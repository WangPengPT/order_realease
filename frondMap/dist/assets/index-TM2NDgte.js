var s8=e=>{throw TypeError(e)};var KN=(e,t,r)=>t.has(e)||s8("Cannot "+r);var wt=(e,t,r)=>(KN(e,t,"read from private field"),r?r.call(e):t.get(e)),Un=(e,t,r)=>t.has(e)?s8("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),hn=(e,t,r,n)=>(KN(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),ji=(e,t,r)=>(KN(e,t,"access private method"),r);var tP=(e,t,r,n)=>({set _(o){hn(e,t,o,r)},get _(){return wt(e,t,n)}});function dZ(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const o in n)if(o!=="default"&&!(o in e)){const l=Object.getOwnPropertyDescriptor(n,o);l&&Object.defineProperty(e,o,l.get?l:{enumerable:!0,get:()=>n[o]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function r(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=r(o);fetch(o.href,l)}})();var gc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _a(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Ffe(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}),r}var hZ={exports:{}},Bk={},fZ={exports:{}},Hi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var TT=Symbol.for("react.element"),zfe=Symbol.for("react.portal"),Bfe=Symbol.for("react.fragment"),$fe=Symbol.for("react.strict_mode"),Ufe=Symbol.for("react.profiler"),Vfe=Symbol.for("react.provider"),qfe=Symbol.for("react.context"),Wfe=Symbol.for("react.forward_ref"),Gfe=Symbol.for("react.suspense"),Hfe=Symbol.for("react.memo"),Kfe=Symbol.for("react.lazy"),l8=Symbol.iterator;function Zfe(e){return e===null||typeof e!="object"?null:(e=l8&&e[l8]||e["@@iterator"],typeof e=="function"?e:null)}var pZ={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},mZ=Object.assign,gZ={};function vb(e,t,r){this.props=e,this.context=t,this.refs=gZ,this.updater=r||pZ}vb.prototype.isReactComponent={};vb.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};vb.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function yZ(){}yZ.prototype=vb.prototype;function mz(e,t,r){this.props=e,this.context=t,this.refs=gZ,this.updater=r||pZ}var gz=mz.prototype=new yZ;gz.constructor=mz;mZ(gz,vb.prototype);gz.isPureReactComponent=!0;var c8=Array.isArray,vZ=Object.prototype.hasOwnProperty,yz={current:null},_Z={key:!0,ref:!0,__self:!0,__source:!0};function xZ(e,t,r){var n,o={},l=null,d=null;if(t!=null)for(n in t.ref!==void 0&&(d=t.ref),t.key!==void 0&&(l=""+t.key),t)vZ.call(t,n)&&!_Z.hasOwnProperty(n)&&(o[n]=t[n]);var i=arguments.length-2;if(i===1)o.children=r;else if(1<i){for(var g=Array(i),_=0;_<i;_++)g[_]=arguments[_+2];o.children=g}if(e&&e.defaultProps)for(n in i=e.defaultProps,i)o[n]===void 0&&(o[n]=i[n]);return{$$typeof:TT,type:e,key:l,ref:d,props:o,_owner:yz.current}}function Xfe(e,t){return{$$typeof:TT,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function vz(e){return typeof e=="object"&&e!==null&&e.$$typeof===TT}function Yfe(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var u8=/\/+/g;function ZN(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Yfe(""+e.key):t.toString(36)}function QP(e,t,r,n,o){var l=typeof e;(l==="undefined"||l==="boolean")&&(e=null);var d=!1;if(e===null)d=!0;else switch(l){case"string":case"number":d=!0;break;case"object":switch(e.$$typeof){case TT:case zfe:d=!0}}if(d)return d=e,o=o(d),e=n===""?"."+ZN(d,0):n,c8(o)?(r="",e!=null&&(r=e.replace(u8,"$&/")+"/"),QP(o,t,r,"",function(_){return _})):o!=null&&(vz(o)&&(o=Xfe(o,r+(!o.key||d&&d.key===o.key?"":(""+o.key).replace(u8,"$&/")+"/")+e)),t.push(o)),1;if(d=0,n=n===""?".":n+":",c8(e))for(var i=0;i<e.length;i++){l=e[i];var g=n+ZN(l,i);d+=QP(l,t,r,g,o)}else if(g=Zfe(e),typeof g=="function")for(e=g.call(e),i=0;!(l=e.next()).done;)l=l.value,g=n+ZN(l,i++),d+=QP(l,t,r,g,o);else if(l==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return d}function rP(e,t,r){if(e==null)return e;var n=[],o=0;return QP(e,n,"","",function(l){return t.call(r,l,o++)}),n}function Jfe(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Kl={current:null},eC={transition:null},Qfe={ReactCurrentDispatcher:Kl,ReactCurrentBatchConfig:eC,ReactCurrentOwner:yz};function bZ(){throw Error("act(...) is not supported in production builds of React.")}Hi.Children={map:rP,forEach:function(e,t,r){rP(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return rP(e,function(){t++}),t},toArray:function(e){return rP(e,function(t){return t})||[]},only:function(e){if(!vz(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Hi.Component=vb;Hi.Fragment=Bfe;Hi.Profiler=Ufe;Hi.PureComponent=mz;Hi.StrictMode=$fe;Hi.Suspense=Gfe;Hi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Qfe;Hi.act=bZ;Hi.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=mZ({},e.props),o=e.key,l=e.ref,d=e._owner;if(t!=null){if(t.ref!==void 0&&(l=t.ref,d=yz.current),t.key!==void 0&&(o=""+t.key),e.type&&e.type.defaultProps)var i=e.type.defaultProps;for(g in t)vZ.call(t,g)&&!_Z.hasOwnProperty(g)&&(n[g]=t[g]===void 0&&i!==void 0?i[g]:t[g])}var g=arguments.length-2;if(g===1)n.children=r;else if(1<g){i=Array(g);for(var _=0;_<g;_++)i[_]=arguments[_+2];n.children=i}return{$$typeof:TT,type:e.type,key:o,ref:l,props:n,_owner:d}};Hi.createContext=function(e){return e={$$typeof:qfe,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Vfe,_context:e},e.Consumer=e};Hi.createElement=xZ;Hi.createFactory=function(e){var t=xZ.bind(null,e);return t.type=e,t};Hi.createRef=function(){return{current:null}};Hi.forwardRef=function(e){return{$$typeof:Wfe,render:e}};Hi.isValidElement=vz;Hi.lazy=function(e){return{$$typeof:Kfe,_payload:{_status:-1,_result:e},_init:Jfe}};Hi.memo=function(e,t){return{$$typeof:Hfe,type:e,compare:t===void 0?null:t}};Hi.startTransition=function(e){var t=eC.transition;eC.transition={};try{e()}finally{eC.transition=t}};Hi.unstable_act=bZ;Hi.useCallback=function(e,t){return Kl.current.useCallback(e,t)};Hi.useContext=function(e){return Kl.current.useContext(e)};Hi.useDebugValue=function(){};Hi.useDeferredValue=function(e){return Kl.current.useDeferredValue(e)};Hi.useEffect=function(e,t){return Kl.current.useEffect(e,t)};Hi.useId=function(){return Kl.current.useId()};Hi.useImperativeHandle=function(e,t,r){return Kl.current.useImperativeHandle(e,t,r)};Hi.useInsertionEffect=function(e,t){return Kl.current.useInsertionEffect(e,t)};Hi.useLayoutEffect=function(e,t){return Kl.current.useLayoutEffect(e,t)};Hi.useMemo=function(e,t){return Kl.current.useMemo(e,t)};Hi.useReducer=function(e,t,r){return Kl.current.useReducer(e,t,r)};Hi.useRef=function(e){return Kl.current.useRef(e)};Hi.useState=function(e){return Kl.current.useState(e)};Hi.useSyncExternalStore=function(e,t,r){return Kl.current.useSyncExternalStore(e,t,r)};Hi.useTransition=function(){return Kl.current.useTransition()};Hi.version="18.3.1";fZ.exports=Hi;var W=fZ.exports;const He=_a(W),_z=dZ({__proto__:null,default:He},[W]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var epe=W,tpe=Symbol.for("react.element"),rpe=Symbol.for("react.fragment"),npe=Object.prototype.hasOwnProperty,ipe=epe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ape={key:!0,ref:!0,__self:!0,__source:!0};function wZ(e,t,r){var n,o={},l=null,d=null;r!==void 0&&(l=""+r),t.key!==void 0&&(l=""+t.key),t.ref!==void 0&&(d=t.ref);for(n in t)npe.call(t,n)&&!ape.hasOwnProperty(n)&&(o[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)o[n]===void 0&&(o[n]=t[n]);return{$$typeof:tpe,type:e,key:l,ref:d,props:o,_owner:ipe.current}}Bk.Fragment=rpe;Bk.jsx=wZ;Bk.jsxs=wZ;hZ.exports=Bk;var m=hZ.exports,SZ={exports:{}},tu={},EZ={exports:{}},TZ={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(Ce,me){var Pe=Ce.length;Ce.push(me);e:for(;0<Pe;){var ye=Pe-1>>>1,pe=Ce[ye];if(0<o(pe,me))Ce[ye]=me,Ce[Pe]=pe,Pe=ye;else break e}}function r(Ce){return Ce.length===0?null:Ce[0]}function n(Ce){if(Ce.length===0)return null;var me=Ce[0],Pe=Ce.pop();if(Pe!==me){Ce[0]=Pe;e:for(var ye=0,pe=Ce.length,Ie=pe>>>1;ye<Ie;){var tt=2*(ye+1)-1,Ze=Ce[tt],Le=tt+1,qe=Ce[Le];if(0>o(Ze,Pe))Le<pe&&0>o(qe,Ze)?(Ce[ye]=qe,Ce[Le]=Pe,ye=Le):(Ce[ye]=Ze,Ce[tt]=Pe,ye=tt);else if(Le<pe&&0>o(qe,Pe))Ce[ye]=qe,Ce[Le]=Pe,ye=Le;else break e}}return me}function o(Ce,me){var Pe=Ce.sortIndex-me.sortIndex;return Pe!==0?Pe:Ce.id-me.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;e.unstable_now=function(){return l.now()}}else{var d=Date,i=d.now();e.unstable_now=function(){return d.now()-i}}var g=[],_=[],S=1,E=null,T=3,C=!1,N=!1,I=!1,j=typeof setTimeout=="function"?setTimeout:null,D=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function F(Ce){for(var me=r(_);me!==null;){if(me.callback===null)n(_);else if(me.startTime<=Ce)n(_),me.sortIndex=me.expirationTime,t(g,me);else break;me=r(_)}}function B(Ce){if(I=!1,F(Ce),!N)if(r(g)!==null)N=!0,we(U);else{var me=r(_);me!==null&&Ae(B,me.startTime-Ce)}}function U(Ce,me){N=!1,I&&(I=!1,D(te),te=-1),C=!0;var Pe=T;try{for(F(me),E=r(g);E!==null&&(!(E.expirationTime>me)||Ce&&!ie());){var ye=E.callback;if(typeof ye=="function"){E.callback=null,T=E.priorityLevel;var pe=ye(E.expirationTime<=me);me=e.unstable_now(),typeof pe=="function"?E.callback=pe:E===r(g)&&n(g),F(me)}else n(g);E=r(g)}if(E!==null)var Ie=!0;else{var tt=r(_);tt!==null&&Ae(B,tt.startTime-me),Ie=!1}return Ie}finally{E=null,T=Pe,C=!1}}var Z=!1,J=null,te=-1,ae=5,ne=-1;function ie(){return!(e.unstable_now()-ne<ae)}function ee(){if(J!==null){var Ce=e.unstable_now();ne=Ce;var me=!0;try{me=J(!0,Ce)}finally{me?oe():(Z=!1,J=null)}}else Z=!1}var oe;if(typeof R=="function")oe=function(){R(ee)};else if(typeof MessageChannel<"u"){var de=new MessageChannel,xe=de.port2;de.port1.onmessage=ee,oe=function(){xe.postMessage(null)}}else oe=function(){j(ee,0)};function we(Ce){J=Ce,Z||(Z=!0,oe())}function Ae(Ce,me){te=j(function(){Ce(e.unstable_now())},me)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Ce){Ce.callback=null},e.unstable_continueExecution=function(){N||C||(N=!0,we(U))},e.unstable_forceFrameRate=function(Ce){0>Ce||125<Ce?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ae=0<Ce?Math.floor(1e3/Ce):5},e.unstable_getCurrentPriorityLevel=function(){return T},e.unstable_getFirstCallbackNode=function(){return r(g)},e.unstable_next=function(Ce){switch(T){case 1:case 2:case 3:var me=3;break;default:me=T}var Pe=T;T=me;try{return Ce()}finally{T=Pe}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Ce,me){switch(Ce){case 1:case 2:case 3:case 4:case 5:break;default:Ce=3}var Pe=T;T=Ce;try{return me()}finally{T=Pe}},e.unstable_scheduleCallback=function(Ce,me,Pe){var ye=e.unstable_now();switch(typeof Pe=="object"&&Pe!==null?(Pe=Pe.delay,Pe=typeof Pe=="number"&&0<Pe?ye+Pe:ye):Pe=ye,Ce){case 1:var pe=-1;break;case 2:pe=250;break;case 5:pe=1073741823;break;case 4:pe=1e4;break;default:pe=5e3}return pe=Pe+pe,Ce={id:S++,callback:me,priorityLevel:Ce,startTime:Pe,expirationTime:pe,sortIndex:-1},Pe>ye?(Ce.sortIndex=Pe,t(_,Ce),r(g)===null&&Ce===r(_)&&(I?(D(te),te=-1):I=!0,Ae(B,Pe-ye))):(Ce.sortIndex=pe,t(g,Ce),N||C||(N=!0,we(U))),Ce},e.unstable_shouldYield=ie,e.unstable_wrapCallback=function(Ce){var me=T;return function(){var Pe=T;T=me;try{return Ce.apply(this,arguments)}finally{T=Pe}}}})(TZ);EZ.exports=TZ;var ope=EZ.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var spe=W,Jc=ope;function kr(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var AZ=new Set,oE={};function Ev(e,t){b0(e,t),b0(e+"Capture",t)}function b0(e,t){for(oE[e]=t,e=0;e<t.length;e++)AZ.add(t[e])}var Rf=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),jD=Object.prototype.hasOwnProperty,lpe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d8={},h8={};function cpe(e){return jD.call(h8,e)?!0:jD.call(d8,e)?!1:lpe.test(e)?h8[e]=!0:(d8[e]=!0,!1)}function upe(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function dpe(e,t,r,n){if(t===null||typeof t>"u"||upe(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Zl(e,t,r,n,o,l,d){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=o,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=l,this.removeEmptyString=d}var Ks={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Ks[e]=new Zl(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Ks[t]=new Zl(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Ks[e]=new Zl(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Ks[e]=new Zl(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Ks[e]=new Zl(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Ks[e]=new Zl(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Ks[e]=new Zl(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Ks[e]=new Zl(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Ks[e]=new Zl(e,5,!1,e.toLowerCase(),null,!1,!1)});var xz=/[\-:]([a-z])/g;function bz(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(xz,bz);Ks[t]=new Zl(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(xz,bz);Ks[t]=new Zl(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(xz,bz);Ks[t]=new Zl(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Ks[e]=new Zl(e,1,!1,e.toLowerCase(),null,!1,!1)});Ks.xlinkHref=new Zl("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Ks[e]=new Zl(e,1,!1,e.toLowerCase(),null,!0,!0)});function wz(e,t,r,n){var o=Ks.hasOwnProperty(t)?Ks[t]:null;(o!==null?o.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(dpe(t,r,o,n)&&(r=null),n||o===null?cpe(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):o.mustUseProperty?e[o.propertyName]=r===null?o.type===3?!1:"":r:(t=o.attributeName,n=o.attributeNamespace,r===null?e.removeAttribute(t):(o=o.type,r=o===3||o===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var Uf=spe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,nP=Symbol.for("react.element"),kx=Symbol.for("react.portal"),Ix=Symbol.for("react.fragment"),Sz=Symbol.for("react.strict_mode"),ND=Symbol.for("react.profiler"),PZ=Symbol.for("react.provider"),CZ=Symbol.for("react.context"),Ez=Symbol.for("react.forward_ref"),MD=Symbol.for("react.suspense"),DD=Symbol.for("react.suspense_list"),Tz=Symbol.for("react.memo"),Jp=Symbol.for("react.lazy"),OZ=Symbol.for("react.offscreen"),f8=Symbol.iterator;function Y1(e){return e===null||typeof e!="object"?null:(e=f8&&e[f8]||e["@@iterator"],typeof e=="function"?e:null)}var bo=Object.assign,XN;function ES(e){if(XN===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);XN=t&&t[1]||""}return`
`+XN+e}var YN=!1;function JN(e,t){if(!e||YN)return"";YN=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(_){var n=_}Reflect.construct(e,[],t)}else{try{t.call()}catch(_){n=_}e.call(t.prototype)}else{try{throw Error()}catch(_){n=_}e()}}catch(_){if(_&&n&&typeof _.stack=="string"){for(var o=_.stack.split(`
`),l=n.stack.split(`
`),d=o.length-1,i=l.length-1;1<=d&&0<=i&&o[d]!==l[i];)i--;for(;1<=d&&0<=i;d--,i--)if(o[d]!==l[i]){if(d!==1||i!==1)do if(d--,i--,0>i||o[d]!==l[i]){var g=`
`+o[d].replace(" at new "," at ");return e.displayName&&g.includes("<anonymous>")&&(g=g.replace("<anonymous>",e.displayName)),g}while(1<=d&&0<=i);break}}}finally{YN=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?ES(e):""}function hpe(e){switch(e.tag){case 5:return ES(e.type);case 16:return ES("Lazy");case 13:return ES("Suspense");case 19:return ES("SuspenseList");case 0:case 2:case 15:return e=JN(e.type,!1),e;case 11:return e=JN(e.type.render,!1),e;case 1:return e=JN(e.type,!0),e;default:return""}}function LD(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Ix:return"Fragment";case kx:return"Portal";case ND:return"Profiler";case Sz:return"StrictMode";case MD:return"Suspense";case DD:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case CZ:return(e.displayName||"Context")+".Consumer";case PZ:return(e._context.displayName||"Context")+".Provider";case Ez:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Tz:return t=e.displayName||null,t!==null?t:LD(e.type)||"Memo";case Jp:t=e._payload,e=e._init;try{return LD(e(t))}catch{}}return null}function fpe(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return LD(t);case 8:return t===Sz?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function $m(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function kZ(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function ppe(e){var t=kZ(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var o=r.get,l=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(d){n=""+d,l.call(this,d)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(d){n=""+d},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function iP(e){e._valueTracker||(e._valueTracker=ppe(e))}function IZ(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=kZ(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function IC(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function FD(e,t){var r=t.checked;return bo({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function p8(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=$m(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function RZ(e,t){t=t.checked,t!=null&&wz(e,"checked",t,!1)}function zD(e,t){RZ(e,t);var r=$m(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?BD(e,t.type,r):t.hasOwnProperty("defaultValue")&&BD(e,t.type,$m(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function m8(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function BD(e,t,r){(t!=="number"||IC(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var TS=Array.isArray;function Hx(e,t,r,n){if(e=e.options,t){t={};for(var o=0;o<r.length;o++)t["$"+r[o]]=!0;for(r=0;r<e.length;r++)o=t.hasOwnProperty("$"+e[r].value),e[r].selected!==o&&(e[r].selected=o),o&&n&&(e[r].defaultSelected=!0)}else{for(r=""+$m(r),t=null,o=0;o<e.length;o++){if(e[o].value===r){e[o].selected=!0,n&&(e[o].defaultSelected=!0);return}t!==null||e[o].disabled||(t=e[o])}t!==null&&(t.selected=!0)}}function $D(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(kr(91));return bo({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function g8(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(kr(92));if(TS(r)){if(1<r.length)throw Error(kr(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:$m(r)}}function jZ(e,t){var r=$m(t.value),n=$m(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function y8(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function NZ(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function UD(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?NZ(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var aP,MZ=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,o){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,o)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(aP=aP||document.createElement("div"),aP.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=aP.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function sE(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var FS={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},mpe=["Webkit","ms","Moz","O"];Object.keys(FS).forEach(function(e){mpe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),FS[t]=FS[e]})});function DZ(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||FS.hasOwnProperty(e)&&FS[e]?(""+t).trim():t+"px"}function LZ(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,o=DZ(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,o):e[r]=o}}var gpe=bo({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function VD(e,t){if(t){if(gpe[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(kr(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(kr(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(kr(61))}if(t.style!=null&&typeof t.style!="object")throw Error(kr(62))}}function qD(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var WD=null;function Az(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var GD=null,Kx=null,Zx=null;function v8(e){if(e=CT(e)){if(typeof GD!="function")throw Error(kr(280));var t=e.stateNode;t&&(t=Wk(t),GD(e.stateNode,e.type,t))}}function FZ(e){Kx?Zx?Zx.push(e):Zx=[e]:Kx=e}function zZ(){if(Kx){var e=Kx,t=Zx;if(Zx=Kx=null,v8(e),t)for(e=0;e<t.length;e++)v8(t[e])}}function BZ(e,t){return e(t)}function $Z(){}var QN=!1;function UZ(e,t,r){if(QN)return e(t,r);QN=!0;try{return BZ(e,t,r)}finally{QN=!1,(Kx!==null||Zx!==null)&&($Z(),zZ())}}function lE(e,t){var r=e.stateNode;if(r===null)return null;var n=Wk(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(kr(231,t,typeof r));return r}var HD=!1;if(Rf)try{var J1={};Object.defineProperty(J1,"passive",{get:function(){HD=!0}}),window.addEventListener("test",J1,J1),window.removeEventListener("test",J1,J1)}catch{HD=!1}function ype(e,t,r,n,o,l,d,i,g){var _=Array.prototype.slice.call(arguments,3);try{t.apply(r,_)}catch(S){this.onError(S)}}var zS=!1,RC=null,jC=!1,KD=null,vpe={onError:function(e){zS=!0,RC=e}};function _pe(e,t,r,n,o,l,d,i,g){zS=!1,RC=null,ype.apply(vpe,arguments)}function xpe(e,t,r,n,o,l,d,i,g){if(_pe.apply(this,arguments),zS){if(zS){var _=RC;zS=!1,RC=null}else throw Error(kr(198));jC||(jC=!0,KD=_)}}function Tv(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function VZ(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function _8(e){if(Tv(e)!==e)throw Error(kr(188))}function bpe(e){var t=e.alternate;if(!t){if(t=Tv(e),t===null)throw Error(kr(188));return t!==e?null:e}for(var r=e,n=t;;){var o=r.return;if(o===null)break;var l=o.alternate;if(l===null){if(n=o.return,n!==null){r=n;continue}break}if(o.child===l.child){for(l=o.child;l;){if(l===r)return _8(o),e;if(l===n)return _8(o),t;l=l.sibling}throw Error(kr(188))}if(r.return!==n.return)r=o,n=l;else{for(var d=!1,i=o.child;i;){if(i===r){d=!0,r=o,n=l;break}if(i===n){d=!0,n=o,r=l;break}i=i.sibling}if(!d){for(i=l.child;i;){if(i===r){d=!0,r=l,n=o;break}if(i===n){d=!0,n=l,r=o;break}i=i.sibling}if(!d)throw Error(kr(189))}}if(r.alternate!==n)throw Error(kr(190))}if(r.tag!==3)throw Error(kr(188));return r.stateNode.current===r?e:t}function qZ(e){return e=bpe(e),e!==null?WZ(e):null}function WZ(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=WZ(e);if(t!==null)return t;e=e.sibling}return null}var GZ=Jc.unstable_scheduleCallback,x8=Jc.unstable_cancelCallback,wpe=Jc.unstable_shouldYield,Spe=Jc.unstable_requestPaint,Do=Jc.unstable_now,Epe=Jc.unstable_getCurrentPriorityLevel,Pz=Jc.unstable_ImmediatePriority,HZ=Jc.unstable_UserBlockingPriority,NC=Jc.unstable_NormalPriority,Tpe=Jc.unstable_LowPriority,KZ=Jc.unstable_IdlePriority,$k=null,_h=null;function Ape(e){if(_h&&typeof _h.onCommitFiberRoot=="function")try{_h.onCommitFiberRoot($k,e,void 0,(e.current.flags&128)===128)}catch{}}var xd=Math.clz32?Math.clz32:Ope,Ppe=Math.log,Cpe=Math.LN2;function Ope(e){return e>>>=0,e===0?32:31-(Ppe(e)/Cpe|0)|0}var oP=64,sP=4194304;function AS(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function MC(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,o=e.suspendedLanes,l=e.pingedLanes,d=r&268435455;if(d!==0){var i=d&~o;i!==0?n=AS(i):(l&=d,l!==0&&(n=AS(l)))}else d=r&~o,d!==0?n=AS(d):l!==0&&(n=AS(l));if(n===0)return 0;if(t!==0&&t!==n&&!(t&o)&&(o=n&-n,l=t&-t,o>=l||o===16&&(l&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-xd(t),o=1<<r,n|=e[r],t&=~o;return n}function kpe(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ipe(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,o=e.expirationTimes,l=e.pendingLanes;0<l;){var d=31-xd(l),i=1<<d,g=o[d];g===-1?(!(i&r)||i&n)&&(o[d]=kpe(i,t)):g<=t&&(e.expiredLanes|=i),l&=~i}}function ZD(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function ZZ(){var e=oP;return oP<<=1,!(oP&4194240)&&(oP=64),e}function eM(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function AT(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-xd(t),e[t]=r}function Rpe(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var o=31-xd(r),l=1<<o;t[o]=0,n[o]=-1,e[o]=-1,r&=~l}}function Cz(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-xd(r),o=1<<n;o&t|e[n]&t&&(e[n]|=t),r&=~o}}var Na=0;function XZ(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var YZ,Oz,JZ,QZ,eX,XD=!1,lP=[],Pm=null,Cm=null,Om=null,cE=new Map,uE=new Map,rm=[],jpe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function b8(e,t){switch(e){case"focusin":case"focusout":Pm=null;break;case"dragenter":case"dragleave":Cm=null;break;case"mouseover":case"mouseout":Om=null;break;case"pointerover":case"pointerout":cE.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":uE.delete(t.pointerId)}}function Q1(e,t,r,n,o,l){return e===null||e.nativeEvent!==l?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:l,targetContainers:[o]},t!==null&&(t=CT(t),t!==null&&Oz(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),e)}function Npe(e,t,r,n,o){switch(t){case"focusin":return Pm=Q1(Pm,e,t,r,n,o),!0;case"dragenter":return Cm=Q1(Cm,e,t,r,n,o),!0;case"mouseover":return Om=Q1(Om,e,t,r,n,o),!0;case"pointerover":var l=o.pointerId;return cE.set(l,Q1(cE.get(l)||null,e,t,r,n,o)),!0;case"gotpointercapture":return l=o.pointerId,uE.set(l,Q1(uE.get(l)||null,e,t,r,n,o)),!0}return!1}function tX(e){var t=jy(e.target);if(t!==null){var r=Tv(t);if(r!==null){if(t=r.tag,t===13){if(t=VZ(r),t!==null){e.blockedOn=t,eX(e.priority,function(){JZ(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function tC(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=YD(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);WD=n,r.target.dispatchEvent(n),WD=null}else return t=CT(r),t!==null&&Oz(t),e.blockedOn=r,!1;t.shift()}return!0}function w8(e,t,r){tC(e)&&r.delete(t)}function Mpe(){XD=!1,Pm!==null&&tC(Pm)&&(Pm=null),Cm!==null&&tC(Cm)&&(Cm=null),Om!==null&&tC(Om)&&(Om=null),cE.forEach(w8),uE.forEach(w8)}function eS(e,t){e.blockedOn===t&&(e.blockedOn=null,XD||(XD=!0,Jc.unstable_scheduleCallback(Jc.unstable_NormalPriority,Mpe)))}function dE(e){function t(o){return eS(o,e)}if(0<lP.length){eS(lP[0],e);for(var r=1;r<lP.length;r++){var n=lP[r];n.blockedOn===e&&(n.blockedOn=null)}}for(Pm!==null&&eS(Pm,e),Cm!==null&&eS(Cm,e),Om!==null&&eS(Om,e),cE.forEach(t),uE.forEach(t),r=0;r<rm.length;r++)n=rm[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<rm.length&&(r=rm[0],r.blockedOn===null);)tX(r),r.blockedOn===null&&rm.shift()}var Xx=Uf.ReactCurrentBatchConfig,DC=!0;function Dpe(e,t,r,n){var o=Na,l=Xx.transition;Xx.transition=null;try{Na=1,kz(e,t,r,n)}finally{Na=o,Xx.transition=l}}function Lpe(e,t,r,n){var o=Na,l=Xx.transition;Xx.transition=null;try{Na=4,kz(e,t,r,n)}finally{Na=o,Xx.transition=l}}function kz(e,t,r,n){if(DC){var o=YD(e,t,r,n);if(o===null)uM(e,t,n,LC,r),b8(e,n);else if(Npe(o,e,t,r,n))n.stopPropagation();else if(b8(e,n),t&4&&-1<jpe.indexOf(e)){for(;o!==null;){var l=CT(o);if(l!==null&&YZ(l),l=YD(e,t,r,n),l===null&&uM(e,t,n,LC,r),l===o)break;o=l}o!==null&&n.stopPropagation()}else uM(e,t,n,null,r)}}var LC=null;function YD(e,t,r,n){if(LC=null,e=Az(n),e=jy(e),e!==null)if(t=Tv(e),t===null)e=null;else if(r=t.tag,r===13){if(e=VZ(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return LC=e,null}function rX(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Epe()){case Pz:return 1;case HZ:return 4;case NC:case Tpe:return 16;case KZ:return 536870912;default:return 16}default:return 16}}var bm=null,Iz=null,rC=null;function nX(){if(rC)return rC;var e,t=Iz,r=t.length,n,o="value"in bm?bm.value:bm.textContent,l=o.length;for(e=0;e<r&&t[e]===o[e];e++);var d=r-e;for(n=1;n<=d&&t[r-n]===o[l-n];n++);return rC=o.slice(e,1<n?1-n:void 0)}function nC(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function cP(){return!0}function S8(){return!1}function ru(e){function t(r,n,o,l,d){this._reactName=r,this._targetInst=o,this.type=n,this.nativeEvent=l,this.target=d,this.currentTarget=null;for(var i in e)e.hasOwnProperty(i)&&(r=e[i],this[i]=r?r(l):l[i]);return this.isDefaultPrevented=(l.defaultPrevented!=null?l.defaultPrevented:l.returnValue===!1)?cP:S8,this.isPropagationStopped=S8,this}return bo(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=cP)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=cP)},persist:function(){},isPersistent:cP}),t}var _b={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Rz=ru(_b),PT=bo({},_b,{view:0,detail:0}),Fpe=ru(PT),tM,rM,tS,Uk=bo({},PT,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:jz,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==tS&&(tS&&e.type==="mousemove"?(tM=e.screenX-tS.screenX,rM=e.screenY-tS.screenY):rM=tM=0,tS=e),tM)},movementY:function(e){return"movementY"in e?e.movementY:rM}}),E8=ru(Uk),zpe=bo({},Uk,{dataTransfer:0}),Bpe=ru(zpe),$pe=bo({},PT,{relatedTarget:0}),nM=ru($pe),Upe=bo({},_b,{animationName:0,elapsedTime:0,pseudoElement:0}),Vpe=ru(Upe),qpe=bo({},_b,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Wpe=ru(qpe),Gpe=bo({},_b,{data:0}),T8=ru(Gpe),Hpe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Kpe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Zpe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Xpe(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Zpe[e])?!!t[e]:!1}function jz(){return Xpe}var Ype=bo({},PT,{key:function(e){if(e.key){var t=Hpe[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=nC(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Kpe[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:jz,charCode:function(e){return e.type==="keypress"?nC(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?nC(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Jpe=ru(Ype),Qpe=bo({},Uk,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),A8=ru(Qpe),eme=bo({},PT,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:jz}),tme=ru(eme),rme=bo({},_b,{propertyName:0,elapsedTime:0,pseudoElement:0}),nme=ru(rme),ime=bo({},Uk,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),ame=ru(ime),ome=[9,13,27,32],Nz=Rf&&"CompositionEvent"in window,BS=null;Rf&&"documentMode"in document&&(BS=document.documentMode);var sme=Rf&&"TextEvent"in window&&!BS,iX=Rf&&(!Nz||BS&&8<BS&&11>=BS),P8=" ",C8=!1;function aX(e,t){switch(e){case"keyup":return ome.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function oX(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Rx=!1;function lme(e,t){switch(e){case"compositionend":return oX(t);case"keypress":return t.which!==32?null:(C8=!0,P8);case"textInput":return e=t.data,e===P8&&C8?null:e;default:return null}}function cme(e,t){if(Rx)return e==="compositionend"||!Nz&&aX(e,t)?(e=nX(),rC=Iz=bm=null,Rx=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return iX&&t.locale!=="ko"?null:t.data;default:return null}}var ume={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function O8(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!ume[e.type]:t==="textarea"}function sX(e,t,r,n){FZ(n),t=FC(t,"onChange"),0<t.length&&(r=new Rz("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var $S=null,hE=null;function dme(e){vX(e,0)}function Vk(e){var t=Mx(e);if(IZ(t))return e}function hme(e,t){if(e==="change")return t}var lX=!1;if(Rf){var iM;if(Rf){var aM="oninput"in document;if(!aM){var k8=document.createElement("div");k8.setAttribute("oninput","return;"),aM=typeof k8.oninput=="function"}iM=aM}else iM=!1;lX=iM&&(!document.documentMode||9<document.documentMode)}function I8(){$S&&($S.detachEvent("onpropertychange",cX),hE=$S=null)}function cX(e){if(e.propertyName==="value"&&Vk(hE)){var t=[];sX(t,hE,e,Az(e)),UZ(dme,t)}}function fme(e,t,r){e==="focusin"?(I8(),$S=t,hE=r,$S.attachEvent("onpropertychange",cX)):e==="focusout"&&I8()}function pme(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Vk(hE)}function mme(e,t){if(e==="click")return Vk(t)}function gme(e,t){if(e==="input"||e==="change")return Vk(t)}function yme(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Td=typeof Object.is=="function"?Object.is:yme;function fE(e,t){if(Td(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var o=r[n];if(!jD.call(t,o)||!Td(e[o],t[o]))return!1}return!0}function R8(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function j8(e,t){var r=R8(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=R8(r)}}function uX(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?uX(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function dX(){for(var e=window,t=IC();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=IC(e.document)}return t}function Mz(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function vme(e){var t=dX(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&uX(r.ownerDocument.documentElement,r)){if(n!==null&&Mz(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var o=r.textContent.length,l=Math.min(n.start,o);n=n.end===void 0?l:Math.min(n.end,o),!e.extend&&l>n&&(o=n,n=l,l=o),o=j8(r,l);var d=j8(r,n);o&&d&&(e.rangeCount!==1||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==d.node||e.focusOffset!==d.offset)&&(t=t.createRange(),t.setStart(o.node,o.offset),e.removeAllRanges(),l>n?(e.addRange(t),e.extend(d.node,d.offset)):(t.setEnd(d.node,d.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var _me=Rf&&"documentMode"in document&&11>=document.documentMode,jx=null,JD=null,US=null,QD=!1;function N8(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;QD||jx==null||jx!==IC(n)||(n=jx,"selectionStart"in n&&Mz(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),US&&fE(US,n)||(US=n,n=FC(JD,"onSelect"),0<n.length&&(t=new Rz("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=jx)))}function uP(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Nx={animationend:uP("Animation","AnimationEnd"),animationiteration:uP("Animation","AnimationIteration"),animationstart:uP("Animation","AnimationStart"),transitionend:uP("Transition","TransitionEnd")},oM={},hX={};Rf&&(hX=document.createElement("div").style,"AnimationEvent"in window||(delete Nx.animationend.animation,delete Nx.animationiteration.animation,delete Nx.animationstart.animation),"TransitionEvent"in window||delete Nx.transitionend.transition);function qk(e){if(oM[e])return oM[e];if(!Nx[e])return e;var t=Nx[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in hX)return oM[e]=t[r];return e}var fX=qk("animationend"),pX=qk("animationiteration"),mX=qk("animationstart"),gX=qk("transitionend"),yX=new Map,M8="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Jm(e,t){yX.set(e,t),Ev(t,[e])}for(var sM=0;sM<M8.length;sM++){var lM=M8[sM],xme=lM.toLowerCase(),bme=lM[0].toUpperCase()+lM.slice(1);Jm(xme,"on"+bme)}Jm(fX,"onAnimationEnd");Jm(pX,"onAnimationIteration");Jm(mX,"onAnimationStart");Jm("dblclick","onDoubleClick");Jm("focusin","onFocus");Jm("focusout","onBlur");Jm(gX,"onTransitionEnd");b0("onMouseEnter",["mouseout","mouseover"]);b0("onMouseLeave",["mouseout","mouseover"]);b0("onPointerEnter",["pointerout","pointerover"]);b0("onPointerLeave",["pointerout","pointerover"]);Ev("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ev("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ev("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ev("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ev("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ev("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var PS="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),wme=new Set("cancel close invalid load scroll toggle".split(" ").concat(PS));function D8(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,xpe(n,t,void 0,e),e.currentTarget=null}function vX(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],o=n.event;n=n.listeners;e:{var l=void 0;if(t)for(var d=n.length-1;0<=d;d--){var i=n[d],g=i.instance,_=i.currentTarget;if(i=i.listener,g!==l&&o.isPropagationStopped())break e;D8(o,i,_),l=g}else for(d=0;d<n.length;d++){if(i=n[d],g=i.instance,_=i.currentTarget,i=i.listener,g!==l&&o.isPropagationStopped())break e;D8(o,i,_),l=g}}}if(jC)throw e=KD,jC=!1,KD=null,e}function no(e,t){var r=t[iL];r===void 0&&(r=t[iL]=new Set);var n=e+"__bubble";r.has(n)||(_X(t,e,2,!1),r.add(n))}function cM(e,t,r){var n=0;t&&(n|=4),_X(r,e,n,t)}var dP="_reactListening"+Math.random().toString(36).slice(2);function pE(e){if(!e[dP]){e[dP]=!0,AZ.forEach(function(r){r!=="selectionchange"&&(wme.has(r)||cM(r,!1,e),cM(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[dP]||(t[dP]=!0,cM("selectionchange",!1,t))}}function _X(e,t,r,n){switch(rX(t)){case 1:var o=Dpe;break;case 4:o=Lpe;break;default:o=kz}r=o.bind(null,t,r,e),o=void 0,!HD||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),n?o!==void 0?e.addEventListener(t,r,{capture:!0,passive:o}):e.addEventListener(t,r,!0):o!==void 0?e.addEventListener(t,r,{passive:o}):e.addEventListener(t,r,!1)}function uM(e,t,r,n,o){var l=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var d=n.tag;if(d===3||d===4){var i=n.stateNode.containerInfo;if(i===o||i.nodeType===8&&i.parentNode===o)break;if(d===4)for(d=n.return;d!==null;){var g=d.tag;if((g===3||g===4)&&(g=d.stateNode.containerInfo,g===o||g.nodeType===8&&g.parentNode===o))return;d=d.return}for(;i!==null;){if(d=jy(i),d===null)return;if(g=d.tag,g===5||g===6){n=l=d;continue e}i=i.parentNode}}n=n.return}UZ(function(){var _=l,S=Az(r),E=[];e:{var T=yX.get(e);if(T!==void 0){var C=Rz,N=e;switch(e){case"keypress":if(nC(r)===0)break e;case"keydown":case"keyup":C=Jpe;break;case"focusin":N="focus",C=nM;break;case"focusout":N="blur",C=nM;break;case"beforeblur":case"afterblur":C=nM;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":C=E8;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":C=Bpe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":C=tme;break;case fX:case pX:case mX:C=Vpe;break;case gX:C=nme;break;case"scroll":C=Fpe;break;case"wheel":C=ame;break;case"copy":case"cut":case"paste":C=Wpe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":C=A8}var I=(t&4)!==0,j=!I&&e==="scroll",D=I?T!==null?T+"Capture":null:T;I=[];for(var R=_,F;R!==null;){F=R;var B=F.stateNode;if(F.tag===5&&B!==null&&(F=B,D!==null&&(B=lE(R,D),B!=null&&I.push(mE(R,B,F)))),j)break;R=R.return}0<I.length&&(T=new C(T,N,null,r,S),E.push({event:T,listeners:I}))}}if(!(t&7)){e:{if(T=e==="mouseover"||e==="pointerover",C=e==="mouseout"||e==="pointerout",T&&r!==WD&&(N=r.relatedTarget||r.fromElement)&&(jy(N)||N[jf]))break e;if((C||T)&&(T=S.window===S?S:(T=S.ownerDocument)?T.defaultView||T.parentWindow:window,C?(N=r.relatedTarget||r.toElement,C=_,N=N?jy(N):null,N!==null&&(j=Tv(N),N!==j||N.tag!==5&&N.tag!==6)&&(N=null)):(C=null,N=_),C!==N)){if(I=E8,B="onMouseLeave",D="onMouseEnter",R="mouse",(e==="pointerout"||e==="pointerover")&&(I=A8,B="onPointerLeave",D="onPointerEnter",R="pointer"),j=C==null?T:Mx(C),F=N==null?T:Mx(N),T=new I(B,R+"leave",C,r,S),T.target=j,T.relatedTarget=F,B=null,jy(S)===_&&(I=new I(D,R+"enter",N,r,S),I.target=F,I.relatedTarget=j,B=I),j=B,C&&N)t:{for(I=C,D=N,R=0,F=I;F;F=dx(F))R++;for(F=0,B=D;B;B=dx(B))F++;for(;0<R-F;)I=dx(I),R--;for(;0<F-R;)D=dx(D),F--;for(;R--;){if(I===D||D!==null&&I===D.alternate)break t;I=dx(I),D=dx(D)}I=null}else I=null;C!==null&&L8(E,T,C,I,!1),N!==null&&j!==null&&L8(E,j,N,I,!0)}}e:{if(T=_?Mx(_):window,C=T.nodeName&&T.nodeName.toLowerCase(),C==="select"||C==="input"&&T.type==="file")var U=hme;else if(O8(T))if(lX)U=gme;else{U=pme;var Z=fme}else(C=T.nodeName)&&C.toLowerCase()==="input"&&(T.type==="checkbox"||T.type==="radio")&&(U=mme);if(U&&(U=U(e,_))){sX(E,U,r,S);break e}Z&&Z(e,T,_),e==="focusout"&&(Z=T._wrapperState)&&Z.controlled&&T.type==="number"&&BD(T,"number",T.value)}switch(Z=_?Mx(_):window,e){case"focusin":(O8(Z)||Z.contentEditable==="true")&&(jx=Z,JD=_,US=null);break;case"focusout":US=JD=jx=null;break;case"mousedown":QD=!0;break;case"contextmenu":case"mouseup":case"dragend":QD=!1,N8(E,r,S);break;case"selectionchange":if(_me)break;case"keydown":case"keyup":N8(E,r,S)}var J;if(Nz)e:{switch(e){case"compositionstart":var te="onCompositionStart";break e;case"compositionend":te="onCompositionEnd";break e;case"compositionupdate":te="onCompositionUpdate";break e}te=void 0}else Rx?aX(e,r)&&(te="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(te="onCompositionStart");te&&(iX&&r.locale!=="ko"&&(Rx||te!=="onCompositionStart"?te==="onCompositionEnd"&&Rx&&(J=nX()):(bm=S,Iz="value"in bm?bm.value:bm.textContent,Rx=!0)),Z=FC(_,te),0<Z.length&&(te=new T8(te,e,null,r,S),E.push({event:te,listeners:Z}),J?te.data=J:(J=oX(r),J!==null&&(te.data=J)))),(J=sme?lme(e,r):cme(e,r))&&(_=FC(_,"onBeforeInput"),0<_.length&&(S=new T8("onBeforeInput","beforeinput",null,r,S),E.push({event:S,listeners:_}),S.data=J))}vX(E,t)})}function mE(e,t,r){return{instance:e,listener:t,currentTarget:r}}function FC(e,t){for(var r=t+"Capture",n=[];e!==null;){var o=e,l=o.stateNode;o.tag===5&&l!==null&&(o=l,l=lE(e,r),l!=null&&n.unshift(mE(e,l,o)),l=lE(e,t),l!=null&&n.push(mE(e,l,o))),e=e.return}return n}function dx(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function L8(e,t,r,n,o){for(var l=t._reactName,d=[];r!==null&&r!==n;){var i=r,g=i.alternate,_=i.stateNode;if(g!==null&&g===n)break;i.tag===5&&_!==null&&(i=_,o?(g=lE(r,l),g!=null&&d.unshift(mE(r,g,i))):o||(g=lE(r,l),g!=null&&d.push(mE(r,g,i)))),r=r.return}d.length!==0&&e.push({event:t,listeners:d})}var Sme=/\r\n?/g,Eme=/\u0000|\uFFFD/g;function F8(e){return(typeof e=="string"?e:""+e).replace(Sme,`
`).replace(Eme,"")}function hP(e,t,r){if(t=F8(t),F8(e)!==t&&r)throw Error(kr(425))}function zC(){}var eL=null,tL=null;function rL(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var nL=typeof setTimeout=="function"?setTimeout:void 0,Tme=typeof clearTimeout=="function"?clearTimeout:void 0,z8=typeof Promise=="function"?Promise:void 0,Ame=typeof queueMicrotask=="function"?queueMicrotask:typeof z8<"u"?function(e){return z8.resolve(null).then(e).catch(Pme)}:nL;function Pme(e){setTimeout(function(){throw e})}function dM(e,t){var r=t,n=0;do{var o=r.nextSibling;if(e.removeChild(r),o&&o.nodeType===8)if(r=o.data,r==="/$"){if(n===0){e.removeChild(o),dE(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=o}while(r);dE(t)}function km(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function B8(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var xb=Math.random().toString(36).slice(2),lh="__reactFiber$"+xb,gE="__reactProps$"+xb,jf="__reactContainer$"+xb,iL="__reactEvents$"+xb,Cme="__reactListeners$"+xb,Ome="__reactHandles$"+xb;function jy(e){var t=e[lh];if(t)return t;for(var r=e.parentNode;r;){if(t=r[jf]||r[lh]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=B8(e);e!==null;){if(r=e[lh])return r;e=B8(e)}return t}e=r,r=e.parentNode}return null}function CT(e){return e=e[lh]||e[jf],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Mx(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(kr(33))}function Wk(e){return e[gE]||null}var aL=[],Dx=-1;function Qm(e){return{current:e}}function oo(e){0>Dx||(e.current=aL[Dx],aL[Dx]=null,Dx--)}function Za(e,t){Dx++,aL[Dx]=e.current,e.current=t}var Um={},ml=Qm(Um),xc=Qm(!1),nv=Um;function w0(e,t){var r=e.type.contextTypes;if(!r)return Um;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var o={},l;for(l in r)o[l]=t[l];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function bc(e){return e=e.childContextTypes,e!=null}function BC(){oo(xc),oo(ml)}function $8(e,t,r){if(ml.current!==Um)throw Error(kr(168));Za(ml,t),Za(xc,r)}function xX(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var o in n)if(!(o in t))throw Error(kr(108,fpe(e)||"Unknown",o));return bo({},r,n)}function $C(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Um,nv=ml.current,Za(ml,e),Za(xc,xc.current),!0}function U8(e,t,r){var n=e.stateNode;if(!n)throw Error(kr(169));r?(e=xX(e,t,nv),n.__reactInternalMemoizedMergedChildContext=e,oo(xc),oo(ml),Za(ml,e)):oo(xc),Za(xc,r)}var mf=null,Gk=!1,hM=!1;function bX(e){mf===null?mf=[e]:mf.push(e)}function kme(e){Gk=!0,bX(e)}function eg(){if(!hM&&mf!==null){hM=!0;var e=0,t=Na;try{var r=mf;for(Na=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}mf=null,Gk=!1}catch(o){throw mf!==null&&(mf=mf.slice(e+1)),GZ(Pz,eg),o}finally{Na=t,hM=!1}}return null}var Lx=[],Fx=0,UC=null,VC=0,yu=[],vu=0,iv=null,_f=1,xf="";function _y(e,t){Lx[Fx++]=VC,Lx[Fx++]=UC,UC=e,VC=t}function wX(e,t,r){yu[vu++]=_f,yu[vu++]=xf,yu[vu++]=iv,iv=e;var n=_f;e=xf;var o=32-xd(n)-1;n&=~(1<<o),r+=1;var l=32-xd(t)+o;if(30<l){var d=o-o%5;l=(n&(1<<d)-1).toString(32),n>>=d,o-=d,_f=1<<32-xd(t)+o|r<<o|n,xf=l+e}else _f=1<<l|r<<o|n,xf=e}function Dz(e){e.return!==null&&(_y(e,1),wX(e,1,0))}function Lz(e){for(;e===UC;)UC=Lx[--Fx],Lx[Fx]=null,VC=Lx[--Fx],Lx[Fx]=null;for(;e===iv;)iv=yu[--vu],yu[vu]=null,xf=yu[--vu],yu[vu]=null,_f=yu[--vu],yu[vu]=null}var Hc=null,Gc=null,ho=!1,gd=null;function SX(e,t){var r=Eu(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function V8(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Hc=e,Gc=km(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Hc=e,Gc=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=iv!==null?{id:_f,overflow:xf}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Eu(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,Hc=e,Gc=null,!0):!1;default:return!1}}function oL(e){return(e.mode&1)!==0&&(e.flags&128)===0}function sL(e){if(ho){var t=Gc;if(t){var r=t;if(!V8(e,t)){if(oL(e))throw Error(kr(418));t=km(r.nextSibling);var n=Hc;t&&V8(e,t)?SX(n,r):(e.flags=e.flags&-4097|2,ho=!1,Hc=e)}}else{if(oL(e))throw Error(kr(418));e.flags=e.flags&-4097|2,ho=!1,Hc=e}}}function q8(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Hc=e}function fP(e){if(e!==Hc)return!1;if(!ho)return q8(e),ho=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!rL(e.type,e.memoizedProps)),t&&(t=Gc)){if(oL(e))throw EX(),Error(kr(418));for(;t;)SX(e,t),t=km(t.nextSibling)}if(q8(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(kr(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){Gc=km(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}Gc=null}}else Gc=Hc?km(e.stateNode.nextSibling):null;return!0}function EX(){for(var e=Gc;e;)e=km(e.nextSibling)}function S0(){Gc=Hc=null,ho=!1}function Fz(e){gd===null?gd=[e]:gd.push(e)}var Ime=Uf.ReactCurrentBatchConfig;function rS(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(kr(309));var n=r.stateNode}if(!n)throw Error(kr(147,e));var o=n,l=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===l?t.ref:(t=function(d){var i=o.refs;d===null?delete i[l]:i[l]=d},t._stringRef=l,t)}if(typeof e!="string")throw Error(kr(284));if(!r._owner)throw Error(kr(290,e))}return e}function pP(e,t){throw e=Object.prototype.toString.call(t),Error(kr(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function W8(e){var t=e._init;return t(e._payload)}function TX(e){function t(D,R){if(e){var F=D.deletions;F===null?(D.deletions=[R],D.flags|=16):F.push(R)}}function r(D,R){if(!e)return null;for(;R!==null;)t(D,R),R=R.sibling;return null}function n(D,R){for(D=new Map;R!==null;)R.key!==null?D.set(R.key,R):D.set(R.index,R),R=R.sibling;return D}function o(D,R){return D=Nm(D,R),D.index=0,D.sibling=null,D}function l(D,R,F){return D.index=F,e?(F=D.alternate,F!==null?(F=F.index,F<R?(D.flags|=2,R):F):(D.flags|=2,R)):(D.flags|=1048576,R)}function d(D){return e&&D.alternate===null&&(D.flags|=2),D}function i(D,R,F,B){return R===null||R.tag!==6?(R=_M(F,D.mode,B),R.return=D,R):(R=o(R,F),R.return=D,R)}function g(D,R,F,B){var U=F.type;return U===Ix?S(D,R,F.props.children,B,F.key):R!==null&&(R.elementType===U||typeof U=="object"&&U!==null&&U.$$typeof===Jp&&W8(U)===R.type)?(B=o(R,F.props),B.ref=rS(D,R,F),B.return=D,B):(B=uC(F.type,F.key,F.props,null,D.mode,B),B.ref=rS(D,R,F),B.return=D,B)}function _(D,R,F,B){return R===null||R.tag!==4||R.stateNode.containerInfo!==F.containerInfo||R.stateNode.implementation!==F.implementation?(R=xM(F,D.mode,B),R.return=D,R):(R=o(R,F.children||[]),R.return=D,R)}function S(D,R,F,B,U){return R===null||R.tag!==7?(R=Qy(F,D.mode,B,U),R.return=D,R):(R=o(R,F),R.return=D,R)}function E(D,R,F){if(typeof R=="string"&&R!==""||typeof R=="number")return R=_M(""+R,D.mode,F),R.return=D,R;if(typeof R=="object"&&R!==null){switch(R.$$typeof){case nP:return F=uC(R.type,R.key,R.props,null,D.mode,F),F.ref=rS(D,null,R),F.return=D,F;case kx:return R=xM(R,D.mode,F),R.return=D,R;case Jp:var B=R._init;return E(D,B(R._payload),F)}if(TS(R)||Y1(R))return R=Qy(R,D.mode,F,null),R.return=D,R;pP(D,R)}return null}function T(D,R,F,B){var U=R!==null?R.key:null;if(typeof F=="string"&&F!==""||typeof F=="number")return U!==null?null:i(D,R,""+F,B);if(typeof F=="object"&&F!==null){switch(F.$$typeof){case nP:return F.key===U?g(D,R,F,B):null;case kx:return F.key===U?_(D,R,F,B):null;case Jp:return U=F._init,T(D,R,U(F._payload),B)}if(TS(F)||Y1(F))return U!==null?null:S(D,R,F,B,null);pP(D,F)}return null}function C(D,R,F,B,U){if(typeof B=="string"&&B!==""||typeof B=="number")return D=D.get(F)||null,i(R,D,""+B,U);if(typeof B=="object"&&B!==null){switch(B.$$typeof){case nP:return D=D.get(B.key===null?F:B.key)||null,g(R,D,B,U);case kx:return D=D.get(B.key===null?F:B.key)||null,_(R,D,B,U);case Jp:var Z=B._init;return C(D,R,F,Z(B._payload),U)}if(TS(B)||Y1(B))return D=D.get(F)||null,S(R,D,B,U,null);pP(R,B)}return null}function N(D,R,F,B){for(var U=null,Z=null,J=R,te=R=0,ae=null;J!==null&&te<F.length;te++){J.index>te?(ae=J,J=null):ae=J.sibling;var ne=T(D,J,F[te],B);if(ne===null){J===null&&(J=ae);break}e&&J&&ne.alternate===null&&t(D,J),R=l(ne,R,te),Z===null?U=ne:Z.sibling=ne,Z=ne,J=ae}if(te===F.length)return r(D,J),ho&&_y(D,te),U;if(J===null){for(;te<F.length;te++)J=E(D,F[te],B),J!==null&&(R=l(J,R,te),Z===null?U=J:Z.sibling=J,Z=J);return ho&&_y(D,te),U}for(J=n(D,J);te<F.length;te++)ae=C(J,D,te,F[te],B),ae!==null&&(e&&ae.alternate!==null&&J.delete(ae.key===null?te:ae.key),R=l(ae,R,te),Z===null?U=ae:Z.sibling=ae,Z=ae);return e&&J.forEach(function(ie){return t(D,ie)}),ho&&_y(D,te),U}function I(D,R,F,B){var U=Y1(F);if(typeof U!="function")throw Error(kr(150));if(F=U.call(F),F==null)throw Error(kr(151));for(var Z=U=null,J=R,te=R=0,ae=null,ne=F.next();J!==null&&!ne.done;te++,ne=F.next()){J.index>te?(ae=J,J=null):ae=J.sibling;var ie=T(D,J,ne.value,B);if(ie===null){J===null&&(J=ae);break}e&&J&&ie.alternate===null&&t(D,J),R=l(ie,R,te),Z===null?U=ie:Z.sibling=ie,Z=ie,J=ae}if(ne.done)return r(D,J),ho&&_y(D,te),U;if(J===null){for(;!ne.done;te++,ne=F.next())ne=E(D,ne.value,B),ne!==null&&(R=l(ne,R,te),Z===null?U=ne:Z.sibling=ne,Z=ne);return ho&&_y(D,te),U}for(J=n(D,J);!ne.done;te++,ne=F.next())ne=C(J,D,te,ne.value,B),ne!==null&&(e&&ne.alternate!==null&&J.delete(ne.key===null?te:ne.key),R=l(ne,R,te),Z===null?U=ne:Z.sibling=ne,Z=ne);return e&&J.forEach(function(ee){return t(D,ee)}),ho&&_y(D,te),U}function j(D,R,F,B){if(typeof F=="object"&&F!==null&&F.type===Ix&&F.key===null&&(F=F.props.children),typeof F=="object"&&F!==null){switch(F.$$typeof){case nP:e:{for(var U=F.key,Z=R;Z!==null;){if(Z.key===U){if(U=F.type,U===Ix){if(Z.tag===7){r(D,Z.sibling),R=o(Z,F.props.children),R.return=D,D=R;break e}}else if(Z.elementType===U||typeof U=="object"&&U!==null&&U.$$typeof===Jp&&W8(U)===Z.type){r(D,Z.sibling),R=o(Z,F.props),R.ref=rS(D,Z,F),R.return=D,D=R;break e}r(D,Z);break}else t(D,Z);Z=Z.sibling}F.type===Ix?(R=Qy(F.props.children,D.mode,B,F.key),R.return=D,D=R):(B=uC(F.type,F.key,F.props,null,D.mode,B),B.ref=rS(D,R,F),B.return=D,D=B)}return d(D);case kx:e:{for(Z=F.key;R!==null;){if(R.key===Z)if(R.tag===4&&R.stateNode.containerInfo===F.containerInfo&&R.stateNode.implementation===F.implementation){r(D,R.sibling),R=o(R,F.children||[]),R.return=D,D=R;break e}else{r(D,R);break}else t(D,R);R=R.sibling}R=xM(F,D.mode,B),R.return=D,D=R}return d(D);case Jp:return Z=F._init,j(D,R,Z(F._payload),B)}if(TS(F))return N(D,R,F,B);if(Y1(F))return I(D,R,F,B);pP(D,F)}return typeof F=="string"&&F!==""||typeof F=="number"?(F=""+F,R!==null&&R.tag===6?(r(D,R.sibling),R=o(R,F),R.return=D,D=R):(r(D,R),R=_M(F,D.mode,B),R.return=D,D=R),d(D)):r(D,R)}return j}var E0=TX(!0),AX=TX(!1),qC=Qm(null),WC=null,zx=null,zz=null;function Bz(){zz=zx=WC=null}function $z(e){var t=qC.current;oo(qC),e._currentValue=t}function lL(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function Yx(e,t){WC=e,zz=zx=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(yc=!0),e.firstContext=null)}function ku(e){var t=e._currentValue;if(zz!==e)if(e={context:e,memoizedValue:t,next:null},zx===null){if(WC===null)throw Error(kr(308));zx=e,WC.dependencies={lanes:0,firstContext:e}}else zx=zx.next=e;return t}var Ny=null;function Uz(e){Ny===null?Ny=[e]:Ny.push(e)}function PX(e,t,r,n){var o=t.interleaved;return o===null?(r.next=r,Uz(t)):(r.next=o.next,o.next=r),t.interleaved=r,Nf(e,n)}function Nf(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var Qp=!1;function Vz(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function CX(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Tf(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Im(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,ha&2){var o=n.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),n.pending=t,Nf(e,r)}return o=n.interleaved,o===null?(t.next=t,Uz(n)):(t.next=o.next,o.next=t),n.interleaved=t,Nf(e,r)}function iC(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,Cz(e,r)}}function G8(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var o=null,l=null;if(r=r.firstBaseUpdate,r!==null){do{var d={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};l===null?o=l=d:l=l.next=d,r=r.next}while(r!==null);l===null?o=l=t:l=l.next=t}else o=l=t;r={baseState:n.baseState,firstBaseUpdate:o,lastBaseUpdate:l,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function GC(e,t,r,n){var o=e.updateQueue;Qp=!1;var l=o.firstBaseUpdate,d=o.lastBaseUpdate,i=o.shared.pending;if(i!==null){o.shared.pending=null;var g=i,_=g.next;g.next=null,d===null?l=_:d.next=_,d=g;var S=e.alternate;S!==null&&(S=S.updateQueue,i=S.lastBaseUpdate,i!==d&&(i===null?S.firstBaseUpdate=_:i.next=_,S.lastBaseUpdate=g))}if(l!==null){var E=o.baseState;d=0,S=_=g=null,i=l;do{var T=i.lane,C=i.eventTime;if((n&T)===T){S!==null&&(S=S.next={eventTime:C,lane:0,tag:i.tag,payload:i.payload,callback:i.callback,next:null});e:{var N=e,I=i;switch(T=t,C=r,I.tag){case 1:if(N=I.payload,typeof N=="function"){E=N.call(C,E,T);break e}E=N;break e;case 3:N.flags=N.flags&-65537|128;case 0:if(N=I.payload,T=typeof N=="function"?N.call(C,E,T):N,T==null)break e;E=bo({},E,T);break e;case 2:Qp=!0}}i.callback!==null&&i.lane!==0&&(e.flags|=64,T=o.effects,T===null?o.effects=[i]:T.push(i))}else C={eventTime:C,lane:T,tag:i.tag,payload:i.payload,callback:i.callback,next:null},S===null?(_=S=C,g=E):S=S.next=C,d|=T;if(i=i.next,i===null){if(i=o.shared.pending,i===null)break;T=i,i=T.next,T.next=null,o.lastBaseUpdate=T,o.shared.pending=null}}while(!0);if(S===null&&(g=E),o.baseState=g,o.firstBaseUpdate=_,o.lastBaseUpdate=S,t=o.shared.interleaved,t!==null){o=t;do d|=o.lane,o=o.next;while(o!==t)}else l===null&&(o.shared.lanes=0);ov|=d,e.lanes=d,e.memoizedState=E}}function H8(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],o=n.callback;if(o!==null){if(n.callback=null,n=r,typeof o!="function")throw Error(kr(191,o));o.call(n)}}}var OT={},xh=Qm(OT),yE=Qm(OT),vE=Qm(OT);function My(e){if(e===OT)throw Error(kr(174));return e}function qz(e,t){switch(Za(vE,t),Za(yE,e),Za(xh,OT),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:UD(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=UD(t,e)}oo(xh),Za(xh,t)}function T0(){oo(xh),oo(yE),oo(vE)}function OX(e){My(vE.current);var t=My(xh.current),r=UD(t,e.type);t!==r&&(Za(yE,e),Za(xh,r))}function Wz(e){yE.current===e&&(oo(xh),oo(yE))}var _o=Qm(0);function HC(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var fM=[];function Gz(){for(var e=0;e<fM.length;e++)fM[e]._workInProgressVersionPrimary=null;fM.length=0}var aC=Uf.ReactCurrentDispatcher,pM=Uf.ReactCurrentBatchConfig,av=0,xo=null,fs=null,Cs=null,KC=!1,VS=!1,_E=0,Rme=0;function nl(){throw Error(kr(321))}function Hz(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Td(e[r],t[r]))return!1;return!0}function Kz(e,t,r,n,o,l){if(av=l,xo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,aC.current=e===null||e.memoizedState===null?Dme:Lme,e=r(n,o),VS){l=0;do{if(VS=!1,_E=0,25<=l)throw Error(kr(301));l+=1,Cs=fs=null,t.updateQueue=null,aC.current=Fme,e=r(n,o)}while(VS)}if(aC.current=ZC,t=fs!==null&&fs.next!==null,av=0,Cs=fs=xo=null,KC=!1,t)throw Error(kr(300));return e}function Zz(){var e=_E!==0;return _E=0,e}function nh(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Cs===null?xo.memoizedState=Cs=e:Cs=Cs.next=e,Cs}function Iu(){if(fs===null){var e=xo.alternate;e=e!==null?e.memoizedState:null}else e=fs.next;var t=Cs===null?xo.memoizedState:Cs.next;if(t!==null)Cs=t,fs=e;else{if(e===null)throw Error(kr(310));fs=e,e={memoizedState:fs.memoizedState,baseState:fs.baseState,baseQueue:fs.baseQueue,queue:fs.queue,next:null},Cs===null?xo.memoizedState=Cs=e:Cs=Cs.next=e}return Cs}function xE(e,t){return typeof t=="function"?t(e):t}function mM(e){var t=Iu(),r=t.queue;if(r===null)throw Error(kr(311));r.lastRenderedReducer=e;var n=fs,o=n.baseQueue,l=r.pending;if(l!==null){if(o!==null){var d=o.next;o.next=l.next,l.next=d}n.baseQueue=o=l,r.pending=null}if(o!==null){l=o.next,n=n.baseState;var i=d=null,g=null,_=l;do{var S=_.lane;if((av&S)===S)g!==null&&(g=g.next={lane:0,action:_.action,hasEagerState:_.hasEagerState,eagerState:_.eagerState,next:null}),n=_.hasEagerState?_.eagerState:e(n,_.action);else{var E={lane:S,action:_.action,hasEagerState:_.hasEagerState,eagerState:_.eagerState,next:null};g===null?(i=g=E,d=n):g=g.next=E,xo.lanes|=S,ov|=S}_=_.next}while(_!==null&&_!==l);g===null?d=n:g.next=i,Td(n,t.memoizedState)||(yc=!0),t.memoizedState=n,t.baseState=d,t.baseQueue=g,r.lastRenderedState=n}if(e=r.interleaved,e!==null){o=e;do l=o.lane,xo.lanes|=l,ov|=l,o=o.next;while(o!==e)}else o===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function gM(e){var t=Iu(),r=t.queue;if(r===null)throw Error(kr(311));r.lastRenderedReducer=e;var n=r.dispatch,o=r.pending,l=t.memoizedState;if(o!==null){r.pending=null;var d=o=o.next;do l=e(l,d.action),d=d.next;while(d!==o);Td(l,t.memoizedState)||(yc=!0),t.memoizedState=l,t.baseQueue===null&&(t.baseState=l),r.lastRenderedState=l}return[l,n]}function kX(){}function IX(e,t){var r=xo,n=Iu(),o=t(),l=!Td(n.memoizedState,o);if(l&&(n.memoizedState=o,yc=!0),n=n.queue,Xz(NX.bind(null,r,n,e),[e]),n.getSnapshot!==t||l||Cs!==null&&Cs.memoizedState.tag&1){if(r.flags|=2048,bE(9,jX.bind(null,r,n,o,t),void 0,null),ks===null)throw Error(kr(349));av&30||RX(r,t,o)}return o}function RX(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=xo.updateQueue,t===null?(t={lastEffect:null,stores:null},xo.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function jX(e,t,r,n){t.value=r,t.getSnapshot=n,MX(t)&&DX(e)}function NX(e,t,r){return r(function(){MX(t)&&DX(e)})}function MX(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Td(e,r)}catch{return!0}}function DX(e){var t=Nf(e,1);t!==null&&bd(t,e,1,-1)}function K8(e){var t=nh();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xE,lastRenderedState:e},t.queue=e,e=e.dispatch=Mme.bind(null,xo,e),[t.memoizedState,e]}function bE(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=xo.updateQueue,t===null?(t={lastEffect:null,stores:null},xo.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function LX(){return Iu().memoizedState}function oC(e,t,r,n){var o=nh();xo.flags|=e,o.memoizedState=bE(1|t,r,void 0,n===void 0?null:n)}function Hk(e,t,r,n){var o=Iu();n=n===void 0?null:n;var l=void 0;if(fs!==null){var d=fs.memoizedState;if(l=d.destroy,n!==null&&Hz(n,d.deps)){o.memoizedState=bE(t,r,l,n);return}}xo.flags|=e,o.memoizedState=bE(1|t,r,l,n)}function Z8(e,t){return oC(8390656,8,e,t)}function Xz(e,t){return Hk(2048,8,e,t)}function FX(e,t){return Hk(4,2,e,t)}function zX(e,t){return Hk(4,4,e,t)}function BX(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function $X(e,t,r){return r=r!=null?r.concat([e]):null,Hk(4,4,BX.bind(null,t,e),r)}function Yz(){}function UX(e,t){var r=Iu();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&Hz(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function VX(e,t){var r=Iu();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&Hz(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function qX(e,t,r){return av&21?(Td(r,t)||(r=ZZ(),xo.lanes|=r,ov|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,yc=!0),e.memoizedState=r)}function jme(e,t){var r=Na;Na=r!==0&&4>r?r:4,e(!0);var n=pM.transition;pM.transition={};try{e(!1),t()}finally{Na=r,pM.transition=n}}function WX(){return Iu().memoizedState}function Nme(e,t,r){var n=jm(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},GX(e))HX(t,r);else if(r=PX(e,t,r,n),r!==null){var o=Hl();bd(r,e,n,o),KX(r,t,n)}}function Mme(e,t,r){var n=jm(e),o={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(GX(e))HX(t,o);else{var l=e.alternate;if(e.lanes===0&&(l===null||l.lanes===0)&&(l=t.lastRenderedReducer,l!==null))try{var d=t.lastRenderedState,i=l(d,r);if(o.hasEagerState=!0,o.eagerState=i,Td(i,d)){var g=t.interleaved;g===null?(o.next=o,Uz(t)):(o.next=g.next,g.next=o),t.interleaved=o;return}}catch{}finally{}r=PX(e,t,o,n),r!==null&&(o=Hl(),bd(r,e,n,o),KX(r,t,n))}}function GX(e){var t=e.alternate;return e===xo||t!==null&&t===xo}function HX(e,t){VS=KC=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function KX(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,Cz(e,r)}}var ZC={readContext:ku,useCallback:nl,useContext:nl,useEffect:nl,useImperativeHandle:nl,useInsertionEffect:nl,useLayoutEffect:nl,useMemo:nl,useReducer:nl,useRef:nl,useState:nl,useDebugValue:nl,useDeferredValue:nl,useTransition:nl,useMutableSource:nl,useSyncExternalStore:nl,useId:nl,unstable_isNewReconciler:!1},Dme={readContext:ku,useCallback:function(e,t){return nh().memoizedState=[e,t===void 0?null:t],e},useContext:ku,useEffect:Z8,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,oC(4194308,4,BX.bind(null,t,e),r)},useLayoutEffect:function(e,t){return oC(4194308,4,e,t)},useInsertionEffect:function(e,t){return oC(4,2,e,t)},useMemo:function(e,t){var r=nh();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=nh();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=Nme.bind(null,xo,e),[n.memoizedState,e]},useRef:function(e){var t=nh();return e={current:e},t.memoizedState=e},useState:K8,useDebugValue:Yz,useDeferredValue:function(e){return nh().memoizedState=e},useTransition:function(){var e=K8(!1),t=e[0];return e=jme.bind(null,e[1]),nh().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=xo,o=nh();if(ho){if(r===void 0)throw Error(kr(407));r=r()}else{if(r=t(),ks===null)throw Error(kr(349));av&30||RX(n,t,r)}o.memoizedState=r;var l={value:r,getSnapshot:t};return o.queue=l,Z8(NX.bind(null,n,l,e),[e]),n.flags|=2048,bE(9,jX.bind(null,n,l,r,t),void 0,null),r},useId:function(){var e=nh(),t=ks.identifierPrefix;if(ho){var r=xf,n=_f;r=(n&~(1<<32-xd(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=_E++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=Rme++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Lme={readContext:ku,useCallback:UX,useContext:ku,useEffect:Xz,useImperativeHandle:$X,useInsertionEffect:FX,useLayoutEffect:zX,useMemo:VX,useReducer:mM,useRef:LX,useState:function(){return mM(xE)},useDebugValue:Yz,useDeferredValue:function(e){var t=Iu();return qX(t,fs.memoizedState,e)},useTransition:function(){var e=mM(xE)[0],t=Iu().memoizedState;return[e,t]},useMutableSource:kX,useSyncExternalStore:IX,useId:WX,unstable_isNewReconciler:!1},Fme={readContext:ku,useCallback:UX,useContext:ku,useEffect:Xz,useImperativeHandle:$X,useInsertionEffect:FX,useLayoutEffect:zX,useMemo:VX,useReducer:gM,useRef:LX,useState:function(){return gM(xE)},useDebugValue:Yz,useDeferredValue:function(e){var t=Iu();return fs===null?t.memoizedState=e:qX(t,fs.memoizedState,e)},useTransition:function(){var e=gM(xE)[0],t=Iu().memoizedState;return[e,t]},useMutableSource:kX,useSyncExternalStore:IX,useId:WX,unstable_isNewReconciler:!1};function ld(e,t){if(e&&e.defaultProps){t=bo({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function cL(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:bo({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var Kk={isMounted:function(e){return(e=e._reactInternals)?Tv(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=Hl(),o=jm(e),l=Tf(n,o);l.payload=t,r!=null&&(l.callback=r),t=Im(e,l,o),t!==null&&(bd(t,e,o,n),iC(t,e,o))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=Hl(),o=jm(e),l=Tf(n,o);l.tag=1,l.payload=t,r!=null&&(l.callback=r),t=Im(e,l,o),t!==null&&(bd(t,e,o,n),iC(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Hl(),n=jm(e),o=Tf(r,n);o.tag=2,t!=null&&(o.callback=t),t=Im(e,o,n),t!==null&&(bd(t,e,n,r),iC(t,e,n))}};function X8(e,t,r,n,o,l,d){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,l,d):t.prototype&&t.prototype.isPureReactComponent?!fE(r,n)||!fE(o,l):!0}function ZX(e,t,r){var n=!1,o=Um,l=t.contextType;return typeof l=="object"&&l!==null?l=ku(l):(o=bc(t)?nv:ml.current,n=t.contextTypes,l=(n=n!=null)?w0(e,o):Um),t=new t(r,l),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Kk,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=l),t}function Y8(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&Kk.enqueueReplaceState(t,t.state,null)}function uL(e,t,r,n){var o=e.stateNode;o.props=r,o.state=e.memoizedState,o.refs={},Vz(e);var l=t.contextType;typeof l=="object"&&l!==null?o.context=ku(l):(l=bc(t)?nv:ml.current,o.context=w0(e,l)),o.state=e.memoizedState,l=t.getDerivedStateFromProps,typeof l=="function"&&(cL(e,t,l,r),o.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(t=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),t!==o.state&&Kk.enqueueReplaceState(o,o.state,null),GC(e,r,o,n),o.state=e.memoizedState),typeof o.componentDidMount=="function"&&(e.flags|=4194308)}function A0(e,t){try{var r="",n=t;do r+=hpe(n),n=n.return;while(n);var o=r}catch(l){o=`
Error generating stack: `+l.message+`
`+l.stack}return{value:e,source:t,stack:o,digest:null}}function yM(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function dL(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var zme=typeof WeakMap=="function"?WeakMap:Map;function XX(e,t,r){r=Tf(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){YC||(YC=!0,bL=n),dL(e,t)},r}function YX(e,t,r){r=Tf(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var o=t.value;r.payload=function(){return n(o)},r.callback=function(){dL(e,t)}}var l=e.stateNode;return l!==null&&typeof l.componentDidCatch=="function"&&(r.callback=function(){dL(e,t),typeof n!="function"&&(Rm===null?Rm=new Set([this]):Rm.add(this));var d=t.stack;this.componentDidCatch(t.value,{componentStack:d!==null?d:""})}),r}function J8(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new zme;var o=new Set;n.set(t,o)}else o=n.get(t),o===void 0&&(o=new Set,n.set(t,o));o.has(r)||(o.add(r),e=Qme.bind(null,e,t,r),t.then(e,e))}function Q8(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function eq(e,t,r,n,o){return e.mode&1?(e.flags|=65536,e.lanes=o,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Tf(-1,1),t.tag=2,Im(r,t,1))),r.lanes|=1),e)}var Bme=Uf.ReactCurrentOwner,yc=!1;function Dl(e,t,r,n){t.child=e===null?AX(t,null,r,n):E0(t,e.child,r,n)}function tq(e,t,r,n,o){r=r.render;var l=t.ref;return Yx(t,o),n=Kz(e,t,r,n,l,o),r=Zz(),e!==null&&!yc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Mf(e,t,o)):(ho&&r&&Dz(t),t.flags|=1,Dl(e,t,n,o),t.child)}function rq(e,t,r,n,o){if(e===null){var l=r.type;return typeof l=="function"&&!aB(l)&&l.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=l,JX(e,t,l,n,o)):(e=uC(r.type,null,n,t,t.mode,o),e.ref=t.ref,e.return=t,t.child=e)}if(l=e.child,!(e.lanes&o)){var d=l.memoizedProps;if(r=r.compare,r=r!==null?r:fE,r(d,n)&&e.ref===t.ref)return Mf(e,t,o)}return t.flags|=1,e=Nm(l,n),e.ref=t.ref,e.return=t,t.child=e}function JX(e,t,r,n,o){if(e!==null){var l=e.memoizedProps;if(fE(l,n)&&e.ref===t.ref)if(yc=!1,t.pendingProps=n=l,(e.lanes&o)!==0)e.flags&131072&&(yc=!0);else return t.lanes=e.lanes,Mf(e,t,o)}return hL(e,t,r,n,o)}function QX(e,t,r){var n=t.pendingProps,o=n.children,l=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Za($x,Lc),Lc|=r;else{if(!(r&1073741824))return e=l!==null?l.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Za($x,Lc),Lc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=l!==null?l.baseLanes:r,Za($x,Lc),Lc|=n}else l!==null?(n=l.baseLanes|r,t.memoizedState=null):n=r,Za($x,Lc),Lc|=n;return Dl(e,t,o,r),t.child}function eY(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function hL(e,t,r,n,o){var l=bc(r)?nv:ml.current;return l=w0(t,l),Yx(t,o),r=Kz(e,t,r,n,l,o),n=Zz(),e!==null&&!yc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Mf(e,t,o)):(ho&&n&&Dz(t),t.flags|=1,Dl(e,t,r,o),t.child)}function nq(e,t,r,n,o){if(bc(r)){var l=!0;$C(t)}else l=!1;if(Yx(t,o),t.stateNode===null)sC(e,t),ZX(t,r,n),uL(t,r,n,o),n=!0;else if(e===null){var d=t.stateNode,i=t.memoizedProps;d.props=i;var g=d.context,_=r.contextType;typeof _=="object"&&_!==null?_=ku(_):(_=bc(r)?nv:ml.current,_=w0(t,_));var S=r.getDerivedStateFromProps,E=typeof S=="function"||typeof d.getSnapshotBeforeUpdate=="function";E||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(i!==n||g!==_)&&Y8(t,d,n,_),Qp=!1;var T=t.memoizedState;d.state=T,GC(t,n,d,o),g=t.memoizedState,i!==n||T!==g||xc.current||Qp?(typeof S=="function"&&(cL(t,r,S,n),g=t.memoizedState),(i=Qp||X8(t,r,i,n,T,g,_))?(E||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(t.flags|=4194308)):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=g),d.props=n,d.state=g,d.context=_,n=i):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{d=t.stateNode,CX(e,t),i=t.memoizedProps,_=t.type===t.elementType?i:ld(t.type,i),d.props=_,E=t.pendingProps,T=d.context,g=r.contextType,typeof g=="object"&&g!==null?g=ku(g):(g=bc(r)?nv:ml.current,g=w0(t,g));var C=r.getDerivedStateFromProps;(S=typeof C=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(i!==E||T!==g)&&Y8(t,d,n,g),Qp=!1,T=t.memoizedState,d.state=T,GC(t,n,d,o);var N=t.memoizedState;i!==E||T!==N||xc.current||Qp?(typeof C=="function"&&(cL(t,r,C,n),N=t.memoizedState),(_=Qp||X8(t,r,_,n,T,N,g)||!1)?(S||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(n,N,g),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(n,N,g)),typeof d.componentDidUpdate=="function"&&(t.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof d.componentDidUpdate!="function"||i===e.memoizedProps&&T===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&T===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=N),d.props=n,d.state=N,d.context=g,n=_):(typeof d.componentDidUpdate!="function"||i===e.memoizedProps&&T===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&T===e.memoizedState||(t.flags|=1024),n=!1)}return fL(e,t,r,n,l,o)}function fL(e,t,r,n,o,l){eY(e,t);var d=(t.flags&128)!==0;if(!n&&!d)return o&&U8(t,r,!1),Mf(e,t,l);n=t.stateNode,Bme.current=t;var i=d&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&d?(t.child=E0(t,e.child,null,l),t.child=E0(t,null,i,l)):Dl(e,t,i,l),t.memoizedState=n.state,o&&U8(t,r,!0),t.child}function tY(e){var t=e.stateNode;t.pendingContext?$8(e,t.pendingContext,t.pendingContext!==t.context):t.context&&$8(e,t.context,!1),qz(e,t.containerInfo)}function iq(e,t,r,n,o){return S0(),Fz(o),t.flags|=256,Dl(e,t,r,n),t.child}var pL={dehydrated:null,treeContext:null,retryLane:0};function mL(e){return{baseLanes:e,cachePool:null,transitions:null}}function rY(e,t,r){var n=t.pendingProps,o=_o.current,l=!1,d=(t.flags&128)!==0,i;if((i=d)||(i=e!==null&&e.memoizedState===null?!1:(o&2)!==0),i?(l=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(o|=1),Za(_o,o&1),e===null)return sL(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(d=n.children,e=n.fallback,l?(n=t.mode,l=t.child,d={mode:"hidden",children:d},!(n&1)&&l!==null?(l.childLanes=0,l.pendingProps=d):l=Yk(d,n,0,null),e=Qy(e,n,r,null),l.return=t,e.return=t,l.sibling=e,t.child=l,t.child.memoizedState=mL(r),t.memoizedState=pL,e):Jz(t,d));if(o=e.memoizedState,o!==null&&(i=o.dehydrated,i!==null))return $me(e,t,d,n,i,o,r);if(l){l=n.fallback,d=t.mode,o=e.child,i=o.sibling;var g={mode:"hidden",children:n.children};return!(d&1)&&t.child!==o?(n=t.child,n.childLanes=0,n.pendingProps=g,t.deletions=null):(n=Nm(o,g),n.subtreeFlags=o.subtreeFlags&14680064),i!==null?l=Nm(i,l):(l=Qy(l,d,r,null),l.flags|=2),l.return=t,n.return=t,n.sibling=l,t.child=n,n=l,l=t.child,d=e.child.memoizedState,d=d===null?mL(r):{baseLanes:d.baseLanes|r,cachePool:null,transitions:d.transitions},l.memoizedState=d,l.childLanes=e.childLanes&~r,t.memoizedState=pL,n}return l=e.child,e=l.sibling,n=Nm(l,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function Jz(e,t){return t=Yk({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function mP(e,t,r,n){return n!==null&&Fz(n),E0(t,e.child,null,r),e=Jz(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function $me(e,t,r,n,o,l,d){if(r)return t.flags&256?(t.flags&=-257,n=yM(Error(kr(422))),mP(e,t,d,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(l=n.fallback,o=t.mode,n=Yk({mode:"visible",children:n.children},o,0,null),l=Qy(l,o,d,null),l.flags|=2,n.return=t,l.return=t,n.sibling=l,t.child=n,t.mode&1&&E0(t,e.child,null,d),t.child.memoizedState=mL(d),t.memoizedState=pL,l);if(!(t.mode&1))return mP(e,t,d,null);if(o.data==="$!"){if(n=o.nextSibling&&o.nextSibling.dataset,n)var i=n.dgst;return n=i,l=Error(kr(419)),n=yM(l,n,void 0),mP(e,t,d,n)}if(i=(d&e.childLanes)!==0,yc||i){if(n=ks,n!==null){switch(d&-d){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(n.suspendedLanes|d)?0:o,o!==0&&o!==l.retryLane&&(l.retryLane=o,Nf(e,o),bd(n,e,o,-1))}return iB(),n=yM(Error(kr(421))),mP(e,t,d,n)}return o.data==="$?"?(t.flags|=128,t.child=e.child,t=ege.bind(null,e),o._reactRetry=t,null):(e=l.treeContext,Gc=km(o.nextSibling),Hc=t,ho=!0,gd=null,e!==null&&(yu[vu++]=_f,yu[vu++]=xf,yu[vu++]=iv,_f=e.id,xf=e.overflow,iv=t),t=Jz(t,n.children),t.flags|=4096,t)}function aq(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),lL(e.return,t,r)}function vM(e,t,r,n,o){var l=e.memoizedState;l===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:o}:(l.isBackwards=t,l.rendering=null,l.renderingStartTime=0,l.last=n,l.tail=r,l.tailMode=o)}function nY(e,t,r){var n=t.pendingProps,o=n.revealOrder,l=n.tail;if(Dl(e,t,n.children,r),n=_o.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&aq(e,r,t);else if(e.tag===19)aq(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Za(_o,n),!(t.mode&1))t.memoizedState=null;else switch(o){case"forwards":for(r=t.child,o=null;r!==null;)e=r.alternate,e!==null&&HC(e)===null&&(o=r),r=r.sibling;r=o,r===null?(o=t.child,t.child=null):(o=r.sibling,r.sibling=null),vM(t,!1,o,r,l);break;case"backwards":for(r=null,o=t.child,t.child=null;o!==null;){if(e=o.alternate,e!==null&&HC(e)===null){t.child=o;break}e=o.sibling,o.sibling=r,r=o,o=e}vM(t,!0,r,null,l);break;case"together":vM(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function sC(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Mf(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),ov|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(kr(153));if(t.child!==null){for(e=t.child,r=Nm(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Nm(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function Ume(e,t,r){switch(t.tag){case 3:tY(t),S0();break;case 5:OX(t);break;case 1:bc(t.type)&&$C(t);break;case 4:qz(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,o=t.memoizedProps.value;Za(qC,n._currentValue),n._currentValue=o;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(Za(_o,_o.current&1),t.flags|=128,null):r&t.child.childLanes?rY(e,t,r):(Za(_o,_o.current&1),e=Mf(e,t,r),e!==null?e.sibling:null);Za(_o,_o.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return nY(e,t,r);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),Za(_o,_o.current),n)break;return null;case 22:case 23:return t.lanes=0,QX(e,t,r)}return Mf(e,t,r)}var iY,gL,aY,oY;iY=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};gL=function(){};aY=function(e,t,r,n){var o=e.memoizedProps;if(o!==n){e=t.stateNode,My(xh.current);var l=null;switch(r){case"input":o=FD(e,o),n=FD(e,n),l=[];break;case"select":o=bo({},o,{value:void 0}),n=bo({},n,{value:void 0}),l=[];break;case"textarea":o=$D(e,o),n=$D(e,n),l=[];break;default:typeof o.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=zC)}VD(r,n);var d;r=null;for(_ in o)if(!n.hasOwnProperty(_)&&o.hasOwnProperty(_)&&o[_]!=null)if(_==="style"){var i=o[_];for(d in i)i.hasOwnProperty(d)&&(r||(r={}),r[d]="")}else _!=="dangerouslySetInnerHTML"&&_!=="children"&&_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&_!=="autoFocus"&&(oE.hasOwnProperty(_)?l||(l=[]):(l=l||[]).push(_,null));for(_ in n){var g=n[_];if(i=o!=null?o[_]:void 0,n.hasOwnProperty(_)&&g!==i&&(g!=null||i!=null))if(_==="style")if(i){for(d in i)!i.hasOwnProperty(d)||g&&g.hasOwnProperty(d)||(r||(r={}),r[d]="");for(d in g)g.hasOwnProperty(d)&&i[d]!==g[d]&&(r||(r={}),r[d]=g[d])}else r||(l||(l=[]),l.push(_,r)),r=g;else _==="dangerouslySetInnerHTML"?(g=g?g.__html:void 0,i=i?i.__html:void 0,g!=null&&i!==g&&(l=l||[]).push(_,g)):_==="children"?typeof g!="string"&&typeof g!="number"||(l=l||[]).push(_,""+g):_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&(oE.hasOwnProperty(_)?(g!=null&&_==="onScroll"&&no("scroll",e),l||i===g||(l=[])):(l=l||[]).push(_,g))}r&&(l=l||[]).push("style",r);var _=l;(t.updateQueue=_)&&(t.flags|=4)}};oY=function(e,t,r,n){r!==n&&(t.flags|=4)};function nS(e,t){if(!ho)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function il(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var o=e.child;o!==null;)r|=o.lanes|o.childLanes,n|=o.subtreeFlags&14680064,n|=o.flags&14680064,o.return=e,o=o.sibling;else for(o=e.child;o!==null;)r|=o.lanes|o.childLanes,n|=o.subtreeFlags,n|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function Vme(e,t,r){var n=t.pendingProps;switch(Lz(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return il(t),null;case 1:return bc(t.type)&&BC(),il(t),null;case 3:return n=t.stateNode,T0(),oo(xc),oo(ml),Gz(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(fP(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,gd!==null&&(EL(gd),gd=null))),gL(e,t),il(t),null;case 5:Wz(t);var o=My(vE.current);if(r=t.type,e!==null&&t.stateNode!=null)aY(e,t,r,n,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(kr(166));return il(t),null}if(e=My(xh.current),fP(t)){n=t.stateNode,r=t.type;var l=t.memoizedProps;switch(n[lh]=t,n[gE]=l,e=(t.mode&1)!==0,r){case"dialog":no("cancel",n),no("close",n);break;case"iframe":case"object":case"embed":no("load",n);break;case"video":case"audio":for(o=0;o<PS.length;o++)no(PS[o],n);break;case"source":no("error",n);break;case"img":case"image":case"link":no("error",n),no("load",n);break;case"details":no("toggle",n);break;case"input":p8(n,l),no("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!l.multiple},no("invalid",n);break;case"textarea":g8(n,l),no("invalid",n)}VD(r,l),o=null;for(var d in l)if(l.hasOwnProperty(d)){var i=l[d];d==="children"?typeof i=="string"?n.textContent!==i&&(l.suppressHydrationWarning!==!0&&hP(n.textContent,i,e),o=["children",i]):typeof i=="number"&&n.textContent!==""+i&&(l.suppressHydrationWarning!==!0&&hP(n.textContent,i,e),o=["children",""+i]):oE.hasOwnProperty(d)&&i!=null&&d==="onScroll"&&no("scroll",n)}switch(r){case"input":iP(n),m8(n,l,!0);break;case"textarea":iP(n),y8(n);break;case"select":case"option":break;default:typeof l.onClick=="function"&&(n.onclick=zC)}n=o,t.updateQueue=n,n!==null&&(t.flags|=4)}else{d=o.nodeType===9?o:o.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=NZ(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=d.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=d.createElement(r,{is:n.is}):(e=d.createElement(r),r==="select"&&(d=e,n.multiple?d.multiple=!0:n.size&&(d.size=n.size))):e=d.createElementNS(e,r),e[lh]=t,e[gE]=n,iY(e,t,!1,!1),t.stateNode=e;e:{switch(d=qD(r,n),r){case"dialog":no("cancel",e),no("close",e),o=n;break;case"iframe":case"object":case"embed":no("load",e),o=n;break;case"video":case"audio":for(o=0;o<PS.length;o++)no(PS[o],e);o=n;break;case"source":no("error",e),o=n;break;case"img":case"image":case"link":no("error",e),no("load",e),o=n;break;case"details":no("toggle",e),o=n;break;case"input":p8(e,n),o=FD(e,n),no("invalid",e);break;case"option":o=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},o=bo({},n,{value:void 0}),no("invalid",e);break;case"textarea":g8(e,n),o=$D(e,n),no("invalid",e);break;default:o=n}VD(r,o),i=o;for(l in i)if(i.hasOwnProperty(l)){var g=i[l];l==="style"?LZ(e,g):l==="dangerouslySetInnerHTML"?(g=g?g.__html:void 0,g!=null&&MZ(e,g)):l==="children"?typeof g=="string"?(r!=="textarea"||g!=="")&&sE(e,g):typeof g=="number"&&sE(e,""+g):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(oE.hasOwnProperty(l)?g!=null&&l==="onScroll"&&no("scroll",e):g!=null&&wz(e,l,g,d))}switch(r){case"input":iP(e),m8(e,n,!1);break;case"textarea":iP(e),y8(e);break;case"option":n.value!=null&&e.setAttribute("value",""+$m(n.value));break;case"select":e.multiple=!!n.multiple,l=n.value,l!=null?Hx(e,!!n.multiple,l,!1):n.defaultValue!=null&&Hx(e,!!n.multiple,n.defaultValue,!0);break;default:typeof o.onClick=="function"&&(e.onclick=zC)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return il(t),null;case 6:if(e&&t.stateNode!=null)oY(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(kr(166));if(r=My(vE.current),My(xh.current),fP(t)){if(n=t.stateNode,r=t.memoizedProps,n[lh]=t,(l=n.nodeValue!==r)&&(e=Hc,e!==null))switch(e.tag){case 3:hP(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&hP(n.nodeValue,r,(e.mode&1)!==0)}l&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[lh]=t,t.stateNode=n}return il(t),null;case 13:if(oo(_o),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(ho&&Gc!==null&&t.mode&1&&!(t.flags&128))EX(),S0(),t.flags|=98560,l=!1;else if(l=fP(t),n!==null&&n.dehydrated!==null){if(e===null){if(!l)throw Error(kr(318));if(l=t.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(kr(317));l[lh]=t}else S0(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;il(t),l=!1}else gd!==null&&(EL(gd),gd=null),l=!0;if(!l)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||_o.current&1?gs===0&&(gs=3):iB())),t.updateQueue!==null&&(t.flags|=4),il(t),null);case 4:return T0(),gL(e,t),e===null&&pE(t.stateNode.containerInfo),il(t),null;case 10:return $z(t.type._context),il(t),null;case 17:return bc(t.type)&&BC(),il(t),null;case 19:if(oo(_o),l=t.memoizedState,l===null)return il(t),null;if(n=(t.flags&128)!==0,d=l.rendering,d===null)if(n)nS(l,!1);else{if(gs!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(d=HC(e),d!==null){for(t.flags|=128,nS(l,!1),n=d.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)l=r,e=n,l.flags&=14680066,d=l.alternate,d===null?(l.childLanes=0,l.lanes=e,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=d.childLanes,l.lanes=d.lanes,l.child=d.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=d.memoizedProps,l.memoizedState=d.memoizedState,l.updateQueue=d.updateQueue,l.type=d.type,e=d.dependencies,l.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Za(_o,_o.current&1|2),t.child}e=e.sibling}l.tail!==null&&Do()>P0&&(t.flags|=128,n=!0,nS(l,!1),t.lanes=4194304)}else{if(!n)if(e=HC(d),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),nS(l,!0),l.tail===null&&l.tailMode==="hidden"&&!d.alternate&&!ho)return il(t),null}else 2*Do()-l.renderingStartTime>P0&&r!==1073741824&&(t.flags|=128,n=!0,nS(l,!1),t.lanes=4194304);l.isBackwards?(d.sibling=t.child,t.child=d):(r=l.last,r!==null?r.sibling=d:t.child=d,l.last=d)}return l.tail!==null?(t=l.tail,l.rendering=t,l.tail=t.sibling,l.renderingStartTime=Do(),t.sibling=null,r=_o.current,Za(_o,n?r&1|2:r&1),t):(il(t),null);case 22:case 23:return nB(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?Lc&1073741824&&(il(t),t.subtreeFlags&6&&(t.flags|=8192)):il(t),null;case 24:return null;case 25:return null}throw Error(kr(156,t.tag))}function qme(e,t){switch(Lz(t),t.tag){case 1:return bc(t.type)&&BC(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return T0(),oo(xc),oo(ml),Gz(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Wz(t),null;case 13:if(oo(_o),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(kr(340));S0()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return oo(_o),null;case 4:return T0(),null;case 10:return $z(t.type._context),null;case 22:case 23:return nB(),null;case 24:return null;default:return null}}var gP=!1,fl=!1,Wme=typeof WeakSet=="function"?WeakSet:Set,_n=null;function Bx(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){Oo(e,t,n)}else r.current=null}function yL(e,t,r){try{r()}catch(n){Oo(e,t,n)}}var oq=!1;function Gme(e,t){if(eL=DC,e=dX(),Mz(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var o=n.anchorOffset,l=n.focusNode;n=n.focusOffset;try{r.nodeType,l.nodeType}catch{r=null;break e}var d=0,i=-1,g=-1,_=0,S=0,E=e,T=null;t:for(;;){for(var C;E!==r||o!==0&&E.nodeType!==3||(i=d+o),E!==l||n!==0&&E.nodeType!==3||(g=d+n),E.nodeType===3&&(d+=E.nodeValue.length),(C=E.firstChild)!==null;)T=E,E=C;for(;;){if(E===e)break t;if(T===r&&++_===o&&(i=d),T===l&&++S===n&&(g=d),(C=E.nextSibling)!==null)break;E=T,T=E.parentNode}E=C}r=i===-1||g===-1?null:{start:i,end:g}}else r=null}r=r||{start:0,end:0}}else r=null;for(tL={focusedElem:e,selectionRange:r},DC=!1,_n=t;_n!==null;)if(t=_n,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,_n=e;else for(;_n!==null;){t=_n;try{var N=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(N!==null){var I=N.memoizedProps,j=N.memoizedState,D=t.stateNode,R=D.getSnapshotBeforeUpdate(t.elementType===t.type?I:ld(t.type,I),j);D.__reactInternalSnapshotBeforeUpdate=R}break;case 3:var F=t.stateNode.containerInfo;F.nodeType===1?F.textContent="":F.nodeType===9&&F.documentElement&&F.removeChild(F.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(kr(163))}}catch(B){Oo(t,t.return,B)}if(e=t.sibling,e!==null){e.return=t.return,_n=e;break}_n=t.return}return N=oq,oq=!1,N}function qS(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var o=n=n.next;do{if((o.tag&e)===e){var l=o.destroy;o.destroy=void 0,l!==void 0&&yL(t,r,l)}o=o.next}while(o!==n)}}function Zk(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function vL(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function sY(e){var t=e.alternate;t!==null&&(e.alternate=null,sY(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[lh],delete t[gE],delete t[iL],delete t[Cme],delete t[Ome])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function lY(e){return e.tag===5||e.tag===3||e.tag===4}function sq(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||lY(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function _L(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=zC));else if(n!==4&&(e=e.child,e!==null))for(_L(e,t,r),e=e.sibling;e!==null;)_L(e,t,r),e=e.sibling}function xL(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(xL(e,t,r),e=e.sibling;e!==null;)xL(e,t,r),e=e.sibling}var Us=null,hd=!1;function $p(e,t,r){for(r=r.child;r!==null;)cY(e,t,r),r=r.sibling}function cY(e,t,r){if(_h&&typeof _h.onCommitFiberUnmount=="function")try{_h.onCommitFiberUnmount($k,r)}catch{}switch(r.tag){case 5:fl||Bx(r,t);case 6:var n=Us,o=hd;Us=null,$p(e,t,r),Us=n,hd=o,Us!==null&&(hd?(e=Us,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Us.removeChild(r.stateNode));break;case 18:Us!==null&&(hd?(e=Us,r=r.stateNode,e.nodeType===8?dM(e.parentNode,r):e.nodeType===1&&dM(e,r),dE(e)):dM(Us,r.stateNode));break;case 4:n=Us,o=hd,Us=r.stateNode.containerInfo,hd=!0,$p(e,t,r),Us=n,hd=o;break;case 0:case 11:case 14:case 15:if(!fl&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){o=n=n.next;do{var l=o,d=l.destroy;l=l.tag,d!==void 0&&(l&2||l&4)&&yL(r,t,d),o=o.next}while(o!==n)}$p(e,t,r);break;case 1:if(!fl&&(Bx(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(i){Oo(r,t,i)}$p(e,t,r);break;case 21:$p(e,t,r);break;case 22:r.mode&1?(fl=(n=fl)||r.memoizedState!==null,$p(e,t,r),fl=n):$p(e,t,r);break;default:$p(e,t,r)}}function lq(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new Wme),t.forEach(function(n){var o=tge.bind(null,e,n);r.has(n)||(r.add(n),n.then(o,o))})}}function nd(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var o=r[n];try{var l=e,d=t,i=d;e:for(;i!==null;){switch(i.tag){case 5:Us=i.stateNode,hd=!1;break e;case 3:Us=i.stateNode.containerInfo,hd=!0;break e;case 4:Us=i.stateNode.containerInfo,hd=!0;break e}i=i.return}if(Us===null)throw Error(kr(160));cY(l,d,o),Us=null,hd=!1;var g=o.alternate;g!==null&&(g.return=null),o.return=null}catch(_){Oo(o,t,_)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)uY(t,e),t=t.sibling}function uY(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(nd(t,e),th(e),n&4){try{qS(3,e,e.return),Zk(3,e)}catch(I){Oo(e,e.return,I)}try{qS(5,e,e.return)}catch(I){Oo(e,e.return,I)}}break;case 1:nd(t,e),th(e),n&512&&r!==null&&Bx(r,r.return);break;case 5:if(nd(t,e),th(e),n&512&&r!==null&&Bx(r,r.return),e.flags&32){var o=e.stateNode;try{sE(o,"")}catch(I){Oo(e,e.return,I)}}if(n&4&&(o=e.stateNode,o!=null)){var l=e.memoizedProps,d=r!==null?r.memoizedProps:l,i=e.type,g=e.updateQueue;if(e.updateQueue=null,g!==null)try{i==="input"&&l.type==="radio"&&l.name!=null&&RZ(o,l),qD(i,d);var _=qD(i,l);for(d=0;d<g.length;d+=2){var S=g[d],E=g[d+1];S==="style"?LZ(o,E):S==="dangerouslySetInnerHTML"?MZ(o,E):S==="children"?sE(o,E):wz(o,S,E,_)}switch(i){case"input":zD(o,l);break;case"textarea":jZ(o,l);break;case"select":var T=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!l.multiple;var C=l.value;C!=null?Hx(o,!!l.multiple,C,!1):T!==!!l.multiple&&(l.defaultValue!=null?Hx(o,!!l.multiple,l.defaultValue,!0):Hx(o,!!l.multiple,l.multiple?[]:"",!1))}o[gE]=l}catch(I){Oo(e,e.return,I)}}break;case 6:if(nd(t,e),th(e),n&4){if(e.stateNode===null)throw Error(kr(162));o=e.stateNode,l=e.memoizedProps;try{o.nodeValue=l}catch(I){Oo(e,e.return,I)}}break;case 3:if(nd(t,e),th(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{dE(t.containerInfo)}catch(I){Oo(e,e.return,I)}break;case 4:nd(t,e),th(e);break;case 13:nd(t,e),th(e),o=e.child,o.flags&8192&&(l=o.memoizedState!==null,o.stateNode.isHidden=l,!l||o.alternate!==null&&o.alternate.memoizedState!==null||(tB=Do())),n&4&&lq(e);break;case 22:if(S=r!==null&&r.memoizedState!==null,e.mode&1?(fl=(_=fl)||S,nd(t,e),fl=_):nd(t,e),th(e),n&8192){if(_=e.memoizedState!==null,(e.stateNode.isHidden=_)&&!S&&e.mode&1)for(_n=e,S=e.child;S!==null;){for(E=_n=S;_n!==null;){switch(T=_n,C=T.child,T.tag){case 0:case 11:case 14:case 15:qS(4,T,T.return);break;case 1:Bx(T,T.return);var N=T.stateNode;if(typeof N.componentWillUnmount=="function"){n=T,r=T.return;try{t=n,N.props=t.memoizedProps,N.state=t.memoizedState,N.componentWillUnmount()}catch(I){Oo(n,r,I)}}break;case 5:Bx(T,T.return);break;case 22:if(T.memoizedState!==null){uq(E);continue}}C!==null?(C.return=T,_n=C):uq(E)}S=S.sibling}e:for(S=null,E=e;;){if(E.tag===5){if(S===null){S=E;try{o=E.stateNode,_?(l=o.style,typeof l.setProperty=="function"?l.setProperty("display","none","important"):l.display="none"):(i=E.stateNode,g=E.memoizedProps.style,d=g!=null&&g.hasOwnProperty("display")?g.display:null,i.style.display=DZ("display",d))}catch(I){Oo(e,e.return,I)}}}else if(E.tag===6){if(S===null)try{E.stateNode.nodeValue=_?"":E.memoizedProps}catch(I){Oo(e,e.return,I)}}else if((E.tag!==22&&E.tag!==23||E.memoizedState===null||E===e)&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===e)break e;for(;E.sibling===null;){if(E.return===null||E.return===e)break e;S===E&&(S=null),E=E.return}S===E&&(S=null),E.sibling.return=E.return,E=E.sibling}}break;case 19:nd(t,e),th(e),n&4&&lq(e);break;case 21:break;default:nd(t,e),th(e)}}function th(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(lY(r)){var n=r;break e}r=r.return}throw Error(kr(160))}switch(n.tag){case 5:var o=n.stateNode;n.flags&32&&(sE(o,""),n.flags&=-33);var l=sq(e);xL(e,l,o);break;case 3:case 4:var d=n.stateNode.containerInfo,i=sq(e);_L(e,i,d);break;default:throw Error(kr(161))}}catch(g){Oo(e,e.return,g)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Hme(e,t,r){_n=e,dY(e)}function dY(e,t,r){for(var n=(e.mode&1)!==0;_n!==null;){var o=_n,l=o.child;if(o.tag===22&&n){var d=o.memoizedState!==null||gP;if(!d){var i=o.alternate,g=i!==null&&i.memoizedState!==null||fl;i=gP;var _=fl;if(gP=d,(fl=g)&&!_)for(_n=o;_n!==null;)d=_n,g=d.child,d.tag===22&&d.memoizedState!==null?dq(o):g!==null?(g.return=d,_n=g):dq(o);for(;l!==null;)_n=l,dY(l),l=l.sibling;_n=o,gP=i,fl=_}cq(e)}else o.subtreeFlags&8772&&l!==null?(l.return=o,_n=l):cq(e)}}function cq(e){for(;_n!==null;){var t=_n;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:fl||Zk(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!fl)if(r===null)n.componentDidMount();else{var o=t.elementType===t.type?r.memoizedProps:ld(t.type,r.memoizedProps);n.componentDidUpdate(o,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var l=t.updateQueue;l!==null&&H8(t,l,n);break;case 3:var d=t.updateQueue;if(d!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}H8(t,d,r)}break;case 5:var i=t.stateNode;if(r===null&&t.flags&4){r=i;var g=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":g.autoFocus&&r.focus();break;case"img":g.src&&(r.src=g.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var _=t.alternate;if(_!==null){var S=_.memoizedState;if(S!==null){var E=S.dehydrated;E!==null&&dE(E)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(kr(163))}fl||t.flags&512&&vL(t)}catch(T){Oo(t,t.return,T)}}if(t===e){_n=null;break}if(r=t.sibling,r!==null){r.return=t.return,_n=r;break}_n=t.return}}function uq(e){for(;_n!==null;){var t=_n;if(t===e){_n=null;break}var r=t.sibling;if(r!==null){r.return=t.return,_n=r;break}_n=t.return}}function dq(e){for(;_n!==null;){var t=_n;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{Zk(4,t)}catch(g){Oo(t,r,g)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var o=t.return;try{n.componentDidMount()}catch(g){Oo(t,o,g)}}var l=t.return;try{vL(t)}catch(g){Oo(t,l,g)}break;case 5:var d=t.return;try{vL(t)}catch(g){Oo(t,d,g)}}}catch(g){Oo(t,t.return,g)}if(t===e){_n=null;break}var i=t.sibling;if(i!==null){i.return=t.return,_n=i;break}_n=t.return}}var Kme=Math.ceil,XC=Uf.ReactCurrentDispatcher,Qz=Uf.ReactCurrentOwner,Au=Uf.ReactCurrentBatchConfig,ha=0,ks=null,Qo=null,Ws=0,Lc=0,$x=Qm(0),gs=0,wE=null,ov=0,Xk=0,eB=0,WS=null,mc=null,tB=0,P0=1/0,ff=null,YC=!1,bL=null,Rm=null,yP=!1,wm=null,JC=0,GS=0,wL=null,lC=-1,cC=0;function Hl(){return ha&6?Do():lC!==-1?lC:lC=Do()}function jm(e){return e.mode&1?ha&2&&Ws!==0?Ws&-Ws:Ime.transition!==null?(cC===0&&(cC=ZZ()),cC):(e=Na,e!==0||(e=window.event,e=e===void 0?16:rX(e.type)),e):1}function bd(e,t,r,n){if(50<GS)throw GS=0,wL=null,Error(kr(185));AT(e,r,n),(!(ha&2)||e!==ks)&&(e===ks&&(!(ha&2)&&(Xk|=r),gs===4&&nm(e,Ws)),wc(e,n),r===1&&ha===0&&!(t.mode&1)&&(P0=Do()+500,Gk&&eg()))}function wc(e,t){var r=e.callbackNode;Ipe(e,t);var n=MC(e,e===ks?Ws:0);if(n===0)r!==null&&x8(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&x8(r),t===1)e.tag===0?kme(hq.bind(null,e)):bX(hq.bind(null,e)),Ame(function(){!(ha&6)&&eg()}),r=null;else{switch(XZ(n)){case 1:r=Pz;break;case 4:r=HZ;break;case 16:r=NC;break;case 536870912:r=KZ;break;default:r=NC}r=_Y(r,hY.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function hY(e,t){if(lC=-1,cC=0,ha&6)throw Error(kr(327));var r=e.callbackNode;if(Jx()&&e.callbackNode!==r)return null;var n=MC(e,e===ks?Ws:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=QC(e,n);else{t=n;var o=ha;ha|=2;var l=pY();(ks!==e||Ws!==t)&&(ff=null,P0=Do()+500,Jy(e,t));do try{Yme();break}catch(i){fY(e,i)}while(!0);Bz(),XC.current=l,ha=o,Qo!==null?t=0:(ks=null,Ws=0,t=gs)}if(t!==0){if(t===2&&(o=ZD(e),o!==0&&(n=o,t=SL(e,o))),t===1)throw r=wE,Jy(e,0),nm(e,n),wc(e,Do()),r;if(t===6)nm(e,n);else{if(o=e.current.alternate,!(n&30)&&!Zme(o)&&(t=QC(e,n),t===2&&(l=ZD(e),l!==0&&(n=l,t=SL(e,l))),t===1))throw r=wE,Jy(e,0),nm(e,n),wc(e,Do()),r;switch(e.finishedWork=o,e.finishedLanes=n,t){case 0:case 1:throw Error(kr(345));case 2:xy(e,mc,ff);break;case 3:if(nm(e,n),(n&130023424)===n&&(t=tB+500-Do(),10<t)){if(MC(e,0)!==0)break;if(o=e.suspendedLanes,(o&n)!==n){Hl(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=nL(xy.bind(null,e,mc,ff),t);break}xy(e,mc,ff);break;case 4:if(nm(e,n),(n&4194240)===n)break;for(t=e.eventTimes,o=-1;0<n;){var d=31-xd(n);l=1<<d,d=t[d],d>o&&(o=d),n&=~l}if(n=o,n=Do()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Kme(n/1960))-n,10<n){e.timeoutHandle=nL(xy.bind(null,e,mc,ff),n);break}xy(e,mc,ff);break;case 5:xy(e,mc,ff);break;default:throw Error(kr(329))}}}return wc(e,Do()),e.callbackNode===r?hY.bind(null,e):null}function SL(e,t){var r=WS;return e.current.memoizedState.isDehydrated&&(Jy(e,t).flags|=256),e=QC(e,t),e!==2&&(t=mc,mc=r,t!==null&&EL(t)),e}function EL(e){mc===null?mc=e:mc.push.apply(mc,e)}function Zme(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var o=r[n],l=o.getSnapshot;o=o.value;try{if(!Td(l(),o))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function nm(e,t){for(t&=~eB,t&=~Xk,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-xd(t),n=1<<r;e[r]=-1,t&=~n}}function hq(e){if(ha&6)throw Error(kr(327));Jx();var t=MC(e,0);if(!(t&1))return wc(e,Do()),null;var r=QC(e,t);if(e.tag!==0&&r===2){var n=ZD(e);n!==0&&(t=n,r=SL(e,n))}if(r===1)throw r=wE,Jy(e,0),nm(e,t),wc(e,Do()),r;if(r===6)throw Error(kr(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,xy(e,mc,ff),wc(e,Do()),null}function rB(e,t){var r=ha;ha|=1;try{return e(t)}finally{ha=r,ha===0&&(P0=Do()+500,Gk&&eg())}}function sv(e){wm!==null&&wm.tag===0&&!(ha&6)&&Jx();var t=ha;ha|=1;var r=Au.transition,n=Na;try{if(Au.transition=null,Na=1,e)return e()}finally{Na=n,Au.transition=r,ha=t,!(ha&6)&&eg()}}function nB(){Lc=$x.current,oo($x)}function Jy(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,Tme(r)),Qo!==null)for(r=Qo.return;r!==null;){var n=r;switch(Lz(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&BC();break;case 3:T0(),oo(xc),oo(ml),Gz();break;case 5:Wz(n);break;case 4:T0();break;case 13:oo(_o);break;case 19:oo(_o);break;case 10:$z(n.type._context);break;case 22:case 23:nB()}r=r.return}if(ks=e,Qo=e=Nm(e.current,null),Ws=Lc=t,gs=0,wE=null,eB=Xk=ov=0,mc=WS=null,Ny!==null){for(t=0;t<Ny.length;t++)if(r=Ny[t],n=r.interleaved,n!==null){r.interleaved=null;var o=n.next,l=r.pending;if(l!==null){var d=l.next;l.next=o,n.next=d}r.pending=n}Ny=null}return e}function fY(e,t){do{var r=Qo;try{if(Bz(),aC.current=ZC,KC){for(var n=xo.memoizedState;n!==null;){var o=n.queue;o!==null&&(o.pending=null),n=n.next}KC=!1}if(av=0,Cs=fs=xo=null,VS=!1,_E=0,Qz.current=null,r===null||r.return===null){gs=1,wE=t,Qo=null;break}e:{var l=e,d=r.return,i=r,g=t;if(t=Ws,i.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){var _=g,S=i,E=S.tag;if(!(S.mode&1)&&(E===0||E===11||E===15)){var T=S.alternate;T?(S.updateQueue=T.updateQueue,S.memoizedState=T.memoizedState,S.lanes=T.lanes):(S.updateQueue=null,S.memoizedState=null)}var C=Q8(d);if(C!==null){C.flags&=-257,eq(C,d,i,l,t),C.mode&1&&J8(l,_,t),t=C,g=_;var N=t.updateQueue;if(N===null){var I=new Set;I.add(g),t.updateQueue=I}else N.add(g);break e}else{if(!(t&1)){J8(l,_,t),iB();break e}g=Error(kr(426))}}else if(ho&&i.mode&1){var j=Q8(d);if(j!==null){!(j.flags&65536)&&(j.flags|=256),eq(j,d,i,l,t),Fz(A0(g,i));break e}}l=g=A0(g,i),gs!==4&&(gs=2),WS===null?WS=[l]:WS.push(l),l=d;do{switch(l.tag){case 3:l.flags|=65536,t&=-t,l.lanes|=t;var D=XX(l,g,t);G8(l,D);break e;case 1:i=g;var R=l.type,F=l.stateNode;if(!(l.flags&128)&&(typeof R.getDerivedStateFromError=="function"||F!==null&&typeof F.componentDidCatch=="function"&&(Rm===null||!Rm.has(F)))){l.flags|=65536,t&=-t,l.lanes|=t;var B=YX(l,i,t);G8(l,B);break e}}l=l.return}while(l!==null)}gY(r)}catch(U){t=U,Qo===r&&r!==null&&(Qo=r=r.return);continue}break}while(!0)}function pY(){var e=XC.current;return XC.current=ZC,e===null?ZC:e}function iB(){(gs===0||gs===3||gs===2)&&(gs=4),ks===null||!(ov&268435455)&&!(Xk&268435455)||nm(ks,Ws)}function QC(e,t){var r=ha;ha|=2;var n=pY();(ks!==e||Ws!==t)&&(ff=null,Jy(e,t));do try{Xme();break}catch(o){fY(e,o)}while(!0);if(Bz(),ha=r,XC.current=n,Qo!==null)throw Error(kr(261));return ks=null,Ws=0,gs}function Xme(){for(;Qo!==null;)mY(Qo)}function Yme(){for(;Qo!==null&&!wpe();)mY(Qo)}function mY(e){var t=vY(e.alternate,e,Lc);e.memoizedProps=e.pendingProps,t===null?gY(e):Qo=t,Qz.current=null}function gY(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=qme(r,t),r!==null){r.flags&=32767,Qo=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{gs=6,Qo=null;return}}else if(r=Vme(r,t,Lc),r!==null){Qo=r;return}if(t=t.sibling,t!==null){Qo=t;return}Qo=t=e}while(t!==null);gs===0&&(gs=5)}function xy(e,t,r){var n=Na,o=Au.transition;try{Au.transition=null,Na=1,Jme(e,t,r,n)}finally{Au.transition=o,Na=n}return null}function Jme(e,t,r,n){do Jx();while(wm!==null);if(ha&6)throw Error(kr(327));r=e.finishedWork;var o=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(kr(177));e.callbackNode=null,e.callbackPriority=0;var l=r.lanes|r.childLanes;if(Rpe(e,l),e===ks&&(Qo=ks=null,Ws=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||yP||(yP=!0,_Y(NC,function(){return Jx(),null})),l=(r.flags&15990)!==0,r.subtreeFlags&15990||l){l=Au.transition,Au.transition=null;var d=Na;Na=1;var i=ha;ha|=4,Qz.current=null,Gme(e,r),uY(r,e),vme(tL),DC=!!eL,tL=eL=null,e.current=r,Hme(r),Spe(),ha=i,Na=d,Au.transition=l}else e.current=r;if(yP&&(yP=!1,wm=e,JC=o),l=e.pendingLanes,l===0&&(Rm=null),Ape(r.stateNode),wc(e,Do()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)o=t[r],n(o.value,{componentStack:o.stack,digest:o.digest});if(YC)throw YC=!1,e=bL,bL=null,e;return JC&1&&e.tag!==0&&Jx(),l=e.pendingLanes,l&1?e===wL?GS++:(GS=0,wL=e):GS=0,eg(),null}function Jx(){if(wm!==null){var e=XZ(JC),t=Au.transition,r=Na;try{if(Au.transition=null,Na=16>e?16:e,wm===null)var n=!1;else{if(e=wm,wm=null,JC=0,ha&6)throw Error(kr(331));var o=ha;for(ha|=4,_n=e.current;_n!==null;){var l=_n,d=l.child;if(_n.flags&16){var i=l.deletions;if(i!==null){for(var g=0;g<i.length;g++){var _=i[g];for(_n=_;_n!==null;){var S=_n;switch(S.tag){case 0:case 11:case 15:qS(8,S,l)}var E=S.child;if(E!==null)E.return=S,_n=E;else for(;_n!==null;){S=_n;var T=S.sibling,C=S.return;if(sY(S),S===_){_n=null;break}if(T!==null){T.return=C,_n=T;break}_n=C}}}var N=l.alternate;if(N!==null){var I=N.child;if(I!==null){N.child=null;do{var j=I.sibling;I.sibling=null,I=j}while(I!==null)}}_n=l}}if(l.subtreeFlags&2064&&d!==null)d.return=l,_n=d;else e:for(;_n!==null;){if(l=_n,l.flags&2048)switch(l.tag){case 0:case 11:case 15:qS(9,l,l.return)}var D=l.sibling;if(D!==null){D.return=l.return,_n=D;break e}_n=l.return}}var R=e.current;for(_n=R;_n!==null;){d=_n;var F=d.child;if(d.subtreeFlags&2064&&F!==null)F.return=d,_n=F;else e:for(d=R;_n!==null;){if(i=_n,i.flags&2048)try{switch(i.tag){case 0:case 11:case 15:Zk(9,i)}}catch(U){Oo(i,i.return,U)}if(i===d){_n=null;break e}var B=i.sibling;if(B!==null){B.return=i.return,_n=B;break e}_n=i.return}}if(ha=o,eg(),_h&&typeof _h.onPostCommitFiberRoot=="function")try{_h.onPostCommitFiberRoot($k,e)}catch{}n=!0}return n}finally{Na=r,Au.transition=t}}return!1}function fq(e,t,r){t=A0(r,t),t=XX(e,t,1),e=Im(e,t,1),t=Hl(),e!==null&&(AT(e,1,t),wc(e,t))}function Oo(e,t,r){if(e.tag===3)fq(e,e,r);else for(;t!==null;){if(t.tag===3){fq(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Rm===null||!Rm.has(n))){e=A0(r,e),e=YX(t,e,1),t=Im(t,e,1),e=Hl(),t!==null&&(AT(t,1,e),wc(t,e));break}}t=t.return}}function Qme(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=Hl(),e.pingedLanes|=e.suspendedLanes&r,ks===e&&(Ws&r)===r&&(gs===4||gs===3&&(Ws&130023424)===Ws&&500>Do()-tB?Jy(e,0):eB|=r),wc(e,t)}function yY(e,t){t===0&&(e.mode&1?(t=sP,sP<<=1,!(sP&130023424)&&(sP=4194304)):t=1);var r=Hl();e=Nf(e,t),e!==null&&(AT(e,t,r),wc(e,r))}function ege(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),yY(e,r)}function tge(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,o=e.memoizedState;o!==null&&(r=o.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(kr(314))}n!==null&&n.delete(t),yY(e,r)}var vY;vY=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||xc.current)yc=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return yc=!1,Ume(e,t,r);yc=!!(e.flags&131072)}else yc=!1,ho&&t.flags&1048576&&wX(t,VC,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;sC(e,t),e=t.pendingProps;var o=w0(t,ml.current);Yx(t,r),o=Kz(null,t,n,e,o,r);var l=Zz();return t.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,bc(n)?(l=!0,$C(t)):l=!1,t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,Vz(t),o.updater=Kk,t.stateNode=o,o._reactInternals=t,uL(t,n,e,r),t=fL(null,t,n,!0,l,r)):(t.tag=0,ho&&l&&Dz(t),Dl(null,t,o,r),t=t.child),t;case 16:n=t.elementType;e:{switch(sC(e,t),e=t.pendingProps,o=n._init,n=o(n._payload),t.type=n,o=t.tag=nge(n),e=ld(n,e),o){case 0:t=hL(null,t,n,e,r);break e;case 1:t=nq(null,t,n,e,r);break e;case 11:t=tq(null,t,n,e,r);break e;case 14:t=rq(null,t,n,ld(n.type,e),r);break e}throw Error(kr(306,n,""))}return t;case 0:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:ld(n,o),hL(e,t,n,o,r);case 1:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:ld(n,o),nq(e,t,n,o,r);case 3:e:{if(tY(t),e===null)throw Error(kr(387));n=t.pendingProps,l=t.memoizedState,o=l.element,CX(e,t),GC(t,n,null,r);var d=t.memoizedState;if(n=d.element,l.isDehydrated)if(l={element:n,isDehydrated:!1,cache:d.cache,pendingSuspenseBoundaries:d.pendingSuspenseBoundaries,transitions:d.transitions},t.updateQueue.baseState=l,t.memoizedState=l,t.flags&256){o=A0(Error(kr(423)),t),t=iq(e,t,n,r,o);break e}else if(n!==o){o=A0(Error(kr(424)),t),t=iq(e,t,n,r,o);break e}else for(Gc=km(t.stateNode.containerInfo.firstChild),Hc=t,ho=!0,gd=null,r=AX(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(S0(),n===o){t=Mf(e,t,r);break e}Dl(e,t,n,r)}t=t.child}return t;case 5:return OX(t),e===null&&sL(t),n=t.type,o=t.pendingProps,l=e!==null?e.memoizedProps:null,d=o.children,rL(n,o)?d=null:l!==null&&rL(n,l)&&(t.flags|=32),eY(e,t),Dl(e,t,d,r),t.child;case 6:return e===null&&sL(t),null;case 13:return rY(e,t,r);case 4:return qz(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=E0(t,null,n,r):Dl(e,t,n,r),t.child;case 11:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:ld(n,o),tq(e,t,n,o,r);case 7:return Dl(e,t,t.pendingProps,r),t.child;case 8:return Dl(e,t,t.pendingProps.children,r),t.child;case 12:return Dl(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,o=t.pendingProps,l=t.memoizedProps,d=o.value,Za(qC,n._currentValue),n._currentValue=d,l!==null)if(Td(l.value,d)){if(l.children===o.children&&!xc.current){t=Mf(e,t,r);break e}}else for(l=t.child,l!==null&&(l.return=t);l!==null;){var i=l.dependencies;if(i!==null){d=l.child;for(var g=i.firstContext;g!==null;){if(g.context===n){if(l.tag===1){g=Tf(-1,r&-r),g.tag=2;var _=l.updateQueue;if(_!==null){_=_.shared;var S=_.pending;S===null?g.next=g:(g.next=S.next,S.next=g),_.pending=g}}l.lanes|=r,g=l.alternate,g!==null&&(g.lanes|=r),lL(l.return,r,t),i.lanes|=r;break}g=g.next}}else if(l.tag===10)d=l.type===t.type?null:l.child;else if(l.tag===18){if(d=l.return,d===null)throw Error(kr(341));d.lanes|=r,i=d.alternate,i!==null&&(i.lanes|=r),lL(d,r,t),d=l.sibling}else d=l.child;if(d!==null)d.return=l;else for(d=l;d!==null;){if(d===t){d=null;break}if(l=d.sibling,l!==null){l.return=d.return,d=l;break}d=d.return}l=d}Dl(e,t,o.children,r),t=t.child}return t;case 9:return o=t.type,n=t.pendingProps.children,Yx(t,r),o=ku(o),n=n(o),t.flags|=1,Dl(e,t,n,r),t.child;case 14:return n=t.type,o=ld(n,t.pendingProps),o=ld(n.type,o),rq(e,t,n,o,r);case 15:return JX(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:ld(n,o),sC(e,t),t.tag=1,bc(n)?(e=!0,$C(t)):e=!1,Yx(t,r),ZX(t,n,o),uL(t,n,o,r),fL(null,t,n,!0,e,r);case 19:return nY(e,t,r);case 22:return QX(e,t,r)}throw Error(kr(156,t.tag))};function _Y(e,t){return GZ(e,t)}function rge(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Eu(e,t,r,n){return new rge(e,t,r,n)}function aB(e){return e=e.prototype,!(!e||!e.isReactComponent)}function nge(e){if(typeof e=="function")return aB(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Ez)return 11;if(e===Tz)return 14}return 2}function Nm(e,t){var r=e.alternate;return r===null?(r=Eu(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function uC(e,t,r,n,o,l){var d=2;if(n=e,typeof e=="function")aB(e)&&(d=1);else if(typeof e=="string")d=5;else e:switch(e){case Ix:return Qy(r.children,o,l,t);case Sz:d=8,o|=8;break;case ND:return e=Eu(12,r,t,o|2),e.elementType=ND,e.lanes=l,e;case MD:return e=Eu(13,r,t,o),e.elementType=MD,e.lanes=l,e;case DD:return e=Eu(19,r,t,o),e.elementType=DD,e.lanes=l,e;case OZ:return Yk(r,o,l,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case PZ:d=10;break e;case CZ:d=9;break e;case Ez:d=11;break e;case Tz:d=14;break e;case Jp:d=16,n=null;break e}throw Error(kr(130,e==null?e:typeof e,""))}return t=Eu(d,r,t,o),t.elementType=e,t.type=n,t.lanes=l,t}function Qy(e,t,r,n){return e=Eu(7,e,n,t),e.lanes=r,e}function Yk(e,t,r,n){return e=Eu(22,e,n,t),e.elementType=OZ,e.lanes=r,e.stateNode={isHidden:!1},e}function _M(e,t,r){return e=Eu(6,e,null,t),e.lanes=r,e}function xM(e,t,r){return t=Eu(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function ige(e,t,r,n,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=eM(0),this.expirationTimes=eM(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=eM(0),this.identifierPrefix=n,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function oB(e,t,r,n,o,l,d,i,g){return e=new ige(e,t,r,i,g),t===1?(t=1,l===!0&&(t|=8)):t=0,l=Eu(3,null,null,t),e.current=l,l.stateNode=e,l.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},Vz(l),e}function age(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:kx,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function xY(e){if(!e)return Um;e=e._reactInternals;e:{if(Tv(e)!==e||e.tag!==1)throw Error(kr(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(bc(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(kr(171))}if(e.tag===1){var r=e.type;if(bc(r))return xX(e,r,t)}return t}function bY(e,t,r,n,o,l,d,i,g){return e=oB(r,n,!0,e,o,l,d,i,g),e.context=xY(null),r=e.current,n=Hl(),o=jm(r),l=Tf(n,o),l.callback=t??null,Im(r,l,o),e.current.lanes=o,AT(e,o,n),wc(e,n),e}function Jk(e,t,r,n){var o=t.current,l=Hl(),d=jm(o);return r=xY(r),t.context===null?t.context=r:t.pendingContext=r,t=Tf(l,d),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=Im(o,t,d),e!==null&&(bd(e,o,d,l),iC(e,o,d)),d}function eO(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function pq(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function sB(e,t){pq(e,t),(e=e.alternate)&&pq(e,t)}function oge(){return null}var wY=typeof reportError=="function"?reportError:function(e){console.error(e)};function lB(e){this._internalRoot=e}Qk.prototype.render=lB.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(kr(409));Jk(e,t,null,null)};Qk.prototype.unmount=lB.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;sv(function(){Jk(null,e,null,null)}),t[jf]=null}};function Qk(e){this._internalRoot=e}Qk.prototype.unstable_scheduleHydration=function(e){if(e){var t=QZ();e={blockedOn:null,target:e,priority:t};for(var r=0;r<rm.length&&t!==0&&t<rm[r].priority;r++);rm.splice(r,0,e),r===0&&tX(e)}};function cB(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function eI(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function mq(){}function sge(e,t,r,n,o){if(o){if(typeof n=="function"){var l=n;n=function(){var _=eO(d);l.call(_)}}var d=bY(t,n,e,0,null,!1,!1,"",mq);return e._reactRootContainer=d,e[jf]=d.current,pE(e.nodeType===8?e.parentNode:e),sv(),d}for(;o=e.lastChild;)e.removeChild(o);if(typeof n=="function"){var i=n;n=function(){var _=eO(g);i.call(_)}}var g=oB(e,0,!1,null,null,!1,!1,"",mq);return e._reactRootContainer=g,e[jf]=g.current,pE(e.nodeType===8?e.parentNode:e),sv(function(){Jk(t,g,r,n)}),g}function tI(e,t,r,n,o){var l=r._reactRootContainer;if(l){var d=l;if(typeof o=="function"){var i=o;o=function(){var g=eO(d);i.call(g)}}Jk(t,d,e,o)}else d=sge(r,t,e,o,n);return eO(d)}YZ=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=AS(t.pendingLanes);r!==0&&(Cz(t,r|1),wc(t,Do()),!(ha&6)&&(P0=Do()+500,eg()))}break;case 13:sv(function(){var n=Nf(e,1);if(n!==null){var o=Hl();bd(n,e,1,o)}}),sB(e,1)}};Oz=function(e){if(e.tag===13){var t=Nf(e,134217728);if(t!==null){var r=Hl();bd(t,e,134217728,r)}sB(e,134217728)}};JZ=function(e){if(e.tag===13){var t=jm(e),r=Nf(e,t);if(r!==null){var n=Hl();bd(r,e,t,n)}sB(e,t)}};QZ=function(){return Na};eX=function(e,t){var r=Na;try{return Na=e,t()}finally{Na=r}};GD=function(e,t,r){switch(t){case"input":if(zD(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var o=Wk(n);if(!o)throw Error(kr(90));IZ(n),zD(n,o)}}}break;case"textarea":jZ(e,r);break;case"select":t=r.value,t!=null&&Hx(e,!!r.multiple,t,!1)}};BZ=rB;$Z=sv;var lge={usingClientEntryPoint:!1,Events:[CT,Mx,Wk,FZ,zZ,rB]},iS={findFiberByHostInstance:jy,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},cge={bundleType:iS.bundleType,version:iS.version,rendererPackageName:iS.rendererPackageName,rendererConfig:iS.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Uf.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=qZ(e),e===null?null:e.stateNode},findFiberByHostInstance:iS.findFiberByHostInstance||oge,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vP=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vP.isDisabled&&vP.supportsFiber)try{$k=vP.inject(cge),_h=vP}catch{}}tu.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=lge;tu.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!cB(t))throw Error(kr(200));return age(e,t,null,r)};tu.createRoot=function(e,t){if(!cB(e))throw Error(kr(299));var r=!1,n="",o=wY;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),t=oB(e,1,!1,null,null,r,!1,n,o),e[jf]=t.current,pE(e.nodeType===8?e.parentNode:e),new lB(t)};tu.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(kr(188)):(e=Object.keys(e).join(","),Error(kr(268,e)));return e=qZ(t),e=e===null?null:e.stateNode,e};tu.flushSync=function(e){return sv(e)};tu.hydrate=function(e,t,r){if(!eI(t))throw Error(kr(200));return tI(null,e,t,!0,r)};tu.hydrateRoot=function(e,t,r){if(!cB(e))throw Error(kr(405));var n=r!=null&&r.hydratedSources||null,o=!1,l="",d=wY;if(r!=null&&(r.unstable_strictMode===!0&&(o=!0),r.identifierPrefix!==void 0&&(l=r.identifierPrefix),r.onRecoverableError!==void 0&&(d=r.onRecoverableError)),t=bY(t,null,e,1,r??null,o,!1,l,d),e[jf]=t.current,pE(e),n)for(e=0;e<n.length;e++)r=n[e],o=r._getVersion,o=o(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,o]:t.mutableSourceEagerHydrationData.push(r,o);return new Qk(t)};tu.render=function(e,t,r){if(!eI(t))throw Error(kr(200));return tI(null,e,t,!1,r)};tu.unmountComponentAtNode=function(e){if(!eI(e))throw Error(kr(40));return e._reactRootContainer?(sv(function(){tI(null,null,e,!1,function(){e._reactRootContainer=null,e[jf]=null})}),!0):!1};tu.unstable_batchedUpdates=rB;tu.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!eI(r))throw Error(kr(200));if(e==null||e._reactInternals===void 0)throw Error(kr(38));return tI(e,t,r,!1,n)};tu.version="18.3.1-next-f1338f8080-20240426";function SY(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(SY)}catch(e){console.error(e)}}SY(),SZ.exports=tu;var tg=SZ.exports;const EY=_a(tg);var TY,gq=tg;TY=gq.createRoot,gq.hydrateRoot;const uge=1,dge=1e6;let bM=0;function hge(){return bM=(bM+1)%Number.MAX_SAFE_INTEGER,bM.toString()}const wM=new Map,yq=e=>{if(wM.has(e))return;const t=setTimeout(()=>{wM.delete(e),HS({type:"REMOVE_TOAST",toastId:e})},dge);wM.set(e,t)},fge=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,uge)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(r=>r.id===t.toast.id?{...r,...t.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=t;return r?yq(r):e.toasts.forEach(n=>{yq(n.id)}),{...e,toasts:e.toasts.map(n=>n.id===r||r===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(r=>r.id!==t.toastId)}}},dC=[];let hC={toasts:[]};function HS(e){hC=fge(hC,e),dC.forEach(t=>{t(hC)})}function Fc({...e}){const t=hge(),r=o=>HS({type:"UPDATE_TOAST",toast:{...o,id:t}}),n=()=>HS({type:"DISMISS_TOAST",toastId:t});return HS({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:o=>{o||n()}}}),{id:t,dismiss:n,update:r}}function Sa(){const[e,t]=W.useState(hC);return W.useEffect(()=>(dC.push(t),()=>{const r=dC.indexOf(t);r>-1&&dC.splice(r,1)}),[e]),{...e,toast:Fc,dismiss:r=>HS({type:"DISMISS_TOAST",toastId:r})}}function Rr(e,t,{checkForDefaultPrevented:r=!0}={}){return function(o){if(e==null||e(o),r===!1||!o.defaultPrevented)return t==null?void 0:t(o)}}function vq(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function rI(...e){return t=>{let r=!1;const n=e.map(o=>{const l=vq(o,t);return!r&&typeof l=="function"&&(r=!0),l});if(r)return()=>{for(let o=0;o<n.length;o++){const l=n[o];typeof l=="function"?l():vq(e[o],null)}}}}function fi(...e){return W.useCallback(rI(...e),e)}function pge(e,t){const r=W.createContext(t),n=l=>{const{children:d,...i}=l,g=W.useMemo(()=>i,Object.values(i));return m.jsx(r.Provider,{value:g,children:d})};n.displayName=e+"Provider";function o(l){const d=W.useContext(r);if(d)return d;if(t!==void 0)return t;throw new Error(`\`${l}\` must be used within \`${e}\``)}return[n,o]}function Zs(e,t=[]){let r=[];function n(l,d){const i=W.createContext(d),g=r.length;r=[...r,d];const _=E=>{var D;const{scope:T,children:C,...N}=E,I=((D=T==null?void 0:T[e])==null?void 0:D[g])||i,j=W.useMemo(()=>N,Object.values(N));return m.jsx(I.Provider,{value:j,children:C})};_.displayName=l+"Provider";function S(E,T){var I;const C=((I=T==null?void 0:T[e])==null?void 0:I[g])||i,N=W.useContext(C);if(N)return N;if(d!==void 0)return d;throw new Error(`\`${E}\` must be used within \`${l}\``)}return[_,S]}const o=()=>{const l=r.map(d=>W.createContext(d));return function(i){const g=(i==null?void 0:i[e])||l;return W.useMemo(()=>({[`__scope${e}`]:{...i,[e]:g}}),[i,g])}};return o.scopeName=e,[n,mge(o,...t)]}function mge(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const n=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(l){const d=n.reduce((i,{useScope:g,scopeName:_})=>{const E=g(l)[`__scope${_}`];return{...i,...E}},{});return W.useMemo(()=>({[`__scope${t.scopeName}`]:d}),[d])}};return r.scopeName=t.scopeName,r}function Vm(e){const t=gge(e),r=W.forwardRef((n,o)=>{const{children:l,...d}=n,i=W.Children.toArray(l),g=i.find(yge);if(g){const _=g.props.children,S=i.map(E=>E===g?W.Children.count(_)>1?W.Children.only(null):W.isValidElement(_)?_.props.children:null:E);return m.jsx(t,{...d,ref:o,children:W.isValidElement(_)?W.cloneElement(_,void 0,S):null})}return m.jsx(t,{...d,ref:o,children:l})});return r.displayName=`${e}.Slot`,r}var Av=Vm("Slot");function gge(e){const t=W.forwardRef((r,n)=>{const{children:o,...l}=r;if(W.isValidElement(o)){const d=_ge(o),i=vge(l,o.props);return o.type!==W.Fragment&&(i.ref=n?rI(n,d):d),W.cloneElement(o,i)}return W.Children.count(o)>1?W.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var AY=Symbol("radix.slottable");function PY(e){const t=({children:r})=>m.jsx(m.Fragment,{children:r});return t.displayName=`${e}.Slottable`,t.__radixId=AY,t}function yge(e){return W.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===AY}function vge(e,t){const r={...t};for(const n in t){const o=e[n],l=t[n];/^on[A-Z]/.test(n)?o&&l?r[n]=(...i)=>{const g=l(...i);return o(...i),g}:o&&(r[n]=o):n==="style"?r[n]={...o,...l}:n==="className"&&(r[n]=[o,l].filter(Boolean).join(" "))}return{...e,...r}}function _ge(e){var n,o;let t=(n=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:n.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(o=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:o.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}function nI(e){const t=e+"CollectionProvider",[r,n]=Zs(t),[o,l]=r(t,{collectionRef:{current:null},itemMap:new Map}),d=I=>{const{scope:j,children:D}=I,R=He.useRef(null),F=He.useRef(new Map).current;return m.jsx(o,{scope:j,itemMap:F,collectionRef:R,children:D})};d.displayName=t;const i=e+"CollectionSlot",g=Vm(i),_=He.forwardRef((I,j)=>{const{scope:D,children:R}=I,F=l(i,D),B=fi(j,F.collectionRef);return m.jsx(g,{ref:B,children:R})});_.displayName=i;const S=e+"CollectionItemSlot",E="data-radix-collection-item",T=Vm(S),C=He.forwardRef((I,j)=>{const{scope:D,children:R,...F}=I,B=He.useRef(null),U=fi(j,B),Z=l(S,D);return He.useEffect(()=>(Z.itemMap.set(B,{ref:B,...F}),()=>void Z.itemMap.delete(B))),m.jsx(T,{[E]:"",ref:U,children:R})});C.displayName=S;function N(I){const j=l(e+"CollectionConsumer",I);return He.useCallback(()=>{const R=j.collectionRef.current;if(!R)return[];const F=Array.from(R.querySelectorAll(`[${E}]`));return Array.from(j.itemMap.values()).sort((Z,J)=>F.indexOf(Z.ref.current)-F.indexOf(J.ref.current))},[j.collectionRef,j.itemMap])}return[{Provider:d,Slot:_,ItemSlot:C},N,n]}var xge=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],wn=xge.reduce((e,t)=>{const r=Vm(`Primitive.${t}`),n=W.forwardRef((o,l)=>{const{asChild:d,...i}=o,g=d?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),m.jsx(g,{...i,ref:l})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function uB(e,t){e&&tg.flushSync(()=>e.dispatchEvent(t))}function Io(e){const t=W.useRef(e);return W.useEffect(()=>{t.current=e}),W.useMemo(()=>(...r)=>{var n;return(n=t.current)==null?void 0:n.call(t,...r)},[])}function bge(e,t=globalThis==null?void 0:globalThis.document){const r=Io(e);W.useEffect(()=>{const n=o=>{o.key==="Escape"&&r(o)};return t.addEventListener("keydown",n,{capture:!0}),()=>t.removeEventListener("keydown",n,{capture:!0})},[r,t])}var wge="DismissableLayer",TL="dismissableLayer.update",Sge="dismissableLayer.pointerDownOutside",Ege="dismissableLayer.focusOutside",_q,CY=W.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Pv=W.forwardRef((e,t)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:o,onFocusOutside:l,onInteractOutside:d,onDismiss:i,...g}=e,_=W.useContext(CY),[S,E]=W.useState(null),T=(S==null?void 0:S.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,C]=W.useState({}),N=fi(t,J=>E(J)),I=Array.from(_.layers),[j]=[..._.layersWithOutsidePointerEventsDisabled].slice(-1),D=I.indexOf(j),R=S?I.indexOf(S):-1,F=_.layersWithOutsidePointerEventsDisabled.size>0,B=R>=D,U=Age(J=>{const te=J.target,ae=[..._.branches].some(ne=>ne.contains(te));!B||ae||(o==null||o(J),d==null||d(J),J.defaultPrevented||i==null||i())},T),Z=Pge(J=>{const te=J.target;[..._.branches].some(ne=>ne.contains(te))||(l==null||l(J),d==null||d(J),J.defaultPrevented||i==null||i())},T);return bge(J=>{R===_.layers.size-1&&(n==null||n(J),!J.defaultPrevented&&i&&(J.preventDefault(),i()))},T),W.useEffect(()=>{if(S)return r&&(_.layersWithOutsidePointerEventsDisabled.size===0&&(_q=T.body.style.pointerEvents,T.body.style.pointerEvents="none"),_.layersWithOutsidePointerEventsDisabled.add(S)),_.layers.add(S),xq(),()=>{r&&_.layersWithOutsidePointerEventsDisabled.size===1&&(T.body.style.pointerEvents=_q)}},[S,T,r,_]),W.useEffect(()=>()=>{S&&(_.layers.delete(S),_.layersWithOutsidePointerEventsDisabled.delete(S),xq())},[S,_]),W.useEffect(()=>{const J=()=>C({});return document.addEventListener(TL,J),()=>document.removeEventListener(TL,J)},[]),m.jsx(wn.div,{...g,ref:N,style:{pointerEvents:F?B?"auto":"none":void 0,...e.style},onFocusCapture:Rr(e.onFocusCapture,Z.onFocusCapture),onBlurCapture:Rr(e.onBlurCapture,Z.onBlurCapture),onPointerDownCapture:Rr(e.onPointerDownCapture,U.onPointerDownCapture)})});Pv.displayName=wge;var Tge="DismissableLayerBranch",OY=W.forwardRef((e,t)=>{const r=W.useContext(CY),n=W.useRef(null),o=fi(t,n);return W.useEffect(()=>{const l=n.current;if(l)return r.branches.add(l),()=>{r.branches.delete(l)}},[r.branches]),m.jsx(wn.div,{...e,ref:o})});OY.displayName=Tge;function Age(e,t=globalThis==null?void 0:globalThis.document){const r=Io(e),n=W.useRef(!1),o=W.useRef(()=>{});return W.useEffect(()=>{const l=i=>{if(i.target&&!n.current){let g=function(){kY(Sge,r,_,{discrete:!0})};const _={originalEvent:i};i.pointerType==="touch"?(t.removeEventListener("click",o.current),o.current=g,t.addEventListener("click",o.current,{once:!0})):g()}else t.removeEventListener("click",o.current);n.current=!1},d=window.setTimeout(()=>{t.addEventListener("pointerdown",l)},0);return()=>{window.clearTimeout(d),t.removeEventListener("pointerdown",l),t.removeEventListener("click",o.current)}},[t,r]),{onPointerDownCapture:()=>n.current=!0}}function Pge(e,t=globalThis==null?void 0:globalThis.document){const r=Io(e),n=W.useRef(!1);return W.useEffect(()=>{const o=l=>{l.target&&!n.current&&kY(Ege,r,{originalEvent:l},{discrete:!1})};return t.addEventListener("focusin",o),()=>t.removeEventListener("focusin",o)},[t,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function xq(){const e=new CustomEvent(TL);document.dispatchEvent(e)}function kY(e,t,r,{discrete:n}){const o=r.originalEvent.target,l=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&o.addEventListener(e,t,{once:!0}),n?uB(o,l):o.dispatchEvent(l)}var Cge=Pv,Oge=OY,Ro=globalThis!=null&&globalThis.document?W.useLayoutEffect:()=>{},kge="Portal",bb=W.forwardRef((e,t)=>{var i;const{container:r,...n}=e,[o,l]=W.useState(!1);Ro(()=>l(!0),[]);const d=r||o&&((i=globalThis==null?void 0:globalThis.document)==null?void 0:i.body);return d?EY.createPortal(m.jsx(wn.div,{...n,ref:t}),d):null});bb.displayName=kge;function Ige(e,t){return W.useReducer((r,n)=>t[r][n]??r,e)}var _s=e=>{const{present:t,children:r}=e,n=Rge(t),o=typeof r=="function"?r({present:n.isPresent}):W.Children.only(r),l=fi(n.ref,jge(o));return typeof r=="function"||n.isPresent?W.cloneElement(o,{ref:l}):null};_s.displayName="Presence";function Rge(e){const[t,r]=W.useState(),n=W.useRef(null),o=W.useRef(e),l=W.useRef("none"),d=e?"mounted":"unmounted",[i,g]=Ige(d,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return W.useEffect(()=>{const _=_P(n.current);l.current=i==="mounted"?_:"none"},[i]),Ro(()=>{const _=n.current,S=o.current;if(S!==e){const T=l.current,C=_P(_);e?g("MOUNT"):C==="none"||(_==null?void 0:_.display)==="none"?g("UNMOUNT"):g(S&&T!==C?"ANIMATION_OUT":"UNMOUNT"),o.current=e}},[e,g]),Ro(()=>{if(t){let _;const S=t.ownerDocument.defaultView??window,E=C=>{const I=_P(n.current).includes(C.animationName);if(C.target===t&&I&&(g("ANIMATION_END"),!o.current)){const j=t.style.animationFillMode;t.style.animationFillMode="forwards",_=S.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=j)})}},T=C=>{C.target===t&&(l.current=_P(n.current))};return t.addEventListener("animationstart",T),t.addEventListener("animationcancel",E),t.addEventListener("animationend",E),()=>{S.clearTimeout(_),t.removeEventListener("animationstart",T),t.removeEventListener("animationcancel",E),t.removeEventListener("animationend",E)}}else g("ANIMATION_END")},[t,g]),{isPresent:["mounted","unmountSuspended"].includes(i),ref:W.useCallback(_=>{n.current=_?getComputedStyle(_):null,r(_)},[])}}function _P(e){return(e==null?void 0:e.animationName)||"none"}function jge(e){var n,o;let t=(n=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:n.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(o=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:o.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var Nge=_z[" useInsertionEffect ".trim().toString()]||Ro;function Ru({prop:e,defaultProp:t,onChange:r=()=>{},caller:n}){const[o,l,d]=Mge({defaultProp:t,onChange:r}),i=e!==void 0,g=i?e:o;{const S=W.useRef(e!==void 0);W.useEffect(()=>{const E=S.current;E!==i&&console.warn(`${n} is changing from ${E?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),S.current=i},[i,n])}const _=W.useCallback(S=>{var E;if(i){const T=Dge(S)?S(e):S;T!==e&&((E=d.current)==null||E.call(d,T))}else l(S)},[i,e,l,d]);return[g,_]}function Mge({defaultProp:e,onChange:t}){const[r,n]=W.useState(e),o=W.useRef(r),l=W.useRef(t);return Nge(()=>{l.current=t},[t]),W.useEffect(()=>{var d;o.current!==r&&((d=l.current)==null||d.call(l,r),o.current=r)},[r,o]),[r,n,l]}function Dge(e){return typeof e=="function"}var IY=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Lge="VisuallyHidden",iI=W.forwardRef((e,t)=>m.jsx(wn.span,{...e,ref:t,style:{...IY,...e.style}}));iI.displayName=Lge;var Fge=iI,dB="ToastProvider",[hB,zge,Bge]=nI("Toast"),[RY,Let]=Zs("Toast",[Bge]),[$ge,aI]=RY(dB),jY=e=>{const{__scopeToast:t,label:r="Notification",duration:n=5e3,swipeDirection:o="right",swipeThreshold:l=50,children:d}=e,[i,g]=W.useState(null),[_,S]=W.useState(0),E=W.useRef(!1),T=W.useRef(!1);return r.trim()||console.error(`Invalid prop \`label\` supplied to \`${dB}\`. Expected non-empty \`string\`.`),m.jsx(hB.Provider,{scope:t,children:m.jsx($ge,{scope:t,label:r,duration:n,swipeDirection:o,swipeThreshold:l,toastCount:_,viewport:i,onViewportChange:g,onToastAdd:W.useCallback(()=>S(C=>C+1),[]),onToastRemove:W.useCallback(()=>S(C=>C-1),[]),isFocusedToastEscapeKeyDownRef:E,isClosePausedRef:T,children:d})})};jY.displayName=dB;var NY="ToastViewport",Uge=["F8"],AL="toast.viewportPause",PL="toast.viewportResume",MY=W.forwardRef((e,t)=>{const{__scopeToast:r,hotkey:n=Uge,label:o="Notifications ({hotkey})",...l}=e,d=aI(NY,r),i=zge(r),g=W.useRef(null),_=W.useRef(null),S=W.useRef(null),E=W.useRef(null),T=fi(t,E,d.onViewportChange),C=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),N=d.toastCount>0;W.useEffect(()=>{const j=D=>{var F;n.length!==0&&n.every(B=>D[B]||D.code===B)&&((F=E.current)==null||F.focus())};return document.addEventListener("keydown",j),()=>document.removeEventListener("keydown",j)},[n]),W.useEffect(()=>{const j=g.current,D=E.current;if(N&&j&&D){const R=()=>{if(!d.isClosePausedRef.current){const Z=new CustomEvent(AL);D.dispatchEvent(Z),d.isClosePausedRef.current=!0}},F=()=>{if(d.isClosePausedRef.current){const Z=new CustomEvent(PL);D.dispatchEvent(Z),d.isClosePausedRef.current=!1}},B=Z=>{!j.contains(Z.relatedTarget)&&F()},U=()=>{j.contains(document.activeElement)||F()};return j.addEventListener("focusin",R),j.addEventListener("focusout",B),j.addEventListener("pointermove",R),j.addEventListener("pointerleave",U),window.addEventListener("blur",R),window.addEventListener("focus",F),()=>{j.removeEventListener("focusin",R),j.removeEventListener("focusout",B),j.removeEventListener("pointermove",R),j.removeEventListener("pointerleave",U),window.removeEventListener("blur",R),window.removeEventListener("focus",F)}}},[N,d.isClosePausedRef]);const I=W.useCallback(({tabbingDirection:j})=>{const R=i().map(F=>{const B=F.ref.current,U=[B,...tye(B)];return j==="forwards"?U:U.reverse()});return(j==="forwards"?R.reverse():R).flat()},[i]);return W.useEffect(()=>{const j=E.current;if(j){const D=R=>{var U,Z,J;const F=R.altKey||R.ctrlKey||R.metaKey;if(R.key==="Tab"&&!F){const te=document.activeElement,ae=R.shiftKey;if(R.target===j&&ae){(U=_.current)==null||U.focus();return}const ee=I({tabbingDirection:ae?"backwards":"forwards"}),oe=ee.findIndex(de=>de===te);SM(ee.slice(oe+1))?R.preventDefault():ae?(Z=_.current)==null||Z.focus():(J=S.current)==null||J.focus()}};return j.addEventListener("keydown",D),()=>j.removeEventListener("keydown",D)}},[i,I]),m.jsxs(Oge,{ref:g,role:"region","aria-label":o.replace("{hotkey}",C),tabIndex:-1,style:{pointerEvents:N?void 0:"none"},children:[N&&m.jsx(CL,{ref:_,onFocusFromOutsideViewport:()=>{const j=I({tabbingDirection:"forwards"});SM(j)}}),m.jsx(hB.Slot,{scope:r,children:m.jsx(wn.ol,{tabIndex:-1,...l,ref:T})}),N&&m.jsx(CL,{ref:S,onFocusFromOutsideViewport:()=>{const j=I({tabbingDirection:"backwards"});SM(j)}})]})});MY.displayName=NY;var DY="ToastFocusProxy",CL=W.forwardRef((e,t)=>{const{__scopeToast:r,onFocusFromOutsideViewport:n,...o}=e,l=aI(DY,r);return m.jsx(iI,{"aria-hidden":!0,tabIndex:0,...o,ref:t,style:{position:"fixed"},onFocus:d=>{var _;const i=d.relatedTarget;!((_=l.viewport)!=null&&_.contains(i))&&n()}})});CL.displayName=DY;var kT="Toast",Vge="toast.swipeStart",qge="toast.swipeMove",Wge="toast.swipeCancel",Gge="toast.swipeEnd",LY=W.forwardRef((e,t)=>{const{forceMount:r,open:n,defaultOpen:o,onOpenChange:l,...d}=e,[i,g]=Ru({prop:n,defaultProp:o??!0,onChange:l,caller:kT});return m.jsx(_s,{present:r||i,children:m.jsx(Zge,{open:i,...d,ref:t,onClose:()=>g(!1),onPause:Io(e.onPause),onResume:Io(e.onResume),onSwipeStart:Rr(e.onSwipeStart,_=>{_.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Rr(e.onSwipeMove,_=>{const{x:S,y:E}=_.detail.delta;_.currentTarget.setAttribute("data-swipe","move"),_.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${S}px`),_.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${E}px`)}),onSwipeCancel:Rr(e.onSwipeCancel,_=>{_.currentTarget.setAttribute("data-swipe","cancel"),_.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),_.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),_.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),_.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Rr(e.onSwipeEnd,_=>{const{x:S,y:E}=_.detail.delta;_.currentTarget.setAttribute("data-swipe","end"),_.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),_.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),_.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${S}px`),_.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${E}px`),g(!1)})})})});LY.displayName=kT;var[Hge,Kge]=RY(kT,{onClose(){}}),Zge=W.forwardRef((e,t)=>{const{__scopeToast:r,type:n="foreground",duration:o,open:l,onClose:d,onEscapeKeyDown:i,onPause:g,onResume:_,onSwipeStart:S,onSwipeMove:E,onSwipeCancel:T,onSwipeEnd:C,...N}=e,I=aI(kT,r),[j,D]=W.useState(null),R=fi(t,de=>D(de)),F=W.useRef(null),B=W.useRef(null),U=o||I.duration,Z=W.useRef(0),J=W.useRef(U),te=W.useRef(0),{onToastAdd:ae,onToastRemove:ne}=I,ie=Io(()=>{var xe;(j==null?void 0:j.contains(document.activeElement))&&((xe=I.viewport)==null||xe.focus()),d()}),ee=W.useCallback(de=>{!de||de===1/0||(window.clearTimeout(te.current),Z.current=new Date().getTime(),te.current=window.setTimeout(ie,de))},[ie]);W.useEffect(()=>{const de=I.viewport;if(de){const xe=()=>{ee(J.current),_==null||_()},we=()=>{const Ae=new Date().getTime()-Z.current;J.current=J.current-Ae,window.clearTimeout(te.current),g==null||g()};return de.addEventListener(AL,we),de.addEventListener(PL,xe),()=>{de.removeEventListener(AL,we),de.removeEventListener(PL,xe)}}},[I.viewport,U,g,_,ee]),W.useEffect(()=>{l&&!I.isClosePausedRef.current&&ee(U)},[l,U,I.isClosePausedRef,ee]),W.useEffect(()=>(ae(),()=>ne()),[ae,ne]);const oe=W.useMemo(()=>j?qY(j):null,[j]);return I.viewport?m.jsxs(m.Fragment,{children:[oe&&m.jsx(Xge,{__scopeToast:r,role:"status","aria-live":n==="foreground"?"assertive":"polite","aria-atomic":!0,children:oe}),m.jsx(Hge,{scope:r,onClose:ie,children:tg.createPortal(m.jsx(hB.ItemSlot,{scope:r,children:m.jsx(Cge,{asChild:!0,onEscapeKeyDown:Rr(i,()=>{I.isFocusedToastEscapeKeyDownRef.current||ie(),I.isFocusedToastEscapeKeyDownRef.current=!1}),children:m.jsx(wn.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":l?"open":"closed","data-swipe-direction":I.swipeDirection,...N,ref:R,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Rr(e.onKeyDown,de=>{de.key==="Escape"&&(i==null||i(de.nativeEvent),de.nativeEvent.defaultPrevented||(I.isFocusedToastEscapeKeyDownRef.current=!0,ie()))}),onPointerDown:Rr(e.onPointerDown,de=>{de.button===0&&(F.current={x:de.clientX,y:de.clientY})}),onPointerMove:Rr(e.onPointerMove,de=>{if(!F.current)return;const xe=de.clientX-F.current.x,we=de.clientY-F.current.y,Ae=!!B.current,Ce=["left","right"].includes(I.swipeDirection),me=["left","up"].includes(I.swipeDirection)?Math.min:Math.max,Pe=Ce?me(0,xe):0,ye=Ce?0:me(0,we),pe=de.pointerType==="touch"?10:2,Ie={x:Pe,y:ye},tt={originalEvent:de,delta:Ie};Ae?(B.current=Ie,xP(qge,E,tt,{discrete:!1})):bq(Ie,I.swipeDirection,pe)?(B.current=Ie,xP(Vge,S,tt,{discrete:!1}),de.target.setPointerCapture(de.pointerId)):(Math.abs(xe)>pe||Math.abs(we)>pe)&&(F.current=null)}),onPointerUp:Rr(e.onPointerUp,de=>{const xe=B.current,we=de.target;if(we.hasPointerCapture(de.pointerId)&&we.releasePointerCapture(de.pointerId),B.current=null,F.current=null,xe){const Ae=de.currentTarget,Ce={originalEvent:de,delta:xe};bq(xe,I.swipeDirection,I.swipeThreshold)?xP(Gge,C,Ce,{discrete:!0}):xP(Wge,T,Ce,{discrete:!0}),Ae.addEventListener("click",me=>me.preventDefault(),{once:!0})}})})})}),I.viewport)})]}):null}),Xge=e=>{const{__scopeToast:t,children:r,...n}=e,o=aI(kT,t),[l,d]=W.useState(!1),[i,g]=W.useState(!1);return Qge(()=>d(!0)),W.useEffect(()=>{const _=window.setTimeout(()=>g(!0),1e3);return()=>window.clearTimeout(_)},[]),i?null:m.jsx(bb,{asChild:!0,children:m.jsx(iI,{...n,children:l&&m.jsxs(m.Fragment,{children:[o.label," ",r]})})})},Yge="ToastTitle",FY=W.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return m.jsx(wn.div,{...n,ref:t})});FY.displayName=Yge;var Jge="ToastDescription",zY=W.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return m.jsx(wn.div,{...n,ref:t})});zY.displayName=Jge;var BY="ToastAction",$Y=W.forwardRef((e,t)=>{const{altText:r,...n}=e;return r.trim()?m.jsx(VY,{altText:r,asChild:!0,children:m.jsx(fB,{...n,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${BY}\`. Expected non-empty \`string\`.`),null)});$Y.displayName=BY;var UY="ToastClose",fB=W.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e,o=Kge(UY,r);return m.jsx(VY,{asChild:!0,children:m.jsx(wn.button,{type:"button",...n,ref:t,onClick:Rr(e.onClick,o.onClose)})})});fB.displayName=UY;var VY=W.forwardRef((e,t)=>{const{__scopeToast:r,altText:n,...o}=e;return m.jsx(wn.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...o,ref:t})});function qY(e){const t=[];return Array.from(e.childNodes).forEach(n=>{if(n.nodeType===n.TEXT_NODE&&n.textContent&&t.push(n.textContent),eye(n)){const o=n.ariaHidden||n.hidden||n.style.display==="none",l=n.dataset.radixToastAnnounceExclude==="";if(!o)if(l){const d=n.dataset.radixToastAnnounceAlt;d&&t.push(d)}else t.push(...qY(n))}}),t}function xP(e,t,r,{discrete:n}){const o=r.originalEvent.currentTarget,l=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r});t&&o.addEventListener(e,t,{once:!0}),n?uB(o,l):o.dispatchEvent(l)}var bq=(e,t,r=0)=>{const n=Math.abs(e.x),o=Math.abs(e.y),l=n>o;return t==="left"||t==="right"?l&&n>r:!l&&o>r};function Qge(e=()=>{}){const t=Io(e);Ro(()=>{let r=0,n=0;return r=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(r),window.cancelAnimationFrame(n)}},[t])}function eye(e){return e.nodeType===e.ELEMENT_NODE}function tye(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const o=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||o?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function SM(e){const t=document.activeElement;return e.some(r=>r===t?!0:(r.focus(),document.activeElement!==t))}var rye=jY,WY=MY,GY=LY,HY=FY,KY=zY,ZY=$Y,XY=fB;function YY(e){var t,r,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(r=YY(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}function Ti(){for(var e,t,r=0,n="",o=arguments.length;r<o;r++)(e=arguments[r])&&(t=YY(e))&&(n&&(n+=" "),n+=t);return n}const wq=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,Sq=Ti,wb=(e,t)=>r=>{var n;if((t==null?void 0:t.variants)==null)return Sq(e,r==null?void 0:r.class,r==null?void 0:r.className);const{variants:o,defaultVariants:l}=t,d=Object.keys(o).map(_=>{const S=r==null?void 0:r[_],E=l==null?void 0:l[_];if(S===null)return null;const T=wq(S)||wq(E);return o[_][T]}),i=r&&Object.entries(r).reduce((_,S)=>{let[E,T]=S;return T===void 0||(_[E]=T),_},{}),g=t==null||(n=t.compoundVariants)===null||n===void 0?void 0:n.reduce((_,S)=>{let{class:E,className:T,...C}=S;return Object.entries(C).every(N=>{let[I,j]=N;return Array.isArray(j)?j.includes({...l,...i}[I]):{...l,...i}[I]===j})?[..._,E,T]:_},[]);return Sq(e,d,g,r==null?void 0:r.class,r==null?void 0:r.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nye=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),JY=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var iye={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aye=W.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:o="",children:l,iconNode:d,...i},g)=>W.createElement("svg",{ref:g,...iye,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:JY("lucide",o),...i},[...d.map(([_,S])=>W.createElement(_,S)),...Array.isArray(l)?l:[l]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cn=(e,t)=>{const r=W.forwardRef(({className:n,...o},l)=>W.createElement(aye,{ref:l,iconNode:t,className:JY(`lucide-${nye(e)}`,n),...o}));return r.displayName=`${e}`,r};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oye=cn("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sye=cn("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lye=cn("BellRing",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QY=cn("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bP=cn("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cye=cn("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sc=cn("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uye=cn("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dye=cn("ChartPie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hye=cn("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Af=cn("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ev=cn("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oI=cn("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pB=cn("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fye=cn("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pye=cn("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mye=cn("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gye=cn("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yye=cn("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vye=cn("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IT=cn("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OL=cn("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _ye=cn("Dot",[["circle",{cx:"12.1",cy:"12.1",r:"1",key:"18d7e5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sI=cn("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mB=cn("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eq=cn("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xye=cn("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gB=cn("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fC=cn("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C0=cn("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yB=cn("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tq=cn("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bye=cn("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eJ=cn("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tJ=cn("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=cn("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wye=cn("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aq=cn("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rJ=cn("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=cn("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nJ=cn("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sye=cn("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iJ=cn("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const im=cn("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vB=cn("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eye=cn("Minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uh=cn("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tye=cn("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RT=cn("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aye=cn("Pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _B=cn("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pye=cn("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cv=cn("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cye=cn("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ch=cn("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lI=cn("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fc=cn("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oye=cn("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xB=cn("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ec=cn("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=cn("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sb=cn("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aJ=cn("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O0=cn("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oJ=cn("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KS=cn("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EM=cn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _u=cn("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sJ=cn("UtensilsCrossed",[["path",{d:"m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8",key:"n7qcjb"}],["path",{d:"M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7",key:"d0u48b"}],["path",{d:"m2.1 21.8 6.4-6.3",key:"yn04lh"}],["path",{d:"m19 5-7 7",key:"194lzd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kye=cn("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ju=cn("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),bB="-",Iye=e=>{const t=jye(e),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=e;return{getClassGroupId:d=>{const i=d.split(bB);return i[0]===""&&i.length!==1&&i.shift(),lJ(i,t)||Rye(d)},getConflictingClassGroupIds:(d,i)=>{const g=r[d]||[];return i&&n[d]?[...g,...n[d]]:g}}},lJ=(e,t)=>{var d;if(e.length===0)return t.classGroupId;const r=e[0],n=t.nextPart.get(r),o=n?lJ(e.slice(1),n):void 0;if(o)return o;if(t.validators.length===0)return;const l=e.join(bB);return(d=t.validators.find(({validator:i})=>i(l)))==null?void 0:d.classGroupId},Pq=/^\[(.+)\]$/,Rye=e=>{if(Pq.test(e)){const t=Pq.exec(e)[1],r=t==null?void 0:t.substring(0,t.indexOf(":"));if(r)return"arbitrary.."+r}},jye=e=>{const{theme:t,prefix:r}=e,n={nextPart:new Map,validators:[]};return Mye(Object.entries(e.classGroups),r).forEach(([l,d])=>{kL(d,n,l,t)}),n},kL=(e,t,r,n)=>{e.forEach(o=>{if(typeof o=="string"){const l=o===""?t:Cq(t,o);l.classGroupId=r;return}if(typeof o=="function"){if(Nye(o)){kL(o(n),t,r,n);return}t.validators.push({validator:o,classGroupId:r});return}Object.entries(o).forEach(([l,d])=>{kL(d,Cq(t,l),r,n)})})},Cq=(e,t)=>{let r=e;return t.split(bB).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},Nye=e=>e.isThemeGetter,Mye=(e,t)=>t?e.map(([r,n])=>{const o=n.map(l=>typeof l=="string"?t+l:typeof l=="object"?Object.fromEntries(Object.entries(l).map(([d,i])=>[t+d,i])):l);return[r,o]}):e,Dye=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,r=new Map,n=new Map;const o=(l,d)=>{r.set(l,d),t++,t>e&&(t=0,n=r,r=new Map)};return{get(l){let d=r.get(l);if(d!==void 0)return d;if((d=n.get(l))!==void 0)return o(l,d),d},set(l,d){r.has(l)?r.set(l,d):o(l,d)}}},cJ="!",Lye=e=>{const{separator:t,experimentalParseClassName:r}=e,n=t.length===1,o=t[0],l=t.length,d=i=>{const g=[];let _=0,S=0,E;for(let j=0;j<i.length;j++){let D=i[j];if(_===0){if(D===o&&(n||i.slice(j,j+l)===t)){g.push(i.slice(S,j)),S=j+l;continue}if(D==="/"){E=j;continue}}D==="["?_++:D==="]"&&_--}const T=g.length===0?i:i.substring(S),C=T.startsWith(cJ),N=C?T.substring(1):T,I=E&&E>S?E-S:void 0;return{modifiers:g,hasImportantModifier:C,baseClassName:N,maybePostfixModifierPosition:I}};return r?i=>r({className:i,parseClassName:d}):d},Fye=e=>{if(e.length<=1)return e;const t=[];let r=[];return e.forEach(n=>{n[0]==="["?(t.push(...r.sort(),n),r=[]):r.push(n)}),t.push(...r.sort()),t},zye=e=>({cache:Dye(e.cacheSize),parseClassName:Lye(e),...Iye(e)}),Bye=/\s+/,$ye=(e,t)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:o}=t,l=[],d=e.trim().split(Bye);let i="";for(let g=d.length-1;g>=0;g-=1){const _=d[g],{modifiers:S,hasImportantModifier:E,baseClassName:T,maybePostfixModifierPosition:C}=r(_);let N=!!C,I=n(N?T.substring(0,C):T);if(!I){if(!N){i=_+(i.length>0?" "+i:i);continue}if(I=n(T),!I){i=_+(i.length>0?" "+i:i);continue}N=!1}const j=Fye(S).join(":"),D=E?j+cJ:j,R=D+I;if(l.includes(R))continue;l.push(R);const F=o(I,N);for(let B=0;B<F.length;++B){const U=F[B];l.push(D+U)}i=_+(i.length>0?" "+i:i)}return i};function Uye(){let e=0,t,r,n="";for(;e<arguments.length;)(t=arguments[e++])&&(r=uJ(t))&&(n&&(n+=" "),n+=r);return n}const uJ=e=>{if(typeof e=="string")return e;let t,r="";for(let n=0;n<e.length;n++)e[n]&&(t=uJ(e[n]))&&(r&&(r+=" "),r+=t);return r};function Vye(e,...t){let r,n,o,l=d;function d(g){const _=t.reduce((S,E)=>E(S),e());return r=zye(_),n=r.cache.get,o=r.cache.set,l=i,i(g)}function i(g){const _=n(g);if(_)return _;const S=$ye(g,r);return o(g,S),S}return function(){return l(Uye.apply(null,arguments))}}const ro=e=>{const t=r=>r[e]||[];return t.isThemeGetter=!0,t},dJ=/^\[(?:([a-z-]+):)?(.+)\]$/i,qye=/^\d+\/\d+$/,Wye=new Set(["px","full","screen"]),Gye=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Hye=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Kye=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Zye=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Xye=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,lf=e=>Qx(e)||Wye.has(e)||qye.test(e),Up=e=>Eb(e,"length",ive),Qx=e=>!!e&&!Number.isNaN(Number(e)),TM=e=>Eb(e,"number",Qx),aS=e=>!!e&&Number.isInteger(Number(e)),Yye=e=>e.endsWith("%")&&Qx(e.slice(0,-1)),ki=e=>dJ.test(e),Vp=e=>Gye.test(e),Jye=new Set(["length","size","percentage"]),Qye=e=>Eb(e,Jye,hJ),eve=e=>Eb(e,"position",hJ),tve=new Set(["image","url"]),rve=e=>Eb(e,tve,ove),nve=e=>Eb(e,"",ave),oS=()=>!0,Eb=(e,t,r)=>{const n=dJ.exec(e);return n?n[1]?typeof t=="string"?n[1]===t:t.has(n[1]):r(n[2]):!1},ive=e=>Hye.test(e)&&!Kye.test(e),hJ=()=>!1,ave=e=>Zye.test(e),ove=e=>Xye.test(e),sve=()=>{const e=ro("colors"),t=ro("spacing"),r=ro("blur"),n=ro("brightness"),o=ro("borderColor"),l=ro("borderRadius"),d=ro("borderSpacing"),i=ro("borderWidth"),g=ro("contrast"),_=ro("grayscale"),S=ro("hueRotate"),E=ro("invert"),T=ro("gap"),C=ro("gradientColorStops"),N=ro("gradientColorStopPositions"),I=ro("inset"),j=ro("margin"),D=ro("opacity"),R=ro("padding"),F=ro("saturate"),B=ro("scale"),U=ro("sepia"),Z=ro("skew"),J=ro("space"),te=ro("translate"),ae=()=>["auto","contain","none"],ne=()=>["auto","hidden","clip","visible","scroll"],ie=()=>["auto",ki,t],ee=()=>[ki,t],oe=()=>["",lf,Up],de=()=>["auto",Qx,ki],xe=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],we=()=>["solid","dashed","dotted","double","none"],Ae=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ce=()=>["start","end","center","between","around","evenly","stretch"],me=()=>["","0",ki],Pe=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ye=()=>[Qx,ki];return{cacheSize:500,separator:":",theme:{colors:[oS],spacing:[lf,Up],blur:["none","",Vp,ki],brightness:ye(),borderColor:[e],borderRadius:["none","","full",Vp,ki],borderSpacing:ee(),borderWidth:oe(),contrast:ye(),grayscale:me(),hueRotate:ye(),invert:me(),gap:ee(),gradientColorStops:[e],gradientColorStopPositions:[Yye,Up],inset:ie(),margin:ie(),opacity:ye(),padding:ee(),saturate:ye(),scale:ye(),sepia:me(),skew:ye(),space:ee(),translate:ee()},classGroups:{aspect:[{aspect:["auto","square","video",ki]}],container:["container"],columns:[{columns:[Vp]}],"break-after":[{"break-after":Pe()}],"break-before":[{"break-before":Pe()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...xe(),ki]}],overflow:[{overflow:ne()}],"overflow-x":[{"overflow-x":ne()}],"overflow-y":[{"overflow-y":ne()}],overscroll:[{overscroll:ae()}],"overscroll-x":[{"overscroll-x":ae()}],"overscroll-y":[{"overscroll-y":ae()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[I]}],"inset-x":[{"inset-x":[I]}],"inset-y":[{"inset-y":[I]}],start:[{start:[I]}],end:[{end:[I]}],top:[{top:[I]}],right:[{right:[I]}],bottom:[{bottom:[I]}],left:[{left:[I]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",aS,ki]}],basis:[{basis:ie()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ki]}],grow:[{grow:me()}],shrink:[{shrink:me()}],order:[{order:["first","last","none",aS,ki]}],"grid-cols":[{"grid-cols":[oS]}],"col-start-end":[{col:["auto",{span:["full",aS,ki]},ki]}],"col-start":[{"col-start":de()}],"col-end":[{"col-end":de()}],"grid-rows":[{"grid-rows":[oS]}],"row-start-end":[{row:["auto",{span:[aS,ki]},ki]}],"row-start":[{"row-start":de()}],"row-end":[{"row-end":de()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ki]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ki]}],gap:[{gap:[T]}],"gap-x":[{"gap-x":[T]}],"gap-y":[{"gap-y":[T]}],"justify-content":[{justify:["normal",...Ce()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Ce(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Ce(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[R]}],px:[{px:[R]}],py:[{py:[R]}],ps:[{ps:[R]}],pe:[{pe:[R]}],pt:[{pt:[R]}],pr:[{pr:[R]}],pb:[{pb:[R]}],pl:[{pl:[R]}],m:[{m:[j]}],mx:[{mx:[j]}],my:[{my:[j]}],ms:[{ms:[j]}],me:[{me:[j]}],mt:[{mt:[j]}],mr:[{mr:[j]}],mb:[{mb:[j]}],ml:[{ml:[j]}],"space-x":[{"space-x":[J]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[J]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",ki,t]}],"min-w":[{"min-w":[ki,t,"min","max","fit"]}],"max-w":[{"max-w":[ki,t,"none","full","min","max","fit","prose",{screen:[Vp]},Vp]}],h:[{h:[ki,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[ki,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[ki,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[ki,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Vp,Up]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",TM]}],"font-family":[{font:[oS]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ki]}],"line-clamp":[{"line-clamp":["none",Qx,TM]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",lf,ki]}],"list-image":[{"list-image":["none",ki]}],"list-style-type":[{list:["none","disc","decimal",ki]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[D]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[D]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...we(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",lf,Up]}],"underline-offset":[{"underline-offset":["auto",lf,ki]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:ee()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ki]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ki]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[D]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...xe(),eve]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Qye]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},rve]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[N]}],"gradient-via-pos":[{via:[N]}],"gradient-to-pos":[{to:[N]}],"gradient-from":[{from:[C]}],"gradient-via":[{via:[C]}],"gradient-to":[{to:[C]}],rounded:[{rounded:[l]}],"rounded-s":[{"rounded-s":[l]}],"rounded-e":[{"rounded-e":[l]}],"rounded-t":[{"rounded-t":[l]}],"rounded-r":[{"rounded-r":[l]}],"rounded-b":[{"rounded-b":[l]}],"rounded-l":[{"rounded-l":[l]}],"rounded-ss":[{"rounded-ss":[l]}],"rounded-se":[{"rounded-se":[l]}],"rounded-ee":[{"rounded-ee":[l]}],"rounded-es":[{"rounded-es":[l]}],"rounded-tl":[{"rounded-tl":[l]}],"rounded-tr":[{"rounded-tr":[l]}],"rounded-br":[{"rounded-br":[l]}],"rounded-bl":[{"rounded-bl":[l]}],"border-w":[{border:[i]}],"border-w-x":[{"border-x":[i]}],"border-w-y":[{"border-y":[i]}],"border-w-s":[{"border-s":[i]}],"border-w-e":[{"border-e":[i]}],"border-w-t":[{"border-t":[i]}],"border-w-r":[{"border-r":[i]}],"border-w-b":[{"border-b":[i]}],"border-w-l":[{"border-l":[i]}],"border-opacity":[{"border-opacity":[D]}],"border-style":[{border:[...we(),"hidden"]}],"divide-x":[{"divide-x":[i]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[i]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[D]}],"divide-style":[{divide:we()}],"border-color":[{border:[o]}],"border-color-x":[{"border-x":[o]}],"border-color-y":[{"border-y":[o]}],"border-color-s":[{"border-s":[o]}],"border-color-e":[{"border-e":[o]}],"border-color-t":[{"border-t":[o]}],"border-color-r":[{"border-r":[o]}],"border-color-b":[{"border-b":[o]}],"border-color-l":[{"border-l":[o]}],"divide-color":[{divide:[o]}],"outline-style":[{outline:["",...we()]}],"outline-offset":[{"outline-offset":[lf,ki]}],"outline-w":[{outline:[lf,Up]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:oe()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[D]}],"ring-offset-w":[{"ring-offset":[lf,Up]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",Vp,nve]}],"shadow-color":[{shadow:[oS]}],opacity:[{opacity:[D]}],"mix-blend":[{"mix-blend":[...Ae(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Ae()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[g]}],"drop-shadow":[{"drop-shadow":["","none",Vp,ki]}],grayscale:[{grayscale:[_]}],"hue-rotate":[{"hue-rotate":[S]}],invert:[{invert:[E]}],saturate:[{saturate:[F]}],sepia:[{sepia:[U]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[g]}],"backdrop-grayscale":[{"backdrop-grayscale":[_]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[S]}],"backdrop-invert":[{"backdrop-invert":[E]}],"backdrop-opacity":[{"backdrop-opacity":[D]}],"backdrop-saturate":[{"backdrop-saturate":[F]}],"backdrop-sepia":[{"backdrop-sepia":[U]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[d]}],"border-spacing-x":[{"border-spacing-x":[d]}],"border-spacing-y":[{"border-spacing-y":[d]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ki]}],duration:[{duration:ye()}],ease:[{ease:["linear","in","out","in-out",ki]}],delay:[{delay:ye()}],animate:[{animate:["none","spin","ping","pulse","bounce",ki]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[B]}],"scale-x":[{"scale-x":[B]}],"scale-y":[{"scale-y":[B]}],rotate:[{rotate:[aS,ki]}],"translate-x":[{"translate-x":[te]}],"translate-y":[{"translate-y":[te]}],"skew-x":[{"skew-x":[Z]}],"skew-y":[{"skew-y":[Z]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ki]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ki]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":ee()}],"scroll-mx":[{"scroll-mx":ee()}],"scroll-my":[{"scroll-my":ee()}],"scroll-ms":[{"scroll-ms":ee()}],"scroll-me":[{"scroll-me":ee()}],"scroll-mt":[{"scroll-mt":ee()}],"scroll-mr":[{"scroll-mr":ee()}],"scroll-mb":[{"scroll-mb":ee()}],"scroll-ml":[{"scroll-ml":ee()}],"scroll-p":[{"scroll-p":ee()}],"scroll-px":[{"scroll-px":ee()}],"scroll-py":[{"scroll-py":ee()}],"scroll-ps":[{"scroll-ps":ee()}],"scroll-pe":[{"scroll-pe":ee()}],"scroll-pt":[{"scroll-pt":ee()}],"scroll-pr":[{"scroll-pr":ee()}],"scroll-pb":[{"scroll-pb":ee()}],"scroll-pl":[{"scroll-pl":ee()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ki]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[lf,Up,TM]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},lve=Vye(sve);function yr(...e){return lve(Ti(e))}const cve=rye,fJ=W.forwardRef(({className:e,...t},r)=>m.jsx(WY,{ref:r,className:yr("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));fJ.displayName=WY.displayName;const uve=wb("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),pJ=W.forwardRef(({className:e,variant:t,...r},n)=>m.jsx(GY,{ref:n,className:yr(uve({variant:t}),e),...r}));pJ.displayName=GY.displayName;const dve=W.forwardRef(({className:e,...t},r)=>m.jsx(ZY,{ref:r,className:yr("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...t}));dve.displayName=ZY.displayName;const mJ=W.forwardRef(({className:e,...t},r)=>m.jsx(XY,{ref:r,className:yr("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:m.jsx(ju,{className:"h-4 w-4"})}));mJ.displayName=XY.displayName;const gJ=W.forwardRef(({className:e,...t},r)=>m.jsx(HY,{ref:r,className:yr("text-sm font-semibold",e),...t}));gJ.displayName=HY.displayName;const yJ=W.forwardRef(({className:e,...t},r)=>m.jsx(KY,{ref:r,className:yr("text-sm opacity-90",e),...t}));yJ.displayName=KY.displayName;function hve(){const{toasts:e}=Sa();return m.jsxs(cve,{children:[e.map(function({id:t,title:r,description:n,action:o,...l}){return m.jsxs(pJ,{...l,children:[m.jsxs("div",{className:"grid gap-1",children:[r&&m.jsx(gJ,{children:r}),n&&m.jsx(yJ,{children:n})]}),o,m.jsx(mJ,{})]},t)}),m.jsx(fJ,{})]})}var Oq=["light","dark"],fve="(prefers-color-scheme: dark)",pve=W.createContext(void 0),mve={setTheme:e=>{},themes:[]},gve=()=>{var e;return(e=W.useContext(pve))!=null?e:mve};W.memo(({forcedTheme:e,storageKey:t,attribute:r,enableSystem:n,enableColorScheme:o,defaultTheme:l,value:d,attrs:i,nonce:g})=>{let _=l==="system",S=r==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${i.map(N=>`'${N}'`).join(",")})`};`:`var d=document.documentElement,n='${r}',s='setAttribute';`,E=o?Oq.includes(l)&&l?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${l}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",T=(N,I=!1,j=!0)=>{let D=d?d[N]:N,R=I?N+"|| ''":`'${D}'`,F="";return o&&j&&!I&&Oq.includes(N)&&(F+=`d.style.colorScheme = '${N}';`),r==="class"?I||D?F+=`c.add(${R})`:F+="null":D&&(F+=`d[s](n,${R})`),F},C=e?`!function(){${S}${T(e)}}()`:n?`!function(){try{${S}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${_})){var t='${fve}',m=window.matchMedia(t);if(m.media!==t||m.matches){${T("dark")}}else{${T("light")}}}else if(e){${d?`var x=${JSON.stringify(d)};`:""}${T(d?"x[e]":"e",!0)}}${_?"":"else{"+T(l,!1,!1)+"}"}${E}}catch(e){}}()`:`!function(){try{${S}var e=localStorage.getItem('${t}');if(e){${d?`var x=${JSON.stringify(d)};`:""}${T(d?"x[e]":"e",!0)}}else{${T(l,!1,!1)};}${E}}catch(t){}}();`;return W.createElement("script",{nonce:g,dangerouslySetInnerHTML:{__html:C}})});var yve=e=>{switch(e){case"success":return xve;case"info":return wve;case"warning":return bve;case"error":return Sve;default:return null}},vve=Array(12).fill(0),_ve=({visible:e,className:t})=>He.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},He.createElement("div",{className:"sonner-spinner"},vve.map((r,n)=>He.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${n}`})))),xve=He.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},He.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),bve=He.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},He.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),wve=He.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},He.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Sve=He.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},He.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Eve=He.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},He.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),He.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Tve=()=>{let[e,t]=He.useState(document.hidden);return He.useEffect(()=>{let r=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",r),()=>window.removeEventListener("visibilitychange",r)},[]),e},IL=1,Ave=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:r,...n}=e,o=typeof(e==null?void 0:e.id)=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:IL++,l=this.toasts.find(i=>i.id===o),d=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(o)&&this.dismissedToasts.delete(o),l?this.toasts=this.toasts.map(i=>i.id===o?(this.publish({...i,...e,id:o,title:r}),{...i,...e,id:o,dismissible:d,title:r}):i):this.addToast({title:r,...n,dismissible:d,id:o}),o},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(t=>{this.subscribers.forEach(r=>r({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let r;t.loading!==void 0&&(r=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let n=e instanceof Promise?e:e(),o=r!==void 0,l,d=n.then(async g=>{if(l=["resolve",g],He.isValidElement(g))o=!1,this.create({id:r,type:"default",message:g});else if(Cve(g)&&!g.ok){o=!1;let _=typeof t.error=="function"?await t.error(`HTTP error! status: ${g.status}`):t.error,S=typeof t.description=="function"?await t.description(`HTTP error! status: ${g.status}`):t.description;this.create({id:r,type:"error",message:_,description:S})}else if(t.success!==void 0){o=!1;let _=typeof t.success=="function"?await t.success(g):t.success,S=typeof t.description=="function"?await t.description(g):t.description;this.create({id:r,type:"success",message:_,description:S})}}).catch(async g=>{if(l=["reject",g],t.error!==void 0){o=!1;let _=typeof t.error=="function"?await t.error(g):t.error,S=typeof t.description=="function"?await t.description(g):t.description;this.create({id:r,type:"error",message:_,description:S})}}).finally(()=>{var g;o&&(this.dismiss(r),r=void 0),(g=t.finally)==null||g.call(t)}),i=()=>new Promise((g,_)=>d.then(()=>l[0]==="reject"?_(l[1]):g(l[1])).catch(_));return typeof r!="string"&&typeof r!="number"?{unwrap:i}:Object.assign(r,{unwrap:i})},this.custom=(e,t)=>{let r=(t==null?void 0:t.id)||IL++;return this.create({jsx:e(r),id:r,...t}),r},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},pc=new Ave,Pve=(e,t)=>{let r=(t==null?void 0:t.id)||IL++;return pc.addToast({title:e,...t,id:r}),r},Cve=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",Ove=Pve,kve=()=>pc.toasts,Ive=()=>pc.getActiveToasts(),Br=Object.assign(Ove,{success:pc.success,info:pc.info,warning:pc.warning,error:pc.error,custom:pc.custom,message:pc.message,promise:pc.promise,dismiss:pc.dismiss,loading:pc.loading},{getHistory:kve,getToasts:Ive});function Rve(e,{insertAt:t}={}){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t==="top"&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}Rve(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function wP(e){return e.label!==void 0}var jve=3,Nve="32px",Mve="16px",kq=4e3,Dve=356,Lve=14,Fve=20,zve=200;function id(...e){return e.filter(Boolean).join(" ")}function Bve(e){let[t,r]=e.split("-"),n=[];return t&&n.push(t),r&&n.push(r),n}var $ve=e=>{var t,r,n,o,l,d,i,g,_,S,E;let{invert:T,toast:C,unstyled:N,interacting:I,setHeights:j,visibleToasts:D,heights:R,index:F,toasts:B,expanded:U,removeToast:Z,defaultRichColors:J,closeButton:te,style:ae,cancelButtonStyle:ne,actionButtonStyle:ie,className:ee="",descriptionClassName:oe="",duration:de,position:xe,gap:we,loadingIcon:Ae,expandByDefault:Ce,classNames:me,icons:Pe,closeButtonAriaLabel:ye="Close toast",pauseWhenPageIsHidden:pe}=e,[Ie,tt]=He.useState(null),[Ze,Le]=He.useState(null),[qe,Ge]=He.useState(!1),[je,ot]=He.useState(!1),[St,rt]=He.useState(!1),[Ut,Ft]=He.useState(!1),[dr,Lr]=He.useState(!1),[Jr,Rt]=He.useState(0),[At,Xe]=He.useState(0),ut=He.useRef(C.duration||de||kq),dt=He.useRef(null),rr=He.useRef(null),er=F===0,tr=F+1<=D,Pr=C.type,un=C.dismissible!==!1,pn=C.className||"",Pi=C.descriptionClassName||"",gi=He.useMemo(()=>R.findIndex(kn=>kn.toastId===C.id)||0,[R,C.id]),Zi=He.useMemo(()=>{var kn;return(kn=C.closeButton)!=null?kn:te},[C.closeButton,te]),js=He.useMemo(()=>C.duration||de||kq,[C.duration,de]),Va=He.useRef(0),Si=He.useRef(0),bs=He.useRef(0),Bo=He.useRef(null),[Ns,$o]=xe.split("-"),rs=He.useMemo(()=>R.reduce((kn,Ii,pa)=>pa>=gi?kn:kn+Ii.height,0),[R,gi]),Ni=Tve(),so=C.invert||T,gl=Pr==="loading";Si.current=He.useMemo(()=>gi*we+rs,[gi,rs]),He.useEffect(()=>{ut.current=js},[js]),He.useEffect(()=>{Ge(!0)},[]),He.useEffect(()=>{let kn=rr.current;if(kn){let Ii=kn.getBoundingClientRect().height;return Xe(Ii),j(pa=>[{toastId:C.id,height:Ii,position:C.position},...pa]),()=>j(pa=>pa.filter(Uo=>Uo.toastId!==C.id))}},[j,C.id]),He.useLayoutEffect(()=>{if(!qe)return;let kn=rr.current,Ii=kn.style.height;kn.style.height="auto";let pa=kn.getBoundingClientRect().height;kn.style.height=Ii,Xe(pa),j(Uo=>Uo.find(Mt=>Mt.toastId===C.id)?Uo.map(Mt=>Mt.toastId===C.id?{...Mt,height:pa}:Mt):[{toastId:C.id,height:pa,position:C.position},...Uo])},[qe,C.title,C.description,j,C.id]);let xr=He.useCallback(()=>{ot(!0),Rt(Si.current),j(kn=>kn.filter(Ii=>Ii.toastId!==C.id)),setTimeout(()=>{Z(C)},zve)},[C,Z,j,Si]);He.useEffect(()=>{if(C.promise&&Pr==="loading"||C.duration===1/0||C.type==="loading")return;let kn;return U||I||pe&&Ni?(()=>{if(bs.current<Va.current){let Ii=new Date().getTime()-Va.current;ut.current=ut.current-Ii}bs.current=new Date().getTime()})():ut.current!==1/0&&(Va.current=new Date().getTime(),kn=setTimeout(()=>{var Ii;(Ii=C.onAutoClose)==null||Ii.call(C,C),xr()},ut.current)),()=>clearTimeout(kn)},[U,I,C,Pr,pe,Ni,xr]),He.useEffect(()=>{C.delete&&xr()},[xr,C.delete]);function Sn(){var kn,Ii,pa;return Pe!=null&&Pe.loading?He.createElement("div",{className:id(me==null?void 0:me.loader,(kn=C==null?void 0:C.classNames)==null?void 0:kn.loader,"sonner-loader"),"data-visible":Pr==="loading"},Pe.loading):Ae?He.createElement("div",{className:id(me==null?void 0:me.loader,(Ii=C==null?void 0:C.classNames)==null?void 0:Ii.loader,"sonner-loader"),"data-visible":Pr==="loading"},Ae):He.createElement(_ve,{className:id(me==null?void 0:me.loader,(pa=C==null?void 0:C.classNames)==null?void 0:pa.loader),visible:Pr==="loading"})}return He.createElement("li",{tabIndex:0,ref:rr,className:id(ee,pn,me==null?void 0:me.toast,(t=C==null?void 0:C.classNames)==null?void 0:t.toast,me==null?void 0:me.default,me==null?void 0:me[Pr],(r=C==null?void 0:C.classNames)==null?void 0:r[Pr]),"data-sonner-toast":"","data-rich-colors":(n=C.richColors)!=null?n:J,"data-styled":!(C.jsx||C.unstyled||N),"data-mounted":qe,"data-promise":!!C.promise,"data-swiped":dr,"data-removed":je,"data-visible":tr,"data-y-position":Ns,"data-x-position":$o,"data-index":F,"data-front":er,"data-swiping":St,"data-dismissible":un,"data-type":Pr,"data-invert":so,"data-swipe-out":Ut,"data-swipe-direction":Ze,"data-expanded":!!(U||Ce&&qe),style:{"--index":F,"--toasts-before":F,"--z-index":B.length-F,"--offset":`${je?Jr:Si.current}px`,"--initial-height":Ce?"auto":`${At}px`,...ae,...C.style},onDragEnd:()=>{rt(!1),tt(null),Bo.current=null},onPointerDown:kn=>{gl||!un||(dt.current=new Date,Rt(Si.current),kn.target.setPointerCapture(kn.pointerId),kn.target.tagName!=="BUTTON"&&(rt(!0),Bo.current={x:kn.clientX,y:kn.clientY}))},onPointerUp:()=>{var kn,Ii,pa,Uo;if(Ut||!un)return;Bo.current=null;let Mt=Number(((kn=rr.current)==null?void 0:kn.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Vo=Number(((Ii=rr.current)==null?void 0:Ii.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),yl=new Date().getTime()-((pa=dt.current)==null?void 0:pa.getTime()),ns=Ie==="x"?Mt:Vo,bn=Math.abs(ns)/yl;if(Math.abs(ns)>=Fve||bn>.11){Rt(Si.current),(Uo=C.onDismiss)==null||Uo.call(C,C),Le(Ie==="x"?Mt>0?"right":"left":Vo>0?"down":"up"),xr(),Ft(!0),Lr(!1);return}rt(!1),tt(null)},onPointerMove:kn=>{var Ii,pa,Uo,Mt;if(!Bo.current||!un||((Ii=window.getSelection())==null?void 0:Ii.toString().length)>0)return;let Vo=kn.clientY-Bo.current.y,yl=kn.clientX-Bo.current.x,ns=(pa=e.swipeDirections)!=null?pa:Bve(xe);!Ie&&(Math.abs(yl)>1||Math.abs(Vo)>1)&&tt(Math.abs(yl)>Math.abs(Vo)?"x":"y");let bn={x:0,y:0};Ie==="y"?(ns.includes("top")||ns.includes("bottom"))&&(ns.includes("top")&&Vo<0||ns.includes("bottom")&&Vo>0)&&(bn.y=Vo):Ie==="x"&&(ns.includes("left")||ns.includes("right"))&&(ns.includes("left")&&yl<0||ns.includes("right")&&yl>0)&&(bn.x=yl),(Math.abs(bn.x)>0||Math.abs(bn.y)>0)&&Lr(!0),(Uo=rr.current)==null||Uo.style.setProperty("--swipe-amount-x",`${bn.x}px`),(Mt=rr.current)==null||Mt.style.setProperty("--swipe-amount-y",`${bn.y}px`)}},Zi&&!C.jsx?He.createElement("button",{"aria-label":ye,"data-disabled":gl,"data-close-button":!0,onClick:gl||!un?()=>{}:()=>{var kn;xr(),(kn=C.onDismiss)==null||kn.call(C,C)},className:id(me==null?void 0:me.closeButton,(o=C==null?void 0:C.classNames)==null?void 0:o.closeButton)},(l=Pe==null?void 0:Pe.close)!=null?l:Eve):null,C.jsx||W.isValidElement(C.title)?C.jsx?C.jsx:typeof C.title=="function"?C.title():C.title:He.createElement(He.Fragment,null,Pr||C.icon||C.promise?He.createElement("div",{"data-icon":"",className:id(me==null?void 0:me.icon,(d=C==null?void 0:C.classNames)==null?void 0:d.icon)},C.promise||C.type==="loading"&&!C.icon?C.icon||Sn():null,C.type!=="loading"?C.icon||(Pe==null?void 0:Pe[Pr])||yve(Pr):null):null,He.createElement("div",{"data-content":"",className:id(me==null?void 0:me.content,(i=C==null?void 0:C.classNames)==null?void 0:i.content)},He.createElement("div",{"data-title":"",className:id(me==null?void 0:me.title,(g=C==null?void 0:C.classNames)==null?void 0:g.title)},typeof C.title=="function"?C.title():C.title),C.description?He.createElement("div",{"data-description":"",className:id(oe,Pi,me==null?void 0:me.description,(_=C==null?void 0:C.classNames)==null?void 0:_.description)},typeof C.description=="function"?C.description():C.description):null),W.isValidElement(C.cancel)?C.cancel:C.cancel&&wP(C.cancel)?He.createElement("button",{"data-button":!0,"data-cancel":!0,style:C.cancelButtonStyle||ne,onClick:kn=>{var Ii,pa;wP(C.cancel)&&un&&((pa=(Ii=C.cancel).onClick)==null||pa.call(Ii,kn),xr())},className:id(me==null?void 0:me.cancelButton,(S=C==null?void 0:C.classNames)==null?void 0:S.cancelButton)},C.cancel.label):null,W.isValidElement(C.action)?C.action:C.action&&wP(C.action)?He.createElement("button",{"data-button":!0,"data-action":!0,style:C.actionButtonStyle||ie,onClick:kn=>{var Ii,pa;wP(C.action)&&((pa=(Ii=C.action).onClick)==null||pa.call(Ii,kn),!kn.defaultPrevented&&xr())},className:id(me==null?void 0:me.actionButton,(E=C==null?void 0:C.classNames)==null?void 0:E.actionButton)},C.action.label):null))};function Iq(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function Uve(e,t){let r={};return[e,t].forEach((n,o)=>{let l=o===1,d=l?"--mobile-offset":"--offset",i=l?Mve:Nve;function g(_){["top","right","bottom","left"].forEach(S=>{r[`${d}-${S}`]=typeof _=="number"?`${_}px`:_})}typeof n=="number"||typeof n=="string"?g(n):typeof n=="object"?["top","right","bottom","left"].forEach(_=>{n[_]===void 0?r[`${d}-${_}`]=i:r[`${d}-${_}`]=typeof n[_]=="number"?`${n[_]}px`:n[_]}):g(i)}),r}var Vve=W.forwardRef(function(e,t){let{invert:r,position:n="bottom-right",hotkey:o=["altKey","KeyT"],expand:l,closeButton:d,className:i,offset:g,mobileOffset:_,theme:S="light",richColors:E,duration:T,style:C,visibleToasts:N=jve,toastOptions:I,dir:j=Iq(),gap:D=Lve,loadingIcon:R,icons:F,containerAriaLabel:B="Notifications",pauseWhenPageIsHidden:U}=e,[Z,J]=He.useState([]),te=He.useMemo(()=>Array.from(new Set([n].concat(Z.filter(pe=>pe.position).map(pe=>pe.position)))),[Z,n]),[ae,ne]=He.useState([]),[ie,ee]=He.useState(!1),[oe,de]=He.useState(!1),[xe,we]=He.useState(S!=="system"?S:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Ae=He.useRef(null),Ce=o.join("+").replace(/Key/g,"").replace(/Digit/g,""),me=He.useRef(null),Pe=He.useRef(!1),ye=He.useCallback(pe=>{J(Ie=>{var tt;return(tt=Ie.find(Ze=>Ze.id===pe.id))!=null&&tt.delete||pc.dismiss(pe.id),Ie.filter(({id:Ze})=>Ze!==pe.id)})},[]);return He.useEffect(()=>pc.subscribe(pe=>{if(pe.dismiss){J(Ie=>Ie.map(tt=>tt.id===pe.id?{...tt,delete:!0}:tt));return}setTimeout(()=>{EY.flushSync(()=>{J(Ie=>{let tt=Ie.findIndex(Ze=>Ze.id===pe.id);return tt!==-1?[...Ie.slice(0,tt),{...Ie[tt],...pe},...Ie.slice(tt+1)]:[pe,...Ie]})})})}),[]),He.useEffect(()=>{if(S!=="system"){we(S);return}if(S==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?we("dark"):we("light")),typeof window>"u")return;let pe=window.matchMedia("(prefers-color-scheme: dark)");try{pe.addEventListener("change",({matches:Ie})=>{we(Ie?"dark":"light")})}catch{pe.addListener(({matches:tt})=>{try{we(tt?"dark":"light")}catch(Ze){console.error(Ze)}})}},[S]),He.useEffect(()=>{Z.length<=1&&ee(!1)},[Z]),He.useEffect(()=>{let pe=Ie=>{var tt,Ze;o.every(Le=>Ie[Le]||Ie.code===Le)&&(ee(!0),(tt=Ae.current)==null||tt.focus()),Ie.code==="Escape"&&(document.activeElement===Ae.current||(Ze=Ae.current)!=null&&Ze.contains(document.activeElement))&&ee(!1)};return document.addEventListener("keydown",pe),()=>document.removeEventListener("keydown",pe)},[o]),He.useEffect(()=>{if(Ae.current)return()=>{me.current&&(me.current.focus({preventScroll:!0}),me.current=null,Pe.current=!1)}},[Ae.current]),He.createElement("section",{ref:t,"aria-label":`${B} ${Ce}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},te.map((pe,Ie)=>{var tt;let[Ze,Le]=pe.split("-");return Z.length?He.createElement("ol",{key:pe,dir:j==="auto"?Iq():j,tabIndex:-1,ref:Ae,className:i,"data-sonner-toaster":!0,"data-theme":xe,"data-y-position":Ze,"data-lifted":ie&&Z.length>1&&!l,"data-x-position":Le,style:{"--front-toast-height":`${((tt=ae[0])==null?void 0:tt.height)||0}px`,"--width":`${Dve}px`,"--gap":`${D}px`,...C,...Uve(g,_)},onBlur:qe=>{Pe.current&&!qe.currentTarget.contains(qe.relatedTarget)&&(Pe.current=!1,me.current&&(me.current.focus({preventScroll:!0}),me.current=null))},onFocus:qe=>{qe.target instanceof HTMLElement&&qe.target.dataset.dismissible==="false"||Pe.current||(Pe.current=!0,me.current=qe.relatedTarget)},onMouseEnter:()=>ee(!0),onMouseMove:()=>ee(!0),onMouseLeave:()=>{oe||ee(!1)},onDragEnd:()=>ee(!1),onPointerDown:qe=>{qe.target instanceof HTMLElement&&qe.target.dataset.dismissible==="false"||de(!0)},onPointerUp:()=>de(!1)},Z.filter(qe=>!qe.position&&Ie===0||qe.position===pe).map((qe,Ge)=>{var je,ot;return He.createElement($ve,{key:qe.id,icons:F,index:Ge,toast:qe,defaultRichColors:E,duration:(je=I==null?void 0:I.duration)!=null?je:T,className:I==null?void 0:I.className,descriptionClassName:I==null?void 0:I.descriptionClassName,invert:r,visibleToasts:N,closeButton:(ot=I==null?void 0:I.closeButton)!=null?ot:d,interacting:oe,position:pe,style:I==null?void 0:I.style,unstyled:I==null?void 0:I.unstyled,classNames:I==null?void 0:I.classNames,cancelButtonStyle:I==null?void 0:I.cancelButtonStyle,actionButtonStyle:I==null?void 0:I.actionButtonStyle,removeToast:ye,toasts:Z.filter(St=>St.position==qe.position),heights:ae.filter(St=>St.position==qe.position),setHeights:ne,expandByDefault:l,gap:D,loadingIcon:R,expanded:ie,pauseWhenPageIsHidden:U,swipeDirections:e.swipeDirections})})):null}))});const qve=({...e})=>{const{theme:t="system"}=gve();return m.jsx(Vve,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})};var Wve=_z[" useId ".trim().toString()]||(()=>{}),Gve=0;function Kc(e){const[t,r]=W.useState(Wve());return Ro(()=>{r(n=>n??String(Gve++))},[e]),t?`radix-${t}`:""}const Hve=["top","right","bottom","left"],qm=Math.min,$c=Math.max,tO=Math.round,SP=Math.floor,bh=e=>({x:e,y:e}),Kve={left:"right",right:"left",bottom:"top",top:"bottom"},Zve={start:"end",end:"start"};function RL(e,t,r){return $c(e,qm(t,r))}function Df(e,t){return typeof e=="function"?e(t):e}function Lf(e){return e.split("-")[0]}function Tb(e){return e.split("-")[1]}function wB(e){return e==="x"?"y":"x"}function SB(e){return e==="y"?"height":"width"}const Xve=new Set(["top","bottom"]);function dh(e){return Xve.has(Lf(e))?"y":"x"}function EB(e){return wB(dh(e))}function Yve(e,t,r){r===void 0&&(r=!1);const n=Tb(e),o=EB(e),l=SB(o);let d=o==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[l]>t.floating[l]&&(d=rO(d)),[d,rO(d)]}function Jve(e){const t=rO(e);return[jL(e),t,jL(t)]}function jL(e){return e.replace(/start|end/g,t=>Zve[t])}const Rq=["left","right"],jq=["right","left"],Qve=["top","bottom"],e_e=["bottom","top"];function t_e(e,t,r){switch(e){case"top":case"bottom":return r?t?jq:Rq:t?Rq:jq;case"left":case"right":return t?Qve:e_e;default:return[]}}function r_e(e,t,r,n){const o=Tb(e);let l=t_e(Lf(e),r==="start",n);return o&&(l=l.map(d=>d+"-"+o),t&&(l=l.concat(l.map(jL)))),l}function rO(e){return e.replace(/left|right|bottom|top/g,t=>Kve[t])}function n_e(e){return{top:0,right:0,bottom:0,left:0,...e}}function vJ(e){return typeof e!="number"?n_e(e):{top:e,right:e,bottom:e,left:e}}function nO(e){const{x:t,y:r,width:n,height:o}=e;return{width:n,height:o,top:r,left:t,right:t+n,bottom:r+o,x:t,y:r}}function Nq(e,t,r){let{reference:n,floating:o}=e;const l=dh(t),d=EB(t),i=SB(d),g=Lf(t),_=l==="y",S=n.x+n.width/2-o.width/2,E=n.y+n.height/2-o.height/2,T=n[i]/2-o[i]/2;let C;switch(g){case"top":C={x:S,y:n.y-o.height};break;case"bottom":C={x:S,y:n.y+n.height};break;case"right":C={x:n.x+n.width,y:E};break;case"left":C={x:n.x-o.width,y:E};break;default:C={x:n.x,y:n.y}}switch(Tb(t)){case"start":C[d]-=T*(r&&_?-1:1);break;case"end":C[d]+=T*(r&&_?-1:1);break}return C}const i_e=async(e,t,r)=>{const{placement:n="bottom",strategy:o="absolute",middleware:l=[],platform:d}=r,i=l.filter(Boolean),g=await(d.isRTL==null?void 0:d.isRTL(t));let _=await d.getElementRects({reference:e,floating:t,strategy:o}),{x:S,y:E}=Nq(_,n,g),T=n,C={},N=0;for(let I=0;I<i.length;I++){const{name:j,fn:D}=i[I],{x:R,y:F,data:B,reset:U}=await D({x:S,y:E,initialPlacement:n,placement:T,strategy:o,middlewareData:C,rects:_,platform:d,elements:{reference:e,floating:t}});S=R??S,E=F??E,C={...C,[j]:{...C[j],...B}},U&&N<=50&&(N++,typeof U=="object"&&(U.placement&&(T=U.placement),U.rects&&(_=U.rects===!0?await d.getElementRects({reference:e,floating:t,strategy:o}):U.rects),{x:S,y:E}=Nq(_,T,g)),I=-1)}return{x:S,y:E,placement:T,strategy:o,middlewareData:C}};async function SE(e,t){var r;t===void 0&&(t={});const{x:n,y:o,platform:l,rects:d,elements:i,strategy:g}=e,{boundary:_="clippingAncestors",rootBoundary:S="viewport",elementContext:E="floating",altBoundary:T=!1,padding:C=0}=Df(t,e),N=vJ(C),j=i[T?E==="floating"?"reference":"floating":E],D=nO(await l.getClippingRect({element:(r=await(l.isElement==null?void 0:l.isElement(j)))==null||r?j:j.contextElement||await(l.getDocumentElement==null?void 0:l.getDocumentElement(i.floating)),boundary:_,rootBoundary:S,strategy:g})),R=E==="floating"?{x:n,y:o,width:d.floating.width,height:d.floating.height}:d.reference,F=await(l.getOffsetParent==null?void 0:l.getOffsetParent(i.floating)),B=await(l.isElement==null?void 0:l.isElement(F))?await(l.getScale==null?void 0:l.getScale(F))||{x:1,y:1}:{x:1,y:1},U=nO(l.convertOffsetParentRelativeRectToViewportRelativeRect?await l.convertOffsetParentRelativeRectToViewportRelativeRect({elements:i,rect:R,offsetParent:F,strategy:g}):R);return{top:(D.top-U.top+N.top)/B.y,bottom:(U.bottom-D.bottom+N.bottom)/B.y,left:(D.left-U.left+N.left)/B.x,right:(U.right-D.right+N.right)/B.x}}const a_e=e=>({name:"arrow",options:e,async fn(t){const{x:r,y:n,placement:o,rects:l,platform:d,elements:i,middlewareData:g}=t,{element:_,padding:S=0}=Df(e,t)||{};if(_==null)return{};const E=vJ(S),T={x:r,y:n},C=EB(o),N=SB(C),I=await d.getDimensions(_),j=C==="y",D=j?"top":"left",R=j?"bottom":"right",F=j?"clientHeight":"clientWidth",B=l.reference[N]+l.reference[C]-T[C]-l.floating[N],U=T[C]-l.reference[C],Z=await(d.getOffsetParent==null?void 0:d.getOffsetParent(_));let J=Z?Z[F]:0;(!J||!await(d.isElement==null?void 0:d.isElement(Z)))&&(J=i.floating[F]||l.floating[N]);const te=B/2-U/2,ae=J/2-I[N]/2-1,ne=qm(E[D],ae),ie=qm(E[R],ae),ee=ne,oe=J-I[N]-ie,de=J/2-I[N]/2+te,xe=RL(ee,de,oe),we=!g.arrow&&Tb(o)!=null&&de!==xe&&l.reference[N]/2-(de<ee?ne:ie)-I[N]/2<0,Ae=we?de<ee?de-ee:de-oe:0;return{[C]:T[C]+Ae,data:{[C]:xe,centerOffset:de-xe-Ae,...we&&{alignmentOffset:Ae}},reset:we}}}),o_e=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var r,n;const{placement:o,middlewareData:l,rects:d,initialPlacement:i,platform:g,elements:_}=t,{mainAxis:S=!0,crossAxis:E=!0,fallbackPlacements:T,fallbackStrategy:C="bestFit",fallbackAxisSideDirection:N="none",flipAlignment:I=!0,...j}=Df(e,t);if((r=l.arrow)!=null&&r.alignmentOffset)return{};const D=Lf(o),R=dh(i),F=Lf(i)===i,B=await(g.isRTL==null?void 0:g.isRTL(_.floating)),U=T||(F||!I?[rO(i)]:Jve(i)),Z=N!=="none";!T&&Z&&U.push(...r_e(i,I,N,B));const J=[i,...U],te=await SE(t,j),ae=[];let ne=((n=l.flip)==null?void 0:n.overflows)||[];if(S&&ae.push(te[D]),E){const de=Yve(o,d,B);ae.push(te[de[0]],te[de[1]])}if(ne=[...ne,{placement:o,overflows:ae}],!ae.every(de=>de<=0)){var ie,ee;const de=(((ie=l.flip)==null?void 0:ie.index)||0)+1,xe=J[de];if(xe&&(!(E==="alignment"?R!==dh(xe):!1)||ne.every(Ce=>Ce.overflows[0]>0&&dh(Ce.placement)===R)))return{data:{index:de,overflows:ne},reset:{placement:xe}};let we=(ee=ne.filter(Ae=>Ae.overflows[0]<=0).sort((Ae,Ce)=>Ae.overflows[1]-Ce.overflows[1])[0])==null?void 0:ee.placement;if(!we)switch(C){case"bestFit":{var oe;const Ae=(oe=ne.filter(Ce=>{if(Z){const me=dh(Ce.placement);return me===R||me==="y"}return!0}).map(Ce=>[Ce.placement,Ce.overflows.filter(me=>me>0).reduce((me,Pe)=>me+Pe,0)]).sort((Ce,me)=>Ce[1]-me[1])[0])==null?void 0:oe[0];Ae&&(we=Ae);break}case"initialPlacement":we=i;break}if(o!==we)return{reset:{placement:we}}}return{}}}};function Mq(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function Dq(e){return Hve.some(t=>e[t]>=0)}const s_e=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:r}=t,{strategy:n="referenceHidden",...o}=Df(e,t);switch(n){case"referenceHidden":{const l=await SE(t,{...o,elementContext:"reference"}),d=Mq(l,r.reference);return{data:{referenceHiddenOffsets:d,referenceHidden:Dq(d)}}}case"escaped":{const l=await SE(t,{...o,altBoundary:!0}),d=Mq(l,r.floating);return{data:{escapedOffsets:d,escaped:Dq(d)}}}default:return{}}}}},_J=new Set(["left","top"]);async function l_e(e,t){const{placement:r,platform:n,elements:o}=e,l=await(n.isRTL==null?void 0:n.isRTL(o.floating)),d=Lf(r),i=Tb(r),g=dh(r)==="y",_=_J.has(d)?-1:1,S=l&&g?-1:1,E=Df(t,e);let{mainAxis:T,crossAxis:C,alignmentAxis:N}=typeof E=="number"?{mainAxis:E,crossAxis:0,alignmentAxis:null}:{mainAxis:E.mainAxis||0,crossAxis:E.crossAxis||0,alignmentAxis:E.alignmentAxis};return i&&typeof N=="number"&&(C=i==="end"?N*-1:N),g?{x:C*S,y:T*_}:{x:T*_,y:C*S}}const c_e=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var r,n;const{x:o,y:l,placement:d,middlewareData:i}=t,g=await l_e(t,e);return d===((r=i.offset)==null?void 0:r.placement)&&(n=i.arrow)!=null&&n.alignmentOffset?{}:{x:o+g.x,y:l+g.y,data:{...g,placement:d}}}}},u_e=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:n,placement:o}=t,{mainAxis:l=!0,crossAxis:d=!1,limiter:i={fn:j=>{let{x:D,y:R}=j;return{x:D,y:R}}},...g}=Df(e,t),_={x:r,y:n},S=await SE(t,g),E=dh(Lf(o)),T=wB(E);let C=_[T],N=_[E];if(l){const j=T==="y"?"top":"left",D=T==="y"?"bottom":"right",R=C+S[j],F=C-S[D];C=RL(R,C,F)}if(d){const j=E==="y"?"top":"left",D=E==="y"?"bottom":"right",R=N+S[j],F=N-S[D];N=RL(R,N,F)}const I=i.fn({...t,[T]:C,[E]:N});return{...I,data:{x:I.x-r,y:I.y-n,enabled:{[T]:l,[E]:d}}}}}},d_e=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:r,y:n,placement:o,rects:l,middlewareData:d}=t,{offset:i=0,mainAxis:g=!0,crossAxis:_=!0}=Df(e,t),S={x:r,y:n},E=dh(o),T=wB(E);let C=S[T],N=S[E];const I=Df(i,t),j=typeof I=="number"?{mainAxis:I,crossAxis:0}:{mainAxis:0,crossAxis:0,...I};if(g){const F=T==="y"?"height":"width",B=l.reference[T]-l.floating[F]+j.mainAxis,U=l.reference[T]+l.reference[F]-j.mainAxis;C<B?C=B:C>U&&(C=U)}if(_){var D,R;const F=T==="y"?"width":"height",B=_J.has(Lf(o)),U=l.reference[E]-l.floating[F]+(B&&((D=d.offset)==null?void 0:D[E])||0)+(B?0:j.crossAxis),Z=l.reference[E]+l.reference[F]+(B?0:((R=d.offset)==null?void 0:R[E])||0)-(B?j.crossAxis:0);N<U?N=U:N>Z&&(N=Z)}return{[T]:C,[E]:N}}}},h_e=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var r,n;const{placement:o,rects:l,platform:d,elements:i}=t,{apply:g=()=>{},..._}=Df(e,t),S=await SE(t,_),E=Lf(o),T=Tb(o),C=dh(o)==="y",{width:N,height:I}=l.floating;let j,D;E==="top"||E==="bottom"?(j=E,D=T===(await(d.isRTL==null?void 0:d.isRTL(i.floating))?"start":"end")?"left":"right"):(D=E,j=T==="end"?"top":"bottom");const R=I-S.top-S.bottom,F=N-S.left-S.right,B=qm(I-S[j],R),U=qm(N-S[D],F),Z=!t.middlewareData.shift;let J=B,te=U;if((r=t.middlewareData.shift)!=null&&r.enabled.x&&(te=F),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(J=R),Z&&!T){const ne=$c(S.left,0),ie=$c(S.right,0),ee=$c(S.top,0),oe=$c(S.bottom,0);C?te=N-2*(ne!==0||ie!==0?ne+ie:$c(S.left,S.right)):J=I-2*(ee!==0||oe!==0?ee+oe:$c(S.top,S.bottom))}await g({...t,availableWidth:te,availableHeight:J});const ae=await d.getDimensions(i.floating);return N!==ae.width||I!==ae.height?{reset:{rects:!0}}:{}}}};function cI(){return typeof window<"u"}function Ab(e){return xJ(e)?(e.nodeName||"").toLowerCase():"#document"}function Zc(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Ih(e){var t;return(t=(xJ(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function xJ(e){return cI()?e instanceof Node||e instanceof Zc(e).Node:!1}function Ad(e){return cI()?e instanceof Element||e instanceof Zc(e).Element:!1}function Ah(e){return cI()?e instanceof HTMLElement||e instanceof Zc(e).HTMLElement:!1}function Lq(e){return!cI()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Zc(e).ShadowRoot}const f_e=new Set(["inline","contents"]);function jT(e){const{overflow:t,overflowX:r,overflowY:n,display:o}=Pd(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!f_e.has(o)}const p_e=new Set(["table","td","th"]);function m_e(e){return p_e.has(Ab(e))}const g_e=[":popover-open",":modal"];function uI(e){return g_e.some(t=>{try{return e.matches(t)}catch{return!1}})}const y_e=["transform","translate","scale","rotate","perspective"],v_e=["transform","translate","scale","rotate","perspective","filter"],__e=["paint","layout","strict","content"];function TB(e){const t=AB(),r=Ad(e)?Pd(e):e;return y_e.some(n=>r[n]?r[n]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!t&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!t&&(r.filter?r.filter!=="none":!1)||v_e.some(n=>(r.willChange||"").includes(n))||__e.some(n=>(r.contain||"").includes(n))}function x_e(e){let t=Wm(e);for(;Ah(t)&&!k0(t);){if(TB(t))return t;if(uI(t))return null;t=Wm(t)}return null}function AB(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const b_e=new Set(["html","body","#document"]);function k0(e){return b_e.has(Ab(e))}function Pd(e){return Zc(e).getComputedStyle(e)}function dI(e){return Ad(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Wm(e){if(Ab(e)==="html")return e;const t=e.assignedSlot||e.parentNode||Lq(e)&&e.host||Ih(e);return Lq(t)?t.host:t}function bJ(e){const t=Wm(e);return k0(t)?e.ownerDocument?e.ownerDocument.body:e.body:Ah(t)&&jT(t)?t:bJ(t)}function EE(e,t,r){var n;t===void 0&&(t=[]),r===void 0&&(r=!0);const o=bJ(e),l=o===((n=e.ownerDocument)==null?void 0:n.body),d=Zc(o);if(l){const i=NL(d);return t.concat(d,d.visualViewport||[],jT(o)?o:[],i&&r?EE(i):[])}return t.concat(o,EE(o,[],r))}function NL(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function wJ(e){const t=Pd(e);let r=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const o=Ah(e),l=o?e.offsetWidth:r,d=o?e.offsetHeight:n,i=tO(r)!==l||tO(n)!==d;return i&&(r=l,n=d),{width:r,height:n,$:i}}function PB(e){return Ad(e)?e:e.contextElement}function e0(e){const t=PB(e);if(!Ah(t))return bh(1);const r=t.getBoundingClientRect(),{width:n,height:o,$:l}=wJ(t);let d=(l?tO(r.width):r.width)/n,i=(l?tO(r.height):r.height)/o;return(!d||!Number.isFinite(d))&&(d=1),(!i||!Number.isFinite(i))&&(i=1),{x:d,y:i}}const w_e=bh(0);function SJ(e){const t=Zc(e);return!AB()||!t.visualViewport?w_e:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function S_e(e,t,r){return t===void 0&&(t=!1),!r||t&&r!==Zc(e)?!1:t}function lv(e,t,r,n){t===void 0&&(t=!1),r===void 0&&(r=!1);const o=e.getBoundingClientRect(),l=PB(e);let d=bh(1);t&&(n?Ad(n)&&(d=e0(n)):d=e0(e));const i=S_e(l,r,n)?SJ(l):bh(0);let g=(o.left+i.x)/d.x,_=(o.top+i.y)/d.y,S=o.width/d.x,E=o.height/d.y;if(l){const T=Zc(l),C=n&&Ad(n)?Zc(n):n;let N=T,I=NL(N);for(;I&&n&&C!==N;){const j=e0(I),D=I.getBoundingClientRect(),R=Pd(I),F=D.left+(I.clientLeft+parseFloat(R.paddingLeft))*j.x,B=D.top+(I.clientTop+parseFloat(R.paddingTop))*j.y;g*=j.x,_*=j.y,S*=j.x,E*=j.y,g+=F,_+=B,N=Zc(I),I=NL(N)}}return nO({width:S,height:E,x:g,y:_})}function CB(e,t){const r=dI(e).scrollLeft;return t?t.left+r:lv(Ih(e)).left+r}function EJ(e,t,r){r===void 0&&(r=!1);const n=e.getBoundingClientRect(),o=n.left+t.scrollLeft-(r?0:CB(e,n)),l=n.top+t.scrollTop;return{x:o,y:l}}function E_e(e){let{elements:t,rect:r,offsetParent:n,strategy:o}=e;const l=o==="fixed",d=Ih(n),i=t?uI(t.floating):!1;if(n===d||i&&l)return r;let g={scrollLeft:0,scrollTop:0},_=bh(1);const S=bh(0),E=Ah(n);if((E||!E&&!l)&&((Ab(n)!=="body"||jT(d))&&(g=dI(n)),Ah(n))){const C=lv(n);_=e0(n),S.x=C.x+n.clientLeft,S.y=C.y+n.clientTop}const T=d&&!E&&!l?EJ(d,g,!0):bh(0);return{width:r.width*_.x,height:r.height*_.y,x:r.x*_.x-g.scrollLeft*_.x+S.x+T.x,y:r.y*_.y-g.scrollTop*_.y+S.y+T.y}}function T_e(e){return Array.from(e.getClientRects())}function A_e(e){const t=Ih(e),r=dI(e),n=e.ownerDocument.body,o=$c(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),l=$c(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let d=-r.scrollLeft+CB(e);const i=-r.scrollTop;return Pd(n).direction==="rtl"&&(d+=$c(t.clientWidth,n.clientWidth)-o),{width:o,height:l,x:d,y:i}}function P_e(e,t){const r=Zc(e),n=Ih(e),o=r.visualViewport;let l=n.clientWidth,d=n.clientHeight,i=0,g=0;if(o){l=o.width,d=o.height;const _=AB();(!_||_&&t==="fixed")&&(i=o.offsetLeft,g=o.offsetTop)}return{width:l,height:d,x:i,y:g}}const C_e=new Set(["absolute","fixed"]);function O_e(e,t){const r=lv(e,!0,t==="fixed"),n=r.top+e.clientTop,o=r.left+e.clientLeft,l=Ah(e)?e0(e):bh(1),d=e.clientWidth*l.x,i=e.clientHeight*l.y,g=o*l.x,_=n*l.y;return{width:d,height:i,x:g,y:_}}function Fq(e,t,r){let n;if(t==="viewport")n=P_e(e,r);else if(t==="document")n=A_e(Ih(e));else if(Ad(t))n=O_e(t,r);else{const o=SJ(e);n={x:t.x-o.x,y:t.y-o.y,width:t.width,height:t.height}}return nO(n)}function TJ(e,t){const r=Wm(e);return r===t||!Ad(r)||k0(r)?!1:Pd(r).position==="fixed"||TJ(r,t)}function k_e(e,t){const r=t.get(e);if(r)return r;let n=EE(e,[],!1).filter(i=>Ad(i)&&Ab(i)!=="body"),o=null;const l=Pd(e).position==="fixed";let d=l?Wm(e):e;for(;Ad(d)&&!k0(d);){const i=Pd(d),g=TB(d);!g&&i.position==="fixed"&&(o=null),(l?!g&&!o:!g&&i.position==="static"&&!!o&&C_e.has(o.position)||jT(d)&&!g&&TJ(e,d))?n=n.filter(S=>S!==d):o=i,d=Wm(d)}return t.set(e,n),n}function I_e(e){let{element:t,boundary:r,rootBoundary:n,strategy:o}=e;const d=[...r==="clippingAncestors"?uI(t)?[]:k_e(t,this._c):[].concat(r),n],i=d[0],g=d.reduce((_,S)=>{const E=Fq(t,S,o);return _.top=$c(E.top,_.top),_.right=qm(E.right,_.right),_.bottom=qm(E.bottom,_.bottom),_.left=$c(E.left,_.left),_},Fq(t,i,o));return{width:g.right-g.left,height:g.bottom-g.top,x:g.left,y:g.top}}function R_e(e){const{width:t,height:r}=wJ(e);return{width:t,height:r}}function j_e(e,t,r){const n=Ah(t),o=Ih(t),l=r==="fixed",d=lv(e,!0,l,t);let i={scrollLeft:0,scrollTop:0};const g=bh(0);function _(){g.x=CB(o)}if(n||!n&&!l)if((Ab(t)!=="body"||jT(o))&&(i=dI(t)),n){const C=lv(t,!0,l,t);g.x=C.x+t.clientLeft,g.y=C.y+t.clientTop}else o&&_();l&&!n&&o&&_();const S=o&&!n&&!l?EJ(o,i):bh(0),E=d.left+i.scrollLeft-g.x-S.x,T=d.top+i.scrollTop-g.y-S.y;return{x:E,y:T,width:d.width,height:d.height}}function AM(e){return Pd(e).position==="static"}function zq(e,t){if(!Ah(e)||Pd(e).position==="fixed")return null;if(t)return t(e);let r=e.offsetParent;return Ih(e)===r&&(r=r.ownerDocument.body),r}function AJ(e,t){const r=Zc(e);if(uI(e))return r;if(!Ah(e)){let o=Wm(e);for(;o&&!k0(o);){if(Ad(o)&&!AM(o))return o;o=Wm(o)}return r}let n=zq(e,t);for(;n&&m_e(n)&&AM(n);)n=zq(n,t);return n&&k0(n)&&AM(n)&&!TB(n)?r:n||x_e(e)||r}const N_e=async function(e){const t=this.getOffsetParent||AJ,r=this.getDimensions,n=await r(e.floating);return{reference:j_e(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function M_e(e){return Pd(e).direction==="rtl"}const D_e={convertOffsetParentRelativeRectToViewportRelativeRect:E_e,getDocumentElement:Ih,getClippingRect:I_e,getOffsetParent:AJ,getElementRects:N_e,getClientRects:T_e,getDimensions:R_e,getScale:e0,isElement:Ad,isRTL:M_e};function PJ(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function L_e(e,t){let r=null,n;const o=Ih(e);function l(){var i;clearTimeout(n),(i=r)==null||i.disconnect(),r=null}function d(i,g){i===void 0&&(i=!1),g===void 0&&(g=1),l();const _=e.getBoundingClientRect(),{left:S,top:E,width:T,height:C}=_;if(i||t(),!T||!C)return;const N=SP(E),I=SP(o.clientWidth-(S+T)),j=SP(o.clientHeight-(E+C)),D=SP(S),F={rootMargin:-N+"px "+-I+"px "+-j+"px "+-D+"px",threshold:$c(0,qm(1,g))||1};let B=!0;function U(Z){const J=Z[0].intersectionRatio;if(J!==g){if(!B)return d();J?d(!1,J):n=setTimeout(()=>{d(!1,1e-7)},1e3)}J===1&&!PJ(_,e.getBoundingClientRect())&&d(),B=!1}try{r=new IntersectionObserver(U,{...F,root:o.ownerDocument})}catch{r=new IntersectionObserver(U,F)}r.observe(e)}return d(!0),l}function F_e(e,t,r,n){n===void 0&&(n={});const{ancestorScroll:o=!0,ancestorResize:l=!0,elementResize:d=typeof ResizeObserver=="function",layoutShift:i=typeof IntersectionObserver=="function",animationFrame:g=!1}=n,_=PB(e),S=o||l?[..._?EE(_):[],...EE(t)]:[];S.forEach(D=>{o&&D.addEventListener("scroll",r,{passive:!0}),l&&D.addEventListener("resize",r)});const E=_&&i?L_e(_,r):null;let T=-1,C=null;d&&(C=new ResizeObserver(D=>{let[R]=D;R&&R.target===_&&C&&(C.unobserve(t),cancelAnimationFrame(T),T=requestAnimationFrame(()=>{var F;(F=C)==null||F.observe(t)})),r()}),_&&!g&&C.observe(_),C.observe(t));let N,I=g?lv(e):null;g&&j();function j(){const D=lv(e);I&&!PJ(I,D)&&r(),I=D,N=requestAnimationFrame(j)}return r(),()=>{var D;S.forEach(R=>{o&&R.removeEventListener("scroll",r),l&&R.removeEventListener("resize",r)}),E==null||E(),(D=C)==null||D.disconnect(),C=null,g&&cancelAnimationFrame(N)}}const z_e=c_e,B_e=u_e,$_e=o_e,U_e=h_e,V_e=s_e,Bq=a_e,q_e=d_e,W_e=(e,t,r)=>{const n=new Map,o={platform:D_e,...r},l={...o.platform,_c:n};return i_e(e,t,{...o,platform:l})};var G_e=typeof document<"u",H_e=function(){},pC=G_e?W.useLayoutEffect:H_e;function iO(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let r,n,o;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(n=r;n--!==0;)if(!iO(e[n],t[n]))return!1;return!0}if(o=Object.keys(e),r=o.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(t,o[n]))return!1;for(n=r;n--!==0;){const l=o[n];if(!(l==="_owner"&&e.$$typeof)&&!iO(e[l],t[l]))return!1}return!0}return e!==e&&t!==t}function CJ(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function $q(e,t){const r=CJ(e);return Math.round(t*r)/r}function PM(e){const t=W.useRef(e);return pC(()=>{t.current=e}),t}function K_e(e){e===void 0&&(e={});const{placement:t="bottom",strategy:r="absolute",middleware:n=[],platform:o,elements:{reference:l,floating:d}={},transform:i=!0,whileElementsMounted:g,open:_}=e,[S,E]=W.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[T,C]=W.useState(n);iO(T,n)||C(n);const[N,I]=W.useState(null),[j,D]=W.useState(null),R=W.useCallback(Ce=>{Ce!==Z.current&&(Z.current=Ce,I(Ce))},[]),F=W.useCallback(Ce=>{Ce!==J.current&&(J.current=Ce,D(Ce))},[]),B=l||N,U=d||j,Z=W.useRef(null),J=W.useRef(null),te=W.useRef(S),ae=g!=null,ne=PM(g),ie=PM(o),ee=PM(_),oe=W.useCallback(()=>{if(!Z.current||!J.current)return;const Ce={placement:t,strategy:r,middleware:T};ie.current&&(Ce.platform=ie.current),W_e(Z.current,J.current,Ce).then(me=>{const Pe={...me,isPositioned:ee.current!==!1};de.current&&!iO(te.current,Pe)&&(te.current=Pe,tg.flushSync(()=>{E(Pe)}))})},[T,t,r,ie,ee]);pC(()=>{_===!1&&te.current.isPositioned&&(te.current.isPositioned=!1,E(Ce=>({...Ce,isPositioned:!1})))},[_]);const de=W.useRef(!1);pC(()=>(de.current=!0,()=>{de.current=!1}),[]),pC(()=>{if(B&&(Z.current=B),U&&(J.current=U),B&&U){if(ne.current)return ne.current(B,U,oe);oe()}},[B,U,oe,ne,ae]);const xe=W.useMemo(()=>({reference:Z,floating:J,setReference:R,setFloating:F}),[R,F]),we=W.useMemo(()=>({reference:B,floating:U}),[B,U]),Ae=W.useMemo(()=>{const Ce={position:r,left:0,top:0};if(!we.floating)return Ce;const me=$q(we.floating,S.x),Pe=$q(we.floating,S.y);return i?{...Ce,transform:"translate("+me+"px, "+Pe+"px)",...CJ(we.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:me,top:Pe}},[r,i,we.floating,S.x,S.y]);return W.useMemo(()=>({...S,update:oe,refs:xe,elements:we,floatingStyles:Ae}),[S,oe,xe,we,Ae])}const Z_e=e=>{function t(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:e,fn(r){const{element:n,padding:o}=typeof e=="function"?e(r):e;return n&&t(n)?n.current!=null?Bq({element:n.current,padding:o}).fn(r):{}:n?Bq({element:n,padding:o}).fn(r):{}}}},X_e=(e,t)=>({...z_e(e),options:[e,t]}),Y_e=(e,t)=>({...B_e(e),options:[e,t]}),J_e=(e,t)=>({...q_e(e),options:[e,t]}),Q_e=(e,t)=>({...$_e(e),options:[e,t]}),exe=(e,t)=>({...U_e(e),options:[e,t]}),txe=(e,t)=>({...V_e(e),options:[e,t]}),rxe=(e,t)=>({...Z_e(e),options:[e,t]});var nxe="Arrow",OJ=W.forwardRef((e,t)=>{const{children:r,width:n=10,height:o=5,...l}=e;return m.jsx(wn.svg,{...l,ref:t,width:n,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:m.jsx("polygon",{points:"0,0 30,0 15,10"})})});OJ.displayName=nxe;var ixe=OJ;function OB(e){const[t,r]=W.useState(void 0);return Ro(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});const n=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const l=o[0];let d,i;if("borderBoxSize"in l){const g=l.borderBoxSize,_=Array.isArray(g)?g[0]:g;d=_.inlineSize,i=_.blockSize}else d=e.offsetWidth,i=e.offsetHeight;r({width:d,height:i})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)}else r(void 0)},[e]),t}var kB="Popper",[kJ,rg]=Zs(kB),[axe,IJ]=kJ(kB),RJ=e=>{const{__scopePopper:t,children:r}=e,[n,o]=W.useState(null);return m.jsx(axe,{scope:t,anchor:n,onAnchorChange:o,children:r})};RJ.displayName=kB;var jJ="PopperAnchor",NJ=W.forwardRef((e,t)=>{const{__scopePopper:r,virtualRef:n,...o}=e,l=IJ(jJ,r),d=W.useRef(null),i=fi(t,d);return W.useEffect(()=>{l.onAnchorChange((n==null?void 0:n.current)||d.current)}),n?null:m.jsx(wn.div,{...o,ref:i})});NJ.displayName=jJ;var IB="PopperContent",[oxe,sxe]=kJ(IB),MJ=W.forwardRef((e,t)=>{var qe,Ge,je,ot,St,rt;const{__scopePopper:r,side:n="bottom",sideOffset:o=0,align:l="center",alignOffset:d=0,arrowPadding:i=0,avoidCollisions:g=!0,collisionBoundary:_=[],collisionPadding:S=0,sticky:E="partial",hideWhenDetached:T=!1,updatePositionStrategy:C="optimized",onPlaced:N,...I}=e,j=IJ(IB,r),[D,R]=W.useState(null),F=fi(t,Ut=>R(Ut)),[B,U]=W.useState(null),Z=OB(B),J=(Z==null?void 0:Z.width)??0,te=(Z==null?void 0:Z.height)??0,ae=n+(l!=="center"?"-"+l:""),ne=typeof S=="number"?S:{top:0,right:0,bottom:0,left:0,...S},ie=Array.isArray(_)?_:[_],ee=ie.length>0,oe={padding:ne,boundary:ie.filter(cxe),altBoundary:ee},{refs:de,floatingStyles:xe,placement:we,isPositioned:Ae,middlewareData:Ce}=K_e({strategy:"fixed",placement:ae,whileElementsMounted:(...Ut)=>F_e(...Ut,{animationFrame:C==="always"}),elements:{reference:j.anchor},middleware:[X_e({mainAxis:o+te,alignmentAxis:d}),g&&Y_e({mainAxis:!0,crossAxis:!1,limiter:E==="partial"?J_e():void 0,...oe}),g&&Q_e({...oe}),exe({...oe,apply:({elements:Ut,rects:Ft,availableWidth:dr,availableHeight:Lr})=>{const{width:Jr,height:Rt}=Ft.reference,At=Ut.floating.style;At.setProperty("--radix-popper-available-width",`${dr}px`),At.setProperty("--radix-popper-available-height",`${Lr}px`),At.setProperty("--radix-popper-anchor-width",`${Jr}px`),At.setProperty("--radix-popper-anchor-height",`${Rt}px`)}}),B&&rxe({element:B,padding:i}),uxe({arrowWidth:J,arrowHeight:te}),T&&txe({strategy:"referenceHidden",...oe})]}),[me,Pe]=FJ(we),ye=Io(N);Ro(()=>{Ae&&(ye==null||ye())},[Ae,ye]);const pe=(qe=Ce.arrow)==null?void 0:qe.x,Ie=(Ge=Ce.arrow)==null?void 0:Ge.y,tt=((je=Ce.arrow)==null?void 0:je.centerOffset)!==0,[Ze,Le]=W.useState();return Ro(()=>{D&&Le(window.getComputedStyle(D).zIndex)},[D]),m.jsx("div",{ref:de.setFloating,"data-radix-popper-content-wrapper":"",style:{...xe,transform:Ae?xe.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Ze,"--radix-popper-transform-origin":[(ot=Ce.transformOrigin)==null?void 0:ot.x,(St=Ce.transformOrigin)==null?void 0:St.y].join(" "),...((rt=Ce.hide)==null?void 0:rt.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:m.jsx(oxe,{scope:r,placedSide:me,onArrowChange:U,arrowX:pe,arrowY:Ie,shouldHideArrow:tt,children:m.jsx(wn.div,{"data-side":me,"data-align":Pe,...I,ref:F,style:{...I.style,animation:Ae?void 0:"none"}})})})});MJ.displayName=IB;var DJ="PopperArrow",lxe={top:"bottom",right:"left",bottom:"top",left:"right"},LJ=W.forwardRef(function(t,r){const{__scopePopper:n,...o}=t,l=sxe(DJ,n),d=lxe[l.placedSide];return m.jsx("span",{ref:l.onArrowChange,style:{position:"absolute",left:l.arrowX,top:l.arrowY,[d]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[l.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[l.placedSide],visibility:l.shouldHideArrow?"hidden":void 0},children:m.jsx(ixe,{...o,ref:r,style:{...o.style,display:"block"}})})});LJ.displayName=DJ;function cxe(e){return e!==null}var uxe=e=>({name:"transformOrigin",options:e,fn(t){var j,D,R;const{placement:r,rects:n,middlewareData:o}=t,d=((j=o.arrow)==null?void 0:j.centerOffset)!==0,i=d?0:e.arrowWidth,g=d?0:e.arrowHeight,[_,S]=FJ(r),E={start:"0%",center:"50%",end:"100%"}[S],T=(((D=o.arrow)==null?void 0:D.x)??0)+i/2,C=(((R=o.arrow)==null?void 0:R.y)??0)+g/2;let N="",I="";return _==="bottom"?(N=d?E:`${T}px`,I=`${-g}px`):_==="top"?(N=d?E:`${T}px`,I=`${n.floating.height+g}px`):_==="right"?(N=`${-g}px`,I=d?E:`${C}px`):_==="left"&&(N=`${n.floating.width+g}px`,I=d?E:`${C}px`),{data:{x:N,y:I}}}});function FJ(e){const[t,r="center"]=e.split("-");return[t,r]}var hI=RJ,NT=NJ,fI=MJ,pI=LJ,[mI,Fet]=Zs("Tooltip",[rg]),gI=rg(),zJ="TooltipProvider",dxe=700,ML="tooltip.open",[hxe,RB]=mI(zJ),BJ=e=>{const{__scopeTooltip:t,delayDuration:r=dxe,skipDelayDuration:n=300,disableHoverableContent:o=!1,children:l}=e,d=W.useRef(!0),i=W.useRef(!1),g=W.useRef(0);return W.useEffect(()=>{const _=g.current;return()=>window.clearTimeout(_)},[]),m.jsx(hxe,{scope:t,isOpenDelayedRef:d,delayDuration:r,onOpen:W.useCallback(()=>{window.clearTimeout(g.current),d.current=!1},[]),onClose:W.useCallback(()=>{window.clearTimeout(g.current),g.current=window.setTimeout(()=>d.current=!0,n)},[n]),isPointerInTransitRef:i,onPointerInTransitChange:W.useCallback(_=>{i.current=_},[]),disableHoverableContent:o,children:l})};BJ.displayName=zJ;var TE="Tooltip",[fxe,yI]=mI(TE),$J=e=>{const{__scopeTooltip:t,children:r,open:n,defaultOpen:o,onOpenChange:l,disableHoverableContent:d,delayDuration:i}=e,g=RB(TE,e.__scopeTooltip),_=gI(t),[S,E]=W.useState(null),T=Kc(),C=W.useRef(0),N=d??g.disableHoverableContent,I=i??g.delayDuration,j=W.useRef(!1),[D,R]=Ru({prop:n,defaultProp:o??!1,onChange:J=>{J?(g.onOpen(),document.dispatchEvent(new CustomEvent(ML))):g.onClose(),l==null||l(J)},caller:TE}),F=W.useMemo(()=>D?j.current?"delayed-open":"instant-open":"closed",[D]),B=W.useCallback(()=>{window.clearTimeout(C.current),C.current=0,j.current=!1,R(!0)},[R]),U=W.useCallback(()=>{window.clearTimeout(C.current),C.current=0,R(!1)},[R]),Z=W.useCallback(()=>{window.clearTimeout(C.current),C.current=window.setTimeout(()=>{j.current=!0,R(!0),C.current=0},I)},[I,R]);return W.useEffect(()=>()=>{C.current&&(window.clearTimeout(C.current),C.current=0)},[]),m.jsx(hI,{..._,children:m.jsx(fxe,{scope:t,contentId:T,open:D,stateAttribute:F,trigger:S,onTriggerChange:E,onTriggerEnter:W.useCallback(()=>{g.isOpenDelayedRef.current?Z():B()},[g.isOpenDelayedRef,Z,B]),onTriggerLeave:W.useCallback(()=>{N?U():(window.clearTimeout(C.current),C.current=0)},[U,N]),onOpen:B,onClose:U,disableHoverableContent:N,children:r})})};$J.displayName=TE;var DL="TooltipTrigger",UJ=W.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,o=yI(DL,r),l=RB(DL,r),d=gI(r),i=W.useRef(null),g=fi(t,i,o.onTriggerChange),_=W.useRef(!1),S=W.useRef(!1),E=W.useCallback(()=>_.current=!1,[]);return W.useEffect(()=>()=>document.removeEventListener("pointerup",E),[E]),m.jsx(NT,{asChild:!0,...d,children:m.jsx(wn.button,{"aria-describedby":o.open?o.contentId:void 0,"data-state":o.stateAttribute,...n,ref:g,onPointerMove:Rr(e.onPointerMove,T=>{T.pointerType!=="touch"&&!S.current&&!l.isPointerInTransitRef.current&&(o.onTriggerEnter(),S.current=!0)}),onPointerLeave:Rr(e.onPointerLeave,()=>{o.onTriggerLeave(),S.current=!1}),onPointerDown:Rr(e.onPointerDown,()=>{o.open&&o.onClose(),_.current=!0,document.addEventListener("pointerup",E,{once:!0})}),onFocus:Rr(e.onFocus,()=>{_.current||o.onOpen()}),onBlur:Rr(e.onBlur,o.onClose),onClick:Rr(e.onClick,o.onClose)})})});UJ.displayName=DL;var pxe="TooltipPortal",[zet,mxe]=mI(pxe,{forceMount:void 0}),I0="TooltipContent",VJ=W.forwardRef((e,t)=>{const r=mxe(I0,e.__scopeTooltip),{forceMount:n=r.forceMount,side:o="top",...l}=e,d=yI(I0,e.__scopeTooltip);return m.jsx(_s,{present:n||d.open,children:d.disableHoverableContent?m.jsx(qJ,{side:o,...l,ref:t}):m.jsx(gxe,{side:o,...l,ref:t})})}),gxe=W.forwardRef((e,t)=>{const r=yI(I0,e.__scopeTooltip),n=RB(I0,e.__scopeTooltip),o=W.useRef(null),l=fi(t,o),[d,i]=W.useState(null),{trigger:g,onClose:_}=r,S=o.current,{onPointerInTransitChange:E}=n,T=W.useCallback(()=>{i(null),E(!1)},[E]),C=W.useCallback((N,I)=>{const j=N.currentTarget,D={x:N.clientX,y:N.clientY},R=bxe(D,j.getBoundingClientRect()),F=wxe(D,R),B=Sxe(I.getBoundingClientRect()),U=Txe([...F,...B]);i(U),E(!0)},[E]);return W.useEffect(()=>()=>T(),[T]),W.useEffect(()=>{if(g&&S){const N=j=>C(j,S),I=j=>C(j,g);return g.addEventListener("pointerleave",N),S.addEventListener("pointerleave",I),()=>{g.removeEventListener("pointerleave",N),S.removeEventListener("pointerleave",I)}}},[g,S,C,T]),W.useEffect(()=>{if(d){const N=I=>{const j=I.target,D={x:I.clientX,y:I.clientY},R=(g==null?void 0:g.contains(j))||(S==null?void 0:S.contains(j)),F=!Exe(D,d);R?T():F&&(T(),_())};return document.addEventListener("pointermove",N),()=>document.removeEventListener("pointermove",N)}},[g,S,d,_,T]),m.jsx(qJ,{...e,ref:l})}),[yxe,vxe]=mI(TE,{isInside:!1}),_xe=PY("TooltipContent"),qJ=W.forwardRef((e,t)=>{const{__scopeTooltip:r,children:n,"aria-label":o,onEscapeKeyDown:l,onPointerDownOutside:d,...i}=e,g=yI(I0,r),_=gI(r),{onClose:S}=g;return W.useEffect(()=>(document.addEventListener(ML,S),()=>document.removeEventListener(ML,S)),[S]),W.useEffect(()=>{if(g.trigger){const E=T=>{const C=T.target;C!=null&&C.contains(g.trigger)&&S()};return window.addEventListener("scroll",E,{capture:!0}),()=>window.removeEventListener("scroll",E,{capture:!0})}},[g.trigger,S]),m.jsx(Pv,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:E=>E.preventDefault(),onDismiss:S,children:m.jsxs(fI,{"data-state":g.stateAttribute,..._,...i,ref:t,style:{...i.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[m.jsx(_xe,{children:n}),m.jsx(yxe,{scope:r,isInside:!0,children:m.jsx(Fge,{id:g.contentId,role:"tooltip",children:o||n})})]})})});VJ.displayName=I0;var WJ="TooltipArrow",xxe=W.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,o=gI(r);return vxe(WJ,r).isInside?null:m.jsx(pI,{...o,...n,ref:t})});xxe.displayName=WJ;function bxe(e,t){const r=Math.abs(t.top-e.y),n=Math.abs(t.bottom-e.y),o=Math.abs(t.right-e.x),l=Math.abs(t.left-e.x);switch(Math.min(r,n,o,l)){case l:return"left";case o:return"right";case r:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function wxe(e,t,r=5){const n=[];switch(t){case"top":n.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":n.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":n.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":n.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r});break}return n}function Sxe(e){const{top:t,right:r,bottom:n,left:o}=e;return[{x:o,y:t},{x:r,y:t},{x:r,y:n},{x:o,y:n}]}function Exe(e,t){const{x:r,y:n}=e;let o=!1;for(let l=0,d=t.length-1;l<t.length;d=l++){const i=t[l],g=t[d],_=i.x,S=i.y,E=g.x,T=g.y;S>n!=T>n&&r<(E-_)*(n-S)/(T-S)+_&&(o=!o)}return o}function Txe(e){const t=e.slice();return t.sort((r,n)=>r.x<n.x?-1:r.x>n.x?1:r.y<n.y?-1:r.y>n.y?1:0),Axe(t)}function Axe(e){if(e.length<=1)return e.slice();const t=[];for(let n=0;n<e.length;n++){const o=e[n];for(;t.length>=2;){const l=t[t.length-1],d=t[t.length-2];if((l.x-d.x)*(o.y-d.y)>=(l.y-d.y)*(o.x-d.x))t.pop();else break}t.push(o)}t.pop();const r=[];for(let n=e.length-1;n>=0;n--){const o=e[n];for(;r.length>=2;){const l=r[r.length-1],d=r[r.length-2];if((l.x-d.x)*(o.y-d.y)>=(l.y-d.y)*(o.x-d.x))r.pop();else break}r.push(o)}return r.pop(),t.length===1&&r.length===1&&t[0].x===r[0].x&&t[0].y===r[0].y?t:t.concat(r)}var Pxe=BJ,Cxe=$J,Oxe=UJ,GJ=VJ;const HJ=Pxe,kxe=Cxe,Ixe=Oxe,KJ=W.forwardRef(({className:e,sideOffset:t=4,...r},n)=>m.jsx(GJ,{ref:n,sideOffset:t,className:yr("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r}));KJ.displayName=GJ.displayName;var Pb=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},cv=typeof window>"u"||"Deno"in globalThis;function Ll(){}function Rxe(e,t){return typeof e=="function"?e(t):e}function LL(e){return typeof e=="number"&&e>=0&&e!==1/0}function ZJ(e,t){return Math.max(e+(t||0)-Date.now(),0)}function Mm(e,t){return typeof e=="function"?e(t):e}function gu(e,t){return typeof e=="function"?e(t):e}function Uq(e,t){const{type:r="all",exact:n,fetchStatus:o,predicate:l,queryKey:d,stale:i}=e;if(d){if(n){if(t.queryHash!==jB(d,t.options))return!1}else if(!AE(t.queryKey,d))return!1}if(r!=="all"){const g=t.isActive();if(r==="active"&&!g||r==="inactive"&&g)return!1}return!(typeof i=="boolean"&&t.isStale()!==i||o&&o!==t.state.fetchStatus||l&&!l(t))}function Vq(e,t){const{exact:r,status:n,predicate:o,mutationKey:l}=e;if(l){if(!t.options.mutationKey)return!1;if(r){if(uv(t.options.mutationKey)!==uv(l))return!1}else if(!AE(t.options.mutationKey,l))return!1}return!(n&&t.state.status!==n||o&&!o(t))}function jB(e,t){return((t==null?void 0:t.queryKeyHashFn)||uv)(e)}function uv(e){return JSON.stringify(e,(t,r)=>FL(r)?Object.keys(r).sort().reduce((n,o)=>(n[o]=r[o],n),{}):r)}function AE(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(r=>AE(e[r],t[r])):!1}function XJ(e,t){if(e===t)return e;const r=qq(e)&&qq(t);if(r||FL(e)&&FL(t)){const n=r?e:Object.keys(e),o=n.length,l=r?t:Object.keys(t),d=l.length,i=r?[]:{},g=new Set(n);let _=0;for(let S=0;S<d;S++){const E=r?S:l[S];(!r&&g.has(E)||r)&&e[E]===void 0&&t[E]===void 0?(i[E]=void 0,_++):(i[E]=XJ(e[E],t[E]),i[E]===e[E]&&e[E]!==void 0&&_++)}return o===d&&_===o?e:i}return t}function aO(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}function qq(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function FL(e){if(!Wq(e))return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(!Wq(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function Wq(e){return Object.prototype.toString.call(e)==="[object Object]"}function jxe(e){return new Promise(t=>{setTimeout(t,e)})}function zL(e,t,r){return typeof r.structuralSharing=="function"?r.structuralSharing(e,t):r.structuralSharing!==!1?XJ(e,t):t}function Nxe(e,t,r=0){const n=[...e,t];return r&&n.length>r?n.slice(1):n}function Mxe(e,t,r=0){const n=[t,...e];return r&&n.length>r?n.slice(0,-1):n}var NB=Symbol();function YJ(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===NB?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function JJ(e,t){return typeof e=="function"?e(...t):!!e}var Vy,dm,c0,tZ,Dxe=(tZ=class extends Pb{constructor(){super();Un(this,Vy);Un(this,dm);Un(this,c0);hn(this,c0,t=>{if(!cv&&window.addEventListener){const r=()=>t();return window.addEventListener("visibilitychange",r,!1),()=>{window.removeEventListener("visibilitychange",r)}}})}onSubscribe(){wt(this,dm)||this.setEventListener(wt(this,c0))}onUnsubscribe(){var t;this.hasListeners()||((t=wt(this,dm))==null||t.call(this),hn(this,dm,void 0))}setEventListener(t){var r;hn(this,c0,t),(r=wt(this,dm))==null||r.call(this),hn(this,dm,t(n=>{typeof n=="boolean"?this.setFocused(n):this.onFocus()}))}setFocused(t){wt(this,Vy)!==t&&(hn(this,Vy,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(r=>{r(t)})}isFocused(){var t;return typeof wt(this,Vy)=="boolean"?wt(this,Vy):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},Vy=new WeakMap,dm=new WeakMap,c0=new WeakMap,tZ),MB=new Dxe,u0,hm,d0,rZ,Lxe=(rZ=class extends Pb{constructor(){super();Un(this,u0,!0);Un(this,hm);Un(this,d0);hn(this,d0,t=>{if(!cv&&window.addEventListener){const r=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",r,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",n)}}})}onSubscribe(){wt(this,hm)||this.setEventListener(wt(this,d0))}onUnsubscribe(){var t;this.hasListeners()||((t=wt(this,hm))==null||t.call(this),hn(this,hm,void 0))}setEventListener(t){var r;hn(this,d0,t),(r=wt(this,hm))==null||r.call(this),hn(this,hm,t(this.setOnline.bind(this)))}setOnline(t){wt(this,u0)!==t&&(hn(this,u0,t),this.listeners.forEach(n=>{n(t)}))}isOnline(){return wt(this,u0)}},u0=new WeakMap,hm=new WeakMap,d0=new WeakMap,rZ),oO=new Lxe;function BL(){let e,t;const r=new Promise((o,l)=>{e=o,t=l});r.status="pending",r.catch(()=>{});function n(o){Object.assign(r,o),delete r.resolve,delete r.reject}return r.resolve=o=>{n({status:"fulfilled",value:o}),e(o)},r.reject=o=>{n({status:"rejected",reason:o}),t(o)},r}function Fxe(e){return Math.min(1e3*2**e,3e4)}function QJ(e){return(e??"online")==="online"?oO.isOnline():!0}var eQ=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function CM(e){return e instanceof eQ}function tQ(e){let t=!1,r=0,n=!1,o;const l=BL(),d=I=>{var j;n||(T(new eQ(I)),(j=e.abort)==null||j.call(e))},i=()=>{t=!0},g=()=>{t=!1},_=()=>MB.isFocused()&&(e.networkMode==="always"||oO.isOnline())&&e.canRun(),S=()=>QJ(e.networkMode)&&e.canRun(),E=I=>{var j;n||(n=!0,(j=e.onSuccess)==null||j.call(e,I),o==null||o(),l.resolve(I))},T=I=>{var j;n||(n=!0,(j=e.onError)==null||j.call(e,I),o==null||o(),l.reject(I))},C=()=>new Promise(I=>{var j;o=D=>{(n||_())&&I(D)},(j=e.onPause)==null||j.call(e)}).then(()=>{var I;o=void 0,n||(I=e.onContinue)==null||I.call(e)}),N=()=>{if(n)return;let I;const j=r===0?e.initialPromise:void 0;try{I=j??e.fn()}catch(D){I=Promise.reject(D)}Promise.resolve(I).then(E).catch(D=>{var Z;if(n)return;const R=e.retry??(cv?0:3),F=e.retryDelay??Fxe,B=typeof F=="function"?F(r,D):F,U=R===!0||typeof R=="number"&&r<R||typeof R=="function"&&R(r,D);if(t||!U){T(D);return}r++,(Z=e.onFail)==null||Z.call(e,r,D),jxe(B).then(()=>_()?void 0:C()).then(()=>{t?T(D):N()})})};return{promise:l,cancel:d,continue:()=>(o==null||o(),l),cancelRetry:i,continueRetry:g,canStart:S,start:()=>(S()?N():C().then(N),l)}}var zxe=e=>setTimeout(e,0);function Bxe(){let e=[],t=0,r=i=>{i()},n=i=>{i()},o=zxe;const l=i=>{t?e.push(i):o(()=>{r(i)})},d=()=>{const i=e;e=[],i.length&&o(()=>{n(()=>{i.forEach(g=>{r(g)})})})};return{batch:i=>{let g;t++;try{g=i()}finally{t--,t||d()}return g},batchCalls:i=>(...g)=>{l(()=>{i(...g)})},schedule:l,setNotifyFunction:i=>{r=i},setBatchNotifyFunction:i=>{n=i},setScheduler:i=>{o=i}}}var ps=Bxe(),qy,nZ,rQ=(nZ=class{constructor(){Un(this,qy)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),LL(this.gcTime)&&hn(this,qy,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(cv?1/0:5*60*1e3))}clearGcTimeout(){wt(this,qy)&&(clearTimeout(wt(this,qy)),hn(this,qy,void 0))}},qy=new WeakMap,nZ),h0,Wy,mu,Gy,al,bT,Hy,ud,hf,iZ,$xe=(iZ=class extends rQ{constructor(t){super();Un(this,ud);Un(this,h0);Un(this,Wy);Un(this,mu);Un(this,Gy);Un(this,al);Un(this,bT);Un(this,Hy);hn(this,Hy,!1),hn(this,bT,t.defaultOptions),this.setOptions(t.options),this.observers=[],hn(this,Gy,t.client),hn(this,mu,wt(this,Gy).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,hn(this,h0,Uxe(this.options)),this.state=t.state??wt(this,h0),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=wt(this,al))==null?void 0:t.promise}setOptions(t){this.options={...wt(this,bT),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&wt(this,mu).remove(this)}setData(t,r){const n=zL(this.state.data,t,this.options);return ji(this,ud,hf).call(this,{data:n,type:"success",dataUpdatedAt:r==null?void 0:r.updatedAt,manual:r==null?void 0:r.manual}),n}setState(t,r){ji(this,ud,hf).call(this,{type:"setState",state:t,setStateOptions:r})}cancel(t){var n,o;const r=(n=wt(this,al))==null?void 0:n.promise;return(o=wt(this,al))==null||o.cancel(t),r?r.then(Ll).catch(Ll):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(wt(this,h0))}isActive(){return this.observers.some(t=>gu(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===NB||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>Mm(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!ZJ(this.state.dataUpdatedAt,t)}onFocus(){var r;const t=this.observers.find(n=>n.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(r=wt(this,al))==null||r.continue()}onOnline(){var r;const t=this.observers.find(n=>n.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(r=wt(this,al))==null||r.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),wt(this,mu).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(r=>r!==t),this.observers.length||(wt(this,al)&&(wt(this,Hy)?wt(this,al).cancel({revert:!0}):wt(this,al).cancelRetry()),this.scheduleGc()),wt(this,mu).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||ji(this,ud,hf).call(this,{type:"invalidate"})}fetch(t,r){var _,S,E;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(r!=null&&r.cancelRefetch))this.cancel({silent:!0});else if(wt(this,al))return wt(this,al).continueRetry(),wt(this,al).promise}if(t&&this.setOptions(t),!this.options.queryFn){const T=this.observers.find(C=>C.options.queryFn);T&&this.setOptions(T.options)}const n=new AbortController,o=T=>{Object.defineProperty(T,"signal",{enumerable:!0,get:()=>(hn(this,Hy,!0),n.signal)})},l=()=>{const T=YJ(this.options,r),N=(()=>{const I={client:wt(this,Gy),queryKey:this.queryKey,meta:this.meta};return o(I),I})();return hn(this,Hy,!1),this.options.persister?this.options.persister(T,N,this):T(N)},i=(()=>{const T={fetchOptions:r,options:this.options,queryKey:this.queryKey,client:wt(this,Gy),state:this.state,fetchFn:l};return o(T),T})();(_=this.options.behavior)==null||_.onFetch(i,this),hn(this,Wy,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((S=i.fetchOptions)==null?void 0:S.meta))&&ji(this,ud,hf).call(this,{type:"fetch",meta:(E=i.fetchOptions)==null?void 0:E.meta});const g=T=>{var C,N,I,j;CM(T)&&T.silent||ji(this,ud,hf).call(this,{type:"error",error:T}),CM(T)||((N=(C=wt(this,mu).config).onError)==null||N.call(C,T,this),(j=(I=wt(this,mu).config).onSettled)==null||j.call(I,this.state.data,T,this)),this.scheduleGc()};return hn(this,al,tQ({initialPromise:r==null?void 0:r.initialPromise,fn:i.fetchFn,abort:n.abort.bind(n),onSuccess:T=>{var C,N,I,j;if(T===void 0){g(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(T)}catch(D){g(D);return}(N=(C=wt(this,mu).config).onSuccess)==null||N.call(C,T,this),(j=(I=wt(this,mu).config).onSettled)==null||j.call(I,T,this.state.error,this),this.scheduleGc()},onError:g,onFail:(T,C)=>{ji(this,ud,hf).call(this,{type:"failed",failureCount:T,error:C})},onPause:()=>{ji(this,ud,hf).call(this,{type:"pause"})},onContinue:()=>{ji(this,ud,hf).call(this,{type:"continue"})},retry:i.options.retry,retryDelay:i.options.retryDelay,networkMode:i.options.networkMode,canRun:()=>!0})),wt(this,al).start()}},h0=new WeakMap,Wy=new WeakMap,mu=new WeakMap,Gy=new WeakMap,al=new WeakMap,bT=new WeakMap,Hy=new WeakMap,ud=new WeakSet,hf=function(t){const r=n=>{switch(t.type){case"failed":return{...n,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...nQ(n.data,this.options),fetchMeta:t.meta??null};case"success":return hn(this,Wy,void 0),{...n,data:t.data,dataUpdateCount:n.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const o=t.error;return CM(o)&&o.revert&&wt(this,Wy)?{...wt(this,Wy),fetchStatus:"idle"}:{...n,error:o,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...t.state}}};this.state=r(this.state),ps.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),wt(this,mu).notify({query:this,type:"updated",action:t})})},iZ);function nQ(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:QJ(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function Uxe(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,r=t!==void 0,n=r?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var ah,aZ,Vxe=(aZ=class extends Pb{constructor(t={}){super();Un(this,ah);this.config=t,hn(this,ah,new Map)}build(t,r,n){const o=r.queryKey,l=r.queryHash??jB(o,r);let d=this.get(l);return d||(d=new $xe({client:t,queryKey:o,queryHash:l,options:t.defaultQueryOptions(r),state:n,defaultOptions:t.getQueryDefaults(o)}),this.add(d)),d}add(t){wt(this,ah).has(t.queryHash)||(wt(this,ah).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const r=wt(this,ah).get(t.queryHash);r&&(t.destroy(),r===t&&wt(this,ah).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){ps.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return wt(this,ah).get(t)}getAll(){return[...wt(this,ah).values()]}find(t){const r={exact:!0,...t};return this.getAll().find(n=>Uq(r,n))}findAll(t={}){const r=this.getAll();return Object.keys(t).length>0?r.filter(n=>Uq(t,n)):r}notify(t){ps.batch(()=>{this.listeners.forEach(r=>{r(t)})})}onFocus(){ps.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){ps.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},ah=new WeakMap,aZ),oh,Nl,Ky,sh,Gp,oZ,qxe=(oZ=class extends rQ{constructor(t){super();Un(this,sh);Un(this,oh);Un(this,Nl);Un(this,Ky);this.mutationId=t.mutationId,hn(this,Nl,t.mutationCache),hn(this,oh,[]),this.state=t.state||iQ(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){wt(this,oh).includes(t)||(wt(this,oh).push(t),this.clearGcTimeout(),wt(this,Nl).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){hn(this,oh,wt(this,oh).filter(r=>r!==t)),this.scheduleGc(),wt(this,Nl).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){wt(this,oh).length||(this.state.status==="pending"?this.scheduleGc():wt(this,Nl).remove(this))}continue(){var t;return((t=wt(this,Ky))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var l,d,i,g,_,S,E,T,C,N,I,j,D,R,F,B,U,Z,J,te;const r=()=>{ji(this,sh,Gp).call(this,{type:"continue"})};hn(this,Ky,tQ({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(ae,ne)=>{ji(this,sh,Gp).call(this,{type:"failed",failureCount:ae,error:ne})},onPause:()=>{ji(this,sh,Gp).call(this,{type:"pause"})},onContinue:r,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>wt(this,Nl).canRun(this)}));const n=this.state.status==="pending",o=!wt(this,Ky).canStart();try{if(n)r();else{ji(this,sh,Gp).call(this,{type:"pending",variables:t,isPaused:o}),await((d=(l=wt(this,Nl).config).onMutate)==null?void 0:d.call(l,t,this));const ne=await((g=(i=this.options).onMutate)==null?void 0:g.call(i,t));ne!==this.state.context&&ji(this,sh,Gp).call(this,{type:"pending",context:ne,variables:t,isPaused:o})}const ae=await wt(this,Ky).start();return await((S=(_=wt(this,Nl).config).onSuccess)==null?void 0:S.call(_,ae,t,this.state.context,this)),await((T=(E=this.options).onSuccess)==null?void 0:T.call(E,ae,t,this.state.context)),await((N=(C=wt(this,Nl).config).onSettled)==null?void 0:N.call(C,ae,null,this.state.variables,this.state.context,this)),await((j=(I=this.options).onSettled)==null?void 0:j.call(I,ae,null,t,this.state.context)),ji(this,sh,Gp).call(this,{type:"success",data:ae}),ae}catch(ae){try{throw await((R=(D=wt(this,Nl).config).onError)==null?void 0:R.call(D,ae,t,this.state.context,this)),await((B=(F=this.options).onError)==null?void 0:B.call(F,ae,t,this.state.context)),await((Z=(U=wt(this,Nl).config).onSettled)==null?void 0:Z.call(U,void 0,ae,this.state.variables,this.state.context,this)),await((te=(J=this.options).onSettled)==null?void 0:te.call(J,void 0,ae,t,this.state.context)),ae}finally{ji(this,sh,Gp).call(this,{type:"error",error:ae})}}finally{wt(this,Nl).runNext(this)}}},oh=new WeakMap,Nl=new WeakMap,Ky=new WeakMap,sh=new WeakSet,Gp=function(t){const r=n=>{switch(t.type){case"failed":return{...n,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...n,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:t.error,failureCount:n.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=r(this.state),ps.batch(()=>{wt(this,oh).forEach(n=>{n.onMutationUpdate(t)}),wt(this,Nl).notify({mutation:this,type:"updated",action:t})})},oZ);function iQ(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var gf,dd,wT,sZ,Wxe=(sZ=class extends Pb{constructor(t={}){super();Un(this,gf);Un(this,dd);Un(this,wT);this.config=t,hn(this,gf,new Set),hn(this,dd,new Map),hn(this,wT,0)}build(t,r,n){const o=new qxe({mutationCache:this,mutationId:++tP(this,wT)._,options:t.defaultMutationOptions(r),state:n});return this.add(o),o}add(t){wt(this,gf).add(t);const r=EP(t);if(typeof r=="string"){const n=wt(this,dd).get(r);n?n.push(t):wt(this,dd).set(r,[t])}this.notify({type:"added",mutation:t})}remove(t){if(wt(this,gf).delete(t)){const r=EP(t);if(typeof r=="string"){const n=wt(this,dd).get(r);if(n)if(n.length>1){const o=n.indexOf(t);o!==-1&&n.splice(o,1)}else n[0]===t&&wt(this,dd).delete(r)}}this.notify({type:"removed",mutation:t})}canRun(t){const r=EP(t);if(typeof r=="string"){const n=wt(this,dd).get(r),o=n==null?void 0:n.find(l=>l.state.status==="pending");return!o||o===t}else return!0}runNext(t){var n;const r=EP(t);if(typeof r=="string"){const o=(n=wt(this,dd).get(r))==null?void 0:n.find(l=>l!==t&&l.state.isPaused);return(o==null?void 0:o.continue())??Promise.resolve()}else return Promise.resolve()}clear(){ps.batch(()=>{wt(this,gf).forEach(t=>{this.notify({type:"removed",mutation:t})}),wt(this,gf).clear(),wt(this,dd).clear()})}getAll(){return Array.from(wt(this,gf))}find(t){const r={exact:!0,...t};return this.getAll().find(n=>Vq(r,n))}findAll(t={}){return this.getAll().filter(r=>Vq(t,r))}notify(t){ps.batch(()=>{this.listeners.forEach(r=>{r(t)})})}resumePausedMutations(){const t=this.getAll().filter(r=>r.state.isPaused);return ps.batch(()=>Promise.all(t.map(r=>r.continue().catch(Ll))))}},gf=new WeakMap,dd=new WeakMap,wT=new WeakMap,sZ);function EP(e){var t;return(t=e.options.scope)==null?void 0:t.id}function Gq(e){return{onFetch:(t,r)=>{var S,E,T,C,N;const n=t.options,o=(T=(E=(S=t.fetchOptions)==null?void 0:S.meta)==null?void 0:E.fetchMore)==null?void 0:T.direction,l=((C=t.state.data)==null?void 0:C.pages)||[],d=((N=t.state.data)==null?void 0:N.pageParams)||[];let i={pages:[],pageParams:[]},g=0;const _=async()=>{let I=!1;const j=F=>{Object.defineProperty(F,"signal",{enumerable:!0,get:()=>(t.signal.aborted?I=!0:t.signal.addEventListener("abort",()=>{I=!0}),t.signal)})},D=YJ(t.options,t.fetchOptions),R=async(F,B,U)=>{if(I)return Promise.reject();if(B==null&&F.pages.length)return Promise.resolve(F);const J=(()=>{const ie={client:t.client,queryKey:t.queryKey,pageParam:B,direction:U?"backward":"forward",meta:t.options.meta};return j(ie),ie})(),te=await D(J),{maxPages:ae}=t.options,ne=U?Mxe:Nxe;return{pages:ne(F.pages,te,ae),pageParams:ne(F.pageParams,B,ae)}};if(o&&l.length){const F=o==="backward",B=F?Gxe:Hq,U={pages:l,pageParams:d},Z=B(n,U);i=await R(U,Z,F)}else{const F=e??l.length;do{const B=g===0?d[0]??n.initialPageParam:Hq(n,i);if(g>0&&B==null)break;i=await R(i,B),g++}while(g<F)}return i};t.options.persister?t.fetchFn=()=>{var I,j;return(j=(I=t.options).persister)==null?void 0:j.call(I,_,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},r)}:t.fetchFn=_}}}function Hq(e,{pages:t,pageParams:r}){const n=t.length-1;return t.length>0?e.getNextPageParam(t[n],t,r[n],r):void 0}function Gxe(e,{pages:t,pageParams:r}){var n;return t.length>0?(n=e.getPreviousPageParam)==null?void 0:n.call(e,t[0],t,r[0],r):void 0}var Po,fm,pm,f0,p0,mm,m0,g0,lZ,Hxe=(lZ=class{constructor(e={}){Un(this,Po);Un(this,fm);Un(this,pm);Un(this,f0);Un(this,p0);Un(this,mm);Un(this,m0);Un(this,g0);hn(this,Po,e.queryCache||new Vxe),hn(this,fm,e.mutationCache||new Wxe),hn(this,pm,e.defaultOptions||{}),hn(this,f0,new Map),hn(this,p0,new Map),hn(this,mm,0)}mount(){tP(this,mm)._++,wt(this,mm)===1&&(hn(this,m0,MB.subscribe(async e=>{e&&(await this.resumePausedMutations(),wt(this,Po).onFocus())})),hn(this,g0,oO.subscribe(async e=>{e&&(await this.resumePausedMutations(),wt(this,Po).onOnline())})))}unmount(){var e,t;tP(this,mm)._--,wt(this,mm)===0&&((e=wt(this,m0))==null||e.call(this),hn(this,m0,void 0),(t=wt(this,g0))==null||t.call(this),hn(this,g0,void 0))}isFetching(e){return wt(this,Po).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return wt(this,fm).findAll({...e,status:"pending"}).length}getQueryData(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=wt(this,Po).get(t.queryHash))==null?void 0:r.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),r=wt(this,Po).build(this,t),n=r.state.data;return n===void 0?this.fetchQuery(e):(e.revalidateIfStale&&r.isStaleByTime(Mm(t.staleTime,r))&&this.prefetchQuery(t),Promise.resolve(n))}getQueriesData(e){return wt(this,Po).findAll(e).map(({queryKey:t,state:r})=>{const n=r.data;return[t,n]})}setQueryData(e,t,r){const n=this.defaultQueryOptions({queryKey:e}),o=wt(this,Po).get(n.queryHash),l=o==null?void 0:o.state.data,d=Rxe(t,l);if(d!==void 0)return wt(this,Po).build(this,n).setData(d,{...r,manual:!0})}setQueriesData(e,t,r){return ps.batch(()=>wt(this,Po).findAll(e).map(({queryKey:n})=>[n,this.setQueryData(n,t,r)]))}getQueryState(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=wt(this,Po).get(t.queryHash))==null?void 0:r.state}removeQueries(e){const t=wt(this,Po);ps.batch(()=>{t.findAll(e).forEach(r=>{t.remove(r)})})}resetQueries(e,t){const r=wt(this,Po);return ps.batch(()=>(r.findAll(e).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const r={revert:!0,...t},n=ps.batch(()=>wt(this,Po).findAll(e).map(o=>o.cancel(r)));return Promise.all(n).then(Ll).catch(Ll)}invalidateQueries(e,t={}){return ps.batch(()=>(wt(this,Po).findAll(e).forEach(r=>{r.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const r={...t,cancelRefetch:t.cancelRefetch??!0},n=ps.batch(()=>wt(this,Po).findAll(e).filter(o=>!o.isDisabled()&&!o.isStatic()).map(o=>{let l=o.fetch(void 0,r);return r.throwOnError||(l=l.catch(Ll)),o.state.fetchStatus==="paused"?Promise.resolve():l}));return Promise.all(n).then(Ll)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const r=wt(this,Po).build(this,t);return r.isStaleByTime(Mm(t.staleTime,r))?r.fetch(t):Promise.resolve(r.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(Ll).catch(Ll)}fetchInfiniteQuery(e){return e.behavior=Gq(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(Ll).catch(Ll)}ensureInfiniteQueryData(e){return e.behavior=Gq(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return oO.isOnline()?wt(this,fm).resumePausedMutations():Promise.resolve()}getQueryCache(){return wt(this,Po)}getMutationCache(){return wt(this,fm)}getDefaultOptions(){return wt(this,pm)}setDefaultOptions(e){hn(this,pm,e)}setQueryDefaults(e,t){wt(this,f0).set(uv(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...wt(this,f0).values()],r={};return t.forEach(n=>{AE(e,n.queryKey)&&Object.assign(r,n.defaultOptions)}),r}setMutationDefaults(e,t){wt(this,p0).set(uv(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...wt(this,p0).values()],r={};return t.forEach(n=>{AE(e,n.mutationKey)&&Object.assign(r,n.defaultOptions)}),r}defaultQueryOptions(e){if(e._defaulted)return e;const t={...wt(this,pm).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=jB(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===NB&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...wt(this,pm).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){wt(this,Po).clear(),wt(this,fm).clear()}},Po=new WeakMap,fm=new WeakMap,pm=new WeakMap,f0=new WeakMap,p0=new WeakMap,mm=new WeakMap,m0=new WeakMap,g0=new WeakMap,lZ),uc,na,ST,Ml,Zy,y0,gm,ym,ET,v0,_0,Xy,Yy,vm,x0,ka,CS,$L,UL,VL,qL,WL,GL,HL,aQ,cZ,Kxe=(cZ=class extends Pb{constructor(t,r){super();Un(this,ka);Un(this,uc);Un(this,na);Un(this,ST);Un(this,Ml);Un(this,Zy);Un(this,y0);Un(this,gm);Un(this,ym);Un(this,ET);Un(this,v0);Un(this,_0);Un(this,Xy);Un(this,Yy);Un(this,vm);Un(this,x0,new Set);this.options=r,hn(this,uc,t),hn(this,ym,null),hn(this,gm,BL()),this.options.experimental_prefetchInRender||wt(this,gm).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(r)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(wt(this,na).addObserver(this),Kq(wt(this,na),this.options)?ji(this,ka,CS).call(this):this.updateResult(),ji(this,ka,qL).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return KL(wt(this,na),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return KL(wt(this,na),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,ji(this,ka,WL).call(this),ji(this,ka,GL).call(this),wt(this,na).removeObserver(this)}setOptions(t){const r=this.options,n=wt(this,na);if(this.options=wt(this,uc).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof gu(this.options.enabled,wt(this,na))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");ji(this,ka,HL).call(this),wt(this,na).setOptions(this.options),r._defaulted&&!aO(this.options,r)&&wt(this,uc).getQueryCache().notify({type:"observerOptionsUpdated",query:wt(this,na),observer:this});const o=this.hasListeners();o&&Zq(wt(this,na),n,this.options,r)&&ji(this,ka,CS).call(this),this.updateResult(),o&&(wt(this,na)!==n||gu(this.options.enabled,wt(this,na))!==gu(r.enabled,wt(this,na))||Mm(this.options.staleTime,wt(this,na))!==Mm(r.staleTime,wt(this,na)))&&ji(this,ka,$L).call(this);const l=ji(this,ka,UL).call(this);o&&(wt(this,na)!==n||gu(this.options.enabled,wt(this,na))!==gu(r.enabled,wt(this,na))||l!==wt(this,vm))&&ji(this,ka,VL).call(this,l)}getOptimisticResult(t){const r=wt(this,uc).getQueryCache().build(wt(this,uc),t),n=this.createResult(r,t);return Xxe(this,n)&&(hn(this,Ml,n),hn(this,y0,this.options),hn(this,Zy,wt(this,na).state)),n}getCurrentResult(){return wt(this,Ml)}trackResult(t,r){return new Proxy(t,{get:(n,o)=>(this.trackProp(o),r==null||r(o),Reflect.get(n,o))})}trackProp(t){wt(this,x0).add(t)}getCurrentQuery(){return wt(this,na)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const r=wt(this,uc).defaultQueryOptions(t),n=wt(this,uc).getQueryCache().build(wt(this,uc),r);return n.fetch().then(()=>this.createResult(n,r))}fetch(t){return ji(this,ka,CS).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),wt(this,Ml)))}createResult(t,r){var ae;const n=wt(this,na),o=this.options,l=wt(this,Ml),d=wt(this,Zy),i=wt(this,y0),_=t!==n?t.state:wt(this,ST),{state:S}=t;let E={...S},T=!1,C;if(r._optimisticResults){const ne=this.hasListeners(),ie=!ne&&Kq(t,r),ee=ne&&Zq(t,n,r,o);(ie||ee)&&(E={...E,...nQ(S.data,t.options)}),r._optimisticResults==="isRestoring"&&(E.fetchStatus="idle")}let{error:N,errorUpdatedAt:I,status:j}=E;C=E.data;let D=!1;if(r.placeholderData!==void 0&&C===void 0&&j==="pending"){let ne;l!=null&&l.isPlaceholderData&&r.placeholderData===(i==null?void 0:i.placeholderData)?(ne=l.data,D=!0):ne=typeof r.placeholderData=="function"?r.placeholderData((ae=wt(this,_0))==null?void 0:ae.state.data,wt(this,_0)):r.placeholderData,ne!==void 0&&(j="success",C=zL(l==null?void 0:l.data,ne,r),T=!0)}if(r.select&&C!==void 0&&!D)if(l&&C===(d==null?void 0:d.data)&&r.select===wt(this,ET))C=wt(this,v0);else try{hn(this,ET,r.select),C=r.select(C),C=zL(l==null?void 0:l.data,C,r),hn(this,v0,C),hn(this,ym,null)}catch(ne){hn(this,ym,ne)}wt(this,ym)&&(N=wt(this,ym),C=wt(this,v0),I=Date.now(),j="error");const R=E.fetchStatus==="fetching",F=j==="pending",B=j==="error",U=F&&R,Z=C!==void 0,te={status:j,fetchStatus:E.fetchStatus,isPending:F,isSuccess:j==="success",isError:B,isInitialLoading:U,isLoading:U,data:C,dataUpdatedAt:E.dataUpdatedAt,error:N,errorUpdatedAt:I,failureCount:E.fetchFailureCount,failureReason:E.fetchFailureReason,errorUpdateCount:E.errorUpdateCount,isFetched:E.dataUpdateCount>0||E.errorUpdateCount>0,isFetchedAfterMount:E.dataUpdateCount>_.dataUpdateCount||E.errorUpdateCount>_.errorUpdateCount,isFetching:R,isRefetching:R&&!F,isLoadingError:B&&!Z,isPaused:E.fetchStatus==="paused",isPlaceholderData:T,isRefetchError:B&&Z,isStale:DB(t,r),refetch:this.refetch,promise:wt(this,gm),isEnabled:gu(r.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const ne=oe=>{te.status==="error"?oe.reject(te.error):te.data!==void 0&&oe.resolve(te.data)},ie=()=>{const oe=hn(this,gm,te.promise=BL());ne(oe)},ee=wt(this,gm);switch(ee.status){case"pending":t.queryHash===n.queryHash&&ne(ee);break;case"fulfilled":(te.status==="error"||te.data!==ee.value)&&ie();break;case"rejected":(te.status!=="error"||te.error!==ee.reason)&&ie();break}}return te}updateResult(){const t=wt(this,Ml),r=this.createResult(wt(this,na),this.options);if(hn(this,Zy,wt(this,na).state),hn(this,y0,this.options),wt(this,Zy).data!==void 0&&hn(this,_0,wt(this,na)),aO(r,t))return;hn(this,Ml,r);const n=()=>{if(!t)return!0;const{notifyOnChangeProps:o}=this.options,l=typeof o=="function"?o():o;if(l==="all"||!l&&!wt(this,x0).size)return!0;const d=new Set(l??wt(this,x0));return this.options.throwOnError&&d.add("error"),Object.keys(wt(this,Ml)).some(i=>{const g=i;return wt(this,Ml)[g]!==t[g]&&d.has(g)})};ji(this,ka,aQ).call(this,{listeners:n()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&ji(this,ka,qL).call(this)}},uc=new WeakMap,na=new WeakMap,ST=new WeakMap,Ml=new WeakMap,Zy=new WeakMap,y0=new WeakMap,gm=new WeakMap,ym=new WeakMap,ET=new WeakMap,v0=new WeakMap,_0=new WeakMap,Xy=new WeakMap,Yy=new WeakMap,vm=new WeakMap,x0=new WeakMap,ka=new WeakSet,CS=function(t){ji(this,ka,HL).call(this);let r=wt(this,na).fetch(this.options,t);return t!=null&&t.throwOnError||(r=r.catch(Ll)),r},$L=function(){ji(this,ka,WL).call(this);const t=Mm(this.options.staleTime,wt(this,na));if(cv||wt(this,Ml).isStale||!LL(t))return;const n=ZJ(wt(this,Ml).dataUpdatedAt,t)+1;hn(this,Xy,setTimeout(()=>{wt(this,Ml).isStale||this.updateResult()},n))},UL=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(wt(this,na)):this.options.refetchInterval)??!1},VL=function(t){ji(this,ka,GL).call(this),hn(this,vm,t),!(cv||gu(this.options.enabled,wt(this,na))===!1||!LL(wt(this,vm))||wt(this,vm)===0)&&hn(this,Yy,setInterval(()=>{(this.options.refetchIntervalInBackground||MB.isFocused())&&ji(this,ka,CS).call(this)},wt(this,vm)))},qL=function(){ji(this,ka,$L).call(this),ji(this,ka,VL).call(this,ji(this,ka,UL).call(this))},WL=function(){wt(this,Xy)&&(clearTimeout(wt(this,Xy)),hn(this,Xy,void 0))},GL=function(){wt(this,Yy)&&(clearInterval(wt(this,Yy)),hn(this,Yy,void 0))},HL=function(){const t=wt(this,uc).getQueryCache().build(wt(this,uc),this.options);if(t===wt(this,na))return;const r=wt(this,na);hn(this,na,t),hn(this,ST,t.state),this.hasListeners()&&(r==null||r.removeObserver(this),t.addObserver(this))},aQ=function(t){ps.batch(()=>{t.listeners&&this.listeners.forEach(r=>{r(wt(this,Ml))}),wt(this,uc).getQueryCache().notify({query:wt(this,na),type:"observerResultsUpdated"})})},cZ);function Zxe(e,t){return gu(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function Kq(e,t){return Zxe(e,t)||e.state.data!==void 0&&KL(e,t,t.refetchOnMount)}function KL(e,t,r){if(gu(t.enabled,e)!==!1&&Mm(t.staleTime,e)!=="static"){const n=typeof r=="function"?r(e):r;return n==="always"||n!==!1&&DB(e,t)}return!1}function Zq(e,t,r,n){return(e!==t||gu(n.enabled,e)===!1)&&(!r.suspense||e.state.status!=="error")&&DB(e,r)}function DB(e,t){return gu(t.enabled,e)!==!1&&e.isStaleByTime(Mm(t.staleTime,e))}function Xxe(e,t){return!aO(e.getCurrentResult(),t)}var _m,xm,dc,yf,If,mC,ZL,uZ,Yxe=(uZ=class extends Pb{constructor(r,n){super();Un(this,If);Un(this,_m);Un(this,xm);Un(this,dc);Un(this,yf);hn(this,_m,r),this.setOptions(n),this.bindMethods(),ji(this,If,mC).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(r){var o;const n=this.options;this.options=wt(this,_m).defaultMutationOptions(r),aO(this.options,n)||wt(this,_m).getMutationCache().notify({type:"observerOptionsUpdated",mutation:wt(this,dc),observer:this}),n!=null&&n.mutationKey&&this.options.mutationKey&&uv(n.mutationKey)!==uv(this.options.mutationKey)?this.reset():((o=wt(this,dc))==null?void 0:o.state.status)==="pending"&&wt(this,dc).setOptions(this.options)}onUnsubscribe(){var r;this.hasListeners()||(r=wt(this,dc))==null||r.removeObserver(this)}onMutationUpdate(r){ji(this,If,mC).call(this),ji(this,If,ZL).call(this,r)}getCurrentResult(){return wt(this,xm)}reset(){var r;(r=wt(this,dc))==null||r.removeObserver(this),hn(this,dc,void 0),ji(this,If,mC).call(this),ji(this,If,ZL).call(this)}mutate(r,n){var o;return hn(this,yf,n),(o=wt(this,dc))==null||o.removeObserver(this),hn(this,dc,wt(this,_m).getMutationCache().build(wt(this,_m),this.options)),wt(this,dc).addObserver(this),wt(this,dc).execute(r)}},_m=new WeakMap,xm=new WeakMap,dc=new WeakMap,yf=new WeakMap,If=new WeakSet,mC=function(){var n;const r=((n=wt(this,dc))==null?void 0:n.state)??iQ();hn(this,xm,{...r,isPending:r.status==="pending",isSuccess:r.status==="success",isError:r.status==="error",isIdle:r.status==="idle",mutate:this.mutate,reset:this.reset})},ZL=function(r){ps.batch(()=>{var n,o,l,d,i,g,_,S;if(wt(this,yf)&&this.hasListeners()){const E=wt(this,xm).variables,T=wt(this,xm).context;(r==null?void 0:r.type)==="success"?((o=(n=wt(this,yf)).onSuccess)==null||o.call(n,r.data,E,T),(d=(l=wt(this,yf)).onSettled)==null||d.call(l,r.data,null,E,T)):(r==null?void 0:r.type)==="error"&&((g=(i=wt(this,yf)).onError)==null||g.call(i,r.error,E,T),(S=(_=wt(this,yf)).onSettled)==null||S.call(_,void 0,r.error,E,T))}this.listeners.forEach(E=>{E(wt(this,xm))})})},uZ),oQ=W.createContext(void 0),Ma=e=>{const t=W.useContext(oQ);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},Jxe=({client:e,children:t})=>(W.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),m.jsx(oQ.Provider,{value:e,children:t})),sQ=W.createContext(!1),Qxe=()=>W.useContext(sQ);sQ.Provider;function e0e(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var t0e=W.createContext(e0e()),r0e=()=>W.useContext(t0e),n0e=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},i0e=e=>{W.useEffect(()=>{e.clearReset()},[e])},a0e=({result:e,errorResetBoundary:t,throwOnError:r,query:n,suspense:o})=>e.isError&&!t.isReset()&&!e.isFetching&&n&&(o&&e.data===void 0||JJ(r,[e.error,n])),o0e=e=>{if(e.suspense){const t=n=>n==="static"?n:Math.max(n??1e3,1e3),r=e.staleTime;e.staleTime=typeof r=="function"?(...n)=>t(r(...n)):t(r),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},s0e=(e,t)=>e.isLoading&&e.isFetching&&!t,l0e=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,Xq=(e,t,r)=>t.fetchOptimistic(e).catch(()=>{r.clearReset()});function c0e(e,t,r){var E,T,C,N,I;const n=Qxe(),o=r0e(),l=Ma(),d=l.defaultQueryOptions(e);(T=(E=l.getDefaultOptions().queries)==null?void 0:E._experimental_beforeQuery)==null||T.call(E,d),d._optimisticResults=n?"isRestoring":"optimistic",o0e(d),n0e(d,o),i0e(o);const i=!l.getQueryCache().get(d.queryHash),[g]=W.useState(()=>new t(l,d)),_=g.getOptimisticResult(d),S=!n&&e.subscribed!==!1;if(W.useSyncExternalStore(W.useCallback(j=>{const D=S?g.subscribe(ps.batchCalls(j)):Ll;return g.updateResult(),D},[g,S]),()=>g.getCurrentResult(),()=>g.getCurrentResult()),W.useEffect(()=>{g.setOptions(d)},[d,g]),l0e(d,_))throw Xq(d,g,o);if(a0e({result:_,errorResetBoundary:o,throwOnError:d.throwOnError,query:l.getQueryCache().get(d.queryHash),suspense:d.suspense}))throw _.error;if((N=(C=l.getDefaultOptions().queries)==null?void 0:C._experimental_afterQuery)==null||N.call(C,d,_),d.experimental_prefetchInRender&&!cv&&s0e(_,n)){const j=i?Xq(d,g,o):(I=l.getQueryCache().get(d.queryHash))==null?void 0:I.promise;j==null||j.catch(Ll).finally(()=>{g.updateResult()})}return d.notifyOnChangeProps?_:g.trackResult(_)}function Li(e,t){return c0e(e,Kxe)}function Ya(e,t){const r=Ma(),[n]=W.useState(()=>new Yxe(r,e));W.useEffect(()=>{n.setOptions(e)},[n,e]);const o=W.useSyncExternalStore(W.useCallback(d=>n.subscribe(ps.batchCalls(d)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),l=W.useCallback((d,i)=>{n.mutate(d,i).catch(Ll)},[n]);if(o.error&&JJ(n.options.throwOnError,[o.error]))throw o.error;return{...o,mutate:l,mutateAsync:o.mutate}}/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function PE(){return PE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},PE.apply(this,arguments)}var Sm;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Sm||(Sm={}));const Yq="popstate";function u0e(e){e===void 0&&(e={});function t(n,o){let{pathname:l,search:d,hash:i}=n.location;return XL("",{pathname:l,search:d,hash:i},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function r(n,o){return typeof o=="string"?o:sO(o)}return h0e(t,r,null,e)}function Fo(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function lQ(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function d0e(){return Math.random().toString(36).substr(2,8)}function Jq(e,t){return{usr:e.state,key:e.key,idx:t}}function XL(e,t,r,n){return r===void 0&&(r=null),PE({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Cb(t):t,{state:r,key:t&&t.key||n||d0e()})}function sO(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Cb(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function h0e(e,t,r,n){n===void 0&&(n={});let{window:o=document.defaultView,v5Compat:l=!1}=n,d=o.history,i=Sm.Pop,g=null,_=S();_==null&&(_=0,d.replaceState(PE({},d.state,{idx:_}),""));function S(){return(d.state||{idx:null}).idx}function E(){i=Sm.Pop;let j=S(),D=j==null?null:j-_;_=j,g&&g({action:i,location:I.location,delta:D})}function T(j,D){i=Sm.Push;let R=XL(I.location,j,D);_=S()+1;let F=Jq(R,_),B=I.createHref(R);try{d.pushState(F,"",B)}catch(U){if(U instanceof DOMException&&U.name==="DataCloneError")throw U;o.location.assign(B)}l&&g&&g({action:i,location:I.location,delta:1})}function C(j,D){i=Sm.Replace;let R=XL(I.location,j,D);_=S();let F=Jq(R,_),B=I.createHref(R);d.replaceState(F,"",B),l&&g&&g({action:i,location:I.location,delta:0})}function N(j){let D=o.location.origin!=="null"?o.location.origin:o.location.href,R=typeof j=="string"?j:sO(j);return R=R.replace(/ $/,"%20"),Fo(D,"No window.location.(origin|href) available to create URL for href: "+R),new URL(R,D)}let I={get action(){return i},get location(){return e(o,d)},listen(j){if(g)throw new Error("A history only accepts one active listener");return o.addEventListener(Yq,E),g=j,()=>{o.removeEventListener(Yq,E),g=null}},createHref(j){return t(o,j)},createURL:N,encodeLocation(j){let D=N(j);return{pathname:D.pathname,search:D.search,hash:D.hash}},push:T,replace:C,go(j){return d.go(j)}};return I}var Qq;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(Qq||(Qq={}));function f0e(e,t,r){return r===void 0&&(r="/"),p0e(e,t,r,!1)}function p0e(e,t,r,n){let o=typeof t=="string"?Cb(t):t,l=LB(o.pathname||"/",r);if(l==null)return null;let d=cQ(e);m0e(d);let i=null;for(let g=0;i==null&&g<d.length;++g){let _=A0e(l);i=E0e(d[g],_,n)}return i}function cQ(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let o=(l,d,i)=>{let g={relativePath:i===void 0?l.path||"":i,caseSensitive:l.caseSensitive===!0,childrenIndex:d,route:l};g.relativePath.startsWith("/")&&(Fo(g.relativePath.startsWith(n),'Absolute route path "'+g.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),g.relativePath=g.relativePath.slice(n.length));let _=Dm([n,g.relativePath]),S=r.concat(g);l.children&&l.children.length>0&&(Fo(l.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+_+'".')),cQ(l.children,t,S,_)),!(l.path==null&&!l.index)&&t.push({path:_,score:w0e(_,l.index),routesMeta:S})};return e.forEach((l,d)=>{var i;if(l.path===""||!((i=l.path)!=null&&i.includes("?")))o(l,d);else for(let g of uQ(l.path))o(l,d,g)}),t}function uQ(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,o=r.endsWith("?"),l=r.replace(/\?$/,"");if(n.length===0)return o?[l,""]:[l];let d=uQ(n.join("/")),i=[];return i.push(...d.map(g=>g===""?l:[l,g].join("/"))),o&&i.push(...d),i.map(g=>e.startsWith("/")&&g===""?"/":g)}function m0e(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:S0e(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const g0e=/^:[\w-]+$/,y0e=3,v0e=2,_0e=1,x0e=10,b0e=-2,e9=e=>e==="*";function w0e(e,t){let r=e.split("/"),n=r.length;return r.some(e9)&&(n+=b0e),t&&(n+=v0e),r.filter(o=>!e9(o)).reduce((o,l)=>o+(g0e.test(l)?y0e:l===""?_0e:x0e),n)}function S0e(e,t){return e.length===t.length&&e.slice(0,-1).every((n,o)=>n===t[o])?e[e.length-1]-t[t.length-1]:0}function E0e(e,t,r){let{routesMeta:n}=e,o={},l="/",d=[];for(let i=0;i<n.length;++i){let g=n[i],_=i===n.length-1,S=l==="/"?t:t.slice(l.length)||"/",E=t9({path:g.relativePath,caseSensitive:g.caseSensitive,end:_},S),T=g.route;if(!E&&_&&r&&!n[n.length-1].route.index&&(E=t9({path:g.relativePath,caseSensitive:g.caseSensitive,end:!1},S)),!E)return null;Object.assign(o,E.params),d.push({params:o,pathname:Dm([l,E.pathname]),pathnameBase:k0e(Dm([l,E.pathnameBase])),route:T}),E.pathnameBase!=="/"&&(l=Dm([l,E.pathnameBase]))}return d}function t9(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=T0e(e.path,e.caseSensitive,e.end),o=t.match(r);if(!o)return null;let l=o[0],d=l.replace(/(.)\/+$/,"$1"),i=o.slice(1);return{params:n.reduce((_,S,E)=>{let{paramName:T,isOptional:C}=S;if(T==="*"){let I=i[E]||"";d=l.slice(0,l.length-I.length).replace(/(.)\/+$/,"$1")}const N=i[E];return C&&!N?_[T]=void 0:_[T]=(N||"").replace(/%2F/g,"/"),_},{}),pathname:l,pathnameBase:d,pattern:e}}function T0e(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),lQ(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],o="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(d,i,g)=>(n.push({paramName:i,isOptional:g!=null}),g?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),o+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?o+="\\/*$":e!==""&&e!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),n]}function A0e(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return lQ(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function LB(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function P0e(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:o=""}=typeof e=="string"?Cb(e):e;return{pathname:r?r.startsWith("/")?r:C0e(r,t):t,search:I0e(n),hash:R0e(o)}}function C0e(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(o=>{o===".."?r.length>1&&r.pop():o!=="."&&r.push(o)}),r.length>1?r.join("/"):"/"}function OM(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function O0e(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function FB(e,t){let r=O0e(e);return t?r.map((n,o)=>o===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function zB(e,t,r,n){n===void 0&&(n=!1);let o;typeof e=="string"?o=Cb(e):(o=PE({},e),Fo(!o.pathname||!o.pathname.includes("?"),OM("?","pathname","search",o)),Fo(!o.pathname||!o.pathname.includes("#"),OM("#","pathname","hash",o)),Fo(!o.search||!o.search.includes("#"),OM("#","search","hash",o)));let l=e===""||o.pathname==="",d=l?"/":o.pathname,i;if(d==null)i=r;else{let E=t.length-1;if(!n&&d.startsWith("..")){let T=d.split("/");for(;T[0]==="..";)T.shift(),E-=1;o.pathname=T.join("/")}i=E>=0?t[E]:"/"}let g=P0e(o,i),_=d&&d!=="/"&&d.endsWith("/"),S=(l||d===".")&&r.endsWith("/");return!g.pathname.endsWith("/")&&(_||S)&&(g.pathname+="/"),g}const Dm=e=>e.join("/").replace(/\/\/+/g,"/"),k0e=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),I0e=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,R0e=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function j0e(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const dQ=["post","put","patch","delete"];new Set(dQ);const N0e=["get",...dQ];new Set(N0e);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function CE(){return CE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},CE.apply(this,arguments)}const BB=W.createContext(null),M0e=W.createContext(null),ng=W.createContext(null),vI=W.createContext(null),Vf=W.createContext({outlet:null,matches:[],isDataRoute:!1}),hQ=W.createContext(null);function D0e(e,t){let{relative:r}=t===void 0?{}:t;Ob()||Fo(!1);let{basename:n,navigator:o}=W.useContext(ng),{hash:l,pathname:d,search:i}=mQ(e,{relative:r}),g=d;return n!=="/"&&(g=d==="/"?n:Dm([n,d])),o.createHref({pathname:g,search:i,hash:l})}function Ob(){return W.useContext(vI)!=null}function Rh(){return Ob()||Fo(!1),W.useContext(vI).location}function fQ(e){W.useContext(ng).static||W.useLayoutEffect(e)}function qf(){let{isDataRoute:e}=W.useContext(Vf);return e?Z0e():L0e()}function L0e(){Ob()||Fo(!1);let e=W.useContext(BB),{basename:t,future:r,navigator:n}=W.useContext(ng),{matches:o}=W.useContext(Vf),{pathname:l}=Rh(),d=JSON.stringify(FB(o,r.v7_relativeSplatPath)),i=W.useRef(!1);return fQ(()=>{i.current=!0}),W.useCallback(function(_,S){if(S===void 0&&(S={}),!i.current)return;if(typeof _=="number"){n.go(_);return}let E=zB(_,JSON.parse(d),l,S.relative==="path");e==null&&t!=="/"&&(E.pathname=E.pathname==="/"?t:Dm([t,E.pathname])),(S.replace?n.replace:n.push)(E,S.state,S)},[t,n,d,l,e])}function pQ(){let{matches:e}=W.useContext(Vf),t=e[e.length-1];return t?t.params:{}}function mQ(e,t){let{relative:r}=t===void 0?{}:t,{future:n}=W.useContext(ng),{matches:o}=W.useContext(Vf),{pathname:l}=Rh(),d=JSON.stringify(FB(o,n.v7_relativeSplatPath));return W.useMemo(()=>zB(e,JSON.parse(d),l,r==="path"),[e,d,l,r])}function F0e(e,t){return z0e(e,t)}function z0e(e,t,r,n){Ob()||Fo(!1);let{navigator:o}=W.useContext(ng),{matches:l}=W.useContext(Vf),d=l[l.length-1],i=d?d.params:{};d&&d.pathname;let g=d?d.pathnameBase:"/";d&&d.route;let _=Rh(),S;if(t){var E;let j=typeof t=="string"?Cb(t):t;g==="/"||(E=j.pathname)!=null&&E.startsWith(g)||Fo(!1),S=j}else S=_;let T=S.pathname||"/",C=T;if(g!=="/"){let j=g.replace(/^\//,"").split("/");C="/"+T.replace(/^\//,"").split("/").slice(j.length).join("/")}let N=f0e(e,{pathname:C}),I=q0e(N&&N.map(j=>Object.assign({},j,{params:Object.assign({},i,j.params),pathname:Dm([g,o.encodeLocation?o.encodeLocation(j.pathname).pathname:j.pathname]),pathnameBase:j.pathnameBase==="/"?g:Dm([g,o.encodeLocation?o.encodeLocation(j.pathnameBase).pathname:j.pathnameBase])})),l,r,n);return t&&I?W.createElement(vI.Provider,{value:{location:CE({pathname:"/",search:"",hash:"",state:null,key:"default"},S),navigationType:Sm.Pop}},I):I}function B0e(){let e=K0e(),t=j0e(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,o={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return W.createElement(W.Fragment,null,W.createElement("h2",null,"Unexpected Application Error!"),W.createElement("h3",{style:{fontStyle:"italic"}},t),r?W.createElement("pre",{style:o},r):null,null)}const $0e=W.createElement(B0e,null);class U0e extends W.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?W.createElement(Vf.Provider,{value:this.props.routeContext},W.createElement(hQ.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function V0e(e){let{routeContext:t,match:r,children:n}=e,o=W.useContext(BB);return o&&o.static&&o.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=r.route.id),W.createElement(Vf.Provider,{value:t},n)}function q0e(e,t,r,n){var o;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var l;if(!r)return null;if(r.errors)e=r.matches;else if((l=n)!=null&&l.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let d=e,i=(o=r)==null?void 0:o.errors;if(i!=null){let S=d.findIndex(E=>E.route.id&&(i==null?void 0:i[E.route.id])!==void 0);S>=0||Fo(!1),d=d.slice(0,Math.min(d.length,S+1))}let g=!1,_=-1;if(r&&n&&n.v7_partialHydration)for(let S=0;S<d.length;S++){let E=d[S];if((E.route.HydrateFallback||E.route.hydrateFallbackElement)&&(_=S),E.route.id){let{loaderData:T,errors:C}=r,N=E.route.loader&&T[E.route.id]===void 0&&(!C||C[E.route.id]===void 0);if(E.route.lazy||N){g=!0,_>=0?d=d.slice(0,_+1):d=[d[0]];break}}}return d.reduceRight((S,E,T)=>{let C,N=!1,I=null,j=null;r&&(C=i&&E.route.id?i[E.route.id]:void 0,I=E.route.errorElement||$0e,g&&(_<0&&T===0?(N=!0,j=null):_===T&&(N=!0,j=E.route.hydrateFallbackElement||null)));let D=t.concat(d.slice(0,T+1)),R=()=>{let F;return C?F=I:N?F=j:E.route.Component?F=W.createElement(E.route.Component,null):E.route.element?F=E.route.element:F=S,W.createElement(V0e,{match:E,routeContext:{outlet:S,matches:D,isDataRoute:r!=null},children:F})};return r&&(E.route.ErrorBoundary||E.route.errorElement||T===0)?W.createElement(U0e,{location:r.location,revalidation:r.revalidation,component:I,error:C,children:R(),routeContext:{outlet:null,matches:D,isDataRoute:!0}}):R()},null)}var gQ=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(gQ||{}),lO=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(lO||{});function W0e(e){let t=W.useContext(BB);return t||Fo(!1),t}function G0e(e){let t=W.useContext(M0e);return t||Fo(!1),t}function H0e(e){let t=W.useContext(Vf);return t||Fo(!1),t}function yQ(e){let t=H0e(),r=t.matches[t.matches.length-1];return r.route.id||Fo(!1),r.route.id}function K0e(){var e;let t=W.useContext(hQ),r=G0e(lO.UseRouteError),n=yQ(lO.UseRouteError);return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}function Z0e(){let{router:e}=W0e(gQ.UseNavigateStable),t=yQ(lO.UseNavigateStable),r=W.useRef(!1);return fQ(()=>{r.current=!0}),W.useCallback(function(o,l){l===void 0&&(l={}),r.current&&(typeof o=="number"?e.navigate(o):e.navigate(o,CE({fromRouteId:t},l)))},[e,t])}function X0e(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function Y0e(e){let{to:t,replace:r,state:n,relative:o}=e;Ob()||Fo(!1);let{future:l,static:d}=W.useContext(ng),{matches:i}=W.useContext(Vf),{pathname:g}=Rh(),_=qf(),S=zB(t,FB(i,l.v7_relativeSplatPath),g,o==="path"),E=JSON.stringify(S);return W.useEffect(()=>_(JSON.parse(E),{replace:r,state:n,relative:o}),[_,E,o,r,n]),null}function cs(e){Fo(!1)}function J0e(e){let{basename:t="/",children:r=null,location:n,navigationType:o=Sm.Pop,navigator:l,static:d=!1,future:i}=e;Ob()&&Fo(!1);let g=t.replace(/^\/*/,"/"),_=W.useMemo(()=>({basename:g,navigator:l,static:d,future:CE({v7_relativeSplatPath:!1},i)}),[g,i,l,d]);typeof n=="string"&&(n=Cb(n));let{pathname:S="/",search:E="",hash:T="",state:C=null,key:N="default"}=n,I=W.useMemo(()=>{let j=LB(S,g);return j==null?null:{location:{pathname:j,search:E,hash:T,state:C,key:N},navigationType:o}},[g,S,E,T,C,N,o]);return I==null?null:W.createElement(ng.Provider,{value:_},W.createElement(vI.Provider,{children:r,value:I}))}function Q0e(e){let{children:t,location:r}=e;return F0e(YL(t),r)}new Promise(()=>{});function YL(e,t){t===void 0&&(t=[]);let r=[];return W.Children.forEach(e,(n,o)=>{if(!W.isValidElement(n))return;let l=[...t,o];if(n.type===W.Fragment){r.push.apply(r,YL(n.props.children,l));return}n.type!==cs&&Fo(!1),!n.props.index||!n.props.children||Fo(!1);let d={id:n.props.id||l.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(d.children=YL(n.props.children,l)),r.push(d)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function JL(){return JL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},JL.apply(this,arguments)}function ebe(e,t){if(e==null)return{};var r={},n=Object.keys(e),o,l;for(l=0;l<n.length;l++)o=n[l],!(t.indexOf(o)>=0)&&(r[o]=e[o]);return r}function tbe(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function rbe(e,t){return e.button===0&&(!t||t==="_self")&&!tbe(e)}const nbe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],ibe="6";try{window.__reactRouterVersion=ibe}catch{}const abe="startTransition",r9=_z[abe];function obe(e){let{basename:t,children:r,future:n,window:o}=e,l=W.useRef();l.current==null&&(l.current=u0e({window:o,v5Compat:!0}));let d=l.current,[i,g]=W.useState({action:d.action,location:d.location}),{v7_startTransition:_}=n||{},S=W.useCallback(E=>{_&&r9?r9(()=>g(E)):g(E)},[g,_]);return W.useLayoutEffect(()=>d.listen(S),[d,S]),W.useEffect(()=>X0e(n),[n]),W.createElement(J0e,{basename:t,children:r,location:i.location,navigationType:i.action,navigator:d,future:n})}const sbe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",lbe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ia=W.forwardRef(function(t,r){let{onClick:n,relative:o,reloadDocument:l,replace:d,state:i,target:g,to:_,preventScrollReset:S,viewTransition:E}=t,T=ebe(t,nbe),{basename:C}=W.useContext(ng),N,I=!1;if(typeof _=="string"&&lbe.test(_)&&(N=_,sbe))try{let F=new URL(window.location.href),B=_.startsWith("//")?new URL(F.protocol+_):new URL(_),U=LB(B.pathname,C);B.origin===F.origin&&U!=null?_=U+B.search+B.hash:I=!0}catch{}let j=D0e(_,{relative:o}),D=cbe(_,{replace:d,state:i,target:g,preventScrollReset:S,relative:o,viewTransition:E});function R(F){n&&n(F),F.defaultPrevented||D(F)}return W.createElement("a",JL({},T,{href:N||j,onClick:I||l?n:R,ref:r,target:g}))});var n9;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(n9||(n9={}));var i9;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(i9||(i9={}));function cbe(e,t){let{target:r,replace:n,state:o,preventScrollReset:l,relative:d,viewTransition:i}=t===void 0?{}:t,g=qf(),_=Rh(),S=mQ(e,{relative:d});return W.useCallback(E=>{if(rbe(E,r)){E.preventDefault();let T=n!==void 0?n:sO(_)===sO(S);g(e,{replace:T,state:o,preventScrollReset:l,relative:d,viewTransition:i})}},[_,g,S,n,o,r,e,l,d,i])}var QL=function(e,t){return QL=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},QL(e,t)};function vQ(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");QL(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var bu=function(){return bu=Object.assign||function(t){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(t[l]=r[l])}return t},bu.apply(this,arguments)};function ig(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]]);return r}function _Q(e,t,r,n){var o=arguments.length,l=o<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(d=e[i])&&(l=(o<3?d(l):o>3?d(t,r,l):d(t,r))||l);return o>3&&l&&Object.defineProperty(t,r,l),l}function xQ(e,t){return function(r,n){t(r,n,e)}}function bQ(e,t,r,n,o,l){function d(D){if(D!==void 0&&typeof D!="function")throw new TypeError("Function expected");return D}for(var i=n.kind,g=i==="getter"?"get":i==="setter"?"set":"value",_=!t&&e?n.static?e:e.prototype:null,S=t||(_?Object.getOwnPropertyDescriptor(_,n.name):{}),E,T=!1,C=r.length-1;C>=0;C--){var N={};for(var I in n)N[I]=I==="access"?{}:n[I];for(var I in n.access)N.access[I]=n.access[I];N.addInitializer=function(D){if(T)throw new TypeError("Cannot add initializers after decoration has completed");l.push(d(D||null))};var j=(0,r[C])(i==="accessor"?{get:S.get,set:S.set}:S[g],N);if(i==="accessor"){if(j===void 0)continue;if(j===null||typeof j!="object")throw new TypeError("Object expected");(E=d(j.get))&&(S.get=E),(E=d(j.set))&&(S.set=E),(E=d(j.init))&&o.unshift(E)}else(E=d(j))&&(i==="field"?o.unshift(E):S[g]=E)}_&&Object.defineProperty(_,n.name,S),T=!0}function wQ(e,t,r){for(var n=arguments.length>2,o=0;o<t.length;o++)r=n?t[o].call(e,r):t[o].call(e);return n?r:void 0}function SQ(e){return typeof e=="symbol"?e:"".concat(e)}function EQ(e,t,r){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function TQ(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function On(e,t,r,n){function o(l){return l instanceof r?l:new r(function(d){d(l)})}return new(r||(r=Promise))(function(l,d){function i(S){try{_(n.next(S))}catch(E){d(E)}}function g(S){try{_(n.throw(S))}catch(E){d(E)}}function _(S){S.done?l(S.value):o(S.value).then(i,g)}_((n=n.apply(e,t||[])).next())})}function AQ(e,t){var r={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},n,o,l,d=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return d.next=i(0),d.throw=i(1),d.return=i(2),typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function i(_){return function(S){return g([_,S])}}function g(_){if(n)throw new TypeError("Generator is already executing.");for(;d&&(d=0,_[0]&&(r=0)),r;)try{if(n=1,o&&(l=_[0]&2?o.return:_[0]?o.throw||((l=o.return)&&l.call(o),0):o.next)&&!(l=l.call(o,_[1])).done)return l;switch(o=0,l&&(_=[_[0]&2,l.value]),_[0]){case 0:case 1:l=_;break;case 4:return r.label++,{value:_[1],done:!1};case 5:r.label++,o=_[1],_=[0];continue;case 7:_=r.ops.pop(),r.trys.pop();continue;default:if(l=r.trys,!(l=l.length>0&&l[l.length-1])&&(_[0]===6||_[0]===2)){r=0;continue}if(_[0]===3&&(!l||_[1]>l[0]&&_[1]<l[3])){r.label=_[1];break}if(_[0]===6&&r.label<l[1]){r.label=l[1],l=_;break}if(l&&r.label<l[2]){r.label=l[2],r.ops.push(_);break}l[2]&&r.ops.pop(),r.trys.pop();continue}_=t.call(e,r)}catch(S){_=[6,S],o=0}finally{n=l=0}if(_[0]&5)throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}}var _I=Object.create?function(e,t,r,n){n===void 0&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]};function PQ(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&_I(t,e,r)}function cO(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function $B(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,l=[],d;try{for(;(t===void 0||t-- >0)&&!(o=n.next()).done;)l.push(o.value)}catch(i){d={error:i}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(d)throw d.error}}return l}function CQ(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat($B(arguments[t]));return e}function OQ(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),o=0,t=0;t<r;t++)for(var l=arguments[t],d=0,i=l.length;d<i;d++,o++)n[o]=l[d];return n}function UB(e,t,r){if(r||arguments.length===2)for(var n=0,o=t.length,l;n<o;n++)(l||!(n in t))&&(l||(l=Array.prototype.slice.call(t,0,n)),l[n]=t[n]);return e.concat(l||Array.prototype.slice.call(t))}function R0(e){return this instanceof R0?(this.v=e,this):new R0(e)}function kQ(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),o,l=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),i("next"),i("throw"),i("return",d),o[Symbol.asyncIterator]=function(){return this},o;function d(C){return function(N){return Promise.resolve(N).then(C,E)}}function i(C,N){n[C]&&(o[C]=function(I){return new Promise(function(j,D){l.push([C,I,j,D])>1||g(C,I)})},N&&(o[C]=N(o[C])))}function g(C,N){try{_(n[C](N))}catch(I){T(l[0][3],I)}}function _(C){C.value instanceof R0?Promise.resolve(C.value.v).then(S,E):T(l[0][2],C)}function S(C){g("next",C)}function E(C){g("throw",C)}function T(C,N){C(N),l.shift(),l.length&&g(l[0][0],l[0][1])}}function IQ(e){var t,r;return t={},n("next"),n("throw",function(o){throw o}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(o,l){t[o]=e[o]?function(d){return(r=!r)?{value:R0(e[o](d)),done:!1}:l?l(d):d}:l}}function RQ(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof cO=="function"?cO(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(l){r[l]=e[l]&&function(d){return new Promise(function(i,g){d=e[l](d),o(i,g,d.done,d.value)})}}function o(l,d,i,g){Promise.resolve(g).then(function(_){l({value:_,done:i})},d)}}function jQ(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var ube=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},e3=function(e){return e3=Object.getOwnPropertyNames||function(t){var r=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[r.length]=n);return r},e3(e)};function NQ(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=e3(e),n=0;n<r.length;n++)r[n]!=="default"&&_I(t,e,r[n]);return ube(t,e),t}function MQ(e){return e&&e.__esModule?e:{default:e}}function DQ(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)}function LQ(e,t,r,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,r):o?o.value=r:t.set(e,r),r}function FQ(e,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof e=="function"?t===e:e.has(t)}function zQ(e,t,r){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var n,o;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=t[Symbol.asyncDispose]}if(n===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=t[Symbol.dispose],r&&(o=n)}if(typeof n!="function")throw new TypeError("Object not disposable.");o&&(n=function(){try{o.call(this)}catch(l){return Promise.reject(l)}}),e.stack.push({value:t,dispose:n,async:r})}else r&&e.stack.push({async:!0});return t}var dbe=typeof SuppressedError=="function"?SuppressedError:function(e,t,r){var n=new Error(r);return n.name="SuppressedError",n.error=e,n.suppressed=t,n};function BQ(e){function t(l){e.error=e.hasError?new dbe(l,e.error,"An error was suppressed during disposal."):l,e.hasError=!0}var r,n=0;function o(){for(;r=e.stack.pop();)try{if(!r.async&&n===1)return n=0,e.stack.push(r),Promise.resolve().then(o);if(r.dispose){var l=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(l).then(o,function(d){return t(d),o()})}else n|=1}catch(d){t(d)}if(n===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return o()}function $Q(e,t){return typeof e=="string"&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(r,n,o,l,d){return n?t?".jsx":".js":o&&(!l||!d)?r:o+l+"."+d.toLowerCase()+"js"}):e}const hbe={__extends:vQ,__assign:bu,__rest:ig,__decorate:_Q,__param:xQ,__esDecorate:bQ,__runInitializers:wQ,__propKey:SQ,__setFunctionName:EQ,__metadata:TQ,__awaiter:On,__generator:AQ,__createBinding:_I,__exportStar:PQ,__values:cO,__read:$B,__spread:CQ,__spreadArrays:OQ,__spreadArray:UB,__await:R0,__asyncGenerator:kQ,__asyncDelegator:IQ,__asyncValues:RQ,__makeTemplateObject:jQ,__importStar:NQ,__importDefault:MQ,__classPrivateFieldGet:DQ,__classPrivateFieldSet:LQ,__classPrivateFieldIn:FQ,__addDisposableResource:zQ,__disposeResources:BQ,__rewriteRelativeImportExtension:$Q},fbe=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:zQ,get __assign(){return bu},__asyncDelegator:IQ,__asyncGenerator:kQ,__asyncValues:RQ,__await:R0,__awaiter:On,__classPrivateFieldGet:DQ,__classPrivateFieldIn:FQ,__classPrivateFieldSet:LQ,__createBinding:_I,__decorate:_Q,__disposeResources:BQ,__esDecorate:bQ,__exportStar:PQ,__extends:vQ,__generator:AQ,__importDefault:MQ,__importStar:NQ,__makeTemplateObject:jQ,__metadata:TQ,__param:xQ,__propKey:SQ,__read:$B,__rest:ig,__rewriteRelativeImportExtension:$Q,__runInitializers:wQ,__setFunctionName:EQ,__spread:CQ,__spreadArray:UB,__spreadArrays:OQ,__values:cO,default:hbe},Symbol.toStringTag,{value:"Module"})),pbe=e=>e?(...t)=>e(...t):(...t)=>fetch(...t);class xI extends Error{constructor(t,r="FunctionsError",n){super(t),this.name=r,this.context=n}}class UQ extends xI{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class t3 extends xI{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class r3 extends xI{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var uO;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(uO||(uO={}));class mbe{constructor(t,{headers:r={},customFetch:n,region:o=uO.Any}={}){this.url=t,this.headers=r,this.region=o,this.fetch=pbe(n)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return On(this,arguments,void 0,function*(r,n={}){var o;let l,d;try{const{headers:i,method:g,body:_,signal:S,timeout:E}=n;let T={},{region:C}=n;C||(C=this.region);const N=new URL(`${this.url}/${r}`);C&&C!=="any"&&(T["x-region"]=C,N.searchParams.set("forceFunctionRegion",C));let I;_&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)?typeof Blob<"u"&&_ instanceof Blob||_ instanceof ArrayBuffer?(T["Content-Type"]="application/octet-stream",I=_):typeof _=="string"?(T["Content-Type"]="text/plain",I=_):typeof FormData<"u"&&_ instanceof FormData?I=_:(T["Content-Type"]="application/json",I=JSON.stringify(_)):I=_;let j=S;E&&(d=new AbortController,l=setTimeout(()=>d.abort(),E),S?(j=d.signal,S.addEventListener("abort",()=>d.abort())):j=d.signal);const D=yield this.fetch(N.toString(),{method:g||"POST",headers:Object.assign(Object.assign(Object.assign({},T),this.headers),i),body:I,signal:j}).catch(U=>{throw new UQ(U)}),R=D.headers.get("x-relay-error");if(R&&R==="true")throw new t3(D);if(!D.ok)throw new r3(D);let F=((o=D.headers.get("Content-Type"))!==null&&o!==void 0?o:"text/plain").split(";")[0].trim(),B;return F==="application/json"?B=yield D.json():F==="application/octet-stream"||F==="application/pdf"?B=yield D.blob():F==="text/event-stream"?B=D:F==="multipart/form-data"?B=yield D.formData():B=yield D.text(),{data:B,error:null,response:D}}catch(i){return{data:null,error:i,response:i instanceof r3||i instanceof t3?i.context:void 0}}finally{l&&clearTimeout(l)}})}}var $l={};const kb=Ffe(fbe);var TP={},AP={},PP={},CP={},OP={},kP={},a9;function VQ(){if(a9)return kP;a9=1,Object.defineProperty(kP,"__esModule",{value:!0});class e extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}}return kP.default=e,kP}var o9;function qQ(){if(o9)return OP;o9=1,Object.defineProperty(OP,"__esModule",{value:!0});const t=kb.__importDefault(VQ());class r{constructor(o){var l,d;this.shouldThrowOnError=!1,this.method=o.method,this.url=o.url,this.headers=new Headers(o.headers),this.schema=o.schema,this.body=o.body,this.shouldThrowOnError=(l=o.shouldThrowOnError)!==null&&l!==void 0?l:!1,this.signal=o.signal,this.isMaybeSingle=(d=o.isMaybeSingle)!==null&&d!==void 0?d:!1,o.fetch?this.fetch=o.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(o,l){return this.headers=new Headers(this.headers),this.headers.set(o,l),this}then(o,l){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const d=this.fetch;let i=d(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async g=>{var _,S,E,T;let C=null,N=null,I=null,j=g.status,D=g.statusText;if(g.ok){if(this.method!=="HEAD"){const U=await g.text();U===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((_=this.headers.get("Accept"))===null||_===void 0)&&_.includes("application/vnd.pgrst.plan+text"))?N=U:N=JSON.parse(U))}const F=(S=this.headers.get("Prefer"))===null||S===void 0?void 0:S.match(/count=(exact|planned|estimated)/),B=(E=g.headers.get("content-range"))===null||E===void 0?void 0:E.split("/");F&&B&&B.length>1&&(I=parseInt(B[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(N)&&(N.length>1?(C={code:"PGRST116",details:`Results contain ${N.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},N=null,I=null,j=406,D="Not Acceptable"):N.length===1?N=N[0]:N=null)}else{const F=await g.text();try{C=JSON.parse(F),Array.isArray(C)&&g.status===404&&(N=[],C=null,j=200,D="OK")}catch{g.status===404&&F===""?(j=204,D="No Content"):C={message:F}}if(C&&this.isMaybeSingle&&(!((T=C==null?void 0:C.details)===null||T===void 0)&&T.includes("0 rows"))&&(C=null,j=200,D="OK"),C&&this.shouldThrowOnError)throw new t.default(C)}return{error:C,data:N,count:I,status:j,statusText:D}});return this.shouldThrowOnError||(i=i.catch(g=>{var _,S,E,T,C,N;let I="";const j=g==null?void 0:g.cause;if(j){const D=(_=j==null?void 0:j.message)!==null&&_!==void 0?_:"",R=(S=j==null?void 0:j.code)!==null&&S!==void 0?S:"";I=`${(E=g==null?void 0:g.name)!==null&&E!==void 0?E:"FetchError"}: ${g==null?void 0:g.message}`,I+=`

Caused by: ${(T=j==null?void 0:j.name)!==null&&T!==void 0?T:"Error"}: ${D}`,R&&(I+=` (${R})`),j!=null&&j.stack&&(I+=`
${j.stack}`)}else I=(C=g==null?void 0:g.stack)!==null&&C!==void 0?C:"";return{error:{message:`${(N=g==null?void 0:g.name)!==null&&N!==void 0?N:"FetchError"}: ${g==null?void 0:g.message}`,details:I,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),i.then(o,l)}returns(){return this}overrideTypes(){return this}}return OP.default=r,OP}var s9;function WQ(){if(s9)return CP;s9=1,Object.defineProperty(CP,"__esModule",{value:!0});const t=kb.__importDefault(qQ());class r extends t.default{select(o){let l=!1;const d=(o??"*").split("").map(i=>/\s/.test(i)&&!l?"":(i==='"'&&(l=!l),i)).join("");return this.url.searchParams.set("select",d),this.headers.append("Prefer","return=representation"),this}order(o,{ascending:l=!0,nullsFirst:d,foreignTable:i,referencedTable:g=i}={}){const _=g?`${g}.order`:"order",S=this.url.searchParams.get(_);return this.url.searchParams.set(_,`${S?`${S},`:""}${o}.${l?"asc":"desc"}${d===void 0?"":d?".nullsfirst":".nullslast"}`),this}limit(o,{foreignTable:l,referencedTable:d=l}={}){const i=typeof d>"u"?"limit":`${d}.limit`;return this.url.searchParams.set(i,`${o}`),this}range(o,l,{foreignTable:d,referencedTable:i=d}={}){const g=typeof i>"u"?"offset":`${i}.offset`,_=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(g,`${o}`),this.url.searchParams.set(_,`${l-o+1}`),this}abortSignal(o){return this.signal=o,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:o=!1,verbose:l=!1,settings:d=!1,buffers:i=!1,wal:g=!1,format:_="text"}={}){var S;const E=[o?"analyze":null,l?"verbose":null,d?"settings":null,i?"buffers":null,g?"wal":null].filter(Boolean).join("|"),T=(S=this.headers.get("Accept"))!==null&&S!==void 0?S:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${_}; for="${T}"; options=${E};`),_==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(o){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${o}`),this}}return CP.default=r,CP}var l9;function VB(){if(l9)return PP;l9=1,Object.defineProperty(PP,"__esModule",{value:!0});const t=kb.__importDefault(WQ()),r=new RegExp("[,()]");class n extends t.default{eq(l,d){return this.url.searchParams.append(l,`eq.${d}`),this}neq(l,d){return this.url.searchParams.append(l,`neq.${d}`),this}gt(l,d){return this.url.searchParams.append(l,`gt.${d}`),this}gte(l,d){return this.url.searchParams.append(l,`gte.${d}`),this}lt(l,d){return this.url.searchParams.append(l,`lt.${d}`),this}lte(l,d){return this.url.searchParams.append(l,`lte.${d}`),this}like(l,d){return this.url.searchParams.append(l,`like.${d}`),this}likeAllOf(l,d){return this.url.searchParams.append(l,`like(all).{${d.join(",")}}`),this}likeAnyOf(l,d){return this.url.searchParams.append(l,`like(any).{${d.join(",")}}`),this}ilike(l,d){return this.url.searchParams.append(l,`ilike.${d}`),this}ilikeAllOf(l,d){return this.url.searchParams.append(l,`ilike(all).{${d.join(",")}}`),this}ilikeAnyOf(l,d){return this.url.searchParams.append(l,`ilike(any).{${d.join(",")}}`),this}regexMatch(l,d){return this.url.searchParams.append(l,`match.${d}`),this}regexIMatch(l,d){return this.url.searchParams.append(l,`imatch.${d}`),this}is(l,d){return this.url.searchParams.append(l,`is.${d}`),this}isDistinct(l,d){return this.url.searchParams.append(l,`isdistinct.${d}`),this}in(l,d){const i=Array.from(new Set(d)).map(g=>typeof g=="string"&&r.test(g)?`"${g}"`:`${g}`).join(",");return this.url.searchParams.append(l,`in.(${i})`),this}contains(l,d){return typeof d=="string"?this.url.searchParams.append(l,`cs.${d}`):Array.isArray(d)?this.url.searchParams.append(l,`cs.{${d.join(",")}}`):this.url.searchParams.append(l,`cs.${JSON.stringify(d)}`),this}containedBy(l,d){return typeof d=="string"?this.url.searchParams.append(l,`cd.${d}`):Array.isArray(d)?this.url.searchParams.append(l,`cd.{${d.join(",")}}`):this.url.searchParams.append(l,`cd.${JSON.stringify(d)}`),this}rangeGt(l,d){return this.url.searchParams.append(l,`sr.${d}`),this}rangeGte(l,d){return this.url.searchParams.append(l,`nxl.${d}`),this}rangeLt(l,d){return this.url.searchParams.append(l,`sl.${d}`),this}rangeLte(l,d){return this.url.searchParams.append(l,`nxr.${d}`),this}rangeAdjacent(l,d){return this.url.searchParams.append(l,`adj.${d}`),this}overlaps(l,d){return typeof d=="string"?this.url.searchParams.append(l,`ov.${d}`):this.url.searchParams.append(l,`ov.{${d.join(",")}}`),this}textSearch(l,d,{config:i,type:g}={}){let _="";g==="plain"?_="pl":g==="phrase"?_="ph":g==="websearch"&&(_="w");const S=i===void 0?"":`(${i})`;return this.url.searchParams.append(l,`${_}fts${S}.${d}`),this}match(l){return Object.entries(l).forEach(([d,i])=>{this.url.searchParams.append(d,`eq.${i}`)}),this}not(l,d,i){return this.url.searchParams.append(l,`not.${d}.${i}`),this}or(l,{foreignTable:d,referencedTable:i=d}={}){const g=i?`${i}.or`:"or";return this.url.searchParams.append(g,`(${l})`),this}filter(l,d,i){return this.url.searchParams.append(l,`${d}.${i}`),this}}return PP.default=n,PP}var c9;function GQ(){if(c9)return AP;c9=1,Object.defineProperty(AP,"__esModule",{value:!0});const t=kb.__importDefault(VB());class r{constructor(o,{headers:l={},schema:d,fetch:i}){this.url=o,this.headers=new Headers(l),this.schema=d,this.fetch=i}select(o,l){const{head:d=!1,count:i}=l??{},g=d?"HEAD":"GET";let _=!1;const S=(o??"*").split("").map(E=>/\s/.test(E)&&!_?"":(E==='"'&&(_=!_),E)).join("");return this.url.searchParams.set("select",S),i&&this.headers.append("Prefer",`count=${i}`),new t.default({method:g,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(o,{count:l,defaultToNull:d=!0}={}){var i;const g="POST";if(l&&this.headers.append("Prefer",`count=${l}`),d||this.headers.append("Prefer","missing=default"),Array.isArray(o)){const _=o.reduce((S,E)=>S.concat(Object.keys(E)),[]);if(_.length>0){const S=[...new Set(_)].map(E=>`"${E}"`);this.url.searchParams.set("columns",S.join(","))}}return new t.default({method:g,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}upsert(o,{onConflict:l,ignoreDuplicates:d=!1,count:i,defaultToNull:g=!0}={}){var _;const S="POST";if(this.headers.append("Prefer",`resolution=${d?"ignore":"merge"}-duplicates`),l!==void 0&&this.url.searchParams.set("on_conflict",l),i&&this.headers.append("Prefer",`count=${i}`),g||this.headers.append("Prefer","missing=default"),Array.isArray(o)){const E=o.reduce((T,C)=>T.concat(Object.keys(C)),[]);if(E.length>0){const T=[...new Set(E)].map(C=>`"${C}"`);this.url.searchParams.set("columns",T.join(","))}}return new t.default({method:S,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:(_=this.fetch)!==null&&_!==void 0?_:fetch})}update(o,{count:l}={}){var d;const i="PATCH";return l&&this.headers.append("Prefer",`count=${l}`),new t.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}delete({count:o}={}){var l;const d="DELETE";return o&&this.headers.append("Prefer",`count=${o}`),new t.default({method:d,url:this.url,headers:this.headers,schema:this.schema,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}}return AP.default=r,AP}var u9;function gbe(){if(u9)return TP;u9=1,Object.defineProperty(TP,"__esModule",{value:!0});const e=kb,t=e.__importDefault(GQ()),r=e.__importDefault(VB());class n{constructor(l,{headers:d={},schema:i,fetch:g}={}){this.url=l,this.headers=new Headers(d),this.schemaName=i,this.fetch=g}from(l){if(!l||typeof l!="string"||l.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");const d=new URL(`${this.url}/${l}`);return new t.default(d,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(l){return new n(this.url,{headers:this.headers,schema:l,fetch:this.fetch})}rpc(l,d={},{head:i=!1,get:g=!1,count:_}={}){var S;let E;const T=new URL(`${this.url}/rpc/${l}`);let C;i||g?(E=i?"HEAD":"GET",Object.entries(d).filter(([I,j])=>j!==void 0).map(([I,j])=>[I,Array.isArray(j)?`{${j.join(",")}}`:`${j}`]).forEach(([I,j])=>{T.searchParams.append(I,j)})):(E="POST",C=d);const N=new Headers(this.headers);return _&&N.set("Prefer",`count=${_}`),new r.default({method:E,url:T,headers:N,schema:this.schemaName,body:C,fetch:(S=this.fetch)!==null&&S!==void 0?S:fetch})}}return TP.default=n,TP}Object.defineProperty($l,"__esModule",{value:!0});var HQ=$l.PostgrestError=nee=$l.PostgrestBuilder=tee=$l.PostgrestTransformBuilder=QQ=$l.PostgrestFilterBuilder=YQ=$l.PostgrestQueryBuilder=ZQ=$l.PostgrestClient=void 0;const Ib=kb,KQ=Ib.__importDefault(gbe());var ZQ=$l.PostgrestClient=KQ.default;const XQ=Ib.__importDefault(GQ());var YQ=$l.PostgrestQueryBuilder=XQ.default;const JQ=Ib.__importDefault(VB());var QQ=$l.PostgrestFilterBuilder=JQ.default;const eee=Ib.__importDefault(WQ());var tee=$l.PostgrestTransformBuilder=eee.default;const ree=Ib.__importDefault(qQ());var nee=$l.PostgrestBuilder=ree.default;const iee=Ib.__importDefault(VQ());HQ=$l.PostgrestError=iee.default;var aee=$l.default={PostgrestClient:KQ.default,PostgrestQueryBuilder:XQ.default,PostgrestFilterBuilder:JQ.default,PostgrestTransformBuilder:eee.default,PostgrestBuilder:ree.default,PostgrestError:iee.default};const ybe=dZ({__proto__:null,get PostgrestBuilder(){return nee},get PostgrestClient(){return ZQ},get PostgrestError(){return HQ},get PostgrestFilterBuilder(){return QQ},get PostgrestQueryBuilder(){return YQ},get PostgrestTransformBuilder(){return tee},default:aee},[$l]),{PostgrestClient:vbe,PostgrestQueryBuilder:$et,PostgrestFilterBuilder:Uet,PostgrestTransformBuilder:Vet,PostgrestBuilder:qet,PostgrestError:_be}=aee||ybe;class oee{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const r=process.versions;if(r&&r.node){const n=r.node,o=parseInt(n.replace(/^v/,"").split(".")[0]);return o>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${o} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${o} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let r=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(r+=`

Suggested solution: ${t.workaround}`),new Error(r)}static createWebSocket(t,r){const n=this.getWebSocketConstructor();return new n(t,r)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const xbe="2.84.0",bbe=`realtime-js/${xbe}`,see="1.0.0",wbe="2.0.0",d9=see,n3=1e4,Sbe=1e3,Ebe=100;var ky;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(ky||(ky={}));var ds;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(ds||(ds={}));var fd;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(fd||(fd={}));var i3;(function(e){e.websocket="websocket"})(i3||(i3={}));var Iy;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(Iy||(Iy={}));class Tbe{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast"}encode(t,r){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return r(this._binaryEncodeUserBroadcastPush(t));let n=[t.join_ref,t.ref,t.topic,t.event,t.payload];return r(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(t){var r;return this._isArrayBuffer((r=t.payload)===null||r===void 0?void 0:r.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var r,n,o,l;const d=t.topic,i=(r=t.ref)!==null&&r!==void 0?r:"",g=(n=t.join_ref)!==null&&n!==void 0?n:"",_=t.payload.event,S=(l=(o=t.payload)===null||o===void 0?void 0:o.payload)!==null&&l!==void 0?l:new ArrayBuffer(0),E=this.USER_BROADCAST_PUSH_META_LENGTH+g.length+i.length+d.length+_.length,T=new ArrayBuffer(this.HEADER_LENGTH+E);let C=new DataView(T),N=0;C.setUint8(N++,this.KINDS.userBroadcastPush),C.setUint8(N++,g.length),C.setUint8(N++,i.length),C.setUint8(N++,d.length),C.setUint8(N++,_.length),C.setUint8(N++,this.BINARY_ENCODING),Array.from(g,j=>C.setUint8(N++,j.charCodeAt(0))),Array.from(i,j=>C.setUint8(N++,j.charCodeAt(0))),Array.from(d,j=>C.setUint8(N++,j.charCodeAt(0))),Array.from(_,j=>C.setUint8(N++,j.charCodeAt(0)));var I=new Uint8Array(T.byteLength+S.byteLength);return I.set(new Uint8Array(T),0),I.set(new Uint8Array(S),T.byteLength),I.buffer}_encodeJsonUserBroadcastPush(t){var r,n,o,l;const d=t.topic,i=(r=t.ref)!==null&&r!==void 0?r:"",g=(n=t.join_ref)!==null&&n!==void 0?n:"",_=t.payload.event,S=(l=(o=t.payload)===null||o===void 0?void 0:o.payload)!==null&&l!==void 0?l:{},T=new TextEncoder().encode(JSON.stringify(S)).buffer,C=this.USER_BROADCAST_PUSH_META_LENGTH+g.length+i.length+d.length+_.length,N=new ArrayBuffer(this.HEADER_LENGTH+C);let I=new DataView(N),j=0;I.setUint8(j++,this.KINDS.userBroadcastPush),I.setUint8(j++,g.length),I.setUint8(j++,i.length),I.setUint8(j++,d.length),I.setUint8(j++,_.length),I.setUint8(j++,this.JSON_ENCODING),Array.from(g,R=>I.setUint8(j++,R.charCodeAt(0))),Array.from(i,R=>I.setUint8(j++,R.charCodeAt(0))),Array.from(d,R=>I.setUint8(j++,R.charCodeAt(0))),Array.from(_,R=>I.setUint8(j++,R.charCodeAt(0)));var D=new Uint8Array(N.byteLength+T.byteLength);return D.set(new Uint8Array(N),0),D.set(new Uint8Array(T),N.byteLength),D.buffer}decode(t,r){if(this._isArrayBuffer(t)){let n=this._binaryDecode(t);return r(n)}if(typeof t=="string"){const n=JSON.parse(t),[o,l,d,i,g]=n;return r({join_ref:o,ref:l,topic:d,event:i,payload:g})}return r({})}_binaryDecode(t){const r=new DataView(t),n=r.getUint8(0),o=new TextDecoder;switch(n){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(t,r,o)}}_decodeUserBroadcast(t,r,n){const o=r.getUint8(1),l=r.getUint8(2),d=r.getUint8(3),i=r.getUint8(4);let g=this.HEADER_LENGTH+4;const _=n.decode(t.slice(g,g+o));g=g+o;const S=n.decode(t.slice(g,g+l));g=g+l;const E=n.decode(t.slice(g,g+d));g=g+d;const T=t.slice(g,t.byteLength),C=i===this.JSON_ENCODING?JSON.parse(n.decode(T)):T,N={type:this.BROADCAST_EVENT,event:S,payload:C};return d>0&&(N.meta=JSON.parse(E)),{join_ref:null,ref:null,topic:_,event:this.BROADCAST_EVENT,payload:N}}_isArrayBuffer(t){var r;return t instanceof ArrayBuffer||((r=t==null?void 0:t.constructor)===null||r===void 0?void 0:r.name)==="ArrayBuffer"}}class lee{constructor(t,r){this.callback=t,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Ga;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(Ga||(Ga={}));const h9=(e,t,r={})=>{var n;const o=(n=r.skipTypes)!==null&&n!==void 0?n:[];return t?Object.keys(t).reduce((l,d)=>(l[d]=Abe(d,e,t,o),l),{}):{}},Abe=(e,t,r,n)=>{const o=t.find(i=>i.name===e),l=o==null?void 0:o.type,d=r[e];return l&&!n.includes(l)?cee(l,d):a3(d)},cee=(e,t)=>{if(e.charAt(0)==="_"){const r=e.slice(1,e.length);return kbe(t,r)}switch(e){case Ga.bool:return Pbe(t);case Ga.float4:case Ga.float8:case Ga.int2:case Ga.int4:case Ga.int8:case Ga.numeric:case Ga.oid:return Cbe(t);case Ga.json:case Ga.jsonb:return Obe(t);case Ga.timestamp:return Ibe(t);case Ga.abstime:case Ga.date:case Ga.daterange:case Ga.int4range:case Ga.int8range:case Ga.money:case Ga.reltime:case Ga.text:case Ga.time:case Ga.timestamptz:case Ga.timetz:case Ga.tsrange:case Ga.tstzrange:return a3(t);default:return a3(t)}},a3=e=>e,Pbe=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},Cbe=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},Obe=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},kbe=(e,t)=>{if(typeof e!="string")return e;const r=e.length-1,n=e[r];if(e[0]==="{"&&n==="}"){let l;const d=e.slice(1,r);try{l=JSON.parse("["+d+"]")}catch{l=d?d.split(","):[]}return l.map(i=>cee(t,i))}return e},Ibe=e=>typeof e=="string"?e.replace(" ","T"):e,uee=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class kM{constructor(t,r,n={},o=n3){this.channel=t,this.event=r,this.payload=n,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,r){var n;return this._hasReceived(t)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:t,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:r}){this.recHooks.filter(n=>n.status===t).forEach(n=>n.callback(r))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var o3;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(o3||(o3={}));class t0{constructor(t,r){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},o=>{const{onJoin:l,onLeave:d,onSync:i}=this.caller;this.joinRef=this.channel._joinRef(),this.state=t0.syncState(this.state,o,l,d),this.pendingDiffs.forEach(g=>{this.state=t0.syncDiff(this.state,g,l,d)}),this.pendingDiffs=[],i()}),this.channel._on(n.diff,{},o=>{const{onJoin:l,onLeave:d,onSync:i}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=t0.syncDiff(this.state,o,l,d),i())}),this.onJoin((o,l,d)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:l,newPresences:d})}),this.onLeave((o,l,d)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:l,leftPresences:d})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,r,n,o){const l=this.cloneDeep(t),d=this.transformState(r),i={},g={};return this.map(l,(_,S)=>{d[_]||(g[_]=S)}),this.map(d,(_,S)=>{const E=l[_];if(E){const T=S.map(j=>j.presence_ref),C=E.map(j=>j.presence_ref),N=S.filter(j=>C.indexOf(j.presence_ref)<0),I=E.filter(j=>T.indexOf(j.presence_ref)<0);N.length>0&&(i[_]=N),I.length>0&&(g[_]=I)}else i[_]=S}),this.syncDiff(l,{joins:i,leaves:g},n,o)}static syncDiff(t,r,n,o){const{joins:l,leaves:d}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),o||(o=()=>{}),this.map(l,(i,g)=>{var _;const S=(_=t[i])!==null&&_!==void 0?_:[];if(t[i]=this.cloneDeep(g),S.length>0){const E=t[i].map(C=>C.presence_ref),T=S.filter(C=>E.indexOf(C.presence_ref)<0);t[i].unshift(...T)}n(i,S,g)}),this.map(d,(i,g)=>{let _=t[i];if(!_)return;const S=g.map(E=>E.presence_ref);_=_.filter(E=>S.indexOf(E.presence_ref)<0),t[i]=_,o(i,_,g),_.length===0&&delete t[i]}),t}static map(t,r){return Object.getOwnPropertyNames(t).map(n=>r(n,t[n]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((r,n)=>{const o=t[n];return"metas"in o?r[n]=o.metas.map(l=>(l.presence_ref=l.phx_ref,delete l.phx_ref,delete l.phx_ref_prev,l)):r[n]=o,r},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var s3;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(s3||(s3={}));var r0;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(r0||(r0={}));var ih;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(ih||(ih={}));class bI{constructor(t,r={config:{}},n){var o,l;if(this.topic=t,this.params=r,this.socket=n,this.bindings={},this.state=ds.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new kM(this,fd.join,this.params,this.timeout),this.rejoinTimer=new lee(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ds.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(d=>d.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=ds.closed,this.socket._remove(this)}),this._onError(d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=ds.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=ds.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=ds.errored,this.rejoinTimer.scheduleTimeout())}),this._on(fd.reply,{},(d,i)=>{this._trigger(this._replyEventName(i),d)}),this.presence=new t0(this),this.broadcastEndpointURL=uee(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((l=(o=this.params.config)===null||o===void 0?void 0:o.broadcast)===null||l===void 0)&&l.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,r=this.timeout){var n,o,l;if(this.socket.isConnected()||this.socket.connect(),this.state==ds.closed){const{config:{broadcast:d,presence:i,private:g}}=this.params,_=(o=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(C=>C.filter))!==null&&o!==void 0?o:[],S=!!this.bindings[r0.PRESENCE]&&this.bindings[r0.PRESENCE].length>0||((l=this.params.config.presence)===null||l===void 0?void 0:l.enabled)===!0,E={},T={broadcast:d,presence:Object.assign(Object.assign({},i),{enabled:S}),postgres_changes:_,private:g};this.socket.accessTokenValue&&(E.access_token=this.socket.accessTokenValue),this._onError(C=>t==null?void 0:t(ih.CHANNEL_ERROR,C)),this._onClose(()=>t==null?void 0:t(ih.CLOSED)),this.updateJoinPayload(Object.assign({config:T},E)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:C})=>{var N;if(this.socket.setAuth(),C===void 0){t==null||t(ih.SUBSCRIBED);return}else{const I=this.bindings.postgres_changes,j=(N=I==null?void 0:I.length)!==null&&N!==void 0?N:0,D=[];for(let R=0;R<j;R++){const F=I[R],{filter:{event:B,schema:U,table:Z,filter:J}}=F,te=C&&C[R];if(te&&te.event===B&&te.schema===U&&te.table===Z&&te.filter===J)D.push(Object.assign(Object.assign({},F),{id:te.id}));else{this.unsubscribe(),this.state=ds.errored,t==null||t(ih.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=D,t&&t(ih.SUBSCRIBED);return}}).receive("error",C=>{this.state=ds.errored,t==null||t(ih.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(C).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(ih.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,r={}){return await this.send({type:"presence",event:"track",payload:t},r.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,r,n){return this.state===ds.joined&&t===r0.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,r,n)}async httpSend(t,r,n={}){var o;const l=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(r==null)return Promise.reject("Payload is required for httpSend()");const d={method:"POST",headers:{Authorization:l,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:r,private:this.private}]})},i=await this._fetchWithTimeout(this.broadcastEndpointURL,d,(o=n.timeout)!==null&&o!==void 0?o:this.timeout);if(i.status===202)return{success:!0};let g=i.statusText;try{const _=await i.json();g=_.error||_.message||g}catch{}return Promise.reject(new Error(g))}async send(t,r={}){var n,o;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:l,payload:d}=t,g={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:l,payload:d,private:this.private}]})};try{const _=await this._fetchWithTimeout(this.broadcastEndpointURL,g,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((o=_.body)===null||o===void 0?void 0:o.cancel()),_.ok?"ok":"error"}catch(_){return _.name==="AbortError"?"timed out":"error"}}else return new Promise(l=>{var d,i,g;const _=this._push(t.type,t,r.timeout||this.timeout);t.type==="broadcast"&&!(!((g=(i=(d=this.params)===null||d===void 0?void 0:d.config)===null||i===void 0?void 0:i.broadcast)===null||g===void 0)&&g.ack)&&l("ok"),_.receive("ok",()=>l("ok")),_.receive("error",()=>l("error")),_.receive("timeout",()=>l("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=ds.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(fd.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(o=>{n=new kM(this,fd.leave,{},t),n.receive("ok",()=>{r(),o("ok")}).receive("timeout",()=>{r(),o("timed out")}).receive("error",()=>{o("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=ds.closed,this.bindings={}}async _fetchWithTimeout(t,r,n){const o=new AbortController,l=setTimeout(()=>o.abort(),n),d=await this.socket.fetch(t,Object.assign(Object.assign({},r),{signal:o.signal}));return clearTimeout(l),d}_push(t,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new kM(this,t,r,n);return this._canPush()?o.send():this._addToPushBuffer(o),o}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>Ebe){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(t,r,n){return r}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,r,n){var o,l;const d=t.toLocaleLowerCase(),{close:i,error:g,leave:_,join:S}=fd;if(n&&[i,g,_,S].indexOf(d)>=0&&n!==this._joinRef())return;let T=this._onMessage(d,r,n);if(r&&!T)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(d)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(C=>{var N,I,j;return((N=C.filter)===null||N===void 0?void 0:N.event)==="*"||((j=(I=C.filter)===null||I===void 0?void 0:I.event)===null||j===void 0?void 0:j.toLocaleLowerCase())===d}).map(C=>C.callback(T,n)):(l=this.bindings[d])===null||l===void 0||l.filter(C=>{var N,I,j,D,R,F;if(["broadcast","presence","postgres_changes"].includes(d))if("id"in C){const B=C.id,U=(N=C.filter)===null||N===void 0?void 0:N.event;return B&&((I=r.ids)===null||I===void 0?void 0:I.includes(B))&&(U==="*"||(U==null?void 0:U.toLocaleLowerCase())===((j=r.data)===null||j===void 0?void 0:j.type.toLocaleLowerCase()))}else{const B=(R=(D=C==null?void 0:C.filter)===null||D===void 0?void 0:D.event)===null||R===void 0?void 0:R.toLocaleLowerCase();return B==="*"||B===((F=r==null?void 0:r.event)===null||F===void 0?void 0:F.toLocaleLowerCase())}else return C.type.toLocaleLowerCase()===d}).map(C=>{if(typeof T=="object"&&"ids"in T){const N=T.data,{schema:I,table:j,commit_timestamp:D,type:R,errors:F}=N;T=Object.assign(Object.assign({},{schema:I,table:j,commit_timestamp:D,eventType:R,new:{},old:{},errors:F}),this._getPayloadRecords(N))}C.callback(T,n)})}_isClosed(){return this.state===ds.closed}_isJoined(){return this.state===ds.joined}_isJoining(){return this.state===ds.joining}_isLeaving(){return this.state===ds.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,r,n){const o=t.toLocaleLowerCase(),l={type:o,filter:r,callback:n};return this.bindings[o]?this.bindings[o].push(l):this.bindings[o]=[l],this}_off(t,r){const n=t.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(o=>{var l;return!(((l=o.type)===null||l===void 0?void 0:l.toLocaleLowerCase())===n&&bI.isEqual(o.filter,r))})),this}static isEqual(t,r){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const n in t)if(t[n]!==r[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(fd.close,{},t)}_onError(t){this._on(fd.error,{},r=>t(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ds.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const r={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(r.new=h9(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(r.old=h9(t.columns,t.old_record)),r}}const IM=()=>{},IP={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Rbe=[1e3,2e3,5e3,1e4],jbe=1e4,Nbe=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class dee{constructor(t,r){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=n3,this.transport=null,this.heartbeatIntervalMs=IP.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=IM,this.ref=0,this.reconnectTimer=null,this.vsn=d9,this.logger=IM,this.conn=null,this.sendBuffer=[],this.serializer=new Tbe,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=o=>o?(...l)=>o(...l):(...l)=>fetch(...l),!(!((n=r==null?void 0:r.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${t}/${i3.websocket}`,this.httpEndpoint=uee(t),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r==null?void 0:r.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=oee.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const r=t.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,r??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const r=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const t=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,r,n){this.logger(t,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case ky.connecting:return Iy.Connecting;case ky.open:return Iy.Open;case ky.closing:return Iy.Closing;default:return Iy.Closed}}isConnected(){return this.connectionState()===Iy.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,r={config:{}}){const n=`realtime:${t}`,o=this.getChannels().find(l=>l.topic===n);if(o)return o;{const l=new bI(`realtime:${t}`,r,this);return this.channels.push(l),l}}push(t){const{topic:r,event:n,payload:o,ref:l}=t,d=()=>{this.encode(t,i=>{var g;(g=this.conn)===null||g===void 0||g.send(i)})};this.log("push",`${r} ${n} (${l})`,o),this.isConnected()?d():this.sendBuffer.push(d)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(Sbe,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},IP.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let r=this.channels.find(n=>n.topic===t&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${t}"`),r.unsubscribe())}_remove(t){this.channels=this.channels.filter(r=>r.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply")try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error")}catch(_){this.log("error","error in heartbeat callback",_)}r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:o,payload:l,ref:d}=r,i=d?`(${d})`:"",g=l.status||"";this.log("receive",`${g} ${n} ${o} ${i}`.trim(),l),this.channels.filter(_=>_._isMember(n)).forEach(_=>_._trigger(o,l,d)),this._triggerStateCallbacks("message",r)})}_clearTimer(t){var r;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){if(this.conn){if(this.conn.readyState===ky.open||this.conn.readyState===ky.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(r=>{this.log("error","error waiting for auth on connect",r),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var r;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(fd.error))}_appendParams(t,r){if(Object.keys(r).length===0)return t;const n=t.match(/\?/)?"&":"?",o=new URLSearchParams(r);return`${t}${n}${o}`}_workerObjectUrl(t){let r;if(t)r=t;else{const n=new Blob([Nbe],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}_setConnectionState(t,r=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(t=null){let r;t?r=t:this.accessToken?r=await this.accessToken():r=this.accessTokenValue,this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const o={access_token:r,version:bbe};r&&n.updateJoinPayload(o),n.joinedOnce&&n._isJoined()&&n._push(fd.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(r=>{this.log("error",`error setting auth in ${t}`,r)})}_triggerStateCallbacks(t,r){try{this.stateChangeCallbacks[t].forEach(n=>{try{n(r)}catch(o){this.log("error",`error in ${t} callback`,o)}})}catch(n){this.log("error",`error triggering ${t} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new lee(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},IP.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var r,n,o,l,d,i,g,_,S,E,T,C;switch(this.transport=(r=t==null?void 0:t.transport)!==null&&r!==void 0?r:null,this.timeout=(n=t==null?void 0:t.timeout)!==null&&n!==void 0?n:n3,this.heartbeatIntervalMs=(o=t==null?void 0:t.heartbeatIntervalMs)!==null&&o!==void 0?o:IP.HEARTBEAT_INTERVAL,this.worker=(l=t==null?void 0:t.worker)!==null&&l!==void 0?l:!1,this.accessToken=(d=t==null?void 0:t.accessToken)!==null&&d!==void 0?d:null,this.heartbeatCallback=(i=t==null?void 0:t.heartbeatCallback)!==null&&i!==void 0?i:IM,this.vsn=(g=t==null?void 0:t.vsn)!==null&&g!==void 0?g:d9,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(_=t==null?void 0:t.reconnectAfterMs)!==null&&_!==void 0?_:N=>Rbe[N-1]||jbe,this.vsn){case see:this.encode=(S=t==null?void 0:t.encode)!==null&&S!==void 0?S:(N,I)=>I(JSON.stringify(N)),this.decode=(E=t==null?void 0:t.decode)!==null&&E!==void 0?E:(N,I)=>I(JSON.parse(N));break;case wbe:this.encode=(T=t==null?void 0:t.encode)!==null&&T!==void 0?T:this.serializer.encode.bind(this.serializer),this.decode=(C=t==null?void 0:t.decode)!==null&&C!==void 0?C:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}class qB extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function vo(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class Mbe extends qB{constructor(t,r,n){super(t),this.name="StorageApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class l3 extends qB{constructor(t,r){super(t),this.name="StorageUnknownError",this.originalError=r}}const WB=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),Dbe=()=>Response,c3=e=>{if(Array.isArray(e))return e.map(r=>c3(r));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([r,n])=>{const o=r.replace(/([-_][a-z])/gi,l=>l.toUpperCase().replace(/[-_]/g,""));t[o]=c3(n)}),t},Lbe=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},RM=e=>{var t;return e.msg||e.message||e.error_description||(typeof e.error=="string"?e.error:(t=e.error)===null||t===void 0?void 0:t.message)||JSON.stringify(e)},Fbe=(e,t,r)=>On(void 0,void 0,void 0,function*(){const n=yield Dbe();e instanceof n&&!(r!=null&&r.noResolveJson)?e.json().then(o=>{const l=e.status||500,d=(o==null?void 0:o.statusCode)||l+"";t(new Mbe(RM(o),l,d))}).catch(o=>{t(new l3(RM(o),o))}):t(new l3(RM(e),e))}),zbe=(e,t,r,n)=>{const o={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"||!n?o:(Lbe(n)?(o.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),o.body=JSON.stringify(n)):o.body=n,t!=null&&t.duplex&&(o.duplex=t.duplex),Object.assign(Object.assign({},o),r))};function MT(e,t,r,n,o,l){return On(this,void 0,void 0,function*(){return new Promise((d,i)=>{e(r,zbe(t,n,o,l)).then(g=>{if(!g.ok)throw g;return n!=null&&n.noResolveJson?g:g.json()}).then(g=>d(g)).catch(g=>Fbe(g,i,n))})})}function OE(e,t,r,n){return On(this,void 0,void 0,function*(){return MT(e,"GET",t,r,n)})}function cd(e,t,r,n,o){return On(this,void 0,void 0,function*(){return MT(e,"POST",t,n,o,r)})}function u3(e,t,r,n,o){return On(this,void 0,void 0,function*(){return MT(e,"PUT",t,n,o,r)})}function Bbe(e,t,r,n){return On(this,void 0,void 0,function*(){return MT(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function GB(e,t,r,n,o){return On(this,void 0,void 0,function*(){return MT(e,"DELETE",t,n,o,r)})}class $be{constructor(t,r){this.downloadFn=t,this.shouldThrowOnError=r}then(t,r){return this.execute().then(t,r)}execute(){return On(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(vo(t))return{data:null,error:t};throw t}})}}var hee;class Ube{constructor(t,r){this.downloadFn=t,this.shouldThrowOnError=r,this[hee]="BlobDownloadBuilder",this.promise=null}asStream(){return new $be(this.downloadFn,this.shouldThrowOnError)}then(t,r){return this.getPromise().then(t,r)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return On(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(vo(t))return{data:null,error:t};throw t}})}}hee=Symbol.toStringTag;const Vbe={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},f9={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class qbe{constructor(t,r={},n,o){this.shouldThrowOnError=!1,this.url=t,this.headers=r,this.bucketId=n,this.fetch=WB(o)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,r,n,o){return On(this,void 0,void 0,function*(){try{let l;const d=Object.assign(Object.assign({},f9),o);let i=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(d.upsert)});const g=d.metadata;typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",d.cacheControl),g&&l.append("metadata",this.encodeMetadata(g)),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.has("cacheControl")||l.append("cacheControl",d.cacheControl),g&&!l.has("metadata")&&l.append("metadata",this.encodeMetadata(g))):(l=n,i["cache-control"]=`max-age=${d.cacheControl}`,i["content-type"]=d.contentType,g&&(i["x-metadata"]=this.toBase64(this.encodeMetadata(g))),(typeof ReadableStream<"u"&&l instanceof ReadableStream||l&&typeof l=="object"&&"pipe"in l&&typeof l.pipe=="function")&&!d.duplex&&(d.duplex="half")),o!=null&&o.headers&&(i=Object.assign(Object.assign({},i),o.headers));const _=this._removeEmptyFolders(r),S=this._getFinalPath(_),E=yield(t=="PUT"?u3:cd)(this.fetch,`${this.url}/object/${S}`,l,Object.assign({headers:i},d!=null&&d.duplex?{duplex:d.duplex}:{}));return{data:{path:_,id:E.Id,fullPath:E.Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(vo(l))return{data:null,error:l};throw l}})}upload(t,r,n){return On(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,r,n)})}uploadToSignedUrl(t,r,n,o){return On(this,void 0,void 0,function*(){const l=this._removeEmptyFolders(t),d=this._getFinalPath(l),i=new URL(this.url+`/object/upload/sign/${d}`);i.searchParams.set("token",r);try{let g;const _=Object.assign({upsert:f9.upsert},o),S=Object.assign(Object.assign({},this.headers),{"x-upsert":String(_.upsert)});typeof Blob<"u"&&n instanceof Blob?(g=new FormData,g.append("cacheControl",_.cacheControl),g.append("",n)):typeof FormData<"u"&&n instanceof FormData?(g=n,g.append("cacheControl",_.cacheControl)):(g=n,S["cache-control"]=`max-age=${_.cacheControl}`,S["content-type"]=_.contentType);const E=yield u3(this.fetch,i.toString(),g,{headers:S});return{data:{path:l,fullPath:E.Key},error:null}}catch(g){if(this.shouldThrowOnError)throw g;if(vo(g))return{data:null,error:g};throw g}})}createSignedUploadUrl(t,r){return On(this,void 0,void 0,function*(){try{let n=this._getFinalPath(t);const o=Object.assign({},this.headers);r!=null&&r.upsert&&(o["x-upsert"]="true");const l=yield cd(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:o}),d=new URL(this.url+l.url),i=d.searchParams.get("token");if(!i)throw new qB("No token returned by API");return{data:{signedUrl:d.toString(),path:t,token:i},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(vo(n))return{data:null,error:n};throw n}})}update(t,r,n){return On(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,r,n)})}move(t,r,n){return On(this,void 0,void 0,function*(){try{return{data:yield cd(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(vo(o))return{data:null,error:o};throw o}})}copy(t,r,n){return On(this,void 0,void 0,function*(){try{return{data:{path:(yield cd(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(vo(o))return{data:null,error:o};throw o}})}createSignedUrl(t,r,n){return On(this,void 0,void 0,function*(){try{let o=this._getFinalPath(t),l=yield cd(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:r},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const d=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return l={signedUrl:encodeURI(`${this.url}${l.signedURL}${d}`)},{data:l,error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(vo(o))return{data:null,error:o};throw o}})}createSignedUrls(t,r,n){return On(this,void 0,void 0,function*(){try{const o=yield cd(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:t},{headers:this.headers}),l=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:o.map(d=>Object.assign(Object.assign({},d),{signedUrl:d.signedURL?encodeURI(`${this.url}${d.signedURL}${l}`):null})),error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(vo(o))return{data:null,error:o};throw o}})}download(t,r){const o=typeof(r==null?void 0:r.transform)<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString((r==null?void 0:r.transform)||{}),d=l?`?${l}`:"",i=this._getFinalPath(t),g=()=>OE(this.fetch,`${this.url}/${o}/${i}${d}`,{headers:this.headers,noResolveJson:!0});return new Ube(g,this.shouldThrowOnError)}info(t){return On(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{const n=yield OE(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:c3(n),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(vo(n))return{data:null,error:n};throw n}})}exists(t){return On(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{return yield Bbe(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(vo(n)&&n instanceof l3){const o=n.originalError;if([400,404].includes(o==null?void 0:o.status))return{data:!1,error:n}}throw n}})}getPublicUrl(t,r){const n=this._getFinalPath(t),o=[],l=r!=null&&r.download?`download=${r.download===!0?"":r.download}`:"";l!==""&&o.push(l);const i=typeof(r==null?void 0:r.transform)<"u"?"render/image":"object",g=this.transformOptsToQueryString((r==null?void 0:r.transform)||{});g!==""&&o.push(g);let _=o.join("&");return _!==""&&(_=`?${_}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${n}${_}`)}}}remove(t){return On(this,void 0,void 0,function*(){try{return{data:yield GB(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(vo(r))return{data:null,error:r};throw r}})}list(t,r,n){return On(this,void 0,void 0,function*(){try{const o=Object.assign(Object.assign(Object.assign({},Vbe),r),{prefix:t||""});return{data:yield cd(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},n),error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(vo(o))return{data:null,error:o};throw o}})}listV2(t,r){return On(this,void 0,void 0,function*(){try{const n=Object.assign({},t);return{data:yield cd(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(vo(n))return{data:null,error:n};throw n}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const r=[];return t.width&&r.push(`width=${t.width}`),t.height&&r.push(`height=${t.height}`),t.resize&&r.push(`resize=${t.resize}`),t.format&&r.push(`format=${t.format}`),t.quality&&r.push(`quality=${t.quality}`),r.join("&")}}const fee="2.84.0",pee={"X-Client-Info":`storage-js/${fee}`};class Wbe{constructor(t,r={},n,o){this.shouldThrowOnError=!1;const l=new URL(t);o!=null&&o.useNewHostname&&/supabase\.(co|in|red)$/.test(l.hostname)&&!l.hostname.includes("storage.supabase.")&&(l.hostname=l.hostname.replace("supabase.","storage.supabase.")),this.url=l.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},pee),r),this.fetch=WB(n)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(t){return On(this,void 0,void 0,function*(){try{const r=this.listBucketOptionsToQueryString(t);return{data:yield OE(this.fetch,`${this.url}/bucket${r}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(vo(r))return{data:null,error:r};throw r}})}getBucket(t){return On(this,void 0,void 0,function*(){try{return{data:yield OE(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(vo(r))return{data:null,error:r};throw r}})}createBucket(t){return On(this,arguments,void 0,function*(r,n={public:!1}){try{return{data:yield cd(this.fetch,`${this.url}/bucket`,{id:r,name:r,type:n.type,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(vo(o))return{data:null,error:o};throw o}})}updateBucket(t,r){return On(this,void 0,void 0,function*(){try{return{data:yield u3(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(vo(n))return{data:null,error:n};throw n}})}emptyBucket(t){return On(this,void 0,void 0,function*(){try{return{data:yield cd(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(vo(r))return{data:null,error:r};throw r}})}deleteBucket(t){return On(this,void 0,void 0,function*(){try{return{data:yield GB(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(vo(r))return{data:null,error:r};throw r}})}listBucketOptionsToQueryString(t){const r={};return t&&("limit"in t&&(r.limit=String(t.limit)),"offset"in t&&(r.offset=String(t.offset)),t.search&&(r.search=t.search),t.sortColumn&&(r.sortColumn=t.sortColumn),t.sortOrder&&(r.sortOrder=t.sortOrder)),Object.keys(r).length>0?"?"+new URLSearchParams(r).toString():""}}class Gbe{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},pee),r),this.fetch=WB(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return On(this,void 0,void 0,function*(){try{return{data:yield cd(this.fetch,`${this.url}/bucket`,{name:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(vo(r))return{data:null,error:r};throw r}})}listBuckets(t){return On(this,void 0,void 0,function*(){try{const r=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&r.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&r.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&r.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&r.set("sortOrder",t.sortOrder),t!=null&&t.search&&r.set("search",t.search);const n=r.toString(),o=n?`${this.url}/bucket?${n}`:`${this.url}/bucket`;return{data:yield OE(this.fetch,o,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(vo(r))return{data:null,error:r};throw r}})}deleteBucket(t){return On(this,void 0,void 0,function*(){try{return{data:yield GB(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(vo(r))return{data:null,error:r};throw r}})}}const HB={"X-Client-Info":`storage-js/${fee}`,"Content-Type":"application/json"};class mee extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function Vc(e){return typeof e=="object"&&e!==null&&"__isStorageVectorsError"in e}class jM extends mee{constructor(t,r,n){super(t),this.name="StorageVectorsApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Hbe extends mee{constructor(t,r){super(t),this.name="StorageVectorsUnknownError",this.originalError=r}}var p9;(function(e){e.InternalError="InternalError",e.S3VectorConflictException="S3VectorConflictException",e.S3VectorNotFoundException="S3VectorNotFoundException",e.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",e.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",e.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(p9||(p9={}));const KB=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),Kbe=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},m9=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Zbe=(e,t,r)=>On(void 0,void 0,void 0,function*(){if(e&&typeof e=="object"&&"status"in e&&"ok"in e&&typeof e.status=="number"&&!(r!=null&&r.noResolveJson)){const o=e.status||500,l=e;if(typeof l.json=="function")l.json().then(d=>{const i=(d==null?void 0:d.statusCode)||(d==null?void 0:d.code)||o+"";t(new jM(m9(d),o,i))}).catch(()=>{const d=o+"",i=l.statusText||`HTTP ${o} error`;t(new jM(i,o,d))});else{const d=o+"",i=l.statusText||`HTTP ${o} error`;t(new jM(i,o,d))}}else t(new Hbe(m9(e),e))}),Xbe=(e,t,r,n)=>{const o={method:e,headers:(t==null?void 0:t.headers)||{}};return n?(Kbe(n)?(o.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),o.body=JSON.stringify(n)):o.body=n,Object.assign(Object.assign({},o),r)):o};function Ybe(e,t,r,n,o,l){return On(this,void 0,void 0,function*(){return new Promise((d,i)=>{e(r,Xbe(t,n,o,l)).then(g=>{if(!g.ok)throw g;if(n!=null&&n.noResolveJson)return g;const _=g.headers.get("content-type");return!_||!_.includes("application/json")?{}:g.json()}).then(g=>d(g)).catch(g=>Zbe(g,i,n))})})}function qc(e,t,r,n,o){return On(this,void 0,void 0,function*(){return Ybe(e,"POST",t,n,o,r)})}class Jbe{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},HB),r),this.fetch=KB(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(t){return On(this,void 0,void 0,function*(){try{return{data:(yield qc(this.fetch,`${this.url}/CreateIndex`,t,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Vc(r))return{data:null,error:r};throw r}})}getIndex(t,r){return On(this,void 0,void 0,function*(){try{return{data:yield qc(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:t,indexName:r},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Vc(n))return{data:null,error:n};throw n}})}listIndexes(t){return On(this,void 0,void 0,function*(){try{return{data:yield qc(this.fetch,`${this.url}/ListIndexes`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Vc(r))return{data:null,error:r};throw r}})}deleteIndex(t,r){return On(this,void 0,void 0,function*(){try{return{data:(yield qc(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:t,indexName:r},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Vc(n))return{data:null,error:n};throw n}})}}class Qbe{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},HB),r),this.fetch=KB(n)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(t){return On(this,void 0,void 0,function*(){try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield qc(this.fetch,`${this.url}/PutVectors`,t,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Vc(r))return{data:null,error:r};throw r}})}getVectors(t){return On(this,void 0,void 0,function*(){try{return{data:yield qc(this.fetch,`${this.url}/GetVectors`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Vc(r))return{data:null,error:r};throw r}})}listVectors(t){return On(this,void 0,void 0,function*(){try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:yield qc(this.fetch,`${this.url}/ListVectors`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Vc(r))return{data:null,error:r};throw r}})}queryVectors(t){return On(this,void 0,void 0,function*(){try{return{data:yield qc(this.fetch,`${this.url}/QueryVectors`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Vc(r))return{data:null,error:r};throw r}})}deleteVectors(t){return On(this,void 0,void 0,function*(){try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield qc(this.fetch,`${this.url}/DeleteVectors`,t,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Vc(r))return{data:null,error:r};throw r}})}}class ewe{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},HB),r),this.fetch=KB(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return On(this,void 0,void 0,function*(){try{return{data:(yield qc(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Vc(r))return{data:null,error:r};throw r}})}getBucket(t){return On(this,void 0,void 0,function*(){try{return{data:yield qc(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Vc(r))return{data:null,error:r};throw r}})}listBuckets(){return On(this,arguments,void 0,function*(t={}){try{return{data:yield qc(this.fetch,`${this.url}/ListVectorBuckets`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Vc(r))return{data:null,error:r};throw r}})}deleteBucket(t){return On(this,void 0,void 0,function*(){try{return{data:(yield qc(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Vc(r))return{data:null,error:r};throw r}})}}class twe extends ewe{constructor(t,r={}){super(t,r.headers||{},r.fetch)}from(t){return new rwe(this.url,this.headers,t,this.fetch)}}class rwe extends Jbe{constructor(t,r,n,o){super(t,r,o),this.vectorBucketName=n}createIndex(t){const r=Object.create(null,{createIndex:{get:()=>super.createIndex}});return On(this,void 0,void 0,function*(){return r.createIndex.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const t=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return On(this,arguments,void 0,function*(r={}){return t.listIndexes.call(this,Object.assign(Object.assign({},r),{vectorBucketName:this.vectorBucketName}))})}getIndex(t){const r=Object.create(null,{getIndex:{get:()=>super.getIndex}});return On(this,void 0,void 0,function*(){return r.getIndex.call(this,this.vectorBucketName,t)})}deleteIndex(t){const r=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return On(this,void 0,void 0,function*(){return r.deleteIndex.call(this,this.vectorBucketName,t)})}index(t){return new nwe(this.url,this.headers,this.vectorBucketName,t,this.fetch)}}class nwe extends Qbe{constructor(t,r,n,o,l){super(t,r,l),this.vectorBucketName=n,this.indexName=o}putVectors(t){const r=Object.create(null,{putVectors:{get:()=>super.putVectors}});return On(this,void 0,void 0,function*(){return r.putVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(t){const r=Object.create(null,{getVectors:{get:()=>super.getVectors}});return On(this,void 0,void 0,function*(){return r.getVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const t=Object.create(null,{listVectors:{get:()=>super.listVectors}});return On(this,arguments,void 0,function*(r={}){return t.listVectors.call(this,Object.assign(Object.assign({},r),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(t){const r=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return On(this,void 0,void 0,function*(){return r.queryVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(t){const r=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return On(this,void 0,void 0,function*(){return r.deleteVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class iwe extends Wbe{constructor(t,r={},n,o){super(t,r,n,o)}from(t){return new qbe(this.url,this.headers,t,this.fetch)}get vectors(){return new twe(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Gbe(this.url+"/iceberg",this.headers,this.fetch)}}const awe="2.84.0";let OS="";typeof Deno<"u"?OS="deno":typeof document<"u"?OS="web":typeof navigator<"u"&&navigator.product==="ReactNative"?OS="react-native":OS="node";const owe={"X-Client-Info":`supabase-js-${OS}/${awe}`},swe={headers:owe},lwe={schema:"public"},cwe={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},uwe={},dwe=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),hwe=()=>Headers,fwe=(e,t,r)=>{const n=dwe(r),o=hwe();return async(l,d)=>{var i;const g=(i=await t())!==null&&i!==void 0?i:e;let _=new o(d==null?void 0:d.headers);return _.has("apikey")||_.set("apikey",e),_.has("Authorization")||_.set("Authorization",`Bearer ${g}`),n(l,Object.assign(Object.assign({},d),{headers:_}))}};function pwe(e){return e.endsWith("/")?e:e+"/"}function mwe(e,t){var r,n;const{db:o,auth:l,realtime:d,global:i}=e,{db:g,auth:_,realtime:S,global:E}=t,T={db:Object.assign(Object.assign({},g),o),auth:Object.assign(Object.assign({},_),l),realtime:Object.assign(Object.assign({},S),d),storage:{},global:Object.assign(Object.assign(Object.assign({},E),i),{headers:Object.assign(Object.assign({},(r=E==null?void 0:E.headers)!==null&&r!==void 0?r:{}),(n=i==null?void 0:i.headers)!==null&&n!==void 0?n:{})}),accessToken:async()=>""};return e.accessToken?T.accessToken=e.accessToken:delete T.accessToken,T}function gwe(e){const t=e==null?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(pwe(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const gee="2.84.0",Px=30*1e3,d3=3,NM=d3*Px,ywe="http://localhost:9999",vwe="supabase.auth.token",_we={"X-Client-Info":`gotrue-js/${gee}`},h3="X-Supabase-Api-Version",yee={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},xwe=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,bwe=10*60*1e3;class j0 extends Error{constructor(t,r,n){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function Rn(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class vee extends j0{constructor(t,r,n){super(t,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function _ee(e){return Rn(e)&&e.name==="AuthApiError"}class am extends j0{constructor(t,r){super(t),this.name="AuthUnknownError",this.originalError=r}}class Wf extends j0{constructor(t,r,n,o){super(t,n,o),this.name=r,this.status=n}}class cc extends Wf{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function xee(e){return Rn(e)&&e.name==="AuthSessionMissingError"}class by extends Wf{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class kS extends Wf{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class IS extends Wf{constructor(t,r=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function bee(e){return Rn(e)&&e.name==="AuthImplicitGrantRedirectError"}class f3 extends Wf{constructor(t,r=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class dO extends Wf{constructor(t,r){super(t,"AuthRetryableFetchError",r,void 0)}}function gC(e){return Rn(e)&&e.name==="AuthRetryableFetchError"}class p3 extends Wf{constructor(t,r,n){super(t,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class hO extends Wf{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const fO="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),g9=` 	
\r=`.split(""),wwe=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<g9.length;t+=1)e[g9[t].charCodeAt(0)]=-2;for(let t=0;t<fO.length;t+=1)e[fO[t].charCodeAt(0)]=t;return e})();function y9(e,t,r){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(fO[n]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(fO[n]),t.queuedBits-=6}}function wee(e,t,r){const n=wwe[e];if(n>-1)for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function v9(e){const t=[],r=d=>{t.push(String.fromCodePoint(d))},n={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},l=d=>{Twe(d,n,r)};for(let d=0;d<e.length;d+=1)wee(e.charCodeAt(d),o,l);return t.join("")}function Swe(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function Ewe(e,t){for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r);if(n>55295&&n<=56319){const o=(n-55296)*1024&65535;n=(e.charCodeAt(r+1)-56320&65535|o)+65536,r+=1}Swe(n,t)}}function Twe(e,t,r){if(t.utf8seq===0){if(e<=127){r(e);return}for(let n=1;n<6;n+=1)if(!(e>>7-n&1)){t.utf8seq=n;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&r(t.codepoint)}}function n0(e){const t=[],r={queue:0,queuedBits:0},n=o=>{t.push(o)};for(let o=0;o<e.length;o+=1)wee(e.charCodeAt(o),r,n);return new Uint8Array(t)}function Awe(e){const t=[];return Ewe(e,r=>t.push(r)),new Uint8Array(t)}function Dy(e){const t=[],r={queue:0,queuedBits:0},n=o=>{t.push(o)};return e.forEach(o=>y9(o,r,n)),y9(null,r,n),t.join("")}function Pwe(e){return Math.round(Date.now()/1e3)+e}function Cwe(){return Symbol("auth-callback")}const Bs=()=>typeof window<"u"&&typeof document<"u",fy={tested:!1,writable:!1},See=()=>{if(!Bs())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(fy.tested)return fy.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),fy.tested=!0,fy.writable=!0}catch{fy.tested=!0,fy.writable=!1}return fy.writable};function Owe(e){const t={},r=new URL(e);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((o,l)=>{t[l]=o})}catch{}return r.searchParams.forEach((n,o)=>{t[o]=n}),t}const Eee=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),kwe=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",Cx=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},py=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch{return r}},qp=async(e,t)=>{await e.removeItem(t)};class wI{constructor(){this.promise=new wI.promiseConstructor((t,r)=>{this.resolve=t,this.reject=r})}}wI.promiseConstructor=Promise;function MM(e){const t=e.split(".");if(t.length!==3)throw new hO("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!xwe.test(t[n]))throw new hO("JWT not in base64url format");return{header:JSON.parse(v9(t[0])),payload:JSON.parse(v9(t[1])),signature:n0(t[2]),raw:{header:t[0],payload:t[1]}}}async function Iwe(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function Rwe(e,t){return new Promise((n,o)=>{(async()=>{for(let l=0;l<1/0;l++)try{const d=await e(l);if(!t(l,null,d)){n(d);return}}catch(d){if(!t(l,d)){o(d);return}}})()})}function jwe(e){return("0"+e.toString(16)).substr(-2)}function Nwe(){const t=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let o="";for(let l=0;l<56;l++)o+=r.charAt(Math.floor(Math.random()*n));return o}return crypto.getRandomValues(t),Array.from(t,jwe).join("")}async function Mwe(e){const r=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",r),o=new Uint8Array(n);return Array.from(o).map(l=>String.fromCharCode(l)).join("")}async function Dwe(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const r=await Mwe(e);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function hx(e,t,r=!1){const n=Nwe();let o=n;r&&(o+="/PASSWORD_RECOVERY"),await Cx(e,`${t}-code-verifier`,o);const l=await Dwe(n);return[l,n===l?"plain":"s256"]}const Lwe=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Fwe(e){const t=e.headers.get(h3);if(!t||!t.match(Lwe))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function zwe(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function Bwe(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const $we=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function fx(e){if(!$we.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function DM(){const e={};return new Proxy(e,{get:(t,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Uwe(e,t){return new Proxy(e,{get:(r,n,o)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const l=n.toString();if(l==="Symbol(Symbol.toPrimitive)"||l==="Symbol(Symbol.toStringTag)"||l==="Symbol(util.inspect.custom)"||l==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,n,o)}return!t.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(r,n,o)}})}function _9(e){return JSON.parse(JSON.stringify(e))}const wy=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Vwe=[502,503,504];async function x9(e){var t;if(!kwe(e))throw new dO(wy(e),0);if(Vwe.includes(e.status))throw new dO(wy(e),e.status);let r;try{r=await e.json()}catch(l){throw new am(wy(l),l)}let n;const o=Fwe(e);if(o&&o.getTime()>=yee["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new p3(wy(r),e.status,((t=r.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(n==="session_not_found")throw new cc}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((l,d)=>l&&typeof d=="string",!0))throw new p3(wy(r),e.status,r.weak_password.reasons);throw new vee(wy(r),e.status||500,n)}const qwe=(e,t,r,n)=>{const o={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),o.body=JSON.stringify(n),Object.assign(Object.assign({},o),r))};async function ei(e,t,r,n){var o;const l=Object.assign({},n==null?void 0:n.headers);l[h3]||(l[h3]=yee["2024-01-01"].name),n!=null&&n.jwt&&(l.Authorization=`Bearer ${n.jwt}`);const d=(o=n==null?void 0:n.query)!==null&&o!==void 0?o:{};n!=null&&n.redirectTo&&(d.redirect_to=n.redirectTo);const i=Object.keys(d).length?"?"+new URLSearchParams(d).toString():"",g=await Wwe(e,t,r+i,{headers:l,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(g):{data:Object.assign({},g),error:null}}async function Wwe(e,t,r,n,o,l){const d=qwe(t,n,o,l);let i;try{i=await e(r,Object.assign({},d))}catch(g){throw console.error(g),new dO(wy(g),0)}if(i.ok||await x9(i),n!=null&&n.noResolveJson)return i;try{return await i.json()}catch(g){await x9(g)}}function od(e){var t;let r=null;Kwe(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=Pwe(e.expires_in)));const n=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:r,user:n},error:null}}function b9(e){const t=od(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(t.data.weak_password=e.weak_password),t}function om(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function Gwe(e){return{data:e,error:null}}function Hwe(e){const{action_link:t,email_otp:r,hashed_token:n,redirect_to:o,verification_type:l}=e,d=ig(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),i={action_link:t,email_otp:r,hashed_token:n,redirect_to:o,verification_type:l},g=Object.assign({},d);return{data:{properties:i,user:g},error:null}}function w9(e){return e}function Kwe(e){return e.access_token&&e.refresh_token&&e.expires_in}const yC=["global","local","others"];class Tee{constructor({url:t="",headers:r={},fetch:n}){this.url=t,this.headers=r,this.fetch=Eee(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,r=yC[0]){if(yC.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${yC.join(", ")}`);try{return await ei(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Rn(n))return{data:null,error:n};throw n}}async inviteUserByEmail(t,r={}){try{return await ei(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:om})}catch(n){if(Rn(n))return{data:{user:null},error:n};throw n}}async generateLink(t){try{const{options:r}=t,n=ig(t,["options"]),o=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(o.new_email=n==null?void 0:n.newEmail,delete o.newEmail),await ei(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:Hwe,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if(Rn(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(t){try{return await ei(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:om})}catch(r){if(Rn(r))return{data:{user:null},error:r};throw r}}async listUsers(t){var r,n,o,l,d,i,g;try{const _={nextPage:null,lastPage:0,total:0},S=await ei(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(l=(o=t==null?void 0:t.perPage)===null||o===void 0?void 0:o.toString())!==null&&l!==void 0?l:""},xform:w9});if(S.error)throw S.error;const E=await S.json(),T=(d=S.headers.get("x-total-count"))!==null&&d!==void 0?d:0,C=(g=(i=S.headers.get("link"))===null||i===void 0?void 0:i.split(","))!==null&&g!==void 0?g:[];return C.length>0&&(C.forEach(N=>{const I=parseInt(N.split(";")[0].split("=")[1].substring(0,1)),j=JSON.parse(N.split(";")[1].split("=")[1]);_[`${j}Page`]=I}),_.total=parseInt(T)),{data:Object.assign(Object.assign({},E),_),error:null}}catch(_){if(Rn(_))return{data:{users:[]},error:_};throw _}}async getUserById(t){fx(t);try{return await ei(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:om})}catch(r){if(Rn(r))return{data:{user:null},error:r};throw r}}async updateUserById(t,r){fx(t);try{return await ei(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:r,headers:this.headers,xform:om})}catch(n){if(Rn(n))return{data:{user:null},error:n};throw n}}async deleteUser(t,r=!1){fx(t);try{return await ei(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:r},xform:om})}catch(n){if(Rn(n))return{data:{user:null},error:n};throw n}}async _listFactors(t){fx(t.userId);try{const{data:r,error:n}=await ei(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:r,error:n}}catch(r){if(Rn(r))return{data:null,error:r};throw r}}async _deleteFactor(t){fx(t.userId),fx(t.id);try{return{data:await ei(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(r){if(Rn(r))return{data:null,error:r};throw r}}async _listOAuthClients(t){var r,n,o,l,d,i,g;try{const _={nextPage:null,lastPage:0,total:0},S=await ei(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(l=(o=t==null?void 0:t.perPage)===null||o===void 0?void 0:o.toString())!==null&&l!==void 0?l:""},xform:w9});if(S.error)throw S.error;const E=await S.json(),T=(d=S.headers.get("x-total-count"))!==null&&d!==void 0?d:0,C=(g=(i=S.headers.get("link"))===null||i===void 0?void 0:i.split(","))!==null&&g!==void 0?g:[];return C.length>0&&(C.forEach(N=>{const I=parseInt(N.split(";")[0].split("=")[1].substring(0,1)),j=JSON.parse(N.split(";")[1].split("=")[1]);_[`${j}Page`]=I}),_.total=parseInt(T)),{data:Object.assign(Object.assign({},E),_),error:null}}catch(_){if(Rn(_))return{data:{clients:[]},error:_};throw _}}async _createOAuthClient(t){try{return await ei(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Rn(r))return{data:null,error:r};throw r}}async _getOAuthClient(t){try{return await ei(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Rn(r))return{data:null,error:r};throw r}}async _updateOAuthClient(t,r){try{return await ei(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:r,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Rn(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(t){try{return await ei(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Rn(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(t){try{return await ei(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Rn(r))return{data:null,error:r};throw r}}}function S9(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const Sy={debug:!!(globalThis&&See()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Aee extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class Pee extends Aee{}async function Cee(e,t,r){Sy.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),Sy.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async o=>{if(o){Sy.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,o.name);try{return await r()}finally{Sy.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,o.name)}}else{if(t===0)throw Sy.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Pee(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Sy.debug)try{const l=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(l,null,"  "))}catch(l){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",l)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function Zwe(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Oee(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function Xwe(e){return parseInt(e,16)}function Ywe(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,n=>n.toString(16).padStart(2,"0")).join("")}function Jwe(e){var t;const{chainId:r,domain:n,expirationTime:o,issuedAt:l=new Date,nonce:d,notBefore:i,requestId:g,resources:_,scheme:S,uri:E,version:T}=e;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(d&&d.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${d}`);if(!E)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(T!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${T}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const C=Oee(e.address),N=S?`${S}://${n}`:n,I=e.statement?`${e.statement}
`:"",j=`${N} wants you to sign in with your Ethereum account:
${C}

${I}`;let D=`URI: ${E}
Version: ${T}
Chain ID: ${r}${d?`
Nonce: ${d}`:""}
Issued At: ${l.toISOString()}`;if(o&&(D+=`
Expiration Time: ${o.toISOString()}`),i&&(D+=`
Not Before: ${i.toISOString()}`),g&&(D+=`
Request ID: ${g}`),_){let R=`
Resources:`;for(const F of _){if(!F||typeof F!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${F}`);R+=`
- ${F}`}D+=R}return`${j}
${D}`}class Yo extends Error{constructor({message:t,code:r,cause:n,name:o}){var l;super(t,{cause:n}),this.__isWebAuthnError=!0,this.name=(l=o??(n instanceof Error?n.name:void 0))!==null&&l!==void 0?l:"Unknown Error",this.code=r}}class pO extends Yo{constructor(t,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:t}),this.name="WebAuthnUnknownError",this.originalError=r}}function Qwe({error:e,options:t}){var r,n,o;const{publicKey:l}=t;if(!l)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Yo({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((r=l.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new Yo({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((n=l.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Yo({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((o=l.authenticatorSelection)===null||o===void 0?void 0:o.userVerification)==="required")return new Yo({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new Yo({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new Yo({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return l.pubKeyCredParams.filter(i=>i.type==="public-key").length===0?new Yo({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new Yo({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const d=window.location.hostname;if(kee(d)){if(l.rp.id!==d)return new Yo({message:`The RP ID "${l.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Yo({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(l.user.id.byteLength<1||l.user.id.byteLength>64)return new Yo({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new Yo({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Yo({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function e1e({error:e,options:t}){const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Yo({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new Yo({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const n=window.location.hostname;if(kee(n)){if(r.rpId!==n)return new Yo({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Yo({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new Yo({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Yo({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}class t1e{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const r1e=new t1e;function n1e(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:r,excludeCredentials:n}=e,o=ig(e,["challenge","user","excludeCredentials"]),l=n0(t).buffer,d=Object.assign(Object.assign({},r),{id:n0(r.id).buffer}),i=Object.assign(Object.assign({},o),{challenge:l,user:d});if(n&&n.length>0){i.excludeCredentials=new Array(n.length);for(let g=0;g<n.length;g++){const _=n[g];i.excludeCredentials[g]=Object.assign(Object.assign({},_),{id:n0(_.id).buffer,type:_.type||"public-key",transports:_.transports})}}return i}function i1e(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:r}=e,n=ig(e,["challenge","allowCredentials"]),o=n0(t).buffer,l=Object.assign(Object.assign({},n),{challenge:o});if(r&&r.length>0){l.allowCredentials=new Array(r.length);for(let d=0;d<r.length;d++){const i=r[d];l.allowCredentials[d]=Object.assign(Object.assign({},i),{id:n0(i.id).buffer,type:i.type||"public-key",transports:i.transports})}}return l}function a1e(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e;return{id:e.id,rawId:e.id,response:{attestationObject:Dy(new Uint8Array(e.response.attestationObject)),clientDataJSON:Dy(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function o1e(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e,n=e.getClientExtensionResults(),o=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:Dy(new Uint8Array(o.authenticatorData)),clientDataJSON:Dy(new Uint8Array(o.clientDataJSON)),signature:Dy(new Uint8Array(o.signature)),userHandle:o.userHandle?Dy(new Uint8Array(o.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function kee(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function E9(){var e,t;return!!(Bs()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function s1e(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new pO("Browser returned unexpected credential type",t)}:{data:null,error:new pO("Empty credential response",t)}}catch(t){return{data:null,error:Qwe({error:t,options:e})}}}async function l1e(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new pO("Browser returned unexpected credential type",t)}:{data:null,error:new pO("Empty credential response",t)}}catch(t){return{data:null,error:e1e({error:t,options:e})}}}const c1e={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},u1e={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function mO(...e){const t=o=>o!==null&&typeof o=="object"&&!Array.isArray(o),r=o=>o instanceof ArrayBuffer||ArrayBuffer.isView(o),n={};for(const o of e)if(o)for(const l in o){const d=o[l];if(d!==void 0)if(Array.isArray(d))n[l]=d;else if(r(d))n[l]=d;else if(t(d)){const i=n[l];t(i)?n[l]=mO(i,d):n[l]=mO(d)}else n[l]=d}return n}function d1e(e,t){return mO(c1e,e,t||{})}function h1e(e,t){return mO(u1e,e,t||{})}class f1e{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:r,friendlyName:n,signal:o},l){try{const{data:d,error:i}=await this.client.mfa.challenge({factorId:t,webauthn:r});if(!d)return{data:null,error:i};const g=o??r1e.createNewAbortSignal();if(d.webauthn.type==="create"){const{user:_}=d.webauthn.credential_options.publicKey;_.name||(_.name=`${_.id}:${n}`),_.displayName||(_.displayName=_.name)}switch(d.webauthn.type){case"create":{const _=d1e(d.webauthn.credential_options.publicKey,l==null?void 0:l.create),{data:S,error:E}=await s1e({publicKey:_,signal:g});return S?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:S}},error:null}:{data:null,error:E}}case"request":{const _=h1e(d.webauthn.credential_options.publicKey,l==null?void 0:l.request),{data:S,error:E}=await l1e(Object.assign(Object.assign({},d.webauthn.credential_options),{publicKey:_,signal:g}));return S?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:S}},error:null}:{data:null,error:E}}}}catch(d){return Rn(d)?{data:null,error:d}:{data:null,error:new am("Unexpected error in challenge",d)}}}async _verify({challengeId:t,factorId:r,webauthn:n}){return this.client.mfa.verify({factorId:r,challengeId:t,webauthn:n})}async _authenticate({factorId:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},l){if(!r)return{data:null,error:new j0("rpId is required for WebAuthn authentication")};try{if(!E9())return{data:null,error:new am("Browser does not support WebAuthn",null)};const{data:d,error:i}=await this.challenge({factorId:t,webauthn:{rpId:r,rpOrigins:n},signal:o},{request:l});if(!d)return{data:null,error:i};const{webauthn:g}=d;return this._verify({factorId:t,challengeId:d.challengeId,webauthn:{type:g.type,rpId:r,rpOrigins:n,credential_response:g.credential_response}})}catch(d){return Rn(d)?{data:null,error:d}:{data:null,error:new am("Unexpected error in authenticate",d)}}}async _register({friendlyName:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},l){if(!r)return{data:null,error:new j0("rpId is required for WebAuthn registration")};try{if(!E9())return{data:null,error:new am("Browser does not support WebAuthn",null)};const{data:d,error:i}=await this._enroll({friendlyName:t});if(!d)return await this.client.mfa.listFactors().then(S=>{var E;return(E=S.data)===null||E===void 0?void 0:E.all.find(T=>T.factor_type==="webauthn"&&T.friendly_name===t&&T.status!=="unverified")}).then(S=>S?this.client.mfa.unenroll({factorId:S==null?void 0:S.id}):void 0),{data:null,error:i};const{data:g,error:_}=await this._challenge({factorId:d.id,friendlyName:d.friendly_name,webauthn:{rpId:r,rpOrigins:n},signal:o},{create:l});return g?this._verify({factorId:d.id,challengeId:g.challengeId,webauthn:{rpId:r,rpOrigins:n,type:g.webauthn.type,credential_response:g.webauthn.credential_response}}):{data:null,error:_}}catch(d){return Rn(d)?{data:null,error:d}:{data:null,error:new am("Unexpected error in register",d)}}}}Zwe();const p1e={url:ywe,storageKey:vwe,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:_we,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function T9(e,t,r){return await r()}const px={};class N0{get jwks(){var t,r;return(r=(t=px[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(t){px[this.storageKey]=Object.assign(Object.assign({},px[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,r;return(r=(t=px[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){px[this.storageKey]=Object.assign(Object.assign({},px[this.storageKey]),{cachedAt:t})}constructor(t){var r,n,o;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const l=Object.assign(Object.assign({},p1e),t);if(this.storageKey=l.storageKey,this.instanceID=(r=N0.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,N0.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!l.debug,typeof l.debug=="function"&&(this.logger=l.debug),this.instanceID>0&&Bs()){const d=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(d),this.logDebugMessages&&console.trace(d)}if(this.persistSession=l.persistSession,this.autoRefreshToken=l.autoRefreshToken,this.admin=new Tee({url:l.url,headers:l.headers,fetch:l.fetch}),this.url=l.url,this.headers=l.headers,this.fetch=Eee(l.fetch),this.lock=l.lock||T9,this.detectSessionInUrl=l.detectSessionInUrl,this.flowType=l.flowType,this.hasCustomAuthorizationHeader=l.hasCustomAuthorizationHeader,this.throwOnError=l.throwOnError,l.lock?this.lock=l.lock:Bs()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=Cee:this.lock=T9,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new f1e(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(l.storage?this.storage=l.storage:See()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=S9(this.memoryStorage)),l.userStorage&&(this.userStorage=l.userStorage)):(this.memoryStorage={},this.storage=S9(this.memoryStorage)),Bs()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(d){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",d)}(o=this.broadcastChannel)===null||o===void 0||o.addEventListener("message",async d=>{this._debug("received broadcast notification from other tab or client",d),await this._notifyAllSubscribers(d.data.event,d.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${gee}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let r={},n="none";if(Bs()&&(r=Owe(window.location.href),this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce")),Bs()&&this.detectSessionInUrl&&n!=="none"){const{data:o,error:l}=await this._getSessionFromURL(r,n);if(l){if(this._debug("#_initialize()","error detecting session from URL",l),bee(l)){const g=(t=l.details)===null||t===void 0?void 0:t.code;if(g==="identity_already_exists"||g==="identity_not_found"||g==="single_identity_not_deletable")return{error:l}}return await this._removeSession(),{error:l}}const{session:d,redirectType:i}=o;return this._debug("#_initialize()","detected session in URL",d,"redirect type",i),await this._saveSession(d),setTimeout(async()=>{i==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",d):await this._notifyAllSubscribers("SIGNED_IN",d)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return Rn(r)?this._returnResult({error:r}):this._returnResult({error:new am("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var r,n,o;try{const l=await ei(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=t==null?void 0:t.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(o=t==null?void 0:t.options)===null||o===void 0?void 0:o.captchaToken}},xform:od}),{data:d,error:i}=l;if(i||!d)return this._returnResult({data:{user:null,session:null},error:i});const g=d.session,_=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",g)),this._returnResult({data:{user:_,session:g},error:null})}catch(l){if(Rn(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async signUp(t){var r,n,o;try{let l;if("email"in t){const{email:S,password:E,options:T}=t;let C=null,N=null;this.flowType==="pkce"&&([C,N]=await hx(this.storage,this.storageKey)),l=await ei(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:T==null?void 0:T.emailRedirectTo,body:{email:S,password:E,data:(r=T==null?void 0:T.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:T==null?void 0:T.captchaToken},code_challenge:C,code_challenge_method:N},xform:od})}else if("phone"in t){const{phone:S,password:E,options:T}=t;l=await ei(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:S,password:E,data:(n=T==null?void 0:T.data)!==null&&n!==void 0?n:{},channel:(o=T==null?void 0:T.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:T==null?void 0:T.captchaToken}},xform:od})}else throw new kS("You must provide either an email or phone number and a password");const{data:d,error:i}=l;if(i||!d)return this._returnResult({data:{user:null,session:null},error:i});const g=d.session,_=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",g)),this._returnResult({data:{user:_,session:g},error:null})}catch(l){if(Rn(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async signInWithPassword(t){try{let r;if("email"in t){const{email:l,password:d,options:i}=t;r=await ei(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:l,password:d,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:b9})}else if("phone"in t){const{phone:l,password:d,options:i}=t;r=await ei(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:l,password:d,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:b9})}else throw new kS("You must provide either an email or phone number and a password");const{data:n,error:o}=r;if(o)return this._returnResult({data:{user:null,session:null},error:o});if(!n||!n.session||!n.user){const l=new by;return this._returnResult({data:{user:null,session:null},error:l})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:o})}catch(r){if(Rn(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(t){var r,n,o,l;return await this._handleProviderSignIn(t.provider,{redirectTo:(r=t.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=t.options)===null||n===void 0?void 0:n.scopes,queryParams:(o=t.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(l=t.options)===null||l===void 0?void 0:l.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:r}=t;switch(r){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(t){var r,n,o,l,d,i,g,_,S,E,T;let C,N;if("message"in t)C=t.message,N=t.signature;else{const{chain:I,wallet:j,statement:D,options:R}=t;let F;if(Bs())if(typeof j=="object")F=j;else{const ae=window;if("ethereum"in ae&&typeof ae.ethereum=="object"&&"request"in ae.ethereum&&typeof ae.ethereum.request=="function")F=ae.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof j!="object"||!(R!=null&&R.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");F=j}const B=new URL((r=R==null?void 0:R.url)!==null&&r!==void 0?r:window.location.href),U=await F.request({method:"eth_requestAccounts"}).then(ae=>ae).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!U||U.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const Z=Oee(U[0]);let J=(n=R==null?void 0:R.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!J){const ae=await F.request({method:"eth_chainId"});J=Xwe(ae)}const te={domain:B.host,address:Z,statement:D,uri:B.href,version:"1",chainId:J,nonce:(o=R==null?void 0:R.signInWithEthereum)===null||o===void 0?void 0:o.nonce,issuedAt:(d=(l=R==null?void 0:R.signInWithEthereum)===null||l===void 0?void 0:l.issuedAt)!==null&&d!==void 0?d:new Date,expirationTime:(i=R==null?void 0:R.signInWithEthereum)===null||i===void 0?void 0:i.expirationTime,notBefore:(g=R==null?void 0:R.signInWithEthereum)===null||g===void 0?void 0:g.notBefore,requestId:(_=R==null?void 0:R.signInWithEthereum)===null||_===void 0?void 0:_.requestId,resources:(S=R==null?void 0:R.signInWithEthereum)===null||S===void 0?void 0:S.resources};C=Jwe(te),N=await F.request({method:"personal_sign",params:[Ywe(C),Z]})}try{const{data:I,error:j}=await ei(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:C,signature:N},!((E=t.options)===null||E===void 0)&&E.captchaToken?{gotrue_meta_security:{captcha_token:(T=t.options)===null||T===void 0?void 0:T.captchaToken}}:null),xform:od});if(j)throw j;if(!I||!I.session||!I.user){const D=new by;return this._returnResult({data:{user:null,session:null},error:D})}return I.session&&(await this._saveSession(I.session),await this._notifyAllSubscribers("SIGNED_IN",I.session)),this._returnResult({data:Object.assign({},I),error:j})}catch(I){if(Rn(I))return this._returnResult({data:{user:null,session:null},error:I});throw I}}async signInWithSolana(t){var r,n,o,l,d,i,g,_,S,E,T,C;let N,I;if("message"in t)N=t.message,I=t.signature;else{const{chain:j,wallet:D,statement:R,options:F}=t;let B;if(Bs())if(typeof D=="object")B=D;else{const Z=window;if("solana"in Z&&typeof Z.solana=="object"&&("signIn"in Z.solana&&typeof Z.solana.signIn=="function"||"signMessage"in Z.solana&&typeof Z.solana.signMessage=="function"))B=Z.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof D!="object"||!(F!=null&&F.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");B=D}const U=new URL((r=F==null?void 0:F.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in B&&B.signIn){const Z=await B.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},F==null?void 0:F.signInWithSolana),{version:"1",domain:U.host,uri:U.href}),R?{statement:R}:null));let J;if(Array.isArray(Z)&&Z[0]&&typeof Z[0]=="object")J=Z[0];else if(Z&&typeof Z=="object"&&"signedMessage"in Z&&"signature"in Z)J=Z;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in J&&"signature"in J&&(typeof J.signedMessage=="string"||J.signedMessage instanceof Uint8Array)&&J.signature instanceof Uint8Array)N=typeof J.signedMessage=="string"?J.signedMessage:new TextDecoder().decode(J.signedMessage),I=J.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in B)||typeof B.signMessage!="function"||!("publicKey"in B)||typeof B!="object"||!B.publicKey||!("toBase58"in B.publicKey)||typeof B.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");N=[`${U.host} wants you to sign in with your Solana account:`,B.publicKey.toBase58(),...R?["",R,""]:[""],"Version: 1",`URI: ${U.href}`,`Issued At: ${(o=(n=F==null?void 0:F.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((l=F==null?void 0:F.signInWithSolana)===null||l===void 0)&&l.notBefore?[`Not Before: ${F.signInWithSolana.notBefore}`]:[],...!((d=F==null?void 0:F.signInWithSolana)===null||d===void 0)&&d.expirationTime?[`Expiration Time: ${F.signInWithSolana.expirationTime}`]:[],...!((i=F==null?void 0:F.signInWithSolana)===null||i===void 0)&&i.chainId?[`Chain ID: ${F.signInWithSolana.chainId}`]:[],...!((g=F==null?void 0:F.signInWithSolana)===null||g===void 0)&&g.nonce?[`Nonce: ${F.signInWithSolana.nonce}`]:[],...!((_=F==null?void 0:F.signInWithSolana)===null||_===void 0)&&_.requestId?[`Request ID: ${F.signInWithSolana.requestId}`]:[],...!((E=(S=F==null?void 0:F.signInWithSolana)===null||S===void 0?void 0:S.resources)===null||E===void 0)&&E.length?["Resources",...F.signInWithSolana.resources.map(J=>`- ${J}`)]:[]].join(`
`);const Z=await B.signMessage(new TextEncoder().encode(N),"utf8");if(!Z||!(Z instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");I=Z}}try{const{data:j,error:D}=await ei(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:N,signature:Dy(I)},!((T=t.options)===null||T===void 0)&&T.captchaToken?{gotrue_meta_security:{captcha_token:(C=t.options)===null||C===void 0?void 0:C.captchaToken}}:null),xform:od});if(D)throw D;if(!j||!j.session||!j.user){const R=new by;return this._returnResult({data:{user:null,session:null},error:R})}return j.session&&(await this._saveSession(j.session),await this._notifyAllSubscribers("SIGNED_IN",j.session)),this._returnResult({data:Object.assign({},j),error:D})}catch(j){if(Rn(j))return this._returnResult({data:{user:null,session:null},error:j});throw j}}async _exchangeCodeForSession(t){const r=await py(this.storage,`${this.storageKey}-code-verifier`),[n,o]=(r??"").split("/");try{const{data:l,error:d}=await ei(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:od});if(await qp(this.storage,`${this.storageKey}-code-verifier`),d)throw d;if(!l||!l.session||!l.user){const i=new by;return this._returnResult({data:{user:null,session:null,redirectType:null},error:i})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:Object.assign(Object.assign({},l),{redirectType:o??null}),error:d})}catch(l){if(Rn(l))return this._returnResult({data:{user:null,session:null,redirectType:null},error:l});throw l}}async signInWithIdToken(t){try{const{options:r,provider:n,token:o,access_token:l,nonce:d}=t,i=await ei(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:o,access_token:l,nonce:d,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:od}),{data:g,error:_}=i;if(_)return this._returnResult({data:{user:null,session:null},error:_});if(!g||!g.session||!g.user){const S=new by;return this._returnResult({data:{user:null,session:null},error:S})}return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),this._returnResult({data:g,error:_})}catch(r){if(Rn(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(t){var r,n,o,l,d;try{if("email"in t){const{email:i,options:g}=t;let _=null,S=null;this.flowType==="pkce"&&([_,S]=await hx(this.storage,this.storageKey));const{error:E}=await ei(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:i,data:(r=g==null?void 0:g.data)!==null&&r!==void 0?r:{},create_user:(n=g==null?void 0:g.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken},code_challenge:_,code_challenge_method:S},redirectTo:g==null?void 0:g.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:E})}if("phone"in t){const{phone:i,options:g}=t,{data:_,error:S}=await ei(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:i,data:(o=g==null?void 0:g.data)!==null&&o!==void 0?o:{},create_user:(l=g==null?void 0:g.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken},channel:(d=g==null?void 0:g.channel)!==null&&d!==void 0?d:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:_==null?void 0:_.message_id},error:S})}throw new kS("You must provide either an email or phone number.")}catch(i){if(Rn(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async verifyOtp(t){var r,n;try{let o,l;"options"in t&&(o=(r=t.options)===null||r===void 0?void 0:r.redirectTo,l=(n=t.options)===null||n===void 0?void 0:n.captchaToken);const{data:d,error:i}=await ei(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:l}}),redirectTo:o,xform:od});if(i)throw i;if(!d)throw new Error("An error occurred on token verification.");const g=d.session,_=d.user;return g!=null&&g.access_token&&(await this._saveSession(g),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",g)),this._returnResult({data:{user:_,session:g},error:null})}catch(o){if(Rn(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithSSO(t){var r,n,o,l,d;try{let i=null,g=null;this.flowType==="pkce"&&([i,g]=await hx(this.storage,this.storageKey));const _=await ei(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(n=(r=t.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((o=t==null?void 0:t.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:g}),headers:this.headers,xform:Gwe});return!((l=_.data)===null||l===void 0)&&l.url&&Bs()&&!(!((d=t.options)===null||d===void 0)&&d.skipBrowserRedirect)&&window.location.assign(_.data.url),this._returnResult(_)}catch(i){if(Rn(i))return this._returnResult({data:null,error:i});throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;if(n)throw n;if(!r)throw new cc;const{error:o}=await ei(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:o})})}catch(t){if(Rn(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const r=`${this.url}/resend`;if("email"in t){const{email:n,type:o,options:l}=t,{error:d}=await ei(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:d})}else if("phone"in t){const{phone:n,type:o,options:l}=t,{data:d,error:i}=await ei(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:i})}throw new kS("You must provide either an email or phone number and a type")}catch(r){if(Rn(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(t,r){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await t(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const r=await py(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=t.expires_at?t.expires_at*1e3-Date.now()<NM:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n){if(this.userStorage){const d=await py(this.userStorage,this.storageKey+"-user");d!=null&&d.user?t.user=d.user:t.user=DM()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const d={value:this.suppressGetSessionWarning};t.user=Uwe(t.user,d),d.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:o,error:l}=await this._callRefreshToken(t.refresh_token);return l?this._returnResult({data:{session:null},error:l}):this._returnResult({data:{session:o},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await ei(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:om}):await this._useSession(async r=>{var n,o,l;const{data:d,error:i}=r;if(i)throw i;return!(!((n=d.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new cc}:await ei(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(l=(o=d.session)===null||o===void 0?void 0:o.access_token)!==null&&l!==void 0?l:void 0,xform:om})})}catch(r){if(Rn(r))return xee(r)&&(await this._removeSession(),await qp(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(t,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,r))}async _updateUser(t,r={}){try{return await this._useSession(async n=>{const{data:o,error:l}=n;if(l)throw l;if(!o.session)throw new cc;const d=o.session;let i=null,g=null;this.flowType==="pkce"&&t.email!=null&&([i,g]=await hx(this.storage,this.storageKey));const{data:_,error:S}=await ei(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:i,code_challenge_method:g}),jwt:d.access_token,xform:om});if(S)throw S;return d.user=_.user,await this._saveSession(d),await this._notifyAllSubscribers("USER_UPDATED",d),this._returnResult({data:{user:d.user},error:null})})}catch(n){if(Rn(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new cc;const r=Date.now()/1e3;let n=r,o=!0,l=null;const{payload:d}=MM(t.access_token);if(d.exp&&(n=d.exp,o=n<=r),o){const{data:i,error:g}=await this._callRefreshToken(t.refresh_token);if(g)return this._returnResult({data:{user:null,session:null},error:g});if(!i)return{data:{user:null,session:null},error:null};l=i}else{const{data:i,error:g}=await this._getUser(t.access_token);if(g)throw g;l={access_token:t.access_token,refresh_token:t.refresh_token,user:i.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)}return this._returnResult({data:{user:l.user,session:l},error:null})}catch(r){if(Rn(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async r=>{var n;if(!t){const{data:d,error:i}=r;if(i)throw i;t=(n=d.session)!==null&&n!==void 0?n:void 0}if(!(t!=null&&t.refresh_token))throw new cc;const{data:o,error:l}=await this._callRefreshToken(t.refresh_token);return l?this._returnResult({data:{user:null,session:null},error:l}):o?this._returnResult({data:{user:o.user,session:o},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if(Rn(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(t,r){try{if(!Bs())throw new IS("No browser detected.");if(t.error||t.error_description||t.error_code)throw new IS(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new f3("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new IS("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new f3("No code detected.");const{data:R,error:F}=await this._exchangeCodeForSession(t.code);if(F)throw F;const B=new URL(window.location.href);return B.searchParams.delete("code"),window.history.replaceState(window.history.state,"",B.toString()),{data:{session:R.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:o,access_token:l,refresh_token:d,expires_in:i,expires_at:g,token_type:_}=t;if(!l||!i||!d||!_)throw new IS("No session defined in URL");const S=Math.round(Date.now()/1e3),E=parseInt(i);let T=S+E;g&&(T=parseInt(g));const C=T-S;C*1e3<=Px&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${C}s, should have been closer to ${E}s`);const N=T-E;S-N>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",N,T,S):S-N<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",N,T,S);const{data:I,error:j}=await this._getUser(l);if(j)throw j;const D={provider_token:n,provider_refresh_token:o,access_token:l,expires_in:E,expires_at:T,refresh_token:d,token_type:_,user:I.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:D,redirectType:t.type},error:null})}catch(n){if(Rn(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const r=await py(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&r)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:o,error:l}=r;if(l)return this._returnResult({error:l});const d=(n=o.session)===null||n===void 0?void 0:n.access_token;if(d){const{error:i}=await this.admin.signOut(d,t);if(i&&!(_ee(i)&&(i.status===404||i.status===401||i.status===403)))return this._returnResult({error:i})}return t!=="others"&&(await this._removeSession(),await qp(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const r=Cwe(),n={id:r,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession(async r=>{var n,o;try{const{data:{session:l},error:d}=r;if(d)throw d;await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",l)),this._debug("INITIAL_SESSION","callback id",t,"session",l)}catch(l){await((o=this.stateChangeEmitters.get(t))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",l),console.error(l)}})}async resetPasswordForEmail(t,r={}){let n=null,o=null;this.flowType==="pkce"&&([n,o]=await hx(this.storage,this.storageKey,!0));try{return await ei(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:o,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(l){if(Rn(l))return this._returnResult({data:null,error:l});throw l}}async getUserIdentities(){var t;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(t=r.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(r){if(Rn(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var r;try{const{data:n,error:o}=await this._useSession(async l=>{var d,i,g,_,S;const{data:E,error:T}=l;if(T)throw T;const C=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(d=t.options)===null||d===void 0?void 0:d.redirectTo,scopes:(i=t.options)===null||i===void 0?void 0:i.scopes,queryParams:(g=t.options)===null||g===void 0?void 0:g.queryParams,skipBrowserRedirect:!0});return await ei(this.fetch,"GET",C,{headers:this.headers,jwt:(S=(_=E.session)===null||_===void 0?void 0:_.access_token)!==null&&S!==void 0?S:void 0})});if(o)throw o;return Bs()&&!(!((r=t.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),this._returnResult({data:{provider:t.provider,url:n==null?void 0:n.url},error:null})}catch(n){if(Rn(n))return this._returnResult({data:{provider:t.provider,url:null},error:n});throw n}}async linkIdentityIdToken(t){return await this._useSession(async r=>{var n;try{const{error:o,data:{session:l}}=r;if(o)throw o;const{options:d,provider:i,token:g,access_token:_,nonce:S}=t,E=await ei(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=l==null?void 0:l.access_token)!==null&&n!==void 0?n:void 0,body:{provider:i,id_token:g,access_token:_,nonce:S,link_identity:!0,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:od}),{data:T,error:C}=E;return C?this._returnResult({data:{user:null,session:null},error:C}):!T||!T.session||!T.user?this._returnResult({data:{user:null,session:null},error:new by}):(T.session&&(await this._saveSession(T.session),await this._notifyAllSubscribers("USER_UPDATED",T.session)),this._returnResult({data:T,error:C}))}catch(o){if(Rn(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}})}async unlinkIdentity(t){try{return await this._useSession(async r=>{var n,o;const{data:l,error:d}=r;if(d)throw d;return await ei(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(o=(n=l.session)===null||n===void 0?void 0:n.access_token)!==null&&o!==void 0?o:void 0})})}catch(r){if(Rn(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(t){const r=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await Rwe(async o=>(o>0&&await Iwe(200*Math.pow(2,o-1)),this._debug(r,"refreshing attempt",o),await ei(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:od})),(o,l)=>{const d=200*Math.pow(2,o);return l&&gC(l)&&Date.now()+d-n<Px})}catch(n){if(this._debug(r,"error",n),Rn(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(r,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",r,"url",n),Bs()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const o=await py(this.storage,this.storageKey);if(o&&this.userStorage){let d=await py(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!d&&(d={user:o.user},await Cx(this.userStorage,this.storageKey+"-user",d)),o.user=(t=d==null?void 0:d.user)!==null&&t!==void 0?t:DM()}else if(o&&!o.user&&!o.user){const d=await py(this.storage,this.storageKey+"-user");d&&(d!=null&&d.user)?(o.user=d.user,await qp(this.storage,this.storageKey+"-user"),await Cx(this.storage,this.storageKey,o)):o.user=DM()}if(this._debug(n,"session from storage",o),!this._isValidSession(o)){this._debug(n,"session is not valid"),o!==null&&await this._removeSession();return}const l=((r=o.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<NM;if(this._debug(n,`session has${l?"":" not"} expired with margin of ${NM}s`),l){if(this.autoRefreshToken&&o.refresh_token){const{error:d}=await this._callRefreshToken(o.refresh_token);d&&(console.error(d),gC(d)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",d),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:d,error:i}=await this._getUser(o.access_token);!i&&(d!=null&&d.user)?(o.user=d.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(d){console.error("Error getting user data:",d),this._debug(n,"error getting user data, skipping SIGNED_IN notification",d)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(n,"error",o),console.error(o);return}finally{this._debug(n,"end")}}async _callRefreshToken(t){var r,n;if(!t)throw new cc;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new wI;const{data:l,error:d}=await this._refreshAccessToken(t);if(d)throw d;if(!l.session)throw new cc;await this._saveSession(l.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",l.session);const i={data:l.session,error:null};return this.refreshingDeferred.resolve(i),i}catch(l){if(this._debug(o,"error",l),Rn(l)){const d={data:null,error:l};return gC(l)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(d),d}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(l),l}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(t,r,n=!0){const o=`#_notifyAllSubscribers(${t})`;this._debug(o,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:r});const l=[],d=Array.from(this.stateChangeEmitters.values()).map(async i=>{try{await i.callback(t,r)}catch(g){l.push(g)}});if(await Promise.all(d),l.length>0){for(let i=0;i<l.length;i+=1)console.error(l[i]);throw l[0]}}finally{this._debug(o,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const r=Object.assign({},t),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await Cx(this.userStorage,this.storageKey+"-user",{user:r.user});const o=Object.assign({},r);delete o.user;const l=_9(o);await Cx(this.storage,this.storageKey,l)}else{const o=_9(r);await Cx(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),await qp(this.storage,this.storageKey),await qp(this.storage,this.storageKey+"-code-verifier"),await qp(this.storage,this.storageKey+"-user"),this.userStorage&&await qp(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&Bs()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Px);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((n.expires_at*1e3-t)/Px);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${Px}ms, refresh threshold is ${d3} ticks`),o<=d3&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof Aee)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Bs()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const r=`#_onVisibilityChanged(${t})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,r,n){const o=[`provider=${encodeURIComponent(r)}`];if(n!=null&&n.redirectTo&&o.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&o.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[l,d]=await hx(this.storage,this.storageKey),i=new URLSearchParams({code_challenge:`${encodeURIComponent(l)}`,code_challenge_method:`${encodeURIComponent(d)}`});o.push(i.toString())}if(n!=null&&n.queryParams){const l=new URLSearchParams(n.queryParams);o.push(l.toString())}return n!=null&&n.skipBrowserRedirect&&o.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${o.join("&")}`}async _unenroll(t){try{return await this._useSession(async r=>{var n;const{data:o,error:l}=r;return l?this._returnResult({data:null,error:l}):await ei(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(n=o==null?void 0:o.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(Rn(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(t){try{return await this._useSession(async r=>{var n,o;const{data:l,error:d}=r;if(d)return this._returnResult({data:null,error:d});const i=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:g,error:_}=await ei(this.fetch,"POST",`${this.url}/factors`,{body:i,headers:this.headers,jwt:(n=l==null?void 0:l.session)===null||n===void 0?void 0:n.access_token});return _?this._returnResult({data:null,error:_}):(t.factorType==="totp"&&g.type==="totp"&&(!((o=g==null?void 0:g.totp)===null||o===void 0)&&o.qr_code)&&(g.totp.qr_code=`data:image/svg+xml;utf-8,${g.totp.qr_code}`),this._returnResult({data:g,error:null}))})}catch(r){if(Rn(r))return this._returnResult({data:null,error:r});throw r}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:o,error:l}=r;if(l)return this._returnResult({data:null,error:l});const d=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?a1e(t.webauthn.credential_response):o1e(t.webauthn.credential_response)})}:{code:t.code}),{data:i,error:g}=await ei(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:d,headers:this.headers,jwt:(n=o==null?void 0:o.session)===null||n===void 0?void 0:n.access_token});return g?this._returnResult({data:null,error:g}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),this._returnResult({data:i,error:g}))})}catch(r){if(Rn(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:o,error:l}=r;if(l)return this._returnResult({data:null,error:l});const d=await ei(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(n=o==null?void 0:o.session)===null||n===void 0?void 0:n.access_token});if(d.error)return d;const{data:i}=d;if(i.type!=="webauthn")return{data:i,error:null};switch(i.webauthn.type){case"create":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:n1e(i.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:i1e(i.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(Rn(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(t){const{data:r,error:n}=await this._challenge({factorId:t.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:t.factorId,challengeId:r.id,code:t.code})}async _listFactors(){var t;const{data:{user:r},error:n}=await this.getUser();if(n)return{data:null,error:n};const o={all:[],phone:[],totp:[],webauthn:[]};for(const l of(t=r==null?void 0:r.factors)!==null&&t!==void 0?t:[])o.all.push(l),l.status==="verified"&&o[l.factor_type].push(l);return{data:o,error:null}}async _getAuthenticatorAssuranceLevel(){var t,r;const{data:{session:n},error:o}=await this.getSession();if(o)return this._returnResult({data:null,error:o});if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:l}=MM(n.access_token);let d=null;l.aal&&(d=l.aal);let i=d;((r=(t=n.user.factors)===null||t===void 0?void 0:t.filter(S=>S.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(i="aal2");const _=l.amr||[];return{data:{currentLevel:d,nextLevel:i,currentAuthenticationMethods:_},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async r=>{const{data:{session:n},error:o}=r;return o?this._returnResult({data:null,error:o}):n?await ei(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:n.access_token,xform:l=>({data:l,error:null})}):this._returnResult({data:null,error:new cc})})}catch(r){if(Rn(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(t,r){try{return await this._useSession(async n=>{const{data:{session:o},error:l}=n;if(l)return this._returnResult({data:null,error:l});if(!o)return this._returnResult({data:null,error:new cc});const d=await ei(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"approve"},xform:i=>({data:i,error:null})});return d.data&&d.data.redirect_url&&Bs()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(d.data.redirect_url),d})}catch(n){if(Rn(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(t,r){try{return await this._useSession(async n=>{const{data:{session:o},error:l}=n;if(l)return this._returnResult({data:null,error:l});if(!o)return this._returnResult({data:null,error:new cc});const d=await ei(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"deny"},xform:i=>({data:i,error:null})});return d.data&&d.data.redirect_url&&Bs()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(d.data.redirect_url),d})}catch(n){if(Rn(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;return n?this._returnResult({data:null,error:n}):r?await ei(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new cc})})}catch(t){if(Rn(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async r=>{const{data:{session:n},error:o}=r;return o?this._returnResult({data:null,error:o}):n?await ei(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:t.clientId},xform:()=>({data:{},error:null})}):this._returnResult({data:null,error:new cc})})}catch(r){if(Rn(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(t,r={keys:[]}){let n=r.keys.find(i=>i.kid===t);if(n)return n;const o=Date.now();if(n=this.jwks.keys.find(i=>i.kid===t),n&&this.jwks_cached_at+bwe>o)return n;const{data:l,error:d}=await ei(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(d)throw d;return!l.keys||l.keys.length===0||(this.jwks=l,this.jwks_cached_at=o,n=l.keys.find(i=>i.kid===t),!n)?null:n}async getClaims(t,r={}){try{let n=t;if(!n){const{data:C,error:N}=await this.getSession();if(N||!C.session)return this._returnResult({data:null,error:N});n=C.session.access_token}const{header:o,payload:l,signature:d,raw:{header:i,payload:g}}=MM(n);r!=null&&r.allowExpired||zwe(l.exp);const _=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,r!=null&&r.keys?{keys:r.keys}:r==null?void 0:r.jwks);if(!_){const{error:C}=await this.getUser(n);if(C)throw C;return{data:{claims:l,header:o,signature:d},error:null}}const S=Bwe(o.alg),E=await crypto.subtle.importKey("jwk",_,S,!0,["verify"]);if(!await crypto.subtle.verify(S,E,d,Awe(`${i}.${g}`)))throw new hO("Invalid JWT signature");return{data:{claims:l,header:o,signature:d},error:null}}catch(n){if(Rn(n))return this._returnResult({data:null,error:n});throw n}}}N0.nextInstanceID={};const Iee=N0;class m1e extends Iee{constructor(t){super(t)}}class Ree{constructor(t,r,n){var o,l,d;this.supabaseUrl=t,this.supabaseKey=r;const i=gwe(t);if(!r)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const g=`sb-${i.hostname.split(".")[0]}-auth-token`,_={db:lwe,realtime:uwe,auth:Object.assign(Object.assign({},cwe),{storageKey:g}),global:swe},S=mwe(n??{},_);this.storageKey=(o=S.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(l=S.global.headers)!==null&&l!==void 0?l:{},S.accessToken?(this.accessToken=S.accessToken,this.auth=new Proxy({},{get:(E,T)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(T)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((d=S.auth)!==null&&d!==void 0?d:{},this.headers,S.global.fetch),this.fetch=fwe(r,this._getAccessToken.bind(this),S.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},S.realtime)),this.accessToken&&this.accessToken().then(E=>this.realtime.setAuth(E)).catch(E=>console.warn("Failed to set initial Realtime auth token:",E)),this.rest=new vbe(new URL("rest/v1",i).href,{headers:this.headers,schema:S.db.schema,fetch:this.fetch}),this.storage=new iwe(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),S.accessToken||this._listenForAuthEvents()}get functions(){return new mbe(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,r={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,r,n)}channel(t,r={config:{}}){return this.realtime.channel(t,r)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t,r;if(this.accessToken)return await this.accessToken();const{data:n}=await this.auth.getSession();return(r=(t=n.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:o,userStorage:l,storageKey:d,flowType:i,lock:g,debug:_,throwOnError:S},E,T){const C={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new m1e({url:this.authUrl.href,headers:Object.assign(Object.assign({},C),E),storageKey:d,autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:o,userStorage:l,flowType:i,lock:g,debug:_,throwOnError:S,fetch:T,hasCustomAuthorizationHeader:Object.keys(this.headers).some(N=>N.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new dee(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,n)=>{this._handleTokenChanged(r,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(t,r,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const jee=(e,t,r)=>new Ree(e,t,r);function g1e(){if(typeof window<"u"||typeof process>"u")return!1;const e=process.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}g1e()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const y1e=Object.freeze(Object.defineProperty({__proto__:null,AuthApiError:vee,AuthClient:Iee,AuthError:j0,AuthImplicitGrantRedirectError:IS,AuthInvalidCredentialsError:kS,AuthInvalidJwtError:hO,AuthInvalidTokenResponseError:by,AuthPKCEGrantCodeExchangeError:f3,AuthRetryableFetchError:dO,AuthSessionMissingError:cc,AuthUnknownError:am,AuthWeakPasswordError:p3,CustomAuthError:Wf,get FunctionRegion(){return uO},FunctionsError:xI,FunctionsFetchError:UQ,FunctionsHttpError:r3,FunctionsRelayError:t3,GoTrueAdminApi:Tee,GoTrueClient:N0,NavigatorLockAcquireTimeoutError:Pee,PostgrestError:_be,get REALTIME_LISTEN_TYPES(){return r0},get REALTIME_POSTGRES_CHANGES_LISTEN_EVENT(){return s3},get REALTIME_PRESENCE_LISTEN_EVENTS(){return o3},get REALTIME_SUBSCRIBE_STATES(){return ih},RealtimeChannel:bI,RealtimeClient:dee,RealtimePresence:t0,SIGN_OUT_SCOPES:yC,SupabaseClient:Ree,WebSocketFactory:oee,createClient:jee,isAuthApiError:_ee,isAuthError:Rn,isAuthImplicitGrantRedirectError:bee,isAuthRetryableFetchError:gC,isAuthSessionMissingError:xee,lockInternals:Sy,navigatorLock:Cee},Symbol.toStringTag,{value:"Module"})),v1e="https://tzdgqhwyzsxkxnncgzap.supabase.co",_1e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",qt=jee(v1e,_1e,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),Nee=W.createContext(void 0),x1e=({children:e})=>{const[t,r]=W.useState(null),[n,o]=W.useState(null),[l,d]=W.useState(!0),i=qf();W.useEffect(()=>{const{data:{subscription:N}}=qt.auth.onAuthStateChange((I,j)=>{o(j),r((j==null?void 0:j.user)??null),I==="SIGNED_IN"&&j&&i("/")});return qt.auth.getSession().then(({data:{session:I}})=>{o(I),r((I==null?void 0:I.user)??null),d(!1)}),()=>N.unsubscribe()},[i]);const g=async(N,I,j,D)=>{const R=`${window.location.origin}/`,{error:F}=await qt.auth.signUp({email:N,password:I,options:{emailRedirectTo:R,data:{display_name:j,phone:D||null}}});return{error:F}},_=async(N,I)=>{const{error:j}=await qt.auth.signInWithPassword({email:N,password:I});return{error:j}},S=async()=>{const{error:N}=await qt.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/`}});return{error:N}},E=async N=>{const{error:I}=await qt.auth.signInWithOtp({phone:N,options:{channel:"sms"}});return{error:I}},T=async(N,I)=>{const{error:j}=await qt.auth.verifyOtp({phone:N,token:I,type:"sms"});return{error:j}},C=async()=>{await qt.auth.signOut(),i("/auth")};return m.jsx(Nee.Provider,{value:{user:t,session:n,signUp:g,signIn:_,signInWithGoogle:S,signInWithPhone:E,verifyOTP:T,signOut:C,loading:l},children:e})},Fi=()=>{const e=W.useContext(Nee);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e},M0=wb("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 cursor-pointer",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),ir=W.forwardRef(({className:e,variant:t,size:r,asChild:n=!1,...o},l)=>{const d=n?Av:"button";return m.jsx(d,{className:yr(M0({variant:t,size:r,className:e})),ref:l,...o})});ir.displayName="Button";const b1e="/assets/xiaoxiong-logo-v3-D4uDr23w.png";var LM="focusScope.autoFocusOnMount",FM="focusScope.autoFocusOnUnmount",A9={bubbles:!1,cancelable:!0},w1e="FocusScope",DT=W.forwardRef((e,t)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:o,onUnmountAutoFocus:l,...d}=e,[i,g]=W.useState(null),_=Io(o),S=Io(l),E=W.useRef(null),T=fi(t,I=>g(I)),C=W.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;W.useEffect(()=>{if(n){let I=function(F){if(C.paused||!i)return;const B=F.target;i.contains(B)?E.current=B:Hp(E.current,{select:!0})},j=function(F){if(C.paused||!i)return;const B=F.relatedTarget;B!==null&&(i.contains(B)||Hp(E.current,{select:!0}))},D=function(F){if(document.activeElement===document.body)for(const U of F)U.removedNodes.length>0&&Hp(i)};document.addEventListener("focusin",I),document.addEventListener("focusout",j);const R=new MutationObserver(D);return i&&R.observe(i,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",I),document.removeEventListener("focusout",j),R.disconnect()}}},[n,i,C.paused]),W.useEffect(()=>{if(i){C9.add(C);const I=document.activeElement;if(!i.contains(I)){const D=new CustomEvent(LM,A9);i.addEventListener(LM,_),i.dispatchEvent(D),D.defaultPrevented||(S1e(C1e(Mee(i)),{select:!0}),document.activeElement===I&&Hp(i))}return()=>{i.removeEventListener(LM,_),setTimeout(()=>{const D=new CustomEvent(FM,A9);i.addEventListener(FM,S),i.dispatchEvent(D),D.defaultPrevented||Hp(I??document.body,{select:!0}),i.removeEventListener(FM,S),C9.remove(C)},0)}}},[i,_,S,C]);const N=W.useCallback(I=>{if(!r&&!n||C.paused)return;const j=I.key==="Tab"&&!I.altKey&&!I.ctrlKey&&!I.metaKey,D=document.activeElement;if(j&&D){const R=I.currentTarget,[F,B]=E1e(R);F&&B?!I.shiftKey&&D===B?(I.preventDefault(),r&&Hp(F,{select:!0})):I.shiftKey&&D===F&&(I.preventDefault(),r&&Hp(B,{select:!0})):D===R&&I.preventDefault()}},[r,n,C.paused]);return m.jsx(wn.div,{tabIndex:-1,...d,ref:T,onKeyDown:N})});DT.displayName=w1e;function S1e(e,{select:t=!1}={}){const r=document.activeElement;for(const n of e)if(Hp(n,{select:t}),document.activeElement!==r)return}function E1e(e){const t=Mee(e),r=P9(t,e),n=P9(t.reverse(),e);return[r,n]}function Mee(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const o=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||o?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function P9(e,t){for(const r of e)if(!T1e(r,{upTo:t}))return r}function T1e(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function A1e(e){return e instanceof HTMLInputElement&&"select"in e}function Hp(e,{select:t=!1}={}){if(e&&e.focus){const r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&A1e(e)&&t&&e.select()}}var C9=P1e();function P1e(){let e=[];return{add(t){const r=e[0];t!==r&&(r==null||r.pause()),e=O9(e,t),e.unshift(t)},remove(t){var r;e=O9(e,t),(r=e[0])==null||r.resume()}}}function O9(e,t){const r=[...e],n=r.indexOf(t);return n!==-1&&r.splice(n,1),r}function C1e(e){return e.filter(t=>t.tagName!=="A")}var zM=0;function SI(){W.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??k9()),document.body.insertAdjacentElement("beforeend",e[1]??k9()),zM++,()=>{zM===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),zM--}},[])}function k9(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var vC="right-scroll-bar-position",_C="width-before-scroll-bar",O1e="with-scroll-bars-hidden",k1e="--removed-body-scroll-bar-size";function BM(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function I1e(e,t){var r=W.useState(function(){return{value:e,callback:t,facade:{get current(){return r.value},set current(n){var o=r.value;o!==n&&(r.value=n,r.callback(n,o))}}}})[0];return r.callback=t,r.facade}var R1e=typeof window<"u"?W.useLayoutEffect:W.useEffect,I9=new WeakMap;function j1e(e,t){var r=I1e(null,function(n){return e.forEach(function(o){return BM(o,n)})});return R1e(function(){var n=I9.get(r);if(n){var o=new Set(n),l=new Set(e),d=r.current;o.forEach(function(i){l.has(i)||BM(i,null)}),l.forEach(function(i){o.has(i)||BM(i,d)})}I9.set(r,e)},[e]),r}function N1e(e){return e}function M1e(e,t){t===void 0&&(t=N1e);var r=[],n=!1,o={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(l){var d=t(l,n);return r.push(d),function(){r=r.filter(function(i){return i!==d})}},assignSyncMedium:function(l){for(n=!0;r.length;){var d=r;r=[],d.forEach(l)}r={push:function(i){return l(i)},filter:function(){return r}}},assignMedium:function(l){n=!0;var d=[];if(r.length){var i=r;r=[],i.forEach(l),d=r}var g=function(){var S=d;d=[],S.forEach(l)},_=function(){return Promise.resolve().then(g)};_(),r={push:function(S){d.push(S),_()},filter:function(S){return d=d.filter(S),r}}}};return o}function D1e(e){e===void 0&&(e={});var t=M1e(null);return t.options=bu({async:!0,ssr:!1},e),t}var Dee=function(e){var t=e.sideCar,r=ig(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=t.read();if(!n)throw new Error("Sidecar medium not found");return W.createElement(n,bu({},r))};Dee.isSideCarExport=!0;function L1e(e,t){return e.useMedium(t),Dee}var Lee=D1e(),$M=function(){},EI=W.forwardRef(function(e,t){var r=W.useRef(null),n=W.useState({onScrollCapture:$M,onWheelCapture:$M,onTouchMoveCapture:$M}),o=n[0],l=n[1],d=e.forwardProps,i=e.children,g=e.className,_=e.removeScrollBar,S=e.enabled,E=e.shards,T=e.sideCar,C=e.noRelative,N=e.noIsolation,I=e.inert,j=e.allowPinchZoom,D=e.as,R=D===void 0?"div":D,F=e.gapMode,B=ig(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),U=T,Z=j1e([r,t]),J=bu(bu({},B),o);return W.createElement(W.Fragment,null,S&&W.createElement(U,{sideCar:Lee,removeScrollBar:_,shards:E,noRelative:C,noIsolation:N,inert:I,setCallbacks:l,allowPinchZoom:!!j,lockRef:r,gapMode:F}),d?W.cloneElement(W.Children.only(i),bu(bu({},J),{ref:Z})):W.createElement(R,bu({},J,{className:g,ref:Z}),i))});EI.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};EI.classNames={fullWidth:_C,zeroRight:vC};var F1e=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function z1e(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=F1e();return t&&e.setAttribute("nonce",t),e}function B1e(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function $1e(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var U1e=function(){var e=0,t=null;return{add:function(r){e==0&&(t=z1e())&&(B1e(t,r),$1e(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},V1e=function(){var e=U1e();return function(t,r){W.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},Fee=function(){var e=V1e(),t=function(r){var n=r.styles,o=r.dynamic;return e(n,o),null};return t},q1e={left:0,top:0,right:0,gap:0},UM=function(e){return parseInt(e||"",10)||0},W1e=function(e){var t=window.getComputedStyle(document.body),r=t[e==="padding"?"paddingLeft":"marginLeft"],n=t[e==="padding"?"paddingTop":"marginTop"],o=t[e==="padding"?"paddingRight":"marginRight"];return[UM(r),UM(n),UM(o)]},G1e=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return q1e;var t=W1e(e),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,n-r+t[2]-t[0])}},H1e=Fee(),i0="data-scroll-locked",K1e=function(e,t,r,n){var o=e.left,l=e.top,d=e.right,i=e.gap;return r===void 0&&(r="margin"),`
  .`.concat(O1e,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(i,"px ").concat(n,`;
  }
  body[`).concat(i0,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(l,`px;
    padding-right: `).concat(d,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(i,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(i,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(vC,` {
    right: `).concat(i,"px ").concat(n,`;
  }
  
  .`).concat(_C,` {
    margin-right: `).concat(i,"px ").concat(n,`;
  }
  
  .`).concat(vC," .").concat(vC,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(_C," .").concat(_C,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(i0,`] {
    `).concat(k1e,": ").concat(i,`px;
  }
`)},R9=function(){var e=parseInt(document.body.getAttribute(i0)||"0",10);return isFinite(e)?e:0},Z1e=function(){W.useEffect(function(){return document.body.setAttribute(i0,(R9()+1).toString()),function(){var e=R9()-1;e<=0?document.body.removeAttribute(i0):document.body.setAttribute(i0,e.toString())}},[])},X1e=function(e){var t=e.noRelative,r=e.noImportant,n=e.gapMode,o=n===void 0?"margin":n;Z1e();var l=W.useMemo(function(){return G1e(o)},[o]);return W.createElement(H1e,{styles:K1e(l,!t,o,r?"":"!important")})},m3=!1;if(typeof window<"u")try{var RP=Object.defineProperty({},"passive",{get:function(){return m3=!0,!0}});window.addEventListener("test",RP,RP),window.removeEventListener("test",RP,RP)}catch{m3=!1}var mx=m3?{passive:!1}:!1,Y1e=function(e){return e.tagName==="TEXTAREA"},zee=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return r[t]!=="hidden"&&!(r.overflowY===r.overflowX&&!Y1e(e)&&r[t]==="visible")},J1e=function(e){return zee(e,"overflowY")},Q1e=function(e){return zee(e,"overflowX")},j9=function(e,t){var r=t.ownerDocument,n=t;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var o=Bee(e,n);if(o){var l=$ee(e,n),d=l[1],i=l[2];if(d>i)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},eSe=function(e){var t=e.scrollTop,r=e.scrollHeight,n=e.clientHeight;return[t,r,n]},tSe=function(e){var t=e.scrollLeft,r=e.scrollWidth,n=e.clientWidth;return[t,r,n]},Bee=function(e,t){return e==="v"?J1e(t):Q1e(t)},$ee=function(e,t){return e==="v"?eSe(t):tSe(t)},rSe=function(e,t){return e==="h"&&t==="rtl"?-1:1},nSe=function(e,t,r,n,o){var l=rSe(e,window.getComputedStyle(t).direction),d=l*n,i=r.target,g=t.contains(i),_=!1,S=d>0,E=0,T=0;do{if(!i)break;var C=$ee(e,i),N=C[0],I=C[1],j=C[2],D=I-j-l*N;(N||D)&&Bee(e,i)&&(E+=D,T+=N);var R=i.parentNode;i=R&&R.nodeType===Node.DOCUMENT_FRAGMENT_NODE?R.host:R}while(!g&&i!==document.body||g&&(t.contains(i)||t===i));return(S&&(Math.abs(E)<1||!o)||!S&&(Math.abs(T)<1||!o))&&(_=!0),_},jP=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},N9=function(e){return[e.deltaX,e.deltaY]},M9=function(e){return e&&"current"in e?e.current:e},iSe=function(e,t){return e[0]===t[0]&&e[1]===t[1]},aSe=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},oSe=0,gx=[];function sSe(e){var t=W.useRef([]),r=W.useRef([0,0]),n=W.useRef(),o=W.useState(oSe++)[0],l=W.useState(Fee)[0],d=W.useRef(e);W.useEffect(function(){d.current=e},[e]),W.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(o));var I=UB([e.lockRef.current],(e.shards||[]).map(M9),!0).filter(Boolean);return I.forEach(function(j){return j.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),I.forEach(function(j){return j.classList.remove("allow-interactivity-".concat(o))})}}},[e.inert,e.lockRef.current,e.shards]);var i=W.useCallback(function(I,j){if("touches"in I&&I.touches.length===2||I.type==="wheel"&&I.ctrlKey)return!d.current.allowPinchZoom;var D=jP(I),R=r.current,F="deltaX"in I?I.deltaX:R[0]-D[0],B="deltaY"in I?I.deltaY:R[1]-D[1],U,Z=I.target,J=Math.abs(F)>Math.abs(B)?"h":"v";if("touches"in I&&J==="h"&&Z.type==="range")return!1;var te=j9(J,Z);if(!te)return!0;if(te?U=J:(U=J==="v"?"h":"v",te=j9(J,Z)),!te)return!1;if(!n.current&&"changedTouches"in I&&(F||B)&&(n.current=U),!U)return!0;var ae=n.current||U;return nSe(ae,j,I,ae==="h"?F:B,!0)},[]),g=W.useCallback(function(I){var j=I;if(!(!gx.length||gx[gx.length-1]!==l)){var D="deltaY"in j?N9(j):jP(j),R=t.current.filter(function(U){return U.name===j.type&&(U.target===j.target||j.target===U.shadowParent)&&iSe(U.delta,D)})[0];if(R&&R.should){j.cancelable&&j.preventDefault();return}if(!R){var F=(d.current.shards||[]).map(M9).filter(Boolean).filter(function(U){return U.contains(j.target)}),B=F.length>0?i(j,F[0]):!d.current.noIsolation;B&&j.cancelable&&j.preventDefault()}}},[]),_=W.useCallback(function(I,j,D,R){var F={name:I,delta:j,target:D,should:R,shadowParent:lSe(D)};t.current.push(F),setTimeout(function(){t.current=t.current.filter(function(B){return B!==F})},1)},[]),S=W.useCallback(function(I){r.current=jP(I),n.current=void 0},[]),E=W.useCallback(function(I){_(I.type,N9(I),I.target,i(I,e.lockRef.current))},[]),T=W.useCallback(function(I){_(I.type,jP(I),I.target,i(I,e.lockRef.current))},[]);W.useEffect(function(){return gx.push(l),e.setCallbacks({onScrollCapture:E,onWheelCapture:E,onTouchMoveCapture:T}),document.addEventListener("wheel",g,mx),document.addEventListener("touchmove",g,mx),document.addEventListener("touchstart",S,mx),function(){gx=gx.filter(function(I){return I!==l}),document.removeEventListener("wheel",g,mx),document.removeEventListener("touchmove",g,mx),document.removeEventListener("touchstart",S,mx)}},[]);var C=e.removeScrollBar,N=e.inert;return W.createElement(W.Fragment,null,N?W.createElement(l,{styles:aSe(o)}):null,C?W.createElement(X1e,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function lSe(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const cSe=L1e(Lee,sSe);var LT=W.forwardRef(function(e,t){return W.createElement(EI,bu({},e,{ref:t,sideCar:cSe}))});LT.classNames=EI.classNames;var uSe=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},yx=new WeakMap,NP=new WeakMap,MP={},VM=0,Uee=function(e){return e&&(e.host||Uee(e.parentNode))},dSe=function(e,t){return t.map(function(r){if(e.contains(r))return r;var n=Uee(r);return n&&e.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",e,". Doing nothing"),null)}).filter(function(r){return!!r})},hSe=function(e,t,r,n){var o=dSe(t,Array.isArray(e)?e:[e]);MP[r]||(MP[r]=new WeakMap);var l=MP[r],d=[],i=new Set,g=new Set(o),_=function(E){!E||i.has(E)||(i.add(E),_(E.parentNode))};o.forEach(_);var S=function(E){!E||g.has(E)||Array.prototype.forEach.call(E.children,function(T){if(i.has(T))S(T);else try{var C=T.getAttribute(n),N=C!==null&&C!=="false",I=(yx.get(T)||0)+1,j=(l.get(T)||0)+1;yx.set(T,I),l.set(T,j),d.push(T),I===1&&N&&NP.set(T,!0),j===1&&T.setAttribute(r,"true"),N||T.setAttribute(n,"true")}catch(D){console.error("aria-hidden: cannot operate on ",T,D)}})};return S(t),i.clear(),VM++,function(){d.forEach(function(E){var T=yx.get(E)-1,C=l.get(E)-1;yx.set(E,T),l.set(E,C),T||(NP.has(E)||E.removeAttribute(n),NP.delete(E)),C||E.removeAttribute(r)}),VM--,VM||(yx=new WeakMap,yx=new WeakMap,NP=new WeakMap,MP={})}},TI=function(e,t,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(e)?e:[e]),o=uSe(e);return o?(n.push.apply(n,Array.from(o.querySelectorAll("[aria-live]"))),hSe(n,o,r,"aria-hidden")):function(){return null}},AI="Dialog",[Vee,qee]=Zs(AI),[fSe,kd]=Vee(AI),Wee=e=>{const{__scopeDialog:t,children:r,open:n,defaultOpen:o,onOpenChange:l,modal:d=!0}=e,i=W.useRef(null),g=W.useRef(null),[_,S]=Ru({prop:n,defaultProp:o??!1,onChange:l,caller:AI});return m.jsx(fSe,{scope:t,triggerRef:i,contentRef:g,contentId:Kc(),titleId:Kc(),descriptionId:Kc(),open:_,onOpenChange:S,onOpenToggle:W.useCallback(()=>S(E=>!E),[S]),modal:d,children:r})};Wee.displayName=AI;var Gee="DialogTrigger",Hee=W.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,o=kd(Gee,r),l=fi(t,o.triggerRef);return m.jsx(wn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":YB(o.open),...n,ref:l,onClick:Rr(e.onClick,o.onOpenToggle)})});Hee.displayName=Gee;var ZB="DialogPortal",[pSe,Kee]=Vee(ZB,{forceMount:void 0}),Zee=e=>{const{__scopeDialog:t,forceMount:r,children:n,container:o}=e,l=kd(ZB,t);return m.jsx(pSe,{scope:t,forceMount:r,children:W.Children.map(n,d=>m.jsx(_s,{present:r||l.open,children:m.jsx(bb,{asChild:!0,container:o,children:d})}))})};Zee.displayName=ZB;var gO="DialogOverlay",Xee=W.forwardRef((e,t)=>{const r=Kee(gO,e.__scopeDialog),{forceMount:n=r.forceMount,...o}=e,l=kd(gO,e.__scopeDialog);return l.modal?m.jsx(_s,{present:n||l.open,children:m.jsx(gSe,{...o,ref:t})}):null});Xee.displayName=gO;var mSe=Vm("DialogOverlay.RemoveScroll"),gSe=W.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,o=kd(gO,r);return m.jsx(LT,{as:mSe,allowPinchZoom:!0,shards:[o.contentRef],children:m.jsx(wn.div,{"data-state":YB(o.open),...n,ref:t,style:{pointerEvents:"auto",...n.style}})})}),dv="DialogContent",Yee=W.forwardRef((e,t)=>{const r=Kee(dv,e.__scopeDialog),{forceMount:n=r.forceMount,...o}=e,l=kd(dv,e.__scopeDialog);return m.jsx(_s,{present:n||l.open,children:l.modal?m.jsx(ySe,{...o,ref:t}):m.jsx(vSe,{...o,ref:t})})});Yee.displayName=dv;var ySe=W.forwardRef((e,t)=>{const r=kd(dv,e.__scopeDialog),n=W.useRef(null),o=fi(t,r.contentRef,n);return W.useEffect(()=>{const l=n.current;if(l)return TI(l)},[]),m.jsx(Jee,{...e,ref:o,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Rr(e.onCloseAutoFocus,l=>{var d;l.preventDefault(),(d=r.triggerRef.current)==null||d.focus()}),onPointerDownOutside:Rr(e.onPointerDownOutside,l=>{const d=l.detail.originalEvent,i=d.button===0&&d.ctrlKey===!0;(d.button===2||i)&&l.preventDefault()}),onFocusOutside:Rr(e.onFocusOutside,l=>l.preventDefault())})}),vSe=W.forwardRef((e,t)=>{const r=kd(dv,e.__scopeDialog),n=W.useRef(!1),o=W.useRef(!1);return m.jsx(Jee,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:l=>{var d,i;(d=e.onCloseAutoFocus)==null||d.call(e,l),l.defaultPrevented||(n.current||(i=r.triggerRef.current)==null||i.focus(),l.preventDefault()),n.current=!1,o.current=!1},onInteractOutside:l=>{var g,_;(g=e.onInteractOutside)==null||g.call(e,l),l.defaultPrevented||(n.current=!0,l.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const d=l.target;((_=r.triggerRef.current)==null?void 0:_.contains(d))&&l.preventDefault(),l.detail.originalEvent.type==="focusin"&&o.current&&l.preventDefault()}})}),Jee=W.forwardRef((e,t)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:o,onCloseAutoFocus:l,...d}=e,i=kd(dv,r),g=W.useRef(null),_=fi(t,g);return SI(),m.jsxs(m.Fragment,{children:[m.jsx(DT,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:o,onUnmountAutoFocus:l,children:m.jsx(Pv,{role:"dialog",id:i.contentId,"aria-describedby":i.descriptionId,"aria-labelledby":i.titleId,"data-state":YB(i.open),...d,ref:_,onDismiss:()=>i.onOpenChange(!1)})}),m.jsxs(m.Fragment,{children:[m.jsx(xSe,{titleId:i.titleId}),m.jsx(wSe,{contentRef:g,descriptionId:i.descriptionId})]})]})}),XB="DialogTitle",Qee=W.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,o=kd(XB,r);return m.jsx(wn.h2,{id:o.titleId,...n,ref:t})});Qee.displayName=XB;var ete="DialogDescription",tte=W.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,o=kd(ete,r);return m.jsx(wn.p,{id:o.descriptionId,...n,ref:t})});tte.displayName=ete;var rte="DialogClose",nte=W.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,o=kd(rte,r);return m.jsx(wn.button,{type:"button",...n,ref:t,onClick:Rr(e.onClick,()=>o.onOpenChange(!1))})});nte.displayName=rte;function YB(e){return e?"open":"closed"}var ite="DialogTitleWarning",[_Se,ate]=pge(ite,{contentName:dv,titleName:XB,docsSlug:"dialog"}),xSe=({titleId:e})=>{const t=ate(ite),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return W.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},bSe="DialogDescriptionWarning",wSe=({contentRef:e,descriptionId:t})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${ate(bSe).contentName}}.`;return W.useEffect(()=>{var l;const o=(l=e.current)==null?void 0:l.getAttribute("aria-describedby");t&&o&&(document.getElementById(t)||console.warn(n))},[n,e,t]),null},JB=Wee,QB=Hee,e4=Zee,FT=Xee,zT=Yee,BT=Qee,$T=tte,PI=nte;const ote=JB,SSe=QB,ESe=e4,ste=W.forwardRef(({className:e,...t},r)=>m.jsx(FT,{className:yr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));ste.displayName=FT.displayName;const TSe=wb("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),t4=W.forwardRef(({side:e="right",className:t,children:r,...n},o)=>m.jsxs(ESe,{children:[m.jsx(ste,{}),m.jsxs(zT,{ref:o,className:yr(TSe({side:e}),t),...n,children:[r,m.jsxs(PI,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[m.jsx(ju,{className:"h-4 w-4"}),m.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));t4.displayName=zT.displayName;const ASe=W.forwardRef(({className:e,...t},r)=>m.jsx(BT,{ref:r,className:yr("text-lg font-semibold text-foreground",e),...t}));ASe.displayName=BT.displayName;const PSe=W.forwardRef(({className:e,...t},r)=>m.jsx($T,{ref:r,className:yr("text-sm text-muted-foreground",e),...t}));PSe.displayName=$T.displayName;var lte={exports:{}},cte={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var D0=W;function CSe(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var OSe=typeof Object.is=="function"?Object.is:CSe,kSe=D0.useState,ISe=D0.useEffect,RSe=D0.useLayoutEffect,jSe=D0.useDebugValue;function NSe(e,t){var r=t(),n=kSe({inst:{value:r,getSnapshot:t}}),o=n[0].inst,l=n[1];return RSe(function(){o.value=r,o.getSnapshot=t,qM(o)&&l({inst:o})},[e,r,t]),ISe(function(){return qM(o)&&l({inst:o}),e(function(){qM(o)&&l({inst:o})})},[e]),jSe(r),r}function qM(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!OSe(e,r)}catch{return!0}}function MSe(e,t){return t()}var DSe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?MSe:NSe;cte.useSyncExternalStore=D0.useSyncExternalStore!==void 0?D0.useSyncExternalStore:DSe;lte.exports=cte;var ute=lte.exports;function LSe(){return ute.useSyncExternalStore(FSe,()=>!0,()=>!1)}function FSe(){return()=>{}}var r4="Avatar",[zSe,Wet]=Zs(r4),[BSe,dte]=zSe(r4),hte=W.forwardRef((e,t)=>{const{__scopeAvatar:r,...n}=e,[o,l]=W.useState("idle");return m.jsx(BSe,{scope:r,imageLoadingStatus:o,onImageLoadingStatusChange:l,children:m.jsx(wn.span,{...n,ref:t})})});hte.displayName=r4;var fte="AvatarImage",pte=W.forwardRef((e,t)=>{const{__scopeAvatar:r,src:n,onLoadingStatusChange:o=()=>{},...l}=e,d=dte(fte,r),i=$Se(n,l),g=Io(_=>{o(_),d.onImageLoadingStatusChange(_)});return Ro(()=>{i!=="idle"&&g(i)},[i,g]),i==="loaded"?m.jsx(wn.img,{...l,ref:t,src:n}):null});pte.displayName=fte;var mte="AvatarFallback",gte=W.forwardRef((e,t)=>{const{__scopeAvatar:r,delayMs:n,...o}=e,l=dte(mte,r),[d,i]=W.useState(n===void 0);return W.useEffect(()=>{if(n!==void 0){const g=window.setTimeout(()=>i(!0),n);return()=>window.clearTimeout(g)}},[n]),d&&l.imageLoadingStatus!=="loaded"?m.jsx(wn.span,{...o,ref:t}):null});gte.displayName=mte;function D9(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}function $Se(e,{referrerPolicy:t,crossOrigin:r}){const n=LSe(),o=W.useRef(null),l=n?(o.current||(o.current=new window.Image),o.current):null,[d,i]=W.useState(()=>D9(l,e));return Ro(()=>{i(D9(l,e))},[l,e]),Ro(()=>{const g=E=>()=>{i(E)};if(!l)return;const _=g("loaded"),S=g("error");return l.addEventListener("load",_),l.addEventListener("error",S),t&&(l.referrerPolicy=t),typeof r=="string"&&(l.crossOrigin=r),()=>{l.removeEventListener("load",_),l.removeEventListener("error",S)}},[l,r,t]),d}var yte=hte,vte=pte,_te=gte;const Gm=W.forwardRef(({className:e,...t},r)=>m.jsx(yte,{ref:r,className:yr("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...t}));Gm.displayName=yte.displayName;const Hm=W.forwardRef(({className:e,...t},r)=>m.jsx(vte,{ref:r,className:yr("aspect-square h-full w-full",e),...t}));Hm.displayName=vte.displayName;const Km=W.forwardRef(({className:e,...t},r)=>m.jsx(_te,{ref:r,className:yr("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...t}));Km.displayName=_te.displayName;const di=e=>typeof e=="string",sS=()=>{let e,t;const r=new Promise((n,o)=>{e=n,t=o});return r.resolve=e,r.reject=t,r},L9=e=>e==null?"":""+e,USe=(e,t,r)=>{e.forEach(n=>{t[n]&&(r[n]=t[n])})},VSe=/###/g,F9=e=>e&&e.indexOf("###")>-1?e.replace(VSe,"."):e,z9=e=>!e||di(e),ZS=(e,t,r)=>{const n=di(t)?t.split("."):t;let o=0;for(;o<n.length-1;){if(z9(e))return{};const l=F9(n[o]);!e[l]&&r&&(e[l]=new r),Object.prototype.hasOwnProperty.call(e,l)?e=e[l]:e={},++o}return z9(e)?{}:{obj:e,k:F9(n[o])}},B9=(e,t,r)=>{const{obj:n,k:o}=ZS(e,t,Object);if(n!==void 0||t.length===1){n[o]=r;return}let l=t[t.length-1],d=t.slice(0,t.length-1),i=ZS(e,d,Object);for(;i.obj===void 0&&d.length;)l=`${d[d.length-1]}.${l}`,d=d.slice(0,d.length-1),i=ZS(e,d,Object),i!=null&&i.obj&&typeof i.obj[`${i.k}.${l}`]<"u"&&(i.obj=void 0);i.obj[`${i.k}.${l}`]=r},qSe=(e,t,r,n)=>{const{obj:o,k:l}=ZS(e,t,Object);o[l]=o[l]||[],o[l].push(r)},yO=(e,t)=>{const{obj:r,k:n}=ZS(e,t);if(r&&Object.prototype.hasOwnProperty.call(r,n))return r[n]},WSe=(e,t,r)=>{const n=yO(e,r);return n!==void 0?n:yO(t,r)},xte=(e,t,r)=>{for(const n in t)n!=="__proto__"&&n!=="constructor"&&(n in e?di(e[n])||e[n]instanceof String||di(t[n])||t[n]instanceof String?r&&(e[n]=t[n]):xte(e[n],t[n],r):e[n]=t[n]);return e},vx=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var GSe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const HSe=e=>di(e)?e.replace(/[&<>"'\/]/g,t=>GSe[t]):e;class KSe{constructor(t){this.capacity=t,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(t){const r=this.regExpMap.get(t);if(r!==void 0)return r;const n=new RegExp(t);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(t,n),this.regExpQueue.push(t),n}}const ZSe=[" ",",","?","!",";"],XSe=new KSe(20),YSe=(e,t,r)=>{t=t||"",r=r||"";const n=ZSe.filter(d=>t.indexOf(d)<0&&r.indexOf(d)<0);if(n.length===0)return!0;const o=XSe.getRegExp(`(${n.map(d=>d==="?"?"\\?":d).join("|")})`);let l=!o.test(e);if(!l){const d=e.indexOf(r);d>0&&!o.test(e.substring(0,d))&&(l=!0)}return l},g3=(e,t,r=".")=>{if(!e)return;if(e[t])return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0;const n=t.split(r);let o=e;for(let l=0;l<n.length;){if(!o||typeof o!="object")return;let d,i="";for(let g=l;g<n.length;++g)if(g!==l&&(i+=r),i+=n[g],d=o[i],d!==void 0){if(["string","number","boolean"].indexOf(typeof d)>-1&&g<n.length-1)continue;l+=g-l+1;break}o=d}return o},kE=e=>e==null?void 0:e.replace("_","-"),JSe={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){var r,n;(n=(r=console==null?void 0:console[e])==null?void 0:r.apply)==null||n.call(r,console,t)}};class vO{constructor(t,r={}){this.init(t,r)}init(t,r={}){this.prefix=r.prefix||"i18next:",this.logger=t||JSe,this.options=r,this.debug=r.debug}log(...t){return this.forward(t,"log","",!0)}warn(...t){return this.forward(t,"warn","",!0)}error(...t){return this.forward(t,"error","")}deprecate(...t){return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(t,r,n,o){return o&&!this.debug?null:(di(t[0])&&(t[0]=`${n}${this.prefix} ${t[0]}`),this.logger[r](t))}create(t){return new vO(this.logger,{prefix:`${this.prefix}:${t}:`,...this.options})}clone(t){return t=t||this.options,t.prefix=t.prefix||this.prefix,new vO(this.logger,t)}}var hh=new vO;let CI=class{constructor(){this.observers={}}on(t,r){return t.split(" ").forEach(n=>{this.observers[n]||(this.observers[n]=new Map);const o=this.observers[n].get(r)||0;this.observers[n].set(r,o+1)}),this}off(t,r){if(this.observers[t]){if(!r){delete this.observers[t];return}this.observers[t].delete(r)}}emit(t,...r){this.observers[t]&&Array.from(this.observers[t].entries()).forEach(([o,l])=>{for(let d=0;d<l;d++)o(...r)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([o,l])=>{for(let d=0;d<l;d++)o.apply(o,[t,...r])})}};class $9 extends CI{constructor(t,r={ns:["translation"],defaultNS:"translation"}){super(),this.data=t||{},this.options=r,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(t){this.options.ns.indexOf(t)<0&&this.options.ns.push(t)}removeNamespaces(t){const r=this.options.ns.indexOf(t);r>-1&&this.options.ns.splice(r,1)}getResource(t,r,n,o={}){var _,S;const l=o.keySeparator!==void 0?o.keySeparator:this.options.keySeparator,d=o.ignoreJSONStructure!==void 0?o.ignoreJSONStructure:this.options.ignoreJSONStructure;let i;t.indexOf(".")>-1?i=t.split("."):(i=[t,r],n&&(Array.isArray(n)?i.push(...n):di(n)&&l?i.push(...n.split(l)):i.push(n)));const g=yO(this.data,i);return!g&&!r&&!n&&t.indexOf(".")>-1&&(t=i[0],r=i[1],n=i.slice(2).join(".")),g||!d||!di(n)?g:g3((S=(_=this.data)==null?void 0:_[t])==null?void 0:S[r],n,l)}addResource(t,r,n,o,l={silent:!1}){const d=l.keySeparator!==void 0?l.keySeparator:this.options.keySeparator;let i=[t,r];n&&(i=i.concat(d?n.split(d):n)),t.indexOf(".")>-1&&(i=t.split("."),o=r,r=i[1]),this.addNamespaces(r),B9(this.data,i,o),l.silent||this.emit("added",t,r,n,o)}addResources(t,r,n,o={silent:!1}){for(const l in n)(di(n[l])||Array.isArray(n[l]))&&this.addResource(t,r,l,n[l],{silent:!0});o.silent||this.emit("added",t,r,n)}addResourceBundle(t,r,n,o,l,d={silent:!1,skipCopy:!1}){let i=[t,r];t.indexOf(".")>-1&&(i=t.split("."),o=n,n=r,r=i[1]),this.addNamespaces(r);let g=yO(this.data,i)||{};d.skipCopy||(n=JSON.parse(JSON.stringify(n))),o?xte(g,n,l):g={...g,...n},B9(this.data,i,g),d.silent||this.emit("added",t,r,n)}removeResourceBundle(t,r){this.hasResourceBundle(t,r)&&delete this.data[t][r],this.removeNamespaces(r),this.emit("removed",t,r)}hasResourceBundle(t,r){return this.getResource(t,r)!==void 0}getResourceBundle(t,r){return r||(r=this.options.defaultNS),this.getResource(t,r)}getDataByLanguage(t){return this.data[t]}hasLanguageSomeTranslations(t){const r=this.getDataByLanguage(t);return!!(r&&Object.keys(r)||[]).find(o=>r[o]&&Object.keys(r[o]).length>0)}toJSON(){return this.data}}var bte={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,r,n,o){return e.forEach(l=>{var d;t=((d=this.processors[l])==null?void 0:d.process(t,r,n,o))??t}),t}};const wte=Symbol("i18next/PATH_KEY");function QSe(){const e=[],t=Object.create(null);let r;return t.get=(n,o)=>{var l;return(l=r==null?void 0:r.revoke)==null||l.call(r),o===wte?e:(e.push(o),r=Proxy.revocable(n,t),r.proxy)},Proxy.revocable(Object.create(null),t).proxy}function y3(e,t){const{[wte]:r}=e(QSe());return r.join((t==null?void 0:t.keySeparator)??".")}const U9={},WM=e=>!di(e)&&typeof e!="boolean"&&typeof e!="number";class _O extends CI{constructor(t,r={}){super(),USe(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],t,this),this.options=r,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=hh.create("translator")}changeLanguage(t){t&&(this.language=t)}exists(t,r={interpolation:{}}){const n={...r};if(t==null)return!1;const o=this.resolve(t,n);if((o==null?void 0:o.res)===void 0)return!1;const l=WM(o.res);return!(n.returnObjects===!1&&l)}extractFromKey(t,r){let n=r.nsSeparator!==void 0?r.nsSeparator:this.options.nsSeparator;n===void 0&&(n=":");const o=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator;let l=r.ns||this.options.defaultNS||[];const d=n&&t.indexOf(n)>-1,i=!this.options.userDefinedKeySeparator&&!r.keySeparator&&!this.options.userDefinedNsSeparator&&!r.nsSeparator&&!YSe(t,n,o);if(d&&!i){const g=t.match(this.interpolator.nestingRegexp);if(g&&g.length>0)return{key:t,namespaces:di(l)?[l]:l};const _=t.split(n);(n!==o||n===o&&this.options.ns.indexOf(_[0])>-1)&&(l=_.shift()),t=_.join(o)}return{key:t,namespaces:di(l)?[l]:l}}translate(t,r,n){let o=typeof r=="object"?{...r}:r;if(typeof o!="object"&&this.options.overloadTranslationOptionHandler&&(o=this.options.overloadTranslationOptionHandler(arguments)),typeof o=="object"&&(o={...o}),o||(o={}),t==null)return"";typeof t=="function"&&(t=y3(t,{...this.options,...o})),Array.isArray(t)||(t=[String(t)]);const l=o.returnDetails!==void 0?o.returnDetails:this.options.returnDetails,d=o.keySeparator!==void 0?o.keySeparator:this.options.keySeparator,{key:i,namespaces:g}=this.extractFromKey(t[t.length-1],o),_=g[g.length-1];let S=o.nsSeparator!==void 0?o.nsSeparator:this.options.nsSeparator;S===void 0&&(S=":");const E=o.lng||this.language,T=o.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if((E==null?void 0:E.toLowerCase())==="cimode")return T?l?{res:`${_}${S}${i}`,usedKey:i,exactUsedKey:i,usedLng:E,usedNS:_,usedParams:this.getUsedParamsDetails(o)}:`${_}${S}${i}`:l?{res:i,usedKey:i,exactUsedKey:i,usedLng:E,usedNS:_,usedParams:this.getUsedParamsDetails(o)}:i;const C=this.resolve(t,o);let N=C==null?void 0:C.res;const I=(C==null?void 0:C.usedKey)||i,j=(C==null?void 0:C.exactUsedKey)||i,D=["[object Number]","[object Function]","[object RegExp]"],R=o.joinArrays!==void 0?o.joinArrays:this.options.joinArrays,F=!this.i18nFormat||this.i18nFormat.handleAsObject,B=o.count!==void 0&&!di(o.count),U=_O.hasDefaultValue(o),Z=B?this.pluralResolver.getSuffix(E,o.count,o):"",J=o.ordinal&&B?this.pluralResolver.getSuffix(E,o.count,{ordinal:!1}):"",te=B&&!o.ordinal&&o.count===0,ae=te&&o[`defaultValue${this.options.pluralSeparator}zero`]||o[`defaultValue${Z}`]||o[`defaultValue${J}`]||o.defaultValue;let ne=N;F&&!N&&U&&(ne=ae);const ie=WM(ne),ee=Object.prototype.toString.apply(ne);if(F&&ne&&ie&&D.indexOf(ee)<0&&!(di(R)&&Array.isArray(ne))){if(!o.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const oe=this.options.returnedObjectHandler?this.options.returnedObjectHandler(I,ne,{...o,ns:g}):`key '${i} (${this.language})' returned an object instead of string.`;return l?(C.res=oe,C.usedParams=this.getUsedParamsDetails(o),C):oe}if(d){const oe=Array.isArray(ne),de=oe?[]:{},xe=oe?j:I;for(const we in ne)if(Object.prototype.hasOwnProperty.call(ne,we)){const Ae=`${xe}${d}${we}`;U&&!N?de[we]=this.translate(Ae,{...o,defaultValue:WM(ae)?ae[we]:void 0,joinArrays:!1,ns:g}):de[we]=this.translate(Ae,{...o,joinArrays:!1,ns:g}),de[we]===Ae&&(de[we]=ne[we])}N=de}}else if(F&&di(R)&&Array.isArray(N))N=N.join(R),N&&(N=this.extendTranslation(N,t,o,n));else{let oe=!1,de=!1;!this.isValidLookup(N)&&U&&(oe=!0,N=ae),this.isValidLookup(N)||(de=!0,N=i);const we=(o.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&de?void 0:N,Ae=U&&ae!==N&&this.options.updateMissing;if(de||oe||Ae){if(this.logger.log(Ae?"updateKey":"missingKey",E,_,i,Ae?ae:N),d){const ye=this.resolve(i,{...o,keySeparator:!1});ye&&ye.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let Ce=[];const me=this.languageUtils.getFallbackCodes(this.options.fallbackLng,o.lng||this.language);if(this.options.saveMissingTo==="fallback"&&me&&me[0])for(let ye=0;ye<me.length;ye++)Ce.push(me[ye]);else this.options.saveMissingTo==="all"?Ce=this.languageUtils.toResolveHierarchy(o.lng||this.language):Ce.push(o.lng||this.language);const Pe=(ye,pe,Ie)=>{var Ze;const tt=U&&Ie!==N?Ie:we;this.options.missingKeyHandler?this.options.missingKeyHandler(ye,_,pe,tt,Ae,o):(Ze=this.backendConnector)!=null&&Ze.saveMissing&&this.backendConnector.saveMissing(ye,_,pe,tt,Ae,o),this.emit("missingKey",ye,_,pe,N)};this.options.saveMissing&&(this.options.saveMissingPlurals&&B?Ce.forEach(ye=>{const pe=this.pluralResolver.getSuffixes(ye,o);te&&o[`defaultValue${this.options.pluralSeparator}zero`]&&pe.indexOf(`${this.options.pluralSeparator}zero`)<0&&pe.push(`${this.options.pluralSeparator}zero`),pe.forEach(Ie=>{Pe([ye],i+Ie,o[`defaultValue${Ie}`]||ae)})}):Pe(Ce,i,ae))}N=this.extendTranslation(N,t,o,C,n),de&&N===i&&this.options.appendNamespaceToMissingKey&&(N=`${_}${S}${i}`),(de||oe)&&this.options.parseMissingKeyHandler&&(N=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${_}${S}${i}`:i,oe?N:void 0,o))}return l?(C.res=N,C.usedParams=this.getUsedParamsDetails(o),C):N}extendTranslation(t,r,n,o,l){var g,_;if((g=this.i18nFormat)!=null&&g.parse)t=this.i18nFormat.parse(t,{...this.options.interpolation.defaultVariables,...n},n.lng||this.language||o.usedLng,o.usedNS,o.usedKey,{resolved:o});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init({...n,interpolation:{...this.options.interpolation,...n.interpolation}});const S=di(t)&&(((_=n==null?void 0:n.interpolation)==null?void 0:_.skipOnVariables)!==void 0?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let E;if(S){const C=t.match(this.interpolator.nestingRegexp);E=C&&C.length}let T=n.replace&&!di(n.replace)?n.replace:n;if(this.options.interpolation.defaultVariables&&(T={...this.options.interpolation.defaultVariables,...T}),t=this.interpolator.interpolate(t,T,n.lng||this.language||o.usedLng,n),S){const C=t.match(this.interpolator.nestingRegexp),N=C&&C.length;E<N&&(n.nest=!1)}!n.lng&&o&&o.res&&(n.lng=this.language||o.usedLng),n.nest!==!1&&(t=this.interpolator.nest(t,(...C)=>(l==null?void 0:l[0])===C[0]&&!n.context?(this.logger.warn(`It seems you are nesting recursively key: ${C[0]} in key: ${r[0]}`),null):this.translate(...C,r),n)),n.interpolation&&this.interpolator.reset()}const d=n.postProcess||this.options.postProcess,i=di(d)?[d]:d;return t!=null&&(i!=null&&i.length)&&n.applyPostProcessor!==!1&&(t=bte.handle(i,t,r,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...o,usedParams:this.getUsedParamsDetails(n)},...n}:n,this)),t}resolve(t,r={}){let n,o,l,d,i;return di(t)&&(t=[t]),t.forEach(g=>{if(this.isValidLookup(n))return;const _=this.extractFromKey(g,r),S=_.key;o=S;let E=_.namespaces;this.options.fallbackNS&&(E=E.concat(this.options.fallbackNS));const T=r.count!==void 0&&!di(r.count),C=T&&!r.ordinal&&r.count===0,N=r.context!==void 0&&(di(r.context)||typeof r.context=="number")&&r.context!=="",I=r.lngs?r.lngs:this.languageUtils.toResolveHierarchy(r.lng||this.language,r.fallbackLng);E.forEach(j=>{var D,R;this.isValidLookup(n)||(i=j,!U9[`${I[0]}-${j}`]&&((D=this.utils)!=null&&D.hasLoadedNamespace)&&!((R=this.utils)!=null&&R.hasLoadedNamespace(i))&&(U9[`${I[0]}-${j}`]=!0,this.logger.warn(`key "${o}" for languages "${I.join(", ")}" won't get resolved as namespace "${i}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),I.forEach(F=>{var Z;if(this.isValidLookup(n))return;d=F;const B=[S];if((Z=this.i18nFormat)!=null&&Z.addLookupKeys)this.i18nFormat.addLookupKeys(B,S,F,j,r);else{let J;T&&(J=this.pluralResolver.getSuffix(F,r.count,r));const te=`${this.options.pluralSeparator}zero`,ae=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(T&&(r.ordinal&&J.indexOf(ae)===0&&B.push(S+J.replace(ae,this.options.pluralSeparator)),B.push(S+J),C&&B.push(S+te)),N){const ne=`${S}${this.options.contextSeparator||"_"}${r.context}`;B.push(ne),T&&(r.ordinal&&J.indexOf(ae)===0&&B.push(ne+J.replace(ae,this.options.pluralSeparator)),B.push(ne+J),C&&B.push(ne+te))}}let U;for(;U=B.pop();)this.isValidLookup(n)||(l=U,n=this.getResource(F,j,U,r))}))})}),{res:n,usedKey:o,exactUsedKey:l,usedLng:d,usedNS:i}}isValidLookup(t){return t!==void 0&&!(!this.options.returnNull&&t===null)&&!(!this.options.returnEmptyString&&t==="")}getResource(t,r,n,o={}){var l;return(l=this.i18nFormat)!=null&&l.getResource?this.i18nFormat.getResource(t,r,n,o):this.resourceStore.getResource(t,r,n,o)}getUsedParamsDetails(t={}){const r=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],n=t.replace&&!di(t.replace);let o=n?t.replace:t;if(n&&typeof t.count<"u"&&(o.count=t.count),this.options.interpolation.defaultVariables&&(o={...this.options.interpolation.defaultVariables,...o}),!n){o={...o};for(const l of r)delete o[l]}return o}static hasDefaultValue(t){const r="defaultValue";for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&r===n.substring(0,r.length)&&t[n]!==void 0)return!0;return!1}}class V9{constructor(t){this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=hh.create("languageUtils")}getScriptPartFromCode(t){if(t=kE(t),!t||t.indexOf("-")<0)return null;const r=t.split("-");return r.length===2||(r.pop(),r[r.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(r.join("-"))}getLanguagePartFromCode(t){if(t=kE(t),!t||t.indexOf("-")<0)return t;const r=t.split("-");return this.formatLanguageCode(r[0])}formatLanguageCode(t){if(di(t)&&t.indexOf("-")>-1){let r;try{r=Intl.getCanonicalLocales(t)[0]}catch{}return r&&this.options.lowerCaseLng&&(r=r.toLowerCase()),r||(this.options.lowerCaseLng?t.toLowerCase():t)}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t}isSupportedCode(t){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(t=this.getLanguagePartFromCode(t)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(t)>-1}getBestMatchFromCodes(t){if(!t)return null;let r;return t.forEach(n=>{if(r)return;const o=this.formatLanguageCode(n);(!this.options.supportedLngs||this.isSupportedCode(o))&&(r=o)}),!r&&this.options.supportedLngs&&t.forEach(n=>{if(r)return;const o=this.getScriptPartFromCode(n);if(this.isSupportedCode(o))return r=o;const l=this.getLanguagePartFromCode(n);if(this.isSupportedCode(l))return r=l;r=this.options.supportedLngs.find(d=>{if(d===l)return d;if(!(d.indexOf("-")<0&&l.indexOf("-")<0)&&(d.indexOf("-")>0&&l.indexOf("-")<0&&d.substring(0,d.indexOf("-"))===l||d.indexOf(l)===0&&l.length>1))return d})}),r||(r=this.getFallbackCodes(this.options.fallbackLng)[0]),r}getFallbackCodes(t,r){if(!t)return[];if(typeof t=="function"&&(t=t(r)),di(t)&&(t=[t]),Array.isArray(t))return t;if(!r)return t.default||[];let n=t[r];return n||(n=t[this.getScriptPartFromCode(r)]),n||(n=t[this.formatLanguageCode(r)]),n||(n=t[this.getLanguagePartFromCode(r)]),n||(n=t.default),n||[]}toResolveHierarchy(t,r){const n=this.getFallbackCodes((r===!1?[]:r)||this.options.fallbackLng||[],t),o=[],l=d=>{d&&(this.isSupportedCode(d)?o.push(d):this.logger.warn(`rejecting language code not found in supportedLngs: ${d}`))};return di(t)&&(t.indexOf("-")>-1||t.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&l(this.formatLanguageCode(t)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&l(this.getScriptPartFromCode(t)),this.options.load!=="currentOnly"&&l(this.getLanguagePartFromCode(t))):di(t)&&l(this.formatLanguageCode(t)),n.forEach(d=>{o.indexOf(d)<0&&l(this.formatLanguageCode(d))}),o}}const q9={zero:0,one:1,two:2,few:3,many:4,other:5},W9={select:e=>e===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class eEe{constructor(t,r={}){this.languageUtils=t,this.options=r,this.logger=hh.create("pluralResolver"),this.pluralRulesCache={}}addRule(t,r){this.rules[t]=r}clearCache(){this.pluralRulesCache={}}getRule(t,r={}){const n=kE(t==="dev"?"en":t),o=r.ordinal?"ordinal":"cardinal",l=JSON.stringify({cleanedCode:n,type:o});if(l in this.pluralRulesCache)return this.pluralRulesCache[l];let d;try{d=new Intl.PluralRules(n,{type:o})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),W9;if(!t.match(/-|_/))return W9;const g=this.languageUtils.getLanguagePartFromCode(t);d=this.getRule(g,r)}return this.pluralRulesCache[l]=d,d}needsPlural(t,r={}){let n=this.getRule(t,r);return n||(n=this.getRule("dev",r)),(n==null?void 0:n.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(t,r,n={}){return this.getSuffixes(t,n).map(o=>`${r}${o}`)}getSuffixes(t,r={}){let n=this.getRule(t,r);return n||(n=this.getRule("dev",r)),n?n.resolvedOptions().pluralCategories.sort((o,l)=>q9[o]-q9[l]).map(o=>`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${o}`):[]}getSuffix(t,r,n={}){const o=this.getRule(t,n);return o?`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${o.select(r)}`:(this.logger.warn(`no plural rule found for: ${t}`),this.getSuffix("dev",r,n))}}const G9=(e,t,r,n=".",o=!0)=>{let l=WSe(e,t,r);return!l&&o&&di(r)&&(l=g3(e,r,n),l===void 0&&(l=g3(t,r,n))),l},GM=e=>e.replace(/\$/g,"$$$$");class tEe{constructor(t={}){var r;this.logger=hh.create("interpolator"),this.options=t,this.format=((r=t==null?void 0:t.interpolation)==null?void 0:r.format)||(n=>n),this.init(t)}init(t={}){t.interpolation||(t.interpolation={escapeValue:!0});const{escape:r,escapeValue:n,useRawValueToEscape:o,prefix:l,prefixEscaped:d,suffix:i,suffixEscaped:g,formatSeparator:_,unescapeSuffix:S,unescapePrefix:E,nestingPrefix:T,nestingPrefixEscaped:C,nestingSuffix:N,nestingSuffixEscaped:I,nestingOptionsSeparator:j,maxReplaces:D,alwaysFormat:R}=t.interpolation;this.escape=r!==void 0?r:HSe,this.escapeValue=n!==void 0?n:!0,this.useRawValueToEscape=o!==void 0?o:!1,this.prefix=l?vx(l):d||"{{",this.suffix=i?vx(i):g||"}}",this.formatSeparator=_||",",this.unescapePrefix=S?"":E||"-",this.unescapeSuffix=this.unescapePrefix?"":S||"",this.nestingPrefix=T?vx(T):C||vx("$t("),this.nestingSuffix=N?vx(N):I||vx(")"),this.nestingOptionsSeparator=j||",",this.maxReplaces=D||1e3,this.alwaysFormat=R!==void 0?R:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const t=(r,n)=>(r==null?void 0:r.source)===n?(r.lastIndex=0,r):new RegExp(n,"g");this.regexp=t(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=t(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=t(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(t,r,n,o){var C;let l,d,i;const g=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},_=N=>{if(N.indexOf(this.formatSeparator)<0){const R=G9(r,g,N,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(R,void 0,n,{...o,...r,interpolationkey:N}):R}const I=N.split(this.formatSeparator),j=I.shift().trim(),D=I.join(this.formatSeparator).trim();return this.format(G9(r,g,j,this.options.keySeparator,this.options.ignoreJSONStructure),D,n,{...o,...r,interpolationkey:j})};this.resetRegExp();const S=(o==null?void 0:o.missingInterpolationHandler)||this.options.missingInterpolationHandler,E=((C=o==null?void 0:o.interpolation)==null?void 0:C.skipOnVariables)!==void 0?o.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:N=>GM(N)},{regex:this.regexp,safeValue:N=>this.escapeValue?GM(this.escape(N)):GM(N)}].forEach(N=>{for(i=0;l=N.regex.exec(t);){const I=l[1].trim();if(d=_(I),d===void 0)if(typeof S=="function"){const D=S(t,l,o);d=di(D)?D:""}else if(o&&Object.prototype.hasOwnProperty.call(o,I))d="";else if(E){d=l[0];continue}else this.logger.warn(`missed to pass in variable ${I} for interpolating ${t}`),d="";else!di(d)&&!this.useRawValueToEscape&&(d=L9(d));const j=N.safeValue(d);if(t=t.replace(l[0],j),E?(N.regex.lastIndex+=d.length,N.regex.lastIndex-=l[0].length):N.regex.lastIndex=0,i++,i>=this.maxReplaces)break}}),t}nest(t,r,n={}){let o,l,d;const i=(g,_)=>{const S=this.nestingOptionsSeparator;if(g.indexOf(S)<0)return g;const E=g.split(new RegExp(`${S}[ ]*{`));let T=`{${E[1]}`;g=E[0],T=this.interpolate(T,d);const C=T.match(/'/g),N=T.match(/"/g);(((C==null?void 0:C.length)??0)%2===0&&!N||N.length%2!==0)&&(T=T.replace(/'/g,'"'));try{d=JSON.parse(T),_&&(d={..._,...d})}catch(I){return this.logger.warn(`failed parsing options string in nesting for key ${g}`,I),`${g}${S}${T}`}return d.defaultValue&&d.defaultValue.indexOf(this.prefix)>-1&&delete d.defaultValue,g};for(;o=this.nestingRegexp.exec(t);){let g=[];d={...n},d=d.replace&&!di(d.replace)?d.replace:d,d.applyPostProcessor=!1,delete d.defaultValue;const _=/{.*}/.test(o[1])?o[1].lastIndexOf("}")+1:o[1].indexOf(this.formatSeparator);if(_!==-1&&(g=o[1].slice(_).split(this.formatSeparator).map(S=>S.trim()).filter(Boolean),o[1]=o[1].slice(0,_)),l=r(i.call(this,o[1].trim(),d),d),l&&o[0]===t&&!di(l))return l;di(l)||(l=L9(l)),l||(this.logger.warn(`missed to resolve ${o[1]} for nesting ${t}`),l=""),g.length&&(l=g.reduce((S,E)=>this.format(S,E,n.lng,{...n,interpolationkey:o[1].trim()}),l.trim())),t=t.replace(o[0],l),this.regexp.lastIndex=0}return t}}const rEe=e=>{let t=e.toLowerCase().trim();const r={};if(e.indexOf("(")>-1){const n=e.split("(");t=n[0].toLowerCase().trim();const o=n[1].substring(0,n[1].length-1);t==="currency"&&o.indexOf(":")<0?r.currency||(r.currency=o.trim()):t==="relativetime"&&o.indexOf(":")<0?r.range||(r.range=o.trim()):o.split(";").forEach(d=>{if(d){const[i,...g]=d.split(":"),_=g.join(":").trim().replace(/^'+|'+$/g,""),S=i.trim();r[S]||(r[S]=_),_==="false"&&(r[S]=!1),_==="true"&&(r[S]=!0),isNaN(_)||(r[S]=parseInt(_,10))}})}return{formatName:t,formatOptions:r}},H9=e=>{const t={};return(r,n,o)=>{let l=o;o&&o.interpolationkey&&o.formatParams&&o.formatParams[o.interpolationkey]&&o[o.interpolationkey]&&(l={...l,[o.interpolationkey]:void 0});const d=n+JSON.stringify(l);let i=t[d];return i||(i=e(kE(n),o),t[d]=i),i(r)}},nEe=e=>(t,r,n)=>e(kE(r),n)(t);class iEe{constructor(t={}){this.logger=hh.create("formatter"),this.options=t,this.init(t)}init(t,r={interpolation:{}}){this.formatSeparator=r.interpolation.formatSeparator||",";const n=r.cacheInBuiltFormats?H9:nEe;this.formats={number:n((o,l)=>{const d=new Intl.NumberFormat(o,{...l});return i=>d.format(i)}),currency:n((o,l)=>{const d=new Intl.NumberFormat(o,{...l,style:"currency"});return i=>d.format(i)}),datetime:n((o,l)=>{const d=new Intl.DateTimeFormat(o,{...l});return i=>d.format(i)}),relativetime:n((o,l)=>{const d=new Intl.RelativeTimeFormat(o,{...l});return i=>d.format(i,l.range||"day")}),list:n((o,l)=>{const d=new Intl.ListFormat(o,{...l});return i=>d.format(i)})}}add(t,r){this.formats[t.toLowerCase().trim()]=r}addCached(t,r){this.formats[t.toLowerCase().trim()]=H9(r)}format(t,r,n,o={}){const l=r.split(this.formatSeparator);if(l.length>1&&l[0].indexOf("(")>1&&l[0].indexOf(")")<0&&l.find(i=>i.indexOf(")")>-1)){const i=l.findIndex(g=>g.indexOf(")")>-1);l[0]=[l[0],...l.splice(1,i)].join(this.formatSeparator)}return l.reduce((i,g)=>{var E;const{formatName:_,formatOptions:S}=rEe(g);if(this.formats[_]){let T=i;try{const C=((E=o==null?void 0:o.formatParams)==null?void 0:E[o.interpolationkey])||{},N=C.locale||C.lng||o.locale||o.lng||n;T=this.formats[_](i,N,{...S,...o,...C})}catch(C){this.logger.warn(C)}return T}else this.logger.warn(`there was no format function for ${_}`);return i},t)}}const aEe=(e,t)=>{e.pending[t]!==void 0&&(delete e.pending[t],e.pendingCount--)};class oEe extends CI{constructor(t,r,n,o={}){var l,d;super(),this.backend=t,this.store=r,this.services=n,this.languageUtils=n.languageUtils,this.options=o,this.logger=hh.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=o.maxParallelReads||10,this.readingCalls=0,this.maxRetries=o.maxRetries>=0?o.maxRetries:5,this.retryTimeout=o.retryTimeout>=1?o.retryTimeout:350,this.state={},this.queue=[],(d=(l=this.backend)==null?void 0:l.init)==null||d.call(l,n,o.backend,o)}queueLoad(t,r,n,o){const l={},d={},i={},g={};return t.forEach(_=>{let S=!0;r.forEach(E=>{const T=`${_}|${E}`;!n.reload&&this.store.hasResourceBundle(_,E)?this.state[T]=2:this.state[T]<0||(this.state[T]===1?d[T]===void 0&&(d[T]=!0):(this.state[T]=1,S=!1,d[T]===void 0&&(d[T]=!0),l[T]===void 0&&(l[T]=!0),g[E]===void 0&&(g[E]=!0)))}),S||(i[_]=!0)}),(Object.keys(l).length||Object.keys(d).length)&&this.queue.push({pending:d,pendingCount:Object.keys(d).length,loaded:{},errors:[],callback:o}),{toLoad:Object.keys(l),pending:Object.keys(d),toLoadLanguages:Object.keys(i),toLoadNamespaces:Object.keys(g)}}loaded(t,r,n){const o=t.split("|"),l=o[0],d=o[1];r&&this.emit("failedLoading",l,d,r),!r&&n&&this.store.addResourceBundle(l,d,n,void 0,void 0,{skipCopy:!0}),this.state[t]=r?-1:2,r&&n&&(this.state[t]=0);const i={};this.queue.forEach(g=>{qSe(g.loaded,[l],d),aEe(g,t),r&&g.errors.push(r),g.pendingCount===0&&!g.done&&(Object.keys(g.loaded).forEach(_=>{i[_]||(i[_]={});const S=g.loaded[_];S.length&&S.forEach(E=>{i[_][E]===void 0&&(i[_][E]=!0)})}),g.done=!0,g.errors.length?g.callback(g.errors):g.callback())}),this.emit("loaded",i),this.queue=this.queue.filter(g=>!g.done)}read(t,r,n,o=0,l=this.retryTimeout,d){if(!t.length)return d(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:t,ns:r,fcName:n,tried:o,wait:l,callback:d});return}this.readingCalls++;const i=(_,S)=>{if(this.readingCalls--,this.waitingReads.length>0){const E=this.waitingReads.shift();this.read(E.lng,E.ns,E.fcName,E.tried,E.wait,E.callback)}if(_&&S&&o<this.maxRetries){setTimeout(()=>{this.read.call(this,t,r,n,o+1,l*2,d)},l);return}d(_,S)},g=this.backend[n].bind(this.backend);if(g.length===2){try{const _=g(t,r);_&&typeof _.then=="function"?_.then(S=>i(null,S)).catch(i):i(null,_)}catch(_){i(_)}return}return g(t,r,i)}prepareLoading(t,r,n={},o){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),o&&o();di(t)&&(t=this.languageUtils.toResolveHierarchy(t)),di(r)&&(r=[r]);const l=this.queueLoad(t,r,n,o);if(!l.toLoad.length)return l.pending.length||o(),null;l.toLoad.forEach(d=>{this.loadOne(d)})}load(t,r,n){this.prepareLoading(t,r,{},n)}reload(t,r,n){this.prepareLoading(t,r,{reload:!0},n)}loadOne(t,r=""){const n=t.split("|"),o=n[0],l=n[1];this.read(o,l,"read",void 0,void 0,(d,i)=>{d&&this.logger.warn(`${r}loading namespace ${l} for language ${o} failed`,d),!d&&i&&this.logger.log(`${r}loaded namespace ${l} for language ${o}`,i),this.loaded(t,d,i)})}saveMissing(t,r,n,o,l,d={},i=()=>{}){var g,_,S,E,T;if((_=(g=this.services)==null?void 0:g.utils)!=null&&_.hasLoadedNamespace&&!((E=(S=this.services)==null?void 0:S.utils)!=null&&E.hasLoadedNamespace(r))){this.logger.warn(`did not save key "${n}" as the namespace "${r}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(n==null||n==="")){if((T=this.backend)!=null&&T.create){const C={...d,isUpdate:l},N=this.backend.create.bind(this.backend);if(N.length<6)try{let I;N.length===5?I=N(t,r,n,o,C):I=N(t,r,n,o),I&&typeof I.then=="function"?I.then(j=>i(null,j)).catch(i):i(null,I)}catch(I){i(I)}else N(t,r,n,o,i,C)}!t||!t[0]||this.store.addResource(t[0],r,n,o)}}}const K9=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if(typeof e[1]=="object"&&(t=e[1]),di(e[1])&&(t.defaultValue=e[1]),di(e[2])&&(t.tDescription=e[2]),typeof e[2]=="object"||typeof e[3]=="object"){const r=e[3]||e[2];Object.keys(r).forEach(n=>{t[n]=r[n]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),Z9=e=>{var t,r;return di(e.ns)&&(e.ns=[e.ns]),di(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),di(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),((r=(t=e.supportedLngs)==null?void 0:t.indexOf)==null?void 0:r.call(t,"cimode"))<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),typeof e.initImmediate=="boolean"&&(e.initAsync=e.initImmediate),e},DP=()=>{},sEe=e=>{Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach(r=>{typeof e[r]=="function"&&(e[r]=e[r].bind(e))})};class XS extends CI{constructor(t={},r){if(super(),this.options=Z9(t),this.services={},this.logger=hh,this.modules={external:[]},sEe(this),r&&!this.isInitialized&&!t.isClone){if(!this.options.initAsync)return this.init(t,r),this;setTimeout(()=>{this.init(t,r)},0)}}init(t={},r){this.isInitializing=!0,typeof t=="function"&&(r=t,t={}),t.defaultNS==null&&t.ns&&(di(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const n=K9();this.options={...n,...this.options,...Z9(t)},this.options.interpolation={...n.interpolation,...this.options.interpolation},t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator);const o=_=>_?typeof _=="function"?new _:_:null;if(!this.options.isClone){this.modules.logger?hh.init(o(this.modules.logger),this.options):hh.init(null,this.options);let _;this.modules.formatter?_=this.modules.formatter:_=iEe;const S=new V9(this.options);this.store=new $9(this.options.resources,this.options);const E=this.services;E.logger=hh,E.resourceStore=this.store,E.languageUtils=S,E.pluralResolver=new eEe(S,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==n.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),_&&(!this.options.interpolation.format||this.options.interpolation.format===n.interpolation.format)&&(E.formatter=o(_),E.formatter.init&&E.formatter.init(E,this.options),this.options.interpolation.format=E.formatter.format.bind(E.formatter)),E.interpolator=new tEe(this.options),E.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},E.backendConnector=new oEe(o(this.modules.backend),E.resourceStore,E,this.options),E.backendConnector.on("*",(C,...N)=>{this.emit(C,...N)}),this.modules.languageDetector&&(E.languageDetector=o(this.modules.languageDetector),E.languageDetector.init&&E.languageDetector.init(E,this.options.detection,this.options)),this.modules.i18nFormat&&(E.i18nFormat=o(this.modules.i18nFormat),E.i18nFormat.init&&E.i18nFormat.init(this)),this.translator=new _O(this.services,this.options),this.translator.on("*",(C,...N)=>{this.emit(C,...N)}),this.modules.external.forEach(C=>{C.init&&C.init(this)})}if(this.format=this.options.interpolation.format,r||(r=DP),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const _=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);_.length>0&&_[0]!=="dev"&&(this.options.lng=_[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(_=>{this[_]=(...S)=>this.store[_](...S)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(_=>{this[_]=(...S)=>(this.store[_](...S),this)});const i=sS(),g=()=>{const _=(S,E)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),i.resolve(E),r(S,E)};if(this.languages&&!this.isInitialized)return _(null,this.t.bind(this));this.changeLanguage(this.options.lng,_)};return this.options.resources||!this.options.initAsync?g():setTimeout(g,0),i}loadResources(t,r=DP){var l,d;let n=r;const o=di(t)?t:this.language;if(typeof t=="function"&&(n=t),!this.options.resources||this.options.partialBundledLanguages){if((o==null?void 0:o.toLowerCase())==="cimode"&&(!this.options.preload||this.options.preload.length===0))return n();const i=[],g=_=>{if(!_||_==="cimode")return;this.services.languageUtils.toResolveHierarchy(_).forEach(E=>{E!=="cimode"&&i.indexOf(E)<0&&i.push(E)})};o?g(o):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(S=>g(S)),(d=(l=this.options.preload)==null?void 0:l.forEach)==null||d.call(l,_=>g(_)),this.services.backendConnector.load(i,this.options.ns,_=>{!_&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),n(_)})}else n(null)}reloadResources(t,r,n){const o=sS();return typeof t=="function"&&(n=t,t=void 0),typeof r=="function"&&(n=r,r=void 0),t||(t=this.languages),r||(r=this.options.ns),n||(n=DP),this.services.backendConnector.reload(t,r,l=>{o.resolve(),n(l)}),o}use(t){if(!t)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!t.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return t.type==="backend"&&(this.modules.backend=t),(t.type==="logger"||t.log&&t.warn&&t.error)&&(this.modules.logger=t),t.type==="languageDetector"&&(this.modules.languageDetector=t),t.type==="i18nFormat"&&(this.modules.i18nFormat=t),t.type==="postProcessor"&&bte.addPostProcessor(t),t.type==="formatter"&&(this.modules.formatter=t),t.type==="3rdParty"&&this.modules.external.push(t),this}setResolvedLanguage(t){if(!(!t||!this.languages)&&!(["cimode","dev"].indexOf(t)>-1)){for(let r=0;r<this.languages.length;r++){const n=this.languages[r];if(!(["cimode","dev"].indexOf(n)>-1)&&this.store.hasLanguageSomeTranslations(n)){this.resolvedLanguage=n;break}}!this.resolvedLanguage&&this.languages.indexOf(t)<0&&this.store.hasLanguageSomeTranslations(t)&&(this.resolvedLanguage=t,this.languages.unshift(t))}}changeLanguage(t,r){this.isLanguageChangingTo=t;const n=sS();this.emit("languageChanging",t);const o=i=>{this.language=i,this.languages=this.services.languageUtils.toResolveHierarchy(i),this.resolvedLanguage=void 0,this.setResolvedLanguage(i)},l=(i,g)=>{g?this.isLanguageChangingTo===t&&(o(g),this.translator.changeLanguage(g),this.isLanguageChangingTo=void 0,this.emit("languageChanged",g),this.logger.log("languageChanged",g)):this.isLanguageChangingTo=void 0,n.resolve((..._)=>this.t(..._)),r&&r(i,(..._)=>this.t(..._))},d=i=>{var S,E;!t&&!i&&this.services.languageDetector&&(i=[]);const g=di(i)?i:i&&i[0],_=this.store.hasLanguageSomeTranslations(g)?g:this.services.languageUtils.getBestMatchFromCodes(di(i)?[i]:i);_&&(this.language||o(_),this.translator.language||this.translator.changeLanguage(_),(E=(S=this.services.languageDetector)==null?void 0:S.cacheUserLanguage)==null||E.call(S,_)),this.loadResources(_,T=>{l(T,_)})};return!t&&this.services.languageDetector&&!this.services.languageDetector.async?d(this.services.languageDetector.detect()):!t&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(d):this.services.languageDetector.detect(d):d(t),n}getFixedT(t,r,n){const o=(l,d,...i)=>{let g;typeof d!="object"?g=this.options.overloadTranslationOptionHandler([l,d].concat(i)):g={...d},g.lng=g.lng||o.lng,g.lngs=g.lngs||o.lngs,g.ns=g.ns||o.ns,g.keyPrefix!==""&&(g.keyPrefix=g.keyPrefix||n||o.keyPrefix);const _=this.options.keySeparator||".";let S;return g.keyPrefix&&Array.isArray(l)?S=l.map(E=>(typeof E=="function"&&(E=y3(E,{...this.options,...d})),`${g.keyPrefix}${_}${E}`)):(typeof l=="function"&&(l=y3(l,{...this.options,...d})),S=g.keyPrefix?`${g.keyPrefix}${_}${l}`:l),this.t(S,g)};return di(t)?o.lng=t:o.lngs=t,o.ns=r,o.keyPrefix=n,o}t(...t){var r;return(r=this.translator)==null?void 0:r.translate(...t)}exists(...t){var r;return(r=this.translator)==null?void 0:r.exists(...t)}setDefaultNamespace(t){this.options.defaultNS=t}hasLoadedNamespace(t,r={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const n=r.lng||this.resolvedLanguage||this.languages[0],o=this.options?this.options.fallbackLng:!1,l=this.languages[this.languages.length-1];if(n.toLowerCase()==="cimode")return!0;const d=(i,g)=>{const _=this.services.backendConnector.state[`${i}|${g}`];return _===-1||_===0||_===2};if(r.precheck){const i=r.precheck(this,d);if(i!==void 0)return i}return!!(this.hasResourceBundle(n,t)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||d(n,t)&&(!o||d(l,t)))}loadNamespaces(t,r){const n=sS();return this.options.ns?(di(t)&&(t=[t]),t.forEach(o=>{this.options.ns.indexOf(o)<0&&this.options.ns.push(o)}),this.loadResources(o=>{n.resolve(),r&&r(o)}),n):(r&&r(),Promise.resolve())}loadLanguages(t,r){const n=sS();di(t)&&(t=[t]);const o=this.options.preload||[],l=t.filter(d=>o.indexOf(d)<0&&this.services.languageUtils.isSupportedCode(d));return l.length?(this.options.preload=o.concat(l),this.loadResources(d=>{n.resolve(),r&&r(d)}),n):(r&&r(),Promise.resolve())}dir(t){var o,l;if(t||(t=this.resolvedLanguage||(((o=this.languages)==null?void 0:o.length)>0?this.languages[0]:this.language)),!t)return"rtl";try{const d=new Intl.Locale(t);if(d&&d.getTextInfo){const i=d.getTextInfo();if(i&&i.direction)return i.direction}}catch{}const r=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],n=((l=this.services)==null?void 0:l.languageUtils)||new V9(K9());return t.toLowerCase().indexOf("-latn")>1?"ltr":r.indexOf(n.getLanguagePartFromCode(t))>-1||t.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(t={},r){const n=new XS(t,r);return n.createInstance=XS.createInstance,n}cloneInstance(t={},r=DP){const n=t.forkResourceStore;n&&delete t.forkResourceStore;const o={...this.options,...t,isClone:!0},l=new XS(o);if((t.debug!==void 0||t.prefix!==void 0)&&(l.logger=l.logger.clone(t)),["store","services","language"].forEach(i=>{l[i]=this[i]}),l.services={...this.services},l.services.utils={hasLoadedNamespace:l.hasLoadedNamespace.bind(l)},n){const i=Object.keys(this.store.data).reduce((g,_)=>(g[_]={...this.store.data[_]},g[_]=Object.keys(g[_]).reduce((S,E)=>(S[E]={...g[_][E]},S),g[_]),g),{});l.store=new $9(i,o),l.services.resourceStore=l.store}return l.translator=new _O(l.services,o),l.translator.on("*",(i,...g)=>{l.emit(i,...g)}),l.init(o,r),l.translator.options=o,l.translator.backendConnector.services.utils={hasLoadedNamespace:l.hasLoadedNamespace.bind(l)},l}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const jr=XS.createInstance();jr.createInstance;jr.dir;jr.init;jr.loadResources;jr.reloadResources;jr.use;jr.changeLanguage;jr.getFixedT;jr.t;jr.exists;jr.setDefaultNamespace;jr.hasLoadedNamespace;jr.loadNamespaces;jr.loadLanguages;const lEe=(e,t,r,n)=>{var l,d,i,g;const o=[r,{code:t,...n||{}}];if((d=(l=e==null?void 0:e.services)==null?void 0:l.logger)!=null&&d.forward)return e.services.logger.forward(o,"warn","react-i18next::",!0);hv(o[0])&&(o[0]=`react-i18next:: ${o[0]}`),(g=(i=e==null?void 0:e.services)==null?void 0:i.logger)!=null&&g.warn?e.services.logger.warn(...o):console!=null&&console.warn&&console.warn(...o)},X9={},Ste=(e,t,r,n)=>{hv(r)&&X9[r]||(hv(r)&&(X9[r]=new Date),lEe(e,t,r,n))},Ete=(e,t)=>()=>{if(e.isInitialized)t();else{const r=()=>{setTimeout(()=>{e.off("initialized",r)},0),t()};e.on("initialized",r)}},v3=(e,t,r)=>{e.loadNamespaces(t,Ete(e,r))},Y9=(e,t,r,n)=>{if(hv(r)&&(r=[r]),e.options.preload&&e.options.preload.indexOf(t)>-1)return v3(e,r,n);r.forEach(o=>{e.options.ns.indexOf(o)<0&&e.options.ns.push(o)}),e.loadLanguages(t,Ete(e,n))},cEe=(e,t,r={})=>!t.languages||!t.languages.length?(Ste(t,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:t.languages}),!0):t.hasLoadedNamespace(e,{lng:r.lng,precheck:(n,o)=>{if(r.bindI18n&&r.bindI18n.indexOf("languageChanging")>-1&&n.services.backendConnector.backend&&n.isLanguageChangingTo&&!o(n.isLanguageChangingTo,e))return!1}}),hv=e=>typeof e=="string",uEe=e=>typeof e=="object"&&e!==null,dEe=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,hEe={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"","&#169;":"","&reg;":"","&#174;":"","&hellip;":"","&#8230;":"","&#x2F;":"/","&#47;":"/"},fEe=e=>hEe[e],pEe=e=>e.replace(dEe,fEe);let _3={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:pEe};const mEe=(e={})=>{_3={..._3,...e}},gEe=()=>_3;let Tte;const yEe=e=>{Tte=e},vEe=()=>Tte,_Ee={type:"3rdParty",init(e){mEe(e.options.react),yEe(e)}},xEe=W.createContext();class bEe{constructor(){this.usedNamespaces={}}addUsedNamespaces(t){t.forEach(r=>{this.usedNamespaces[r]||(this.usedNamespaces[r]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const wEe=(e,t)=>hv(t)?t:uEe(t)&&hv(t.defaultValue)?t.defaultValue:Array.isArray(e)?e[e.length-1]:e,SEe={t:wEe,ready:!1},EEe=()=>()=>{},Ki=(e,t={})=>{var ae,ne,ie;const{i18n:r}=t,{i18n:n,defaultNS:o}=W.useContext(xEe)||{},l=r||n||vEe();l&&!l.reportNamespaces&&(l.reportNamespaces=new bEe),l||Ste(l,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const d=W.useMemo(()=>{var ee;return{...gEe(),...(ee=l==null?void 0:l.options)==null?void 0:ee.react,...t}},[l,t]),{useSuspense:i,keyPrefix:g}=d,_=o||((ae=l==null?void 0:l.options)==null?void 0:ae.defaultNS),S=hv(_)?[_]:_||["translation"],E=W.useMemo(()=>S,S);(ie=(ne=l==null?void 0:l.reportNamespaces)==null?void 0:ne.addUsedNamespaces)==null||ie.call(ne,E);const T=W.useRef(0),C=W.useCallback(ee=>{if(!l)return EEe;const{bindI18n:oe,bindI18nStore:de}=d,xe=()=>{T.current+=1,ee()};return oe&&l.on(oe,xe),de&&l.store.on(de,xe),()=>{oe&&oe.split(" ").forEach(we=>l.off(we,xe)),de&&de.split(" ").forEach(we=>l.store.off(we,xe))}},[l,d]),N=W.useRef(),I=W.useCallback(()=>{if(!l)return SEe;const ee=!!(l.isInitialized||l.initializedStoreOnce)&&E.every(Ce=>cEe(Ce,l,d)),oe=t.lng||l.language,de=T.current,xe=N.current;if(xe&&xe.ready===ee&&xe.lng===oe&&xe.keyPrefix===g&&xe.revision===de)return xe;const Ae={t:l.getFixedT(oe,d.nsMode==="fallback"?E:E[0],g),ready:ee,lng:oe,keyPrefix:g,revision:de};return N.current=Ae,Ae},[l,E,g,d,t.lng]),[j,D]=W.useState(0),{t:R,ready:F}=ute.useSyncExternalStore(C,I,I);W.useEffect(()=>{if(l&&!F&&!i){const ee=()=>D(oe=>oe+1);t.lng?Y9(l,t.lng,E,ee):v3(l,E,ee)}},[l,t.lng,E,F,i,j]);const B=l||{},U=W.useRef(null),Z=W.useRef(),J=ee=>{const oe=Object.getOwnPropertyDescriptors(ee);oe.__original&&delete oe.__original;const de=Object.create(Object.getPrototypeOf(ee),oe);if(!Object.prototype.hasOwnProperty.call(de,"__original"))try{Object.defineProperty(de,"__original",{value:ee,writable:!1,enumerable:!1,configurable:!1})}catch{}return de},te=W.useMemo(()=>{const ee=B,oe=ee==null?void 0:ee.language;let de=ee;ee&&(U.current&&U.current.__original===ee?Z.current!==oe?(de=J(ee),U.current=de,Z.current=oe):de=U.current:(de=J(ee),U.current=de,Z.current=oe));const xe=[R,de,F];return xe.t=R,xe.i18n=de,xe.ready=F,xe},[R,B,F,B.resolvedLanguage,B.language,B.languages]);if(l&&i&&!F)throw new Promise(ee=>{const oe=()=>ee();t.lng?Y9(l,t.lng,E,oe):v3(l,E,oe)});return te};var TEe=W.createContext(void 0);function UT(e){const t=W.useContext(TEe);return e||t||"ltr"}var HM="rovingFocusGroup.onEntryFocus",AEe={bubbles:!1,cancelable:!0},VT="RovingFocusGroup",[x3,Ate,PEe]=nI(VT),[CEe,OI]=Zs(VT,[PEe]),[OEe,kEe]=CEe(VT),Pte=W.forwardRef((e,t)=>m.jsx(x3.Provider,{scope:e.__scopeRovingFocusGroup,children:m.jsx(x3.Slot,{scope:e.__scopeRovingFocusGroup,children:m.jsx(IEe,{...e,ref:t})})}));Pte.displayName=VT;var IEe=W.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,orientation:n,loop:o=!1,dir:l,currentTabStopId:d,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:g,onEntryFocus:_,preventScrollOnEntryFocus:S=!1,...E}=e,T=W.useRef(null),C=fi(t,T),N=UT(l),[I,j]=Ru({prop:d,defaultProp:i??null,onChange:g,caller:VT}),[D,R]=W.useState(!1),F=Io(_),B=Ate(r),U=W.useRef(!1),[Z,J]=W.useState(0);return W.useEffect(()=>{const te=T.current;if(te)return te.addEventListener(HM,F),()=>te.removeEventListener(HM,F)},[F]),m.jsx(OEe,{scope:r,orientation:n,dir:N,loop:o,currentTabStopId:I,onItemFocus:W.useCallback(te=>j(te),[j]),onItemShiftTab:W.useCallback(()=>R(!0),[]),onFocusableItemAdd:W.useCallback(()=>J(te=>te+1),[]),onFocusableItemRemove:W.useCallback(()=>J(te=>te-1),[]),children:m.jsx(wn.div,{tabIndex:D||Z===0?-1:0,"data-orientation":n,...E,ref:C,style:{outline:"none",...e.style},onMouseDown:Rr(e.onMouseDown,()=>{U.current=!0}),onFocus:Rr(e.onFocus,te=>{const ae=!U.current;if(te.target===te.currentTarget&&ae&&!D){const ne=new CustomEvent(HM,AEe);if(te.currentTarget.dispatchEvent(ne),!ne.defaultPrevented){const ie=B().filter(we=>we.focusable),ee=ie.find(we=>we.active),oe=ie.find(we=>we.id===I),xe=[ee,oe,...ie].filter(Boolean).map(we=>we.ref.current);kte(xe,S)}}U.current=!1}),onBlur:Rr(e.onBlur,()=>R(!1))})})}),Cte="RovingFocusGroupItem",Ote=W.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,focusable:n=!0,active:o=!1,tabStopId:l,children:d,...i}=e,g=Kc(),_=l||g,S=kEe(Cte,r),E=S.currentTabStopId===_,T=Ate(r),{onFocusableItemAdd:C,onFocusableItemRemove:N,currentTabStopId:I}=S;return W.useEffect(()=>{if(n)return C(),()=>N()},[n,C,N]),m.jsx(x3.ItemSlot,{scope:r,id:_,focusable:n,active:o,children:m.jsx(wn.span,{tabIndex:E?0:-1,"data-orientation":S.orientation,...i,ref:t,onMouseDown:Rr(e.onMouseDown,j=>{n?S.onItemFocus(_):j.preventDefault()}),onFocus:Rr(e.onFocus,()=>S.onItemFocus(_)),onKeyDown:Rr(e.onKeyDown,j=>{if(j.key==="Tab"&&j.shiftKey){S.onItemShiftTab();return}if(j.target!==j.currentTarget)return;const D=NEe(j,S.orientation,S.dir);if(D!==void 0){if(j.metaKey||j.ctrlKey||j.altKey||j.shiftKey)return;j.preventDefault();let F=T().filter(B=>B.focusable).map(B=>B.ref.current);if(D==="last")F.reverse();else if(D==="prev"||D==="next"){D==="prev"&&F.reverse();const B=F.indexOf(j.currentTarget);F=S.loop?MEe(F,B+1):F.slice(B+1)}setTimeout(()=>kte(F))}}),children:typeof d=="function"?d({isCurrentTabStop:E,hasTabStop:I!=null}):d})})});Ote.displayName=Cte;var REe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function jEe(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function NEe(e,t,r){const n=jEe(e.key,r);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return REe[n]}function kte(e,t=!1){const r=document.activeElement;for(const n of e)if(n===r||(n.focus({preventScroll:t}),document.activeElement!==r))return}function MEe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var Ite=Pte,Rte=Ote,b3=["Enter"," "],DEe=["ArrowDown","PageUp","Home"],jte=["ArrowUp","PageDown","End"],LEe=[...DEe,...jte],FEe={ltr:[...b3,"ArrowRight"],rtl:[...b3,"ArrowLeft"]},zEe={ltr:["ArrowLeft"],rtl:["ArrowRight"]},qT="Menu",[IE,BEe,$Ee]=nI(qT),[Ov,Nte]=Zs(qT,[$Ee,rg,OI]),kI=rg(),Mte=OI(),[UEe,kv]=Ov(qT),[VEe,WT]=Ov(qT),Dte=e=>{const{__scopeMenu:t,open:r=!1,children:n,dir:o,onOpenChange:l,modal:d=!0}=e,i=kI(t),[g,_]=W.useState(null),S=W.useRef(!1),E=Io(l),T=UT(o);return W.useEffect(()=>{const C=()=>{S.current=!0,document.addEventListener("pointerdown",N,{capture:!0,once:!0}),document.addEventListener("pointermove",N,{capture:!0,once:!0})},N=()=>S.current=!1;return document.addEventListener("keydown",C,{capture:!0}),()=>{document.removeEventListener("keydown",C,{capture:!0}),document.removeEventListener("pointerdown",N,{capture:!0}),document.removeEventListener("pointermove",N,{capture:!0})}},[]),m.jsx(hI,{...i,children:m.jsx(UEe,{scope:t,open:r,onOpenChange:E,content:g,onContentChange:_,children:m.jsx(VEe,{scope:t,onClose:W.useCallback(()=>E(!1),[E]),isUsingKeyboardRef:S,dir:T,modal:d,children:n})})})};Dte.displayName=qT;var qEe="MenuAnchor",n4=W.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,o=kI(r);return m.jsx(NT,{...o,...n,ref:t})});n4.displayName=qEe;var i4="MenuPortal",[WEe,Lte]=Ov(i4,{forceMount:void 0}),Fte=e=>{const{__scopeMenu:t,forceMount:r,children:n,container:o}=e,l=kv(i4,t);return m.jsx(WEe,{scope:t,forceMount:r,children:m.jsx(_s,{present:r||l.open,children:m.jsx(bb,{asChild:!0,container:o,children:n})})})};Fte.displayName=i4;var Pu="MenuContent",[GEe,a4]=Ov(Pu),zte=W.forwardRef((e,t)=>{const r=Lte(Pu,e.__scopeMenu),{forceMount:n=r.forceMount,...o}=e,l=kv(Pu,e.__scopeMenu),d=WT(Pu,e.__scopeMenu);return m.jsx(IE.Provider,{scope:e.__scopeMenu,children:m.jsx(_s,{present:n||l.open,children:m.jsx(IE.Slot,{scope:e.__scopeMenu,children:d.modal?m.jsx(HEe,{...o,ref:t}):m.jsx(KEe,{...o,ref:t})})})})}),HEe=W.forwardRef((e,t)=>{const r=kv(Pu,e.__scopeMenu),n=W.useRef(null),o=fi(t,n);return W.useEffect(()=>{const l=n.current;if(l)return TI(l)},[]),m.jsx(o4,{...e,ref:o,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:Rr(e.onFocusOutside,l=>l.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),KEe=W.forwardRef((e,t)=>{const r=kv(Pu,e.__scopeMenu);return m.jsx(o4,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),ZEe=Vm("MenuContent.ScrollLock"),o4=W.forwardRef((e,t)=>{const{__scopeMenu:r,loop:n=!1,trapFocus:o,onOpenAutoFocus:l,onCloseAutoFocus:d,disableOutsidePointerEvents:i,onEntryFocus:g,onEscapeKeyDown:_,onPointerDownOutside:S,onFocusOutside:E,onInteractOutside:T,onDismiss:C,disableOutsideScroll:N,...I}=e,j=kv(Pu,r),D=WT(Pu,r),R=kI(r),F=Mte(r),B=BEe(r),[U,Z]=W.useState(null),J=W.useRef(null),te=fi(t,J,j.onContentChange),ae=W.useRef(0),ne=W.useRef(""),ie=W.useRef(0),ee=W.useRef(null),oe=W.useRef("right"),de=W.useRef(0),xe=N?LT:W.Fragment,we=N?{as:ZEe,allowPinchZoom:!0}:void 0,Ae=me=>{var qe,Ge;const Pe=ne.current+me,ye=B().filter(je=>!je.disabled),pe=document.activeElement,Ie=(qe=ye.find(je=>je.ref.current===pe))==null?void 0:qe.textValue,tt=ye.map(je=>je.textValue),Ze=sTe(tt,Pe,Ie),Le=(Ge=ye.find(je=>je.textValue===Ze))==null?void 0:Ge.ref.current;(function je(ot){ne.current=ot,window.clearTimeout(ae.current),ot!==""&&(ae.current=window.setTimeout(()=>je(""),1e3))})(Pe),Le&&setTimeout(()=>Le.focus())};W.useEffect(()=>()=>window.clearTimeout(ae.current),[]),SI();const Ce=W.useCallback(me=>{var ye,pe;return oe.current===((ye=ee.current)==null?void 0:ye.side)&&cTe(me,(pe=ee.current)==null?void 0:pe.area)},[]);return m.jsx(GEe,{scope:r,searchRef:ne,onItemEnter:W.useCallback(me=>{Ce(me)&&me.preventDefault()},[Ce]),onItemLeave:W.useCallback(me=>{var Pe;Ce(me)||((Pe=J.current)==null||Pe.focus(),Z(null))},[Ce]),onTriggerLeave:W.useCallback(me=>{Ce(me)&&me.preventDefault()},[Ce]),pointerGraceTimerRef:ie,onPointerGraceIntentChange:W.useCallback(me=>{ee.current=me},[]),children:m.jsx(xe,{...we,children:m.jsx(DT,{asChild:!0,trapped:o,onMountAutoFocus:Rr(l,me=>{var Pe;me.preventDefault(),(Pe=J.current)==null||Pe.focus({preventScroll:!0})}),onUnmountAutoFocus:d,children:m.jsx(Pv,{asChild:!0,disableOutsidePointerEvents:i,onEscapeKeyDown:_,onPointerDownOutside:S,onFocusOutside:E,onInteractOutside:T,onDismiss:C,children:m.jsx(Ite,{asChild:!0,...F,dir:D.dir,orientation:"vertical",loop:n,currentTabStopId:U,onCurrentTabStopIdChange:Z,onEntryFocus:Rr(g,me=>{D.isUsingKeyboardRef.current||me.preventDefault()}),preventScrollOnEntryFocus:!0,children:m.jsx(fI,{role:"menu","aria-orientation":"vertical","data-state":tre(j.open),"data-radix-menu-content":"",dir:D.dir,...R,...I,ref:te,style:{outline:"none",...I.style},onKeyDown:Rr(I.onKeyDown,me=>{const ye=me.target.closest("[data-radix-menu-content]")===me.currentTarget,pe=me.ctrlKey||me.altKey||me.metaKey,Ie=me.key.length===1;ye&&(me.key==="Tab"&&me.preventDefault(),!pe&&Ie&&Ae(me.key));const tt=J.current;if(me.target!==tt||!LEe.includes(me.key))return;me.preventDefault();const Le=B().filter(qe=>!qe.disabled).map(qe=>qe.ref.current);jte.includes(me.key)&&Le.reverse(),aTe(Le)}),onBlur:Rr(e.onBlur,me=>{me.currentTarget.contains(me.target)||(window.clearTimeout(ae.current),ne.current="")}),onPointerMove:Rr(e.onPointerMove,RE(me=>{const Pe=me.target,ye=de.current!==me.clientX;if(me.currentTarget.contains(Pe)&&ye){const pe=me.clientX>de.current?"right":"left";oe.current=pe,de.current=me.clientX}}))})})})})})})});zte.displayName=Pu;var XEe="MenuGroup",s4=W.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return m.jsx(wn.div,{role:"group",...n,ref:t})});s4.displayName=XEe;var YEe="MenuLabel",Bte=W.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return m.jsx(wn.div,{...n,ref:t})});Bte.displayName=YEe;var xO="MenuItem",J9="menu.itemSelect",II=W.forwardRef((e,t)=>{const{disabled:r=!1,onSelect:n,...o}=e,l=W.useRef(null),d=WT(xO,e.__scopeMenu),i=a4(xO,e.__scopeMenu),g=fi(t,l),_=W.useRef(!1),S=()=>{const E=l.current;if(!r&&E){const T=new CustomEvent(J9,{bubbles:!0,cancelable:!0});E.addEventListener(J9,C=>n==null?void 0:n(C),{once:!0}),uB(E,T),T.defaultPrevented?_.current=!1:d.onClose()}};return m.jsx($te,{...o,ref:g,disabled:r,onClick:Rr(e.onClick,S),onPointerDown:E=>{var T;(T=e.onPointerDown)==null||T.call(e,E),_.current=!0},onPointerUp:Rr(e.onPointerUp,E=>{var T;_.current||(T=E.currentTarget)==null||T.click()}),onKeyDown:Rr(e.onKeyDown,E=>{const T=i.searchRef.current!=="";r||T&&E.key===" "||b3.includes(E.key)&&(E.currentTarget.click(),E.preventDefault())})})});II.displayName=xO;var $te=W.forwardRef((e,t)=>{const{__scopeMenu:r,disabled:n=!1,textValue:o,...l}=e,d=a4(xO,r),i=Mte(r),g=W.useRef(null),_=fi(t,g),[S,E]=W.useState(!1),[T,C]=W.useState("");return W.useEffect(()=>{const N=g.current;N&&C((N.textContent??"").trim())},[l.children]),m.jsx(IE.ItemSlot,{scope:r,disabled:n,textValue:o??T,children:m.jsx(Rte,{asChild:!0,...i,focusable:!n,children:m.jsx(wn.div,{role:"menuitem","data-highlighted":S?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...l,ref:_,onPointerMove:Rr(e.onPointerMove,RE(N=>{n?d.onItemLeave(N):(d.onItemEnter(N),N.defaultPrevented||N.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Rr(e.onPointerLeave,RE(N=>d.onItemLeave(N))),onFocus:Rr(e.onFocus,()=>E(!0)),onBlur:Rr(e.onBlur,()=>E(!1))})})})}),JEe="MenuCheckboxItem",Ute=W.forwardRef((e,t)=>{const{checked:r=!1,onCheckedChange:n,...o}=e;return m.jsx(Hte,{scope:e.__scopeMenu,checked:r,children:m.jsx(II,{role:"menuitemcheckbox","aria-checked":bO(r)?"mixed":r,...o,ref:t,"data-state":c4(r),onSelect:Rr(o.onSelect,()=>n==null?void 0:n(bO(r)?!0:!r),{checkForDefaultPrevented:!1})})})});Ute.displayName=JEe;var Vte="MenuRadioGroup",[QEe,eTe]=Ov(Vte,{value:void 0,onValueChange:()=>{}}),qte=W.forwardRef((e,t)=>{const{value:r,onValueChange:n,...o}=e,l=Io(n);return m.jsx(QEe,{scope:e.__scopeMenu,value:r,onValueChange:l,children:m.jsx(s4,{...o,ref:t})})});qte.displayName=Vte;var Wte="MenuRadioItem",Gte=W.forwardRef((e,t)=>{const{value:r,...n}=e,o=eTe(Wte,e.__scopeMenu),l=r===o.value;return m.jsx(Hte,{scope:e.__scopeMenu,checked:l,children:m.jsx(II,{role:"menuitemradio","aria-checked":l,...n,ref:t,"data-state":c4(l),onSelect:Rr(n.onSelect,()=>{var d;return(d=o.onValueChange)==null?void 0:d.call(o,r)},{checkForDefaultPrevented:!1})})})});Gte.displayName=Wte;var l4="MenuItemIndicator",[Hte,tTe]=Ov(l4,{checked:!1}),Kte=W.forwardRef((e,t)=>{const{__scopeMenu:r,forceMount:n,...o}=e,l=tTe(l4,r);return m.jsx(_s,{present:n||bO(l.checked)||l.checked===!0,children:m.jsx(wn.span,{...o,ref:t,"data-state":c4(l.checked)})})});Kte.displayName=l4;var rTe="MenuSeparator",Zte=W.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return m.jsx(wn.div,{role:"separator","aria-orientation":"horizontal",...n,ref:t})});Zte.displayName=rTe;var nTe="MenuArrow",Xte=W.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,o=kI(r);return m.jsx(pI,{...o,...n,ref:t})});Xte.displayName=nTe;var iTe="MenuSub",[Het,Yte]=Ov(iTe),RS="MenuSubTrigger",Jte=W.forwardRef((e,t)=>{const r=kv(RS,e.__scopeMenu),n=WT(RS,e.__scopeMenu),o=Yte(RS,e.__scopeMenu),l=a4(RS,e.__scopeMenu),d=W.useRef(null),{pointerGraceTimerRef:i,onPointerGraceIntentChange:g}=l,_={__scopeMenu:e.__scopeMenu},S=W.useCallback(()=>{d.current&&window.clearTimeout(d.current),d.current=null},[]);return W.useEffect(()=>S,[S]),W.useEffect(()=>{const E=i.current;return()=>{window.clearTimeout(E),g(null)}},[i,g]),m.jsx(n4,{asChild:!0,..._,children:m.jsx($te,{id:o.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":o.contentId,"data-state":tre(r.open),...e,ref:rI(t,o.onTriggerChange),onClick:E=>{var T;(T=e.onClick)==null||T.call(e,E),!(e.disabled||E.defaultPrevented)&&(E.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:Rr(e.onPointerMove,RE(E=>{l.onItemEnter(E),!E.defaultPrevented&&!e.disabled&&!r.open&&!d.current&&(l.onPointerGraceIntentChange(null),d.current=window.setTimeout(()=>{r.onOpenChange(!0),S()},100))})),onPointerLeave:Rr(e.onPointerLeave,RE(E=>{var C,N;S();const T=(C=r.content)==null?void 0:C.getBoundingClientRect();if(T){const I=(N=r.content)==null?void 0:N.dataset.side,j=I==="right",D=j?-5:5,R=T[j?"left":"right"],F=T[j?"right":"left"];l.onPointerGraceIntentChange({area:[{x:E.clientX+D,y:E.clientY},{x:R,y:T.top},{x:F,y:T.top},{x:F,y:T.bottom},{x:R,y:T.bottom}],side:I}),window.clearTimeout(i.current),i.current=window.setTimeout(()=>l.onPointerGraceIntentChange(null),300)}else{if(l.onTriggerLeave(E),E.defaultPrevented)return;l.onPointerGraceIntentChange(null)}})),onKeyDown:Rr(e.onKeyDown,E=>{var C;const T=l.searchRef.current!=="";e.disabled||T&&E.key===" "||FEe[n.dir].includes(E.key)&&(r.onOpenChange(!0),(C=r.content)==null||C.focus(),E.preventDefault())})})})});Jte.displayName=RS;var Qte="MenuSubContent",ere=W.forwardRef((e,t)=>{const r=Lte(Pu,e.__scopeMenu),{forceMount:n=r.forceMount,...o}=e,l=kv(Pu,e.__scopeMenu),d=WT(Pu,e.__scopeMenu),i=Yte(Qte,e.__scopeMenu),g=W.useRef(null),_=fi(t,g);return m.jsx(IE.Provider,{scope:e.__scopeMenu,children:m.jsx(_s,{present:n||l.open,children:m.jsx(IE.Slot,{scope:e.__scopeMenu,children:m.jsx(o4,{id:i.contentId,"aria-labelledby":i.triggerId,...o,ref:_,align:"start",side:d.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:S=>{var E;d.isUsingKeyboardRef.current&&((E=g.current)==null||E.focus()),S.preventDefault()},onCloseAutoFocus:S=>S.preventDefault(),onFocusOutside:Rr(e.onFocusOutside,S=>{S.target!==i.trigger&&l.onOpenChange(!1)}),onEscapeKeyDown:Rr(e.onEscapeKeyDown,S=>{d.onClose(),S.preventDefault()}),onKeyDown:Rr(e.onKeyDown,S=>{var C;const E=S.currentTarget.contains(S.target),T=zEe[d.dir].includes(S.key);E&&T&&(l.onOpenChange(!1),(C=i.trigger)==null||C.focus(),S.preventDefault())})})})})})});ere.displayName=Qte;function tre(e){return e?"open":"closed"}function bO(e){return e==="indeterminate"}function c4(e){return bO(e)?"indeterminate":e?"checked":"unchecked"}function aTe(e){const t=document.activeElement;for(const r of e)if(r===t||(r.focus(),document.activeElement!==t))return}function oTe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}function sTe(e,t,r){const o=t.length>1&&Array.from(t).every(_=>_===t[0])?t[0]:t,l=r?e.indexOf(r):-1;let d=oTe(e,Math.max(l,0));o.length===1&&(d=d.filter(_=>_!==r));const g=d.find(_=>_.toLowerCase().startsWith(o.toLowerCase()));return g!==r?g:void 0}function lTe(e,t){const{x:r,y:n}=e;let o=!1;for(let l=0,d=t.length-1;l<t.length;d=l++){const i=t[l],g=t[d],_=i.x,S=i.y,E=g.x,T=g.y;S>n!=T>n&&r<(E-_)*(n-S)/(T-S)+_&&(o=!o)}return o}function cTe(e,t){if(!t)return!1;const r={x:e.clientX,y:e.clientY};return lTe(r,t)}function RE(e){return t=>t.pointerType==="mouse"?e(t):void 0}var uTe=Dte,dTe=n4,hTe=Fte,fTe=zte,pTe=s4,mTe=Bte,gTe=II,yTe=Ute,vTe=qte,_Te=Gte,xTe=Kte,bTe=Zte,wTe=Xte,STe=Jte,ETe=ere,RI="DropdownMenu",[TTe,Ket]=Zs(RI,[Nte]),Xl=Nte(),[ATe,rre]=TTe(RI),nre=e=>{const{__scopeDropdownMenu:t,children:r,dir:n,open:o,defaultOpen:l,onOpenChange:d,modal:i=!0}=e,g=Xl(t),_=W.useRef(null),[S,E]=Ru({prop:o,defaultProp:l??!1,onChange:d,caller:RI});return m.jsx(ATe,{scope:t,triggerId:Kc(),triggerRef:_,contentId:Kc(),open:S,onOpenChange:E,onOpenToggle:W.useCallback(()=>E(T=>!T),[E]),modal:i,children:m.jsx(uTe,{...g,open:S,onOpenChange:E,dir:n,modal:i,children:r})})};nre.displayName=RI;var ire="DropdownMenuTrigger",are=W.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,disabled:n=!1,...o}=e,l=rre(ire,r),d=Xl(r);return m.jsx(dTe,{asChild:!0,...d,children:m.jsx(wn.button,{type:"button",id:l.triggerId,"aria-haspopup":"menu","aria-expanded":l.open,"aria-controls":l.open?l.contentId:void 0,"data-state":l.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...o,ref:rI(t,l.triggerRef),onPointerDown:Rr(e.onPointerDown,i=>{!n&&i.button===0&&i.ctrlKey===!1&&(l.onOpenToggle(),l.open||i.preventDefault())}),onKeyDown:Rr(e.onKeyDown,i=>{n||(["Enter"," "].includes(i.key)&&l.onOpenToggle(),i.key==="ArrowDown"&&l.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(i.key)&&i.preventDefault())})})})});are.displayName=ire;var PTe="DropdownMenuPortal",ore=e=>{const{__scopeDropdownMenu:t,...r}=e,n=Xl(t);return m.jsx(hTe,{...n,...r})};ore.displayName=PTe;var sre="DropdownMenuContent",lre=W.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=rre(sre,r),l=Xl(r),d=W.useRef(!1);return m.jsx(fTe,{id:o.contentId,"aria-labelledby":o.triggerId,...l,...n,ref:t,onCloseAutoFocus:Rr(e.onCloseAutoFocus,i=>{var g;d.current||(g=o.triggerRef.current)==null||g.focus(),d.current=!1,i.preventDefault()}),onInteractOutside:Rr(e.onInteractOutside,i=>{const g=i.detail.originalEvent,_=g.button===0&&g.ctrlKey===!0,S=g.button===2||_;(!o.modal||S)&&(d.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});lre.displayName=sre;var CTe="DropdownMenuGroup",OTe=W.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Xl(r);return m.jsx(pTe,{...o,...n,ref:t})});OTe.displayName=CTe;var kTe="DropdownMenuLabel",cre=W.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Xl(r);return m.jsx(mTe,{...o,...n,ref:t})});cre.displayName=kTe;var ITe="DropdownMenuItem",ure=W.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Xl(r);return m.jsx(gTe,{...o,...n,ref:t})});ure.displayName=ITe;var RTe="DropdownMenuCheckboxItem",dre=W.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Xl(r);return m.jsx(yTe,{...o,...n,ref:t})});dre.displayName=RTe;var jTe="DropdownMenuRadioGroup",NTe=W.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Xl(r);return m.jsx(vTe,{...o,...n,ref:t})});NTe.displayName=jTe;var MTe="DropdownMenuRadioItem",hre=W.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Xl(r);return m.jsx(_Te,{...o,...n,ref:t})});hre.displayName=MTe;var DTe="DropdownMenuItemIndicator",fre=W.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Xl(r);return m.jsx(xTe,{...o,...n,ref:t})});fre.displayName=DTe;var LTe="DropdownMenuSeparator",pre=W.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Xl(r);return m.jsx(bTe,{...o,...n,ref:t})});pre.displayName=LTe;var FTe="DropdownMenuArrow",zTe=W.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Xl(r);return m.jsx(wTe,{...o,...n,ref:t})});zTe.displayName=FTe;var BTe="DropdownMenuSubTrigger",mre=W.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Xl(r);return m.jsx(STe,{...o,...n,ref:t})});mre.displayName=BTe;var $Te="DropdownMenuSubContent",gre=W.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Xl(r);return m.jsx(ETe,{...o,...n,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});gre.displayName=$Te;var UTe=nre,VTe=are,qTe=ore,yre=lre,vre=cre,_re=ure,xre=dre,bre=hre,wre=fre,Sre=pre,Ere=mre,Tre=gre;const Iv=UTe,Rv=VTe,WTe=W.forwardRef(({className:e,inset:t,children:r,...n},o)=>m.jsxs(Ere,{ref:o,className:yr("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",t&&"pl-8",e),...n,children:[r,m.jsx(pB,{className:"ml-auto h-4 w-4"})]}));WTe.displayName=Ere.displayName;const GTe=W.forwardRef(({className:e,...t},r)=>m.jsx(Tre,{ref:r,className:yr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));GTe.displayName=Tre.displayName;const ag=W.forwardRef(({className:e,sideOffset:t=4,...r},n)=>m.jsx(qTe,{children:m.jsx(yre,{ref:n,sideOffset:t,className:yr("z-[100] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));ag.displayName=yre.displayName;const Oa=W.forwardRef(({className:e,inset:t,...r},n)=>m.jsx(_re,{ref:n,className:yr("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t&&"pl-8",e),...r}));Oa.displayName=_re.displayName;const HTe=W.forwardRef(({className:e,children:t,checked:r,...n},o)=>m.jsxs(xre,{ref:o,className:yr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),checked:r,...n,children:[m.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:m.jsx(wre,{children:m.jsx(Af,{className:"h-4 w-4"})})}),t]}));HTe.displayName=xre.displayName;const KTe=W.forwardRef(({className:e,children:t,...r},n)=>m.jsxs(bre,{ref:n,className:yr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...r,children:[m.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:m.jsx(wre,{children:m.jsx(vye,{className:"h-2 w-2 fill-current"})})}),t]}));KTe.displayName=bre.displayName;const u4=W.forwardRef(({className:e,inset:t,...r},n)=>m.jsx(vre,{ref:n,className:yr("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...r}));u4.displayName=vre.displayName;const Pf=W.forwardRef(({className:e,...t},r)=>m.jsx(Sre,{ref:r,className:yr("-mx-1 my-1 h-px bg-muted",e),...t}));Pf.displayName=Sre.displayName;const d4=()=>{const{user:e}=Fi();return Sa(),Li({queryKey:["profile",e==null?void 0:e.id],queryFn:async()=>{if(!e)return null;const{data:t,error:r}=await qt.from("profiles").select("*").eq("id",e.id).single();if(r)throw r;return t},enabled:!!e})},ZTe=()=>{const{user:e}=Fi(),{toast:t}=Sa(),r=Ma();return Ya({mutationFn:async({display_name:n,phone:o,avatar_url:l,language_preference:d})=>{if(!e)throw new Error("User not authenticated");const{data:i,error:g}=await qt.from("profiles").update({display_name:n,phone:o,avatar_url:l,language_preference:d}).eq("id",e.id).select().single();if(g)throw g;return i},onSuccess:()=>{r.invalidateQueries({queryKey:["profile"]}),t({title:"Success",description:"Profile updated successfully"})},onError:()=>{t({title:"Error",description:"Failed to update profile",variant:"destructive"})}})},XTe=()=>{const{user:e}=Fi(),t=Ma();return Ya({mutationFn:async r=>{if(!e)return;const{error:n}=await qt.from("profiles").update({language_preference:r}).eq("id",e.id);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["profile"]})}})},YTe=()=>{const{user:e}=Fi(),{toast:t}=Sa();return Ya({mutationFn:async r=>{if(!e)throw new Error("User not authenticated");const n=r.name.split(".").pop(),o=`${Date.now()}.${n}`,l=`${e.id}/${o}`,{error:d}=await qt.storage.from("avatars").upload(l,r,{upsert:!0});if(d)throw d;const{data:{publicUrl:i}}=qt.storage.from("avatars").getPublicUrl(l);return i},onError:()=>{t({title:"Error",description:"Failed to upload avatar",variant:"destructive"})}})},KM=[{code:"en",name:"English",flag:""},{code:"zh",name:"",flag:""},{code:"pt",name:"Portugus",flag:""}],JTe=()=>{const{i18n:e}=Ki(),{user:t}=Fi(),r=XTe(),n=KM.find(l=>l.code===e.language)||KM[0],o=l=>{e.changeLanguage(l),t&&r.mutate(l)};return m.jsxs(Iv,{children:[m.jsx(Rv,{asChild:!0,children:m.jsx(ir,{variant:"ghost",size:"icon",title:"Change Language",children:m.jsx(C0,{className:"w-5 h-5"})})}),m.jsx(ag,{align:"end",children:KM.map(l=>m.jsxs(Oa,{onClick:()=>o(l.code),className:`cursor-pointer ${n.code===l.code?"bg-accent":""}`,children:[m.jsx("span",{className:"mr-2",children:l.flag}),m.jsx("span",{children:l.name})]},l.code))})]})},nu=()=>{const{user:e}=Fi(),{data:t,isLoading:r}=Li({queryKey:["user-roles",e==null?void 0:e.id],queryFn:async()=>{if(!e)return"user";const{data:i,error:g}=await qt.from("user_roles").select("role").eq("user_id",e.id).single();if(g)throw g;return i.role},enabled:!!e});return{role:t??"user",hasRole:i=>t===i,isAdmin:t==="admin",isSupervisor:t==="supervisor",isMerchant:t==="merchant",isLoading:r}},QTe=wb("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function jn({className:e,variant:t,...r}){return m.jsx("div",{className:yr(QTe({variant:t}),e),...r})}function w3(e,[t,r]){return Math.min(r,Math.max(t,e))}function e2e(e,t){return W.useReducer((r,n)=>t[r][n]??r,e)}var h4="ScrollArea",[Are,Zet]=Zs(h4),[t2e,Mu]=Are(h4),Pre=W.forwardRef((e,t)=>{const{__scopeScrollArea:r,type:n="hover",dir:o,scrollHideDelay:l=600,...d}=e,[i,g]=W.useState(null),[_,S]=W.useState(null),[E,T]=W.useState(null),[C,N]=W.useState(null),[I,j]=W.useState(null),[D,R]=W.useState(0),[F,B]=W.useState(0),[U,Z]=W.useState(!1),[J,te]=W.useState(!1),ae=fi(t,ie=>g(ie)),ne=UT(o);return m.jsx(t2e,{scope:r,type:n,dir:ne,scrollHideDelay:l,scrollArea:i,viewport:_,onViewportChange:S,content:E,onContentChange:T,scrollbarX:C,onScrollbarXChange:N,scrollbarXEnabled:U,onScrollbarXEnabledChange:Z,scrollbarY:I,onScrollbarYChange:j,scrollbarYEnabled:J,onScrollbarYEnabledChange:te,onCornerWidthChange:R,onCornerHeightChange:B,children:m.jsx(wn.div,{dir:ne,...d,ref:ae,style:{position:"relative","--radix-scroll-area-corner-width":D+"px","--radix-scroll-area-corner-height":F+"px",...e.style}})})});Pre.displayName=h4;var Cre="ScrollAreaViewport",Ore=W.forwardRef((e,t)=>{const{__scopeScrollArea:r,children:n,nonce:o,...l}=e,d=Mu(Cre,r),i=W.useRef(null),g=fi(t,i,d.onViewportChange);return m.jsxs(m.Fragment,{children:[m.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:o}),m.jsx(wn.div,{"data-radix-scroll-area-viewport":"",...l,ref:g,style:{overflowX:d.scrollbarXEnabled?"scroll":"hidden",overflowY:d.scrollbarYEnabled?"scroll":"hidden",...e.style},children:m.jsx("div",{ref:d.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});Ore.displayName=Cre;var jh="ScrollAreaScrollbar",f4=W.forwardRef((e,t)=>{const{forceMount:r,...n}=e,o=Mu(jh,e.__scopeScrollArea),{onScrollbarXEnabledChange:l,onScrollbarYEnabledChange:d}=o,i=e.orientation==="horizontal";return W.useEffect(()=>(i?l(!0):d(!0),()=>{i?l(!1):d(!1)}),[i,l,d]),o.type==="hover"?m.jsx(r2e,{...n,ref:t,forceMount:r}):o.type==="scroll"?m.jsx(n2e,{...n,ref:t,forceMount:r}):o.type==="auto"?m.jsx(kre,{...n,ref:t,forceMount:r}):o.type==="always"?m.jsx(p4,{...n,ref:t}):null});f4.displayName=jh;var r2e=W.forwardRef((e,t)=>{const{forceMount:r,...n}=e,o=Mu(jh,e.__scopeScrollArea),[l,d]=W.useState(!1);return W.useEffect(()=>{const i=o.scrollArea;let g=0;if(i){const _=()=>{window.clearTimeout(g),d(!0)},S=()=>{g=window.setTimeout(()=>d(!1),o.scrollHideDelay)};return i.addEventListener("pointerenter",_),i.addEventListener("pointerleave",S),()=>{window.clearTimeout(g),i.removeEventListener("pointerenter",_),i.removeEventListener("pointerleave",S)}}},[o.scrollArea,o.scrollHideDelay]),m.jsx(_s,{present:r||l,children:m.jsx(kre,{"data-state":l?"visible":"hidden",...n,ref:t})})}),n2e=W.forwardRef((e,t)=>{const{forceMount:r,...n}=e,o=Mu(jh,e.__scopeScrollArea),l=e.orientation==="horizontal",d=NI(()=>g("SCROLL_END"),100),[i,g]=e2e("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return W.useEffect(()=>{if(i==="idle"){const _=window.setTimeout(()=>g("HIDE"),o.scrollHideDelay);return()=>window.clearTimeout(_)}},[i,o.scrollHideDelay,g]),W.useEffect(()=>{const _=o.viewport,S=l?"scrollLeft":"scrollTop";if(_){let E=_[S];const T=()=>{const C=_[S];E!==C&&(g("SCROLL"),d()),E=C};return _.addEventListener("scroll",T),()=>_.removeEventListener("scroll",T)}},[o.viewport,l,g,d]),m.jsx(_s,{present:r||i!=="hidden",children:m.jsx(p4,{"data-state":i==="hidden"?"hidden":"visible",...n,ref:t,onPointerEnter:Rr(e.onPointerEnter,()=>g("POINTER_ENTER")),onPointerLeave:Rr(e.onPointerLeave,()=>g("POINTER_LEAVE"))})})}),kre=W.forwardRef((e,t)=>{const r=Mu(jh,e.__scopeScrollArea),{forceMount:n,...o}=e,[l,d]=W.useState(!1),i=e.orientation==="horizontal",g=NI(()=>{if(r.viewport){const _=r.viewport.offsetWidth<r.viewport.scrollWidth,S=r.viewport.offsetHeight<r.viewport.scrollHeight;d(i?_:S)}},10);return L0(r.viewport,g),L0(r.content,g),m.jsx(_s,{present:n||l,children:m.jsx(p4,{"data-state":l?"visible":"hidden",...o,ref:t})})}),p4=W.forwardRef((e,t)=>{const{orientation:r="vertical",...n}=e,o=Mu(jh,e.__scopeScrollArea),l=W.useRef(null),d=W.useRef(0),[i,g]=W.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),_=Mre(i.viewport,i.content),S={...n,sizes:i,onSizesChange:g,hasThumb:_>0&&_<1,onThumbChange:T=>l.current=T,onThumbPointerUp:()=>d.current=0,onThumbPointerDown:T=>d.current=T};function E(T,C){return c2e(T,d.current,i,C)}return r==="horizontal"?m.jsx(i2e,{...S,ref:t,onThumbPositionChange:()=>{if(o.viewport&&l.current){const T=o.viewport.scrollLeft,C=Q9(T,i,o.dir);l.current.style.transform=`translate3d(${C}px, 0, 0)`}},onWheelScroll:T=>{o.viewport&&(o.viewport.scrollLeft=T)},onDragScroll:T=>{o.viewport&&(o.viewport.scrollLeft=E(T,o.dir))}}):r==="vertical"?m.jsx(a2e,{...S,ref:t,onThumbPositionChange:()=>{if(o.viewport&&l.current){const T=o.viewport.scrollTop,C=Q9(T,i);l.current.style.transform=`translate3d(0, ${C}px, 0)`}},onWheelScroll:T=>{o.viewport&&(o.viewport.scrollTop=T)},onDragScroll:T=>{o.viewport&&(o.viewport.scrollTop=E(T))}}):null}),i2e=W.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...o}=e,l=Mu(jh,e.__scopeScrollArea),[d,i]=W.useState(),g=W.useRef(null),_=fi(t,g,l.onScrollbarXChange);return W.useEffect(()=>{g.current&&i(getComputedStyle(g.current))},[g]),m.jsx(Rre,{"data-orientation":"horizontal",...o,ref:_,sizes:r,style:{bottom:0,left:l.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:l.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":jI(r)+"px",...e.style},onThumbPointerDown:S=>e.onThumbPointerDown(S.x),onDragScroll:S=>e.onDragScroll(S.x),onWheelScroll:(S,E)=>{if(l.viewport){const T=l.viewport.scrollLeft+S.deltaX;e.onWheelScroll(T),Lre(T,E)&&S.preventDefault()}},onResize:()=>{g.current&&l.viewport&&d&&n({content:l.viewport.scrollWidth,viewport:l.viewport.offsetWidth,scrollbar:{size:g.current.clientWidth,paddingStart:SO(d.paddingLeft),paddingEnd:SO(d.paddingRight)}})}})}),a2e=W.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...o}=e,l=Mu(jh,e.__scopeScrollArea),[d,i]=W.useState(),g=W.useRef(null),_=fi(t,g,l.onScrollbarYChange);return W.useEffect(()=>{g.current&&i(getComputedStyle(g.current))},[g]),m.jsx(Rre,{"data-orientation":"vertical",...o,ref:_,sizes:r,style:{top:0,right:l.dir==="ltr"?0:void 0,left:l.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":jI(r)+"px",...e.style},onThumbPointerDown:S=>e.onThumbPointerDown(S.y),onDragScroll:S=>e.onDragScroll(S.y),onWheelScroll:(S,E)=>{if(l.viewport){const T=l.viewport.scrollTop+S.deltaY;e.onWheelScroll(T),Lre(T,E)&&S.preventDefault()}},onResize:()=>{g.current&&l.viewport&&d&&n({content:l.viewport.scrollHeight,viewport:l.viewport.offsetHeight,scrollbar:{size:g.current.clientHeight,paddingStart:SO(d.paddingTop),paddingEnd:SO(d.paddingBottom)}})}})}),[o2e,Ire]=Are(jh),Rre=W.forwardRef((e,t)=>{const{__scopeScrollArea:r,sizes:n,hasThumb:o,onThumbChange:l,onThumbPointerUp:d,onThumbPointerDown:i,onThumbPositionChange:g,onDragScroll:_,onWheelScroll:S,onResize:E,...T}=e,C=Mu(jh,r),[N,I]=W.useState(null),j=fi(t,ae=>I(ae)),D=W.useRef(null),R=W.useRef(""),F=C.viewport,B=n.content-n.viewport,U=Io(S),Z=Io(g),J=NI(E,10);function te(ae){if(D.current){const ne=ae.clientX-D.current.left,ie=ae.clientY-D.current.top;_({x:ne,y:ie})}}return W.useEffect(()=>{const ae=ne=>{const ie=ne.target;(N==null?void 0:N.contains(ie))&&U(ne,B)};return document.addEventListener("wheel",ae,{passive:!1}),()=>document.removeEventListener("wheel",ae,{passive:!1})},[F,N,B,U]),W.useEffect(Z,[n,Z]),L0(N,J),L0(C.content,J),m.jsx(o2e,{scope:r,scrollbar:N,hasThumb:o,onThumbChange:Io(l),onThumbPointerUp:Io(d),onThumbPositionChange:Z,onThumbPointerDown:Io(i),children:m.jsx(wn.div,{...T,ref:j,style:{position:"absolute",...T.style},onPointerDown:Rr(e.onPointerDown,ae=>{ae.button===0&&(ae.target.setPointerCapture(ae.pointerId),D.current=N.getBoundingClientRect(),R.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",C.viewport&&(C.viewport.style.scrollBehavior="auto"),te(ae))}),onPointerMove:Rr(e.onPointerMove,te),onPointerUp:Rr(e.onPointerUp,ae=>{const ne=ae.target;ne.hasPointerCapture(ae.pointerId)&&ne.releasePointerCapture(ae.pointerId),document.body.style.webkitUserSelect=R.current,C.viewport&&(C.viewport.style.scrollBehavior=""),D.current=null})})})}),wO="ScrollAreaThumb",jre=W.forwardRef((e,t)=>{const{forceMount:r,...n}=e,o=Ire(wO,e.__scopeScrollArea);return m.jsx(_s,{present:r||o.hasThumb,children:m.jsx(s2e,{ref:t,...n})})}),s2e=W.forwardRef((e,t)=>{const{__scopeScrollArea:r,style:n,...o}=e,l=Mu(wO,r),d=Ire(wO,r),{onThumbPositionChange:i}=d,g=fi(t,E=>d.onThumbChange(E)),_=W.useRef(void 0),S=NI(()=>{_.current&&(_.current(),_.current=void 0)},100);return W.useEffect(()=>{const E=l.viewport;if(E){const T=()=>{if(S(),!_.current){const C=u2e(E,i);_.current=C,i()}};return i(),E.addEventListener("scroll",T),()=>E.removeEventListener("scroll",T)}},[l.viewport,S,i]),m.jsx(wn.div,{"data-state":d.hasThumb?"visible":"hidden",...o,ref:g,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:Rr(e.onPointerDownCapture,E=>{const C=E.target.getBoundingClientRect(),N=E.clientX-C.left,I=E.clientY-C.top;d.onThumbPointerDown({x:N,y:I})}),onPointerUp:Rr(e.onPointerUp,d.onThumbPointerUp)})});jre.displayName=wO;var m4="ScrollAreaCorner",Nre=W.forwardRef((e,t)=>{const r=Mu(m4,e.__scopeScrollArea),n=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&n?m.jsx(l2e,{...e,ref:t}):null});Nre.displayName=m4;var l2e=W.forwardRef((e,t)=>{const{__scopeScrollArea:r,...n}=e,o=Mu(m4,r),[l,d]=W.useState(0),[i,g]=W.useState(0),_=!!(l&&i);return L0(o.scrollbarX,()=>{var E;const S=((E=o.scrollbarX)==null?void 0:E.offsetHeight)||0;o.onCornerHeightChange(S),g(S)}),L0(o.scrollbarY,()=>{var E;const S=((E=o.scrollbarY)==null?void 0:E.offsetWidth)||0;o.onCornerWidthChange(S),d(S)}),_?m.jsx(wn.div,{...n,ref:t,style:{width:l,height:i,position:"absolute",right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function SO(e){return e?parseInt(e,10):0}function Mre(e,t){const r=e/t;return isNaN(r)?0:r}function jI(e){const t=Mre(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,n=(e.scrollbar.size-r)*t;return Math.max(n,18)}function c2e(e,t,r,n="ltr"){const o=jI(r),l=o/2,d=t||l,i=o-d,g=r.scrollbar.paddingStart+d,_=r.scrollbar.size-r.scrollbar.paddingEnd-i,S=r.content-r.viewport,E=n==="ltr"?[0,S]:[S*-1,0];return Dre([g,_],E)(e)}function Q9(e,t,r="ltr"){const n=jI(t),o=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,l=t.scrollbar.size-o,d=t.content-t.viewport,i=l-n,g=r==="ltr"?[0,d]:[d*-1,0],_=w3(e,g);return Dre([0,d],[0,i])(_)}function Dre(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const n=(t[1]-t[0])/(e[1]-e[0]);return t[0]+n*(r-e[0])}}function Lre(e,t){return e>0&&e<t}var u2e=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},n=0;return function o(){const l={left:e.scrollLeft,top:e.scrollTop},d=r.left!==l.left,i=r.top!==l.top;(d||i)&&t(),r=l,n=window.requestAnimationFrame(o)}(),()=>window.cancelAnimationFrame(n)};function NI(e,t){const r=Io(e),n=W.useRef(0);return W.useEffect(()=>()=>window.clearTimeout(n.current),[]),W.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(r,t)},[r,t])}function L0(e,t){const r=Io(t);Ro(()=>{let n=0;if(e){const o=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(r)});return o.observe(e),()=>{window.cancelAnimationFrame(n),o.unobserve(e)}}},[e,r])}var Fre=Pre,d2e=Ore,h2e=Nre;const fv=W.forwardRef(({className:e,children:t,...r},n)=>m.jsxs(Fre,{ref:n,className:yr("relative overflow-hidden",e),...r,children:[m.jsx(d2e,{className:"h-full w-full rounded-[inherit]",children:t}),m.jsx(zre,{}),m.jsx(h2e,{})]}));fv.displayName=Fre.displayName;const zre=W.forwardRef(({className:e,orientation:t="vertical",...r},n)=>m.jsx(f4,{ref:n,orientation:t,className:yr("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...r,children:m.jsx(jre,{className:"relative flex-1 rounded-full bg-border"})}));zre.displayName=f4.displayName;const{slice:f2e,forEach:p2e}=[];function m2e(e){return p2e.call(f2e.call(arguments,1),t=>{if(t)for(const r in t)e[r]===void 0&&(e[r]=t[r])}),e}function g2e(e){return typeof e!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(r=>r.test(e))}const eW=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,y2e=function(e,t){const n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},o=encodeURIComponent(t);let l=`${e}=${o}`;if(n.maxAge>0){const d=n.maxAge-0;if(Number.isNaN(d))throw new Error("maxAge should be a Number");l+=`; Max-Age=${Math.floor(d)}`}if(n.domain){if(!eW.test(n.domain))throw new TypeError("option domain is invalid");l+=`; Domain=${n.domain}`}if(n.path){if(!eW.test(n.path))throw new TypeError("option path is invalid");l+=`; Path=${n.path}`}if(n.expires){if(typeof n.expires.toUTCString!="function")throw new TypeError("option expires is invalid");l+=`; Expires=${n.expires.toUTCString()}`}if(n.httpOnly&&(l+="; HttpOnly"),n.secure&&(l+="; Secure"),n.sameSite)switch(typeof n.sameSite=="string"?n.sameSite.toLowerCase():n.sameSite){case!0:l+="; SameSite=Strict";break;case"lax":l+="; SameSite=Lax";break;case"strict":l+="; SameSite=Strict";break;case"none":l+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return n.partitioned&&(l+="; Partitioned"),l},tW={create(e,t,r,n){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};r&&(o.expires=new Date,o.expires.setTime(o.expires.getTime()+r*60*1e3)),n&&(o.domain=n),document.cookie=y2e(e,t,o)},read(e){const t=`${e}=`,r=document.cookie.split(";");for(let n=0;n<r.length;n++){let o=r[n];for(;o.charAt(0)===" ";)o=o.substring(1,o.length);if(o.indexOf(t)===0)return o.substring(t.length,o.length)}return null},remove(e,t){this.create(e,"",-1,t)}};var v2e={name:"cookie",lookup(e){let{lookupCookie:t}=e;if(t&&typeof document<"u")return tW.read(t)||void 0},cacheUserLanguage(e,t){let{lookupCookie:r,cookieMinutes:n,cookieDomain:o,cookieOptions:l}=t;r&&typeof document<"u"&&tW.create(r,e,n,o,l)}},_2e={name:"querystring",lookup(e){var n;let{lookupQuerystring:t}=e,r;if(typeof window<"u"){let{search:o}=window.location;!window.location.search&&((n=window.location.hash)==null?void 0:n.indexOf("?"))>-1&&(o=window.location.hash.substring(window.location.hash.indexOf("?")));const d=o.substring(1).split("&");for(let i=0;i<d.length;i++){const g=d[i].indexOf("=");g>0&&d[i].substring(0,g)===t&&(r=d[i].substring(g+1))}}return r}},x2e={name:"hash",lookup(e){var o;let{lookupHash:t,lookupFromHashIndex:r}=e,n;if(typeof window<"u"){const{hash:l}=window.location;if(l&&l.length>2){const d=l.substring(1);if(t){const i=d.split("&");for(let g=0;g<i.length;g++){const _=i[g].indexOf("=");_>0&&i[g].substring(0,_)===t&&(n=i[g].substring(_+1))}}if(n)return n;if(!n&&r>-1){const i=l.match(/\/([a-zA-Z-]*)/g);return Array.isArray(i)?(o=i[typeof r=="number"?r:0])==null?void 0:o.replace("/",""):void 0}}}return n}};let _x=null;const rW=()=>{if(_x!==null)return _x;try{if(_x=typeof window<"u"&&window.localStorage!==null,!_x)return!1;const e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch{_x=!1}return _x};var b2e={name:"localStorage",lookup(e){let{lookupLocalStorage:t}=e;if(t&&rW())return window.localStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupLocalStorage:r}=t;r&&rW()&&window.localStorage.setItem(r,e)}};let xx=null;const nW=()=>{if(xx!==null)return xx;try{if(xx=typeof window<"u"&&window.sessionStorage!==null,!xx)return!1;const e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch{xx=!1}return xx};var w2e={name:"sessionStorage",lookup(e){let{lookupSessionStorage:t}=e;if(t&&nW())return window.sessionStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupSessionStorage:r}=t;r&&nW()&&window.sessionStorage.setItem(r,e)}},S2e={name:"navigator",lookup(e){const t=[];if(typeof navigator<"u"){const{languages:r,userLanguage:n,language:o}=navigator;if(r)for(let l=0;l<r.length;l++)t.push(r[l]);n&&t.push(n),o&&t.push(o)}return t.length>0?t:void 0}},E2e={name:"htmlTag",lookup(e){let{htmlTag:t}=e,r;const n=t||(typeof document<"u"?document.documentElement:null);return n&&typeof n.getAttribute=="function"&&(r=n.getAttribute("lang")),r}},T2e={name:"path",lookup(e){var o;let{lookupFromPathIndex:t}=e;if(typeof window>"u")return;const r=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(r)?(o=r[typeof t=="number"?t:0])==null?void 0:o.replace("/",""):void 0}},A2e={name:"subdomain",lookup(e){var o,l;let{lookupFromSubdomainIndex:t}=e;const r=typeof t=="number"?t+1:1,n=typeof window<"u"&&((l=(o=window.location)==null?void 0:o.hostname)==null?void 0:l.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(n)return n[r]}};let Bre=!1;try{document.cookie,Bre=!0}catch{}const $re=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];Bre||$re.splice(1,1);const P2e=()=>({order:$re,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:e=>e});class Ure{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(t,r)}init(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=t,this.options=m2e(r,this.options||{},P2e()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=o=>o.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=n,this.addDetector(v2e),this.addDetector(_2e),this.addDetector(b2e),this.addDetector(w2e),this.addDetector(S2e),this.addDetector(E2e),this.addDetector(T2e),this.addDetector(A2e),this.addDetector(x2e)}addDetector(t){return this.detectors[t.name]=t,this}detect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,r=[];return t.forEach(n=>{if(this.detectors[n]){let o=this.detectors[n].lookup(this.options);o&&typeof o=="string"&&(o=[o]),o&&(r=r.concat(o))}}),r=r.filter(n=>n!=null&&!g2e(n)).map(n=>this.options.convertDetectedLanguage(n)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?r:r.length>0?r[0]:null}cacheUserLanguage(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;r&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(t)>-1||r.forEach(n=>{this.detectors[n]&&this.detectors[n].cacheUserLanguage(t,this.options)}))}}Ure.type="languageDetector";const C2e={en:{translation:{"nav.brandName":"Xiaoxiong Market","nav.map":"Home","nav.mapView":"Private Map","nav.restaurants":"Restaurants","nav.activities":"Activities","nav.profile":"Profile","nav.signIn":"Sign In","nav.signOut":"Sign Out","nav.myAccount":"My Account","nav.admin":"Admin Panel","nav.manageRestaurants":"Manage Restaurants","nav.joinUs":"Restaurant Join","map.subtitle":"Explore nearby featured restaurants","home.hero.brandName":"Xiaoxiong Market","home.hero.title":"Discover Nearby Cuisine","home.hero.subtitle":"Your Culinary Journey Starts Here","home.hero.description":"Explore curated restaurants across cities, join exciting food events, and connect with fellow food lovers;","home.hero.exploreBtn":"Explore Restaurants","home.hero.activitiesBtn":"View Activities","home.features.title":"Why Choose Us?","home.features.description":"Discover Cuisine; Share Experiences; Join Activities;","home.features.map.title":"Smart Map","home.features.map.desc":"Find nearby restaurants with our intelligent location-based search and interactive map view;","home.features.reviews.title":"Trusted Reviews","home.features.reviews.desc":"Read authentic reviews and ratings from verified diners to make informed decisions;","home.features.events.title":"Exclusive Events","home.features.events.desc":"Join special dining events, food festivals, and connect with the culinary community;","home.cta.title":"Ready to Start?","home.cta.description":"Join Xiaoxiong Market and reach thousands of food lovers. Grow your business with us;","home.cta.button":"Restaurant Join","home.stats.delivery":"Take Away","home.stats.reservation":"Reservation","restaurants.title":"Restaurants","restaurants.search":"Search name, address, postal code...","restaurants.noResults":"No restaurants found","restaurants.noResultsDesc":"Try adjusting your search or filters","restaurants.viewDetails":"View Details","restaurants.addToFavorite":"Add to favorites","restaurants.removeFromFavorite":"Remove from favorites","restaurants.mustSignIn":"Please sign in to favorite restaurants","restaurants.listView":"List View","restaurants.mapView":"Map View","restaurants.sortByDistance":"Sort by Distance","restaurants.sortedByDistance":"Sorted by distance","restaurants.radius":"Radius","restaurants.radius1km":"1 km","restaurants.radius3km":"3 km","restaurants.radius5km":"5 km","restaurants.radius10km":"10 km","restaurants.radius20km":"20 km","restaurants.allRestaurants":"All Restaurants","restaurants.getLocation":"Get My Location","restaurants.locationEnabled":"Location Enabled","restaurants.directions":"Get Directions","restaurants.distanceAway":"{{distance}} km away","restaurants.restaurantTypes":"Restaurant Types","restaurant.address":"Address","restaurant.phone":"Phone","restaurant.hours":"Hours","restaurant.today":"Today","restaurant.closed":"Closed","restaurant.dayMon":"Mon","restaurant.dayTue":"Tue","restaurant.dayWed":"Wed","restaurant.dayThu":"Thu","restaurant.dayFri":"Fri","restaurant.daySat":"Sat","restaurant.daySun":"Sun","restaurant.website":"Website","restaurant.visitWebsite":"Visit Website","restaurant.getDirections":"Get Directions","restaurant.callNow":"Call Now","restaurant.joinPrivate":"Join Private Domain","restaurant.reviews":"Reviews","restaurant.addReview":"Add Review","restaurant.rating":"Rating","restaurant.edited":"Edited","restaurant.reply":"Reply","restaurant.writeComment":"Write a comment...","restaurant.writeReply":"Write a reply...","restaurant.postComment":"Post Comment","restaurant.signInToComment":"Please sign in to comment","restaurant.signInToRate":"Please sign in to rate this restaurant","restaurant.noComments":"No comments yet. Be the first to share your experience!","restaurant.confirmDelete":"Are you sure you want to delete this comment?","restaurant.ratingsCount":"ratings","restaurant.yourRating":"Your rating","restaurant.rateThisRestaurant":"Rate this restaurant","restaurant.photoGallery":"Photo Gallery","restaurant.addImage":"Add Image","restaurant.imageUploadFailed":"Failed to upload image","restaurant.imageTooLarge":"Image size must be less than 5MB","restaurant.priceRange":"Price Range (Optional)","restaurant.selectPriceRange":"Select price range...","activities.title":"Activities","activities.description":"Join exclusive dining experiences and culinary events","activities.viewDetails":"View Details","activities.joinEvent":"Join Event","activities.joined":"Joined","activities.subscribe":"Subscribe","activities.subscribed":"Subscribed","activities.subscribers":"subscribers","activities.subscribersCount":"subscribers","activities.participants":"participants","activities.restaurantsParticipating":"restaurants participating","activities.until":"Until","activities.shareSuccess":"Activity shared successfully","activities.linkCopied":"Link copied to clipboard","activities.shareError":"Failed to share activity","activities.pinned":"Pinned","activities.ended":"Ended","activities.ongoing":"Ongoing","activities.signInToJoin":"Please sign in to join this activity","activities.signInToSubscribe":"Please sign in","activities.signInToSubscribeDesc":"You need to sign in to subscribe to activities","activities.about":"About This Activity","activities.participatingRestaurants":"Participating Restaurants","activities.repeat.none":"One-time","activities.repeat.daily":"Daily","activities.repeat.weekly":"Weekly","activities.repeat.monthly":"Monthly","activities.repeat.yearly":"Yearly","profile.title":"My Profile","profile.settings":"Settings","profile.favorites":"Favorites","profile.reviews":"Reviews","profile.comments":"Comments","profile.activities":"Activities","profile.favoriteRestaurants":"My Favorite Restaurants","profile.favoritesDesc":"Restaurants you've bookmarked for future visits","profile.myReviews":"My Reviews","profile.myComments":"My Comments","profile.reviewsDesc":"Your ratings and reviews for restaurants","profile.commentsDesc":"Comments you've posted on restaurants and activities","profile.joinedActivities":"Joined Activities","profile.activitiesDesc":"Events and activities you're participating in","profile.noActivities":"No activities joined yet. Check out our","profile.noFavorites":"No favorite restaurants yet","profile.noComments":"No comments yet","profile.upcomingEvents":"upcoming events","profile.editProfile":"Edit Profile","profile.editProfileDescription":"Update your profile information","profile.displayName":"Display Name","profile.phone":"Phone","profile.uploadAvatar":"Upload Avatar","profile.joinedOn":"Joined on","profile.deleteAccount":"Delete Account","profile.deleteAccountWarning":"Warning: This action is permanent","profile.deleteAccountDescription":"Deleting your account will permanently remove all your data, including your profile, favorites, comments, and activity subscriptions. This action cannot be undone.","profile.confirmDeleteAccount":"Final Confirmation Required","profile.confirmDeleteDescription":"This is your last chance. All your data will be permanently deleted and cannot be recovered.","profile.typeDeleteToConfirm":"Type DELETE to confirm","profile.deleteAccountSuccess":"Account deleted successfully","profile.deleteAccountFailed":"Failed to delete account","profile.changeEmail":"Change Email","profile.verifyOldEmail":"Verify Current Email","profile.verifyNewEmail":"Enter New Email","profile.confirmEmailUpdate":"Confirm Email Update","profile.oldEmailStep":"Step 1/3: We need to verify your current email","profile.newEmailStep":"Step 2/3: Enter your new email address","profile.confirmEmailStep":"Step 3/3: Confirm your email update","profile.currentEmail":"Current Email","profile.newEmail":"New Email","profile.verificationCode":"Verification Code","profile.sendCode":"Send Code","profile.codeSent":"Sent","profile.enterCode":"Enter 4-digit code","profile.verify":"Verify","profile.updateEmail":"Update Email","profile.codeSentToOldEmail":"Verification code sent to your old email","profile.codeSentToNewEmail":"Verification code sent to your new email","profile.sendCodeFailed":"Failed to send verification code","profile.enterCodePlaceholder":"Please enter verification code","profile.codeIncorrect":"Verification code is incorrect or expired","profile.verificationFailed":"Verification failed","profile.oldEmailVerified":"Old email verified successfully","profile.newEmailVerified":"New email verified successfully","profile.enterValidEmail":"Please enter a valid email address","profile.pleaseSignIn":"Please sign in first","profile.emailUpdated":"Email updated successfully, please sign in with your new email","profile.emailUpdateFailed":"Failed to update email","profile.enterNewEmail":"Enter your new email address","profile.role.user":"User","profile.role.merchant":"Merchant","profile.role.supervisor":"Supervisor","profile.role.admin":"Admin","profile.changePassword":"Change Password","profile.changePasswordDescription":"Update your account password","profile.verifyOldPassword":"Verify Current Password","profile.oldPasswordStep":"Step 1/2: Verify your identity","profile.currentPassword":"Current Password","profile.enterCurrentPassword":"Enter current password","profile.forgotPassword":"Forgot password?","profile.useEmailVerification":"Use email verification instead","profile.oldPasswordVerified":"Password verified successfully","profile.oldPasswordIncorrect":"Current password is incorrect","profile.setNewPassword":"Set New Password","profile.newPasswordStep":"Step 2/2: Enter your new password","profile.newPassword":"New Password","profile.confirmNewPassword":"Confirm New Password","profile.enterNewPassword":"Enter new password (min 6 characters)","profile.confirmNewPasswordPlaceholder":"Enter new password again","profile.passwordsDontMatch":"Passwords don't match","profile.passwordTooShort":"Password must be at least 6 characters","profile.passwordUpdated":"Password updated successfully","profile.passwordUpdateFailed":"Failed to update password","profile.updatePassword":"Update Password","report.title":"Report","report.reportComment":"Report Comment","report.reportRestaurant":"Report Restaurant","report.reportActivity":"Report Activity","report.reportUser":"Report User","report.description":"Help us maintain a safe community","report.reason":"Reason for Report","report.reasonPlaceholder":"Select a reason","report.reasons":{spam:"Spam or Advertising",harassment:"Harassment or Bullying",inappropriate_content:"Inappropriate Content",misinformation:"Misinformation",copyright:"Copyright Violation",fraud:"Fraud or Scam",hate_speech:"Hate Speech",violence:"Violence or Threats",other:"Other"},"report.detailsLabel":"Details","report.detailsPlaceholder":"Please provide detailed information about this report (required, minimum 20 characters)","report.detailsMin":"Details must be at least 20 characters","report.contactLabel":"Contact Email","report.contactPlaceholder":"Your email for follow-up","report.contactRequired":"Contact email is required","report.invalidEmail":"Please enter a valid email address","report.evidenceLabel":"Evidence URLs","report.evidenceRequired":"At least one evidence (image or URL) is required","report.evidenceRequiredNote":"Please upload at least one image or provide a link","report.uploadImages":"Upload Images","report.evidenceUrls":"Or Provide URLs","report.imageUploadHint":"Supported formats: JPG, PNG, WEBP, GIF. Max 5MB per image","report.imageTooLarge":"Image size must be less than 5MB","report.invalidImageType":"Only JPG, PNG, WEBP, and GIF formats are supported","report.imageUploadFailed":"Failed to upload images. Please try again","report.evidencePlaceholder":"Add screenshot or evidence URL","report.addEvidence":"Add Evidence","report.removeEvidence":"Remove","report.submit":"Submit Report","report.submitting":"Submitting...","report.success":"Report submitted successfully. We will review it soon.","report.successDetailed":"Report submitted successfully! Reference: {{reference}}","report.successDescription":"We will review your report within 24-48 hours. You will receive an email notification at the contact address you provided once the review is complete. Thank you for helping us maintain a safe community!","report.failed":"Failed to submit report","report.cancel":"Cancel","report.confirmTitle":"Confirm Report Submission","report.confirmMessage":"Are you sure you want to submit this report? False reports may result in account restrictions.","admin.reports":"Reports","admin.reportsDescription":"Manage user reports","admin.totalReports":"Total Reports","admin.allReportsCount":"All submitted reports","admin.awaitingReview":"Awaiting review","admin.underReview":"Under review","admin.resolvedReports":"Resolved reports","admin.dismissedReports":"Dismissed reports","admin.allReports":"All Reports","admin.manageReportsDesc":"View and manage all user reports","admin.searchReports":"Search reports by description, reporter, or reason...","admin.noReports":"No reports yet","admin.reportStatus":{pending:"Pending",reviewing:"Reviewing",resolved:"Resolved",dismissed:"Dismissed"},"admin.reportType":{comment:"Comment",restaurant:"Restaurant",activity:"Activity",user:"User"},"admin.reportedBy":"Reported By","admin.reportedAt":"Reported At","admin.viewReport":"View Report","admin.updateStatus":"Update Status","admin.adminNotes":"Admin Notes","admin.saveNotes":"Save Notes","auth.welcome":"Welcome to Xiaoxiong Market","auth.subtitle":"Discover amazing restaurants and join exciting dining events","auth.login":"Login","auth.register":"Email Register","auth.phone":"Phone","auth.email":"Email","auth.password":"Password","auth.displayName":"Display Name","auth.phoneOptional":"Phone (Optional)","auth.phoneNumber":"Phone Number","auth.phoneMin":"Please enter a valid phone number","auth.phoneHint":"Enter your phone number with country code (e.g., +351 912 345 678)","auth.confirmPassword":"Confirm Password","auth.signIn":"Sign In","auth.signingIn":"Signing in...","auth.sendCode":"Send Code","auth.sendingCode":"Sending...","auth.verificationCode":"Verification Code","auth.verify":"Verify","auth.verifying":"Verifying...","auth.otpLength":"Code must be 6 digits","auth.otpSent":"Verification code sent to your phone","auth.otpHint":"Enter the 6-digit code sent to {{phone}}","auth.createAccount":"Create Account","auth.creatingAccount":"Creating account...","auth.orContinueWith":"Or continue with","auth.google":"Google","auth.backToHome":"Back to home","auth.invalidEmail":"Invalid email address","auth.passwordMin":"Password must be at least 6 characters","auth.passwordPlaceholder":"Minimum 6 characters","auth.passwordStrength":{weak:"Weak password - Add uppercase, numbers, or symbols",medium:"Medium password - Consider adding more variety",strong:"Strong password"},"auth.displayNameMin":"Display name must be at least 2 characters","auth.passwordsDontMatch":"Passwords don't match","auth.invalidCredentials":"Invalid email or password","auth.emailExists":"This email is already registered","auth.signInSuccess":"Successfully signed in!","auth.signUpSuccess":"Account created successfully! You can now sign in.","auth.verificationCodeSent":"Verification code sent to your email","auth.verificationCodeFailed":"Failed to send verification code","auth.invalidVerificationCode":"Invalid verification code","auth.verificationCodeUsed":"This verification code has already been used. Please request a new one.","auth.verificationCodeHint":"Please enter the 4-digit verification code sent to {{email}}","auth.resendCode":"Resend Code","auth.resendIn":"Resend in {{seconds}}s","common.loading":"Loading...","common.error":"Error","common.success":"Success","common.cancel":"Cancel","common.continue":"Continue","common.save":"Save","common.delete":"Delete","common.edit":"Edit","common.submit":"Submit","common.back":"Back","common.next":"Next","common.previous":"Previous","common.search":"Search","common.filter":"Filter","common.sort":"Sort","common.actions":"Actions","common.km":"km","common.uploading":"Uploading...","common.enterPlaceholder":"Enter...","common.selectPlaceholder":"Select...","common.share":"Share","common.copyLink":"Copy Link","common.moreOptions":"More Options","common.shareVia":"Share via","common.linkCopied":"Link copied to clipboard","common.shareSuccess":"Shared successfully","common.shareError":"Failed to share","common.actions.clearFilter":"Clear Filter","common.showMore":"Show More","common.showLess":"Show Less","notifications.title":"Notifications","notifications.markAllRead":"Mark all read","notifications.noNotifications":"No notifications yet","notifications.markAsReadError":"Failed to mark notification as read","notifications.markAllAsReadSuccess":"All notifications marked as read","notifications.markAllAsReadError":"Failed to mark all notifications as read","notifications.userNotAuthenticated":"User not authenticated","admin.management":"Management","admin.dashboard":"Dashboard","admin.users":"Users","admin.restaurants":"Restaurants","admin.activities":"Activities","admin.logs":"Operation Logs","admin.userManagement":"User Management","admin.restaurantManagement":"Restaurant Management","admin.activityManagement":"Activity Management","admin.operationLogs":"Operation Logs","admin.manageUserRoles":"Manage user roles and permissions","admin.manageRestaurants":"View and manage all restaurants","admin.manageActivities":"View and manage all activities","admin.viewSystemLogs":"View all system operation logs","admin.dashboardDescription":"Overview of system statistics","admin.totalUsers":"Total Users","admin.totalRestaurants":"Total Restaurants","admin.totalActivities":"Total Activities","admin.totalComments":"Total Comments","admin.registeredUsers":"Registered users","admin.listedRestaurants":"Listed restaurants","admin.activeEvents":"Active events","admin.userReviews":"User reviews and comments","admin.recentActivity":"Recent Activity","admin.recentActivityDescription":"Latest system activities","admin.viewLogsForDetails":"View operation logs for detailed activity","admin.selectRole":"Select a role","admin.assignRole":"Assign Role","admin.confirmRemoveRole":"Are you sure you want to remove this role?","admin.noPhone":"No phone number","admin.addRestaurant":"Add Restaurant","admin.addActivity":"Add Activity","admin.editActivity":"Edit Activity","admin.activityCreated":"Activity created successfully","admin.activityUpdated":"Activity updated successfully","admin.confirmDelete":"Confirm Deletion","admin.deleteActivityWarning":"This will permanently delete the activity and all associated data. This action cannot be undone.","admin.activityImage":"Activity Image","admin.uploadImage":"Upload Image","admin.titleEnglish":"Title (English)","admin.titleChinese":"Title (Chinese)","admin.titlePortuguese":"Title (Portuguese)","admin.contentEnglish":"Content (English)","admin.contentChinese":"Content (Chinese)","admin.contentPortuguese":"Content (Portuguese)","admin.startDate":"Start Date","admin.endDate":"End Date","admin.pickDate":"Pick a date","admin.repeatMode":"Repeat Mode","admin.selectRepeatMode":"Select repeat mode","admin.repeatNone":"No Repeat","admin.repeatDaily":"Daily","admin.repeatWeekly":"Weekly","admin.repeatMonthly":"Monthly","admin.repeatYearly":"Yearly","admin.associatedRestaurants":"Associated Restaurants","admin.pinned":"Pinned","admin.sortOrder":"Sort Order","admin.editRestaurant":"Edit Restaurant","admin.restaurantCreated":"Restaurant created successfully","admin.restaurantUpdated":"Restaurant updated successfully","admin.deleteRestaurantWarning":"This will permanently delete the restaurant and all associated data. This action cannot be undone.","admin.restaurantImage":"Restaurant Image","admin.nameChinese":"Name (Chinese)","admin.nameEnglish":"Name (English)","admin.namePortuguese":"Name (Portuguese)","admin.typeChinese":"Type (Chinese)","admin.typeEnglish":"Type (English)","admin.typePortuguese":"Type (Portuguese)","admin.restaurantTypes":"Restaurant Types","admin.tags":"tags","admin.addType":"Add Type","admin.descriptionChinese":"Description (Chinese)","admin.descriptionEnglish":"Description (English)","admin.descriptionPortuguese":"Description (Portuguese)","admin.address":"Address","admin.phone":"Phone","admin.website":"Website","admin.showWebsiteButton":"Show Website Button","admin.location":"Location","admin.locationOnMap":"Location on Map","admin.latitude":"Latitude","admin.longitude":"Longitude","admin.clickOrDragToSetLocation":"Click on the map or drag the marker to set the location","admin.mapInstructions":"Click on the map or drag the marker to set the location","admin.openingHours":"Opening Hours","admin.closed":"Closed","admin.day.monday":"Monday","admin.day.tuesday":"Tuesday","admin.day.wednesday":"Wednesday","admin.day.thursday":"Thursday","admin.day.friday":"Friday","admin.day.saturday":"Saturday","admin.day.sunday":"Sunday","admin.userGrowth":"User Growth Trend","admin.userGrowthDescription":"Cumulative user registration over time","admin.activityEngagement":"Activity Engagement","admin.activityEngagementDescription":"Subscribers and comments per activity","admin.topRestaurants":"Top Restaurants","admin.topRestaurantsDescription":"Restaurants ranked by rating and engagement","admin.subscribers":"Subscribers","admin.comments":"Comments","admin.rating":"Rating","admin.noData":"No data available","admin.exportCSV":"Export CSV","admin.exportSuccess":"Data exported successfully","admin.noDataToExport":"No data available to export","admin.batchDelete":"Batch Delete","admin.batchAssignRole":"Batch Assign Role","admin.selectedCount":"{{count}} selected","admin.confirmBatchDelete":"Confirm Batch Delete","admin.batchDeleteWarning":"This will permanently delete {{count}} items. This action cannot be undone.","admin.clearSelection":"Clear Selection","admin.selectAll":"Select All","admin.searchUsers":"Search by name or phone...","admin.searchRestaurants":"Search by name or address...","admin.searchActivities":"Search by title or content...","admin.filterByRole":"Filter by role","admin.filterByType":"Filter by type","admin.filterByStatus":"Filter by status","admin.allRoles":"All Roles","admin.allTypes":"All Types","admin.allStatus":"All Status","admin.statusActive":"Active","admin.statusEnded":"Ended","admin.statusPinned":"Pinned","admin.view":"View","admin.createMerchant":"Create Merchant","admin.createSupervisor":"Create Supervisor","admin.createUser":"Create User","admin.createNewUser":"Create New User","admin.createUserDescription":"Create a new merchant or supervisor account","admin.userCreated":"User created successfully","admin.createUserError":"Failed to create user","admin.role":"Role","admin.create":"Create","admin.oldData":"Old Data","admin.newData":"New Data","admin.noLogs":"No operation logs yet","admin.merchant":"Merchant","admin.supervisor":"Supervisor","admin.editActivityDetails":"Edit activity details, dates and settings","admin.createActivityWithContent":"Create new activity with multilingual content and rich formatting","admin.imageMaxSize":"PNG, JPG Max 5MB","admin.multilingualContent":"Multilingual Content","admin.chinese":"Chinese","admin.english":"English","admin.portuguese":"Portuguese","admin.title":"Title","admin.content":"Content","admin.enterTitle":"Enter activity title...","admin.enterContent":"Enter detailed activity content with rich text formatting...","admin.dateSettings":"Date Settings","admin.selectDate":"Select date","admin.displaySettings":"Display Settings","admin.pinToTop":"Pin to Top","admin.showAtTop":"Show this activity at the top of the list","admin.lowerFirst":"Lower numbers appear first","admin.selectParticipatingRestaurants":"Select participating restaurants","admin.editRestaurantDetails":"Edit restaurant details, location, hours and settings","admin.createRestaurantWithInfo":"Create new restaurant with multilingual content and complete information","admin.restaurantName":"Restaurant Name","admin.enterRestaurantName":"Enter restaurant name...","admin.restaurantType":"Restaurant Type (1-3 tags)","admin.typeExample":"e.g. Cantonese","admin.typeExamplePt":"e.g. Cantons","admin.enterDescription":"Enter restaurant description...","admin.contactAndWebsite":"Contact & Website","admin.enterAddress":"Enter address...","admin.enterPhone":"+351 XXX XXX XXX","admin.enterWebsite":"https://...","admin.clickOrDragMarker":"Click on the map or drag the marker to set the location","admin.weekdays":"Weekdays","admin.weekend":"Weekend","admin.copyToAll":"Copy to All Days","admin.splitShift":"Split Shift","admin.open":"Open","admin.close":"Close","admin.afternoon":"Afternoon","admin.evening":"Evening","admin.visible":"Visible","admin.showInFrontend":"Show this restaurant in the frontend","common.saving":"Saving...","merchant.myRestaurants":"My Restaurants","merchant.merchantDescription":"Manage your restaurant information and settings","merchant.supervisorDescription":"Manage all restaurants under your supervision","merchant.noRestaurants":"No restaurants assigned yet","joinUs.title":"Join Xiaoxiong Market","joinUs.description":"Partner with us to grow your restaurant business. Fill out the form below and our team will contact you soon.","joinUs.name":"Name","joinUs.namePlaceholder":"Your full name","joinUs.email":"Email","joinUs.emailPlaceholder":"your@email.com","joinUs.phone":"Phone","joinUs.phonePlaceholder":"+351 123 456 789","joinUs.restaurantName":"Restaurant Name","joinUs.restaurantNamePlaceholder":"Your restaurant name","joinUs.restaurantAddress":"Restaurant Address (Optional)","joinUs.restaurantAddressPlaceholder":"Street address, city","joinUs.optional":"Optional","joinUs.featuresNeeded":"Features Needed","joinUs.featuresDescription":"Select at least one feature you're interested in","joinUs.feature.booking":"Table Booking","joinUs.feature.delivery":"Delivery Service","joinUs.feature.qrcode":"QR Code Menu","joinUs.submit":"Submit Request","joinUs.nameMin":"Name must be at least 2 characters","joinUs.emailInvalid":"Invalid email address","joinUs.phoneMin":"Phone must be at least 6 characters","joinUs.restaurantNameMin":"Restaurant name must be at least 2 characters","joinUs.addressMin":"Restaurant address must be at least 2 characters","joinUs.featuresMin":"Please select at least one feature","joinUs.consentText":"By registering, you agree to receive marketing emails and promotional offers. For details, please review our Privacy Policy and Terms of Service.","joinUs.successTitle":"Request Submitted!","joinUs.successDescription":"Thank you for your trust!","joinUs.successMessage":"Your information has been successfully submitted! Thank you for your trust! Our dedicated consultant will contact you by phone within 24 business hours.","joinUs.submitAnother":"Submit Another Request","joinUs.submitError":"Failed to submit request. Please try again.","joinUs.rateLimitError":"Too Many Requests","joinUs.rateLimitErrorDesc":"You have already submitted a request in the last 24 hours. Please try again later.","joinUs.adminTitle":"Join Requests Management","joinUs.adminDescription":"View and manage all merchant join requests","joinUs.recipientEmail":"Recipient Email","joinUs.recipientEmailDesc":"Email address where join requests will be sent","joinUs.totalRequests":"Total Requests","joinUs.totalRequestsDesc":"All time join requests received","joinUs.allRequests":"All Join Requests","joinUs.allRequestsDesc":"View and manage all submitted join requests","joinUs.searchPlaceholder":"Search by name, email, restaurant...","joinUs.contact":"Contact","joinUs.restaurant":"Restaurant","joinUs.submittedAt":"Submitted","joinUs.noRequests":"No join requests yet","joinUs.enterNewEmail":"Enter new recipient email:","joinUs.emailUpdated":"Recipient email updated successfully","joinUs.emailUpdateError":"Failed to update recipient email","joinUs.status":"Status","joinUs.status.pending":"Pending","joinUs.status.completed":"Completed","joinUs.status.rejected":"Rejected","joinUs.statusUpdated":"Status updated successfully","joinUs.statusUpdateError":"Failed to update status","joinUs.requestDeleted":"Request deleted successfully","joinUs.deleteError":"Failed to delete request","joinUs.confirmDelete":"Delete Request","joinUs.confirmDeleteDescription":"Are you sure you want to delete this request? This action cannot be undone.","toast.subscribed":"Subscribed!","toast.unsubscribed":"Unsubscribed","toast.subscribedDesc":"You've joined this activity","toast.unsubscribedDesc":"You've left this activity","toast.subscriptionFailed":"Failed to update subscription","toast.roleChanged":"Role changed successfully","toast.roleChangeFailed":"Failed to change role","toast.profileUpdated":"Profile updated successfully","toast.profileUpdateFailed":"Failed to update profile","toast.avatarUploadFailed":"Failed to upload avatar","toast.activityDeleted":"Activity deleted successfully","toast.activityDeleteFailed":"Failed to delete activity","toast.restaurantDeleted":"Restaurant deleted successfully","toast.restaurantDeleteFailed":"Failed to delete restaurant","toast.usersDeleted":"Users deleted successfully","toast.usersDeleteFailed":"Failed to delete users","toast.restaurantsDeleted":"Restaurants deleted successfully","toast.restaurantsDeleteFailed":"Failed to delete restaurants","toast.activitiesDeleted":"Activities deleted successfully","toast.activitiesDeleteFailed":"Failed to delete activities","toast.rolesChanged":"Roles changed successfully","toast.rolesChangeFailed":"Failed to change roles","toast.commentDeleted":"Comment deleted successfully","toast.commentDeleteFailed":"Failed to delete comment","toast.pleaseSelectRating":"Please select a rating","toast.participationJoined":"Successfully joined the activity","toast.participationLeft":"Successfully left the activity","toast.participationFailed":"Failed to update participation","toast.visibilityUpdated":"Restaurant visibility updated","toast.visibilityUpdateFailed":"Failed to update restaurant visibility","error.general":"An error occurred","error.networkError":"Network error. Please try again.","error.notFound":"Not found","error.unauthorized":"Unauthorized access","validation.titleRequired":"Title is required","validation.contentRequired":"Content is required","validation.nameRequired":"Name is required","validation.typeRequired":"At least 1 type is required","validation.typeMaximum":"Maximum 3 types allowed","validation.addressRequired":"Address is required","admin.showing":"Showing","admin.of":"of","admin.results":"results"}},zh:{translation:{"nav.brandName":"","nav.map":"","nav.mapView":"","nav.restaurants":"","nav.activities":"","nav.profile":"","nav.signIn":"","nav.signOut":"","nav.myAccount":"","nav.admin":"","nav.manageRestaurants":"","nav.joinUs":"","map.subtitle":"","home.hero.brandName":"","home.hero.title":"","home.hero.subtitle":"","home.hero.description":"","home.hero.exploreBtn":"","home.hero.activitiesBtn":"","home.features.title":"","home.features.description":"","home.features.map.title":"","home.features.map.desc":"","home.features.reviews.title":"","home.features.reviews.desc":"","home.features.events.title":"","home.features.events.desc":"","home.cta.title":"","home.cta.description":"","home.cta.button":"","home.stats.delivery":"","home.stats.reservation":"","restaurants.title":"","restaurants.search":"...","restaurants.noResults":"","restaurants.noResultsDesc":"","restaurants.viewDetails":"","restaurants.addToFavorite":"","restaurants.removeFromFavorite":"","restaurants.mustSignIn":"","restaurants.listView":"","restaurants.mapView":"","restaurants.sortByDistance":"","restaurants.sortedByDistance":"","restaurants.radius":"","restaurants.radius1km":"1 km","restaurants.radius3km":"3 km","restaurants.radius5km":"5 km","restaurants.radius10km":"10 km","restaurants.radius20km":"20 km","restaurants.allRestaurants":"","restaurants.getLocation":"","restaurants.locationEnabled":"","restaurants.directions":"","restaurants.distanceAway":"{{distance}} km","restaurants.restaurantTypes":"","restaurant.address":"","restaurant.phone":"","restaurant.hours":"","restaurant.today":"","restaurant.closed":"","restaurant.dayMon":"","restaurant.dayTue":"","restaurant.dayWed":"","restaurant.dayThu":"","restaurant.dayFri":"","restaurant.daySat":"","restaurant.daySun":"","restaurant.website":"","restaurant.visitWebsite":"","restaurant.getDirections":"","restaurant.callNow":"","restaurant.joinPrivate":"","restaurant.reviews":"","restaurant.addReview":"","restaurant.rating":"","restaurant.edited":"","restaurant.reply":"","restaurant.writeComment":"...","restaurant.writeReply":"...","restaurant.postComment":"","restaurant.signInToComment":"","restaurant.signInToRate":"","restaurant.noComments":"","restaurant.confirmDelete":"","restaurant.ratingsCount":"","restaurant.yourRating":"","restaurant.rateThisRestaurant":"","restaurant.photoGallery":"","restaurant.addImage":"","restaurant.imageUploadFailed":"","restaurant.imageTooLarge":"5MB","restaurant.priceRange":"","restaurant.selectPriceRange":"...","activities.title":"","activities.description":"","activities.viewDetails":"","activities.joinEvent":"","activities.joined":"","activities.subscribe":"","activities.subscribed":"","activities.subscribers":"","activities.subscribersCount":"","activities.participants":"","activities.restaurantsParticipating":"","activities.until":"","activities.shareSuccess":"","activities.linkCopied":"","activities.shareError":"","activities.pinned":"","activities.ended":"","activities.ongoing":"","activities.signInToJoin":"","activities.signInToSubscribe":"","activities.signInToSubscribeDesc":"","activities.about":"","activities.participatingRestaurants":"","activities.repeat.none":"","activities.repeat.daily":"","activities.repeat.weekly":"","activities.repeat.monthly":"","activities.repeat.yearly":"","profile.title":"","profile.settings":"","profile.favorites":"","profile.reviews":"","profile.comments":"","profile.activities":"","profile.favoriteRestaurants":"","profile.favoritesDesc":"","profile.myReviews":"","profile.myComments":"","profile.reviewsDesc":"","profile.commentsDesc":"","profile.joinedActivities":"","profile.activitiesDesc":"","profile.noActivities":"","profile.noFavorites":"","profile.noComments":"","profile.upcomingEvents":"","profile.editProfile":"","profile.editProfileDescription":"","profile.displayName":"","profile.phone":"","profile.uploadAvatar":"","profile.joinedOn":"","profile.deleteAccount":"","profile.deleteAccountWarning":"","profile.deleteAccountDescription":"","profile.confirmDeleteAccount":"","profile.confirmDeleteDescription":"","profile.typeDeleteToConfirm":" DELETE ","profile.deleteAccountSuccess":"","profile.deleteAccountFailed":"","profile.changeEmail":"","profile.verifyOldEmail":"","profile.verifyNewEmail":"","profile.confirmEmailUpdate":"","profile.oldEmailStep":" 1/3: ","profile.newEmailStep":" 2/3: ","profile.confirmEmailStep":" 3/3: ","profile.currentEmail":"","profile.newEmail":"","profile.verificationCode":"","profile.sendCode":"","profile.codeSent":"","profile.enterCode":"4","profile.verify":"","profile.updateEmail":"","profile.codeSentToOldEmail":"","profile.codeSentToNewEmail":"","profile.sendCodeFailed":"","profile.enterCodePlaceholder":"","profile.codeIncorrect":"","profile.verificationFailed":"","profile.oldEmailVerified":"","profile.newEmailVerified":"","profile.enterValidEmail":"","profile.pleaseSignIn":"","profile.emailUpdated":"","profile.emailUpdateFailed":"","profile.enterNewEmail":"","profile.role.user":"","profile.role.merchant":"","profile.role.supervisor":"","profile.role.admin":"","profile.changePassword":"","profile.changePasswordDescription":"","profile.verifyOldPassword":"","profile.oldPasswordStep":" 1/2: ","profile.currentPassword":"","profile.enterCurrentPassword":"","profile.forgotPassword":"","profile.useEmailVerification":"","profile.oldPasswordVerified":"","profile.oldPasswordIncorrect":"","profile.setNewPassword":"","profile.newPasswordStep":" 2/2: ","profile.newPassword":"","profile.confirmNewPassword":"","profile.enterNewPassword":"6","profile.confirmNewPasswordPlaceholder":"","profile.passwordsDontMatch":"","profile.passwordTooShort":"6","profile.passwordUpdated":"","profile.passwordUpdateFailed":"","profile.updatePassword":"","report.title":"","report.reportComment":"","report.reportRestaurant":"","report.reportActivity":"","report.reportUser":"","report.description":"","report.reason":"","report.reasonPlaceholder":"","report.reasons":{spam:"",harassment:"",inappropriate_content:"",misinformation:"",copyright:"",fraud:"",hate_speech:"",violence:"",other:""},"report.detailsLabel":"","report.detailsPlaceholder":"20","report.detailsMin":"20","report.contactLabel":"","report.contactPlaceholder":"","report.contactRequired":"","report.invalidEmail":"","report.evidenceLabel":"","report.evidenceRequired":"","report.evidenceRequiredNote":"","report.uploadImages":"","report.evidenceUrls":"","report.imageUploadHint":"JPG, PNG, WEBP, GIF 5MB","report.imageTooLarge":" 5MB","report.invalidImageType":" JPGPNGWEBP  GIF ","report.imageUploadFailed":"","report.evidencePlaceholder":"","report.addEvidence":"","report.removeEvidence":"","report.submit":"","report.submitting":"...","report.success":"","report.successDetailed":"{{reference}}","report.successDescription":" 24-48 ","report.failed":"","report.cancel":"","report.confirmTitle":"","report.confirmMessage":"","admin.reports":"","admin.reportsDescription":"","admin.totalReports":"","admin.allReportsCount":"","admin.awaitingReview":"","admin.underReview":"","admin.resolvedReports":"","admin.dismissedReports":"","admin.allReports":"","admin.manageReportsDesc":"","admin.searchReports":"...","admin.noReports":"","admin.reportStatus":{pending:"",reviewing:"",resolved:"",dismissed:""},"admin.reportType":{comment:"",restaurant:"",activity:"",user:""},"admin.reportedBy":"","admin.reportedAt":"","admin.viewReport":"","admin.updateStatus":"","admin.adminNotes":"","admin.saveNotes":"","auth.welcome":"","auth.subtitle":"","auth.login":"","auth.register":"","auth.phone":"","auth.email":"","auth.password":"","auth.displayName":"","auth.phoneOptional":"","auth.phoneNumber":"","auth.phoneMin":"","auth.phoneHint":"+351 912 345 678","auth.confirmPassword":"","auth.signIn":"","auth.signingIn":"...","auth.sendCode":"","auth.sendingCode":"...","auth.verificationCode":"","auth.verify":"","auth.verifying":"...","auth.otpLength":"6","auth.otpSent":"","auth.otpHint":" {{phone}} 6","auth.createAccount":"","auth.creatingAccount":"...","auth.orContinueWith":"","auth.google":"Google","auth.backToHome":"","auth.invalidEmail":"","auth.passwordMin":"6","auth.passwordPlaceholder":"6","auth.passwordStrength":{weak:" - ",medium:" - ",strong:""},"auth.displayNameMin":"2","auth.passwordsDontMatch":"","auth.invalidCredentials":"","auth.emailExists":"","auth.signInSuccess":"","auth.signUpSuccess":"","auth.verificationCodeSent":"","auth.verificationCodeFailed":"","auth.invalidVerificationCode":"","auth.verificationCodeUsed":"","auth.verificationCodeHint":" {{email}} 4","auth.resendCode":"","auth.resendIn":"{{seconds}}","common.loading":"...","common.error":"","common.success":"","common.cancel":"","common.continue":"","common.save":"","common.delete":"","common.edit":"","common.submit":"","common.back":"","common.next":"","common.previous":"","common.search":"","common.filter":"","common.sort":"","common.actions":"","common.km":"","common.uploading":"...","common.share":"","common.copyLink":"","common.moreOptions":"","common.shareVia":"","common.linkCopied":"","common.shareSuccess":"","common.shareError":"","common.actions.clearFilter":"","common.showMore":"","common.showLess":"","notifications.title":"","notifications.markAllRead":"","notifications.noNotifications":"","notifications.markAsReadError":"","notifications.markAllAsReadSuccess":"","notifications.markAllAsReadError":"","notifications.userNotAuthenticated":"","admin.management":"","admin.dashboard":"","admin.users":"","admin.restaurants":"","admin.activities":"","admin.logs":"","admin.userManagement":"","admin.restaurantManagement":"","admin.activityManagement":"","admin.operationLogs":"","admin.manageUserRoles":"","admin.manageRestaurants":"","admin.manageActivities":"","admin.viewSystemLogs":"","admin.dashboardDescription":"","admin.totalUsers":"","admin.totalRestaurants":"","admin.totalActivities":"","admin.totalComments":"","admin.registeredUsers":"","admin.listedRestaurants":"","admin.activeEvents":"","admin.userReviews":"","admin.recentActivity":"","admin.recentActivityDescription":"","admin.viewLogsForDetails":"","admin.selectRole":"","admin.assignRole":"","admin.confirmRemoveRole":"","admin.noPhone":"","admin.addRestaurant":"","admin.addActivity":"","admin.editActivity":"","admin.activityCreated":"","admin.activityUpdated":"","admin.confirmDelete":"","admin.deleteActivityWarning":"","admin.activityImage":"","admin.uploadImage":"","admin.titleEnglish":"","admin.titleChinese":"","admin.titlePortuguese":"","admin.contentEnglish":"","admin.contentChinese":"","admin.contentPortuguese":"","admin.startDate":"","admin.endDate":"","admin.pickDate":"","admin.repeatMode":"","admin.selectRepeatMode":"","admin.repeatNone":"","admin.repeatDaily":"","admin.repeatWeekly":"","admin.repeatMonthly":"","admin.repeatYearly":"","admin.associatedRestaurants":"","admin.pinned":"","admin.sortOrder":"","admin.editRestaurant":"","admin.restaurantCreated":"","admin.restaurantUpdated":"","admin.deleteRestaurantWarning":"","admin.restaurantImage":"","admin.nameChinese":"","admin.nameEnglish":"","admin.namePortuguese":"","admin.typeChinese":"","admin.typeEnglish":"","admin.typePortuguese":"","admin.restaurantTypes":"","admin.tags":"","admin.addType":"","admin.descriptionChinese":"","admin.descriptionEnglish":"","admin.descriptionPortuguese":"","admin.address":"","admin.phone":"","admin.website":"","admin.showWebsiteButton":"","admin.location":"","admin.locationOnMap":"","admin.latitude":"","admin.longitude":"","admin.clickOrDragToSetLocation":"","admin.mapInstructions":"","admin.openingHours":"","admin.closed":"","admin.day.monday":"","admin.day.tuesday":"","admin.day.wednesday":"","admin.day.thursday":"","admin.day.friday":"","admin.day.saturday":"","admin.day.sunday":"","admin.userGrowth":"","admin.userGrowthDescription":"","admin.activityEngagement":"","admin.activityEngagementDescription":"","admin.topRestaurants":"","admin.topRestaurantsDescription":"","admin.subscribers":"","admin.comments":"","admin.rating":"","admin.noData":"","admin.exportCSV":"CSV","admin.exportSuccess":"","admin.noDataToExport":"","admin.batchDelete":"","admin.batchAssignRole":"","admin.selectedCount":" {{count}} ","admin.confirmBatchDelete":"","admin.batchDeleteWarning":" {{count}} ","admin.clearSelection":"","admin.selectAll":"","admin.searchUsers":"...","admin.searchRestaurants":"...","admin.searchActivities":"...","admin.filterByRole":"","admin.filterByType":"","admin.filterByStatus":"","admin.allRoles":"","admin.allTypes":"","admin.allStatus":"","admin.statusActive":"","admin.statusEnded":"","admin.statusPinned":"","admin.view":"","admin.createMerchant":"","admin.createSupervisor":"Supervisor","admin.createUser":"","admin.createNewUser":"","admin.createUserDescription":"supervisor","admin.userCreated":"","admin.createUserError":"","admin.role":"","admin.create":"","admin.oldData":"","admin.newData":"","admin.noLogs":"","admin.merchant":"","admin.supervisor":"","admin.editActivityDetails":"","admin.createActivityWithContent":"","admin.imageMaxSize":"PNG, JPG  5MB","admin.multilingualContent":"","admin.chinese":"","admin.english":"","admin.portuguese":"","admin.title":"","admin.content":"","admin.enterTitle":"...","admin.enterContent":"...","admin.dateSettings":"","admin.selectDate":"","admin.displaySettings":"","admin.pinToTop":"","admin.showAtTop":"","admin.lowerFirst":"","admin.selectParticipatingRestaurants":"","admin.editRestaurantDetails":"","admin.createRestaurantWithInfo":"","admin.restaurantName":"","admin.enterRestaurantName":"...","admin.restaurantType":" (1-3 )","admin.typeExample":"","admin.typeExamplePt":"Cantons","admin.enterDescription":"...","admin.contactAndWebsite":"","admin.enterAddress":"...","admin.enterPhone":"+351 XXX XXX XXX","admin.enterWebsite":"https://...","admin.clickOrDragMarker":"","admin.weekdays":"","admin.weekend":"","admin.copyToAll":"","admin.splitShift":"","admin.open":"","admin.close":"","admin.afternoon":"","admin.evening":"","admin.visible":"","admin.showInFrontend":"","common.saving":"...","merchant.myRestaurants":"","merchant.merchantDescription":"","merchant.supervisorDescription":"","merchant.noRestaurants":"","joinUs.title":"","joinUs.description":"","joinUs.name":"","joinUs.namePlaceholder":"","joinUs.email":"","joinUs.emailPlaceholder":"your@email.com","joinUs.phone":"","joinUs.phonePlaceholder":"+351 123 456 789","joinUs.restaurantName":"","joinUs.restaurantNamePlaceholder":"","joinUs.restaurantAddress":"","joinUs.restaurantAddressPlaceholder":"","joinUs.optional":"","joinUs.featuresNeeded":"","joinUs.featuresDescription":"","joinUs.feature.booking":"","joinUs.feature.delivery":"","joinUs.feature.qrcode":"","joinUs.submit":"","joinUs.nameMin":"2","joinUs.emailInvalid":"","joinUs.phoneMin":"6","joinUs.restaurantNameMin":"2","joinUs.addressMin":"2","joinUs.featuresMin":"","joinUs.consentText":"","joinUs.successTitle":"","joinUs.successDescription":"","joinUs.successMessage":"24","joinUs.submitAnother":"","joinUs.submitError":"","joinUs.rateLimitError":"","joinUs.rateLimitErrorDesc":"24","joinUs.adminTitle":"","joinUs.adminDescription":"","joinUs.recipientEmail":"","joinUs.recipientEmailDesc":"","joinUs.totalRequests":"","joinUs.totalRequestsDesc":"","joinUs.allRequests":"","joinUs.allRequestsDesc":"","joinUs.searchPlaceholder":"...","joinUs.contact":"","joinUs.restaurant":"","joinUs.submittedAt":"","joinUs.noRequests":"","joinUs.enterNewEmail":"","joinUs.emailUpdated":"","joinUs.emailUpdateError":"","joinUs.status":"","joinUs.status.pending":"","joinUs.status.completed":"","joinUs.status.rejected":"","joinUs.statusUpdated":"","joinUs.statusUpdateError":"","joinUs.requestDeleted":"","joinUs.deleteError":"","joinUs.confirmDelete":"","joinUs.confirmDeleteDescription":"","toast.subscribed":"","toast.unsubscribed":"","toast.subscribedDesc":"","toast.unsubscribedDesc":"","toast.subscriptionFailed":"","toast.roleChanged":"","toast.roleChangeFailed":"","toast.profileUpdated":"","toast.profileUpdateFailed":"","toast.avatarUploadFailed":"","toast.activityDeleted":"","toast.activityDeleteFailed":"","toast.restaurantDeleted":"","toast.restaurantDeleteFailed":"","toast.usersDeleted":"","toast.usersDeleteFailed":"","toast.restaurantsDeleted":"","toast.restaurantsDeleteFailed":"","toast.activitiesDeleted":"","toast.activitiesDeleteFailed":"","toast.rolesChanged":"","toast.rolesChangeFailed":"","toast.commentDeleted":"","toast.commentDeleteFailed":"","toast.pleaseSelectRating":"","toast.participationJoined":"","toast.participationJoinFailed":"","toast.participationLeft":"","toast.participationLeaveFailed":"","toast.visibilityUpdated":"","toast.visibilityUpdateFailed":"","toast.verificationFailed":"","toast.pleaseSignIn":"","toast.emailUpdatedSuccess":"","toast.emailUpdateError":"","toast.signInToFavorite":"","toast.favoritesUpdateFailed":"","toast.favoriteAdded":"","toast.favoriteRemoved":"","toast.resendCodeFailed":"","toast.verificationCodeResent":"","toast.reportUpdatedSuccess":"","toast.reportUpdateFailed":"","toast.merchantRestaurantsSaved":"","toast.merchantRestaurantsDescription":"","toast.merchantRestaurantsSaveFailed":"","toast.merchantRestaurantsDescriptionFailed":"","toast.participationUpdateFailed":"","toast.participationUpdateFailedDesc":"","toast.restaurantJoined":"","toast.restaurantJoinedDesc":"","toast.restaurantLeft":"","toast.restaurantLeftDesc":"","admin.reportsTrend":"","admin.reportsTrendDesc":"7","admin.reportsReasonDist":"","admin.reportsReasonDistDesc":"","admin.reportsTypeDist":"","admin.reportsTypeDistDesc":"","admin.reportsStatusDist":"","admin.reportsStatusDistDesc":"","admin.reportsCount":"","merchant.manageRestaurants":"","merchant.manageSupervisorRestaurants":"","merchant.assignRestaurantsTo":" {name} ","merchant.merchantOnlyOne":" ","merchant.saveReminder":' ""',"merchant.searchRestaurants":"...","merchant.selected":"","merchant.selectedCountOne":" {count}/1 ","merchant.selectedCountMulti":" {count} ","error.general":"","error.networkError":"","error.notFound":"","error.unauthorized":"","validation.titleRequired":"","validation.contentRequired":"","validation.nameRequired":"","validation.typeRequired":"1","validation.typeMaximum":"3","validation.addressRequired":"","admin.showing":"","admin.of":"","admin.results":""}},pt:{translation:{"nav.brandName":"Xiaoxiong Market","nav.map":"Incio","nav.mapView":"Mapa Privado","nav.restaurants":"Restaurantes","nav.activities":"Atividades","nav.profile":"Perfil","nav.signIn":"Entrar","nav.signOut":"Sair","nav.myAccount":"Minha Conta","nav.admin":"Painel Admin","nav.manageRestaurants":"Gerir Restaurantes","nav.joinUs":"Juntar Restaurante","map.subtitle":"Explore restaurantes selecionados nas proximidades","home.hero.brandName":"Xiaoxiong Market","home.hero.title":"Descubra Gastronomia Prxima","home.hero.subtitle":"Sua Jornada Culinria Comea Aqui","home.hero.description":"Explore restaurantes selecionados em vrias cidades, participe de eventos gastronmicos e conecte-se com amantes da gastronomia;","home.hero.exploreBtn":"Explorar Restaurantes","home.hero.activitiesBtn":"Ver Atividades","home.features.title":"Por Que Nos Escolher?","home.features.description":"Descubra Gastronomia; Compartilhe Experincias; Participe de Atividades;","home.features.map.title":"Mapa Inteligente","home.features.map.desc":"Encontre restaurantes prximos com nossa busca inteligente baseada em localizao e visualizao interativa do mapa;","home.features.reviews.title":"Avaliaes Confiveis","home.features.reviews.desc":"Leia avaliaes e classificaes autnticas de clientes verificados para tomar decises informadas;","home.features.events.title":"Eventos Exclusivos","home.features.events.desc":"Participe de eventos gastronmicos especiais, festivais de comida e conecte-se com a comunidade culinria;","home.cta.title":"Pronto para Comear?","home.cta.description":"Junte-se ao Xiaoxiong Market e alcance milhares de amantes da gastronomia. Cresa seu negcio conosco;","home.cta.button":"Adeso de Restaurante","home.stats.delivery":"Take Away","home.stats.reservation":"Reserva","restaurants.title":"Restaurantes","restaurants.search":"Pesquisar nome, morada, cdigo postal...","restaurants.noResults":"Nenhum restaurante encontrado","restaurants.noResultsDesc":"Tente ajustar sua pesquisa ou filtros","restaurants.viewDetails":"Ver Detalhes","restaurants.addToFavorite":"Adicionar aos favoritos","restaurants.removeFromFavorite":"Remover dos favoritos","restaurants.mustSignIn":"Por favor, faa login para favoritar restaurantes","restaurants.listView":"Vista de Lista","restaurants.mapView":"Vista de Mapa","restaurants.sortByDistance":"Ordenar por Distncia","restaurants.sortedByDistance":"Ordenado por distncia","restaurants.radius":"Raio","restaurants.radius1km":"1 km","restaurants.radius3km":"3 km","restaurants.radius5km":"5 km","restaurants.radius10km":"10 km","restaurants.radius20km":"20 km","restaurants.allRestaurants":"Todos os Restaurantes","restaurants.getLocation":"Obter Minha Localizao","restaurants.locationEnabled":"Localizao Ativada","restaurants.directions":"Obter Direes","restaurants.distanceAway":"{{distance}} km","restaurants.restaurantTypes":"Tipos de Restaurantes","restaurant.address":"Endereo","restaurant.phone":"Telefone","restaurant.hours":"Horrio","restaurant.today":"Hoje","restaurant.closed":"Fechado","restaurant.dayMon":"Seg","restaurant.dayTue":"Ter","restaurant.dayWed":"Qua","restaurant.dayThu":"Qui","restaurant.dayFri":"Sex","restaurant.daySat":"Sb","restaurant.daySun":"Dom","restaurant.website":"Site","restaurant.visitWebsite":"Visitar Site","restaurant.getDirections":"Obter Direes","restaurant.callNow":"Ligar Agora","restaurant.joinPrivate":"Entrar no Domnio Privado","restaurant.reviews":"Avaliaes","restaurant.addReview":"Adicionar Avaliao","restaurant.rating":"Classificao","restaurant.edited":"Editado","restaurant.reply":"Responder","restaurant.writeComment":"Escreva um comentrio...","restaurant.writeReply":"Escreva uma resposta...","restaurant.postComment":"Publicar Comentrio","restaurant.signInToComment":"Por favor, faa login para comentar","restaurant.signInToRate":"Por favor, faa login para avaliar este restaurante","restaurant.noComments":"Ainda no h comentrios. Seja o primeiro a compartilhar sua experincia!","restaurant.confirmDelete":"Tem certeza de que deseja excluir este comentrio?","restaurant.ratingsCount":"avaliaes","restaurant.yourRating":"Sua avaliao","restaurant.rateThisRestaurant":"Avalie este restaurante","restaurant.photoGallery":"Galeria de Fotos","restaurant.addImage":"Adicionar Imagem","restaurant.imageUploadFailed":"Falha ao enviar imagem","restaurant.imageTooLarge":"O tamanho da imagem deve ser menor que 5MB","restaurant.priceRange":"Faixa de Preo (Opcional)","restaurant.selectPriceRange":"Selecione a faixa de preo...","activities.title":"Atividades","activities.description":"Participe de experincias gastronmicas exclusivas e eventos culinrios","activities.viewDetails":"Ver Detalhes","activities.joinEvent":"Participar do Evento","activities.joined":"Participando","activities.subscribe":"Subscrever","activities.subscribed":"Subscrito","activities.subscribers":"inscritos","activities.subscribersCount":"assinantes","activities.participants":"participantes","activities.restaurantsParticipating":"restaurantes participando","activities.until":"At","activities.shareSuccess":"Atividade partilhada com sucesso","activities.linkCopied":"Link copiado para a rea de transferncia","activities.shareError":"Falha ao partilhar atividade","activities.pinned":"Fixado","activities.ended":"Encerrado","activities.ongoing":"Em Andamento","activities.signInToJoin":"Por favor, faa login para participar desta atividade","activities.signInToSubscribe":"Por favor, faa login","activities.signInToSubscribeDesc":"Voc precisa fazer login para subscrever atividades","activities.about":"Sobre Esta Atividade","activities.participatingRestaurants":"Restaurantes Participantes","activities.repeat.none":"nica vez","activities.repeat.daily":"Dirio","activities.repeat.weekly":"Semanal","activities.repeat.monthly":"Mensal","activities.repeat.yearly":"Anual","profile.title":"Meu Perfil","profile.settings":"Configuraes","profile.favorites":"Favoritos","profile.reviews":"Avaliaes","profile.comments":"Comentrios","profile.activities":"Atividades","profile.favoriteRestaurants":"Meus Restaurantes Favoritos","profile.favoritesDesc":"Restaurantes que voc marcou para visitas futuras","profile.myReviews":"Minhas Avaliaes","profile.myComments":"Meus Comentrios","profile.reviewsDesc":"Suas classificaes e avaliaes para restaurantes","profile.commentsDesc":"Comentrios que voc postou em restaurantes e atividades","profile.joinedActivities":"Atividades Participadas","profile.activitiesDesc":"Eventos e atividades em que voc est participando","profile.noActivities":"Nenhuma atividade participada ainda. Confira nossos","profile.noFavorites":"Nenhum restaurante favorito ainda","profile.noComments":"Nenhum comentrio ainda","profile.upcomingEvents":"prximos eventos","profile.editProfile":"Editar Perfil","profile.editProfileDescription":"Atualize suas informaes de perfil","profile.displayName":"Nome de Exibio","profile.phone":"Telefone","profile.uploadAvatar":"Enviar Avatar","profile.joinedOn":"Participou em","profile.deleteAccount":"Excluir Conta","profile.deleteAccountWarning":"Aviso: Esta ao  permanente","profile.deleteAccountDescription":"Excluir sua conta remover permanentemente todos os seus dados, incluindo seu perfil, favoritos, comentrios e inscries em atividades. Esta ao no pode ser desfeita.","profile.confirmDeleteAccount":"Confirmao Final Necessria","profile.confirmDeleteDescription":"Esta  sua ltima chance. Todos os seus dados sero permanentemente excludos e no podero ser recuperados.","profile.typeDeleteToConfirm":"Digite DELETE para confirmar","profile.deleteAccountSuccess":"Conta excluda com sucesso","profile.deleteAccountFailed":"Falha ao excluir conta","profile.changeEmail":"Alterar Email","profile.verifyOldEmail":"Verificar Email Atual","profile.verifyNewEmail":"Inserir Novo Email","profile.confirmEmailUpdate":"Confirmar Atualizao de Email","profile.oldEmailStep":"Passo 1/3: Precisamos verificar seu email atual","profile.newEmailStep":"Passo 2/3: Insira seu novo endereo de email","profile.confirmEmailStep":"Passo 3/3: Confirme sua atualizao de email","profile.currentEmail":"Email Atual","profile.newEmail":"Novo Email","profile.verificationCode":"Cdigo de Verificao","profile.sendCode":"Enviar Cdigo","profile.codeSent":"Enviado","profile.enterCode":"Digite o cdigo de 4 dgitos","profile.verify":"Verificar","profile.updateEmail":"Atualizar Email","profile.codeSentToOldEmail":"Cdigo de verificao enviado para seu email antigo","profile.codeSentToNewEmail":"Cdigo de verificao enviado para seu novo email","profile.sendCodeFailed":"Falha ao enviar cdigo de verificao","profile.enterCodePlaceholder":"Por favor, insira o cdigo de verificao","profile.codeIncorrect":"Cdigo de verificao incorreto ou expirado","profile.verificationFailed":"Falha na verificao","profile.oldEmailVerified":"Email antigo verificado com sucesso","profile.newEmailVerified":"Novo email verificado com sucesso","profile.enterValidEmail":"Por favor, insira um endereo de email vlido","profile.pleaseSignIn":"Por favor, faa login primeiro","profile.emailUpdated":"Email atualizado com sucesso, por favor faa login com seu novo email","profile.emailUpdateFailed":"Falha ao atualizar email","profile.enterNewEmail":"Insira seu novo endereo de email","profile.role.user":"Usurio","profile.role.merchant":"Comerciante","profile.role.supervisor":"Supervisor","profile.role.admin":"Administrador","profile.changePassword":"Alterar Senha","profile.changePasswordDescription":"Atualize a senha da sua conta","profile.verifyOldPassword":"Verificar Senha Atual","profile.oldPasswordStep":"Passo 1/2: Verifique sua identidade","profile.currentPassword":"Senha Atual","profile.enterCurrentPassword":"Digite a senha atual","profile.forgotPassword":"Esqueceu a senha?","profile.useEmailVerification":"Use verificao por e-mail","profile.oldPasswordVerified":"Senha verificada com sucesso","profile.oldPasswordIncorrect":"Senha atual incorreta","profile.setNewPassword":"Definir Nova Senha","profile.newPasswordStep":"Passo 2/2: Digite sua nova senha","profile.newPassword":"Nova Senha","profile.confirmNewPassword":"Confirmar Nova Senha","profile.enterNewPassword":"Digite nova senha (mn. 6 caracteres)","profile.confirmNewPasswordPlaceholder":"Digite a nova senha novamente","profile.passwordsDontMatch":"As senhas no coincidem","profile.passwordTooShort":"A senha deve ter pelo menos 6 caracteres","profile.passwordUpdated":"Senha atualizada com sucesso","profile.passwordUpdateFailed":"Falha ao atualizar senha","profile.updatePassword":"Atualizar Senha","report.title":"Denunciar","report.reportComment":"Denunciar Comentrio","report.reportRestaurant":"Denunciar Restaurante","report.reportActivity":"Denunciar Atividade","report.reportUser":"Denunciar Usurio","report.description":"Ajude-nos a manter uma comunidade segura","report.reason":"Motivo da Denncia","report.reasonPlaceholder":"Selecione um motivo","report.reasons":{spam:"Spam ou Publicidade",harassment:"Assdio ou Bullying",inappropriate_content:"Contedo Inadequado",misinformation:"Desinformao",copyright:"Violao de Direitos Autorais",fraud:"Fraude ou Golpe",hate_speech:"Discurso de dio",violence:"Violncia ou Ameaas",other:"Outro"},"report.detailsLabel":"Detalhes","report.detailsPlaceholder":"Fornea informaes detalhadas sobre esta denncia (obrigatrio, mnimo 20 caracteres)","report.detailsMin":"Detalhes devem ter pelo menos 20 caracteres","report.contactLabel":"Email de Contato","report.contactPlaceholder":"Seu email para acompanhamento","report.contactRequired":"Email de contato  obrigatrio","report.invalidEmail":"Por favor, insira um endereo de email vlido","report.evidenceLabel":"URLs de Evidncia","report.evidenceRequired":" necessrio fornecer pelo menos uma evidncia (imagem ou URL)","report.evidenceRequiredNote":"Por favor, carregue pelo menos uma imagem ou fornea um link","report.uploadImages":"Carregar Imagens","report.evidenceUrls":"Ou Fornecer URLs","report.imageUploadHint":"Formatos suportados: JPG, PNG, WEBP, GIF. Mx 5MB por imagem","report.imageTooLarge":"O tamanho da imagem deve ser inferior a 5MB","report.invalidImageType":"Apenas os formatos JPG, PNG, WEBP e GIF so suportados","report.imageUploadFailed":"Falha ao carregar imagens. Por favor, tente novamente","report.evidencePlaceholder":"Adicionar captura de tela ou URL de evidncia","report.addEvidence":"Adicionar Evidncia","report.removeEvidence":"Remover","report.submit":"Enviar Denncia","report.submitting":"Enviando...","report.success":"Denncia enviada com sucesso. Vamos analis-la em breve.","report.successDetailed":"Denncia enviada com sucesso! Referncia: {{reference}}","report.successDescription":"Vamos analisar sua denncia em 24-48 horas. Voc receber uma notificao por e-mail no endereo de contato fornecido assim que a anlise for concluda. Obrigado por nos ajudar a manter uma comunidade segura!","report.failed":"Falha ao enviar denncia","report.cancel":"Cancelar","report.confirmTitle":"Confirmar Envio de Denncia","report.confirmMessage":"Tem certeza que deseja enviar esta denncia? Denncias falsas podem resultar em restries de conta.","admin.reports":"Denncias","admin.reportsDescription":"Gerenciar denncias de usurios","admin.totalReports":"Total de Denncias","admin.allReportsCount":"Todas as denncias enviadas","admin.awaitingReview":"Aguardando reviso","admin.underReview":"Em reviso","admin.resolvedReports":"Denncias resolvidas","admin.dismissedReports":"Denncias rejeitadas","admin.allReports":"Todas as Denncias","admin.manageReportsDesc":"Ver e gerenciar todas as denncias de usurios","admin.searchReports":"Pesquisar denncias por descrio, denunciante ou motivo...","admin.noReports":"Nenhuma denncia ainda","admin.reportStatus":{pending:"Pendente",reviewing:"Em Anlise",resolved:"Resolvido",dismissed:"Rejeitado"},"admin.reportType":{comment:"Comentrio",restaurant:"Restaurante",activity:"Atividade",user:"Usurio"},"admin.reportedBy":"Denunciado Por","admin.reportedAt":"Denunciado Em","admin.viewReport":"Ver Denncia","admin.updateStatus":"Atualizar Status","admin.adminNotes":"Notas do Administrador","admin.saveNotes":"Salvar Notas","auth.welcome":"Bem-vindo ao Xiaoxiong Market","auth.subtitle":"Descubra restaurantes incrveis e participe de eventos gastronmicos emocionantes","auth.login":"Entrar","auth.register":"Registo por Email","auth.phone":"Telefone","auth.email":"Email","auth.password":"Senha","auth.displayName":"Nome de Exibio","auth.phoneOptional":"Telefone (Opcional)","auth.phoneNumber":"Nmero de Telefone","auth.phoneMin":"Por favor, insira um nmero de telefone vlido","auth.phoneHint":"Insira seu nmero de telefone com cdigo do pas (ex: +351 912 345 678)","auth.confirmPassword":"Confirmar Senha","auth.signIn":"Entrar","auth.signingIn":"Entrando...","auth.sendCode":"Enviar Cdigo","auth.sendingCode":"Enviando...","auth.verificationCode":"Cdigo de Verificao","auth.verify":"Verificar","auth.verifying":"Verificando...","auth.otpLength":"O cdigo deve ter 6 dgitos","auth.otpSent":"Cdigo de verificao enviado para seu telefone","auth.otpHint":"Insira o cdigo de 6 dgitos enviado para {{phone}}","auth.createAccount":"Criar Conta","auth.creatingAccount":"Criando conta...","auth.orContinueWith":"Ou continue com","auth.google":"Google","auth.backToHome":"Voltar ao incio","auth.invalidEmail":"Endereo de email invlido","auth.passwordMin":"A senha deve ter pelo menos 6 caracteres","auth.passwordPlaceholder":"Mnimo 6 caracteres","auth.passwordStrength":{weak:"Senha fraca - Adicione maisculas, nmeros ou smbolos",medium:"Senha mdia - Considere adicionar mais variedade",strong:"Senha forte"},"auth.displayNameMin":"O nome de exibio deve ter pelo menos 2 caracteres","auth.passwordsDontMatch":"As senhas no coincidem","auth.invalidCredentials":"Email ou senha invlidos","auth.emailExists":"Este email j est registrado","auth.signInSuccess":"Login bem-sucedido!","auth.signUpSuccess":"Conta criada com sucesso! Agora voc pode fazer login.","auth.verificationCodeSent":"Cdigo de verificao enviado para seu email","auth.verificationCodeFailed":"Falha ao enviar cdigo de verificao","auth.invalidVerificationCode":"Cdigo de verificao invlido","auth.verificationCodeUsed":"Este cdigo de verificao j foi usado. Por favor, solicite um novo.","auth.verificationCodeHint":"Por favor, insira o cdigo de verificao de 4 dgitos enviado para {{email}}","auth.resendCode":"Reenviar Cdigo","auth.resendIn":"Reenviar em {{seconds}}s","common.loading":"Carregando...","common.error":"Erro","common.success":"Sucesso","common.cancel":"Cancelar","common.continue":"Continuar","common.save":"Salvar","common.delete":"Excluir","common.edit":"Editar","common.submit":"Enviar","common.back":"Voltar","common.next":"Prximo","common.previous":"Anterior","common.search":"Pesquisar","common.filter":"Filtrar","common.sort":"Ordenar","common.actions":"Aes","common.km":"km","common.uploading":"Carregando...","common.enterPlaceholder":"Digite...","common.selectPlaceholder":"Selecione...","common.share":"Compartilhar","common.copyLink":"Copiar Link","common.moreOptions":"Mais Opes","common.shareVia":"Compartilhar via","common.linkCopied":"Link copiado","common.shareSuccess":"Compartilhado com sucesso","common.shareError":"Falha ao compartilhar","common.actions.clearFilter":"Limpar Filtro","common.showMore":"Mostrar Mais","common.showLess":"Mostrar Menos","notifications.title":"Notificaes","notifications.markAllRead":"Marcar todas como lidas","notifications.noNotifications":"Nenhuma notificao ainda","notifications.markAsReadError":"Falha ao marcar notificao como lida","notifications.markAllAsReadSuccess":"Todas as notificaes marcadas como lidas","notifications.markAllAsReadError":"Falha ao marcar todas as notificaes como lidas","notifications.userNotAuthenticated":"Usurio no autenticado","admin.management":"Gerenciamento","admin.dashboard":"Painel","admin.users":"Usurios","admin.restaurants":"Restaurantes","admin.activities":"Atividades","admin.logs":"Logs de Operao","admin.userManagement":"Gerenciamento de Usurios","admin.restaurantManagement":"Gerenciamento de Restaurantes","admin.activityManagement":"Gerenciamento de Atividades","admin.operationLogs":"Logs de Operao","admin.manageUserRoles":"Gerenciar funes e permisses de usurios","admin.manageRestaurants":"Visualizar e gerenciar todos os restaurantes","admin.manageActivities":"Visualizar e gerenciar todas as atividades","admin.viewSystemLogs":"Visualizar todos os logs de operao do sistema","admin.dashboardDescription":"Viso geral das estatsticas do sistema","admin.totalUsers":"Total de Usurios","admin.totalRestaurants":"Total de Restaurantes","admin.totalActivities":"Total de Atividades","admin.totalComments":"Total de Comentrios","admin.registeredUsers":"Usurios registrados","admin.listedRestaurants":"Restaurantes listados","admin.activeEvents":"Eventos ativos","admin.userReviews":"Avaliaes e comentrios de usurios","admin.recentActivity":"Atividade Recente","admin.recentActivityDescription":"ltimas atividades do sistema","admin.viewLogsForDetails":"Visualize os logs de operao para atividades detalhadas","admin.selectRole":"Selecione uma funo","admin.assignRole":"Atribuir Funo","admin.confirmRemoveRole":"Tem certeza de que deseja remover esta funo?","admin.noPhone":"Sem nmero de telefone","admin.addRestaurant":"Adicionar Restaurante","admin.addActivity":"Adicionar Atividade","admin.editActivity":"Editar Atividade","admin.activityCreated":"Atividade criada com sucesso","admin.activityUpdated":"Atividade atualizada com sucesso","admin.confirmDelete":"Confirmar Excluso","admin.deleteActivityWarning":"Isso excluir permanentemente a atividade e todos os dados associados. Esta ao no pode ser desfeita.","admin.activityImage":"Imagem da Atividade","admin.uploadImage":"Carregar Imagem","admin.titleEnglish":"Ttulo (Ingls)","admin.titleChinese":"Ttulo (Chins)","admin.titlePortuguese":"Ttulo (Portugus)","admin.contentEnglish":"Contedo (Ingls)","admin.contentChinese":"Contedo (Chins)","admin.contentPortuguese":"Contedo (Portugus)","admin.startDate":"Data de Incio","admin.endDate":"Data de Trmino","admin.pickDate":"Escolher data","admin.repeatMode":"Modo de Repetio","admin.selectRepeatMode":"Selecione o modo de repetio","admin.repeatNone":"Sem Repetio","admin.repeatDaily":"Diariamente","admin.repeatWeekly":"Semanalmente","admin.repeatMonthly":"Mensalmente","admin.repeatYearly":"Anualmente","admin.associatedRestaurants":"Restaurantes Associados","admin.pinned":"Fixado","admin.sortOrder":"Ordem de Classificao","admin.editRestaurant":"Editar Restaurante","admin.restaurantCreated":"Restaurante criado com sucesso","admin.restaurantUpdated":"Restaurante atualizado com sucesso","admin.deleteRestaurantWarning":"Isso excluir permanentemente o restaurante e todos os dados associados. Esta ao no pode ser desfeita.","admin.restaurantImage":"Imagem do Restaurante","admin.nameChinese":"Nome (Chins)","admin.nameEnglish":"Nome (Ingls)","admin.namePortuguese":"Nome (Portugus)","admin.typeChinese":"Tipo (Chins)","admin.typeEnglish":"Tipo (Ingls)","admin.typePortuguese":"Tipo (Portugus)","admin.restaurantTypes":"Tipos de Restaurantes","admin.tags":"etiquetas","admin.addType":"Adicionar Tipo","admin.descriptionChinese":"Descrio (Chins)","admin.descriptionEnglish":"Descrio (Ingls)","admin.descriptionPortuguese":"Descrio (Portugus)","admin.address":"Endereo","admin.phone":"Telefone","admin.website":"Site","admin.showWebsiteButton":"Mostrar Boto do Site","admin.location":"Localizao","admin.locationOnMap":"Localizao no Mapa","admin.latitude":"Latitude","admin.longitude":"Longitude","admin.clickOrDragToSetLocation":"Clique no mapa ou arraste o marcador para definir a localizao","admin.mapInstructions":"Clique no mapa ou arraste o marcador para definir a localizao","admin.openingHours":"Horrio de Funcionamento","admin.closed":"Fechado","admin.day.monday":"Segunda-feira","admin.day.tuesday":"Tera-feira","admin.day.wednesday":"Quarta-feira","admin.day.thursday":"Quinta-feira","admin.day.friday":"Sexta-feira","admin.day.saturday":"Sbado","admin.day.sunday":"Domingo","admin.userGrowth":"Tendncia de Crescimento de Usurios","admin.userGrowthDescription":"Crescimento acumulado de registro de usurios","admin.activityEngagement":"Engajamento em Atividades","admin.activityEngagementDescription":"Inscritos e comentrios por atividade","admin.topRestaurants":"Restaurantes Mais Populares","admin.topRestaurantsDescription":"Restaurantes classificados por classificao e engajamento","admin.subscribers":"Inscritos","admin.comments":"Comentrios","admin.rating":"Classificao","admin.noData":"Nenhum dado disponvel","admin.exportCSV":"Exportar CSV","admin.exportSuccess":"Dados exportados com sucesso","admin.noDataToExport":"Nenhum dado disponvel para exportar","admin.batchDelete":"Excluso em Lote","admin.batchAssignRole":"Atribuir Funo em Lote","admin.selectedCount":"{{count}} selecionado(s)","admin.confirmBatchDelete":"Confirmar Excluso em Lote","admin.batchDeleteWarning":"Isso excluir permanentemente {{count}} itens. Esta ao no pode ser desfeita.","admin.clearSelection":"Limpar Seleo","admin.selectAll":"Selecionar Tudo","admin.searchUsers":"Pesquisar por nome ou telefone...","admin.searchRestaurants":"Pesquisar por nome ou endereo...","admin.searchActivities":"Pesquisar por ttulo ou contedo...","admin.filterByRole":"Filtrar por funo","admin.filterByType":"Filtrar por tipo","admin.filterByStatus":"Filtrar por status","admin.allRoles":"Todas as Funes","admin.allTypes":"Todos os Tipos","admin.allStatus":"Todos os Status","admin.statusActive":"Ativo","admin.statusEnded":"Encerrado","admin.statusPinned":"Fixado","admin.view":"Visualizar","admin.createMerchant":"Criar Comerciante","admin.createSupervisor":"Criar Supervisor","admin.createUser":"Criar Usurio","admin.createNewUser":"Criar Novo Usurio","admin.createUserDescription":"Criar uma nova conta de comerciante ou supervisor","admin.userCreated":"Usurio criado com sucesso","admin.createUserError":"Falha ao criar usurio","admin.role":"Funo","admin.create":"Criar","admin.oldData":"Dados Antigos","admin.newData":"Novos Dados","admin.noLogs":"Nenhum log de operao ainda","admin.merchant":"Comerciante","admin.supervisor":"Supervisor","admin.editActivityDetails":"Editar detalhes da atividade, datas e configuraes","admin.createActivityWithContent":"Criar nova atividade com contedo multilngue e formatao rica","admin.imageMaxSize":"PNG, JPG Mx 5MB","admin.multilingualContent":"Contedo Multilngue","admin.chinese":"Chins","admin.english":"Ingls","admin.portuguese":"Portugus","admin.title":"Ttulo","admin.content":"Contedo","admin.enterTitle":"Digite o ttulo da atividade...","admin.enterContent":"Digite o contedo detalhado da atividade com formatao rica...","admin.dateSettings":"Configuraes de Data","admin.selectDate":"Selecionar data","admin.displaySettings":"Configuraes de Exibio","admin.pinToTop":"Fixar no Topo","admin.showAtTop":"Mostrar esta atividade no topo da lista","admin.lowerFirst":"Nmeros menores aparecem primeiro","admin.selectParticipatingRestaurants":"Selecionar restaurantes participantes","admin.editRestaurantDetails":"Editar detalhes do restaurante, localizao, horrios e configuraes","admin.createRestaurantWithInfo":"Criar novo restaurante com contedo multilngue e informaes completas","admin.restaurantName":"Nome do Restaurante","admin.enterRestaurantName":"Digite o nome do restaurante...","admin.restaurantType":"Tipo de Restaurante (1-3 etiquetas)","admin.typeExample":"e.g. Cantons","admin.typeExamplePt":"e.g. Cantons","admin.enterDescription":"Digite a descrio do restaurante...","admin.contactAndWebsite":"Contato e Website","admin.enterAddress":"Digite o endereo...","admin.enterPhone":"+351 XXX XXX XXX","admin.enterWebsite":"https://...","admin.clickOrDragMarker":"Clique no mapa ou arraste o marcador para definir a localizao","admin.weekdays":"Dias de Semana","admin.weekend":"Fim de Semana","admin.copyToAll":"Copiar para Todos os Dias","admin.splitShift":"Turno Dividido","admin.open":"Abrir","admin.close":"Fechar","admin.afternoon":"Tarde","admin.evening":"Noite","admin.visible":"Visvel","admin.showInFrontend":"Mostrar este restaurante no frontend","common.saving":"Salvando...","merchant.myRestaurants":"Meus Restaurantes","merchant.merchantDescription":"Gerir informaes e configuraes do seu restaurante","merchant.supervisorDescription":"Gerir todos os restaurantes sob sua superviso","merchant.noRestaurants":"Nenhum restaurante atribudo ainda","joinUs.title":"Junte-se ao Xiaoxiong Market","joinUs.description":"Faa parceria connosco para desenvolver o seu negcio de restaurante. Preencha o formulrio abaixo e a nossa equipa entrar em contacto em breve.","joinUs.name":"Nome","joinUs.namePlaceholder":"Seu nome completo","joinUs.email":"Email","joinUs.emailPlaceholder":"seu@email.com","joinUs.phone":"Telefone","joinUs.phonePlaceholder":"+351 123 456 789","joinUs.restaurantName":"Nome do Restaurante","joinUs.restaurantNamePlaceholder":"Nome do seu restaurante","joinUs.restaurantAddress":"Morada do Restaurante (Opcional)","joinUs.restaurantAddressPlaceholder":"Morada completa, cidade","joinUs.optional":"Opcional","joinUs.featuresNeeded":"Funcionalidades Necessrias","joinUs.featuresDescription":"Selecione pelo menos uma funcionalidade do seu interesse","joinUs.feature.booking":"Reserva de Mesas","joinUs.feature.delivery":"Servio de Entrega","joinUs.feature.qrcode":"Menu QR Code","joinUs.submit":"Enviar Pedido","joinUs.nameMin":"O nome deve ter pelo menos 2 caracteres","joinUs.emailInvalid":"Endereo de email invlido","joinUs.phoneMin":"O telefone deve ter pelo menos 6 caracteres","joinUs.restaurantNameMin":"O nome do restaurante deve ter pelo menos 2 caracteres","joinUs.addressMin":"A morada do restaurante deve ter pelo menos 2 caracteres","joinUs.featuresMin":"Por favor, selecione pelo menos uma funcionalidade","joinUs.consentText":"Ao se registrar, voc concorda em receber e-mails de marketing e ofertas promocionais. Para detalhes, consulte nossa Poltica de Privacidade e Termos de Servio.","joinUs.successTitle":"Informao Enviada com Sucesso!","joinUs.successDescription":"Obrigado pela sua confiana!","joinUs.successMessage":"Suas informaes foram enviadas com sucesso! Obrigado pela sua confiana! Nosso consultor dedicado entrar em contato por telefone dentro de 24 horas teis.","joinUs.submitAnother":"Enviar Outro Pedido","joinUs.submitError":"Falha ao enviar pedido. Por favor, tente novamente.","joinUs.rateLimitError":"Muitos Pedidos","joinUs.rateLimitErrorDesc":"J enviou um pedido nas ltimas 24 horas. Por favor, tente mais tarde.","joinUs.adminTitle":"Gesto de Pedidos de Adeso","joinUs.adminDescription":"Ver e gerir todos os pedidos de adeso de comerciantes","joinUs.recipientEmail":"Email de Receo","joinUs.recipientEmailDesc":"Endereo de email onde os pedidos de adeso sero enviados","joinUs.totalRequests":"Total de Pedidos","joinUs.totalRequestsDesc":"Todos os pedidos de adeso recebidos","joinUs.allRequests":"Todos os Pedidos de Adeso","joinUs.allRequestsDesc":"Ver e gerir todos os pedidos de adeso submetidos","joinUs.searchPlaceholder":"Pesquisar por nome, email, restaurante...","joinUs.contact":"Contacto","joinUs.restaurant":"Restaurante","joinUs.submittedAt":"Submetido","joinUs.noRequests":"Nenhum pedido de adeso ainda","joinUs.enterNewEmail":"Introduza novo email de receo:","joinUs.emailUpdated":"Email de receo atualizado com sucesso","joinUs.emailUpdateError":"Falha ao atualizar email de receo","joinUs.status":"Estado","joinUs.status.pending":"Pendente","joinUs.status.completed":"Concludo","joinUs.status.rejected":"Rejeitado","joinUs.statusUpdated":"Estado atualizado com sucesso","joinUs.statusUpdateError":"Falha ao atualizar o estado","joinUs.requestDeleted":"Pedido eliminado com sucesso","joinUs.deleteError":"Falha ao eliminar o pedido","joinUs.confirmDelete":"Eliminar Pedido","joinUs.confirmDeleteDescription":"Tem certeza de que deseja eliminar este pedido? Esta ao no pode ser desfeita.","toast.subscribed":"Subscrito!","toast.unsubscribed":"Cancelado","toast.subscribedDesc":"Juntou-se a esta atividade","toast.unsubscribedDesc":"Saiu desta atividade","toast.subscriptionFailed":"Falha ao atualizar subscrio","toast.roleChanged":"Funo alterada com sucesso","toast.roleChangeFailed":"Falha ao alterar funo","toast.profileUpdated":"Perfil atualizado com sucesso","toast.profileUpdateFailed":"Falha ao atualizar perfil","toast.avatarUploadFailed":"Falha ao carregar avatar","toast.activityDeleted":"Atividade eliminada com sucesso","toast.activityDeleteFailed":"Falha ao eliminar atividade","toast.restaurantDeleted":"Restaurante eliminado com sucesso","toast.restaurantDeleteFailed":"Falha ao eliminar restaurante","toast.usersDeleted":"Utilizadores eliminados com sucesso","toast.usersDeleteFailed":"Falha ao eliminar utilizadores","toast.restaurantsDeleted":"Restaurantes eliminados com sucesso","toast.restaurantsDeleteFailed":"Falha ao eliminar restaurantes","toast.activitiesDeleted":"Atividades eliminadas com sucesso","toast.activitiesDeleteFailed":"Falha ao eliminar atividades","toast.rolesChanged":"Funes alteradas com sucesso","toast.rolesChangeFailed":"Falha ao alterar funes","toast.commentDeleted":"Comentrio eliminado com sucesso","toast.commentDeleteFailed":"Falha ao eliminar comentrio","toast.pleaseSelectRating":"Por favor selecione uma avaliao","toast.participationJoined":"Participao confirmada com sucesso","toast.participationLeft":"Saiu da atividade com sucesso","toast.participationFailed":"Falha ao atualizar participao","toast.visibilityUpdated":"Visibilidade do restaurante atualizada","toast.visibilityUpdateFailed":"Falha ao atualizar visibilidade do restaurante","error.general":"Ocorreu um erro","error.networkError":"Erro de rede. Por favor, tente novamente.","error.notFound":"No encontrado","error.unauthorized":"Acesso no autorizado","validation.titleRequired":"Ttulo  obrigatrio","validation.contentRequired":"Contedo  obrigatrio","validation.nameRequired":"Nome  obrigatrio","validation.typeRequired":"Pelo menos 1 tipo  necessrio","validation.typeMaximum":"Mximo de 3 tipos permitidos","validation.addressRequired":"Endereo  obrigatrio","admin.showing":"Mostrando","admin.of":"de","admin.results":"resultados"}}};jr.use(Ure).use(_Ee).init({resources:C2e,fallbackLng:"en",supportedLngs:["en","zh","pt"],interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator"],caches:["localStorage"]}});const O2e=()=>{const{user:e}=Fi(),t=Ma();return W.useEffect(()=>{if(!e)return;const r=qt.channel("notifications-changes").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${e.id}`},()=>{t.invalidateQueries({queryKey:["notifications",e.id]}),t.invalidateQueries({queryKey:["notifications-unread-count",e.id]})}).subscribe();return()=>{qt.removeChannel(r)}},[e,t]),Li({queryKey:["notifications",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:r,error:n}=await qt.from("notifications").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}).limit(50);if(n)throw n;return r},enabled:!!e})},k2e=()=>{const{user:e}=Fi(),t=Ma();return W.useEffect(()=>{if(!e)return;const r=qt.channel("notifications-unread-changes").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${e.id}`},()=>{t.invalidateQueries({queryKey:["notifications-unread-count",e.id]})}).subscribe();return()=>{qt.removeChannel(r)}},[e,t]),Li({queryKey:["notifications-unread-count",e==null?void 0:e.id],queryFn:async()=>{if(!e)return 0;const{count:r,error:n}=await qt.from("notifications").select("*",{count:"exact",head:!0}).eq("user_id",e.id).eq("read",!1);if(n)throw n;return r||0},enabled:!!e})},I2e=()=>{const{toast:e}=Sa(),t=Ma();return Ya({mutationFn:async r=>{const{error:n}=await qt.from("notifications").update({read:!0}).eq("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["notifications"]}),t.invalidateQueries({queryKey:["notifications-unread-count"]})},onError:()=>{e({title:jr.t("common.error"),description:jr.t("notifications.markAsReadError"),variant:"destructive"})}})},R2e=()=>{const{user:e}=Fi(),{toast:t}=Sa(),r=Ma();return Ya({mutationFn:async()=>{if(!e)throw new Error(jr.t("notifications.userNotAuthenticated"));const{error:n}=await qt.from("notifications").update({read:!0}).eq("user_id",e.id).eq("read",!1);if(n)throw n},onSuccess:()=>{r.invalidateQueries({queryKey:["notifications"]}),r.invalidateQueries({queryKey:["notifications-unread-count"]}),t({title:jr.t("common.success"),description:jr.t("notifications.markAllAsReadSuccess")})},onError:()=>{t({title:jr.t("common.error"),description:jr.t("notifications.markAllAsReadError"),variant:"destructive"})}})};function hi(e){const t=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&t==="[object Date]"?new e.constructor(+e):typeof e=="number"||t==="[object Number]"||typeof e=="string"||t==="[object String]"?new Date(e):new Date(NaN)}function Ac(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}function Fl(e,t){const r=hi(e);return isNaN(t)?Ac(e,NaN):(t&&r.setDate(r.getDate()+t),r)}function Cd(e,t){const r=hi(e);if(isNaN(t))return Ac(e,NaN);if(!t)return r;const n=r.getDate(),o=Ac(e,r.getTime());o.setMonth(r.getMonth()+t+1,0);const l=o.getDate();return n>=l?o:(r.setFullYear(o.getFullYear(),o.getMonth(),n),r)}const g4=6048e5,j2e=864e5,LP=43200,iW=1440;let N2e={};function Rb(){return N2e}function Ph(e,t){var i,g,_,S;const r=Rb(),n=(t==null?void 0:t.weekStartsOn)??((g=(i=t==null?void 0:t.locale)==null?void 0:i.options)==null?void 0:g.weekStartsOn)??r.weekStartsOn??((S=(_=r.locale)==null?void 0:_.options)==null?void 0:S.weekStartsOn)??0,o=hi(e),l=o.getDay(),d=(l<n?7:0)+l-n;return o.setDate(o.getDate()-d),o.setHours(0,0,0,0),o}function pv(e){return Ph(e,{weekStartsOn:1})}function Vre(e){const t=hi(e),r=t.getFullYear(),n=Ac(e,0);n.setFullYear(r+1,0,4),n.setHours(0,0,0,0);const o=pv(n),l=Ac(e,0);l.setFullYear(r,0,4),l.setHours(0,0,0,0);const d=pv(l);return t.getTime()>=o.getTime()?r+1:t.getTime()>=d.getTime()?r:r-1}function Zm(e){const t=hi(e);return t.setHours(0,0,0,0),t}function F0(e){const t=hi(e),r=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return r.setUTCFullYear(t.getFullYear()),+e-+r}function fh(e,t){const r=Zm(e),n=Zm(t),o=+r-F0(r),l=+n-F0(n);return Math.round((o-l)/j2e)}function M2e(e){const t=Vre(e),r=Ac(e,0);return r.setFullYear(t,0,4),r.setHours(0,0,0,0),pv(r)}function S3(e,t){const r=t*7;return Fl(e,r)}function D2e(e,t){return Cd(e,t*12)}function L2e(e){let t;return e.forEach(function(r){const n=hi(r);(t===void 0||t<n||isNaN(Number(n)))&&(t=n)}),t||new Date(NaN)}function F2e(e){let t;return e.forEach(r=>{const n=hi(r);(!t||t>n||isNaN(+n))&&(t=n)}),t||new Date(NaN)}function xC(e,t){const r=hi(e),n=hi(t),o=r.getTime()-n.getTime();return o<0?-1:o>0?1:o}function z2e(e){return Ac(e,Date.now())}function vc(e,t){const r=Zm(e),n=Zm(t);return+r==+n}function y4(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function B2e(e){if(!y4(e)&&typeof e!="number")return!1;const t=hi(e);return!isNaN(Number(t))}function z0(e,t){const r=hi(e),n=hi(t),o=r.getFullYear()-n.getFullYear(),l=r.getMonth()-n.getMonth();return o*12+l}function $2e(e,t,r){const n=Ph(e,r),o=Ph(t,r),l=+n-F0(n),d=+o-F0(o);return Math.round((l-d)/g4)}function U2e(e){return t=>{const n=(e?Math[e]:Math.trunc)(t);return n===0?0:n}}function V2e(e,t){return+hi(e)-+hi(t)}function q2e(e){const t=hi(e);return t.setHours(23,59,59,999),t}function MI(e){const t=hi(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}function W2e(e){const t=hi(e);return+q2e(t)==+MI(t)}function G2e(e,t){const r=hi(e),n=hi(t),o=xC(r,n),l=Math.abs(z0(r,n));let d;if(l<1)d=0;else{r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-o*l);let i=xC(r,n)===-o;W2e(hi(e))&&l===1&&xC(e,n)===1&&(i=!1),d=o*(l-Number(i))}return d===0?0:d}function H2e(e,t,r){const n=V2e(e,t)/1e3;return U2e(r==null?void 0:r.roundingMethod)(n)}function Tc(e){const t=hi(e);return t.setDate(1),t.setHours(0,0,0,0),t}function qre(e){const t=hi(e),r=Ac(e,0);return r.setFullYear(t.getFullYear(),0,1),r.setHours(0,0,0,0),r}function v4(e,t){var i,g,_,S;const r=Rb(),n=(t==null?void 0:t.weekStartsOn)??((g=(i=t==null?void 0:t.locale)==null?void 0:i.options)==null?void 0:g.weekStartsOn)??r.weekStartsOn??((S=(_=r.locale)==null?void 0:_.options)==null?void 0:S.weekStartsOn)??0,o=hi(e),l=o.getDay(),d=(l<n?-7:0)+6-(l-n);return o.setDate(o.getDate()+d),o.setHours(23,59,59,999),o}function Wre(e){return v4(e,{weekStartsOn:1})}const K2e={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Z2e=(e,t,r)=>{let n;const o=K2e[e];return typeof o=="string"?n=o:t===1?n=o.one:n=o.other.replace("{{count}}",t.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+n:n+" ago":n};function ZM(e){return(t={})=>{const r=t.width?String(t.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}const X2e={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Y2e={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},J2e={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Q2e={date:ZM({formats:X2e,defaultWidth:"full"}),time:ZM({formats:Y2e,defaultWidth:"full"}),dateTime:ZM({formats:J2e,defaultWidth:"full"})},eAe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},tAe=(e,t,r,n)=>eAe[e];function lS(e){return(t,r)=>{const n=r!=null&&r.context?String(r.context):"standalone";let o;if(n==="formatting"&&e.formattingValues){const d=e.defaultFormattingWidth||e.defaultWidth,i=r!=null&&r.width?String(r.width):d;o=e.formattingValues[i]||e.formattingValues[d]}else{const d=e.defaultWidth,i=r!=null&&r.width?String(r.width):e.defaultWidth;o=e.values[i]||e.values[d]}const l=e.argumentCallback?e.argumentCallback(t):t;return o[l]}}const rAe={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},nAe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},iAe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},aAe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},oAe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},sAe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},lAe=(e,t)=>{const r=Number(e),n=r%100;if(n>20||n<10)switch(n%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},cAe={ordinalNumber:lAe,era:lS({values:rAe,defaultWidth:"wide"}),quarter:lS({values:nAe,defaultWidth:"wide",argumentCallback:e=>e-1}),month:lS({values:iAe,defaultWidth:"wide"}),day:lS({values:aAe,defaultWidth:"wide"}),dayPeriod:lS({values:oAe,defaultWidth:"wide",formattingValues:sAe,defaultFormattingWidth:"wide"})};function cS(e){return(t,r={})=>{const n=r.width,o=n&&e.matchPatterns[n]||e.matchPatterns[e.defaultMatchWidth],l=t.match(o);if(!l)return null;const d=l[0],i=n&&e.parsePatterns[n]||e.parsePatterns[e.defaultParseWidth],g=Array.isArray(i)?dAe(i,E=>E.test(d)):uAe(i,E=>E.test(d));let _;_=e.valueCallback?e.valueCallback(g):g,_=r.valueCallback?r.valueCallback(_):_;const S=t.slice(d.length);return{value:_,rest:S}}}function uAe(e,t){for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t(e[r]))return r}function dAe(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return r}function hAe(e){return(t,r={})=>{const n=t.match(e.matchPattern);if(!n)return null;const o=n[0],l=t.match(e.parsePattern);if(!l)return null;let d=e.valueCallback?e.valueCallback(l[0]):l[0];d=r.valueCallback?r.valueCallback(d):d;const i=t.slice(o.length);return{value:d,rest:i}}}const fAe=/^(\d+)(th|st|nd|rd)?/i,pAe=/\d+/i,mAe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},gAe={any:[/^b/i,/^(a|c)/i]},yAe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},vAe={any:[/1/i,/2/i,/3/i,/4/i]},_Ae={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},xAe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},bAe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},wAe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},SAe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},EAe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},TAe={ordinalNumber:hAe({matchPattern:fAe,parsePattern:pAe,valueCallback:e=>parseInt(e,10)}),era:cS({matchPatterns:mAe,defaultMatchWidth:"wide",parsePatterns:gAe,defaultParseWidth:"any"}),quarter:cS({matchPatterns:yAe,defaultMatchWidth:"wide",parsePatterns:vAe,defaultParseWidth:"any",valueCallback:e=>e+1}),month:cS({matchPatterns:_Ae,defaultMatchWidth:"wide",parsePatterns:xAe,defaultParseWidth:"any"}),day:cS({matchPatterns:bAe,defaultMatchWidth:"wide",parsePatterns:wAe,defaultParseWidth:"any"}),dayPeriod:cS({matchPatterns:SAe,defaultMatchWidth:"any",parsePatterns:EAe,defaultParseWidth:"any"})},_4={code:"en-US",formatDistance:Z2e,formatLong:Q2e,formatRelative:tAe,localize:cAe,match:TAe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function AAe(e){const t=hi(e);return fh(t,qre(t))+1}function Gre(e){const t=hi(e),r=+pv(t)-+M2e(t);return Math.round(r/g4)+1}function Hre(e,t){var S,E,T,C;const r=hi(e),n=r.getFullYear(),o=Rb(),l=(t==null?void 0:t.firstWeekContainsDate)??((E=(S=t==null?void 0:t.locale)==null?void 0:S.options)==null?void 0:E.firstWeekContainsDate)??o.firstWeekContainsDate??((C=(T=o.locale)==null?void 0:T.options)==null?void 0:C.firstWeekContainsDate)??1,d=Ac(e,0);d.setFullYear(n+1,0,l),d.setHours(0,0,0,0);const i=Ph(d,t),g=Ac(e,0);g.setFullYear(n,0,l),g.setHours(0,0,0,0);const _=Ph(g,t);return r.getTime()>=i.getTime()?n+1:r.getTime()>=_.getTime()?n:n-1}function PAe(e,t){var i,g,_,S;const r=Rb(),n=(t==null?void 0:t.firstWeekContainsDate)??((g=(i=t==null?void 0:t.locale)==null?void 0:i.options)==null?void 0:g.firstWeekContainsDate)??r.firstWeekContainsDate??((S=(_=r.locale)==null?void 0:_.options)==null?void 0:S.firstWeekContainsDate)??1,o=Hre(e,t),l=Ac(e,0);return l.setFullYear(o,0,n),l.setHours(0,0,0,0),Ph(l,t)}function Kre(e,t){const r=hi(e),n=+Ph(r,t)-+PAe(r,t);return Math.round(n/g4)+1}function ja(e,t){const r=e<0?"-":"",n=Math.abs(e).toString().padStart(t,"0");return r+n}const Wp={y(e,t){const r=e.getFullYear(),n=r>0?r:1-r;return ja(t==="yy"?n%100:n,t.length)},M(e,t){const r=e.getMonth();return t==="M"?String(r+1):ja(r+1,2)},d(e,t){return ja(e.getDate(),t.length)},a(e,t){const r=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(e,t){return ja(e.getHours()%12||12,t.length)},H(e,t){return ja(e.getHours(),t.length)},m(e,t){return ja(e.getMinutes(),t.length)},s(e,t){return ja(e.getSeconds(),t.length)},S(e,t){const r=t.length,n=e.getMilliseconds(),o=Math.trunc(n*Math.pow(10,r-3));return ja(o,t.length)}},bx={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},aW={G:function(e,t,r){const n=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return r.era(n,{width:"abbreviated"});case"GGGGG":return r.era(n,{width:"narrow"});case"GGGG":default:return r.era(n,{width:"wide"})}},y:function(e,t,r){if(t==="yo"){const n=e.getFullYear(),o=n>0?n:1-n;return r.ordinalNumber(o,{unit:"year"})}return Wp.y(e,t)},Y:function(e,t,r,n){const o=Hre(e,n),l=o>0?o:1-o;if(t==="YY"){const d=l%100;return ja(d,2)}return t==="Yo"?r.ordinalNumber(l,{unit:"year"}):ja(l,t.length)},R:function(e,t){const r=Vre(e);return ja(r,t.length)},u:function(e,t){const r=e.getFullYear();return ja(r,t.length)},Q:function(e,t,r){const n=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(n);case"QQ":return ja(n,2);case"Qo":return r.ordinalNumber(n,{unit:"quarter"});case"QQQ":return r.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(n,{width:"wide",context:"formatting"})}},q:function(e,t,r){const n=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(n);case"qq":return ja(n,2);case"qo":return r.ordinalNumber(n,{unit:"quarter"});case"qqq":return r.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(n,{width:"wide",context:"standalone"})}},M:function(e,t,r){const n=e.getMonth();switch(t){case"M":case"MM":return Wp.M(e,t);case"Mo":return r.ordinalNumber(n+1,{unit:"month"});case"MMM":return r.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(n,{width:"wide",context:"formatting"})}},L:function(e,t,r){const n=e.getMonth();switch(t){case"L":return String(n+1);case"LL":return ja(n+1,2);case"Lo":return r.ordinalNumber(n+1,{unit:"month"});case"LLL":return r.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(n,{width:"wide",context:"standalone"})}},w:function(e,t,r,n){const o=Kre(e,n);return t==="wo"?r.ordinalNumber(o,{unit:"week"}):ja(o,t.length)},I:function(e,t,r){const n=Gre(e);return t==="Io"?r.ordinalNumber(n,{unit:"week"}):ja(n,t.length)},d:function(e,t,r){return t==="do"?r.ordinalNumber(e.getDate(),{unit:"date"}):Wp.d(e,t)},D:function(e,t,r){const n=AAe(e);return t==="Do"?r.ordinalNumber(n,{unit:"dayOfYear"}):ja(n,t.length)},E:function(e,t,r){const n=e.getDay();switch(t){case"E":case"EE":case"EEE":return r.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(n,{width:"short",context:"formatting"});case"EEEE":default:return r.day(n,{width:"wide",context:"formatting"})}},e:function(e,t,r,n){const o=e.getDay(),l=(o-n.weekStartsOn+8)%7||7;switch(t){case"e":return String(l);case"ee":return ja(l,2);case"eo":return r.ordinalNumber(l,{unit:"day"});case"eee":return r.day(o,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(o,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(o,{width:"short",context:"formatting"});case"eeee":default:return r.day(o,{width:"wide",context:"formatting"})}},c:function(e,t,r,n){const o=e.getDay(),l=(o-n.weekStartsOn+8)%7||7;switch(t){case"c":return String(l);case"cc":return ja(l,t.length);case"co":return r.ordinalNumber(l,{unit:"day"});case"ccc":return r.day(o,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(o,{width:"narrow",context:"standalone"});case"cccccc":return r.day(o,{width:"short",context:"standalone"});case"cccc":default:return r.day(o,{width:"wide",context:"standalone"})}},i:function(e,t,r){const n=e.getDay(),o=n===0?7:n;switch(t){case"i":return String(o);case"ii":return ja(o,t.length);case"io":return r.ordinalNumber(o,{unit:"day"});case"iii":return r.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(n,{width:"short",context:"formatting"});case"iiii":default:return r.day(n,{width:"wide",context:"formatting"})}},a:function(e,t,r){const o=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(o,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(o,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(o,{width:"wide",context:"formatting"})}},b:function(e,t,r){const n=e.getHours();let o;switch(n===12?o=bx.noon:n===0?o=bx.midnight:o=n/12>=1?"pm":"am",t){case"b":case"bb":return r.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(o,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(o,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(o,{width:"wide",context:"formatting"})}},B:function(e,t,r){const n=e.getHours();let o;switch(n>=17?o=bx.evening:n>=12?o=bx.afternoon:n>=4?o=bx.morning:o=bx.night,t){case"B":case"BB":case"BBB":return r.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(o,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(o,{width:"wide",context:"formatting"})}},h:function(e,t,r){if(t==="ho"){let n=e.getHours()%12;return n===0&&(n=12),r.ordinalNumber(n,{unit:"hour"})}return Wp.h(e,t)},H:function(e,t,r){return t==="Ho"?r.ordinalNumber(e.getHours(),{unit:"hour"}):Wp.H(e,t)},K:function(e,t,r){const n=e.getHours()%12;return t==="Ko"?r.ordinalNumber(n,{unit:"hour"}):ja(n,t.length)},k:function(e,t,r){let n=e.getHours();return n===0&&(n=24),t==="ko"?r.ordinalNumber(n,{unit:"hour"}):ja(n,t.length)},m:function(e,t,r){return t==="mo"?r.ordinalNumber(e.getMinutes(),{unit:"minute"}):Wp.m(e,t)},s:function(e,t,r){return t==="so"?r.ordinalNumber(e.getSeconds(),{unit:"second"}):Wp.s(e,t)},S:function(e,t){return Wp.S(e,t)},X:function(e,t,r){const n=e.getTimezoneOffset();if(n===0)return"Z";switch(t){case"X":return sW(n);case"XXXX":case"XX":return Ey(n);case"XXXXX":case"XXX":default:return Ey(n,":")}},x:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"x":return sW(n);case"xxxx":case"xx":return Ey(n);case"xxxxx":case"xxx":default:return Ey(n,":")}},O:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+oW(n,":");case"OOOO":default:return"GMT"+Ey(n,":")}},z:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+oW(n,":");case"zzzz":default:return"GMT"+Ey(n,":")}},t:function(e,t,r){const n=Math.trunc(e.getTime()/1e3);return ja(n,t.length)},T:function(e,t,r){const n=e.getTime();return ja(n,t.length)}};function oW(e,t=""){const r=e>0?"-":"+",n=Math.abs(e),o=Math.trunc(n/60),l=n%60;return l===0?r+String(o):r+String(o)+t+ja(l,2)}function sW(e,t){return e%60===0?(e>0?"-":"+")+ja(Math.abs(e)/60,2):Ey(e,t)}function Ey(e,t=""){const r=e>0?"-":"+",n=Math.abs(e),o=ja(Math.trunc(n/60),2),l=ja(n%60,2);return r+o+t+l}const lW=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},Zre=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},CAe=(e,t)=>{const r=e.match(/(P+)(p+)?/)||[],n=r[1],o=r[2];if(!o)return lW(e,t);let l;switch(n){case"P":l=t.dateTime({width:"short"});break;case"PP":l=t.dateTime({width:"medium"});break;case"PPP":l=t.dateTime({width:"long"});break;case"PPPP":default:l=t.dateTime({width:"full"});break}return l.replace("{{date}}",lW(n,t)).replace("{{time}}",Zre(o,t))},OAe={p:Zre,P:CAe},kAe=/^D+$/,IAe=/^Y+$/,RAe=["D","DD","YY","YYYY"];function jAe(e){return kAe.test(e)}function NAe(e){return IAe.test(e)}function MAe(e,t,r){const n=DAe(e,t,r);if(console.warn(n),RAe.includes(e))throw new RangeError(n)}function DAe(e,t,r){const n=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${n} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const LAe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,FAe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,zAe=/^'([^]*?)'?$/,BAe=/''/g,$Ae=/[a-zA-Z]/;function Is(e,t,r){var S,E,T,C,N,I,j,D;const n=Rb(),o=(r==null?void 0:r.locale)??n.locale??_4,l=(r==null?void 0:r.firstWeekContainsDate)??((E=(S=r==null?void 0:r.locale)==null?void 0:S.options)==null?void 0:E.firstWeekContainsDate)??n.firstWeekContainsDate??((C=(T=n.locale)==null?void 0:T.options)==null?void 0:C.firstWeekContainsDate)??1,d=(r==null?void 0:r.weekStartsOn)??((I=(N=r==null?void 0:r.locale)==null?void 0:N.options)==null?void 0:I.weekStartsOn)??n.weekStartsOn??((D=(j=n.locale)==null?void 0:j.options)==null?void 0:D.weekStartsOn)??0,i=hi(e);if(!B2e(i))throw new RangeError("Invalid time value");let g=t.match(FAe).map(R=>{const F=R[0];if(F==="p"||F==="P"){const B=OAe[F];return B(R,o.formatLong)}return R}).join("").match(LAe).map(R=>{if(R==="''")return{isToken:!1,value:"'"};const F=R[0];if(F==="'")return{isToken:!1,value:UAe(R)};if(aW[F])return{isToken:!0,value:R};if(F.match($Ae))throw new RangeError("Format string contains an unescaped latin alphabet character `"+F+"`");return{isToken:!1,value:R}});o.localize.preprocessor&&(g=o.localize.preprocessor(i,g));const _={firstWeekContainsDate:l,weekStartsOn:d,locale:o};return g.map(R=>{if(!R.isToken)return R.value;const F=R.value;(!(r!=null&&r.useAdditionalWeekYearTokens)&&NAe(F)||!(r!=null&&r.useAdditionalDayOfYearTokens)&&jAe(F))&&MAe(F,t,String(e));const B=aW[F[0]];return B(i,F,o.localize,_)}).join("")}function UAe(e){const t=e.match(zAe);return t?t[1].replace(BAe,"'"):e}function VAe(e,t,r){const n=Rb(),o=(r==null?void 0:r.locale)??n.locale??_4,l=2520,d=xC(e,t);if(isNaN(d))throw new RangeError("Invalid time value");const i=Object.assign({},r,{addSuffix:r==null?void 0:r.addSuffix,comparison:d});let g,_;d>0?(g=hi(t),_=hi(e)):(g=hi(e),_=hi(t));const S=H2e(_,g),E=(F0(_)-F0(g))/1e3,T=Math.round((S-E)/60);let C;if(T<2)return r!=null&&r.includeSeconds?S<5?o.formatDistance("lessThanXSeconds",5,i):S<10?o.formatDistance("lessThanXSeconds",10,i):S<20?o.formatDistance("lessThanXSeconds",20,i):S<40?o.formatDistance("halfAMinute",0,i):S<60?o.formatDistance("lessThanXMinutes",1,i):o.formatDistance("xMinutes",1,i):T===0?o.formatDistance("lessThanXMinutes",1,i):o.formatDistance("xMinutes",T,i);if(T<45)return o.formatDistance("xMinutes",T,i);if(T<90)return o.formatDistance("aboutXHours",1,i);if(T<iW){const N=Math.round(T/60);return o.formatDistance("aboutXHours",N,i)}else{if(T<l)return o.formatDistance("xDays",1,i);if(T<LP){const N=Math.round(T/iW);return o.formatDistance("xDays",N,i)}else if(T<LP*2)return C=Math.round(T/LP),o.formatDistance("aboutXMonths",C,i)}if(C=G2e(_,g),C<12){const N=Math.round(T/LP);return o.formatDistance("xMonths",N,i)}else{const N=C%12,I=Math.trunc(C/12);return N<3?o.formatDistance("aboutXYears",I,i):N<9?o.formatDistance("overXYears",I,i):o.formatDistance("almostXYears",I+1,i)}}function og(e,t){return VAe(e,z2e(e),t)}function qAe(e){const t=hi(e),r=t.getFullYear(),n=t.getMonth(),o=Ac(e,0);return o.setFullYear(r,n+1,0),o.setHours(0,0,0,0),o.getDate()}function WAe(e){return Math.trunc(+hi(e)/1e3)}function GAe(e){const t=hi(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(0,0,0,0),t}function HAe(e,t){return $2e(GAe(e),Tc(e),t)+1}function E3(e,t){const r=hi(e),n=hi(t);return r.getTime()>n.getTime()}function Xre(e,t){const r=hi(e),n=hi(t);return+r<+n}function x4(e,t){const r=hi(e),n=hi(t);return r.getFullYear()===n.getFullYear()&&r.getMonth()===n.getMonth()}function KAe(e,t){const r=hi(e),n=hi(t);return r.getFullYear()===n.getFullYear()}function bC(e,t){return Fl(e,-t)}function XM(e,t){const r=hi(e),n=r.getFullYear(),o=r.getDate(),l=Ac(e,0);l.setFullYear(n,t,15),l.setHours(0,0,0,0);const d=qAe(l);return r.setMonth(t,Math.min(o,d)),r}function cW(e,t){const r=hi(e);return isNaN(+r)?Ac(e,NaN):(r.setFullYear(t),r)}const ZAe=()=>{const{t:e}=Ki(),{data:t=[]}=O2e(),{data:r=0}=k2e(),n=I2e(),o=R2e(),l=(i,g)=>{g||n.mutate(i)},d=i=>{switch(i){case"comment_reply":return"";case"new_activity":return"";case"activity_update":return"";case"new_user":return"";case"merchant_joined":return"";default:return""}};return m.jsxs(Iv,{children:[m.jsx(Rv,{asChild:!0,children:m.jsxs(ir,{variant:"ghost",size:"icon",className:"relative",children:[m.jsx(QY,{className:"h-5 w-5"}),r>0&&m.jsx(jn,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-xs",children:r>9?"9+":r})]})}),m.jsxs(ag,{align:"end",className:"w-80 max-h-[500px]",children:[m.jsxs(u4,{className:"flex items-center justify-between",children:[m.jsx("span",{children:e("notifications.title")}),r>0&&m.jsxs(ir,{variant:"ghost",size:"sm",onClick:()=>o.mutate(),disabled:o.isPending,children:[m.jsx(hye,{className:"h-4 w-4 mr-1"}),e("notifications.markAllRead")]})]}),m.jsx(Pf,{}),m.jsx(fv,{className:"h-[400px]",children:t.length===0?m.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e("notifications.noNotifications")}):t.map(i=>m.jsx(Oa,{className:`flex flex-col items-start p-3 cursor-pointer ${i.read?"":"bg-secondary/50"}`,asChild:!0,children:m.jsx(ia,{to:i.link||"#",onClick:()=>l(i.id,i.read),children:m.jsxs("div",{className:"flex items-start gap-2 w-full",children:[m.jsx("span",{className:"text-2xl",children:d(i.type)}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex items-center justify-between gap-2",children:[m.jsx("p",{className:"font-semibold text-sm truncate",children:i.title}),!i.read&&m.jsx(jn,{variant:"default",className:"h-2 w-2 p-0 rounded-full"})]}),m.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 mt-1",children:i.content}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:og(new Date(i.created_at),{addSuffix:!0})})]})]})})},i.id))})]})]})},XAe=()=>{var C,N,I,j,D,R,F,B;const[e,t]=W.useState(!1),{user:r,signOut:n}=Fi(),{t:o,i18n:l}=Ki(),{isAdmin:d,isSupervisor:i,isMerchant:g}=nu(),{data:_}=d4();W.useEffect(()=>{_!=null&&_.language_preference&&_.language_preference!==l.language&&l.changeLanguage(_.language_preference)},[_,l]);const S=W.useMemo(()=>[{to:"/",icon:ys,label:o("nav.map")},{to:"/restaurants",icon:tJ,label:o("nav.restaurants")},{to:"/activities",icon:Sc,label:o("nav.activities")},{to:"/map",icon:nJ,label:o("nav.mapView")},{to:"/join-us",icon:es,label:o("nav.joinUs")}],[o]),E=W.useCallback(()=>{n(),t(!1)},[n]),T=W.useCallback(()=>{t(!1)},[]);return m.jsx("nav",{className:"fixed top-0 left-0 right-0 z-50 bg-background/95 backdrop-blur-sm border-b border-border shadow-soft",children:m.jsxs("div",{className:"w-full px-3 sm:px-4 lg:px-6 h-14 sm:h-16 flex items-center justify-between",children:[m.jsx(ia,{to:"/",className:"flex items-center gap-2",children:m.jsx("img",{src:b1e,alt:"Logo",className:"w-[35px] h-[35px] md:w-[45px] md:h-[45px] object-contain drop-shadow-md"})}),m.jsx("div",{className:"hidden lg:flex items-center gap-6",children:S.map(U=>m.jsxs(ia,{to:U.to,className:"flex items-center gap-2 text-muted-foreground hover:text-primary transition-colors",children:[m.jsx(U.icon,{className:"w-4 h-4"}),m.jsx("span",{children:U.label})]},U.to))}),m.jsxs("div",{className:"flex items-center gap-1 sm:gap-3",children:[m.jsx(JTe,{}),r&&m.jsx(ZAe,{}),r?m.jsxs(Iv,{children:[m.jsx(Rv,{asChild:!0,children:m.jsx(ir,{variant:"ghost",size:"icon",className:"rounded-full h-8 w-8 sm:h-10 sm:w-10",children:m.jsxs(Gm,{className:"w-7 h-7 sm:w-8 sm:h-8",children:[m.jsx(Hm,{src:(_==null?void 0:_.avatar_url)||((C=r.user_metadata)==null?void 0:C.avatar_url)}),m.jsx(Km,{className:"text-xs sm:text-sm",children:((I=(N=_==null?void 0:_.display_name)==null?void 0:N[0])==null?void 0:I.toUpperCase())||((R=(D=(j=r.user_metadata)==null?void 0:j.display_name)==null?void 0:D[0])==null?void 0:R.toUpperCase())||((B=(F=r.email)==null?void 0:F[0])==null?void 0:B.toUpperCase())})]})})}),m.jsxs(ag,{align:"end",children:[m.jsx(u4,{children:o("nav.myAccount")}),m.jsx(Pf,{}),m.jsx(Oa,{asChild:!0,children:m.jsxs(ia,{to:"/profile",className:"cursor-pointer",children:[m.jsx(EM,{className:"w-4 h-4 mr-2"}),o("nav.profile")]})}),(g||i)&&m.jsx(Oa,{asChild:!0,children:m.jsxs(ia,{to:"/merchant-restaurants",className:"cursor-pointer",children:[m.jsx(es,{className:"w-4 h-4 mr-2"}),o("nav.manageRestaurants")]})}),(d||i)&&m.jsxs(m.Fragment,{children:[m.jsx(Pf,{}),m.jsx(Oa,{asChild:!0,children:m.jsxs(ia,{to:"/admin",className:"cursor-pointer",children:[m.jsx(fc,{className:"w-4 h-4 mr-2"}),o("nav.admin")]})})]}),m.jsx(Pf,{}),m.jsxs(Oa,{onClick:()=>n(),className:"cursor-pointer",children:[m.jsx(Aq,{className:"w-4 h-4 mr-2"}),o("nav.signOut")]})]})]}):m.jsx(ir,{asChild:!0,className:"hidden lg:flex",children:m.jsx(ia,{to:"/auth",children:o("nav.signIn")})}),m.jsxs(ote,{open:e,onOpenChange:t,children:[m.jsx(SSe,{asChild:!0,className:"lg:hidden",children:m.jsx(ir,{size:"icon",className:"h-8 w-8 sm:h-10 sm:w-10 bg-primary text-primary-foreground hover:bg-primary/90 rounded-lg",children:m.jsx(iJ,{className:"w-4 sm:w-5 h-4 sm:h-5"})})}),m.jsx(t4,{side:"right",className:"w-64 sm:w-80",children:m.jsxs("div",{className:"flex flex-col gap-4 mt-8",children:[S.map(U=>m.jsxs(ia,{to:U.to,onClick:T,className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[m.jsx(U.icon,{className:"w-5 h-5"}),m.jsx("span",{children:U.label})]},U.to)),m.jsx("div",{className:"border-t border-border my-4"}),r?m.jsxs(m.Fragment,{children:[m.jsxs(ia,{to:"/profile",onClick:T,className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[m.jsx(EM,{className:"w-5 h-5"}),m.jsx("span",{children:o("nav.profile")})]}),(g||i)&&m.jsxs(ia,{to:"/merchant-restaurants",onClick:T,className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[m.jsx(es,{className:"w-5 h-5"}),m.jsx("span",{children:o("nav.manageRestaurants")})]}),(d||i)&&m.jsxs(ia,{to:"/admin",onClick:T,className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[m.jsx(fc,{className:"w-5 h-5"}),m.jsx("span",{children:o("nav.admin")})]}),m.jsxs("button",{onClick:E,className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[m.jsx(Aq,{className:"w-5 h-5"}),m.jsx("span",{children:o("nav.signOut")})]})]}):m.jsxs(ia,{to:"/auth",onClick:T,className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[m.jsx(EM,{className:"w-5 h-5"}),m.jsx("span",{children:o("nav.signIn")})]})]})})]})]})]})})};function YAe(){const{pathname:e}=Rh();return W.useEffect(()=>{window.scrollTo(0,0)},[e]),null}const rn=W.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,className:yr("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));rn.displayName="Card";const Di=W.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,className:yr("flex flex-col space-y-1.5 p-6",e),...t}));Di.displayName="CardHeader";const Qi=W.forwardRef(({className:e,...t},r)=>m.jsx("h3",{ref:r,className:yr("text-2xl font-semibold leading-none tracking-tight",e),...t}));Qi.displayName="CardTitle";const Lo=W.forwardRef(({className:e,...t},r)=>m.jsx("p",{ref:r,className:yr("text-sm text-muted-foreground",e),...t}));Lo.displayName="CardDescription";const ln=W.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,className:yr("p-6 pt-0",e),...t}));ln.displayName="CardContent";const DI=W.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,className:yr("flex items-center p-6 pt-0",e),...t}));DI.displayName="CardFooter";const JAe="/assets/lisbon-hero-BSeJ4NyM.jpg",QAe="/assets/map-icon-CwlHKRle.png",Yre=W.memo(({stats:e,t})=>m.jsx("div",{className:"absolute top-3 sm:top-4 left-3 z-20",children:m.jsxs("div",{className:"gap-4 w-fit flex-col flex items-start justify-start",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(Oye,{className:"w-4 h-4 text-primary"}),m.jsx("span",{className:"text-sm text-muted-foreground",children:t("home.stats.delivery")}),m.jsx("span",{className:"font-bold text-foreground text-sm",children:e.order_count})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(cye,{className:"w-4 h-4 text-accent"}),m.jsx("span",{className:"text-sm text-muted-foreground",children:t("home.stats.reservation")}),m.jsx("span",{className:"font-bold text-foreground text-sm",children:e.reserve_count})]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-xl sm:text-2xl font-bold text-foreground",children:t("home.hero.brandName")}),m.jsx("img",{src:QAe,alt:"map icon",className:"w-5 sm:w-8 h-5 sm:h-8 object-contain flex-shrink-0"})]})]})}));Yre.displayName="StatsDisplay";const wC=W.memo(({to:e,Icon:t,title:r,desc:n,iconBg:o,iconColor:l,hoverBorderColor:d})=>m.jsx(ia,{to:e,children:m.jsxs(rn,{className:`group p-6 sm:p-8 border-border/50 ${d} transition-all hover:shadow-large cursor-pointer h-full`,children:[m.jsx("div",{className:`w-14 sm:w-16 h-14 sm:h-16 rounded-2xl ${o} flex items-center justify-center mb-4 sm:mb-6 group-hover:scale-110 transition-transform`,children:m.jsx(t,{className:`w-7 sm:w-8 h-7 sm:h-8 ${l}`})}),m.jsx("h3",{className:"text-xl sm:text-2xl font-semibold mb-2 sm:mb-3 text-card-foreground",children:r}),m.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground leading-relaxed flex items-center gap-2",children:[n,m.jsx(oye,{className:"w-4 h-4 flex-shrink-0 group-hover:translate-x-1 transition-transform"})]})]})}));wC.displayName="FeatureCard";const ePe=()=>{const{t:e}=Ki(),[t,r]=W.useState(null);return W.useEffect(()=>{(async()=>{try{const l=await(await fetch("https://v.xiaoxiong.pt/api/get_info")).json();l&&r({order_count:l.order_count||0,reserve_count:l.reserve_count||0})}catch(o){console.error("Failed to fetch stats:",o)}})()},[]),m.jsxs("div",{className:"min-h-screen",children:[m.jsxs("section",{className:"relative min-h-screen flex items-start overflow-hidden",children:[m.jsxs("div",{className:"absolute inset-0",children:[m.jsx("img",{src:JAe,alt:"Lisbon cityscape",className:"w-full h-full object-cover"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-background/90 via-background/70 to-background/90"})]}),t&&m.jsx(Yre,{stats:t,t:e}),m.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 flex items-center min-h-screen",children:m.jsxs("div",{className:"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full",children:[m.jsx(ia,{to:"/map",className:"inline-block",children:m.jsxs("div",{className:"inline-flex items-center gap-2 px-3 sm:px-4 py-1.5 sm:py-2 rounded-full bg-primary/10 border border-primary/20 backdrop-blur-sm hover:bg-primary/20 transition-colors cursor-pointer",children:[m.jsx(ys,{className:"w-3.5 sm:w-4 h-3.5 sm:h-4 text-primary"}),m.jsx("span",{className:"text-xs sm:text-sm font-medium text-primary",children:e("home.hero.subtitle")})]})}),m.jsx("h1",{className:"text-3xl sm:text-5xl md:text-7xl font-bold text-foreground leading-tight px-4 drop-shadow-lg",children:e("home.hero.title")}),m.jsx("p",{className:"text-sm sm:text-xl md:text-2xl text-foreground/80 max-w-2xl mx-auto px-4 drop-shadow-md",children:e("home.hero.description")}),m.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center pt-2 sm:pt-4 px-4",children:[m.jsx(ir,{size:"lg",asChild:!0,className:"text-base sm:text-lg shadow-lg hover:shadow-xl transition-shadow w-full sm:w-auto",children:m.jsxs(ia,{to:"/restaurants",children:[m.jsx(Cv,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),e("home.hero.exploreBtn")]})}),m.jsx(ir,{size:"lg",variant:"outline",asChild:!0,className:"text-base sm:text-lg w-full sm:w-auto backdrop-blur-sm",children:m.jsxs(ia,{to:"/activities",children:[m.jsx(Sc,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),e("home.hero.activitiesBtn")]})})]})]})})]}),m.jsx("section",{className:"py-16 sm:py-24 px-4 bg-secondary/20",children:m.jsxs("div",{className:"container mx-auto max-w-6xl",children:[m.jsxs("div",{className:"text-center mb-12 sm:mb-16",children:[m.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-foreground mb-3 sm:mb-4",children:e("home.features.title")}),m.jsx("p",{className:"text-base sm:text-lg text-muted-foreground max-w-2xl mx-auto px-4",children:e("home.features.description")})]}),m.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 sm:gap-8",children:[m.jsx(wC,{to:"/map",Icon:ys,title:e("home.features.map.title"),desc:e("home.features.map.desc"),iconBg:"bg-gradient-to-br from-primary to-primary-light",iconColor:"text-primary-foreground",hoverBorderColor:"hover:border-primary/50"}),m.jsx(wC,{to:"/restaurants",Icon:Ec,title:e("home.features.reviews.title"),desc:e("home.features.reviews.desc"),iconBg:"bg-gradient-to-br from-accent to-warning",iconColor:"text-accent-foreground",hoverBorderColor:"hover:border-accent/50"}),m.jsx("div",{className:"sm:col-span-2 md:col-span-1",children:m.jsx(wC,{to:"/activities",Icon:Sc,title:e("home.features.events.title"),desc:e("home.features.events.desc"),iconBg:"bg-gradient-to-br from-success to-accent",iconColor:"text-white",hoverBorderColor:"hover:border-success/50"})})]})]})}),m.jsxs("section",{className:"py-16 sm:py-20 px-4 bg-gradient-to-br from-primary via-primary-glow to-primary-light relative overflow-hidden",children:[m.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),m.jsx("div",{className:"absolute top-0 right-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl"}),m.jsx("div",{className:"absolute bottom-0 left-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl"}),m.jsxs("div",{className:"container mx-auto max-w-4xl text-center relative z-10",children:[m.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-primary-foreground mb-4 sm:mb-6 px-4",children:e("home.cta.title")}),m.jsx("p",{className:"text-base sm:text-xl text-primary-foreground/90 mb-6 sm:mb-8 max-w-2xl mx-auto px-4",children:e("home.cta.description")}),m.jsx(ir,{size:"lg",variant:"secondary",asChild:!0,className:"text-base sm:text-lg shadow-xl hover:shadow-2xl w-full sm:w-auto mx-4",children:m.jsxs(ia,{to:"/join-us",children:[m.jsx(sJ,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),e("home.cta.button")]})})]})]})]})},en=W.forwardRef(({className:e,type:t,...r},n)=>m.jsx("input",{type:t,className:yr("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:n,...r}));en.displayName="Input";var LI="Popover",[Jre,Xet]=Zs(LI,[rg]),GT=rg(),[tPe,sg]=Jre(LI),Qre=e=>{const{__scopePopover:t,children:r,open:n,defaultOpen:o,onOpenChange:l,modal:d=!1}=e,i=GT(t),g=W.useRef(null),[_,S]=W.useState(!1),[E,T]=Ru({prop:n,defaultProp:o??!1,onChange:l,caller:LI});return m.jsx(hI,{...i,children:m.jsx(tPe,{scope:t,contentId:Kc(),triggerRef:g,open:E,onOpenChange:T,onOpenToggle:W.useCallback(()=>T(C=>!C),[T]),hasCustomAnchor:_,onCustomAnchorAdd:W.useCallback(()=>S(!0),[]),onCustomAnchorRemove:W.useCallback(()=>S(!1),[]),modal:d,children:r})})};Qre.displayName=LI;var ene="PopoverAnchor",rPe=W.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,o=sg(ene,r),l=GT(r),{onCustomAnchorAdd:d,onCustomAnchorRemove:i}=o;return W.useEffect(()=>(d(),()=>i()),[d,i]),m.jsx(NT,{...l,...n,ref:t})});rPe.displayName=ene;var tne="PopoverTrigger",rne=W.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,o=sg(tne,r),l=GT(r),d=fi(t,o.triggerRef),i=m.jsx(wn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":sne(o.open),...n,ref:d,onClick:Rr(e.onClick,o.onOpenToggle)});return o.hasCustomAnchor?i:m.jsx(NT,{asChild:!0,...l,children:i})});rne.displayName=tne;var b4="PopoverPortal",[nPe,iPe]=Jre(b4,{forceMount:void 0}),nne=e=>{const{__scopePopover:t,forceMount:r,children:n,container:o}=e,l=sg(b4,t);return m.jsx(nPe,{scope:t,forceMount:r,children:m.jsx(_s,{present:r||l.open,children:m.jsx(bb,{asChild:!0,container:o,children:n})})})};nne.displayName=b4;var B0="PopoverContent",ine=W.forwardRef((e,t)=>{const r=iPe(B0,e.__scopePopover),{forceMount:n=r.forceMount,...o}=e,l=sg(B0,e.__scopePopover);return m.jsx(_s,{present:n||l.open,children:l.modal?m.jsx(oPe,{...o,ref:t}):m.jsx(sPe,{...o,ref:t})})});ine.displayName=B0;var aPe=Vm("PopoverContent.RemoveScroll"),oPe=W.forwardRef((e,t)=>{const r=sg(B0,e.__scopePopover),n=W.useRef(null),o=fi(t,n),l=W.useRef(!1);return W.useEffect(()=>{const d=n.current;if(d)return TI(d)},[]),m.jsx(LT,{as:aPe,allowPinchZoom:!0,children:m.jsx(ane,{...e,ref:o,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Rr(e.onCloseAutoFocus,d=>{var i;d.preventDefault(),l.current||(i=r.triggerRef.current)==null||i.focus()}),onPointerDownOutside:Rr(e.onPointerDownOutside,d=>{const i=d.detail.originalEvent,g=i.button===0&&i.ctrlKey===!0,_=i.button===2||g;l.current=_},{checkForDefaultPrevented:!1}),onFocusOutside:Rr(e.onFocusOutside,d=>d.preventDefault(),{checkForDefaultPrevented:!1})})})}),sPe=W.forwardRef((e,t)=>{const r=sg(B0,e.__scopePopover),n=W.useRef(!1),o=W.useRef(!1);return m.jsx(ane,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:l=>{var d,i;(d=e.onCloseAutoFocus)==null||d.call(e,l),l.defaultPrevented||(n.current||(i=r.triggerRef.current)==null||i.focus(),l.preventDefault()),n.current=!1,o.current=!1},onInteractOutside:l=>{var g,_;(g=e.onInteractOutside)==null||g.call(e,l),l.defaultPrevented||(n.current=!0,l.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const d=l.target;((_=r.triggerRef.current)==null?void 0:_.contains(d))&&l.preventDefault(),l.detail.originalEvent.type==="focusin"&&o.current&&l.preventDefault()}})}),ane=W.forwardRef((e,t)=>{const{__scopePopover:r,trapFocus:n,onOpenAutoFocus:o,onCloseAutoFocus:l,disableOutsidePointerEvents:d,onEscapeKeyDown:i,onPointerDownOutside:g,onFocusOutside:_,onInteractOutside:S,...E}=e,T=sg(B0,r),C=GT(r);return SI(),m.jsx(DT,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:o,onUnmountAutoFocus:l,children:m.jsx(Pv,{asChild:!0,disableOutsidePointerEvents:d,onInteractOutside:S,onEscapeKeyDown:i,onPointerDownOutside:g,onFocusOutside:_,onDismiss:()=>T.onOpenChange(!1),children:m.jsx(fI,{"data-state":sne(T.open),role:"dialog",id:T.contentId,...C,...E,ref:t,style:{...E.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),one="PopoverClose",lPe=W.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,o=sg(one,r);return m.jsx(wn.button,{type:"button",...n,ref:t,onClick:Rr(e.onClick,()=>o.onOpenChange(!1))})});lPe.displayName=one;var cPe="PopoverArrow",uPe=W.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,o=GT(r);return m.jsx(pI,{...o,...n,ref:t})});uPe.displayName=cPe;function sne(e){return e?"open":"closed"}var dPe=Qre,hPe=rne,fPe=nne,lne=ine;const EO=dPe,TO=hPe,jE=W.forwardRef(({className:e,align:t="center",sideOffset:r=4,...n},o)=>m.jsx(fPe,{children:m.jsx(lne,{ref:o,align:t,sideOffset:r,className:yr("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));jE.displayName=lne.displayName;const w4=(e,t)=>Li({queryKey:["restaurants",e,t],queryFn:async()=>{let r=qt.from("restaurants").select("*").eq("visible",!0).order("rating",{ascending:!1});if(e&&(r=r.or(`name.ilike.%${e}%,address.ilike.%${e}%`)),t){const d=t.split(",").flatMap(i=>[`type.cs.{${i}}`,`type_en.cs.{${i}}`,`type_pt.cs.{${i}}`]);r=r.or(d.join(","))}const{data:n,error:o}=await r;if(o)throw o;return n}}),pPe=e=>Li({queryKey:["restaurant",e],queryFn:async()=>{const{data:t,error:r}=await qt.from("restaurants").select("*").eq("id",e).single();if(r)throw r;return t},enabled:!!e}),cne=()=>{const{user:e}=Fi();return Li({queryKey:["favorites",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await qt.from("favorites").select("restaurant_id").eq("user_id",e.id);if(r)throw r;return t.map(n=>n.restaurant_id)},enabled:!!e})},une=()=>{const{user:e}=Fi(),t=Ma();return Ya({mutationFn:async r=>{if(!e)throw new Error("Must be logged in");const{data:n}=await qt.from("favorites").select("id").eq("user_id",e.id).eq("restaurant_id",r).maybeSingle();if(n){const{error:o}=await qt.from("favorites").delete().eq("id",n.id);if(o)throw o;return{action:"removed"}}else{const{error:o}=await qt.from("favorites").insert({user_id:e.id,restaurant_id:r});if(o)throw o;return{action:"added"}}},onSuccess:r=>{t.invalidateQueries({queryKey:["favorites"]}),Br.success(jr.t(r.action==="added"?"toast.favoriteAdded":"toast.favoriteRemoved"))},onError:r=>{r.message==="Must be logged in"?Br.error(jr.t("toast.signInToFavorite")):Br.error(jr.t("toast.favoritesUpdateFailed"))}})},dne=()=>Li({queryKey:["restaurant-types",jr.language],queryFn:async()=>{const e=jr.language,t=e==="zh"?"type":e==="pt"?"type_pt":"type_en",{data:r,error:n}=await qt.from("restaurants").select("type, type_en, type_pt").order("type");if(n)throw n;const o=r.flatMap(d=>d[t]||d.type_en||d.type||[]);return Array.from(new Set(o)).sort()}}),HT=(e,t,r,n)=>{const l=FP(r-e),d=FP(n-t),i=Math.sin(l/2)*Math.sin(l/2)+Math.cos(FP(e))*Math.cos(FP(r))*Math.sin(d/2)*Math.sin(d/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))},FP=e=>e*Math.PI/180,FI=()=>new Promise((e,t)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e,t,{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):t(new Error("Geolocation is not supported by this browser."))}),hne=(e,t,r)=>{const n=/iPad|iPhone|iPod/.test(navigator.userAgent),o=/Android/.test(navigator.userAgent);n?window.open(`maps://maps.apple.com/?daddr=${e},${t}&q=${encodeURIComponent(r)}`,"_blank"):o?window.open(`geo:${e},${t}?q=${e},${t}(${encodeURIComponent(r)})`,"_blank"):window.open(`https://www.google.com/maps/dir/?api=1&destination=${e},${t}`,"_blank")};var fne={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(gc,function(){var r,n,o;function l(i,g){if(!r)r=g;else if(!n)n=g;else{var _="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",S={};r(S),o=g(S),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(o.workerUrl=window.URL.createObjectURL(new Blob([_],{type:"text/javascript"})))}}l(["exports"],function(i){var g=1e-6,_=typeof Float32Array<"u"?Float32Array:Array;function S(u,a){var c=a[0],f=a[1],p=a[2],x=a[3],b=c*x-p*f;return b?(u[0]=x*(b=1/b),u[1]=-f*b,u[2]=-p*b,u[3]=c*b,u):null}function E(){var u=new _(9);return _!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}function T(u,a){var c=a[0],f=a[1],p=a[2],x=a[3],b=a[4],A=a[5],k=a[6],M=a[7],$=a[8];return u[0]=b*$-A*M,u[1]=p*M-f*$,u[2]=f*A-p*b,u[3]=A*k-x*$,u[4]=c*$-p*k,u[5]=p*x-c*A,u[6]=x*M-b*k,u[7]=f*k-c*M,u[8]=c*b-f*x,u}function C(u,a,c){var f=a[0],p=a[1],x=a[2],b=a[3],A=a[4],k=a[5],M=a[6],$=a[7],V=a[8],q=c[0],X=c[1],Y=c[2],se=c[3],ce=c[4],he=c[5],be=c[6],Ee=c[7],Oe=c[8];return u[0]=q*f+X*b+Y*M,u[1]=q*p+X*A+Y*$,u[2]=q*x+X*k+Y*V,u[3]=se*f+ce*b+he*M,u[4]=se*p+ce*A+he*$,u[5]=se*x+ce*k+he*V,u[6]=be*f+Ee*b+Oe*M,u[7]=be*p+Ee*A+Oe*$,u[8]=be*x+Ee*k+Oe*V,u}function N(){var u=new _(16);return _!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u}function I(u){var a=new _(16);return a[0]=u[0],a[1]=u[1],a[2]=u[2],a[3]=u[3],a[4]=u[4],a[5]=u[5],a[6]=u[6],a[7]=u[7],a[8]=u[8],a[9]=u[9],a[10]=u[10],a[11]=u[11],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15],a}function j(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function D(u,a){var c=a[0],f=a[1],p=a[2],x=a[3],b=a[4],A=a[5],k=a[6],M=a[7],$=a[8],V=a[9],q=a[10],X=a[11],Y=a[12],se=a[13],ce=a[14],he=a[15],be=c*A-f*b,Ee=c*k-p*b,Oe=c*M-x*b,Ue=f*k-p*A,Fe=f*M-x*A,Ke=p*M-x*k,Qe=$*se-V*Y,nt=$*ce-q*Y,Et=$*he-X*Y,ft=V*ce-q*se,Tt=V*he-X*se,It=q*he-X*ce,Dt=be*It-Ee*Tt+Oe*ft+Ue*Et-Fe*nt+Ke*Qe;return Dt?(u[0]=(A*It-k*Tt+M*ft)*(Dt=1/Dt),u[1]=(p*Tt-f*It-x*ft)*Dt,u[2]=(se*Ke-ce*Fe+he*Ue)*Dt,u[3]=(q*Fe-V*Ke-X*Ue)*Dt,u[4]=(k*Et-b*It-M*nt)*Dt,u[5]=(c*It-p*Et+x*nt)*Dt,u[6]=(ce*Oe-Y*Ke-he*Ee)*Dt,u[7]=($*Ke-q*Oe+X*Ee)*Dt,u[8]=(b*Tt-A*Et+M*Qe)*Dt,u[9]=(f*Et-c*Tt-x*Qe)*Dt,u[10]=(Y*Fe-se*Oe+he*be)*Dt,u[11]=(V*Oe-$*Fe-X*be)*Dt,u[12]=(A*nt-b*ft-k*Qe)*Dt,u[13]=(c*ft-f*nt+p*Qe)*Dt,u[14]=(se*Ee-Y*Ue-ce*be)*Dt,u[15]=($*Ue-V*Ee+q*be)*Dt,u):null}function R(u,a,c){var f=a[0],p=a[1],x=a[2],b=a[3],A=a[4],k=a[5],M=a[6],$=a[7],V=a[8],q=a[9],X=a[10],Y=a[11],se=a[12],ce=a[13],he=a[14],be=a[15],Ee=c[0],Oe=c[1],Ue=c[2],Fe=c[3];return u[0]=Ee*f+Oe*A+Ue*V+Fe*se,u[1]=Ee*p+Oe*k+Ue*q+Fe*ce,u[2]=Ee*x+Oe*M+Ue*X+Fe*he,u[3]=Ee*b+Oe*$+Ue*Y+Fe*be,u[4]=(Ee=c[4])*f+(Oe=c[5])*A+(Ue=c[6])*V+(Fe=c[7])*se,u[5]=Ee*p+Oe*k+Ue*q+Fe*ce,u[6]=Ee*x+Oe*M+Ue*X+Fe*he,u[7]=Ee*b+Oe*$+Ue*Y+Fe*be,u[8]=(Ee=c[8])*f+(Oe=c[9])*A+(Ue=c[10])*V+(Fe=c[11])*se,u[9]=Ee*p+Oe*k+Ue*q+Fe*ce,u[10]=Ee*x+Oe*M+Ue*X+Fe*he,u[11]=Ee*b+Oe*$+Ue*Y+Fe*be,u[12]=(Ee=c[12])*f+(Oe=c[13])*A+(Ue=c[14])*V+(Fe=c[15])*se,u[13]=Ee*p+Oe*k+Ue*q+Fe*ce,u[14]=Ee*x+Oe*M+Ue*X+Fe*he,u[15]=Ee*b+Oe*$+Ue*Y+Fe*be,u}function F(u,a,c){var f,p,x,b,A,k,M,$,V,q,X,Y,se=c[0],ce=c[1],he=c[2];return a===u?(u[12]=a[0]*se+a[4]*ce+a[8]*he+a[12],u[13]=a[1]*se+a[5]*ce+a[9]*he+a[13],u[14]=a[2]*se+a[6]*ce+a[10]*he+a[14],u[15]=a[3]*se+a[7]*ce+a[11]*he+a[15]):(p=a[1],x=a[2],b=a[3],A=a[4],k=a[5],M=a[6],$=a[7],V=a[8],q=a[9],X=a[10],Y=a[11],u[0]=f=a[0],u[1]=p,u[2]=x,u[3]=b,u[4]=A,u[5]=k,u[6]=M,u[7]=$,u[8]=V,u[9]=q,u[10]=X,u[11]=Y,u[12]=f*se+A*ce+V*he+a[12],u[13]=p*se+k*ce+q*he+a[13],u[14]=x*se+M*ce+X*he+a[14],u[15]=b*se+$*ce+Y*he+a[15]),u}function B(u,a,c){var f=c[0],p=c[1],x=c[2];return u[0]=a[0]*f,u[1]=a[1]*f,u[2]=a[2]*f,u[3]=a[3]*f,u[4]=a[4]*p,u[5]=a[5]*p,u[6]=a[6]*p,u[7]=a[7]*p,u[8]=a[8]*x,u[9]=a[9]*x,u[10]=a[10]*x,u[11]=a[11]*x,u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15],u}function U(u,a,c){var f=Math.sin(c),p=Math.cos(c),x=a[4],b=a[5],A=a[6],k=a[7],M=a[8],$=a[9],V=a[10],q=a[11];return a!==u&&(u[0]=a[0],u[1]=a[1],u[2]=a[2],u[3]=a[3],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15]),u[4]=x*p+M*f,u[5]=b*p+$*f,u[6]=A*p+V*f,u[7]=k*p+q*f,u[8]=M*p-x*f,u[9]=$*p-b*f,u[10]=V*p-A*f,u[11]=q*p-k*f,u}function Z(u,a,c){var f=Math.sin(c),p=Math.cos(c),x=a[0],b=a[1],A=a[2],k=a[3],M=a[8],$=a[9],V=a[10],q=a[11];return a!==u&&(u[4]=a[4],u[5]=a[5],u[6]=a[6],u[7]=a[7],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15]),u[0]=x*p-M*f,u[1]=b*p-$*f,u[2]=A*p-V*f,u[3]=k*p-q*f,u[8]=x*f+M*p,u[9]=b*f+$*p,u[10]=A*f+V*p,u[11]=k*f+q*p,u}function J(u,a,c){var f=Math.sin(c),p=Math.cos(c),x=a[0],b=a[1],A=a[2],k=a[3],M=a[4],$=a[5],V=a[6],q=a[7];return a!==u&&(u[8]=a[8],u[9]=a[9],u[10]=a[10],u[11]=a[11],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15]),u[0]=x*p+M*f,u[1]=b*p+$*f,u[2]=A*p+V*f,u[3]=k*p+q*f,u[4]=M*p-x*f,u[5]=$*p-b*f,u[6]=V*p-A*f,u[7]=q*p-k*f,u}function te(u,a){return u[0]=a[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=a[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=a[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function ae(u,a,c){var f,p,x,b=c[0],A=c[1],k=c[2],M=Math.sqrt(b*b+A*A+k*k);return M<g?null:(b*=M=1/M,A*=M,k*=M,f=Math.sin(a),p=Math.cos(a),u[0]=b*b*(x=1-p)+p,u[1]=A*b*x+k*f,u[2]=k*b*x-A*f,u[3]=0,u[4]=b*A*x-k*f,u[5]=A*A*x+p,u[6]=k*A*x+b*f,u[7]=0,u[8]=b*k*x+A*f,u[9]=A*k*x-b*f,u[10]=k*k*x+p,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u)}function ne(u,a){var c=a[0],f=a[1],p=a[2],x=a[4],b=a[5],A=a[6],k=a[8],M=a[9],$=a[10];return u[0]=Math.sqrt(c*c+f*f+p*p),u[1]=Math.sqrt(x*x+b*b+A*A),u[2]=Math.sqrt(k*k+M*M+$*$),u}function ie(u,a){var c=a[0],f=a[1],p=a[2],x=a[3],b=c+c,A=f+f,k=p+p,M=c*b,$=f*b,V=f*A,q=p*b,X=p*A,Y=p*k,se=x*b,ce=x*A,he=x*k;return u[0]=1-V-Y,u[1]=$+he,u[2]=q-ce,u[3]=0,u[4]=$-he,u[5]=1-M-Y,u[6]=X+se,u[7]=0,u[8]=q+ce,u[9]=X-se,u[10]=1-M-V,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}var ee=R;function oe(){var u=new _(3);return _!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u}function de(u){var a=new _(3);return a[0]=u[0],a[1]=u[1],a[2]=u[2],a}function xe(u){var a=u[0],c=u[1],f=u[2];return Math.sqrt(a*a+c*c+f*f)}function we(u,a,c){var f=new _(3);return f[0]=u,f[1]=a,f[2]=c,f}function Ae(u,a,c,f){return u[0]=a,u[1]=c,u[2]=f,u}function Ce(u,a,c){return u[0]=a[0]+c[0],u[1]=a[1]+c[1],u[2]=a[2]+c[2],u}function me(u,a,c){return u[0]=a[0]-c[0],u[1]=a[1]-c[1],u[2]=a[2]-c[2],u}function Pe(u,a,c){return u[0]=a[0]*c[0],u[1]=a[1]*c[1],u[2]=a[2]*c[2],u}function ye(u,a,c){return u[0]=Math.min(a[0],c[0]),u[1]=Math.min(a[1],c[1]),u[2]=Math.min(a[2],c[2]),u}function pe(u,a,c){return u[0]=Math.max(a[0],c[0]),u[1]=Math.max(a[1],c[1]),u[2]=Math.max(a[2],c[2]),u}function Ie(u,a,c){return u[0]=a[0]*c,u[1]=a[1]*c,u[2]=a[2]*c,u}function tt(u,a,c,f){return u[0]=a[0]+c[0]*f,u[1]=a[1]+c[1]*f,u[2]=a[2]+c[2]*f,u}function Ze(u,a){var c=a[0]-u[0],f=a[1]-u[1],p=a[2]-u[2];return Math.sqrt(c*c+f*f+p*p)}function Le(u,a){var c=a[0]-u[0],f=a[1]-u[1],p=a[2]-u[2];return c*c+f*f+p*p}function qe(u){var a=u[0],c=u[1],f=u[2];return a*a+c*c+f*f}function Ge(u,a){return u[0]=-a[0],u[1]=-a[1],u[2]=-a[2],u}function je(u,a){var c=a[0],f=a[1],p=a[2],x=c*c+f*f+p*p;return x>0&&(x=1/Math.sqrt(x)),u[0]=a[0]*x,u[1]=a[1]*x,u[2]=a[2]*x,u}function ot(u,a){return u[0]*a[0]+u[1]*a[1]+u[2]*a[2]}function St(u,a,c){var f=a[0],p=a[1],x=a[2],b=c[0],A=c[1],k=c[2];return u[0]=p*k-x*A,u[1]=x*b-f*k,u[2]=f*A-p*b,u}function rt(u,a,c,f){var p=a[0],x=a[1],b=a[2];return u[0]=p+f*(c[0]-p),u[1]=x+f*(c[1]-x),u[2]=b+f*(c[2]-b),u}function Ut(u,a,c){var f=a[0],p=a[1],x=a[2],b=c[3]*f+c[7]*p+c[11]*x+c[15];return u[0]=(c[0]*f+c[4]*p+c[8]*x+c[12])/(b=b||1),u[1]=(c[1]*f+c[5]*p+c[9]*x+c[13])/b,u[2]=(c[2]*f+c[6]*p+c[10]*x+c[14])/b,u}function Ft(u,a,c){var f=a[0],p=a[1],x=a[2];return u[0]=f*c[0]+p*c[3]+x*c[6],u[1]=f*c[1]+p*c[4]+x*c[7],u[2]=f*c[2]+p*c[5]+x*c[8],u}function dr(u,a,c){var f=c[0],p=c[1],x=c[2],b=c[3],A=a[0],k=a[1],M=a[2],$=p*M-x*k,V=x*A-f*M,q=f*k-p*A;return u[0]=A+b*($+=$)+p*(q+=q)-x*(V+=V),u[1]=k+b*V+x*$-f*q,u[2]=M+b*q+f*V-p*$,u}function Lr(u){return u[0]=0,u[1]=0,u[2]=0,u}function Jr(u,a){return u[0]===a[0]&&u[1]===a[1]&&u[2]===a[2]}var Rt=me,At=Pe,Xe=xe;function ut(){var u=new _(4);return _!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0,u[3]=0),u}function dt(u,a,c){return u[0]=a[0]*c,u[1]=a[1]*c,u[2]=a[2]*c,u[3]=a[3]*c,u}function rr(u,a){var c=a[0],f=a[1],p=a[2],x=a[3],b=c*c+f*f+p*p+x*x;return b>0&&(b=1/Math.sqrt(b)),u[0]=c*b,u[1]=f*b,u[2]=p*b,u[3]=x*b,u}function er(u,a,c){var f=a[0],p=a[1],x=a[2],b=a[3];return u[0]=c[0]*f+c[4]*p+c[8]*x+c[12]*b,u[1]=c[1]*f+c[5]*p+c[9]*x+c[13]*b,u[2]=c[2]*f+c[6]*p+c[10]*x+c[14]*b,u[3]=c[3]*f+c[7]*p+c[11]*x+c[15]*b,u}function tr(){var u=new _(4);return _!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u[3]=1,u}function Pr(u){return u[0]=0,u[1]=0,u[2]=0,u[3]=1,u}function un(u,a,c){c*=.5;var f=a[0],p=a[1],x=a[2],b=a[3],A=Math.sin(c),k=Math.cos(c);return u[0]=f*k+b*A,u[1]=p*k+x*A,u[2]=x*k-p*A,u[3]=b*k-f*A,u}function pn(u,a,c){c*=.5;var f=a[0],p=a[1],x=a[2],b=a[3],A=Math.sin(c),k=Math.cos(c);return u[0]=f*k-x*A,u[1]=p*k+b*A,u[2]=x*k+f*A,u[3]=b*k-p*A,u}oe(),ut();var Pi,gi,Zi,js=rr,Va=(Pi=oe(),gi=we(1,0,0),Zi=we(0,1,0),function(u,a,c){var f=ot(a,c);return f<-.999999?(St(Pi,gi,a),Xe(Pi)<1e-6&&St(Pi,Zi,a),je(Pi,Pi),function(p,x,b){b*=.5;var A=Math.sin(b);p[0]=A*x[0],p[1]=A*x[1],p[2]=A*x[2],p[3]=Math.cos(b)}(u,Pi,Math.PI),u):f>.999999?(u[0]=0,u[1]=0,u[2]=0,u[3]=1,u):(St(Pi,a,c),u[0]=Pi[0],u[1]=Pi[1],u[2]=Pi[2],u[3]=1+f,js(u,u))});function Si(){var u=new _(2);return _!=Float32Array&&(u[0]=0,u[1]=0),u}function bs(u,a){var c=new _(2);return c[0]=u,c[1]=a,c}function Bo(u,a,c){return u[0]=a,u[1]=c,u}function Ns(u,a,c){return u[0]=a[0]+c[0],u[1]=a[1]+c[1],u}function $o(u,a,c){return u[0]=a[0]-c[0],u[1]=a[1]-c[1],u}function rs(u,a,c){return u[0]=a[0]*c,u[1]=a[1]*c,u}function Ni(u){var a=u[0],c=u[1];return Math.sqrt(a*a+c*c)}function so(u,a){var c=a[0],f=a[1],p=c*c+f*f;return p>0&&(p=1/Math.sqrt(p)),u[0]=a[0]*p,u[1]=a[1]*p,u}function gl(u,a){return u[0]*a[0]+u[1]*a[1]}tr(),tr(),E();var xr,Sn,kn=$o;function Ii(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}Si();var pa=function(){if(Sn)return xr;function u(a,c,f,p){this.cx=3*a,this.bx=3*(f-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(p-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=c,this.p2x=f,this.p2y=p}return Sn=1,xr=u,u.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,c){if(c===void 0&&(c=1e-6),a<0)return 0;if(a>1)return 1;for(var f=a,p=0;p<8;p++){var x=this.sampleCurveX(f)-a;if(Math.abs(x)<c)return f;var b=this.sampleCurveDerivativeX(f);if(Math.abs(b)<1e-6)break;f-=x/b}var A=0,k=1;for(f=a,p=0;p<20&&(x=this.sampleCurveX(f),!(Math.abs(x-a)<c));p++)a>x?A=f:k=f,f=.5*(k-A)+A;return f},solve:function(a,c){return this.sampleCurveY(this.solveCurveX(a,c))}},xr}(),Uo=Ii(pa);function Mt(u,a){this.x=u,this.y=a}function Vo(u,a){if(Array.isArray(u)){if(!Array.isArray(a)||u.length!==a.length)return!1;for(let c=0;c<u.length;c++)if(!Vo(u[c],a[c]))return!1;return!0}if(typeof u=="object"&&u!==null&&a!==null){if(typeof a!="object"||Object.keys(u).length!==Object.keys(a).length)return!1;for(const c in u)if(!Vo(u[c],a[c]))return!1;return!0}return u===a}Mt.prototype={clone(){return new Mt(this.x,this.y)},add(u){return this.clone()._add(u)},sub(u){return this.clone()._sub(u)},multByPoint(u){return this.clone()._multByPoint(u)},divByPoint(u){return this.clone()._divByPoint(u)},mult(u){return this.clone()._mult(u)},div(u){return this.clone()._div(u)},rotate(u){return this.clone()._rotate(u)},rotateAround(u,a){return this.clone()._rotateAround(u,a)},matMult(u){return this.clone()._matMult(u)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(u){return this.x===u.x&&this.y===u.y},dist(u){return Math.sqrt(this.distSqr(u))},distSqr(u){const a=u.x-this.x,c=u.y-this.y;return a*a+c*c},angle(){return Math.atan2(this.y,this.x)},angleTo(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith(u){return this.angleWithSep(u.x,u.y)},angleWithSep(u,a){return Math.atan2(this.x*a-this.y*u,this.x*u+this.y*a)},_matMult(u){const a=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=a,this},_add(u){return this.x+=u.x,this.y+=u.y,this},_sub(u){return this.x-=u.x,this.y-=u.y,this},_mult(u){return this.x*=u,this.y*=u,this},_div(u){return this.x/=u,this.y/=u,this},_multByPoint(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint(u){return this.x/=u.x,this.y/=u.y,this},_unit(){return this._div(this.mag()),this},_perp(){const u=this.y;return this.y=this.x,this.x=-u,this},_rotate(u){const a=Math.cos(u),c=Math.sin(u),f=c*this.x+a*this.y;return this.x=a*this.x-c*this.y,this.y=f,this},_rotateAround(u,a){const c=Math.cos(u),f=Math.sin(u),p=a.y+f*(this.x-a.x)+c*(this.y-a.y);return this.x=a.x+c*(this.x-a.x)-f*(this.y-a.y),this.y=p,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Mt},Mt.convert=function(u){if(u instanceof Mt)return u;if(Array.isArray(u))return new Mt(+u[0],+u[1]);if(u.x!==void 0&&u.y!==void 0)return new Mt(+u.x,+u.y);throw new Error("Expected [x, y] or {x, y} point format")};const yl=Math.PI/180,ns=180/Math.PI;function bn(u){return u*yl}function is(u){return u*ns}const Kb=[[0,0],[1,0],[1,1],[0,1]];function pg(u){if(u<=0)return 0;if(u>=1)return 1;const a=u*u,c=a*u;return 4*(u<.5?c:3*(u-a)+c-.75)}function ct(u,a,c,f){const p=new Uo(u,a,c,f);return function(x){return p.solve(x)}}const fe=ct(.25,.1,.25,1);function ve(u,a,c){return Math.min(c,Math.max(a,u))}function Me(u,a,c){return(c=ve((c-u)/(a-u),0,1))*c*(3-2*c)}function Je(u,a,c){const f=c-a,p=((u-a)%f+f)%f+a;return p===a?c:p}function Ye(u,a,c){if(!u.length)return c(null,[]);let f=u.length;const p=new Array(u.length);let x=null;u.forEach((b,A)=>{a(b,(k,M)=>{k&&(x=k),p[A]=M,--f==0&&c(x,p)})})}let at=1;function _t(){return at++}function st(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log2(u)))}function yt(u,a){u.forEach(c=>{a[c]&&(a[c]=a[c].bind(a))})}function Kt(u,a,c){const f={};for(const p in u)f[p]=a.call(this,u[p],p,u);return f}function Bt(u,a,c){const f={};for(const p in u)a.call(this,u[p],p,u)&&(f[p]=u[p]);return f}function Tr(u){return Array.isArray(u)?u.map(Tr):typeof u=="object"&&u?Kt(u,Tr):u}function Kr(u,a){for(let c=0;c<u.length;c++)if(a.indexOf(u[c])>=0)return!0;return!1}const Wr={};function Ir(u){Wr[u]||(typeof console<"u"&&console.warn(u),Wr[u]=!0)}function yn(u,a,c){return(c.y-u.y)*(a.x-u.x)>(a.y-u.y)*(c.x-u.x)}function En(u){let a=0;for(let c,f,p=0,x=u.length,b=x-1;p<x;b=p++)c=u[p],f=u[b],a+=(f.x-c.x)*(c.y+f.y);return a}function pi([u,a,c]){const f=bn(a+90),p=bn(c);return{x:u*Math.cos(f)*Math.sin(p),y:u*Math.sin(f)*Math.sin(p),z:u*Math.cos(p),azimuthal:a,polar:c}}function ca(u){return(typeof self<"u"||u!==void 0)&&typeof WorkerGlobalScope<"u"&&(u!==void 0?u:self)instanceof WorkerGlobalScope}function za(u){const a={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,f,p,x)=>{const b=p||x;return a[f]=!b||b.toLowerCase(),""}),a["max-age"]){const c=parseInt(a["max-age"],10);isNaN(c)?delete a["max-age"]:a["max-age"]=c}return a}let Ea=null;function xa(u,a){return[u[4*a],u[4*a+1],u[4*a+2],u[4*a+3]]}function ci(u,a,c,f){for(;a<c;){const p=a+c>>1;u[p]<f?a=p+1:c=p}return a}function Nn(u,a,c,f){for(;a<c;){const p=a+c>>1;u[p]<=f?a=p+1:c=p}return a}function zi(u){return u>0?1/(1.001-u):1+u}function aa(u){return u>0?1-1/(1.001-u):-u}function yi(u,a,c){return(u-a.min)*(c.max-c.min)/(a.max-a.min)+c.min}const Bi={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Bi.API_URL)return null;try{const u=new URL(Bi.API_URL);return u.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":u.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Qa(u){return Bi.API_URL_REGEX.test(u)}function as(u){return Bi.API_SPRITE_REGEX.test(u)}let Yl,Lh,lo,Jl,ws,Cc;function Xs(){return Yl==null&&(Yl=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Yl}const Ys={now:()=>Jl!==void 0?Jl:performance.now(),setNow(u){Jl=u},restoreNow(){Jl=void 0},frame(u){const a=requestAnimationFrame(u);return{cancel:()=>cancelAnimationFrame(a)}},getImageData(u,a=0){const{width:c,height:f}=u;ws||(ws=document.createElement("canvas"));const p=ws.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(c>ws.width||f>ws.height)&&(ws.width=c,ws.height=f),p.clearRect(-a,-a,c+2*a,f+2*a),p.drawImage(u,0,0,c,f),p.getImageData(-a,-a,c+2*a,f+2*a)},resolveURL:u=>(Lh||(Lh=document.createElement("a")),Lh.href=u,Lh.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(lo==null&&(lo=window.matchMedia("(prefers-reduced-motion: reduce)")),lo.matches)},hasCanvasFingerprintNoise(){if(Cc!==void 0)return Cc;if(!Xs())return Cc=!1,!1;const u=new OffscreenCanvas(85,1),a=u.getContext("2d",{willReadFrequently:!0});let c=0;for(let p=0;p<u.width;++p)a.fillStyle=`rgba(${c++},${c++},${c++}, 255)`,a.fillRect(p,0,1,1);const f=a.getImageData(0,0,u.width,u.height);c=0;for(let p=0;p<f.data.length;++p)if(p%4!=3&&c++!==f.data[p])return Cc=!0,!0;return Cc=!1,!1}};function Fv(u,a){const c=u.indexOf("?");if(c<0)return`${u}?${new URLSearchParams(a).toString()}`;const f=new URLSearchParams(u.slice(c));for(const p in a)f.set(p,a[p]);return`${u.slice(0,c)}?${f.toString()}`}function mg(u,a={persistentParams:[]}){const c=u.indexOf("?");if(c<0)return u;const f=new URLSearchParams,p=new URLSearchParams(u.slice(c));for(const b of a.persistentParams){const A=p.get(b);A&&f.set(b,A)}const x=f.toString();return`${u.slice(0,c)}${x.length>0?`?${x}`:""}`}const gg="mapbox-tiles";let yg=500,Ms=50;const Oc=["language","worldview","jobid"];let Ss,vl;function zu(){try{return caches}catch{}}function Fh(){const u=zu();u&&Ss==null&&(Ss=u.open(gg))}let zv=1/0;const Bv={supported:!1,testSupport:function(u){!Zb&&Ld&&(u2?Xb(u):iu=u)}};let iu,Ld,Zb=!1,u2=!1;const Ql=typeof self<"u"?self:{};function Xb(u){const a=u.createTexture();u.bindTexture(u.TEXTURE_2D,a);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,Ld),u.isContextLost())return;Bv.supported=!0}catch{}u.deleteTexture(a),Zb=!0}Ql.document&&(Ld=Ql.document.createElement("img"),Ld.onload=function(){iu&&Xb(iu),iu=null,u2=!0},Ld.onerror=function(){Zb=!0,iu=null},Ld.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const zh={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(zh);class Bh extends Error{constructor(a,c,f){c===401&&Qa(f)&&(a+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(a),this.status=c,this.url=f}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Yb=ca()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,vg=function(u,a){if(!(/^file:/.test(c=u.url)||/^file:/.test(Yb())&&!/^\w+:/.test(c))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(f,p){const x=new AbortController,b=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:Yb(),referrerPolicy:f.referrerPolicy,signal:x.signal});let A=!1,k=!1;const M=($=b.url).indexOf("sku=")>0&&Qa($);var $;f.type==="json"&&b.headers.set("Accept","application/json");const V=(X,Y,se)=>{if(k)return;if(X&&X.message!=="SecurityError"&&Ir(X.toString()),Y&&se)return q(Y);const ce=Date.now();fetch(b).then(he=>{if(he.ok){const be=M?he.clone():null;return q(he,be,ce)}return p(new Bh(he.statusText,he.status,f.url))}).catch(he=>{he.name!=="AbortError"&&p(new Error(`${he.message} ${f.url}`))})},q=(X,Y,se)=>{(f.type==="arrayBuffer"?X.arrayBuffer():f.type==="json"?X.json():X.text()).then(ce=>{k||(Y&&se&&function(he,be,Ee){if(Fh(),Ss==null)return;const Oe=za(be.headers.get("Cache-Control")||"");if(Oe["no-store"])return;const Ue={status:be.status,statusText:be.statusText,headers:new Headers};be.headers.forEach((Qe,nt)=>Ue.headers.set(nt,Qe)),Oe["max-age"]&&Ue.headers.set("Expires",new Date(Ee+1e3*Oe["max-age"]).toUTCString());const Fe=Ue.headers.get("Expires");if(!Fe||new Date(Fe).getTime()-Ee<42e4)return;let Ke=mg(he.url,{persistentParams:Oc});if(be.status===206){const Qe=he.headers.get("Range");if(!Qe)return;Ue.status=200,Ke=Fv(Ke,{range:Qe})}(function(Qe,nt){if(vl===void 0)try{new Response(new ReadableStream),vl=!0}catch{vl=!1}vl?nt(Qe.body):Qe.blob().then(nt).catch(Et=>Ir(Et.message))})(be,Qe=>{const nt=new Response((Et=be.status)!==200&&Et!==404&&[101,103,204,205,304].includes(Et)?null:Qe,Ue);var Et;Fh(),Ss!=null&&Ss.then(ft=>ft.put(Ke,nt)).catch(ft=>Ir(ft.message))})}(b,Y,se),A=!0,p(null,ce,X.headers))}).catch(ce=>{k||p(new Error(ce.message))})};return M?function(X,Y){if(Fh(),Ss==null)return Y(null);Ss.then(se=>{let ce=mg(X.url,{persistentParams:Oc});const he=X.headers.get("Range");he&&(ce=Fv(ce,{range:he})),se.match(ce).then(be=>{const Ee=function(Oe){if(!Oe)return!1;const Ue=new Date(Oe.headers.get("Expires")||0),Fe=za(Oe.headers.get("Cache-Control")||"");return Number(Ue)>Date.now()&&!Fe["no-cache"]}(be);se.delete(ce).catch(Y),Ee&&se.put(ce,be.clone()).catch(Y),Y(null,be,Ee)}).catch(Y)}).catch(Y)}(b,V):V(null,null),{cancel:()=>{k=!0,A||x.abort()}}}(u,a);if(ca(self)&&self.worker.actor)return self.worker.actor.send("getResource",u,a,void 0,!0)}var c;return function(f,p){const x=new XMLHttpRequest;x.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(x.responseType="arraybuffer");for(const b in f.headers)x.setRequestHeader(b,f.headers[b]);return f.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=f.credentials==="include",x.onerror=()=>{p(new Error(x.statusText))},x.onload=()=>{if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let b=x.response;if(f.type==="json")try{b=JSON.parse(x.response)}catch(k){return p(k)}const A=new Headers;x.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(k=>{const M=k.split(": "),$=M.shift(),V=M.join(": ");A.append($,V)}),p(null,b,A)}else p(new Bh(x.statusText,x.status,f.url))},x.send(f.body),{cancel:()=>x.abort()}}(u,a)},Xf=function(u,a){return vg(Object.assign(u,{type:"arrayBuffer"}),a)};function Yn(u){const a=document.createElement("a");return a.href=u,a.protocol===location.protocol&&a.host===location.host}const Jb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let _g,xg;_g=[],xg=0;const Qb=function(u,a){if(Bv.supported&&(u.headers||(u.headers={}),u.headers.accept="image/webp,*/*"),xg>=Bi.MAX_PARALLEL_IMAGE_REQUESTS){const x={requestParameters:u,callback:a,cancelled:!1,cancel(){this.cancelled=!0}};return _g.push(x),x}xg++;let c=!1;const f=()=>{if(!c)for(c=!0,xg--;_g.length&&xg<Bi.MAX_PARALLEL_IMAGE_REQUESTS;){const x=_g.shift(),{requestParameters:b,callback:A,cancelled:k}=x;k||(x.cancel=Qb(b,A).cancel)}},p=Xf(u,(x,b,A)=>{f(),x?a(x):b&&(self.createImageBitmap?function(k,M){const $=new Blob([new Uint8Array(k)],{type:"image/png"});createImageBitmap($).then(V=>{M(null,V)}).catch(V=>{M(new Error(`Could not load image because of ${V.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(b,(k,M)=>a(k,M,A)):function(k,M){const $=new Image;$.onload=()=>{M(null,$),URL.revokeObjectURL($.src),$.onload=null,requestAnimationFrame(()=>{$.src=Jb})},$.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const V=new Blob([new Uint8Array(k)],{type:"image/png"});$.src=k.byteLength?URL.createObjectURL(V):Jb}(b,(k,M)=>a(k,M,A)))});return{cancel:()=>{p.cancel(),f()}}};var bg,wg,Sg,$h={exports:{}},d2={exports:{}},$v={exports:{}},WR=function(){if(Sg)return $h.exports;Sg=1;var u=(bg||(bg=1,d2.exports=function(c,f){var p,x,b,A,k,M,$,V;for(x=c.length-(p=3&c.length),b=f,k=3432918353,M=461845907,V=0;V<x;)$=255&c.charCodeAt(V)|(255&c.charCodeAt(++V))<<8|(255&c.charCodeAt(++V))<<16|(255&c.charCodeAt(++V))<<24,++V,b=27492+(65535&(A=5*(65535&(b=(b^=$=(65535&($=($=(65535&$)*k+((($>>>16)*k&65535)<<16)&4294967295)<<15|$>>>17))*M+((($>>>16)*M&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(A>>>16)&65535)<<16);switch($=0,p){case 3:$^=(255&c.charCodeAt(V+2))<<16;case 2:$^=(255&c.charCodeAt(V+1))<<8;case 1:b^=$=(65535&($=($=(65535&($^=255&c.charCodeAt(V)))*k+((($>>>16)*k&65535)<<16)&4294967295)<<15|$>>>17))*M+((($>>>16)*M&65535)<<16)&4294967295}return b^=c.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}),d2.exports),a=(wg||(wg=1,$v.exports=function(c,f){for(var p,x=c.length,b=f^x,A=0;x>=4;)p=1540483477*(65535&(p=255&c.charCodeAt(A)|(255&c.charCodeAt(++A))<<8|(255&c.charCodeAt(++A))<<16|(255&c.charCodeAt(++A))<<24))+((1540483477*(p>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),x-=4,++A;switch(x){case 3:b^=(255&c.charCodeAt(A+2))<<16;case 2:b^=(255&c.charCodeAt(A+1))<<8;case 1:b=1540483477*(65535&(b^=255&c.charCodeAt(A)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}),$v.exports);return $h.exports=u,$h.exports.murmur3=u,$h.exports.murmur2=a,$h.exports}(),Eg=Ii(WR);class _l{constructor(a,...c){Object.assign(this,c[0]||{}),this.type=a}}class Tg extends _l{constructor(a,c={}){super("error",Object.assign({error:a},c))}}function Yf(u,a,c){c[u]&&c[u].indexOf(a)!==-1||(c[u]=c[u]||[],c[u].push(a))}function Ag(u,a,c){if(c&&c[u]){const f=c[u].indexOf(a);f!==-1&&c[u].splice(f,1)}}class Bu{on(a,c){return this._listeners=this._listeners||{},Yf(a,c,this._listeners),this}off(a,c){return Ag(a,c,this._listeners),Ag(a,c,this._oneTimeListeners),this}once(a,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},Yf(a,c,this._oneTimeListeners),this):new Promise(f=>{this.once(a,f)})}fire(a,c){const f=typeof a=="string"?new _l(a,c):a,p=f.type;if(this.listens(p)){f.target=this;const x=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const k of x)k.call(this,f);const b=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const k of b)Ag(p,k,this._oneTimeListeners),k.call(this,f);const A=this._eventedParent;if(A){const k=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(f,k),A.fire(f)}}else f instanceof Tg&&console.error(f.error);return this}listens(a){return!!(this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a))}setEventedParent(a,c){return this._eventedParent=a,this._eventedParentData=c,this}}class eo{constructor(a){typeof a=="string"?this.name=a:(this.name=a.name,this.iconsetId=a.iconsetId)}static from(a){return new eo(a)}static toString(a){return a.iconsetId?`${a.name}${a.iconsetId}`:a.name}static parse(a){const[c,f]=a.split("");return new eo({name:c,iconsetId:f})}static isEqual(a,c){return a.name===c.name&&a.iconsetId===c.iconsetId}toString(){return eo.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var ew,tw={},rw=function(){if(ew)return tw;ew=1;var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function a(x){return(x=Math.round(x))<0?0:x>255?255:x}function c(x){return a(x[x.length-1]==="%"?parseFloat(x)/100*255:parseInt(x))}function f(x){return(b=x[x.length-1]==="%"?parseFloat(x)/100:parseFloat(x))<0?0:b>1?1:b;var b}function p(x,b,A){return A<0?A+=1:A>1&&(A-=1),6*A<1?x+(b-x)*A*6:2*A<1?b:3*A<2?x+(b-x)*(2/3-A)*6:x}try{tw.parseCSSColor=function(x){var b,A=x.replace(/ /g,"").toLowerCase();if(A in u)return u[A].slice();if(A[0]==="#")return A.length===4?(b=parseInt(A.substr(1),16))>=0&&b<=4095?[(3840&b)>>4|(3840&b)>>8,240&b|(240&b)>>4,15&b|(15&b)<<4,1]:null:A.length===7&&(b=parseInt(A.substr(1),16))>=0&&b<=16777215?[(16711680&b)>>16,(65280&b)>>8,255&b,1]:null;var k=A.indexOf("("),M=A.indexOf(")");if(k!==-1&&M+1===A.length){var $=A.substr(0,k),V=A.substr(k+1,M-(k+1)).split(","),q=1;switch($){case"rgba":if(V.length!==4)return null;q=f(V.pop());case"rgb":return V.length!==3?null:[c(V[0]),c(V[1]),c(V[2]),q];case"hsla":if(V.length!==4)return null;q=f(V.pop());case"hsl":if(V.length!==3)return null;var X=(parseFloat(V[0])%360+360)%360/360,Y=f(V[1]),se=f(V[2]),ce=se<=.5?se*(Y+1):se+Y-se*Y,he=2*se-ce;return[a(255*p(he,ce,X+1/3)),a(255*p(he,ce,X)),a(255*p(he,ce,X-1/3)),q];default:return null}}return null}}catch{}return tw}();class ni{constructor(a,c,f,p=1){this.r=a,this.g=c,this.b=f,this.a=p}static parse(a){if(!a)return;if(a instanceof ni)return a;if(typeof a!="string")return;const c=rw.parseCSSColor(a);return c?new ni(c[0]/255,c[1]/255,c[2]/255,c[3]):void 0}toString(){const[a,c,f,p]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*a)},${Math.round(255*c)},${Math.round(255*f)},${p})`}toNonPremultipliedRenderColor(a){const{r:c,g:f,b:p,a:x}=this;return new h2(a,c,f,p,x)}toPremultipliedRenderColor(a){const{r:c,g:f,b:p,a:x}=this;return new f2(a,c*x,f*x,p*x,x)}clone(){return new ni(this.r,this.g,this.b,this.a)}}class nw{constructor(a,c,f,p,x,b=!1){if(this.premultiplied=!1,this.premultiplied=b,a){const A=a.image.height,k=A*A;this.premultiplied?(c=x===0?0:c/x*(A-1),f=x===0?0:f/x*(A-1),p=x===0?0:p/x*(A-1)):(c*=A-1,f*=A-1,p*=A-1);const M=Math.floor(c),$=Math.floor(f),V=Math.floor(p),q=Math.ceil(c),X=Math.ceil(f),Y=Math.ceil(p),se=c-M,ce=f-$,he=p-V,be=a.image.data,Ee=4*(M+$*k+V*A),Oe=4*(M+$*k+Y*A),Ue=4*(M+X*k+V*A),Fe=4*(M+X*k+Y*A),Ke=4*(q+$*k+V*A),Qe=4*(q+$*k+Y*A),nt=4*(q+X*k+V*A),Et=4*(q+X*k+Y*A);if(Ee<0||Et>=be.length)throw new Error("out of range");this.r=qr(qr(qr(be[Ee],be[Oe],he),qr(be[Ue],be[Fe],he),ce),qr(qr(be[Ke],be[Qe],he),qr(be[nt],be[Et],he),ce),se)/255*(this.premultiplied?x:1),this.g=qr(qr(qr(be[Ee+1],be[Oe+1],he),qr(be[Ue+1],be[Fe+1],he),ce),qr(qr(be[Ke+1],be[Qe+1],he),qr(be[nt+1],be[Et+1],he),ce),se)/255*(this.premultiplied?x:1),this.b=qr(qr(qr(be[Ee+2],be[Oe+2],he),qr(be[Ue+2],be[Fe+2],he),ce),qr(qr(be[Ke+2],be[Qe+2],he),qr(be[nt+2],be[Et+2],he),ce),se)/255*(this.premultiplied?x:1),this.a=x}else this.r=c,this.g=f,this.b=p,this.a=x}toArray(){const{r:a,g:c,b:f,a:p}=this;return[255*a,255*c,255*f,p]}toHslaArray(){let{r:a,g:c,b:f,a:p}=this;if(this.premultiplied){if(p===0)return[0,0,0,0];const Y=1/p;a*=Y,c*=Y,f*=Y}const x=Math.min(Math.max(a,0),1),b=Math.min(Math.max(c,0),1),A=Math.min(Math.max(f,0),1),k=Math.min(x,b,A),M=Math.max(x,b,A),$=M-k,V=.5*(k+M);if($===0)return[0,0,100*V,p];const q=V>.5?$/(2-M-k):$/(M+k);let X;switch(M){case x:X=60*((b-A)/$+(b<A?6:0));break;case b:X=60*((A-x)/$+2);break;default:X=60*((x-b)/$+4)}return[X,100*q,100*V,p]}toArray01(){const{r:a,g:c,b:f,a:p}=this;return[a,c,f,p]}toArray01Scaled(a){const{r:c,g:f,b:p}=this;return[c*a,f*a,p*a]}toArray01Linear(){const{r:a,g:c,b:f,a:p}=this;return[Math.pow(a,2.2),Math.pow(c,2.2),Math.pow(f,2.2),p]}}class h2 extends nw{constructor(a,c,f,p,x){super(a,c,f,p,x,!1)}}class f2 extends nw{constructor(a,c,f,p,x){super(a,c,f,p,x,!0)}}function qr(u,a,c){return u*(1-c)+a*c}function Pg(u,a,c){return u.map((f,p)=>qr(f,a[p],c))}ni.black=new ni(0,0,0,1),ni.white=new ni(1,1,1,1),ni.transparent=new ni(0,0,0,0),ni.red=new ni(1,0,0,1),ni.blue=new ni(0,0,1,1);var $u=Object.freeze({__proto__:null,array:Pg,color:function(u,a,c){return new ni(qr(u.r,a.r,c),qr(u.g,a.g,c),qr(u.b,a.b,c),qr(u.a,a.a,c))},number:qr});class ec extends Error{constructor(a,c){super(c),this.message=c,this.key=a}}class tc{constructor(a,c=[]){this.parent=a,this.bindings={};for(const[f,p]of c)this.bindings[f]=p}concat(a){return new tc(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const Jf={kind:"null"},Cr={kind:"number"},Vn={kind:"string"},ti={kind:"boolean"},Js={kind:"color"},Qf={kind:"object"},oi={kind:"value"},Cg={kind:"collator"},Uh={kind:"formatted"},Og={kind:"resolvedImage"};function wo(u,a){return{kind:"array",itemType:u,N:a}}function qa(u){if(u.kind==="array"){const a=qa(u.itemType);return typeof u.N=="number"?`array<${a}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${a}>`}return u.kind}const GR=[Jf,Cr,Vn,ti,Js,Uh,Qf,wo(oi),Og];function kg(u,a){if(a.kind==="error")return null;if(u.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!kg(u.itemType,a.itemType))&&(typeof u.N!="number"||u.N===a.N))return null}else{if(u.kind===a.kind)return null;if(u.kind==="value"){for(const c of GR)if(!kg(c,a))return null}}return`Expected ${qa(u)} but found ${qa(a)} instead.`}function iw(u,a){return a.some(c=>c.kind===u.kind)}function Ig(u,a){return a.some(c=>c==="null"?u===null:c==="array"?Array.isArray(u):c==="object"?u&&!Array.isArray(u)&&typeof u=="object":c===typeof u)}function Uv(u,a){return u.kind==="array"&&a.kind==="array"?u.N===a.N&&Uv(u.itemType,a.itemType):u.kind===a.kind}class aw{constructor(a,c,f){this.sensitivity=a?c?"variant":"case":c?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,c){return this.collator.compare(a,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Rg{constructor(a,c,f,p,x){this.text=a.normalize?a.normalize():a,this.image=c,this.scale=f,this.fontStack=p,this.textColor=x}}class po{constructor(a){this.sections=a}static fromString(a){return new po([new Rg(a,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(a=>a.text.length!==0||!!a.image&&a.image.hasPrimary())}static factory(a){return a instanceof po?a:po.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map(a=>a.text).join("")}serialize(){const a=["format"];for(const c of this.sections){if(c.image){const p=c.image.getPrimary().id.toString();a.push(["image",p]);continue}a.push(c.text);const f={};c.fontStack&&(f["text-font"]=["literal",c.fontStack.split(",")]),c.scale&&(f["font-scale"]=c.scale),c.textColor&&(f["text-color"]=["rgba"].concat(c.textColor.toNonPremultipliedRenderColor(null).toArray())),a.push(f)}return a}}class Uu{constructor(a,c={}){if(this.id=eo.from(a),this.options=Object.assign({},c),c.transform){const{a:f,b:p,c:x,d:b,e:A,f:k}=c.transform;this.options.transform=new DOMMatrix([f,p,x,b,A,k])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a,b:c,c:f,d:p,e:x,f:b}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a,b:c,c:f,d:p,e:x,f:b}})}static parse(a){let c,f,p,x;try{({name:c,iconsetId:f,params:p,transform:x}=JSON.parse(a)||{})}catch{return null}if(!c)return null;const{a:b,b:A,c:k,d:M,e:$,f:V}=x||{};return new Uu({name:c,iconsetId:f},{params:p,transform:new DOMMatrix([b,A,k,M,$,V])})}scaleSelf(a,c){return this.options.transform.scaleSelf(a,c),this}}class Ds{constructor(a,c,f,p,x=!1){this.primaryId=eo.from(a),this.primaryOptions=c,f&&(this.secondaryId=eo.from(f)),this.secondaryOptions=p,this.available=x}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Uu(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Uu(this.secondaryId,this.secondaryOptions):null}static from(a){return typeof a=="string"?Ds.build({name:a}):a}static build(a,c,f,p){return!a||typeof a=="object"&&!("name"in a)?null:new Ds(a,f,c,p)}}function Vv(u,a,c,f){return typeof u=="number"&&u>=0&&u<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof c=="number"&&c>=0&&c<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[u,a,c,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[u,a,c,f]:[u,a,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ep(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof ni||u instanceof aw||u instanceof po||u instanceof Ds)return!0;if(Array.isArray(u)){for(const a of u)if(!ep(a))return!1;return!0}if(typeof u=="object"){for(const a in u)if(!ep(u[a]))return!1;return!0}return!1}function co(u){if(u===null)return Jf;if(typeof u=="string")return Vn;if(typeof u=="boolean")return ti;if(typeof u=="number")return Cr;if(u instanceof ni)return Js;if(u instanceof aw)return Cg;if(u instanceof po)return Uh;if(u instanceof Ds)return Og;if(Array.isArray(u)){const a=u.length;let c;for(const f of u){const p=co(f);if(c){if(c===p)continue;c=oi;break}c=p}return wo(c||oi,a)}return Qf}function au(u){const a=typeof u;return u===null?"":a==="string"||a==="number"||a==="boolean"?String(u):u instanceof po||u instanceof Ds||u instanceof ni?u.toString():JSON.stringify(u)}class Vu{constructor(a,c){this.type=a,this.value=c}static parse(a,c){if(a.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!ep(a[1]))return c.error("invalid value");const f=a[1];let p=co(f);const x=c.expectedType;return p.kind!=="array"||p.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(p=x),new Vu(p,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ni?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof po?this.value.serialize():this.value}}class Ta{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}}const mn={string:Vn,number:Cr,boolean:ti,object:Qf};class Sr{constructor(a,c){this.type=a,this.args=c}static parse(a,c){if(a.length<2)return c.error("Expected at least one argument.");let f,p=1;const x=a[0];if(x==="array"){let A,k;if(a.length>2){const M=a[1];if(typeof M!="string"||!(M in mn)||M==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);A=mn[M],p++}else A=oi;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return c.error('The length argument to "array" must be a positive integer literal',2);k=a[2],p++}f=wo(A,k)}else f=mn[x];const b=[];for(;p<a.length;p++){const A=c.parse(a[p],p,oi);if(!A)return null;b.push(A)}return new Sr(f,b)}evaluate(a){for(let c=0;c<this.args.length;c++){const f=this.args[c].evaluate(a);if(!kg(this.type,co(f)))return f;if(c===this.args.length-1)throw new Ta(`The expression ${JSON.stringify(this.args[c].serialize())} evaluated to ${qa(co(f))} but was expected to be of type ${qa(this.type)}.`)}return null}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){const a=this.type,c=[a.kind];if(a.kind==="array"){const f=a.itemType;if(f.kind==="string"||f.kind==="number"||f.kind==="boolean"){c.push(f.kind);const p=a.N;(typeof p=="number"||this.args.length>1)&&c.push(p)}}return c.concat(this.args.map(f=>f.serialize()))}}class Vh{constructor(a){this.type=Uh,this.sections=a}static parse(a,c){if(a.length<2)return c.error("Expected at least one argument.");const f=a[1];if(!Array.isArray(f)&&typeof f=="object")return c.error("First argument must be an image or text section.");const p=[];let x=!1;for(let b=1;b<=a.length-1;++b){const A=a[b];if(x&&typeof A=="object"&&!Array.isArray(A)){x=!1;let k=null;if(A["font-scale"]&&(k=c.parseObjectValue(A["font-scale"],b,"font-scale",Cr),!k))return null;let M=null;if(A["text-font"]&&(M=c.parseObjectValue(A["text-font"],b,"text-font",wo(Vn)),!M))return null;let $=null;if(A["text-color"]&&($=c.parseObjectValue(A["text-color"],b,"text-color",Js),!$))return null;const V=p[p.length-1];V.scale=k,V.font=M,V.textColor=$}else{const k=c.parse(a[b],b,oi);if(!k)return null;const M=k.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,p.push({content:k,scale:null,font:null,textColor:null})}}return new Vh(p)}evaluate(a){return new po(this.sections.map(c=>{const f=c.content.evaluate(a);return Uv(co(f),Og)?new Rg("",f,null,null,null):new Rg(au(f),null,c.scale?c.scale.evaluate(a):null,c.font?c.font.evaluate(a).join(","):null,c.textColor?c.textColor.evaluate(a):null)}))}eachChild(a){for(const c of this.sections)a(c.content),c.scale&&a(c.scale),c.font&&a(c.font),c.textColor&&a(c.textColor)}outputDefined(){return!1}serialize(){const a=["format"];for(const c of this.sections){a.push(c.content.serialize());const f={};c.scale&&(f["font-scale"]=c.scale.serialize()),c.font&&(f["text-font"]=c.font.serialize()),c.textColor&&(f["text-color"]=c.textColor.serialize()),a.push(f)}return a}}class Yr{constructor(a,c,f,p){this._imageWarnHistory={},this.type=Og,this.namePrimary=a,this.nameSecondary=c,f&&(this.paramsPrimary=f.params,this.iconsetIdPrimary=f.iconset?f.iconset.id:void 0),p&&(this.paramsSecondary=p.params,this.iconsetIdSecondary=p.iconset?p.iconset.id:void 0)}static parse(a,c){if(a.length<2)return c.error("Expected two or more arguments.");let f=1;const p=[];function x(){if(f<a.length){const A=c.parse(a[f],f++,Vn);return A?(p.push({image:A,options:{}}),!0):(c.error(p.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function b(){if(f<a.length){const k=a[f];if((A=k)===null||typeof A!="object"||Array.isArray(A))return!0;const M=k.params,$=k.iconset,V=c.concat(f);if(!M&&!$)return f++,!0;if(M){if(typeof M!="object"||M.constructor!==Object)return V.error('Image options "params" should be an object'),!1;const q={},X=V.concat(void 0,"params");for(const Y in M){if(!Y)return X.error("Image parameter name should be non-empty"),!1;const se=X.concat(void 0,Y).parse(M[Y],void 0,Js,void 0,{typeAnnotation:"coerce"});if(!se)return!1;q[Y]=se}p[p.length-1].options.params=q}if($){if(typeof $!="object"||$.constructor!==Object)return V.error('Image options "iconset" should be an object'),!1;if(!$.id)return V.error('Image options "iconset" should have an "id" property'),!1;p[p.length-1].options.iconset=$}return f++,!0}var A;return!0}for(let A=0;A<2;A++)if(!x()||!b())return;return new Yr(p[0].image,p[1]?p[1].image:void 0,p[0].options,p[1]?p[1].options:void 0)}evaluateParams(a,c){const f={};if(c){for(const p in c)if(c[p])try{f[p]=c[p].evaluate(a)}catch{continue}if(Object.keys(f).length!==0)return{params:f}}}evaluate(a){const c={name:this.namePrimary.evaluate(a),iconsetId:this.iconsetIdPrimary},f=this.nameSecondary?{name:this.nameSecondary.evaluate(a),iconsetId:this.iconsetIdSecondary}:void 0,p=Ds.build(c,f,this.paramsPrimary?this.evaluateParams(a,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(a,this.paramsSecondary):void 0);if(p&&a.availableImages){const x=p.getPrimary().id;if(p.available=a.availableImages.some(b=>eo.isEqual(b,x)),p.available){const b=p.getSecondary()?p.getSecondary().id:null;b&&(p.available=a.availableImages.some(A=>eo.isEqual(A,b)))}}return p}eachChild(a){if(a(this.namePrimary),this.paramsPrimary)for(const c in this.paramsPrimary)this.paramsPrimary[c]&&a(this.paramsPrimary[c]);if(this.nameSecondary&&(a(this.nameSecondary),this.paramsSecondary))for(const c in this.paramsSecondary)this.paramsSecondary[c]&&a(this.paramsSecondary[c])}outputDefined(){return!1}serializeOptions(a,c){const f={};if(c&&(f.iconset={id:c}),a){f.params={};for(const p in a)a[p]&&(f.params[p]=a[p].serialize())}return Object.keys(f).length>0?f:void 0}serialize(){const a=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const c=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);c&&a.push(c)}if(this.nameSecondary&&(a.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const c=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);c&&a.push(c)}return a}}function tp(u){return Gr(u)?"string":jg(u)?"number":Wv(u)?"boolean":Array.isArray(u)?"array":u===null?"null":qv(u)?"object":typeof u}function qv(u){return u!=null&&!Array.isArray(u)&&typeof u!="function"&&!(u instanceof String||u instanceof Number||u instanceof Boolean)&&typeof u=="object"}function Gr(u){return typeof u=="string"||u instanceof String}function jg(u){return typeof u=="number"||u instanceof Number}function Wv(u){return typeof u=="boolean"||u instanceof Boolean}const p2={"to-boolean":ti,"to-color":Js,"to-number":Cr,"to-string":Vn};class ou{constructor(a,c){this.type=a,this.args=c}static parse(a,c){if(a.length<2)return c.error("Expected at least one argument.");const f=a[0],p=[];let x=Jf;if(f==="to-array"){if(!Array.isArray(a[1]))return null;const b=a[1].length;if(c.expectedType){if(c.expectedType.kind!=="array")return c.error(`Expected ${c.expectedType.kind} but found array.`);x=wo(c.expectedType.itemType,b)}else{if(!(b>0&&ep(a[1][0])))return null;x=wo(co(a[1][0]),b)}for(let A=0;A<b;A++){const k=a[1][A];let M;if(Array.isArray(k))M=c.parse(k,void 0,x.itemType);else{const $=tp(k);if($!==x.itemType.kind)return c.error(`Expected ${x.itemType.kind} but found ${$}.`);M=c.registry.literal.parse(["literal",k===void 0?null:k],c)}if(!M)return null;p.push(M)}}else{if((f==="to-boolean"||f==="to-string")&&a.length!==2)return c.error("Expected one argument.");x=p2[f];for(let b=1;b<a.length;b++){const A=c.parse(a[b],b,oi);if(!A)return null;p.push(A)}}return new ou(x,p)}evaluate(a){if(this.type.kind==="boolean")return!!this.args[0].evaluate(a);if(this.type.kind==="color"){let c,f;for(const p of this.args){if(c=p.evaluate(a),f=null,c instanceof ni)return c;if(typeof c=="string"){const x=a.parseColor(c);if(x)return x}else if(Array.isArray(c)&&(f=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:Vv(c[0],c[1],c[2],c[3]),!f))return new ni(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new Ta(f||`Could not parse color from value '${typeof c=="string"?c:String(JSON.stringify(c))}'`)}if(this.type.kind==="number"){let c=null;for(const f of this.args){if(c=f.evaluate(a),c===null)return 0;const p=Number(c);if(!isNaN(p))return p}throw new Ta(`Could not convert ${JSON.stringify(c)} to number.`)}return this.type.kind==="formatted"?po.fromString(au(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?Ds.build(au(this.args[0].evaluate(a))):this.type.kind==="array"?this.args.map(c=>c.evaluate(a)):au(this.args[0].evaluate(a))}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Vh([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Yr(this.args[0]).serialize();const a=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(c=>{a.push(c.serialize())}),a}}const Gv=["Unknown","Point","LineString","Polygon"];class So{constructor(a,c,f){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=a,this.options=c,this.iconImageUseTheme=f}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Gv[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(a){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const a=this.featureDistanceData.center,c=this.featureDistanceData.scale,{x:f,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(f*c-a[0])+this.featureDistanceData.bearing[1]*(p*c-a[1])}return 0}parseColor(a){let c=this._parseColorCache[a];return c||(c=this._parseColorCache[a]=ni.parse(a)),c}getConfig(a){return this.options?this.options.get(a):null}}class os{constructor(a,c,f,p,x){this.name=a,this.type=c,this._evaluate=f,this.args=p,this._overloadIndex=x}evaluate(a){if(!this._evaluate){const c=os.definitions[this.name];this._evaluate=Array.isArray(c)?c[2]:c.overloads[this._overloadIndex][1]}return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(a=>a.serialize()))}static parse(a,c){const f=a[0],p=os.definitions[f];if(!p)return c.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(p)?p[0]:p.type,b=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,A=[];let k=null,M=-1;for(const[$,V]of b){if(Array.isArray($)&&$.length!==a.length-1)continue;A.push($),M++,k=new r_(c.registry,c.path,null,c.scope,void 0,c._scope,c.options,c.iconImageUseTheme);const q=[];let X=!1;for(let Y=1;Y<a.length;Y++){const se=a[Y],ce=Array.isArray($)?$[Y-1]:$.type,he=k.parse(se,1+q.length,ce);if(!he){X=!0;break}q.push(he)}if(!X)if(Array.isArray($)&&$.length!==q.length)k.error(`Expected ${$.length} arguments, but found ${q.length} instead.`);else{for(let Y=0;Y<q.length;Y++){const se=Array.isArray($)?$[Y]:$.type,ce=q[Y];k.concat(Y+1).checkSubtype(se,ce.type)}if(k.errors.length===0)return new os(f,x,V,q,M)}}if(A.length===1)c.errors.push(...k.errors);else{const $=(A.length?A:b.map(([q])=>q)).map(qh).join(" | "),V=[];for(let q=1;q<a.length;q++){const X=c.parse(a[q],1+V.length);if(!X)return null;V.push(qa(X.type))}c.error(`Expected arguments of type ${$}, but found (${V.join(", ")}) instead.`)}return null}static register(a,c){os.definitions=c;for(const f in c)a[f]=os}}function qh(u){return Array.isArray(u)?`(${u.map(qa).join(", ")})`:`(${qa(u.type)}...)`}class rp{constructor(a,c,f){this.type=Cg,this.locale=f,this.caseSensitive=a,this.diacriticSensitive=c}static parse(a,c){if(a.length!==2)return c.error("Expected one argument.");const f=a[1];if(typeof f!="object"||Array.isArray(f))return c.error("Collator options argument must be an object.");const p=f["case-sensitive"]===void 0?c.parse(!1,1,ti):c.parseObjectValue(f["case-sensitive"],1,"case-sensitive",ti);if(!p)return null;const x=f["diacritic-sensitive"]===void 0?c.parse(!1,1,ti):c.parseObjectValue(f["diacritic-sensitive"],1,"diacritic-sensitive",ti);if(!x)return null;let b=null;return f.locale&&(b=c.parseObjectValue(f.locale,1,"locale",Vn),!b)?null:new rp(p,x,b)}evaluate(a){return new aw(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}serialize(){const a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]}}function qu(u,a,c=0,f=u.length-1,p=HR){for(;f>c;){if(f-c>600){const k=f-c+1,M=a-c+1,$=Math.log(k),V=.5*Math.exp(2*$/3),q=.5*Math.sqrt($*V*(k-V)/k)*(M-k/2<0?-1:1);qu(u,a,Math.max(c,Math.floor(a-M*V/k+q)),Math.min(f,Math.floor(a+(k-M)*V/k+q)),p)}const x=u[a];let b=c,A=f;for(Eo(u,c,a),p(u[f],x)>0&&Eo(u,c,f);b<A;){for(Eo(u,b,A),b++,A--;p(u[b],x)<0;)b++;for(;p(u[A],x)>0;)A--}p(u[c],x)===0?Eo(u,c,A):(A++,Eo(u,A,f)),A<=a&&(c=A+1),a<=A&&(f=A-1)}}function Eo(u,a,c){const f=u[a];u[a]=u[c],u[c]=f}function HR(u,a){return u<a?-1:u>a?1:0}function KR(u){let a=0;for(let c,f,p=0,x=u.length,b=x-1;p<x;b=p++)c=u[p],f=u[b],a+=(f.x-c.x)*(c.y+f.y);return a}function Ng(u,a){u[0]=Math.min(u[0],a[0]),u[1]=Math.min(u[1],a[1]),u[2]=Math.max(u[2],a[0]),u[3]=Math.max(u[3],a[1])}function Fd(u,a){return!(u[0]<=a[0]||u[2]>=a[2]||u[1]<=a[1]||u[3]>=a[3])}function m2(u,a,c){const f=u[0]-a[0],p=u[1]-a[1],x=u[0]-c[0],b=u[1]-c[1];return f*b-x*p==0&&f*x<=0&&p*b<=0}function rc(u,a,c=!1){let f=!1;for(let A=0,k=a.length;A<k;A++){const M=a[A];for(let $=0,V=M.length,q=V-1;$<V;q=$++){const X=M[q],Y=M[$];if(m2(u,X,Y))return c;(x=X)[1]>(p=u)[1]!=(b=Y)[1]>p[1]&&p[0]<(b[0]-x[0])*(p[1]-x[1])/(b[1]-x[1])+x[0]&&(f=!f)}}var p,x,b;return f}function g2(u,a,c,f){const p=f[0]-c[0],x=f[1]-c[1],b=(u[0]-c[0])*x-p*(u[1]-c[1]),A=(a[0]-c[0])*x-p*(a[1]-c[1]);return b>0&&A<0||b<0&&A>0}function Hv(u,a,c,f){return(p=[f[0]-c[0],f[1]-c[1]])[0]*(x=[a[0]-u[0],a[1]-u[1]])[1]-p[1]*x[0]!=0&&!(!g2(u,a,c,f)||!g2(c,f,u,a));var p,x}function Mg(u){const a=new Mt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),c=new Mt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const f of u[0])a.x>f.x&&(a.x=f.x),a.y>f.y&&(a.y=f.y),c.x<f.x&&(c.x=f.x),c.y<f.y&&(c.y=f.y);return{min:a,max:c}}const zd=8192;function ZR(u,a){const c=(180+u[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,p=Math.pow(2,a.z);return[Math.round(c*p*zd),Math.round(f*p*zd)]}function y2(u,a){for(let c=0;c<a.length;c++)if(rc(u,a[c]))return!0;return!1}function XR(u,a,c){for(const f of c)for(let p=0,x=f.length,b=x-1;p<x;b=p++)if(Hv(u,a,f[b],f[p]))return!0;return!1}function Bd(u,a){for(let c=0;c<u.length;++c)if(!rc(u[c],a))return!1;for(let c=0;c<u.length-1;++c)if(XR(u[c],u[c+1],a))return!1;return!0}function YR(u,a){for(let c=0;c<a.length;c++)if(Bd(u,a[c]))return!0;return!1}function ow(u,a,c){const f=[];for(let p=0;p<u.length;p++){const x=[];for(let b=0;b<u[p].length;b++){const A=ZR(u[p][b],c);Ng(a,A),x.push(A)}f.push(x)}return f}function Kv(u,a,c){const f=[];for(let p=0;p<u.length;p++){const x=ow(u[p],a,c);f.push(x)}return f}function sw(u,a,c,f){if(u[0]<c[0]||u[0]>c[2]){const p=.5*f;let x=u[0]-c[0]>p?-f:c[0]-u[0]>p?f:0;x===0&&(x=u[0]-c[2]>p?-f:c[2]-u[0]>p?f:0),u[0]+=x}Ng(a,u)}function lw(u,a,c,f){const p=Math.pow(2,f.z)*zd,x=[f.x*zd,f.y*zd],b=[];if(!u)return b;for(const A of u)for(const k of A){const M=[k.x+x[0],k.y+x[1]];sw(M,a,c,p),b.push(M)}return b}function nc(u,a,c,f){const p=Math.pow(2,f.z)*zd,x=[f.x*zd,f.y*zd],b=[];if(!u)return b;for(const k of u){const M=[];for(const $ of k){const V=[$.x+x[0],$.y+x[1]];Ng(a,V),M.push(V)}b.push(M)}if(a[2]-a[0]<=p/2){(A=a)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const k of b)for(const M of k)sw(M,a,c,p)}var A;return b}class Wh{constructor(a,c){this.type=ti,this.geojson=a,this.geometries=c}static parse(a,c){if(a.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(ep(a[1])){const f=a[1];if(f.type==="FeatureCollection")for(let p=0;p<f.features.length;++p){const x=f.features[p].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new Wh(f,f.features[p].geometry)}else if(f.type==="Feature"){const p=f.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Wh(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Wh(f,f)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(c,f){const p=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=c.canonicalID();if(!b)return!1;if(f.type==="Polygon"){const A=ow(f.coordinates,x,b),k=lw(c.geometry(),p,x,b);if(!Fd(p,x))return!1;for(const M of k)if(!rc(M,A))return!1}if(f.type==="MultiPolygon"){const A=Kv(f.coordinates,x,b),k=lw(c.geometry(),p,x,b);if(!Fd(p,x))return!1;for(const M of k)if(!y2(M,A))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(c,f){const p=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=c.canonicalID();if(!b)return!1;if(f.type==="Polygon"){const A=ow(f.coordinates,x,b),k=nc(c.geometry(),p,x,b);if(!Fd(p,x))return!1;for(const M of k)if(!Bd(M,A))return!1}if(f.type==="MultiPolygon"){const A=Kv(f.coordinates,x,b),k=nc(c.geometry(),p,x,b);if(!Fd(p,x))return!1;for(const M of k)if(!YR(M,A))return!1}return!0}(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Dg={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},cw=1/298.257223563,uw=cw*(2-cw),np=Math.PI/180;class ip{static fromTile(a,c,f){const p=Math.PI*(1-2*(a+.5)/Math.pow(2,c)),x=Math.atan(.5*(Math.exp(p)-Math.exp(-p)))/np;return new ip(x,f)}static get units(){return Dg}constructor(a,c){if(a===void 0)throw new Error("No latitude given.");if(c&&!Dg[c])throw new Error(`Unknown unit ${c}. Use one of: ${Object.keys(Dg).join(", ")}`);const f=6378.137*np*(c?Dg[c]:1),p=Math.cos(a*np),x=1/(1-uw*(1-p*p)),b=Math.sqrt(x);this.kx=f*b*p,this.ky=f*b*x*(1-uw)}distance(a,c){const f=xl(a[0]-c[0])*this.kx,p=(a[1]-c[1])*this.ky;return Math.sqrt(f*f+p*p)}bearing(a,c){const f=xl(c[0]-a[0])*this.kx;return Math.atan2(f,(c[1]-a[1])*this.ky)/np}destination(a,c,f){const p=f*np;return this.offset(a,Math.sin(p)*c,Math.cos(p)*c)}offset(a,c,f){return[a[0]+c/this.kx,a[1]+f/this.ky]}lineDistance(a){let c=0;for(let f=0;f<a.length-1;f++)c+=this.distance(a[f],a[f+1]);return c}area(a){let c=0;for(let f=0;f<a.length;f++){const p=a[f];for(let x=0,b=p.length,A=b-1;x<b;A=x++)c+=xl(p[x][0]-p[A][0])*(p[x][1]+p[A][1])*(f?-1:1)}return Math.abs(c)/2*this.kx*this.ky}along(a,c){let f=0;if(c<=0)return a[0];for(let p=0;p<a.length-1;p++){const x=a[p],b=a[p+1],A=this.distance(x,b);if(f+=A,f>c)return Zv(x,b,(c-(f-A))/A)}return a[a.length-1]}pointToSegmentDistance(a,c,f){let[p,x]=c,b=xl(f[0]-p)*this.kx,A=(f[1]-x)*this.ky;if(b!==0||A!==0){const k=(xl(a[0]-p)*this.kx*b+(a[1]-x)*this.ky*A)/(b*b+A*A);k>1?(p=f[0],x=f[1]):k>0&&(p+=b/this.kx*k,x+=A/this.ky*k)}return b=xl(a[0]-p)*this.kx,A=(a[1]-x)*this.ky,Math.sqrt(b*b+A*A)}pointOnLine(a,c){let f=1/0,p=a[0][0],x=a[0][1],b=0,A=0;for(let k=0;k<a.length-1;k++){let M=a[k][0],$=a[k][1],V=xl(a[k+1][0]-M)*this.kx,q=(a[k+1][1]-$)*this.ky,X=0;V===0&&q===0||(X=(xl(c[0]-M)*this.kx*V+(c[1]-$)*this.ky*q)/(V*V+q*q),X>1?(M=a[k+1][0],$=a[k+1][1]):X>0&&(M+=V/this.kx*X,$+=q/this.ky*X)),V=xl(c[0]-M)*this.kx,q=(c[1]-$)*this.ky;const Y=V*V+q*q;Y<f&&(f=Y,p=M,x=$,b=k,A=X)}return{point:[p,x],index:b,t:Math.max(0,Math.min(1,A))}}lineSlice(a,c,f){let p=this.pointOnLine(f,a),x=this.pointOnLine(f,c);if(p.index>x.index||p.index===x.index&&p.t>x.t){const M=p;p=x,x=M}const b=[p.point],A=p.index+1,k=x.index;!dw(f[A],b[0])&&A<=k&&b.push(f[A]);for(let M=A+1;M<=k;M++)b.push(f[M]);return dw(f[k],x.point)||b.push(x.point),b}lineSliceAlong(a,c,f){let p=0;const x=[];for(let b=0;b<f.length-1;b++){const A=f[b],k=f[b+1],M=this.distance(A,k);if(p+=M,p>a&&x.length===0&&x.push(Zv(A,k,(a-(p-M))/M)),p>=c)return x.push(Zv(A,k,(c-(p-M))/M)),x;p>a&&x.push(k)}return x}bufferPoint(a,c){const f=c/this.ky,p=c/this.kx;return[a[0]-p,a[1]-f,a[0]+p,a[1]+f]}bufferBBox(a,c){const f=c/this.ky,p=c/this.kx;return[a[0]-p,a[1]-f,a[2]+p,a[3]+f]}insideBBox(a,c){return xl(a[0]-c[0])>=0&&xl(a[0]-c[2])<=0&&a[1]>=c[1]&&a[1]<=c[3]}}function dw(u,a){return u[0]===a[0]&&u[1]===a[1]}function Zv(u,a,c){const f=xl(a[0]-u[0]);return[u[0]+f*c,u[1]+(a[1]-u[1])*c]}function xl(u){for(;u<-180;)u+=360;for(;u>180;)u-=360;return u}class Xv{constructor(a=[],c=(f,p)=>f<p?-1:f>p?1:0){if(this.data=a,this.length=this.data.length,this.compare=c,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],c=this.data.pop();return--this.length>0&&(this.data[0]=c,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:c,compare:f}=this,p=c[a];for(;a>0;){const x=a-1>>1,b=c[x];if(f(p,b)>=0)break;c[a]=b,a=x}c[a]=p}_down(a){const{data:c,compare:f}=this,p=this.length>>1,x=c[a];for(;a<p;){let b=1+(a<<1);const A=b+1;if(A<this.length&&f(c[A],c[b])<0&&(b=A),f(c[b],x)>=0)break;c[a]=c[b],a=b}c[a]=x}}var Jt=8192;function hw(u,a){return a.dist-u.dist}const ap=100,op=50;function Lg(u){const a=[1/0,1/0,-1/0,-1/0];if(a.length!==u.length)return!1;for(let c=0;c<a.length;c++)if(a[c]!==u[c])return!1;return!0}function Fg(u){return u[1]-u[0]+1}function su(u,a){const c=u[1]>=u[0]&&u[1]<a;return c||console.warn("Distance Expression: Index is out of range"),c}function Yv(u,a){if(u[0]>u[1])return[null,null];const c=Fg(u);if(a){if(c===2)return[u,null];const f=Math.floor(c/2);return[[u[0],u[0]+f],[u[0]+f,u[1]]]}{if(c===1)return[u,null];const f=Math.floor(c/2)-1;return[[u[0],u[0]+f],[u[0]+f+1,u[1]]]}}function ic(u,a){const c=[1/0,1/0,-1/0,-1/0];if(!su(a,u.length))return c;for(let f=a[0];f<=a[1];++f)Ng(c,u[f]);return c}function In(u){const a=[1/0,1/0,-1/0,-1/0];for(let c=0;c<u.length;++c)for(let f=0;f<u[c].length;++f)Ng(a,u[c][f]);return a}function sp(u,a,c){if(Lg(u)||Lg(a))return NaN;let f=0,p=0;return u[2]<a[0]&&(f=a[0]-u[2]),u[0]>a[2]&&(f=u[0]-a[2]),u[1]>a[3]&&(p=u[1]-a[3]),u[3]<a[1]&&(p=a[1]-u[3]),c.distance([0,0],[f,p])}function JR(u){return 360*u-180}function QR(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function Jv(u,a){const c=Math.pow(2,a.z),f=(u.y/Jt+a.y)/c;return[JR((u.x/Jt+a.x)/c),QR(f)]}function ej(u,a){const c=[];for(let f=0;f<u.length;++f)c.push(Jv(u[f],a));return c}function ea(u,a,c){const f=c.pointOnLine(a,u).point;return c.distance(u,f)}function v2(u,a,c,f,p){const x=c.slice(f[0],f[1]+1);let b=1/0;for(let A=a[0];A<=a[1];++A)if((b=Math.min(b,ea(u[A],x,p)))===0)return 0;return b}function fw(u,a,c,f,p){const x=Math.min(p.pointToSegmentDistance(u,c,f),p.pointToSegmentDistance(a,c,f)),b=Math.min(p.pointToSegmentDistance(c,u,a),p.pointToSegmentDistance(f,u,a));return Math.min(x,b)}function tj(u,a,c,f,p){if(!su(a,u.length)||!su(f,c.length))return NaN;let x=1/0;for(let b=a[0];b<a[1];++b)for(let A=f[0];A<f[1];++A){if(Hv(u[b],u[b+1],c[A],c[A+1]))return 0;x=Math.min(x,fw(u[b],u[b+1],c[A],c[A+1],p))}return x}function rj(u,a,c,f,p){if(!su(a,u.length)||!su(f,c.length))return NaN;let x=1/0;for(let b=a[0];b<=a[1];++b)for(let A=f[0];A<=f[1];++A)if((x=Math.min(x,p.distance(u[b],c[A])))===0)return x;return x}function nj(u,a,c){if(rc(u,a,!0))return 0;let f=1/0;for(const p of a){const x=p.length;if(x<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[x-1]&&(f=Math.min(f,c.pointToSegmentDistance(u,p[x-1],p[0])))===0||(f=Math.min(f,ea(u,p,c)))===0)return f}return f}function ij(u,a,c,f){if(!su(a,u.length))return NaN;for(let x=a[0];x<=a[1];++x)if(rc(u[x],c,!0))return 0;let p=1/0;for(let x=a[0];x<a[1];++x)for(const b of c)for(let A=0,k=b.length,M=k-1;A<k;M=A++){if(Hv(u[x],u[x+1],b[M],b[A]))return 0;p=Math.min(p,fw(u[x],u[x+1],b[M],b[A],f))}return p}function _2(u,a){for(const c of u)for(let f=0;f<=c.length-1;++f)if(rc(c[f],a,!0))return!0;return!1}function aj(u,a,c,f=1/0){const p=In(u),x=In(a);if(f!==1/0&&sp(p,x,c)>=f)return f;if(Fd(p,x)){if(_2(u,a))return 0}else if(_2(a,u))return 0;let b=f;for(const A of u)for(let k=0,M=A.length,$=M-1;k<M;$=k++)for(const V of a)for(let q=0,X=V.length,Y=X-1;q<X;Y=q++){if(Hv(A[$],A[k],V[Y],V[q]))return 0;b=Math.min(b,fw(A[$],A[k],V[Y],V[q],c))}return b}function Qv(u,a,c,f,p,x,b){if(x===null||b===null)return;const A=sp(ic(f,x),ic(p,b),c);A<a&&u.push({dist:A,range1:x,range2:b})}function oj(u,a,c,f,p=1/0){let x=Math.min(f.distance(u[0],c[0][0]),p);if(x===0)return x;const b=new Xv([{dist:0,range1:[0,u.length-1],range2:[0,0]}],hw),A=a?op:ap,k=In(c);for(;b.length;){const M=b.pop();if(M.dist>=x)continue;const $=M.range1;if(Fg($)<=A){if(!su($,u.length))return NaN;if(a){const V=ij(u,$,c,f);if((x=Math.min(x,V))===0)return x}else for(let V=$[0];V<=$[1];++V){const q=nj(u[V],c,f);if((x=Math.min(x,q))===0)return x}}else{const V=Yv($,a);if(V[0]!==null){const q=sp(ic(u,V[0]),k,f);q<x&&b.push({dist:q,range1:V[0],range2:[0,0]})}if(V[1]!==null){const q=sp(ic(u,V[1]),k,f);q<x&&b.push({dist:q,range1:V[1],range2:[0,0]})}}}return x}function x2(u,a,c,f,p,x=1/0){let b=Math.min(x,p.distance(u[0],c[0]));if(b===0)return b;const A=new Xv([{dist:0,range1:[0,u.length-1],range2:[0,c.length-1]}],hw),k=a?op:ap,M=f?op:ap;for(;A.length;){const $=A.pop();if($.dist>=b)continue;const V=$.range1,q=$.range2;if(Fg(V)<=k&&Fg(q)<=M){if(!su(V,u.length)||!su(q,c.length))return NaN;if(a&&f?b=Math.min(b,tj(u,V,c,q,p)):a||f?a&&!f?b=Math.min(b,v2(c,q,u,V,p)):!a&&f&&(b=Math.min(b,v2(u,V,c,q,p))):b=Math.min(b,rj(u,V,c,q,p)),b===0)return b}else{const X=Yv(V,a),Y=Yv(q,f);Qv(A,b,p,u,c,X[0],Y[0]),Qv(A,b,p,u,c,X[0],Y[1]),Qv(A,b,p,u,c,X[1],Y[0]),Qv(A,b,p,u,c,X[1],Y[1])}}return b}function pw(u,a,c,f,p=1/0){let x=p;const b=ic(u,[0,u.length-1]);for(const A of c)if(!(x!==1/0&&sp(b,ic(A,[0,A.length-1]),f)>=x)&&(x=Math.min(x,x2(u,a,A,!0,f,x)),x===0))return x;return x}function e_(u,a,c,f,p=1/0){let x=p;const b=ic(u,[0,u.length-1]);for(const A of c){if(x!==1/0&&sp(b,In(A),f)>=x)continue;const k=oj(u,a,A,f,x);if(isNaN(k))return k;if((x=Math.min(x,k))===0)return x}return x}function mw(u){return u==="Point"||u==="MultiPoint"||u==="LineString"||u==="MultiLineString"||u==="Polygon"||u==="MultiPolygon"}class Gh{constructor(a,c){this.type=Cr,this.geojson=a,this.geometries=c}static parse(a,c){if(a.length!==2)return c.error(`'distance' expression requires either one argument, but found ' ${a.length-1} instead.`);if(ep(a[1])){const f=a[1];if(f.type==="FeatureCollection"){for(let p=0;p<f.features.length;++p)if(mw(f.features[p].geometry.type))return new Gh(f,f.features[p].geometry)}else if(f.type==="Feature"){if(mw(f.geometry.type))return new Gh(f,f.geometry)}else if(mw(f.type))return new Gh(f,f)}return c.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(a){const c=a.geometry(),f=a.canonicalID();if(c!=null&&f!=null){if(a.geometryType()==="Point")return function(p,x,b){const A=[];for(const M of p)for(const $ of M)A.push(Jv($,x));const k=new ip(A[0][1],"meters");return b.type==="Point"||b.type==="MultiPoint"||b.type==="LineString"?x2(A,!1,b.type==="Point"?[b.coordinates]:b.coordinates,b.type==="LineString",k):b.type==="MultiLineString"?pw(A,!1,b.coordinates,k):b.type==="Polygon"||b.type==="MultiPolygon"?e_(A,!1,b.type==="Polygon"?[b.coordinates]:b.coordinates,k):null}(c,f,this.geometries);if(a.geometryType()==="LineString")return function(p,x,b){const A=[];for(const M of p){const $=[];for(const V of M)$.push(Jv(V,x));A.push($)}const k=new ip(A[0][0][1],"meters");if(b.type==="Point"||b.type==="MultiPoint"||b.type==="LineString")return pw(b.type==="Point"?[b.coordinates]:b.coordinates,b.type==="LineString",A,k);if(b.type==="MultiLineString"){let M=1/0;for(let $=0;$<b.coordinates.length;$++){const V=pw(b.coordinates[$],!0,A,k,M);if(isNaN(V))return V;if((M=Math.min(M,V))===0)return M}return M}if(b.type==="Polygon"||b.type==="MultiPolygon"){let M=1/0;for(let $=0;$<A.length;$++){const V=e_(A[$],!0,b.type==="Polygon"?[b.coordinates]:b.coordinates,k,M);if(isNaN(V))return V;if((M=Math.min(M,V))===0)return M}return M}return null}(c,f,this.geometries);if(a.geometryType()==="Polygon")return function(p,x,b){const A=[];for(const M of function($,V){const q=$.length;if(q<=1)return[$];const X=[];let Y,se;for(let ce=0;ce<q;ce++){const he=KR($[ce]);he!==0&&($[ce].area=Math.abs(he),se===void 0&&(se=he<0),se===he<0?(Y&&X.push(Y),Y=[$[ce]]):Y.push($[ce]))}return Y&&X.push(Y),X}(p)){const $=[];for(let V=0;V<M.length;++V)$.push(ej(M[V],x));A.push($)}const k=new ip(A[0][0][0][1],"meters");if(b.type==="Point"||b.type==="MultiPoint"||b.type==="LineString")return e_(b.type==="Point"?[b.coordinates]:b.coordinates,b.type==="LineString",A,k);if(b.type==="MultiLineString"){let M=1/0;for(let $=0;$<b.coordinates.length;$++){const V=e_(b.coordinates[$],!0,A,k,M);if(isNaN(V))return V;if((M=Math.min(M,V))===0)return M}return M}return b.type==="Polygon"||b.type==="MultiPolygon"?function(M,$,V){let q=1/0;for(const X of M)for(const Y of $){const se=aj(X,Y,V,q);if(isNaN(se))return se;if((q=Math.min(q,se))===0)return q}return q}(b.type==="Polygon"?[b.coordinates]:b.coordinates,A,k):null}(c,f,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function lp(u){if(u instanceof os&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof Wh||u instanceof Gh)return!1;if(u instanceof up)return u.featureConstant;let a=!0;return u.eachChild(c=>{a&&!lp(c)&&(a=!1)}),a}function zg(u){if(u instanceof os&&u.name==="feature-state")return!1;let a=!0;return u.eachChild(c=>{a&&!zg(c)&&(a=!1)}),a}function cp(u,a){if(u instanceof os&&a.indexOf(u.name)>=0)return!1;let c=!0;return u.eachChild(f=>{c&&!cp(f,a)&&(c=!1)}),c}function b2(u,a,c){return[u,a,c].filter(Boolean).join("")}function gw(u,a){switch(u){case"string":return au(a);case"number":return+a;case"boolean":return!!a;case"color":return ni.parse(a);case"formatted":return po.fromString(au(a));case"resolvedImage":return Ds.build(au(a))}return a}function w2(u,a,c,f){return f!==void 0&&(u=f*Math.round(u/f)),a!==void 0&&u<a&&(u=a),c!==void 0&&u>c&&(u=c),u}class up{constructor(a,c,f,p=!1){this.type=a,this.key=c,this.scope=f,this.featureConstant=p}static parse(a,c){let f=c.expectedType;if(f==null&&(f=oi),a.length<2||a.length>3)return c.error("Invalid number of arguments for 'config' expression.");const p=c.parse(a[1],1);if(!(p instanceof Vu))return c.error("Key name of 'config' expression must be a string literal.");let x,b=!0;const A=au(p.value);if(a.length>=3){const k=c.parse(a[2],2);if(!(k instanceof Vu))return c.error("Scope of 'config' expression must be a string literal.");x=au(k.value)}if(c.options){const k=b2(A,x,c._scope),M=c.options.get(k);M&&(b=lp(M.value||M.default))}return new up(f,A,x,b)}evaluate(a){const c=b2(this.key,this.scope,a.scope),f=a.getConfig(c);if(!f)return null;const{type:p,value:x,values:b,minValue:A,maxValue:k,stepValue:M}=f,$=f.default.evaluate(a);let V=$;if(x){const q=a.scope;a.scope=(q||"").split("").slice(1).join(""),V=x.evaluate(a),a.scope=q}return p&&(V=gw(p,V)),V===void 0||A===void 0&&k===void 0&&M===void 0||(typeof V=="number"?V=w2(V,A,k,M):Array.isArray(V)&&(V=V.map(q=>typeof q=="number"?w2(q,A,k,M):q))),x!==void 0&&V!==void 0&&b&&!b.includes(V)&&(V=$,p&&(V=gw(p,V))),(p&&p!==this.type||V!==void 0&&!Uv(co(V),this.type))&&(V=gw(this.type.kind,V)),V}eachChild(){}outputDefined(){return!1}serialize(){const a=["config",this.key];return this.scope&&a.concat(this.scope),a}}class t_{constructor(a,c){this.type=c.type,this.name=a,this.boundExpression=c}static parse(a,c){if(a.length!==2||typeof a[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const f=a[1];return c.scope.has(f)?new t_(f,c.scope.get(f)):c.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class r_{constructor(a,c=[],f,p=new tc,x=[],b,A,k){this.registry=a,this.path=c,this.key=c.map(M=>typeof M=="string"?`['${M}']`:`[${M}]`).join(""),this.scope=p,this.errors=x,this.expectedType=f,this._scope=b,this.options=A,this.iconImageUseTheme=k}parse(a,c,f,p,x={}){return c||f?this.concat(c,null,f,p)._parse(a,x):this._parse(a,x)}parseObjectValue(a,c,f,p,x,b={}){return this.concat(c,f,p,x)._parse(a,b)}_parse(a,c){function f(p,x,b){return b==="assert"?new Sr(x,[p]):b==="coerce"?new ou(x,[p]):p}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=typeof a[0]=="string"?this.registry[a[0]]:void 0;if(p){let x=p.parse(a,this);if(!x)return null;if(this.expectedType){const b=this.expectedType,A=x.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||A.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||A.kind!=="value"&&A.kind!=="string"){if(this.checkSubtype(b,A))return null}else x=f(x,b,c.typeAnnotation||"coerce");else x=f(x,b,c.typeAnnotation||"assert")}if(!(x instanceof Vu)&&x.type.kind!=="resolvedImage"&&yw(x)){const b=new So(this._scope,this.options,this.iconImageUseTheme);try{x=new Vu(x.type,x.evaluate(b))}catch(A){return this.error(A.message),null}}return x}return ou.parse(["to-array",a],this)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,c,f,p){let x=typeof a=="number"?this.path.concat(a):this.path;x=typeof c=="string"?x.concat(c):x;const b=p?this.scope.concat(p):this.scope;return new r_(this.registry,x,f||null,b,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(a,...c){const f=`${this.key}${c.map(p=>`[${p}]`).join("")}`;this.errors.push(new ec(f,a))}checkSubtype(a,c){const f=kg(a,c);return f&&this.error(f),f}}function yw(u){if(u instanceof t_)return yw(u.boundExpression);if(u instanceof os&&u.name==="error"||u instanceof rp||u instanceof Wh||u instanceof Gh||u instanceof up)return!1;const a=u instanceof ou||u instanceof Sr;let c=!0;return u.eachChild(f=>{c=a?c&&yw(f):c&&f instanceof Vu}),!!c&&lp(u)&&cp(u,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function n_(u,a){const c=u.length-1;let f,p,x=0,b=c,A=0;for(;x<=b;)if(A=Math.floor((x+b)/2),f=u[A],p=u[A+1],f<=a){if(A===c||a<p)return A;x=A+1}else{if(!(f>a))throw new Ta("Input is not a number.");b=A-1}return 0}class Bg{constructor(a,c,f){this.type=a,this.input=c,this.labels=[],this.outputs=[];for(const[p,x]of f)this.labels.push(p),this.outputs.push(x)}static parse(a,c){if(a.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return c.error("Expected an even number of arguments.");const f=c.parse(a[1],1,Cr);if(!f)return null;const p=[];let x=null;c.expectedType&&c.expectedType.kind!=="value"&&(x=c.expectedType);for(let b=1;b<a.length;b+=2){const A=b===1?-1/0:a[b],k=a[b+1],M=b,$=b+1;if(typeof A!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(p.length&&p[p.length-1][0]>=A)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const V=c.parse(k,$,x);if(!V)return null;x=x||V.type,p.push([A,V])}return new Bg(x,f,p)}evaluate(a){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(a);const p=this.input.evaluate(a);if(p<=c[0])return f[0].evaluate(a);const x=c.length;return p>=c[x-1]?f[x-1].evaluate(a):f[n_(c,p)].evaluate(a)}eachChild(a){a(this.input);for(const c of this.outputs)a(c)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}serialize(){const a=["step",this.input.serialize()];for(let c=0;c<this.labels.length;c++)c>0&&a.push(this.labels[c]),a.push(this.outputs[c].serialize());return a}}const S2=.95047,E2=1.08883,T2=4/29,dp=6/29,i_=3*dp*dp,sj=dp*dp*dp,A2=Math.PI/180,lj=180/Math.PI;function vw(u){return u>sj?Math.pow(u,1/3):u/i_+T2}function _w(u){return u>dp?u*u*u:i_*(u-T2)}function a_(u){return 255*(u<=.0031308?12.92*u:1.055*Math.pow(u,1/2.4)-.055)}function o_(u){return(u/=255)<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function Hh(u){const a=o_(u.r),c=o_(u.g),f=o_(u.b),p=vw((.4124564*a+.3575761*c+.1804375*f)/S2),x=vw((.2126729*a+.7151522*c+.072175*f)/1);return{l:116*x-16,a:500*(p-x),b:200*(x-vw((.0193339*a+.119192*c+.9503041*f)/E2)),alpha:u.a}}function xw(u){let a=(u.l+16)/116,c=isNaN(u.a)?a:a+u.a/500,f=isNaN(u.b)?a:a-u.b/200;return a=1*_w(a),c=S2*_w(c),f=E2*_w(f),new ni(a_(3.2404542*c-1.5371385*a-.4985314*f),a_(-.969266*c+1.8760108*a+.041556*f),a_(.0556434*c-.2040259*a+1.0572252*f),u.alpha)}function P2(u,a,c){const f=a-u;return u+c*(f>180||f<-180?f-360*Math.round(f/360):f)}const $g={forward:Hh,reverse:xw,interpolate:function(u,a,c){return{l:qr(u.l,a.l,c),a:qr(u.a,a.a,c),b:qr(u.b,a.b,c),alpha:qr(u.alpha,a.alpha,c)}}},Kh={forward:function(u){const{l:a,a:c,b:f}=Hh(u),p=Math.atan2(f,c)*lj;return{h:p<0?p+360:p,c:Math.sqrt(c*c+f*f),l:a,alpha:u.a}},reverse:function(u){const a=u.h*A2,c=u.c;return xw({l:u.l,a:Math.cos(a)*c,b:Math.sin(a)*c,alpha:u.alpha})},interpolate:function(u,a,c){return{h:P2(u.h,a.h,c),c:qr(u.c,a.c,c),l:qr(u.l,a.l,c),alpha:qr(u.alpha,a.alpha,c)}}};var s_=Object.freeze({__proto__:null,hcl:Kh,lab:$g});class bl{constructor(a,c,f,p,x){this.type=a,this.operator=c,this.interpolation=f,this.input=p,this.labels=[],this.outputs=[];for(const[b,A]of x)this.labels.push(b),this.outputs.push(A)}static interpolationFactor(a,c,f,p){let x=0;if(a.name==="exponential")x=bw(c,a.base,f,p);else if(a.name==="linear")x=bw(c,1,f,p);else if(a.name==="cubic-bezier"){const b=a.controlPoints;x=new Uo(b[0],b[1],b[2],b[3]).solve(bw(c,1,f,p))}return x}static parse(a,c){let[f,p,x,...b]=a;if(!Array.isArray(p)||p.length===0)return c.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const M=p[1];if(typeof M!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:M}}else{if(p[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const M=p.slice(1);if(M.length!==4||M.some($=>typeof $!="number"||$<0||$>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:M}}}if(a.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length-1>3&&(a.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(x=c.parse(x,2,Cr),!x)return null;const A=[];let k=null;f==="interpolate-hcl"||f==="interpolate-lab"?k=Js:c.expectedType&&c.expectedType.kind!=="value"&&(k=c.expectedType);for(let M=0;M<b.length;M+=2){const $=b[M],V=b[M+1],q=M+3,X=M+4;if(typeof $!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',q);if(A.length&&A[A.length-1][0]>=$)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',q);const Y=c.parse(V,X,k);if(!Y)return null;k=k||Y.type,A.push([$,Y])}return k.kind==="number"||k.kind==="color"||k.kind==="array"&&k.itemType.kind==="number"&&typeof k.N=="number"?new bl(k,f,p,x,A):c.error(`Type ${qa(k)} is not interpolatable.`)}evaluate(a){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(a);const p=this.input.evaluate(a);if(p<=c[0])return f[0].evaluate(a);const x=c.length;if(p>=c[x-1])return f[x-1].evaluate(a);const b=n_(c,p),A=bl.interpolationFactor(this.interpolation,p,c[b],c[b+1]),k=f[b].evaluate(a),M=f[b+1].evaluate(a);return this.operator==="interpolate"?$u[this.type.kind.toLowerCase()](k,M,A):this.operator==="interpolate-hcl"?Kh.reverse(Kh.interpolate(Kh.forward(k),Kh.forward(M),A)):$g.reverse($g.interpolate($g.forward(k),$g.forward(M),A))}eachChild(a){a(this.input);for(const c of this.outputs)a(c)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}serialize(){let a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const c=[this.operator,a,this.input.serialize()];for(let f=0;f<this.labels.length;f++)c.push(this.labels[f],this.outputs[f].serialize());return c}}function bw(u,a,c,f){const p=f-c,x=u-c;return p===0?0:a===1?x/p:(Math.pow(a,x)-1)/(Math.pow(a,p)-1)}class Ug{constructor(a,c){this.type=a,this.args=c}static parse(a,c){if(a.length<2)return c.error("Expectected at least one argument.");let f=null;const p=c.expectedType;p&&p.kind!=="value"&&(f=p);const x=[];for(const A of a.slice(1)){const k=c.parse(A,1+x.length,f,void 0,{typeAnnotation:"omit"});if(!k)return null;f=f||k.type,x.push(k)}const b=p&&x.some(A=>kg(p,A.type));return new Ug(b?oi:f,x)}evaluate(a){let c,f=null,p=0;for(const x of this.args){if(p++,f=x.evaluate(a),f&&f instanceof Ds&&!f.available&&(c||(c=f),f=null,p===this.args.length))return c;if(f!==null)break}return f}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){const a=["coalesce"];return this.eachChild(c=>{a.push(c.serialize())}),a}}class Vg{constructor(a,c){this.type=c.type,this.bindings=[].concat(a),this.result=c}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const c of this.bindings)a(c[1]);a(this.result)}static parse(a,c){if(a.length<4)return c.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const f=[];for(let x=1;x<a.length-1;x+=2){const b=a[x];if(typeof b!="string")return c.error(`Expected string, but found ${typeof b} instead.`,x);if(/[^a-zA-Z0-9_]/.test(b))return c.error("Variable names must contain only alphanumeric characters or '_'.",x);const A=c.parse(a[x+1],x+1);if(!A)return null;f.push([b,A])}const p=c.parse(a[a.length-1],a.length-1,c.expectedType,f);return p?new Vg(f,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const a=["let"];for(const[c,f]of this.bindings)a.push(c,f.serialize());return a.push(this.result.serialize()),a}}class ww{constructor(a,c,f){this.type=a,this.index=c,this.input=f}static parse(a,c){if(a.length!==3)return c.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const f=c.parse(a[1],1,Cr),p=c.parse(a[2],2,wo(c.expectedType||oi));return f&&p?new ww(p.type.itemType,f,p):null}evaluate(a){const c=this.index.evaluate(a),f=this.input.evaluate(a);if(c<0)throw new Ta("Array index out of bounds: negative index");if(c>=f.length)throw new Ta("Array index out of bounds: index exceeds array size");if(c!==Math.floor(c))throw new Ta("Array index must be an integer. Use at-interpolated for fractional indices");return f[c]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Sw{constructor(a,c,f){this.type=a,this.index=c,this.input=f}static parse(a,c){if(a.length!==3)return c.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const f=c.parse(a[1],1,Cr),p=c.parse(a[2],2,wo(c.expectedType||oi));return f&&p?new Sw(p.type.itemType,f,p):null}evaluate(a){const c=this.index.evaluate(a),f=this.input.evaluate(a);if(c<0)throw new Ta(`Array index out of bounds: ${c} < 0.`);if(c>f.length-1)throw new Ta(`Array index out of bounds: ${c} > ${f.length-1}.`);if(c===Math.floor(c))return f[c];const p=Math.floor(c),x=Math.ceil(c),b=f[p],A=f[x];if(typeof b!="number"||typeof A!="number")throw new Ta(`Cannot interpolate between non-number values at index ${c}.`);const k=c-p;return b*(1-k)+A*k}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Ew{constructor(a,c){this.type=ti,this.needle=a,this.haystack=c}static parse(a,c){if(a.length!==3)return c.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const f=c.parse(a[1],1,oi),p=c.parse(a[2],2,oi);return f&&p?iw(f.type,[ti,Vn,Cr,Jf,oi])?new Ew(f,p):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${qa(f.type)} instead`):null}evaluate(a){const c=this.needle.evaluate(a),f=this.haystack.evaluate(a);if(f==null)return!1;if(!Ig(c,["boolean","string","number","null"]))throw new Ta(`Expected first argument to be of type boolean, string, number or null, but found ${qa(co(c))} instead.`);if(!Ig(f,["string","array"]))throw new Ta(`Expected second argument to be of type array or string, but found ${qa(co(f))} instead.`);return f.indexOf(c)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class qg{constructor(a,c,f){this.type=Cr,this.needle=a,this.haystack=c,this.fromIndex=f}static parse(a,c){if(a.length<=2||a.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const f=c.parse(a[1],1,oi),p=c.parse(a[2],2,oi);if(!f||!p)return null;if(!iw(f.type,[ti,Vn,Cr,Jf,oi]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${qa(f.type)} instead`);if(a.length===4){const x=c.parse(a[3],3,Cr);return x?new qg(f,p,x):null}return new qg(f,p)}evaluate(a){const c=this.needle.evaluate(a),f=this.haystack.evaluate(a);if(!Ig(c,["boolean","string","number","null"]))throw new Ta(`Expected first argument to be of type boolean, string, number or null, but found ${qa(co(c))} instead.`);if(!Ig(f,["string","array"]))throw new Ta(`Expected second argument to be of type array or string, but found ${qa(co(f))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(a);return f.indexOf(c,p)}return f.indexOf(c)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class l_{constructor(a,c,f,p,x,b){this.inputType=a,this.type=c,this.input=f,this.cases=p,this.outputs=x,this.otherwise=b}static parse(a,c){if(a.length<5)return c.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return c.error("Expected an even number of arguments.");let f,p;c.expectedType&&c.expectedType.kind!=="value"&&(p=c.expectedType);const x={},b=[];for(let M=2;M<a.length-1;M+=2){let $=a[M];const V=a[M+1];Array.isArray($)||($=[$]);const q=c.concat(M);if($.length===0)return q.error("Expected at least one branch label.");for(const Y of $){if(typeof Y!="number"&&typeof Y!="string")return q.error("Branch labels must be numbers or strings.");if(typeof Y=="number"&&Math.abs(Y)>Number.MAX_SAFE_INTEGER)return q.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Y=="number"&&Math.floor(Y)!==Y)return q.error("Numeric branch labels must be integer values.");if(f){if(q.checkSubtype(f,co(Y)))return null}else f=co(Y);if(x[String(Y)]!==void 0)return q.error("Branch labels must be unique.");x[String(Y)]=b.length}const X=c.parse(V,M,p);if(!X)return null;p=p||X.type,b.push(X)}const A=c.parse(a[1],1,oi);if(!A)return null;const k=c.parse(a[a.length-1],a.length-1,p);return k?A.type.kind!=="value"&&c.concat(1).checkSubtype(f,A.type)?null:new l_(f,p,A,x,b,k):null}evaluate(a){const c=this.input.evaluate(a);return(Uv(co(c),this.inputType)&&this.outputs[this.cases[c]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every(a=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const a=["match",this.input.serialize()],c=Object.keys(this.cases).sort(),f=[],p={};for(const b of c){const A=p[this.cases[b]];A===void 0?(p[this.cases[b]]=f.length,f.push([this.cases[b],[b]])):f[A][1].push(b)}const x=b=>this.inputType.kind==="number"?Number(b):b;for(const[b,A]of f)a.push(A.length===1?x(A[0]):A.map(x)),a.push(this.outputs[b].serialize());return a.push(this.otherwise.serialize()),a}}class hp{constructor(a,c,f){this.type=a,this.branches=c,this.otherwise=f}static parse(a,c){if(a.length<4)return c.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return c.error("Expected an odd number of arguments.");let f;c.expectedType&&c.expectedType.kind!=="value"&&(f=c.expectedType);const p=[];for(let b=1;b<a.length-1;b+=2){const A=c.parse(a[b],b,ti);if(!A)return null;const k=c.parse(a[b+1],b+1,f);if(!k)return null;p.push([A,k]),f=f||k.type}const x=c.parse(a[a.length-1],a.length-1,f);return x?new hp(f,p,x):null}evaluate(a){for(const[c,f]of this.branches)if(c.evaluate(a))return f.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[c,f]of this.branches)a(c),a(f);a(this.otherwise)}outputDefined(){return this.branches.every(([a,c])=>c.outputDefined())&&this.otherwise.outputDefined()}serialize(){const a=["case"];return this.eachChild(c=>{a.push(c.serialize())}),a}}class c_{constructor(a,c,f,p){this.type=a,this.input=c,this.beginIndex=f,this.endIndex=p}static parse(a,c){if(a.length<=2||a.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const f=c.parse(a[1],1,oi),p=c.parse(a[2],2,Cr);if(!f||!p)return null;if(!iw(f.type,[wo(oi),Vn,oi]))return c.error(`Expected first argument to be of type array or string, but found ${qa(f.type)} instead`);if(a.length===4){const x=c.parse(a[3],3,Cr);return x?new c_(f.type,f,p,x):null}return new c_(f.type,f,p)}evaluate(a){const c=this.input.evaluate(a),f=this.beginIndex.evaluate(a);if(!Ig(c,["string","array"]))throw new Ta(`Expected first argument to be of type array or string, but found ${qa(co(c))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(a);return c.slice(f,p)}return c.slice(f)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class u_{constructor(a,c){this.type=wo(Vn),this.str=a,this.delimiter=c}static parse(a,c){if(a.length!==3)return c.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const f=c.parse(a[1],1,Vn),p=c.parse(a[2],2,Vn);return f&&p?new u_(f,p):void 0}evaluate(a){const c=this.str.evaluate(a),f=this.delimiter.evaluate(a);return c.split(f)}eachChild(a){a(this.str),a(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function C2(u,a){return u==="=="||u==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function O2(u,a,c,f){return f.compare(a,c)===0}function fp(u,a,c){const f=u!=="=="&&u!=="!=";return class pne{constructor(x,b,A){this.type=ti,this.lhs=x,this.rhs=b,this.collator=A,this.hasUntypedArgument=x.type.kind==="value"||b.type.kind==="value"}static parse(x,b){if(x.length!==3&&x.length!==4)return b.error("Expected two or three arguments.");const A=x[0];let k=b.parse(x[1],1,oi);if(!k)return null;if(!C2(A,k.type))return b.concat(1).error(`"${A}" comparisons are not supported for type '${qa(k.type)}'.`);let M=b.parse(x[2],2,oi);if(!M)return null;if(!C2(A,M.type))return b.concat(2).error(`"${A}" comparisons are not supported for type '${qa(M.type)}'.`);if(k.type.kind!==M.type.kind&&k.type.kind!=="value"&&M.type.kind!=="value")return b.error(`Cannot compare types '${qa(k.type)}' and '${qa(M.type)}'.`);f&&(k.type.kind==="value"&&M.type.kind!=="value"?k=new Sr(M.type,[k]):k.type.kind!=="value"&&M.type.kind==="value"&&(M=new Sr(k.type,[M])));let $=null;if(x.length===4){if(k.type.kind!=="string"&&M.type.kind!=="string"&&k.type.kind!=="value"&&M.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if($=b.parse(x[3],3,Cg),!$)return null}return new pne(k,M,$)}evaluate(x){const b=this.lhs.evaluate(x),A=this.rhs.evaluate(x);if(f&&this.hasUntypedArgument){const k=co(b),M=co(A);if(k.kind!==M.kind||k.kind!=="string"&&k.kind!=="number")throw new Ta(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${k.kind}, ${M.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const k=co(b),M=co(A);if(k.kind!=="string"||M.kind!=="string")return a(x,b,A)}return this.collator?c(x,b,A,this.collator.evaluate(x)):a(x,b,A)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}serialize(){const x=[u];return this.eachChild(b=>{x.push(b.serialize())}),x}}}const k2=fp("==",function(u,a,c){return a===c},O2),I2=fp("!=",function(u,a,c){return a!==c},function(u,a,c,f){return!O2(0,a,c,f)}),cj=fp("<",function(u,a,c){return a<c},function(u,a,c,f){return f.compare(a,c)<0}),uj=fp(">",function(u,a,c){return a>c},function(u,a,c,f){return f.compare(a,c)>0}),dj=fp("<=",function(u,a,c){return a<=c},function(u,a,c,f){return f.compare(a,c)<=0}),d_=fp(">=",function(u,a,c){return a>=c},function(u,a,c,f){return f.compare(a,c)>=0});class Tw{constructor(a,c,f,p,x,b){this.type=Vn,this.number=a,this.locale=c,this.currency=f,this.unit=p,this.minFractionDigits=x,this.maxFractionDigits=b}static parse(a,c){if(a.length!==3)return c.error("Expected two arguments.");const f=c.parse(a[1],1,Cr);if(!f)return null;const p=a[2];if(typeof p!="object"||Array.isArray(p))return c.error("NumberFormat options argument must be an object.");let x=null;if(p.locale&&(x=c.parseObjectValue(p.locale,2,"locale",Vn),!x))return null;let b=null;if(p.currency&&(b=c.parseObjectValue(p.currency,2,"currency",Vn),!b))return null;let A=null;if(p.unit&&(A=c.parseObjectValue(p.unit,2,"unit",Vn),!A))return null;let k=null;if(p["min-fraction-digits"]&&(k=c.parseObjectValue(p["min-fraction-digits"],2,"min-fraction-digits",Cr),!k))return null;let M=null;return p["max-fraction-digits"]&&(M=c.parseObjectValue(p["max-fraction-digits"],2,"max-fraction-digits",Cr),!M)?null:new Tw(f,x,b,A,k,M)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(a):void 0,unit:this.unit?this.unit.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.unit&&a(this.unit),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.unit&&(a.unit=this.unit.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]}}class Aw{constructor(a){this.type=Cr,this.input=a}static parse(a,c){if(a.length!==2)return c.error(`Expected 1 argument, but found ${a.length-1} instead.`);const f=c.parse(a[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${qa(f.type)} instead.`):new Aw(f):null}evaluate(a){const c=this.input.evaluate(a);if(typeof c=="string"||Array.isArray(c))return c.length;throw new Ta(`Expected value to be of type string or array, but found ${qa(co(c))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}serialize(){const a=["length"];return this.eachChild(c=>{a.push(c.serialize())}),a}}function R2(u){return function(){u=1831565813+(u|=0)|0;let a=Math.imul(u^u>>>15,1|u);return a=a+Math.imul(a^a>>>7,61|a)^a,((a^a>>>14)>>>0)/4294967296}}const pp={"==":k2,"!=":I2,">":uj,"<":cj,">=":d_,"<=":dj,array:Sr,at:ww,"at-interpolated":Sw,boolean:Sr,case:hp,coalesce:Ug,collator:rp,format:Vh,image:Yr,in:Ew,"index-of":qg,interpolate:bl,"interpolate-hcl":bl,"interpolate-lab":bl,length:Aw,let:Vg,literal:Vu,match:l_,number:Sr,"number-format":Tw,object:Sr,slice:c_,step:Bg,string:Sr,"to-boolean":ou,"to-color":ou,"to-number":ou,"to-string":ou,var:t_,within:Wh,distance:Gh,config:up,split:u_};function Pw(u,[a,c,f,p]){a=a.evaluate(u),c=c.evaluate(u),f=f.evaluate(u);const x=p?p.evaluate(u):1,b=Vv(a,c,f,x);if(b)throw new Ta(b);return new ni(a/255,c/255,f/255,x)}function j2(u,[a,c,f,p]){a=a.evaluate(u),c=c.evaluate(u),f=f.evaluate(u);const x=p?p.evaluate(u):1,b=function(M,$,V,q){return typeof M=="number"&&M>=0&&M<=360?typeof $=="number"&&$>=0&&$<=100&&typeof V=="number"&&V>=0&&V<=100?q===void 0||typeof q=="number"&&q>=0&&q<=1?null:`Invalid hsla value [${[M,$,V,q].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof q=="number"?[M,$,V,q]:[M,$,V]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof q=="number"?[M,$,V,q]:[M,$,V]).join(", ")}]: 'h' must be between 0 and 360.`}(a,c,f,x);if(b)throw new Ta(b);const A=`hsla(${a}, ${c}%, ${f}%, ${x})`,k=ni.parse(A);if(!k)throw new Ta(`Failed to parse HSLA color: ${A}`);return k}function N2(u,a){return u in a}function h_(u,a){const c=a[u];return c===void 0?null:c}function Wu(u){return{type:u}}function Wg(u){if(u instanceof up)return new Set([u.key]);let a=new Set;return u.eachChild(c=>{a=new Set([...a,...Wg(c)])}),a}function f_(u){if(u instanceof os&&u.name==="is-active-floor")return!0;let a=!1;return u.eachChild(c=>{!a&&f_(c)&&(a=!0)}),a}function Zh(u){return{result:"success",value:u}}function $d(u){return{result:"error",value:u}}function Cw(u,a){return!!u&&!!u.parameters&&u.parameters.indexOf(a)>-1}function p_(u){return u["property-type"]==="data-driven"}function Ow(u){return Cw(u.expression,"measure-light")}function kw(u){return Cw(u.expression,"zoom")}function m_(u){return!!u.expression&&u.expression.interpolated}function g_(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function Iw(u){return u}function y_(u,a){const c=a.type==="color",f=u.stops&&typeof u.stops[0][0]=="object",p=f||!(f||u.property!==void 0),x=u.type||(m_(a)?"exponential":"interval");if(c&&((u=Object.assign({},u)).stops&&(u.stops=u.stops.map(M=>[M[0],ni.parse(M[1])])),u.default=ni.parse(u.default?u.default:a.default)),u.colorSpace&&u.colorSpace!=="rgb"&&!s_[u.colorSpace])throw new Error(`Unknown color space: ${u.colorSpace}`);let b,A,k;if(x==="exponential")b=M2;else if(x==="interval")b=Ud;else if(x==="categorical"){b=hj,A=Object.create(null);for(const M of u.stops)A[M[0]]=M[1];k=typeof u.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);b=fj}if(f){const M={},$=[];for(let X=0;X<u.stops.length;X++){const Y=u.stops[X],se=Y[0].zoom;M[se]===void 0&&(M[se]={zoom:se,type:u.type,property:u.property,default:u.default,stops:[]},$.push(se)),M[se].stops.push([Y[0].value,Y[1]])}const V=[];for(const X of $)V.push([M[X].zoom,y_(M[X],a)]);const q={name:"linear"};return{kind:"composite",interpolationType:q,interpolationFactor:bl.interpolationFactor.bind(void 0,q),zoomStops:V.map(X=>X[0]),evaluate:({zoom:X},Y)=>M2({stops:V,base:u.base},a,X).evaluate(X,Y)}}if(p){const M=x==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:bl.interpolationFactor.bind(void 0,M),zoomStops:u.stops.map($=>$[0]),evaluate:({zoom:$})=>b(u,a,$,A,k)}}return{kind:"source",evaluate(M,$){const V=$&&$.properties?$.properties[u.property]:void 0;return V===void 0?mp(u.default,a.default):b(u,a,V,A,k)}}}function mp(u,a,c){return u!==void 0?u:a!==void 0?a:c!==void 0?c:void 0}function hj(u,a,c,f,p){return mp(typeof c===p?f[c]:void 0,u.default,a.default)}function Ud(u,a,c){if(!jg(c))return mp(u.default,a.default);const f=u.stops.length;if(f===1||c<=u.stops[0][0])return u.stops[0][1];if(c>=u.stops[f-1][0])return u.stops[f-1][1];const p=n_(u.stops.map(x=>x[0]),c);return u.stops[p][1]}function M2(u,a,c){const f=u.base!==void 0?u.base:1;if(!jg(c))return mp(u.default,a.default);const p=u.stops.length;if(p===1||c<=u.stops[0][0])return u.stops[0][1];if(c>=u.stops[p-1][0])return u.stops[p-1][1];const x=n_(u.stops.map($=>$[0]),c),b=function($,V,q,X){const Y=X-q,se=$-q;return Y===0?0:V===1?se/Y:(Math.pow(V,se)-1)/(Math.pow(V,Y)-1)}(c,f,u.stops[x][0],u.stops[x+1][0]),A=u.stops[x][1],k=u.stops[x+1][1];let M=$u[a.type]||Iw;if(u.colorSpace&&u.colorSpace!=="rgb"){const $=s_[u.colorSpace];M=(V,q)=>$.reverse($.interpolate($.forward(V),$.forward(q),b))}return typeof A.evaluate=="function"?{evaluate(...$){const V=A.evaluate.apply(void 0,$),q=k.evaluate.apply(void 0,$);if(V!==void 0&&q!==void 0)return M(V,q,b)}}:M(A,k,b)}function fj(u,a,c){return a.type==="color"?c=ni.parse(c):a.type==="formatted"?c=po.fromString(c.toString()):a.type==="resolvedImage"?c=Ds.build(c.toString()):tp(c)===a.type||a.type==="enum"&&a.values[c]||(c=void 0),mp(c,u.default,a.default)}os.register(pp,{error:[{kind:"error"},[Vn],(u,[a])=>{throw new Ta(a.evaluate(u))}],typeof:[Vn,[oi],(u,[a])=>qa(co(a.evaluate(u)))],"to-rgba":[wo(Cr,4),[Js],(u,[a])=>a.evaluate(u).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[wo(Cr,4),[Js],(u,[a])=>a.evaluate(u).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Js,[Cr,Cr,Cr],Pw],rgba:[Js,[Cr,Cr,Cr,Cr],Pw],hsl:[Js,[Cr,Cr,Cr],j2],hsla:[Js,[Cr,Cr,Cr,Cr],j2],has:{type:ti,overloads:[[[Vn],(u,[a])=>N2(a.evaluate(u),u.properties())],[[Vn,Qf],(u,[a,c])=>N2(a.evaluate(u),c.evaluate(u))]]},get:{type:oi,overloads:[[[Vn],(u,[a])=>h_(a.evaluate(u),u.properties())],[[Vn,Qf],(u,[a,c])=>h_(a.evaluate(u),c.evaluate(u))]]},"feature-state":[oi,[Vn],(u,[a])=>h_(a.evaluate(u),u.featureState||{})],properties:[Qf,[],u=>u.properties()],"geometry-type":[Vn,[],u=>u.geometryType()],worldview:[Vn,[],u=>u.globals.worldview||""],"is-active-floor":[ti,Wu(Vn),(u,a)=>{if(!(u.globals.activeFloors&&u.globals.activeFloors.size>0))return!1;const c=u.globals.activeFloors;return a.some(f=>{const p=f.evaluate(u);return c.has(p)})}],id:[oi,[],u=>u.id()],zoom:[Cr,[],u=>u.globals.zoom],pitch:[Cr,[],u=>u.globals.pitch||0],"distance-from-center":[Cr,[],u=>u.distanceFromCenter()],"measure-light":[Cr,[Vn],(u,[a])=>u.measureLight(a.evaluate(u))],"heatmap-density":[Cr,[],u=>u.globals.heatmapDensity||0],"line-progress":[Cr,[],u=>u.globals.lineProgress||0],"raster-value":[Cr,[],u=>u.globals.rasterValue||0],"raster-particle-speed":[Cr,[],u=>u.globals.rasterParticleSpeed||0],"sky-radial-progress":[Cr,[],u=>u.globals.skyRadialProgress||0],accumulated:[oi,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[Cr,Wu(Cr),(u,a)=>{let c=0;for(const f of a)c+=f.evaluate(u);return c}],"*":[Cr,Wu(Cr),(u,a)=>{let c=1;for(const f of a)c*=f.evaluate(u);return c}],"-":{type:Cr,overloads:[[[Cr,Cr],(u,[a,c])=>a.evaluate(u)-c.evaluate(u)],[[Cr],(u,[a])=>-a.evaluate(u)]]},"/":[Cr,[Cr,Cr],(u,[a,c])=>a.evaluate(u)/c.evaluate(u)],"%":[Cr,[Cr,Cr],(u,[a,c])=>a.evaluate(u)%c.evaluate(u)],ln2:[Cr,[],()=>Math.LN2],pi:[Cr,[],()=>Math.PI],e:[Cr,[],()=>Math.E],"^":[Cr,[Cr,Cr],(u,[a,c])=>Math.pow(a.evaluate(u),c.evaluate(u))],sqrt:[Cr,[Cr],(u,[a])=>Math.sqrt(a.evaluate(u))],log10:[Cr,[Cr],(u,[a])=>Math.log(a.evaluate(u))/Math.LN10],ln:[Cr,[Cr],(u,[a])=>Math.log(a.evaluate(u))],log2:[Cr,[Cr],(u,[a])=>Math.log2(a.evaluate(u))],sin:[Cr,[Cr],(u,[a])=>Math.sin(a.evaluate(u))],cos:[Cr,[Cr],(u,[a])=>Math.cos(a.evaluate(u))],tan:[Cr,[Cr],(u,[a])=>Math.tan(a.evaluate(u))],asin:[Cr,[Cr],(u,[a])=>Math.asin(a.evaluate(u))],acos:[Cr,[Cr],(u,[a])=>Math.acos(a.evaluate(u))],atan:[Cr,[Cr],(u,[a])=>Math.atan(a.evaluate(u))],min:[Cr,Wu(Cr),(u,a)=>Math.min(...a.map(c=>c.evaluate(u)))],max:[Cr,Wu(Cr),(u,a)=>Math.max(...a.map(c=>c.evaluate(u)))],abs:[Cr,[Cr],(u,[a])=>Math.abs(a.evaluate(u))],round:[Cr,[Cr],(u,[a])=>{const c=a.evaluate(u);return c<0?-Math.round(-c):Math.round(c)}],floor:[Cr,[Cr],(u,[a])=>Math.floor(a.evaluate(u))],ceil:[Cr,[Cr],(u,[a])=>Math.ceil(a.evaluate(u))],"filter-==":[ti,[Vn,oi],(u,[a,c])=>u.properties()[a.value]===c.value],"filter-id-==":[ti,[oi],(u,[a])=>u.id()===a.value],"filter-type-==":[ti,[Vn],(u,[a])=>u.geometryType()===a.value],"filter-<":[ti,[Vn,oi],(u,[a,c])=>{const f=u.properties()[a.value],p=c.value;return typeof f==typeof p&&f<p}],"filter-id-<":[ti,[oi],(u,[a])=>{const c=u.id(),f=a.value;return typeof c==typeof f&&c<f}],"filter->":[ti,[Vn,oi],(u,[a,c])=>{const f=u.properties()[a.value],p=c.value;return typeof f==typeof p&&f>p}],"filter-id->":[ti,[oi],(u,[a])=>{const c=u.id(),f=a.value;return typeof c==typeof f&&c>f}],"filter-<=":[ti,[Vn,oi],(u,[a,c])=>{const f=u.properties()[a.value],p=c.value;return typeof f==typeof p&&f<=p}],"filter-id-<=":[ti,[oi],(u,[a])=>{const c=u.id(),f=a.value;return typeof c==typeof f&&c<=f}],"filter->=":[ti,[Vn,oi],(u,[a,c])=>{const f=u.properties()[a.value],p=c.value;return typeof f==typeof p&&f>=p}],"filter-id->=":[ti,[oi],(u,[a])=>{const c=u.id(),f=a.value;return typeof c==typeof f&&c>=f}],"filter-has":[ti,[oi],(u,[a])=>a.value in u.properties()],"filter-has-id":[ti,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[ti,[wo(Vn)],(u,[a])=>a.value.indexOf(u.geometryType())>=0],"filter-id-in":[ti,[wo(oi)],(u,[a])=>a.value.indexOf(u.id())>=0],"filter-in-small":[ti,[Vn,wo(oi)],(u,[a,c])=>c.value.indexOf(u.properties()[a.value])>=0],"filter-in-large":[ti,[Vn,wo(oi)],(u,[a,c])=>function(f,p,x,b){for(;x<=b;){const A=x+b>>1;if(p[A]===f)return!0;p[A]>f?b=A-1:x=A+1}return!1}(u.properties()[a.value],c.value,0,c.value.length-1)],all:{type:ti,overloads:[[[ti,ti],(u,[a,c])=>a.evaluate(u)&&c.evaluate(u)],[Wu(ti),(u,a)=>{for(const c of a)if(!c.evaluate(u))return!1;return!0}]]},any:{type:ti,overloads:[[[ti,ti],(u,[a,c])=>a.evaluate(u)||c.evaluate(u)],[Wu(ti),(u,a)=>{for(const c of a)if(c.evaluate(u))return!0;return!1}]]},"!":[ti,[ti],(u,[a])=>!a.evaluate(u)],"is-supported-script":[ti,[Vn],(u,[a])=>{const c=u.globals&&u.globals.isSupportedScript;return!c||c(a.evaluate(u))}],upcase:[Vn,[Vn],(u,[a])=>a.evaluate(u).toUpperCase()],downcase:[Vn,[Vn],(u,[a])=>a.evaluate(u).toLowerCase()],concat:[Vn,Wu(oi),(u,a)=>a.map(c=>au(c.evaluate(u))).join("")],"resolved-locale":[Vn,[Cg],(u,[a])=>a.evaluate(u).resolvedLocale()],random:[Cr,[Cr,Cr,oi],(u,a)=>{const[c,f,p]=a.map(b=>b.evaluate(u));if(c>f||c===f)return c;let x;if(typeof p=="string")x=function(b){let A=0;if(b.length===0)return A;for(let k=0;k<b.length;k++)A=(A<<5)-A+b.charCodeAt(k),A|=0;return A}(p);else{if(typeof p!="number")throw new Ta(`Invalid seed input: ${p}`);x=p}return c+R2(x)()*(f-c)}]});class v_{constructor(a,c,f,p,x){this.expression=a,this._warningHistory={},this._scope=f,this._options=p,this._iconImageUseTheme=x,this._evaluator=new So(f,p,x),this._defaultValue=c?function(b){return b.type==="color"&&(g_(b.default)||Array.isArray(b.default))?new ni(0,0,0,0):b.type==="color"?ni.parse(b.default)||null:b.default===void 0?null:b.default}(c):null,this._enumValues=c&&c.type==="enum"?c.values:null,this.configDependencies=Wg(a),this.isIndoorDependent=f_(a)}evaluateWithoutErrorHandling(a,c,f,p,x,b,A,k){return this._evaluator.globals=a,this._evaluator.feature=c,this._evaluator.featureState=f,this._evaluator.canonical=p||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=k||null,this.expression.evaluate(this._evaluator)}evaluate(a,c,f,p,x,b,A,k,M){this._evaluator||(this._evaluator=new So(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=a,this._evaluator.feature=c||null,this._evaluator.featureState=f||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b||null,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=k||null,this._evaluator.iconImageUseTheme=M||null;try{const $=this.expression.evaluate(this._evaluator);if($==null||typeof $=="number"&&$!=$)return this._defaultValue;if(this._enumValues&&!($ in this._enumValues))throw new Ta(`Expected value to be one of ${Object.keys(this._enumValues).map(V=>JSON.stringify(V)).join(", ")}, but found ${JSON.stringify($)} instead.`);return $}catch($){return this._warningHistory[$.message]||(this._warningHistory[$.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${$.message}`)),this._defaultValue}}}function __(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in pp}function lu(u,a,c,f,p){const x=new r_(pp,[],a?function(A){const k={color:Js,string:Vn,number:Cr,enum:Vn,boolean:ti,formatted:Uh,resolvedImage:Og};return A.type==="array"?wo(k[A.value]||oi,A.length):k[A.type]}(a):void 0,void 0,void 0,c,f,p),b=x.parse(u,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return b?Zh(new v_(b,a,c,f,p)):$d(x.errors)}class Gg{constructor(a,c,f,p){this.kind=a,this._styleExpression=c,this.isLightConstant=f,this.isLineProgressConstant=p,this.isStateDependent=a!=="constant"&&!zg(c.expression),this.configDependencies=Wg(c.expression),this.isIndoorDependent=f_(c.expression)}evaluateWithoutErrorHandling(a,c,f,p,x,b){return this._styleExpression.evaluateWithoutErrorHandling(a,c,f,p,x,b)}evaluate(a,c,f,p,x,b,A){return this._styleExpression.evaluate(a,c,f,p,x,b,void 0,void 0,A)}}class Vd{constructor(a,c,f,p,x,b){this.kind=a,this.zoomStops=f,this._styleExpression=c,this.isStateDependent=a!=="camera"&&!zg(c.expression),this.isIndoorDependent=f_(c.expression),this.isLightConstant=x,this.isLineProgressConstant=b,this.configDependencies=Wg(c.expression),this.interpolationType=p}evaluateWithoutErrorHandling(a,c,f,p,x,b){return this._styleExpression.evaluateWithoutErrorHandling(a,c,f,p,x,b)}evaluate(a,c,f,p,x,b){return this._styleExpression.evaluate(a,c,f,p,x,b)}interpolationFactor(a,c,f){return this.interpolationType?bl.interpolationFactor(this.interpolationType,a,c,f):0}}function Rw(u,a,c,f,p){if((u=lu(u,a,c,f,p)).result==="error")return u;const x=u.value.expression,b=lp(x);if(!b&&!p_(a))return $d([new ec("","data expressions not supported")]);const A=cp(x,["zoom","pitch","distance-from-center"]);if(!A&&!kw(a))return $d([new ec("","zoom expressions not supported")]);const k=cp(x,["measure-light"]);if(!k&&!Ow(a))return $d([new ec("","measure-light expression not supported")]);const M=cp(x,["line-progress"]);if(!M&&!function(q){return Cw(q.expression,"line-progress")}(a))return $d([new ec("","line-progress expression not supported")]);const $=a.expression&&a.expression.relaxZoomRestriction,V=b_(x);return V||A||$?V instanceof ec?$d([V]):V instanceof bl&&!m_(a)?$d([new ec("",'"interpolate" expressions cannot be used with this property')]):Zh(V?new Vd(b&&M?"camera":"composite",u.value,V.labels,V instanceof bl?V.interpolation:void 0,k,M):new Gg(b&&M?"constant":"source",u.value,k,M)):$d([new ec("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class x_{constructor(a,c){this._parameters=a,this._specification=c,Object.assign(this,y_(this._parameters,this._specification))}static deserialize(a){return new x_(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function b_(u){let a=null;if(u instanceof Vg)a=b_(u.result);else if(u instanceof Ug){for(const c of u.args)if(a=b_(c),a)break}else(u instanceof Bg||u instanceof bl)&&u.input instanceof os&&u.input.name==="zoom"&&(a=u);return a instanceof ec||u.eachChild(c=>{const f=b_(c);f instanceof ec?a=f:a&&f&&a!==f&&(a=new ec("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),a}var Hg,w_,D2=function(){if(w_)return Hg;w_=1,Hg=a;var u=3;function a(c,f,p){var x=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;var b=new Int32Array(this.arrayBuffer);c=b[0],this.d=(f=b[1])+2*(p=b[2]);for(var A=0;A<this.d*this.d;A++){var k=b[u+A],M=b[u+A+1];x.push(k===M?null:b.subarray(k,M))}var $=b[u+x.length+1];this.keys=b.subarray(b[u+x.length],$),this.bboxes=b.subarray($),this.insert=this._insertReadonly}else{this.d=f+2*p;for(var V=0;V<this.d*this.d;V++)x.push([]);this.keys=[],this.bboxes=[]}this.n=f,this.extent=c,this.padding=p,this.scale=f/c,this.uid=0;var q=p/f*c;this.min=-q,this.max=c+q}return a.prototype.insert=function(c,f,p,x,b){this._forEachCell(f,p,x,b,this._insertCell,this.uid++),this.keys.push(c),this.bboxes.push(f),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(b)},a.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},a.prototype._insertCell=function(c,f,p,x,b,A){this.cells[b].push(A)},a.prototype.query=function(c,f,p,x,b){var A=this.min,k=this.max;if(c<=A&&f<=A&&k<=p&&k<=x&&!b)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(c,f,p,x,this._queryCell,M,{},b),M},a.prototype._queryCell=function(c,f,p,x,b,A,k,M){var $=this.cells[b];if($!==null)for(var V=this.keys,q=this.bboxes,X=0;X<$.length;X++){var Y=$[X];if(k[Y]===void 0){var se=4*Y;(M?M(q[se+0],q[se+1],q[se+2],q[se+3]):c<=q[se+2]&&f<=q[se+3]&&p>=q[se+0]&&x>=q[se+1])?(k[Y]=!0,A.push(V[Y])):k[Y]=!1}}},a.prototype._forEachCell=function(c,f,p,x,b,A,k,M){for(var $=this._convertToCellCoord(c),V=this._convertToCellCoord(f),q=this._convertToCellCoord(p),X=this._convertToCellCoord(x),Y=$;Y<=q;Y++)for(var se=V;se<=X;se++){var ce=this.d*se+Y;if((!M||M(this._convertFromCellCoord(Y),this._convertFromCellCoord(se),this._convertFromCellCoord(Y+1),this._convertFromCellCoord(se+1)))&&b.call(this,c,f,p,x,ce,A,k,M))return}},a.prototype._convertFromCellCoord=function(c){return(c-this.padding)/this.scale},a.prototype._convertToCellCoord=function(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))},a.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var c=this.cells,f=u+this.cells.length+1+1,p=0,x=0;x<this.cells.length;x++)p+=this.cells[x].length;var b=new Int32Array(f+p+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;for(var A=f,k=0;k<c.length;k++){var M=c[k];b[u+k]=A,b.set(M,A),A+=M.length}return b[u+c.length]=A,b.set(this.keys,A),b[u+c.length+1]=A+=this.keys.length,b.set(this.bboxes,A),A+=this.bboxes.length,b.buffer},Hg}(),Xh=Ii(D2);const gp={};function gr(u,a,c={}){Object.defineProperty(u,"_classRegistryKey",{value:a,writable:!1}),gp[a]={klass:u,omit:c.omit||[]}}gr(Object,"Object"),Xh.serialize=function(u,a){const c=u.toArrayBuffer();return a&&a.add(c),{buffer:c}},Xh.deserialize=function(u){return new Xh(u.buffer)},Object.defineProperty(Xh,"name",{value:"Grid"}),gr(Xh,"Grid"),delete Mt.prototype.constructor,typeof DOMMatrix<"u"&&gr(DOMMatrix,"DOMMatrix"),gr(ni,"Color"),gr(Error,"Error"),gr(po,"Formatted"),gr(Rg,"FormattedSection"),gr(Bh,"AJAXError"),gr(Ds,"ResolvedImage"),gr(x_,"StylePropertyFunction"),gr(v_,"StyleExpression",{omit:["_evaluator"]}),gr(eo,"ImageId"),gr(Uu,"ImageVariant"),gr(Vd,"ZoomDependentExpression"),gr(Gg,"ZoomConstantExpression"),gr(os,"CompoundExpression",{omit:["_evaluate"]});for(const u in pp)gp[pp[u]._classRegistryKey]||gr(pp[u],`Expression${u}`);function jw(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function Gu(u){return self.ImageBitmap&&u instanceof ImageBitmap}function qd(u,a){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp)return u;if(jw(u)||Gu(u))return a&&a.add(u),u;if(ArrayBuffer.isView(u))return a&&a.add(u.buffer),u;if(u instanceof ImageData)return a&&a.add(u.data.buffer),u;if(Array.isArray(u)){const c=[];for(const f of u)c.push(qd(f,a));return c}if(u instanceof Map){const c={$name:"Map",entries:[]};for(const[f,p]of u.entries())c.entries.push(qd(f),qd(p,a));return c}if(u instanceof Set){const c={$name:"Set"};let f=0;for(const p of u.values())c[++f]=qd(p);return c}if(u instanceof DOMMatrix){const c={$name:"DOMMatrix"},f=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const p of f)c[p]=u[p];return c}if(typeof u=="bigint")return{$name:"BigInt",value:u.toString()};if(typeof u=="object"){const c=u.constructor,f=c._classRegistryKey;if(!f)throw new Error(`Can't serialize object of unregistered class "${c.name}".`);const p=c.serialize?c.serialize(u,a):{};if(!c.serialize){for(const x in u)u.hasOwnProperty(x)&&(gp[f].omit.indexOf(x)>=0||(p[x]=qd(u[x],a)));u instanceof Error&&(p.message=u.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(p.$name=f),p}throw new Error("can't serialize object of type "+typeof u)}function Wd(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||jw(u)||Gu(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(Wd);if(typeof u=="object"){const a=u.$name||"Object";if(a==="Map"){const p=u.entries||[],x=new Map;for(let b=0;b<p.length;b+=2)x.set(Wd(p[b]),Wd(p[b+1]));return x}if(a==="Set"){const p=new Set;for(const x of Object.keys(u))x!=="$name"&&p.add(Wd(u[x]));return p}if(a==="DOMMatrix"){let p;return p=u.is2D?[u.a,u.b,u.c,u.d,u.e,u.f]:[u.m11,u.m12,u.m13,u.m14,u.m21,u.m22,u.m23,u.m24,u.m31,u.m32,u.m33,u.m34,u.m41,u.m42,u.m43,u.m44],new DOMMatrix(p)}if(a==="BigInt")return BigInt(u.value);const{klass:c}=gp[a];if(!c)throw new Error(`Can't deserialize unregistered class "${a}".`);if(c.deserialize)return c.deserialize(u);const f=Object.create(c.prototype);for(const p of Object.keys(u))p!=="$name"&&(f[p]=Wd(u[p]));return f}throw new Error("can't deserialize object of type "+typeof u)}const Nr={"Latin-1 Supplement":u=>u>=128&&u<=255,Arabic:u=>u>=1536&&u<=1791,"Arabic Supplement":u=>u>=1872&&u<=1919,"Arabic Extended-A":u=>u>=2208&&u<=2303,"Hangul Jamo":u=>u>=4352&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>u>=5120&&u<=5759,Khmer:u=>u>=6016&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>u>=6320&&u<=6399,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"CJK Radicals Supplement":u=>u>=11904&&u<=12031,"Kangxi Radicals":u=>u>=12032&&u<=12255,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Bopomofo:u=>u>=12544&&u<=12591,"Hangul Compatibility Jamo":u=>u>=12592&&u<=12687,Kanbun:u=>u>=12688&&u<=12703,"Bopomofo Extended":u=>u>=12704&&u<=12735,"CJK Strokes":u=>u>=12736&&u<=12783,"Katakana Phonetic Extensions":u=>u>=12784&&u<=12799,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"CJK Unified Ideographs Extension A":u=>u>=13312&&u<=19903,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Yi Syllables":u=>u>=40960&&u<=42127,"Yi Radicals":u=>u>=42128&&u<=42191,"Hangul Jamo Extended-A":u=>u>=43360&&u<=43391,"Hangul Syllables":u=>u>=44032&&u<=55215,"Hangul Jamo Extended-B":u=>u>=55216&&u<=55295,"Private Use Area":u=>u>=57344&&u<=63743,"CJK Compatibility Ideographs":u=>u>=63744&&u<=64255,"Arabic Presentation Forms-A":u=>u>=64336&&u<=65023,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Arabic Presentation Forms-B":u=>u>=65136&&u<=65279,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519,Osage:u=>u>=66736&&u<=66815,"CJK Unified Ideographs Extension B":u=>u>=131072&&u<=173791};function Nw(u){for(const a of u)if(E_(a.charCodeAt(0)))return!0;return!1}function L2(u){for(const a of u)if(!S_(a.charCodeAt(0)))return!1;return!0}function S_(u){return!(Nr.Arabic(u)||Nr["Arabic Supplement"](u)||Nr["Arabic Extended-A"](u)||Nr["Arabic Presentation Forms-A"](u)||Nr["Arabic Presentation Forms-B"](u))}function E_(u){return!(u!==746&&u!==747&&(u<4352||!(Nr["Bopomofo Extended"](u)||Nr.Bopomofo(u)||Nr["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||Nr["CJK Compatibility Ideographs"](u)||Nr["CJK Compatibility"](u)||Nr["CJK Radicals Supplement"](u)||Nr["CJK Strokes"](u)||!(!Nr["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||Nr["CJK Unified Ideographs Extension A"](u)||Nr["CJK Unified Ideographs"](u)||Nr["Enclosed CJK Letters and Months"](u)||Nr["Hangul Compatibility Jamo"](u)||Nr["Hangul Jamo Extended-A"](u)||Nr["Hangul Jamo Extended-B"](u)||Nr["Hangul Jamo"](u)||Nr["Hangul Syllables"](u)||Nr.Hiragana(u)||Nr["Ideographic Description Characters"](u)||Nr.Kanbun(u)||Nr["Kangxi Radicals"](u)||Nr["Katakana Phonetic Extensions"](u)||Nr.Katakana(u)&&u!==12540||!(!Nr["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!Nr["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||Nr["Unified Canadian Aboriginal Syllabics"](u)||Nr["Unified Canadian Aboriginal Syllabics Extended"](u)||Nr["Vertical Forms"](u)||Nr["Yijing Hexagram Symbols"](u)||Nr["Yi Syllables"](u)||Nr["Yi Radicals"](u))))}function Mw(u){return!(E_(u)||function(a){return!!(Nr["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||Nr["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||Nr["Letterlike Symbols"](a)||Nr["Number Forms"](a)||Nr["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||Nr["Control Pictures"](a)&&a!==9251||Nr["Optical Character Recognition"](a)||Nr["Enclosed Alphanumerics"](a)||Nr["Geometric Shapes"](a)||Nr["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||Nr["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||Nr["CJK Symbols and Punctuation"](a)||Nr.Katakana(a)||Nr["Private Use Area"](a)||Nr["CJK Compatibility Forms"](a)||Nr["Small Form Variants"](a)||Nr["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(u))}function Dw(u){return Nr.Arabic(u)||Nr["Arabic Supplement"](u)||Nr["Arabic Extended-A"](u)||Nr["Arabic Presentation Forms-A"](u)||Nr["Arabic Presentation Forms-B"](u)}function F2(u){return u>=1424&&u<=2303||Nr["Arabic Presentation Forms-A"](u)||Nr["Arabic Presentation Forms-B"](u)}function pj(u,a){return!(!a&&F2(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||Nr.Khmer(u))}function mj(u){for(const a of u)if(F2(a.charCodeAt(0)))return!0;return!1}const Qs={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Lw=null,Es=Qs.unavailable,Gd=null;const z2=function(u){u&&typeof u=="string"&&u.indexOf("NetworkError")>-1&&(Es=Qs.error),Lw&&Lw(u)};function Fw(){zw.fire(new _l("pluginStateChange",{pluginStatus:Es,pluginURL:Gd}))}const zw=new Bu,Bw=function(){return Es},$w=function(){if(Es!==Qs.deferred||!Gd)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Es=Qs.loading,Fw(),Gd&&Xf({url:Gd},u=>{u?z2(u):(Es=Qs.loaded,Fw())})},el={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Es===Qs.loaded||el.applyArabicShaping!=null,isLoading:()=>Es===Qs.loading,setState(u){Es=u.pluginStatus,Gd=u.pluginURL},isParsing:()=>Es===Qs.parsing,isParsed:()=>Es===Qs.parsed,getPluginURL:()=>Gd};class Ri{constructor(a,c){this.zoom=a,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.transition=c.transition,this.pitch=c.pitch,this.brightness=c.brightness,this.worldview=c.worldview,this.activeFloors=c.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(a){return function(c,f){for(const p of c)if(!pj(p.charCodeAt(0),f))return!1;return!0}(a,el.isLoaded())}}class Kg{constructor(a,c,f,p,x){this.property=a,this.value=c,this.expression=function(b,A,k,M,$){if(g_(b))return new x_(b,A);if(__(b)||Array.isArray(b)&&b.length>0){const V=Rw(b,A,k,M,$);if(V.result==="error")throw new Error(V.value.map(q=>`${q.key}: ${q.message}`).join(", "));return V.value}{let V=b;return typeof b=="string"&&A.type==="color"&&(V=ni.parse(b)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>V}}}(c===void 0?a.specification.default:c,a.specification,f,p,x)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(a,c,f,p){return this.property.possiblyEvaluate(this,a,c,f,p)}}class yp{constructor(a,c,f,p){this.property=a,this.value=new Kg(a,void 0,c,f,p)}transitioned(a,c){return new $2(this.property,this.value,c,Object.assign({},a.transition,this.transition),a.now)}untransitioned(){return new $2(this.property,this.value,null,{},0)}}class B2{constructor(a,c,f,p){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues),this._scope=c,this._options=f,this._iconImageUseTheme=p,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(a){return Tr(this._values[a].value.value)}setValue(a,c){this._values.hasOwnProperty(a)||(this._values[a]=new yp(this._values[a].property,this._scope,this._options,this._iconImageUseTheme)),this._values[a].value=new Kg(this._values[a].property,c===null?void 0:Tr(c),this._scope,this._options,this._iconImageUseTheme),this._values[a].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[a].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[a].value.isIndoorDependent())}setTransitionOrValue(a,c){c&&(this._options=c);const f=this._properties.properties;if(a)for(const p in a){const x=a[p];if(p.endsWith("-transition")){const b=p.slice(0,-11);f[b]&&this.setTransition(b,x)}else f.hasOwnProperty(p)&&this.setValue(p,x)}}getTransition(a){return Tr(this._values[a].transition)}setTransition(a,c){this._values.hasOwnProperty(a)||(this._values[a]=new yp(this._values[a].property)),this._values[a].transition=Tr(c)||void 0}serialize(){const a={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(a[c]=f);const p=this.getTransition(c);p!==void 0&&(a[`${c}-transition`]=p)}return a}transitioned(a,c){const f=new Hu(this._properties);for(const p of Object.keys(this._values))f._values[p]=this._values[p].transitioned(a,c._values[p]);return f}untransitioned(){const a=new Hu(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].untransitioned();return a}isIndoorDependent(){return this._isIndoorDependent}}class $2{constructor(a,c,f,p,x){const b=p.delay||0,A=p.duration||0;x=x||0,this.property=a,this.value=c,this.begin=x+b,this.end=this.begin+A,a.specification.transition&&(p.delay||p.duration)&&(this.prior=f)}possiblyEvaluate(a,c,f){const p=a.now||0,x=this.value.possiblyEvaluate(a,c,f),b=this.prior;if(b){if(p>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(p<this.begin)return b.possiblyEvaluate(a,c,f);{const A=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(a,c,f),x,pg(A))}}return x}}class Hu{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,c,f){const p=new Yh(this._properties);for(const x of Object.keys(this._values))p._values[x]=this._values[x].possiblyEvaluate(a,c,f);return p}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class Uw{constructor(a,c,f,p){this._properties=a,this._values=Object.create(a.defaultPropertyValues),this._scope=c,this._options=f,this._iconImageUseTheme=p,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(a){return Tr(this._values[a].value)}setValue(a,c){this._values[a]=new Kg(this._values[a].property,c===null?void 0:Tr(c),this._scope,this._options,this._iconImageUseTheme),this._values[a].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[a].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[a].isIndoorDependent())}serialize(){const a={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(a[c]=f)}return a}possiblyEvaluate(a,c,f,p){const x=new Yh(this._properties);for(const b of Object.keys(this._values))x._values[b]=this._values[b].possiblyEvaluate(a,c,f,p);return x}isIndoorDependent(){return this._isIndoorDependent}}class ac{constructor(a,c,f,p){this.property=a,this.value=c,this.parameters=f,this.iconImageUseTheme=p}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,c,f,p){return this.property.evaluate(this.value,this.parameters,a,c,f,p,this.iconImageUseTheme)}}class Yh{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class Wt{constructor(a){this.specification=a}possiblyEvaluate(a,c){return a.expression.evaluate(c)}interpolate(a,c,f){const p=$u[this.specification.type];return p?p(a,c,f):a}}class lr{constructor(a,c){this.specification=a,this.overrides=c}possiblyEvaluate(a,c,f,p,x){return a.expression.kind==="constant"||a.expression.kind==="camera"?new ac(this,{kind:"constant",value:a.expression.evaluate(c,null,{},f,p,void 0,x)},c):new ac(this,a.expression,c,x)}interpolate(a,c,f){if(a.value.kind!=="constant"||c.value.kind!=="constant")return a;if(a.value.value===void 0||c.value.value===void 0)return new ac(this,{kind:"constant",value:void 0},a.parameters);const p=$u[this.specification.type];return p?new ac(this,{kind:"constant",value:p(a.value.value,c.value.value,f)},a.parameters):a}evaluate(a,c,f,p,x,b,A){return a.kind==="constant"?a.value:a.evaluate(c,f,p,x,b,void 0,A)}}class vp{constructor(a){this.specification=a}possiblyEvaluate(a,c,f,p){return!!a.expression.evaluate(c,null,{},f,p)}interpolate(){return!1}}class ua{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const c=new Ri(0,{});for(const f in a){const p=a[f];p.specification.overridable&&this.overridableProperties.push(f);const x=this.defaultPropertyValues[f]=new Kg(p,void 0),b=this.defaultTransitionablePropertyValues[f]=new yp(p);this.defaultTransitioningPropertyValues[f]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=x.possiblyEvaluate(c)}}}gr(lr,"DataDrivenProperty"),gr(Wt,"DataConstantProperty"),gr(vp,"ColorRampProperty");var ht=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Vw(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function _p(u){if(Array.isArray(u))return u.map(_p);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const a={};for(const c in u)a[c]=_p(u[c]);return a}return Vw(u)}function xp(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const a of u.slice(1))if(!xp(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}function T_(u,a="",c=null,f="fill"){if(u==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};xp(u)||(u=wl(u));const p=u;let x=!0;try{x=function($){if(!wp($))return $;let V=_p($);return bp(V),V=A_(V),V}(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}let b=null,A=null;if(f!=="background"&&f!=="sky"&&f!=="slot"){A=ht[`filter_${f}`];const $=lu(x,A,a,c);if($.result==="error")throw new Error($.value.map(V=>`${V.key}: ${V.message}`).join(", "));b=(V,q,X)=>$.value.evaluate(V,q,{},X)}let k=null,M=null;if(x!==p){const $=lu(p,A,a,c);if($.result==="error")throw new Error($.value.map(V=>`${V.key}: ${V.message}`).join(", "));k=(V,q,X,Y,se)=>$.value.evaluate(V,q,{},X,void 0,void 0,Y,se),M=!lp($.value.expression)}return{filter:b,dynamicFilter:k||void 0,needGeometry:V2(x),needFeature:!!M}}function A_(u){if(!Array.isArray(u))return u;const a=function(c){if(gj.has(c[0])){for(let f=1;f<c.length;f++)if(wp(c[f]))return!0}return c}(u);return a===!0?a:a.map(c=>A_(c))}function bp(u){let a=!1;const c=[];if(u[0]==="case"){for(let f=1;f<u.length-1;f+=2)a=a||wp(u[f]),c.push(u[f+1]);c.push(u[u.length-1])}else if(u[0]==="match"){a=a||wp(u[1]);for(let f=2;f<u.length-1;f+=2)c.push(u[f+1]);c.push(u[u.length-1])}else if(u[0]==="step"){a=a||wp(u[1]);for(let f=1;f<u.length-1;f+=2)c.push(u[f+1])}a&&(u.length=0,u.push("any",...c));for(let f=1;f<u.length;f++)bp(u[f])}function wp(u){if(!Array.isArray(u))return!1;if((a=u[0])==="pitch"||a==="distance-from-center")return!0;var a;for(let c=1;c<u.length;c++)if(wp(u[c]))return!0;return!1}const gj=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function U2(u,a){return u<a?-1:u>a?1:0}function V2(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let a=1;a<u.length;a++)if(V2(u[a]))return!0;return!1}function wl(u){if(!u)return!0;const a=u[0];return u.length<=1?a!=="any":a==="=="?qw(u[1],u[2],"=="):a==="!="?P_(qw(u[1],u[2],"==")):a==="<"||a===">"||a==="<="||a===">="?qw(u[1],u[2],a):a==="any"?(c=u.slice(1),["any"].concat(c.map(wl))):a==="all"?["all"].concat(u.slice(1).map(wl)):a==="none"?["all"].concat(u.slice(1).map(wl).map(P_)):a==="in"?Ww(u[1],u.slice(2)):a==="!in"?P_(Ww(u[1],u.slice(2))):a==="has"?q2(u[1]):a!=="!has"||P_(q2(u[1]));var c}function qw(u,a,c){switch(u){case"$type":return[`filter-type-${c}`,a];case"$id":return[`filter-id-${c}`,a];default:return[`filter-${c}`,u,a]}}function Ww(u,a){if(a.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(c=>typeof c!=typeof a[0])?["filter-in-large",u,["literal",a.sort(U2)]]:["filter-in-small",u,["literal",a]]}}function q2(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function P_(u){return["!",u]}const Zg="";function Jh(u,a){return a?`${u}${Zg}${a}`:u}let W2;const G2=()=>W2||(W2=new ua({"icon-size":new lr(ht.layout_symbol["icon-size"]),"icon-image":new lr(ht.layout_symbol["icon-image"]),"icon-rotate":new lr(ht.layout_symbol["icon-rotate"]),"icon-offset":new lr(ht.layout_symbol["icon-offset"])}));class yj{constructor(a,c,f,p,x,b){this.cachedIconPrimary=null;const A=lu(a,ht.appearance.condition);if(A.result==="success"&&(this.condition=A.value),this.name=c,f){this.properties=new Yh(G2()),this.unevaluatedLayout=new Uw(G2(),p,x,b);for(const k in f)this.unevaluatedLayout.setValue(k,f[k])}}hasCachedIconPrimary(){return this.cachedIconPrimary!==null}setCachedIconPrimary(a){this.cachedIconPrimary=a}getCachedIconPrimary(){return this.cachedIconPrimary}isActive(a){return!(this.condition||!a.isHidden||this.name!=="hidden")||this.condition.evaluate(a.globals,a.feature,a.featureState,a.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(a){return this.properties.get(a)}getUnevaluatedProperties(){return this.unevaluatedLayout}recalculate(a,c,f){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(a,void 0,c,f))}serialize(){const a={};return a.condition=this.condition.expression.serialize(),this.name&&(a.name=this.name),this.unevaluatedLayout&&(a.properties=this.unevaluatedLayout.serialize()),a}}const H2="-transition",vj=new Set(["fill","line","background","hillshade","raster"]);class ss extends Bu{constructor(a,c,f,p,x,b){if(super(),this.id=a.id,this.fqid=Jh(this.id,f),this.type=a.type,this.scope=f,this.lut=p,this.options=x,this.iconImageUseTheme=b,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},a.type!=="custom"){if(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type&&a.type!=="background"&&a.type!=="sky"&&a.type!=="slot"){this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter;const A=lu(this.filter,ht[`filter_${a.type}`]);A.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...A.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||A.value.isIndoorDependent)}if(a.slot&&(this.slot=a.slot),a.appearances&&this.setAppearances(a.appearances),c.layout&&(this._unevaluatedLayout=new Uw(c.layout,this.scope,x,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),c.paint){this._transitionablePaint=new B2(c.paint,this.scope,x);for(const A in a.paint)this.setPaintProperty(A,a.paint[A]);for(const A in a.layout)this.setLayoutProperty(A,a.layout[A]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Yh(c.paint)}}}onAdd(a){}onRemove(a){}isDraped(a){return!this.is3D(!0)&&vj.has(this.type)}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}setLayoutProperty(a,c){if(this.type==="custom"&&a==="visibility")return void(this.visibility=c);const f=this._unevaluatedLayout;f._properties.properties[a]&&(f.setValue(a,c),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...f.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||f.isIndoorDependent(),a==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(a){this.appearances=[],a.forEach(c=>{this.appearances.push(new yj(c.condition,c.name,c.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(a){return a.endsWith(H2)?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)}isPaintProperty(a){return!!this._transitionablePaint._properties.properties[a]}setPaintProperty(a,c){const f=this._transitionablePaint,p=f._properties.properties;if(a.endsWith(H2)){const V=a.slice(0,-11);return p[V]&&f.setTransition(V,c||void 0),!1}if(!p[a])return!1;const x=f._values[a],b=x.value.isDataDriven(),A=x.value;f.setValue(a,c),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...f.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||f.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(a);const k=f._values[a].value,M=k.isDataDriven(),$=a.endsWith("pattern")||a==="line-dasharray";return M||b||$||this._handleOverridablePaintPropertyUpdate(a,A,k)}_handleSpecialPaintPropertyUpdate(a){}getProgramIds(){return null}getDefaultProgramParams(a,c,f){return null}_handleOverridablePaintPropertyUpdate(a,c,f){return!1}isHidden(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||this.visibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(a,c){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,c,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,c)}serialize(){const a={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(a.appearances=this.appearances.map(c=>c.serialize())),Bt(a,(c,f)=>!(c===void 0||f==="layout"&&!Object.keys(c).length||f==="paint"&&!Object.keys(c).length))}is3D(a){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const a in this.paint._values){const c=this.paint.get(a);if(c instanceof ac&&p_(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}for(const a of this.appearances)if(!zg(a.condition.expression))return!0;return!1}compileFilter(a){this._filterCompiled||(this._featureFilter=T_(this.filter,this.scope,a),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(a){this._stats&&(a.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(a,c,f){return{}}queryRadius(a){}queryIntersectsFeature(a,c,f,p,x,b,A,k,M){}}const _j={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Xg{constructor(a,c){this._structArray=a,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class $i{constructor(){this.capacity=-1,this.resize(0)}static serialize(a,c){return a._trim(),c&&c.add(a.arrayBuffer),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const c=Object.create(this.prototype);return c.arrayBuffer=a.arrayBuffer,c.length=a.length,c.capacity=a.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...a){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...a){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Tn(u,a=1){let c=0,f=0;return{members:u.map(p=>{const x=_j[p.type].BYTES_PER_ELEMENT,b=c=Gw(c,Math.max(a,x)),A=p.components||1;return f=Math.max(f,x),c+=x*A,{name:p.name,type:p.type,components:A,offset:b}}),size:Gw(c,Math.max(f,a)),alignment:a}}function Gw(u,a){return Math.ceil(u/a)*a}class Ls extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c){const f=this.length;return this.resize(f+1),this.emplace(f,a,c)}emplace(a,c,f){const p=2*a;return this.int16[p+0]=c,this.int16[p+1]=f,a}}Ls.prototype.bytesPerElement=4,gr(Ls,"StructArrayLayout2i4");class Qh extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,a,c,f)}emplace(a,c,f,p){const x=3*a;return this.int16[x+0]=c,this.int16[x+1]=f,this.int16[x+2]=p,a}}Qh.prototype.bytesPerElement=6,gr(Qh,"StructArrayLayout3i6");class Sp extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,f,p){const x=this.length;return this.resize(x+1),this.emplace(x,a,c,f,p)}emplace(a,c,f,p,x){const b=4*a;return this.int16[b+0]=c,this.int16[b+1]=f,this.int16[b+2]=p,this.int16[b+3]=x,a}}Sp.prototype.bytesPerElement=8,gr(Sp,"StructArrayLayout4i8");class Ku extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.float32[1*a+0]=c,a}}Ku.prototype.bytesPerElement=4,gr(Ku,"StructArrayLayout1f4");class Hw extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,a,c,f)}emplace(a,c,f,p){const x=4*a,b=2*a;return this.int16[x+0]=c,this.int16[x+1]=f,this.float32[b+1]=p,a}}Hw.prototype.bytesPerElement=8,gr(Hw,"StructArrayLayout2i1f8");class Kw extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,a,c,f)}emplace(a,c,f,p){const x=4*a;return this.int16[x+0]=c,this.int16[x+1]=f,this.int16[x+2]=p,a}}Kw.prototype.bytesPerElement=8,gr(Kw,"StructArrayLayout3i8");class C_ extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,f,p,x){const b=this.length;return this.resize(b+1),this.emplace(b,a,c,f,p,x)}emplace(a,c,f,p,x,b){const A=5*a;return this.int16[A+0]=c,this.int16[A+1]=f,this.int16[A+2]=p,this.int16[A+3]=x,this.int16[A+4]=b,a}}C_.prototype.bytesPerElement=10,gr(C_,"StructArrayLayout5i10");class O_ extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,x,b,A){const k=this.length;return this.resize(k+1),this.emplace(k,a,c,f,p,x,b,A)}emplace(a,c,f,p,x,b,A,k){const M=6*a,$=12*a,V=3*a;return this.int16[M+0]=c,this.int16[M+1]=f,this.uint8[$+4]=p,this.uint8[$+5]=x,this.uint8[$+6]=b,this.uint8[$+7]=A,this.float32[V+2]=k,a}}O_.prototype.bytesPerElement=12,gr(O_,"StructArrayLayout2i4ub1f12");class Sl extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,a,c,f)}emplace(a,c,f,p){const x=3*a;return this.float32[x+0]=c,this.float32[x+1]=f,this.float32[x+2]=p,a}}Sl.prototype.bytesPerElement=12,gr(Sl,"StructArrayLayout3f12");class Hd extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,x){const b=this.length;return this.resize(b+1),this.emplace(b,a,c,f,p,x)}emplace(a,c,f,p,x,b){const A=6*a,k=3*a;return this.uint16[A+0]=c,this.uint16[A+1]=f,this.uint16[A+2]=p,this.uint16[A+3]=x,this.float32[k+2]=b,a}}Hd.prototype.bytesPerElement=12,gr(Hd,"StructArrayLayout4ui1f12");class ef extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,f,p){const x=this.length;return this.resize(x+1),this.emplace(x,a,c,f,p)}emplace(a,c,f,p,x){const b=4*a;return this.uint16[b+0]=c,this.uint16[b+1]=f,this.uint16[b+2]=p,this.uint16[b+3]=x,a}}ef.prototype.bytesPerElement=8,gr(ef,"StructArrayLayout4ui8");class k_ extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,f,p,x,b){const A=this.length;return this.resize(A+1),this.emplace(A,a,c,f,p,x,b)}emplace(a,c,f,p,x,b,A){const k=6*a;return this.int16[k+0]=c,this.int16[k+1]=f,this.int16[k+2]=p,this.int16[k+3]=x,this.int16[k+4]=b,this.int16[k+5]=A,a}}k_.prototype.bytesPerElement=12,gr(k_,"StructArrayLayout6i12");class I_ extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,f,p,x,b,A,k,M,$,V,q){const X=this.length;return this.resize(X+1),this.emplace(X,a,c,f,p,x,b,A,k,M,$,V,q)}emplace(a,c,f,p,x,b,A,k,M,$,V,q,X){const Y=12*a;return this.int16[Y+0]=c,this.int16[Y+1]=f,this.int16[Y+2]=p,this.int16[Y+3]=x,this.uint16[Y+4]=b,this.uint16[Y+5]=A,this.uint16[Y+6]=k,this.uint16[Y+7]=M,this.int16[Y+8]=$,this.int16[Y+9]=V,this.int16[Y+10]=q,this.int16[Y+11]=X,a}}I_.prototype.bytesPerElement=24,gr(I_,"StructArrayLayout4i4ui4i24");class Ep extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,x,b){const A=this.length;return this.resize(A+1),this.emplace(A,a,c,f,p,x,b)}emplace(a,c,f,p,x,b,A){const k=10*a,M=5*a;return this.int16[k+0]=c,this.int16[k+1]=f,this.int16[k+2]=p,this.float32[M+2]=x,this.float32[M+3]=b,this.float32[M+4]=A,a}}Ep.prototype.bytesPerElement=20,gr(Ep,"StructArrayLayout3i3f20");class Kd extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p){const x=this.length;return this.resize(x+1),this.emplace(x,a,c,f,p)}emplace(a,c,f,p,x){const b=4*a;return this.float32[b+0]=c,this.float32[b+1]=f,this.float32[b+2]=p,this.float32[b+3]=x,a}}Kd.prototype.bytesPerElement=16,gr(Kd,"StructArrayLayout4f16");class Zw extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.uint32[1*a+0]=c,a}}Zw.prototype.bytesPerElement=4,gr(Zw,"StructArrayLayout1ul4");class oc extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c){const f=this.length;return this.resize(f+1),this.emplace(f,a,c)}emplace(a,c,f){const p=2*a;return this.uint16[p+0]=c,this.uint16[p+1]=f,a}}oc.prototype.bytesPerElement=4,gr(oc,"StructArrayLayout2ui4");class Xw extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,f,p,x,b,A,k,M,$,V,q,X){const Y=this.length;return this.resize(Y+1),this.emplace(Y,a,c,f,p,x,b,A,k,M,$,V,q,X)}emplace(a,c,f,p,x,b,A,k,M,$,V,q,X,Y){const se=20*a,ce=10*a;return this.int16[se+0]=c,this.int16[se+1]=f,this.int16[se+2]=p,this.int16[se+3]=x,this.int16[se+4]=b,this.float32[ce+3]=A,this.float32[ce+4]=k,this.float32[ce+5]=M,this.float32[ce+6]=$,this.int16[se+14]=V,this.uint32[ce+8]=q,this.uint16[se+18]=X,this.uint16[se+19]=Y,a}}Xw.prototype.bytesPerElement=40,gr(Xw,"StructArrayLayout5i4f1i1ul2ui40");class R_ extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,f,p,x,b,A){const k=this.length;return this.resize(k+1),this.emplace(k,a,c,f,p,x,b,A)}emplace(a,c,f,p,x,b,A,k){const M=8*a;return this.int16[M+0]=c,this.int16[M+1]=f,this.int16[M+2]=p,this.int16[M+4]=x,this.int16[M+5]=b,this.int16[M+6]=A,this.int16[M+7]=k,a}}R_.prototype.bytesPerElement=16,gr(R_,"StructArrayLayout3i2i2i16");class Tp extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,f,p,x){const b=this.length;return this.resize(b+1),this.emplace(b,a,c,f,p,x)}emplace(a,c,f,p,x,b){const A=4*a,k=8*a;return this.float32[A+0]=c,this.float32[A+1]=f,this.float32[A+2]=p,this.int16[k+6]=x,this.int16[k+7]=b,a}}Tp.prototype.bytesPerElement=16,gr(Tp,"StructArrayLayout2f1f2i16");class Ap extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,x,b){const A=this.length;return this.resize(A+1),this.emplace(A,a,c,f,p,x,b)}emplace(a,c,f,p,x,b,A){const k=20*a,M=5*a;return this.uint8[k+0]=c,this.uint8[k+1]=f,this.float32[M+1]=p,this.float32[M+2]=x,this.float32[M+3]=b,this.float32[M+4]=A,a}}Ap.prototype.bytesPerElement=20,gr(Ap,"StructArrayLayout2ub4f20");class Gi extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,a,c,f)}emplace(a,c,f,p){const x=3*a;return this.uint16[x+0]=c,this.uint16[x+1]=f,this.uint16[x+2]=p,a}}Gi.prototype.bytesPerElement=6,gr(Gi,"StructArrayLayout3ui6");class Pp extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,x,b,A,k,M,$,V,q,X,Y,se,ce,he,be,Ee,Oe,Ue){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,a,c,f,p,x,b,A,k,M,$,V,q,X,Y,se,ce,he,be,Ee,Oe,Ue)}emplace(a,c,f,p,x,b,A,k,M,$,V,q,X,Y,se,ce,he,be,Ee,Oe,Ue,Fe){const Ke=30*a,Qe=15*a,nt=60*a;return this.int16[Ke+0]=c,this.int16[Ke+1]=f,this.int16[Ke+2]=p,this.float32[Qe+2]=x,this.float32[Qe+3]=b,this.uint16[Ke+8]=A,this.uint16[Ke+9]=k,this.uint32[Qe+5]=M,this.uint32[Qe+6]=$,this.uint32[Qe+7]=V,this.uint16[Ke+16]=q,this.uint16[Ke+17]=X,this.uint16[Ke+18]=Y,this.float32[Qe+10]=se,this.float32[Qe+11]=ce,this.uint8[nt+48]=he,this.uint8[nt+49]=be,this.uint8[nt+50]=Ee,this.uint32[Qe+13]=Oe,this.int16[Ke+28]=Ue,this.uint8[nt+58]=Fe,a}}Pp.prototype.bytesPerElement=60,gr(Pp,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Yw extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,x,b,A,k,M,$,V,q,X,Y,se,ce,he,be,Ee,Oe,Ue,Fe,Ke,Qe,nt,Et,ft,Tt,It,Dt,Xt,Vt,jt){const $t=this.length;return this.resize($t+1),this.emplace($t,a,c,f,p,x,b,A,k,M,$,V,q,X,Y,se,ce,he,be,Ee,Oe,Ue,Fe,Ke,Qe,nt,Et,ft,Tt,It,Dt,Xt,Vt,jt)}emplace(a,c,f,p,x,b,A,k,M,$,V,q,X,Y,se,ce,he,be,Ee,Oe,Ue,Fe,Ke,Qe,nt,Et,ft,Tt,It,Dt,Xt,Vt,jt,$t){const xt=20*a,vt=40*a,zt=80*a;return this.float32[xt+0]=c,this.float32[xt+1]=f,this.int16[vt+4]=p,this.int16[vt+5]=x,this.int16[vt+6]=b,this.int16[vt+7]=A,this.int16[vt+8]=k,this.int16[vt+9]=M,this.int16[vt+10]=$,this.int16[vt+11]=V,this.int16[vt+12]=q,this.uint16[vt+13]=X,this.uint16[vt+14]=Y,this.uint16[vt+15]=se,this.uint16[vt+16]=ce,this.uint16[vt+17]=he,this.uint16[vt+18]=be,this.uint16[vt+19]=Ee,this.uint16[vt+20]=Oe,this.uint16[vt+21]=Ue,this.uint16[vt+22]=Fe,this.uint16[vt+23]=Ke,this.uint16[vt+24]=Qe,this.uint16[vt+25]=nt,this.uint16[vt+26]=Et,this.uint16[vt+27]=ft,this.uint32[xt+14]=Tt,this.float32[xt+15]=It,this.float32[xt+16]=Dt,this.float32[xt+17]=Xt,this.float32[xt+18]=Vt,this.uint8[zt+76]=jt,this.uint16[vt+39]=$t,a}}Yw.prototype.bytesPerElement=80,gr(Yw,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Jw extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,x,b){const A=this.length;return this.resize(A+1),this.emplace(A,a,c,f,p,x,b)}emplace(a,c,f,p,x,b,A){const k=6*a;return this.float32[k+0]=c,this.float32[k+1]=f,this.float32[k+2]=p,this.float32[k+3]=x,this.float32[k+4]=b,this.float32[k+5]=A,a}}Jw.prototype.bytesPerElement=24,gr(Jw,"StructArrayLayout6f24");class tf extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,x){const b=this.length;return this.resize(b+1),this.emplace(b,a,c,f,p,x)}emplace(a,c,f,p,x,b){const A=5*a;return this.float32[A+0]=c,this.float32[A+1]=f,this.float32[A+2]=p,this.float32[A+3]=x,this.float32[A+4]=b,a}}tf.prototype.bytesPerElement=20,gr(tf,"StructArrayLayout5f20");class Qw extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,x,b,A){const k=this.length;return this.resize(k+1),this.emplace(k,a,c,f,p,x,b,A)}emplace(a,c,f,p,x,b,A,k){const M=7*a;return this.float32[M+0]=c,this.float32[M+1]=f,this.float32[M+2]=p,this.float32[M+3]=x,this.float32[M+4]=b,this.float32[M+5]=A,this.float32[M+6]=k,a}}Qw.prototype.bytesPerElement=28,gr(Qw,"StructArrayLayout7f28");class Yg extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,x,b,A,k,M,$,V){const q=this.length;return this.resize(q+1),this.emplace(q,a,c,f,p,x,b,A,k,M,$,V)}emplace(a,c,f,p,x,b,A,k,M,$,V,q){const X=11*a;return this.float32[X+0]=c,this.float32[X+1]=f,this.float32[X+2]=p,this.float32[X+3]=x,this.float32[X+4]=b,this.float32[X+5]=A,this.float32[X+6]=k,this.float32[X+7]=M,this.float32[X+8]=$,this.float32[X+9]=V,this.float32[X+10]=q,a}}Yg.prototype.bytesPerElement=44,gr(Yg,"StructArrayLayout11f44");class e1 extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,x,b,A,k,M){const $=this.length;return this.resize($+1),this.emplace($,a,c,f,p,x,b,A,k,M)}emplace(a,c,f,p,x,b,A,k,M,$){const V=9*a;return this.float32[V+0]=c,this.float32[V+1]=f,this.float32[V+2]=p,this.float32[V+3]=x,this.float32[V+4]=b,this.float32[V+5]=A,this.float32[V+6]=k,this.float32[V+7]=M,this.float32[V+8]=$,a}}e1.prototype.bytesPerElement=36,gr(e1,"StructArrayLayout9f36");class Zd extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c){const f=this.length;return this.resize(f+1),this.emplace(f,a,c)}emplace(a,c,f){const p=2*a;return this.float32[p+0]=c,this.float32[p+1]=f,a}}Zd.prototype.bytesPerElement=8,gr(Zd,"StructArrayLayout2f8");class t1 extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,f,p){const x=this.length;return this.resize(x+1),this.emplace(x,a,c,f,p)}emplace(a,c,f,p,x){const b=6*a;return this.uint32[3*a+0]=c,this.uint16[b+2]=f,this.uint16[b+3]=p,this.uint16[b+4]=x,a}}t1.prototype.bytesPerElement=12,gr(t1,"StructArrayLayout1ul3ui12");class j_ extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.uint16[1*a+0]=c,a}}j_.prototype.bytesPerElement=2,gr(j_,"StructArrayLayout1ui2");class N_ extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,x,b,A,k,M,$,V,q,X,Y,se,ce){const he=this.length;return this.resize(he+1),this.emplace(he,a,c,f,p,x,b,A,k,M,$,V,q,X,Y,se,ce)}emplace(a,c,f,p,x,b,A,k,M,$,V,q,X,Y,se,ce,he){const be=16*a;return this.float32[be+0]=c,this.float32[be+1]=f,this.float32[be+2]=p,this.float32[be+3]=x,this.float32[be+4]=b,this.float32[be+5]=A,this.float32[be+6]=k,this.float32[be+7]=M,this.float32[be+8]=$,this.float32[be+9]=V,this.float32[be+10]=q,this.float32[be+11]=X,this.float32[be+12]=Y,this.float32[be+13]=se,this.float32[be+14]=ce,this.float32[be+15]=he,a}}N_.prototype.bytesPerElement=64,gr(N_,"StructArrayLayout16f64");class Cp extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,x,b,A){const k=this.length;return this.resize(k+1),this.emplace(k,a,c,f,p,x,b,A)}emplace(a,c,f,p,x,b,A,k){const M=10*a,$=5*a;return this.uint16[M+0]=c,this.uint16[M+1]=f,this.uint16[M+2]=p,this.uint16[M+3]=x,this.float32[$+2]=b,this.float32[$+3]=A,this.float32[$+4]=k,a}}Cp.prototype.bytesPerElement=20,gr(Cp,"StructArrayLayout4ui3f20");class r1 extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.int16[1*a+0]=c,a}}r1.prototype.bytesPerElement=2,gr(r1,"StructArrayLayout1i2");class M_ extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.uint8[1*a+0]=c,a}}M_.prototype.bytesPerElement=1,gr(M_,"StructArrayLayout1ub1");class n1 extends Xg{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}n1.prototype.size=40;class K2 extends Xw{get(a){return new n1(this,a)}}gr(K2,"CollisionBoxArray");class D_ extends Xg{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(a){this._structArray.uint8[this._pos1+49]=a}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(a){this._structArray.uint8[this._pos1+50]=a}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(a){this._structArray.uint32[this._pos4+13]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(a){this._structArray.uint8[this._pos1+58]=a}}D_.prototype.size=60;class Jg extends Pp{get(a){return new D_(this,a)}}gr(Jg,"PlacedSymbolArray");class i1 extends Xg{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(a){this._structArray.uint32[this._pos4+14]=a}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(a){this._structArray.float32[this._pos4+18]=a}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}i1.prototype.size=80;class Z2 extends Yw{get(a){return new i1(this,a)}}gr(Z2,"SymbolInstanceArray");class a1 extends Ku{getoffsetX(a){return this.float32[1*a+0]}}gr(a1,"GlyphOffsetArray");class X2 extends Ls{getx(a){return this.int16[2*a+0]}gety(a){return this.int16[2*a+1]}}gr(X2,"SymbolLineVertexArray");class L_ extends Xg{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}L_.prototype.size=12;class Y2 extends t1{get(a){return new L_(this,a)}}gr(Y2,"FeatureIndexArray");class J2 extends oc{geta_centroid_pos0(a){return this.uint16[2*a+0]}geta_centroid_pos1(a){return this.uint16[2*a+1]}}gr(J2,"FillExtrusionCentroidArray");class Q2 extends Xg{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Q2.prototype.size=6;class eA extends Qh{get(a){return new Q2(this,a)}}gr(eA,"FillExtrusionWallArray");const tA=Tn([{name:"a_pos",components:2,type:"Int16"}],4),xj=Tn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),bj=Tn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ta{constructor(a=[]){this.segments=a}_prepareSegment(a,c,f,p){let x=this.segments[this.segments.length-1];return a>ta.MAX_VERTEX_ARRAY_LENGTH&&Ir(`Max vertices per segment is ${ta.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}`),(!x||x.vertexLength+a>ta.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==p)&&(x={vertexOffset:c,primitiveOffset:f,vertexLength:0,primitiveLength:0},p!==void 0&&(x.sortKey=p),this.segments.push(x)),x}prepareSegment(a,c,f,p){return this._prepareSegment(a,c.length,f.length,p)}get(){return this.segments}destroy(){for(const a of this.segments)for(const c in a.vaos)a.vaos[c].destroy()}static simpleSegment(a,c,f,p){return new ta([{vertexOffset:a,primitiveOffset:c,vertexLength:f,primitiveLength:p,vaos:{},sortKey:0}])}}function rA(u,a){return 256*(u=ve(Math.floor(u),0,255))+ve(Math.floor(a),0,255)}ta.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,gr(ta,"SegmentVector");const wj=Tn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Sj=Tn([{name:"a_pattern_b",components:4,type:"Uint16"}]),Ej=Tn([{name:"a_dash",components:4,type:"Uint16"}]);class Qg{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(a,c,f,p){this.ids.push(ey(a)),this.positions.push(c,f,p)}eachPosition(a,c){const f=ey(a);let p=0,x=this.ids.length-1;for(;p<x;){const b=p+x>>1;this.ids[b]>=f?x=b:p=b+1}for(;this.ids[p]===f;)c(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(a,c){const f=new Float64Array(a.ids),p=new Uint32Array(a.positions);return o1(f,p,0,f.length-1),c&&(c.add(f.buffer),c.add(p.buffer)),{ids:f,positions:p}}static deserialize(a){const c=new Qg;let f;c.ids=a.ids,c.positions=a.positions;for(const p of c.ids)p!==f&&c.uniqueIds.push(p),f=p;return c.indexed=!0,c}}function ey(u){const a=+u;return Number.isSafeInteger(a)?a:Eg(String(u))}function o1(u,a,c,f){for(;c<f;){const p=u[c+f>>1];let x=c-1,b=f+1;for(;;){do x++;while(u[x]<p);do b--;while(u[b]>p);if(x>=b)break;F_(u,x,b),F_(a,3*x,3*b),F_(a,3*x+1,3*b+1),F_(a,3*x+2,3*b+2)}b-c<f-b?(o1(u,a,c,b),c=b+1):(o1(u,a,b+1,f),f=b)}}function F_(u,a,c){const f=u[a];u[a]=u[c],u[c]=f}gr(Qg,"FeaturePositionMap");class sc{constructor(a){this.gl=a.gl,this.initialized=!1}fetchUniformLocation(a,c){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(a,c),this.initialized=!0),!!this.location}set(a,c,f){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class z_ extends sc{constructor(a){super(a),this.current=0}set(a,c,f){this.fetchUniformLocation(a,c)&&this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))}}class Ia extends sc{constructor(a){super(a),this.current=0}set(a,c,f){this.fetchUniformLocation(a,c)&&this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))}}class cu extends sc{constructor(a){super(a),this.current=[0,0]}set(a,c,f){this.fetchUniformLocation(a,c)&&(f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1])))}}class Op extends sc{constructor(a){super(a),this.current=[0,0,0]}set(a,c,f){this.fetchUniformLocation(a,c)&&(f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2])))}}class ty extends sc{constructor(a){super(a),this.current=[0,0,0,0]}set(a,c,f){this.fetchUniformLocation(a,c)&&(f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3])))}}class s1 extends sc{constructor(a){super(a),this.current=ni.transparent.toPremultipliedRenderColor(null)}set(a,c,f){this.fetchUniformLocation(a,c)&&(f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a)))}}const nA=new Float32Array(16);class ry extends sc{constructor(a){super(a),this.current=nA}set(a,c,f){if(this.fetchUniformLocation(a,c)){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(let p=1;p<16;p++)if(f[p]!==this.current[p]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}}}}const Tj=new Float32Array(9),iA=new Float32Array(4);class l1 extends sc{constructor(a){super(a),this.current=iA}set(a,c,f){if(this.fetchUniformLocation(a,c)){for(let p=0;p<4;p++)if(f[p]!==this.current[p]){this.current=f,this.gl.uniformMatrix2fv(this.location,!1,f);break}}}}function c1(u){return[rA(255*u.r,255*u.g),rA(255*u.b,255*u.a)]}function B_(u,a,c,f,p,x,b,A){return!!u&&(u.kind==="composite"||u.kind==="source"?u.evaluate(new Ri(0,{brightness:x,worldview:A}),a,c,p,f,b)==="none":u.value==="none")}class $_{constructor(a,c,f,p){this.value=a,this.uniformNames=c.map(x=>`u_${x}`),this.type=f,this.context=p}setUniform(a,c,f,p,x){const b=p.constantOr(this.value);c.set(a,x,b instanceof ni?b.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):b)}getBinding(a,c){return this.type==="color"?new s1(a):new Ia(a)}}class ny{constructor(a,c){this.uniformNames=c.map(f=>`u_${f}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(a,c){this.pixelRatio=a.pixelRatio||1,this.pattern=a.tl.concat(a.br),this.patternTransition=c?c.tl.concat(c.br):this.pattern}setUniform(a,c,f,p,x){let b=null;x!=="u_pattern"&&x!=="u_dash"||(b=this.pattern),x==="u_pattern_b"&&(b=this.patternTransition),x==="u_pixel_ratio"&&(b=this.pixelRatio),b&&c.set(a,x,b)}getBinding(a,c){return c==="u_pattern"||c==="u_pattern_b"||c==="u_dash"?new ty(a):new Ia(a)}}class Zu{constructor(a,c,f,p){this.expression=a,this.type=f,this.maxValue=0,this.paintVertexAttributes=c.map(x=>({name:`a_${x}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(a,c,f,p,x,b,A,k){const M=this.paintVertexArray.length,$=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Ri(0,{brightness:b,worldview:k}),c,{},x,p,A):this.expression.kind==="constant"&&this.expression.value,V=B_(this.lutExpression,c,{},p,x,b,A,k);this.paintVertexArray.resize(a),this._setPaintValue(M,a,$,V?null:this.context.lut)}updatePaintArray(a,c,f,p,x,b,A,k){const M=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:A,worldview:k},f,p,void 0,x):this.expression.kind==="constant"&&this.expression.value,$=B_(this.lutExpression,f,p,x,void 0,A,void 0,k);this._setPaintValue(a,c,M,$?null:this.context.lut)}_setPaintValue(a,c,f,p){if(this.type==="color"){const x=c1(f.toPremultipliedRenderColor(p));for(let b=a;b<c;b++)this.paintVertexArray.emplace(b,x[0],x[1])}else{for(let x=a;x<c;x++)this.paintVertexArray.emplace(x,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class kc{constructor(a,c,f,p,x,b){this.expression=a,this.uniformNames=c.map(A=>`u_${A}_t`),this.type=f,this.useIntegerZoom=p,this.context=x,this.maxValue=0,this.paintVertexAttributes=c.map(A=>({name:`a_${A}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(a,c,f,p,x,b,A,k){const M=this.expression.evaluate(new Ri(this.context.zoom,{brightness:b,worldview:k}),c,{},x,p,A),$=this.expression.evaluate(new Ri(this.context.zoom+1,{brightness:b,worldview:k}),c,{},x,p,A),V=B_(this.lutExpression,c,{},p,x,b,A,k),q=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(q,a,M,$,V?null:this.context.lut)}updatePaintArray(a,c,f,p,x,b,A,k){const M=this.expression.evaluate({zoom:this.context.zoom,brightness:A,worldview:k},f,p,void 0,x),$=this.expression.evaluate({zoom:this.context.zoom+1,brightness:A,worldview:k},f,p,void 0,x),V=B_(this.lutExpression,f,p,x,void 0,A,void 0,k);this._setPaintValue(a,c,M,$,V?null:this.context.lut)}_setPaintValue(a,c,f,p,x){if(this.type==="color"){const b=c1(f.toPremultipliedRenderColor(x)),A=c1(f.toPremultipliedRenderColor(x));for(let k=a;k<c;k++)this.paintVertexArray.emplace(k,b[0],b[1],A[0],A[1])}else{for(let b=a;b<c;b++)this.paintVertexArray.emplace(b,f,p);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(p))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,c,f,p,x){const b=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,A=ve(this.expression.interpolationFactor(b,this.context.zoom,this.context.zoom+1),0,1);c.set(a,x,A)}getBinding(a,c){return new Ia(a)}}class qo{constructor(a,c,f,p,x){this.expression=a,this.layerId=x,this.paintVertexAttributes=(f==="array"?Ej:wj).members;for(let b=0;b<c.length;++b);this.paintVertexArray=new p,this.paintTransitionVertexArray=new ef}populatePaintArray(a,c,f,p){const x=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValues(x,a,c.patterns&&c.patterns[this.layerId],f)}updatePaintArray(a,c,f,p,x,b,A){this._setPaintValues(a,c,f.patterns&&f.patterns[this.layerId],b)}_setPaintValues(a,c,f,p){if(!p||!f)return;const x=p[f[0]],b=p[f[1]];if(x){if(x){const{tl:A,br:k,pixelRatio:M}=x;for(let $=a;$<c;$++)this.paintVertexArray.emplace($,A[0],A[1],k[0],k[1],M)}if(b){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:A,br:k}=b;for(let M=a;M<c;M++)this.paintTransitionVertexArray.emplace(M,A[0],A[1],k[0],k[1])}}}upload(a){const c=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,c)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=a.createVertexBuffer(this.paintTransitionVertexArray,Sj.members,c))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Xu{constructor(a,c,f=()=>!0){this.binders={},this._buffers=[],this.context=c;const p=[];for(const x in a.paint._values){const b=a.paint.get(x);if(x.endsWith("-use-theme")||!f(x)||!(b instanceof ac&&p_(b.property.specification)))continue;const A=Pj(x,a.type),k=b.value,M=b.property.specification.type,$=!!b.property.useIntegerZoom,V=x==="line-dasharray"||x.endsWith("pattern"),q=a.paint.get(`${x}-use-theme`),X=x==="line-dasharray"&&a.layout.get("line-cap").value.kind!=="constant"||q&&q.value.kind!=="constant";if(k.kind!=="constant"||X)if(k.kind==="source"||X||V){const Y=u1(x,M,"source");this.binders[x]=V?new qo(k,A,M,Y,a.id):new Zu(k,A,M,Y),p.push(`/a_${x}`)}else{const Y=u1(x,M,"composite");this.binders[x]=new kc(k,A,M,$,c,Y),p.push(`/z_${x}`)}else this.binders[x]=V?new ny(k.value,A):new $_(k.value,A,M,c),p.push(`/u_${x}`);q&&(this.binders[x].lutExpression=q.value)}this.cacheKey=p.sort().join("")}getMaxValue(a){const c=this.binders[a];return c instanceof Zu||c instanceof kc?c.maxValue:0}populatePaintArrays(a,c,f,p,x,b,A,k){for(const M in this.binders){const $=this.binders[M];$.context=this.context,($ instanceof Zu||$ instanceof kc||$ instanceof qo)&&$.populatePaintArray(a,c,f,p,x,b,A,k)}}setConstantPatternPositions(a,c){for(const f in this.binders){const p=this.binders[f];p instanceof ny&&p.setConstantPatternPositions(a,c)}}getPatternTransitionVertexBuffer(a){const c=this.binders[a];return c instanceof qo?c.paintTransitionVertexBuffer:null}updatePaintArrays(a,c,f,p,x,b,A,k,M,$){let V=!1;const q=Object.keys(a),X=q.length!==0&&!k,Y=X?q:c.uniqueIds;this.context.lut=x.lut;for(const se in this.binders){const ce=this.binders[se];if(ce.context=this.context,(ce instanceof Zu||ce instanceof kc||ce instanceof qo)&&ce.expression&&ce.expression.kind&&ce.expression.kind!=="constant"&&(ce.expression.isStateDependent===!0||ce.expression.isLightConstant===!1)){const he=x.paint.get(se);ce.expression=he.value;for(const be of Y){const Ee=a[be.toString()];c.eachPosition(be,(Oe,Ue,Fe)=>{const Ke=p.feature(Oe);ce.updatePaintArray(Ue,Fe,Ke,Ee,b,A,M,$)})}if(!X)for(const be of f.uniqueIds){const Ee=a[be.toString()];f.eachPosition(be,(Oe,Ue,Fe)=>{const Ke=p.feature(Oe);ce.updatePaintArray(Ue,Fe,Ke,Ee,b,A,M,$)})}V=!0}}return V}defines(){const a=[];for(const c in this.binders){const f=this.binders[c];(f instanceof $_||f instanceof ny)&&a.push(...f.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a){const c=[];for(const f in this.binders){const p=this.binders[f];if(p instanceof $_||p instanceof ny||p instanceof kc)for(const x of p.uniformNames)c.push({name:x,property:f,binding:p.getBinding(a,x)})}return c}setUniforms(a,c,f,p,x){for(const{name:b,property:A,binding:k}of f)this.binders[A].setUniform(a,k,x,p.get(A),b)}updatePaintBuffers(){this._buffers=[];for(const a in this.binders){const c=this.binders[a];(c instanceof Zu||c instanceof kc||c instanceof qo)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer),c instanceof qo&&c.paintTransitionVertexBuffer&&this._buffers.push(c.paintTransitionVertexBuffer)}}upload(a){for(const c in this.binders){const f=this.binders[c];(f instanceof Zu||f instanceof kc||f instanceof qo)&&f.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const c=this.binders[a];(c instanceof Zu||c instanceof kc||c instanceof qo)&&c.destroy()}}}class Ic{constructor(a,c,f=()=>!0){this.programConfigurations={};for(const p of a)this.programConfigurations[p.id]=new Xu(p,c,f);this.needsUpload=!1,this._featureMap=new Qg,this._featureMapWithoutIds=new Qg,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(a,c,f,p,x,b,A,k,M){for(const $ in this.programConfigurations)this.programConfigurations[$].populatePaintArrays(a,c,p,x,b,A,k,M);c.id!==void 0?this._featureMap.add(c.id,f,this._bufferOffset,a):(this._featureMapWithoutIds.add(this._idlessCounter,f,this._bufferOffset,a),this._idlessCounter+=1),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,c,f,p,x,b,A,k){for(const M of f)this.needsUpload=this.programConfigurations[M.id].updatePaintArrays(a,this._featureMap,this._featureMapWithoutIds,c,M,p,x,b,A||0,k)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}const Aj={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Pj(u,a){return Aj[u]||[u.replace(`${a}-`,"").replace(/-/g,"_")]}const Cj={"line-pattern":{source:Hd,composite:Hd},"fill-pattern":{source:Hd,composite:Hd},"fill-extrusion-pattern":{source:Hd,composite:Hd},"line-dasharray":{source:ef,composite:ef}},Oj={color:{source:Zd,composite:Kd},number:{source:Ku,composite:Zd}};function u1(u,a,c){const f=Cj[u];return f&&f[c]||Oj[a][c]}gr($_,"ConstantBinder"),gr(ny,"PatternConstantBinder"),gr(Zu,"SourceExpressionBinder"),gr(qo,"PatternCompositeBinder"),gr(kc,"CompositeExpressionBinder"),gr(Xu,"ProgramConfiguration",{omit:["_buffers"]}),gr(Ic,"ProgramConfigurationSet");const Fs=Jt/Math.PI/2,y=5,s=6,h=16383,v=64,w=[v,32,16],P=-Fs,O=Fs;function L(u,a,c,f=Fs){return c=bn(c),[u*Math.sin(c)*f,-a*f,u*Math.cos(c)*f]}function z(u,a,c){return L(Math.cos(bn(u)),Math.sin(bn(u)),a,c)}const G=63710088e-1,H=2*Math.PI*G;class Q{constructor(a,c){if(isNaN(a)||isNaN(c))throw new Error(`Invalid LngLat object: (${a}, ${c})`);if(this.lng=+a,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Q(Je(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const c=Math.PI/180,f=this.lat*c,p=a.lat*c,x=Math.sin(f)*Math.sin(p)+Math.cos(f)*Math.cos(p)*Math.cos((a.lng-this.lng)*c);return G*Math.acos(Math.min(x,1))}toBounds(a=0){const c=360*a/40075017,f=c/Math.cos(Math.PI/180*this.lat);return new K({lng:this.lng-f,lat:this.lat-c},{lng:this.lng+f,lat:this.lat+c})}toEcef(a){return z(this.lat,this.lng,Fs+a*Fs/G)}static convert(a){if(a instanceof Q)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Q(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Q(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class K{constructor(a,c){a&&(c?this.setSouthWest(a).setNorthEast(c):Array.isArray(a)&&a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))}setNorthEast(a){return this._ne=a instanceof Q?new Q(a.lng,a.lat):Q.convert(a),this}setSouthWest(a){return this._sw=a instanceof Q?new Q(a.lng,a.lat):Q.convert(a),this}extend(a){const c=this._sw,f=this._ne;let p,x;if(a instanceof Q)p=a,x=a;else{if(!(a instanceof K))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(K.convert(a)):this.extend(Q.convert(a)):typeof a=="object"&&a!==null&&a.hasOwnProperty("lat")&&(a.hasOwnProperty("lon")||a.hasOwnProperty("lng"))?this.extend(Q.convert(a)):this;if(p=a._sw,x=a._ne,!p||!x)return this}return c||f?(c.lng=Math.min(p.lng,c.lng),c.lat=Math.min(p.lat,c.lat),f.lng=Math.max(x.lng,f.lng),f.lat=Math.max(x.lat,f.lat)):(this._sw=new Q(p.lng,p.lat),this._ne=new Q(x.lng,x.lat)),this}getCenter(){return new Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Q(this.getWest(),this.getNorth())}getSouthEast(){return new Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(a){const{lng:c,lat:f}=Q.convert(a);let p=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&p}static convert(a){if(a)return a instanceof K?a:new K(a)}}const re=0,le=25.5;function ue(u){return H*Math.cos(u*Math.PI/180)}function _e(u){return(180+u)/360}function ge(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function Se(u,a){return u/ue(a)}function ke(u){return 360*u-180}function Te(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function $e(u,a){return u*ue(Te(a))}const Re=85.051129;function Ve(u){return Math.cos(bn(ve(u,-Re,Re)))}function Be(u,a){const c=ve(a,re,le),f=Math.pow(2,c);return Ve(u)*H/(512*f)}function De(u){return 1/Math.cos(u*Math.PI/180)}function We(u,a=0){const c=Math.exp(Math.PI*(1-(u.y+a/Jt)/(1<<u.z)*2));return 80150034*c/(c*c+1)/Jt/(1<<u.z)}class lt{constructor(a,c,f=0){this.x=+a,this.y=+c,this.z=+f}static fromLngLat(a,c=0){const f=Q.convert(a);return new lt(_e(f.lng),ge(f.lat),Se(c,f.lat))}toLngLat(){return new Q(ke(this.x),Te(this.y))}toAltitude(){return $e(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/H*De(Te(this.y))}}function it(u,a,c,f,p,x,b,A,k){const M=(a+f)/2,$=(c+p)/2,V=new Mt(M,$);A(V),function(q,X,Y,se,ce,he){const be=Y-ce,Ee=se-he;return Math.abs((se-X)*be-(Y-q)*Ee)/Math.hypot(be,Ee)}(V.x,V.y,x.x,x.y,b.x,b.y)>=k?(it(u,a,c,M,$,x,V,A,k),it(u,M,$,f,p,V,b,A,k)):u.push(b)}function bt(u,a,c){let f=u[0],p=f.x,x=f.y;a(f);const b=[f];for(let A=1;A<u.length;A++){const k=u[A],{x:M,y:$}=k;a(k),it(b,p,x,M,$,f,k,a,c),p=M,x=$,f=k}return b}function mt(u,a,c,f){if(f(a,c)){const p=a.add(c)._mult(.5);mt(u,a,p,f),mt(u,p,c,f)}else u.push(c)}function Ot(u,a){let c=u[0];const f=[c];for(let p=1;p<u.length;p++){const x=u[p];mt(f,c,x,a),c=x}return f}const Zt=Math.pow(2,14)-1,pt=-Zt-1;function et(u,a){const c=Math.round(u.x*a),f=Math.round(u.y*a);return u.x=ve(c,pt,Zt),u.y=ve(f,pt,Zt),(c<u.x||c>u.x+1||f<u.y||f>u.y+1)&&Ir("Geometry exceeds allowed extent, reduce your vector tile buffer size"),u}function kt(u,a,c){const f=u.loadGeometry(),p=u.extent,x=Jt/p;if(a&&c&&c.projection.isReprojectedInTileSpace){const b=1<<a.z,{scale:A,x:k,y:M,projection:$}=c,V=q=>{const X=ke((a.x+q.x/p)/b),Y=Te((a.y+q.y/p)/b),se=$.project(X,Y);q.x=(se.x*A-k)*p,q.y=(se.y*A-M)*p};for(let q=0;q<f.length;q++)if(u.type!==1)f[q]=bt(f[q],V,1);else{const X=[];for(const Y of f[q])Y.x<0||Y.x>=p||Y.y<0||Y.y>=p||(V(Y),X.push(Y));f[q]=X}}for(const b of f)for(const A of b)et(A,x);return f}function gt(u,a){return{type:u.type,id:u.id,properties:u.properties,geometry:a?kt(u):[]}}class Lt{constructor(a,c,f,p,x){this.properties={},this.extent=f,this.type=0,this.id=void 0,this._pbf=a,this._geometry=-1,this._keys=p,this._values=x,a.readFields(Qt,this,c)}loadGeometry(){const a=this._pbf;a.pos=this._geometry;const c=a.readVarint()+a.pos,f=[];let p,x=1,b=0,A=0,k=0;for(;a.pos<c;){if(b<=0){const M=a.readVarint();x=7&M,b=M>>3}if(b--,x===1||x===2)A+=a.readSVarint(),k+=a.readSVarint(),x===1&&(p&&f.push(p),p=[]),p&&p.push(new Mt(A,k));else{if(x!==7)throw new Error(`unknown command ${x}`);p&&p.push(p[0].clone())}}return p&&f.push(p),f}bbox(){const a=this._pbf;a.pos=this._geometry;const c=a.readVarint()+a.pos;let f=1,p=0,x=0,b=0,A=1/0,k=-1/0,M=1/0,$=-1/0;for(;a.pos<c;){if(p<=0){const V=a.readVarint();f=7&V,p=V>>3}if(p--,f===1||f===2)x+=a.readSVarint(),b+=a.readSVarint(),x<A&&(A=x),x>k&&(k=x),b<M&&(M=b),b>$&&($=b);else if(f!==7)throw new Error(`unknown command ${f}`)}return[A,M,k,$]}toGeoJSON(a,c,f){const p=this.extent*Math.pow(2,f),x=this.extent*a,b=this.extent*c,A=this.loadGeometry();function k(q){return[360*(q.x+x)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*(q.y+b)/p)*Math.PI))-90]}function M(q){return q.map(k)}let $;if(this.type===1){const q=[];for(const Y of A)q.push(Y[0]);const X=M(q);$=q.length===1?{type:"Point",coordinates:X[0]}:{type:"MultiPoint",coordinates:X}}else if(this.type===2){const q=A.map(M);$=q.length===1?{type:"LineString",coordinates:q[0]}:{type:"MultiLineString",coordinates:q}}else{if(this.type!==3)throw new Error("unknown feature type");{const q=function(Y){const se=Y.length;if(se<=1)return[Y];const ce=[];let he,be;for(let Ee=0;Ee<se;Ee++){const Oe=vr(Y[Ee]);Oe!==0&&(be===void 0&&(be=Oe<0),be===Oe<0?(he&&ce.push(he),he=[Y[Ee]]):he&&he.push(Y[Ee]))}return he&&ce.push(he),ce}(A),X=[];for(const Y of q)X.push(Y.map(M));$=X.length===1?{type:"Polygon",coordinates:X[0]}:{type:"MultiPolygon",coordinates:X}}}const V={type:"Feature",geometry:$,properties:this.properties};return this.id!=null&&(V.id=this.id),V}}function Qt(u,a,c){u===1?a.id=c.readVarint():u===2?function(f,p){const x=f.readVarint()+f.pos;for(;f.pos<x;){const b=p._keys[f.readVarint()],A=p._values[f.readVarint()];p.properties[b]=A}}(c,a):u===3?a.type=c.readVarint():u===4&&(a._geometry=c.pos)}function vr(u){let a=0;for(let c,f,p=0,x=u.length,b=x-1;p<x;b=p++)c=u[p],f=u[b],a+=(f.x-c.x)*(c.y+f.y);return a}Lt.types=["Unknown","Point","LineString","Polygon"];class Gt{constructor(a,c){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(Yt,this,c),this.length=this._features.length}feature(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];const c=this._pbf.readVarint()+this._pbf.pos;return new Lt(this._pbf,c,this.extent,this._keys,this._values)}}function Yt(u,a,c){u===15?a.version=c.readVarint():u===1?a.name=c.readString():u===5?a.extent=c.readVarint():u===2?a._features.push(c.pos):u===3?a._keys.push(c.readString()):u===4&&a._values.push(function(f){let p=null;const x=f.readVarint()+f.pos;for(;f.pos<x;){const b=f.readVarint()>>3;p=b===1?f.readString():b===2?f.readFloat():b===3?f.readDouble():b===4?f.readVarint64():b===5?f.readVarint():b===6?f.readSVarint():b===7?f.readBoolean():null}if(p==null)throw new Error("unknown feature value");return p}(c))}class br{constructor(a,c){this.layers=a.readFields(hr,{},c)}}function hr(u,a,c){if(u===3){const f=new Gt(c,c.readVarint()+c.pos);f.length&&(a[f.name]=f)}}const cr="3d_elevation_id",fr="level";class Mr{constructor(){this._valid=!1}reset(a){return this.feature=a,this._valid=!0,this._geometry=a.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(a,c){return this._valid&&a(c(this._geometry)),this}require(a,c,f){return this.get(a,!0,c,f)}optional(a,c,f){return this.get(a,!1,c,f)}success(){return this._valid}get(a,c,f,p){const x=this.feature.properties.hasOwnProperty(a)?+this.feature.properties[a]:void 0;return this._valid&&x!==void 0&&!Number.isNaN(x)?f(p?p(x):x):c&&(this._valid=!1),this}}class An{constructor(a,c){this.featureFunc=a,this.vertexFunc=c}parseFeature(a,c,f){return this.featureFunc(a,c,f)}parseVertex(a,c,f){return this.vertexFunc(a,c,f)}}const Dn=new An((u,a,c)=>u.reset(a).require(cr,f=>{c.id=f}).optional("fixed_height_relative",f=>{c.constantHeight=f},Hr.decodeRelativeHeight).geometry(f=>{c.bounds=f},Mg).success(),(u,a,c)=>u.reset(a).require(cr,f=>{c.id=f}).require("elevation_idx",f=>{c.idx=f}).require("extent",f=>{c.extent=f}).require("height_relative",f=>{c.height=f},Hr.decodeRelativeHeight).geometry(f=>{c.position=f},Hr.getPoint).success()),mi=new An((u,a,c)=>u.reset(a).require(cr,f=>{c.id=f}).optional("fixed_height",f=>{c.constantHeight=f},Hr.decodeMetricHeight).geometry(f=>{c.bounds=f},Mg).success(),(u,a,c)=>u.reset(a).require(cr,f=>{c.id=f}).require("elevation_idx",f=>{c.idx=f}).require("extent",f=>{c.extent=f}).require("height",f=>{c.height=f},Hr.decodeMetricHeight).geometry(f=>{c.position=f},Hr.getPoint).success());class Hr{static getPoint(a){return bs(a[0][0].x,a[0][0].y)}static decodeRelativeHeight(a){return 1e-4*a*5}static decodeMetricHeight(a){return 1e-4*a}static getVersionSchema(a){return a?a==="1.0.1"?mi:void 0:Dn}static parse(a){const c=[],f=[],p=a.length,x=new Mr;for(let b=0;b<p;b++){const A=a.feature(b),k=A.properties.version,M=Hr.getVersionSchema(k);if(M===void 0){Ir(`Unknown elevation feature version number ${k||"(unknown)"}`);continue}const $=A.properties.type;if(!$)continue;const V=Lt.types[A.type];if(V==="Point"&&$==="curve_point"){const q={};M.parseVertex(x,A,q)&&c.push(q)}else if(V==="Polygon"&&$==="curve_meta"){const q={};M.parseFeature(x,A,q)&&f.push(q)}}return{vertices:c,features:f}}}class Mn{constructor(a,c){this.pos=a,this.dir=c}intersectsPlane(a,c,f){const p=gl(c,this.dir);if(Math.abs(p)<1e-6)return!1;const x=((a[0]-this.pos[0])*c[0]+(a[1]-this.pos[1])*c[1])/p;return f[0]=this.pos[0]+this.dir[0]*x,f[1]=this.pos[1]+this.dir[1]*x,!0}}class sn{constructor(a,c){this.pos=a,this.dir=c}intersectsPlane(a,c,f){const p=ot(c,this.dir);if(Math.abs(p)<1e-6)return!1;const x=((a[0]-this.pos[0])*c[0]+(a[1]-this.pos[1])*c[1]+(a[2]-this.pos[2])*c[2])/p;return f[0]=this.pos[0]+this.dir[0]*x,f[1]=this.pos[1]+this.dir[1]*x,f[2]=this.pos[2]+this.dir[2]*x,!0}closestPointOnSphere(a,c,f){if(function(X,Y){var se=X[0],ce=X[1],he=X[2],be=Y[0],Ee=Y[1],Oe=Y[2];return Math.abs(se-be)<=g*Math.max(1,Math.abs(se),Math.abs(be))&&Math.abs(ce-Ee)<=g*Math.max(1,Math.abs(ce),Math.abs(Ee))&&Math.abs(he-Oe)<=g*Math.max(1,Math.abs(he),Math.abs(Oe))}(this.pos,a)||c===0)return f[0]=f[1]=f[2]=0,!1;const[p,x,b]=this.dir,A=this.pos[0]-a[0],k=this.pos[1]-a[1],M=this.pos[2]-a[2],$=p*p+x*x+b*b,V=2*(A*p+k*x+M*b),q=V*V-4*$*(A*A+k*k+M*M-c*c);if(q<0){const X=Math.max(-V/2,0),Y=A+p*X,se=k+x*X,ce=M+b*X,he=Math.hypot(Y,se,ce);return f[0]=Y*c/he,f[1]=se*c/he,f[2]=ce*c/he,!1}{const X=(-V-Math.sqrt(q))/(2*$);if(X<0){const Y=Math.hypot(A,k,M);return f[0]=A*c/Y,f[1]=k*c/Y,f[2]=M*c/Y,!1}return f[0]=A+p*X,f[1]=k+x*X,f[2]=M+b*X,!0}}}class si{constructor(a,c,f,p,x){this.TL=a,this.TR=c,this.BR=f,this.BL=p,this.horizon=x}static fromInvProjectionMatrix(a,c,f){const p=[-1,1,1],x=[1,1,1],b=[1,-1,1],A=[-1,-1,1],k=Ut(p,p,a),M=Ut(x,x,a),$=Ut(b,b,a),V=Ut(A,A,a);return new si(k,M,$,V,c/f)}}function Ln(u,a,c){let f=1/0,p=-1/0;const x=[];for(const b of u){Rt(x,b,a);const A=ot(x,c);f=Math.min(f,A),p=Math.max(p,A)}return[f,p]}function Ai(u,a){let c=!0;for(let f=0;f<u.planes.length;f++){const p=u.planes[f];let x=0;for(let b=0;b<a.length;b++)x+=+(ot(p,a[b])+p[3]>=0);if(x===0)return 0;x!==a.length&&(c=!1)}return c?2:1}function qn(u,a){for(const c of u.projections){const f=Ln(a,u.points[0],c.axis);if(c.projection[1]<f[0]||c.projection[0]>f[1])return 0}return 1}function dn(u,a){let c=0;const f=[0,0,0,0];for(let b=0;b<u.length;b++)f[0]=u[b][0],f[1]=u[b][1],f[2]=u[b][2],f[3]=1,(p=f)[0]*(x=a)[0]+p[1]*x[1]+p[2]*x[2]+p[3]*x[3]>=0&&c++;var p,x;return c}class Jn{constructor(a,c){this.points=a||new Array(8).fill([0,0,0]),this.planes=c||new Array(6).fill([0,0,0,0]),this.bounds=gn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Rt([],this.points[2],this.points[3]),Rt([],this.points[0],this.points[3]),Rt([],this.points[4],this.points[0]),Rt([],this.points[5],this.points[1]),Rt([],this.points[6],this.points[2]),Rt([],this.points[7],this.points[3])];for(const f of this.frustumEdges){const p=[0,-f[2],f[1]],x=[f[2],0,-f[0]];this.projections.push({axis:p,projection:Ln(this.points,this.points[0],p)}),this.projections.push({axis:x,projection:Ln(this.points,this.points[0],x)})}}static fromInvProjectionMatrix(a,c,f,p){const x=Math.pow(2,f),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const $=er([],M,a),V=1/$[3]/c*x;return(q=$)[0]=(X=$)[0]*(Y=[V,V,p?1/$[3]:V,V])[0],q[1]=X[1]*Y[1],q[2]=X[2]*Y[2],q[3]=X[3]*Y[3],q;var q,X,Y}),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const $=je([],St([],Rt([],b[M[0]],b[M[1]]),Rt([],b[M[2]],b[M[1]]))),V=-ot($,b[M[1]]);return $.concat(V)}),k=[];for(let M=0;M<b.length;M++)k.push([b[M][0],b[M][1],b[M][2]]);return new Jn(k,A)}intersectsPrecise(a,c,f){for(let p=0;p<c.length;p++)if(!dn(a,c[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!dn(a,this.planes[p]))return 0;for(const p of f)for(const x of this.frustumEdges){const b=St([],p,x),A=xe(b);if(A===0)continue;Ie(b,b,1/A);const k=Ln(this.points,this.points[0],b),M=Ln(a,this.points[0],b);if(k[0]>M[1]||M[0]>k[1])return 0}return 1}containsPoint(a){for(const c of this.planes){const f=c[3];if(ot([c[0],c[1],c[2]],a)+f<0)return!1}return!0}}class gn{static fromPoints(a){const c=[1/0,1/0,1/0],f=[-1/0,-1/0,-1/0];for(const p of a)ye(c,c,p),pe(f,f,p);return new gn(c,f)}static fromTileIdAndHeight(a,c,f){const p=1<<a.canonical.z,x=a.canonical.x,b=a.canonical.y;return new gn([x/p,b/p,c],[(x+1)/p,(b+1)/p,f])}static applyTransform(a,c){const f=a.getCorners();for(let p=0;p<f.length;++p)Ut(f[p],f[p],c);return gn.fromPoints(f)}static applyTransformFast(a,c){const f=[c[12],c[13],c[14]],p=[...f];for(let x=0;x<3;x++)for(let b=0;b<3;b++){const A=c[4*b+x],k=A*a.min[b],M=A*a.max[b];f[x]+=Math.min(k,M),p[x]+=Math.max(k,M)}return new gn(f,p)}static projectAabbCorners(a,c){const f=a.getCorners();for(let p=0;p<f.length;++p)Ut(f[p],f[p],c);return f}constructor(a,c){this.min=a,this.max=c,this.center=Ie([],Ce([],this.min,this.max),.5)}quadrant(a){const c=[a%2==0,a<2],f=de(this.min),p=de(this.max);for(let x=0;x<c.length;x++)f[x]=c[x]?this.min[x]:this.center[x],p[x]=c[x]?this.center[x]:this.max[x];return p[2]=this.max[2],new gn(f,p)}distanceX(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]}distanceY(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]}distanceZ(a){return Math.max(Math.min(this.max[2],a[2]),this.min[2])-a[2]}getCorners(){const a=this.min,c=this.max;return[[a[0],a[1],a[2]],[c[0],a[1],a[2]],[c[0],c[1],a[2]],[a[0],c[1],a[2]],[a[0],a[1],c[2]],[c[0],a[1],c[2]],[c[0],c[1],c[2]],[a[0],c[1],c[2]]]}intersects(a){return this.intersectsAabb(a.bounds)?Ai(a,this.getCorners()):0}intersectsFlat(a){return this.intersectsAabb(a.bounds)?Ai(a,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(a,c){return c||this.intersects(a)?qn(a,this.getCorners()):0}intersectsPreciseFlat(a,c){return c||this.intersectsFlat(a)?qn(a,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(a){for(let c=0;c<3;++c)if(this.min[c]>a.max[c]||a.min[c]>this.max[c])return!1;return!0}intersectsAabbXY(a){return!(this.min[0]>a.max[0]||a.min[0]>this.max[0]||this.min[1]>a.max[1]||a.min[1]>this.max[1])}encapsulate(a){for(let c=0;c<3;c++)this.min[c]=Math.min(this.min[c],a.min[c]),this.max[c]=Math.max(this.max[c],a.max[c])}encapsulatePoint(a){for(let c=0;c<3;c++)this.min[c]=Math.min(this.min[c],a[c]),this.max[c]=Math.max(this.max[c],a[c])}closestPoint(a){return[Math.max(Math.min(this.max[0],a[0]),this.min[0]),Math.max(Math.min(this.max[1],a[1]),this.min[1]),Math.max(Math.min(this.max[2],a[2]),this.min[2])]}}gr(gn,"Aabb");class Mi{constructor(a,c){this.feature=a,this.metersToTile=c,this.index=0}get(){const a=this.feature.vertices[this.index],c=this.feature.vertexProps[this.index].dir,f=c[1],p=-c[0],x=(a.extent+1)*this.metersToTile;return[new Mt(Math.trunc(a.position[0]+f*x),Math.trunc(a.position[1]+p*x)),new Mt(Math.trunc(a.position[0]-f*x),Math.trunc(a.position[1]-p*x))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class ri{constructor(a,c,f,p,x,b){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Si(),Si(),Si(),Si(),Si(),Si(),Si()],this.id=a,this.heightRange={min:f,max:f},this.safeArea=c,this.constantHeight=f,this.constantHeight==null&&(this.constantHeight!=null||p.length!==0)){this.vertices=p,this.edges=x,this.edges=this.edges.filter(A=>{return A.a<this.vertices.length&&A.b<this.vertices.length&&!((k=this.vertices[A.a].position)[0]===(M=this.vertices[A.b].position)[0]&&k[1]===M[1]);var k,M}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const A of this.vertices)this.vertexProps.push({dir:bs(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,A.height),this.heightRange.max=Math.max(this.heightRange.max,A.height);for(const A of this.edges){const k=this.vertices[A.a].position,M=this.vertices[A.b].position,$=$o(Si(),M,k),V=Ni($),q=rs(Si(),$,1/V);this.edgeProps.push({vec:$,dir:q,len:V});const X=this.vertexProps[A.a].dir,Y=this.vertexProps[A.b].dir;Ns(X,X,q),Ns(Y,Y,q)}for(const A of this.vertexProps)A.dir[0]===0&&A.dir[1]===0||so(A.dir,A.dir);this.tessellate(b)}}pointElevation(a){if(this.constantHeight!=null)return this.constantHeight;const c=this.getClosestEdge(a);if(c==null)return 0;const[f,p]=c;return qr(this.vertices[this.edges[f].a].height,this.vertices[this.edges[f].b].height,p)}computeSlopeNormal(a,c){const f=this.getClosestEdge(a);if(!f)return we(0,0,1);const p=f[0],x=this.edges[p],b=this.edgeProps[p].vec,A=we(b[0],b[1],(this.vertices[x.b].height-this.vertices[x.a].height)*c),k=we(A[1],-A[0],0);St(k,k,A);const M=xe(k);return M>0?Ie(k,k,1/M):Ae(k,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(a){if(this.edges.length===0)return;let c=0,f=Number.POSITIVE_INFINITY,p=0;const[x,b,A,k,M,$,V]=this._tmpVec2;Bo(V,a.x,a.y);const q=new Mn(V,null);for(let X=0;X<this.edges.length;X++){const Y=this.edges[X],se=this.edgeProps[X].dir;q.dir=se;const ce=this.vertices[Y.a].position,he=this.vertices[Y.b].position,be=q.intersectsPlane(ce,this.vertexProps[Y.a].dir,x),Ee=q.intersectsPlane(he,this.vertexProps[Y.b].dir,b);if(!be||!Ee)continue;$o(A,b,x),$o(k,V,x);const Oe=gl(A,A),Ue=Oe>0?gl(k,A)/Oe:0,Fe=ve(Ue,0,1),Ke=Math.abs((Ue-Fe)*this.edgeProps[X].len);$o(M,V,ce),Bo($,se[1],-se[0]);const Qe=Ke+Math.abs(gl(M,$));Qe<f&&(c=X,f=Qe,p=Fe)}return[c,p]}tessellate(a){const c=oe(),f=oe(),p=oe(),x=oe();for(let b=this.edges.length-1;b>=0;--b){const A=this.edges[b].a,k=this.edges[b].b,{position:M,height:$,extent:V}=this.vertices[A],{position:q,height:X,extent:Y}=this.vertices[k],se=this.vertexProps[A].dir,ce=this.vertexProps[k].dir;if(Ae(c,M[0]/a,M[1]/a,$),Ae(f,q[0]/a,q[1]/a,X),Ae(p,se[1],-se[0],0),Ie(p,p,V),Ae(x,ce[1],-ce[0],0),Ie(x,x,Y),this.distSqLines(we(c[0]+.5*p[0],c[1]+.5*p[1],c[2]+.5*p[2]),we(f[0]-.5*x[0],f[1]-.5*x[1],f[2]-.5*x[2]),we(c[0]-.5*p[0],c[1]-.5*p[1],c[2]-.5*p[2]),we(f[0]+.5*x[0],f[1]+.5*x[1],f[2]+.5*x[2]))<=.0025000000000000005)continue;const he=this.vertices.length,be=Ns(Si(),M,q);this.vertices.push({position:rs(be,be,.5),height:.5*($+X),extent:.5*(V+Y)});const Ee=Ns(Si(),se,ce);this.vertexProps.push({dir:so(Ee,Ee)}),this.edges.splice(b,1),this.edgeProps.splice(b,1),this.edges.push({a:A,b:he}),this.edges.push({a:he,b:k});const Oe=$o(Si(),this.vertices[he].position,M),Ue=Ni(Oe),Fe={vec:Oe,dir:rs(Si(),Oe,1/Ue),len:Ue};this.edgeProps.push(Fe),this.edgeProps.push(Fe)}}distSqLines(a,c,f,p){const x=me(oe(),c,a),b=me(oe(),p,f),A=me(oe(),a,f),k=ot(x,x),M=ot(x,b),$=ot(x,A),V=ot(b,b),q=ot(b,A),X=k*V-M*M;if(X===0)return Le(rt(x,f,p,ot(A,b)/ot(b,b)),a);const Y=(k*q-M*$)/X;return Le(rt(x,a,c,(M*q-$*V)/X),rt(b,f,p,Y))}}class Zr{static parseFrom(a,c){const f=Hr.parse(a);if(!f)return[];let{vertices:p,features:x}=f;const b=1/We(c);x.sort(($,V)=>$.id-V.id),p.sort(($,V)=>$.id-V.id||$.idx-V.idx),p=p.filter(($,V,q)=>V===q.findIndex(X=>X.id===$.id&&X.idx===$.idx));const A=new Array;let k=0;const M=p.length;for(const $ of x){if($.constantHeight){A.push(new ri($.id,$.bounds,$.constantHeight));continue}for(;k!==M&&p[k].id<$.id;)k++;if(k===M||p[k].id!==$.id)continue;const V=new Array,q=new Array,X=k;for(;k!==M&&p[k].id===$.id;){const Y=p[k];if(V.push({position:Y.position,height:Y.height,extent:Y.extent}),k!==X&&p[k-1].idx===Y.idx-1){const se=k-X;q.push({a:se-1,b:se})}k++}A.push(new ri($.id,$.bounds,void 0,V,q,b))}return A}static getElevationFeature(a,c){if(!c)return;const f=+a.properties[cr];return Number.isNaN(f)?void 0:c.find(p=>p.id===f)}}class zn{constructor(a,c){this.zScale=1,this.xOffset=0,this.yOffset=0,a.equals(c)||(this.zScale=Math.pow(2,c.z-a.z),this.xOffset=(a.x*this.zScale-c.x)*Jt,this.yOffset=(a.y*this.zScale-c.y)*Jt)}constantElevation(a,c){if(a.constantHeight!=null)return this.computeBiasedHeight(a.constantHeight,c)}pointElevation(a,c,f){const p=this.constantElevation(c,f);return p??(a.x=a.x*this.zScale+this.xOffset,a.y=a.y*this.zScale+this.yOffset,this.computeBiasedHeight(c.pointElevation(a),f))}computeBiasedHeight(a,c){return c<=0?a:a+c*Me(0,c,a>=0?a:Math.abs(.5*a))}}gr(ri,"ElevationFeature");class Xi{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.projection=a.projection,this.layoutVertexArray=new Ls,this.indexArray=new Gi,this.segments=new ta,this.programConfigurations=new Ic(a.layers,{zoom:a.zoom,lut:a.lut}),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Ku),this.worldview=a.worldview,this.hasAppearances=null}updateFootprints(a,c){}updateAppearances(a,c,f,p){}populate(a,c,f,p){const x=this.layers[0],b=[];let A=null;x.type==="circle"&&(A=x.layout.get("circle-sort-key"));for(const{feature:M,id:$,index:V,sourceLayerIndex:q}of a){const X=this.layers[0]._featureFilter.needGeometry,Y=gt(M,X);if(!this.layers[0]._featureFilter.filter(new Ri(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),Y,f))continue;const se=A?A.evaluate(Y,{},f):void 0,ce={id:$,properties:M.properties,type:M.type,sourceLayerIndex:q,index:V,geometry:X?Y.geometry:kt(M,f,p),patterns:{},sortKey:se};b.push(ce)}A&&b.sort((M,$)=>M.sortKey-$.sortKey);let k=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new k_,k=p.projection);for(const M of b){const{geometry:$,index:V,sourceLayerIndex:q}=M,X=a[V].feature;this.addFeature(M,$,V,c.availableImages,f,k,c.brightness,c.elevationFeatures),c.featureIndex.insert(X,$,V,q,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(a,c,f,p,x,b,A){this.programConfigurations.updatePaintArrays(a,c,x,f,p,b,A,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,tA.members),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=a.createVertexBuffer(this.globeExtVertexArray,bj.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=a.createVertexBuffer(this.elevatedLayoutVertexArray,xj.members))),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(a,c,f,p,x,b,A,k){let M;this.elevationMode!=="none"&&(M=Zr.getElevationFeature(a,k));for(const $ of c)for(const V of $){const q=V.x,X=V.y;if(q<0||q>=Jt||X<0||X>=Jt)continue;if(b){const ce=b.projectTilePoint(q,X,x),he=b.upVector(x,q,X);this.addGlobeExtVertex(ce,he),this.addGlobeExtVertex(ce,he),this.addGlobeExtVertex(ce,he),this.addGlobeExtVertex(ce,he)}const Y=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),se=Y.vertexLength;if(this.addCircleVertex(q,X,-1,-1),this.addCircleVertex(q,X,1,-1),this.addCircleVertex(q,X,1,1),this.addCircleVertex(q,X,-1,1),this.elevationMode!=="none"){const ce=M?M.pointElevation(new Mt(q,X)):0;this.hasElevation=this.hasElevation||ce!==0;for(let he=0;he<4;he++)this.elevatedLayoutVertexArray.emplaceBack(ce)}this.indexArray.emplaceBack(se,se+1,se+2),this.indexArray.emplaceBack(se,se+2,se+3),Y.vertexLength+=4,Y.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,{},p,x,A,void 0,this.worldview)}addCircleVertex(a,c,f,p){this.layoutVertexArray.emplaceBack(2*a+(f+1)/2,2*c+(p+1)/2)}addGlobeExtVertex(a,c){this.globeExtVertexArray.emplaceBack(a.x,a.y,a.z,c[0]*16384,c[1]*16384,c[2]*16384)}}function ba(u,a){for(let c=0;c<u.length;c++)if(mo(a,u[c]))return!0;for(let c=0;c<a.length;c++)if(mo(u,a[c]))return!0;return!!Ts(u,a)}function ra(u,a,c){return!!mo(u,a)||!!No(a,u,c)}function da(u,a){if(u.length===1)return lc(a,u[0]);for(let c=0;c<a.length;c++){const f=a[c];for(let p=0;p<f.length;p++)if(mo(u,f[p]))return!0}for(let c=0;c<u.length;c++)if(lc(a,u[c]))return!0;for(let c=0;c<a.length;c++)if(Ts(u,a[c]))return!0;return!1}function zs(u,a,c){if(u.length>1){if(Ts(u,a))return!0;for(let f=0;f<a.length;f++)if(No(a[f],u,c))return!0}for(let f=0;f<u.length;f++)if(No(u[f],a,c))return!0;return!1}function Ts(u,a){if(u.length===0||a.length===0)return!1;for(let c=0;c<u.length-1;c++){const f=u[c],p=u[c+1];for(let x=0;x<a.length-1;x++)if(jo(f,p,a[x],a[x+1]))return!0}return!1}function jo(u,a,c,f){return yn(u,c,f)!==yn(a,c,f)&&yn(u,a,c)!==yn(u,a,f)}function Wo(u,a,c){return(u.x-c.x)*(a.y-c.y)-(u.y-c.y)*(a.x-c.x)}function El(u,a,c,f){const p=Wo(u,a,f),x=Wo(u,a,c);if(Math.sign(p)===Math.sign(x))return;const b=Wo(c,f,u),A=b+x-p;return Math.sign(b)!==Math.sign(A)?[b/(b-A),x/(x-p)]:void 0}function No(u,a,c){const f=c*c;if(a.length===1)return u.distSqr(a[0])<f;for(let p=1;p<a.length;p++)if(Tl(u,a[p-1],a[p])<f)return!0;return!1}function Tl(u,a,c){const f=a.distSqr(c);if(f===0)return u.distSqr(a);const p=((u.x-a.x)*(c.x-a.x)+(u.y-a.y)*(c.y-a.y))/f;return u.distSqr(p<0?a:p>1?c:c.sub(a)._mult(p)._add(a))}function lc(u,a){let c,f,p,x=!1;for(let b=0;b<u.length;b++){c=u[b];for(let A=0,k=c.length-1;A<c.length;k=A++)f=c[A],p=c[k],f.y>a.y!=p.y>a.y&&a.x<(p.x-f.x)*(a.y-f.y)/(p.y-f.y)+f.x&&(x=!x)}return x}function mo(u,a){let c=!1;for(let f=0,p=u.length-1;f<u.length;p=f++){const x=u[f],b=u[p];x.y>a.y!=b.y>a.y&&a.x<(b.x-x.x)*(a.y-x.y)/(b.y-x.y)+x.x&&(c=!c)}return c}function oa(u,a,c,f,p){for(const b of u)if(a<=b.x&&c<=b.y&&f>=b.x&&p>=b.y)return!0;const x=[new Mt(a,c),new Mt(a,p),new Mt(f,p),new Mt(f,c)];if(u.length>2){for(const b of x)if(mo(u,b))return!0}for(let b=0;b<u.length-1;b++)if(wa(u[b],u[b+1],x))return!0;return!1}function wa(u,a,c){const f=c[0],p=c[2];if(u.x<f.x&&a.x<f.x||u.x>p.x&&a.x>p.x||u.y<f.y&&a.y<f.y||u.y>p.y&&a.y>p.y)return!1;const x=yn(u,a,c[0]);return x!==yn(u,a,c[1])||x!==yn(u,a,c[2])||x!==yn(u,a,c[3])}function Ei(u,a,c,f,p,x){let b=a.y-u.y,A=u.x-a.x;if(x=x||0){const k=b*b+A*A;if(k===0)return!0;const M=Math.sqrt(k);b/=M,A/=M}return!((c.x-u.x)*b+(c.y-u.y)*A-x<0||(f.x-u.x)*b+(f.y-u.y)*A-x<0||(p.x-u.x)*b+(p.y-u.y)*A-x<0)}function Aa(u,a,c,f,p,x,b){return!(Ei(u,a,f,p,x,b)||Ei(a,c,f,p,x,b)||Ei(c,u,f,p,x,b)||Ei(f,p,u,a,c,b)||Ei(p,x,u,a,c,b)||Ei(x,f,u,a,c,b))}function go(u,a,c){const f=a.paint.get(u).value;return f.kind==="constant"?f.value:c.programConfigurations.get(a.id).getMaxValue(u)}function sa(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function Al(u,a,c,f,p){if(!a[0]&&!a[1])return u;const x=Mt.convert(a)._mult(p);c==="viewport"&&x._rotate(-f);const b=[];for(let A=0;A<u.length;A++)b.push(u[A].sub(x));return b}function kp(u,a,c,f){const p=Mt.convert(u)._mult(f);return a==="viewport"&&p._rotate(-c),p}let Yu,Ip;function Rp(u,a,c){var f=2*Math.PI*6378137/256/Math.pow(2,c);return[u*f-2*Math.PI*6378137/2,a*f-2*Math.PI*6378137/2]}gr(Xi,"CircleBucket",{omit:["layers"]});class Pl{constructor(a,c,f){this.z=a,this.x=c,this.y=f,this.key=Cl(0,a,a,c,f)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}isChildOf(a){const c=this.z-a.z;return a.z===0||a.z<this.z&&a.x===this.x>>c&&a.y===this.y>>c}url(a,c){const f=function(x,b,A){var k=Rp(256*x,256*(b=Math.pow(2,A)-b-1),A),M=Rp(256*(x+1),256*(b+1),A);return k[0]+","+k[1]+","+M[0]+","+M[1]}(this.x,this.y,this.z),p=function(x,b,A){let k,M="";for(let $=x;$>0;$--)k=1<<$-1,M+=(b&k?1:0)+(A&k?2:0);return M}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",f)}toString(){return`${this.z}/${this.x}/${this.y}`}}class uu{constructor(a,c){this.wrap=a,this.canonical=c,this.key=Cl(a,c.z,c.z,c.x,c.y)}}class uo{constructor(a,c,f,p,x){this.overscaledZ=a,this.wrap=c,this.canonical=new Pl(f,+p,+x),this.key=c===0&&a===f?this.canonical.key:Cl(c,a,f,p,x)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){const c=this.canonical.z-a;return a>this.canonical.z?new uo(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new uo(a,this.wrap,a,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(a,c=!0){if(this.overscaledZ===a&&c)return this.key;if(a>this.canonical.z)return Cl(this.wrap*+c,a,this.canonical.z,this.canonical.x,this.canonical.y);{const f=this.canonical.z-a;return Cl(this.wrap*+c,a,a,this.canonical.x>>f,this.canonical.y>>f)}}isChildOf(a){if(a.wrap!==this.wrap)return!1;const c=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.z<this.canonical.z&&a.canonical.x===this.canonical.x>>c&&a.canonical.y===this.canonical.y>>c}children(a){if(this.overscaledZ>=a)return[new uo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,f=2*this.canonical.x,p=2*this.canonical.y;return[new uo(c,this.wrap,c,f,p),new uo(c,this.wrap,c,f+1,p),new uo(c,this.wrap,c,f,p+1),new uo(c,this.wrap,c,f+1,p+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new uo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new uo(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new uu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Cl(u,a,c,f,p){const x=1<<Math.min(c,22);let b=x*(p%x)+f%x;return u&&c<22&&(b+=x*x*((u<0?-2*u-1:2*u)%(1<<2*(22-c)))),16*(32*b+c)+(a-c)}const rf=[u=>{let a=u.canonical.x-1,c=u.wrap;return a<0&&(a=(1<<u.canonical.z)-1,c--),new uo(u.overscaledZ,c,u.canonical.z,a,u.canonical.y)},u=>{let a=u.canonical.x+1,c=u.wrap;return a===1<<u.canonical.z&&(a=0,c++),new uo(u.overscaledZ,c,u.canonical.z,a,u.canonical.y)},u=>new uo(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,(u.canonical.y===0?1<<u.canonical.z:u.canonical.y)-1),u=>new uo(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y===(1<<u.canonical.z)-1?0:u.canonical.y+1)];gr(Pl,"CanonicalTileID"),gr(uo,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const aA=Tn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:U_}=aA,eue=Tn([{name:"a_pos_3",components:3,type:"Int16"}]);var c$=Tn([{name:"a_pos",type:"Int16",components:2}]);function oA(u){return u*Fs/G}const tue=[new gn([P,P,P],[O,O,O]),new gn([P,P,P],[0,0,O]),new gn([0,P,P],[O,0,O]),new gn([P,0,P],[0,O,O]),new gn([0,0,P],[O,O,O])];function u$(u,a,c,f=!0){const p=Ie([],u._camera.position,u.worldSize),x=[a,c,1,1];er(x,x,u.pixelMatrixInverse),dt(x,x,1/x[3]);const b=je([],Rt([],x,p)),A=u.globeMatrix,k=[A[12],A[13],A[14]],M=Rt([],k,p),$=xe(M),V=je([],M),q=u.worldSize/(2*Math.PI),X=ot(V,b),Y=Math.asin(q/$);if(Y<Math.acos(X)){if(!f)return null;const Et=[],ft=[];Ie(Et,b,$/X),je(ft,Rt(ft,Et,M)),je(b,Ce(b,M,Ie(b,ft,Math.tan(Y)*$)))}const se=[];new sn(p,b).closestPointOnSphere(k,q,se);const ce=je([],xa(A,0)),he=je([],xa(A,1)),be=je([],xa(A,2)),Ee=ot(ce,se),Oe=ot(he,se),Ue=ot(be,se),Fe=is(Math.asin(-Oe/q));let Ke=is(Math.atan2(Ee,Ue));Ke=u.center.lng+function(Et,ft){const Tt=(ft-Et+180)%360-180;return Tt<-180?Tt+360:Tt}(u.center.lng,Ke);const Qe=_e(Ke),nt=ve(ge(Fe),0,1);return new lt(Qe,nt)}class rue{constructor(a,c,f){this.a=Rt([],a,f),this.b=Rt([],c,f),this.center=f;const p=je([],this.a),x=je([],this.b);this.angle=Math.acos(ot(p,x))}}function kj(u,a){if(u.angle===0)return null;let c;return c=u.a[a]===0?1/u.angle*.5*Math.PI:1/u.angle*Math.atan(u.b[a]/u.a[a]/Math.sin(u.angle)-1/Math.tan(u.angle)),c<0||c>1?null:function(f,p,x,b){const A=Math.sin(x);return f*(Math.sin((1-b)*x)/A)+p*(Math.sin(b*x)/A)}(u.a[a],u.b[a],u.angle,ve(c,0,1))+u.center[a]}function Xd(u){if(u.z<=1)return tue[u.z+2*u.y+u.x];const a=Ij(sA(u));return gn.fromPoints(a)}function nf(u,a,c){return Ie(u,u,1-c),tt(u,u,a,c)}function d$(u,a,c){for(const f of u)Ut(f,f,a),Ie(f,f,c)}function h$(u,a,c,f){const p=a/u.worldSize,x=u.globeMatrix;if(c.z<=1){const nt=Xd(c).getCorners();return d$(nt,x,p),gn.fromPoints(nt)}const b=sA(c,f),A=Ij(b,Fs+oA(u._tileCoverLift));d$(A,x,p);const k=Number.MAX_VALUE,M=[-k,-k,-k],$=[k,k,k];if(b.contains(u.center)){for(const ft of A)ye($,$,ft),pe(M,M,ft);M[2]=0;const nt=u.point,Et=[nt.x*p,nt.y*p,0];return ye($,$,Et),pe(M,M,Et),new gn($,M)}if(u._tileCoverLift>0){for(const nt of A)ye($,$,nt),pe(M,M,nt);return new gn($,M)}const V=[x[12]*p,x[13]*p,x[14]*p],q=b.getCenter(),X=ve(u.center.lat,-Re,Re),Y=ve(q.lat,-Re,Re),se=_e(u.center.lng),ce=ge(X);let he=se-_e(q.lng);const be=ce-ge(Y);he>.5?he-=1:he<-.5&&(he+=1);let Ee=0;Math.abs(he)>Math.abs(be)?Ee=he>=0?1:3:(Ee=be>=0?0:2,tt(V,V,[x[4]*p,x[5]*p,x[6]*p],-Math.sin(bn(be>=0?b.getSouth():b.getNorth()))*Fs));const Oe=A[Ee],Ue=A[(Ee+1)%4],Fe=new rue(Oe,Ue,V),Ke=[kj(Fe,0)||Oe[0],kj(Fe,1)||Oe[1],kj(Fe,2)||Oe[2]],Qe=jp(u.zoom);if(Qe>0){const nt=function({x:ft,y:Tt,z:It},Dt,Xt,Vt,jt){const $t=1/(1<<It);let xt=ft*$t,vt=xt+$t,zt=Tt*$t,Ht=zt+$t,Nt=0;const pr=(xt+vt)/2-Vt;return pr>.5?Nt=-1:pr<-.5&&(Nt=1),xt=((xt+Nt)*Dt-(Vt*=Dt))*Xt+Vt,vt=((vt+Nt)*Dt-Vt)*Xt+Vt,zt=(zt*Dt-(jt*=Dt))*Xt+jt,Ht=(Ht*Dt-jt)*Xt+jt,[[xt,Ht,0],[vt,Ht,0],[vt,zt,0],[xt,zt,0]]}(c,a,u._pixelsPerMercatorPixel,se,ce);for(let ft=0;ft<A.length;ft++)nf(A[ft],nt[ft],Qe);const Et=Ce([],nt[Ee],nt[(Ee+1)%4]);Ie(Et,Et,.5),nf(Ke,Et,Qe)}for(const nt of A)ye($,$,nt),pe(M,M,nt);return $[2]=Math.min(Oe[2],Ue[2]),ye($,$,Ke),pe(M,M,Ke),new gn($,M)}function sA({x:u,y:a,z:c},f=!1){const p=1/(1<<c),x=new Q(ke(u*p),a===(1<<c)-1&&f?-90:Te((a+1)*p)),b=new Q(ke((u+1)*p),a===0&&f?90:Te(a*p));return new K(x,b)}function Ij(u,a=Fs){const c=bn(u.getNorth()),f=bn(u.getSouth()),p=Math.cos(c),x=Math.cos(f),b=Math.sin(c),A=Math.sin(f),k=u.getWest(),M=u.getEast();return[L(x,A,k,a),L(x,A,M,a),L(p,b,M,a),L(p,b,k,a)]}function d1(u,a,c,f){const p=1<<c.z,x=(u/Jt+c.x)/p;return z(Te((a/Jt+c.y)/p),ke(x),f)}function lA({min:u,max:a}){return h/Math.max(a[0]-u[0],a[1]-u[1],a[2]-u[2])}const f$=new Float64Array(16);function cA(u){const a=lA(u),c=te(f$,[a,a,a]);return F(c,c,Ge([],u.min))}function Rj(u){const a=(f=u.min,(c=f$)[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=f[0],c[13]=f[1],c[14]=f[2],c[15]=1,c);var c,f;const p=1/lA(u);return B(a,a,[p,p,p])}function jj(u){const a=Jt/(2*Math.PI);return u/(2*Math.PI)/a}function p$(u,a){return Jt/(512*Math.pow(2,u))*lA(Xd(a))}function m$(u,a,c,f,p){const x=jj(c),b=[u,a,-c/(2*Math.PI)],A=j(new Float64Array(16));return F(A,A,b),B(A,A,[x,x,x]),U(A,A,bn(-p)),Z(A,A,bn(-f)),A}function jp(u){return Me(y,s,u)}function g$(u,a){const c=z(a.lat,a.lng),f=function(Y){const se=z(Y._center.lat,Y._center.lng);let ce=St([],we(0,1,0),se);const he=ae([],-Y.angle,se);ce=Ut(ce,ce,he),ae(he,-Y._pitch,ce);const be=je([],se);return Ie(be,be,oA(Y.cameraToCenterDistance/Y.pixelsPerMeter)),Ut(be,be,he),Ce([],se,be)}(u);return b=(p=me([],f,c))[0],A=p[1],k=p[2],M=(x=c)[0],$=x[1],V=x[2],X=(q=Math.sqrt((b*b+A*A+k*k)*(M*M+$*$+V*V)))&&ot(p,x)/q,Math.acos(Math.min(Math.max(X,-1),1));var p,x,b,A,k,M,$,V,q,X}function Nj(u,a){return g$(u,a)>Math.PI/2*1.01}const y$=bn(85),nue=Math.cos(y$),iue=Math.sin(y$),aue=N(),v$=u=>{const a=[];return u.paint.get("circle-pitch-alignment")==="map"&&a.push("PITCH_WITH_MAP"),u.paint.get("circle-pitch-scale")==="map"&&a.push("SCALE_WITH_MAP"),a};function _$(u,a,c,f,p,x,b,A,k){if(x&&u.queryGeometry.isAboveHorizon)return!1;x&&(k*=u.pixelToTileUnitsFactor);const M=u.tileID.canonical,$=c.projection.upVectorScale(M,c.center.lat,c.worldSize).metersToTile;for(const V of a)for(const q of V){const X=q.add(A),Y=p&&c.elevation?c.elevation.exaggeration()*p.getElevationAt(X.x,X.y,!0):0,se=c.projection.projectTilePoint(X.x,X.y,M);if(Y>0){const Ee=c.projection.upVector(M,X.x,X.y);se.x+=Ee[0]*$*Y,se.y+=Ee[1]*$*Y,se.z+=Ee[2]*$*Y}const ce=x?X:oue(se.x,se.y,se.z,f),he=x?u.tilespaceRays.map(Ee=>lue(Ee,Y)):u.queryGeometry.screenGeometry,be=er([],[se.x,se.y,se.z,1],f);if(!b&&x?k*=be[3]/c.cameraToCenterDistance:b&&!x&&(k*=c.cameraToCenterDistance/be[3]),x){const Ee=Te((q.y/Jt+M.y)/(1<<M.z));k/=c.projection.pixelsPerMeter(Ee,1)/Se(1,Ee)}if(ra(he,ce,k))return!0}return!1}function oue(u,a,c,f){const p=er([],[u,a,c,1],f);return new Mt(p[0]/p[3],p[1]/p[3])}const x$=we(0,0,0),sue=we(0,0,1);function lue(u,a){const c=oe();return x$[2]=a,u.intersectsPlane(x$,sue,c),new Mt(c[0],c[1])}class b$ extends Xi{}let w$,S$,E$,T$;function A$(u,{width:a,height:c},f,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==a*c*f)throw new RangeError("mismatched image size")}else p=new Uint8Array(a*c*f);return u.width=a,u.height=c,u.data=p,u}function P$(u,a,c){const{width:f,height:p}=a;f===u.width&&p===u.height||(Mj(u,a,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,f),height:Math.min(u.height,p)},c,null),u.width=f,u.height=p,u.data=a.data)}function Mj(u,a,c,f,p,x,b,A){if(p.width===0||p.height===0)return a;if(p.width>u.width||p.height>u.height||c.x>u.width-p.width||c.y>u.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>a.width||p.height>a.height||f.x>a.width-p.width||f.y>a.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const k=u.data,M=a.data,$=x===4&&A;for(let V=0;V<p.height;V++){const q=((c.y+V)*u.width+c.x)*x,X=((f.y+V)*a.width+f.x)*x;if($)for(let Y=0;Y<p.width;Y++){const se=q+Y*x+3,ce=X+Y*x;M[ce+0]=255,M[ce+1]=255,M[ce+2]=255,M[ce+3]=k[se]}else if(b)for(let Y=0;Y<p.width;Y++){const se=q+Y*x,ce=X+Y*x,he=new ni(k[se+0]/255,k[se+1]/255,k[se+2]/255,k[se+3]).toNonPremultipliedRenderColor(b).toArray();M[ce+0]=he[0],M[ce+1]=he[1],M[ce+2]=he[2],M[ce+3]=he[3]}else for(let Y=0;Y<p.width*x;Y++)M[X+Y]=k[q+Y]}return a}gr(b$,"HeatmapBucket",{omit:["layers"]});class Np{constructor(a,c){A$(this,a,1,c)}resize(a){P$(this,new Np(a),1)}clone(){return new Np({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,c,f,p,x){Mj(a,c,f,p,x,1,null)}}class Go{constructor(a,c){A$(this,a,4,c)}resize(a){P$(this,new Go(a),4)}replace(a,c){c?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new Go({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,c,f,p,x,b,A){Mj(a,c,f,p,x,4,b,A)}}class C${constructor(a,c){this.width=a.width,this.height=a.height,this.data=c instanceof Uint8Array?new Float32Array(c.buffer):c}}function h1(u){const a={},c=u.resolution||256,f=u.clips?u.clips.length:1,p=u.image||new Go({width:c,height:f}),x=(b,A,k)=>{a[u.evaluationKey]=k;const M=u.expression.evaluate(a),$=M?M.toNonPremultipliedRenderColor(null):null;$&&(p.data[b+A+0]=Math.floor(255*$.r),p.data[b+A+1]=Math.floor(255*$.g),p.data[b+A+2]=Math.floor(255*$.b),p.data[b+A+3]=Math.floor(255*$.a))};if(u.clips)for(let b=0,A=0;b<f;++b,A+=4*c)for(let k=0,M=0;k<c;k++,M+=4){const $=k/(c-1),{start:V,end:q}=u.clips[b];x(A,M,V*(1-$)+q*$)}else for(let b=0,A=0;b<c;b++,A+=4)x(0,A,b/(c-1));return p}gr(Np,"AlphaImage"),gr(Go,"RGBAImage");const cue=Tn([{name:"a_pos",components:2,type:"Int16"}],4),uue=Tn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),due=Tn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),hue=Tn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function V_(u,a,c=2){const f=a&&a.length,p=f?a[0]*c:u.length;let x=O$(u,0,p,c,!0);const b=[];if(!x||x.next===x.prev)return b;let A,k,M;if(f&&(x=function($,V,q,X){const Y=[];for(let se=0,ce=V.length;se<ce;se++){const he=O$($,V[se]*X,se<ce-1?V[se+1]*X:$.length,X,!1);he===he.next&&(he.steiner=!0),Y.push(xue(he))}Y.sort(yue);for(let se=0;se<Y.length;se++)q=vue(Y[se],q);return q}(u,a,x,c)),u.length>80*c){A=u[0],k=u[1];let $=A,V=k;for(let q=c;q<p;q+=c){const X=u[q],Y=u[q+1];X<A&&(A=X),Y<k&&(k=Y),X>$&&($=X),Y>V&&(V=Y)}M=Math.max($-A,V-k),M=M!==0?32767/M:0}return f1(x,b,c,A,k,M,0),b}function O$(u,a,c,f,p){let x;if(p===function(b,A,k,M){let $=0;for(let V=A,q=k-M;V<k;V+=M)$+=(b[q]-b[V])*(b[V+1]+b[q+1]),q=V;return $}(u,a,c,f)>0)for(let b=a;b<c;b+=f)x=j$(b/f|0,u[b],u[b+1],x);else for(let b=c-f;b>=a;b-=f)x=j$(b/f|0,u[b],u[b+1],x);return x&&q_(x,x.next)&&(g1(x),x=x.next),x}function iy(u,a){if(!u)return u;a||(a=u);let c,f=u;do if(c=!1,f.steiner||!q_(f,f.next)&&yo(f.prev,f,f.next)!==0)f=f.next;else{if(g1(f),f=a=f.prev,f===f.next)break;c=!0}while(c||f!==a);return a}function f1(u,a,c,f,p,x,b){if(!u)return;!b&&x&&function(k,M,$,V){let q=k;do q.z===0&&(q.z=Dj(q.x,q.y,M,$,V)),q.prevZ=q.prev,q.nextZ=q.next,q=q.next;while(q!==k);q.prevZ.nextZ=null,q.prevZ=null,function(X){let Y,se=1;do{let ce,he=X;X=null;let be=null;for(Y=0;he;){Y++;let Ee=he,Oe=0;for(let Fe=0;Fe<se&&(Oe++,Ee=Ee.nextZ,Ee);Fe++);let Ue=se;for(;Oe>0||Ue>0&&Ee;)Oe!==0&&(Ue===0||!Ee||he.z<=Ee.z)?(ce=he,he=he.nextZ,Oe--):(ce=Ee,Ee=Ee.nextZ,Ue--),be?be.nextZ=ce:X=ce,ce.prevZ=be,be=ce;he=Ee}be.nextZ=null,se*=2}while(Y>1)}(q)}(u,f,p,x);let A=u;for(;u.prev!==u.next;){const k=u.prev,M=u.next;if(x?pue(u,f,p,x):fue(u))a.push(k.i,u.i,M.i),g1(u),u=M.next,A=M.next;else if((u=M)===A){b?b===1?f1(u=mue(iy(u),a),a,c,f,p,x,2):b===2&&gue(u,a,c,f,p,x):f1(iy(u),a,c,f,p,x,1);break}}}function fue(u){const a=u.prev,c=u,f=u.next;if(yo(a,c,f)>=0)return!1;const p=a.x,x=c.x,b=f.x,A=a.y,k=c.y,M=f.y,$=Math.min(p,x,b),V=Math.min(A,k,M),q=Math.max(p,x,b),X=Math.max(A,k,M);let Y=f.next;for(;Y!==a;){if(Y.x>=$&&Y.x<=q&&Y.y>=V&&Y.y<=X&&p1(p,A,x,k,b,M,Y.x,Y.y)&&yo(Y.prev,Y,Y.next)>=0)return!1;Y=Y.next}return!0}function pue(u,a,c,f){const p=u.prev,x=u,b=u.next;if(yo(p,x,b)>=0)return!1;const A=p.x,k=x.x,M=b.x,$=p.y,V=x.y,q=b.y,X=Math.min(A,k,M),Y=Math.min($,V,q),se=Math.max(A,k,M),ce=Math.max($,V,q),he=Dj(X,Y,a,c,f),be=Dj(se,ce,a,c,f);let Ee=u.prevZ,Oe=u.nextZ;for(;Ee&&Ee.z>=he&&Oe&&Oe.z<=be;){if(Ee.x>=X&&Ee.x<=se&&Ee.y>=Y&&Ee.y<=ce&&Ee!==p&&Ee!==b&&p1(A,$,k,V,M,q,Ee.x,Ee.y)&&yo(Ee.prev,Ee,Ee.next)>=0||(Ee=Ee.prevZ,Oe.x>=X&&Oe.x<=se&&Oe.y>=Y&&Oe.y<=ce&&Oe!==p&&Oe!==b&&p1(A,$,k,V,M,q,Oe.x,Oe.y)&&yo(Oe.prev,Oe,Oe.next)>=0))return!1;Oe=Oe.nextZ}for(;Ee&&Ee.z>=he;){if(Ee.x>=X&&Ee.x<=se&&Ee.y>=Y&&Ee.y<=ce&&Ee!==p&&Ee!==b&&p1(A,$,k,V,M,q,Ee.x,Ee.y)&&yo(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.prevZ}for(;Oe&&Oe.z<=be;){if(Oe.x>=X&&Oe.x<=se&&Oe.y>=Y&&Oe.y<=ce&&Oe!==p&&Oe!==b&&p1(A,$,k,V,M,q,Oe.x,Oe.y)&&yo(Oe.prev,Oe,Oe.next)>=0)return!1;Oe=Oe.nextZ}return!0}function mue(u,a){let c=u;do{const f=c.prev,p=c.next.next;!q_(f,p)&&I$(f,c,c.next,p)&&m1(f,p)&&m1(p,f)&&(a.push(f.i,c.i,p.i),g1(c),g1(c.next),c=u=p),c=c.next}while(c!==u);return iy(c)}function gue(u,a,c,f,p,x){let b=u;do{let A=b.next.next;for(;A!==b.prev;){if(b.i!==A.i&&bue(b,A)){let k=R$(b,A);return b=iy(b,b.next),k=iy(k,k.next),f1(b,a,c,f,p,x,0),void f1(k,a,c,f,p,x,0)}A=A.next}b=b.next}while(b!==u)}function yue(u,a){let c=u.x-a.x;return c===0&&(c=u.y-a.y,c===0)&&(c=(u.next.y-u.y)/(u.next.x-u.x)-(a.next.y-a.y)/(a.next.x-a.x)),c}function vue(u,a){const c=function(p,x){let b=x;const A=p.x,k=p.y;let M,$=-1/0;if(q_(p,b))return b;do{if(q_(p,b.next))return b.next;if(k<=b.y&&k>=b.next.y&&b.next.y!==b.y){const se=b.x+(k-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(se<=A&&se>$&&($=se,M=b.x<b.next.x?b:b.next,se===A))return M}b=b.next}while(b!==x);if(!M)return null;const V=M,q=M.x,X=M.y;let Y=1/0;b=M;do{if(A>=b.x&&b.x>=q&&A!==b.x&&k$(k<X?A:$,k,q,X,k<X?$:A,k,b.x,b.y)){const se=Math.abs(k-b.y)/(A-b.x);m1(b,p)&&(se<Y||se===Y&&(b.x>M.x||b.x===M.x&&_ue(M,b)))&&(M=b,Y=se)}b=b.next}while(b!==V);return M}(u,a);if(!c)return a;const f=R$(c,u);return iy(f,f.next),iy(c,c.next)}function _ue(u,a){return yo(u.prev,u,a.prev)<0&&yo(a.next,u,u.next)<0}function Dj(u,a,c,f,p){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-c)*p|0)|u<<8))|u<<4))|u<<2))|u<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-f)*p|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function xue(u){let a=u,c=u;do(a.x<c.x||a.x===c.x&&a.y<c.y)&&(c=a),a=a.next;while(a!==u);return c}function k$(u,a,c,f,p,x,b,A){return(p-b)*(a-A)>=(u-b)*(x-A)&&(u-b)*(f-A)>=(c-b)*(a-A)&&(c-b)*(x-A)>=(p-b)*(f-A)}function p1(u,a,c,f,p,x,b,A){return!(u===b&&a===A)&&k$(u,a,c,f,p,x,b,A)}function bue(u,a){return u.next.i!==a.i&&u.prev.i!==a.i&&!function(c,f){let p=c;do{if(p.i!==c.i&&p.next.i!==c.i&&p.i!==f.i&&p.next.i!==f.i&&I$(p,p.next,c,f))return!0;p=p.next}while(p!==c);return!1}(u,a)&&(m1(u,a)&&m1(a,u)&&function(c,f){let p=c,x=!1;const b=(c.x+f.x)/2,A=(c.y+f.y)/2;do p.y>A!=p.next.y>A&&p.next.y!==p.y&&b<(p.next.x-p.x)*(A-p.y)/(p.next.y-p.y)+p.x&&(x=!x),p=p.next;while(p!==c);return x}(u,a)&&(yo(u.prev,u,a.prev)||yo(u,a.prev,a))||q_(u,a)&&yo(u.prev,u,u.next)>0&&yo(a.prev,a,a.next)>0)}function yo(u,a,c){return(a.y-u.y)*(c.x-a.x)-(a.x-u.x)*(c.y-a.y)}function q_(u,a){return u.x===a.x&&u.y===a.y}function I$(u,a,c,f){const p=dA(yo(u,a,c)),x=dA(yo(u,a,f)),b=dA(yo(c,f,u)),A=dA(yo(c,f,a));return p!==x&&b!==A||!(p!==0||!uA(u,c,a))||!(x!==0||!uA(u,f,a))||!(b!==0||!uA(c,u,f))||!(A!==0||!uA(c,a,f))}function uA(u,a,c){return a.x<=Math.max(u.x,c.x)&&a.x>=Math.min(u.x,c.x)&&a.y<=Math.max(u.y,c.y)&&a.y>=Math.min(u.y,c.y)}function dA(u){return u>0?1:u<0?-1:0}function m1(u,a){return yo(u.prev,u,u.next)<0?yo(u,a,u.next)>=0&&yo(u,u.prev,a)>=0:yo(u,a,u.prev)<0||yo(u,u.next,a)<0}function R$(u,a){const c=Lj(u.i,u.x,u.y),f=Lj(a.i,a.x,a.y),p=u.next,x=a.prev;return u.next=a,a.prev=u,c.next=p,p.prev=c,f.next=c,c.prev=f,x.next=f,f.prev=x,f}function j$(u,a,c,f){const p=Lj(u,a,c);return f?(p.next=f.next,p.prev=f,f.next.prev=p,f.next=p):(p.prev=p,p.next=p),p}function g1(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function Lj(u,a,c){return{i:u,x:a,y:c,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function y1(u,a){const c=u.length;if(c<=1)return[u];const f=[];let p,x;for(let b=0;b<c;b++){const A=En(u[b]);A!==0&&(u[b].area=Math.abs(A),x===void 0&&(x=A<0),x===A<0?(p&&f.push(p),p=[u[b]]):p.push(u[b]))}if(p&&f.push(p),a>1)for(let b=0;b<f.length;b++)f[b].length<=a||(qu(f[b],a,1,f[b].length-1,wue),f[b]=f[b].slice(0,a));return f}function wue(u,a){return a.area-u.area}function N$(u,a,c=1){if(!u)return null;const f=typeof u=="string"?Ds.from(u).getPrimary():u.getPrimary(),p=typeof u=="string"?null:u.getSecondary();for(const x of[f,p]){if(!x)continue;const b=x.id.toString();a.has(b)||a.set(b,[]),x.scaleSelf(c),a.get(b).push(x)}return{primary:f.toString(),secondary:p?p.toString():null}}function Fj(u,a,c,f){const p=f.patternDependencies;let x=!1;for(const b of a){const A=b.paint.get(`${u}-pattern`);A.isConstant()||(x=!0),N$(A.constantOr(null),p,c)&&(x=!0)}return x}function zj(u,a,c,f,p,x){const b=x.patternDependencies;for(const A of a){const k=A.paint.get(`${u}-pattern`).value;if(k.kind!=="constant"){let M=k.evaluate({zoom:f},c,{},x.availableImages);M=M&&M.name?M.name:M;const $=N$(M,b,p);if(!$)continue;const{primary:V,secondary:q}=$;V&&(c.patterns[A.id]=[V,q].filter(Boolean))}}return c}class M${constructor(){this.polygons=new Map}add(a,...c){const f=this.polygons.get(a);f?f.push(...c):this.polygons.set(a,c)}merge(a){for(const[c,f]of a.polygons)this.add(c,...f)}}class af{constructor(){this.portals=[]}static isOnBorder(a,c){return a<=0&&c<=0||a>=Jt&&c>=Jt}static evaluate(a){if(a.length===0)return new af;let c=[];for(const k of a)c.push(...k.portals);if(c.length===0)return new af;for(const k of c){const M=k.va,$=k.vb;(af.isOnBorder(M.x,$.x)||af.isOnBorder(M.y,$.y))&&(k.type="border")}const f=c.filter(k=>k.type!=="unevaluated"),p=c.filter(k=>k.type==="unevaluated");if(p.length===0)return new af;p.sort((k,M)=>k.hash===M.hash?k.isTunnel===M.isTunnel?0:k.isTunnel?-1:1:k.hash<M.hash?1:-1),c=f.concat(p);let x=f.length,b=x,A=x;do if(b++,b===c.length||c[x].hash!==c[b].hash){if(b-x==2){A<x&&(c[A]=c[x],c[x]=null);const k=c[A],M=c[b-1];k.type=k.isTunnel!==M.isTunnel?"tunnel":"polygon",k.connection={a:k.connection.a,b:M.connection.a},A++}x=b}while(x!==c.length);return c.splice(A),c.sort((k,M)=>k.hash<M.hash?1:-1),{portals:c}}}gr(af,"ElevationPortalGraph"),gr(M$,"ElevationPolygons");class Sue{constructor(a,c,f){this.outPositions=a,this.outNormals=c,this.outIndices=f,this.vertexLookup=new Map}addVertex(a,c,f){let p=a[2];f!=null&&(p*=f);const x=`${a[0]},${a[1]},${a[2]},${c[0]},${c[1]},${c[2]}`,b=this.vertexLookup.get(x);if(b!=null)return b;const A=this.outPositions.length;this.vertexLookup.set(x,A);const k=Math.trunc(16384*c[0]),M=Math.trunc(16384*c[1]),$=Math.trunc(16384*c[2]);return this.outPositions.emplaceBack(a[0],a[1],p),this.outNormals.emplaceBack(k,M,$),A}addTriangle(a,c,f){this.outIndices.emplaceBack(a,c,f)}addTriangles(a,c,f){if(a.length===0)return;const p=f.length===1,x=oe(),b=oe();for(let A=0;A<a.length;A+=3){const k=c[a[A+0]],M=c[a[A+1]],$=c[a[A+2]],V=p?f[0]:f[a[A+1]],q=p?f[0]:f[a[A+2]];Ae(x,k.x,k.y,p?f[0]:f[a[A+0]]);const X=this.addVertex(x,b);Ae(x,M.x,M.y,V);const Y=this.addVertex(x,b);Ae(x,$.x,$.y,q);const se=this.addVertex(x,b);this.outIndices.emplaceBack(X,Y,se)}}addQuad(a,c,f,p,x,b){const A=this.addVertex(a,x,b),k=this.addVertex(c,x,b),M=this.addVertex(f,x,b),$=this.addVertex(p,x,b);this.addTriangle(A,k,M),this.addTriangle(M,$,A)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Ol{constructor(a,c,f,p){this.unevaluatedPortals=new af,this.portalPolygons=new M$,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Hw,this.vertexNormals=new Kw,this.indexArray=new Gi,this.tileToMeters=We(a),this.bridgeProgramConfigurations=new Ic(c,{zoom:f,lut:p},x=>x!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Ic(c,{zoom:f,lut:p},x=>x!=="fill-bridge-guard-rail-color")}addVertices(a,c){const f=this.unevalVertices.length;for(let p=0;p<a.length;p++)this.unevalVertices.push(a[p]),this.unevalHeights.push(c[p]);return f}addTriangles(a,c,f){const p=f?this.unevalTunnelTriangles:this.unevalTriangles;for(const x of a)p.push(x+c)}addRenderableRing(a,c,f,p,x,b){const A=[new Mt(x.min.x,x.min.y),new Mt(x.max.x,x.min.y),new Mt(x.max.x,x.max.y),new Mt(x.min.x,x.max.y)];for(let k=0;k<f-1;k++){const M=c+k,$=M+1,V=this.unevalVertices[M],q=this.unevalVertices[$];if(!(V.x>=x.min.x&&V.x<=x.max.x&&V.y>=x.min.y&&V.y<=x.max.y||q.x>=x.min.x&&q.x<=x.max.x&&q.y>=x.min.y&&q.y<=x.max.y||wa(V,q,A))||this.isOnBorder(V.x,q.x)||this.isOnBorder(V.y,q.y))continue;const X=Ol.computeEdgeHash(this.unevalVertices[M],this.unevalVertices[$]);let Y,se=this.vertexHashLookup.get(Ol.computePosHash(V));se!=null?Y=se.next:(se=this.vertexHashLookup.get(Ol.computePosHash(q)),Y=se!=null?se.prev:X),this.unevalEdges.push({polygonIdx:a,a:M,b:$,hash:X,portalHash:Y,isTunnel:p,type:"unevaluated",featureInfo:b})}}addPortalCandidates(a,c,f,p,x){if(c.length===0)return;this.portalPolygons.add(a,{geometry:c,zLevel:x});const b=c[0];this.vertexHashLookup.clear();let A=Ol.computeEdgeHash(b[b.length-2],b[b.length-1]);for(let k=0;k<b.length-1;k++){const M=b[k+0],$=b[k+1],V=bs($.x-M.x,$.y-M.y),q=Ni(V);if(q===0)continue;let X="unevaluated";const Y=p.pointElevation(M),se=p.pointElevation($);Math.abs(Y)<.01&&Math.abs(se)<.01?X="entrance":(this.isOnBorder(M.x,$.x)||this.isOnBorder(M.y,$.y))&&(X="border");const ce=Ol.computeEdgeHash(M,$);this.unevaluatedPortals.portals.push({connection:{a,b:void 0},va:M,vb:$,vab:V,length:q,hash:ce,isTunnel:f,type:X});const he=Ol.computePosHash(M);this.vertexHashLookup.set(he,{prev:A,next:ce}),A=ce}}construct(a){if(this.unevalVertices.length===0)return;const c=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),f=q=>{q.primitiveLength=this.indexArray.length-q.primitiveOffset},p=new Sue(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(a.portals,this.unevalEdges);const x=c(),b=c(),A=c(),k=(q,X)=>{q.sort((se,ce)=>se.type===X&&ce.type!==X?-1:se.type!==X&&ce.type===X?1:0);const Y=q.findIndex(se=>se.type!==X);return Y>=0?Y:q.length};let M=0;this.unevalEdges.length>0&&(M=k(this.unevalEdges,"none"),this.constructBridgeStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:M},this.tileToMeters)),f(A);const $=c(),V=c();if(this.unevalEdges.length>0){const q=this.unevalEdges.splice(M),X=k(q,"tunnel")+M;this.unevalEdges.push(...q),this.constructTunnelStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:M},{min:M,max:X})}f($),p.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),f(V),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),f(b),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),f(x),this.maskSegments=ta.simpleSegment(0,V.primitiveOffset,0,V.primitiveLength),this.depthSegments=ta.simpleSegment(0,b.primitiveOffset,0,b.primitiveLength),this.renderableBridgeSegments=ta.simpleSegment(0,A.primitiveOffset,0,A.primitiveLength),this.renderableTunnelSegments=ta.simpleSegment(0,$.primitiveOffset,0,$.primitiveLength),this.shadowCasterSegments=ta.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength)}update(a,c,f,p,x,b,A,k){this.bridgeProgramConfigurations.updatePaintArrays(a,c,x,f,p,b,A,k),this.tunnelProgramConfigurations.updatePaintArrays(a,c,x,f,p,b,A,k)}upload(a){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=a.createVertexBuffer(this.vertexPositions,due.members),this.vertexBufferNormal=a.createVertexBuffer(this.vertexNormals,hue.members),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(a),this.tunnelProgramConfigurations.upload(a))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(a,c,f,p,x){const b=(A,k)=>{for(let M=0;M<k.length-1;M++){const $=k[M].featureIndex,V=k[M+1].vertexStart,q=a.feature($);A.populatePaintArrays(V,q,$,{},f,c,p,void 0,x)}};b(this.bridgeProgramConfigurations,this.bridgeFeatureSections),b(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(a,c,f,p,x){const b=new Map;for(let A=p;A<x;A++){const k=f[A],M=k.a,$=k.b,V=Ol.computePosHash(a[M]),q=Ol.computePosHash(a[$]);let X=b.get(V);X||(X={},b.set(V,X));let Y=b.get(q);Y||(Y={},b.set(q,Y)),c[M]<=0&&c[$]<=0||(X.to=$,Y.from=M)}return b}isTerminalVertex(a,c){const f=Ol.computePosHash(this.unevalVertices[a]),p=c.get(f);return!p||!p.from||!p.to}constructBridgeStructures(a,c,f,p,x,b){a.clearVertexLookup();const A=this.computeVertexConnections(c,f,p,x.min,x.max),k=1/b,M=.5*k,$=(Xt,Vt)=>Ae(Xt,c[Vt].x,c[Vt].y,f[Vt]*k),V=oe(),q=oe(),X=oe(),Y=oe(),se=oe(),ce=(Xt,Vt)=>{const jt=A.get(Ol.computePosHash(c[Vt])),$t=jt.from,xt=jt.to;if(!$t||!xt)return;$(V,$t),$(q,Vt),$(X,xt),Lr(Y),Jr(V,q)||(Rt(se,q,V),je(Y,se)),Jr(X,q)||(Rt(se,X,q),Ce(Y,Y,je(se,se)));const vt=Xe(Y);return vt>0?Ie(Xt,Y,1/vt):void 0};let he=Number.POSITIVE_INFINITY;this.sortSubarray(p,x.min,x.max,(Xt,Vt)=>Xt.featureInfo.featureIndex-Vt.featureInfo.featureIndex);const be=oe(),Ee=oe(),Oe=oe(),Ue=oe(),Fe=oe(),Ke=oe(),Qe=oe(),nt=oe(),Et=oe(),ft=[oe(),oe(),oe(),oe()],Tt=[oe(),oe(),oe(),oe()],It=[{coord:new Mt(0,0),height:0},{coord:new Mt(0,0),height:0}],Dt=(Xt,Vt)=>Xt>Vt;for(let Xt=x.min;Xt<x.max;Xt++){const Vt=p[Xt];if(!Vt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(It,c,f,Vt,Dt))continue;const[jt,$t]=It;if(Ae(be,jt.coord.x,jt.coord.y,k*jt.height),Ae(Ee,$t.coord.x,$t.coord.y,k*$t.height),Jr(be,Ee))continue;Rt(Oe,Ee,be),je(Oe,Oe);const xt=ce(nt,Vt.a)||Oe,vt=ce(Et,Vt.b)||Oe;Ae(Ue,xt[1],-xt[0],0),je(Ue,Ue),Ae(Fe,vt[1],-vt[0],0),je(Fe,Fe),St(nt,Ue,xt),je(Ke,nt),St(nt,Fe,vt),je(Qe,nt),Ce(ft[0],be,Ie(nt,Rt(nt,Ue,Ke),M)),Ce(ft[1],be,Ie(nt,Ce(nt,Ue,Ke),M)),Ce(ft[2],be,Ie(nt,Ke,M)),ft[3]=be,Ce(Tt[0],Ee,Ie(nt,Rt(nt,Fe,Qe),M)),Ce(Tt[1],Ee,Ie(nt,Ce(nt,Fe,Qe),M)),Ce(Tt[2],Ee,Ie(nt,Qe,M)),Tt[3]=Ee,he=this.addFeatureSection(Vt.featureInfo.featureIndex,he,this.bridgeFeatureSections,a);const zt=a.addVertex(ft[0],Ue,b),Ht=a.addVertex(ft[1],Ue,b),Nt=a.addVertex(Tt[0],Fe,b),pr=a.addVertex(Tt[1],Fe,b);a.addTriangle(zt,Ht,Nt),a.addTriangle(Ht,pr,Nt);const _r=a.addVertex(ft[1],Ke,b),ur=a.addVertex(ft[2],Ke,b),ar=a.addVertex(Tt[1],Qe,b),Xr=a.addVertex(Tt[2],Qe,b);a.addTriangle(_r,ur,ar),a.addTriangle(ur,Xr,ar),Ge(Ue,Ue),Ge(Fe,Fe);const sr=a.addVertex(ft[2],Ue,b),Or=a.addVertex(ft[3],Ue,b),Qr=a.addVertex(Tt[2],Fe,b),vn=a.addVertex(Tt[3],Fe,b);a.addTriangle(sr,Or,Qr),a.addTriangle(Or,vn,Qr);const Bn=this.isTerminalVertex(Vt.a,A),nn=this.isTerminalVertex(Vt.b,A);jt.height<.01&&Bn&&a.addQuad(ft[3],ft[2],ft[1],ft[0],Ge(xt,xt),b),$t.height<.01&&nn&&a.addQuad(Tt[0],Tt[1],Tt[2],Tt[3],vt,b)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:a.getVertexCount()})}constructTunnelStructures(a,c,f,p,x,b){a.clearVertexLookup();let A=Number.POSITIVE_INFINITY;const k=(he,be)=>he.featureInfo.featureIndex-be.featureInfo.featureIndex;this.sortSubarray(p,x.min,x.max,k),this.sortSubarray(p,b.min,b.max,k);const M=he=>je(he,he),$=[{coord:new Mt(0,0),height:0},{coord:new Mt(0,0),height:0}],V=(he,be)=>he<be,q=oe(),X=oe(),Y=oe(),se=oe(),ce=oe();for(let he=x.min;he<x.max;he++){if(!this.prepareEdgePoints($,c,f,p[he],V))continue;const[be,Ee]=$,Oe=M(Ae(ce,-(Ee.coord.y-be.coord.y),Ee.coord.x-be.coord.x,0));A=this.addFeatureSection(p[he].featureInfo.featureIndex,A,this.tunnelFeatureSections,a),a.addQuad(Ae(q,be.coord.x,be.coord.y,be.height),Ae(X,Ee.coord.x,Ee.coord.y,Ee.height),Ae(Y,Ee.coord.x,Ee.coord.y,p[he].isTunnel?-.1:0),Ae(se,be.coord.x,be.coord.y,p[he].isTunnel?-.1:0),Oe)}for(let he=b.min;he<b.max;he++){const be=p[he];be.isTunnel&&([be.a,be.b]=[be.b,be.a]);const Ee=c[be.a],Oe=c[be.b],Ue=M(Ae(ce,-(Oe.y-Ee.y),Oe.x-Ee.x,0));A=this.addFeatureSection(be.featureInfo.featureIndex,A,this.tunnelFeatureSections,a),a.addQuad(Ae(q,Oe.x,Oe.y,0),Ae(X,Ee.x,Ee.y,0),Ae(Y,Ee.x,Ee.y,f[be.a]+4),Ae(se,Oe.x,Oe.y,f[be.b]+4),Ue),a.addQuad(Ae(q,Ee.x,Ee.y,0),Ae(X,Oe.x,Oe.y,0),Ae(Y,Oe.x,Oe.y,f[be.b]+4),Ae(se,Ee.x,Ee.y,f[be.a]+4),Ue)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:a.getVertexCount()})}setElevatedPoint(a,c,f,p){a.coord.x=c,a.coord.y=f,a.height=p}prepareEdgePoints(a,c,f,p,x){let b=c[p.a].x,A=c[p.a].y,k=c[p.b].x,M=c[p.b].y,$=f[p.a],V=f[p.b];const q=x($,0),X=x(V,0);if(q&&X)return this.setElevatedPoint(a[0],b,A,$),this.setElevatedPoint(a[1],k,M,V),!0;if(!q&&!X)return!1;if(q){if(!X){const Y=V/(V-$);k=qr(k,b,Y),M=qr(M,A,Y),V=qr(V,$,Y)}}else{const Y=$/($-V);b=qr(b,k,Y),A=qr(A,M,Y),$=qr($,V,Y)}return this.setElevatedPoint(a[0],b,A,$),this.setElevatedPoint(a[1],k,M,V),!0}prepareEdges(a,c){if(c.length===0)return;c.sort((A,k)=>A.hash===k.hash?k.polygonIdx-A.polygonIdx:k.hash>A.hash?1:-1);let f=0,p=0,x=0,b=c[f].polygonIdx;do p++,(p===c.length||c[f].hash!==c[p].hash)&&((p-f==1||c[p-1].polygonIdx!==b)&&(x<f&&(c[x]=c[f],c[f]=null),c[x].type="none",x++),f=p,f!==c.length&&(b=c[f].polygonIdx));while(f!==c.length);if(c.splice(x),c.length!==0&&a.length!==0){c.sort((M,$)=>M.portalHash<$.portalHash?1:-1);let A=0,k=0;for(;A!==c.length&&k!==a.length;){const M=c[A],$=a[k];M.portalHash>$.hash?A++:$.hash>M.portalHash?k++:(M.type=$.type,A++)}}}isOnBorder(a,c){return a<=0&&c<=0||a>=Jt&&c>=Jt}addFeatureSection(a,c,f,p){return a!==c&&(c=a,f.push({featureIndex:a,vertexStart:p.getVertexCount()}),p.clearVertexLookup()),c}sortSubarray(a,c,f,p){const x=a.slice(c,f);x.sort(p),a.splice(c,x.length,...x)}static computeEdgeHash(a,c){return(a.y===c.y&&a.x>c.x||a.y>c.y)&&([a,c]=[c,a]),BigInt(Ol.computePosHash(a))<<32n|BigInt(Ol.computePosHash(c))}static computePosHash(a){return((65535&a.x)<<16|65535&a.y)>>>0}}var D$,L$={exports:{}},F$=(D$||(D$=1,function(u,a){(function(c){function f(ze,Ne){return ze>Ne?1:ze<Ne?-1:0}var p=function(ze,Ne){ze===void 0&&(ze=f),Ne===void 0&&(Ne=!1),this._compare=ze,this._root=null,this._size=0,this._noDuplicates=!!Ne},x={size:{configurable:!0}};function b(ze,Ne,Pt,nr,Ct){var or=Ct-nr;if(or>0){var Ar=nr+Math.floor(or/2),Er={key:Ne[Ar],data:Pt[Ar],parent:ze};return Er.left=b(Er,Ne,Pt,nr,Ar),Er.right=b(Er,Ne,Pt,Ar+1,Ct),Er}return null}function A(ze,Ne,Pt,nr,Ct){if(!(Pt>=nr)){for(var or=ze[Pt+nr>>1],Ar=Pt-1,Er=nr+1;;){do Ar++;while(Ct(ze[Ar],or)<0);do Er--;while(Ct(ze[Er],or)>0);if(Ar>=Er)break;var an=ze[Ar];ze[Ar]=ze[Er],ze[Er]=an,an=Ne[Ar],Ne[Ar]=Ne[Er],Ne[Er]=an}A(ze,Ne,Pt,Er,Ct),A(ze,Ne,Er+1,nr,Ct)}}p.prototype.rotateLeft=function(ze){var Ne=ze.right;Ne&&(ze.right=Ne.left,Ne.left&&(Ne.left.parent=ze),Ne.parent=ze.parent),ze.parent?ze===ze.parent.left?ze.parent.left=Ne:ze.parent.right=Ne:this._root=Ne,Ne&&(Ne.left=ze),ze.parent=Ne},p.prototype.rotateRight=function(ze){var Ne=ze.left;Ne&&(ze.left=Ne.right,Ne.right&&(Ne.right.parent=ze),Ne.parent=ze.parent),ze.parent?ze===ze.parent.left?ze.parent.left=Ne:ze.parent.right=Ne:this._root=Ne,Ne&&(Ne.right=ze),ze.parent=Ne},p.prototype._splay=function(ze){for(;ze.parent;){var Ne=ze.parent;Ne.parent?Ne.left===ze&&Ne.parent.left===Ne?(this.rotateRight(Ne.parent),this.rotateRight(Ne)):Ne.right===ze&&Ne.parent.right===Ne?(this.rotateLeft(Ne.parent),this.rotateLeft(Ne)):Ne.left===ze&&Ne.parent.right===Ne?(this.rotateRight(Ne),this.rotateLeft(Ne)):(this.rotateLeft(Ne),this.rotateRight(Ne)):Ne.left===ze?this.rotateRight(Ne):this.rotateLeft(Ne)}},p.prototype.splay=function(ze){for(var Ne,Pt,nr,Ct,or;ze.parent;)(Pt=(Ne=ze.parent).parent)&&Pt.parent?((nr=Pt.parent).left===Pt?nr.left=ze:nr.right=ze,ze.parent=nr):(ze.parent=null,this._root=ze),Ct=ze.left,or=ze.right,ze===Ne.left?(Pt&&(Pt.left===Ne?(Ne.right?(Pt.left=Ne.right,Pt.left.parent=Pt):Pt.left=null,Ne.right=Pt,Pt.parent=Ne):(Ct?(Pt.right=Ct,Ct.parent=Pt):Pt.right=null,ze.left=Pt,Pt.parent=ze)),or?(Ne.left=or,or.parent=Ne):Ne.left=null,ze.right=Ne,Ne.parent=ze):(Pt&&(Pt.right===Ne?(Ne.left?(Pt.right=Ne.left,Pt.right.parent=Pt):Pt.right=null,Ne.left=Pt,Pt.parent=Ne):(or?(Pt.left=or,or.parent=Pt):Pt.left=null,ze.right=Pt,Pt.parent=ze)),Ct?(Ne.right=Ct,Ct.parent=Ne):Ne.right=null,ze.left=Ne,Ne.parent=ze)},p.prototype.replace=function(ze,Ne){ze.parent?ze===ze.parent.left?ze.parent.left=Ne:ze.parent.right=Ne:this._root=Ne,Ne&&(Ne.parent=ze.parent)},p.prototype.minNode=function(ze){if(ze===void 0&&(ze=this._root),ze)for(;ze.left;)ze=ze.left;return ze},p.prototype.maxNode=function(ze){if(ze===void 0&&(ze=this._root),ze)for(;ze.right;)ze=ze.right;return ze},p.prototype.insert=function(ze,Ne){var Pt=this._root,nr=null,Ct=this._compare;if(this._noDuplicates)for(;Pt;){if(nr=Pt,Ct(Pt.key,ze)===0)return;Pt=Ct(Pt.key,ze)<0?Pt.right:Pt.left}else for(;Pt;)nr=Pt,Pt=Ct(Pt.key,ze)<0?Pt.right:Pt.left;return Pt={key:ze,data:Ne,left:null,right:null,parent:nr},nr?Ct(nr.key,Pt.key)<0?nr.right=Pt:nr.left=Pt:this._root=Pt,this.splay(Pt),this._size++,Pt},p.prototype.find=function(ze){for(var Ne=this._root,Pt=this._compare;Ne;){var nr=Pt(Ne.key,ze);if(nr<0)Ne=Ne.right;else{if(!(nr>0))return Ne;Ne=Ne.left}}return null},p.prototype.contains=function(ze){for(var Ne=this._root,Pt=this._compare;Ne;){var nr=Pt(ze,Ne.key);if(nr===0)return!0;Ne=nr<0?Ne.left:Ne.right}return!1},p.prototype.remove=function(ze){var Ne=this.find(ze);if(!Ne)return!1;if(this.splay(Ne),Ne.left)if(Ne.right){var Pt=this.minNode(Ne.right);Pt.parent!==Ne&&(this.replace(Pt,Pt.right),Pt.right=Ne.right,Pt.right.parent=Pt),this.replace(Ne,Pt),Pt.left=Ne.left,Pt.left.parent=Pt}else this.replace(Ne,Ne.left);else this.replace(Ne,Ne.right);return this._size--,!0},p.prototype.removeNode=function(ze){if(!ze)return!1;if(this.splay(ze),ze.left)if(ze.right){var Ne=this.minNode(ze.right);Ne.parent!==ze&&(this.replace(Ne,Ne.right),Ne.right=ze.right,Ne.right.parent=Ne),this.replace(ze,Ne),Ne.left=ze.left,Ne.left.parent=Ne}else this.replace(ze,ze.left);else this.replace(ze,ze.right);return this._size--,!0},p.prototype.erase=function(ze){var Ne=this.find(ze);if(Ne){this.splay(Ne);var Pt=Ne.left,nr=Ne.right,Ct=null;Pt&&(Pt.parent=null,Ct=this.maxNode(Pt),this.splay(Ct),this._root=Ct),nr&&(Pt?Ct.right=nr:this._root=nr,nr.parent=Ct),this._size--}},p.prototype.pop=function(){var ze=this._root,Ne=null;if(ze){for(;ze.left;)ze=ze.left;Ne={key:ze.key,data:ze.data},this.remove(ze.key)}return Ne},p.prototype.next=function(ze){var Ne=ze;if(Ne)if(Ne.right)for(Ne=Ne.right;Ne&&Ne.left;)Ne=Ne.left;else for(Ne=ze.parent;Ne&&Ne.right===ze;)ze=Ne,Ne=Ne.parent;return Ne},p.prototype.prev=function(ze){var Ne=ze;if(Ne)if(Ne.left)for(Ne=Ne.left;Ne&&Ne.right;)Ne=Ne.right;else for(Ne=ze.parent;Ne&&Ne.left===ze;)ze=Ne,Ne=Ne.parent;return Ne},p.prototype.forEach=function(ze){for(var Ne=this._root,Pt=[],nr=!1,Ct=0;!nr;)Ne?(Pt.push(Ne),Ne=Ne.left):Pt.length>0?(ze(Ne=Pt.pop(),Ct++),Ne=Ne.right):nr=!0;return this},p.prototype.range=function(ze,Ne,Pt,nr){for(var Ct=[],or=this._compare,Ar=this._root;Ct.length!==0||Ar;)if(Ar)Ct.push(Ar),Ar=Ar.left;else{if(or((Ar=Ct.pop()).key,Ne)>0)break;if(or(Ar.key,ze)>=0&&Pt.call(nr,Ar))return this;Ar=Ar.right}return this},p.prototype.keys=function(){for(var ze=this._root,Ne=[],Pt=[],nr=!1;!nr;)ze?(Ne.push(ze),ze=ze.left):Ne.length>0?(ze=Ne.pop(),Pt.push(ze.key),ze=ze.right):nr=!0;return Pt},p.prototype.values=function(){for(var ze=this._root,Ne=[],Pt=[],nr=!1;!nr;)ze?(Ne.push(ze),ze=ze.left):Ne.length>0?(ze=Ne.pop(),Pt.push(ze.data),ze=ze.right):nr=!0;return Pt},p.prototype.at=function(ze){for(var Ne=this._root,Pt=[],nr=!1,Ct=0;!nr;)if(Ne)Pt.push(Ne),Ne=Ne.left;else if(Pt.length>0){if(Ne=Pt.pop(),Ct===ze)return Ne;Ct++,Ne=Ne.right}else nr=!0;return null},p.prototype.load=function(ze,Ne,Pt){if(ze===void 0&&(ze=[]),Ne===void 0&&(Ne=[]),Pt===void 0&&(Pt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var nr=ze.length;return Pt&&A(ze,Ne,0,nr-1,this._compare),this._root=b(null,ze,Ne,0,nr),this._size=nr,this},p.prototype.min=function(){var ze=this.minNode(this._root);return ze?ze.key:null},p.prototype.max=function(){var ze=this.maxNode(this._root);return ze?ze.key:null},p.prototype.isEmpty=function(){return this._root===null},x.size.get=function(){return this._size},p.createTree=function(ze,Ne,Pt,nr,Ct){return new p(Pt,Ct).load(ze,Ne,nr)},Object.defineProperties(p.prototype,x);var k=0,M=1,$=2,V=3,q=0,X=1,Y=2,se=3;function ce(ze,Ne,Pt){Ne===null?(ze.inOut=!1,ze.otherInOut=!0):(ze.isSubject===Ne.isSubject?(ze.inOut=!Ne.inOut,ze.otherInOut=Ne.otherInOut):(ze.inOut=!Ne.otherInOut,ze.otherInOut=Ne.isVertical()?!Ne.inOut:Ne.inOut),Ne&&(ze.prevInResult=!he(Ne,Pt)||Ne.isVertical()?Ne.prevInResult:Ne));var nr=he(ze,Pt);ze.resultTransition=nr?function(Ct,or){var Ar,Er=!Ct.inOut,an=!Ct.otherInOut;switch(or){case q:Ar=Er&&an;break;case X:Ar=Er||an;break;case se:Ar=Er^an;break;case Y:Ar=Ct.isSubject?Er&&!an:an&&!Er}return Ar?1:-1}(ze,Pt):0}function he(ze,Ne){switch(ze.type){case k:switch(Ne){case q:return!ze.otherInOut;case X:return ze.otherInOut;case Y:return ze.isSubject&&ze.otherInOut||!ze.isSubject&&!ze.otherInOut;case se:return!0}break;case $:return Ne===q||Ne===X;case V:return Ne===Y;case M:return!1}return!1}var be=function(ze,Ne,Pt,nr,Ct){this.left=Ne,this.point=ze,this.otherEvent=Pt,this.isSubject=nr,this.type=Ct||k,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},Ee={inResult:{configurable:!0}};function Oe(ze,Ne){return ze[0]===Ne[0]&&ze[1]===Ne[1]}be.prototype.isBelow=function(ze){var Ne=this.point,Pt=this.otherEvent.point;return this.left?(Ne[0]-ze[0])*(Pt[1]-ze[1])-(Pt[0]-ze[0])*(Ne[1]-ze[1])>0:(Pt[0]-ze[0])*(Ne[1]-ze[1])-(Ne[0]-ze[0])*(Pt[1]-ze[1])>0},be.prototype.isAbove=function(ze){return!this.isBelow(ze)},be.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},Ee.inResult.get=function(){return this.resultTransition!==0},be.prototype.clone=function(){var ze=new be(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ze.contourId=this.contourId,ze.resultTransition=this.resultTransition,ze.prevInResult=this.prevInResult,ze.isExteriorRing=this.isExteriorRing,ze.inOut=this.inOut,ze.otherInOut=this.otherInOut,ze},Object.defineProperties(be.prototype,Ee);var Ue=11102230246251565e-32,Fe=134217729,Ke=(3+8*Ue)*Ue;function Qe(ze,Ne,Pt,nr,Ct){var or,Ar,Er,an,Fr=Ne[0],wr=nr[0],Wn=0,vi=0;wr>Fr==wr>-Fr?(or=Fr,Fr=Ne[++Wn]):(or=wr,wr=nr[++vi]);var Ur=0;if(Wn<ze&&vi<Pt)for(wr>Fr==wr>-Fr?(Er=or-((Ar=Fr+or)-Fr),Fr=Ne[++Wn]):(Er=or-((Ar=wr+or)-wr),wr=nr[++vi]),or=Ar,Er!==0&&(Ct[Ur++]=Er);Wn<ze&&vi<Pt;)wr>Fr==wr>-Fr?(Er=or-((Ar=or+Fr)-(an=Ar-or))+(Fr-an),Fr=Ne[++Wn]):(Er=or-((Ar=or+wr)-(an=Ar-or))+(wr-an),wr=nr[++vi]),or=Ar,Er!==0&&(Ct[Ur++]=Er);for(;Wn<ze;)Er=or-((Ar=or+Fr)-(an=Ar-or))+(Fr-an),Fr=Ne[++Wn],or=Ar,Er!==0&&(Ct[Ur++]=Er);for(;vi<Pt;)Er=or-((Ar=or+wr)-(an=Ar-or))+(wr-an),wr=nr[++vi],or=Ar,Er!==0&&(Ct[Ur++]=Er);return or===0&&Ur!==0||(Ct[Ur++]=or),Ur}function nt(ze){return new Float64Array(ze)}var Et=33306690738754716e-32,ft=22204460492503146e-32,Tt=11093356479670487e-47,It=nt(4),Dt=nt(8),Xt=nt(12),Vt=nt(16),jt=nt(4);function $t(ze,Ne,Pt){var nr=function(Ct,or,Ar,Er,an,Fr){var wr=(or-Fr)*(Ar-an),Wn=(Ct-an)*(Er-Fr),vi=wr-Wn;if(wr===0||Wn===0||wr>0!=Wn>0)return vi;var Ur=Math.abs(wr+Wn);return Math.abs(vi)>=Et*Ur?vi:-function(Fn,_i,ii,la,Ui,Ci,ui){var Zn,on,Xn,Oi,zr,$n,Vi,ma,Pa,Wa,qi,Ba,tl,$a,Il,Ho,jc,rl,Rl=Fn-Ui,Ko=ii-Ui,jl=_i-Ci,Nc=la-Ci;It[0]=(Il=(ma=Rl-(Vi=($n=Fe*Rl)-($n-Rl)))*(Wa=Nc-(Pa=($n=Fe*Nc)-($n-Nc)))-(($a=Rl*Nc)-Vi*Pa-ma*Pa-Vi*Wa))-((qi=Il-(jc=(ma=jl-(Vi=($n=Fe*jl)-($n-jl)))*(Wa=Ko-(Pa=($n=Fe*Ko)-($n-Ko)))-((Ho=jl*Ko)-Vi*Pa-ma*Pa-Vi*Wa)))+(zr=Il-qi))+(zr-jc),It[1]=(tl=$a-((Ba=$a+qi)-(zr=Ba-$a))+(qi-zr))-((qi=tl-Ho)+(zr=tl-qi))+(zr-Ho),It[2]=Ba-((rl=Ba+qi)-(zr=rl-Ba))+(qi-zr),It[3]=rl;var Ao=function(Bp,eh){for(var eP=eh[0],cx=1;cx<4;cx++)eP+=eh[cx];return eP}(0,It),As=ft*ui;if(Ao>=As||-Ao>=As||(Zn=Fn-(Rl+(zr=Fn-Rl))+(zr-Ui),Xn=ii-(Ko+(zr=ii-Ko))+(zr-Ui),on=_i-(jl+(zr=_i-jl))+(zr-Ci),Oi=la-(Nc+(zr=la-Nc))+(zr-Ci),Zn===0&&on===0&&Xn===0&&Oi===0)||(As=Tt*ui+Ke*Math.abs(Ao),(Ao+=Rl*Oi+Nc*Zn-(jl*Xn+Ko*on))>=As||-Ao>=As))return Ao;jt[0]=(Il=(ma=Zn-(Vi=($n=Fe*Zn)-($n-Zn)))*(Wa=Nc-(Pa=($n=Fe*Nc)-($n-Nc)))-(($a=Zn*Nc)-Vi*Pa-ma*Pa-Vi*Wa))-((qi=Il-(jc=(ma=on-(Vi=($n=Fe*on)-($n-on)))*(Wa=Ko-(Pa=($n=Fe*Ko)-($n-Ko)))-((Ho=on*Ko)-Vi*Pa-ma*Pa-Vi*Wa)))+(zr=Il-qi))+(zr-jc),jt[1]=(tl=$a-((Ba=$a+qi)-(zr=Ba-$a))+(qi-zr))-((qi=tl-Ho)+(zr=tl-qi))+(zr-Ho),jt[2]=Ba-((rl=Ba+qi)-(zr=rl-Ba))+(qi-zr),jt[3]=rl;var Qd=Qe(4,It,4,jt,Dt);jt[0]=(Il=(ma=Rl-(Vi=($n=Fe*Rl)-($n-Rl)))*(Wa=Oi-(Pa=($n=Fe*Oi)-($n-Oi)))-(($a=Rl*Oi)-Vi*Pa-ma*Pa-Vi*Wa))-((qi=Il-(jc=(ma=jl-(Vi=($n=Fe*jl)-($n-jl)))*(Wa=Xn-(Pa=($n=Fe*Xn)-($n-Xn)))-((Ho=jl*Xn)-Vi*Pa-ma*Pa-Vi*Wa)))+(zr=Il-qi))+(zr-jc),jt[1]=(tl=$a-((Ba=$a+qi)-(zr=Ba-$a))+(qi-zr))-((qi=tl-Ho)+(zr=tl-qi))+(zr-Ho),jt[2]=Ba-((rl=Ba+qi)-(zr=rl-Ba))+(qi-zr),jt[3]=rl;var zp=Qe(Qd,Dt,4,jt,Xt);jt[0]=(Il=(ma=Zn-(Vi=($n=Fe*Zn)-($n-Zn)))*(Wa=Oi-(Pa=($n=Fe*Oi)-($n-Oi)))-(($a=Zn*Oi)-Vi*Pa-ma*Pa-Vi*Wa))-((qi=Il-(jc=(ma=on-(Vi=($n=Fe*on)-($n-on)))*(Wa=Xn-(Pa=($n=Fe*Xn)-($n-Xn)))-((Ho=on*Xn)-Vi*Pa-ma*Pa-Vi*Wa)))+(zr=Il-qi))+(zr-jc),jt[1]=(tl=$a-((Ba=$a+qi)-(zr=Ba-$a))+(qi-zr))-((qi=tl-Ho)+(zr=tl-qi))+(zr-Ho),jt[2]=Ba-((rl=Ba+qi)-(zr=rl-Ba))+(qi-zr),jt[3]=rl;var lx=Qe(zp,Xt,4,jt,Vt);return Vt[lx-1]}(Ct,or,Ar,Er,an,Fr,Ur)}(ze[0],ze[1],Ne[0],Ne[1],Pt[0],Pt[1]);return nr>0?-1:nr<0?1:0}function xt(ze,Ne){var Pt=ze.point,nr=Ne.point;return Pt[0]>nr[0]?1:Pt[0]<nr[0]?-1:Pt[1]!==nr[1]?Pt[1]>nr[1]?1:-1:function(Ct,or,Ar,Er){return Ct.left!==or.left?Ct.left?1:-1:$t(Ar,Ct.otherEvent.point,or.otherEvent.point)!==0?Ct.isBelow(or.otherEvent.point)?-1:1:!Ct.isSubject&&or.isSubject?1:-1}(ze,Ne,Pt)}function vt(ze,Ne,Pt){var nr=new be(Ne,!1,ze,ze.isSubject),Ct=new be(Ne,!0,ze.otherEvent,ze.isSubject);return Oe(ze.point,ze.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ze),nr.contourId=Ct.contourId=ze.contourId,xt(Ct,ze.otherEvent)>0&&(ze.otherEvent.left=!0,Ct.left=!1),ze.otherEvent.otherEvent=Ct,ze.otherEvent=nr,Pt.push(Ct),Pt.push(nr),Pt}function zt(ze,Ne){return ze[0]*Ne[1]-ze[1]*Ne[0]}function Ht(ze,Ne){return ze[0]*Ne[0]+ze[1]*Ne[1]}function Nt(ze,Ne,Pt){var nr=function(an,Fr,wr,Wn,vi){var Ur=[Fr[0]-an[0],Fr[1]-an[1]],Fn=[Wn[0]-wr[0],Wn[1]-wr[1]];function _i($n,Vi,ma){return[$n[0]+Vi*ma[0],$n[1]+Vi*ma[1]]}var ii=[wr[0]-an[0],wr[1]-an[1]],la=zt(Ur,Fn),Ui=la*la,Ci=Ht(Ur,Ur);if(Ui>0){var ui=zt(ii,Fn)/la;if(ui<0||ui>1)return null;var Zn=zt(ii,Ur)/la;return Zn<0||Zn>1?null:ui===0||ui===1?[_i(an,ui,Ur)]:Zn===0||Zn===1?[_i(wr,Zn,Fn)]:[_i(an,ui,Ur)]}if((Ui=(la=zt(ii,Ur))*la)>0)return null;var on=Ht(Ur,ii)/Ci,Xn=on+Ht(Ur,Fn)/Ci,Oi=Math.min(on,Xn),zr=Math.max(on,Xn);return Oi<=1&&zr>=0?Oi===1?[_i(an,Oi>0?Oi:0,Ur)]:zr===0?[_i(an,zr<1?zr:1,Ur)]:[_i(an,Oi>0?Oi:0,Ur),_i(an,zr<1?zr:1,Ur)]:null}(ze.point,ze.otherEvent.point,Ne.point,Ne.otherEvent.point),Ct=nr?nr.length:0;if(Ct===0||Ct===1&&(Oe(ze.point,Ne.point)||Oe(ze.otherEvent.point,Ne.otherEvent.point))||Ct===2&&ze.isSubject===Ne.isSubject)return 0;if(Ct===1)return Oe(ze.point,nr[0])||Oe(ze.otherEvent.point,nr[0])||vt(ze,nr[0],Pt),Oe(Ne.point,nr[0])||Oe(Ne.otherEvent.point,nr[0])||vt(Ne,nr[0],Pt),1;var or=[],Ar=!1,Er=!1;return Oe(ze.point,Ne.point)?Ar=!0:xt(ze,Ne)===1?or.push(Ne,ze):or.push(ze,Ne),Oe(ze.otherEvent.point,Ne.otherEvent.point)?Er=!0:xt(ze.otherEvent,Ne.otherEvent)===1?or.push(Ne.otherEvent,ze.otherEvent):or.push(ze.otherEvent,Ne.otherEvent),Ar&&Er||Ar?(Ne.type=M,ze.type=Ne.inOut===ze.inOut?$:V,Ar&&!Er&&vt(or[1].otherEvent,or[0].point,Pt),2):Er?(vt(or[0],or[1].point,Pt),3):or[0]!==or[3].otherEvent?(vt(or[0],or[1].point,Pt),vt(or[1],or[2].point,Pt),3):(vt(or[0],or[1].point,Pt),vt(or[3].otherEvent,or[2].point,Pt),3)}function pr(ze,Ne){if(ze===Ne)return 0;if($t(ze.point,ze.otherEvent.point,Ne.point)!==0||$t(ze.point,ze.otherEvent.point,Ne.otherEvent.point)!==0)return Oe(ze.point,Ne.point)?ze.isBelow(Ne.otherEvent.point)?-1:1:ze.point[0]===Ne.point[0]?ze.point[1]<Ne.point[1]?-1:1:xt(ze,Ne)===1?Ne.isAbove(ze.point)?-1:1:ze.isBelow(Ne.point)?-1:1;if(ze.isSubject!==Ne.isSubject)return ze.isSubject?-1:1;var Pt=ze.point,nr=Ne.point;return Pt[0]===nr[0]&&Pt[1]===nr[1]?(Pt=ze.otherEvent.point)[0]===(nr=Ne.otherEvent.point)[0]&&Pt[1]===nr[1]?0:ze.contourId>Ne.contourId?1:-1:xt(ze,Ne)===1?1:-1}var _r=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function ur(ze,Ne,Pt,nr){var Ct,or=ze+1,Ar=Ne[ze].point,Er=Ne.length;for(or<Er&&(Ct=Ne[or].point);or<Er&&Ct[0]===Ar[0]&&Ct[1]===Ar[1];){if(!Pt[or])return or;++or<Er&&(Ct=Ne[or].point)}for(or=ze-1;Pt[or]&&or>nr;)or--;return or}_r.prototype.isExterior=function(){return this.holeOf==null};var ar=sr,Xr=sr;function sr(ze,Ne){if(!(this instanceof sr))return new sr(ze,Ne);if(this.data=ze||[],this.length=this.data.length,this.compare=Ne||Or,this.length>0)for(var Pt=(this.length>>1)-1;Pt>=0;Pt--)this._down(Pt)}function Or(ze,Ne){return ze<Ne?-1:ze>Ne?1:0}sr.prototype={push:function(ze){this.data.push(ze),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ze=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ze}},peek:function(){return this.data[0]},_up:function(ze){for(var Ne=this.data,Pt=this.compare,nr=Ne[ze];ze>0;){var Ct=ze-1>>1,or=Ne[Ct];if(Pt(nr,or)>=0)break;Ne[ze]=or,ze=Ct}Ne[ze]=nr},_down:function(ze){for(var Ne=this.data,Pt=this.compare,nr=this.length>>1,Ct=Ne[ze];ze<nr;){var or=1+(ze<<1),Ar=or+1,Er=Ne[or];if(Ar<this.length&&Pt(Ne[Ar],Er)<0&&(or=Ar,Er=Ne[Ar]),Pt(Er,Ct)>=0)break;Ne[ze]=Er,ze=or}Ne[ze]=Ct}},ar.default=Xr;var Qr=Math.max,vn=Math.min,Bn=0;function nn(ze,Ne,Pt,nr,Ct,or){var Ar,Er,an,Fr,wr,Wn;for(Ar=0,Er=ze.length-1;Ar<Er;Ar++)if(Fr=ze[Ar+1],wr=new be(an=ze[Ar],!1,void 0,Ne),Wn=new be(Fr,!1,wr,Ne),wr.otherEvent=Wn,an[0]!==Fr[0]||an[1]!==Fr[1]){wr.contourId=Wn.contourId=Pt,or||(wr.isExteriorRing=!1,Wn.isExteriorRing=!1),xt(wr,Wn)>0?Wn.left=!0:wr.left=!0;var vi=an[0],Ur=an[1];Ct[0]=vn(Ct[0],vi),Ct[1]=vn(Ct[1],Ur),Ct[2]=Qr(Ct[2],vi),Ct[3]=Qr(Ct[3],Ur),nr.push(wr),nr.push(Wn)}}var Hn=[];function Kn(ze,Ne,Pt){typeof ze[0][0][0]=="number"&&(ze=[ze]),typeof Ne[0][0][0]=="number"&&(Ne=[Ne]);var nr=function(Ur,Fn,_i){var ii=null;return Ur.length*Fn.length==0&&(_i===q?ii=Hn:_i===Y?ii=Ur:_i!==X&&_i!==se||(ii=Ur.length===0?Fn:Ur)),ii}(ze,Ne,Pt);if(nr)return nr===Hn?null:nr;var Ct=[1/0,1/0,-1/0,-1/0],or=[1/0,1/0,-1/0,-1/0],Ar=function(Ur,Fn,_i,ii,la){var Ui,Ci,ui,Zn,on,Xn,Oi=new ar(null,xt);for(ui=0,Zn=Ur.length;ui<Zn;ui++)for(on=0,Xn=(Ui=Ur[ui]).length;on<Xn;on++)(Ci=on===0)&&Bn++,nn(Ui[on],!0,Bn,Oi,_i,Ci);for(ui=0,Zn=Fn.length;ui<Zn;ui++)for(on=0,Xn=(Ui=Fn[ui]).length;on<Xn;on++)Ci=on===0,la===Y&&(Ci=!1),Ci&&Bn++,nn(Ui[on],!1,Bn,Oi,ii,Ci);return Oi}(ze,Ne,Ct,or,Pt);if(nr=function(Ur,Fn,_i,ii,la){var Ui=null;return(_i[0]>ii[2]||ii[0]>_i[2]||_i[1]>ii[3]||ii[1]>_i[3])&&(la===q?Ui=Hn:la===Y?Ui=Ur:la!==X&&la!==se||(Ui=Ur.concat(Fn))),Ui}(ze,Ne,Ct,or,Pt))return nr===Hn?null:nr;for(var Er=function(Ur){var Fn,_i,ii=function(ui){var Zn,on,Xn,Oi,zr=[];for(on=0,Xn=ui.length;on<Xn;on++)((Zn=ui[on]).left&&Zn.inResult||!Zn.left&&Zn.otherEvent.inResult)&&zr.push(Zn);for(var $n=!1;!$n;)for($n=!0,on=0,Xn=zr.length;on<Xn;on++)on+1<Xn&&xt(zr[on],zr[on+1])===1&&(Oi=zr[on],zr[on]=zr[on+1],zr[on+1]=Oi,$n=!1);for(on=0,Xn=zr.length;on<Xn;on++)(Zn=zr[on]).otherPos=on;for(on=0,Xn=zr.length;on<Xn;on++)(Zn=zr[on]).left||(Oi=Zn.otherPos,Zn.otherPos=Zn.otherEvent.otherPos,Zn.otherEvent.otherPos=Oi);return zr}(Ur),la={},Ui=[],Ci=function(){if(!la[Fn]){var ui=Ui.length,Zn=function(zr,$n,Vi){var ma=new _r;if(zr.prevInResult!=null){var Pa=zr.prevInResult,Wa=Pa.outputContourId;if(Pa.resultTransition>0){var qi=$n[Wa];if(qi.holeOf!=null){var Ba=qi.holeOf;$n[Ba].holeIds.push(Vi),ma.holeOf=Ba,ma.depth=$n[Wa].depth}else $n[Wa].holeIds.push(Vi),ma.holeOf=Wa,ma.depth=$n[Wa].depth+1}else ma.holeOf=null,ma.depth=$n[Wa].depth}else ma.holeOf=null,ma.depth=0;return ma}(ii[Fn],Ui,ui),on=function(zr){la[zr]=!0,zr<ii.length&&ii[zr]&&(ii[zr].outputContourId=ui)},Xn=Fn,Oi=Fn;for(Zn.points.push(ii[Fn].point);on(Xn),on(Xn=ii[Xn].otherPos),Zn.points.push(ii[Xn].point),!((Xn=ur(Xn,ii,la,Oi))==Oi||Xn>=ii.length)&&ii[Xn];);Ui.push(Zn)}};for(Fn=0,_i=ii.length;Fn<_i;Fn++)Ci();return Ui}(function(Ur,Fn,_i,ii,la,Ui){for(var Ci,ui,Zn,on=new p(pr),Xn=[],Oi=Math.min(ii[2],la[2]);Ur.length!==0;){var zr=Ur.pop();if(Xn.push(zr),Ui===q&&zr.point[0]>Oi||Ui===Y&&zr.point[0]>ii[2])break;if(zr.left){ui=Ci=on.insert(zr),Ci=Ci!==(Zn=on.minNode())?on.prev(Ci):null,ui=on.next(ui);var $n=Ci?Ci.key:null;if(ce(zr,$n,Ui),ui&&Nt(zr,ui.key,Ur)===2&&(ce(zr,$n,Ui),ce(ui.key,zr,Ui)),Ci&&Nt(Ci.key,zr,Ur)===2){var Vi=Ci;ce($n,(Vi=Vi!==Zn?on.prev(Vi):null)?Vi.key:null,Ui),ce(zr,$n,Ui)}}else ui=Ci=on.find(zr=zr.otherEvent),Ci&&ui&&(Ci=Ci!==Zn?on.prev(Ci):null,ui=on.next(ui),on.remove(zr),ui&&Ci&&Nt(Ci.key,ui.key,Ur))}return Xn}(Ar,0,0,Ct,or,Pt)),an=[],Fr=0;Fr<Er.length;Fr++){var wr=Er[Fr];if(wr.isExterior()){for(var Wn=[wr.points],vi=0;vi<wr.holeIds.length;vi++)Wn.push(Er[wr.holeIds[vi]].points);an.push(Wn)}}return an}var Yi={UNION:X,DIFFERENCE:Y,INTERSECTION:q,XOR:se};c.diff=function(ze,Ne){return Kn(ze,Ne,Y)},c.intersection=function(ze,Ne){return Kn(ze,Ne,q)},c.operations=Yi,c.union=function(ze,Ne){return Kn(ze,Ne,X)},c.xor=function(ze,Ne){return Kn(ze,Ne,se)},Object.defineProperty(c,"__esModule",{value:!0})})(a)}(0,L$.exports)),L$.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function hA(u,a,c,f){const p=[],x=f===0?(b,A,k,M,$,V)=>{b.push(new Mt(V,k+(V-A)/(M-A)*($-k)))}:(b,A,k,M,$,V)=>{b.push(new Mt(A+(V-k)/($-k)*(M-A),V))};for(const b of u){const A=[];for(const k of b){if(k.length<=2)continue;const M=[];for(let q=0;q<k.length-1;q++){const X=k[q].x,Y=k[q].y,se=k[q+1].x,ce=k[q+1].y,he=f===0?X:Y,be=f===0?se:ce;he<a?be>a&&x(M,X,Y,se,ce,a):he>c?be<c&&x(M,X,Y,se,ce,c):M.push(k[q]),be<a&&he>=a&&x(M,X,Y,se,ce,a),be>c&&he<=c&&x(M,X,Y,se,ce,c)}let $=k[k.length-1];const V=f===0?$.x:$.y;V>=a&&V<=c&&M.push($),M.length&&($=M[M.length-1],M[0].x===$.x&&M[0].y===$.y||M.push(M[0]),A.push(M))}A.length&&p.push(A)}return p}function Eue(u,a){const c=Bj(u),f=Bj([a]),p=F$.intersection(c,f);return p==null?[]:z$(p)}function Tue(u,a){let f=Bj(u,65536);const p=[];for(;a.valid();a.next()){const[x,b]=a.get(),A=x.x*65536,k=x.y*65536,M=b.x*65536,$=b.y*65536,V=M-A,q=$-k,X=Math.hypot(V,q);if(X===0)continue;const Y=Math.trunc(q/X*3),se=-Math.trunc(V/X*3);p.push([[[A,k],[M,$],[M+Y,$+se],[A+Y,k+se],[A,k]]])}return p.length>0&&(f=F$.diff(f,p)),z$(f,1/65536)}function Bj(u,a=1){return[u.map(c=>c.map(f=>[f.x*a,f.y*a]))]}function z$(u,a=1){return u.map(c=>c.map((f,p)=>{const x=f.map(b=>new Mt(b[0]*a,b[1]*a).round());return p>0&&x.reverse(),x}))}class $j{constructor(a,c){this.layoutVertexArray=new Ls,this.indexArray=new Gi,this.lineIndexArray=new oc,this.triangleSegments=new ta,this.lineSegments=new ta,this.programConfigurations=new Ic(a.layers,{zoom:a.zoom,lut:a.lut}),this.uploaded=!1,c&&(this.elevatedLayoutVertexArray=new Ku)}update(a,c,f,p,x,b,A,k){this.programConfigurations.updatePaintArrays(a,c,x,f,p,b,A,k)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,cue.members),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.lineIndexBuffer=a.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=a.createVertexBuffer(this.elevatedLayoutVertexArray,uue.members))),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(a,c,f,p,x,b,A){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,f,p,x,b,void 0,A)}}class Uj{constructor(a){this.zoom=a.zoom,this.pixelRatio=a.pixelRatio,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=a.lut,this.bufferData=new $j(a,!1),this.elevationBufferData=new $j(a,!0),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.projection=a.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=a.sourceLayerIndex,this.worldview=a.worldview,this.hasAppearances=null}updateFootprints(a,c){}updateAppearances(a,c,f,p){}populate(a,c,f,p){this.hasPattern=Fj("fill",this.layers,this.pixelRatio,c);const x=this.layers[0].layout.get("fill-sort-key"),b=[];for(const{feature:A,id:k,index:M,sourceLayerIndex:$}of a){const V=this.layers[0]._featureFilter.needGeometry,q=gt(A,V);if(!this.layers[0]._featureFilter.filter(new Ri(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),q,f))continue;const X=x?x.evaluate(q,{},f,c.availableImages):void 0,Y={id:k,properties:A.properties,type:A.type,sourceLayerIndex:$,index:M,geometry:V?q.geometry:kt(A,f,p),patterns:{},sortKey:X};b.push(Y)}x&&b.sort((A,k)=>A.sortKey-k.sortKey);for(const A of b){const{geometry:k,index:M,sourceLayerIndex:$}=A;if(this.hasPattern){const V=zj("fill",this.layers,A,this.zoom,this.pixelRatio,c);this.patternFeatures.push(V)}else this.addFeature(A,k,M,f,{},c.availableImages,c.brightness,c.elevationFeatures);c.featureIndex.insert(a[M].feature,k,M,$,this.index)}}update(a,c,f,p,x,b,A){this.bufferData.update(a,c,f,p,x,b,A,this.worldview),this.elevationBufferData.update(a,c,f,p,x,b,A,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(a,c,f,p,x,b,A,this.worldview)}addFeatures(a,c,f,p,x,b){for(const A of this.patternFeatures)this.addFeature(A,A.geometry,A.index,c,f,p,b,a.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(a){this.bufferData.upload(a),this.elevationBufferData.upload(a),this.elevatedStructures&&this.elevatedStructures.upload(a)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(a,c,f,p,x,b=[],A,k){const M=y1(c,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(a,M,p,f,k):this.addGeometry(M,this.bufferData),this.bufferData.populatePaintArrays(a,f,x,b,p,A,this.worldview),this.elevationBufferData.populatePaintArrays(a,f,x,b,p,A,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(a,c,f,p,x){this.elevatedStructures&&(this.elevatedStructures.construct(a),this.elevatedStructures.populatePaintArrays(c,f,p,x,this.worldview))}addElevatedRoadFeature(a,c,f,p,x){const b=new Array,A=Zr.getElevationFeature(a,x);if(!A)return void this.addGeometry(c,this.bufferData);{const M=this.clipPolygonsToTile(c,1);M.length>0&&b.push({polygons:M,elevationFeature:A,elevationTileID:f})}const k={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(a,{},f),featureIndex:p};for(const M of b)if(M.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Ol(M.elevationTileID,this.layers,this.zoom,this.lut));const V=M.elevationFeature.isTunnel();let q=0;a.properties.hasOwnProperty(fr)&&(q=+a.properties[fr]);for(const X of M.polygons)this.elevatedStructures.addPortalCandidates(M.elevationFeature.id,X,V,M.elevationFeature,q)}M.elevationFeature.constantHeight==null&&(M.polygons=this.prepareElevatedPolygons(M.polygons,M.elevationFeature,M.elevationTileID));const $=new zn(f,M.elevationTileID);this.addElevatedGeometry(M.polygons,$,M.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,p,k)}}addElevatedGeometry(a,c,f,p,x,b){const A={elevation:f,elevationSampler:c,bias:p,index:x,featureInfo:b},[k,M]=this.addGeometry(a,this.elevationBufferData,A);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:k,max:M}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,k),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,M))}addGeometry(a,c,f){let p=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,b=null;f&&(b=f.elevationSampler.constantElevation(f.elevation,f.bias),b!=null&&(p=b,x=b));const A=(k,M,$)=>{if(f!=null)if(M.push(k),b!=null)c.elevatedLayoutVertexArray.emplaceBack(b),$.push(b);else{const V=f.elevationSampler.pointElevation(k,f.elevation,f.bias);c.elevatedLayoutVertexArray.emplaceBack(V),$.push(V),p=Math.min(p,V),x=Math.max(x,V)}};for(const k of a){let M=0;for(const Ee of k)M+=Ee.length;const $=c.triangleSegments.prepareSegment(M,c.layoutVertexArray,c.indexArray),V=$.vertexLength,q=[],X=[],Y=[],se=[],ce=[],he=c.layoutVertexArray.length;for(const Ee of k){if(Ee.length===0)continue;Ee!==k[0]&&X.push(q.length/2);const Oe=c.lineSegments.prepareSegment(Ee.length,c.layoutVertexArray,c.lineIndexArray),Ue=Oe.vertexLength;f&&ce.push(c.layoutVertexArray.length-he),A(Ee[0],Y,se),c.layoutVertexArray.emplaceBack(Ee[0].x,Ee[0].y),c.lineIndexArray.emplaceBack(Ue+Ee.length-1,Ue),q.push(Ee[0].x),q.push(Ee[0].y);for(let Fe=1;Fe<Ee.length;Fe++)A(Ee[Fe],Y,se),c.layoutVertexArray.emplaceBack(Ee[Fe].x,Ee[Fe].y),c.lineIndexArray.emplaceBack(Ue+Fe-1,Ue+Fe),q.push(Ee[Fe].x),q.push(Ee[Fe].y);Oe.vertexLength+=Ee.length,Oe.primitiveLength+=Ee.length}const be=V_(q,X);for(let Ee=0;Ee<be.length;Ee+=3)c.indexArray.emplaceBack(V+be[Ee],V+be[Ee+1],V+be[Ee+2]);if(be.length>0&&f&&this.elevationMode==="hd-road-base"){const Ee=f.elevation.isTunnel(),Oe=f.elevation.safeArea,Ue=this.elevatedStructures.addVertices(Y,se);this.elevatedStructures.addTriangles(be,Ue,Ee);const Fe=ce.length;if(Fe>0){for(let Ke=0;Ke<Fe-1;Ke++)this.elevatedStructures.addRenderableRing(f.index,ce[Ke]+Ue,ce[Ke+1]-ce[Ke],Ee,Oe,f.featureInfo);this.elevatedStructures.addRenderableRing(f.index,ce[Fe-1]+Ue,Y.length-ce[Fe-1],Ee,Oe,f.featureInfo)}}$.vertexLength+=M,$.primitiveLength+=be.length/3}return[p,x]}prepareElevatedPolygons(a,c,f){const p=1/We(f),x=[];for(const b of a){const A=Tue(b,new Mi(c,p));x.push(...A)}return x}clipPolygonsToTile(a,c){const f=-c,p=-c,x=Jt+c,b=Jt+c;let A=0;const k=[],M=[];for(;A<a.length;A++){const q=a[A],X=Mg(q);(X.min.x>=f&&X.max.x<=x&&X.min.y>=p&&X.max.y<=b?k:M).push(q)}if(k.length===a.length)return a;const $=[new Mt(f,p),new Mt(x,p),new Mt(x,b),new Mt(f,b),new Mt(f,p)],V=k;for(const q of M)V.push(...Eue(q,$));return V}}let B$,$$,U$,V$;gr(Uj,"FillBucket",{omit:["layers","patternFeatures"]}),gr($j,"FillBufferData"),gr(Ol,"ElevatedStructures");class fA{constructor(a,c,f,p){if(this.triangleCount=c.length/3,this.min=new Mt(0,0),this.max=new Mt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||a.length===0)return;const[x,b]=[a[0].clone(),a[0].clone()];for(let V=1;V<a.length;++V){const q=a[V];x.x=Math.min(x.x,q.x),x.y=Math.min(x.y,q.y),b.x=Math.max(b.x,q.x),b.y=Math.max(b.y,q.y)}if(p){const V=Math.ceil(Math.max(b.x-x.x,b.y-x.y)/p);f=Math.max(f,V)}if(f===0)return;this.min=x,this.max=b;const A=this.max.sub(this.min);A.x=Math.max(A.x,1),A.y=Math.max(A.y,1);const k=Math.max(A.x,A.y)/f;this.cellsX=Math.max(1,Math.ceil(A.x/k)),this.cellsY=Math.max(1,Math.ceil(A.y/k)),this.xScale=1/k,this.yScale=1/k;const M=[];for(let V=0;V<this.triangleCount;V++){const q=a[c[3*V+0]].sub(this.min),X=a[c[3*V+1]].sub(this.min),Y=a[c[3*V+2]].sub(this.min),se=Yd(Math.floor(Math.min(q.x,X.x,Y.x)),this.xScale,this.cellsX),ce=Yd(Math.floor(Math.max(q.x,X.x,Y.x)),this.xScale,this.cellsX),he=Yd(Math.floor(Math.min(q.y,X.y,Y.y)),this.yScale,this.cellsY),be=Yd(Math.floor(Math.max(q.y,X.y,Y.y)),this.yScale,this.cellsY),Ee=new Mt(0,0),Oe=new Mt(0,0),Ue=new Mt(0,0),Fe=new Mt(0,0);for(let Ke=he;Ke<=be;++Ke){Ee.y=Oe.y=Ke*k,Ue.y=Fe.y=(Ke+1)*k;for(let Qe=se;Qe<=ce;++Qe)Ee.x=Ue.x=Qe*k,Oe.x=Fe.x=(Qe+1)*k,(Aa(q,X,Y,Ee,Oe,Fe)||Aa(q,X,Y,Ee,Fe,Ue))&&M.push({cellIdx:Ke*this.cellsX+Qe,triIdx:V})}}if(M.length===0)return;M.sort((V,q)=>V.cellIdx-q.cellIdx||V.triIdx-q.triIdx);let $=0;for(;$<M.length;){const V=M[$].cellIdx,q={start:this.payload.length,len:0};for(;$<M.length&&M[$].cellIdx===V;)++q.len,this.payload.push(M[$++].triIdx);this.cells[V]=q}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(a,c){if(this.triangleCount===0||this.cells.length===0||a.x>this.max.x||this.min.x>a.x||a.y>this.max.y||this.min.y>a.y)return;const f=Yd(a.x-this.min.x,this.xScale,this.cellsX),p=Yd(a.y-this.min.y,this.yScale,this.cellsY),x=this.cells[p*this.cellsX+f];if(x){this._lazyInitLookup();for(let b=0;b<x.len;b++){const A=this.payload[x.start+b],k=Math.floor(A/8),M=1<<A%8;if(!(this.lookup[k]&M)&&(this.lookup[k]|=M,c.push(A),c.length===this.triangleCount))return}}}query(a,c,f){if(this.triangleCount===0||this.cells.length===0||a.x>this.max.x||this.min.x>c.x||a.y>this.max.y||this.min.y>c.y)return;this._lazyInitLookup();const p=Yd(a.x-this.min.x,this.xScale,this.cellsX),x=Yd(c.x-this.min.x,this.xScale,this.cellsX),b=Yd(a.y-this.min.y,this.yScale,this.cellsY),A=Yd(c.y-this.min.y,this.yScale,this.cellsY);for(let k=b;k<=A;k++)for(let M=p;M<=x;M++){const $=this.cells[k*this.cellsX+M];if($)for(let V=0;V<$.len;V++){const q=this.payload[$.start+V],X=Math.floor(q/8),Y=1<<q%8;if(!(this.lookup[X]&Y)&&(this.lookup[X]|=Y,f.push(q),f.length===this.triangleCount))return}}}}function Yd(u,a,c){return Math.max(0,Math.min(c-1,Math.floor(u*a)))}gr(fA,"TriangleGridIndex");class q${constructor(a){this.zoom=a.zoom,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.footprints=[],this.worldview=a.worldview,this.hasAppearances=null}updateFootprints(a,c){for(const f of this.footprints)c.push({footprint:f,id:a})}updateAppearances(a,c,f,p){}populate(a,c,f,p){const x=[];for(const{feature:b,id:A,index:k,sourceLayerIndex:M}of a){const $=this.layers[0]._featureFilter.needGeometry,V=gt(b,$);if(!this.layers[0]._featureFilter.filter(new Ri(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),V,f))continue;const q={id:A,properties:b.properties,type:b.type,sourceLayerIndex:M,index:k,geometry:$?V.geometry:kt(b,f,p),patterns:{}};x.push(q)}for(const b of x){const{geometry:A,index:k,sourceLayerIndex:M}=b;this.addFeature(b,A,k,f,{},c.availableImages,c.brightness),c.featureIndex.insert(a[k].feature,A,k,M,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(a){}update(a,c,f,p,x,b,A){}destroy(){}addFeature(a,c,f,p,x,b=[],A){for(const k of y1(c,2)){const M=[],$=[],V=[],q=new Mt(1/0,1/0),X=new Mt(-1/0,-1/0);for(const ce of k)if(ce.length!==0){ce!==k[0]&&V.push($.length/2);for(let he=0;he<ce.length;he++)$.push(ce[he].x),$.push(ce[he].y),M.push(ce[he]),q.x=Math.min(q.x,ce[he].x),q.y=Math.min(q.y,ce[he].y),X.x=Math.max(X.x,ce[he].x),X.y=Math.max(X.y,ce[he].y)}const Y=V_($,V),se=new fA(M,Y,8,256);this.footprints.push({vertices:M,indices:Y,grid:se,min:q,max:X})}}}gr(q$,"ClipBucket",{omit:["layers"]});const Aue=Tn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Pue=Tn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Cue=Tn([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),Oue=Tn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),kue=Tn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Iue=Tn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Rue=Tn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:jue}=Aue,v1=Number.MAX_SAFE_INTEGER,W$=v1-1;function G$(u,a,c,f){return u.order<a||u.order===v1||!(u.clipMask&c)||function(p,x){return x.length!==0&&x.find(b=>b===p)===void 0}(f,u.clipScope)}function pA(u,a){return u.x-a.x||u.y-a.y}function H$(u,a){return pA(u.min,a.min)===0&&pA(u.max,a.max)===0}function Vj(u,a){return!(u.min.x>a.max.x||u.max.x<a.min.x||u.min.y>a.max.y||u.max.y<a.min.y)}function mA(u,a){if(u.length!==a.length)return!1;for(let c=0;c<u.length;c++)if(u[c].sourceId!==a[c].sourceId||!H$(u[c],a[c])||u[c].order!==a[c].order||u[c].clipMask!==a[c].clipMask||!Vo(u[c].clipScope,a[c].clipScope))return!1;return!0}function K$(u,a,c){const f=1/Jt,p=1/(1<<c.canonical.z),x=(a.x*f+c.canonical.x)*p+c.wrap,b=(a.y*f+c.canonical.y)*p;return{min:new Mt((u.x*f+c.canonical.x)*p+c.wrap,(u.y*f+c.canonical.y)*p),max:new Mt(x,b)}}function Nue(u,a,c){const f=1<<c.canonical.z,p=((a.x-c.wrap)*f-c.canonical.x)*Jt,x=(a.y*f-c.canonical.y)*Jt;return{min:new Mt(((u.x-c.wrap)*f-c.canonical.x)*Jt,(u.y*f-c.canonical.y)*Jt),max:new Mt(p,x)}}function qj(u,a,c,f,p,x,b){const A=u.indices,k=u.vertices,M=[];for(let $=f;$<f+p;$+=3){const V=a[c[$+0]+x],q=a[c[$+1]+x],X=a[c[$+2]+x],Y=Math.min(V.x,q.x,X.x),se=Math.max(V.x,q.x,X.x),ce=Math.min(V.y,q.y,X.y),he=Math.max(V.y,q.y,X.y);M.length=0,u.grid.query(new Mt(Y,ce),new Mt(se,he),M);for(let be=0;be<M.length;be++){const Ee=M[be];if(Aa(k[A[3*Ee+0]],k[A[3*Ee+1]],k[A[3*Ee+2]],V,q,X,b))return!0}}return!1}function Z$(u,a,c,f){if(!u||!c)return!1;let p=u.vertices;if(!a.canonical.equals(f.canonical)||a.wrap!==f.wrap){if(c.vertices.length<u.vertices.length)return Z$(c,f,u,a);const x=a.canonical,b=f.canonical,A=Math.pow(2,b.z-x.z);p=u.vertices.map(k=>new Mt((k.x+x.x*Jt)*A-b.x*Jt,(k.y+x.y*Jt)*A-b.y*Jt))}return qj(c,p,u.indices,0,u.indices.length,0,0)}function X$(u,a,c,f){const p=Math.pow(2,f.z-c.z);return new Mt((u+c.x*Jt)*p-f.x*Jt,(a+c.y*Jt)*p-f.y*Jt)}function Wj(u,a){const c=[];a.grid.queryPoint(u,c);const f=a.indices,p=a.vertices;for(let x=0;x<c.length;x++){const b=c[x];if(mo([p[f[3*b+0]],p[f[3*b+1]],p[f[3*b+2]]],u))return!0}return!1}const Gj=[new Mt(0,0),new Mt(Jt,0),new Mt(Jt,Jt),new Mt(0,Jt)];function Y$(u,a){const c=[];let f=[];if(!a||u.length<2)return[u];if(u.length===2)return wa(u[0],u[1],Gj)?[u]:[];for(let p=0;p<u.length+2;p++){const x=u[p%u.length],b=u[(p+1)%u.length],A=wa(p===0?u[u.length-1]:u[(p-1)%u.length],x,Gj),k=wa(x,b,Gj),M=A||k;M&&f.push(x),M&&k||f.length>0&&(f.length>1&&c.push(f),f=[])}return f.length>1&&c.push(f),c}const Hj=Lt.types,Mue=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Due=["fill-extrusion-flood-light-ground-radius"],Lue=Math.pow(2,13),Fue=Math.pow(2,15)-1,J$=new Mt(0,1),Mp=2147483648,Q$=7,eU=450;function _1(u,a,c,f,p,x,b,A){u.emplaceBack((a<<1)+b,(c<<1)+x,(Math.floor(f*Lue)<<1)+p,Math.round(A))}function x1(u,a,c){u.emplaceBack(a.x*Jt,a.y*Jt,c?1:0)}function gA(u,a,c,f,p,x){u.emplaceBack(a.x,a.y,(c.x<<1)+f,(c.y<<1)+p,x)}function b1(u,a,c){u.emplaceBack(a.x,a.y,a.z,c[0]*16384,c[1]*16384,c[2]*16384)}class tU{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class rU{constructor(){this.centroidXY=new Mt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Mt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Mt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Mt(this.max.x-this.min.x,this.max.y-this.min.y)}}class nU{constructor(){this.acc=new Mt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(a,c){a.min.x===Number.MAX_VALUE&&(a.min.x=a.max.x=c.x,a.min.y=a.max.y=c.y)}appendEdge(a,c,f){this.accCount++,this.acc._add(c);let p=!!this.borders;c.x<a.min.x?(a.min.x=c.x,p=!0):c.x>a.max.x&&(a.max.x=c.x,p=!0),c.y<a.min.y?(a.min.y=c.y,p=!0):c.y>a.max.y&&(a.max.y=c.y,p=!0),((c.x===0||c.x===Jt)&&c.x===f.x)!=((c.y===0||c.y===Jt)&&c.y===f.y)&&this.processBorderOverlap(c,f),p&&this.checkBorderIntersection(c,f)}checkBorderIntersection(a,c){c.x<0!=a.x<0&&this.addBorderIntersection(0,qr(c.y,a.y,(0-c.x)/(a.x-c.x))),c.x>Jt!=a.x>Jt&&this.addBorderIntersection(1,qr(c.y,a.y,(Jt-c.x)/(a.x-c.x))),c.y<0!=a.y<0&&this.addBorderIntersection(2,qr(c.x,a.x,(0-c.y)/(a.y-c.y))),c.y>Jt!=a.y>Jt&&this.addBorderIntersection(3,qr(c.x,a.x,(Jt-c.y)/(a.y-c.y)))}addBorderIntersection(a,c){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const f=this.borders[a];c<f[0]&&(f[0]=c),c>f[1]&&(f[1]=c)}processBorderOverlap(a,c){if(a.x===c.x){if(a.y===c.y)return;const f=a.x===0?0:1;this.addBorderIntersection(f,c.y),this.addBorderIntersection(f,a.y)}else{const f=a.y===0?2:3;this.addBorderIntersection(f,c.x),this.addBorderIntersection(f,a.x)}}centroid(){return this.accCount===0?new Mt(0,0):new Mt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((a,c)=>a+ +(c[0]!==Number.MAX_VALUE),0):0}}function iU(u,a){const c=u.add(a)._unit(),f=ve(u.x*c.x+u.y*c.y,-1,1);var p,x,b;return p=Math.acos(f),Math.min(4,Math.max(-4,Math.tan(p)))/4*Fue*((x=u).x*(b=a).y-x.y*b.x<0?-1:1)}const zue=[u=>u.x<0,u=>u.x>Jt,u=>u.y<0,u=>u.y>Jt];function Bue(u,a,c,f){const p=[4];if(f===0)return p;c._mult(f);const x=u.sub(c),b=a.sub(c),A=[u,a,x,b];for(let k=0;k<4;k++)for(const M of A)if(zue[k](M)){p.push(k);break}return p}class Kj{constructor(a){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new C_,this.indexArray=new Gi,this.programConfigurations=new Ic(a.layers,{zoom:a.zoom,lut:a.lut},c=>Due.includes(c)),this._segments=new ta,this.hiddenByLandmarkVertexArray=new M_,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ta}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(a,c,f,p=!1){const x=a.length;if(x>2){let b=Math.max(0,this._segments.get().length-1);const A=this._segments._prepareSegment(4*x,this.vertexArray.length,2*this._segmentToGroundQuads[b].length);let k;b!==this._segments.get().length-1&&(b++,this._segmentToGroundQuads[b]=[],this._segmentToRegionTriCounts[b]=[0,0,0,0,0]);{const M=a[0],$=a[1];k=iU(M.sub(a[x-1])._perp()._unit(),$.sub(M)._perp()._unit())}for(let M=0;M<x;M++){const $=M===x-1?0:M+1,V=a[M],q=a[$],X=a[$===x-1?0:$+1],Y=q.sub(V)._perp()._unit(),se=iU(Y,X.sub(q)._perp()._unit()),ce=k,he=se;if(Zj(V,q,c)||p&&sU(V,c)&&sU(q,c)){k=se;continue}const be=A.vertexLength;gA(this.vertexArray,V,q,1,1,ce),gA(this.vertexArray,V,q,1,0,ce),gA(this.vertexArray,V,q,0,1,he),gA(this.vertexArray,V,q,0,0,he),A.vertexLength+=4;const Ee=Bue(V,q,Y,f);for(const Oe of Ee)this._segmentToGroundQuads[b].push({id:be,region:Oe}),this._segmentToRegionTriCounts[b][Oe]+=2,A.primitiveLength+=2;k=se}}}prepareBorderSegments(){if(!this.hasData())return;const a=this._segments.get(),c=a.length;for(let f=0;f<c;f++)this._segmentToGroundQuads[f].sort((p,x)=>p.region-x.region);for(let f=0;f<c;f++){const p=this._segmentToGroundQuads[f],x=a[f],b=this._segmentToRegionTriCounts[f];b.reduce((k,M)=>k+M,0);let A=0;for(let k=0;k<=4;k++){const M=b[k];if(M!==0){let $=this.regionSegments[k];$||($=this.regionSegments[k]=new ta);const V={vertexOffset:x.vertexOffset,primitiveOffset:x.primitiveOffset+A,vertexLength:x.vertexLength,primitiveLength:M};$.get().push(V)}A+=M}for(let k=0;k<p.length;k++){const M=p[k].id;this.indexArray.emplaceBack(M,M+1,M+3),this.indexArray.emplaceBack(M,M+3,M+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(a,c,f,p,x,b,A){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,a,c,f,p,x,b,void 0,A)}upload(a){this.hasData()&&(this.vertexBuffer=a.createVertexBuffer(this.vertexArray,Pue.members),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=a.createVertexBuffer(this.groundRadiusArray,Cue.members)))}uploadPaintProperties(a){this.hasData()&&this.programConfigurations.upload(a)}update(a,c,f,p,x,b,A,k){this.hasData()&&this.programConfigurations.updatePaintArrays(a,c,f,p,x,b,A,k)}updateHiddenByLandmark(a){this.updateHiddenByLandmarkRange(a.groundVertexArrayOffset,a.groundVertexCount,!!(a.flags&Mp))}updateHiddenByLandmarkRange(a,c,f){if(!this.hasData())return;const p=c+a;if(c!==0){for(let x=a;x<p;++x)this.hiddenByLandmarkVertexArray.emplace(x,f?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(a){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=a.createVertexBuffer(this.hiddenByLandmarkVertexArray,Iue.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let a=0;a<=4;a++){const c=this.regionSegments[a];c&&c.destroy()}}}}class yA{constructor(a){this.zoom=a.zoom,this.canonical=a.canonical,this.overscaling=a.overscaling,this.layers=a.layers,this.pixelRatio=a.pixelRatio,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=a.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Gi,this.footprintVertices=new Ls,this.footprintSegments=[],this.layoutVertexArray=new Sp,this.centroidVertexArray=new J2,this.wallVertexArray=new eA,this.indexArray=new Gi,this.programConfigurations=new Ic(a.layers,{zoom:a.zoom,lut:a.lut},c=>Mue.includes(c)),this.segments=new ta,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.groundEffect=new Kj(a),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=a.worldview,this.hasAppearances=null}updateFootprints(a,c){}updateAppearances(a,c,f,p){}populate(a,c,f,p){this.features=[],this.hasPattern=Fj("fill-extrusion",this.layers,this.pixelRatio,c),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=We(f),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:x,id:b,index:A,sourceLayerIndex:k}of a){const M=this.layers[0]._featureFilter.needGeometry,$=gt(x,M);if(!this.layers[0]._featureFilter.filter(new Ri(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),$,f))continue;const V={id:b,sourceLayerIndex:k,index:A,geometry:M?$.geometry:kt(x,f,p),properties:x.properties,type:x.type,patterns:{}},q=this.layoutVertexArray.length,X=Hj[V.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:x.id,feature:zj("fill-extrusion",this.layers,V,this.zoom,this.pixelRatio,c)});else if(this.wallMode)for(const Y of V.geometry)for(const se of Y$(Y,X))this.addFeature(x.id,V,[se],A,f,{},c.availableImages,p,c.brightness);else this.addFeature(x.id,V,V.geometry,A,f,{},c.availableImages,p,c.brightness);c.featureIndex.insert(x,V.geometry,A,k,this.index,q)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(a,c,f,p,x,b){for(const{featureId:A,feature:k}of this.features){const M=Hj[k.type]==="Polygon",{geometry:$}=k;if(this.wallMode)for(const V of $)for(const q of Y$(V,M))this.addFeature(A,k,[q],k.index,c,f,p,x,b);else this.addFeature(A,k,$,k.index,c,f,p,x,b)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(a,c,f,p,x,b,A){this.programConfigurations.updatePaintArrays(a,c,x,f,p,b,A,this.worldview),this.groundEffect.update(a,c,x,f,p,b,A,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,jue),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.wallVertexBuffer=a.createVertexBuffer(this.wallVertexArray,kue.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=a.createVertexBuffer(this.layoutVertexExtArray,Rue.members,!0)),this.groundEffect.upload(a)),this.groundEffect.uploadPaintProperties(a),this.programConfigurations.upload(a),this.uploaded=!0}uploadCentroid(a){this.groundEffect.uploadHiddenByLandmark(a),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,Oue.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,c,f,p,x,b,A,k,M){const $=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(c,{})/this.tileToMeter,V=[new Mt(0,0),new Mt(Jt,Jt)],q=k.projection,X=q.name==="globe",Y=this.wallMode||Hj[c.type]==="Polygon",se=new nU;se.centroidDataIndex=this.centroidData.length;const ce=new rU;ce.buildingId=a,c.properties&&c.properties.hasOwnProperty("building_id")&&(ce.buildingId=c.properties.building_id);const he=this.layers[0].paint.get("fill-extrusion-base").evaluate(c,{},x)<=0,be=this.layers[0].paint.get("fill-extrusion-height").evaluate(c,{},x);let Ee;if(ce.height=be,ce.vertexArrayOffset=this.layoutVertexArray.length,ce.groundVertexArrayOffset=this.groundEffect.vertexArray.length,X&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new k_),this.wallMode){if(X)return void Ir("Non zero fill-extrusion-line-width is not yet supported on globe.");if(f.length!==1)return;Ee=function(ft){const Tt=ft[0].x===ft[ft.length-1].x&&ft[0].y===ft[ft.length-1].y;(function(ur){let ar=0;const Xr=ur.length;for(let sr=0;sr<Xr;sr++)ar+=(ur[(sr+1)%Xr].x-ur[sr].x)*(ur[(sr+1)%Xr].y+ur[sr].y);return ar>=0})(ft)||(ft=ft.reverse());const Dt={geometry:[],joinNormals:[],indices:[]},Xt=[],Vt=[],jt=[];let $t=ft.length;for(;$t>=2&&ft[$t-1].equals(ft[$t-2]);)$t--;if($t<(Tt?3:2))return Dt;let xt,vt,zt,Ht,Nt,pr=0;for(;pr<$t-1&&ft[pr].equals(ft[pr+1]);)pr++;Tt&&(xt=ft[$t-2],Nt=ft[pr].sub(xt)._unit()._perp());for(let ur=pr;ur<$t;ur++){if(zt=ur===$t-1?Tt?ft[pr+1]:void 0:ft[ur+1],zt&&ft[ur].equals(zt))continue;Nt&&(Ht=Nt),xt&&(vt=xt),xt=ft[ur],Nt=zt?zt.sub(xt)._unit()._perp():Ht,Ht=Ht||Nt;let ar=Ht.add(Nt);ar.x===0&&ar.y===0||ar._unit();const Xr=ar.x*Nt.x+ar.y*Nt.y,sr=Xr!==0?1/Xr:1/0,Or=Ht.x*Nt.y-Ht.y*Nt.x>0;let Qr="miter";const vn=2;Qr==="miter"&&sr>vn&&(Qr="bevel"),Qr==="bevel"&&(sr>100&&(Qr="flipbevel"),sr<vn&&(Qr="miter"));const Bn=(nn,Hn,Kn,Yi)=>{const ze=new Mt(nn.x,nn.y),Ne=new Mt(nn.x,nn.y);ze.x+=Hn.x*Yi,ze.y+=Hn.y*Yi,Ne.x-=Hn.x*Math.max(Kn,1),Ne.y-=Hn.y*Math.max(Kn,1),jt.push(Hn),Xt.push(ze),Vt.push(Ne)};if(Qr==="miter")ar._mult(sr),Bn(xt,ar,0,0);else if(Qr==="flipbevel")ar=Nt.mult(-1),Bn(xt,ar,0,0),Bn(xt,ar.mult(-1),0,0);else{const nn=-Math.sqrt(sr*sr-1),Hn=Or?nn:0,Kn=Or?0:nn;vt&&Bn(xt,Ht,Hn,Kn),zt&&Bn(xt,Nt,Hn,Kn)}}Dt.geometry=[...Xt,...Vt.reverse(),Xt[0]],Dt.joinNormals=[...jt,...jt.reverse(),jt[jt.length-1]];const _r=Dt.geometry.length-1;for(let ur=0;ur<_r/2;ur++)if(ur+1<_r/2){let ar=ur,Xr=ur+1,sr=_r-1-ur,Or=_r-2-ur;ar=ar===0?_r-1:ar-1,Xr=Xr===0?_r-1:Xr-1,sr=sr===0?_r-1:sr-1,Or=Or===0?_r-1:Or-1,Dt.indices.push(sr),Dt.indices.push(Xr),Dt.indices.push(ar),Dt.indices.push(sr),Dt.indices.push(Or),Dt.indices.push(Xr)}return Dt}(f[0]),f=[Ee.geometry]}const Oe=(ft,Tt)=>ft<(Tt.length-1)/2||ft===Tt.length-1,Ue=this.wallMode?[f]:y1(f,500);for(let ft=Ue.length-1;ft>=0;ft--){const Tt=Ue[ft];(Tt.length===0||(Fe=Tt[0]).every(It=>It.x<=0)||Fe.every(It=>It.x>=Jt)||Fe.every(It=>It.y<=0)||Fe.every(It=>It.y>=Jt))&&Ue.splice(ft,1)}var Fe;let Ke;if(X)Ke=dU(Ue,V,x);else{Ke=[];for(const ft of Ue)Ke.push({polygon:ft,bounds:V})}const Qe=Y?this.edgeRadius:0,nt=Qe>0&&this.zoom<17,Et=(ft,Tt)=>{if(ft.length===0)return!1;const It=ft[ft.length-1];return Tt.x===It.x&&Tt.y===It.y};for(const{polygon:ft,bounds:Tt}of Ke){let It=0,Dt=0;for(const $t of ft)Y&&!$t[0].equals($t[$t.length-1])&&$t.push($t[0]),Dt+=Y?$t.length-1:$t.length;const Xt=this.segments.prepareSegment((Y?5:4)*Dt,this.layoutVertexArray,this.indexArray);ce.footprintSegIdx<0&&(ce.footprintSegIdx=this.footprintSegments.length),ce.polygonSegIdx<0&&(ce.polygonSegIdx=this.polygonSegments.length);const Vt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},jt=new tU;if(jt.vertexOffset=this.footprintVertices.length,jt.indexOffset=3*this.footprintIndices.length,jt.ringIndices=[],Y){const $t=[],xt=[];It=Xt.vertexLength;for(let zt=0;zt<ft.length;zt++){const Ht=ft[zt];Ht.length&&zt!==0&&xt.push($t.length/2);const Nt=[];let pr,_r;pr=Ht[1].sub(Ht[0])._perp()._unit(),jt.ringIndices.push(Ht.length-1);for(let ur=1;ur<Ht.length;ur++){const ar=Ht[ur],Xr=Ht[ur===Ht.length-1?1:ur+1],sr=ar.clone();if(Qe){_r=Xr.sub(ar)._perp()._unit();const Or=pr.add(_r)._unit(),Qr=Qe*Math.min(4,1/(pr.x*Or.x+pr.y*Or.y));sr.x+=Qr*Or.x,sr.y+=Qr*Or.y,sr.x=Math.round(sr.x),sr.y=Math.round(sr.y),pr=_r}if(!he||Qe!==0&&!nt||Et(Nt,sr)||Nt.push(sr),_1(this.layoutVertexArray,sr.x,sr.y,0,0,1,1,0),this.wallMode){const Or=Oe(ur,Ht);x1(this.wallVertexArray,Ee.joinNormals[ur],!Or)}Xt.vertexLength++,this.footprintVertices.emplaceBack(ar.x,ar.y),$t.push(ar.x,ar.y),X&&b1(this.layoutVertexExtArray,q.projectTilePoint(sr.x,sr.y,x),q.upVector(x,sr.x,sr.y))}he&&(Qe===0||nt)&&(Nt.length!==0&&Et(Nt,Nt[0])&&Nt.pop(),this.groundEffect.addData(Nt,Tt,$))}const vt=this.wallMode?Ee.indices:V_($t,xt);for(let zt=0;zt<vt.length;zt+=3)this.footprintIndices.emplaceBack(jt.vertexOffset+vt[zt+0],jt.vertexOffset+vt[zt+1],jt.vertexOffset+vt[zt+2]),this.indexArray.emplaceBack(It+vt[zt],It+vt[zt+2],It+vt[zt+1]),Xt.primitiveLength++;jt.indexCount+=vt.length,jt.vertexCount+=this.footprintVertices.length-jt.vertexOffset}for(let $t=0;$t<ft.length;$t++){const xt=ft[$t];se.startRing(ce,xt[0]);let vt=xt.length>4&&lU(xt[xt.length-2],xt[0],xt[1]),zt=Qe?$ue(xt[xt.length-2],xt[0],xt[1],Qe):0;const Ht=[];let Nt,pr,_r;pr=xt[1].sub(xt[0])._perp()._unit();let ur=!0;for(let ar=1,Xr=0;ar<xt.length;ar++){let sr=xt[ar-1],Or=xt[ar];const Qr=xt[ar===xt.length-1?1:ar+1];if(se.appendEdge(ce,Or,sr),Zj(Or,sr,Tt)){Qe&&(pr=Qr.sub(Or)._perp()._unit(),ur=!ur);continue}const vn=Or.sub(sr)._perp(),Bn=vn.x/(Math.abs(vn.x)+Math.abs(vn.y)),nn=vn.y>0?1:0,Hn=sr.dist(Or);if(Xr+Hn>32768&&(Xr=0),Qe){_r=Qr.sub(Or)._perp()._unit();let Ne=oU(sr,Or,Qr,aU(pr,_r),Qe);isNaN(Ne)&&(Ne=0);const Pt=Or.sub(sr)._unit();sr=sr.add(Pt.mult(zt))._round(),Or=Or.add(Pt.mult(-Ne))._round(),zt=Ne,pr=_r,he&&this.zoom>=17&&(Et(Ht,sr)||Ht.push(sr),Et(Ht,Or)||Ht.push(Or))}const Kn=Xt.vertexLength,Yi=xt.length>4&&lU(sr,Or,Qr);let ze=cU(Xr,vt,ur);if(_1(this.layoutVertexArray,sr.x,sr.y,Bn,nn,0,0,ze),_1(this.layoutVertexArray,sr.x,sr.y,Bn,nn,0,1,ze),this.wallMode){const Ne=Oe(ar-1,xt),Pt=Ee.joinNormals[ar-1];x1(this.wallVertexArray,Pt,Ne),x1(this.wallVertexArray,Pt,Ne)}if(Xr+=Hn,ze=cU(Xr,Yi,!ur),vt=Yi,_1(this.layoutVertexArray,Or.x,Or.y,Bn,nn,0,0,ze),_1(this.layoutVertexArray,Or.x,Or.y,Bn,nn,0,1,ze),this.wallMode){const Ne=Oe(ar,xt),Pt=Ee.joinNormals[ar];x1(this.wallVertexArray,Pt,Ne),x1(this.wallVertexArray,Pt,Ne)}if(Xt.vertexLength+=4,this.indexArray.emplaceBack(Kn+0,Kn+1,Kn+2),this.indexArray.emplaceBack(Kn+1,Kn+3,Kn+2),Xt.primitiveLength+=2,Qe){const Ne=It+(ar===1?xt.length-2:ar-2),Pt=ar===1?It:Ne+1;if(this.indexArray.emplaceBack(Kn+1,Ne,Kn+3),this.indexArray.emplaceBack(Ne,Pt,Kn+3),Xt.primitiveLength+=2,Nt===void 0&&(Nt=Kn),!Zj(Qr,xt[ar],Tt)){const nr=ar===xt.length-1?Nt:Xt.vertexLength;this.indexArray.emplaceBack(Kn+2,Kn+3,nr),this.indexArray.emplaceBack(Kn+3,nr+1,nr),this.indexArray.emplaceBack(Kn+3,Pt,nr+1),Xt.primitiveLength+=3}ur=!ur}if(X){const Ne=this.layoutVertexExtArray,Pt=q.projectTilePoint(sr.x,sr.y,x),nr=q.projectTilePoint(Or.x,Or.y,x),Ct=q.upVector(x,sr.x,sr.y),or=q.upVector(x,Or.x,Or.y);b1(Ne,Pt,Ct),b1(Ne,Pt,Ct),b1(Ne,nr,or),b1(Ne,nr,or)}}Y&&(It+=xt.length-1),he&&Qe&&this.zoom>=17&&(Ht.length!==0&&Et(Ht,Ht[0])&&Ht.pop(),this.groundEffect.addData(Ht,Tt,$,Qe>0))}this.footprintSegments.push(jt),Vt.triangleCount=this.indexArray.length-Vt.triangleArrayOffset,this.polygonSegments.push(Vt),++ce.footprintSegLen,++ce.polygonSegLen}if(ce.vertexCount=this.layoutVertexArray.length-ce.vertexArrayOffset,ce.groundVertexCount=this.groundEffect.vertexArray.length-ce.groundVertexArrayOffset,ce.vertexCount!==0){if(ce.centroidXY=se.borders?J$:this.encodeCentroid(se,ce),this.centroidData.push(ce),se.borders){this.featuresOnBorder.push(se);const ft=this.featuresOnBorder.length-1;for(let Tt=0;Tt<se.borders.length;Tt++)se.borders[Tt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Tt].push(ft)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,p,b,A,x,M,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(c,p,b,A,x,M,this.worldview),this.maxHeight=Math.max(this.maxHeight,be)}}sortBorders(){for(let a=0;a<this.borderFeatureIndices.length;a++)this.borderFeatureIndices[a].sort((c,f)=>this.featuresOnBorder[c].borders[a][0]-this.featuresOnBorder[f].borders[a][0])}splitToSubtiles(){const a=[];for(let A=0;A<this.centroidData.length;A++){const k=this.centroidData[A],M=+(k.min.y+k.max.y>Jt),$=2*M+(+(k.min.x+k.max.x>Jt)^M);for(let V=0;V<k.polygonSegLen;V++){const q=k.polygonSegIdx+V;a.push({centroidIdx:A,subtile:$,polygonSegmentIdx:q,triangleSegmentIdx:this.polygonSegments[q].triangleSegIdx})}}const c=new Gi;a.sort((A,k)=>A.triangleSegmentIdx===k.triangleSegmentIdx?A.subtile-k.subtile:A.triangleSegmentIdx-k.triangleSegmentIdx);let f=0,p=0,x=0;for(const A of a){if(A.triangleSegmentIdx!==f)break;x++}const b=a.length;for(;p!==a.length;){f=a[p].triangleSegmentIdx;let A=0,k=p,M=p;for(let $=k;$<x&&a[$].subtile===A;$++)M++;for(;k!==x;){const $=a[k];A=$.subtile;const V=this.centroidData[$.centroidIdx].min.clone(),q=this.centroidData[$.centroidIdx].max.clone(),X={vertexOffset:this.segments.segments[f].vertexOffset,primitiveOffset:c.length,vertexLength:this.segments.segments[f].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let Y=k;Y<M;Y++){const se=a[Y],ce=this.polygonSegments[se.polygonSegmentIdx],he=this.centroidData[se.centroidIdx].min,be=this.centroidData[se.centroidIdx].max,Ee=this.indexArray.uint16;for(let Oe=ce.triangleArrayOffset;Oe<ce.triangleArrayOffset+ce.triangleCount;Oe++)c.emplaceBack(Ee[3*Oe],Ee[3*Oe+1],Ee[3*Oe+2]);X.primitiveLength+=ce.triangleCount,V.x=Math.min(V.x,he.x),V.y=Math.min(V.y,he.y),q.x=Math.max(q.x,be.x),q.y=Math.max(q.y,be.y)}X.primitiveLength>0&&this.triangleSubSegments.push({segment:X,min:V,max:q}),k=M;for(let Y=k;Y<x&&a[Y].subtile===a[k].subtile;Y++)M++}p=x;for(let $=p;$<b&&a[$].triangleSegmentIdx===a[p].triangleSegmentIdx;$++)x++}c._trim(),this.indexArray=c}getVisibleSegments(a,c,f){const p=new ta;if(this.wallMode){for(const se of this.triangleSubSegments)p.segments.push(se.segment);return p}let x=0,b=0;const A=1<<a.canonical.z;if(c){const se=c.getMinMaxForTile(a);se&&(x=se.min,b=se.max)}b+=this.maxHeight;const k=a.toUnwrapped();let M;const $=[k.canonical.x/A+k.wrap,k.canonical.y/A],V=[(k.canonical.x+1)/A+k.wrap,(k.canonical.y+1)/A],q=(se,ce,he)=>[se[0]*(1-he[0])+ce[0]*he[0],se[1]*(1-he[1])+ce[1]*he[1]],X=[],Y=[];for(const se of this.triangleSubSegments){X[0]=se.min.x/Jt,X[1]=se.min.y/Jt,Y[0]=se.max.x/Jt,Y[1]=se.max.y/Jt;const ce=q($,V,X),he=q($,V,Y);if(new gn([ce[0],ce[1],x],[he[0],he[1],b]).intersectsPrecise(f)===0){M&&(p.segments.push(M),M=void 0);continue}const be=se.segment;M&&M.vertexOffset!==be.vertexOffset&&(p.segments.push(M),M=void 0),M?(M.vertexLength+=be.vertexLength,M.primitiveLength+=be.primitiveLength):M={vertexOffset:be.vertexOffset,primitiveLength:be.primitiveLength,vertexLength:be.vertexLength,primitiveOffset:be.primitiveOffset,sortKey:void 0,vaos:{}}}return M&&p.segments.push(M),p}encodeCentroid(a,c){const f=a.centroid(),p=c.span(),x=Math.min(7,Math.round(p.x*this.tileToMeter/10)),b=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new Mt(ve(f.x,1,Jt-1)<<3|x,ve(f.y,1,Jt-1)<<3|b)}encodeBorderCentroid(a){if(!a.borders)return new Mt(0,0);const c=a.borders,f=Number.MAX_VALUE;if(c[0][0]!==f||c[1][0]!==f){const p=c[0][0]!==f?0:1;return new Mt(6|(c[0][0]!==f?0:65528),(c[p][0]+c[p][1])/2<<3|6)}{const p=c[2][0]!==f?2:3;return new Mt((c[p][0]+c[p][1])/2<<3|6,6|(c[2][0]!==f?0:65528))}}showCentroid(a){const c=this.centroidData[a.centroidDataIndex];c.flags&=2147483647,c.centroidXY.x=0,c.centroidXY.y=0,this.writeCentroidToBuffer(c)}writeCentroidToBuffer(a){this.groundEffect.updateHiddenByLandmark(a);const c=a.vertexArrayOffset,f=a.vertexCount+a.vertexArrayOffset,p=a.flags&Mp?J$:a.centroidXY,x=this.centroidVertexArray.geta_centroid_pos0(c);if(this.centroidVertexArray.geta_centroid_pos1(c)!==p.y||x!==p.x){for(let b=c;b<f;++b)this.centroidVertexArray.emplace(b,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const a of this.centroidData)this.writeCentroidToBuffer(a)}updateReplacement(a,c,f){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const p=c.getReplacementRegionsForTile(a.toUnwrapped());if(mA(this.activeReplacements,p))return;if(this.activeReplacements=p,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const b of this.centroidData)b.flags&=2147483647;const x=[];for(const b of this.activeReplacements){if(b.order<f)continue;const A=Math.max(1,Math.pow(2,b.footprintTileId.canonical.z-a.canonical.z));if(b.footprint.buildingId){const k=b.footprint.buildingId;for(const M of this.centroidData)M.buildingId===k&&(M.flags|=Mp)}else for(const k of this.centroidData)if(!(k.flags&Mp||b.min.x>k.max.x||k.min.x>b.max.x||b.min.y>k.max.y||k.min.y>b.max.y))for(let M=0;M<k.footprintSegLen;M++){const $=this.footprintSegments[k.footprintSegIdx+M];if(x.length=0,Uue(this.footprintVertices,$.vertexOffset,$.vertexCount,b.footprintTileId.canonical,a.canonical,x),qj(b.footprint,x,this.footprintIndices.uint16,$.indexOffset,$.indexCount,-$.vertexOffset,-A)){k.flags|=Mp;break}}}for(const b of this.centroidData)this.writeCentroidToBuffer(b);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(a,c,f){let p=!1;for(let x=0;x<f.footprintSegLen;x++){const b=this.footprintSegments[f.footprintSegIdx+x];let A=0;for(const k of b.ringIndices){for(let M=A,$=k+A-1;M<k+A;$=M++){const V=this.footprintVertices.int16[2*(M+b.vertexOffset)+0],q=this.footprintVertices.int16[2*(M+b.vertexOffset)+1],X=this.footprintVertices.int16[2*($+b.vertexOffset)+1];q>c!=X>c&&a<(this.footprintVertices.int16[2*($+b.vertexOffset)+0]-V)*(c-q)/(X-q)+V&&(p=!p)}A=k}}return p}getHeightAtTileCoord(a,c){let f=Number.NEGATIVE_INFINITY,p=!0;const x=4*(a+Jt)*Jt+(c+Jt);if(this.partLookup.hasOwnProperty(x)){const b=this.partLookup[x];return b?{height:b.height,hidden:!!(b.flags&Mp)}:void 0}for(const b of this.centroidData)a>b.max.x||b.min.x>a||c>b.max.y||b.min.y>c||b.height<=f||this.footprintContainsPoint(a,c,b)&&(f=b.height,this.partLookup[x]=b,p=!!(b.flags&Mp));if(f!==Number.NEGATIVE_INFINITY)return{height:f,hidden:p};this.partLookup[x]=void 0}}function aU(u,a){const c=u.add(a)._unit();return u.x*c.x+u.y*c.y}function $ue(u,a,c,f){const p=a.sub(u)._perp()._unit(),x=c.sub(a)._perp()._unit();return oU(u,a,c,aU(p,x),f)}function oU(u,a,c,f,p){const x=Math.sqrt(1-f*f);return Math.min(u.dist(a)/3,a.dist(c)/3,p*x/f)}function Zj(u,a,c){return u.x<c[0].x&&a.x<c[0].x||u.x>c[1].x&&a.x>c[1].x||u.y<c[0].y&&a.y<c[0].y||u.y>c[1].y&&a.y>c[1].y}function sU(u,a){return u.x<a[0].x||u.x>a[1].x||u.y<a[0].y||u.y>a[1].y}function lU(u,a,c){if(u.x<0||u.x>=Jt||a.x<0||a.x>=Jt||c.x<0||c.x>=Jt)return!1;const f=c.sub(a),p=f.perp(),x=u.sub(a);return(f.x*x.x+f.y*x.y)/Math.sqrt((f.x*f.x+f.y*f.y)*(x.x*x.x+x.y*x.y))>-.866&&p.x*x.x+p.y*x.y<0}function cU(u,a,c){const f=a?2|u:-3&u;return c?1|f:-2&f}function uU(){const u=Math.PI/32,a=Math.tan(u),c=G;return c*Math.sqrt(1+2*a*a)-c}function dU(u,a,c){const f=1<<c.z,p=ke(c.x/f),x=ke((c.x+1)/f),b=Te(c.y/f),A=Te((c.y+1)/f);return function(k,M,$,V,q=0,X){const Y=[];if(!k.length||!$||!V)return Y;const se=(Fe,Ke)=>{for(const Qe of Fe)Y.push({polygon:Qe,bounds:Ke})},ce=Math.ceil(Math.log2($)),he=Math.ceil(Math.log2(V)),be=ce-he,Ee=[];for(let Fe=0;Fe<Math.abs(be);Fe++)Ee.push(be>0?0:1);for(let Fe=0;Fe<Math.min(ce,he);Fe++)Ee.push(0),Ee.push(1);let Oe=k;if(Oe=hA(Oe,M[0].y-q,M[1].y+q,1),Oe=hA(Oe,M[0].x-q,M[1].x+q,0),!Oe.length)return Y;const Ue=[];for(Ee.length?Ue.push({polygons:Oe,bounds:M,depth:0}):se(Oe,M);Ue.length;){const Fe=Ue.pop(),Ke=Fe.depth,Qe=Ee[Ke],nt=Fe.bounds[0],Et=Fe.bounds[1],ft=Qe===0?nt.x:nt.y,Tt=Qe===0?Et.x:Et.y,It=X?X(Qe,ft,Tt):.5*(ft+Tt),Dt=hA(Fe.polygons,ft-q,It+q,Qe),Xt=hA(Fe.polygons,It-q,Tt+q,Qe);if(Dt.length){const Vt=[nt,new Mt(Qe===0?It:Et.x,Qe===1?It:Et.y)];Ee.length>Ke+1?Ue.push({polygons:Dt,bounds:Vt,depth:Ke+1}):se(Dt,Vt)}if(Xt.length){const Vt=[new Mt(Qe===0?It:nt.x,Qe===1?It:nt.y),Et];Ee.length>Ke+1?Ue.push({polygons:Xt,bounds:Vt,depth:Ke+1}):se(Xt,Vt)}}return Y}(u,a,Math.ceil((x-p)/11.25),Math.ceil((b-A)/11.25),1,(k,M,$)=>{if(k===0)return .5*(M+$);{const V=Te((c.y+M/Jt)/f);return(ge(.5*(Te((c.y+$/Jt)/f)+V))*f-c.y)*Jt}})}function Uue(u,a,c,f,p,x){const b=Math.pow(2,f.z-p.z);for(let A=0;A<c;A++){let k=u.int16[2*(A+a)+0],M=u.int16[2*(A+a)+1];k=(k+p.x*Jt)*b-f.x*Jt,M=(M+p.y*Jt)*b-f.y*Jt,x.push(new Mt(k,M))}}let hU,fU;gr(yA,"FillExtrusionBucket",{omit:["layers","features"]}),gr(rU,"PartData"),gr(tU,"FootprintSegment"),gr(nU,"BorderCentroidData"),gr(Kj,"GroundEffect");class ay extends Mt{constructor(a,c,f){super(a,c),this.z=f}}class pU extends ay{constructor(a,c,f,p){super(a,c,f),this.w=p}}function mU(u,a,c,f){const p=c==="x"?"y":"x",x=(f-u[c])/(a[c]-u[c]);u[p]=Math.round(u[p]+(a[p]-u[p])*x),u[c]=f,u.hasOwnProperty("z")&&(u.z=qr(u.z,a.z,x)),u.hasOwnProperty("w")&&(u.w=qr(u.w,a.w,x))}function gU(u,a,c,f){const p=c,x=f;for(const b of["x","y"]){let A=u,k=a;A[b]>=k[b]&&(A=a,k=u),A[b]<p&&k[b]>p&&mU(A,k,b,p),A[b]<x&&k[b]>x&&mU(k,A,b,x)}}function vA(u,a,c,f,p,x){const b=[];for(let A=0;A<u.length;A++){const k=u[A];let M;const $=b.length;let V=0;for(let q=0;q<k.length-1;q++){let X=k[q],Y=k[q+1],se=0;const ce=V;let he,be;x&&(se=Math.hypot(Y.x-X.x,Y.y-X.y),V+=se,he=X,be=Y),X.x<a&&Y.x<a||(X.x<a?X=new Mt(a,X.y+(a-X.x)/(Y.x-X.x)*(Y.y-X.y))._round():Y.x<a&&(Y=new Mt(a,X.y+(a-X.x)/(Y.x-X.x)*(Y.y-X.y))._round()),X.y<c&&Y.y<c||(X.y<c?X=new Mt(X.x+(c-X.y)/(Y.y-X.y)*(Y.x-X.x),c)._round():Y.y<c&&(Y=new Mt(X.x+(c-X.y)/(Y.y-X.y)*(Y.x-X.x),c)._round()),X.x>=f&&Y.x>=f||(X.x>=f?X=new Mt(f,X.y+(f-X.x)/(Y.x-X.x)*(Y.y-X.y))._round():Y.x>=f&&(Y=new Mt(f,X.y+(f-X.x)/(Y.x-X.x)*(Y.y-X.y))._round()),X.y>=p&&Y.y>=p||(X.y>=p?X=new Mt(X.x+(p-X.y)/(Y.y-X.y)*(Y.x-X.x),p)._round():Y.y>=p&&(Y=new Mt(X.x+(p-X.y)/(Y.y-X.y)*(Y.x-X.x),p)._round()),M&&X.equals(M[M.length-1])||(M=[X],b.push(M),x&&x.push({progress:{min:ce+yU(he,be,X)*se,max:1},parentIndex:A,prevPoint:he,nextPoint:be})),M.push(Y),x&&(x[x.length-1].progress.max=ce+yU(he,be,Y)*se,x[x.length-1].nextPoint=be)))))}if(x&&V>0)for(let q=$;q<b.length;q++)x[q].progress.min/=V,x[q].progress.max/=V}return b}function Vue(u,a,c,f,p){if(u.length<2)return void f.push(u);const x=[];for(;a.valid();){const[M,$]=a.get();for(let V=0;V<u.length-1;V++){const q=u[V],X=u[V+1],Y=El(q,X,M,$);if(Y){const[se]=Y,ce=new Mt(qr(q.x,X.x,se),qr(q.y,X.y,se));x.push({t:V+se,distance:0,point:ce})}}a.next()}if(x.length===0)return void f.push(u);x.sort((M,$)=>M.t-$.t);let b=0,A=0,k=[];for(f.push(k);b!==u.length;){if(A===x.length){for(;b!==u.length;)k.length!==0&&k[k.length-1].equals(u[b])||k.push(u[b]),b++;break}x[A].t<=b?(k.length!==0&&k[k.length-1].equals(x[A].point)||k.push(x[A].point),Math.trunc(x[A].t),A++):(k.length!==0&&k[k.length-1].equals(u[b])||k.push(u[b]),b++)}}function yU(u,a,c){return u.x!==a.x?(c.x-u.x)/(a.x-u.x):u.y!==a.y?(c.y-u.y)/(a.y-u.y):0}function w1(u,a){return u.x*a.x+u.y*a.y}function vU(u,a){if(u.length===1){let c=0;const f=a[c++];let p;for(;!p||f.equals(p);)if(p=a[c++],!p)return 1/0;for(;c<a.length;c++){const x=a[c],b=u[0],A=p.sub(f),k=x.sub(f),M=b.sub(f),$=w1(A,A),V=w1(A,k),q=w1(k,k),X=w1(M,A),Y=w1(M,k),se=$*q-V*V,ce=(q*X-V*Y)/se,he=($*Y-V*X)/se,be=f.z*(1-ce-he)+p.z*ce+x.z*he;if(isFinite(be))return be}return 1/0}{let c=1/0;for(const f of a)c=Math.min(c,f.z);return c}}function _U(u,a,c){let f=1/0;da(c,a)&&(f=vU(c,a[0]));for(let p=0;p<a.length;p++){const x=a[p],b=u[p];for(let A=0;A<x.length-1;A++){const k=x[A],M=[k,x[A+1],b[A+1],b[A],k];ba(c,M)&&(f=Math.min(f,vU(c,M)))}}return f!==1/0&&f}function xU(u,a,c,f,p,x,b,A,k,M,$){return u.projection.name==="globe"?function(V,q,X,Y,se,ce,he,be,Ee,Oe,Ue){const Fe=[],Ke=[],Qe=V.projection.upVectorScale(Ue,V.center.lat,V.worldSize).metersToTile,nt=[0,0,0,1],Et=[0,0,0,1],ft=(It,Dt,Xt,Vt)=>{It[0]=Dt,It[1]=Xt,It[2]=Vt,It[3]=1},Tt=uU();X>0&&(X+=Tt),Y+=Tt;for(const It of q){const Dt=[],Xt=[];for(const Vt of It){const jt=Vt.x+se.x,$t=Vt.y+se.y,xt=V.projection.projectTilePoint(jt,$t,Ue),vt=V.projection.upVector(Ue,Vt.x,Vt.y);let zt=X,Ht=Y;if(he){const Nt=bU(jt,$t,X,Y,he,be,Ee,Oe);zt+=Nt.base,Ht+=Nt.top}X!==0?ft(nt,xt.x+vt[0]*Qe*zt,xt.y+vt[1]*Qe*zt,xt.z+vt[2]*Qe*zt):ft(nt,xt.x,xt.y,xt.z),ft(Et,xt.x+vt[0]*Qe*Ht,xt.y+vt[1]*Qe*Ht,xt.z+vt[2]*Qe*Ht),Ut(nt,nt,ce),Ut(Et,Et,ce),Dt.push(new ay(nt[0],nt[1],nt[2])),Xt.push(new ay(Et[0],Et[1],Et[2]))}Fe.push(Dt),Ke.push(Xt)}return[Fe,Ke]}(u,a,c,f,p,x,b,A,k,M,$):b?function(V,q,X,Y,se,ce,he,be,Ee){const Oe=[],Ue=[],Fe=[0,0,0,1];for(const Ke of V){const Qe=[],nt=[];for(const Et of Ke){const ft=Et.x+Y.x,Tt=Et.y+Y.y,It=bU(ft,Tt,q,X,ce,he,be,Ee);Fe[0]=ft,Fe[1]=Tt,Fe[2]=It.base,Fe[3]=1,er(Fe,Fe,se),Fe[3]=Math.max(Fe[3],1e-5);const Dt=new ay(Fe[0]/Fe[3],Fe[1]/Fe[3],Fe[2]/Fe[3]);Fe[0]=ft,Fe[1]=Tt,Fe[2]=It.top,Fe[3]=1,er(Fe,Fe,se),Fe[3]=Math.max(Fe[3],1e-5);const Xt=new ay(Fe[0]/Fe[3],Fe[1]/Fe[3],Fe[2]/Fe[3]);Qe.push(Dt),nt.push(Xt)}Oe.push(Qe),Ue.push(nt)}return[Oe,Ue]}(a,c,f,p,x,b,A,k,M):function(V,q,X,Y,se){const ce=[],he=[],be=se[8]*q,Ee=se[9]*q,Oe=se[10]*q,Ue=se[11]*q,Fe=se[8]*X,Ke=se[9]*X,Qe=se[10]*X,nt=se[11]*X;for(const Et of V){const ft=[],Tt=[];for(const It of Et){const Dt=It.x+Y.x,Xt=It.y+Y.y,Vt=se[0]*Dt+se[4]*Xt+se[12],jt=se[1]*Dt+se[5]*Xt+se[13],$t=se[2]*Dt+se[6]*Xt+se[14],xt=se[3]*Dt+se[7]*Xt+se[15],vt=Vt+be,zt=jt+Ee,Ht=$t+Oe,Nt=Math.max(xt+Ue,1e-5),pr=Vt+Fe,_r=jt+Ke,ur=$t+Qe,ar=Math.max(xt+nt,1e-5);ft.push(new ay(vt/Nt,zt/Nt,Ht/Nt)),Tt.push(new ay(pr/ar,_r/ar,ur/ar))}ce.push(ft),he.push(Tt)}return[ce,he]}(a,c,f,p,x)}function bU(u,a,c,f,p,x,b,A){const k=b*p.getElevationAt(u,a,!0,!0),M=x[0]!==0,$=M?x[1]===0?b*(x[0]/Q$-eU):b*function(V,q,X){const Y=Math.floor(q[0]/8),se=Math.floor(q[1]/8),ce=10*(q[0]-8*Y),he=10*(q[1]-8*se),be=V.getElevationAt(Y,se,!0,!0),Ee=V.getMeterToDEM(X),Oe=Math.floor(.5*(ce*Ee-1)),Ue=Math.floor(.5*(he*Ee-1)),Fe=V.tileCoordToPixel(Y,se),Ke=2*Oe+1,Qe=2*Ue+1,nt=function(Xt,Vt,jt,$t,xt){return[Xt.getElevationAtPixel(Vt,jt,!0),Xt.getElevationAtPixel(Vt+xt,jt,!0),Xt.getElevationAtPixel(Vt,jt+xt,!0),Xt.getElevationAtPixel(Vt+$t,jt+xt,!0)]}(V,Fe.x-Oe,Fe.y-Ue,Ke,Qe),Et=Math.abs(nt[0]-nt[1]),ft=Math.abs(nt[2]-nt[3]),Tt=Math.abs(nt[0]-nt[2])+Math.abs(nt[1]-nt[3]),It=Math.min(.25,.5*Ee*(Et+ft)/Ke),Dt=Math.min(.25,.5*Ee*Tt/Qe);return be+Math.max(It*ce,Dt*he)}(p,x,A):k;return{base:k+(c===0?-1:c),top:M?Math.max($+f,k+c+2):k+f}}class que{constructor(a){this._callback=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Wue{constructor(){this.tasks={},this.taskQueue=[],yt(["process"],this),this.invoker=new que(this.process),this.nextId=0}add(a,c){const f=this.nextId++,p=function({type:x,isSymbolTile:b,zoom:A}){return A=A||0,x==="message"?0:x!=="maybePrepare"||b?x!=="parseTile"||b?x==="parseTile"&&b?300-A:x==="maybePrepare"&&b?400-A:500:200-A:100-A}(c);if(p===0){try{a()}finally{}return null}return this.tasks[f]={fn:a,metadata:c,priority:p,id:f},this.taskQueue.push(f),this.invoker.trigger(),{cancel:()=>{delete this.tasks[f]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(f=>!!this.tasks[f]),!this.taskQueue.length)return;const a=this.pick();if(a===null)return;const c=this.tasks[a];if(delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),!c)return;c.fn()}finally{}}pick(){let a=null,c=1/0;for(let p=0;p<this.taskQueue.length;p++){const x=this.tasks[this.taskQueue[p]];x.priority<c&&(c=x.priority,a=p)}if(a===null)return null;const f=this.taskQueue[a];return this.taskQueue.splice(a,1),f}remove(){this.invoker.remove()}}class wU{constructor(a,c,f){this.target=a,this.parent=c,this.mapId=f,this.callbacks={},this.cancelCallbacks={},yt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Wue}send(a,c,f,p,x=!1,b){const A=Math.round(1e18*Math.random()).toString(36).substring(0,10);f&&(f.metadata=b,this.callbacks[A]=f);const k=new Set;return this.target.postMessage({id:A,type:a,hasCallback:!!f,targetMapId:p,mustQueue:x,sourceMapId:this.mapId,data:qd(c,k)},k),{cancel:()=>{f&&delete this.callbacks[A],this.target.postMessage({id:A,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(a){const c=a.data;if(!c)return;const f=c.id;if(f&&(!c.targetMapId||this.mapId===c.targetMapId))if(c.type==="<cancel>"){const p=this.cancelCallbacks[f];delete this.cancelCallbacks[f],p&&p.cancel()}else if(c.mustQueue||ca(self)){const p=this.callbacks[f],x=this.scheduler.add(()=>this.processTask(f,c),p&&p.metadata||{type:"message"});x&&(this.cancelCallbacks[f]=x)}else this.processTask(f,c)}processTask(a,c){if(delete this.cancelCallbacks[a],c.type==="<response>"){const f=this.callbacks[a];delete this.callbacks[a],f&&(c.error?f(Wd(c.error)):f(null,Wd(c.data)))}else{const f=new Set,p=c.hasCallback?(b,A)=>{this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:b?qd(b):null,data:qd(A,f)},f)}:()=>{},x=Wd(c.data);if(this.parent[c.type])this.parent[c.type](c.sourceMapId,x,p);else if(this.parent.getWorkerSource){const b=c.type.split("."),{source:A,scope:k}=x;this.parent.getWorkerSource(c.sourceMapId,b[0],A,k)[b[1]](x,p)}else p(new Error(`Could not find function ${c.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var S1={workerUrl:"",workerClass:null,workerParams:void 0};const Xj="mapboxgl_preloaded_worker_pool";class oy{constructor(){this.active={}}acquire(a,c=oy.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<c;)this.workers.push(S1.workerClass!=null?new S1.workerClass:new self.Worker(S1.workerUrl,S1.workerParams));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.workers&&this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Xj]}numActive(){return Object.keys(this.active).length}}oy.workerCount=2;class W_{constructor(a,c,f="Worker",p=oy.workerCount){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=_t();const x=this.workerPool.acquire(this.id,p);for(let b=0;b<x.length;b++){const A=new W_.Actor(x[b],c,this.id);A.name=`${f} ${b}`,this.actors.push(A)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(a,c,f){Ye(this.actors,(p,x)=>{p.send(a,c,x)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}let E1,Yj;function _A(){return E1||(E1=new oy),E1}W_.Actor=wU;class Gue{constructor(a){this.module=a}createIntArray(a){const c=new Int32Array(a),f=this.module.malloc(c.length*c.BYTES_PER_ELEMENT);return this.module.heap32.set(c,f/c.BYTES_PER_ELEMENT),f}createFloatArray(a){const c=new Float32Array(a),f=this.module.malloc(c.length*c.BYTES_PER_ELEMENT);return this.module.heapF32.set(c,f/c.BYTES_PER_ELEMENT),f}createStringBuffer(a){const c=this.module.malloc(a.length+1);for(let f=0;f<a.length;++f)this.module.heapU8[c+f]=a.charCodeAt(f);return this.module.heapU8[c+a.length]=0,c}readStringBuffer(a){let c="";for(;this.module.heapU8[a]!==0;)c+=String.fromCharCode(this.module.heapU8[a]),++a;return c}setStyle(a){const c=a.entranceColorRgb,f=a.facadeGlazingColorRgb,p=a.roofColorRgb,x=a.wallColorRgb,b=a.normalScale;this.module.setStyle(c[0],c[1],c[2],f[0],f[1],f[2],p[0],p[1],p[2],x[0],x[1],x[2],b[0],b[1],b[2],a.tileToMeters)}setAOOptions(a,c){this.module.setAOOptions(a?1:0,c)}setMetricOptions(a,c){this.module.setMetricOptions(a?1:0,c)}setStructuralOptions(a){this.module.setStructuralOptions(a?1:0)}setFacadeOptions(a,c){this.module.setFacadeOptions(a,c?1:0)}setFauxFacadeOptions(a,c,f){this.module.setFauxFacadeOptions(a?1:0,c?1:0,f)}setFacadeClassifierOptions(a){this.module.setFacadeClassifierOptions(a)}generateMesh(a,c){for(const A of a){const k=this.createStringBuffer(A.roofType),M=[0],$=[];for(const X of A.coordinates)if(Array.isArray(X)){for(const Y of X)$.push(Y.x),$.push(Y.y);M.push($.length)}const V=this.createIntArray(M),q=this.createFloatArray($);this.module.addFeature(A.id,A.sourceId,A.minHeight,A.height,k,A.roofType.length,q,V,M.length-1),this.module.free(k),this.module.free(V),this.module.free(q)}for(const A of c){let k;k=A.entrances?JSON.parse(A.entrances):[];const M=this.createFloatArray(k),$=[];for(const q of A.coordinates)$.push(q.x),$.push(q.y);const V=this.createFloatArray($);this.module.addFacade(A.sourceId,A.crossPerc,A.distanceToRoad,M,k.length,V,$.length),this.module.free(M),this.module.free(V)}if(!this.module.generateMesh()){const A=this.module.getLastError();return this.readStringBuffer(A)}const f=this.module.getMeshCount(),p=new Array(f);for(let A=0;A<f;A++){const k=this.module.getPositionsPtr(A),M=this.module.getPositionsLength(A),$=new Float32Array(this.module.heapF32.buffer,k,M),V=this.module.getNormalsPtr(A),q=this.module.getNormalsLength(A),X=new Float32Array(this.module.heapF32.buffer,V,q),Y=this.module.getColorsPtr(A),se=this.module.getColorsLength(A),ce=new Uint8Array(this.module.heapU8.buffer,Y,se),he=this.module.getAOPtr(A),be=this.module.getAOLength(A),Ee=new Float32Array(this.module.heapF32.buffer,he,be),Oe=this.module.getUVPtr(A),Ue=this.module.getUVLength(A),Fe=new Float32Array(this.module.heapF32.buffer,Oe,Ue),Ke=this.module.getFauxFacadePtr(A),Qe=this.module.getFauxFacadeLength(A),nt=new Uint8Array(this.module.heapU8.buffer,Ke,Qe),Et=this.module.getIndicesPtr(A),ft=this.module.getIndicesLength(A),Tt=new Int32Array(this.module.heap32.buffer,Et,ft),It=this.module.getBuildingPart(A),Dt=this.readStringBuffer(It);p[A]={positions:$,normals:X,colors:ce,ao:Ee,uv:Fe,isFauxFacade:nt,indices:Tt,buildingPart:Dt}}const x=this.module.getRingCount(),b=[];for(let A=0;A<x;A++){const k=this.module.getRingPtr(A),M=this.module.getRingLength(A),$=new Float32Array(this.module.heapF32.buffer,k,M);b.push($)}return{meshes:p,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:b}}}let T1,Jj,Ju,G_,Qj,H_=null,K_=null,SU=null,xA=null;function EU(){return ca(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Jj||Bi.DRACO_URL}function TU(){if(ca(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(G_)return G_;const u=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return G_=WebAssembly.validate(u)?Bi.MESHOPT_SIMD_URL:Bi.MESHOPT_URL,G_}function Hue(){return xA}const bA={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Kue={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},A1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function AU(u,a,c){const f=c.json.bufferViews.length,p=c.buffers.length;a.bufferView=f,c.json.bufferViews[f]={buffer:p,byteLength:u.byteLength},c.buffers[p]=u}const eN="KHR_draco_mesh_compression";function Zue(u,a){const c=u.extensions&&u.extensions[eN];if(!c)return;const f=new Ju.Decoder,p=kU(a,c.bufferView),x=new Ju.Mesh;if(!f.DecodeArrayToMesh(p,p.byteLength,x))throw new Error("Failed to decode Draco mesh");const b=a.json.accessors[u.indices],A=bA[b.componentType],k=b.count*A.BYTES_PER_ELEMENT,M=Ju._malloc(k);A===Uint16Array?f.GetTrianglesUInt16Array(x,k,M):f.GetTrianglesUInt32Array(x,k,M),AU(Ju.memory.buffer.slice(M,M+k),b,a),Ju._free(M);for(const $ of Object.keys(c.attributes)){const V=f.GetAttributeByUniqueId(x,c.attributes[$]),q=a.json.accessors[u.attributes[$]],X=Kue[q.componentType],Y=q.count*A1[q.type]*bA[q.componentType].BYTES_PER_ELEMENT,se=Ju._malloc(Y);f.GetAttributeDataArrayForAllPoints(x,V,Ju[X],Y,se),AU(Ju.memory.buffer.slice(se,se+Y),q,a),Ju._free(se)}f.destroy(),x.destroy(),delete u.extensions[eN]}const wA="EXT_meshopt_compression";function Xue(u,a){if(!u.extensions||!u.extensions[wA])return;const c=u.extensions[wA],f=new Uint8Array(a.buffers[c.buffer],c.byteOffset||0,c.byteLength||0),p=new Uint8Array(c.count*c.byteStride);Qj.decodeGltfBuffer(p,c.count,c.byteStride,f,c.mode,c.filter),u.buffer=a.buffers.length,u.byteOffset=0,a.buffers[u.buffer]=p.buffer,delete u.extensions[wA]}const PU=1179937895,CU=new TextDecoder("utf8");function OU(u,a){return new URL(u,a).href}function Yue(u,a,c,f){return fetch(OU(u.uri,f)).then(p=>p.arrayBuffer()).then(p=>{a.buffers[c]=p})}function kU(u,a){const c=u.json.bufferViews[a];return new Uint8Array(u.buffers[c.buffer],c.byteOffset||0,c.byteLength)}function Jue(u,a,c,f){if(u.uri){const p=OU(u.uri,f);return fetch(p).then(x=>x.blob()).then(x=>createImageBitmap(x)).then(x=>{a.images[c]=x})}if(u.bufferView!==void 0){const p=kU(a,u.bufferView),x=new Blob([p],{type:u.mimeType});return createImageBitmap(x).then(b=>{a.images[c]=b})}}function IU(u,a=0,c){const f={json:null,images:[],buffers:[]};if(new Uint32Array(u,a,1)[0]===PU){const $=new Uint32Array(u,a);let V=2;const q=($[V++]>>2)-3,X=$[V++]>>2;if(V++,f.json=JSON.parse(CU.decode($.subarray(V,V+X))),V+=X,V<q){const Y=$[V++];V++;const se=a+(V<<2);f.buffers[0]=u.slice(se,se+Y)}}else f.json=JSON.parse(CU.decode(new Uint8Array(u,a)));const{buffers:p,images:x,meshes:b,extensionsUsed:A,bufferViews:k}=f.json;let M=Promise.resolve();if(p){const $=[];for(let V=0;V<p.length;V++){const q=p[V];q.uri?$.push(Yue(q,f,V,c)):f.buffers[V]||(f.buffers[V]=null)}M=Promise.all($)}return M.then(()=>{const $=[],V=A&&A.includes(eN),q=A&&A.includes(wA);if(V&&$.push(function(){if(!Ju)return T1??(T1=function(X){let Y,se=null;function ce(){Y=new Uint8Array(se.buffer)}function he(){throw new Error("Unexpected Draco error.")}const be={a:{a:he,d:function(Ee,Oe,Ue){return Y.copyWithin(Ee,Oe,Oe+Ue)},c:function(Ee){const Oe=Y.length,Ue=Math.max(Ee>>>0,Math.ceil(1.2*Oe)),Fe=Math.ceil((Ue-Oe)/65536);try{return se.grow(Fe),ce(),!0}catch{return!1}},b:he}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(X,be):X.then(Ee=>Ee.arrayBuffer()).then(Ee=>WebAssembly.instantiate(Ee,be))).then(Ee=>{const{Rb:Oe,Qb:Ue,P:Fe,T:Ke,X:Qe,Ja:nt,La:Et,Qa:ft,Va:Tt,Wa:It,eb:Dt,jb:Xt,f:Vt,e:jt,yb:$t,zb:xt,Ab:vt,Bb:zt,Db:Ht,Gb:Nt}=Ee.instance.exports;se=jt;const pr=(()=>{let _r=0,ur=0,ar=0,Xr=0;return sr=>{ar&&(Oe(Xr),Oe(_r),ur+=ar,ar=_r=0),_r||(ur+=128,_r=Ue(ur));const Or=sr.length+7&-8;let Qr=_r;Or>=ur&&(ar=Or,Qr=Xr=Ue(Or));for(let vn=0;vn<sr.length;vn++)Y[Qr+vn]=sr[vn];return Qr}})();return ce(),Vt(),{memory:jt,_free:Oe,_malloc:Ue,Mesh:class{constructor(){this.ptr=Fe()}destroy(){Ke(this.ptr)}},Decoder:class{constructor(){this.ptr=nt()}destroy(){Xt(this.ptr)}DecodeArrayToMesh(_r,ur,ar){const Xr=pr(_r),sr=Et(this.ptr,Xr,ur,ar.ptr);return!!Qe(sr)}GetAttributeByUniqueId(_r,ur){return{ptr:ft(this.ptr,_r.ptr,ur)}}GetTrianglesUInt16Array(_r,ur,ar){Tt(this.ptr,_r.ptr,ur,ar)}GetTrianglesUInt32Array(_r,ur,ar){It(this.ptr,_r.ptr,ur,ar)}GetAttributeDataArrayForAllPoints(_r,ur,ar,Xr,sr){Dt(this.ptr,_r.ptr,ur.ptr,ar,Xr,sr)}},DT_INT8:$t(),DT_UINT8:xt(),DT_INT16:vt(),DT_UINT16:zt(),DT_UINT32:Ht(),DT_FLOAT32:Nt()}})}(fetch(EU())),T1.then(X=>{Ju=X,T1=void 0}))}()),q&&$.push(function(){if(Qj)return;const X=function(Y){let se;const ce=WebAssembly.instantiateStreaming(Y,{}).then(Ee=>{se=Ee.instance,se.exports.__wasm_call_ctors()}),he={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},be={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:ce,supported:!0,decodeGltfBuffer(Ee,Oe,Ue,Fe,Ke,Qe){(function(nt,Et,ft,Tt,It,Dt,Xt){const Vt=nt.exports.sbrk,jt=Tt+3&-4,$t=Vt(jt*It),xt=Vt(Dt.length),vt=new Uint8Array(nt.exports.memory.buffer);vt.set(Dt,xt);const zt=Et($t,Tt,It,xt,Dt.length);if(zt===0&&Xt&&Xt($t,jt,It),ft.set(vt.subarray($t,$t+Tt*It)),Vt($t-Vt(0)),zt!==0)throw new Error(`Malformed buffer data: ${zt}`)})(se,se.exports[be[Ke]],Ee,Oe,Ue,Fe,se.exports[he[Qe]])}}}(fetch(TU()));return X.ready.then(()=>{Qj=X})}()),x)for(let X=0;X<x.length;X++)$.push(Jue(x[X],f,X,c));return($.length?Promise.all($):Promise.resolve()).then(()=>{if(V&&b)for(const{primitives:X}of b)for(const Y of X)Zue(Y,f);if(q&&b&&k)for(const X of k)Xue(X,f);return f})})}function RU(u){return fetch(u).then(a=>a.arrayBuffer()).then(a=>IU(a,0,u))}function tN(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function rN(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class nN{constructor(a,c,f,p){this.context=a,this.format=f,this.useMipmap=p&&p.useMipmap,this.texture=a.gl.createTexture(),this.update(c,{premultiply:p&&p.premultiply})}update(a,c){const f=a&&a instanceof HTMLVideoElement&&a.width===0?a.videoWidth:a.width,p=a&&a instanceof HTMLVideoElement&&a.height===0?a.videoHeight:a.height,{context:x}=this,{gl:b}=x,{x:A,y:k}=c&&c.position?c.position:{x:0,y:0},M=A+f,$=k+p;!this.size||this.size[0]===M&&this.size[1]===$||(b.bindTexture(b.TEXTURE_2D,null),b.deleteTexture(this.texture),this.texture=b.createTexture(),this.size=null),b.bindTexture(b.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA8&&(!c||c.premultiply!==!1));const V=a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||ImageBitmap&&a instanceof ImageBitmap;if(!this.size&&M>0&&$>0){const q=this.useMipmap?Math.floor(Math.log2(Math.max(M,$)))+1:1;b.texStorage2D(b.TEXTURE_2D,q,this.format,M,$),this.size=[M,$]}this.size&&(V?b.texSubImage2D(b.TEXTURE_2D,0,A,k,tN(this.format),rN(this.format),a):"data"in a&&a.data&&b.texSubImage2D(b.TEXTURE_2D,0,A,k,f,p,tN(this.format),rN(this.format),a.data)),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(a,c,f=!1){const{context:p}=this,{gl:x}=p;x.bindTexture(x.TEXTURE_2D,this.texture),a!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,a),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap&&!f?a===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:a),this.minFilter=a),c!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,c),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,c),this.wrapS=c)}bindExtraParam(a,c,f,p,x){const{context:b}=this,{gl:A}=b;A.bindTexture(A.TEXTURE_2D,this.texture),c!==this.magFilter&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,c),this.magFilter=c),a!==this.minFilter&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,this.useMipmap?a===A.NEAREST?A.NEAREST_MIPMAP_NEAREST:A.LINEAR_MIPMAP_LINEAR:a),this.minFilter=a),f!==this.wrapS&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,f),this.wrapS=f),p!==this.wrapT&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,p),this.wrapT=p),x!==this.compareMode&&(x?(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_COMPARE_MODE,A.COMPARE_REF_TO_TEXTURE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_COMPARE_FUNC,x)):A.texParameteri(A.TEXTURE_2D,A.TEXTURE_COMPARE_MODE,A.NONE),this.compareMode=x)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}class P1{constructor(a,c){this.context=a,this.texture=c}bind(a,c){const{context:f}=this,{gl:p}=f;p.bindTexture(p.TEXTURE_2D,this.texture),a!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,a),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,a),this.minFilter=a),c!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,c),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,c),this.wrapS=c)}}const Que=Tn([{name:"a_pos_3f",components:3,type:"Float32"}]),ede=Tn([{name:"a_color_3f",components:3,type:"Float32"}]),tde=Tn([{name:"a_color_4f",components:4,type:"Float32"}]),rde=Tn([{name:"a_uv_2f",components:2,type:"Float32"}]),nde=Tn([{name:"a_normal_3f",components:3,type:"Float32"}]),ide=Tn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),ade=Tn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function jU(u,a){const c=SA(u.projection,u.zoom,u.width,u.height),f=function(x,b,A,k,M){const $=new Q(A.lng-180*Dp,A.lat),V=new Q(A.lng+180*Dp,A.lat),q=x.project($.lng,$.lat),X=x.project(V.lng,V.lat),Y=-Math.atan2(X.y-q.y,X.x-q.x),se=lt.fromLngLat(A);se.y=ve(se.y,-1+Dp,1-Dp);const ce=se.toLngLat(),he=x.project(ce.lng,ce.lat),be=lt.fromLngLat(ce);be.x+=Dp;const Ee=be.toLngLat(),Oe=x.project(Ee.lng,Ee.lat),Ue=MU(Oe.x-he.x,Oe.y-he.y,Y),Fe=lt.fromLngLat(ce);Fe.y+=Dp;const Ke=Fe.toLngLat(),Qe=x.project(Ke.lng,Ke.lat),nt=MU(Qe.x-he.x,Qe.y-he.y,Y),Et=Math.abs(Ue.x)/Math.abs(nt.y),ft=j([]);J(ft,ft,-Y*(1-(M?0:k)));const Tt=j([]);return B(Tt,Tt,[1,1-(1-Et)*k,1]),Tt[4]=-nt.x/nt.y*k,J(Tt,Tt,Y),R(Tt,ft,Tt),Tt}(u.projection,0,u.center,c,a),p=NU(u);return B(f,f,[p,p,1]),f}function NU(u){const a=u.projection,c=SA(u.projection,u.zoom,u.width,u.height),f=iN(a,u.center),p=iN(a,Q.convert(a.center));return Math.pow(2,f*c+(1-c)*p)}function SA(u,a,c,f,p=1/0){const x=u.range;if(!x)return 0;const b=Math.min(p,Math.max(c,f)),A=Math.log2(b/1024);return Me(x[0]+A,x[1]+A,a)}const Dp=1/4e4;function iN(u,a){const c=ve(a.lat,-Re,Re),f=new Q(a.lng-180*Dp,c),p=new Q(a.lng+180*Dp,c),x=u.project(f.lng,c),b=u.project(p.lng,c),A=lt.fromLngLat(f),k=lt.fromLngLat(p),M=b.x-x.x,$=b.y-x.y,V=k.x-A.x,q=k.y-A.y,X=Math.sqrt((V*V+q*q)/(M*M+$*$));return Math.log2(X)}function MU(u,a,c){const f=Math.cos(c),p=Math.sin(c);return{x:u*f-a*p,y:u*p+a*f}}function DU(u,a,c){j(u),J(u,u,bn(a[2])),U(u,u,bn(a[0])),Z(u,u,bn(a[1])),B(u,u,c),R(u,u,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function EA(u,a,c,f,p,x,b,A){const k=[c[0]-a[0],c[1]-a[1],0],M=[f[0]-a[0],f[1]-a[1],0];if(xe(k)<1e-12||xe(M)<1e-12)return Pr(u);const $=St([],k,M);je($,$),me(M,f,a),k[2]=(x-p)*A,M[2]=(b-p)*A;const V=k;return St(V,k,M),je(V,V),Va(u,$,V)}function TA(u,a,c=!1){const f=jp(a.zoom),p=function(x,b,A){const k=b.worldSize,M=[x[12],x[13],x[14]],$=Te(M[1]/k),V=ke(M[0]/k),q=j([]),X=Se(1,$)*k,Y=Se(1,0)*k*Be($,b.zoom),se=1/jj(k);let ce=Y*se;if(A){const Oe=SA(b.projection,b.zoom,b.width,b.height,1024);ce=se*b.projection.pixelSpaceConversion(b.center.lat,k,Oe)}const he=z($,V);Ce(he,he,Ie([],je([],he),X*ce*M[2]));const be=function(Oe){const Ue=[Oe[0],Oe[1],Oe[2]];let Fe=[0,1,0];const Ke=St([],Fe,Ue);return St(Fe,Ue,Ke),qe(Fe)===0&&(Fe=[0,1,0],St(Ke,Ue,Fe)),je(Ke,Ke),je(Fe,Fe),je(Ue,Ue),[Ke[0],Ke[1],Ke[2],0,Fe[0],Fe[1],Fe[2],0,Ue[0],Ue[1],Ue[2],0,Oe[0],Oe[1],Oe[2],1]}(he);B(q,q,[ce,ce,ce*X]),F(q,q,[-M[0],-M[1],-M[2]]);const Ee=R([],b.globeMatrix,be);return R(Ee,Ee,q),R(Ee,Ee,x),Ee}(u,a,c);if(f>0){const x=function(b,A){const k=A.worldSize,M=Se(1,0)*k*Be(A.center.lat,A.zoom)/jj(k),$=Se(1,A.center.lat)*k,V=j([]);Z(V,V,bn(A.center.lng)),U(V,V,bn(A.center.lat)),F(V,V,[0,0,Fs]),B(V,V,[M,M,M*$]);const q=A.point;return F(V,V,[-q.x,-q.y,0]),R(V,V,b),R(V,A.globeMatrix,V)}(u,a);return function(b,A,k){const M=(Y,se,ce)=>{const he=xe(Y),be=xe(se),Ee=nf(Y,se,ce);return Ie(Ee,Ee,1/xe(Ee)*qr(he,be,ce))},$=M([b[0],b[1],b[2]],[A[0],A[1],A[2]],k),V=M([b[4],b[5],b[6]],[A[4],A[5],A[6]],k),q=M([b[8],b[9],b[10]],[A[8],A[9],A[10]],k),X=nf([b[12],b[13],b[14]],[A[12],A[13],A[14]],k);return[$[0],$[1],$[2],0,V[0],V[1],V[2],0,q[0],q[1],q[2],0,X[0],X[1],X[2],1]}(p,x,f)}return p}function aN(u,a,c,f){const p=gn.projectAabbCorners(f,c);let x=Number.MAX_VALUE;for(let A=0;A<p.length;++A){const k=p[A];k[0]=(.5*k[0]+.5)*a.width,k[1]=(.5-.5*k[1])*a.height,k[2]<x&&(x=k[2])}const b=function(A){const k=[];let M=0;for(let X=1;X<A.length;X++)(A[X][0]<A[M][0]||A[X][0]===A[M][0]&&A[X][1]<A[M][1])&&(M=X);let $,V=M;const q=new Uint8Array(A.length);do{if(q[V])break;k.push(new Mt(A[V][0],A[V][1])),q[V]=1,$=(V+1)%A.length;for(let X=0;X<A.length;X++){if(A[X][0]===A[$][0]&&A[X][1]===A[$][1]||A[X][0]===A[V][0]&&A[X][1]===A[V][1])continue;const Y=[A[X][0]-A[V][0],A[X][1]-A[V][1]],se=[A[$][0]-A[V][0],A[$][1]-A[V][1]],ce=Y[0]*se[1]-Y[1]*se[0];(ce>0||ce===0&&Y[0]*se[0]+Y[1]*se[1]>=0&&Y[0]*Y[0]+Y[1]*Y[1]>se[0]*se[0]+se[1]*se[1])&&($=X)}V=$}while(V!==M);return k.length>0&&k.push(k[0]),k}(p);if(ba(u,b))return x}const sy=64,Z_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function AA(u,a,c,f,p,x,b,A,k,M=!1){const $=c.zoom,V=c.project(f),q=Be(f.lat,$),X=1/q;j(u),F(u,u,[V.x+b[0]*X,V.y+b[1]*X,b[2]]);let Y=1,se=1;const ce=c.worldSize;if(M){if(c.projection.name==="mercator"){let Oe=0;c.elevation&&(Oe=c.elevation.getAtPointOrZero(new lt(V.x/ce,V.y/ce),0));const Ue=er([],[V.x,V.y,Oe,1],c.projMatrix)[3]/c.cameraToCenterDistance;Y=Ue,se=Ue*Be(c.center.lat,$)}else if(c.projection.name==="globe"){const Oe=TA(u,c),Ue=[0,0,0,1];er(Ue,Ue,R([],c.projMatrix,Oe));const Fe=Ue[3]/c.cameraToCenterDistance,Ke=jp($),Qe=c.projection.pixelsPerMeter(f.lat,ce)*Be(f.lat,$),nt=c.projection.pixelsPerMeter(c.center.lat,ce)*Be(c.center.lat,$);Y=Fe/qr(Qe,Ve(c.center.lat),Ke),se=Fe*q/Qe,Y*=nt,se*=nt}}else Y=X;B(u,u,[Y,Y,se]);const he=[...u],be=a.orientation,Ee=[];if(DU(Ee,[be[0]+(p?p[0]:0),be[1]+(p?p[1]:0),be[2]+(p?p[2]:0)],x),R(u,he,Ee),A&&c.elevation){let Oe=0;const Ue=[];if(k&&c.elevation){Oe=function(Ke,Qe,nt,Et,ft){const Tt=Qe.elevation;if(!Tt)return 0;const It=gn.projectAabbCorners(nt,Et),Dt=Se(1,ft.lat)*Qe.worldSize,Xt=function(ur,ar){const Xr=[0,0,1],sr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Or of sr){const Qr=ur[Or.corners[0]],vn=ur[Or.corners[1]],Bn=ur[Or.corners[2]],nn=[vn[0]-Qr[0],vn[1]-Qr[1],ar*(vn[2]-Qr[2])],Hn=St(nn,nn,[Bn[0]-Qr[0],Bn[1]-Qr[1],ar*(Bn[2]-Qr[2])]);je(Hn,Hn),Or.dotProductWithUp=ot(Hn,Xr)}return sr.sort((Or,Qr)=>Or.dotProductWithUp-Qr.dotProductWithUp),sr[0].corners}(It,Dt),Vt=It[Xt[0]],jt=It[Xt[1]],$t=It[Xt[2]],xt=It[Xt[3]],vt=Tt.getAtPointOrZero(new lt(Vt[0]/Qe.worldSize,Vt[1]/Qe.worldSize),0),zt=Tt.getAtPointOrZero(new lt(jt[0]/Qe.worldSize,jt[1]/Qe.worldSize),0),Ht=Tt.getAtPointOrZero(new lt($t[0]/Qe.worldSize,$t[1]/Qe.worldSize),0),Nt=Tt.getAtPointOrZero(new lt(xt[0]/Qe.worldSize,xt[1]/Qe.worldSize),0),pr=(vt+Nt)/2,_r=(zt+Ht)/2;return pr>_r?zt<Ht?EA(Ke,jt,xt,Vt,zt,Nt,vt,Dt):EA(Ke,$t,Vt,xt,Ht,vt,Nt,Dt):vt<Nt?EA(Ke,Vt,jt,$t,vt,zt,Ht,Dt):EA(Ke,xt,$t,jt,Nt,Ht,zt,Dt),Math.max(pr,_r)}(Ue,c,a.aabb,u,f);const Fe=R([],ie([],Ue),Ee);R(u,he,Fe)}else Oe=c.elevation.getAtPointOrZero(new lt(V.x/ce,V.y/ce),0);Oe!==0&&(u[14]+=Oe)}}class LU{constructor(a,c,f,p,x){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=a,this.uri=c,this.position=f!=null?new Q(f[0],f[1]):new Q(0,0),this.orientation=p??[0,0,0],this.nodes=x,this.uploaded=!1,this.aabb=new gn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(a,c){R(a.globalMatrix,c,a.localMatrix);const f=this.nodeOverrides.get(a.name);if(f!==void 0){const b=[];x=f.orientation,j(p=b),Z(p,p,bn(x[1])),J(p,p,bn(x[2])),U(p,p,bn(x[0])),R(a.globalMatrix,a.globalMatrix,b)}var p,x;if(a.meshes)for(const b of a.meshes){const A=gn.applyTransformFast(b.aabb,a.globalMatrix);this.aabb.encapsulate(A)}if(a.children)for(const b of a.children)this._applyTransformations(b,a.globalMatrix)}computeBoundsAndApplyParent(){const a=j([]);this.aabb=new gn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.nodes)this._applyTransformations(c,a)}computeModelMatrix(a,c,f,p,x,b,A=!1){AA(this.matrix,this,a.transform,this.position,c,f,p,x,b,A)}upload(a){if(!this.uploaded){for(const c of this.nodes)oN(c,a);for(const c of this.nodes)PA(c);this.uploaded=!0}}destroy(){for(const a of this.nodes)sN(a)}}function C1(u,a,c=!1){u.uploaded||(u.gfxTexture=new nN(a,u.image,c?a.gl.R8:a.gl.RGBA8,{useMipmap:u.sampler.minFilter>=a.gl.NEAREST_MIPMAP_NEAREST}),u.uploaded=!0,u.image=null)}function ode(u,a,c){u.indexBuffer=a.createIndexBuffer(u.indexArray,!1,!0),u.vertexBuffer=a.createVertexBuffer(u.vertexArray,Que.members,!1,!0),u.normalArray&&(u.normalBuffer=a.createVertexBuffer(u.normalArray,nde.members,!1,!0)),u.texcoordArray&&(u.texcoordBuffer=a.createVertexBuffer(u.texcoordArray,rde.members,!1,!0)),u.colorArray&&(u.colorBuffer=a.createVertexBuffer(u.colorArray,(u.colorArray.bytesPerElement===12?ede:tde).members,!1,!0)),u.featureArray&&(u.pbrBuffer=a.createVertexBuffer(u.featureArray,ade.members,!0)),u.segments=ta.simpleSegment(0,0,u.vertexArray.length,u.indexArray.length);const f=u.material;f.pbrMetallicRoughness.baseColorTexture&&C1(f.pbrMetallicRoughness.baseColorTexture,a),f.pbrMetallicRoughness.metallicRoughnessTexture&&C1(f.pbrMetallicRoughness.metallicRoughnessTexture,a),f.normalTexture&&C1(f.normalTexture,a),f.occlusionTexture&&C1(f.occlusionTexture,a,c),f.emissionTexture&&C1(f.emissionTexture,a)}function oN(u,a,c){if(u.meshes)for(const f of u.meshes)ode(f,a,c);if(u.children)for(const f of u.children)oN(f,a,c)}function PA(u){if(u.meshes)for(const a of u.meshes)a.indexArray.destroy(),a.vertexArray.destroy(),a.colorArray&&a.colorArray.destroy(),a.normalArray&&a.normalArray.destroy(),a.texcoordArray&&a.texcoordArray.destroy(),a.featureArray&&a.featureArray.destroy();if(u.children)for(const a of u.children)PA(a)}function sN(u){if(u.meshes)for(const c of u.meshes)c.vertexBuffer&&(c.vertexBuffer.destroy(),c.indexBuffer.destroy(),c.normalBuffer&&c.normalBuffer.destroy(),c.texcoordBuffer&&c.texcoordBuffer.destroy(),c.colorBuffer&&c.colorBuffer.destroy(),c.pbrBuffer&&c.pbrBuffer.destroy(),c.segments.destroy(),c.material&&((a=c.material).pbrMetallicRoughness.baseColorTexture&&a.pbrMetallicRoughness.baseColorTexture.gfxTexture&&a.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),a.pbrMetallicRoughness.metallicRoughnessTexture&&a.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&a.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),a.normalTexture&&a.normalTexture.gfxTexture&&a.normalTexture.gfxTexture.destroy(),a.emissionTexture&&a.emissionTexture.gfxTexture&&a.emissionTexture.gfxTexture.destroy(),a.occlusionTexture&&a.occlusionTexture.gfxTexture&&a.occlusionTexture.gfxTexture.destroy()));var a;if(u.children)for(const c of u.children)sN(c)}function ly(u,a){const c=u.json.bufferViews[a.bufferView],f=bA[a.componentType];return new f(u.buffers[c.buffer],(a.byteOffset||0)+(c.byteOffset||0),a.count*(c.byteStride&&c.byteStride!==A1[a.type]*f.BYTES_PER_ELEMENT?c.byteStride/f.BYTES_PER_ELEMENT:A1[a.type]))}function lN(u,a,c,f){const p=bA[a.componentType],x=function($){switch($){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(p),b=u.json.bufferViews[a.bufferView],A=b.byteStride?b.byteStride/p.BYTES_PER_ELEMENT:A1[a.type],k=c.float32,M=k.length/c.capacity;for(let $=0,V=0;$<a.count*A;$+=A,V+=M)for(let q=0;q<M;q++)k[V+q]=f[$+q]*x;c._trim()}function sde(u,a,c){const f=u.indices,p=u.attributes,x={};x.indexArray=new Gi;const b=a.json.accessors[f],A=b.count/3;x.indexArray.reserve(A);const k=ly(a,b);for(let q=0;q<A;q++)x.indexArray.emplaceBack(k[3*q],k[3*q+1],k[3*q+2]);x.indexArray._trim(),x.vertexArray=new Sl;const M=a.json.accessors[p.POSITION];x.vertexArray.reserve(M.count);const $=ly(a,M);for(let q=0;q<M.count;q++)x.vertexArray.emplaceBack($[3*q],$[3*q+1],$[3*q+2]);if(x.vertexArray._trim(),x.aabb=new gn(M.min,M.max),x.centroid=function(q,X){const Y=[0,0,0],se=q.length;if(se>0){for(let ce=0;ce<se;ce++){const he=3*q[ce];Y[0]+=X[he],Y[1]+=X[he+1],Y[2]+=X[he+2]}Y[0]/=se,Y[1]/=se,Y[2]/=se}return Y}(k,$),p.COLOR_0!==void 0){const q=a.json.accessors[p.COLOR_0],X=A1[q.type],Y=ly(a,q);x.colorArray=X===3?new Sl:new Kd,x.colorArray.resize(q.count),lN(a,q,x.colorArray,Y)}if(p.NORMAL!==void 0){x.normalArray=new Sl;const q=a.json.accessors[p.NORMAL];x.normalArray.resize(q.count);const X=ly(a,q);lN(a,q,x.normalArray,X)}if(p.TEXCOORD_0!==void 0&&c.length>0){x.texcoordArray=new Zd;const q=a.json.accessors[p.TEXCOORD_0];x.texcoordArray.resize(q.count);const X=ly(a,q);lN(a,q,x.texcoordArray,X)}if(p._FEATURE_ID_RGBA4444!==void 0){const q=a.json.accessors[p._FEATURE_ID_RGBA4444];a.json.extensionsUsed&&a.json.extensionsUsed.includes("EXT_meshopt_compression")&&(x.featureData=ly(a,q))}p._FEATURE_RGBA4444!==void 0&&(x.featureData=new Uint32Array(ly(a,a.json.accessors[p._FEATURE_RGBA4444]).buffer));const V=u.material;return x.material=function(q,X){const{emissiveFactor:Y=[0,0,0],alphaMode:se="OPAQUE",alphaCutoff:ce=.5,normalTexture:he,occlusionTexture:be,emissiveTexture:Ee,doubleSided:Oe,name:Ue}=q,{baseColorFactor:Fe=[1,1,1,1],metallicFactor:Ke=1,roughnessFactor:Qe=1,baseColorTexture:nt,metallicRoughnessTexture:Et}=q.pbrMetallicRoughness||{},ft=be?X[be.index]:void 0;if(be&&be.extensions&&be.extensions.KHR_texture_transform&&ft){const Tt=be.extensions.KHR_texture_transform;ft.offsetScale=[Tt.offset[0],Tt.offset[1],Tt.scale[0],Tt.scale[1]]}return{name:Ue,pbrMetallicRoughness:{baseColorFactor:new ni(...Fe),metallicFactor:Ke,roughnessFactor:Qe,baseColorTexture:nt?X[nt.index]:void 0,metallicRoughnessTexture:Et?X[Et.index]:void 0},doubleSided:Oe,emissiveFactor:new ni(...Y),alphaMode:se,alphaCutoff:ce,normalTexture:he?X[he.index]:void 0,occlusionTexture:ft,emissionTexture:Ee?X[Ee.index]:void 0,defined:q.defined===void 0}}(V!==void 0?a.json.materials[V]:{defined:!1},c),x}function FU(u,a,c){const{matrix:f,rotation:p,translation:x,scale:b,mesh:A,extras:k,children:M,name:$}=u,V={};if(V.name=$,V.localMatrix=f||function(q,X,Y,se){var ce=X[0],he=X[1],be=X[2],Ee=X[3],Oe=ce+ce,Ue=he+he,Fe=be+be,Ke=ce*Oe,Qe=ce*Ue,nt=ce*Fe,Et=he*Ue,ft=he*Fe,Tt=be*Fe,It=Ee*Oe,Dt=Ee*Ue,Xt=Ee*Fe,Vt=se[0],jt=se[1],$t=se[2];return q[0]=(1-(Et+Tt))*Vt,q[1]=(Qe+Xt)*Vt,q[2]=(nt-Dt)*Vt,q[3]=0,q[4]=(Qe-Xt)*jt,q[5]=(1-(Ke+Tt))*jt,q[6]=(ft+It)*jt,q[7]=0,q[8]=(nt+Dt)*$t,q[9]=(ft-It)*$t,q[10]=(1-(Ke+Et))*$t,q[11]=0,q[12]=Y[0],q[13]=Y[1],q[14]=Y[2],q[15]=1,q}([],p||[0,0,0,1],x||[0,0,0],b||[1,1,1]),V.globalMatrix=I(V.localMatrix),A!==void 0){V.meshes=c[A];const q=V.anchor=[0,0];for(const X of V.meshes){const{min:Y,max:se}=X.aabb;q[0]+=Y[0]+se[0],q[1]+=Y[1]+se[1]}q[0]=Math.floor(q[0]/V.meshes.length/2),q[1]=Math.floor(q[1]/V.meshes.length/2)}if(k&&(k.id&&(V.id=k.id),k.lights&&(V.lights=function(q){if(!q.length)return[];const X=function(be){const Ee=atob(be),Oe=new Uint8Array(Ee.length);for(let Ue=0;Ue<Ee.length;Ue++)Oe[Ue]=Ee.codePointAt(Ue);return Oe}(q),Y=[],se=X.length/24,ce=new Uint16Array(X.buffer),he=new Float32Array(X.buffer);for(let be=0;be<se;be++){const Ee=ce[2*be*6]/30,Oe=ce[2*be*6+1]/30,Ue=ce[2*be*6+10]/100,Fe=he[6*be+1],Ke=he[6*be+2],Qe=he[6*be+3],nt=he[6*be+4],Et=Qe-Fe,ft=nt-Ke,Tt=Math.hypot(Et,ft);Y.push({pos:[Fe+.5*Et,Ke+.5*ft,Oe],normal:[ft/Tt,-Et/Tt,0],width:Tt,height:Ee,depth:Ue,points:[Fe,Ke,Qe,nt]})}return Y}(k.lights)),k.MAPBOX_geometry_bloom&&(V.isGeometryBloom=k.MAPBOX_geometry_bloom)),M){const q=[];for(const X of M)q.push(FU(a.json.nodes[X],a,c));V.children=q}return V}function lde(u){if(u.vertices.length===0||u.indices.length===0)return null;const a=new fA(u.vertices,u.indices,8,256),[c,f]=[a.min.clone(),a.max.clone()];return{vertices:u.vertices,indices:u.indices,grid:a,min:c,max:f}}function cde(u){if(!u.extras||!u.extras.ground)return null;const a=u.extras.ground;if(!a||!Array.isArray(a)||a.length===0)return null;const c=a[0];if(!c||!Array.isArray(c)||c.length===0)return null;const f=[];for(const b of c){if(!Array.isArray(b)||b.length!==2)continue;const A=b[0],k=b[1];typeof A=="number"&&typeof k=="number"&&f.push(new Mt(A,k))}if(f.length<3)return null;f.length>1&&f[f.length-1].equals(f[0])&&f.pop();let p=0;for(let b=0;b<f.length;b++){const A=f[b],k=f[(b+1)%f.length],M=f[(b+2)%f.length];p+=(A.x-k.x)*(M.y-k.y)-(M.x-k.x)*(A.y-k.y)}p>0&&f.reverse();const x=V_(f.flatMap(b=>[b.x,b.y]),[]);return x.length===0?null:{vertices:f,indices:x}}function ude(u,a){const c=[],f=[];let p=0;const x=[];for(const b of u){p=c.length;const A=b.vertexArray.float32,k=b.indexArray.uint16;for(let M=0;M<b.vertexArray.length;M++)x[0]=A[3*M+0],x[1]=A[3*M+1],x[2]=A[3*M+2],Ut(x,x,a),c.push(new Mt(x[0],x[1]));for(let M=0;M<3*b.indexArray.length;M++)f.push(k[M]+p)}if(f.length%3!=0)return null;for(let b=0;b<f.length;b+=3){const A=c[f[b+0]],k=c[f[b+1]],M=c[f[b+2]];(A.x-k.x)*(M.y-k.y)-(M.x-k.x)*(A.y-k.y)>0&&([f[b+1],f[b+2]]=[f[b+2],f[b+1]])}return{vertices:c,indices:f}}function cN(u){const a=function(k,M){const $=[],V=WebGL2RenderingContext;if(k.json.textures)for(const q of k.json.textures){const X={magFilter:V.LINEAR,minFilter:V.NEAREST,wrapS:V.REPEAT,wrapT:V.REPEAT};q.sampler!==void 0&&Object.assign(X,k.json.samplers[q.sampler]),$.push({image:M[q.source],sampler:X,uploaded:!1})}return $}(u,u.images),c=function(k,M){const $=[];for(const V of k.json.meshes){const q=[];for(const X of V.primitives)q.push(sde(X,k,M));$.push(q)}return $}(u,a),{scenes:f,scene:p,nodes:x}=u.json,b=f?f[p||0].nodes:[...x.keys()],A=[];for(const k of b)A.push(FU(x[k],u,c));return function(k,M,$){const V={},q=new Set;for(let X=0;X<k.length;X++){const Y=$[M[X]];if(!Y.extras)continue;const se=Y.extras["mapbox:footprint:version"],ce=Y.extras["mapbox:footprint:id"];(se||ce)&&q.add(X),se==="1.0.0"&&ce&&(V[ce]=X)}for(let X=0;X<k.length;X++){if(q.has(X))continue;const Y=k[X],se=$[M[X]];if(!se.extras)continue;let ce=null;Y.id in V&&(ce=ude(k[V[Y.id]].meshes,Y.localMatrix)),ce||(ce=cde(se)),ce&&(Y.footprint=lde(ce))}if(q.size>0){const X=Array.from(q.values()).sort((Y,se)=>Y-se);for(let Y=X.length-1;Y>=0;Y--)k.splice(X[Y],1)}}(A,b,u.json.nodes),A}function dde(u){u.heightmap=new Float32Array(4096),u.heightmap.fill(-1);const a=u.vertexArray.float32,c=u.aabb.min[0]-1,f=u.aabb.min[1]-1,p=sy/(u.aabb.max[0]-c+2),x=sy/(u.aabb.max[1]-f+2);for(let b=0;b<a.length;b+=3){const A=a[b+2],k=(a[b+0]-c)*p|0,M=(a[b+1]-f)*x|0;A>u.heightmap[M*sy+k]&&(u.heightmap[M*sy+k]=A)}}function zU(u,a,c,f,p){c.reserve(c.length+4*u.length),f.reserve(f.length+10*u.length),p.reserve(p.length+10*u.length);let x=f.length;for(const b of u){const A=Math.min(10,Math.max(4,1.3*b.height))*a,k=[-b.normal[1],b.normal[0],0],M=Math.min(.29,.1*b.width/b.depth),$=b.width-2*b.depth*a*(M+.01),V=tt([],b.pos,k,$/2),q=tt([],b.pos,k,-$/2),X=[V[0],V[1],V[2]+b.height],Y=[q[0],q[1],q[2]+b.height],se=tt([],b.normal,k,M);Ie(se,se,A);const ce=tt([],b.normal,k,-M);Ie(ce,ce,A),Ce(se,V,se),Ce(ce,q,ce),V[2]+=.1,q[2]+=.1,f.emplaceBack(se[0],se[1],se[2]),f.emplaceBack(ce[0],ce[1],ce[2]),f.emplaceBack(V[0],V[1],V[2]),f.emplaceBack(q[0],q[1],q[2]),f.emplaceBack(X[0],X[1],X[2]),f.emplaceBack(Y[0],Y[1],Y[2]),f.emplaceBack(V[0],V[1],V[2]),f.emplaceBack(q[0],q[1],q[2]),f.emplaceBack(se[0],se[1],se[2]),f.emplaceBack(ce[0],ce[1],ce[2]);const he=$/A/2;p.emplaceBack(-he-M,-1,he,.8),p.emplaceBack(he+M,-1,he,.8),p.emplaceBack(-he,0,he,1.3),p.emplaceBack(he,0,he,1.3),p.emplaceBack(he+M,-.8,he,.7),p.emplaceBack(he+M,-.8,he,.7),p.emplaceBack(0,0,he,1.3),p.emplaceBack(0,0,he,1.3),p.emplaceBack(he+M,-1.2,he,.8),p.emplaceBack(he+M,-1.2,he,.8),c.emplaceBack(6+x,4+x,8+x),c.emplaceBack(7+x,9+x,5+x),c.emplaceBack(0+x,1+x,2+x),c.emplaceBack(1+x,3+x,2+x),x+=10}}function hde(u,a){const c={};c.indexArray=new Gi,c.vertexArray=new Sl,c.colorArray=new Kd,zU(u,a,c.indexArray,c.vertexArray,c.colorArray);const f={defined:!0};f.emissiveFactor=ni.black;const p={};return p.baseColorFactor=ni.white,f.pbrMetallicRoughness=p,c.material=f,c.aabb=new gn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),c}const BU=Tn([{name:"a_pos_3f",components:3,type:"Float32"}]),fde=Tn([{name:"a_normal_3",components:3,type:"Int16"}]),pde=Tn([{name:"a_centroid_3",components:3,type:"Int16"}]),$U=Tn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),mde=Tn([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),gde=Tn([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),yde=Tn([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),vde=Tn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),_de=Tn([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),UU=Lt.types,CA=32767;function xde(u,a){const c=Jt+a;for(const f of u)for(const p of f)if(p.x<-a||p.x>c||p.y<-a||p.y>c)return!1;return!0}class VU{constructor(){this.layoutVertexArray=new Sl,this.layoutAttenuationArray=new Kd,this.layoutColorArray=new oc,this.indexArray=new Gi,this.indexArrayForConflation=new Gi,this.segmentsBucket=new ta}}class uN{constructor(){this.layoutVertexArray=new Sl,this.layoutNormalArray=new Qh,this.layoutCentroidArray=new Qh,this.layoutColorArray=new oc,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutFloodLightDataArray=new j_,this.layoutAOArray=new Ku,this.indexArray=new Gi,this.indexArrayForConflation=new Gi,this.segmentsBucket=new ta,this.entranceBloom=new VU}}class qU{constructor(a){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new uN,this.buildingWithFacade=new uN,this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.footprintLookup={},this.zoom=a.zoom,this.canonical=a.canonical,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.worldview=a.worldview,this.lut=a.lut,this.buildingWithFacade.layoutFacadePaintArray=new oc,this.buildingWithFacade.layoutFacadeDataArray=new ef,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new oc,this.programConfigurations=new Ic(a.layers,{zoom:a.zoom,lut:a.lut}),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.projection=a.projection,this.groundEffect=new Kj(a),this.groundEffect.groundRadiusArray=new Ku,this.hasAppearances=null}updateFootprints(a,c){for(const f of this.footprints)c.push({footprint:f,id:a})}updateAppearances(a,c,f,p){}prepare(){return function(){if(xA!=null||SU!=null)return null;if(K_!=null)return K_;const a=fetch(Bi.BUILDING_GEN_URL);return K_=function(c){let f,p,x,b;function A(){f=new Uint8Array(b.buffer),p=new Int32Array(b.buffer),x=new Float32Array(b.buffer)}function k(){throw new Error("Unexpected BuildingGen error.")}const M=()=>{},$={a:{a:k,f:function(V){const q=f.length,X=Math.max(V>>>0,Math.ceil(1.2*q)),Y=Math.ceil((X-q)/65536);try{return b.grow(Y),A(),!0}catch{return!1}},g:k,b:M,c:M,d:M,e:M}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(c,$):c.then(V=>V.arrayBuffer()).then(V=>WebAssembly.instantiate(V,$))).then(V=>{const q=V.instance.exports;return(0,q.g)(),b=q.f,A(),new Gue({setStyle:q.h,setAOOptions:q.i,setMetricOptions:q.j,setStructuralOptions:q.k,setFacadeOptions:q.l,setFauxFacadeOptions:q.m,setFacadeClassifierOptions:q.n,addFeature:q.o,addFacade:q.p,generateMesh:q.q,getLastError:q.r,getOuterRingLength:q.s,getMeshCount:q.t,getPositionsPtr:q.u,getPositionsLength:q.v,getNormalsPtr:q.w,getNormalsLength:q.x,getColorsPtr:q.y,getColorsLength:q.z,getAOPtr:q.A,getAOLength:q.B,getUVPtr:q.C,getUVLength:q.D,getFauxFacadePtr:q.E,getFauxFacadeLength:q.F,getIndicesPtr:q.G,getIndicesLength:q.H,getBuildingPart:q.I,getRingCount:q.J,getRingPtr:q.K,getRingLength:q.L,free:q.M,malloc:q.N,heapU8:f,heap32:p,heapF32:x})})}(a).then(c=>(K_=null,xA=c,xA)).catch(c=>{Ir("Could not load building-gen"),K_=null,SU=c}),K_}()}populate(a,c,f,p){const x=Hue();if(!x)return;const b=We(f);this.tileToMeter=b,this.brightness=c.brightness,x.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,b],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:b,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),x.setAOOptions(!1,.3),x.setMetricOptions(!1,16),x.setStructuralOptions(!0),x.setFacadeClassifierOptions(3);const A=new Map,k=new Map;for(const{feature:M}of a){if(UU[M.type]!=="LineString"){A.set(M.id,M.properties.source_id);continue}const $=this.layers[0]._featureFilter.needGeometry,V=gt(M,$);if(!this.layers[0]._featureFilter.filter(new Ri(this.zoom),V,f))continue;const q=$?V.geometry:kt(M,f,p),X=[];for(const he of q)for(const be of he)X.push({x:be.x,y:be.y});const Y={coordinates:X,crossPerc:M.properties.cross_perc,distanceToRoad:M.properties.distance_to_road,entrances:M.properties.entrances,sourceId:0},se=M.properties.source_id;let ce=k.get(se);ce||(ce=[],k.set(se,ce)),ce.push(Y)}this.maxHeight=0;for(const{feature:M,id:$,index:V,sourceLayerIndex:q}of a){if(UU[M.type]==="LineString")continue;const X=this.layers[0]._featureFilter.needGeometry,Y=gt(M,X);if(!this.layers[0]._featureFilter.filter(new Ri(this.zoom),Y,f))continue;const se=X?Y.geometry:kt(M,f,p),ce=y1(se,500);if(!xde(se,163))continue;const he=this.layers[0],be=he.layout.get("building-roof-shape").evaluate(M,{},f);if(be==="flat")continue;const Ee=he.layout.get("building-base").evaluate(M,{},f),Oe=he.layout.get("building-height").evaluate(M,{},f),Ue=he.layout.get("building-flood-light-ground-radius").evaluate(M,{},f),Fe=he.paint.get("building-ambient-occlusion-intensity"),Ke=Ue/this.tileToMeter;let Qe=he.layout.get("building-flood-light-wall-radius").evaluate(M,{},f);Qe=ve(Qe,0,2048);const nt=Qe/2048*CA,Et=A.get($);let ft;ft=k.has(Et)?k.get(Et):[];const Tt=ft.length!==0&&he.layout.get("building-facade").evaluate(M,{},f);x.setFacadeOptions(4,!0),x.setFauxFacadeOptions(Tt,!1,1);let It=0,Dt=0,Xt=0,Vt=0,jt=0,$t=0;if(Tt){let Ct=Math.round(he.layout.get("building-facade-floors").evaluate(M,{},f));if(Ee===0){Ct=Math.max(1,Ct-(ft.length>0?1:0));let Ar=4;if(Oe>100){const Er=[10,13,15];Ar=Er[M.id?M.id%Er.length:0],x.setFacadeOptions(Ar,!0)}jt=1.6803*Ar/b}else jt=Ee/b;$t=Oe/b,jt=Math.min(jt,$t),Xt=he.layout.get("building-facade-unit-width").evaluate(M,{},f)/b,Vt=($t-jt)/Ct,x.setFauxFacadeOptions(!0,!0,Xt);const or=he.layout.get("building-facade-window").evaluate(M,{},f);It=or[0],Dt=or[1]}const xt=[],vt=new Mt(1/0,1/0),zt=new Mt(-1/0,-1/0),Ht=new Mt(0,0);let Nt=0;for(const Ct of ce)if(Ct.length>0){const or=[];for(const Ar of Ct){const Er=[];for(let an=Ar.length-1;an>=0;an--){const Fr=Ar[an];Er.push({x:Fr.x,y:Fr.y}),vt.x=Math.min(vt.x,Fr.x),vt.y=Math.min(vt.y,Fr.y),zt.x=Math.max(zt.x,Fr.x),zt.y=Math.max(zt.y,Fr.y),Ht.x+=Fr.x,Ht.y+=Fr.y,Nt++}or.push(Er)}xt.push({id:M.id?M.id:0,height:Oe,minHeight:Ee,sourceId:0,roofType:be,coordinates:or})}Ht.x/=Nt||1,Ht.y/=Nt||1;const pr=x.generateMesh(xt,ft);if(typeof pr=="string"){Ir(`Unable to generate building ${M.id}: ${pr}`);continue}if(pr.meshes.length===0||pr.modifiedPolygonRings.length===0)continue;let _r=0;for(const Ct of pr.meshes)_r+=Ct.positions.length/3;const ur=Tt?this.buildingWithFacade:this.buildingWithoutFacade,ar=ur.segmentsBucket.prepareSegment(_r,ur.layoutVertexArray,ur.indexArray),Xr=[];let sr=null,Or=0,Qr=-1;const vn=ur.layoutVertexArray.length,Bn=ur.indexArray.length;let nn=0;for(const Ct of pr.meshes){const or=ur.layoutVertexArray.length;if(Ct.buildingPart==="entrance"){const wr=new Array;for(let Fn=0;Fn<Ct.positions.length;Fn+=12){const _i=Ct.positions[Fn+0],ii=Ct.positions[Fn+1],la=Ct.positions[Fn+3],Ui=Ct.positions[Fn+4],Ci=Ct.positions[Fn+2],ui=Ct.positions[Fn+8]-Ci,Zn=1,on=la-_i,Xn=Ui-ii,Oi=Math.hypot(on,Xn);wr.push({pos:[_i+.5*on,ii+.5*Xn,Ci],normal:[Xn/Oi,-on/Oi,0],width:Oi,height:ui,depth:Zn,points:[_i,ii,la,Ui]})}const Wn=ur.entranceBloom.segmentsBucket.prepareSegment(10*wr.length,ur.entranceBloom.layoutVertexArray,ur.entranceBloom.indexArray),vi=ur.entranceBloom.layoutVertexArray.length;Or=ur.entranceBloom.indexArray.length,zU(wr,.5/this.tileToMeter,ur.entranceBloom.indexArray,ur.entranceBloom.layoutVertexArray,ur.entranceBloom.layoutAttenuationArray);const Ur=ur.entranceBloom.layoutVertexArray.length-vi;Qr=ur.entranceBloom.indexArray.length-Or;for(let Fn=0;Fn<Ur;Fn++)ur.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Wn.vertexLength+=Ur,Wn.primitiveLength+=Qr,sr={part:Ct.buildingPart,vertexOffset:vi,vertexLength:Ur}}for(let wr=0;wr<Ct.positions.length;wr+=3)nn=Math.max(nn,Ct.positions[wr+2]),ur.layoutVertexArray.emplaceBack(Ct.positions[wr],Ct.positions[wr+1],Ct.positions[wr+2]);const Ar=Math.floor(Ht.x),Er=Math.floor(Ht.y),an=Math.floor(nn);for(let wr=0;wr<Ct.positions.length;wr+=3)ur.layoutCentroidArray.emplaceBack(Ar,Er,an),ur.layoutFloodLightDataArray.emplaceBack(Ct.buildingPart==="wall"?nt:0);for(let wr=0;wr<Ct.normals.length;wr+=3)ur.layoutNormalArray.emplaceBack(Ct.normals[wr+0]*CA,Ct.normals[wr+1]*CA,Ct.normals[wr+2]*CA);for(let wr=0;wr<Ct.ao.length;wr++)ur.layoutAOArray.emplaceBack(Ct.ao[wr]);for(let wr=0;wr<Ct.colors.length;wr+=3){const Wn=1+(Ct.ao[wr/3]-1)*Fe;ur.layoutColorArray.emplaceBack(Ct.colors[wr]*Wn<<8|Ct.colors[wr+1]*Wn,Ct.colors[wr+2]*Wn<<8)}if(Tt){for(let wr=0;wr<Ct.positions.length;wr+=3)ur.layoutFacadePaintArray.emplaceBack(65535,255);for(let wr=0;wr<Ct.isFauxFacade.length;wr++)if(Ct.isFauxFacade[wr]){const Wn=1|Math.min(65535,Math.floor(Ct.uv[2*wr]*pr.outerRingLength)),vi=Math.floor(255*It)<<8|Math.floor(255*Dt),Ur=Math.floor(65535*Math.min(1,Xt/Jt)),Fn=Math.floor(65535*Math.min(1,Vt/Jt));ur.layoutFacadeDataArray.emplaceBack(Wn,vi,Ur,Fn);const _i=Math.floor(65535*Math.min(1,jt/Jt)),ii=Math.floor(65535*Math.min(1,$t/Jt));ur.layoutFacadeVerticalRangeArray.emplaceBack(_i,ii)}else ur.layoutFacadeDataArray.emplaceBack(0,0,0,0),ur.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const Fr=ar.vertexLength;for(let wr=0;wr<Ct.indices.length;wr+=3)ur.indexArray.emplaceBack(Fr+Ct.indices[wr],Fr+Ct.indices[wr+1],Fr+Ct.indices[wr+2]);ar.vertexLength+=Ct.positions.length/3,ar.primitiveLength+=Ct.indices.length/3,(Ct.buildingPart==="roof"||Ct.buildingPart==="wall"||Ct.buildingPart==="facade_glazing"||Ct.buildingPart==="entrance")&&Xr.push({part:Ct.buildingPart,vertexOffset:or,vertexLength:Ct.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,nn),this.buildingFeatures.push({promoteId:$,feature:Y,hasFauxFacade:Tt,segment:ar,parts:Xr,buildingBloom:sr});const Hn=ur.indexArray.length-Bn,Kn=[],Yi=[],ze=new Mt(1/0,1/0),Ne=new Mt(-1/0,-1/0),Pt=this.groundEffect.vertexArray.length;for(const Ct of pr.modifiedPolygonRings){const or=[],Ar=new Mt(1/0,1/0),Er=new Mt(-1/0,-1/0);for(let an=0;an<Ct.length;an+=2){const Fr=Ct.length-an-2;Ar.x=Math.min(Ar.x,Ct[Fr]),Ar.y=Math.min(Ar.y,Ct[Fr+1]),Er.x=Math.max(Er.x,Ct[Fr]),Er.y=Math.max(Er.y,Ct[Fr+1]);const wr=new Mt(Ct[Fr],Ct[Fr+1]);or.push(wr),Kn.push(wr.x,wr.y),Yi.push(wr.clone())}ze.x=Math.min(ze.x,Ar.x),ze.y=Math.min(ze.y,Ar.y),Ne.x=Math.max(Ne.x,Er.x),Ne.y=Math.max(Ne.y,Er.y),this.groundEffect.addData(or,[Ar,Er],Ke)}const nr=this.groundEffect.vertexArray.length-Pt;for(let Ct=0;Ct<nr;Ct++)this.groundEffect.groundRadiusArray.emplaceBack(Ue);(vt.x<0||zt.x>Jt||vt.y<0||zt.y>Jt)&&this.featuresOnBorder.push({featureId:M.id,footprintIndex:this.footprints.length});{const Ct=V_(Kn,null,2),or=new fA(Yi,Ct,8,256);let Ar=M.id;M.properties&&M.properties.hasOwnProperty("building_id")&&(Ar=M.properties.building_id);const Er={vertices:Yi,indices:Ct,grid:or,min:ze,max:Ne,buildingId:Ar,hiddenFlags:0,indicesOffset:Bn,indicesLength:Hn,bloomIndicesOffset:Or,bloomIndicesLength:Qr,groundEffectVertexOffset:Pt,groundEffectVertexLength:nr,hasFauxFacade:Tt,segment:ar,height:nn};M.id!==void 0&&this.featureFootprintLookup.set(M.id,this.footprints.length),this.footprints.push(Er)}this.programConfigurations.populatePaintArrays(ur.layoutVertexArray.length,M,V,{},c.availableImages,f,c.brightness),this.groundEffect.addPaintPropertiesData(M,V,{},c.availableImages,f,c.brightness),c.featureIndex.insert(M,se,V,q,this.index,vn)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(a,c,f,p,x,b,A){this.programConfigurations.updatePaintArrays(a,c,x,f,p,b,A),this.groundEffect.update(a,c,x,f,p,b,A),this.evaluate(this.layers[0],a),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(a){const c=f=>{f.layoutVertexBuffer=a.createVertexBuffer(f.layoutVertexArray,BU.members),f.layoutNormalBuffer=a.createVertexBuffer(f.layoutNormalArray,fde.members),f.layoutCentroidBuffer=a.createVertexBuffer(f.layoutCentroidArray,pde.members),f.layoutFloodLightDataBuffer=a.createVertexBuffer(f.layoutFloodLightDataArray,_de.members),f.layoutFacadeDataArray&&f.layoutFacadeDataArray.length&&(f.layoutFacadeDataBuffer=a.createVertexBuffer(f.layoutFacadeDataArray,gde.members)),f.layoutFacadeVerticalRangeArray&&f.layoutFacadeVerticalRangeArray.length&&(f.layoutFacadeVerticalRangeBuffer=a.createVertexBuffer(f.layoutFacadeVerticalRangeArray,yde.members)),f.entranceBloom.layoutVertexArray.length&&(f.entranceBloom.layoutVertexBuffer=a.createVertexBuffer(f.entranceBloom.layoutVertexArray,BU.members),f.entranceBloom.layoutAttenuationBuffer=a.createVertexBuffer(f.entranceBloom.layoutAttenuationArray,vde.members)),this.uploadUpdatedColorBuffer(a),this.uploadUpdatedIndexBuffer(a)};this.uploaded||(c(this.buildingWithoutFacade),c(this.buildingWithFacade),this.groundEffect.upload(a)),this.groundEffect.uploadPaintProperties(a),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){const a=c=>{c.layoutVertexBuffer&&(c.layoutVertexBuffer.destroy(),c.layoutNormalBuffer.destroy(),c.layoutColorBuffer.destroy(),c.segmentsBucket.destroy(),c.indexBuffer&&c.indexBuffer.destroy(),c.entranceBloom.layoutVertexBuffer&&(c.entranceBloom.layoutVertexBuffer.destroy(),c.entranceBloom.layoutColorBuffer.destroy(),c.entranceBloom.layoutAttenuationBuffer.destroy(),c.entranceBloom.indexBuffer.destroy(),c.entranceBloom.segmentsBucket.destroy()))};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(a,c,f=!0){let p=!1;const x=f?c:0,b=0|(f?-1:~c);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const A of a){const k=this.footprints[A],M=k.hiddenFlags&b|x;k.hiddenFlags!==M&&(k.hiddenFlags=M,p=!0,this.groundEffect.updateHiddenByLandmarkRange(k.groundEffectVertexOffset,k.groundEffectVertexLength,k.hiddenFlags!==0))}return p&&(this.indexArrayForConflationUploaded=!1),p}uploadUpdatedIndexBuffer(a){if(this.groundEffect.uploadHiddenByLandmark(a),this.indexArrayForConflationUploaded)return;const c=p=>{p.indexArray.length!==0&&(p.indexArrayForConflation.resize(p.indexArray.length),p.indexArrayForConflation.uint16.set(p.indexArray.uint16),p.entranceBloom.indexArrayForConflation.resize(p.entranceBloom.indexArray.length),p.entranceBloom.indexArrayForConflation.uint16.set(p.entranceBloom.indexArray.uint16))};c(this.buildingWithoutFacade),c(this.buildingWithFacade);for(const p of this.footprints){const x=p.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,b=p.indicesOffset+p.indicesLength;if(p.hiddenFlags!==0){for(let k=p.indicesOffset;k<b;k++)x.indexArrayForConflation.uint16[3*k+0]=0,x.indexArrayForConflation.uint16[3*k+1]=0,x.indexArrayForConflation.uint16[3*k+2]=0;const A=p.bloomIndicesOffset+p.bloomIndicesLength;for(let k=p.bloomIndicesOffset;k<A;k++)x.entranceBloom.indexArrayForConflation.uint16[3*k+0]=0,x.entranceBloom.indexArrayForConflation.uint16[3*k+1]=0,x.entranceBloom.indexArrayForConflation.uint16[3*k+2]=0}}const f=p=>{p.indexArray.length!==0&&(p.indexBuffer?p.indexBuffer.updateData(p.indexArrayForConflation):p.indexBuffer=a.createIndexBuffer(p.indexArrayForConflation,!0),p.entranceBloom.indexBuffer?p.entranceBloom.indexBuffer.updateData(p.entranceBloom.indexArrayForConflation):p.entranceBloom.indexBuffer=a.createIndexBuffer(p.entranceBloom.indexArrayForConflation,!0))};f(this.buildingWithoutFacade),f(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(a){const c=f=>{f.layoutColorBuffer?f.layoutColorBuffer.updateData(f.layoutColorArray):f.layoutColorBuffer=a.createVertexBuffer(f.layoutColorArray,$U.members,!0),f.layoutFacadePaintArray&&(f.layoutFacadePaintBuffer?f.layoutFacadePaintBuffer.updateData(f.layoutFacadePaintArray):f.layoutFacadePaintBuffer=a.createVertexBuffer(f.layoutFacadePaintArray,mde.members,!0)),f.entranceBloom.layoutColorBuffer?f.entranceBloom.layoutColorBuffer.updateData(f.entranceBloom.layoutColorArray):f.entranceBloom.layoutColorBuffer=a.createVertexBuffer(f.entranceBloom.layoutColorArray,$U.members,!0)};c(this.buildingWithoutFacade),c(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(a,c){const f=a.paint.get("building-ambient-occlusion-intensity");for(const p of this.buildingFeatures){const x=c[p.promoteId],b=p.feature;b.properties["building-part"]="roof";const A=a.paint.get("building-color").evaluate(b,x,this.canonical).toPremultipliedRenderColor(this.lut),k=a.paint.get("building-emissive-strength").evaluate(b,x,this.canonical);b.properties["building-part"]="wall";const M=a.paint.get("building-color").evaluate(b,x,this.canonical).toPremultipliedRenderColor(this.lut),$=a.paint.get("building-emissive-strength").evaluate(b,x,this.canonical);b.properties["building-part"]="window";const V=a.paint.get("building-color").evaluate(b,x,this.canonical).toPremultipliedRenderColor(this.lut),q=a.paint.get("building-emissive-strength").evaluate(b,x,this.canonical);b.properties["building-part"]="door";const X=a.paint.get("building-color").evaluate(b,x,this.canonical).toPremultipliedRenderColor(this.lut),Y=a.paint.get("building-emissive-strength").evaluate(b,x,this.canonical),se=p.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const he of p.parts){let be,Ee=A;he.part==="roof"?(Ee=A,be=k):he.part==="wall"?(Ee=M,be=$):he.part==="facade_glazing"?(Ee=V,be=q):he.part==="entrance"&&(Ee=X,be=Y),be=ve(be,0,1);for(let Oe=0;Oe<he.vertexLength;Oe++){const Ue=he.vertexOffset+Oe,Fe=1+(se.layoutAOArray.float32[Ue]-1)*f;se.layoutColorArray.emplace(Ue,Ee.r*Fe*255<<8|Ee.g*Fe*255,Ee.b*Fe*255<<8|255*be),p.hasFauxFacade&&se.layoutFacadePaintArray.emplace(Ue,255*V.r<<8|255*V.g,255*V.b<<8|255*q)}}const ce=p.buildingBloom;if(ce)for(let he=0;he<ce.vertexLength;he++)se.entranceBloom.layoutColorArray.emplace(ce.vertexOffset+he,255*X.r<<8|255*X.g,255*X.b<<8|51*Y)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(a,c,f){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const p=c.getReplacementRegionsForTile(a.toUnwrapped());if(mA(this.activeReplacements,p))return;this.activeReplacements=p;for(const b of this.footprints)b.hiddenFlags&=-2;const x=[];for(const b of this.activeReplacements){if(b.order<=W$)continue;const A=Math.max(1,Math.pow(2,b.footprintTileId.canonical.z-a.canonical.z));for(const k of this.footprints)k.min.x>b.max.x||k.max.x<b.min.x||k.min.y>b.max.y||k.max.y<b.min.y||(x.length=0,bde(k.vertices,0,k.vertices.length,b.footprintTileId.canonical,a.canonical,x),qj(b.footprint,x,k.indices,0,k.indices.length,0,-A)&&(k.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const b of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(b.groundEffectVertexOffset,b.groundEffectVertexLength,b.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(a){if(a.id!==void 0){const c=this.featureFootprintLookup.get(a.id);return this.footprints[c]}return null}getHeightAtTileCoord(a,c){let f=Number.NEGATIVE_INFINITY,p=!0;const x=4*(a+Jt)*Jt+(c+Jt);if(this.footprintLookup.hasOwnProperty(x)){const A=this.footprintLookup[x];return A?{height:A.height,hidden:A.hiddenFlags!==0}:void 0}const b=new Mt(a,c);for(const A of this.footprints)a>A.max.x||A.min.x>a||c>A.max.y||A.min.y>c||A.height<=f||Wj(b,A)&&(f=A.height,this.footprintLookup[x]=A,p=A.hiddenFlags!==0);if(f!==Number.NEGATIVE_INFINITY)return{height:f,hidden:p};this.footprintLookup[x]=void 0}}function bde(u,a,c,f,p,x){const b=Math.pow(2,f.z-p.z);for(let A=0;A<c;A++){let k=u[A+a].x,M=u[A+a].y;k=(k+p.x*Jt)*b-f.x*Jt,M=(M+p.y*Jt)*b-f.y*Jt,x.push(new Mt(k,M))}}let WU,GU;gr(qU,"BuildingBucket",{omit:["layers"]}),gr(uN,"BuildingGeometry"),gr(VU,"BuildingBloomGeometry");const wde=Tn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Sde=Tn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Ede}=wde,Tde=Tn([{name:"a_packed",components:3,type:"Float32"}]),{members:Ade}=Tde,Pde=Tn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Cde}=Pde;class HU{constructor(a,c){this.width=a,this.height=c,this.nextRow=0,this.image=new Np({width:a,height:c}),this.positions={},this.uploaded=!1}getDash(a,c){const f=this.getKey(a,c);return this.positions[f]}trim(){const a=this.width,c=this.height=st(this.nextRow);this.image.resize({width:a,height:c})}getKey(a,c){return a.join(",")+c}getDashRanges(a,c,f){const p=[];let x=a.length%2==1?-a[a.length-1]*f:0,b=a[0]*f,A=!0;p.push({left:x,right:b,isDash:A,zeroLength:a[0]===0});let k=a[0];for(let M=1;M<a.length;M++){A=!A;const $=a[M];x=k*f,k+=$,b=k*f,p.push({left:x,right:b,isDash:A,zeroLength:$===0})}return p}addRoundDash(a,c,f){const p=c/2;for(let x=-f;x<=f;x++){const b=this.width*(this.nextRow+f+x);let A=0,k=a[A];for(let M=0;M<this.width;M++){M/k.right>1&&(k=a[++A]);const $=Math.abs(M-k.left),V=Math.abs(M-k.right),q=Math.min($,V);let X;const Y=x/f*(p+1);if(k.isDash){const se=p-Math.abs(Y);X=Math.sqrt(q*q+se*se)}else X=p-Math.sqrt(q*q+Y*Y);this.image.data[b+M]=Math.max(0,Math.min(255,X+128))}}}addRegularDash(a,c){for(let k=a.length-1;k>=0;--k){const M=a[k],$=a[k+1];M.zeroLength?a.splice(k,1):$&&$.isDash===M.isDash&&($.left=M.left,a.splice(k,1))}const f=a[0],p=a[a.length-1];f.isDash===p.isDash&&(f.left=p.left-this.width,p.right=f.right+this.width);const x=this.width*this.nextRow;let b=0,A=a[b];for(let k=0;k<this.width;k++){k/A.right>1&&(A=a[++b]);const M=Math.abs(k-A.left),$=Math.abs(k-A.right),V=Math.min(M,$);this.image.data[x+k]=Math.max(0,Math.min(255,(A.isDash?V:-V)+c+128))}}addDash(a,c){const f=this.getKey(a,c);if(this.positions[f])return this.positions[f];const p=c==="round",x=p?7:0,b=2*x+1;if(this.nextRow+b>this.height)return Ir("LineAtlas out of space"),null;a.length===0&&a.push(1);let A=0;for(let $=0;$<a.length;$++)a[$]<0&&(Ir("Negative value is found in line dasharray, replacing values with 0"),a[$]=0),A+=a[$];if(A!==0){const $=this.width/A,V=this.getDashRanges(a,this.width,$);p?this.addRoundDash(V,$,x):this.addRegularDash(V,c==="square"?.5*$:0)}const k=this.nextRow+x;this.nextRow+=b;const M={tl:[k,x],br:[A,0]};return this.positions[f]=M,M}}gr(HU,"LineAtlas");const Ode=Lt.types,kde=Math.cos(Math.PI/180*37.5),Ide=Math.cos(Math.PI/180*5);class dN{constructor(a){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=a.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=a.overscaling,this.pixelRatio=a.pixelRatio,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.projection=a.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new O_,this.layoutVertexArray2=new Sl,this.patternVertexArray=new Sl,this.indexArray=new Gi,this.programConfigurations=new Ic(a.layers,{zoom:a.zoom,lut:a.lut}),this.segments=new ta,this.maxLineLength=0,this.zOffsetVertexArray=new Sl,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.tessellationStep=a.tessellationStep?a.tessellationStep:Jt/64,this.worldview=a.worldview,this.hasAppearances=null}updateFootprints(a,c){}updateAppearances(a,c,f,p){}populate(a,c,f,p){this.hasPattern=Fj("line",this.layers,this.pixelRatio,c);const x=this.layers[0].layout.get("line-sort-key");this.tileToMeter=We(f);const b=this.layers[0].layout.get("line-elevation-reference");if(b==="hd-road-markup")this.elevationType="road";else{const q=this.layers[0].layout.get("line-z-offset"),X=q.isConstant()&&!q.constantOr(0);this.elevationType=b!=="sea"&&b!=="ground"&&X?"none":"offset",this.elevationType==="offset"&&b==="none"&&Ir(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const A=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&A!==void 0;const k=[];for(const{feature:q,id:X,index:Y,sourceLayerIndex:se}of a){const ce=this.layers[0]._featureFilter.needGeometry,he=gt(q,ce);if(!this.layers[0]._featureFilter.filter(new Ri(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),he,f))continue;const be=x?x.evaluate(he,{},f):void 0,Ee={id:X,properties:q.properties,type:q.type,sourceLayerIndex:se,index:Y,geometry:ce?he.geometry:kt(q,f,p),patterns:{},sortKey:be};k.push(Ee)}x&&k.sort((q,X)=>q.sortKey-X.sortKey);const{lineAtlas:M,featureIndex:$}=c,V=this.addConstantDashes(M);for(const q of k){const{geometry:X,index:Y,sourceLayerIndex:se}=q;if(V&&this.addFeatureDashes(q,M),this.hasPattern){const ce=zj("line",this.layers,q,this.zoom,this.pixelRatio,c);this.patternFeatures.push(ce)}else this.addFeature(q,X,Y,f,M.positions,c.availableImages,c.brightness,c.elevationFeatures);$.insert(a[Y].feature,X,Y,se,this.index)}}addConstantDashes(a){let c=!1;for(const f of this.layers){const p=f.paint.get("line-dasharray").value,x=f.layout.get("line-cap").value;if(p.kind!=="constant"||x.kind!=="constant")c=!0;else{const b=x.value,A=p.value;if(!A)continue;a.addDash(A,b)}}return c}addFeatureDashes(a,c){const f=this.zoom;for(const p of this.layers){const x=p.paint.get("line-dasharray").value,b=p.layout.get("line-cap").value;if(x.kind==="constant"&&b.kind==="constant")continue;let A,k;if(x.kind==="constant"){if(A=x.value,!A)continue}else A=x.evaluate({zoom:f},a);k=b.kind==="constant"?b.value:b.evaluate({zoom:f},a),c.addDash(A,k),a.patterns[p.id]=[c.getKey(A,k)]}}update(a,c,f,p,x,b,A,k){this.programConfigurations.updatePaintArrays(a,c,x,f,p,b,A,k)}addFeatures(a,c,f,p,x,b){for(const A of this.patternFeatures)this.addFeature(A,A.geometry,A.index,c,f,p,b)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,Ade)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=a.createVertexBuffer(this.patternVertexArray,Cde)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=a.createVertexBuffer(this.zOffsetVertexArray,Sde.members,!0)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Ede),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a,c){let f,p;if(c&&c>0?(f=`mapbox_clip_start_${c}`,p=`mapbox_clip_end_${c}`):(f="mapbox_clip_start",p="mapbox_clip_end"),a.properties&&a.properties.hasOwnProperty(f)&&a.properties.hasOwnProperty(p))return{start:+a.properties[f],end:+a.properties[p]}}addFeature(a,c,f,p,x,b,A,k){const M=this.layers[0].layout,$=M.get("line-join").evaluate(a,{}),V=M.get("line-cap").evaluate(a,{}),q=M.get("line-miter-limit"),X=M.get("line-round-limit");this.lineClips=this.lineFeatureClips(a),this.lineFeature=a;const Y=!(!a.properties||!a.properties.hasOwnProperty("mapbox_line_metrics"))&&a.properties.mapbox_line_metrics;this.zOffsetValue=M.get("line-z-offset").value;const se=this.layers[0].paint.get("line-width").value;if(se.kind!=="constant"&&se.isLineProgressConstant===!1&&(this.variableWidthValue=se),this.elevationType==="road"){const ce=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(a,c,p,k,$,V,q,X)){const[he,be]=this.clipRuntimeLinesToTile(c,1);for(let Ee=0;Ee<he.length;Ee++){const Oe=he[Ee],Ue=be[Ee],Fe={progress:{min:Ue.progress.min,max:Ue.progress.max},nextDir:this.computeSegNextDir(Ue,Oe),prevDir:this.computeSegPrevDir(Ue,Oe)};this.addLine(Oe,a,p,$,V,q,X,Fe,Y&&Ue.parentIndex>0?Ue.parentIndex:null)}this.fillNonElevatedRoadSegment(ce)}}else for(let ce=0;ce<c.length;ce++)this.addLine(c[ce],a,p,$,V,q,X,void 0,Y&&ce>0?ce:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,x,b,p,A,void 0,this.worldview)}computeSegNextDir(a,c){return a.nextPoint.sub(c.at(-2)).unit()}computeSegPrevDir(a,c){return c[1].sub(a.prevPoint).unit()}clipLinesToTile(a,c){return vA(a,-c,-c,Jt+c,Jt+c)}clipRuntimeLinesToTile(a,c){const f=[];return[vA(a,-c,-c,Jt+c,Jt+c,f),f]}addElevatedRoadFeature(a,c,f,p,x,b,A,k){const M=[],$=Zr.getElevationFeature(a,p);if($){const V=this.clipLinesToTile(c,1),q=this.prepareElevatedLines(V,$,f);for(const X of q)M.push({geometry:X,elevation:$,elevationTileID:f,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(M.length===0)return!1;for(const V of M){const q=this.layoutVertexArray.length;this.addLine(V.geometry,a,f,x,b,A,k);const X=new zn(f,V.elevationTileID);if(V.elevation)for(let Y=q;Y<this.layoutVertexArray.length;Y++){const se=new Mt(this.layoutVertexArray.int16[6*Y]>>1,this.layoutVertexArray.int16[6*Y+1]>>1),ce=X.pointElevation(se,V.elevation,.05);this.updateHeightRange(ce),this.zOffsetVertexArray.emplaceBack(ce,0,0)}else this.fillNonElevatedRoadSegment(q)}return!0}prepareElevatedLines(a,c,f){if(c.constantHeight!=null)return a;const p=[],x=1/We(f);for(const b of a)Vue(b,new Mi(c,x),0,p);return p}fillNonElevatedRoadSegment(a){for(let c=a;c<this.layoutVertexArray.length;c++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(a){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,a),this.heightRange.max=Math.max(this.heightRange.max,a)):this.heightRange={min:a,max:a}}addLine(a,c,f,p,x,b,A,k,M){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=M?this.lineFeatureClips(c,M):this.lineClips;const $=p==="none";this.patternJoinNone=this.hasPattern&&$,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const V=k&&k.progress.min>0,q=k&&k.progress.max<1;if(this.lineClips){let nt={min:this.lineClips.start,max:this.lineClips.end},Et=1;if(k){const It=this.lineClips.end-this.lineClips.start;nt=function(Dt,Xt,Vt){return{min:yi(Dt.min,Xt,Vt),max:yi(Dt.max,Xt,Vt)}}(k.progress,{min:0,max:1},nt),It>0&&(Et=(nt.max-nt.min)/It)}const ft=+c.properties.mapbox_clip_feature_len,Tt=+c.properties.mapbox_clip_seg_len;if(Number.isNaN(ft)||Number.isNaN(Tt)){for(let Dt=0;Dt<a.length-1;Dt++)this.totalDistance+=a[Dt].dist(a[Dt+1]);const It=this.totalDistance/(nt.max-nt.min);this.totalFeatureLength=Number.isFinite(It)?It:0,this.lineClips.start=nt.min,this.lineClips.end=nt.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=ft,this.distance=Tt*Et,this.lineClips.start=nt.min,this.lineClips.end=nt.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const X=Ode[c.type]==="Polygon";let Y=a.length;for(;Y>=2&&a[Y-1].equals(a[Y-2]);)Y--;let se=0;for(;se<Y-1&&a[se].equals(a[se+1]);)se++;if(Y<(X?3:2))return;p==="bevel"&&(b=1.05);const ce=this.segments.prepareSegment(10*Y,this.layoutVertexArray,this.indexArray);let he,be,Ee,Oe,Ue,Fe,Ke,Qe;k&&k.prevDir&&(Fe=k.prevDir.perp()),k&&k.nextDir&&(Ke=k.nextDir.perp()),this.e1=this.e2=-1,X&&(he=a[Y-2],Ue=a[se].sub(he)._unit()._perp());for(let nt=se;nt<Y;nt++){if(Ee=nt===Y-1?X?a[se+1]:void 0:a[nt+1],Ee&&a[nt].equals(Ee))continue;Ue&&(Oe=Ue),he&&(be=he),he=a[nt],Qe=this.evaluateLineProgressFeatures(be?be.dist(he):0),Ue=Ee?Ee.sub(he)._unit()._perp():Oe,Oe=Oe||Ue;const Et=be&&Ee;let ft=Et?p:X||$?"butt":x;const Tt=Oe.x*Ue.x+Oe.y*Ue.y;if($){const vt=function(zt){if(zt.patternJoinNone){const Ht=zt.segmentPoints.length/2,Nt=zt.lineSoFar-zt.segmentStart;for(let pr=0;pr<Ht;++pr){const _r=zt.segmentPoints[2*pr+1],ur=Math.round(zt.segmentPoints[2*pr])+.5+.25*_r;zt.patternVertexArray.emplaceBack(ur,Nt,zt.segmentStart),zt.patternVertexArray.emplaceBack(ur,Nt,zt.segmentStart)}zt.segmentPoints.length=0}zt.e1=zt.e2=-1};if(Et&&Tt<Ide){this.updateDistance(be,he),this.addCurrentVertex(he,Oe,1,1,ce,Qe),vt(this),this.addCurrentVertex(he,Ue,-1,-1,ce,Qe);continue}if(be){if(!Ee){this.updateDistance(be,he),this.addCurrentVertex(he,Oe,1,1,ce,Qe),vt(this);continue}ft="miter"}}let It=Oe.add(Ue);It.x===0&&It.y===0||It._unit();const Dt=It.x*Ue.x+It.y*Ue.y,Xt=Dt!==0?1/Dt:1/0,Vt=2*Math.sqrt(2-2*Dt),jt=Dt<kde&&be&&Ee,$t=Oe.x*Ue.y-Oe.y*Ue.x>0,xt=this.overscaling<=16?15*Jt/(512*this.overscaling):0;if(Et&&ft==="round"){if(Xt<A)ft="miter";else if(Xt<=2){const vt=hN(he,-10,Jt+10);ft=this.elevationType==="offset"&&(vt||this.hasCrossSlope)?"miter":"fakeround"}}if(ft==="miter"&&Xt>b&&(ft="bevel"),ft==="bevel"&&(Xt>2&&(ft="flipbevel"),Xt<b&&(ft="miter")),be&&!(ft==="miter"&&jt)&&this.updateDistance(be,he),ft==="miter")if(jt){const vt=he.dist(be);if(vt>2*xt){const Ht=he.sub(he.sub(be)._mult(xt/vt)._round());this.updateDistance(be,Ht),this.addCurrentVertex(Ht,Oe,0,0,ce,Qe),be=Ht}this.updateDistance(be,he),It._mult(Xt),this.addCurrentVertex(he,It,0,0,ce,Qe);const zt=he.dist(Ee);if(zt>2*xt){const Ht=he.add(Ee.sub(he)._mult(xt/zt)._round());this.updateDistance(he,Ht),this.addCurrentVertex(Ht,Ue,0,0,ce,Qe),he=Ht}}else It._mult(Xt),this.addCurrentVertex(he,It,0,0,ce,Qe);else if(ft==="flipbevel"){if(Xt>100)It=Ue.mult(-1);else{const vt=Xt*Oe.add(Ue).mag()/Oe.sub(Ue).mag();It._perp()._mult(vt*($t?-1:1))}this.addCurrentVertex(he,It,0,0,ce,Qe),this.addCurrentVertex(he,It.mult(-1),0,0,ce,Qe)}else if(ft==="bevel"||ft==="fakeround"){Qe!=null&&be&&this.addCurrentVertex(he,Ke||Oe,-1,-1,ce,Qe);const vt=he.dist(be)<=2*xt&&ft!=="bevel",zt=It.mult($t?1:-1);zt._mult(Xt);const Ht=Ue.mult($t?-1:1),Nt=Oe.mult($t?-1:1),pr=this.evaluateLineProgressFeatures(this.distance);if(Qe==null&&(this.addHalfVertex(he,zt.x,zt.y,!1,!$t,0,ce,pr),vt||this.addHalfVertex(he,zt.x+2*Nt.x,zt.y+2*Nt.y,!1,$t,0,ce,pr)),ft==="fakeround"){const _r=Math.round(180*Vt/Math.PI/20);this.addHalfVertex(he,Nt.x,Nt.y,!1,$t,0,ce,pr);for(let ur=0;ur<_r;ur++){let ar=ur/_r;if(ar!==.5){const sr=ar-.5;ar+=ar*sr*(ar-1)*((1.0904+Tt*(Tt*(3.55645-1.43519*Tt)-3.2452))*sr*sr+(.848013+Tt*(.215638*Tt-1.06021)))}const Xr=Ht.sub(Nt)._mult(ar)._add(Nt)._unit();this.addHalfVertex(he,Xr.x,Xr.y,!1,$t,0,ce,pr)}this.addHalfVertex(he,Ht.x,Ht.y,!1,$t,0,ce,pr)}vt||Qe!=null||this.addHalfVertex(he,zt.x+2*Ht.x,zt.y+2*Ht.y,!1,$t,0,ce,pr),Qe!=null&&Ee&&this.addCurrentVertex(he,Fe||Ue,1,1,ce,Qe)}else if(ft==="butt")this.addCurrentVertex(he,It,0,0,ce,Qe);else if(ft==="square"){if(!be){const vt=V?0:-1;this.addCurrentVertex(he,It,vt,vt,ce,Qe)}if(this.addCurrentVertex(he,It,0,0,ce,Qe),be){const vt=q?0:1;this.addCurrentVertex(he,It,vt,vt,ce,Qe)}}else if(ft==="round"){if(be){const vt=!Et&&Ke?Ke:Oe;this.addCurrentVertex(he,vt,0,0,ce,Qe),!Et&&q||this.addCurrentVertex(he,vt,1,1,ce,Qe,!0)}if(Ee){const vt=!Et&&Fe?Fe:Ue;!Et&&V||this.addCurrentVertex(he,vt,-1,-1,ce,Qe,!0),this.addCurrentVertex(he,vt,0,0,ce,Qe)}}}}addVerticesTo(a,c,f,p,x,b,A,k,M,$){const V=(c.w-a.w)/this.tessellationStep|0;let q=0;const X=this.scaledDistance;if(V>1){this.lineSoFar=a.w;const se=(c.x-a.x)/V,ce=(c.y-a.y)/V,he=(c.z-a.z)/V,be=(c.w-a.w)/V;for(let Ee=1;Ee<V;++Ee){a.x+=se,a.y+=ce,a.z+=he,this.lineSoFar+=be,q+=be;const Oe=this.evaluateLineProgressFeatures(this.prevDistance+q);this.scaledDistance=(this.prevDistance+q)/this.totalDistance,this.addHalfVertex(a,f,p,$,!1,A,M,Oe),this.addHalfVertex(a,x,b,$,!0,-k,M,Oe)}}this.lineSoFar=c.w,this.scaledDistance=X;const Y=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(c,f,p,$,!1,A,M,Y),this.addHalfVertex(c,x,b,$,!0,-k,M,Y)}evaluateLineProgressFeatures(a){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+a)/this.totalFeatureLength):Ir(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let c=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(c=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:c}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:c}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:c}}addCurrentVertex(a,c,f,p,x,b,A=!1){const k=c.x+c.y*f,M=c.y-c.x*f,$=c.y*p-c.x,V=-c.y-c.x*p;if(b!=null){const q=this.elevationType==="offset",X=-10,Y=Jt+10,se=b.zOffset,ce=new pU(a.x,a.y,se,this.lineSoFar),he=!!q&&hN(a,X,Y),be=this.lineSoFar,Ee=this.distance;if(this.currentVertex)if(he){const Oe=this.currentVertexIsOutside,Ue=this.currentVertex,Fe=new pU(a.x,a.y,se,this.lineSoFar);if(gU(Ue,Fe,X,Y),!hN(Fe,X,Y)){if(Oe){this.e1=this.e2=-1,this.distance-=Ue.dist(ce),this.lineSoFar=Ue.w;const Ke=this.evaluateLineProgressFeatures(Ue.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ue,k,M,A,!1,f,x,Ke),this.addHalfVertex(Ue,$,V,A,!0,-p,x,Ke),this.prevDistance=this.distance}this.distance=this.prevDistance+Ue.dist(Fe),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Ue,Fe,k,M,$,V,f,p,x,A),this.distance=Ee,this.scaledDistance=this.distance/this.totalDistance}}else{const Oe=this.currentVertex;if(this.currentVertexIsOutside){gU(Oe,ce,X,Y),this.e1=this.e2=-1,this.distance-=Oe.dist(ce),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Oe.w;const Ue=this.evaluateLineProgressFeatures(Oe.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Oe,k,M,A,!1,f,x,Ue),this.addHalfVertex(Oe,$,V,A,!0,-p,x,Ue),this.prevDistance=this.distance,this.distance=Ee,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Oe,ce,k,M,$,V,f,p,x,A)}else he||(this.addHalfVertex(a,k,M,A,!1,f,x,b),this.addHalfVertex(a,$,V,A,!0,-p,x,b));this.currentVertex=ce,this.currentVertexIsOutside=he,this.lineSoFar=be}else this.addHalfVertex(a,k,M,A,!1,f,x,b),this.addHalfVertex(a,$,V,A,!0,-p,x,b)}addHalfVertex({x:a,y:c},f,p,x,b,A,k,M){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),b||this.segmentPoints.push(this.lineSoFar-this.segmentStart,A)),this.layoutVertexArray.emplaceBack((a<<1)+(x?1:0),(c<<1)+(b?1:0),Math.round(63*f)+128,Math.round(63*p)+128,1+(A===0?0:A<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const V=qr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,V)}const $=k.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,$),k.primitiveLength++),b?this.e2=$:this.e1=$,M!=null&&this.zOffsetVertexArray.emplaceBack(M.zOffset,M.variableWidth,M.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(a,c){this.prevDistance=this.distance,this.distance+=a.dist(c),this.updateScaledDistance()}}function hN(u,a,c){return u.x<a||u.x>c||u.y<a||u.y>c}let KU,ZU;function XU(u,a,c){return a*(Jt/(u.tileSize*Math.pow(2,c-u.tileID.overscaledZ)))}gr(dN,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const YU=(u,a,c)=>(1-c)*u+c*a;function JU(u,a){return 1/XU(u,1,a.tileZoom)}function QU(u,a,c,f){return u.translatePosMatrix(f||a.tileID.projMatrix,a,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const eV=u=>{const a=[];tV(u)&&a.push("RENDER_LINE_DASH"),u.paint.get("line-gradient")&&a.push("RENDER_LINE_GRADIENT");const c=u.paint.get("line-trim-offset");c[0]===0&&c[1]===0||a.push("RENDER_LINE_TRIM_OFFSET"),u.paint.get("line-border-width").constantOr(1)!==0&&a.push("RENDER_LINE_BORDER");const f=u.layout.get("line-join").constantOr("miter")==="none",p=!!u.paint.get("line-pattern").constantOr(1);return f&&p&&a.push("LINE_JOIN_NONE"),a};function tV(u){const a=u.paint.get("line-dasharray").value;return a.kind!=="constant"||a.value}let fN;const rV=()=>fN||(fN={layout:KU||(KU=new ua({"line-cap":new lr(ht.layout_line["line-cap"]),"line-join":new lr(ht.layout_line["line-join"]),"line-miter-limit":new Wt(ht.layout_line["line-miter-limit"]),"line-round-limit":new Wt(ht.layout_line["line-round-limit"]),"line-sort-key":new lr(ht.layout_line["line-sort-key"]),"line-z-offset":new lr(ht.layout_line["line-z-offset"]),"line-elevation-reference":new Wt(ht.layout_line["line-elevation-reference"]),"line-cross-slope":new Wt(ht.layout_line["line-cross-slope"]),visibility:new Wt(ht.layout_line.visibility),"line-width-unit":new Wt(ht.layout_line["line-width-unit"])})),paint:ZU||(ZU=new ua({"line-opacity":new lr(ht.paint_line["line-opacity"]),"line-color":new lr(ht.paint_line["line-color"]),"line-translate":new Wt(ht.paint_line["line-translate"]),"line-translate-anchor":new Wt(ht.paint_line["line-translate-anchor"]),"line-width":new lr(ht.paint_line["line-width"]),"line-gap-width":new lr(ht.paint_line["line-gap-width"]),"line-offset":new lr(ht.paint_line["line-offset"]),"line-blur":new lr(ht.paint_line["line-blur"]),"line-dasharray":new lr(ht.paint_line["line-dasharray"]),"line-pattern":new lr(ht.paint_line["line-pattern"]),"line-pattern-cross-fade":new Wt(ht.paint_line["line-pattern-cross-fade"]),"line-gradient":new vp(ht.paint_line["line-gradient"]),"line-trim-offset":new Wt(ht.paint_line["line-trim-offset"]),"line-trim-fade-range":new Wt(ht.paint_line["line-trim-fade-range"]),"line-trim-color":new Wt(ht.paint_line["line-trim-color"]),"line-emissive-strength":new Wt(ht.paint_line["line-emissive-strength"]),"line-border-width":new lr(ht.paint_line["line-border-width"]),"line-border-color":new lr(ht.paint_line["line-border-color"]),"line-occlusion-opacity":new Wt(ht.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"})}))},fN);class Rde extends lr{possiblyEvaluate(a,c){return c=new Ri(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,transition:c.transition,worldview:c.worldview}),super.possiblyEvaluate(a,c)}evaluate(a,c,f,p){return c=Object.assign({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(a,c,f,p)}}let O1;function nV(u,a){return a>0?a+2*u:u}const jde=Tn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Nde=Tn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Mde=Tn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Tn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Dde=Tn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Lde=Tn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),Fde=Tn([{name:"a_texb",components:2,type:"Uint16"}]),zde=Tn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Bde=Tn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Tn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const iV=Tn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$de=Tn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Tn([{name:"triangle",components:3,type:"Uint16"}]),Tn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Tn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Tn([{type:"Float32",name:"offsetX"}]),Tn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var To=24;function Ude(u,a,c){return u.sections.forEach(f=>{f.text=function(p,x,b){const A=x.layout.get("text-transform").evaluate(b,{});return A==="uppercase"?p=p.toLocaleUpperCase():A==="lowercase"&&(p=p.toLocaleLowerCase()),el.applyArabicShaping&&(p=el.applyArabicShaping(p)),p}(f.text,a,c)}),u}const k1={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Vde(u){return u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""}function qde(u){return u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""}const pN=4294967296,aV=1/pN,oV=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let OA=class{constructor(u=new Uint8Array(16)){this.buf=ArrayBuffer.isView(u)?u:new Uint8Array(u),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(u,a,c=this.length){for(;this.pos<c;){const f=this.readVarint(),p=f>>3,x=this.pos;this.type=7&f,u(p,a,this),this.pos===x&&this.skip(f)}return a}readMessage(u,a){return this.readFields(u,a,this.readVarint()+this.pos)}readFixed32(){const u=this.dataView.getUint32(this.pos,!0);return this.pos+=4,u}readSFixed32(){const u=this.dataView.getInt32(this.pos,!0);return this.pos+=4,u}readFixed64(){const u=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*pN;return this.pos+=8,u}readSFixed64(){const u=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*pN;return this.pos+=8,u}readFloat(){const u=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,u}readDouble(){const u=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,u}readVarint(u){const a=this.buf;let c,f;return f=a[this.pos++],c=127&f,f<128?c:(f=a[this.pos++],c|=(127&f)<<7,f<128?c:(f=a[this.pos++],c|=(127&f)<<14,f<128?c:(f=a[this.pos++],c|=(127&f)<<21,f<128?c:(f=a[this.pos],c|=(15&f)<<28,function(p,x,b){const A=b.buf;let k,M;if(M=A[b.pos++],k=(112&M)>>4,M<128||(M=A[b.pos++],k|=(127&M)<<3,M<128)||(M=A[b.pos++],k|=(127&M)<<10,M<128)||(M=A[b.pos++],k|=(127&M)<<17,M<128)||(M=A[b.pos++],k|=(127&M)<<24,M<128)||(M=A[b.pos++],k|=(1&M)<<31,M<128))return X_(p,k,x);throw new Error("Expected varint not more than 10 bytes")}(c,u,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const u=this.readVarint();return u%2==1?(u+1)/-2:u/2}readBoolean(){return!!this.readVarint()}readString(){const u=this.readVarint()+this.pos,a=this.pos;return this.pos=u,u-a>=12&&oV?oV.decode(this.buf.subarray(a,u)):function(c,f,p){let x="",b=f;for(;b<p;){const A=c[b];let k,M,$,V=null,q=A>239?4:A>223?3:A>191?2:1;if(b+q>p)break;q===1?A<128&&(V=A):q===2?(k=c[b+1],(192&k)==128&&(V=(31&A)<<6|63&k,V<=127&&(V=null))):q===3?(k=c[b+1],M=c[b+2],(192&k)==128&&(192&M)==128&&(V=(15&A)<<12|(63&k)<<6|63&M,(V<=2047||V>=55296&&V<=57343)&&(V=null))):q===4&&(k=c[b+1],M=c[b+2],$=c[b+3],(192&k)==128&&(192&M)==128&&(192&$)==128&&(V=(15&A)<<18|(63&k)<<12|(63&M)<<6|63&$,(V<=65535||V>=1114112)&&(V=null))),V===null?(V=65533,q=1):V>65535&&(V-=65536,x+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),x+=String.fromCharCode(V),b+=q}return x}(this.buf,a,u)}readBytes(){const u=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,u);return this.pos=u,a}readPackedVarint(u=[],a){const c=this.readPackedEnd();for(;this.pos<c;)u.push(this.readVarint(a));return u}readPackedSVarint(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readSVarint());return u}readPackedBoolean(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readBoolean());return u}readPackedFloat(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readFloat());return u}readPackedDouble(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readDouble());return u}readPackedFixed32(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readFixed32());return u}readPackedSFixed32(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readSFixed32());return u}readPackedFixed64(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readFixed64());return u}readPackedSFixed64(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readSFixed64());return u}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(u){const a=7&u;if(a===0)for(;this.buf[this.pos++]>127;);else if(a===2)this.pos=this.readVarint()+this.pos;else if(a===5)this.pos+=4;else{if(a!==1)throw new Error(`Unimplemented type: ${a}`);this.pos+=8}}writeTag(u,a){this.writeVarint(u<<3|a)}realloc(u){let a=this.length||16;for(;a<this.pos+u;)a*=2;if(a!==this.length){const c=new Uint8Array(a);c.set(this.buf),this.buf=c,this.dataView=new DataView(c.buffer),this.length=a}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(u){this.realloc(4),this.dataView.setInt32(this.pos,u,!0),this.pos+=4}writeSFixed32(u){this.realloc(4),this.dataView.setInt32(this.pos,u,!0),this.pos+=4}writeFixed64(u){this.realloc(8),this.dataView.setInt32(this.pos,-1&u,!0),this.dataView.setInt32(this.pos+4,Math.floor(u*aV),!0),this.pos+=8}writeSFixed64(u){this.realloc(8),this.dataView.setInt32(this.pos,-1&u,!0),this.dataView.setInt32(this.pos+4,Math.floor(u*aV),!0),this.pos+=8}writeVarint(u){(u=+u||0)>268435455||u<0?function(a,c){let f,p;if(a>=0?(f=a%4294967296|0,p=a/4294967296|0):(f=~(-a%4294967296),p=~(-a/4294967296),4294967295^f?f=f+1|0:(f=0,p=p+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(x,b,A){A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,A.buf[A.pos]=127&(x>>>=7)}(f,0,c),function(x,b){const A=(7&x)<<4;b.buf[b.pos++]|=A|((x>>>=3)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x)))))}(p,c)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))}writeSVarint(u){this.writeVarint(u<0?2*-u-1:2*u)}writeBoolean(u){this.writeVarint(+u)}writeString(u){u=String(u),this.realloc(4*u.length),this.pos++;const a=this.pos;this.pos=function(f,p,x){for(let b,A,k=0;k<p.length;k++){if(b=p.charCodeAt(k),b>55295&&b<57344){if(!A){b>56319||k+1===p.length?(f[x++]=239,f[x++]=191,f[x++]=189):A=b;continue}if(b<56320){f[x++]=239,f[x++]=191,f[x++]=189,A=b;continue}b=A-55296<<10|b-56320|65536,A=null}else A&&(f[x++]=239,f[x++]=191,f[x++]=189,A=null);b<128?f[x++]=b:(b<2048?f[x++]=b>>6|192:(b<65536?f[x++]=b>>12|224:(f[x++]=b>>18|240,f[x++]=b>>12&63|128),f[x++]=b>>6&63|128),f[x++]=63&b|128)}return x}(this.buf,u,this.pos);const c=this.pos-a;c>=128&&sV(a,c,this),this.pos=a-1,this.writeVarint(c),this.pos+=c}writeFloat(u){this.realloc(4),this.dataView.setFloat32(this.pos,u,!0),this.pos+=4}writeDouble(u){this.realloc(8),this.dataView.setFloat64(this.pos,u,!0),this.pos+=8}writeBytes(u){const a=u.length;this.writeVarint(a),this.realloc(a);for(let c=0;c<a;c++)this.buf[this.pos++]=u[c]}writeRawMessage(u,a){this.pos++;const c=this.pos;u(a,this);const f=this.pos-c;f>=128&&sV(c,f,this),this.pos=c-1,this.writeVarint(f),this.pos+=f}writeMessage(u,a,c){this.writeTag(u,2),this.writeRawMessage(a,c)}writePackedVarint(u,a){a.length&&this.writeMessage(u,Wde,a)}writePackedSVarint(u,a){a.length&&this.writeMessage(u,Gde,a)}writePackedBoolean(u,a){a.length&&this.writeMessage(u,Zde,a)}writePackedFloat(u,a){a.length&&this.writeMessage(u,Hde,a)}writePackedDouble(u,a){a.length&&this.writeMessage(u,Kde,a)}writePackedFixed32(u,a){a.length&&this.writeMessage(u,Xde,a)}writePackedSFixed32(u,a){a.length&&this.writeMessage(u,Yde,a)}writePackedFixed64(u,a){a.length&&this.writeMessage(u,Jde,a)}writePackedSFixed64(u,a){a.length&&this.writeMessage(u,Qde,a)}writeBytesField(u,a){this.writeTag(u,2),this.writeBytes(a)}writeFixed32Field(u,a){this.writeTag(u,5),this.writeFixed32(a)}writeSFixed32Field(u,a){this.writeTag(u,5),this.writeSFixed32(a)}writeFixed64Field(u,a){this.writeTag(u,1),this.writeFixed64(a)}writeSFixed64Field(u,a){this.writeTag(u,1),this.writeSFixed64(a)}writeVarintField(u,a){this.writeTag(u,0),this.writeVarint(a)}writeSVarintField(u,a){this.writeTag(u,0),this.writeSVarint(a)}writeStringField(u,a){this.writeTag(u,2),this.writeString(a)}writeFloatField(u,a){this.writeTag(u,5),this.writeFloat(a)}writeDoubleField(u,a){this.writeTag(u,1),this.writeDouble(a)}writeBooleanField(u,a){this.writeVarintField(u,+a)}};function X_(u,a,c){return c?4294967296*a+(u>>>0):4294967296*(a>>>0)+(u>>>0)}function sV(u,a,c){const f=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));c.realloc(f);for(let p=c.pos-1;p>=u;p--)c.buf[p+f]=c.buf[p]}function Wde(u,a){for(let c=0;c<u.length;c++)a.writeVarint(u[c])}function Gde(u,a){for(let c=0;c<u.length;c++)a.writeSVarint(u[c])}function Hde(u,a){for(let c=0;c<u.length;c++)a.writeFloat(u[c])}function Kde(u,a){for(let c=0;c<u.length;c++)a.writeDouble(u[c])}function Zde(u,a){for(let c=0;c<u.length;c++)a.writeBoolean(u[c])}function Xde(u,a){for(let c=0;c<u.length;c++)a.writeFixed32(u[c])}function Yde(u,a){for(let c=0;c<u.length;c++)a.writeSFixed32(u[c])}function Jde(u,a){for(let c=0;c<u.length;c++)a.writeFixed64(u[c])}function Qde(u,a){for(let c=0;c<u.length;c++)a.writeSFixed64(u[c])}const mN=3;function ehe(u,a,c){a.glyphs=[],u===1&&c.readMessage(the,a)}function the(u,a,c){if(u===3){const{id:f,bitmap:p,width:x,height:b,left:A,top:k,advance:M}=c.readMessage(rhe,{});a.glyphs.push({id:f,bitmap:new Np({width:x+2*mN,height:b+2*mN},p),metrics:{width:x,height:b,left:A,top:k,advance:M}})}else u===4?a.ascender=c.readSVarint():u===5&&(a.descender=c.readSVarint())}function rhe(u,a,c){u===1?a.id=c.readVarint():u===2?a.bitmap=c.readBytes():u===3?a.width=c.readVarint():u===4?a.height=c.readVarint():u===5?a.left=c.readSVarint():u===6?a.top=c.readSVarint():u===7&&(a.advance=c.readVarint())}const lV=mN,kl={horizontal:1,vertical:2,horizontalOnly:3};class I1{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(a,c){const f=new I1;return f.scale=a||1,f.fontStack=c,f}static forImage(a){const c=new I1;return c.image=a,c}}class Y_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(a,c,f){const p=new Y_;for(let x=0;x<a.sections.length;x++){const b=a.sections[x];b.image?p.addImageSection(b,f):p.addTextSection(b,c)}return p}length(){return this.text.length}getSection(a){return this.sections[this.sectionIndex[a]]}getSections(){return this.sections}getSectionIndex(a){return this.sectionIndex[a]}getCodePoint(a){return this.text.codePointAt(a)}verticalizePunctuation(a){this.text=function(c,f){let p="";for(let x=0;x<c.length;x++){const b=c.charCodeAt(x+1)||null,A=c.charCodeAt(x-1)||null;p+=!f&&(b&&Mw(b)&&!k1[c[x+1]]||A&&Mw(A)&&!k1[c[x-1]])||!k1[c[x]]?c[x]:k1[c[x]]}return p}(this.text,a)}trim(){let a=0;for(let f=0;f<this.text.length&&kA[this.text.charCodeAt(f)];f++)a++;let c=this.text.length;for(let f=this.text.length-1;f>=0&&f>=a&&kA[this.text.charCodeAt(f)];f--)c--;this.text=this.text.substring(a,c),this.sectionIndex=this.sectionIndex.slice(a,c)}substring(a,c){const f=new Y_;return f.text=this.text.substring(a,c),f.sectionIndex=this.sectionIndex.slice(a,c),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((a,c)=>Math.max(a,this.sections[c].scale),0)}addTextSection(a,c){this.text+=a.text,this.sections.push(I1.forText(a.scale,a.fontStack||c));const f=this.sections.length-1;for(let p=0;p<a.text.length;++p)this.sectionIndex.push(f)}addImageSection(a,c){const f=a.image?a.image.getPrimary():null;if(!f)return void Ir("Can't add FormattedSection with an empty image.");f.scaleSelf(c);const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCodePoint(p),this.sections.push(I1.forImage(f)),this.sectionIndex.push(this.sections.length-1)):Ir("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function gN(u,a,c,f,p,x,b,A,k,M,$,V,q,X,Y,se=1){const ce=Y_.fromFeature(u,p,se);V===kl.vertical&&ce.verticalizePunctuation(q);let he=[];const be=function(Ke,Qe,nt,Et,ft,Tt){if(!Ke)return[];const It=[],Dt=function($t,xt,vt,zt,Ht,Nt){let pr=0;for(let _r=0;_r<$t.length();_r++){const ur=$t.getSection(_r);pr+=cV($t.getCodePoint(_r),ur,zt,Ht,xt,Nt)}return pr/Math.max(1,Math.ceil(pr/vt))}(Ke,Qe,nt,Et,ft,Tt),Xt=Ke.text.indexOf("")>=0;let Vt=0;for(let $t=0;$t<Ke.length();$t++){const xt=Ke.getSection($t),vt=Ke.getCodePoint($t);if(kA[vt]||(Vt+=cV(vt,xt,Et,ft,Qe,Tt)),$t<Ke.length()-1){const zt=!((jt=vt)<11904||!(Nr["Bopomofo Extended"](jt)||Nr.Bopomofo(jt)||Nr["CJK Compatibility Forms"](jt)||Nr["CJK Compatibility Ideographs"](jt)||Nr["CJK Compatibility"](jt)||Nr["CJK Radicals Supplement"](jt)||Nr["CJK Strokes"](jt)||Nr["CJK Symbols and Punctuation"](jt)||Nr["CJK Unified Ideographs Extension A"](jt)||Nr["CJK Unified Ideographs"](jt)||Nr["Enclosed CJK Letters and Months"](jt)||Nr["Halfwidth and Fullwidth Forms"](jt)||Nr.Hiragana(jt)||Nr["Ideographic Description Characters"](jt)||Nr["Kangxi Radicals"](jt)||Nr["Katakana Phonetic Extensions"](jt)||Nr.Katakana(jt)||Nr["Vertical Forms"](jt)||Nr["Yi Radicals"](jt)||Nr["Yi Syllables"](jt)));(nhe[vt]||zt||xt.image)&&It.push(dV($t+1,Vt,Dt,It,ihe(vt,Ke.getCodePoint($t+1),zt&&Xt),!1))}}var jt;return hV(dV(Ke.length(),Vt,Dt,It,0,!0))}(ce,M,x,a,f,X),{processBidirectionalText:Ee,processStyledBidirectionalText:Oe}=el;if(Ee&&ce.sections.length===1){const Ke=Ee(ce.toString(),be);for(const Qe of Ke){const nt=new Y_;nt.text=Qe,nt.sections=ce.sections;for(let Et=0;Et<Qe.length;Et++)nt.sectionIndex.push(0);he.push(nt)}}else if(Oe){const Ke=Oe(ce.text,ce.sectionIndex,be);for(const Qe of Ke){const nt=new Y_;nt.text=Qe[0],nt.sectionIndex=Qe[1],nt.sections=ce.sections,he.push(nt)}}else he=function(Ke,Qe){const nt=[],Et=Ke.text;let ft=0;for(const Tt of Qe)nt.push(Ke.substring(ft,Tt)),ft=Tt;return ft<Et.length&&nt.push(Ke.substring(ft,Et.length)),nt}(ce,be);const Ue=[],Fe={positionedLines:Ue,text:ce.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:V,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Ke,Qe,nt,Et,ft,Tt,It,Dt,Xt,Vt,jt,$t){let xt=0,vt=0,zt=0;const Ht=Dt==="right"?1:Dt==="left"?0:.5;let Nt=!1;for(const sr of ft){const Or=sr.getSections();for(const Qr of Or){if(Qr.image)continue;const vn=Qe[Qr.fontStack];if(vn&&(Nt=vn.ascender!==void 0&&vn.descender!==void 0,!Nt))break}if(!Nt)break}let pr=0;for(const sr of ft){sr.trim();const Or=sr.getMaxScale(),Qr=(Or-1)*To,vn={positionedGlyphs:[],lineOffset:0};Ke.positionedLines[pr]=vn;const Bn=vn.positionedGlyphs;let nn=0;if(!sr.length()){vt+=Tt,++pr;continue}let Hn=0,Kn=0;for(let ze=0;ze<sr.length();ze++){const Ne=sr.getSection(ze),Pt=sr.getSectionIndex(ze),nr=sr.getCodePoint(ze);let Ct=Ne.scale,or=null,Ar=null,Er=null,an=To,Fr=0,wr=Xt;wr===kl.vertical&&((_r=nr)===12312||_r===12313||_r===12316||_r===12540||_r===12448)&&(wr=kl.horizontal);const Wn=!(wr===kl.horizontal||!jt&&!E_(nr)||jt&&(kA[nr]||Dw(nr)));if(Ne.image){const vi=Et.get(Ne.image.toString());if(!vi)continue;Er=Ne.image,Ke.iconsInText=Ke.iconsInText||!0,Ar=vi.paddedRect;const Ur=vi.displaySize;Ct=Ct*To/$t,or={width:Ur[0],height:Ur[1],left:0,top:-lV,advance:Wn?Ur[1]:Ur[0],localGlyph:!1},Fr=Nt?-or.height*Ct:Or*To-17-Ur[1]*Ct,an=or.advance;const Fn=(Wn?Ur[0]:Ur[1])*Ct-To*Or;Fn>0&&Fn>nn&&(nn=Fn)}else{const vi=nt[Ne.fontStack];if(!vi)continue;vi[nr]&&(Ar=vi[nr]);const Ur=Qe[Ne.fontStack];if(!Ur)continue;const Fn=Ur.glyphs[nr];if(!Fn)continue;if(or=Fn.metrics,an=nr!==8203?To:0,Nt){const _i=Ur.ascender!==void 0?Math.abs(Ur.ascender):0,ii=Ur.descender!==void 0?Math.abs(Ur.descender):0,la=(_i+ii)*Ct;Hn<la&&(Hn=la,Kn=(_i-ii)/2*Ct),Fr=-_i*Ct}else Fr=(Or-Ct)*To-17}Wn?(Ke.verticalizable=!0,Bn.push({glyph:nr,image:Er,x:xt,y:vt+Fr,vertical:Wn,scale:Ct,localGlyph:or.localGlyph,fontStack:Ne.fontStack,sectionIndex:Pt,metrics:or,rect:Ar}),xt+=an*Ct+Vt):(Bn.push({glyph:nr,image:Er,x:xt,y:vt+Fr,vertical:Wn,scale:Ct,localGlyph:or.localGlyph,fontStack:Ne.fontStack,sectionIndex:Pt,metrics:or,rect:Ar}),xt+=or.advance*Ct+Vt)}Bn.length!==0&&(zt=Math.max(xt-Vt,zt),Nt?fV(Bn,Ht,nn,Kn,Tt*Or/2):fV(Bn,Ht,nn,0,Tt/2)),xt=0;const Yi=Tt*Or+nn;vn.lineOffset=Math.max(nn,Qr),vt+=Yi,++pr}var _r;const ur=vt,{horizontalAlign:ar,verticalAlign:Xr}=yN(It);(function(sr,Or,Qr,vn,Bn,nn){const Hn=(Or-Qr)*Bn,Kn=-nn*vn;for(const Yi of sr)for(const ze of Yi.positionedGlyphs)ze.x+=Hn,ze.y+=Kn})(Ke.positionedLines,Ht,ar,Xr,zt,ur),Ke.top+=-Xr*ur,Ke.bottom=Ke.top+ur,Ke.left+=-ar*zt,Ke.right=Ke.left+zt,Ke.hasBaseline=Nt}(Fe,a,c,f,he,b,A,k,V,M,q,Y),!function(Ke){for(const Qe of Ke)if(Qe.positionedGlyphs.length!==0)return!1;return!0}(Ue))return Fe}const kA={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},nhe={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function cV(u,a,c,f,p,x){if(a.image){const b=f.get(a.image.toString());return b?b.displaySize[0]*a.scale*To/x+p:0}{const b=c[a.fontStack],A=b&&b.glyphs[u];return A?A.metrics.advance*a.scale+p:0}}function uV(u,a,c,f){const p=Math.pow(u-a,2);return f?u<a?p/2:2*p:p+Math.abs(c)*c}function ihe(u,a,c){let f=0;return u===10&&(f-=1e4),c&&(f+=150),u!==40&&u!==65288||(f+=50),a!==41&&a!==65289||(f+=50),f}function dV(u,a,c,f,p,x){let b=null,A=uV(a,c,p,x);for(const k of f){const M=uV(a-k.x,c,p,x)+k.badness;M<=A&&(b=k,A=M)}return{index:u,x:a,priorBreak:b,badness:A}}function hV(u){return u?hV(u.priorBreak).concat(u.index):[]}function yN(u){let a=.5,c=.5;switch(u){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:a,verticalAlign:c}}function fV(u,a,c,f,p){if(!(a||c||f||p))return;const x=u.length-1,b=u[x],A=(b.x+b.metrics.advance*b.scale)*a;for(let k=0;k<=x;k++)u[k].x-=A,u[k].y+=c+f+p}function pV(u){return u.imagePrimary!==void 0&&u.top!==void 0&&u.bottom!==void 0&&u.left!==void 0&&u.right!==void 0}function IA(u,a,c,f){const{horizontalAlign:p,verticalAlign:x}=yN(f),b=c[0]-u.displaySize[0]*p,A=c[1]-u.displaySize[1]*x;return{imagePrimary:u,imageSecondary:a,top:A,bottom:A+u.displaySize[1],left:b,right:b+u.displaySize[0]}}function vN(u,a,c,f,p,x){const b=u.imagePrimary;let A;if(b.content){const ce=b.content,he=b.pixelRatio||1;A=[ce[0]/he,ce[1]/he,b.displaySize[0]-ce[2]/he,b.displaySize[1]-ce[3]/he]}const k=a.left*x,M=a.right*x;let $,V,q,X;c==="width"||c==="both"?(X=p[0]+k-f[3],V=p[0]+M+f[1]):(X=p[0]+(k+M-b.displaySize[0])/2,V=X+b.displaySize[0]);const Y=a.top*x,se=a.bottom*x;return c==="height"||c==="both"?($=p[1]+Y-f[0],q=p[1]+se+f[2]):($=p[1]+(Y+se-b.displaySize[1])/2,q=$+b.displaySize[1]),{imagePrimary:b,imageSecondary:void 0,top:$,right:V,bottom:q,left:X,collisionPadding:A}}function mV(u){return!u.imagePrimary.stretchX}function gV(u){return!u.imagePrimary.stretchY}function yV(u){return{width:u.right-u.left,height:u.bottom-u.top}}const Qu=128;function J_(u,a,c){const{expression:f}=a;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new Ri(u+1,{worldview:c}))};if(f.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:x}=f;let b=0;for(;b<p.length&&p[b]<=u;)b++;b=Math.max(0,b-1);let A=b;for(;A<p.length&&p[A]<u+1;)A++;A=Math.min(p.length-1,A);const k=p[b],M=p[A];return f.kind==="composite"?{kind:"composite",minZoom:k,maxZoom:M,interpolationType:x}:{kind:"camera",minZoom:k,maxZoom:M,minSize:f.evaluate(new Ri(k,{worldview:c})),maxSize:f.evaluate(new Ri(M,{worldview:c})),interpolationType:x}}}function _N(u,{uSize:a,uSizeT:c},{lowerSize:f,upperSize:p}){return u.kind==="source"?f/Qu:u.kind==="composite"?qr(f/Qu,p/Qu,c):a}function Q_(u,a,c=1){let f=0,p=0;if(u.kind==="constant")p=u.layoutSize*c;else if(u.kind!=="source"){const{interpolationType:x,minZoom:b,maxZoom:A}=u,k=x?ve(bl.interpolationFactor(x,a,b,A),0,1):0;u.kind==="camera"?p=qr(u.minSize,u.maxSize,k)*c:f=k*c}return{uSizeT:f,uSize:p}}class of extends Mt{constructor(a,c,f,p,x){super(a,c),this.angle=p,this.z=f,x!==void 0&&(this.segment=x)}clone(){return new of(this.x,this.y,this.z,this.angle,this.segment)}}function vV(u,a,c,f,p){if(a.segment===void 0)return!0;let x=a,b=a.segment+1,A=0;for(;A>-c/2;){if(b--,b<0)return!1;A-=u[b].dist(x),x=u[b]}A+=u[b].dist(u[b+1]),b++;const k=[];let M=0;for(;A<c/2;){const $=u[b],V=u[b+1];if(!V)return!1;let q=u[b-1].angleTo($)-$.angleTo(V);for(q=Math.abs((q+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:A,angleDelta:q}),M+=q;A-k[0].distance>f;)M-=k.shift().angleDelta;if(M>p)return!1;b++,A+=$.dist(V)}return!0}function _V(u){let a=0;for(let c=0;c<u.length-1;c++)a+=u[c].dist(u[c+1]);return a}function xV(u,a,c){return u?.6*a*c:0}function bV(u,a){return Math.max(u?u.right-u.left:0,a?a.right-a.left:0)}function ahe(u,a,c,f,p,x){const b=xV(c,p,x),A=bV(c,f)*x;let k=0;const M=_V(u)/2;for(let $=0;$<u.length-1;$++){const V=u[$],q=u[$+1],X=V.dist(q);if(k+X>M){const Y=(M-k)/X,se=qr(V.x,q.x,Y),ce=qr(V.y,q.y,Y),he=new of(se,ce,0,q.angleTo(V),$);return!b||vV(u,he,A,b,a)?he:void 0}k+=X}}function ohe(u,a,c,f,p,x,b,A,k){const M=xV(f,x,b),$=bV(f,p),V=$*b,q=u[0].x===0||u[0].x===k||u[0].y===0||u[0].y===k;return a-V<a/4&&(a=V+a/4),wV(u,q?a/2*A%a:($/2+2*x)*b*A%a,a,M,c,V,q,!1,k)}function wV(u,a,c,f,p,x,b,A,k){const M=x/2,$=_V(u);let V=0,q=a-c,X=[];for(let Y=0;Y<u.length-1;Y++){const se=u[Y],ce=u[Y+1],he=se.dist(ce),be=ce.angleTo(se);for(;q+c<V+he;){q+=c;const Ee=(q-V)/he,Oe=qr(se.x,ce.x,Ee),Ue=qr(se.y,ce.y,Ee);if(Oe>=0&&Oe<k&&Ue>=0&&Ue<k&&q-M>=0&&q+M<=$){const Fe=new of(Oe,Ue,0,be,Y);f&&!vV(u,Fe,x,f,p)||X.push(Fe)}}V+=he}return A||X.length||b||(X=wV(u,V/2,c,f,p,x,b,!0,k)),X}function SV(u){let a=0,c=0;for(const b of u)a+=b.w*b.h,c=Math.max(c,b.w);u.sort((b,A)=>A.h-b.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),c),h:1/0}];let p=0,x=0;for(const b of u)for(let A=f.length-1;A>=0;A--){const k=f[A];if(!(b.w>k.w||b.h>k.h)){if(b.x=k.x,b.y=k.y,x=Math.max(x,b.y+b.h),p=Math.max(p,b.x+b.w),b.w===k.w&&b.h===k.h){const M=f.pop();M&&A<f.length&&(f[A]=M)}else b.h===k.h?(k.x+=b.w,k.w-=b.w):b.w===k.w?(k.y+=b.h,k.h-=b.h):(f.push({x:k.x+b.w,y:k.y,w:k.w-b.w,h:b.h}),k.y+=b.h,k.h-=b.h);break}}return{w:p,h:x,fill:a/(p*x)||0}}gr(of,"Anchor");const cy=1;class R1{static getImagePositionScale(a,c,f){if(c&&a&&a.options&&a.options.transform){const p=a.options.transform;return{x:p.a,y:p.d}}return{x:f,y:f}}constructor(a,c,f,p){this.paddedRect=a;const{pixelRatio:x,version:b,stretchX:A,stretchY:k,content:M,sdf:$,usvg:V}=c;this.pixelRatio=x,this.stretchX=A,this.stretchY=k,this.content=M,this.version=b,this.padding=f,this.sdf=$,this.usvg=V,this.scale=R1.getImagePositionScale(p,V,x)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function xN(u,a,c){const f=Uu.parse(u),p=function(x,b,A=[1,1]){return{x:0,y:0,w:(x.data?x.data.width:x.width*A[0])+2*b,h:(x.data?x.data.height:x.height*A[1])+2*b}}(a,c,[f.options.transform.a,f.options.transform.d]);return{bin:p,imagePosition:new R1(p,a,c,f),imageVariant:f}}class EV{constructor(a,c,f){const p=new Map,x=new Map;this.haveRenderCallbacks=[];const b=[];this.addImages(a,p,cy,b),this.addImages(c,x,2,b);const{w:A,h:k}=SV(b),M=new Go({width:A||1,height:k||1});for(const[$,V]of a.entries()){const q=p.get($).paddedRect;Go.copy(V.data,M,{x:0,y:0},{x:q.x+cy,y:q.y+cy},V.data,null,V.sdf)}for(const[$,V]of c.entries()){const q=x.get($),X=q.paddedRect;let Y=q.padding;const se=X.x+Y,ce=X.y+Y,he=V.data.width,be=V.data.height;Y=Y>1?Y-1:Y,Go.copy(V.data,M,{x:0,y:0},{x:se,y:ce},V.data,f),Go.copy(V.data,M,{x:0,y:be-Y},{x:se,y:ce-Y},{width:he,height:Y},f),Go.copy(V.data,M,{x:0,y:0},{x:se,y:ce+be},{width:he,height:Y},f),Go.copy(V.data,M,{x:he-Y,y:0},{x:se-Y,y:ce},{width:Y,height:be},f),Go.copy(V.data,M,{x:0,y:0},{x:se+he,y:ce},{width:Y,height:be},f),Go.copy(V.data,M,{x:he-Y,y:be-Y},{x:se-Y,y:ce-Y},{width:Y,height:Y},f),Go.copy(V.data,M,{x:0,y:be-Y},{x:se+he,y:ce-Y},{width:Y,height:Y},f),Go.copy(V.data,M,{x:0,y:0},{x:se+he,y:ce+be},{width:Y,height:Y},f),Go.copy(V.data,M,{x:he-Y,y:0},{x:se-Y,y:ce+be},{width:Y,height:Y},f)}this.lut=f,this.image=M,this.iconPositions=p,this.patternPositions=x}addImages(a,c,f,p){for(const[x,b]of a.entries()){const{bin:A,imagePosition:k,imageVariant:M}=xN(x,b,f);c.set(x,k),p.push(A),b.hasRenderCallback&&this.haveRenderCallbacks.push(M.id)}}patchUpdatedImages(a,c,f){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(p=>a.hasImage(p,f)),a.dispatchRenderCallbacks(this.haveRenderCallbacks,f);for(const p of a.getUpdatedImages(f)){for(const x of this.iconPositions.keys()){const b=Uu.parse(x);if(eo.isEqual(b.id,p)){const A=a.getImage(p,f);this.patchUpdatedImage(this.iconPositions.get(x),A,c,null)}}for(const x of this.patternPositions.keys()){const b=Uu.parse(x);if(eo.isEqual(b.id,p)){const A=a.getImage(p,f);this.patchUpdatedImage(this.patternPositions.get(x),A,c,this.lut)}}}}patchUpdatedImage(a,c,f,p=null){if(!a||!c||a.version===c.version)return;a.version=c.version;const[x,b]=a.tl,A=a.sdf;if(this.lut||A){const k={width:c.data.width,height:c.data.height},M=new Go(k);Go.copy(c.data,M,{x:0,y:0},{x:0,y:0},k,p,A),f.update(M,{position:{x,y:b}})}else f.update(c.data,{position:{x,y:b}})}}gr(R1,"ImagePosition"),gr(EV,"ImageAtlas");const j1=1e20;function TV(u,a,c,f,p,x,b,A,k){for(let M=a;M<a+f;M++)AV(u,c*x+M,x,p,b,A,k);for(let M=c;M<c+p;M++)AV(u,M*x+a,1,f,b,A,k)}function AV(u,a,c,f,p,x,b){x[0]=0,b[0]=-j1,b[1]=j1,p[0]=u[a];for(let A=1,k=0,M=0;A<f;A++){p[A]=u[a+A*c];const $=A*A;do{const V=x[k];M=(p[A]-p[V]+$-V*V)/(A-V)/2}while(M<=b[k]&&--k>-1);k++,x[k]=A,b[k]=M,b[k+1]=j1}for(let A=0,k=0;A<f;A++){for(;b[k+1]<A;)k++;const M=x[k],$=A-M;u[a+A*c]=p[M]+$*$}}const ed=2,bN={none:0,ideographs:1,all:2};class ex{constructor(a,c,f){this.requestManager=a,this.localGlyphMode=c,this.localFontFamily=f,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(a){this.url=a}getGlyphs(a,c){const f=[],p=this.url||Bi.GLYPHS_URL;for(const x in a)for(const b of a[x])f.push({stack:x,id:b});Ye(f,({stack:x,id:b},A)=>{let k=this.entries[x];k||(k=this.entries[x]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let M=k.glyphs[b];if(M!==void 0)return void A(null,{stack:x,id:b,glyph:M});if(M=this._tinySDF(k,x,b),M)return k.glyphs[b]=M,void A(null,{stack:x,id:b,glyph:M});const $=Math.floor(b/256);if(256*$>65535)return Ir("glyphs > 65535 not supported"),void A(null,{stack:x,id:b,glyph:M});if(k.ranges[$])return void A(null,{stack:x,id:b,glyph:M});let V=k.requests[$];V||(V=k.requests[$]=[],ex.loadGlyphRange(x,$,p,this.requestManager,(q,X)=>{if(X){k.ascender=X.ascender,k.descender=X.descender;for(const Y in X.glyphs)this._doesCharSupportLocalGlyph(+Y)||(k.glyphs[+Y]=X.glyphs[+Y]);k.ranges[$]=!0}for(const Y of V)Y(q,X);delete k.requests[$]})),V.push((q,X)=>{q?A(q):X&&A(null,{stack:x,id:b,glyph:X.glyphs[b]||null})})},(x,b)=>{if(x)c(x);else if(b){const A={};for(const{stack:k,id:M,glyph:$}of b)A[k]===void 0&&(A[k]={}),A[k].glyphs===void 0&&(A[k].glyphs={}),A[k].glyphs[M]=$&&{id:$.id,bitmap:$.bitmap.clone(),metrics:$.metrics},A[k].ascender=this.entries[k].ascender,A[k].descender=this.entries[k].descender;c(null,A)}})}_doesCharSupportLocalGlyph(a){return this.localGlyphMode!==bN.none&&(this.localGlyphMode===bN.all?!!this.localFontFamily:!!this.localFontFamily&&(Nr["CJK Unified Ideographs"](a)||Nr["Hangul Syllables"](a)||Nr.Hiragana(a)||Nr.Katakana(a)||Nr["CJK Symbols and Punctuation"](a)||Nr["CJK Unified Ideographs Extension A"](a)||Nr["CJK Unified Ideographs Extension B"](a)||Nr.Osage(a)))}_tinySDF(a,c,f){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(f))return;let x=a.tinySDF;if(!x){let se="400";/bold/i.test(c)?se="900":/medium/i.test(c)?se="500":/light/i.test(c)&&(se="200"),x=a.tinySDF=new ex.TinySDF({fontFamily:p,fontWeight:se,fontSize:24*ed,buffer:3*ed,radius:8*ed}),x.fontWeight=se}if(this.localGlyphs[x.fontWeight][f])return this.localGlyphs[x.fontWeight][f];const b=String.fromCodePoint(f),{data:A,width:k,height:M,glyphWidth:$,glyphHeight:V,glyphLeft:q,glyphTop:X,glyphAdvance:Y}=x.draw(b);return this.localGlyphs[x.fontWeight][f]={id:f,bitmap:new Np({width:k,height:M},A),metrics:{width:$/ed,height:V/ed,left:q/ed,top:X/ed-27,advance:Y/ed,localGlyph:!0}}}}ex.loadGlyphRange=function(u,a,c,f,p){const x=256*a,b=x+255,A=f.transformRequest(f.normalizeGlyphsURL(c).replace("{fontstack}",u).replace("{range}",`${x}-${b}`),zh.Glyphs);Xf(A,(k,M)=>{if(k)p(k);else if(M){const $={},V=function(q){return new OA(q).readFields(ehe,{})}(M);for(const q of V.glyphs)$[q.id]=q;p(null,{glyphs:$,ascender:V.ascender,descender:V.descender})}})},ex.TinySDF=class{constructor({fontSize:u=24,buffer:a=3,radius:c=8,cutoff:f=.25,fontFamily:p="sans-serif",fontWeight:x="normal",fontStyle:b="normal",lang:A=null}={}){this.buffer=a,this.cutoff=f,this.radius=c,this.lang=A;const k=this.size=u+4*a,M=this._createCanvas(k),$=this.ctx=M.getContext("2d",{willReadFrequently:!0});$.font=`${b} ${x} ${u}px ${p}`,$.textBaseline="alphabetic",$.textAlign="left",$.fillStyle="black",this.gridOuter=new Float64Array(k*k),this.gridInner=new Float64Array(k*k),this.f=new Float64Array(k),this.z=new Float64Array(k+1),this.v=new Uint16Array(k)}_createCanvas(u){const a=document.createElement("canvas");return a.width=a.height=u,a}draw(u){const{width:a,actualBoundingBoxAscent:c,actualBoundingBoxDescent:f,actualBoundingBoxLeft:p,actualBoundingBoxRight:x}=this.ctx.measureText(u),b=Math.ceil(c),A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-p))),k=Math.min(this.size-this.buffer,b+Math.ceil(f)),M=A+2*this.buffer,$=k+2*this.buffer,V=Math.max(M*$,0),q=new Uint8ClampedArray(V),X={data:q,width:M,height:$,glyphWidth:A,glyphHeight:k,glyphTop:b,glyphLeft:0,glyphAdvance:a};if(A===0||k===0)return X;const{ctx:Y,buffer:se,gridInner:ce,gridOuter:he}=this;this.lang&&(Y.lang=this.lang),Y.clearRect(se,se,A,k),Y.fillText(u,se,se+b);const be=Y.getImageData(se,se,A,k);he.fill(j1,0,V),ce.fill(0,0,V);for(let Ee=0;Ee<k;Ee++)for(let Oe=0;Oe<A;Oe++){const Ue=be.data[4*(Ee*A+Oe)+3]/255;if(Ue===0)continue;const Fe=(Ee+se)*M+Oe+se;if(Ue===1)he[Fe]=0,ce[Fe]=j1;else{const Ke=.5-Ue;he[Fe]=Ke>0?Ke*Ke:0,ce[Fe]=Ke<0?Ke*Ke:0}}TV(he,0,0,M,$,M,this.f,this.v,this.z),TV(ce,se,se,A,k,M,this.f,this.v,this.z);for(let Ee=0;Ee<V;Ee++){const Oe=Math.sqrt(he[Ee])-Math.sqrt(ce[Ee]);q[Ee]=Math.round(255-255*(Oe/this.radius+this.cutoff))}return X}};const Jd=cy;function PV(u,a){return u+a[1]-a[0]}function wN(u,a,c,f,p=1){const x=[],b=u.imagePrimary,A=b.pixelRatio,k=b.paddedRect.w-2*Jd,M=b.paddedRect.h-2*Jd,$=(u.right-u.left)*p,V=(u.bottom-u.top)*p,q=b.stretchX||[[0,k]],X=b.stretchY||[[0,M]],Y=q.reduce(PV,0),se=X.reduce(PV,0),ce=k-Y,he=M-se;let be=0,Ee=Y,Oe=0,Ue=se,Fe=0,Ke=ce,Qe=0,nt=he;if(b.content&&f){const ft=b.content;be=RA(q,0,ft[0]),Oe=RA(X,0,ft[1]),Ee=RA(q,ft[0],ft[2]),Ue=RA(X,ft[1],ft[3]),Fe=ft[0]-be,Qe=ft[1]-Oe,Ke=ft[2]-ft[0]-Ee,nt=ft[3]-ft[1]-Ue}const Et=(ft,Tt,It,Dt)=>{const Xt=jA(ft.stretch-be,Ee,$,u.left*p),Vt=NA(ft.fixed-Fe,Ke,ft.stretch,Y),jt=jA(Tt.stretch-Oe,Ue,V,u.top*p),$t=NA(Tt.fixed-Qe,nt,Tt.stretch,se),xt=jA(It.stretch-be,Ee,$,u.left*p),vt=NA(It.fixed-Fe,Ke,It.stretch,Y),zt=jA(Dt.stretch-Oe,Ue,V,u.top*p),Ht=NA(Dt.fixed-Qe,nt,Dt.stretch,se),Nt=new Mt(Xt,jt),pr=new Mt(xt,jt),_r=new Mt(xt,zt),ur=new Mt(Xt,zt),ar=new Mt(Vt/A,$t/A),Xr=new Mt(vt/A,Ht/A),sr=a*Math.PI/180;if(sr){const Hn=Math.sin(sr),Kn=Math.cos(sr),Yi=[Kn,-Hn,Hn,Kn];Nt._matMult(Yi),pr._matMult(Yi),ur._matMult(Yi),_r._matMult(Yi)}const Or=ft.stretch+ft.fixed,Qr=It.stretch+It.fixed,vn=Tt.stretch+Tt.fixed,Bn=Dt.stretch+Dt.fixed,nn=u.imageSecondary;return{tl:Nt,tr:pr,bl:ur,br:_r,texPrimary:{x:b.paddedRect.x+Jd+Or,y:b.paddedRect.y+Jd+vn,w:Qr-Or,h:Bn-vn},texSecondary:nn?{x:nn.paddedRect.x+Jd+Or,y:nn.paddedRect.y+Jd+vn,w:Qr-Or,h:Bn-vn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ar,pixelOffsetBR:Xr,minFontScaleX:Ke/A/$,minFontScaleY:nt/A/V,isSDF:c}};if(f&&(b.stretchX||b.stretchY)){const ft=CV(q,ce,Y),Tt=CV(X,he,se);for(let It=0;It<ft.length-1;It++){const Dt=ft[It],Xt=ft[It+1];for(let Vt=0;Vt<Tt.length-1;Vt++)x.push(Et(Dt,Tt[Vt],Xt,Tt[Vt+1]))}}else x.push(Et({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:k+1},{fixed:0,stretch:M+1}));return x}function she(u,a){const c=u.stretchY||[[0,u.paddedRect.h-2*Jd]];return a&&(u.stretchX||u.stretchY)?OV(u.stretchX||[[0,u.paddedRect.w-2*Jd]])*OV(c):1}function RA(u,a,c){let f=0;for(const p of u)f+=Math.max(a,Math.min(c,p[1]))-Math.max(a,Math.min(c,p[0]));return f}function CV(u,a,c){const f=[{fixed:-Jd,stretch:0}];for(const[p,x]of u){const b=f[f.length-1];f.push({fixed:p-b.stretch,stretch:b.stretch}),f.push({fixed:p-b.stretch,stretch:b.stretch+(x-p)})}return f.push({fixed:a+Jd,stretch:c}),f}function OV(u){return 2*u.length+1}function jA(u,a,c,f){return u/a*c+f}function NA(u,a,c,f){return u-a*c/f}function lhe(u,a,c,f){const p=a+u.positionedLines[f].lineOffset;return f===0?c+p/2:c+(p+(a+u.positionedLines[f-1].lineOffset))/2}function che(u,a=1,c=!1){let f=1/0,p=1/0,x=-1/0,b=-1/0;const A=u[0];for(let X=0;X<A.length;X++){const Y=A[X];(!X||Y.x<f)&&(f=Y.x),(!X||Y.y<p)&&(p=Y.y),(!X||Y.x>x)&&(x=Y.x),(!X||Y.y>b)&&(b=Y.y)}const k=Math.min(x-f,b-p);let M=k/2;const $=new Xv([],uhe);if(k===0)return new Mt(f,p);for(let X=f;X<x;X+=k)for(let Y=p;Y<b;Y+=k)$.push(new tx(X+M,Y+M,M,u));let V=function(X){let Y=0,se=0,ce=0;const he=X[0];for(let be=0,Ee=he.length,Oe=Ee-1;be<Ee;Oe=be++){const Ue=he[be],Fe=he[Oe],Ke=Ue.x*Fe.y-Fe.x*Ue.y;se+=(Ue.x+Fe.x)*Ke,ce+=(Ue.y+Fe.y)*Ke,Y+=3*Ke}return new tx(se/Y,ce/Y,0,X)}(u),q=$.length;for(;$.length;){const X=$.pop();(X.d>V.d||!V.d)&&(V=X,c&&console.log("found best %d after %d probes",Math.round(1e4*X.d)/1e4,q)),X.max-V.d<=a||(M=X.h/2,$.push(new tx(X.p.x-M,X.p.y-M,M,u)),$.push(new tx(X.p.x+M,X.p.y-M,M,u)),$.push(new tx(X.p.x-M,X.p.y+M,M,u)),$.push(new tx(X.p.x+M,X.p.y+M,M,u)),q+=4)}return c&&(console.log(`num probes: ${q}`),console.log(`best distance: ${V.d}`)),V.p}function uhe(u,a){return a.max-u.max}class tx{constructor(a,c,f,p){this.p=new Mt(a,c),this.h=f,this.d=function(x,b){let A=!1,k=1/0;for(let M=0;M<b.length;M++){const $=b[M];for(let V=0,q=$.length,X=q-1;V<q;X=V++){const Y=$[V],se=$[X];Y.y>x.y!=se.y>x.y&&x.x<(se.x-Y.x)*(x.y-Y.y)/(se.y-Y.y)+Y.x&&(A=!A),k=Math.min(k,Tl(x,Y,se))}}return(A?1:-1)*Math.sqrt(k)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const dhe=Object.keys,SN=Number.POSITIVE_INFINITY,hhe=Math.sqrt(2);function MA(u,a,c,f){const p=u.collisionPadding||[0,0,0,0],x={top:u.top-p[1],bottom:u.bottom+p[3],left:u.left-p[0],right:u.right+p[2],scaled:!1};return f!==void 0&&function(b,A){b.top*=A,b.bottom*=A,b.left*=A,b.right*=A,b.scaled=!0}(x,f),c&&function(b,A){if(!A)return;const k=bn(A),M=new Mt(b.left,b.top),$=new Mt(b.right,b.top),V=new Mt(b.left,b.bottom),q=new Mt(b.right,b.bottom);M._rotateAround(k,new Mt(0,0)),$._rotateAround(k,new Mt(0,0)),V._rotateAround(k,new Mt(0,0)),q._rotateAround(k,new Mt(0,0)),b.left=Math.min(M.x,$.x,V.x,q.x),b.right=Math.max(M.x,$.x,V.x,q.x),b.top=Math.min(M.y,$.y,V.y,q.y),b.bottom=Math.max(M.y,$.y,V.y,q.y)}(x,c),a?{top:Math.min(a.top,x.top),bottom:Math.max(a.bottom,x.bottom),left:Math.min(a.left,x.left),right:Math.max(a.right,x.right),scaled:a.scaled||x.scaled}:x}function kV(u,[a,c]){let f=0,p=0;if(c===SN){a<0&&(a=0);const x=a/hhe;switch(u){case"top-right":case"top-left":p=x-7;break;case"bottom-right":case"bottom-left":p=7-x;break;case"bottom":p=7-a;break;case"top":p=a-7}switch(u){case"top-right":case"bottom-right":f=-x;break;case"top-left":case"bottom-left":f=x;break;case"left":f=a;break;case"right":f=-a}}else{switch(a=Math.abs(a),c=Math.abs(c),u){case"top-right":case"top-left":case"top":p=c-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-c}switch(u){case"top-right":case"bottom-right":case"right":f=-a;break;case"top-left":case"bottom-left":case"left":f=a}}return[f,p]}function fhe(u,a,c,f,p,x,b,A,k,M,$){const V=u.layers[0],q=V.appearances;if(q.length===0)return{iconBBox:null,iconVerticalBBox:null};let X=null,Y=null;const se=f.get("icon-rotate").evaluate(p,{},x);a&&(X=MA(a,X,se,b),c)&&(Y=MA(c,Y,se+90,b));const[ce,he]=f.get("icon-size-scale-range"),be=ve(1,ce,he);for(const Ee of q){const Oe=Ee.getUnevaluatedProperties(),Ue=Oe._values["icon-image"].value!==void 0,Fe=Oe._values["icon-size"].value!==void 0,Ke=Oe._values["icon-offset"].value!==void 0,Qe=Oe._values["icon-rotate"].value!==void 0;if(Ue||Fe||Ke||Qe){const nt=Ke?V.getAppearanceValueAndResolveTokens(Ee,"icon-offset",p,x,[]):null,Et=nt&&Array.isArray(nt)?nt:A,ft=Qe?V.getAppearanceValueAndResolveTokens(Ee,"icon-rotate",p,x,[]):null,Tt=typeof ft=="number"?ft:se,It=Fe?V.getAppearanceValueAndResolveTokens(Ee,"icon-size",p,x,[]):null,Dt=typeof It=="number"?It*k.iconScaleFactor:b;let Xt=null,Vt=null,jt=null;if(Ue){const $t=V.getAppearanceValueAndResolveTokens(Ee,"icon-image",p,x,[]);if($t){const xt=u.getResolvedImageFromTokens($t),vt=Oe._values["icon-size"],zt=N1(xt,J_(u.zoom,vt,u.worldview),vt,x,u.zoom,p,u.pixelRatio,be,u.worldview);jt=M.get(zt.iconPrimary.toString())}}else a&&(jt=a.imagePrimary);jt&&(Xt=IA(jt,null,Et,$),u.allowVerticalPlacement&&(Vt=IA(jt,null,Et,$))),Xt&&(X=MA(Xt,X,Tt,Dt)),Vt&&(Y=MA(Vt,Y,Tt+90,Dt))}}return{iconBBox:X,iconVerticalBBox:Y}}function DA(u,a,c,f,p,x,b,A,k){if(!a||!a.usvg)return;const M=yV(f),$=yV(p),V=x!=="both"&&x!=="width"||!mV(f)?1:$.width/M.width,q=x!=="both"&&x!=="height"||!gV(f)?1:$.height/M.height;c.scaleSelf(V,q);const X=c.toString();b.set(X,c),A.set(X,a);const{imagePosition:Y}=xN(X,a,cy);k.set(X,Y)}function IV(u,a,c,f,p,x,b,A,k){if(!u)return;const M=function($,V,q,X,Y,se){if($.kind==="camera")return $.maxSize;if($.kind==="composite"){const ce=V.possiblyEvaluate(new Ri($.maxZoom,{worldview:se}),q).evaluate(Y,{},q),he=V.possiblyEvaluate(new Ri($.minZoom,{worldview:se}),q).evaluate(Y,{},q);return Math.max(ce,he)}return V.possiblyEvaluate(new Ri(X,{worldview:se})).evaluate(Y,{},q)}(a,c,f,p,x,k);return u.scaleSelf(M*A*b)}function N1(u,a,c,f,p,x,b,A,k){return{iconPrimary:IV(u.getPrimary(),a,c,f,p,x,b,A,k),iconSecondary:IV(u.getSecondary(),a,c,f,p,x,b,A,k)}}function phe(u,a,c){if(!a)return;const f=c.get(u.toString()),p=c.get(a.toString());f&&p&&(f.paddedRect.w===p.paddedRect.w&&f.paddedRect.h===p.paddedRect.h||Ir(`Mismatch in icon variant sizes: ${u.toString()} and ${a.toString()}`),f.usvg!==p.usvg&&Ir(`Mismatch in icon variant image types: ${u.id} and ${a.id}`))}function RV(u,a,c,f){if(!u)return;const p=a.get(c.toString());if(u.imagePrimary=p,f){const x=a.get(f.toString());u.imageSecondary=x}}function mhe(u,a){for(const c in u.horizontal)jV(u.horizontal[c],a);jV(u.vertical,a)}function jV(u,a){if(u){for(const c of u.positionedLines)for(const f of c.positionedGlyphs)if(f.image!==null){const p=f.image.toString();f.rect=a.get(p).paddedRect}}}function EN(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ghe(u,a,c,f,p,x,b,A,k){const M=TN(x.horizontal)||x.vertical,$=c.get("icon-text-fit-padding").evaluate(f,{},p);let V,q=a;return a&&k!=="none"&&(u.allowVerticalPlacement&&x.vertical&&(V=vN(a,x.vertical,k,$,A,b)),M&&(q=vN(a,M,k,$,A,b))),{defaultShapedIcon:q,verticallyShapedIcon:V}}function yhe(u,a,c,f,p,x,b,A,k,M,$,V,q,X,Y,se,ce,he,be,Ee,Oe,Ue){let Fe=b.textMaxSize.evaluate(a,{},q);Fe===void 0?Fe=A*b.textScaleFactor:Fe*=b.textScaleFactor;const Ke=u.layers[0].layout,Qe=To,nt=A*b.textScaleFactor/Qe,Et=TN(c.horizontal)||c.vertical;if(ce!=="none"&&u.appearanceFeatureData&&a.index<u.appearanceFeatureData.length){const Nt=u.appearanceFeatureData[a.index];Nt&&(Nt.textShaping=Et,Nt.iconTextFitPadding=Ke.get("icon-text-fit-padding").evaluate(a,{},q),Nt.fontScale=nt)}const ft=X.name==="globe",Tt=u.tilePixelRatio*Fe/Qe,It=(xt=u.overscaling,u.zoom>18&&xt>2&&(xt>>=1),Math.max(Jt/(512*xt),1)*Ke.get("symbol-spacing")),Dt=Ke.get("text-padding")*u.tilePixelRatio,Xt=Ke.get("icon-padding")*u.tilePixelRatio,Vt=bn(Ke.get("text-max-angle")),jt=Ke.get("icon-rotation-alignment")==="map"&&Ee!=="point",$t=It/2;var xt;u.hasAnyIconTextFit===!1&&ce!=="none"&&(u.hasAnyIconTextFit=!0);const vt=a.properties?+a.properties[cr]:null,zt=vt&&u.elevationFeatureIdToIndex?u.elevationFeatureIdToIndex.get(vt):65535,Ht=(Nt,pr,_r)=>{if(pr.x<0||pr.x>=Jt||pr.y<0||pr.y>=Jt)return;let ur=null;if(ft){const{x:ar,y:Xr,z:sr}=X.projectTilePoint(pr.x,pr.y,_r);ur={anchor:new of(ar,Xr,sr,0,void 0),up:X.upVector(_r,pr.x,pr.y)}}(function(ar,Xr,sr,Or,Qr,vn,Bn,nn,Hn,Kn,Yi,ze,Ne,Pt,nr,Ct,or,Ar,Er,an,Fr,wr,Wn,vi,Ur,Fn,_i,ii,la,Ui,Ci){const ui=ar.addToLineVertexArray(Xr,Or);let Zn,on,Xn,Oi,zr,$n,Vi,ma=0,Pa=0,Wa=0,qi=0,Ba=-1,tl=-1;const $a={};let Il=Eg("");const Ho=sr?sr.anchor:Xr,jc=ii!=="none";let rl=0,Rl=0;if(Hn._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Ao=Hn.layout.get("text-offset").evaluate(Fr,{},Ur);rl=Ao[0]*To,Rl=Ao[1]*To}else rl=Hn.layout.get("text-radial-offset").evaluate(Fr,{},Ur)*To,Rl=SN;if(ar.allowVerticalPlacement&&Qr.vertical){const Ao=Qr.vertical;if(nr)$n=AN(Ao),nn&&(Vi=AN(nn));else{const As=Hn.layout.get("text-rotate").evaluate(Fr,{},Ur)+90;Xn=LA(Kn,Ho,Xr,Yi,ze,Ne,Ao,Pt,As,Ct),nn&&(Oi=LA(Kn,Ho,Xr,Yi,ze,Ne,nn,Ar,As,null,Ci))}}if(vn){const Ao=ar.iconSizeData,As=Hn.layout.get("icon-rotate").evaluate(Fr,{},Ur),Qd=wN(vn,As,Wn,jc,wr.iconScaleFactor),zp=nn?wN(nn,As,Wn,jc,wr.iconScaleFactor):void 0;on=LA(Kn,Ho,Xr,Yi,ze,Ne,vn,Ar,As,null,Ui);const lx=function(eh,eP,cx,kfe,J6,Q6,Ife,Rfe){const e8=eh.layers[0],t8=e8.appearances;let ux=eP.length;if(cx&&(ux=Math.max(ux,cx.length)),t8.length===0)return ux;const[jfe,Nfe]=kfe.get("icon-size-scale-range"),Mfe=ve(1,jfe,Nfe);for(const r8 of t8){const n8=r8.getUnevaluatedProperties();if(n8._values["icon-image"].value!==void 0){const i8=e8.getAppearanceValueAndResolveTokens(r8,"icon-image",J6,Q6,[]);if(i8){const a8=eh.getResolvedImageFromTokens(i8);if(a8){const o8=n8._values["icon-size"],Dfe=N1(a8,J_(eh.zoom,o8,eh.worldview),o8,Q6,eh.zoom,J6,eh.pixelRatio,Mfe,eh.worldview),Lfe=Ife.get(Dfe.iconPrimary.toString());ux=Math.max(ux,she(Lfe,Rfe))}}}}return ux}(ar,Qd,zp,Hn.layout,Fr,Ur,ar.iconAtlasPositions,jc);ma=4*lx;let Bp=null;Ao.kind==="source"?(Bp=[Qu*Hn.layout.get("icon-size").evaluate(Fr,{},Ur)*wr.iconScaleFactor],Bp[0]>sf&&Ir(`${ar.layerIds[0]}: Value for "icon-size" is >= ${M1}. Reduce your "icon-size".`)):Ao.kind==="composite"&&(Bp=[Qu*wr.compositeIconSizes[0].evaluate(Fr,{},Ur)*wr.iconScaleFactor,Qu*wr.compositeIconSizes[1].evaluate(Fr,{},Ur)*wr.iconScaleFactor],(Bp[0]>sf||Bp[1]>sf)&&Ir(`${ar.layerIds[0]}: Value for "icon-size" is >= ${M1}. Reduce your "icon-size".`)),ar.addSymbols(ar.icon,Qd,Bp,an,Er,Fr,void 0,sr,Xr,ui.lineStartIndex,ui.lineLength,-1,vi,Ur,Fn,_i,ar.symbolInstances.length,lx),Ba=ar.icon.placedSymbolArray.length-1,zp&&(Pa=4*lx,ar.addSymbols(ar.icon,zp,Bp,an,Er,Fr,kl.vertical,sr,Xr,ui.lineStartIndex,ui.lineLength,-1,vi,Ur,Fn,_i,ar.symbolInstances.length,lx),tl=ar.icon.placedSymbolArray.length-1)}for(const Ao in Qr.horizontal){const As=Ao,Qd=Qr.horizontal[As];Zn||(Il=Eg(Qd.text),nr?zr=AN(Qd):Zn=LA(Kn,Ho,Xr,Yi,ze,Ne,Qd,Pt,Hn.layout.get("text-rotate").evaluate(Fr,{},Ur),Ct));const zp=Qd.positionedLines.length===1;if(Wa+=NV(ar,sr,Xr,Qd,Bn,Hn,nr,Fr,Ct,ui,Qr.vertical?kl.horizontal:kl.horizontalOnly,zp?dhe(Qr.horizontal):[As],$a,Ba,wr,vi,Ur,ar.symbolInstances.length,Fn),zp)break}Qr.vertical&&(qi+=NV(ar,sr,Xr,Qr.vertical,Bn,Hn,nr,Fr,Ct,ui,kl.vertical,["vertical"],$a,tl,wr,vi,Ur,ar.symbolInstances.length,Fn));let Ko=-1;const jl=(Ao,As)=>Ao?Math.max(Ao,As):As;Ko=jl(zr,Ko),Ko=jl($n,Ko),Ko=jl(Vi,Ko);const Nc=Ko>-1?1:0;ar.glyphOffsetArray.length>=65535&&Ir("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Fr.sortKey!==void 0&&ar.addToSortKeyRanges(ar.symbolInstances.length,Fr.sortKey),ar.symbolInstances.emplaceBack(Xr.x,Xr.y,Ho.x,Ho.y,Ho.z,$a.right>=0?$a.right:-1,$a.center>=0?$a.center:-1,$a.left>=0?$a.left:-1,$a.vertical>=0?$a.vertical:-1,Ba,tl,Il,Zn!==void 0?Zn:ar.collisionBoxArray.length,Zn!==void 0?Zn+1:ar.collisionBoxArray.length,Xn!==void 0?Xn:ar.collisionBoxArray.length,Xn!==void 0?Xn+1:ar.collisionBoxArray.length,on!==void 0?on:ar.collisionBoxArray.length,on!==void 0?on+1:ar.collisionBoxArray.length,Oi||ar.collisionBoxArray.length,Oi?Oi+1:ar.collisionBoxArray.length,Yi,Wa,qi,ma,Pa,Nc,0,rl,Rl,Ko,0,jc?1:0,la)})(u,pr,ur,Nt,c,f,x,p,u.layers[0],u.collisionBoxArray,a.index,a.sourceLayerIndex,u.index,Dt,be,M,0,Xt,jt,he,a,b,$,V,q,Y,se,ce,zt,Oe,Ue)};if(Ee==="line")for(const Nt of vA(a.geometry,0,0,Jt,Jt)){const pr=ohe(Nt,It,Vt,c.vertical||Et,f,Qe,Tt,u.overscaling,Jt);for(const _r of pr)Et&&vhe(u,Et.text,$t,_r)||Ht(Nt,_r,q)}else if(Ee==="line-center"){for(const Nt of a.geometry)if(Nt.length>1){const pr=ahe(Nt,Vt,c.vertical||Et,f,Qe,Tt);pr&&Ht(Nt,pr,q)}}else if(a.type==="Polygon")for(const Nt of y1(a.geometry,0)){const pr=che(Nt,16);Ht(Nt[0],new of(pr.x,pr.y,0,0,void 0),q)}else if(a.type==="LineString")for(const Nt of a.geometry)Ht(Nt,new of(Nt[0].x,Nt[0].y,0,0,void 0),q);else if(a.type==="Point")for(const Nt of a.geometry)for(const pr of Nt)Ht([pr],new of(pr.x,pr.y,0,0,void 0),q)}const M1=255,sf=M1*Qu;function NV(u,a,c,f,p,x,b,A,k,M,$,V,q,X,Y,se,ce,he,be){const Ee=function(Fe,Ke,Qe,nt,Et,ft,Tt,It){const Dt=[];if(Ke.positionedLines.length===0)return Dt;const Xt=nt.layout.get("text-rotate").evaluate(ft,{})*Math.PI/180,Vt=function(zt){const Ht=zt[0],Nt=zt[1],pr=Ht*Nt;return pr>0?[Ht,-Nt]:pr<0?[-Ht,Nt]:Ht===0?[Nt,Ht]:[Nt,-Ht]}(Qe);let jt=Math.abs(Ke.top-Ke.bottom);for(const zt of Ke.positionedLines)jt-=zt.lineOffset;const $t=Ke.positionedLines.length,xt=jt/$t;let vt=Ke.top-Qe[1];for(let zt=0;zt<$t;++zt){const Ht=Ke.positionedLines[zt];vt=lhe(Ke,xt,vt,zt);for(const Nt of Ht.positionedGlyphs){if(!Nt.rect)continue;const pr=Nt.rect||{};let _r=lV+1,ur=!0,ar=1,Xr=0;if(Nt.image){const Er=Tt.get(Nt.image.toString());if(!Er)continue;if(Er.sdf){Ir("SDF images are not supported in formatted text and will be ignored.");continue}ur=!1,ar=Er.pixelRatio,_r=cy/ar}const sr=(Et||It)&&Nt.vertical,Or=Nt.metrics.advance*Nt.scale/2,Qr=Nt.metrics,vn=Nt.rect;if(vn===null)continue;It&&Ke.verticalizable&&(Xr=Nt.image?Or-Nt.metrics.width*Nt.scale/2:0);const Bn=Et?[Nt.x+Or,Nt.y]:[0,0];let nn=[0,0],Hn=[0,0],Kn=!1;Et||(sr?(Hn=[Nt.x+Or+Vt[0],Nt.y+Vt[1]-Xr],Kn=!0):nn=[Nt.x+Or+Qe[0],Nt.y+Qe[1]-Xr]);const Yi=vn.w*Nt.scale/(ar*(Nt.localGlyph?ed:1)),ze=vn.h*Nt.scale/(ar*(Nt.localGlyph?ed:1));let Ne,Pt,nr,Ct;if(sr){const Er=Nt.y-vt,an=new Mt(-Or,Or-Er),Fr=-Math.PI/2,wr=new Mt(...Hn);Ne=new Mt(-Or+nn[0],nn[1]),Ne._rotateAround(Fr,an)._add(wr),Ne.x+=-Er+Or,Ne.y-=(Qr.left-_r)*Nt.scale;const Wn=Nt.image?Qr.advance*Nt.scale:To*Nt.scale,vi=String.fromCodePoint(Nt.glyph);Vde(vi)?Ne.x+=(1-_r)*Nt.scale:qde(vi)?Ne.x+=Wn-Qr.height*Nt.scale+(-_r-1)*Nt.scale:Ne.x+=Nt.image||Qr.width+2*_r===vn.w&&Qr.height+2*_r===vn.h?(Wn-ze)/2:(Wn-(Qr.height+2*_r)*Nt.scale)/2,Pt=new Mt(Ne.x,Ne.y-Yi),nr=new Mt(Ne.x+ze,Ne.y),Ct=new Mt(Ne.x+ze,Ne.y-Yi)}else{const Er=(Qr.left-_r)*Nt.scale-Or+nn[0],an=(-Qr.top-_r)*Nt.scale+nn[1],Fr=Er+Yi,wr=an+ze;Ne=new Mt(Er,an),Pt=new Mt(Fr,an),nr=new Mt(Er,wr),Ct=new Mt(Fr,wr)}if(Xt){let Er;Er=Et?new Mt(0,0):Kn?new Mt(Vt[0],Vt[1]):new Mt(Qe[0],Qe[1]),Ne._rotateAround(Xt,Er),Pt._rotateAround(Xt,Er),nr._rotateAround(Xt,Er),Ct._rotateAround(Xt,Er)}const or=new Mt(0,0),Ar=new Mt(0,0);Dt.push({tl:Ne,tr:Pt,bl:nr,br:Ct,texPrimary:pr,texSecondary:void 0,writingMode:Ke.writingMode,glyphOffset:Bn,sectionIndex:Nt.sectionIndex,isSDF:ur,pixelOffsetTL:or,pixelOffsetBR:Ar,minFontScaleX:0,minFontScaleY:0})}}return Dt}(0,f,k,x,b,A,p,u.allowVerticalPlacement),Oe=u.textSizeData;let Ue=null;Oe.kind==="source"?(Ue=[Qu*x.layout.get("text-size").evaluate(A,{},ce)*Y.textScaleFactor],Ue[0]>sf&&Ir(`${u.layerIds[0]}: Value for "text-size" is >= ${M1}. Reduce your "text-size".`)):Oe.kind==="composite"&&(Ue=[Qu*Y.compositeTextSizes[0].evaluate(A,{},ce)*Y.textScaleFactor,Qu*Y.compositeTextSizes[1].evaluate(A,{},ce)*Y.textScaleFactor],(Ue[0]>sf||Ue[1]>sf)&&Ir(`${u.layerIds[0]}: Value for "text-size" is >= ${M1}. Reduce your "text-size".`)),u.addSymbols(u.text,Ee,Ue,k,b,A,$,a,c,M.lineStartIndex,M.lineLength,X,se,ce,be,!1,he,Ee.length);for(const Fe of V)q[Fe]=u.text.placedSymbolArray.length-1;return 4*Ee.length}function TN(u){for(const a in u)return u[a];return null}function LA(u,a,c,f,p,x,b,A,k,M,$){let V,q,X,Y;if(V=$?$.top:b.top,q=$?$.bottom:b.bottom,X=$?$.left:b.left,Y=$?$.right:b.right,pV(b)&&b.collisionPadding){const se=b.collisionPadding;X-=se[0],V-=se[1],Y+=se[2],q+=se[3]}if(k){const se=new Mt(X,V),ce=new Mt(Y,V),he=new Mt(X,q),be=new Mt(Y,q),Ee=bn(k);let Oe=new Mt(0,0);M&&(Oe=new Mt(M[0],M[1])),se._rotateAround(Ee,Oe),ce._rotateAround(Ee,Oe),he._rotateAround(Ee,Oe),be._rotateAround(Ee,Oe),X=Math.min(se.x,ce.x,he.x,be.x),Y=Math.max(se.x,ce.x,he.x,be.x),V=Math.min(se.y,ce.y,he.y,be.y),q=Math.max(se.y,ce.y,he.y,be.y)}return u.emplaceBack(a.x,a.y,a.z,c.x,c.y,X,V,Y,q,A,f,p,x),u.length-1}function AN(u){pV(u)&&u.collisionPadding&&(u.top-=u.collisionPadding[1],u.bottom+=u.collisionPadding[3]);const a=u.bottom-u.top;return a>0?Math.max(10,a):null}function vhe(u,a,c,f){const p=u.compareText;if(a in p){const x=p[a];for(let b=x.length-1;b>=0;b--)if(f.dist(x[b])<c)return!0}else p[a]=[];return p[a].push(f),!1}function MV(u,a){const c=u.fovAboveCenter,f=u.elevation?u.elevation.getMinElevationBelowMSL()*a:0,p=(u._camera.position[2]*u.worldSize-f)/Math.cos(u._pitch),x=Math.sin(c)*p/Math.sin(Math.max(Math.PI/2-u._pitch-c,.01));let b=Math.sin(u._pitch)*x+p;const A=p*(1/u._horizonShift);if(!u.elevation||u.elevation.exaggeration()===0){let k=Math.max(u.zoom-17,0);u.isOrthographic&&(k/=10),b*=1+k}return Math.min(1.01*b,A)}function D1(u,a){if(!a.isReprojectedInTileSpace)return{scale:1<<u.z,x:u.x,y:u.y,x2:u.x+1,y2:u.y+1,projection:a};const c=Math.pow(2,-u.z),f=u.x*c,p=(u.x+1)*c,x=u.y*c,b=(u.y+1)*c,A=ke(f),k=ke(p),M=Te(x),$=Te(b),V=a.project(A,M),q=a.project(k,M),X=a.project(k,$),Y=a.project(A,$);let se=Math.min(V.x,q.x,X.x,Y.x),ce=Math.min(V.y,q.y,X.y,Y.y),he=Math.max(V.x,q.x,X.x,Y.x),be=Math.max(V.y,q.y,X.y,Y.y);const Ee=c/16;function Oe(Fe,Ke,Qe,nt,Et,ft){const Tt=(Qe+Et)/2,It=(nt+ft)/2,Dt=a.project(ke(Tt),Te(It)),Xt=Math.max(0,se-Dt.x,ce-Dt.y,Dt.x-he,Dt.y-be);se=Math.min(se,Dt.x),he=Math.max(he,Dt.x),ce=Math.min(ce,Dt.y),be=Math.max(be,Dt.y),Xt>Ee&&(Oe(Fe,Dt,Qe,nt,Tt,It),Oe(Dt,Ke,Tt,It,Et,ft))}Oe(V,q,f,x,p,x),Oe(q,X,p,x,p,b),Oe(X,Y,p,b,f,b),Oe(Y,V,f,b,f,x),se-=Ee,ce-=Ee,he+=Ee,be+=Ee;const Ue=1/Math.max(he-se,be-ce);return{scale:Ue,x:se*Ue,y:ce*Ue,x2:he*Ue,y2:be*Ue,projection:a}}function DV(u,{x:a,y:c},f=0){return new Mt(((a-f)*u.scale-u.x)*Jt,(c*u.scale-u.y)*Jt)}const _he=j(new Float32Array(16));class Lp{constructor(a){this.spec=a,this.name=a.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(a,c){return{x:0,y:0,z:0}}unproject(a,c){return new Q(0,0)}projectTilePoint(a,c,f){return{x:a,y:c,z:0}}locationPoint(a,c,f,p=!0){return a._coordinatePoint(a.locationCoordinate(c,f),p)}pixelsPerMeter(a,c){return Se(1,a)*c}pixelSpaceConversion(a,c,f){return 1}farthestPixelDistance(a){return MV(a,a.pixelsPerMeter)}pointCoordinate(a,c,f,p){const x=a.horizonLineFromTop(!1),b=new Mt(c,Math.max(x,f));return a.rayIntersectionCoordinate(a.pointRayIntersection(b,p))}pointCoordinate3D(a,c,f){const p=new Mt(c,f);if(a.elevation)return a.elevation.pointCoordinate(p);{const x=this.pointCoordinate(a,p.x,p.y,0);return[x.x,x.y,x.z]}}isPointAboveHorizon(a,c){if(a.elevation&&a.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(a,c.x,c.y);const f=a.horizonLineFromTop();return c.y<f}createInversionMatrix(a,c){return _he}createTileMatrix(a,c,f){let p,x,b;const A=f.canonical,k=j(new Float64Array(16));if(this.isReprojectedInTileSpace){const M=D1(A,this);p=1,x=M.x+f.wrap*M.scale,b=M.y,B(k,k,[p/M.scale,p/M.scale,a.pixelsPerMeter/c])}else p=c/a.zoomScale(A.z),x=(A.x+Math.pow(2,A.z)*f.wrap)*p,b=A.y*p;return F(k,k,[x,b,0]),B(k,k,[p/Jt,p/Jt,1]),k}upVector(a,c,f){return[0,0,1]}upVectorScale(a,c,f){return{metersToTile:1}}}class xhe extends Lp{constructor(a){super(a),this.range=[4,7],this.center=a.center||[-96,37.5];const[c,f]=this.parallels=a.parallels||[29.5,45.5],p=Math.sin(bn(c));this.n=(p+Math.sin(bn(f)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(a,c){const{n:f,c:p,r0:x}=this,b=bn(a-this.center[0]),A=bn(c),k=Math.sqrt(p-2*f*Math.sin(A))/f;return{x:k*Math.sin(b*f),y:k*Math.cos(b*f)-x,z:0}}unproject(a,c){const{n:f,c:p,r0:x}=this,b=x+c;let A=Math.atan2(a,Math.abs(b))*Math.sign(b);b*f<0&&(A-=Math.PI*Math.sign(a)*Math.sign(b));const k=bn(this.center[0])*f;A=Je(A,-Math.PI-k,Math.PI-k);const M=ve(is(A/f)+this.center[0],-180,180),$=Math.asin(ve((p-(a*a+b*b)*f*f)/(2*f),-1,1)),V=ve(is($),-Re,Re);return new Q(M,V)}}const L1=1.340264,F1=-.081106,z1=893e-6,B1=.003796,FA=Math.sqrt(3)/2;class bhe extends Lp{project(a,c){c=c/180*Math.PI,a=a/180*Math.PI;const f=Math.asin(FA*Math.sin(c)),p=f*f,x=p*p*p;return{x:.5*(a*Math.cos(f)/(FA*(L1+3*F1*p+x*(7*z1+9*B1*p)))/Math.PI+.5),y:1-.5*(f*(L1+F1*p+x*(z1+B1*p))/Math.PI+1),z:0}}unproject(a,c){a=(2*a-.5)*Math.PI;let f=c=(2*(1-c)-1)*Math.PI,p=f*f,x=p*p*p;for(let $,V,q,X=0;X<12&&(V=f*(L1+F1*p+x*(z1+B1*p))-c,q=L1+3*F1*p+x*(7*z1+9*B1*p),$=V/q,f=ve(f-$,-Math.PI/3,Math.PI/3),p=f*f,x=p*p*p,!(Math.abs($)<1e-12));++X);const b=FA*a*(L1+3*F1*p+x*(7*z1+9*B1*p))/Math.cos(f),A=Math.asin(Math.sin(f)/FA),k=ve(180*b/Math.PI,-180,180),M=ve(180*A/Math.PI,-Re,Re);return new Q(k,M)}}class whe extends Lp{constructor(a){super(a),this.wrap=!0,this.supportsWorldCopies=!0}project(a,c){return{x:.5+a/360,y:.5-c/360,z:0}}unproject(a,c){const f=360*(a-.5),p=ve(360*(.5-c),-Re,Re);return new Q(f,p)}}const rx=Math.PI/2;function zA(u){return Math.tan((rx+u)/2)}class She extends Lp{constructor(a){super(a),this.center=a.center||[0,30];const[c,f]=this.parallels=a.parallels||[30,30];let p=bn(c),x=bn(f);this.southernCenter=p+x<0,this.southernCenter&&(p=-p,x=-x);const b=Math.cos(p),A=zA(p);this.n=p===x?Math.sin(p):Math.log(b/Math.cos(x))/Math.log(zA(x)/A),this.f=b*Math.pow(zA(p),this.n)/this.n}project(a,c){c=bn(c),this.southernCenter&&(c=-c),a=bn(a-this.center[0]);const f=1e-6,{n:p,f:x}=this;x>0?c<-rx+f&&(c=-rx+f):c>rx-f&&(c=rx-f);const b=x/Math.pow(zA(c),p);let A=b*Math.sin(p*a),k=x-b*Math.cos(p*a);return A=.5*(A/Math.PI+.5),k=.5*(k/Math.PI+.5),{x:A,y:this.southernCenter?k:1-k,z:0}}unproject(a,c){a=(2*a-.5)*Math.PI,this.southernCenter&&(c=1-c),c=(2*(1-c)-.5)*Math.PI;const{n:f,f:p}=this,x=p-c,b=Math.sign(x),A=Math.sign(f)*Math.sqrt(a*a+x*x);let k=Math.atan2(a,Math.abs(x))*b;x*f<0&&(k-=Math.PI*Math.sign(a)*b);const M=ve(is(k/f)+this.center[0],-180,180),$=ve(is(2*Math.atan(Math.pow(p/A,1/f))-rx),-Re,Re);return new Q(M,this.southernCenter?-$:$)}}class LV extends Lp{constructor(a){super(a),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(a,c){return{x:_e(a),y:ge(c),z:0}}unproject(a,c){const f=ke(a),p=Te(c);return new Q(f,p)}}const FV=bn(Re);class Ehe extends Lp{project(a,c){const f=(c=bn(c))*c,p=f*f;return{x:.5*((a=bn(a))*(.8707-.131979*f+p*(p*(.003971*f-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(c*(1.007226+f*(.015085+p*(.028874*f-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(a,c){a=(2*a-.5)*Math.PI;let f=c=(2*(1-c)-1)*Math.PI,p=25,x=0,b=f*f;do{b=f*f;const M=b*b;x=(f*(1.007226+b*(.015085+M*(.028874*b-.044475-.005916*M)))-c)/(1.007226+b*(.045255+M*(.259866*b-.311325-.005916*11*M))),f=ve(f-x,-FV,FV)}while(Math.abs(x)>1e-6&&--p>0);b=f*f;const A=ve(is(a/(.8707+b*(b*(b*b*b*(.003971-.001529*b)-.013791)-.131979))),-180,180),k=is(f);return new Q(A,k)}}const zV=bn(Re);class The extends Lp{project(a,c){c=bn(c),a=bn(a);const f=Math.cos(c),p=2/Math.PI,x=Math.acos(f*Math.cos(a/2)),b=Math.sin(x)/x,A=.5*(a*p+2*f*Math.sin(a/2)/b)||0,k=.5*(c+Math.sin(c)/b)||0;return{x:.5*(A/Math.PI+.5),y:1-.5*(k/Math.PI+1),z:0}}unproject(a,c){let f=a=(2*a-.5)*Math.PI,p=c=(2*(1-c)-1)*Math.PI,x=25;const b=1e-6;let A=0,k=0;do{const M=Math.cos(p),$=Math.sin(p),V=2*$*M,q=$*$,X=M*M,Y=Math.cos(f/2),se=Math.sin(f/2),ce=2*Y*se,he=se*se,be=1-X*Y*Y,Ee=be?1/be:0,Oe=be?Math.acos(M*Y)*Math.sqrt(1/be):0,Ue=.5*(2*Oe*M*se+2*f/Math.PI)-a,Fe=.5*(Oe*$+p)-c,Ke=.5*Ee*(X*he+Oe*M*Y*q)+1/Math.PI,Qe=Ee*(ce*V/4-Oe*$*se),nt=.125*Ee*(V*se-Oe*$*X*ce),Et=.5*Ee*(q*Y+Oe*he*M)+.5,ft=Qe*nt-Et*Ke;A=(Fe*Qe-Ue*Et)/ft,k=(Ue*nt-Fe*Ke)/ft,f=ve(f-A,-Math.PI,Math.PI),p=ve(p-k,-zV,zV)}while((Math.abs(A)>b||Math.abs(k)>b)&&--x>0);return new Q(is(f),is(p))}}class BV extends Lp{constructor(a){super(a),this.center=a.center||[0,0],this.parallels=a.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(bn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(a,c){const{scale:f,cosPhi:p}=this;return{x:bn(a)*p*f+.5,y:-Math.sin(bn(c))/p*f+.5,z:0}}unproject(a,c){const{scale:f,cosPhi:p}=this,x=-(c-.5)/f,b=ve(is((a-.5)/f)/p,-180,180),A=Math.asin(ve(x*p,-1,1)),k=ve(is(A),-Re,Re);return new Q(b,k)}}class Ahe extends LV{constructor(a){super(a),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(a,c,f){const p=d1(a,c,f);return Ut(p,p,cA(Xd(f))),{x:p[0],y:p[1],z:p[2]}}locationPoint(a,c,f){const p=z(c.lat,c.lng),x=je([],p),b=f?a._centerAltitude+f:a.elevation?a.elevation.getAtPointOrZero(a.locationCoordinate(c),a._centerAltitude):a._centerAltitude;tt(p,p,x,Se(1,0)*Jt*b);const A=j(new Float64Array(16));return R(A,a.pixelMatrix,a.globeMatrix),Ut(p,p,A),new Mt(p[0],p[1])}pixelsPerMeter(a,c){return Se(1,0)*c}pixelSpaceConversion(a,c,f){const p=Se(1,a)*c,x=qr(Se(1,45)*c,p,f);return this.pixelsPerMeter(a,c)/x}createTileMatrix(a,c,f){const p=Rj(Xd(f.canonical));return R(new Float64Array(16),a.globeMatrix,p)}createInversionMatrix(a,c){const{center:f}=a,p=cA(Xd(c));return Z(p,p,bn(f.lng)),U(p,p,bn(f.lat)),B(p,p,[a._pixelsPerMercatorPixel,a._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(a,c,f,p){return u$(a,c,f,!0)||new lt(0,0)}pointCoordinate3D(a,c,f){const p=this.pointCoordinate(a,c,f,0);return[p.x,p.y,p.z]}isPointAboveHorizon(a,c){return!u$(a,c.x,c.y,!1)}farthestPixelDistance(a){const c=function(p,x){const b=p.cameraToCenterDistance,A=p._centerAltitude*x,k=p._camera,M=p._camera.forward(),$=Ce([],Ie([],M,-b),[0,0,A]),V=p.worldSize/(2*Math.PI),q=[0,0,-V],X=p.width/p.height,Y=Math.tan(p.fovAboveCenter),se=Ie([],k.up(),Y),ce=Ie([],k.right(),Y*X),he=je([],Ce([],Ce([],M,se),ce)),be=[];let Ee;if(new sn($,he).closestPointOnSphere(q,V,be)){const Oe=Ce([],be,q),Ue=Rt([],Oe,$);Ee=Math.cos(p.fovAboveCenter)*xe(Ue)}else{const Oe=Rt([],$,q),Ue=Rt([],q,$);je(Ue,Ue);const Fe=xe(Oe)-V;Ee=Math.sqrt(Fe*(Fe+2*V));const Ke=Math.acos(Ee/(V+Fe))-Math.acos(ot(M,Ue));Ee*=Math.cos(Ke)}return 1.01*Ee}(a,this.pixelsPerMeter(a.center.lat,a.worldSize)),f=jp(a.zoom);if(f>0){const p=MV(a,Se(1,a.center.lat)*a.worldSize),x=a.worldSize/(2*Math.PI),b=Math.max(a.width,a.height)/a.worldSize*Math.PI;return qr(c,p+x*(1-Math.cos(b)),Math.pow(f,10))}return c}upVector(a,c,f){return d1(c,f,a,1)}upVectorScale(a){return{metersToTile:oA(lA(Xd(a)))}}}function $V(u){const a=u.parallels,c=!!a&&Math.abs(a[0]+a[1])<.01;switch(u.name){case"mercator":return new LV(u);case"equirectangular":return new whe(u);case"naturalEarth":return new Ehe(u);case"equalEarth":return new bhe(u);case"winkelTripel":return new The(u);case"albers":return c?new BV(u):new xhe(u);case"lambertConformalConic":return c?new BV(u):new She(u);case"globe":return new Ahe(u)}throw new Error(`Invalid projection name: ${u.name}`)}const Phe=Lt.types,Che=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function $1(u,a,c,f,p,x,b,A,k,M,$,V,q){const X=A?Math.min(sf,Math.round(A[0])):0,Y=A?Math.min(sf,Math.round(A[1])):0;u.emplaceBack(a,c,Math.round(32*f),Math.round(32*p),x,b,(X<<1)+(k?1:0),0+(Y<<1),16*M,16*$,256*V,256*q)}function U1(u,a,c){u.emplaceBack(a,c)}function V1(u,a,c,f,p,x,b){u.emplaceBack(a,c,f,p,x,b)}const BA=(u,a,c,f)=>{for(let p=0;p<a;p++)u.emplaceBack(c[0],c[1],c[2],f[0],f[1],f[2])};function nx(u,a,c,f,p){u.emplaceBack(a,c,f,p),u.emplaceBack(a,c,f,p),u.emplaceBack(a,c,f,p),u.emplaceBack(a,c,f,p)}function Ohe(u){for(const a of u.sections)if(mj(a.text))return!0;return!1}class PN{constructor(a){this.layoutVertexArray=new I_,this.indexArray=new Gi,this.programConfigurations=a,this.segments=new ta,this.dynamicLayoutVertexArray=new Kd,this.opacityVertexArray=new Zw,this.placedSymbolArray=new Jg,this.iconTransitioningVertexArray=new oc,this.globeExtVertexArray=new Ep,this.zOffsetVertexArray=new Ku,this.orientationVertexArray=new Jw,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(a,c){const f=[],p=this.layoutVertexArray.uint16;for(let x=0;x<c;++x){const b=12*(a+x);f.push(...p.slice(b,b+12))}return f}updateIconVertexData(a,c,f,p,x,b,A,k,M,$,V,q,X){const Y=this.layoutVertexArray.uint16,se=12*a;Y[se]=c,Y[se+1]=f,Y[se+2]=p,Y[se+3]=x,Y[se+4]=b,Y[se+5]=A,Y[se+6]=k,Y[se+7]=M,Y[se+8]=$,Y[se+9]=V,Y[se+10]=q,Y[se+11]=X}upload(a,c,f,p,x,b){this.isEmpty()||(f&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,jde.members,!!b),this.indexBuffer=a.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,Mde.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,Che,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=a.createVertexBuffer(this.iconTransitioningVertexArray,Fde.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=a.createVertexBuffer(this.globeExtVertexArray,Nde.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||x)&&(this.zOffsetVertexBuffer=a.createVertexBuffer(this.zOffsetVertexArray,Dde.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=a.createVertexBuffer(this.orientationVertexArray,Lde.members,!0)),this.opacityVertexBuffer.itemSize=1),(f||p)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}gr(PN,"SymbolBuffers");class CN{constructor(a,c,f){this.layoutVertexArray=new a,this.layoutAttributes=c,this.indexArray=new f,this.segments=new ta,this.collisionVertexArray=new Ap,this.collisionVertexArrayExt=new Kd}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,zde.members,!0),this.collisionVertexBufferExt=a.createVertexBuffer(this.collisionVertexArrayExt,Bde.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}gr(CN,"CollisionBuffers");class $A{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(b=>b.fqid),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=j([]),this.placementViewportMatrix=j([]);const c=this.layers[0]._unevaluatedLayout._values;this.worldview=a.worldview,this.textSizeData=J_(this.zoom,c["text-size"],this.worldview),this.iconSizeData=J_(this.zoom,c["icon-size"],this.worldview);const f=this.layers[0].layout,p=f.get("symbol-sort-key"),x=f.get("symbol-z-order");this.lut=a.lut,this.canOverlap=f.get("text-allow-overlap")||f.get("icon-allow-overlap")||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=f.get("text-writing-mode").map(b=>kl[b]),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=a.sourceID,this.projection=a.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null}hasAnyAppearanceProperty(a){const c=this.layers[0].getAppearances();return!(!c||c.length===0)&&c.some(f=>f.getProperty(a)!=null)}createArrays(){this.text=new PN(new Ic(this.layers,{zoom:this.zoom,lut:this.lut},a=>a.startsWith("text")||a.startsWith("symbol"))),this.icon=new PN(new Ic(this.layers,{zoom:this.zoom,lut:this.lut},a=>a.startsWith("icon")||a.startsWith("symbol"))),this.glyphOffsetArray=new a1,this.lineVertexArray=new X2,this.symbolInstances=new Z2}calculateGlyphDependencies(a,c,f,p,x){for(const b of a){const A=b.codePointAt(0);if(A===void 0)break;if(c[A]=!0,p&&x&&A<=65535){const k=k1[b];k&&(c[k.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(a,c,f,p,x,b){let A=1;const k=a.getUnevaluatedProperties()._values["icon-size"],M=J_(this.zoom,k,this.worldview),$=Q_(M,c);if(M.kind!=="constant"&&M.kind!=="camera"||(A=$.uSize),M.kind==="composite"){const{minZoom:V,maxZoom:q}=M,X=k.possiblyEvaluate(new Ri(V,{worldview:this.worldview}),p),Y=k.possiblyEvaluate(new Ri(q,{worldview:this.worldview}),p),se=X.evaluate(f,{},p,x);A=se+(Y.evaluate(f,{},p,x)-se)*$.uSizeT}return M.kind==="source"&&(A=k.possiblyEvaluate(new Ri(this.zoom,{worldview:this.worldview}),p).evaluate(f,{},p,x)),A*b}updateFootprints(a,c){}updateReplacement(a,c){if(c.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=c.updateTime;const f=c.getReplacementRegionsForTile(a.toUnwrapped(),!0);return!mA(this.activeReplacements,f)&&(this.activeReplacements=f,!0)}getResolvedImageFromTokens(a){return typeof a=="string"?Ds.build(a):a}populate(a,c,f,p){const x=this.layers[0],b=x.layout,A=this.projection.name==="globe",k=b.get("text-font"),M=b.get("text-field"),$=b.get("icon-image"),[V,q]=b.get("icon-size-scale-range"),X=ve(c.scaleFactor||1,V,q),Y=(M.value.kind!=="constant"||M.value.value instanceof po&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(k.value.kind!=="constant"||k.value.value.length>0),se=$.value.kind!=="constant"||!!$.value.value||Object.keys($.parameters).length>0,ce=this.hasAnyAppearanceProperty("icon-image"),he=b.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!Y&&!se&&!ce)return;const be=c.iconDependencies,Ee=c.glyphDependencies,Oe=c.availableImages,Ue=new Ri(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),Fe=Ke=>{const Qe=Ke.id.toString();be.has(Qe)?be.get(Qe).push(Ke):be.set(Qe,[Ke])};for(const Ke of a){const{feature:Qe,id:nt,index:Et,sourceLayerIndex:ft}=Ke,Tt=x._featureFilter.needGeometry,It=gt(Qe,Tt);if(!x._featureFilter.filter(Ue,It,f))continue;if(Tt||(It.geometry=kt(Qe,f,p)),A&&Qe.type!==1&&f.z<=5){const zt=It.geometry,Ht=.98078528056,Nt=(pr,_r)=>ot(d1(pr.x,pr.y,f,1),d1(_r.x,_r.y,f,1))<Ht;for(let pr=0;pr<zt.length;pr++)zt[pr]=Ot(zt[pr],Nt)}let Dt,Xt;if(Y){const zt=x.getValueAndResolveTokens("text-field",It,f,Oe),Ht=po.factory(zt);Ohe(Ht)&&(this.hasRTLText=!0),(!this.hasRTLText||Bw()==="unavailable"||this.hasRTLText&&el.isParsed())&&(Dt=Ude(Ht,x,It))}if(se){const zt=x.getValueAndResolveTokens("icon-image",It,f,Oe);Xt=this.getResolvedImageFromTokens(zt)}const Vt=this.layers[0];let jt=!1;if(!Xt&&ce){const zt=Vt.getAppearances();for(const Ht of zt)if(Ht.getProperty("icon-image")){const Nt=Vt.getAppearanceValueAndResolveTokens(Ht,"icon-image",It,f,Oe);if(Nt){Xt=this.getResolvedImageFromTokens(Nt),jt=!0;break}}}if(!Dt&&!Xt)continue;const $t=this.sortFeaturesByKey?he.evaluate(It,{},f):void 0,xt={id:nt,text:Dt,icon:Xt,index:Et,sourceLayerIndex:ft,geometry:It.geometry,properties:Qe.properties,type:Phe[Qe.type],sortKey:$t};if(this.features.push(xt),this.appearanceFeatureData.push({id:nt,properties:Qe.properties,usesAppearanceIconAsPlaceholder:jt,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),Xt){const zt=Vt._unevaluatedLayout._values,{iconPrimary:Ht,iconSecondary:Nt}=N1(Xt,this.iconSizeData,zt["icon-size"],f,this.zoom,xt,this.pixelRatio,X,this.worldview);Fe(Ht),Nt&&(this.hasAnySecondaryIcon=!0,Fe(Nt))}const vt=Vt.getAppearances();if(vt.length!==0&&vt.forEach(zt=>{if(!zt.getProperty("icon-image"))return;const Ht=this.getCombinedIconPrimary(zt,Vt,It,f,Oe,xt,X);Ht&&Fe(Ht)}),Dt){const zt=k.evaluate(It,{},f).join(","),Ht=b.get("text-rotation-alignment")==="map"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(kl.vertical)>=0;for(const Nt of Dt.sections)if(Nt.image){const pr=Nt.image.getPrimary().scaleSelf(this.pixelRatio),_r=pr.id.toString(),ur=be.get(_r)||[];ur.push(pr),be.set(_r,ur)}else{const pr=Nw(Dt.toString()),_r=Nt.fontStack||zt,ur=Ee[_r]=Ee[_r]||{};this.calculateGlyphDependencies(Nt.text,ur,Ht,this.allowVerticalPlacement,pr)}}}if(b.get("symbol-placement")==="line"&&(this.features=function(Ke){const Qe={},nt={},Et=[];let ft=0;function Tt(Vt){Et.push(Ke[Vt]),ft++}function It(Vt,jt,$t){const xt=nt[Vt];return delete nt[Vt],nt[jt]=xt,Et[xt].geometry[0].pop(),Et[xt].geometry[0]=Et[xt].geometry[0].concat($t[0]),xt}function Dt(Vt,jt,$t){const xt=Qe[jt];return delete Qe[jt],Qe[Vt]=xt,Et[xt].geometry[0].shift(),Et[xt].geometry[0]=$t[0].concat(Et[xt].geometry[0]),xt}function Xt(Vt,jt,$t){const xt=$t?jt[0][jt[0].length-1]:jt[0][0];return`${Vt}:${xt.x}:${xt.y}`}for(let Vt=0;Vt<Ke.length;Vt++){const jt=Ke[Vt],$t=jt.geometry,xt=jt.text?jt.text.toString():null;if(!xt){Tt(Vt);continue}const vt=Xt(xt,$t),zt=Xt(xt,$t,!0);if(vt in nt&&zt in Qe&&nt[vt]!==Qe[zt]){const Ht=Dt(vt,zt,$t),Nt=It(vt,zt,Et[Ht].geometry);delete Qe[vt],delete nt[zt],nt[Xt(xt,Et[Nt].geometry,!0)]=Nt,Et[Ht].geometry=null}else vt in nt?It(vt,zt,$t):zt in Qe?Dt(vt,zt,$t):(Tt(Vt),Qe[vt]=ft-1,nt[zt]=ft-1)}return Et.filter(Vt=>Vt.geometry)}(this.features)),b.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",c.elevationFeatures){!this.elevationFeatures&&c.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ke of c.elevationFeatures)this.elevationFeatureIdToIndex.set(Ke.id,this.elevationFeatures.length),this.elevationFeatures.push(Ke)}}else b.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Ke,Qe)=>Ke.sortKey-Qe.sortKey)}getCombinedIconPrimary(a,c,f,p,x,b,A){let k,M;const $=a.getUnevaluatedProperties();if($._values["icon-image"].value!==void 0){const V=c.getAppearanceValueAndResolveTokens(a,"icon-image",f,p,x);k=this.getResolvedImageFromTokens(V)}else{const V=c.getValueAndResolveTokens("icon-image",f,p,x);k=this.getResolvedImageFromTokens(V)}if(k){const V=$._values["icon-size"]||c._unevaluatedLayout._values["icon-size"];M=N1(k,J_(this.zoom,V,this.worldview),V,p,this.zoom,b,this.pixelRatio,A,this.worldview).iconPrimary}return M}updateAppearanceBasedIconTextures(a,c,f,p){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const x=this.layers[0];let b=!1,A=0;const k=x.layout,[M,$]=k.get("icon-size-scale-range"),V=ve(1,M,$);for(let q=0;q<this.symbolInstances.length;q++){const X=this.symbolInstances.get(q),Y=this.appearanceFeatureData[X.featureIndex];if(Y&&X.placedIconSymbolIndex>=0){const se=Y.id,ce=c&&se!==void 0?c[String(se)]:void 0,he={type:"Point",id:Y.id,properties:Y.properties,geometry:[]},be=this.layers[0].appearances&&this.layers[0].appearances.find(Ee=>Ee.isActive({globals:p,feature:he,canonical:a,featureState:ce}));if(Y.activeAppearance===be)continue;if(be){Y.activeAppearance=be;const Ee={sortKey:void 0,text:void 0,icon:null,index:X.featureIndex,sourceLayerIndex:X.featureIndex,geometry:[],properties:Y.properties,type:"Point",id:Y.id};if(!be.hasCachedIconPrimary()){const Ke=this.getCombinedIconPrimary(be,x,he,a,f,Ee,V);be.setCachedIconPrimary(Ke)}const Oe=be.getCachedIconPrimary();if(!Oe)continue;const Ue=Oe.toString(),Fe=this.iconAtlasPositions&&this.iconAtlasPositions.get(Ue);if(Fe){const Ke=x.getAppearanceValueAndResolveTokens(be,"icon-offset",he,a,f),Qe=Ke&&Array.isArray(Ke)?Ke:[0,0];let nt=IA(Fe,void 0,Qe,x.layout.get("icon-anchor").evaluate(he,{},a));const Et=x.getAppearanceValueAndResolveTokens(be,"icon-rotate",he,a,f),ft=typeof Et=="number"?Et:0,Tt=Fe.sdf,It=x.layout.get("icon-text-fit").constantOr("none");It!=="none"&&Y.textShaping&&Y.iconTextFitPadding&&Y.fontScale&&(nt=vN(nt,Y.textShaping,It,Y.iconTextFitPadding,Qe,Y.fontScale));const Dt=this.calculateEffectiveAppearanceIconSize(be,p.zoom,he,a,f,V),Xt=0,Vt=1+(Math.min(sf,Math.round(Dt*Qu))<<1),jt=wN(nt,ft,Tt,It!=="none",V);Y.isUsingAppearanceVertexData||(Y.isUsingAppearanceVertexData=!0,Y.layoutBasedVertexData=this.icon.getIconVertexData(A,X.numIconVertices));for(let xt=0;xt<jt.length;++xt){const vt=jt[xt],zt=Y.layoutBasedVertexData[0]||X.tileAnchorX,Ht=Y.layoutBasedVertexData[1]||X.tileAnchorY,Nt=16*vt.pixelOffsetTL.x,pr=16*vt.pixelOffsetTL.y,_r=16*vt.pixelOffsetBR.x,ur=16*vt.pixelOffsetBR.y,ar=16*vt.minFontScaleX,Xr=16*vt.minFontScaleY;this.icon.updateIconVertexData(A,zt,Ht,Math.round(32*vt.tl.x),Math.round(32*vt.tl.y),vt.texPrimary.x,vt.texPrimary.y,Xt,Vt,Nt,pr,ar,Xr),this.icon.updateIconVertexData(A+1,zt,Ht,Math.round(32*vt.tr.x),Math.round(32*vt.tr.y),vt.texPrimary.x+vt.texPrimary.w,vt.texPrimary.y,Xt,Vt,_r,pr,ar,Xr),this.icon.updateIconVertexData(A+2,zt,Ht,Math.round(32*vt.bl.x),Math.round(32*vt.bl.y),vt.texPrimary.x,vt.texPrimary.y+vt.texPrimary.h,Xt,Vt,Nt,ur,ar,Xr),this.icon.updateIconVertexData(A+3,zt,Ht,Math.round(32*vt.br.x),Math.round(32*vt.br.y),vt.texPrimary.x+vt.texPrimary.w,vt.texPrimary.y+vt.texPrimary.h,Xt,Vt,_r,ur,ar,Xr),A+=4}const $t=X.numIconVertices-4*jt.length;for(let xt=0;xt<$t;++xt)this.icon.updateIconVertexData(A+xt,0,0,0,0,0,0,0,0,0,0,0,0);b=!0}else A+=X.numIconVertices}else if(Y.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(A,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(A+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(A+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(A+3,0,0,0,0,0,0,0,0,0,0,0,0),b=!0),A+=X.numIconVertices,Y.activeAppearance=null;else if(Y.isUsingAppearanceVertexData){const Oe=Y.layoutBasedVertexData.length/12;for(let Ue=0;Ue<Oe;++Ue){const Fe=Ue*12;this.icon.updateIconVertexData(A+Ue,Y.layoutBasedVertexData[Fe+0],Y.layoutBasedVertexData[Fe+1],Y.layoutBasedVertexData[Fe+2],Y.layoutBasedVertexData[Fe+3],Y.layoutBasedVertexData[Fe+4],Y.layoutBasedVertexData[Fe+5],Y.layoutBasedVertexData[Fe+6],Y.layoutBasedVertexData[Fe+7],Y.layoutBasedVertexData[Fe+8],Y.layoutBasedVertexData[Fe+9],Y.layoutBasedVertexData[Fe+10],Y.layoutBasedVertexData[Fe+11])}A+=Oe,Y.isUsingAppearanceVertexData=!1,Y.activeAppearance=null,b=!0}else A+=X.numIconVertices,Y.activeAppearance=null}}return b}update(a,c,f,p,x,b,A){this.text.programConfigurations.updatePaintArrays(a,c,x,f,p,b,A,this.worldview),this.icon.programConfigurations.updatePaintArrays(a,c,x,f,p,b,A,this.worldview)}updateRoadElevation(a){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let c=!1;const f=We(a),p=1/f;let x=!1,b=!1;for(let A=0;A<this.symbolInstances.length;A++){const k=this.symbolInstances.get(A),M=we(1,0,0),$=we(0,1,0),{numHorizontalGlyphVertices:V,numVerticalGlyphVertices:q,numIconVertices:X,numVerticalIconVertices:Y}=k,se=V>0||q>0,ce=X>0,he=this.elevationFeatures[k.elevationFeatureIndex];if(he){const be=new Mt(k.tileAnchorX,k.tileAnchorY),Ee=.075+he.pointElevation(be);k.zOffset!==Ee&&(c=!0,k.zOffset=Ee),Ee!==0&&(this.hasAnyZOffset=!0);const Oe=he.computeSlopeNormal(be,p),Ue=Va(tr(),we(0,0,1),Oe);dr(M,M,Ue),dr($,$,Ue),M[2]*=f,$[2]*=f,M[0]===1&&M[1]===0&&M[2]===0&&$[0]===0&&$[1]===1&&$[2]===0||(x=x||se,b=b||ce)}if(se&&(BA(this.text.orientationVertexArray,V,M,$),BA(this.text.orientationVertexArray,q,M,$)),ce){const{placedIconSymbolIndex:be,verticalPlacedIconSymbolIndex:Ee}=k;be>=0&&BA(this.icon.orientationVertexArray,X,M,$),Ee>=0&&BA(this.icon.orientationVertexArray,Y,M,$)}}x||(this.text.orientationVertexArray=void 0),b||(this.icon.orientationVertexArray=void 0),c&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const a=(x,b,A)=>{f+=b,f>x.length&&x.resize(f);for(let k=-b;k<0;k++)x.emplace(k+f,A)},c=(x,b,A)=>{p+=b,p>x.length&&x.resize(p);for(let k=-b;k<0;k++)x.emplace(k+p,A)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let f=0,p=0;for(let x=0;x<this.symbolInstances.length;x++){const b=this.symbolInstances.get(x),{numHorizontalGlyphVertices:A,numVerticalGlyphVertices:k,numIconVertices:M}=b,$=b.zOffset,V=M>0;if((A>0||k>0)&&(a(this.text.zOffsetVertexArray,A,$),a(this.text.zOffsetVertexArray,k,$)),V){const{placedIconSymbolIndex:q,verticalPlacedIconSymbolIndex:X}=b;q>=0&&c(this.icon.zOffsetVertexArray,M,$),X>=0&&c(this.icon.zOffsetVertexArray,b.numVerticalIconVertices,$)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a,c,f,p,x){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(b=>b.appearances&&b.appearances.length>0)),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(a,c,f,p){return!!(a&&c&&f)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(a,c,f,p)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=$V(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,c){const f=this.lineVertexArray.length;if(a.segment!==void 0)for(const{x:p,y:x}of c)this.lineVertexArray.emplaceBack(p,x);return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(a,c,f,p,x,b,A,k,M,$,V,q,X,Y,se,ce,he,be){const Ee=a.indexArray,Oe=a.layoutVertexArray,Ue=a.globeExtVertexArray,Fe=a.segments.prepareSegment(4*be,Oe,Ee,this.canOverlap?b.sortKey:void 0),Ke=this.glyphOffsetArray.length,Qe=Fe.vertexLength,nt=this.allowVerticalPlacement&&A===kl.vertical?Math.PI/2:0,Et=b.text&&b.text.sections;for(let It=0;It<c.length;It++){const{tl:Dt,tr:Xt,bl:Vt,br:jt,texPrimary:$t,texSecondary:xt,pixelOffsetTL:vt,pixelOffsetBR:zt,minFontScaleX:Ht,minFontScaleY:Nt,glyphOffset:pr,isSDF:_r,sectionIndex:ur}=c[It],ar=Fe.vertexLength,Xr=pr[1];if($1(Oe,M.x,M.y,Dt.x,Xr+Dt.y,$t.x,$t.y,f,_r,vt.x,vt.y,Ht,Nt),$1(Oe,M.x,M.y,Xt.x,Xr+Xt.y,$t.x+$t.w,$t.y,f,_r,zt.x,vt.y,Ht,Nt),$1(Oe,M.x,M.y,Vt.x,Xr+Vt.y,$t.x,$t.y+$t.h,f,_r,vt.x,zt.y,Ht,Nt),$1(Oe,M.x,M.y,jt.x,Xr+jt.y,$t.x+$t.w,$t.y+$t.h,f,_r,zt.x,zt.y,Ht,Nt),k){const{x:sr,y:Or,z:Qr}=k.anchor,[vn,Bn,nn]=k.up;V1(Ue,sr,Or,Qr,vn,Bn,nn),V1(Ue,sr,Or,Qr,vn,Bn,nn),V1(Ue,sr,Or,Qr,vn,Bn,nn),V1(Ue,sr,Or,Qr,vn,Bn,nn),nx(a.dynamicLayoutVertexArray,sr,Or,Qr,nt)}else nx(a.dynamicLayoutVertexArray,M.x,M.y,M.z,nt);if(ce){const sr=xt||$t;U1(a.iconTransitioningVertexArray,sr.x,sr.y),U1(a.iconTransitioningVertexArray,sr.x+sr.w,sr.y),U1(a.iconTransitioningVertexArray,sr.x,sr.y+sr.h),U1(a.iconTransitioningVertexArray,sr.x+sr.w,sr.y+sr.h)}Ee.emplaceBack(ar,ar+1,ar+2),Ee.emplaceBack(ar+1,ar+2,ar+3),Fe.vertexLength+=4,Fe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(pr[0]),It!==c.length-1&&ur===c[It+1].sectionIndex||a.programConfigurations.populatePaintArrays(Oe.length,b,b.index,{},X,Y,se,Et&&Et[ur],this.worldview)}const ft=be-c.length;ft!==0&&this._addNullVertices(ft,Oe,f,k,Ue,a,ce,Fe,Ee);const Tt=k?k.anchor:M;a.placedSymbolArray.emplaceBack(Tt.x,Tt.y,Tt.z,M.x,M.y,Ke,this.glyphOffsetArray.length-Ke,Qe,$,V,M.segment,f?f[0]:0,f?f[1]:0,p[0],p[1],A,0,0,0,q,0),a.symbolInstanceIndices.push(he)}_addNullVertices(a,c,f,p,x,b,A,k,M){for(let $=0;$<a;$++){for(let q=0;q<4;q++)$1(c,0,0,0,0,0,0,f,!1,0,0,0,0),p&&V1(x,0,0,0,0,0,0),nx(b.dynamicLayoutVertexArray,0,0,0,0),A&&U1(b.iconTransitioningVertexArray,0,0);const V=k.vertexLength;M.emplaceBack(V,V+1,V+2),M.emplaceBack(V+1,V+2,V+3),k.vertexLength+=4,k.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(a,c,f,p,x,b,A){a.emplaceBack(c,f,p,x,b,Math.round(A.x),Math.round(A.y))}_addCollisionDebugVertices(a,c,f,p,x,b,A){const k=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),M=k.vertexLength,$=A.tileAnchorX,V=A.tileAnchorY;for(let X=0;X<4;X++)f.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(f.collisionVertexArrayExt,c,a.padding,A.zOffset),this._commitLayoutVertex(f.layoutVertexArray,p,x,b,$,V,new Mt(a.x1,a.y1)),this._commitLayoutVertex(f.layoutVertexArray,p,x,b,$,V,new Mt(a.x2,a.y1)),this._commitLayoutVertex(f.layoutVertexArray,p,x,b,$,V,new Mt(a.x2,a.y2)),this._commitLayoutVertex(f.layoutVertexArray,p,x,b,$,V,new Mt(a.x1,a.y2)),k.vertexLength+=4;const q=f.indexArray;q.emplaceBack(M,M+1),q.emplaceBack(M+1,M+2),q.emplaceBack(M+2,M+3),q.emplaceBack(M+3,M),k.primitiveLength+=4}_addTextDebugCollisionBoxes(a,c,f,p,x,b){for(let A=p;A<x;A++){const k=f.get(A),M=this.getSymbolInstanceTextSize(a,b,c,A);this._addCollisionDebugVertices(k,M,this.textCollisionBox,k.projectedAnchorX,k.projectedAnchorY,k.projectedAnchorZ,b)}}_addIconDebugCollisionBoxes(a,c,f,p,x,b){for(let A=p;A<x;A++){const k=f.get(A),M=this.getSymbolInstanceIconSize(a,c,b.placedIconSymbolIndex);this._addCollisionDebugVertices(k,M,this.iconCollisionBox,k.projectedAnchorX,k.projectedAnchorY,k.projectedAnchorZ,b)}}generateCollisionDebugBuffers(a,c,f){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new CN(R_,iV.members,oc),this.iconCollisionBox=new CN(R_,iV.members,oc);const p=Q_(this.iconSizeData,a),x=Q_(this.textSizeData,a,f);for(let b=0;b<this.symbolInstances.length;b++){const A=this.symbolInstances.get(b);this._addTextDebugCollisionBoxes(x,a,c,A.textBoxStartIndex,A.textBoxEndIndex,A),this._addTextDebugCollisionBoxes(x,a,c,A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A),this._addIconDebugCollisionBoxes(p,a,c,A.iconBoxStartIndex,A.iconBoxEndIndex,A),this._addIconDebugCollisionBoxes(p,a,c,A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex,A)}}getSymbolInstanceTextSize(a,c,f,p){const x=this.text.placedSymbolArray.get(c.rightJustifiedTextSymbolIndex>=0?c.rightJustifiedTextSymbolIndex:c.centerJustifiedTextSymbolIndex>=0?c.centerJustifiedTextSymbolIndex:c.leftJustifiedTextSymbolIndex>=0?c.leftJustifiedTextSymbolIndex:c.verticalPlacedTextSymbolIndex>=0?c.verticalPlacedTextSymbolIndex:p),b=_N(this.textSizeData,a,x)/To;return this.tilePixelRatio*b}getSymbolInstanceIconSize(a,c,f){const p=this.icon.placedSymbolArray.get(f),x=_N(this.iconSizeData,a,p);return this.tilePixelRatio*x}_commitDebugCollisionVertexUpdate(a,c,f,p){a.emplaceBack(c,-f,-f,p),a.emplaceBack(c,f,-f,p),a.emplaceBack(c,f,f,p),a.emplaceBack(c,-f,f,p)}_updateTextDebugCollisionBoxes(a,c,f,p,x,b,A){for(let k=p;k<x;k++){const M=f.get(k),$=this.getSymbolInstanceTextSize(a,b,c,k);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,$,M.padding,b.zOffset)}}_updateIconDebugCollisionBoxes(a,c,f,p,x,b,A){for(let k=p;k<x;k++){const M=f.get(k),$=this.getSymbolInstanceIconSize(a,c,b.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,$,M.padding,b.zOffset)}}updateCollisionDebugBuffers(a,c,f,p){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const x=Q_(this.iconSizeData,a,p),b=Q_(this.textSizeData,a,f);for(let A=0;A<this.symbolInstances.length;A++){const k=this.symbolInstances.get(A);this._updateTextDebugCollisionBoxes(b,a,c,k.textBoxStartIndex,k.textBoxEndIndex,k,f),this._updateTextDebugCollisionBoxes(b,a,c,k.verticalTextBoxStartIndex,k.verticalTextBoxEndIndex,k,f),this._updateIconDebugCollisionBoxes(x,a,c,k.iconBoxStartIndex,k.iconBoxEndIndex,k,p),this._updateIconDebugCollisionBoxes(x,a,c,k.verticalIconBoxStartIndex,k.verticalIconBoxEndIndex,k,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(a,c,f,p,x,b,A,k,M){const $={};if(c<f){const{x1:V,y1:q,x2:X,y2:Y,padding:se,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:be,tileAnchorX:Ee,tileAnchorY:Oe,featureIndex:Ue}=a.get(c);$.textBox={x1:V,y1:q,x2:X,y2:Y,padding:se,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:be,tileAnchorX:Ee,tileAnchorY:Oe},$.textFeatureIndex=Ue}if(p<x){const{x1:V,y1:q,x2:X,y2:Y,padding:se,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:be,tileAnchorX:Ee,tileAnchorY:Oe,featureIndex:Ue}=a.get(p);$.verticalTextBox={x1:V,y1:q,x2:X,y2:Y,padding:se,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:be,tileAnchorX:Ee,tileAnchorY:Oe},$.verticalTextFeatureIndex=Ue}if(b<A){const{x1:V,y1:q,x2:X,y2:Y,padding:se,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:be,tileAnchorX:Ee,tileAnchorY:Oe,featureIndex:Ue}=a.get(b);$.iconBox={x1:V,y1:q,x2:X,y2:Y,padding:se,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:be,tileAnchorX:Ee,tileAnchorY:Oe},$.iconFeatureIndex=Ue}if(k<M){const{x1:V,y1:q,x2:X,y2:Y,padding:se,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:be,tileAnchorX:Ee,tileAnchorY:Oe,featureIndex:Ue}=a.get(k);$.verticalIconBox={x1:V,y1:q,x2:X,y2:Y,padding:se,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:be,tileAnchorX:Ee,tileAnchorY:Oe},$.verticalIconFeatureIndex=Ue}return $}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(a,c){const f=a.placedSymbolArray.get(c),p=f.vertexStartIndex+4*f.numGlyphs;for(let x=f.vertexStartIndex;x<p;x+=4)a.indexArray.emplaceBack(x,x+1,x+2),a.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(a),f=Math.cos(a),p=[],x=[],b=[];for(let A=0;A<this.symbolInstances.length;++A){b.push(A);const k=this.symbolInstances.get(A);p.push(0|Math.round(c*k.tileAnchorX+f*k.tileAnchorY)),x.push(k.featureIndex)}return b.sort((A,k)=>p[A]-p[k]||x[k]-x[A]),b}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let a=0;a<this.symbolInstances.length;++a)this.symbolInstanceIndexesSortedZOffset.push(a)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((a,c)=>this.symbolInstances.get(c).zOffset-this.symbolInstances.get(a).zOffset)}addToSortKeyRanges(a,c){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===c?f.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const f=this.symbolInstances.get(c);this.featureSortOrder.push(f.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:x,leftJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:A,placedIconSymbolIndex:k,verticalPlacedIconSymbolIndex:M}=f;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),x>=0&&x!==p&&this.addIndicesForPlacedSymbol(this.text,x),b>=0&&b!==x&&b!==p&&this.addIndicesForPlacedSymbol(this.text,b),A>=0&&this.addIndicesForPlacedSymbol(this.text,A),k>=0&&this.addIndicesForPlacedSymbol(this.icon,k),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(a){const c=this.symbolInstances.get(this.text.symbolInstanceIndices[a]).elevationFeatureIndex;let f;return this.elevationFeatures&&c<this.elevationFeatures.length&&(f=this.elevationFeatures[c]),f}}function UV(u,a){return a.replace(/{([^{}]+)}/g,(c,f)=>f in u?String(u[f]):"")}let VV,qV,ON;gr($A,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),$A.addDynamicAttributes=nx;class WV{constructor(a){this.type=a.property.overrides?a.property.overrides.runtimeType:Jf,this.defaultValue=a}evaluate(a){if(a.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(a.formattedSection))return c.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}gr(WV,"FormatSectionOverride",{omit:["defaultValue"]});const kN=()=>ON||(ON={layout:VV||(VV=new ua({"symbol-placement":new Wt(ht.layout_symbol["symbol-placement"]),"symbol-spacing":new Wt(ht.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Wt(ht.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new lr(ht.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Wt(ht.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Wt(ht.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Wt(ht.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Wt(ht.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Wt(ht.layout_symbol["icon-ignore-placement"]),"icon-optional":new Wt(ht.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Wt(ht.layout_symbol["icon-rotation-alignment"]),"icon-size":new lr(ht.layout_symbol["icon-size"]),"icon-size-scale-range":new Wt(ht.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new lr(ht.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new lr(ht.layout_symbol["icon-text-fit-padding"]),"icon-image":new lr(ht.layout_symbol["icon-image"]),"icon-image-use-theme":new Wt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new lr(ht.layout_symbol["icon-rotate"]),"icon-padding":new Wt(ht.layout_symbol["icon-padding"]),"icon-keep-upright":new Wt(ht.layout_symbol["icon-keep-upright"]),"icon-offset":new lr(ht.layout_symbol["icon-offset"]),"icon-anchor":new lr(ht.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Wt(ht.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Wt(ht.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Wt(ht.layout_symbol["text-rotation-alignment"]),"text-field":new lr(ht.layout_symbol["text-field"]),"text-font":new lr(ht.layout_symbol["text-font"]),"text-size":new lr(ht.layout_symbol["text-size"]),"text-size-scale-range":new Wt(ht.layout_symbol["text-size-scale-range"]),"text-max-width":new lr(ht.layout_symbol["text-max-width"]),"text-line-height":new lr(ht.layout_symbol["text-line-height"]),"text-letter-spacing":new lr(ht.layout_symbol["text-letter-spacing"]),"text-justify":new lr(ht.layout_symbol["text-justify"]),"text-radial-offset":new lr(ht.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Wt(ht.layout_symbol["text-variable-anchor"]),"text-anchor":new lr(ht.layout_symbol["text-anchor"]),"text-max-angle":new Wt(ht.layout_symbol["text-max-angle"]),"text-writing-mode":new Wt(ht.layout_symbol["text-writing-mode"]),"text-rotate":new lr(ht.layout_symbol["text-rotate"]),"text-padding":new Wt(ht.layout_symbol["text-padding"]),"text-keep-upright":new Wt(ht.layout_symbol["text-keep-upright"]),"text-transform":new lr(ht.layout_symbol["text-transform"]),"text-offset":new lr(ht.layout_symbol["text-offset"]),"text-allow-overlap":new Wt(ht.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Wt(ht.layout_symbol["text-ignore-placement"]),"text-optional":new Wt(ht.layout_symbol["text-optional"]),visibility:new Wt(ht.layout_symbol.visibility)})),paint:qV||(qV=new ua({"icon-opacity":new lr(ht.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new lr(ht.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new lr(ht.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new lr(ht.paint_symbol["text-emissive-strength"]),"icon-color":new lr(ht.paint_symbol["icon-color"]),"icon-halo-color":new lr(ht.paint_symbol["icon-halo-color"]),"icon-halo-width":new lr(ht.paint_symbol["icon-halo-width"]),"icon-halo-blur":new lr(ht.paint_symbol["icon-halo-blur"]),"icon-translate":new Wt(ht.paint_symbol["icon-translate"]),"icon-translate-anchor":new Wt(ht.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Wt(ht.paint_symbol["icon-image-cross-fade"]),"text-opacity":new lr(ht.paint_symbol["text-opacity"]),"text-occlusion-opacity":new lr(ht.paint_symbol["text-occlusion-opacity"]),"text-color":new lr(ht.paint_symbol["text-color"],{runtimeType:Js,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new lr(ht.paint_symbol["text-halo-color"]),"text-halo-width":new lr(ht.paint_symbol["text-halo-width"]),"text-halo-blur":new lr(ht.paint_symbol["text-halo-blur"]),"text-translate":new Wt(ht.paint_symbol["text-translate"]),"text-translate-anchor":new Wt(ht.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Wt(ht.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Wt(ht.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Wt(ht.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Wt(ht.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new lr(ht.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"})}))},ON);class UA extends ss{constructor(a,c,f,p){super(a,kN(),c,f,p,a.layout?a.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=j([]),this.hasOcclusionOpacityProperties=a.paint!==void 0&&("icon-occlusion-opacity"in a.paint||"text-occlusion-opacity"in a.paint)}_handleSpecialPaintPropertyUpdate(a){a!=="icon-occlusion-opacity"&&a!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(a,c){super.recalculate(a,c),this.appearances&&this.appearances.forEach(p=>{p.recalculate(a,c,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const f=this.layout.get("text-writing-mode");if(f){const p=[];for(const x of f)p.indexOf(x)<0&&p.push(x);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(a,c,f,p){return this._saturation===a&&this._contrast===c&&this._brightnessMin===f&&this._brightnessMax===p||(this._colorAdjustmentMatrix=function(x,b,A,k){x=aa(x),b=zi(b);const M=N(),$=x/3,V=1-2*$,q=[V,$,$,0,$,V,$,0,$,$,V,0,0,0,0,1],X=.5-.5*b,Y=k-A;return R(M,[Y,0,0,0,0,Y,0,0,0,0,Y,0,A,A,A,1],[b,0,0,0,0,b,0,0,0,0,b,0,X,X,X,1]),R(M,M,q),M}(a,c,f,p),this._saturation=a,this._contrast=c,this._brightnessMin=f,this._brightnessMax=p),this._colorAdjustmentMatrix}getValueAndResolveTokens(a,c,f,p){const x=this.layout.get(a).evaluate(c,{},f,p),b=this._unevaluatedLayout._values[a];return b.isDataDriven()||__(b.value)||!x?x:UV(c.properties,x)}getAppearanceValueAndResolveTokens(a,c,f,p,x){const b=a.getProperty(c);if(!b)return;const A=b.evaluate(f,{},p,x),k=a.getUnevaluatedProperties()._values[c];return k.isDataDriven()||__(k.value)||!A||typeof A!="string"?A:UV(f.properties,A)}createBucket(a){return new $A(a)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const a of kN().paint.overridableProperties){if(!UA.hasPaintOverride(this.layout,a))continue;const c=this.paint.get(a),f=new WV(c),p=new v_(f,c.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let x=null;x=c.value.kind==="constant"||c.value.kind==="source"?new Gg("source",p):new Vd("composite",p,c.value.zoomStops,c.value.interpolationType),this.paint._values[a]=new ac(c.property,x,c.parameters)}}_handleOverridablePaintPropertyUpdate(a,c,f){return!(!this.layout||c.isDataDriven()||f.isDataDriven())&&UA.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,c){const f=a.get("text-field"),p=kN().paint.properties[c];let x=!1;const b=A=>{for(const k of A)if(p.overrides&&p.overrides.hasOverride(k))return void(x=!0)};if(f.value.kind==="constant"&&f.value.value instanceof po)b(f.value.value.sections);else if(f.value.kind==="source"){const A=M=>{x||(M instanceof Vu&&co(M.value)===Uh?b(M.value.sections):M instanceof Vh?b(M.sections):M.eachChild(A))},k=f.value;k._styleExpression&&A(k._styleExpression.expression)}return x}getProgramIds(){return["symbol"]}getDefaultProgramParams(a,c,f){return{config:new Xu(this,{zoom:c,lut:f}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let GV,HV,KV,ZV;var IN=Tn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function VA(u,a,c,f,p,x,b,A){const k=[u,a,1,c,f,1,p,x,1],M=[b,A,1],$=T([],k),[V,q,X]=Ft(M,M,$);return C(k,k,[V,0,0,0,q,0,0,0,X])}function XV(u,a,c,f,p,x,b,A){const k=function(M,$,V,q,X,Y,se,ce){const he=VA(0,0,1,0,1,1,0,1),be=VA(M,$,V,q,X,Y,se,ce);return C(be,be,T([],he))}(u,a,c,f,p,x,b,A);return[k[2]/k[8]/Jt,k[5]/k[8]/Jt]}function qA(u){return[u[0],Math.min(Math.max(u[1],-Re),Re)]}class YV extends Bu{constructor(a,c,f,p){super(),this.id=a,this.dispatcher=f,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=c,this._dirty=!1}load(a,c){if(this._loaded=c||!1,this.fire(new _l("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return a&&(this.coordinates=a),this._loaded=!0,void this._finishLoading();this._imageRequest=Qb(this.map._requestManager.transformRequest(this.url,zh.Image),(f,p)=>{this._imageRequest=null,this._loaded=!0,f?this.fire(new Tg(f)):p&&(this.image=p instanceof HTMLImageElement?Ys.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading())})}loaded(){return this._loaded}updateImage(a){return a.url?(this._imageRequest&&a.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}setTexture(a){if(!(a.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new P1(this.map.painter.context,a.handle),this.width=a.dimensions[0],this.height=a.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new _l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(a){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof P1||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(a){if(this.coordinates=a,this._boundsArray=void 0,this._unsupportedCoords=!1,!a.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let c=a[0][1],f=a[0][1];for(const x of a)x[1]>f&&(f=x[1]),x[1]<c&&(c=x[1]);const p=(f+c)/2;if(p>Re?this.onNorthPole=!0:p<-Re&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const x=a.map(lt.fromLngLat);this.tileID=function(b){let A=1/0,k=1/0,M=-1/0,$=-1/0;for(const se of b)A=Math.min(A,se.x),k=Math.min(k,se.y),M=Math.max(M,se.x),$=Math.max($,se.y);const V=Math.max(M-A,$-k),q=Math.max(0,Math.floor(-Math.log2(V))),X=Math.pow(2,q);let Y=Math.floor((A+M)/2*X);return Y>1&&(Y-=1),new Pl(q,Y,Math.floor((k+$)/2*X))}(x),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new _l("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof P1||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(a){for(const he in this.tiles){const be=this.tiles[he];be.state!=="loaded"&&(be.state="loaded",be.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const c=D1(new Pl(0,0,0),this.map.transform.projection),f=[c.projection.project(this.coordinates[0][0],this.coordinates[0][1]),c.projection.project(this.coordinates[1][0],this.coordinates[1][1]),c.projection.project(this.coordinates[2][0],this.coordinates[2][1]),c.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(he){const be=he[1].x-he[0].x,Ee=he[1].y-he[0].y,Oe=he[2].x-he[1].x,Ue=he[2].y-he[1].y,Fe=he[3].x-he[2].x,Ke=he[3].y-he[2].y,Qe=he[0].x-he[3].x,nt=he[0].y-he[3].y,Et=be*Ue-Oe*Ee,ft=Oe*Ke-Fe*Ue,Tt=Fe*nt-Qe*Ke,It=Qe*Ee-be*nt;return Et>0&&ft>0&&Tt>0&&It>0||Et<0&&ft<0&&Tt<0&&It<0}(f))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const p=D1(this.tileID,this.map.transform.projection),[x,b,A,k]=this.coordinates.map(he=>{const be=p.projection.project(he[0],he[1]);return DV(p,be)._round()});this.perspectiveTransform=XV(x.x,x.y,b.x,b.y,A.x,A.y,k.x,k.y);const M=this._boundsArray=new Sp;M.emplaceBack(x.x,x.y,0,0),M.emplaceBack(b.x,b.y,Jt,0),M.emplaceBack(k.x,k.y,0,Jt),M.emplaceBack(A.x,A.y,Jt,Jt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=a.createVertexBuffer(M,IN.members),this.boundsSegments=ta.simpleSegment(0,0,4,2);const $=[],V=[qA((q=this.coordinates)[0]),qA(q[1]),qA(q[2]),qA(q[3])];var q;const[X,Y,se,ce]=function(he){let be=he[0][0],Ee=be,Oe=he[0][1],Ue=Oe;for(let Fe=1;Fe<he.length;Fe++)he[Fe][0]<be?be=he[Fe][0]:he[Fe][0]>Ee&&(Ee=he[Fe][0]),he[Fe][1]<Oe?Oe=he[Fe][1]:he[Fe][1]>Ue&&(Ue=he[Fe][1]);return[be,Oe,Ee-be,Ue-Oe]}(V);{const he=new Sp,[be,Ee,Oe,Ue]=function(jt){let $t=jt[0].x,xt=$t,vt=jt[0].y,zt=vt;for(let Ht=1;Ht<jt.length;Ht++)jt[Ht].x<$t?$t=jt[Ht].x:jt[Ht].x>xt&&(xt=jt[Ht].x),jt[Ht].y<vt?vt=jt[Ht].y:jt[Ht].y>zt&&(zt=jt[Ht].y);return[$t,vt,xt-$t,zt-vt]}(f),Fe=jt=>[(jt.x-be)/Oe,(jt.y-Ee)/Ue],[Ke,Qe,nt,Et]=f.map(Fe),ft=function(jt,$t,xt,vt,zt,Ht,Nt,pr){const _r=VA(0,0,1,0,1,1,0,1);return C(_r,_r,T([],VA(jt,$t,xt,vt,zt,Ht,Nt,pr)))}(Ke[0],Ke[1],Qe[0],Qe[1],nt[0],nt[1],Et[0],Et[1]);this.elevatedGlobePerspectiveTransform=XV(Ke[0],Ke[1],Qe[0],Qe[1],nt[0],nt[1],Et[0],Et[1]);const Tt=(jt,$t)=>{$.push(jt.lng);const xt=Math.round((jt.lng-X)/se*Jt),vt=Math.round((jt.lat-Y)/ce*Jt),zt=Fe($t),Ht=Ft([],[zt[0],zt[1],1],ft),Nt=Math.round(Ht[0]/Ht[2]*Jt),pr=Math.round(Ht[1]/Ht[2]*Jt);he.emplaceBack(xt,vt,Nt,pr)},It=f[3].x-f[0].x,Dt=f[3].y-f[0].y,Xt=f[2].x-f[1].x,Vt=f[2].y-f[1].y;for(let jt=0;jt<65;jt++){const $t=jt/64,xt=[f[0].x+$t*It,f[0].y+$t*Dt],vt=[f[1].x+$t*Xt,f[1].y+$t*Vt],zt=vt[0]-xt[0],Ht=vt[1]-xt[1];for(let Nt=0;Nt<65;Nt++){const pr=Nt/64,_r={x:xt[0]+zt*pr,y:xt[1]+Ht*pr};Tt(c.projection.unproject(_r.x,_r.y),_r)}}this.elevatedGlobeVertexBuffer=a.createVertexBuffer(he,IN.members)}{this.maxLongitudeTriangleSize=0;let he=[],be=new Gi;const Ee=(Oe,Ue,Fe)=>{be.emplaceBack(Oe,Ue,Fe);const Ke=$[Oe],Qe=$[Ue],nt=$[Fe],Et=Math.min(Math.min(Ke,Qe),nt),ft=Math.max(Math.max(Ke,Qe),nt)-Et;ft>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ft),he.push(Et+ft/2)};for(let Oe=0;Oe<64;Oe++)for(let Ue=0;Ue<64;Ue++){const Fe=65*Oe+Ue,Ke=Fe+1,Qe=Fe+65,nt=Qe+1;Ee(Fe,Qe,Ke),Ee(Ke,Qe,nt)}[he,be]=function(Oe,Ue){const Fe=Array.from({length:Oe.length},(nt,Et)=>Et);Fe.sort((nt,Et)=>Oe[nt]-Oe[Et]);const Ke=[],Qe=new Gi;for(let nt=0;nt<Fe.length;nt++){const Et=Fe[nt];Ke.push(Oe[Et]);const ft=3*Et,Tt=ft+1;Qe.emplaceBack(Ue.uint16[ft],Ue.uint16[Tt],Ue.uint16[Tt+1])}return[Ke,Qe]}(he,be),this.elevatedGlobeTrianglesCenterLongitudes=he,this.elevatedGlobeIndexBuffer=a.createIndexBuffer(be)}this.elevatedGlobeSegments=ta.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,se/Jt,0,ce/Jt,0,0,Y,X,0])}prepare(){const a=Object.keys(this.tiles).length!==0;if(this.tileID&&!a)return;const c=this.map.painter.context,f=c.gl;!this._dirty||this.texture instanceof P1||(this.texture?this.texture.update(this.image):(this.texture=new nN(c,this.image,f.RGBA8),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this._dirty=!1),a&&this._prepareData(c)}loadTile(a,c){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},c(null)):(a.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(a){const c=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!c)return null;const f=this.elevatedGlobeTrianglesCenterLongitudes;let p=(x=a+180)+360*Math.round((f[0]-x)/360);var x;const b=new ta,A=(V,q)=>{b.segments.push({vertexOffset:0,primitiveOffset:V,vertexLength:c.segments[0].vertexLength,primitiveLength:q,sortKey:void 0,vaos:{}})},k=.51*this.maxLongitudeTriangleSize;if(Math.abs(f[0]-p)<=k){const V=Nn(f,0,f.length,p+k);return V===f.length||A(V,ci(f,V+1,f.length,p+360-k)-V),b}p<f[0]&&(p+=360);const M=ci(f,0,f.length,p-k);if(M===f.length)return A(0,f.length),b;A(0,M-0);const $=Nn(f,M+1,f.length,p+k);return $!==f.length&&A($,f.length-$),b}}const khe=(Math.pow(256,2)-1)/16907520;class JV extends ss{constructor(a,c,f,p){super(a,{layout:KV||(KV=new ua({visibility:new Wt(ht.layout_raster.visibility)})),paint:ZV||(ZV=new ua({"raster-opacity":new Wt(ht.paint_raster["raster-opacity"]),"raster-color":new vp(ht.paint_raster["raster-color"]),"raster-color-mix":new Wt(ht.paint_raster["raster-color-mix"]),"raster-color-range":new Wt(ht.paint_raster["raster-color-range"]),"raster-hue-rotate":new Wt(ht.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Wt(ht.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Wt(ht.paint_raster["raster-brightness-max"]),"raster-saturation":new Wt(ht.paint_raster["raster-saturation"]),"raster-contrast":new Wt(ht.paint_raster["raster-contrast"]),"raster-resampling":new Wt(ht.paint_raster["raster-resampling"]),"raster-fade-duration":new Wt(ht.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Wt(ht.paint_raster["raster-emissive-strength"]),"raster-array-band":new Wt(ht.paint_raster["raster-array-band"]),"raster-elevation":new Wt(ht.paint_raster["raster-elevation"]),"raster-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"})}))},c,f,p),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(a){return!(a&&a._source instanceof YV&&(a._source.onNorthPole||a._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(a){a!=="raster-color"&&a!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(a){if(!this.hasColorMap()||!this._curRampRange)return;const c=this._transitionablePaint._values["raster-color"].value.expression,[f,p]=a||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(f)&&isNaN(p)||f===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=h1({expression:c,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:f,end:p}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[f,p])}}let QV,e6,t6,r6,n6;class i6 extends ss{constructor(a,c,f,p){super(a,{layout:QV||(QV=new ua({visibility:new Wt(ht["layout_raster-particle"].visibility)})),paint:e6||(e6=new ua({"raster-particle-array-band":new Wt(ht["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Wt(ht["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new vp(ht["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Wt(ht["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Wt(ht["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Wt(ht["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Wt(ht["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Wt(ht["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"})}))},c,f,p),this._updateColorRamp(),this.lastInvalidatedAt=Ys.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(a){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(a){return!1}_handleSpecialPaintPropertyUpdate(a){a!=="raster-particle-color"&&a!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),a==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const a=this._transitionablePaint._values["raster-particle-color"].value.expression,c=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=h1({expression:a,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:c}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ys.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Ihe extends ss{constructor(a,c){super(a,{},c,null),this.implementation=a,a.slot&&(this.slot=a.slot)}is3D(a){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(a){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(a){this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)}onRemove(a){this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)}}function RN(u,a,c){const f=[0,0,1],p=Pr([]);return pn(p,p,c?-bn(u)+Math.PI:bn(u)),un(p,p,-bn(a)),dr(f,f,p),je(f,f)}const a6={None:0,Model:1,Symbol:2,FillExtrusion:4};class WA{constructor(a,c,f,p){this.message=(a?`${a}: `:"")+f,p&&(this.identifier=p),c!=null&&c.__line__&&(this.line=c.__line__)}}function jN(u,a){const c=u.indexOf("://")===-1;try{return new URL(u,c&&a?"http://example.com":void 0),!0}catch{return!1}}class o6{constructor(a,c){this.feature=a,this.instancedDataOffset=c,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class s6{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new N_,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(a){const c=16*a,f=this.instancedDataArray.float32;let p=Math.floor(f[c+2]);const x=1.05*(f[c+2]-p);return p/=100,[f[c]%1*1.05,f[c+1]%1*1.05,x,p]}tileCoordinatesForInstance(a){const c=16*a,f=this.instancedDataArray.float32;let p=f[c+0];return p=p>Jt?p-Jt:p,new Mt(Math.trunc(p),Math.trunc(f[c+1]))}translationForInstance(a){const c=16*a,f=this.instancedDataArray.float32;return[f[c+4],f[c+5],f[c+6]]}rotationScaleForInstance(a){const c=16*a,f=this.instancedDataArray.float32;return[f[c+7],f[c+8],f[c+9],f[c+10],f[c+11],f[c+12],f[c+13],f[c+14],f[c+15]]}transformForInstance(a){const c=16*a,f=this.instancedDataArray.float32;return[f[c+7],f[c+8],f[c+9],f[c+4],f[c+10],f[c+11],f[c+12],f[c+5],f[c+13],f[c+14],f[c+15],f[c+6],0,0,0,1]}}class NN{constructor(a){this.zoom=a.zoom,this.canonical=a.canonical,this.overscaledZ=this.canonical.z+Math.log2(a.overscaling),this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.projection=a.projection,this.index=a.index,this.worldview=a.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=a.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(a,c){}updateAppearances(a,c,f,p){}populate(a,c,f,p){this.tileToMeter=We(f);const x=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:b,id:A,index:k,sourceLayerIndex:M}of a){const $=A??(b.properties&&b.properties.hasOwnProperty("id")?b.properties.id:void 0),V=gt(b,x);if(!this.layers[0]._featureFilter.filter(new Ri(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),V,f))continue;const q={id:$,sourceLayerIndex:M,index:k,geometry:x?V.geometry:kt(b,f,p),properties:b.properties,type:b.type,patterns:{}},X=this.addFeature(q,q.geometry,V);X&&c.featureIndex.insert(b,q.geometry,k,M,this.index,this.instancesPerModel[X].instancedDataArray.length,Jt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const a=this.layers[0].modelManager,c=this.layers[0].scope;let f=0;for(const p of this.modelUris){const x=a.getModel(p,c);if(!x)continue;const b=this.instancesPerModel[p];if(b){const A=.5*Ze(x.aabb.max,x.aabb.min)*b.maxScale+b.maxXYTranslationDistance,k=Math.min(Jt,Math.max(A/this.tileToMeter,Jt/32));f=Math.max(k,f)}}return f}update(a,c,f,p){for(const x in this.instancesPerModel){const b=this.instancesPerModel[x];for(const A in a)b.idToFeaturesIndex.hasOwnProperty(A)&&(this.evaluate(b.features[b.idToFeaturesIndex[A]],a[A],b,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let a=!1;for(const c in this.instancesPerModel){const f=this.instancesPerModel[c];for(const p of f.features){const x=this.layers[0],b=p.feature,A=this.canonical,k=x.paint.get("model-rotation").evaluate(b,{},A),M=x.paint.get("model-scale").evaluate(b,{},A),$=x.paint.get("model-translation").evaluate(b,{},A);Jr(p.rotation,k)&&Jr(p.scale,M)&&Jr(p.translation,$)||(this.evaluate(p,p.featureStates,f,!0),a=!0)}}return a}updateReplacement(a,c,f,p){if(c.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=c.updateTime;const x=c.getReplacementRegionsForTile(a.toUnwrapped(),!0);if(mA(this.activeReplacements,x))return!1;this.activeReplacements=x;let b=!1;for(const A in this.instancesPerModel){const k=this.instancesPerModel[A],M=k.instancedDataArray;for(const $ of k.features){const V=$.instancedDataOffset,q=$.instancedDataCount;for(let X=0;X<q;X++){const Y=16*(X+V);let se=M.float32[Y+0];const ce=se>Jt;se=ce?se-Jt:se;const he=Math.floor(se),be=Math.floor(M.float32[Y+1]);let Ee=!1;for(const Oe of this.activeReplacements)if(!G$(Oe,f,a6.Model,p)&&!(Oe.min.x>he||he>Oe.max.x||Oe.min.y>be||be>Oe.max.y)&&(Ee=Wj(X$(he,be,a.canonical,Oe.footprintTileId.canonical),Oe.footprint),Ee))break;M.float32[Y]=Ee?se+Jt:se,b=b||Ee!==ce}}}return b}isEmpty(){for(const a in this.instancesPerModel)if(this.instancesPerModel[a].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(a){if(!this.uploaded)for(const c in this.instancesPerModel){const f=this.instancesPerModel[c];f.instancedDataArray.length<0||f.instancedDataArray.length===0||(f.instancedDataBuffer?f.instancedDataBuffer.updateData(f.instancedDataArray):f.instancedDataBuffer=a.createVertexBuffer(f.instancedDataArray,ide.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const c in this.instancesPerModel){const f=this.instancesPerModel[c];f.instancedDataArray.length!==0&&f.instancedDataBuffer&&f.instancedDataBuffer.destroy()}const a=this.layers[0].modelManager;if(a&&this.modelUris&&this.modelsRequested)for(const c of this.modelUris)a.removeModel(c,"",!0)}addFeature(a,c,f){const p=this.layers[0],x=p.layout.get("model-id").evaluate(f,{},this.canonical);if(!x)return Ir(`modelId is not evaluated for layer ${p.id} and it is not going to get rendered.`),x;(jN(x,!1)||this.styleDefinedModelURLs[x]!==void 0)&&(this.modelUris.includes(x)||this.modelUris.push(x)),this.instancesPerModel[x]||(this.instancesPerModel[x]=new s6);const b=this.instancesPerModel[x],A=b.instancedDataArray,k=new o6(f,A.length);for(const M of c)for(const $ of M){if($.x<0||$.x>=Jt||$.y<0||$.y>=Jt)continue;if(this.lookupDim!==0){const q=(this.lookupDim-1)/Jt,X=this.lookupDim*($.y*q|0)+$.x*q|0;if(this.lookup){if(this.lookup[X]!==0)continue;this.lookup[X]=1}}this.instanceCount++;const V=A.length;A.resize(V+1),b.instancesEvaluatedElevation.push(0),A.float32[16*V]=$.x,A.float32[16*V+1]=$.y}return k.instancedDataCount=b.instancedDataArray.length-k.instancedDataOffset,k.instancedDataCount>0&&(a.id&&(b.idToFeaturesIndex[a.id]=b.features.length),b.features.push(k),this.evaluate(k,{},b,!1)),x}getModelUris(){return this.modelUris}evaluate(a,c,f,p){const x=this.layers[0],b=a.feature,A=this.canonical,k=a.rotation=x.paint.get("model-rotation").evaluate(b,c,A),M=a.scale=x.paint.get("model-scale").evaluate(b,c,A),$=a.translation=x.paint.get("model-translation").evaluate(b,c,A),V=Object.assign({},x.paint.get("model-color").evaluate(b,c,A));V.a=x.paint.get("model-color-mix-intensity").evaluate(b,c,A);const q=[];this.maxVerticalOffset<$[2]&&(this.maxVerticalOffset=$[2]);const X=$[0]*$[0]+$[1]*$[1],Y=X>0?Math.sqrt(X):0;f.maxScale=Math.max(Math.max(f.maxScale,M[0]),Math.max(M[1],M[2])),f.maxXYTranslationDistance=Math.max(f.maxXYTranslationDistance,Y),this.maxScale=Math.max(Math.max(this.maxScale,M[0]),Math.max(M[1],M[2])),DU(q,k,M);const se=Math.round(100*V.a)+V.b/1.05;for(let ce=0;ce<a.instancedDataCount;++ce){const he=a.instancedDataOffset+ce,be=16*he,Ee=f.instancedDataArray.float32;let Oe=0;p&&(Oe=Ee[be+6]-f.instancesEvaluatedElevation[he]);const Ue=0|Ee[be+1];Ee[be]=(0|Ee[be])+V.r/1.05,Ee[be+1]=Ue+V.g/1.05,Ee[be+2]=se,Ee[be+3]=1/(A.z>10?this.tileToMeter:We(A,Ue)),Ee[be+4]=$[0],Ee[be+5]=$[1],Ee[be+6]=$[2]+Oe,Ee[be+7]=q[0],Ee[be+8]=q[1],Ee[be+9]=q[2],Ee[be+10]=q[4],Ee[be+11]=q[5],Ee[be+12]=q[6],Ee[be+13]=q[8],Ee[be+14]=q[9],Ee[be+15]=q[10],f.instancesEvaluatedElevation[he]=$[2]}}}let l6,c6;gr(NN,"ModelBucket",{omit:["layers"]}),gr(s6,"PerModelAttributes"),gr(o6,"ModelFeature");class ix{constructor(a,c,f){this._demTile=a,this._dem=this._demTile.dem,this._scale=c,this._offset=f}static create(a,c,f){const p=f||a.findDEMTileFor(c);if(!p||!p.dem)return;const x=p.dem,b=p.tileID,A=1<<c.canonical.z-b.canonical.z;return new ix(p,x.dim/Jt/A,[(c.canonical.x/A-b.canonical.x)*x.dim,(c.canonical.y/A-b.canonical.y)*x.dim])}tileCoordToPixel(a,c){const f=c*this._scale+this._offset[1];return new Mt(Math.floor(a*this._scale+this._offset[0]),Math.floor(f))}getElevationAt(a,c,f,p){const x=a*this._scale+this._offset[0],b=c*this._scale+this._offset[1],A=Math.floor(x),k=Math.floor(b),M=this._dem;return p=!!p,f?qr(qr(M.get(A,k,p),M.get(A,k+1,p),b-k),qr(M.get(A+1,k,p),M.get(A+1,k+1,p),b-k),x-A):M.get(A,k,p)}getElevationAtPixel(a,c,f){return this._dem.get(a,c,!!f)}getMeterToDEM(a){return(1<<this._demTile.tileID.canonical.z)*Se(1,a)*this._dem.stride}}const MN=new Float32Array(262144),uy=new Uint8Array(262144);function u6(u){let a=0;if(u.meshes)for(const c of u.meshes)a=Math.max(a,c.aabb.max[2]);if(u.children)for(const c of u.children)a=Math.max(a,u6(c));return a}function d6(u,a,c){if(u.meshes)for(const f of u.meshes){if(f.aabb.min[0]===1/0)continue;const p=gn.applyTransform(f.aabb,u.globalMatrix);c.insert(a,p.min[0],p.min[1],p.max[0],p.max[1])}if(u.children)for(const f of u.children)d6(f,a,c)}const h6=["","wall","door","roof","window","lamp","logo"];class f6{constructor(a){this.node=a,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:a.id,geometry:[],properties:{height:u6(a)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new gn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let a=0;const c=new gn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const f of this.node.meshes)this.node.lightMeshIndex!==a&&(f.transformedAabb=gn.applyTransformFast(f.aabb,this.node.globalMatrix),c.encapsulate(f.transformedAabb)),a++;this.aabb=c}return this.aabb}}class GA{constructor(a,c,f,p,x,b,A,k){this.id=f,this.layers=a,this.layerIds=this.layers.map(M=>M.fqid),this.stateDependentLayerIds=this.layers.filter(M=>M.isStateDependent()).map(M=>M.id),this.modelTraits|=Z_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,p&&(this.modelTraits|=Z_.HasMapboxMeshFeatures),x&&(this.modelTraits|=Z_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=b,this.worldview=k,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const M of c)this.nodesInfo.push(new f6(M)),d6(M,A.featureIndexArray.length,A.grid),A.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,A.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(a,c){for(const f of this.getNodesInfo()){const p=f.node;p.footprint&&c.push({footprint:p.footprint,id:a})}}updateAppearances(a,c,f,p){}update(a){const c=Object.keys(a).length!==0;if(c&&!this.stateDependentLayers.length)return;const f=c?this.stateDependentLayers:this.layers;if(!Vo(a,this.states))for(const p of f)this.evaluate(p,a);this.states=structuredClone(a)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(a){if(!this.needsUpload)return;const c=this.getNodesInfo();for(const f of c){const p=f.node;this.uploaded?this.updatePbrBuffer(p):oN(p,a,!0)}for(const f of c)PA(f.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(a){let c=!1;if(!a.meshes)return c;for(const f of a.meshes)f.pbrBuffer&&(f.pbrBuffer.updateData(f.featureArray),c=!0);return c}needsReEvaluation(a,c,f){const p=a.transform.projectionOptions,x=a.style.getBrightness(),b=this.brightness!==x;if(!this.uploaded||this.dirty||p.name!==this.projection.name||q1(f.paint.get("model-color").value,b)||q1(f.paint.get("model-color-mix-intensity").value,b)||q1(f.paint.get("model-roughness").value,b)||q1(f.paint.get("model-emissive-strength").value,b)||q1(f.paint.get("model-height-based-emissive-strength-multiplier").value,b)){this.projection=p,this.brightness=x;const A=this.getNodesInfo();for(const k of A)k.state=null;return!0}return!1}evaluateTransform(a,c){if(a.transform.zoom===this.zoom)return;this.zoom=a.transform.zoom;const f=this.getNodesInfo(),p=this.id.canonical;for(const x of f){const b=x.feature;x.evaluatedTranslation=c.paint.get("model-translation").evaluate(b,{},p),x.evaluatedScale=c.paint.get("model-scale").evaluate(b,{},p)}}evaluate(a,c){const f=this.getNodesInfo();for(const p of f){if(!p.node.meshes)continue;const x=p.feature,b=c&&c[x.id];if(Vo(b,p.state))continue;p.state=structuredClone(b);const A=p.node.meshes&&p.node.meshes[0].featureData,k=p.evaluatedColor[2],M=p.evaluatedRMEA[2],$=this.id.canonical;if(p.hasTranslucentParts=!1,A){for(let V=0;V<h6.length;V++){const q=h6[V];q.length&&(x.properties.part=q);const X=a.paint.get("model-color").evaluate(x,b,$).toPremultipliedRenderColor(null),Y=a.paint.get("model-color-mix-intensity").evaluate(x,b,$);p.evaluatedColor[V]=[X.r,X.g,X.b,Y],p.evaluatedRMEA[V][0]=a.paint.get("model-roughness").evaluate(x,b,$),p.evaluatedRMEA[V][2]=a.paint.get("model-emissive-strength").evaluate(x,b,$),p.evaluatedRMEA[V][3]=X.a,p.emissionHeightBasedParams[V]=a.paint.get("model-height-based-emissive-strength-multiplier").evaluate(x,b,$),!p.hasTranslucentParts&&X.a<1&&(p.hasTranslucentParts=!0)}delete x.properties.part,jhe(p,k!==p.evaluatedColor[2]||M!==p.evaluatedRMEA[2],this.modelTraits)}else p.evaluatedRMEA[0][2]=a.paint.get("model-emissive-strength").evaluate(x,b,$);p.evaluatedTranslation=a.paint.get("model-translation").evaluate(x,b,$),p.evaluatedScale=a.paint.get("model-scale").evaluate(x,b,$),this.updatePbrBuffer(p.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(a,c,f,p){const x=a.findDEMTileFor(f);if(x&&(x.tileID.canonical!==this.terrainTile||c!==this.terrainExaggeration)){if(x.dem&&x.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=x.tileID.overscaledZ;const b=ix.create(a,f,x);if(!b)return;this.modelTraits&Z_.HasMapboxMeshFeatures&&this.updateDEM(a,b,f,p);for(const A of this.getNodesInfo()){const k=A.node;if(!k.footprint||!k.footprint.vertices||!k.footprint.vertices.length)continue;const M=k.footprint.vertices;let $=b.getElevationAt(M[0].x,M[0].y,!0,!0);for(let V=1;V<M.length;V++)$=Math.min($,b.getElevationAt(M[V].x,M[V].y,!0,!0));k.elevation=$}}this.terrainTile=x.tileID.canonical,this.terrainExaggeration=c}}updateDEM(a,c,f,p){let x=c._dem._modifiedForSources[p];if(x===void 0&&(c._dem._modifiedForSources[p]=[],x=c._dem._modifiedForSources[p]),x.includes(f.canonical))return;const b=c._dem.dim;x.push(f.canonical);let A=!1;for(const k of this.getNodesInfo()){const M=k.node;if(!M.footprint||!M.footprint.grid)continue;const $=M.footprint.grid,V=c.tileCoordToPixel($.min.x,$.min.y),q=c.tileCoordToPixel($.max.x,$.max.y),X=Math.min(Math.min(b-q.y,V.x),Math.min(V.y,b-q.x));if(X<0)continue;const Y=ve(X,2,5);let se=Math.max(0,V.x-Y),ce=Math.max(0,V.y-Y),he=Math.min(q.x+Y,b-1),be=Math.min(q.y+Y,b-1);for(let Fe=ce;Fe<=be;++Fe)for(let Ke=se;Ke<=he;++Ke)uy[Fe*b+Ke]=255;let Ee=0,Oe=0;for(let Fe=0;Fe<$.cellsY;++Fe)for(let Ke=0;Ke<$.cellsX;++Ke){if(!$.cells[Fe*$.cellsX+Ke])continue;const Qe=c.tileCoordToPixel($.min.x+Ke/$.xScale,$.min.y+Fe/$.yScale),nt=c.tileCoordToPixel($.min.x+(Ke+1)/$.xScale,$.min.y+(Fe+1)/$.yScale);for(let Et=Qe.y;Et<=Math.min(nt.y+1,b-1);++Et)for(let ft=Qe.x;ft<=Math.min(nt.x+1,b-1);++ft)uy[Et*b+ft]===255&&(uy[Et*b+ft]=0,Ee+=c.getElevationAtPixel(ft,Et),Oe++)}const Ue=Ee/Oe;se=Math.max(1,V.x-Y),ce=Math.max(1,V.y-Y),he=Math.min(q.x+Y,b-2),be=Math.min(q.y+Y,b-2),A=!0;for(let Fe=ce;Fe<=be;++Fe)for(let Ke=se;Ke<=he;++Ke)uy[Fe*b+Ke]===0&&(MN[Fe*b+Ke]=c._dem.set(Ke,Fe,Ue));for(let Fe=1;Fe<Y;++Fe){se=Math.max(1,V.x-Fe),ce=Math.max(1,V.y-Fe),he=Math.min(q.x+Fe,b-2),be=Math.min(q.y+Fe,b-2);for(let Ke=ce;Ke<=be;++Ke)for(let Qe=se;Qe<=he;++Qe){const nt=Ke*b+Qe;if(uy[nt]===255){let Et=0,ft=0,Tt=-1,It=-1;for(let Dt=-1;Dt<=1;++Dt)for(let Xt=-1;Xt<=1;++Xt){const Vt=(Ke+Dt)*b+Qe+Xt;if(uy[Vt]>=Fe)continue;const jt=MN[Vt],$t=Math.abs(jt);$t>ft&&(Et=jt,ft=$t,Tt=Xt,It=Dt)}if(ft>.1){const Dt=1-(Fe+.5*Math.abs(Tt*It))/Y;let Xt=c._dem.get(Qe,Ke)+Et*Dt;const Vt=c._dem.get(Qe+Tt,Ke+It),jt=c._dem.get(Qe-Tt,Ke-It,!0);(Xt-Vt)*(Xt-jt)>0&&(Xt=(Vt+jt)/2),MN[nt]=c._dem.set(Qe,Ke,Xt),uy[nt]=Fe}}}}}A&&(c._demTile.needsDEMTextureUpload=!0,c._dem._timestamp=Ys.now())}setFilter(a){this.filter=a?T_(a):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(a=>this.filter.filter(new Ri(this.id.overscaledZ,{worldview:this.worldview}),a.feature,this.id.canonical)):this.nodesInfo}destroy(){const a=this.getNodesInfo();for(const c of a)PA(c.node),sN(c.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(a,c){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const f=c.getReplacementRegionsForTile(a.toUnwrapped());for(const p of this.getNodesInfo()){const x=p.node.footprint;p.hiddenByReplacement=!!x&&!f.find(b=>b.footprint===x)}}getHeightAtTileCoord(a,c){const f=[],p=[0,0,0],x=j([]);for(const b of this.getNodesInfo()){const A=b.node.meshes[0],k=A.transformedAabb;if(a<k.min[0]||c<k.min[1]||a>k.max[0]||c>k.max[1])continue;if(b.node.hidden===!0)return{height:1/0,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};D(x,b.node.globalMatrix),p[0]=a,p[1]=c,Ut(p,p,x);const M=(p[0]-A.aabb.min[0])/(A.aabb.max[0]-A.aabb.min[0])*sy|0,$=Math.min(63,(p[1]-A.aabb.min[1])/(A.aabb.max[1]-A.aabb.min[1])*sy|0)*sy+Math.min(63,M),V=A.heightmap[$];if(!(V<0&&b.node.footprint))return b.hiddenByReplacement?void 0:{height:V,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};if(b.node.footprint.grid.query(new Mt(a,c),new Mt(a,c),f),f.length>0)return{height:void 0,maxHeight:b.feature.properties.height,hidden:b.hiddenByReplacement,verticalScale:b.evaluatedScale[2]}}}}function q1(u,a){return u instanceof Gg&&!u.isLightConstant&&a}function Rhe(u,a,c,f,p,x,b,A){let k=(61440&a|(61440&a)>>4)>>8,M=(3840&a|(3840&a)>>4)>>4,$=240&a|(240&a)>>4;c[3]>0&&(k=qr(k,255*c[0],c[3]),M=qr(M,255*c[1],c[3]),$=qr($,255*c[2],c[3]));const V=k<<8|M,q=$<<8|Math.floor(255*f[3]),X=function(Fe){const Ke=ve(Fe,0,2);return Math.min(Math.round(.5*Ke*255),255)}(f[2])<<8|15*f[0]<<4|15*f[1],Y=ve(p[0],0,1),se=ve(p[1],0,1),ce=ve(p[2],0,1),he=ve(p[3],0,1);let be,Ee,Oe,Ue;if(Y!==se&&b!==x&&se!==Y){const Fe=b-x;Ee=1/(Fe*(se-Y)),Oe=-(x+Fe*Y)/(Fe*(se-Y));const Ke=ve(p[4],-1,1);Ue=Math.pow(10,Ke),be=255*ce<<8|255*he}else be=65535,Ee=0,Oe=1,Ue=1;if(u.emplaceBack(V,q,X,be,Ee,Oe,Ue),A){const Fe=A.length;A.clear();for(let Ke=0;Ke<Fe;Ke++)A.emplaceBack(V,q,X,be,Ee,Oe,Ue)}}function jhe(u,a,c){const f=u.node;let p=0;const x=c&Z_.HasMeshoptCompression;for(const b of f.meshes){if(f.lights&&f.lightMeshIndex===p||!b.featureData)continue;b.featureArray=new Cp,b.featureArray.reserve(b.featureData.length);let A=a;for(const k of b.featureData){const M=x?65535&k:k>>16&65535,$=x?k>>16&65535:65535&k,V=(15&$)<8?15&$:0,q=u.evaluatedRMEA[V],X=u.evaluatedColor[V],Y=u.emissionHeightBasedParams[V];let se;if(A&&V===2&&f.lights&&(se=new Cp,se.resize(10*f.lights.length)),Rhe(b.featureArray,M,X,q,Y,b.aabb.min[2],b.aabb.max[2],se),se&&A){A=!1;const ce=f.meshes[f.lightMeshIndex];ce.featureArray=se,ce.featureArray._trim()}}b.featureArray._trim(),p++}}gr(GA,"Tiled3dModelBucket",{omit:["layers"]}),gr(f6,"Tiled3dModelFeature");const Nhe=["id","tile","layer","source","sourceLayer","state"];class dy{constructor(a,c,f,p,x){this.type="Feature",this._vectorTileFeature=a,this._z=c,this._x=f,this._y=p,this.properties=a?a.properties:{},this.id=x}clone(){const a=new dy(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(a.state=Object.assign({},this.state)),this.layer&&(a.layer=Object.assign({},this.layer)),this.source&&(a.source=this.source),this.sourceLayer&&(a.sourceLayer=this.sourceLayer),a}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const c of Nhe)this[c]!==void 0&&(a[c]=this[c]);return a}}class hy extends Bu{constructor(a,c,f,p){super(),this.id=a,this.type="model",this.models=[],this._loaded=!1,this._options=c,this._modelsInfo=new Map}load(){const a=[];for(const c in this._options.models){const f=this._options.models[c],p=this._modelsInfo.get(c);if(p){const x=p.model;x.position=f.position!=null?new Q(f.position[0],f.position[1]):new Q(0,0),x.orientation=f.orientation!=null?f.orientation:[0,0,0],p.modelSpec=f,hy.applyModelSpecification(x,f),x.computeBoundsAndApplyParent(),this.models.push(x)}else{const x=RU(this.map._requestManager.transformRequest(f.uri,zh.Model).url).then(b=>{if(!b)return;const A=cN(b),k=new LU(c,f.uri,f.position,f.orientation,A);hy.applyModelSpecification(k,f),k.computeBoundsAndApplyParent(),this.models.push(k),this._modelsInfo.set(c,{modelSpec:f,model:k})}).catch(b=>{this.fire(new Tg(new Error(`Could not load model ${c} from ${f.uri}: ${b.message}`)))});a.push(x)}}Promise.allSettled(a).then(()=>{this._loaded=!0,this.fire(new _l("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(c=>{this._loaded=!0,this.fire(new Tg(new Error(`Could not load models: ${c.message}`)))})}static applyModelSpecification(a,c){c.nodeOverrides&&hy.convertNodeOverrides(a,c.nodeOverrides),c.materialOverrides&&hy.convertMaterialOverrides(a,c.materialOverrides),c.nodeOverrideNames&&(a.nodeOverrideNames=[...c.nodeOverrideNames]),c.materialOverrideNames&&(a.materialOverrideNames=[...c.materialOverrideNames]),c.featureProperties&&(a.featureProperties=c.featureProperties)}static convertNodeOverrides(a,c){if(Array.isArray(c)&&c.every(f=>typeof f=="string")){a.nodeOverrideNames=[];for(const f of c)a.nodeOverrideNames.push(f)}else Object.entries(c).forEach(([f,p])=>{const x={orientation:[0,0,0]};if(p.hasOwnProperty("orientation")){const b=p.orientation;b&&(x.orientation=b)}a.nodeOverrides.set(f,x)})}static convertMaterialOverrides(a,c){if(Array.isArray(c)&&c.every(f=>typeof f=="string")){a.materialOverrideNames=[];for(const f of c)a.materialOverrideNames.push(f)}else Object.entries(c).forEach(([f,p])=>{const x={color:new ni(1,1,1),colorMix:0,emissionStrength:0,opacity:1},b=p["model-color"];b!==void 0&&(x.color.r=b[0],x.color.g=b[1],x.color.b=b[2]);const A=p["model-color-mix-intensity"];A!==void 0&&(x.colorMix=A);const k=p["model-emissive-strength"];k!==void 0&&(x.emissionStrength=k);const M=p["model-opacity"];M!==void 0&&(x.opacity=M),a.materialOverrides.set(f,x)})}onAdd(a){this.map=a,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(a,c){}serialize(){return this._options}setProperty(a,c){return!1}reload(){const a=Jh(this.id,this.scope);this.map.style.clearSource(a),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(a){this.models=[];const c=new Map;for(const f in a){const p=a[f];if(this._modelsInfo.has(f)){const x=this._modelsInfo.get(f);x&&x.modelSpec.uri===p.uri&&c.set(f,x)}}this._modelsInfo=c,this._options.models=a,this._loaded=!1,this.load()}}function DN(u,a,c,f){const p=1<<u.z;a.lat=Te((f/Jt+u.y)/p),a.lng=ke((c/Jt+u.x)/p)}function Mhe(u,a,c,f){const p=u.getNodesInfo()[a];if(!p||p.hiddenByReplacement||!p.node.meshes)return;let x=Number.MAX_VALUE;const b=p.node,A=c.tile,k=f.calculatePosMatrix(A.tileID.toUnwrapped(),f.worldSize),M=p.evaluatedScale;let $=0;f.elevation&&b.elevation&&($=b.elevation*f.elevation.exaggeration()),F(k,k,[(b.anchor?b.anchor[0]:0)*(M[0]-1),(b.anchor?b.anchor[1]:0)*(M[1]-1),$]),B(k,k,M);const V=c.queryGeometry,q=V.isPointQuery()?V.screenBounds:V.screenGeometry,X=function(se){const ce=R([],k,se.globalMatrix);R(ce,f.expandedFarZProjMatrix,ce);for(let he=0;he<se.meshes.length;++he){const be=se.meshes[he];if(he===se.lightMeshIndex)continue;const Ee=aN(q,f,ce,be.aabb);Ee!=null&&(x=Math.min(Ee,x))}if(se.children)for(const he of se.children)X(he)};if(X(b),x===Number.MAX_VALUE)return;const Y=new Q(0,0);return DN(A.tileID.canonical,Y,p.node.anchor[0],p.node.anchor[1]),{intersectionZ:x,position:Y,feature:p.feature}}const Dhe={circle:class extends ss{constructor(u,a,c,f){super(u,{layout:Yu||(Yu=new ua({"circle-sort-key":new lr(ht.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Wt(ht.layout_circle["circle-elevation-reference"]),visibility:new Wt(ht.layout_circle.visibility)})),paint:Ip||(Ip=new ua({"circle-radius":new lr(ht.paint_circle["circle-radius"]),"circle-color":new lr(ht.paint_circle["circle-color"]),"circle-blur":new lr(ht.paint_circle["circle-blur"]),"circle-opacity":new lr(ht.paint_circle["circle-opacity"]),"circle-translate":new Wt(ht.paint_circle["circle-translate"]),"circle-translate-anchor":new Wt(ht.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Wt(ht.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Wt(ht.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new lr(ht.paint_circle["circle-stroke-width"]),"circle-stroke-color":new lr(ht.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new lr(ht.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Wt(ht.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"})}))},a,c,f)}createBucket(u){return new Xi(u)}queryRadius(u){const a=u;return go("circle-radius",this,a)+go("circle-stroke-width",this,a)+sa(this.paint.get("circle-translate"))}queryIntersectsFeature(u,a,c,f,p,x,b,A){const k=kp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,u.pixelToTileUnitsFactor),M=this.paint.get("circle-radius").evaluate(a,c)+this.paint.get("circle-stroke-width").evaluate(a,c);return _$(u,f,x,b,A,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",k,M)}getProgramIds(){return["circle"]}getDefaultProgramParams(u,a,c){const f=v$(this);return{config:new Xu(this,{zoom:a,lut:c}),defines:f,overrideFog:!1}}is3D(u){return!u&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends ss{createBucket(u){return new b$(u)}constructor(u,a,c,f){super(u,{layout:w$||(w$=new ua({visibility:new Wt(ht.layout_heatmap.visibility)})),paint:S$||(S$=new ua({"heatmap-radius":new lr(ht.paint_heatmap["heatmap-radius"]),"heatmap-weight":new lr(ht.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Wt(ht.paint_heatmap["heatmap-intensity"]),"heatmap-color":new vp(ht.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Wt(ht.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"})}))},a,c,f),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=h1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(u){return go("heatmap-radius",this,u)}queryIntersectsFeature(u,a,c,f,p,x,b,A){const k=this.paint.get("heatmap-radius").evaluate(a,c);return _$(u,f,x,b,A,!0,!0,new Mt(0,0),k)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(u,a,c){return u==="heatmap"?{config:new Xu(this,{zoom:a,lut:c}),overrideFog:!1}:{}}},hillshade:class extends ss{constructor(u,a,c,f){super(u,{layout:E$||(E$=new ua({visibility:new Wt(ht.layout_hillshade.visibility)})),paint:T$||(T$=new ua({"hillshade-illumination-direction":new Wt(ht.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Wt(ht.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Wt(ht.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Wt(ht.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Wt(ht.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Wt(ht.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Wt(ht.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"})}))},a,c,f)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(u,a,c){return{overrideFog:!1}}},fill:class extends ss{constructor(u,a,c,f){super(u,{layout:B$||(B$=new ua({"fill-sort-key":new lr(ht.layout_fill["fill-sort-key"]),visibility:new Wt(ht.layout_fill.visibility),"fill-elevation-reference":new Wt(ht.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new lr(ht.layout_fill["fill-construct-bridge-guard-rail"])})),paint:$$||($$=new ua({"fill-antialias":new Wt(ht.paint_fill["fill-antialias"]),"fill-opacity":new lr(ht.paint_fill["fill-opacity"]),"fill-color":new lr(ht.paint_fill["fill-color"]),"fill-outline-color":new lr(ht.paint_fill["fill-outline-color"]),"fill-translate":new Wt(ht.paint_fill["fill-translate"]),"fill-translate-anchor":new Wt(ht.paint_fill["fill-translate-anchor"]),"fill-pattern":new lr(ht.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Wt(ht.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Wt(ht.paint_fill["fill-emissive-strength"]),"fill-z-offset":new lr(ht.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new lr(ht.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new lr(ht.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"})}))},a,c,f)}getProgramIds(){const u=this.paint.get("fill-pattern"),a=u&&u.constantOr(1),c=[a?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&c.push(a&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),c}getDefaultProgramParams(u,a,c){return{config:new Xu(this,{zoom:a,lut:c}),overrideFog:!1}}recalculate(u,a){super.recalculate(u,a);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new Uj(u)}queryRadius(){return sa(this.paint.get("fill-translate"))}queryIntersectsFeature(u,a,c,f,p,x){return!u.queryGeometry.isAboveHorizon&&da(Al(u.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,u.pixelToTileUnitsFactor),f)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(u){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const a=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return u!=null?a&&!u:a}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends ss{constructor(u,a,c,f){super(u,{layout:hU||(hU=new ua({visibility:new Wt(ht["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Wt(ht["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:fU||(fU=new ua({"fill-extrusion-opacity":new Wt(ht["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new lr(ht["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Wt(ht["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Wt(ht["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new lr(ht["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Wt(ht["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new lr(ht["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new lr(ht["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Wt(ht["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Wt(ht["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Wt(ht["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Wt(ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Wt(ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Wt(ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Wt(ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Wt(ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Wt(ht["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Wt(ht["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new lr(ht["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new lr(ht["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Wt(ht["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Wt(ht["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Wt(ht["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Wt(ht["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new lr(ht["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new lr(ht["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Wt(ht["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"})}))},a,c,f),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new yA(u)}queryRadius(){return sa(this.paint.get("fill-extrusion-translate"))}is3D(u){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(u,a,c,f,p,x,b,A,k){const M=kp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,u.pixelToTileUnitsFactor),$=this.paint.get("fill-extrusion-height").evaluate(a,c),V=this.paint.get("fill-extrusion-base").evaluate(a,c),q=[0,0],X=A&&x.elevation,Y=x.elevation?x.elevation.exaggeration():1,se=u.tile.getBucket(this);if(X&&se instanceof yA){const Oe=se.centroidVertexArray,Ue=k+1;Ue<Oe.length&&(q[0]=Oe.geta_centroid_pos0(Ue),q[1]=Oe.geta_centroid_pos1(Ue))}if(q[0]===0&&q[1]===1)return!1;x.projection.name==="globe"&&(f=dU([f],[new Mt(0,0),new Mt(Jt,Jt)],u.tileID.canonical).map(Oe=>Oe.polygon).flat());const ce=X?A:null,[he,be]=xU(x,f,V,$,M,b,ce,q,Y,x.center.lat,u.tileID.canonical),Ee=u.queryGeometry;return _U(he,be,Ee.isPointQuery()?Ee.screenBounds:Ee.screenGeometry)}},building:class extends ss{constructor(u,a,c,f){super(u,{layout:WU||(WU=new ua({visibility:new Wt(ht.layout_building.visibility),"building-facade":new lr(ht.layout_building["building-facade"]),"building-facade-floors":new lr(ht.layout_building["building-facade-floors"]),"building-facade-unit-width":new lr(ht.layout_building["building-facade-unit-width"]),"building-facade-window":new lr(ht.layout_building["building-facade-window"]),"building-roof-shape":new lr(ht.layout_building["building-roof-shape"]),"building-height":new lr(ht.layout_building["building-height"]),"building-base":new lr(ht.layout_building["building-base"]),"building-flood-light-wall-radius":new lr(ht.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new lr(ht.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new lr(ht.layout_building["building-flip-roof-orientation"])})),paint:GU||(GU=new ua({"building-opacity":new Wt(ht.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Wt(ht.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Wt(ht.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Wt(ht.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Wt(ht.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Wt(ht.paint_building["building-vertical-scale"]),"building-cast-shadows":new Wt(ht.paint_building["building-cast-shadows"]),"building-color":new lr(ht.paint_building["building-color"]),"building-emissive-strength":new lr(ht.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Wt(ht.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Wt(ht.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Wt(ht.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Wt(ht.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Wt(ht.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"})}))},a,c,f),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new qU(u)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(u){return!0}queryRadius(u){return 0}queryIntersectsFeature(u,a,c,f,p,x,b,A,k){let M=this.layout.get("building-height").evaluate(a,c);const $=this.layout.get("building-base").evaluate(a,c),V=u.tile.getBucket(this).getFootprint(a);if(V){if(V.hiddenFlags!==0)return!1;M=V.height}const[q,X]=xU(x,f,$,M,new Mt(0,0),b,null,[0,0],1,x.center.lat,u.tileID.canonical),Y=u.queryGeometry;return _U(q,X,Y.isPointQuery()?Y.screenBounds:Y.screenGeometry)}},line:class extends ss{constructor(u,a,c,f){const p=rV();super(u,p,a,c,f),p.layout&&(this.layout=new Yh(p.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(u){if(u==="line-gradient"){const a=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=a._styleExpression&&a._styleExpression.expression instanceof Bg,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(u,a){super.recalculate(u,a),this.paint._values["line-floorwidth"]=(()=>{if(O1)return O1;const c=rV();return O1=new Rde(c.paint.properties["line-width"].specification),O1.useIntegerZoom=!0,O1})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new dN(u)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(u,a,c){const f=eV(this);return{config:new Xu(this,{zoom:a,lut:c}),defines:f,overrideFog:!1}}queryRadius(u){const a=u,c=nV(go("line-width",this,a),go("line-gap-width",this,a)),f=go("line-offset",this,a);return c/2+Math.abs(f)+sa(this.paint.get("line-translate"))}queryIntersectsFeature(u,a,c,f,p,x){if(u.queryGeometry.isAboveHorizon)return!1;const b=Al(u.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,u.pixelToTileUnitsFactor),A=u.pixelToTileUnitsFactor/2*nV(this.paint.get("line-width").evaluate(a,c),this.paint.get("line-gap-width").evaluate(a,c)),k=this.paint.get("line-offset").evaluate(a,c);return k&&(f=function(M,$){const V=[],q=new Mt(0,0);for(let X=0;X<M.length;X++){const Y=M[X],se=[];for(let ce=0;ce<Y.length;ce++){const he=Y[ce],be=Y[ce+1],Ee=ce===0?q:he.sub(Y[ce-1])._unit()._perp(),Oe=ce===Y.length-1?q:be.sub(he)._unit()._perp(),Ue=Ee._add(Oe)._unit();Ue._mult(1/(Ue.x*Oe.x+Ue.y*Oe.y)),se.push(Ue._mult($)._add(he))}V.push(se)}return V}(f,k*u.pixelToTileUnitsFactor)),function(M,$,V){for(let q=0;q<$.length;q++){const X=$[q];if(M.length>=3){for(let Y=0;Y<X.length;Y++)if(mo(M,X[Y]))return!0}if(zs(M,X,V))return!0}return!1}(b,f,A)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(u){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:UA,background:class extends ss{constructor(u,a,c,f){super(u,{layout:GV||(GV=new ua({visibility:new Wt(ht.layout_background.visibility)})),paint:HV||(HV=new ua({"background-pitch-alignment":new Wt(ht.paint_background["background-pitch-alignment"]),"background-color":new Wt(ht.paint_background["background-color"]),"background-pattern":new Wt(ht.paint_background["background-pattern"]),"background-opacity":new Wt(ht.paint_background["background-opacity"]),"background-emissive-strength":new Wt(ht.paint_background["background-emissive-strength"]),"background-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"})}))},a,c,f)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(u,a,c){return{overrideFog:!1}}is3D(u){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:JV,"raster-particle":i6,sky:class extends ss{constructor(u,a,c,f){super(u,{layout:t6||(t6=new ua({visibility:new Wt(ht.layout_sky.visibility)})),paint:r6||(r6=new ua({"sky-type":new Wt(ht.paint_sky["sky-type"]),"sky-atmosphere-sun":new Wt(ht.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Wt(ht.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Wt(ht.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Wt(ht.paint_sky["sky-gradient-radius"]),"sky-gradient":new vp(ht.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Wt(ht.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Wt(ht.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Wt(ht.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"})}))},a,c,f),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(u){u==="sky-gradient"?this._updateColorRamp():u!=="sky-atmosphere-sun"&&u!=="sky-atmosphere-halo-color"&&u!=="sky-atmosphere-color"&&u!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=h1({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(u){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const a=u.style.light.properties.get("position");return this._lightPosition.azimuthal!==a.azimuthal||this._lightPosition.polar!==a.polar}return!1}getCenter(u,a){if(this.paint.get("sky-type")==="atmosphere"){const f=this.paint.get("sky-atmosphere-sun"),p=!f,x=u.style.light,b=x.properties.get("position");return p&&x.properties.get("anchor")==="viewport"&&Ir("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?RN(b.azimuthal,90-b.polar,a):RN(f[0],90-f[1],a)}const c=this.paint.get("sky-gradient-center");return RN(c[0],90-c[1],a)}isSky(){return!0}markSkyboxValid(u){this._skyboxInvalidated=!1,this._lightPosition=u.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const u=this.paint.get("sky-type");return u==="atmosphere"?["skyboxCapture","skybox"]:u==="gradient"?["skyboxGradient"]:null}},slot:class extends ss{constructor(u,a,c,f){super(u,{paint:n6||(n6=new ua({}))},a,null)}},model:class extends ss{constructor(u,a,c,f){super(u,{layout:l6||(l6=new ua({visibility:new Wt(ht.layout_model.visibility),"model-id":new lr(ht.layout_model["model-id"])})),paint:c6||(c6=new ua({"model-opacity":new lr(ht.paint_model["model-opacity"]),"model-rotation":new lr(ht.paint_model["model-rotation"]),"model-scale":new lr(ht.paint_model["model-scale"]),"model-translation":new lr(ht.paint_model["model-translation"]),"model-color":new lr(ht.paint_model["model-color"]),"model-color-mix-intensity":new lr(ht.paint_model["model-color-mix-intensity"]),"model-type":new Wt(ht.paint_model["model-type"]),"model-cast-shadows":new Wt(ht.paint_model["model-cast-shadows"]),"model-receive-shadows":new Wt(ht.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Wt(ht.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new lr(ht.paint_model["model-emissive-strength"]),"model-roughness":new lr(ht.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new lr(ht.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Wt(ht.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Wt(ht.paint_model["model-front-cutoff"]),"model-elevation-reference":new Wt(ht.paint_model["model-elevation-reference"]),"model-color-use-theme":new lr({type:"string",default:"default","property-type":"data-driven"})}))},a,c,f),this.layer=u,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new NN(u)}getProgramIds(){return["model"]}is3D(u){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(u){return u instanceof GA?Jt-1:0}queryRenderedFeatures(u,a,c){const f=a.getSource();if(!(f&&f instanceof hy))return{};const p=f,x={};x[this.id]=[];const b=x[this.id];let A=0;for(const k of p.models){const M=a.getFeatureState(this.sourceLayer,k.id),$={type:"Unknown",id:k.id,properties:k.featureProperties},V=this.paint.get("model-rotation").evaluate($,M),q=this.paint.get("model-scale").evaluate($,M),X=this.paint.get("model-translation").evaluate($,M),Y=this.paint.get("model-elevation-reference");let se=[];AA(se,k,c,k.position,V,q,X,Y==="ground",Y==="ground",!1),c.projection.name==="globe"&&(se=TA(se,c));const ce=R([],c.projMatrix,se),he=aN(u.isPointQuery()?u.screenBounds:u.screenGeometry,c,ce,k.aabb);if(he!=null){const be=new dy(void 0,0,0,0,k.id);be.layer=this.layer,be.properties=structuredClone(k.featureProperties),be.properties.layer=this.id,be.properties.uri=k.uri,be.properties.orientation=k.orientation,be.sourceLayer=this.sourceLayer,be.geometry={type:"Point",coordinates:[k.position.lng,k.position.lat]},be.state=M,be.source=this.source,b.push({featureIndex:A,feature:be,intersectionZ:he})}++A}return x}queryIntersectsFeature(u,a,c,f,p,x){if(!this.modelManager)return!1;const b=this.modelManager,A=u.tile.getBucket(this);if(!(A&&A instanceof NN))return!1;for(const k in A.instancesPerModel){const M=A.instancesPerModel[k],$=a.id!==void 0?a.id:a.properties&&a.properties.hasOwnProperty("id")?a.properties.id:void 0;if(M.idToFeaturesIndex.hasOwnProperty($)){const V=M.features[M.idToFeaturesIndex[$]],q=b.getModel(k,this.scope);if(!q)return!1;let X=[];const Y=new Q(0,0),se=A.canonical;let ce=Number.MAX_VALUE;for(let he=0;he<V.instancedDataCount;++he){const be=16*(V.instancedDataOffset+he),Ee=M.instancedDataArray.float32,Oe=[Ee[be+4],Ee[be+5],Ee[be+6]];DN(se,Y,Math.floor(Ee[be]),Math.floor(Ee[be+1])),AA(X,q,x,Y,V.rotation,V.scale,Oe,!1,!1,!1),x.projection.name==="globe"&&(X=TA(X,x));const Ue=R([],x.projMatrix,X),Fe=u.queryGeometry,Ke=aN(Fe.isPointQuery()?Fe.screenBounds:Fe.screenGeometry,x,Ue,q.aabb);Ke!=null&&(ce=Math.min(Ke,ce))}return ce!==Number.MAX_VALUE&&ce}}return!1}_handleOverridablePaintPropertyUpdate(u,a,c){return!(!this.layout||a.isDataDriven()||c.isDataDriven()||u!=="model-color"&&u!=="model-color-mix-intensity"&&u!=="model-rotation"&&u!=="model-scale"&&u!=="model-translation"&&u!=="model-emissive-strength")}_isPropertyZoomDependent(u){const a=this._transitionablePaint._values[u];return a!=null&&a.value!=null&&a.value.expression!=null&&a.value.expression instanceof Vd}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends ss{constructor(u,a,c,f){super(u,{layout:U$||(U$=new ua({"clip-layer-types":new Wt(ht.layout_clip["clip-layer-types"]),"clip-layer-scope":new Wt(ht.layout_clip["clip-layer-scope"])})),paint:V$||(V$=new ua({}))},a,c,f)}recalculate(u,a){super.recalculate(u,a)}createBucket(u){return new q$(u)}is3D(u){return!0}}},LN=new ni(0,0,0),FN={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},zN={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},HA={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},Lhe={PAINT_ORDER_FILL_AND_STROKE:1},W1={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},p6={MASK_TYPE_LUMINANCE:1};function Fhe(u,a,c){u===1&&a.icons.push(function(f,p){return function(x){if(x.usvg_tree.height||(x.usvg_tree.height=x.usvg_tree.width),!x.metadata)return x;const{metadata:b}=x;if(b.content_area){const{content_area:A}=b;A.left==null&&(A.left=0),A.top==null&&(A.top=A.left),A.width==null&&(A.width=x.usvg_tree.width),A.height==null&&(A.height=A.width)}if(b.text_placeholder){const{text_placeholder:A}=b;A.top==null&&(A.top=A.left),A.height==null&&(A.height=A.width)}return b.stretch_x&&b.stretch_x.length&&m6(b,"x"),b.stretch_y&&b.stretch_y.length&&m6(b,"y"),x}(f.readFields(zhe,{name:void 0},p))}(c,c.readVarint()+c.pos))}function m6(u,a){const c=[],f=u[`stretch_${a}`];let p=null;for(let x=0;x<f.length;x++)p===null?p=c.length===0?f[0]:c[c.length-1][1]+f[x]:(c.push([p,p+f[x]]),p=null);u[`stretch_${a}_areas`]=c}function zhe(u,a,c){u===1?a.name=c.readString():u===2?a.metadata=function(f,p){return f.readFields(Bhe,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},p)}(c,c.readVarint()+c.pos):u===3&&(a.usvg_tree=function(f,p){return f.readFields(Vhe,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},p)}(c,c.readVarint()+c.pos),a.data="usvg_tree")}function Bhe(u,a,c){u===1?a.stretch_x=c.readPackedVarint():u===2?a.stretch_y=c.readPackedVarint():u===3?a.content_area=g6(c,c.readVarint()+c.pos):u===4?a.variables.push(function(f,p){return f.readFields(Uhe,{name:void 0},p)}(c,c.readVarint()+c.pos)):u===5&&(a.text_placeholder=g6(c,c.readVarint()+c.pos))}function g6(u,a){return u.readFields($he,{},a)}function $he(u,a,c){u===1?a.left=c.readVarint():u===2?a.width=c.readVarint():u===3?a.top=c.readVarint():u===4&&(a.height=c.readVarint())}function Uhe(u,a,c){u===1?a.name=c.readString():u===2&&(a.rgb_color=XA(c.readVarint()),a.value="rgb_color")}function Vhe(u,a,c){u===1?a.width=a.height=c.readVarint():u===2?a.height=c.readVarint():u===3?a.children.push(KA(c,c.readVarint()+c.pos)):u===4?a.linear_gradients.push(function(f,p){return f.readFields(Xhe,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},p)}(c,c.readVarint()+c.pos)):u===5?a.radial_gradients.push(function(f,p){return f.readFields(Jhe,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},p)}(c,c.readVarint()+c.pos)):u===7?a.clip_paths.push(function(f,p){return f.readFields(Qhe,{children:[]},p)}(c,c.readVarint()+c.pos)):u===8&&a.masks.push(function(f,p){const x=f.readFields(efe,{left:0,width:20,mask_type:p6.MASK_TYPE_LUMINANCE,children:[]},p);return x.height==null&&(x.height=x.width),x.top==null&&(x.top=x.left),x}(c,c.readVarint()+c.pos))}function KA(u,a){return u.readFields(qhe,{},a)}function qhe(u,a,c){u===1?(a.group=function(f,p){return f.readFields(Whe,{opacity:255,children:[]},p)}(c,c.readVarint()+c.pos),a.node="group"):u===2&&(a.path=function(f,p){return f.readFields(Hhe,{paint_order:1,commands:[],step:1,diffs:[],rule:FN.PATH_RULE_NON_ZERO},p)}(c,c.readVarint()+c.pos),a.node="path")}function Whe(u,a,c){u===1?a.transform=ZA(c,c.readVarint()+c.pos):u===2?a.opacity=c.readVarint():u===5?a.clip_path_idx=c.readVarint():u===6?a.mask_idx=c.readVarint():u===7&&a.children.push(KA(c,c.readVarint()+c.pos))}function ZA(u,a){return u.readFields(Ghe,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},a)}function Ghe(u,a,c){u===1?a.sx=c.readFloat():u===2?a.ky=c.readFloat():u===3?a.kx=c.readFloat():u===4?a.sy=c.readFloat():u===5?a.tx=c.readFloat():u===6&&(a.ty=c.readFloat())}function Hhe(u,a,c){u===1?a.fill=function(f,p){return f.readFields(Khe,{rgb_color:LN,paint:"rgb_color",opacity:255},p)}(c,c.readVarint()+c.pos):u===2?a.stroke=function(f,p){return f.readFields(Zhe,{rgb_color:LN,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},p)}(c,c.readVarint()+c.pos):u===3?a.paint_order=c.readVarint():u===5?c.readPackedVarint(a.commands):u===6?a.step=c.readFloat():u===7?c.readPackedSVarint(a.diffs):u===8&&(a.rule=c.readVarint())}function Khe(u,a,c){u===1?(a.rgb_color=XA(c.readVarint()),a.paint="rgb_color"):u===2?(a.linear_gradient_idx=c.readVarint(),a.paint="linear_gradient_idx"):u===3?(a.radial_gradient_idx=c.readVarint(),a.paint="radial_gradient_idx"):u===5&&(a.opacity=c.readVarint())}function XA(u){return new ni((u>>16&255)/255,(u>>8&255)/255,(255&u)/255,1)}function Zhe(u,a,c){u===1?(a.rgb_color=XA(c.readVarint()),a.paint="rgb_color"):u===2?(a.linear_gradient_idx=c.readVarint(),a.paint="linear_gradient_idx"):u===3?(a.radial_gradient_idx=c.readVarint(),a.paint="radial_gradient_idx"):u===5?c.readPackedFloat(a.dasharray):u===6?a.dashoffset=c.readFloat():u===7?a.miterlimit=c.readFloat():u===8?a.opacity=c.readVarint():u===9?a.width=c.readFloat():u===10?a.linecap=c.readVarint():u===11&&(a.linejoin=c.readVarint())}function Xhe(u,a,c){u===1?a.transform=ZA(c,c.readVarint()+c.pos):u===2?a.spread_method=c.readVarint():u===3?a.stops.push(y6(c,c.readVarint()+c.pos)):u===4?a.x1=c.readFloat():u===5?a.y1=c.readFloat():u===6?a.x2=c.readFloat():u===7&&(a.y2=c.readFloat())}function y6(u,a){return u.readFields(Yhe,{offset:0,opacity:255,rgb_color:LN},a)}function Yhe(u,a,c){u===1?a.offset=c.readFloat():u===2?a.opacity=c.readVarint():u===3&&(a.rgb_color=XA(c.readVarint()))}function Jhe(u,a,c){u===1?a.transform=ZA(c,c.readVarint()+c.pos):u===2?a.spread_method=c.readVarint():u===3?a.stops.push(y6(c,c.readVarint()+c.pos)):u===4?a.cx=c.readFloat():u===5?a.cy=c.readFloat():u===6?a.r=c.readFloat():u===7?a.fx=c.readFloat():u===8?a.fy=c.readFloat():u===9&&(a.fr=c.readFloat())}function Qhe(u,a,c){u===1?a.transform=ZA(c,c.readVarint()+c.pos):u===2?a.clip_path_idx=c.readVarint():u===3&&a.children.push(KA(c,c.readVarint()+c.pos))}function efe(u,a,c){u===1?a.left=a.top=c.readFloat():u===2?a.width=a.height=c.readFloat():u===3?a.top=c.readFloat():u===4?a.height=c.readFloat():u===5?a.mask_type=c.readVarint():u===6?a.mask_idx=c.readVarint():u===7&&a.children.push(KA(c,c.readVarint()+c.pos))}class tfe{static calculate(a={},c=[]){const f=new Map,p=new Map;if(Object.keys(a).length===0)return f;c.forEach(x=>{p.set(x.name,x.rgb_color||new ni(0,0,0))});for(const[x,b]of Object.entries(a))p.has(x)?f.set(p.get(x).toString(),b):console.warn(`Ignoring unknown image variable "${x}"`);return f}}function ax(u,a=255,c){const f=a/255,p=u.toString(),x=c.has(p)?c.get(p).clone():u.clone();return x.a*=f,x.toString()}function G1(u,a){if(!Xs()){const c=document.createElement("canvas");return c.width=u,c.height=a,c}return new OffscreenCanvas(u,a)}function rfe(u,a){const c=tfe.calculate(a.params,u.metadata?u.metadata.variables:[]),f=u.usvg_tree,p=f.width,x=f.height,b=a.transform?a.transform:new DOMMatrix,A=Math.max(1,Math.round(p*b.a)),k=Math.max(1,Math.round(x*b.d)),M=new DOMMatrix([A/p,0,0,k/x,0,0]),$=G1(A,k).getContext("2d");return BN($,M,f,f,c),$.getImageData(0,0,A,k)}function BN(u,a,c,f,p){for(const x of f.children)v6(u,a,c,x,p)}function v6(u,a,c,f,p){f.group?(u.save(),function(x,b,A,k,M){const $=k.mask_idx!=null?A.masks[k.mask_idx]:null,V=k.clip_path_idx!=null?A.clip_paths[k.clip_path_idx]:null;if(k.transform&&(b=ox(k.transform).preMultiplySelf(b)),!function(Y,se,ce){return Y.opacity!==255||se||ce}(k,V!=null,$!=null))return void BN(x,b,A,k,M);const q=G1(x.canvas.width,x.canvas.height),X=q.getContext("2d");BN(X,b,A,k,M),V&&T6(X,b,A,V),$&&A6(X,b,A,$,M),x.globalAlpha=k.opacity/255,x.drawImage(q,0,0)}(u,a,c,f.group,p),u.restore()):f.path&&(u.save(),function(x,b,A,k,M){x.setTransform(b),k.paint_order===Lhe.PAINT_ORDER_FILL_AND_STROKE?(_6(x,A,k,M),b6(x,A,k,M)):(b6(x,A,k,M),_6(x,A,k,M))}(u,a,c,f.path,p),u.restore())}function _6(u,a,c,f){const p=c.fill;if(!p)return;const x=p.opacity/255;switch(u.save(),u.beginPath(),P6(c,u),p.paint){case"rgb_color":u.fillStyle=ax(p.rgb_color,p.opacity,f);break;case"linear_gradient_idx":{const b=a.linear_gradients[p.linear_gradient_idx];b.transform&&u.setTransform(ox(b.transform).preMultiplySelf(u.getTransform())),u.fillStyle=w6(u,b,x,f);break}case"radial_gradient_idx":{const b=a.radial_gradients[p.radial_gradient_idx];b.transform&&u.setTransform(ox(b.transform).preMultiplySelf(u.getTransform())),u.fillStyle=S6(u,b,x,f)}}u.fill(x6(c)),u.restore()}function x6(u){return u.rule===FN.PATH_RULE_NON_ZERO?"nonzero":u.rule===FN.PATH_RULE_EVEN_ODD?"evenodd":void 0}function b6(u,a,c,f){const p=c.stroke;if(!p)return;const x=C6(c);u.lineWidth=p.width,u.miterLimit=p.miterlimit,u.setLineDash(p.dasharray),u.lineDashOffset=p.dashoffset;const b=p.opacity/255;switch(p.paint){case"rgb_color":u.strokeStyle=ax(p.rgb_color,p.opacity,f);break;case"linear_gradient_idx":u.strokeStyle=w6(u,a.linear_gradients[p.linear_gradient_idx],b,f,!0);break;case"radial_gradient_idx":u.strokeStyle=S6(u,a.radial_gradients[p.radial_gradient_idx],b,f,!0)}switch(p.linejoin){case HA.LINE_JOIN_MITER_CLIP:case HA.LINE_JOIN_MITER:u.lineJoin="miter";break;case HA.LINE_JOIN_ROUND:u.lineJoin="round";break;case HA.LINE_JOIN_BEVEL:u.lineJoin="bevel"}switch(p.linecap){case zN.LINE_CAP_BUTT:u.lineCap="butt";break;case zN.LINE_CAP_ROUND:u.lineCap="round";break;case zN.LINE_CAP_SQUARE:u.lineCap="square"}u.stroke(x)}function w6(u,a,c,f,p=!1){if(a.stops.length===1){const q=a.stops[0];return ax(q.rgb_color,q.opacity*c,f)}const{x1:x,y1:b,x2:A,y2:k}=a;let M=new DOMPoint(x,b),$=new DOMPoint(A,k);if(p){const q=ox(a.transform);M=q.transformPoint(M),$=q.transformPoint($)}const V=u.createLinearGradient(M.x,M.y,$.x,$.y);for(const q of a.stops)V.addColorStop(q.offset,ax(q.rgb_color,q.opacity*c,f));return V}function S6(u,a,c,f,p=!1){if(a.stops.length===1){const he=a.stops[0];return ax(he.rgb_color,he.opacity*c,f)}const x=ox(a.transform),{fx:b,fy:A,fr:k,cx:M,cy:$,r:V}=a;let q=new DOMPoint(b,A),X=new DOMPoint(M,$),Y=k,se=V;if(p){q=x.transformPoint(q),X=x.transformPoint(X);const he=(x.a+x.d)/2;Y=k*he,se=a.r*he}const ce=u.createRadialGradient(q.x,q.y,Y,X.x,X.y,se);for(const he of a.stops)ce.addColorStop(he.offset,ax(he.rgb_color,he.opacity*c,f));return ce}function E6(u,a,c,f){const p=f.transform?ox(f.transform).preMultiplySelf(a):a,x=G1(u.canvas.width,u.canvas.height),b=x.getContext("2d");for(const k of f.children)if(k.group)E6(b,p,c,k.group);else if(k.path){const M=k.path,$=new Path2D;$.addPath(C6(M),p),b.fill($,x6(M))}const A=f.clip_path_idx!=null?c.clip_paths[f.clip_path_idx]:null;A&&T6(b,p,c,A),u.globalCompositeOperation="source-over",u.drawImage(x,0,0)}function T6(u,a,c,f){const p=G1(u.canvas.width,u.canvas.height);E6(p.getContext("2d"),a,c,f),u.globalCompositeOperation="destination-in",u.drawImage(p,0,0)}function A6(u,a,c,f,p){if(f.children.length===0)return;const x=f.mask_idx!=null?c.masks[f.mask_idx]:null;x&&A6(u,a,c,x,p);const b=u.canvas.width,A=u.canvas.height,k=G1(b,A),M=k.getContext("2d"),$=f.width,V=f.height,q=f.left,X=f.top,Y=new Path2D,se=new Path2D;se.rect(q,X,$,V),Y.addPath(se,a),M.clip(Y);for(const be of f.children)v6(M,a,c,be,p);const ce=M.getImageData(0,0,b,A),he=ce.data;if(f.mask_type===p6.MASK_TYPE_LUMINANCE)for(let be=0;be<he.length;be+=4)he[be+3]=he[be+3]/255*(.2126*he[be]+.7152*he[be+1]+.0722*he[be+2]);M.putImageData(ce,0,0),u.globalCompositeOperation="destination-in",u.drawImage(k,0,0)}function ox(u){return u?new DOMMatrix([u.sx,u.ky,u.kx,u.sy,u.tx,u.ty]):new DOMMatrix}function P6(u,a){const c=u.step;let f=u.diffs[0]*c,p=u.diffs[1]*c;a.moveTo(f,p);for(let x=0,b=2;x<u.commands.length;x++)switch(u.commands[x]){case W1.PATH_COMMAND_MOVE:f+=u.diffs[b++]*c,p+=u.diffs[b++]*c,a.moveTo(f,p);break;case W1.PATH_COMMAND_LINE:f+=u.diffs[b++]*c,p+=u.diffs[b++]*c,a.lineTo(f,p);break;case W1.PATH_COMMAND_QUAD:{const A=f+u.diffs[b++]*c,k=p+u.diffs[b++]*c;f=A+u.diffs[b++]*c,p=k+u.diffs[b++]*c,a.quadraticCurveTo(A,k,f,p);break}case W1.PATH_COMMAND_CUBIC:{const A=f+u.diffs[b++]*c,k=p+u.diffs[b++]*c,M=A+u.diffs[b++]*c,$=k+u.diffs[b++]*c;f=M+u.diffs[b++]*c,p=$+u.diffs[b++]*c,a.bezierCurveTo(A,k,M,$,f,p);break}case W1.PATH_COMMAND_CLOSE:a.closePath()}return a}function C6(u){return P6(u,new Path2D)}class YA{constructor(a){this.capacity=a,this.cache=new Map}get(a){if(!this.cache.has(a))return;const c=this.cache.get(a);return this.cache.delete(a),this.cache.set(a,c),c}put(a,c){this.cache.has(a)?this.cache.delete(a):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(a,c)}delete(a){this.cache.delete(a)}}gr(YA,"LRUCache");class $N{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(a){return new Go(a,a.data)}getFromCache(a,c,f){return this.cacheMap.has(f)||this.cacheMap.set(f,new YA(150)),this.cacheMap.get(f).get(Jh(a.toString(),c))}setInCache(a,c,f,p){this.cacheDependenciesMap.has(p)||this.cacheDependenciesMap.set(p,new Map),this.cacheMap.has(p)||this.cacheMap.set(p,new YA(150));const x=this.cacheDependenciesMap.get(p),b=Jh(a.id.toString(),f);x.get(b)||x.set(b,new Set);const A=this.cacheMap.get(p),k=a.toString();x.get(b).add(k),A.put(Jh(a.toString(),f),c)}removeImagesFromCacheByIds(a,c,f=0){if(!this.cacheMap.has(f)||!this.cacheDependenciesMap.has(f))return;const p=this.cacheMap.get(f),x=this.cacheDependenciesMap.get(f);for(const b of a){const A=Jh(b.toString(),c);if(x.has(A)){for(const k of x.get(A))p.delete(k);x.delete(A)}}}rasterize(a,c,f,p,x=rfe){const b=this.getFromCache(a,f,p);if(b)return b.clone();const A=x(c.icon,a.options),k=$N._getImage(A);return this.setInCache(a,k,f,p),k.clone()}}class O6{constructor(a){this.size=a,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(a,c){const f=this.toIdx(a,c);return{min:this.minimums[f],max:this.maximums[f]}}isLeaf(a,c){return this.leaves[this.toIdx(a,c)]}toIdx(a,c){return c*this.size+a}}function k6(u,a,c,f){let p=0,x=Number.MAX_VALUE;for(let b=0;b<3;b++)if(Math.abs(f[b])<1e-15){if(c[b]<u[b]||c[b]>a[b])return null}else{const A=1/f[b];let k=(u[b]-c[b])*A,M=(a[b]-c[b])*A;if(k>M){const $=k;k=M,M=$}if(k>p&&(p=k),M<x&&(x=M),p>x)return null}return p}function I6(u,a,c,f,p,x,b,A,k,M,$){const V=f-u,q=p-a,X=x-c,Y=b-u,se=A-a,ce=k-c,he=$[1]*ce-$[2]*se,be=$[2]*Y-$[0]*ce,Ee=$[0]*se-$[1]*Y,Oe=V*he+q*be+X*Ee;if(Math.abs(Oe)<1e-15)return null;const Ue=1/Oe,Fe=M[0]-u,Ke=M[1]-a,Qe=M[2]-c,nt=(Fe*he+Ke*be+Qe*Ee)*Ue;if(nt<0||nt>1)return null;const Et=Ke*X-Qe*q,ft=Qe*V-Fe*X,Tt=Fe*q-Ke*V,It=($[0]*Et+$[1]*ft+$[2]*Tt)*Ue;return It<0||nt+It>1?null:(Y*Et+se*ft+ce*Tt)*Ue}function R6(u,a,c){return(u-a)/(c-a)}function j6(u,a,c,f,p,x,b,A,k){const M=1<<c,$=x-f,V=b-p,q=(u+1)/M*$+f,X=(a+0)/M*V+p,Y=(a+1)/M*V+p;A[0]=(u+0)/M*$+f,A[1]=X,k[0]=q,k[1]=Y}class N6{constructor(a){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=a,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const c=function(x){const b=Math.ceil(Math.log2(x.dim/8)),A=[];let k=Math.ceil(Math.pow(2,b));const M=1/k,$=(X,Y,se,ce,he)=>{const be=ce?1:0,Ee=(X+1)*se-be,Oe=Y*se,Ue=(Y+1)*se-be;he[0]=X*se,he[1]=Oe,he[2]=Ee,he[3]=Ue};let V=new O6(k);const q=[];for(let X=0;X<k*k;X++){$(X%k,Math.floor(X/k),M,!1,q);const Y=Fp(q[0],q[1],x),se=Fp(q[2],q[1],x),ce=Fp(q[2],q[3],x),he=Fp(q[0],q[3],x);V.minimums.push(Math.min(Y,se,ce,he)),V.maximums.push(Math.max(Y,se,ce,he)),V.leaves.push(1)}for(A.push(V),k/=2;k>=1;k/=2){const X=A[A.length-1];V=new O6(k);for(let Y=0;Y<k*k;Y++){$(Y%k,Math.floor(Y/k),2,!0,q);const se=X.getElevation(q[0],q[1]),ce=X.getElevation(q[2],q[1]),he=X.getElevation(q[2],q[3]),be=X.getElevation(q[0],q[3]),Ee=X.isLeaf(q[0],q[1]),Oe=X.isLeaf(q[2],q[1]),Ue=X.isLeaf(q[2],q[3]),Fe=X.isLeaf(q[0],q[3]),Ke=Math.min(se.min,ce.min,he.min,be.min),Qe=Math.max(se.max,ce.max,he.max,be.max),nt=Ee&&Oe&&Ue&&Fe;V.maximums.push(Qe),V.minimums.push(Ke),V.leaves.push(Qe-Ke<=5&&nt?1:0)}A.push(V)}return A}(this.dem),f=c.length-1,p=c[f];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(c,0,0,f,0)}raycastRoot(a,c,f,p,x,b,A=1){return k6([a,c,-100],[f,p,this.maximums[0]*A],x,b)}raycast(a,c,f,p,x,b,A=1){if(!this.nodeCount)return null;const k=this.raycastRoot(a,c,f,p,x,b,A);if(k==null)return null;const M=[],$=[],V=[],q=[],X=[{idx:0,t:k,nodex:0,nodey:0,depth:0}];for(;X.length>0;){const{idx:Y,t:se,nodex:ce,nodey:he,depth:be}=X.pop();if(this.leaves[Y]){j6(ce,he,be,a,c,f,p,V,q);const Oe=1<<be,Ue=(ce+0)/Oe,Fe=(ce+1)/Oe,Ke=(he+0)/Oe,Qe=(he+1)/Oe,nt=Fp(Ue,Ke,this.dem)*A,Et=Fp(Fe,Ke,this.dem)*A,ft=Fp(Fe,Qe,this.dem)*A,Tt=Fp(Ue,Qe,this.dem)*A,It=I6(V[0],V[1],nt,q[0],V[1],Et,q[0],q[1],ft,x,b),Dt=I6(q[0],q[1],ft,V[0],q[1],Tt,V[0],V[1],nt,x,b),Xt=Math.min(It!==null?It:Number.MAX_VALUE,Dt!==null?Dt:Number.MAX_VALUE);if(Xt!==Number.MAX_VALUE)return Xt;{const Vt=tt([],x,b,se);if(M6(nt,Et,Tt,ft,R6(Vt[0],V[0],q[0]),R6(Vt[1],V[1],q[1]))>=Vt[2])return se}continue}let Ee=0;for(let Oe=0;Oe<this._siblingOffset.length;Oe++){j6((ce<<1)+this._siblingOffset[Oe][0],(he<<1)+this._siblingOffset[Oe][1],be+1,a,c,f,p,V,q),V[2]=-100,q[2]=this.maximums[this.childOffsets[Y]+Oe]*A;const Ue=k6(V,q,x,b);if(Ue!=null){const Fe=Ue;M[Oe]=Fe;let Ke=!1;for(let Qe=0;Qe<Ee&&!Ke;Qe++)Fe>=M[$[Qe]]&&($.splice(Qe,0,Oe),Ke=!0);Ke||($[Ee]=Oe),Ee++}}for(let Oe=0;Oe<Ee;Oe++){const Ue=$[Oe];X.push({idx:this.childOffsets[Y]+Ue,t:M[Ue],nodex:(ce<<1)+this._siblingOffset[Ue][0],nodey:(he<<1)+this._siblingOffset[Ue][1],depth:be+1})}}return null}_addNode(a,c,f){return this.minimums.push(a),this.maximums.push(c),this.leaves.push(f),this.childOffsets.push(0),this.nodeCount++}_construct(a,c,f,p,x){if(a[p].isLeaf(c,f)===1)return;this.childOffsets[x]||(this.childOffsets[x]=this.nodeCount);const b=p-1,A=a[b];let k=0,M=0;for(let $=0;$<this._siblingOffset.length;$++){const V=2*c+this._siblingOffset[$][0],q=2*f+this._siblingOffset[$][1],X=A.getElevation(V,q),Y=A.isLeaf(V,q),se=this._addNode(X.min,X.max,Y);Y&&(k|=1<<$),M||(M=se)}for(let $=0;$<this._siblingOffset.length;$++)k&1<<$||this._construct(a,2*c+this._siblingOffset[$][0],2*f+this._siblingOffset[$][1],b,M+$)}}function M6(u,a,c,f,p,x){return qr(qr(u,c,x),qr(a,f,x),p)}function Fp(u,a,c){const f=c.dim,p=ve(u*f-.5,0,f-1),x=ve(a*f-.5,0,f-1),b=Math.floor(p),A=Math.floor(x),k=Math.min(b+1,f-1),M=Math.min(A+1,f-1);return M6(c.get(b,A),c.get(k,A),c.get(b,M),c.get(k,M),p-b,x-A)}const nfe={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function ife(u,a,c){return(256*u*256+256*a+c)/10-1e4}function afe(u,a,c){return 256*u+a+c/256-32768}class JA{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(a,c,f,p=!1){if(this.uid=a,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(f&&f!=="mapbox"&&f!=="terrarium")return void Ir(`"${f}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=c.height;const x=this.dim=c.height-2,b=new Uint32Array(c.data.buffer);if(this.pixels=new Uint8Array(c.data.buffer),this.floatView=new Float32Array(c.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let k=0;k<x;k++)b[this._idx(-1,k)]=b[this._idx(0,k)],b[this._idx(x,k)]=b[this._idx(x-1,k)],b[this._idx(k,-1)]=b[this._idx(k,0)],b[this._idx(k,x)]=b[this._idx(k,x-1)];b[this._idx(-1,-1)]=b[this._idx(0,0)],b[this._idx(x,-1)]=b[this._idx(x-1,0)],b[this._idx(-1,x)]=b[this._idx(0,x-1)],b[this._idx(x,x)]=b[this._idx(x-1,x-1)]}const A=f==="terrarium"?afe:ife;for(let k=0;k<b.length;++k){const M=4*k;this.floatView[k]=A(this.pixels[M],this.pixels[M+1],this.pixels[M+2])}this._timestamp=Ys.now()}_buildQuadTree(){this._tree=new N6(this)}get(a,c,f=!1){f&&(a=ve(a,-1,this.dim),c=ve(c,-1,this.dim));const p=this._idx(a,c);return this.floatView[p]}set(a,c,f){const p=this._idx(a,c),x=this.floatView[p];return this.floatView[p]=f,f-x}static getUnpackVector(a){return nfe[a]}_idx(a,c){if(a<-1||a>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(a+1)}static pack(a,c){const f=[0,0,0,0],p=JA.getUnpackVector(c);let x=Math.floor((a+p[3])/p[2]);return f[2]=x%256,x=Math.floor(x/256),f[1]=x%256,x=Math.floor(x/256),f[0]=x,f}getPixels(){return new C$({width:this.stride,height:this.stride},this.pixels)}backfillBorder(a,c,f){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let p=c*this.dim,x=c*this.dim+this.dim,b=f*this.dim,A=f*this.dim+this.dim;switch(c){case-1:p=x-1;break;case 1:x=p+1}switch(f){case-1:b=A-1;break;case 1:A=b+1}const k=-c*this.dim,M=-f*this.dim;for(let $=b;$<A;$++)for(let V=p;V<x;V++){const q=4*this._idx(V,$),X=4*this._idx(V+k,$+M);this.pixels[q+0]=a.pixels[X+0],this.pixels[q+1]=a.pixels[X+1],this.pixels[q+2]=a.pixels[X+2],this.pixels[q+3]=a.pixels[X+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function ofe(u,a,c){u===1?a.headerLength=c.readFixed32():u===2?a.x=c.readVarint():u===3?a.y=c.readVarint():u===4?a.z=c.readVarint():u===5&&a.layers.push(function(f,p){return f.readFields(dfe,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},p)}(c,c.readVarint()+c.pos))}function sfe(u,a,c){u===1?(a.delta_filter=function(f,p){return f.readFields(lfe,{blockSize:0},p)}(c,c.readVarint()+c.pos),a.filter="delta_filter"):u===2?(c.readVarint(),a.filter="zigzag_filter"):u===3?(c.readVarint(),a.filter="bitshuffle_filter"):u===4&&(c.readVarint(),a.filter="byteshuffle_filter")}function lfe(u,a,c){u===1&&(a.blockSize=c.readVarint())}function cfe(u,a,c){u===1?(c.readVarint(),a.codec="gzip_data"):u===2?(c.readVarint(),a.codec="jpeg_image"):u===3?(c.readVarint(),a.codec="webp_image"):u===4&&(c.readVarint(),a.codec="png_image")}function ufe(u,a,c){let f=0,p=0;u===1?a.firstByte=c.readFixed64():u===2?a.lastByte=c.readFixed64():u===3?a.filters.push(function(x,b){return x.readFields(sfe,{},b)}(c,c.readVarint()+c.pos)):u===4?a.codec=function(x,b){return x.readFields(cfe,{},b)}(c,c.readVarint()+c.pos):u===5?p=c.readFloat():u===6?f=c.readFloat():u===7?a.bands.push(c.readString()):u===8?a.offset=c.readDouble():u===9&&(a.scale=c.readDouble()),a.offset===0&&(a.offset=p),a.scale===0&&(a.scale=f)}function dfe(u,a,c){u===1?a.version=c.readVarint():u===2?a.name=c.readString():u===3?a.units=c.readString():u===4?a.tileSize=c.readVarint():u===5?a.buffer=c.readVarint():u===6?a.pixelFormat=c.readVarint():u===7&&a.dataIndex.push(function(f,p){return f.readFields(ufe,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},p)}(c,c.readVarint()+c.pos))}function hfe(u,a,c){if(u===2)(function(f,p,x){f.readFields(ffe,x,p)})(c,c.readVarint()+c.pos,a);else if(u===3)throw new Error("Not implemented")}function ffe(u,a,c){if(u===1){let f=0;const p=c.readVarint()+c.pos;for(;c.pos<p;)a[f++]=c.readVarint()}}function pfe(u,a){if(a.length!==4)throw new Error(`Expected data of dimension 4 but got ${a.length}.`);let c=a[3];for(let f=2;f>=1;f--){const p=f===1?1:0,x=f===2?1:0;for(let b=0;b<a[0];b++){const A=a[1]*b;for(let k=p;k<a[1];k++){const M=a[2]*(k+A);for(let $=x;$<a[2];$++){const V=a[3]*($+M);for(let q=0;q<a[3];q++){const X=V+q;u[X]+=u[X-c]}}}}c*=a[f]}return u}function mfe(u){for(let a=0,c=u.length;a<c;a++)u[a]=u[a]>>>1^-(1&u[a]);return u}function gfe(u,a){switch(a){case"uint32":return u;case"uint16":for(let c=0;c<u.length;c+=2){const f=u[c],p=u[c+1];u[c]=(240&f)>>4|(61440&f)>>8|(240&p)<<4|61440&p,u[c+1]=15&f|(3840&f)>>4|(15&p)<<8|(3840&p)<<4}return u;case"uint8":for(let c=0;c<u.length;c+=4){const f=u[c],p=u[c+1],x=u[c+2],b=u[c+3];u[c+0]=(192&f)>>6|(192&p)>>4|(192&x)>>2|192&b,u[c+1]=(48&f)>>4|(48&p)>>2|48&x|(48&b)<<2,u[c+2]=(12&f)>>2|12&p|(12&x)<<2|(12&b)<<4,u[c+3]=3&f|(3&p)<<2|(3&x)<<4|(3&b)<<6}return u;default:throw new Error(`Invalid pixel format, "${a}"`)}}gr(JA,"DEMData"),gr(N6,"DemMinMaxQuadTree",{omit:["dem"]});var Rc=Uint8Array,H1=Uint16Array,yfe=Int32Array,D6=new Rc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),L6=new Rc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),vfe=new Rc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),F6=function(u,a){for(var c=new H1(31),f=0;f<31;++f)c[f]=a+=1<<u[f-1];var p=new yfe(c[30]);for(f=1;f<30;++f)for(var x=c[f];x<c[f+1];++x)p[x]=x-c[f]<<5|f;return{b:c,r:p}},z6=F6(D6,2),B6=z6.b,_fe=z6.r;B6[28]=258,_fe[258]=28;for(var xfe=F6(L6,0).b,$6=new H1(32768),to=0;to<32768;++to){var sx=(43690&to)>>1|(21845&to)<<1;$6[to]=((65280&(sx=(61680&(sx=(52428&sx)>>2|(13107&sx)<<2))>>4|(3855&sx)<<4))>>8|(255&sx)<<8)>>1}var K1=function(u,a,c){for(var f=u.length,p=0,x=new H1(a);p<f;++p)u[p]&&++x[u[p]-1];var b,A=new H1(a);for(p=1;p<a;++p)A[p]=A[p-1]+x[p-1]<<1;b=new H1(1<<a);var k=15-a;for(p=0;p<f;++p)if(u[p])for(var M=p<<4|u[p],$=a-u[p],V=A[u[p]-1]++<<$,q=V|(1<<$)-1;V<=q;++V)b[$6[V]>>k]=M;return b},Z1=new Rc(288);for(to=0;to<144;++to)Z1[to]=8;for(to=144;to<256;++to)Z1[to]=9;for(to=256;to<280;++to)Z1[to]=7;for(to=280;to<288;++to)Z1[to]=8;var U6=new Rc(32);for(to=0;to<32;++to)U6[to]=5;var bfe=K1(Z1,9),wfe=K1(U6,5),UN=function(u){for(var a=u[0],c=1;c<u.length;++c)u[c]>a&&(a=u[c]);return a},td=function(u,a,c){var f=a/8|0;return(u[f]|u[f+1]<<8)>>(7&a)&c},VN=function(u,a){var c=a/8|0;return(u[c]|u[c+1]<<8|u[c+2]<<16)>>(7&a)},Sfe=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],rd=function(u,a,c){var f=new Error(a||Sfe[u]);if(f.code=u,Error.captureStackTrace&&Error.captureStackTrace(f,rd),!c)throw f;return f},Efe=new Rc(0),Tfe=typeof TextDecoder<"u"&&new TextDecoder;try{Tfe.decode(Efe,{stream:!0})}catch{}const Afe={gzip_data:"gzip"};class du extends Error{constructor(a){super(a),this.name="MRTError"}}const Pfe={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},V6={uint32:1,uint16:2,uint8:4},Cfe={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let qN;class QA{constructor(a=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=a}getLayer(a){const c=this.layers[a];if(!c)throw new du(`Layer '${a}' not found`);return c}getHeaderLength(a){const c=new Uint8Array(a),f=new DataView(a);if(c[0]!==13)throw new du("File is not a valid MRT.");return f.getUint32(1,!0)}parseHeader(a){const c=new Uint8Array(a),f=this.getHeaderLength(a);if(c.length<f)throw new du(`Expected header with length >= ${f} but got buffer of length ${c.length}`);const p=new qN(c.subarray(0,f)).readFields(ofe,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new du(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(const x of p.layers)this.layers[x.name]=new q6(x,{cacheSize:this._cacheSize});return this}createDecodingTask(a){const c=[],f=this.getLayer(a.layerName);for(let p of a.blockIndices){const x=f.dataIndex[p],b=x.firstByte-a.firstByte,A=x.lastByte-a.firstByte;if(f._blocksInProgress.has(p))continue;const k={layerName:f.name,firstByte:b,lastByte:A,pixelFormat:f.pixelFormat,blockIndex:p,blockShape:[x.bands.length].concat(f.bandShape),buffer:f.buffer,codec:x.codec.codec,filters:x.filters.map(M=>M.filter)};f._blocksInProgress.add(p),c.push(k)}return new W6(c,()=>{c.forEach(p=>f._blocksInProgress.delete(p.blockIndex))},(p,x)=>{if(c.forEach(b=>f._blocksInProgress.delete(b.blockIndex)),p)throw p;x.forEach(b=>{this.getLayer(b.layerName).processDecodedData(b)})})}}class q6{constructor({version:a,name:c,units:f,tileSize:p,pixelFormat:x,buffer:b,dataIndex:A},k){if(this.version=a,this.version!==1)throw new du(`Cannot parse raster layer encoded with MRT version ${a}`);this.name=c,this.units=f,this.tileSize=p,this.buffer=b,this.pixelFormat=Pfe[x],this.dataIndex=A,this.bandShape=[p+2*b,p+2*b,V6[this.pixelFormat]],this._decodedBlocks=new YA(k?k.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return V6[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:a})=>a).flat()}processDecodedData(a){const c=a.blockIndex.toString();this._decodedBlocks.get(c)||this._decodedBlocks.put(c,a.data)}getBlockForBand(a){let c=0;switch(typeof a){case"string":for(const[f,p]of this.dataIndex.entries()){for(const[x,b]of p.bands.entries())if(b===a)return{bandIndex:c+x,blockIndex:f,blockBandIndex:x};c+=p.bands.length}break;case"number":for(const[f,p]of this.dataIndex.entries()){if(a>=c&&a<c+p.bands.length)return{bandIndex:a,blockIndex:f,blockBandIndex:a-c};c+=p.bands.length}break;default:throw new du(`Invalid band \`${JSON.stringify(a)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(a){let c=1/0,f=-1/0;const p=[],x=new Set;for(const b of a){const{blockIndex:A}=this.getBlockForBand(b);if(A<0)throw new du(`Invalid band: ${JSON.stringify(b)}`);const k=this.dataIndex[A];p.includes(A)||p.push(A),x.add(A),c=Math.min(c,k.firstByte),f=Math.max(f,k.lastByte)}if(x.size>this.cacheSize)throw new du(`Number of blocks to decode (${x.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:c,lastByte:f,blockIndices:p}}hasBand(a){const{blockIndex:c}=this.getBlockForBand(a);return c>=0}hasDataForBand(a){const{blockIndex:c}=this.getBlockForBand(a);return c>=0&&!!this._decodedBlocks.get(c.toString())}getBandView(a){const{blockIndex:c,blockBandIndex:f}=this.getBlockForBand(a);if(c<0)throw new du(`Band not found: ${JSON.stringify(a)}`);const p=this._decodedBlocks.get(c.toString());if(!p)throw new du(`Data for band ${JSON.stringify(a)} of layer "${this.name}" not decoded.`);const x=this.dataIndex[c],b=this.bandShape.reduce((M,$)=>M*$,1),A=f*b,k=p.subarray(A,A+b);return{data:k,bytes:new Uint8Array(k.buffer).subarray(k.byteOffset,k.byteOffset+k.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:x.offset,scale:x.scale}}}QA.setPbf=function(u){qN=u};class W6{constructor(a,c,f){this.tasks=a,this._onCancel=c,this._onComplete=f,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(a,c){this._finalized||(this._onComplete(a,c),this._finalized=!0)}}QA.performDecoding=function(u,a){const c=new Uint8Array(u);return Promise.all(a.tasks.map(f=>{const{layerName:p,firstByte:x,lastByte:b,pixelFormat:A,blockShape:k,blockIndex:M,filters:$,codec:V}=f,q=c.subarray(x,b+1),X=new Uint32Array(k[0]*k[1]*k[2]);let Y;if(V!=="gzip_data")throw new du(`Unhandled codec: ${V}`);return Y=function(se,ce){if(!globalThis.DecompressionStream&&ce==="gzip_data")return Promise.resolve(((Oe=function(Ke){Ke[0]==31&&Ke[1]==139&&Ke[2]==8||rd(6,"invalid gzip data");var Qe=Ke[3],nt=10;4&Qe&&(nt+=2+(Ke[10]|Ke[11]<<8));for(var Et=(Qe>>3&1)+(Qe>>4&1);Et>0;Et-=!Ke[nt++]);return nt+(2&Qe)}(Ee=se))+8>Ee.length&&rd(6,"invalid gzip data"),function(Ke,Qe,nt,Et){var ft=Ke.length;if(!ft||Qe.f&&!Qe.l)return nt||new Rc(0);var Tt=!nt,It=Tt||Qe.i!=2,Dt=Qe.i;Tt&&(nt=new Rc(3*ft));var Xt,Vt,jt=function(la){var Ui=nt.length;if(la>Ui){var Ci=new Rc(Math.max(2*Ui,la));Ci.set(nt),nt=Ci}},$t=Qe.f||0,xt=Qe.p||0,vt=Qe.b||0,zt=Qe.l,Ht=Qe.d,Nt=Qe.m,pr=Qe.n,_r=8*ft;do{if(!zt){$t=td(Ke,xt,1);var ur=td(Ke,xt+1,3);if(xt+=3,!ur){var ar=Ke[(ze=4+((xt+7)/8|0))-4]|Ke[ze-3]<<8,Xr=ze+ar;if(Xr>ft){Dt&&rd(0);break}It&&jt(vt+ar),nt.set(Ke.subarray(ze,Xr),vt),Qe.b=vt+=ar,Qe.p=xt=8*Xr,Qe.f=$t;continue}if(ur==1)zt=bfe,Ht=wfe,Nt=9,pr=5;else if(ur==2){var sr=td(Ke,xt,31)+257,Or=td(Ke,xt+10,15)+4,Qr=sr+td(Ke,xt+5,31)+1;xt+=14;for(var vn=new Rc(Qr),Bn=new Rc(19),nn=0;nn<Or;++nn)Bn[vfe[nn]]=td(Ke,xt+3*nn,7);xt+=3*Or;var Hn=UN(Bn),Kn=(1<<Hn)-1,Yi=K1(Bn,Hn);for(nn=0;nn<Qr;){var ze,Ne=Yi[td(Ke,xt,Kn)];if(xt+=15&Ne,(ze=Ne>>4)<16)vn[nn++]=ze;else{var Pt=0,nr=0;for(ze==16?(nr=3+td(Ke,xt,3),xt+=2,Pt=vn[nn-1]):ze==17?(nr=3+td(Ke,xt,7),xt+=3):ze==18&&(nr=11+td(Ke,xt,127),xt+=7);nr--;)vn[nn++]=Pt}}var Ct=vn.subarray(0,sr),or=vn.subarray(sr);Nt=UN(Ct),pr=UN(or),zt=K1(Ct,Nt),Ht=K1(or,pr)}else rd(1);if(xt>_r){Dt&&rd(0);break}}It&&jt(vt+131072);for(var Ar=(1<<Nt)-1,Er=(1<<pr)-1,an=xt;;an=xt){var Fr=(Pt=zt[VN(Ke,xt)&Ar])>>4;if((xt+=15&Pt)>_r){Dt&&rd(0);break}if(Pt||rd(2),Fr<256)nt[vt++]=Fr;else{if(Fr==256){an=xt,zt=null;break}var wr=Fr-254;Fr>264&&(wr=td(Ke,xt,(1<<(Ur=D6[nn=Fr-257]))-1)+B6[nn],xt+=Ur);var Wn=Ht[VN(Ke,xt)&Er],vi=Wn>>4;if(Wn||rd(3),xt+=15&Wn,or=xfe[vi],vi>3){var Ur=L6[vi];or+=VN(Ke,xt)&(1<<Ur)-1,xt+=Ur}if(xt>_r){Dt&&rd(0);break}It&&jt(vt+131072);var Fn=vt+wr;if(vt<or){var _i=0-or,ii=Math.min(or,Fn);for(_i+vt<0&&rd(3);vt<ii;++vt)nt[vt]=(void 0)[_i+vt]}for(;vt<Fn;++vt)nt[vt]=nt[vt-or]}}Qe.l=zt,Qe.p=an,Qe.b=vt,Qe.f=$t,zt&&($t=1,Qe.m=Nt,Qe.d=Ht,Qe.n=pr)}while(!$t);return vt!=nt.length&&Tt?(Xt=nt,((Vt=vt)==null||Vt>Xt.length)&&(Vt=Xt.length),new Rc(Xt.subarray(0,Vt))):nt.subarray(0,vt)}(Ee.subarray(Oe,-8),{i:2},new Rc(((he=Ee)[(be=he.length)-4]|he[be-3]<<8|he[be-2]<<16|he[be-1]<<24)>>>0))));var he,be,Ee,Oe;const Ue=Afe[ce];if(!Ue)throw new Error(`Unhandled codec: ${ce}`);const Fe=new globalThis.DecompressionStream(Ue);return new Response(new Blob([se]).stream().pipeThrough(Fe)).arrayBuffer().then(Ke=>new Uint8Array(Ke))}(q,V).then(se=>(function(ce,he){ce.readFields(hfe,he)}(new qN(se),X),new Cfe[A](X.buffer))),Y.then(se=>{for(let ce=$.length-1;ce>=0;ce--)switch($[ce]){case"delta_filter":pfe(se,k);break;case"zigzag_filter":mfe(se);break;case"bitshuffle_filter":gfe(se,A);break;default:throw new du(`Unhandled filter "${$[ce]}"`)}return{layerName:p,blockIndex:M,data:se}}).catch(se=>{throw se})}))},gr(W6,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),gr(QA,"MapboxRasterTile"),gr(q6,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class G6{constructor(a){this._stringToNumber={},this._numberToString=[];for(let c=0;c<a.length;c++){const f=a[c];this._stringToNumber[f]=c,this._numberToString[c]=f}}encode(a){return this._stringToNumber[a]}decode(a){return this._numberToString[a]}}class H6{constructor(a,c){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Xh(Jt,16,0),this.featureIndexArray=new Y2,this.promoteId=c,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(a,c,f,p,x,b=0,A=0){const k=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,p,x,b);const M=this.grid;for(let $=0;$<c.length;$++){const V=c[$],q=[1/0,1/0,-1/0,-1/0];for(let X=0;X<V.length;X++){const Y=V[X];q[0]=Math.min(q[0],Y.x),q[1]=Math.min(q[1],Y.y),q[2]=Math.max(q[2],Y.x),q[3]=Math.max(q[3],Y.y)}A!==0&&(q[0]-=A,q[1]-=A,q[2]+=A,q[3]+=A),q[0]<Jt&&q[1]<Jt&&q[2]>=0&&q[3]>=0&&M.insert(k,q[0],q[1],q[2],q[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new br(new OA(this.rawTileData)).layers,this.sourceLayerCoder=new G6(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const a in this.vtLayers)this.vtFeatures[a]=[]}return this.vtLayers}query(a,c){const{tilespaceGeometry:f,transform:p,tileTransform:x,pixelPosMatrix:b,availableImages:A,worldview:k}=c;this.loadVTLayers(),this.serializedLayersCache.clear();const M=c.queryRadius?c.queryRadius:0,$=f.bufferedTilespaceBounds,V=this.grid.query($.min.x,$.min.y,$.max.x,$.max.y,(se,ce,he,be)=>oa(f.bufferedTilespaceGeometry,se-M,ce-M,he+M,be+M));V.sort(Ofe);let q=null;p.elevation&&V.length>0&&(q=ix.create(p.elevation,this.tileID));const X={};let Y;for(let se=0;se<V.length;se++){const ce=V[se];if(ce===Y)continue;Y=ce;const he=this.featureIndexArray.get(ce);let be=null;this.is3DTile?this.loadMatchingModelFeature(X,he,a,f,p,k):this.loadMatchingFeature(X,he,a,A,k,(Ee,Oe,Ue,Fe=0)=>(be||(be=kt(Ee,this.tileID.canonical,x)),Oe.queryIntersectsFeature(f,Ee,Ue,be,this.z,p,b,q,Fe)))}return X}loadMatchingFeature(a,c,f,p,x,b){const{featureIndex:A,bucketIndex:k,sourceLayerIndex:M,layoutVertexArrayOffset:$}=c,V=this.bucketLayerIDs[k],q=f.layers,X=Object.keys(q);if(X.length&&!Kr(X,V))return;const Y=f.sourceCache,se=this.sourceLayerCoder.decode(M),ce=this.vtLayers[se].feature(A),he=this.getId(ce,se);for(let be=0;be<V.length;be++){const Ee=V[be];if(!q[Ee])continue;const{styleLayer:Oe,targets:Ue}=q[Ee];let Fe={};he!==void 0&&(Fe=Y.getFeatureState(Oe.sourceLayer,he));const Ke=!b||b(ce,Oe,Fe,$);if(!Ke)continue;const Qe=new dy(ce,this.z,this.x,this.y,he);Qe.tile=this.tileID.canonical,Qe.state=Fe;let nt=this.serializedLayersCache.get(Ee);nt||(nt=Oe.serialize(),nt.id=Ee,this.serializedLayersCache.set(Ee,nt)),Qe.source=nt.source,Qe.sourceLayer=nt["source-layer"],Qe.layer=Object.assign({},nt),Qe.layer.paint=K6(nt.paint,Oe.paint,ce,Fe,p),Qe.layer.layout=K6(nt.layout,Oe.layout,ce,Fe,p);let Et=!1;for(const ft of Ue){this.updateFeatureProperties(Qe,ft);const{filter:Tt}=ft;if(Tt){if(ce.properties=Qe.properties,Tt.needGeometry){const It=gt(ce,!0);if(!Tt.filter(new Ri(this.tileID.overscaledZ,{worldview:x}),It,this.tileID.canonical))continue}else if(!Tt.filter(new Ri(this.tileID.overscaledZ,{worldview:x}),ce))continue}Et=!0,ft.targetId&&this.addFeatureVariant(Qe,ft)}Et&&this.appendToResult(a,Ee,A,Qe,Ke)}}loadMatchingModelFeature(a,c,f,p,x,b){const{featureIndex:A,bucketIndex:k}=c,M=this.bucketLayerIDs[k],$=f.layers,V=Object.keys($);if(!V.length||Kr(V,M))for(let q=0;q<M.length;q++){const X=M[q],{styleLayer:Y,targets:se}=$[X];if(Y.type!=="model")continue;const ce=p.tile,he=ce.getBucket(Y);if(!(he&&he instanceof GA))continue;const be=Mhe(he,A,p,x);if(!be)continue;const{z:Ee,x:Oe,y:Ue}=ce.tileID.canonical,{feature:Fe,intersectionZ:Ke,position:Qe}=be;let nt={};Fe.id!==void 0&&(nt=f.sourceCache.getFeatureState(Y.sourceLayer,Fe.id));const Et=new dy({},Ee,Oe,Ue,Fe.id);Et.tile=this.tileID.canonical,Et.state=nt,Et.properties=Fe.properties,Et.geometry={type:"Point",coordinates:[Qe.lng,Qe.lat]};let ft=this.serializedLayersCache.get(X);ft||(ft=Y.serialize(),ft.id=X,this.serializedLayersCache.set(X,ft)),Et.source=ft.source,Et.sourceLayer=ft["source-layer"],Et.layer=Object.assign({},ft);let Tt=!1;for(const It of se){this.updateFeatureProperties(Et,It);const{filter:Dt}=It;if(Dt){if(Fe.properties=Et.properties,Dt.needGeometry){if(!Dt.filter(new Ri(this.tileID.overscaledZ,{worldview:b}),Fe,this.tileID.canonical))continue}else if(!Dt.filter(new Ri(this.tileID.overscaledZ,{worldview:b}),Fe))continue}Tt=!0,It.targetId&&this.addFeatureVariant(Et,It)}Tt&&this.appendToResult(a,X,A,Et,Ke)}}updateFeatureProperties(a,c,f){if(c.properties){const p={};for(const x in c.properties){const b=c.properties[x].evaluate({zoom:this.z},a._vectorTileFeature,a.state,a.tile,f);b!=null&&(p[x]=b)}a.properties=p}}addFeatureVariant(a,c,f){const p={target:c.target,namespace:c.namespace,uniqueFeatureID:c.uniqueFeatureID};c.properties&&(p.properties=a.properties),a.variants=a.variants||{},a.variants[c.targetId]=a.variants[c.targetId]||[],a.variants[c.targetId].push(p)}appendToResult(a,c,f,p,x){let b=a[c];b===void 0&&(b=a[c]=[]),b.push({featureIndex:f,feature:p,intersectionZ:x})}lookupSymbolFeatures(a,c,f,p,x,b){const A={};this.loadVTLayers();for(const k of a)this.loadMatchingFeature(A,{bucketIndex:c,sourceLayerIndex:f,featureIndex:k,layoutVertexArrayOffset:0},p,x,b);return A}loadFeature(a){const{featureIndex:c,sourceLayerIndex:f}=a;this.loadVTLayers();const p=this.sourceLayerCoder.decode(f),x=this.vtFeatures[p];if(x[c])return x[c];const b=this.vtLayers[p].feature(c);return x[c]=b,b}hasLayer(a){for(const c of this.bucketLayerIDs)for(const f of c)if(a===f)return!0;return!1}getId(a,c){let f=a.id;if(this.promoteId){const p=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[c];if(p!=null)if(Array.isArray(p)){if(!this.promoteIdExpression){const x=lu(p);if(x.result!=="success"){const b=x.value.map(A=>`${A.key}: ${A.message}`).join(", ");return void Ir(`Failed to create expression for promoteId: ${b}`)}this.promoteIdExpression=x.value}f=this.promoteIdExpression.evaluate({zoom:0},a)}else f=a.properties[p];typeof f=="boolean"&&(f=Number(f))}return f}}function K6(u,a,c,f,p){return Kt(u,(x,b)=>{const A=a instanceof Yh?a.get(b):null;return A&&A.evaluate?A.evaluate(c,f,void 0,p):A})}function Ofe(u,a){return a-u}gr(H6,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Z6=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class WN{static from(a){if(!(a instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,f]=new Uint8Array(a,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=f>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const x=Z6[15&f];if(!x)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(a,2,1),[A]=new Uint32Array(a,4,1);return new WN(A,b,x,a)}constructor(a,c=64,f=Float64Array,p){if(isNaN(a)||a<0)throw new Error(`Unpexpected numItems value: ${a}.`);this.numItems=+a,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=f,this.IndexArrayType=a<65536?Uint16Array:Uint32Array;const x=Z6.indexOf(this.ArrayType),b=2*a*this.ArrayType.BYTES_PER_ELEMENT,A=a*this.IndexArrayType.BYTES_PER_ELEMENT,k=(8-A%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${f}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+A+k,2*a),this._pos=2*a,this._finished=!0):(this.data=new ArrayBuffer(8+b+A+k),this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+A+k,2*a),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=a)}add(a,c){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=a,this.coords[this._pos++]=c,f}finish(){const a=this._pos>>1;if(a!==this.numItems)throw new Error(`Added ${a} items when expected ${this.numItems}.`);return GN(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(a,c,f,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:b,nodeSize:A}=this,k=[0,x.length-1,0],M=[];for(;k.length;){const $=k.pop()||0,V=k.pop()||0,q=k.pop()||0;if(V-q<=A){for(let ce=q;ce<=V;ce++){const he=b[2*ce],be=b[2*ce+1];he>=a&&he<=f&&be>=c&&be<=p&&M.push(x[ce])}continue}const X=q+V>>1,Y=b[2*X],se=b[2*X+1];Y>=a&&Y<=f&&se>=c&&se<=p&&M.push(x[X]),($===0?a<=Y:c<=se)&&(k.push(q),k.push(X-1),k.push(1-$)),($===0?f>=Y:p>=se)&&(k.push(X+1),k.push(V),k.push(1-$))}return M}within(a,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:x,nodeSize:b}=this,A=[0,p.length-1,0],k=[],M=f*f;for(;A.length;){const $=A.pop()||0,V=A.pop()||0,q=A.pop()||0;if(V-q<=b){for(let ce=q;ce<=V;ce++)Y6(x[2*ce],x[2*ce+1],a,c)<=M&&k.push(p[ce]);continue}const X=q+V>>1,Y=x[2*X],se=x[2*X+1];Y6(Y,se,a,c)<=M&&k.push(p[X]),($===0?a-f<=Y:c-f<=se)&&(A.push(q),A.push(X-1),A.push(1-$)),($===0?a+f>=Y:c+f>=se)&&(A.push(X+1),A.push(V),A.push(1-$))}return k}}function GN(u,a,c,f,p,x){if(p-f<=c)return;const b=f+p>>1;X6(u,a,b,f,p,x),GN(u,a,c,f,b-1,1-x),GN(u,a,c,b+1,p,1-x)}function X6(u,a,c,f,p,x){for(;p>f;){if(p-f>600){const M=p-f+1,$=c-f+1,V=Math.log(M),q=.5*Math.exp(2*V/3),X=.5*Math.sqrt(V*q*(M-q)/M)*($-M/2<0?-1:1);X6(u,a,c,Math.max(f,Math.floor(c-$*q/M+X)),Math.min(p,Math.floor(c+(M-$)*q/M+X)),x)}const b=a[2*c+x];let A=f,k=p;for(X1(u,a,f,c),a[2*p+x]>b&&X1(u,a,f,p);A<k;){for(X1(u,a,A,k),A++,k--;a[2*A+x]<b;)A++;for(;a[2*k+x]>b;)k--}a[2*f+x]===b?X1(u,a,f,k):(k++,X1(u,a,k,p)),k<=c&&(f=k+1),c<=k&&(p=k-1)}}function X1(u,a,c,f){HN(u,c,f),HN(a,2*c,2*f),HN(a,2*c+1,2*f+1)}function HN(u,a,c){const f=u[a];u[a]=u[c],u[c]=f}function Y6(u,a,c,f){const p=u-c,x=a-f;return p*p+x*x}i.$=Wv,i.A=Uu,i.B=Jh,i.C=2,i.D=W_,i.E=Bu,i.F=R1,i.G=SV,i.H=qv,i.I=eo,i.J=Vw,i.K=tp,i.L=jg,i.M=m_,i.N=p_,i.O=kw,i.P=Mt,i.Q=__,i.R=zh,i.S=_p,i.T=nN,i.U=lu,i.V=WA,i.W=Rw,i.X=cp,i.Y=lp,i.Z=zg,i._=os,i.a=function(u){return Bi.API_CDN_URL_REGEX.test(u)},i.a$=Sp,i.a0=Gr,i.a1=rw,i.a2=xp,i.a3=class extends WA{},i.a4=g_,i.a5=Ow,i.a6=ht,i.a7=function(u){const a=u.value;return a?Gr(a)?jN(a,!0)?[]:[new WA(u.key,a,`invalid url "${a}"`)]:[new WA(u.key,a,`string expected, "${tp(a)}" found`)]:[]},i.a8=B2,i.a9=ua,i.aA=ve,i.aB=R,i.aC=er,i.aD=Fs,i.aE=mo,i.aF=_e,i.aG=bt,i.aH=function(u,a){const c={};for(let f=0;f<a.length;f++){const p=a[f];p in u&&(c[p]=u[p])}return c},i.aI=K,i.aJ=ge,i.aK=class{constructor(u){this.entries={},this.scheduler=u}request(u,a,c,f){const p=this.entries[u]=this.entries[u]||{callbacks:[]};if(p.result){const[x,b]=p.result;return this.scheduler?this.scheduler.add(()=>{f(x,b)},a):f(x,b),()=>{}}return p.callbacks.push(f),p.cancel||(p.cancel=c((x,b)=>{p.result=[x,b];for(const A of p.callbacks)this.scheduler?this.scheduler.add(()=>{A(x,b)},a):A(x,b);setTimeout(()=>delete this.entries[u],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(x=>x!==f),p.callbacks.length||(p.cancel(),delete this.entries[u]))}}},i.aL=function(u,a,c){const f=JSON.stringify(u.request);return u.data&&(this.deduped.entries[f]={result:[null,u.data]}),this.deduped.request(f,{type:"parseTile",isSymbolTile:u.isSymbolTile,zoom:u.tileZoom},p=>{const x=Xf(u.request,(b,A,k)=>{b?p(b):A&&p(null,{vectorTile:c?void 0:new br(new OA(A)),rawData:A,responseHeaders:new Map(k.entries())})});return()=>{x.cancel(),p()}},a)},i.aM=function(u){return u?{cacheControl:u.get("Cache-Control"),expires:u.get("Expires")}:{cacheControl:void 0,expires:void 0}},i.aN=function(u){zv++,zv>Ms&&(u.getActor().send("enforceCacheSizeLimit",yg),zv=0)},i.aO=function(u){return u<=1?1:Math.pow(2,Math.floor(Math.log2(u)))},i.aP=uo,i.aQ=JV,i.aR=i6,i.aS=Q,i.aT=YV,i.aU=function(u,a){const c=document.createElement("video");c.muted=!0,c.onloadstart=function(){a(null,c)};for(let f=0;f<u.length;f++){const p=document.createElement("source");Yn(u[f])||(c.crossOrigin="Anonymous"),p.src=u[f],c.appendChild(p)}return{cancel:()=>{}}},i.aV=P1,i.aW=hy,i.aX=yt,i.aY=D1,i.aZ=ke,i.a_=Te,i.aa=Wt,i.ab=class{constructor(u){this.specification=u}possiblyEvaluate(u,a){return pi(u.expression.evaluate(a))}interpolate(u,a,c){return{x:qr(u.x,a.x,c),y:qr(u.y,a.y,c),z:qr(u.z,a.z,c),azimuthal:qr(u.azimuthal,a.azimuthal,c),polar:qr(u.polar,a.polar,c)}}},i.ac=Ri,i.ad=Vd,i.ae=lt,i.af=Ut,i.ag=xe,i.ah=Me,i.ai=Yh,i.aj=jp,i.ak=qr,i.al=Jt,i.am=Pg,i.an=bn,i.ao=ni,i.ap=class{constructor(u){this.specification=u}possiblyEvaluate(u,a){return function([c,f]){const p=pi([1,c,f]);return{x:p.x,y:p.y,z:p.z}}(u.expression.evaluate(a))}interpolate(u,a,c){return{x:qr(u.x,a.x,c),y:qr(u.y,a.y,c),z:qr(u.z,a.z,c)}}},i.aq=function(u,a,c=0,f=!0){const p=new Mt(c,c),x=u.sub(p),b=a.add(p),A=[x,new Mt(b.x,x.y),b,new Mt(x.x,b.y)];return f&&A.push(x.clone()),A},i.ar=function(u,a){const c=[];for(let f=0;f<u.length;f++){const p=Je(f-1,-1,u.length-1),x=Je(f+1,-1,u.length-1),b=u[f],A=u[x],k=u[p].sub(b).unit(),M=A.sub(b).unit(),$=M.angleWithSep(k.x,k.y),V=k.add(M).unit().mult(-1*a/Math.sin($/2));c.push(b.add(V))}return c},i.as=DV,i.at=oa,i.au=function(u,a,c=0){return we(((a.x-c)*u.scale-u.x)*Jt,(a.y*u.scale-u.y)*Jt,$e(a.z,a.y))},i.av=Rt,i.aw=je,i.ax=sn,i.ay=XU,i.az=function(u){let a=1/0,c=1/0,f=-1/0,p=-1/0;for(const x of u)a=Math.min(a,x.x),c=Math.min(c,x.y),f=Math.max(f,x.x),p=Math.max(p,x.y);return{min:new Mt(a,c),max:new Mt(f,p)}},i.b=function(u){return Bi.API_FONTS_REGEX.test(u)},i.b$=Wj,i.b0=Gi,i.b1=_t,i.b2=K2,i.b3=$A,i.b4=function(){el.isLoading()||el.isLoaded()||Bw()!=="deferred"||$w()},i.b5=T_,i.b6=gt,i.b7=dy,i.b8=za,i.b9=dN,i.bA=J,i.bB=N,i.bC=function(u,a){const{x:c,y:f}=u.point,p=m$(c,f,u.worldSize/u._pixelsPerMercatorPixel,0,0);return R(p,p,Rj(Xd(a)))},i.bD=S,i.bE=Lr,i.bF=Ze,i.bG=tt,i.bH=St,i.bI=ot,i.bJ=Q_,i.bK=kl,i.bL=_N,i.bM=function(u,a,c,f,p){const x=5*a+2;u.float32[x+0]=c,u.float32[x+1]=f,u.float32[x+2]=p},i.bN=nx,i.bO=bs,i.bP=rs,i.bQ=Ns,i.bR=kn,i.bS=Je,i.bT=function(u,a,c,f){var p=new _(4);return p[0]=u,p[1]=a,p[2]=c,p[3]=f,p},i.bU=class{isDataAvailableAtPoint(u){const a=this._source();if(this.isUsingMockSource()||!a||u.y<0||u.y>1)return!1;const c=a.getSource().maxzoom,f=1<<c,p=Math.floor(u.x),x=Math.floor((u.x-p)*f),b=Math.floor(u.y*f),A=this.findDEMTileFor(new uo(c,p,c,x,b));return!(!A||!A.dem)}getAtPointOrZero(u,a=0){return this.getAtPoint(u,a)||0}getAtPoint(u,a,c=!0){if(this.isUsingMockSource())return null;a==null&&(a=null);const f=this._source();if(!f||u.y<0||u.y>1)return a;const p=f.getSource().maxzoom,x=1<<p,b=Math.floor(u.x),A=u.x-b,k=new uo(p,b,p,Math.floor(A*x),Math.floor(u.y*x)),M=this.findDEMTileFor(k);if(!M||!M.dem)return a;const $=M.dem,V=1<<M.tileID.canonical.z,q=(A*V-M.tileID.canonical.x)*$.dim,X=(u.y*V-M.tileID.canonical.y)*$.dim,Y=Math.floor(q),se=Math.floor(X);return(c?this.exaggeration():1)*qr(qr($.get(Y,se),$.get(Y,se+1),X-se),qr($.get(Y+1,se),$.get(Y+1,se+1),X-se),q-Y)}static getAtTileOffset(u,a,c,f){const p=1<<u.canonical.z;return f?f.pointElevation(a):c?c.getAtPointOrZero(new lt(u.wrap+(u.canonical.x+a.x/Jt)/p,(u.canonical.y+a.y/Jt)/p)):0}static getAtTileOffsetFunc(u,a,c,f){return(p,x,b)=>{const A=this.getAtTileOffset(u,p,x,b),k=f.upVector(u.canonical,p.x,p.y);return Ie(k,k,A*f.upVectorScale(u.canonical,a,c).metersToTile),k}}getForTilePoints(u,a,c,f){if(this.isUsingMockSource())return!1;const p=ix.create(this,u,f);return!!p&&(a.forEach(x=>{x[2]=this.exaggeration()*p.getElevationAt(x[0],x[1],c)}),!0)}getMinMaxForTile(u){if(this.isUsingMockSource())return null;const a=this.findDEMTileFor(u);if(!a||!a.dem)return null;const c=a.dem.tree,f=a.tileID,p=1<<u.canonical.z-f.canonical.z;let x=u.canonical.x/p-f.canonical.x,b=u.canonical.y/p-f.canonical.y,A=0;for(let k=0;k<u.canonical.z-f.canonical.z&&!c.leaves[A];k++){x*=2,b*=2;const M=2*Math.floor(b)+Math.floor(x);A=c.childOffsets[A]+M,x%=1,b%=1}return{min:this.exaggeration()*c.minimums[A],max:this.exaggeration()*c.maximums[A]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(u,a,c){throw new Error("Pure virtual method called.")}pointCoordinate(u){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(u){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const u=this.visibleDemTiles;if(u.length===0)return null;let a=!1,c=Number.MAX_VALUE,f=Number.MIN_VALUE;for(const p of u){const x=this.getMinMaxForTile(p.tileID);x&&(c=Math.min(c,x.min),f=Math.max(f,x.max),a=!0)}return a?{min:c,max:f}:null}},i.bV=vA,i.bW=ba,i.bX=To,i.bY=G$,i.bZ=a6,i.b_=X$,i.ba=Uj,i.bb=kt,i.bc=Ls,i.bd=j_,i.be=c$,i.bf=ta,i.bg=V_,i.bh=IN,i.bi=function(u,a){const c=jp(a.zoom);if(c===0)return Xd(u);const f=sA(u),p=Ij(f),x=_e(f.getWest())*a.worldSize,b=_e(f.getEast())*a.worldSize,A=ge(f.getNorth())*a.worldSize,k=ge(f.getSouth())*a.worldSize,M=[x,A,0],$=[b,A,0],V=[x,k,0],q=[b,k,0],X=D([],a.globeMatrix);return Ut(M,M,X),Ut($,$,X),Ut(V,V,X),Ut(q,q,X),p[0]=nf(p[0],V,c),p[1]=nf(p[1],q,c),p[2]=nf(p[2],$,c),p[3]=nf(p[3],M,c),gn.fromPoints(p)},i.bj=cA,i.bk=D,i.bl=d1,i.bm=nf,i.bn=Qh,i.bo=eue,i.bp=te,i.bq=F,i.br=QA,i.bs=OA,i.bt=Xf,i.bu=function(u,a){const c=[];for(const f in u)f in a||c.push(f);return c},i.bv=Ye,i.bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.bx=Vo,i.by=I,i.bz=j,i.c=as,i.c$=function(u){return u*u*u*u*u},i.c0=yN,i.c1=kV,i.c2=EN,i.c3=WN,i.c4=Ie,i.c5=Xe,i.c6=Pr,i.c7=function(u,a,c){c*=.5;var f=a[0],p=a[1],x=a[2],b=a[3],A=Math.sin(c),k=Math.cos(c);return u[0]=f*k+p*A,u[1]=p*k-f*A,u[2]=x*k+b*A,u[3]=b*k-x*A,u},i.c8=un,i.c9=xa,i.cA=Jn,i.cB=NU,i.cC=Pl,i.cD=h$,i.cE=function(u,a,c,f,p,x,b,A,k){if(k.name==="globe")return h$(u,a,new Pl(c,f,p),!1);const M=D1({z:c,x:f,y:p},k);return new gn([(x+M.x/M.scale)*a,a*(M.y/M.scale),b],[(x+M.x2/M.scale)*a,a*(M.y2/M.scale),A])},i.cF=function(u,a,c){return u[0]=Math.min(a[0],c[0]),u[1]=Math.min(a[1],c[1]),u[2]=Math.min(a[2],c[2]),u[3]=Math.min(a[3],c[3]),u},i.cG=function(u,a,c){return u[0]=Math.max(a[0],c[0]),u[1]=Math.max(a[1],c[1]),u[2]=Math.max(a[2],c[2]),u[3]=Math.max(a[3],c[3]),u},i.cH=function(u){const a=Math.round((u+45+360)%360/90)%4;return Kb[a]},i.cI=Re,i.cJ=dt,i.cK=s,i.cL=function(u){const a=j(new Float64Array(16));R(a,u.pixelMatrix,u.globeMatrix);const c=[0,P,0],f=[0,O,0];return Ut(c,c,a),Ut(f,f,a),[c[0]>0&&c[0]<=u.width&&c[1]>0&&c[1]<=u.height&&!Nj(u,new Q(u.center.lat,90)),f[0]>0&&f[0]<=u.width&&f[1]>0&&f[1]<=u.height&&!Nj(u,new Q(u.center.lat,-90))]},i.cM=function(u,a){const{scale:c}=u.tileTransform,f=c*Jt/(u.tileSize*Math.pow(2,a.zoom-u.tileID.overscaledZ+u.tileID.canonical.z));return function(p,x,b){var A=x[1],k=x[2],M=x[3],$=b[0],V=b[1];return p[0]=x[0]*$,p[1]=A*$,p[2]=k*V,p[3]=M*V,p}(new Float32Array(4),a.inverseAdjustmentMatrix,[f,f])},i.cN=SA,i.cO=ee,i.cP=jU,i.cQ=function(u){const a=jU(u,!0);return S([],[a[0],a[1],a[4],a[5]])},i.cR=B,i.cS=si,i.cT=U,i.cU=function(u){const{x:a,y:c}=u.point,{lng:f,lat:p}=u._center;return m$(a,c,u.worldSize,f,p)},i.cV=Pe,i.cW=is,i.cX=Cl,i.cY=wa,i.cZ=y,i.c_=function(u,a,c){let f=0;for(let p=0;p<2;++p)u[p]>0&&(f+=(u[p]-0)*(u[p]-0)),a[p]<0&&(f+=(0-a[p])*(0-a[p]));return f},i.ca=function(u,a){return u[0]=-a[0],u[1]=-a[1],u[2]=-a[2],u[3]=a[3],u},i.cb=ie,i.cc=function(u,a,c,f,p){var x=1/Math.tan(a/2);if(u[0]=x/c,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=x,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,p!=null&&p!==1/0){var b=1/(f-p);u[10]=(p+f)*b,u[14]=2*p*f*b}else u[10]=-1,u[14]=-2*f;return u},i.cd=function(u,a,c,f,p,x,b){var A=1/(a-c),k=1/(f-p),M=1/(x-b);return u[0]=-2*A,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*k,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*M,u[11]=0,u[12]=(a+c)*A,u[13]=(p+f)*k,u[14]=(b+x)*M,u[15]=1,u},i.ce=Se,i.cf=function(u,a,c){u[4*a+0]=c[0],u[4*a+1]=c[1],u[4*a+2]=c[2],u[4*a+3]=c[3]},i.cg=z_,i.ch=Op,i.ci=Ia,i.cj=cu,i.ck=ry,i.cl=$V,i.cm=function(){var u=new _(4);return _!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u},i.cn=function(u,a,c){var f=a[0],p=a[1],x=a[2],b=a[3],A=Math.sin(c),k=Math.cos(c);return u[0]=f*k+x*A,u[1]=p*k+b*A,u[2]=f*-A+x*k,u[3]=p*-A+b*k,u},i.co=function(u,a){return u[0]===a[0]&&u[1]===a[1]&&u[2]===a[2]&&u[3]===a[3]},i.cp=Jr,i.cq=function(u){var a=u[0],c=u[1],f=u[2],p=u[3];return Math.sqrt(a*a+c*c+f*f+p*p)},i.cr=js,i.cs=dr,i.ct=uu,i.cu=3,i.cv=2,i.cw=7,i.cx=6,i.cy=rt,i.cz=oe,i.d=function(u){return Bi.API_TILEJSON_REGEX.test(u)},i.d$=v$,i.d0=ue,i.d1=45,i.d2=ty,i.d3=function(u,a,c){const f=Math.sqrt(u*u+a*a+c*c),p=f>0?Math.acos(c/f)*ns:0;let x=u!==0||a!==0?Math.atan2(-a,-u)*ns+90:0;return x<0&&(x+=360),[f,x,p]},i.d4=we,i.d5=pi,i.d6=We,i.d7=Ce,i.d8=gn,i.d9=me,i.dA=s1,i.dB=class extends sc{constructor(u){super(u),this.current=Tj}set(u,a,c){if(this.fetchUniformLocation(u,a)){for(let f=0;f<9;f++)if(c[f]!==this.current[f]){this.current=c,this.gl.uniformMatrix3fv(this.location,!1,c);break}}}},i.dC=pg,i.dD=function(u,a,c){const f=jp(c.zoom),p=u.style.map._antialias,x=u.terrain&&u.terrain.exaggeration()>0;return f===0&&!p&&!x},i.dE=function(u){const a=u.pixelsPerMeter,c=a/Se(1,u.center.lat),f=j(new Float64Array(16));return F(f,f,[u.point.x,u.point.y,0]),B(f,f,[c,c,a]),Float32Array.from(f)},i.dF=sA,i.dG=function(u){const a=Re-5;u=ve(u,-a,a)/a*90;const c=Math.pow(Math.abs(Math.sin(bn(u))),3);return Math.round(c*(w.length-1))},i.dH=function(u,a,c,f){const p=a.getNorth(),x=a.getSouth(),b=a.getWest(),A=a.getEast(),k=1<<u.z,M=A-b,$=p-x,V=M/v,q=-$/w[c],X=[0,V,0,q,0,0,p,b,0];if(u.z>0){const Y=180/f;C(X,X,[Y/M+1,0,0,0,Y/$+1,0,-.5*Y/V,.5*Y/q,1])}return X[2]=k,X[5]=u.x,X[8]=u.y,X},i.dI=Xd,i.dJ=function(u,a,c){const f=j(new Float64Array(16)),p=(a/(1<<u)-.5)*Math.PI*2;return Z(f,c.globeMatrix,p),Float32Array.from(f)},i.dK=C$,i.dL=oA,i.dM=function(u,a){return[Math.pow(u[0],2.2)*a,Math.pow(u[1],2.2)*a,Math.pow(u[2],2.2)*a]},i.dN=E,i.dO=function(u,a){var c=Math.sin(a),f=Math.cos(a);return u[0]=f,u[1]=c,u[2]=0,u[3]=-c,u[4]=f,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},i.dP=Ft,i.dQ=p$,i.dR=zi,i.dS=aa,i.dT=256,i.dU=function(u,a){const c=[0,0,0];return Ut(c,c,cA(Xd(a.canonical))),Ut(c,c,u),c},i.dV=u=>({u_matrix:new ry(u),u_texsize:new cu(u),u_pixels_to_tile_units:new l1(u),u_device_pixel_ratio:new Ia(u),u_width_scale:new Ia(u),u_floor_width_scale:new Ia(u),u_image:new z_(u),u_units_to_pixels:new cu(u),u_tile_units_to_pixels:new Ia(u),u_alpha_discard_threshold:new Ia(u),u_trim_offset:new cu(u),u_trim_fade_range:new cu(u),u_trim_color:new ty(u),u_emissive_strength:new Ia(u),u_zbias_factor:new Ia(u),u_tile_to_meter:new Ia(u),u_ground_shadow_factor:new Op(u),u_pattern_transition:new Ia(u)}),i.dW=u=>({u_matrix:new ry(u),u_pixels_to_tile_units:new l1(u),u_device_pixel_ratio:new Ia(u),u_width_scale:new Ia(u),u_floor_width_scale:new Ia(u),u_units_to_pixels:new cu(u),u_dash_image:new z_(u),u_gradient_image:new z_(u),u_image_height:new Ia(u),u_texsize:new cu(u),u_tile_units_to_pixels:new Ia(u),u_alpha_discard_threshold:new Ia(u),u_trim_offset:new cu(u),u_trim_fade_range:new cu(u),u_trim_color:new ty(u),u_emissive_strength:new Ia(u),u_zbias_factor:new Ia(u),u_tile_to_meter:new Ia(u),u_ground_shadow_factor:new Op(u)}),i.dX=u=>({u_camera_to_center_distance:new Ia(u),u_extrude_scale:new l1(u),u_device_pixel_ratio:new Ia(u),u_matrix:new ry(u),u_inv_rot_matrix:new ry(u),u_merc_center:new cu(u),u_tile_id:new Op(u),u_zoom_transition:new Ia(u),u_up_dir:new Op(u),u_emissive_strength:new Ia(u)}),i.dY=Tp,i.dZ=$de,i.d_=class{constructor(u,a,c,f){this.context=u,this.format=f,this.size=c,this.texture=u.gl.createTexture();const[p,x,b]=this.size,{gl:A}=u;A.bindTexture(A.TEXTURE_3D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in a&&a.data&&A.texImage3D(A.TEXTURE_3D,0,this.format,p,x,b,0,tN(this.format),rN(this.format),a.data)}bind(u,a){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_3D,this.texture),u!==this.minFilter&&(f.texParameteri(f.TEXTURE_3D,f.TEXTURE_MAG_FILTER,u),f.texParameteri(f.TEXTURE_3D,f.TEXTURE_MIN_FILTER,u),this.minFilter=u),a!==this.wrapS&&(f.texParameteri(f.TEXTURE_3D,f.TEXTURE_WRAP_S,a),f.texParameteri(f.TEXTURE_3D,f.TEXTURE_WRAP_T,a),this.wrapS=a)}destroy(){const{gl:u}=this.context;u.deleteTexture(this.texture),this.texture=null}},i.da=function(u){return[Math.pow(u[0],1/2.2),Math.pow(u[1],1/2.2),Math.pow(u[2],1/2.2)]},i.db=RU,i.dc=cN,i.dd=LU,i.de=jN,i.df=function(u,a){return u.readFields(Fhe,{icons:[]},a)},i.dg=_A,i.dh=ex,i.di=bN,i.dj=Yb,i.dk=z2,i.dl=mg,i.dm=Eg,i.dn=Tr,i.dp=function(u){const a=u.indexOf(Zg);return a>=0?u.slice(0,a):u},i.dq=function(u){return u.indexOf(Zg)>=0},i.dr=function(u){const a=u.lastIndexOf(Zg);return a>=0?u.slice(a+1):""},i.ds=function(u){const a=[],c=u.id;return c===void 0&&a.push({message:`layers.${c}: missing required property "id"`}),u.render===void 0&&a.push({message:`layers.${c}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&a.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),a},i.dt=function(u,a,c,f){return u.type==="custom"?new Ihe(u,a):new Dhe[u.type](u,a,c,f)},i.du=Bt,i.dv=function(u){const a=u.indexOf(Zg);return a>=0?u.slice(a+1):""},i.dw=class extends dy{constructor(u,a){super(u._vectorTileFeature,u._z,u._x,u._y,u.id),u.state&&(this.state=Object.assign({},u.state)),this.target=a.target,this.namespace=a.namespace,a.properties&&(this.properties=a.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=u.source,this.sourceLayer=u.sourceLayer,this.layer=u.layer)}toJSON(){const u=super.toJSON();return u.target=this.target,u.namespace=this.namespace,u}},i.dx=zw,i.dy=vg,i.dz=function(u){return u({pluginStatus:Es,pluginURL:Gd}),zw.on("pluginStateChange",u),u},i.e=Bi,i.e$=function([u,a,c]){const f=Math.hypot(u,a,c),p=Math.atan2(u,c),x=.5*Math.PI-Math.acos(-a/f);return new Q(is(p),is(x))},i.e0=(u,a,c,f,p,x)=>{const b=u.transform,A=b.projection.name==="globe";let k;if(x.paint.get("circle-pitch-alignment")==="map")if(A){const $=p$(b.zoom,a.canonical)*b._pixelsPerMercatorPixel;k=Float32Array.from([$,0,0,$])}else k=b.calculatePixelsToTileUnitsMatrix(c);else k=new Float32Array([b.pixelsToGLUnits[0],0,0,b.pixelsToGLUnits[1]]);const M={u_camera_to_center_distance:u.transform.getCameraToCenterDistance(b.projection),u_matrix:u.translatePosMatrix(a.projMatrix,c,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ys.devicePixelRatio,u_extrude_scale:k,u_inv_rot_matrix:aue,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:x.paint.get("circle-emissive-strength")};if(A){M.u_inv_rot_matrix=f,M.u_merc_center=p,M.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],M.u_zoom_transition=jp(b.zoom);const $=p[0]*Jt,V=p[1]*Jt;M.u_up_dir=b.projection.upVector(new Pl(0,0,0),$,V)}return M},i.e1=eV,i.e2=Ds,i.e3=(u,a,c,f,p,x,b,A,k,M)=>{const $=u.transform,V=$.pitch<15?YU(.07,.7,ve((14-$.zoom)/5,0,1)):.07,q=c.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:QU(u,a,c,f),u_texsize:a.imageAtlasTexture?a.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:$.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:p,u_width_scale:x,u_floor_width_scale:b,u_image:0,u_tile_units_to_pixels:JU(a,$),u_units_to_pixels:[1/$.pixelsToGLUnits[0],1/$.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:A,u_trim_fade_range:c.paint.get("line-trim-fade-range"),u_trim_color:c.paint.get("line-trim-color").toPremultipliedRenderColor(q?null:c.lut).toArray01(),u_emissive_strength:c.paint.get("line-emissive-strength"),u_zbias_factor:V,u_tile_to_meter:We(a.tileID.canonical,0),u_ground_shadow_factor:k,u_pattern_transition:M}},i.e4=(u,a,c,f,p,x,b,A,k,M)=>{const $=u.transform,V=$.calculatePixelsToTileUnitsMatrix(a),q=c.paint.get("line-trim-color-use-theme").constantOr("default")==="none",X=$.pitch<15?YU(.07,.7,ve((14-$.zoom)/5,0,1)):.07;return{u_matrix:QU(u,a,c,f),u_pixels_to_tile_units:V,u_device_pixel_ratio:x,u_width_scale:b,u_floor_width_scale:A,u_units_to_pixels:[1/$.pixelsToGLUnits[0],1/$.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:tV(c)&&a.lineAtlasTexture?a.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:JU(a,u.transform),u_alpha_discard_threshold:0,u_trim_offset:k,u_trim_fade_range:c.paint.get("line-trim-fade-range"),u_trim_color:c.paint.get("line-trim-color").toPremultipliedRenderColor(q?null:c.lut).toArray01(),u_emissive_strength:c.paint.get("line-emissive-strength"),u_zbias_factor:X,u_tile_to_meter:We(a.tileID.canonical,0),u_ground_shadow_factor:M}},i.e5=st,i.e6=h1,i.e7=$e,i.e8=rf,i.e9=yA,i.eA=DN,i.eB=AA,i.eC=TA,i.eD=[1,1,1],i.eE=ix,i.eF=ut,i.eG=function(u,a,c,f){var p=a[0],x=a[1],b=a[2],A=a[3];return u[0]=p+f*(c[0]-p),u[1]=x+f*(c[1]-x),u[2]=b+f*(c[2]-b),u[3]=A+f*(c[3]-A),u},i.eH=Z_,i.eI=oc,i.eJ=Zd,i.eK=function(u,a,c,f,p,x,b,A,k,M,$,V,q,X,Y,se){var ce=new _(16);return ce[0]=u,ce[1]=a,ce[2]=c,ce[3]=f,ce[4]=p,ce[5]=x,ce[6]=b,ce[7]=A,ce[8]=k,ce[9]=M,ce[10]=$,ce[11]=V,ce[12]=q,ce[13]=X,ce[14]=Y,ce[15]=se,ce},i.eL=G,i.eM=e1,i.eN=Yg,i.eO=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Mt(1/0,1/0),max:new Mt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(u,a=!1){const c=K$(new Mt(0,0),new Mt(Jt,Jt),u),f=[];if(a&&!Vj(c,this._globalClipBounds))return f;for(const p of this._activeRegions){if(p.hiddenByOverlap||!Vj(c,p))continue;const x=Nue(p.min,p.max,u);f.push({min:x.min,max:x.max,sourceId:this._sourceIds[p.priority],footprint:p.footprint,footprintTileId:p.tileId,order:p.order,clipMask:p.clipMask,clipScope:p.clipScope})}return f}setSources(u){this._setSources(u.map(a=>({getSourceId:()=>a.cache.id,getFootprints:()=>{const c=[];for(const f of a.cache.getVisibleCoordinates()){const p=a.cache.getTile(f).buckets[a.layer];p&&p.updateFootprints(f.toUnwrapped(),c)}return c},getOrder:()=>a.order,getClipMask:()=>a.clipMask,getClipScope:()=>a.clipScope})))}_addSource(u){const a=u.getFootprints();if(a.length===0)return;const c=u.getOrder(),f=u.getClipMask(),p=u.getClipScope();for(const x of a){if(!x.footprint)continue;const b=K$(x.footprint.min,x.footprint.max,x.id);this._activeRegions.push({min:b.min,max:b.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:x.id,footprint:x.footprint,order:c,clipMask:f,clipScope:p})}this._sourceIds.push(u.getSourceId())}_computeReplacement(){this._activeRegions.sort((a,c)=>a.priority-c.priority||pA(a.min,c.min)||pA(a.max,c.max)||a.order-c.order||a.clipMask-c.clipMask||function(f,p){const x=(b,A)=>b+A;return f.length-p.length||f.reduce(x,"").localeCompare(p.reduce(x,""))}(a.clipScope,c.clipScope));let u=this._activeRegions.length!==this._prevRegions.length;if(!u){let a=0;for(;!u&&a!==this._activeRegions.length;){const c=this._activeRegions[a],f=this._prevRegions[a];u=c.priority!==f.priority||!H$(c,f)||c.order!==f.order||c.clipMask!==f.clipMask||!Vo(c.clipScope,f.clipScope),this._activeRegions[a].hiddenByOverlap=f.hiddenByOverlap,++a}}if(u){++this._updateTime;for(const c of this._activeRegions)c.order!==v1&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,c.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,c.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,c.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,c.max.y));const a=c=>{const f=this._activeRegions;if(c>=f.length)return c;const p=f[c].priority;for(;c<f.length&&f[c].priority===p;)++c;return c};if(this._sourceIds.length>1){let c=0,f=a(c);for(;c!==f;){let p=c;const x=c;for(;p!==f;){const b=this._activeRegions[p];b.hiddenByOverlap=!1;for(let A=0;A<x;A++){const k=this._activeRegions[A];if(!k.hiddenByOverlap&&b.order===v1&&Vj(b,k)&&(b.hiddenByOverlap=Z$(b.footprint,b.tileId,k.footprint,k.tileId),b.hiddenByOverlap))break}++p}c=f,f=a(c)}}}}_setSources(u){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let a=u.length-1;a>=0;a--)this._addSource(u[a]);this._computeReplacement()}},i.eP=v1,i.eQ=class{constructor(u){this._createGrid(u),this._createPoles(u)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const u of this._poleSegments)u.destroy();for(const u of this._gridSegments)u.withSkirts.destroy(),u.withoutSkirts.destroy()}_fillGridMeshWithLods(u,a){const c=new Ls,f=new Gi,p=[],x=u+1+2,b=a[0]+1,A=a[0]+1+(1+a.length),k=(M,$,V)=>{let q=M===x-1?M-2:M===0?M:M-1;return q+=V?24575:0,[q,$]};for(let M=0;M<x;++M)c.emplaceBack(...k(M,0,!0));for(let M=0;M<b;++M)for(let $=0;$<x;++$)c.emplaceBack(...k($,M,($===0||$===x-1)&&!0));for(let M=0;M<a.length;++M){const $=a[M];for(let V=0;V<x;++V)c.emplaceBack(...k(V,$,!0))}for(let M=0;M<a.length;++M){const $=f.length,V=a[M]+1+2,q=new Gi;for(let se=0;se<V-1;se++){const ce=se===V-2,he=ce?x*(A-a.length+M-se):x;for(let be=0;be<x-1;be++){const Ee=se*x+be;se===0||ce||be===0||be===x-2?(q.emplaceBack(Ee+1,Ee,Ee+he),q.emplaceBack(Ee+he,Ee+he+1,Ee+1)):(f.emplaceBack(Ee+1,Ee,Ee+he),f.emplaceBack(Ee+he,Ee+he+1,Ee+1))}}const X=ta.simpleSegment(0,$,c.length,f.length-$);for(let se=0;se<q.uint16.length;se+=3)f.emplaceBack(q.uint16[se],q.uint16[se+1],q.uint16[se+2]);const Y=ta.simpleSegment(0,$,c.length,f.length-$);p.push({withoutSkirts:X,withSkirts:Y})}return{vertices:c,indices:f,segments:p}}_createGrid(u){const a=this._fillGridMeshWithLods(v,w);this._gridSegments=a.segments,this._gridBuffer=u.createVertexBuffer(a.vertices,c$.members),this._gridIndexBuffer=u.createIndexBuffer(a.indices,!0)}_createPoles(u){const a=new Gi;for(let b=0;b<=v;b++)a.emplaceBack(0,b+1,b+2);this._poleIndexBuffer=u.createIndexBuffer(a,!0);const c=new tf,f=new tf,p=new tf,x=new tf;this._poleSegments=[];for(let b=0,A=0;b<y;b++){const k=360/(1<<b);c.emplaceBack(0,-Fs,0,.5,0),f.emplaceBack(0,-Fs,0,.5,1),p.emplaceBack(0,-Fs,0,.5,.5),x.emplaceBack(0,-Fs,0,.5,.5);for(let M=0;M<=v;M++){let $=M/v,V=0;const q=qr(0,k,$),[X,Y,se]=L(nue,iue,q,Fs);c.emplaceBack(X,Y,se,$,V),f.emplaceBack(X,Y,se,$,1-V);const ce=bn(q);$=.5+.5*Math.sin(ce),V=.5+.5*Math.cos(ce),p.emplaceBack(X,Y,se,$,V),x.emplaceBack(X,Y,se,$,1-V)}this._poleSegments.push(ta.simpleSegment(A,0,66,64)),A+=66}this._poleNorthVertexBuffer=u.createVertexBuffer(c,U_,!1),this._poleSouthVertexBuffer=u.createVertexBuffer(f,U_,!1),this._texturedPoleNorthVertexBuffer=u.createVertexBuffer(p,U_,!1),this._texturedPoleSouthVertexBuffer=u.createVertexBuffer(x,U_,!1)}getGridBuffers(u,a){return[this._gridBuffer,this._gridIndexBuffer,a?this._gridSegments[u].withSkirts:this._gridSegments[u].withoutSkirts]}getPoleBuffers(u,a){return[a?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,a?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[u]]}},i.eR=W$,i.eS=ct,i.eT=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.eU=fe,i.eV=De,i.eW=function(u,a,c){return u[0]=a[0]/c[0],u[1]=a[1]/c[1],u[2]=a[2]/c[2],u},i.eX=At,i.eY=z,i.eZ=qe,i.e_=Ae,i.ea=uU,i.eb=Mp,i.ec=eU,i.ed=Q$,i.ee=Be,i.ef=function(u,a){if(u===a){var c=a[1],f=a[2],p=a[3],x=a[6],b=a[7],A=a[11];u[1]=a[4],u[2]=a[8],u[3]=a[12],u[4]=c,u[6]=a[9],u[7]=a[13],u[8]=f,u[9]=x,u[11]=a[14],u[12]=p,u[13]=b,u[14]=A}else u[0]=a[0],u[1]=a[4],u[2]=a[8],u[3]=a[12],u[4]=a[1],u[5]=a[5],u[6]=a[9],u[7]=a[13],u[8]=a[2],u[9]=a[6],u[10]=a[10],u[11]=a[14],u[12]=a[3],u[13]=a[7],u[14]=a[11],u[15]=a[15];return u},i.eg=khe,i.eh=Tn,i.ei=r1,i.ej=256,i.ek=Rj,i.el=Sl,i.em=Z,i.en=function(u,a){return u[0]=a[0],u[1]=a[1],u[2]=a[2],u[3]=a[4],u[4]=a[5],u[5]=a[6],u[6]=a[8],u[7]=a[9],u[8]=a[10],u},i.eo=tf,i.ep=Qw,i.eq=R2,i.er=function(u,a,c,f,p){return ve((u-a)/(c-a)*(p-f)+f,f,p)},i.es=pn,i.et=function(u,a){var c=a[0],f=a[1],p=a[2],x=a[3],b=a[4],A=a[5],k=a[6],M=a[7],$=a[8],V=$*b-A*M,q=-$*x+A*k,X=M*x-b*k,Y=c*V+f*q+p*X;return Y?(u[0]=V*(Y=1/Y),u[1]=(-$*f+p*M)*Y,u[2]=(A*f-p*b)*Y,u[3]=q*Y,u[4]=($*c-p*k)*Y,u[5]=(-A*c+p*x)*Y,u[6]=X*Y,u[7]=(-M*c+f*k)*Y,u[8]=(b*c-f*x)*Y,u):null},i.eu=2,i.ev=Ge,i.ew=tr,i.ex=ne,i.ey=function(u,a){var c=new _(3);ne(c,a);var f=1/c[0],p=1/c[1],x=1/c[2],b=a[0]*f,A=a[1]*p,k=a[2]*x,M=a[4]*f,$=a[5]*p,V=a[6]*x,q=a[8]*f,X=a[9]*p,Y=a[10]*x,se=b+$+Y,ce=0;return se>0?(ce=2*Math.sqrt(se+1),u[3]=.25*ce,u[0]=(V-X)/ce,u[1]=(q-k)/ce,u[2]=(A-M)/ce):b>$&&b>Y?(ce=2*Math.sqrt(1+b-$-Y),u[3]=(V-X)/ce,u[0]=.25*ce,u[1]=(A+M)/ce,u[2]=(q+k)/ce):$>Y?(ce=2*Math.sqrt(1+$-b-Y),u[3]=(q-k)/ce,u[0]=(A+M)/ce,u[1]=.25*ce,u[2]=(V+X)/ce):(ce=2*Math.sqrt(1+Y-b-$),u[3]=(A-M)/ce,u[0]=(q+k)/ce,u[1]=(V+X)/ce,u[2]=.25*ce),u},i.ez=function(u,a){var c=2*Math.acos(a[3]),f=Math.sin(c/2);return f>g?(u[0]=a[0]/f,u[1]=a[1]/f,u[2]=a[2]/f):(u[0]=1,u[1]=0,u[2]=0),c},i.f=function(u){return btoa(encodeURIComponent(u).replace(/%([0-9A-F]{2})/g,(a,c)=>String.fromCharCode(+("0x"+c))))},i.f0=rr,i.f1=iN,i.f2=function(u){const a=u.navigator?u.navigator.userAgent:null;return!!function(c){if(Ea==null){const f=c.navigator?c.navigator.userAgent:null;Ea=!!c.safari||!(!f||!(/\b(iPad|iPhone|iPod)\b/.test(f)||f.match("Safari")&&!f.match("Chrome")))}return Ea}(u)&&!(!a||!(a.match("Version/15.4")||a.match("Version/15.5")||a.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},i.f3=function(u,a){yg=u,Ms=a},i.f4=Nj,i.f5=g$,i.f6=function(u){const a=[0,0,0],c=j(new Float64Array(16));return R(c,u.pixelMatrix,u.globeMatrix),Ut(a,a,c),new Mt(a[0],a[1])},i.f7=function(){const u=E1;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(Xj),E1=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.f8=function(){_A().acquire(Xj)},i.f9=Bw,i.fA=Lt,i.fB=function(u){let a=0;if(new Uint32Array(u,0,1)[0]!==PU){const c=new Uint32Array(u,0,7),[,,f,p,x,b]=c;a=c.byteLength+p+x+b+x,(f!==u.byteLength||a>=u.byteLength)&&Ir("Invalid b3dm header information.")}return IU(u,a)},i.fC=function(u,a){const c=cN(u);for(const f of c){for(const p of f.meshes)dde(p);f.lights&&(f.lightMeshIndex=f.meshes.length,f.meshes.push(hde(f.lights,a)))}return c},i.fD=GA,i.fE=ca,i.fF=wU,i.fG=el,i.fH=Qs,i.fI=function(u){Fh(),Ss!=null&&Ss.then(a=>{a.keys().then(c=>{for(let f=0;f<c.length-u;f++)a.delete(c[f]).catch(p=>Ir(p.message))}).catch(c=>Ir(c.message))}).catch(a=>Ir(a.message))},i.fa=function(u,a,c=!1){if(Es===Qs.deferred||Es===Qs.loading||Es===Qs.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Gd=Ys.resolveURL(u),Es=Qs.deferred,Lw=a,Fw(),c||$w()},i.fb=function(u){G_=Ys.resolveURL(u),H_||(H_=new W_(_A(),new Bu)),H_.broadcast("setMeshoptUrl",G_)},i.fc=TU,i.fd=function(u){Jj=Ys.resolveURL(u),H_||(H_=new W_(_A(),new Bu)),H_.broadcast("setDracoUrl",Jj)},i.fe=EU,i.ff=S1,i.fg=function(u){const a=zu();if(!a)return;const c=a.delete(gg);u&&c.then(()=>u()).catch(u)},i.fh=oy,i.fi=gr,i.fj=Np,i.fk=ed,i.fl=G6,i.fm=H6,i.fn=HU,i.fo=cr,i.fp="hd_road_elevation",i.fq=Zr,i.fr=Kt,i.fs=af,i.ft=xN,i.fu=cy,i.fv=function(u,a,c,f,p,x,b,A=1,k,M,$){u.createArrays(),u.tilePixelRatio=Jt/(512*u.overscaling),u.compareText={},u.iconsNeedLinear=!1;const V=u.layers[0].layout,q=u.layers[0]._unevaluatedLayout._values,X={};X.scaleFactor=A,X.textSizeScaleRange=V.get("text-size-scale-range"),X.iconSizeScaleRange=V.get("icon-size-scale-range");const[Y,se]=X.textSizeScaleRange,[ce,he]=X.iconSizeScaleRange;X.textScaleFactor=ve(X.scaleFactor,Y,se),X.iconScaleFactor=ve(X.scaleFactor,ce,he);const be=q["text-size"],Ee=q["icon-size"];if(u.textSizeData.kind==="composite"){const{minZoom:nt,maxZoom:Et}=u.textSizeData;X.compositeTextSizes=[be.possiblyEvaluate(new Ri(nt,{worldview:$}),x),be.possiblyEvaluate(new Ri(Et,{worldview:$}),x)]}if(u.iconSizeData.kind==="composite"){const{minZoom:nt,maxZoom:Et}=u.iconSizeData;X.compositeIconSizes=[Ee.possiblyEvaluate(new Ri(nt,{worldview:$}),x),Ee.possiblyEvaluate(new Ri(Et,{worldview:$}),x)]}X.layoutTextSize=be.possiblyEvaluate(new Ri(b+1,{worldview:$}),x),X.layoutIconSize=Ee.possiblyEvaluate(new Ri(b+1,{worldview:$}),x),X.textMaxSize=be.possiblyEvaluate(new Ri(18,{worldview:$}),x);const Oe=V.get("symbol-placement"),Ue=V.get("text-rotation-alignment")==="map"&&Oe!=="point",Fe=V.get("text-size");let Ke=!1;const Qe=[];for(const nt of u.features){const Et=V.get("text-font").evaluate(nt,{},x).join(","),ft=Fe.evaluate(nt,{},x)*X.textScaleFactor,Tt=X.layoutTextSize.evaluate(nt,{},x)*X.textScaleFactor,It=X.layoutIconSize.evaluate(nt,{},x)*X.iconScaleFactor,Dt={horizontal:{},vertical:void 0},Xt=nt.text;let Vt,jt=[0,0];if(Xt){const vn=Xt.toString(),Bn=V.get("text-letter-spacing").evaluate(nt,{},x)*To,nn=V.get("text-line-height").evaluate(nt,{},x)*To,Hn=L2(vn)?Bn:0,Kn=V.get("text-anchor").evaluate(nt,{},x),Yi=V.get("text-variable-anchor");if(!Yi){const Ct=V.get("text-radial-offset").evaluate(nt,{},x);if(Ct)jt=kV(Kn,[Ct*To,SN]);else{const or=V.get("text-offset").evaluate(nt,{},x);jt=[or[0]*To,or[1]*To]}}let ze=Ue?"center":V.get("text-justify").evaluate(nt,{},x);const Ne=Oe==="point",Pt=Ne?V.get("text-max-width").evaluate(nt,{},x)*To:1/0,nr=Ct=>{u.allowVerticalPlacement&&Nw(vn)&&(Dt.vertical=gN(Xt,a,c,p,Et,Pt,nn,Kn,Ct,Hn,jt,kl.vertical,!0,Tt,ft,k))};if(!Ue&&Yi){const Ct=ze==="auto"?Yi.map(Ar=>EN(Ar)):[ze];let or=!1;for(let Ar=0;Ar<Ct.length;Ar++){const Er=Ct[Ar];if(!Dt.horizontal[Er])if(or)Dt.horizontal[Er]=Dt.horizontal[0];else{const an=gN(Xt,a,c,p,Et,Pt,nn,"center",Er,Hn,jt,kl.horizontal,!1,Tt,ft,k);an&&(Dt.horizontal[Er]=an,or=an.positionedLines.length===1)}}nr("left")}else{if(ze==="auto"&&(ze=EN(Kn)),Ne||V.get("text-writing-mode").indexOf("horizontal")>=0||!Nw(vn)){const Ct=gN(Xt,a,c,p,Et,Pt,nn,Kn,ze,Hn,jt,kl.horizontal,!1,Tt,ft,k);Ct&&(Dt.horizontal[ze]=Ct)}nr(Ne?"left":ze)}}let $t,xt,vt,zt,Ht,Nt,pr=!1;const _r=V.get("icon-text-fit").evaluate(nt,{},x);if(nt.icon&&nt.icon.hasPrimary()){const vn=N1(nt.icon,u.iconSizeData,q["icon-size"],x,u.zoom,nt,k,X.iconScaleFactor,$);$t=vn.iconPrimary,vt=vn.iconSecondary;const Bn=$t.toString();if(xt=f.get(Bn),xt&&(Ht=V.get("icon-offset").evaluate(nt,{},x),Nt=V.get("icon-anchor").evaluate(nt,{},x),Vt=IA(p.get(Bn),vt?p.get(vt.toString()):void 0,Ht,Nt),pr=xt.sdf,u.sdfIcons===void 0?u.sdfIcons=xt.sdf:u.sdfIcons!==xt.sdf&&Ir("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(xt.pixelRatio!==u.pixelRatio||V.get("icon-rotate").constantOr(1)!==0)&&(u.iconsNeedLinear=!0)),vt){const nn=vt.toString();zt=f.get(nn)}}Ke=Ke||!(!nt.icon||!nt.icon.hasSecondary());const ur=TN(Dt.horizontal)||Dt.vertical;u.iconsInText||(u.iconsInText=!!ur&&ur.iconsInText);const ar=Tt*X.textScaleFactor/To,{defaultShapedIcon:Xr,verticallyShapedIcon:sr}=ghe(u,Vt,V,nt,x,Dt,ar,Ht,_r);_r!=="none"&&Vt&&(mV(Vt)||gV(Vt))&&(DA(0,xt,$t,Vt,Xr,_r,M,f,p),DA(0,zt,vt,Vt,Xr,_r,M,f,p),sr&&(DA(0,xt,$t,Vt,sr,_r,M,f,p),DA(0,zt,vt,Vt,sr,_r,M,f,p))),Vt=Xr;const{iconBBox:Or,iconVerticalBBox:Qr}=fhe(u,Vt,sr,V,nt,x,It,Ht,X,p,Nt);Qe.push({feature:nt,shapedTextOrientations:Dt,shapedText:ur,shapedIcon:Vt,iconPrimary:$t,iconSecondary:vt,iconOffset:Ht,iconAnchor:Nt,verticallyShapedIcon:sr,layoutTextSize:Tt,layoutIconSize:It,textOffset:jt,isSDFIcon:pr,iconTextFit:_r,iconCollisionBounds:Or,iconVerticalCollisionBounds:Qr})}return{featureData:Qe,sizes:X,hasAnySecondaryIcon:Ke,textAlongLine:Ue,symbolPlacement:Oe}},i.fw=EV,i.fx=function(u,a,c,f,p,x,b,A,k,M){u.iconAtlasPositions=M.iconPositions;const{featureData:$,hasAnySecondaryIcon:V,sizes:q,textAlongLine:X,symbolPlacement:Y}=a;for(const se of $){const{shapedIcon:ce,verticallyShapedIcon:he,feature:be,shapedTextOrientations:Ee,shapedText:Oe,layoutTextSize:Ue,textOffset:Fe,isSDFIcon:Ke,iconPrimary:Qe,iconSecondary:nt,iconTextFit:Et,iconOffset:ft,iconCollisionBounds:Tt,iconVerticalCollisionBounds:It}=se;RV(ce,M.iconPositions,Qe,nt),RV(he,M.iconPositions,Qe,nt),mhe(Ee,M.iconPositions),phe(Qe,nt,M.iconPositions),(Oe||ce)&&yhe(u,be,Ee,ce,he,k,q,Ue,0,Fe,Ke,f,p,b,A,V,Et,ft,X,Y,Tt,It)}c&&u.generateCollisionDebugBuffers(x,u.collisionBoxArray,q.textScaleFactor)},i.fy=br,i.fz=JA,i.g=function(u,a){return vg(Object.assign(u,{method:"GET"}),a)},i.h=function(u){return u.indexOf("mapbox:")===0},i.i=function(u){return Bi.API_STYLE_REGEX.test(u)&&!as(u)},i.j=Qa,i.k=Bv,i.l=function(u){return decodeURIComponent(atob(u).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.m=function(u,a){return vg(Object.assign(u,{type:"json"}),a)},i.n=Qb,i.o=Ys,i.p=function(u,a){return vg(Object.assign(u,{method:"POST"}),a)},i.q=Go,i.r=Xs,i.s=function(u){try{const a=self[u];return a.setItem("_mapbox_test_",1),a.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=function(){return Yj||(Yj=new oy),Yj},i.u=function(){return function u(a){return a?(a^Math.random()*(16>>a/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,u)}()},i.v=function(u){return!!u&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(u)},i.w=Ir,i.x=$N,i.y=Tg,i.z=_l}),l(["./shared"],function(i){function g(ct){const fe=ct?ct.url.toString():void 0;return fe?performance.getEntriesByName(fe):[]}function _(ct){if(typeof ct=="number"||typeof ct=="boolean"||typeof ct=="string"||ct==null)return JSON.stringify(ct);if(Array.isArray(ct)){let ve="[";for(const Me of ct)ve+=`${_(Me)},`;return`${ve}]`}let fe="{";for(const ve of Object.keys(ct).sort())fe+=`${ve}:${_(ct[ve])},`;return`${fe}}`}function S(ct){let fe="";for(const ve of i.bw)fe+=`/${_(ct[ve])}`;return fe}class E{constructor(fe){this.keyCache={},this._layers={},this._layerConfigs={},fe&&this.replace(fe)}replace(fe,ve){this._layerConfigs={},this._layers={},this.update(fe,[],ve)}update(fe,ve,Me){this._options=Me;for(const Ye of fe)this._layerConfigs[Ye.id]=Ye,(this._layers[Ye.id]=i.dt(Ye,this.scope,null,this._options)).compileFilter(Me),this.keyCache[Ye.id]&&delete this.keyCache[Ye.id];for(const Ye of ve)delete this.keyCache[Ye],delete this._layerConfigs[Ye],delete this._layers[Ye];this.familiesBySource={};const Je=function(Ye,at){const _t={};for(let yt=0;yt<Ye.length;yt++){const Kt=Ye[yt];let Bt=at&&at[Kt.id];Bt||(Kt.type==="symbol"?Bt=Kt.id:(Bt=S(Kt),Kt.type==="line"&&Kt.paint&&function Kr(Wr){return typeof Wr=="string"&&Wr==="line-progress"||(Array.isArray(Wr)?Wr.some(Kr):!(!Wr||typeof Wr!="object")&&Object.values(Wr).some(Kr))}(Kt.paint["line-width"])&&(Bt+=`/${_(Kt.paint["line-width"])}`))),at&&(at[Kt.id]=Bt);let Tr=_t[Bt];Tr||(Tr=_t[Bt]=[]),Tr.push(Kt)}const st=[];for(const yt in _t)st.push(_t[yt]);return st}(Object.values(this._layerConfigs),this.keyCache);for(const Ye of Je){const at=Ye.map(Tr=>this._layers[Tr.id]),_t=at[0];if(_t.visibility==="none")continue;const st=_t.source||"";let yt=this.familiesBySource[st];yt||(yt=this.familiesBySource[st]={});const Kt=_t.sourceLayer||"_geojsonTileLayer";let Bt=yt[Kt];Bt||(Bt=yt[Kt]=[]),Bt.push(at)}}}const T=1*i.fk;class C{constructor(fe){const ve={},Me=[];for(const _t in fe){const st=fe[_t],yt=ve[_t]={};for(const Kt in st.glyphs){const Bt=st.glyphs[+Kt];if(!Bt||Bt.bitmap.width===0||Bt.bitmap.height===0)continue;const Tr=Bt.metrics.localGlyph?T:1,Kr={x:0,y:0,w:Bt.bitmap.width+2*Tr,h:Bt.bitmap.height+2*Tr};Me.push(Kr),yt[Kt]=Kr}}const{w:Je,h:Ye}=i.G(Me),at=new i.fj({width:Je||1,height:Ye||1});for(const _t in fe){const st=fe[_t];for(const yt in st.glyphs){const Kt=st.glyphs[+yt];if(!Kt||Kt.bitmap.width===0||Kt.bitmap.height===0)continue;const Bt=ve[_t][yt],Tr=Kt.metrics.localGlyph?T:1;i.fj.copy(Kt.bitmap,at,{x:0,y:0},{x:Bt.x+Tr,y:Bt.y+Tr},Kt.bitmap)}}this.image=at,this.positions=ve}}function N(ct,fe,ve){ct[fe]?ve&&(ct[fe].center=ve):ct[fe]={floorIds:new Set,center:ve||[0,0],floors:{}}}function I(ct,fe,ve,Me){for(const Je of fe)N(ct,Je),ct[Je].floors[ve]=Me,ct[Je].floorIds.add(ve)}function j(ct){return{id:ct.properties.id.toString(),center:ct.properties.center.toString().split(";").map(Number)}}function D(ct){return{id:ct.properties.id.toString(),isDefault:!!ct.properties.is_default&&ct.properties.is_default,connections:ct.properties.connected_floor_ids?new Set(ct.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:ct.properties.conflicted_floor_ids?new Set(ct.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:ct.properties.building_ids?new Set(ct.properties.building_ids.toString().split(";")):new Set,name:ct.properties.name.toString(),zIndex:ct.properties.z_index}}function R(ct,fe){return fe.every(ve=>ct.properties&&ct.properties[ve]!=null)}function F(ct){return R(ct,["type","id","name"])&&ct.properties.type==="building"}function B(ct){return R(ct,["type","id","name","z_index"])&&ct.properties.type==="floor"}i.fi(C,"GlyphAtlas");class U{constructor(fe){this.tileID=new i.aP(fe.tileID.overscaledZ,fe.tileID.wrap,fe.tileID.canonical.z,fe.tileID.canonical.x,fe.tileID.canonical.y),this.tileZoom=fe.tileZoom,this.uid=fe.uid,this.zoom=fe.zoom,this.lut=fe.lut,this.canonical=fe.tileID.canonical,this.pixelRatio=fe.pixelRatio,this.tileSize=fe.tileSize,this.source=fe.source,this.scope=fe.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=fe.showCollisionBoxes,this.collectResourceTiming=!!fe.request&&fe.request.collectResourceTiming,this.promoteId=fe.promoteId,this.isSymbolTile=fe.isSymbolTile,this.tileTransform=i.aY(fe.tileID.canonical,fe.projection),this.projection=fe.projection,this.worldview=fe.worldview,this.localizableLayerIds=fe.localizableLayerIds,this.brightness=fe.brightness,this.extraShadowCaster=!!fe.extraShadowCaster,this.tessellationStep=fe.tessellationStep,this.scaleFactor=fe.scaleFactor,this.worldview=fe.worldview,this.indoor=fe.indoor}parse(fe,ve,Me,Je,Ye,at){this.status="parsing",this.data=fe,this.collisionBoxArray=new i.b2;const _t=new i.fl(Object.keys(fe.layers).sort()),st=new i.fm(this.tileID,this.promoteId);st.bucketLayerIDs=[];const yt={},Kt=new i.fn(256,256),Bt={featureIndex:st,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Kt,availableImages:Me,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Ir=this.indoor.indoorState.activeFloorsVisible,yn=function(En,pi,ca){const za=function(ci,Nn){if(!ci)return i.w("No source layers defined in indoor specification"),Nn;if(ci.size===0)return Nn;const zi=ci.difference(Nn);for(const aa of zi)i.w(`Missing source layer required in indoor specification: ${aa}`);return Nn.intersection(Nn)}(pi.sourceLayers,new Set(Object.keys(En.layers))),Ea=pi.indoorState,xa=function(ci,Nn,zi,aa){const yi=new Set,Bi=new Set,Qa=new Set,as=new Map,Yl={},Lh=lo=>{const Jl=as.get(lo)||new Set;for(const ws of yi)if((as.get(ws)||new Set).has(lo)||Jl.has(ws))return!0;return!1};for(const lo of Nn){const Jl=ci.layers[lo];if(Jl)for(let ws=0;ws<Jl.length;ws++){const Cc=Jl.feature(ws);if(F(Cc)){const{id:Xs,center:Ys}=j(Cc);N(Yl,Xs,Ys),yi.add(Xs)}else if(B(Cc)){const{id:Xs,isDefault:Ys,connections:Fv,conflicts:mg,buildings:gg,name:yg,zIndex:Ms}=D(Cc);I(Yl,gg,Xs,{name:yg,zIndex:Ms}),as.set(Xs,mg),(Xs===aa||Fv.has(aa))&&yi.add(Xs),Bi.add(Xs),Ys&&Qa.add(Xs)}}else i.w(`indoor source layer not found: ${lo}`)}if(zi)for(const lo of zi)Bi.has(lo)&&(Lh(lo)||yi.add(lo));for(const lo of Qa)yi.has(lo)||Lh(lo)||yi.add(lo);return{buildings:Yl,activeFloors:yi}}(En,za,Ea.lastActiveFloors,Ea.selectedFloorId);return ca.send("setIndoorData",xa),xa}(fe,this.indoor,Ye);Bt.activeFloors=Ir?yn.activeFloors:void 0}const Tr=[],Kr=ve.familiesBySource[this.source];for(const Ir in Kr){const yn=fe.layers[Ir];if(!yn)continue;let En=!1,pi=!1,ca=!1;for(const ci of Kr[Ir])ci[0].type==="symbol"?En=!0:pi=!0,ci[0].is3D()&&ci[0].type!=="model"&&(ca=!0);if(this.extraShadowCaster&&!ca||this.isSymbolTile===!0&&!En||this.isSymbolTile===!1&&!pi)continue;yn.version===1&&i.w(`Vector tile source "${this.source}" layer "${Ir}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const za=_t.encode(Ir),Ea=[];let xa=!1;for(let ci=0,Nn=0;ci<yn.length;ci++){const zi=yn.feature(ci),aa=st.getId(zi,Ir);if(this.localizableLayerIds&&this.localizableLayerIds.has(Ir)){const yi=zi.properties?zi.properties.worldview:null;if(this.worldview&&typeof yi=="string")if(yi==="all")zi.properties.$localized=!0;else{if(!yi.split(",").includes(this.worldview))continue;zi.properties.$localized=!0,zi.properties.worldview=this.worldview}}!xa&&zi.properties&&zi.properties.hasOwnProperty(i.fo)&&(xa=!0),Ea.push({feature:zi,id:aa,index:Nn,sourceLayerIndex:za}),Nn++}xa&&!Bt.elevationFeatures&&fe.layers.hasOwnProperty(i.fp)&&(Bt.elevationFeatures=i.fq.parseFrom(fe.layers[i.fp],this.canonical));for(const ci of Kr[Ir]){const Nn=ci[0];if(this.extraShadowCaster&&(!Nn.is3D()||Nn.type==="model")||this.isSymbolTile!==void 0&&Nn.type==="symbol"!==this.isSymbolTile||Nn.minzoom&&this.zoom<Math.floor(Nn.minzoom)||Nn.maxzoom&&this.zoom>=Nn.maxzoom||Nn.visibility==="none")continue;Z(ci,this.zoom,Bt.brightness,Me,this.worldview);const zi=yt[Nn.id]=Nn.createBucket({index:st.bucketLayerIDs.length,layers:ci,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:za,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Je,worldview:this.worldview});st.bucketLayerIDs.push(ci.map(yi=>i.B(yi.id,yi.scope)));let aa=zi.prepare?zi.prepare():null;aa!=null?(aa=aa.then(()=>zi.populate(Ea,Bt,this.tileID.canonical,this.tileTransform)),Tr.push(aa)):zi.populate(Ea,Bt,this.tileID.canonical,this.tileTransform)}}const Wr=()=>{let Ir,yn,En,pi,ca,za;Kt.trim();const Ea={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},xa=()=>{if(Ir)return this.status="done",at(Ir);if(this.extraShadowCaster)this.status="done",at(null,{buckets:Object.values(yt).filter(Nn=>!Nn.isEmpty()),featureIndex:st,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Bt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(yn&&En&&pi){const Nn=new C(yn),zi=new Map;for(const[Bi,Qa]of En.entries()){const{imagePosition:as}=i.ft(Bi,Qa,i.fu);zi.set(Bi,as)}const aa={};for(const Bi in yt){const Qa=yt[Bi];Qa instanceof i.b3&&(Z(Qa.layers,this.zoom,Bt.brightness,Me,this.worldview),aa[Bi]=i.fv(Qa,yn,Nn.positions,En,zi,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,ca,this.worldview))}const yi={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ye,En,ca,()=>{yi.iconsPending=!1,ci(aa,Nn,yi)}),this.rasterizeIfNeeded(Ye,pi,za,()=>{yi.patternsPending=!1,ci(aa,Nn,yi)})}},ci=(Nn,zi,aa,yi)=>{if(aa.iconsPending||aa.patternsPending)return;const Bi=new i.fw(En,pi,this.lut);for(const Qa in yt){const as=yt[Qa];if(Qa in Nn)i.fx(as,Nn[Qa],this.showCollisionBoxes,Me,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,En,Bi);else if(as.hasPattern&&(as instanceof i.b9||as instanceof i.ba||as instanceof i.e9)){Z(as.layers,this.zoom,Bt.brightness,Me,this.worldview);const Yl=Object.fromEntries(Bi.patternPositions);as.addFeatures(Bt,this.tileID.canonical,Yl,Me,this.tileTransform,this.brightness)}}this.status="done",at(null,{buckets:Object.values(yt).filter(Qa=>!Qa.isEmpty()),featureIndex:st,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:zi.image,lineAtlas:Kt,imageAtlas:Bi,brightness:Bt.brightness})};if(!this.extraShadowCaster){const Nn=i.fr(Bt.glyphDependencies,yi=>Object.keys(yi).map(Number));Object.keys(Nn).length?Ye.send("getGlyphs",{uid:this.uid,stacks:Nn},(yi,Bi)=>{Ir||(Ir=yi,yn=Bi,xa())},void 0,!1,Ea):yn={};const zi=Array.from(Bt.iconDependencies.keys()).map(yi=>i.I.parse(yi));zi.length?Ye.send("getImages",{images:zi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(yi,Bi)=>{Ir||(Ir=yi,En=new Map,ca=this.updateImageMapAndGetImageTaskQueue(En,Bi,Bt.iconDependencies),xa())},void 0,!1,Ea):(En=new Map,ca=new Map);const aa=Array.from(Bt.patternDependencies.keys()).map(yi=>i.I.parse(yi));aa.length?Ye.send("getImages",{images:aa,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(yi,Bi)=>{Ir||(Ir=yi,pi=new Map,za=this.updateImageMapAndGetImageTaskQueue(pi,Bi,Bt.patternDependencies),xa())},void 0,!1,Ea):(pi=new Map,za=new Map)}if(Bt.elevationFeatures&&Bt.elevationFeatures.length>0){const Nn=[];for(const aa of Object.values(yt))if(aa instanceof i.ba){const yi=aa.getUnevaluatedPortalGraph();yi&&Nn.push(yi)}const zi=i.fs.evaluate(Nn);for(const aa of Object.values(yt))if(aa instanceof i.ba){const yi=fe.layers[_t.decode(aa.sourceLayerIndex)];aa.setEvaluatedPortalGraph(zi,yi,this.tileID.canonical,Bt.availableImages,Bt.brightness)}}xa()};Tr.length>0?Promise.allSettled(Tr).then(Wr).catch(at):Wr()}updateParameters(fe){this.scaleFactor=fe.scaleFactor,this.showCollisionBoxes=fe.showCollisionBoxes,this.projection=fe.projection,this.brightness=fe.brightness,this.tileTransform=i.aY(fe.tileID.canonical,fe.projection),this.extraShadowCaster=fe.extraShadowCaster,this.lut=fe.lut,this.worldview=fe.worldview,this.indoor=fe.indoor}rasterizeIfNeeded(fe,ve,Me,Je){Array.from(ve.values()).some(Ye=>Ye.usvg)?this.rasterize(fe,ve,Me,Je):Je()}updateImageMapAndGetImageTaskQueue(fe,ve,Me){const Je=new Map;for(const Ye of ve.keys()){const at=Me.get(Ye)||[];for(const _t of at){const st=_t.toString(),yt=ve.get(_t.id.toString());yt.usvg?Je.has(st)||(Je.set(st,_t),fe.set(st,Object.assign({},yt))):fe.set(st,yt)}}return Je}rasterize(fe,ve,Me,Je){this.rasterizeTask=fe.send("rasterizeImages",{scope:this.scope,tasks:Me},(Ye,at)=>{if(!Ye)for(const[_t,st]of at.entries()){const yt=Object.assign(ve.get(_t),{data:st});ve.set(_t,yt)}Je()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Z(ct,fe,ve,Me,Je){const Ye=new i.ac(fe,{brightness:ve,worldview:Je});for(const at of ct)at.recalculate(Ye,Me)}class J extends i.E{constructor(fe,ve,Me,Je,Ye,at,_t){super(),this.actor=fe,this.layerIndex=ve,this.availableImages=Me,this.availableModels=Je,this.loadVectorData=at||i.aL,this.loading={},this.loaded={},this.deduped=new i.aK(fe.scheduler),this.isSpriteLoaded=Ye,this.scheduler=fe.scheduler,this.brightness=_t}loadTile(fe,ve){const Me=fe.uid,Je=fe&&fe.request,Ye=Je&&Je.collectResourceTiming,at=this.loading[Me]=new U(fe);at.abort=this.loadVectorData(fe,(_t,st)=>{const yt=!this.loading[Me];if(delete this.loading[Me],at.cancelRasterize(),yt||_t||!st)return at.status="done",yt||(this.loaded[Me]=at),ve(_t);const Kt=st.rawData,Bt={},Tr=i.aM(st.responseHeaders);Tr&&Tr.expires&&(Bt.expires=Tr.expires),Tr&&Tr.cacheControl&&(Bt.cacheControl=Tr.cacheControl),at.vectorTile=st.vectorTile||new i.fy(new i.bs(Kt));const Kr=()=>{at.parse(at.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Wr,Ir)=>{if(Wr||!Ir)return ve(Wr);const yn={};if(Ye){const En=g(Je);En.length>0&&(yn.resourceTiming=JSON.parse(JSON.stringify(En)))}ve(null,Object.assign({rawTileData:Kt.slice(0),responseHeaders:st.responseHeaders},Ir,Bt,yn))})};this.isSpriteLoaded?Kr():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Kr,{type:"parseTile",isSymbolTile:fe.isSymbolTile,zoom:fe.tileZoom}):Kr()}),this.loaded=this.loaded||{},this.loaded[Me]=at})}reloadTile(fe,ve){const Me=this.loaded,Je=fe.uid;if(Me&&Me[Je]){const Ye=Me[Je];Ye.updateParameters(fe);const at=(_t,st)=>{const yt=Ye.reloadCallback;yt&&(delete Ye.reloadCallback,Ye.parse(Ye.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,yt)),ve(_t,st)};Ye.status==="parsing"?Ye.reloadCallback=at:Ye.status==="done"&&(Ye.vectorTile?Ye.parse(Ye.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,at):at())}else ve(null,void 0)}abortTile(fe,ve){const Me=fe.uid,Je=this.loading[Me];Je&&(Je.abort&&Je.abort(),delete this.loading[Me]),ve()}removeTile(fe,ve){const Me=this.loaded,Je=fe.uid;Me&&Me[Je]&&delete Me[Je],ve()}}class te{loadTile(fe,ve){const{uid:Me,encoding:Je,rawImageData:Ye,padding:at}=fe,_t=ImageBitmap&&Ye instanceof ImageBitmap?this.getImageData(Ye,at):Ye;ve(null,new i.fz(Me,_t,Je,at<1))}reloadTile(fe,ve){ve(null,null)}abortTile(fe,ve){ve()}removeTile(fe,ve){ve()}getImageData(fe,ve){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(fe.width,fe.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=fe.width,this.offscreenCanvas.height=fe.height,this.offscreenCanvasContext.drawImage(fe,0,0,fe.width,fe.height);const Me=this.offscreenCanvasContext.getImageData(-ve,-ve,fe.width+2*ve,fe.height+2*ve);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Me}}i.br.setPbf(i.bs);class ae{constructor(fe){this._mrt=new i.br(fe.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=fe.uid,this.tileID=fe.tileID,this.source=fe.source}parse(fe,ve){const Me=this._mrt;this.status="parsing",this._entireBuffer=fe;try{Me.parseHeader(fe),this._isHeaderLoaded=!0;const Je=[];for(const Ye in Me.layers){const at=Me.getLayer(Ye),_t=at.getDataRange(at.getBandList()),st=Me.createDecodingTask(_t),yt=fe.slice(_t.firstByte,_t.lastByte+1),Kt=i.br.performDecoding(yt,st).then(Bt=>st.complete(null,Bt)).catch(Bt=>st.complete(Bt,null));Je.push(Kt)}Promise.allSettled(Je).then(()=>ve(null,Me)).catch(Ye=>ve(Ye))}catch(Je){ve(Je)}}}class ne{constructor(fe){this.actor=fe,this.loading={},this.loaded={}}loadTile(fe,ve){const Me=fe.uid,Je=fe.request,Ye=this.loading[Me]=new ae(fe),{cancel:at}=i.bt(Je,(_t,st,yt)=>{const Kt=!this.loading[Me];if(delete this.loading[Me],Kt||_t||!st)return Ye.status="done",Kt||(this.loaded[Me]=Ye),ve(_t);Ye.parse(st,(Bt,Tr)=>{if(Bt||!Tr)return ve(Bt);ve(null,Tr,yt)}),this.loaded[Me]=Ye});Ye.abort=at}reloadTile(fe,ve){ve(null,void 0)}abortTile(fe,ve){const Me=fe.uid,Je=this.loading[Me];Je&&(Je.abort&&Je.abort(),delete this.loading[Me]),ve()}removeTile(fe,ve){const Me=fe.uid;this.loaded[Me]&&delete this.loaded[Me],ve()}decodeRasterArray(fe,ve){i.br.performDecoding(fe.buffer,fe.task).then(Me=>ve(null,Me)).catch(Me=>ve(Me))}}const ie=i.fA.prototype.toGeoJSON;class ee{constructor(fe){this._feature=fe,this.extent=i.al,this.type=fe.type,this.properties=fe.tags,"id"in fe&&!isNaN(fe.id)&&(this.id=parseInt(fe.id,10))}loadGeometry(){if(this._feature.type===1){const fe=[];for(const ve of this._feature.geometry)fe.push([new i.P(ve[0],ve[1])]);return fe}{const fe=[];for(const ve of this._feature.geometry){const Me=[];for(const Je of ve)Me.push(new i.P(Je[0],Je[1]));fe.push(Me)}return fe}}toGeoJSON(fe,ve,Me){return ie.call(this,fe,ve,Me)}}class oe{constructor(fe,ve){this.name=fe,this.extent=i.al,this.length=ve.length,this._jsonFeatures=ve}feature(fe){return new ee(this._jsonFeatures[fe])}}class de{constructor(fe){this.layers={},this.extent=i.al;for(const ve of Object.keys(fe))this.layers[ve]=new oe(ve,fe[ve])}}const xe=64/4096,we=128;class Ae{constructor(){this.features=new Map}clear(){this.features.clear()}load(fe=[],ve){for(const Me of fe){const Je=Me.id;if(Je==null)continue;let Ye=this.features.get(Je);Ye&&this.updateCache(Ye,ve),Me.geometry?(Ye=me(Me),this.updateCache(Ye,ve),this.features.set(Je,Ye)):this.features.delete(Je),this.updateCache(Ye,ve)}}updateCache(fe,ve){for(const{canonical:Me,uid:Je}of Object.values(ve)){const{z:Ye,x:at,y:_t}=Me;Ce(fe,Math.pow(2,Ye),at,_t)&&delete ve[Je]}}getTile(fe,ve,Me){const Je=Math.pow(2,fe),Ye=[];for(const at of this.features.values())Ce(at,Je,ve,Me)&&Ye.push(Ie(at,Je,ve,Me));return{features:Ye}}getFeatures(){return[...this.features.values()]}}function Ce({minX:ct,minY:fe,maxX:ve,maxY:Me},Je,Ye,at){return ct<(Ye+1+xe)/Je&&fe<(at+1+xe)/Je&&ve>(Ye-xe)/Je&&Me>(at-xe)/Je}function me(ct){const{id:fe,geometry:ve,properties:Me}=ct;if(!ve)return;if(ve.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Je,coordinates:Ye}=ve,at={id:fe,type:1,geometry:[],tags:Me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},_t=at.geometry;if(Je==="Point")Pe(Ye,_t,at);else if(Je==="MultiPoint")for(const st of Ye)Pe(st,_t,at);else if(Je==="LineString")at.type=2,ye(Ye,_t,at);else if(Je==="MultiLineString")at.type=2,pe(Ye,_t,at);else if(Je==="Polygon")at.type=3,pe(Ye,_t,at,!0);else{if(Je!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");at.type=3;for(const st of Ye)pe(st,_t,at,!0)}return at}function Pe([ct,fe],ve,Me){const Je=i.aF(ct);let Ye=i.aJ(fe);Ye=Ye<0?0:Ye>1?1:Ye,ve.push(Je,Ye),Me.minX=Math.min(Me.minX,Je),Me.minY=Math.min(Me.minY,Ye),Me.maxX=Math.max(Me.maxX,Je),Me.maxY=Math.max(Me.maxY,Ye)}function ye(ct,fe,ve,Me=!1,Je=!1){const Ye=[];for(const at of ct)Pe(at,Ye,ve);fe.push(Ye),Me&&function(at,_t){let st=0;for(let yt=0,Kt=at.length,Bt=Kt-2;yt<Kt;Bt=yt,yt+=2)st+=(at[yt]-at[Bt])*(at[yt+1]+at[Bt+1]);if(st>0===_t)for(let yt=0,Kt=at.length;yt<Kt/2;yt+=2){const Bt=at[yt],Tr=at[yt+1];at[yt]=at[Kt-2-yt],at[yt+1]=at[Kt-1-yt],at[Kt-2-yt]=Bt,at[Kt-1-yt]=Tr}}(Ye,Je)}function pe(ct,fe,ve,Me=!1){for(let Je=0;Je<ct.length;Je++)ye(ct[Je],fe,ve,Me,Je===0)}function Ie(ct,fe,ve,Me){const{id:Je,type:Ye,geometry:at,tags:_t}=ct,st=[];if(Ye===1)(function(yt,Kt,Bt,Tr,Kr){for(let Wr=0;Wr<yt.length;Wr+=2){const Ir=Math.round(i.al*(yt[Wr+0]*Kt-Bt)),yn=Math.round(i.al*(yt[Wr+1]*Kt-Tr));Kr.push([Ir,yn])}})(at,fe,ve,Me,st);else for(const yt of at)tt(yt,fe,ve,Me,st);return{id:Je,type:Ye,geometry:st,tags:_t}}function tt(ct,fe,ve,Me,Je){const Ye=-we,at=i.al+we;let _t;for(let st=0;st<ct.length-2;st+=2){let yt=Math.round(i.al*(ct[st+0]*fe-ve)),Kt=Math.round(i.al*(ct[st+1]*fe-Me)),Bt=Math.round(i.al*(ct[st+2]*fe-ve)),Tr=Math.round(i.al*(ct[st+3]*fe-Me));const Kr=Bt-yt,Wr=Tr-Kt;yt<Ye&&Bt<Ye||(yt<Ye?(Kt+=Math.round(Wr*((Ye-yt)/Kr)),yt=Ye):Bt<Ye&&(Tr=Kt+Math.round(Wr*((Ye-yt)/Kr)),Bt=Ye),Kt<Ye&&Tr<Ye||(Kt<Ye?(yt+=Math.round(Kr*((Ye-Kt)/Wr)),Kt=Ye):Tr<Ye&&(Bt=yt+Math.round(Kr*((Ye-Kt)/Wr)),Tr=Ye),yt>=at&&Bt>=at||(yt>=at?(Kt+=Math.round(Wr*((at-yt)/Kr)),yt=at):Bt>=at&&(Tr=Kt+Math.round(Wr*((at-yt)/Kr)),Bt=at),Kt>=at&&Tr>=at||(Kt>=at?(yt+=Math.round(Kr*((at-Kt)/Wr)),Kt=at):Tr>=at&&(Bt=yt+Math.round(Kr*((at-Kt)/Wr)),Tr=at),_t&&yt===_t[_t.length-1][0]&&Kt===_t[_t.length-1][1]||(_t=[[yt,Kt]],Je.push(_t)),_t.push([Bt,Tr])))))}}function Ze({name:ct,features:fe},ve){ve.writeStringField(1,ct),ve.writeVarintField(5,i.al);const Me=new Map,Je=new Map,Ye={keys:Me,values:Je,feature:null};for(const at of fe)Ye.feature=at,ve.writeMessage(2,Le,Ye);for(const at of Me.keys())ve.writeStringField(3,at);for(const at of Je.keys())ve.writeMessage(4,St,at)}function Le(ct,fe){const ve=ct.feature;ve.id!==void 0&&Number.isSafeInteger(+ve.id)&&fe.writeVarintField(1,+ve.id),ve.tags&&fe.writeMessage(2,qe,ct),fe.writeVarintField(3,ve.type),fe.writeMessage(4,ot,ve)}function qe({keys:ct,values:fe,feature:ve},Me){for(const Je of Object.keys(ve.tags)){let Ye=ve.tags[Je];if(Ye===null)continue;let at=ct.get(Je);at===void 0&&(at=ct.size,ct.set(Je,at)),Me.writeVarint(at);const _t=typeof Ye;_t!=="string"&&_t!=="boolean"&&_t!=="number"&&(Ye=JSON.stringify(Ye));let st=fe.get(Ye);st===void 0&&(st=fe.size,fe.set(Ye,st)),Me.writeVarint(st)}}function Ge(ct,fe){return(fe<<3)+(7&ct)}function je(ct){return ct<<1^ct>>31}function ot(ct,fe){const{geometry:ve,type:Me}=ct;let Je=0,Ye=0;if(Me===1){fe.writeVarint(Ge(1,ve.length));for(const at of ve){const _t=at[0]-Je,st=at[1]-Ye;fe.writeVarint(je(_t)),fe.writeVarint(je(st)),Je+=_t,Ye+=st}}else for(const at of ve){fe.writeVarint(Ge(1,1));const _t=at.length-(Me===3?1:0);for(let st=0;st<_t;st++){st===1&&fe.writeVarint(Ge(2,_t-1));const yt=at[st][0]-Je,Kt=at[st][1]-Ye;fe.writeVarint(je(yt)),fe.writeVarint(je(Kt)),Je+=yt,Ye+=Kt}Me===3&&fe.writeVarint(Ge(7,1))}}function St(ct,fe){const ve=typeof ct;ve==="string"?fe.writeStringField(1,ct):ve==="boolean"?fe.writeBooleanField(7,ct):ve==="number"&&(ct%1!=0?fe.writeDoubleField(3,ct):ct<0?fe.writeSVarintField(6,ct):fe.writeVarintField(5,ct))}const rt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ct=>ct},Ut=Math.fround||(Ft=new Float32Array(1),ct=>(Ft[0]=+ct,Ft[0]));var Ft;const dr=3,Lr=5,Jr=6;class Rt{constructor(fe){this.options=Object.assign(Object.create(rt),fe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(fe){const{log:ve,minZoom:Me,maxZoom:Je}=this.options;ve&&console.time("total time");const Ye=`prepare ${fe.length} points`;ve&&console.time(Ye),this.points=fe;const at=[];for(let st=0;st<fe.length;st++){const yt=fe[st];if(!yt.geometry)continue;const[Kt,Bt]=yt.geometry.coordinates,Tr=Ut(ut(Kt)),Kr=Ut(dt(Bt));at.push(Tr,Kr,1/0,st,-1,1),this.options.reduce&&at.push(0)}let _t=this.trees[Je+1]=this._createTree(at);ve&&console.timeEnd(Ye);for(let st=Je;st>=Me;st--){const yt=+Date.now();_t=this.trees[st]=this._createTree(this._cluster(_t,st)),ve&&console.log("z%d: %d clusters in %dms",st,_t.numItems,+Date.now()-yt)}return ve&&console.timeEnd("total time"),this}getClusters(fe,ve){let Me=((fe[0]+180)%360+360)%360-180;const Je=Math.max(-90,Math.min(90,fe[1]));let Ye=fe[2]===180?180:((fe[2]+180)%360+360)%360-180;const at=Math.max(-90,Math.min(90,fe[3]));if(fe[2]-fe[0]>=360)Me=-180,Ye=180;else if(Me>Ye){const Bt=this.getClusters([Me,Je,180,at],ve),Tr=this.getClusters([-180,Je,Ye,at],ve);return Bt.concat(Tr)}const _t=this.trees[this._limitZoom(ve)],st=_t.range(ut(Me),dt(at),ut(Ye),dt(Je)),yt=_t.data,Kt=[];for(const Bt of st){const Tr=this.stride*Bt;Kt.push(yt[Tr+Lr]>1?At(yt,Tr,this.clusterProps):this.points[yt[Tr+dr]])}return Kt}getChildren(fe){const ve=this._getOriginId(fe),Me=this._getOriginZoom(fe),Je="No cluster with the specified id.",Ye=this.trees[Me];if(!Ye)throw new Error(Je);const at=Ye.data;if(ve*this.stride>=at.length)throw new Error(Je);const _t=this.options.radius/(this.options.extent*Math.pow(2,Me-1)),st=Ye.within(at[ve*this.stride],at[ve*this.stride+1],_t),yt=[];for(const Kt of st){const Bt=Kt*this.stride;at[Bt+4]===fe&&yt.push(at[Bt+Lr]>1?At(at,Bt,this.clusterProps):this.points[at[Bt+dr]])}if(yt.length===0)throw new Error(Je);return yt}getLeaves(fe,ve,Me){const Je=[];return this._appendLeaves(Je,fe,ve=ve||10,Me=Me||0,0),Je}getTile(fe,ve,Me){const Je=this.trees[this._limitZoom(fe)],Ye=Math.pow(2,fe),{extent:at,radius:_t}=this.options,st=_t/at,yt=(Me-st)/Ye,Kt=(Me+1+st)/Ye,Bt={features:[]};return this._addTileFeatures(Je.range((ve-st)/Ye,yt,(ve+1+st)/Ye,Kt),Je.data,ve,Me,Ye,Bt),ve===0&&this._addTileFeatures(Je.range(1-st/Ye,yt,1,Kt),Je.data,Ye,Me,Ye,Bt),ve===Ye-1&&this._addTileFeatures(Je.range(0,yt,st/Ye,Kt),Je.data,-1,Me,Ye,Bt),Bt.features.length?Bt:null}getClusterExpansionZoom(fe){let ve=this._getOriginZoom(fe)-1;for(;ve<=this.options.maxZoom;){const Me=this.getChildren(fe);if(ve++,Me.length!==1)break;fe=Me[0].properties.cluster_id}return ve}_appendLeaves(fe,ve,Me,Je,Ye){const at=this.getChildren(ve);for(const _t of at){const st=_t.properties;if(st&&st.cluster?Ye+st.point_count<=Je?Ye+=st.point_count:Ye=this._appendLeaves(fe,st.cluster_id,Me,Je,Ye):Ye<Je?Ye++:fe.push(_t),fe.length===Me)break}return Ye}_createTree(fe){const ve=new i.c3(fe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Me=0;Me<fe.length;Me+=this.stride)ve.add(fe[Me],fe[Me+1]);return ve.finish(),ve.data=fe,ve}_addTileFeatures(fe,ve,Me,Je,Ye,at){for(const _t of fe){const st=_t*this.stride,yt=ve[st+Lr]>1;let Kt,Bt,Tr;if(yt)Kt=Xe(ve,st,this.clusterProps),Bt=ve[st],Tr=ve[st+1];else{const Ir=this.points[ve[st+dr]];Kt=Ir.properties;const[yn,En]=Ir.geometry.coordinates;Bt=ut(yn),Tr=dt(En)}const Kr={type:1,geometry:[[Math.round(this.options.extent*(Bt*Ye-Me)),Math.round(this.options.extent*(Tr*Ye-Je))]],tags:Kt};let Wr;Wr=yt||this.options.generateId?ve[st+dr]:this.points[ve[st+dr]].id,Wr!==void 0&&(Kr.id=Wr),at.features.push(Kr)}}_limitZoom(fe){return Math.max(this.options.minZoom,Math.min(Math.floor(+fe),this.options.maxZoom+1))}_cluster(fe,ve){const{radius:Me,extent:Je,reduce:Ye,minPoints:at}=this.options,_t=Me/(Je*Math.pow(2,ve)),st=fe.data,yt=[],Kt=this.stride;for(let Bt=0;Bt<st.length;Bt+=Kt){if(st[Bt+2]<=ve)continue;st[Bt+2]=ve;const Tr=st[Bt],Kr=st[Bt+1],Wr=fe.within(st[Bt],st[Bt+1],_t),Ir=st[Bt+Lr];let yn=Ir;for(const En of Wr){const pi=En*Kt;st[pi+2]>ve&&(yn+=st[pi+Lr])}if(yn>Ir&&yn>=at){let En,pi=Tr*Ir,ca=Kr*Ir,za=-1;const Ea=(Bt/Kt<<5)+(ve+1)+this.points.length;for(const xa of Wr){const ci=xa*Kt;if(st[ci+2]<=ve)continue;st[ci+2]=ve;const Nn=st[ci+Lr];pi+=st[ci]*Nn,ca+=st[ci+1]*Nn,st[ci+4]=Ea,Ye&&(En||(En=this._map(st,Bt,!0),za=this.clusterProps.length,this.clusterProps.push(En)),Ye(En,this._map(st,ci)))}st[Bt+4]=Ea,yt.push(pi/yn,ca/yn,1/0,Ea,-1,yn),Ye&&yt.push(za)}else{for(let En=0;En<Kt;En++)yt.push(st[Bt+En]);if(yn>1)for(const En of Wr){const pi=En*Kt;if(!(st[pi+2]<=ve)){st[pi+2]=ve;for(let ca=0;ca<Kt;ca++)yt.push(st[pi+ca])}}}}return yt}_getOriginId(fe){return fe-this.points.length>>5}_getOriginZoom(fe){return(fe-this.points.length)%32}_map(fe,ve,Me){if(fe[ve+Lr]>1){const at=this.clusterProps[fe[ve+Jr]];return Me?Object.assign({},at):at}const Je=this.points[fe[ve+dr]].properties,Ye=this.options.map(Je);return Me&&Ye===Je?Object.assign({},Ye):Ye}}function At(ct,fe,ve){return{type:"Feature",id:ct[fe+dr],properties:Xe(ct,fe,ve),geometry:{type:"Point",coordinates:[(Me=ct[fe],360*(Me-.5)),rr(ct[fe+1])]}};var Me}function Xe(ct,fe,ve){const Me=ct[fe+Lr],Je=Me>=1e4?`${Math.round(Me/1e3)}k`:Me>=1e3?Math.round(Me/100)/10+"k":Me,Ye=ct[fe+Jr],at=Ye===-1?{}:Object.assign({},ve[Ye]);return Object.assign(at,{cluster:!0,cluster_id:ct[fe+dr],point_count:Me,point_count_abbreviated:Je})}function ut(ct){return ct/360+.5}function dt(ct){const fe=Math.sin(ct*Math.PI/180),ve=.5-.25*Math.log((1+fe)/(1-fe))/Math.PI;return ve<0?0:ve>1?1:ve}function rr(ct){const fe=(180-360*ct)*Math.PI/180;return 360*Math.atan(Math.exp(fe))/Math.PI-90}function er(ct,fe,ve,Me){let Je=Me;const Ye=fe+(ve-fe>>1);let at,_t=ve-fe;const st=ct[fe],yt=ct[fe+1],Kt=ct[ve],Bt=ct[ve+1];for(let Tr=fe+3;Tr<ve;Tr+=3){const Kr=tr(ct[Tr],ct[Tr+1],st,yt,Kt,Bt);if(Kr>Je)at=Tr,Je=Kr;else if(Kr===Je){const Wr=Math.abs(Tr-Ye);Wr<_t&&(at=Tr,_t=Wr)}}Je>Me&&(at-fe>3&&er(ct,fe,at,Me),ct[at+2]=Je,ve-at>3&&er(ct,at,ve,Me))}function tr(ct,fe,ve,Me,Je,Ye){let at=Je-ve,_t=Ye-Me;if(at!==0||_t!==0){const st=((ct-ve)*at+(fe-Me)*_t)/(at*at+_t*_t);st>1?(ve=Je,Me=Ye):st>0&&(ve+=at*st,Me+=_t*st)}return at=ct-ve,_t=fe-Me,at*at+_t*_t}function Pr(ct,fe,ve,Me){const Je={id:ct??null,type:fe,geometry:ve,tags:Me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")un(Je,ve);else if(fe==="Polygon")un(Je,ve[0]);else if(fe==="MultiLineString")for(const Ye of ve)un(Je,Ye);else if(fe==="MultiPolygon")for(const Ye of ve)un(Je,Ye[0]);return Je}function un(ct,fe){for(let ve=0;ve<fe.length;ve+=3)ct.minX=Math.min(ct.minX,fe[ve]),ct.minY=Math.min(ct.minY,fe[ve+1]),ct.maxX=Math.max(ct.maxX,fe[ve]),ct.maxY=Math.max(ct.maxY,fe[ve+1])}function pn(ct,fe,ve,Me){if(!fe.geometry)return;const Je=fe.geometry.coordinates;if(Je&&Je.length===0)return;const Ye=fe.geometry.type,at=Math.pow(ve.tolerance/((1<<ve.maxZoom)*ve.extent),2);let _t=[],st=fe.id;if(ve.promoteId?st=fe.properties[ve.promoteId]:ve.generateId&&(st=Me||0),Ye==="Point")Pi(Je,_t);else if(Ye==="MultiPoint")for(const yt of Je)Pi(yt,_t);else if(Ye==="LineString")gi(Je,_t,at,!1);else if(Ye==="MultiLineString"){if(ve.lineMetrics){for(const yt of Je)_t=[],gi(yt,_t,at,!1),ct.push(Pr(st,"LineString",_t,fe.properties));return}Zi(Je,_t,at,!1)}else if(Ye==="Polygon")Zi(Je,_t,at,!0);else{if(Ye!=="MultiPolygon"){if(Ye==="GeometryCollection"){for(const yt of fe.geometry.geometries)pn(ct,{id:st,geometry:yt,properties:fe.properties},ve,Me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const yt of Je){const Kt=[];Zi(yt,Kt,at,!0),_t.push(Kt)}}ct.push(Pr(st,Ye,_t,fe.properties))}function Pi(ct,fe){fe.push(js(ct[0]),Va(ct[1]),0)}function gi(ct,fe,ve,Me){let Je,Ye,at=0;for(let st=0;st<ct.length;st++){const yt=js(ct[st][0]),Kt=Va(ct[st][1]);fe.push(yt,Kt,0),st>0&&(at+=Me?(Je*Kt-yt*Ye)/2:Math.sqrt(Math.pow(yt-Je,2)+Math.pow(Kt-Ye,2))),Je=yt,Ye=Kt}const _t=fe.length-3;fe[2]=1,er(fe,0,_t,ve),fe[_t+2]=1,fe.size=Math.abs(at),fe.start=0,fe.end=fe.size}function Zi(ct,fe,ve,Me){for(let Je=0;Je<ct.length;Je++){const Ye=[];gi(ct[Je],Ye,ve,Me),fe.push(Ye)}}function js(ct){return ct/360+.5}function Va(ct){const fe=Math.sin(ct*Math.PI/180),ve=.5-.25*Math.log((1+fe)/(1-fe))/Math.PI;return ve<0?0:ve>1?1:ve}function Si(ct,fe,ve,Me,Je,Ye,at,_t){if(Me/=fe,Ye>=(ve/=fe)&&at<Me)return ct;if(at<ve||Ye>=Me)return null;const st=[];for(const yt of ct){const Kt=yt.geometry;let Bt=yt.type;const Tr=Je===0?yt.minX:yt.minY,Kr=Je===0?yt.maxX:yt.maxY;if(Tr>=ve&&Kr<Me){st.push(yt);continue}if(Kr<ve||Tr>=Me)continue;let Wr=[];if(Bt==="Point"||Bt==="MultiPoint")bs(Kt,Wr,ve,Me,Je);else if(Bt==="LineString")Bo(Kt,Wr,ve,Me,Je,!1,_t.lineMetrics);else if(Bt==="MultiLineString")$o(Kt,Wr,ve,Me,Je,!1);else if(Bt==="Polygon")$o(Kt,Wr,ve,Me,Je,!0);else if(Bt==="MultiPolygon")for(const Ir of Kt){const yn=[];$o(Ir,yn,ve,Me,Je,!0),yn.length&&Wr.push(yn)}if(Wr.length){if(_t.lineMetrics&&Bt==="LineString"){for(const Ir of Wr)st.push(Pr(yt.id,Bt,Ir,yt.tags));continue}Bt!=="LineString"&&Bt!=="MultiLineString"||(Wr.length===1?(Bt="LineString",Wr=Wr[0]):Bt="MultiLineString"),Bt!=="Point"&&Bt!=="MultiPoint"||(Bt=Wr.length===3?"Point":"MultiPoint"),st.push(Pr(yt.id,Bt,Wr,yt.tags))}}return st.length?st:null}function bs(ct,fe,ve,Me,Je){for(let Ye=0;Ye<ct.length;Ye+=3){const at=ct[Ye+Je];at>=ve&&at<=Me&&rs(fe,ct[Ye],ct[Ye+1],ct[Ye+2])}}function Bo(ct,fe,ve,Me,Je,Ye,at){let _t=Ns(ct);const st=Je===0?Ni:so;let yt,Kt,Bt=ct.start;for(let yn=0;yn<ct.length-3;yn+=3){const En=ct[yn],pi=ct[yn+1],ca=ct[yn+2],za=ct[yn+3],Ea=ct[yn+4],xa=Je===0?En:pi,ci=Je===0?za:Ea;let Nn=!1;at&&(yt=Math.sqrt(Math.pow(En-za,2)+Math.pow(pi-Ea,2))),xa<ve?ci>ve&&(Kt=st(_t,En,pi,za,Ea,ve),at&&(_t.start=Bt+yt*Kt)):xa>Me?ci<Me&&(Kt=st(_t,En,pi,za,Ea,Me),at&&(_t.start=Bt+yt*Kt)):rs(_t,En,pi,ca),ci<ve&&xa>=ve&&(Kt=st(_t,En,pi,za,Ea,ve),Nn=!0),ci>Me&&xa<=Me&&(Kt=st(_t,En,pi,za,Ea,Me),Nn=!0),!Ye&&Nn&&(at&&(_t.end=Bt+yt*Kt),fe.push(_t),_t=Ns(ct)),at&&(Bt+=yt)}let Tr=ct.length-3;const Kr=ct[Tr],Wr=ct[Tr+1],Ir=Je===0?Kr:Wr;Ir>=ve&&Ir<=Me&&rs(_t,Kr,Wr,ct[Tr+2]),Tr=_t.length-3,Ye&&Tr>=3&&(_t[Tr]!==_t[0]||_t[Tr+1]!==_t[1])&&rs(_t,_t[0],_t[1],_t[2]),_t.length&&fe.push(_t)}function Ns(ct){const fe=[];return fe.size=ct.size,fe.start=ct.start,fe.end=ct.end,fe}function $o(ct,fe,ve,Me,Je,Ye){for(const at of ct)Bo(at,fe,ve,Me,Je,Ye,!1)}function rs(ct,fe,ve,Me){ct.push(fe,ve,Me)}function Ni(ct,fe,ve,Me,Je,Ye){const at=(Ye-fe)/(Me-fe);return rs(ct,Ye,ve+(Je-ve)*at,1),at}function so(ct,fe,ve,Me,Je,Ye){const at=(Ye-ve)/(Je-ve);return rs(ct,fe+(Me-fe)*at,Ye,1),at}function gl(ct,fe){const ve=[];for(let Me=0;Me<ct.length;Me++){const Je=ct[Me],Ye=Je.type;let at;if(Ye==="Point"||Ye==="MultiPoint"||Ye==="LineString")at=xr(Je.geometry,fe);else if(Ye==="MultiLineString"||Ye==="Polygon"){at=[];for(const _t of Je.geometry)at.push(xr(_t,fe))}else if(Ye==="MultiPolygon"){at=[];for(const _t of Je.geometry){const st=[];for(const yt of _t)st.push(xr(yt,fe));at.push(st)}}ve.push(Pr(Je.id,Ye,at,Je.tags))}return ve}function xr(ct,fe){const ve=[];ve.size=ct.size,ct.start!==void 0&&(ve.start=ct.start,ve.end=ct.end);for(let Me=0;Me<ct.length;Me+=3)ve.push(ct[Me]+fe,ct[Me+1],ct[Me+2]);return ve}function Sn(ct,fe){if(ct.transformed)return ct;const ve=1<<ct.z,Me=ct.x,Je=ct.y;for(const Ye of ct.features){const at=Ye.geometry,_t=Ye.type;if(Ye.geometry=[],_t===1)for(let st=0;st<at.length;st+=2)Ye.geometry.push(kn(at[st],at[st+1],fe,ve,Me,Je));else for(let st=0;st<at.length;st++){const yt=[];for(let Kt=0;Kt<at[st].length;Kt+=2)yt.push(kn(at[st][Kt],at[st][Kt+1],fe,ve,Me,Je));Ye.geometry.push(yt)}}return ct.transformed=!0,ct}function kn(ct,fe,ve,Me,Je,Ye){return[Math.round(ve*(ct*Me-Je)),Math.round(ve*(fe*Me-Ye))]}function Ii(ct,fe,ve,Me,Je){const Ye=fe===Je.maxZoom?0:Je.tolerance/((1<<fe)*Je.extent),at={features:[],numPoints:0,numSimplified:0,numFeatures:ct.length,source:null,x:ve,y:Me,z:fe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const _t of ct)pa(at,_t,Ye,Je);return at}function pa(ct,fe,ve,Me){const Je=fe.geometry,Ye=fe.type,at=[];if(ct.minX=Math.min(ct.minX,fe.minX),ct.minY=Math.min(ct.minY,fe.minY),ct.maxX=Math.max(ct.maxX,fe.maxX),ct.maxY=Math.max(ct.maxY,fe.maxY),Ye==="Point"||Ye==="MultiPoint")for(let _t=0;_t<Je.length;_t+=3)at.push(Je[_t],Je[_t+1]),ct.numPoints++,ct.numSimplified++;else if(Ye==="LineString")Uo(at,Je,ct,ve,!1,!1);else if(Ye==="MultiLineString"||Ye==="Polygon")for(let _t=0;_t<Je.length;_t++)Uo(at,Je[_t],ct,ve,Ye==="Polygon",_t===0);else if(Ye==="MultiPolygon")for(let _t=0;_t<Je.length;_t++){const st=Je[_t];for(let yt=0;yt<st.length;yt++)Uo(at,st[yt],ct,ve,!0,yt===0)}if(at.length){let _t=fe.tags||null;if(Ye==="LineString"&&Me.lineMetrics){_t={};for(const yt in fe.tags)_t[yt]=fe.tags[yt];_t.mapbox_clip_start=Je.start/Je.size,_t.mapbox_clip_end=Je.end/Je.size}const st={geometry:at,type:Ye==="Polygon"||Ye==="MultiPolygon"?3:Ye==="LineString"||Ye==="MultiLineString"?2:1,tags:_t};fe.id!==null&&(st.id=fe.id),ct.features.push(st)}}function Uo(ct,fe,ve,Me,Je,Ye){const at=Me*Me;if(Me>0&&fe.size<(Je?at:Me))return void(ve.numPoints+=fe.length/3);const _t=[];for(let st=0;st<fe.length;st+=3)(Me===0||fe[st+2]>at)&&(ve.numSimplified++,_t.push(fe[st],fe[st+1])),ve.numPoints++;Je&&function(st,yt){let Kt=0;for(let Bt=0,Tr=st.length,Kr=Tr-2;Bt<Tr;Kr=Bt,Bt+=2)Kt+=(st[Bt]-st[Kr])*(st[Bt+1]+st[Kr+1]);if(Kt>0===yt)for(let Bt=0,Tr=st.length;Bt<Tr/2;Bt+=2){const Kr=st[Bt],Wr=st[Bt+1];st[Bt]=st[Tr-2-Bt],st[Bt+1]=st[Tr-1-Bt],st[Tr-2-Bt]=Kr,st[Tr-1-Bt]=Wr}}(_t,Ye),ct.push(_t)}const Mt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Vo{constructor(fe,ve){const Me=(ve=this.options=function(Ye,at){for(const _t in at)Ye[_t]=at[_t];return Ye}(Object.create(Mt),ve)).debug;if(Me&&console.time("preprocess data"),ve.maxZoom<0||ve.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ve.promoteId&&ve.generateId)throw new Error("promoteId and generateId cannot be used together.");let Je=function(Ye,at){const _t=[];if(Ye.type==="FeatureCollection")for(let st=0;st<Ye.features.length;st++)pn(_t,Ye.features[st],at,st);else pn(_t,Ye.type==="Feature"?Ye:{geometry:Ye},at);return _t}(fe,ve);this.tiles={},this.tileCoords=[],Me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ve.indexMaxZoom,ve.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Je=function(Ye,at){const _t=at.buffer/at.extent;let st=Ye;const yt=Si(Ye,1,-1-_t,_t,0,-1,2,at),Kt=Si(Ye,1,1-_t,2+_t,0,-1,2,at);return(yt||Kt)&&(st=Si(Ye,1,-_t,1+_t,0,-1,2,at)||[],yt&&(st=gl(yt,1).concat(st)),Kt&&(st=st.concat(gl(Kt,-1)))),st}(Je,ve),Je.length&&this.splitTile(Je,0,0,0),Me&&(Je.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(fe,ve,Me,Je,Ye,at,_t){const st=[fe,ve,Me,Je],yt=this.options,Kt=yt.debug;for(;st.length;){Je=st.pop(),Me=st.pop(),ve=st.pop(),fe=st.pop();const Bt=1<<ve,Tr=yl(ve,Me,Je);let Kr=this.tiles[Tr];if(!Kr&&(Kt>1&&console.time("creation"),Kr=this.tiles[Tr]=Ii(fe,ve,Me,Je,yt),this.tileCoords.push({z:ve,x:Me,y:Je}),Kt)){Kt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ve,Me,Je,Kr.numFeatures,Kr.numPoints,Kr.numSimplified),console.timeEnd("creation"));const Nn=`z${ve}`;this.stats[Nn]=(this.stats[Nn]||0)+1,this.total++}if(Kr.source=fe,Ye==null){if(ve===yt.indexMaxZoom||Kr.numPoints<=yt.indexMaxPoints)continue}else{if(ve===yt.maxZoom||ve===Ye)continue;if(Ye!=null){const Nn=Ye-ve;if(Me!==at>>Nn||Je!==_t>>Nn)continue}}if(Kr.source=null,fe.length===0)continue;Kt>1&&console.time("clipping");const Wr=.5*yt.buffer/yt.extent,Ir=.5-Wr,yn=.5+Wr,En=1+Wr;let pi=null,ca=null,za=null,Ea=null,xa=Si(fe,Bt,Me-Wr,Me+yn,0,Kr.minX,Kr.maxX,yt),ci=Si(fe,Bt,Me+Ir,Me+En,0,Kr.minX,Kr.maxX,yt);fe=null,xa&&(pi=Si(xa,Bt,Je-Wr,Je+yn,1,Kr.minY,Kr.maxY,yt),ca=Si(xa,Bt,Je+Ir,Je+En,1,Kr.minY,Kr.maxY,yt),xa=null),ci&&(za=Si(ci,Bt,Je-Wr,Je+yn,1,Kr.minY,Kr.maxY,yt),Ea=Si(ci,Bt,Je+Ir,Je+En,1,Kr.minY,Kr.maxY,yt),ci=null),Kt>1&&console.timeEnd("clipping"),st.push(pi||[],ve+1,2*Me,2*Je),st.push(ca||[],ve+1,2*Me,2*Je+1),st.push(za||[],ve+1,2*Me+1,2*Je),st.push(Ea||[],ve+1,2*Me+1,2*Je+1)}}getTile(fe,ve,Me){fe=+fe,ve=+ve,Me=+Me;const Je=this.options,{extent:Ye,debug:at}=Je;if(fe<0||fe>24)return null;const _t=1<<fe,st=yl(fe,ve=ve+_t&_t-1,Me);if(this.tiles[st])return Sn(this.tiles[st],Ye);at>1&&console.log("drilling down to z%d-%d-%d",fe,ve,Me);let yt,Kt=fe,Bt=ve,Tr=Me;for(;!yt&&Kt>0;)Kt--,Bt>>=1,Tr>>=1,yt=this.tiles[yl(Kt,Bt,Tr)];return yt&&yt.source?(at>1&&(console.log("found parent tile z%d-%d-%d",Kt,Bt,Tr),console.time("drilling down")),this.splitTile(yt.source,Kt,Bt,Tr,fe,ve,Me),at>1&&console.timeEnd("drilling down"),this.tiles[st]?Sn(this.tiles[st],Ye):null):null}}function yl(ct,fe,ve){return 32*((1<<ct)*ve+fe)+ct}function ns(ct,fe){const ve=ct.tileID.canonical;if(!this._geoJSONIndex)return void fe(null,null);const Me=this._geoJSONIndex.getTile(ve.z,ve.x,ve.y);if(!Me)return void fe(null,null);const Je=yt=>yt.tags&&"3d_elevation_id"in yt.tags&&"source"in yt.tags&&yt.tags.source==="elevation",Ye=Me.features.filter(yt=>Je(yt));let at={_geojsonTileLayer:Me.features};Ye.length>0&&(at={_geojsonTileLayer:Me.features.filter(yt=>!Je(yt)),hd_road_elevation:Ye});const _t=new de(at),st=function(yt){const Kt=new i.bs;for(const Bt of Object.keys(yt))Kt.writeMessage(3,Ze,{name:Bt,features:yt[Bt]});return Kt.finish()}(at).buffer;fe(null,{vectorTile:_t,rawData:st})}class bn extends J{constructor(fe,ve,Me,Je,Ye,at,_t){super(fe,ve,Me,Je,Ye,ns,_t),at&&(this.loadGeoJSON=at),this._dynamicIndex=new Ae}loadData(fe,ve){const Me=fe&&fe.request,Je=Me&&Me.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(fe,(Ye,at)=>{if(Ye||!at)return ve(Ye);if(typeof at!="object")return ve(new Error(`Input data given to '${fe.source}' is not a valid GeoJSON object.`));{try{if(fe.filter){const st=i.U(fe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(st.result==="error")throw new Error(st.value.map(yt=>`${yt.key}: ${yt.message}`).join(", "));at.features=at.features.filter(yt=>st.value.evaluate({zoom:0},yt))}fe.dynamic?(at.type==="Feature"&&(at={type:"FeatureCollection",features:[at]}),fe.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(at.features,this.loaded),fe.cluster&&(at.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=fe.cluster?new Rt(function({superclusterOptions:st,clusterProperties:yt}){if(!yt||!st)return st;const Kt={},Bt={},Tr={accumulated:null,zoom:0},Kr={properties:null},Wr=Object.keys(yt);for(const Ir of Wr){const[yn,En]=yt[Ir],pi=i.U(En),ca=i.U(typeof yn=="string"?[yn,["accumulated"],["get",Ir]]:yn);Kt[Ir]=pi.value,Bt[Ir]=ca.value}return st.map=Ir=>{Kr.properties=Ir;const yn={};for(const En of Wr)yn[En]=Kt[En].evaluate(Tr,Kr);return yn},st.reduce=(Ir,yn)=>{Kr.properties=yn;for(const En of Wr)Tr.accumulated=Ir[En],Ir[En]=Bt[En].evaluate(Tr,Kr)},st}(fe)).load(at.features):fe.dynamic?this._dynamicIndex:function(st,yt){return new Vo(st,yt)}(at,fe.geojsonVtOptions)}catch(st){return ve(st)}const _t={};if(Je){const st=g(Me);st&&(_t.resourceTiming={},_t.resourceTiming[fe.source]=JSON.parse(JSON.stringify(st)))}ve(null,_t)}})}reloadTile(fe,ve){const Me=this.loaded;return Me&&Me[fe.uid]?fe.partial?ve(null,void 0):super.reloadTile(fe,ve):this.loadTile(fe,ve)}loadGeoJSON(fe,ve){if(fe.request)i.m(fe.request,ve);else{if(typeof fe.data!="string")return ve(new Error(`Input data given to '${fe.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return ve(null,JSON.parse(fe.data))}catch{return ve(new Error(`Input data given to '${fe.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(fe,ve){try{ve(null,this._geoJSONIndex.getClusterExpansionZoom(fe.clusterId))}catch(Me){ve(Me)}}getClusterChildren(fe,ve){try{ve(null,this._geoJSONIndex.getChildren(fe.clusterId))}catch(Me){ve(Me)}}getClusterLeaves(fe,ve){try{ve(null,this._geoJSONIndex.getLeaves(fe.clusterId,fe.limit,fe.offset))}catch(Me){ve(Me)}}}class is{constructor(fe,ve,Me){this.tileID=new i.aP(fe.tileID.overscaledZ,fe.tileID.wrap,fe.tileID.canonical.z,fe.tileID.canonical.x,fe.tileID.canonical.y),this.tileZoom=fe.tileZoom,this.uid=fe.uid,this.zoom=fe.zoom,this.canonical=fe.tileID.canonical,this.pixelRatio=fe.pixelRatio,this.tileSize=fe.tileSize,this.source=fe.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=fe.projection,this.brightness=ve,this.worldview=Me}parse(fe,ve,Me,Je){this.status="parsing";const Ye=new i.aP(Me.tileID.overscaledZ,Me.tileID.wrap,Me.tileID.canonical.z,Me.tileID.canonical.x,Me.tileID.canonical.y),at=[],_t=ve.familiesBySource[Me.source],st=new i.fm(Ye,Me.promoteId);st.bucketLayerIDs=[],st.is3DTile=!0,i.fB(fe).then(yt=>{if(!yt)return Je(new Error("Could not parse tile"));const Kt=yt.json.extensionsUsed&&yt.json.extensionsUsed.includes("MAPBOX_mesh_features")||yt.json.asset.extras&&yt.json.asset.extras.MAPBOX_mesh_features,Bt=yt.json.extensionsUsed&&yt.json.extensionsUsed.includes("EXT_meshopt_compression"),Tr=new i.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Kr in _t)for(const Wr of _t[Kr]){const Ir=Wr[0];st.bucketLayerIDs.push(Wr.map(pi=>i.B(pi.id,pi.scope))),Ir.recalculate(Tr,[]);const yn=i.fC(yt,1/i.d6(Me.tileID.canonical)),En=new i.fD(Wr,yn,Ye,Kt,Bt,this.brightness,st,this.worldview);Kt||(En.needsUpload=!0),at.push(En),En.evaluate(Ir)}this.status="done",Je(null,{buckets:at,featureIndex:st,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(yt=>Je(new Error(yt.message)))}}class Kb{constructor(fe,ve,Me,Je,Ye,at,_t,st){this.actor=fe,this.layerIndex=ve,this.availableImages=Me,this.availableModels=Je,this.brightness=_t,this.loading={},this.loaded={},this.worldview=st}loadTile(fe,ve){const Me=fe.uid,Je=this.loading[Me]=new is(fe,this.brightness,this.worldview);i.bt(fe.request,(Ye,at)=>{const _t=!this.loading[Me];return delete this.loading[Me],_t||Ye?(Je.status="done",_t||(this.loaded[Me]=Je),ve(Ye)):at&&at.byteLength!==0?void Je.parse(at,this.layerIndex,fe,(st,yt)=>{Je.status="done",this.loaded=this.loaded||{},this.loaded[Me]=Je,st||!yt?ve(st):ve(null,yt)}):(Je.status="done",this.loaded[Me]=Je,ve())})}reloadTile(fe,ve){const Me=this.loaded,Je=fe.uid;if(Me&&Me[Je]){const Ye=Me[Je];Ye.projection=fe.projection,Ye.brightness=fe.brightness;const at=(_t,st)=>{Ye.reloadCallback&&(delete Ye.reloadCallback,this.loadTile(fe,ve)),ve(_t,st)};Ye.status==="parsing"?Ye.reloadCallback=at:Ye.status==="done"&&this.loadTile(fe,ve)}}abortTile(fe,ve){const Me=fe.uid;this.loading[Me]&&delete this.loading[Me],ve()}removeTile(fe,ve){const Me=this.loaded,Je=fe.uid;Me&&Me[Je]&&delete Me[Je],ve()}}class pg{constructor(fe){this.self=fe,this.actor=new i.fF(fe,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new i.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=i.cl({name:"mercator"}),this.workerSourceTypes={vector:J,geojson:bn,"raster-dem":te,"raster-array":ne,"batched-model":Kb},this.workerSources={},this.self.registerWorkerSource=(ve,Me)=>{if(this.workerSourceTypes[ve])throw new Error(`Worker source with name "${ve}" already registered.`);this.workerSourceTypes[ve]=Me},this.self.registerRTLTextPlugin=ve=>{if(i.fG.isParsed())throw new Error("RTL text plugin already registered.");i.fG.setState({pluginStatus:i.fH.parsed,pluginURL:i.fG.getPluginURL()}),i.fG.applyArabicShaping=ve.applyArabicShaping,i.fG.processBidirectionalText=ve.processBidirectionalText,i.fG.processStyledBidirectionalText=ve.processStyledBidirectionalText;for(const Me of this.rtlPluginParsingListeners)Me(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(fe,ve,Me){delete this.layerIndexes[fe],delete this.availableImages[fe],delete this.availableModels[fe],delete this.workerSources[fe],Me()}checkIfReady(fe,ve,Me){Me()}setReferrer(fe,ve){this.referrer=ve}spriteLoaded(fe,ve){this.isSpriteLoaded[fe]||(this.isSpriteLoaded[fe]={});const{scope:Me,isLoaded:Je}=ve;if(this.isSpriteLoaded[fe][Me]=Je,this.workerSources[fe]&&this.workerSources[fe][Me])for(const Ye in this.workerSources[fe][Me]){const at=this.workerSources[fe][Me][Ye];for(const _t in at){const st=at[_t];st instanceof J&&(st.isSpriteLoaded=Je,st.fire(new i.z("isSpriteLoaded")))}}}setImages(fe,ve,Me){this.availableImages[fe]||(this.availableImages[fe]={});const{scope:Je,images:Ye}=ve;if(this.availableImages[fe][Je]=Ye,this.workerSources[fe]&&this.workerSources[fe][Je]){for(const at in this.workerSources[fe][Je]){const _t=this.workerSources[fe][Je][at];for(const st in _t)_t[st].availableImages=Ye}Me()}else Me()}setModels(fe,{scope:ve,models:Me},Je){if(this.availableModels[fe]||(this.availableModels[fe]={}),this.availableModels[fe][ve]=Me,this.workerSources[fe]&&this.workerSources[fe][ve]){for(const Ye in this.workerSources[fe][ve]){const at=this.workerSources[fe][ve][Ye];for(const _t in at)at[_t].availableModels=Me}Je()}else Je()}setProjection(fe,ve){this.projections[fe]=i.cl(ve)}setBrightness(fe,ve,Me){this.brightness=ve,Me()}setWorldview(fe,ve,Me){this.worldview=ve,Me()}setLayers(fe,ve,Me){this.getLayerIndex(fe,ve.scope).replace(ve.layers,ve.options),Me()}updateLayers(fe,ve,Me){this.getLayerIndex(fe,ve.scope).update(ve.layers,ve.removedIds,ve.options),Me()}loadTile(fe,ve,Me){ve.projection=this.projections[fe]||this.defaultProjection,this.getWorkerSource(fe,ve.type,ve.source,ve.scope).loadTile(ve,Me)}decodeRasterArray(fe,ve,Me){this.getWorkerSource(fe,ve.type,ve.source,ve.scope).decodeRasterArray(ve,Me)}reloadTile(fe,ve,Me){ve.projection=this.projections[fe]||this.defaultProjection,this.getWorkerSource(fe,ve.type,ve.source,ve.scope).reloadTile(ve,Me)}abortTile(fe,ve,Me){this.getWorkerSource(fe,ve.type,ve.source,ve.scope).abortTile(ve,Me)}removeTile(fe,ve,Me){this.getWorkerSource(fe,ve.type,ve.source,ve.scope).removeTile(ve,Me)}removeSource(fe,ve,Me){if(!(this.workerSources[fe]&&this.workerSources[fe][ve.scope]&&this.workerSources[fe][ve.scope][ve.type]&&this.workerSources[fe][ve.scope][ve.type][ve.source]))return;const Je=this.workerSources[fe][ve.scope][ve.type][ve.source];delete this.workerSources[fe][ve.scope][ve.type][ve.source],Je.removeSource!==void 0?Je.removeSource(ve,Me):Me()}loadWorkerSource(fe,ve,Me){try{this.self.importScripts(ve.url),Me()}catch(Je){Me(Je.toString())}}syncRTLPluginState(fe,ve,Me){if(i.fG.isParsed())Me(null,!0);else if(i.fG.isParsing())this.rtlPluginParsingListeners.push(Me);else try{i.fG.setState(ve);const Je=i.fG.getPluginURL();!i.fG.isLoaded()||i.fG.isParsed()||i.fG.isParsing()||Je==null||(i.fG.setState({pluginStatus:i.fH.parsing,pluginURL:i.fG.getPluginURL()}),this.self.importScripts(Je),i.fG.isParsed()?Me(null,!0):this.rtlPluginParsingListeners.push(Me))}catch(Je){Me(Je.toString())}}setDracoUrl(fe,ve){this.dracoUrl=ve}getAvailableImages(fe,ve){this.availableImages[fe]||(this.availableImages[fe]={});let Me=this.availableImages[fe][ve];return Me||(Me=[]),Me}getAvailableModels(fe,ve){this.availableModels[fe]||(this.availableModels[fe]={});let Me=this.availableModels[fe][ve];return Me||(Me={}),Me}getLayerIndex(fe,ve){this.layerIndexes[fe]||(this.layerIndexes[fe]={});let Me=this.layerIndexes[fe][ve];return Me||(Me=this.layerIndexes[fe][ve]=new E,Me.scope=ve),Me}getWorkerSource(fe,ve,Me,Je){const Ye=this.workerSources;return Ye[fe]||(Ye[fe]={}),Ye[fe][Je]||(Ye[fe][Je]={}),Ye[fe][Je][ve]||(Ye[fe][Je][ve]={}),this.isSpriteLoaded[fe]||(this.isSpriteLoaded[fe]={}),Ye[fe][Je][ve][Me]||(Ye[fe][Je][ve][Me]=new this.workerSourceTypes[ve]({send:(at,_t,st,yt,Kt,Bt)=>this.actor.send(at,_t,st,fe,Kt,Bt),scheduler:this.actor.scheduler},this.getLayerIndex(fe,Je),this.getAvailableImages(fe,Je),this.getAvailableModels(fe,Je),this.isSpriteLoaded[fe][Je],void 0,this.brightness,this.worldview)),Ye[fe][Je][ve][Me]}rasterizeImagesWorker(fe,ve,Me){const Je=new Map;for(const[Ye,{image:at,imageVariant:_t}]of ve.tasks.entries()){const st=this.imageRasterizer.rasterize(_t,at,ve.scope,fe);Je.set(Ye,st)}Me(void 0,Je)}removeRasterizedImages(fe,ve,Me){this.imageRasterizer.removeImagesFromCacheByIds(ve.imageIds,ve.scope,fe),Me()}enforceCacheSizeLimit(fe,ve){i.fI(ve)}getWorkerPerformanceMetrics(fe,ve,Me){Me(void 0,void 0)}}return i.fE(self)&&(self.worker=new pg(self)),pg}),l(["./shared"],function(i){var g="3.16.0";const _={create:"create",load:"load",fullLoad:"fullLoad"},S={mark(y){performance.mark(y)},measure(y,s,h){performance.measure(y,s,h)}};function E(y){const s=y.name.split("?")[0];return i.a(s)&&s.includes("mapbox-gl.js")?"javascript":i.a(s)&&s.includes("mapbox-gl.css")?"css":i.b(s)?"fontRange":i.c(s)?"sprite":i.i(s)?"style":i.d(s)?"tilejson":"other"}var T,C={},N=function(){if(T)return C;function y(v){return!s(v)}function s(v){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,O,L=new Blob([""],{type:"text/javascript"}),z=URL.createObjectURL(L);try{O=new Worker(z),P=!0}catch{P=!1}return O&&O.terminate(),URL.revokeObjectURL(z),P}()?function(){var P=document.createElement("canvas");P.width=P.height=1;var O=P.getContext("2d");if(!O)return!1;var L=O.getImageData(0,0,1,1);return L&&L.width===P.width}()?(h[w=v&&v.failIfMajorPerformanceCaveat]===void 0&&(h[w]=function(P){var O,L=function(z){var G=document.createElement("canvas"),H=Object.create(y.webGLContextAttributes);return H.failIfMajorPerformanceCaveat=z,G.getContext("webgl2",H)}(P);if(!L)return!1;try{O=L.createShader(L.VERTEX_SHADER)}catch{return!1}return!(!O||L.isContextLost())&&(L.shaderSource(O,"void main() {}"),L.compileShader(O),L.getShaderParameter(O,L.COMPILE_STATUS)===!0)}(w)),h[w]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var w}T=1,C.supported=y,C.notSupportedReason=s;var h={};return y.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},C}();function I(y,s,h){const v=document.createElement(y);return s!=null&&(v.className=s),h&&h.appendChild(v),v}function j(y,s,h){const v=document.createElementNS("http://www.w3.org/2000/svg",y);for(const w of Object.keys(s))v.setAttributeNS(null,w,String(s[w]));return h&&h.appendChild(v),v}const D=typeof document<"u"?document.documentElement&&document.documentElement.style:null,R=D&&D.userSelect!==void 0?"userSelect":"WebkitUserSelect";let F;function B(){D&&R&&(F=D[R],D[R]="none")}function U(){D&&R&&(D[R]=F)}function Z(y){y.preventDefault(),y.stopPropagation(),window.removeEventListener("click",Z,!0)}function J(){window.addEventListener("click",Z,!0),window.setTimeout(()=>{window.removeEventListener("click",Z,!0)},0)}function te(y,s){const h=y.getBoundingClientRect();return ie(y,h,s)}function ae(y,s){const h=y.getBoundingClientRect(),v=[];for(let w=0;w<s.length;w++)v.push(ie(y,h,s[w]));return v}function ne(y){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&y.button===2&&y.ctrlKey?0:y.button}function ie(y,s,h){const v=y.offsetWidth===s.width?1:y.offsetWidth/s.width;return new i.P((h.clientX-s.left)*v,(h.clientY-s.top)*v)}const ee="01",oe="NO_ACCESS_TOKEN";class de{constructor(s,h,v){this._transformRequestFn=s,this._customAccessToken=h,this._silenceAuthErrors=!!v,this._createSkuToken()}_createSkuToken(){const s=function(){let h="";for(let v=0;v<10;v++)h+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ee,h].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,h){return this._transformRequestFn&&this._transformRequestFn(s,h)||{url:s}}normalizeStyleURL(s,h){if(!i.h(s))return s;const v=we(s);return v.params.push(`sdk=js-${g}`),v.path=`/styles/v1${v.path}`,this._makeAPIURL(v,this._customAccessToken||h)}normalizeGlyphsURL(s,h){if(!i.h(s))return s;const v=we(s);return v.path=`/fonts/v1${v.path}`,this._makeAPIURL(v,this._customAccessToken||h)}normalizeModelURL(s,h){if(!i.h(s))return s;const v=we(s);return v.path=`/models/v1${v.path}`,this._makeAPIURL(v,this._customAccessToken||h)}normalizeSourceURL(s,h,v,w){if(!i.h(s))return s;const P=we(s);return P.path=`/v4/${P.authority}.json`,P.params.push("secure"),v&&P.params.push(`language=${v}`),w&&P.params.push(`worldview=${w}`),this._makeAPIURL(P,this._customAccessToken||h)}normalizeIconsetURL(s,h){const v=we(s);return i.h(s)?(v.path=`/styles/v1${v.path}/iconset.pbf`,this._makeAPIURL(v,this._customAccessToken||h)):Ae(v)}normalizeSpriteURL(s,h,v,w){const P=we(s);return i.h(s)?(P.path=`/styles/v1${P.path}/sprite${h}${v}`,this._makeAPIURL(P,this._customAccessToken||w)):(P.path+=`${h}${v}`,Ae(P))}normalizeTileURL(s,h,v){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!i.h(s))return s;const w=we(s);w.path=w.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${h||v&&w.authority!=="raster"&&v===512?"@2x":""}${i.k.supported?".webp":"$1"}`),w.authority==="raster"?w.path=`/${i.e.RASTER_URL_PREFIX}${w.path}`:w.authority==="rasterarrays"?w.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${w.path}`:w.authority==="3dtiles"?w.path=`/${i.e.TILES3D_URL_PREFIX}${w.path}`:(w.path=w.path.replace(/^.+\/v4\//,"/"),w.path=`/${i.e.TILE_URL_VERSION}${w.path}`);const P=this._customAccessToken||function(O){for(const L of O){const z=L.match(/^access_token=(.*)$/);if(z)return z[1]}return null}(w.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&P&&this._skuToken&&w.params.push(`sku=${this._skuToken}`),this._makeAPIURL(w,P)}canonicalizeTileURL(s,h){const v=we(s);if(!v.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!v.path.match(/\.[\w]+$/))return s;let w="mapbox://";v.path.match(/^\/raster\/v1\//)?w+=`raster/${v.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:v.path.match(/^\/rasterarrays\/v1\//)?w+=`rasterarrays/${v.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:w+=`tiles/${v.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let P=v.params;return h&&(P=P.filter(O=>!O.match(/^access_token=/))),P.length&&(w+=`?${P.join("&")}`),w}canonicalizeTileset(s,h){const v=!!h&&i.h(h),w=[];for(const P of s.tiles||[])i.j(P)?w.push(this.canonicalizeTileURL(P,v)):w.push(P);return w}_makeAPIURL(s,h){const v="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",w=we(i.e.API_URL);if(s.protocol=w.protocol,s.authority=w.authority,s.protocol==="http"){const P=s.params.indexOf("secure");P>=0&&s.params.splice(P,1)}if(w.path!=="/"&&(s.path=`${w.path}${s.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return Ae(s);if(h=h||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!h)throw new Error(`An API access token is required to use Mapbox GL. ${v}`);if(h[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${v}`)}return s.params=s.params.filter(P=>P.indexOf("access_token")===-1),s.params.push(`access_token=${h||""}`),Ae(s)}}const xe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function we(y){const s=y.match(xe);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function Ae(y){const s=y.params.length?`?${y.params.join("&")}`:"";return`${y.protocol}://${y.authority}${y.path}${s}`}const Ce="mapbox.eventData";function me(y){if(!y)return null;const s=y.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(i.l(s[1]))}catch{return null}}class Pe{constructor(s){this.type=s,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(s){const h=me(i.e.ACCESS_TOKEN);let v="";return v=h&&h.u?i.f(h.u):i.e.ACCESS_TOKEN||"",s?`${Ce}.${s}:${v}`:`${Ce}:${v}`}fetchEventData(){const s=i.s("localStorage"),h=this.getStorageKey(),v=this.getStorageKey("uuid"),w=this.getStorageKey("uuidTimestamp");if(s)try{const P=localStorage.getItem(h);P&&(this.eventData=JSON.parse(P));const O=localStorage.getItem(v);O&&(this.anonId=O);const L=localStorage.getItem(w);L&&(this.anonIdTimestamp=Number(L));const z=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<z)&&this.refreshUUID()}catch{i.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=i.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const s=i.s("localStorage"),h=this.getStorageKey(),v=this.getStorageKey("uuid"),w=this.getStorageKey("uuidTimestamp"),P=this.anonId,O=this.anonIdTimestamp;if(s&&P)try{localStorage.setItem(v,P),Object.keys(this.eventData).length>=1&&localStorage.setItem(h,JSON.stringify(this.eventData)),O&&localStorage.setItem(w,O.toString())}catch{i.w("Unable to write to LocalStorage")}}processRequests(s){}postEvent(s,h,v,w){if(!i.e.EVENTS_URL)return;const P=we(i.e.EVENTS_URL);P.params.push(`access_token=${w||i.e.ACCESS_TOKEN||""}`);const O={event:this.type,created:new Date(s).toISOString()},L=h?Object.assign(O,h):O,z={url:Ae(P),headers:{"Content-Type":"text/plain"},body:JSON.stringify([L])};this.pendingRequest=i.p(z,G=>{this.pendingRequest=null,v(G),this.saveEventData(),this.processRequests(w)})}queueRequest(s,h){this.queue.push(s),this.processRequests(h)}}const ye=new class extends Pe{constructor(y){super("appUserTurnstile"),this._customAccessToken=y}postTurnstileEvent(y,s){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(y)&&y.some(h=>i.h(h)||i.j(h))&&this.queueRequest(Date.now(),s)}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const s=me(i.e.ACCESS_TOKEN),h=s?s.u:i.e.ACCESS_TOKEN;let v=h!==this.eventData.tokenU;i.v(this.anonId)||(this.refreshUUID(),v=!0);const w=this.queue.shift();if(this.eventData.lastSuccess){const P=new Date(this.eventData.lastSuccess),O=new Date(w),L=(w-this.eventData.lastSuccess)/864e5;v=v||L>=1||L<-1||P.getDate()!==O.getDate()}else v=!0;v?this.postEvent(w,{sdkIdentifier:"mapbox-gl-js",sdkVersion:g,skuId:ee,"enabled.telemetry":!1,userId:this.anonId},P=>{P||(this.eventData.lastSuccess=w,this.eventData.tokenU=h)},y):this.processRequests()}},pe=ye.postTurnstileEvent.bind(ye),Ie=new class extends Pe{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(y,s,h,v){this.skuToken=s,this.errorCb=v,i.e.EVENTS_URL&&(h||i.e.ACCESS_TOKEN?this.queueRequest({id:y,timestamp:Date.now()},h):this.errorCb(new Error(oe)))}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;const{id:s,timestamp:h}=this.queue.shift();s&&this.success[s]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID(),this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:g,skuId:ee,skuToken:this.skuToken,userId:this.anonId},v=>{v?this.errorCb(v):s&&(this.success[s]=!0)},y))}remove(){this.errorCb=null}},tt=Ie.postMapLoadEvent.bind(Ie),Ze=new class extends Pe{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(y){let s=this.mapInstanceIdMap.get(y);return s||(s=i.u(),this.mapInstanceIdMap.set(y,s)),s}getEventId(y){const s=this.eventIdPerMapInstanceMap.get(y)||0;return this.eventIdPerMapInstanceMap.set(y,s+1),s}postStyleLoadEvent(y,s){const{map:h,style:v,importedStyles:w}=s;if(!i.e.EVENTS_URL||!y&&!i.e.ACCESS_TOKEN)return;const P=this.getMapInstanceId(h),O={mapInstanceId:P,eventId:this.getEventId(P),style:v};w.length&&(O.importedStyles=w),this.queueRequest({timestamp:Date.now(),payload:O},y)}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,payload:h}=this.queue.shift();this.postEvent(s,h,()=>{},y)}},Le=Ze.postStyleLoadEvent.bind(Ze),qe=new class extends Pe{constructor(y){super("metrics"),y&&(this.data=y)}postMetricsEvent(y){if(!i.e.EVENTS_URL||!y&&!i.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID();const s=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:s},y)}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,payload:h}=this.queue.shift();this.postEvent(s,h,()=>{},y)}}({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Ge=qe.postMetricsEvent.bind(qe),je=new class extends Pe{constructor(){super("gljs.performance")}postPerformanceEvent(y,s){i.e.EVENTS_URL&&(y||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:s},y)}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,performanceData:h}=this.queue.shift(),v=function(w){const P=performance.getEntriesByType("resource"),O=performance.getEntriesByType("mark"),L=function(re){const le={};if(re){for(const ue in re)if(ue!=="other")for(const _e of re[ue]){const ge=`${ue}ResolveRangeMin`,Se=`${ue}ResolveRangeMax`,ke=`${ue}RequestCount`,Te=`${ue}RequestCachedCount`;le[ge]=Math.min(le[ge]||1/0,_e.startTime),le[Se]=Math.max(le[Se]||-1/0,_e.responseEnd);const $e=Re=>{le[Re]===void 0&&(le[Re]=0),++le[Re]};_e.transferSize!==void 0&&_e.transferSize===0&&$e(Te),$e(ke)}}return le}(function(re,le){const ue={};if(re)for(const _e of re){const ge=le(_e);ue[ge]===void 0&&(ue[ge]=[]),ue[ge].push(_e)}return ue}(P,E)),z=window.devicePixelRatio,G=navigator.connection||navigator.mozConnection||navigator.webkitConnection,H=G?G.effectiveType:void 0,Q={counters:[],metadata:[],attributes:[]},K=(re,le,ue)=>{ue!=null&&re.push({name:le,value:ue.toString()})};for(const re in L)K(Q.counters,re,L[re]);if(w.interactionRange[0]!==1/0&&w.interactionRange[1]!==-1/0&&(K(Q.counters,"interactionRangeMin",w.interactionRange[0]),K(Q.counters,"interactionRangeMax",w.interactionRange[1])),O)for(const re of Object.values(_)){const le=O.find(ue=>ue.name===re);le&&K(Q.counters,re,le.startTime)}return K(Q.counters,"visibilityHidden",w.visibilityHidden),K(Q.attributes,"style",function(re){if(re)for(const le of re){const ue=le.name.split("?")[0];if(i.i(ue)){const _e=ue.split("/").slice(-2);if(_e.length===2)return`mapbox://styles/${_e[0]}/${_e[1]}`}}}(P)),K(Q.attributes,"terrainEnabled",w.terrainEnabled?"true":"false"),K(Q.attributes,"fogEnabled",w.fogEnabled?"true":"false"),K(Q.attributes,"projection",w.projection),K(Q.attributes,"zoom",w.zoom),K(Q.metadata,"devicePixelRatio",z),K(Q.metadata,"connectionEffectiveType",H),K(Q.metadata,"navigatorUserAgent",navigator.userAgent),K(Q.metadata,"screenWidth",window.screen.width),K(Q.metadata,"screenHeight",window.screen.height),K(Q.metadata,"windowWidth",window.innerWidth),K(Q.metadata,"windowHeight",window.innerHeight),K(Q.metadata,"mapWidth",w.width/z),K(Q.metadata,"mapHeight",w.height/z),K(Q.metadata,"webglRenderer",w.renderer),K(Q.metadata,"webglVendor",w.vendor),K(Q.metadata,"sdkVersion",g),K(Q.metadata,"sdkIdentifier","mapbox-gl-js"),Q}(h);for(const w of v.metadata);for(const w of v.counters);for(const w of v.attributes);this.postEvent(s,v,()=>{},y)}},ot=je.postPerformanceEvent.bind(je),St=new class extends Pe{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(y,s,h,v){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const w=we(i.e.API_URL+i.e.SESSION_PATH);w.params.push(`sku=${s||""}`),w.params.push(`access_token=${v||i.e.ACCESS_TOKEN||""}`);const P={url:Ae(w),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(P,O=>{this.pendingRequest=null,h(O),this.saveEventData(),this.processRequests(v)})}getSessionAPI(y,s,h,v){this.skuToken=s,this.errorCb=v,i.e.SESSION_PATH&&i.e.API_URL&&(h||i.e.ACCESS_TOKEN?this.queueRequest({id:y,timestamp:Date.now()},h):this.errorCb(new Error(oe)))}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;const{id:s,timestamp:h}=this.queue.shift();s&&this.success[s]||this.getSession(h,this.skuToken,v=>{v?this.errorCb(v):s&&(this.success[s]=!0)},y)}remove(){this.errorCb=null}},rt=St.getSessionAPI.bind(St),Ut=new Set;function Ft(y,s){s?Ut.add(y):Ut.delete(y)}class dr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(s,h){this._updatedSourceCaches[s]=h,this.setDirty()}discardSourceCacheUpdate(s){delete this._updatedSourceCaches[s]}updateLayer(s){const h=s.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(s.id),this.setDirty()}removeLayer(s){const h=s.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][s.id]=s,this._updatedLayers[h].delete(s.id),this._updatedPaintProps.delete(s.fqid),this.setDirty()}getRemovedLayer(s){return this._removedLayers[s.scope]?this._removedLayers[s.scope][s.id]:null}discardLayerRemoval(s){this._removedLayers[s.scope]&&delete this._removedLayers[s.scope][s.id]}getLayerUpdatesByScope(){const s={};for(const h in this._updatedLayers)s[h]=s[h]||{},s[h].updatedIds=Array.from(this._updatedLayers[h].values());for(const h in this._removedLayers)s[h]=s[h]||{},s[h].removedIds=Object.keys(this._removedLayers[h]);return s}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(s){this._updatedPaintProps.add(s.fqid),this.setDirty()}getUpdatedImages(s){return this._updatedImages[s]?Array.from(this._updatedImages[s].values()):[]}updateImage(s,h){this._updatedImages[h]=this._updatedImages[h]||new Set,this._updatedImages[h].add(i.I.toString(s)),this.setDirty()}resetUpdatedImages(s){this._updatedImages[s]&&this._updatedImages[s].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Lr(y){const{userImage:s}=y;return!!(s&&s.render&&s.render())&&(y.data.replace(new Uint8Array(s.data.buffer)),!0)}class Jr extends i.E{constructor(s){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=s,s!=="raster"&&i.r()&&(this.imageRasterizerDispatcher=new i.D(i.t(),this,"Image Rasterizer Worker",1))}addScope(s){this.loaded.set(s,!1),this.imageProviders.set(s,new Map),this.images.set(s,new Map),this.updatedImages.set(s,new Set),this.callbackDispatchedThisFrame.set(s,new Set),this.patterns.set(s,new Map),this.atlasImage.set(s,new i.q({width:1,height:1}))}removeScope(s){this.loaded.delete(s),this.imageProviders.delete(s),this.images.delete(s),this.updatedImages.delete(s),this.callbackDispatchedThisFrame.delete(s),this.patterns.delete(s),this.atlasImage.delete(s);const h=this.atlasTexture.get(s);h&&(h.destroy(),this.atlasTexture.delete(s))}addImageProvider(s,h){this.imageProviders.has(h)||this.imageProviders.set(h,new Map),this.imageProviders.get(h).set(s.id,s)}removeImageProvider(s,h){this.imageProviders.has(h)&&this.imageProviders.get(h).delete(s)}getPendingImageProviders(){const s=[];for(const h of this.imageProviders.values())for(const v of h.values())v.hasPendingRequests()&&s.push(v);return s}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.x),this._imageRasterizer}isLoaded(){for(const s of this.loaded.keys())if(!this.loaded.get(s))return!1;return!0}setLoaded(s,h){if(this.loaded.get(h)!==s&&(this.loaded.set(h,s),s)){for(const{ids:v,callback:w}of this.requestors)this._notify(v,h,w);this.requestors=[]}}hasImage(s,h){return!!this.getImage(s,h)}getImage(s,h){return this.images.get(h).get(s.toString())}addImage(s,h,v){this._validate(s,v)&&this.images.get(h).set(s.toString(),v)}_validate(s,h){let v=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new i.y(new Error(`Image "${s.name}" has invalid "stretchX" value`))),v=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new i.y(new Error(`Image "${s.name}" has invalid "stretchY" value`))),v=!1),this._validateContent(h.content,h)||(this.fire(new i.y(new Error(`Image "${s.name}" has invalid "content" value`))),v=!1),v}_validateStretch(s,h){if(!s)return!0;let v=0;for(const w of s){if(w[0]<v||w[1]<w[0]||h<w[1])return!1;v=w[1]}return!0}_validateContent(s,h){return s?s.length!==4||!h.usvg&&(s[0]<0||h.data.width<s[0]||s[1]<0||h.data.height<s[1]||s[2]<0||h.data.width<s[2]||s[3]<0||h.data.height<s[3])?!1:!(s[2]<s[0]||s[3]<s[1]):!0}updateImage(s,h,v){const w=this.images.get(h).get(s.toString());v.version=w.version+1,this.images.get(h).set(s.toString(),v),this.updatedImages.get(h).add(s),this.removeFromImageRasterizerCache(s,h)}clearUpdatedImages(s){this.updatedImages.get(s).clear()}removeFromImageRasterizerCache(s,h){this.spriteFormat!=="raster"&&(i.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[s],scope:h}):this.imageRasterizer.removeImagesFromCacheByIds([s],h))}removeImage(s,h){const v=this.images.get(h),w=v.get(s.toString());v.delete(s.toString()),this.patterns.get(h).delete(s.toString()),this.removeFromImageRasterizerCache(s,h),w.userImage&&w.userImage.onRemove&&w.userImage.onRemove()}listImages(s){return Array.from(this.images.get(s).keys()).map(h=>i.I.from(h))}getImages(s,h,v){const w=[],P=[],O=this.imageProviders.get(h);for(const H of s){if(!H.iconsetId){w.push(H);continue}const Q=O.get(H.iconsetId);Q&&(this.getImage(H,h)?P.push(H):Q.addPendingRequest(H))}if(w.length===0)return void this._notify(P,h,v);let L=!0;const z=!!this.loaded.get(h),G=this.images.get(h);if(!z)for(const H of w)G.has(H.toString())||(L=!1);z||L?this._notify(w,h,v):this.requestors.push({ids:w,scope:h,callback:v})}rasterizeImages(s,h){const v=new Map,{tasks:w,scope:P}=s;for(const[O,L]of w.entries()){const z=this.getImage(L.id,P);z&&v.set(O,{image:z,imageVariant:L})}this._rasterizeImages(P,v,h)}_rasterizeImages(s,h,v){if(i.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:h,scope:s},v);else{const w=new Map;for(const[P,{image:O,imageVariant:L}]of h.entries())w.set(P,this.imageRasterizer.rasterize(L,O,s,0));v(void 0,w)}}getUpdatedImages(s){return this.updatedImages.get(s)||new Set}_notify(s,h,v){const w=this.images.get(h),P=new Map;for(const O of s){if(!w.get(O.toString())){if(O.iconsetId)continue;this.fire(new i.z("styleimagemissing",{id:O.name}))}const L=w.get(O.toString());if(!L){i.w(`Image "${O.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const z={data:L.usvg?null:L.data.clone(),pixelRatio:L.pixelRatio,sdf:L.sdf,usvg:L.usvg,version:L.version,stretchX:L.stretchX,stretchY:L.stretchY,content:L.content,hasRenderCallback:!!(L.userImage&&L.userImage.render)};L.usvg&&Object.assign(z,{width:L.icon.usvg_tree.width,height:L.icon.usvg_tree.height}),P.set(i.I.toString(O),z)}v(null,P)}getPixelSize(s){const{width:h,height:v}=this.atlasImage.get(s);return{width:h,height:v}}getPattern(s,h,v){const w=s.toString(),P=this.patterns.get(h),O=P.get(w),L=this.getImage(s,h);if(!L)return null;if(O){if(O.position.version===L.version)return O.position;O.position.version=L.version}else{if(L.usvg&&!L.data){const z=this.getPatternInFlightId(w,h);if(this.patternsInFlight.has(z))return null;this.patternsInFlight.add(z);const G=new i.A(s).scaleSelf(i.o.devicePixelRatio),H=new Map([[G.toString(),{image:L,imageVariant:G}]]);return this._rasterizeImages(h,H,(Q,K)=>this.storePatternImage(G,h,L,v,K)),null}this.storePattern(s,h,L)}return this._updatePatternAtlas(h,v),P.get(w).position}getPatternInFlightId(s,h){return i.B(s,h)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(s,h,v,w,P){const O=s.toString(),L=P?P.get(O):void 0;L&&(v.data=L,this.storePattern(s.id,h,v),this._updatePatternAtlas(h,w),this.patternsInFlight.delete(this.getPatternInFlightId(s.id.toString(),h)))}storePattern(s,h,v){const w={w:v.data.width+2*i.C,h:v.data.height+2*i.C,x:0,y:0},P=new i.F(w,v,i.C);this.patterns.get(h).set(s.toString(),{bin:w,position:P})}destroyAtlasTextures(){for(const s of this.atlasTexture.values())s&&s.destroy();this.atlasTexture.clear()}bind(s,h){const v=s.gl;let w=this.atlasTexture.get(h);w?this.dirty&&(w.update(this.atlasImage.get(h)),this.dirty=!1):(w=new i.T(s,this.atlasImage.get(h),v.RGBA8),this.atlasTexture.set(h,w)),w.bind(v.LINEAR,v.CLAMP_TO_EDGE)}_updatePatternAtlas(s,h){const v=this.patterns.get(s),w=Array.from(v.values()).map(({bin:G})=>G),{w:P,h:O}=i.G(w),L=this.atlasImage.get(s);L.resize({width:P||1,height:O||1});const z=this.images.get(s);for(const[G,{bin:H,position:Q}]of v.entries()){let K=Q.padding;const re=H.x+K,le=H.y+K,ue=z.get(G).data,_e=ue.width,ge=ue.height;K=K>1?K-1:K,i.q.copy(ue,L,{x:0,y:0},{x:re,y:le},{width:_e,height:ge},h),i.q.copy(ue,L,{x:0,y:ge-K},{x:re,y:le-K},{width:_e,height:K},h),i.q.copy(ue,L,{x:0,y:0},{x:re,y:le+ge},{width:_e,height:K},h),i.q.copy(ue,L,{x:_e-K,y:0},{x:re-K,y:le},{width:K,height:ge},h),i.q.copy(ue,L,{x:0,y:0},{x:re+_e,y:le},{width:K,height:ge},h),i.q.copy(ue,L,{x:_e-K,y:ge-K},{x:re-K,y:le-K},{width:K,height:K},h),i.q.copy(ue,L,{x:0,y:ge-K},{x:re+_e,y:le-K},{width:K,height:K},h),i.q.copy(ue,L,{x:0,y:0},{x:re+_e,y:le+ge},{width:K,height:K},h),i.q.copy(ue,L,{x:_e-K,y:0},{x:re-K,y:le+ge},{width:K,height:K},h)}this.dirty=!0}beginFrame(){for(const s of this.images.keys())this.callbackDispatchedThisFrame.set(s,new Set)}dispatchRenderCallbacks(s,h){const v=this.images.get(h);for(const w of s){if(this.callbackDispatchedThisFrame.get(h).has(w.toString()))continue;this.callbackDispatchedThisFrame.get(h).add(w.toString());const P=v.get(w.toString());Lr(P)&&this.updateImage(w,h,P)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Rt(y){const s=y.value,h=y.valueSpec,v=y.style,w=y.styleSpec,P=y.key,O=y.arrayElementValidator||Ni;if(!Array.isArray(s))return[new i.V(P,s,`array expected, ${i.K(s)} found`)];if(h.length&&s.length!==h.length)return[new i.V(P,s,`array length ${h.length} expected, length ${s.length} found`)];if(h["min-length"]&&s.length<h["min-length"])return[new i.V(P,s,`array length at least ${h["min-length"]} expected, length ${s.length} found`)];let L={type:h.value,values:h.values,minimum:h.minimum,maximum:h.maximum,function:void 0};w.$version<7&&(L.function=h.function),i.H(h.value)&&(L=h.value);let z=[];for(let G=0;G<s.length;G++)z=z.concat(O({array:s,arrayIndex:G,value:s[G],valueSpec:L,style:v,styleSpec:w,key:`${P}[${G}]`},!0));return z}function At(y){const s=y.key,h=y.value,v=y.valueSpec;if(!i.L(h))return[new i.V(s,h,`number expected, ${i.K(h)} found`)];if(h!=h)return[new i.V(s,h,"number expected, NaN found")];if("minimum"in v){let w=v.minimum;if(Array.isArray(v.minimum)&&(w=v.minimum[y.arrayIndex]),h<w)return[new i.V(s,h,`${h} is less than the minimum value ${w}`)]}if("maximum"in v){let w=v.maximum;if(Array.isArray(v.maximum)&&(w=v.maximum[y.arrayIndex]),h>w)return[new i.V(s,h,`${h} is greater than the maximum value ${w}`)]}return[]}function Xe(y){const s=y.key,h=y.value;if(!i.H(h))return[new i.V(s,h,`object expected, ${i.K(h)} found`)];const v=y.valueSpec,w=i.J(h.type);let P,O,L,z={};const G=w!=="categorical"&&h.property===void 0,H=!G,Q=function(ue){const _e=ue.stops;return Array.isArray(_e)&&Array.isArray(_e[0])&&i.H(_e[0][0])}(h),K=so({key:y.key,value:y.value,valueSpec:y.styleSpec.function,style:y.style,styleSpec:y.styleSpec,objectElementValidators:{stops:function(ue){if(w==="identity")return[new i.V(ue.key,ue.value,'identity function may not have a "stops" property')];let _e=[];const ge=ue.value;return _e=_e.concat(Rt({key:ue.key,value:ge,valueSpec:ue.valueSpec,style:ue.style,styleSpec:ue.styleSpec,arrayElementValidator:re})),Array.isArray(ge)&&ge.length===0&&_e.push(new i.V(ue.key,ge,"array must have at least one stop")),_e},default:function(ue){return Ni({key:ue.key,value:ue.value,valueSpec:v,style:ue.style,styleSpec:ue.styleSpec})}}});return w==="identity"&&G&&K.push(new i.V(y.key,y.value,'missing required property "property"')),w==="identity"||h.stops||K.push(new i.V(y.key,y.value,'missing required property "stops"')),w==="exponential"&&v.expression&&!i.M(v)&&K.push(new i.V(y.key,y.value,"exponential functions not supported")),y.styleSpec.$version>=8&&(H&&!i.N(v)?K.push(new i.V(y.key,y.value,"property functions not supported")):G&&!i.O(v)&&K.push(new i.V(y.key,y.value,"zoom functions not supported"))),w!=="categorical"&&!Q||h.property!==void 0||K.push(new i.V(y.key,y.value,'"property" property is required')),K;function re(ue){let _e=[];const ge=ue.value,Se=ue.key;if(!Array.isArray(ge))return[new i.V(Se,ge,`array expected, ${i.K(ge)} found`)];if(ge.length!==2)return[new i.V(Se,ge,`array length 2 expected, length ${ge.length} found`)];if(Q){if(!i.H(ge[0]))return[new i.V(Se,ge,`object expected, ${i.K(ge[0])} found`)];const ke=ge[0];if(ke.zoom===void 0)return[new i.V(Se,ge,"object stop key must have zoom")];if(ke.value===void 0)return[new i.V(Se,ge,"object stop key must have value")];const Te=i.J(ke.zoom);if(typeof Te!="number")return[new i.V(Se,ke.zoom,"stop zoom values must be numbers")];if(L&&L>Te)return[new i.V(Se,ke.zoom,"stop zoom values must appear in ascending order")];Te!==L&&(L=Te,O=void 0,z={}),_e=_e.concat(so({key:`${Se}[0]`,value:ge[0],valueSpec:{zoom:{}},style:ue.style,styleSpec:ue.styleSpec,objectElementValidators:{zoom:At,value:le}}))}else _e=_e.concat(le({key:`${Se}[0]`,value:ge[0],style:ue.style,styleSpec:ue.styleSpec},ge));return i.Q(i.S(ge[1]))?_e.concat([new i.V(`${Se}[1]`,ge[1],"expressions are not allowed in function stops.")]):_e.concat(Ni({key:`${Se}[1]`,value:ge[1],valueSpec:v,style:ue.style,styleSpec:ue.styleSpec}))}function le(ue,_e){const ge=i.K(ue.value),Se=i.J(ue.value),ke=ue.value!==null?ue.value:_e;if(P){if(ge!==P)return[new i.V(ue.key,ke,`${ge} stop domain type must match previous stop domain type ${P}`)]}else P=ge;if(ge!=="number"&&ge!=="string"&&ge!=="boolean"&&typeof Se!="number"&&typeof Se!="string"&&typeof Se!="boolean")return[new i.V(ue.key,ke,"stop domain value must be a number, string, or boolean")];if(ge!=="number"&&w!=="categorical"){let Te=`number expected, ${ge} found`;return i.N(v)&&w===void 0&&(Te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(ue.key,ke,Te)]}return w!=="categorical"||ge!=="number"||typeof Se=="number"&&isFinite(Se)&&Math.floor(Se)===Se?w!=="categorical"&&ge==="number"&&typeof Se=="number"&&typeof O=="number"&&O!==void 0&&Se<O?[new i.V(ue.key,ke,"stop domain values must appear in ascending order")]:(O=Se,w==="categorical"&&Se in z?[new i.V(ue.key,ke,"stop domain values must be unique")]:(z[Se]=!0,[])):[new i.V(ue.key,ke,`integer expected, found ${String(Se)}`)]}}function ut(y){const s=(y.expressionContext==="property"?i.W:i.U)(i.S(y.value),y.valueSpec);if(s.result==="error")return s.value.map(v=>new i.V(`${y.key}${v.key}`,y.value,v.message));const h=s.value.expression||s.value._styleExpression.expression;if(y.expressionContext==="property"&&y.propertyKey==="text-font"&&!h.outputDefined())return[new i.V(y.key,y.value,`Invalid data expression for "${y.propertyKey}". Output values must be contained as literals within the expression.`)];if(y.expressionContext==="property"&&y.propertyType==="layout"&&!i.Z(h))return[new i.V(y.key,y.value,'"feature-state" data expressions are not supported with layout properties.')];if(y.expressionContext==="filter")return dt(h,y);if(y.expressionContext==="appearance")return rr(h,y);if(y.expressionContext&&y.expressionContext.indexOf("cluster")===0){if(!i.X(h,["zoom","feature-state"]))return[new i.V(y.key,y.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(y.expressionContext==="cluster-initial"&&!i.Y(h))return[new i.V(y.key,y.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function dt(y,s){const h=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(s.valueSpec&&s.valueSpec.expression)for(const w of s.valueSpec.expression.parameters)h.delete(w);if(h.size===0)return[];const v=[];return y instanceof i._&&h.has(y.name)?[new i.V(s.key,s.value,`["${y.name}"] expression is not supported in a filter for a ${s.object.type} layer with id: ${s.object.id}`)]:(y.eachChild(w=>{v.push(...dt(w,s))}),v)}function rr(y,s){const h=new Set;if(s.valueSpec&&s.valueSpec.expression)for(const w of s.valueSpec.expression.parameters)h.add(w);if(h.size===0)return[];const v=[];return y instanceof i._&&!h.has(y.name)?[new i.V(s.key,s.value,`["${y.name}"] is not an allowed parameter`)]:(y.eachChild(w=>{v.push(...rr(w,s))}),v)}function er(y){const s=y.key,h=y.value,v=y.valueSpec,w=[];return Array.isArray(v.values)?v.values.indexOf(i.J(h))===-1&&w.push(new i.V(s,h,`expected one of [${v.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(v.values).indexOf(i.J(h))===-1&&w.push(new i.V(s,h,`expected one of [${Object.keys(v.values).join(", ")}], ${JSON.stringify(h)} found`)),w}function tr(y){return i.a2(i.S(y.value))?ut(Object.assign({},y,{expressionContext:"filter",valueSpec:y.styleSpec[`filter_${y.layerType||"fill"}`]})):Pr(y)}function Pr(y){const s=y.value,h=y.key;if(!Array.isArray(s))return[new i.V(h,s,`array expected, ${i.K(s)} found`)];if(s.length<1)return[new i.V(h,s,"filter array must have at least 1 element")];const v=y.styleSpec;let w=er({key:`${h}[0]`,value:s[0],valueSpec:v.filter_operator});switch(i.J(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&i.J(s[1])==="$type"&&w.push(new i.V(h,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&w.push(new i.V(h,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(i.a0(s[1])||w.push(new i.V(`${h}[1]`,s[1],`string expected, ${i.K(s[1])} found`)));for(let P=2;P<s.length;P++)i.J(s[1])==="$type"?w=w.concat(er({key:`${h}[${P}]`,value:s[P],valueSpec:v.geometry_type})):i.a0(s[P])||i.L(s[P])||i.$(s[P])||w.push(new i.V(`${h}[${P}]`,s[P],`string, number, or boolean expected, ${i.K(s[P])} found.`));break;case"any":case"all":case"none":for(let P=1;P<s.length;P++)w=w.concat(Pr({key:`${h}[${P}]`,value:s[P],style:y.style,styleSpec:y.styleSpec}));break;case"has":case"!has":s.length!==2?w.push(new i.V(h,s,`filter array for "${s[0]}" operator must have 2 elements`)):i.a0(s[1])||w.push(new i.V(`${h}[1]`,s[1],`string expected, ${i.K(s[1])} found`))}return w}function un(y,s){const h=y.key,v=y.style,w=y.layer,P=y.styleSpec,O=y.value,L=y.objectKey,z=P[`${s}_${y.layerType}`];if(!z)return[];const G=L.match(/^(.*)-use-theme$/);if(G&&z[G[1]])return i.Q(i.S(O))?[].concat(Ni({key:h,value:O,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:v,styleSpec:P,expressionContext:"property",propertyType:s,propertyKey:L})):Ni({key:h,value:O,valueSpec:{type:"string"},style:v,styleSpec:P});const H=L.match(/^(.*)-transition$/);if(s==="paint"&&H&&z[H[1]]&&z[H[1]].transition)return Ni({key:h,value:O,valueSpec:P.transition,style:v,styleSpec:P});const Q=y.valueSpec||z[L];if(!Q)return[new i.a3(h,O,`unknown property "${L}"`)];let K;if(i.a0(O)&&i.N(Q)&&!Q.tokens&&(K=/^{([^}]+)}$/.exec(O))){const le=`\`{ "type": "identity", "property": ${K?JSON.stringify(K[1]):'"_"'} }\``;return[new i.V(h,O,`"${L}" does not support interpolation syntax
Use an identity property function instead: ${le}.`)]}const re=[];if(y.layerType==="symbol")L!=="text-field"||!v||v.glyphs||v.imports||re.push(new i.V(h,O,'use of "text-field" requires a style "glyphs" property')),L==="text-font"&&i.a4(i.S(O))&&i.J(O.type)==="identity"&&re.push(new i.V(h,O,'"text-font" does not support identity functions'));else if(y.layerType==="model"&&s==="paint"&&w&&w.layout&&w.layout.hasOwnProperty("model-id")&&i.N(Q)&&(i.a5(Q)||i.O(Q))){const le=i.W(i.S(O),Q).value,ue="expression"in le&&le.expression||"_styleExpression"in le&&le._styleExpression&&le._styleExpression.expression;ue&&!i.X(ue,["measure-light"])&&(L==="model-emissive-strength"&&i.Y(ue)&&i.Z(ue)||re.push(new i.V(h,O,`${L} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return re.concat(Ni({key:y.key,value:O,valueSpec:Q,style:v,styleSpec:P,expressionContext:"property",propertyType:s,propertyKey:L}))}function pn(y){return un(y,"paint")}function Pi(y){return un(y,"layout")}function gi(y){let s=[];const h=y.value,v=y.key,w=y.style,P=y.styleSpec;if(!i.H(h))return[new i.V(v,h,"object expected")];h.type||h.ref||s.push(new i.V(v,h,'either "type" or "ref" is required'));let O=i.J(h.type);const L=i.J(h.ref);if(h.id){const z=i.J(h.id);for(let G=0;G<y.arrayIndex;G++){const H=w.layers[G];i.J(H.id)===z&&s.push(new i.V(v,h.id,`duplicate layer id "${z}", previously used at line ${H.id.__line__}`))}}if("ref"in h){let z;["type","source","source-layer","filter","layout"].forEach(G=>{G in h&&s.push(new i.V(v,h[G],`"${G}" is prohibited for ref layers`))}),w.layers.forEach(G=>{i.J(G.id)===L&&(z=G)}),z?z.ref?s.push(new i.V(v,h.ref,"ref cannot reference another ref layer")):O=i.J(z.type):typeof L=="string"&&s.push(new i.V(v,h.ref,`ref layer "${L}" not found`))}else if(O!=="background"&&O!=="sky"&&O!=="slot")if(h.source)if(i.a0(h.source)){const z=w.sources&&w.sources[h.source],G=z&&i.J(z.type);z?G==="vector"&&O==="raster"?s.push(new i.V(v,h.source,`layer "${h.id}" requires a raster source`)):G==="raster"&&O!=="raster"?s.push(new i.V(v,h.source,`layer "${h.id}" requires a vector source`)):G!=="vector"||h["source-layer"]?G==="raster-dem"&&O!=="hillshade"?s.push(new i.V(v,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):G!=="raster-array"||["raster","raster-particle"].includes(O)?O==="line"&&h.paint&&(h.paint["line-gradient"]||h.paint["line-trim-offset"])&&G==="geojson"&&!z.lineMetrics?s.push(new i.V(v,h,`layer "${h.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):O==="raster-particle"&&G!=="raster-array"&&s.push(new i.V(v,h.source,`layer "${h.id}" requires a 'raster-array' source.`)):s.push(new i.V(v,h.source,"raster-array source can only be used with layer type 'raster'.")):s.push(new i.V(v,h,`layer "${h.id}" must specify a "source-layer"`)):s.push(new i.V(v,h.source,`source "${h.source}" not found`))}else s.push(new i.V(`${v}.source`,h.source,'"source" must be a string'));else s.push(new i.V(v,h,'missing required property "source"'));return s=s.concat(so({key:v,value:h,valueSpec:P.layer,style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ni({key:`${v}.type`,value:h.type,valueSpec:P.layer.type,style:y.style,styleSpec:y.styleSpec,object:h,objectKey:"type"}),filter:z=>tr(Object.assign({layerType:O},z)),layout:z=>so({layer:h,key:z.key,value:z.value,valueSpec:{},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{"*":G=>Pi(Object.assign({layerType:O},G))}}),paint:z=>so({layer:h,key:z.key,value:z.value,valueSpec:{},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{"*":G=>pn(Object.assign({layerType:O,layer:h},G))}}),appearances(z){const G=Rt({key:z.key,value:z.value,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:K=>function(re){const{key:le,layer:ue,layerType:_e}=re,ge=i.J(re.value),Se=i.J(ge.name),ke=i.J(ge.condition),Te=so({key:le,value:ge,valueSpec:re.styleSpec.appearance,style:re.style,styleSpec:re.styleSpec,objectElementValidators:{condition:$e=>function(Re){const Ve=[];return Ve.push(...ut({key:Re.key,value:Re.object.condition,valueSpec:i.a6.appearance.condition,expressionContext:"appearance"})),Ve}(Object.assign({layer:ue,layerType:_e},$e)),properties:$e=>function(Re){const Ve=[],{styleSpec:Be,layer:De,layerType:We}=Re,lt=Be[`paint_${We}`],it=Be[`layout_${We}`],bt=Re.object[Re.objectKey];for(const mt in bt){const Ot=mt in lt?"paint":mt in it?"layout":void 0;if(!Ot){Ve.push(new i.V(Re.key,mt,`unknown property "${mt}" for layer type "${We}"`));continue}const Zt=Object.assign({},Re,{key:`${Re.key}.${mt}`,object:bt,objectKey:mt,layer:De,layerType:We,value:bt[mt],valueSpec:Ot==="paint"?lt[mt]:it[mt]});Ve.push(...un(Zt,Ot))}return Ve}(Object.assign({layer:ue,layerType:_e},$e))}});return Se!=="hidden"&&ke===void 0&&Te.push(new i.V(re.key,"name",'Appearance with name different than "hidden" must have a condition')),Te}(Object.assign({layerType:O,layer:h},K))}),H=Array.isArray(z.value)?z.value:[],Q=new Set;return H.forEach((K,re)=>{const le=i.J(K.name);if(le)if(Q.has(le)){const ue=i.J(h.id);G.push(new i.V(z.key,le,`Duplicated appearance name "${le}" for layer "${ue}"`))}else Q.add(le)}),G}}})),s}function Zi({key:y,value:s}){return i.a0(s)?[]:[new i.V(y,s,`string expected, ${i.K(s)} found`)]}const js={promoteId:function y({key:s,value:h}){if(i.a0(h))return Zi({key:s,value:h});if(Array.isArray(h)){const w=[],P=i.S(h),O=i.U(P);return O.result==="error"&&O.value.forEach(L=>{w.push(new i.V(`${s}${L.key}`,null,`${L.message}`))}),i.X(O.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||w.push(new i.V(`${s}`,null,"promoteId expression should be only feature dependent")),w}if(!i.H(h))return[new i.V(s,h,`string, expression or object expected, "${i.K(h)}" found`)];const v=[];for(const w in h)v.push(...y({key:`${s}.${w}`,value:h[w]}));return v}};function Va(y){const s=y.value,h=y.key,v=y.styleSpec,w=y.style;if(!i.H(s))return[new i.V(h,s,`object expected, ${i.K(s)} found`)];if(!("type"in s))return[new i.V(h,s,'"type" is required')];const P=i.J(s.type);let O=[];switch(["vector","raster","raster-dem","raster-array"].includes(P)&&("url"in s||"tiles"in s||O.push(new i.a3(h,s,'Either "url" or "tiles" is required.'))),P){case"vector":case"raster":case"raster-dem":case"raster-array":return O=O.concat(so({key:h,value:s,valueSpec:v[`source_${P.replace("-","_")}`],style:y.style,styleSpec:v,objectElementValidators:js})),O;case"geojson":if(O=so({key:h,value:s,valueSpec:v.source_geojson,style:w,styleSpec:v,objectElementValidators:js}),"cluster"in s&&"clusterProperties"in s){if(!i.H(s.clusterProperties))return[new i.V(`${h}.clusterProperties`,s,`object expected, ${i.K(s)} found`)];for(const L in s.clusterProperties){const z=s.clusterProperties[L];if(!Array.isArray(z))return[new i.V(`${h}.clusterProperties.${L}`,z,"array expected")];const[G,H]=z,Q=typeof G=="string"?[G,["accumulated"],["get",L]]:G;O.push(...ut({key:`${h}.${L}.map`,value:H,expressionContext:"cluster-map"})),O.push(...ut({key:`${h}.${L}.reduce`,value:Q,expressionContext:"cluster-reduce"}))}}return O;case"video":return so({key:h,value:s,valueSpec:v.source_video,style:w,styleSpec:v});case"image":return so({key:h,value:s,valueSpec:v.source_image,style:w,styleSpec:v});case"canvas":return[new i.V(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return er({key:`${h}.type`,value:s.type,valueSpec:{values:Si(v)}})}}function Si(y){return y.source.reduce((s,h)=>{const v=y[h];return v.type.type==="enum"&&(s=s.concat(Object.keys(v.type.values||{}))),s},[])}function bs(y){const s=y.value,h=y.styleSpec,v=h.light,w=y.style;if(s===void 0)return[];if(!i.H(s))return[new i.V("light",s,`object expected, ${i.K(s)} found`)];let P=[];for(const O in s){const L=O.match(/^(.*)-transition$/),z=O.match(/^(.*)-use-theme$/);P=P.concat(z&&v[z[1]]?Ni({key:O,value:s[O],valueSpec:{type:"string"},style:w,styleSpec:h}):L&&v[L[1]]&&v[L[1]].transition?Ni({key:O,value:s[O],valueSpec:h.transition,style:w,styleSpec:h}):v[O]?Ni({key:O,value:s[O],valueSpec:v[O],style:w,styleSpec:h}):[new i.V(O,s[O],`unknown property "${O}"`)])}return P}function Bo(y){const s=y.value;if(!s)return[];const h=y.key;if(!i.H(s))return[new i.V(h,s,`object expected, ${i.K(s)} found`)];let v=[];const w=y.styleSpec,P=w["light-3d"],O=y.style,L=y.style.lights;for(const H of["type","id"])if(!(H in s))return v=v.concat([new i.V(h,s,`missing property "${H}"`)]),v;if(!i.a0(s.type))return v=v.concat([new i.V(`${h}.type`,s.type,"string expected")]),v;if(L)for(let H=0;H<y.arrayIndex;H++){const Q=i.J(s.type),K=L[H];i.J(K.type)===Q&&v.push(new i.V(h,s.id,`duplicate light type "${s.type}", previously defined at line ${K.id.__line__}`))}const z=`properties_light_${s.type}`;if(!(z in w))return v=v.concat([new i.V(`${h}.type`,s,`Invalid light type ${s.type}`)]),v;const G=w[z];for(const H in s)if(H==="properties"){const Q=s[H];if(!i.H(Q))return v=v.concat([new i.V("properties",Q,`object expected, ${i.K(Q)} found`)]),v;for(const K in Q){const re=K.match(/^(.*)-transition$/),le=K.match(/^(.*)-use-theme$/);v=v.concat(le&&G[le[1]]?Ni({key:H,value:Q[K],valueSpec:{type:"string"},style:O,styleSpec:w}):re&&G[re[1]]&&G[re[1]].transition?Ni({key:H,value:s[H],valueSpec:w.transition,style:O,styleSpec:w}):G[K]?Ni({key:K,value:Q[K],valueSpec:G[K],style:O,styleSpec:w}):[new i.a3(y.key,Q[K],`unknown property "${K}"`)])}}else v=v.concat(P[H]?Ni({key:H,value:s[H],valueSpec:P[H],style:O,styleSpec:w}):[new i.a3(H,s[H],`unknown property "${H}"`)]);return v}function Ns(y){const s=y.value,h=y.key,v=y.style,w=y.styleSpec,P=w.terrain;if(s==null)return[];if(!i.H(s))return[new i.V("terrain",s,`object expected, ${i.K(s)} found`)];let O=[];for(const L in s){const z=L.match(/^(.*)-transition$/),G=L.match(/^(.*)-use-theme$/);O=O.concat(G&&P[G[1]]?Ni({key:L,value:s[L],valueSpec:{type:"string"},style:v,styleSpec:w}):z&&P[z[1]]&&P[z[1]].transition?Ni({key:L,value:s[L],valueSpec:w.transition,style:v,styleSpec:w}):P[L]?Ni({key:L,value:s[L],valueSpec:P[L],style:v,styleSpec:w}):[new i.a3(L,s[L],`unknown property "${L}"`)])}if(s.source)if(i.a0(s.source)){const L=v.sources&&v.sources[s.source],z=L&&i.J(L.type);L?z!=="raster-dem"&&O.push(new i.V(`${h}.source`,s.source,`terrain cannot be used with a source of type ${z}, it only be used with a "raster-dem" source type`)):O.push(new i.V(`${h}.source`,s.source,`source "${s.source}" not found`))}else O.push(new i.V(`${h}.source`,s.source,"source must be a string"));else O.push(new i.V(h,s,'terrain is missing required property "source"'));return O}function $o(y){const s=y.value,h=y.style,v=y.styleSpec,w=v.fog;if(s===void 0)return[];if(!i.H(s))return[new i.V("fog",s,`object expected, ${i.K(s)} found`)];let P=[];for(const O in s){const L=O.match(/^(.*)-transition$/),z=O.match(/^(.*)-use-theme$/);P=P.concat(z&&w[z[1]]?Ni({key:O,value:s[O],valueSpec:{type:"string"},style:h,styleSpec:v}):L&&w[L[1]]&&w[L[1]].transition?Ni({key:O,value:s[O],valueSpec:v.transition,style:h,styleSpec:v}):w[O]?Ni({key:O,value:s[O],valueSpec:w[O],style:h,styleSpec:v}):[new i.a3(O,s[O],`unknown property "${O}"`)])}return P}const rs={"*":()=>[],array:Rt,boolean:function(y){const s=y.value,h=y.key;return i.$(s)?[]:[new i.V(h,s,`boolean expected, ${i.K(s)} found`)]},number:At,color:function({key:y,value:s}){return i.a0(s)?i.a1.parseCSSColor(s)===null?[new i.V(y,s,`color expected, "${s}" found`)]:[]:[new i.V(y,s,`color expected, ${i.K(s)} found`)]},enum:er,filter:tr,function:Xe,layer:gi,object:so,source:Va,model:i.a7,light:bs,"light-3d":Bo,terrain:Ns,fog:$o,string:Zi,formatted:function(y){return Zi(y).length===0?[]:ut(y)},resolvedImage:function(y){return Zi(y).length===0?[]:ut(y)},projection:function(y){const s=y.value,h=y.styleSpec,v=h.projection,w=y.style;if(i.H(s)){let P=[];for(const O in s)P=P.concat(Ni({key:O,value:s[O],valueSpec:v[O],style:w,styleSpec:h}));return P}return i.a0(s)?[]:[new i.V("projection",s,`object or string expected, ${i.K(s)} found`)]},import:function(y){const s=y.key,{value:h,styleSpec:v}=y;if(!i.H(h))return[new i.V(s,h,"import must be an object")];const{data:w,...P}=h;Object.defineProperty(P,"__line__",{value:h.__line__,enumerable:!1});let O=so(Object.assign({},y,{value:P,valueSpec:v.import}));return i.J(P.id)===""&&O.push(new i.V(`${y.key}.id`,P,"import id can't be an empty string")),w&&(O=O.concat(xr(w,v,{key:`${y.key}.data`}))),O},iconset:function(y){const s=y.value,h=y.key,v=y.styleSpec,w=y.style;if(!i.H(s))return[new i.V(h,s,"object expected")];if(!s.type)return[new i.V(h,s,'"type" is required')];const P=i.J(s.type);let O=[];if(O=O.concat(so({key:h,value:s,valueSpec:v[`iconset_${P}`],style:w,styleSpec:v})),function(L,z){return!(L!=="source"||!z.source)}(P,s)){const L=w.sources&&w.sources[s.source],z=L&&i.J(L.type);L?z!=="raster-array"&&O.push(new i.V(h,s.source,`iconset cannot be used with a source of type ${String(z)}, it only be used with a "raster-array" source type`)):O.push(new i.V(h,s.source,`source "${s.source}" not found`))}return O}};function Ni(y,s=!1){const h=y.value,v=y.valueSpec,w=y.styleSpec;if(v.expression){if(i.a4(i.J(h)))return Xe(y);if(i.Q(i.S(h)))return ut(y)}if(v.type&&rs[v.type]){const P=rs[v.type](y);return s===!0&&P.length>0&&Array.isArray(y.value)?ut(y):P}return so(Object.assign({},y,{valueSpec:v.type?w[v.type]:v}))}function so(y){const s=y.key,h=y.value,v=y.valueSpec||{},w=y.objectElementValidators||{},P=y.style,O=y.styleSpec;if(!i.H(h))return[new i.V(s,h,`object expected, ${i.K(h)} found`)];let L=[];for(const z in h){const G=z.split(".")[0];let H;w[G]?H=w[G]:v[G]?H=Ni:w["*"]?H=w["*"]:v["*"]&&(H=Ni),H?L=L.concat(H({key:(s&&`${s}.`)+z,value:h[z],valueSpec:v[G]||v["*"],style:P,styleSpec:O,object:h,objectKey:z},h)):L.push(new i.a3(s,h[z],`unknown property "${z}"`))}for(const z in v){if(w[z])continue;const G=v[z];G.required&&G.default===void 0&&h[z]===void 0&&L.push(new i.V(s,h,`missing required property "${z}"`))}return L}function gl({key:y,value:s}){const h=Zi({key:y,value:s});if(h.length)return h;const v=s;return v.indexOf("{fontstack}")===-1&&h.push(new i.V(y,s,'"glyphs" url must include a "{fontstack}" token')),v.indexOf("{range}")===-1&&h.push(new i.V(y,s,'"glyphs" url must include a "{range}" token')),h}function xr(y,s=i.a6,h={}){return so({key:h.key||"",value:y,valueSpec:Object.assign(s.$root,{"*":{type:"*"}}),styleSpec:s,style:y,objectElementValidators:{glyphs:gl}})}function Sn(y,s=i.a6){return ct(xr(y,s))}const kn=y=>ct(Va(y)),Ii=y=>ct(bs(y)),pa=y=>ct(Bo(y)),Uo=y=>ct(Ns(y)),Mt=y=>ct($o(y)),Vo=y=>ct(function(s){const h=s.value,v=s.style,w=s.styleSpec,P=w.snow;if(h===void 0)return[];if(!i.H(h))return[new i.V("snow",h,`object expected, ${i.K(h)} found`)];let O=[];for(const L in h){const z=L.match(/^(.*)-transition$/);O=O.concat(z&&P[z[1]]&&P[z[1]].transition?Ni({key:L,value:h[L],valueSpec:w.transition,style:v,styleSpec:w}):P[L]?Ni({key:L,value:h[L],valueSpec:P[L],style:v,styleSpec:w}):[new i.a3(L,h[L],`unknown property "${L}"`)])}return O}(y)),yl=y=>ct(function(s){const h=s.value,v=s.style,w=s.styleSpec,P=w.rain;if(h===void 0)return[];if(!i.H(h))return[new i.V("rain",h,`object expected, ${i.K(h)} found`)];let O=[];for(const L in h){const z=L.match(/^(.*)-transition$/);O=O.concat(z&&P[z[1]]&&P[z[1]].transition?Ni({key:L,value:h[L],valueSpec:w.transition,style:v,styleSpec:w}):P[L]?Ni({key:L,value:h[L],valueSpec:P[L],style:v,styleSpec:w}):[new i.a3(L,h[L],`unknown property "${L}"`)])}return O}(y)),ns=y=>ct(gi(y)),bn=y=>ct(tr(y)),is=y=>ct(pn(y)),Kb=y=>ct(Pi(y)),pg=y=>ct(i.a7(y));function ct(y){return y.slice().sort((s,h)=>s.line&&h.line?s.line-h.line:0)}function fe(y,s){let h=!1;if(s&&s.length)for(const v of s)v instanceof i.a3?i.w(v.message):(y.fire(new i.y(new Error(v.message))),h=!0);return h}const ve=i.a6.light;let Me;class Je extends i.E{constructor(s,h="flat"){super(),this._transitionable=new i.a8(Me||(Me=new i.a9({anchor:new i.aa(ve.anchor),position:new i.ab(ve.position),color:new i.aa(ve.color),intensity:new i.aa(ve.intensity)}))),this.setLight(s,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h,v={}){this._validate(Ii,s,v)||(this._transitionable.setTransitionOrValue(s),this.id=h)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,v){return(!v||v.validate!==!1)&&fe(this,s.call(Sn,Object.assign({value:h,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}const Ye=i.a6.terrain;let at=class extends i.E{constructor(y,s,h,v,w){super(),this.scope=h,this._transitionable=new i.a8(new i.a9({source:new i.aa(Ye.source),exaggeration:new i.aa(Ye.exaggeration)}),h,v),this._transitionable.setTransitionOrValue(y,v),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s,this.worldview=w}get(){return this._transitionable.serialize()}set(y,s){this._transitionable.setTransitionOrValue(y,s)}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}getExaggeration(y){return this._transitioning.possiblyEvaluate(new i.ac(y,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const y=this._transitionable._values.exaggeration;if(!y)return null;const s=y.value.expression;if(!s)return null;let h=-1,v=-1,w=1;for(const P of s.zoomStops)w=s.evaluate(new i.ac(P,{worldview:this.worldview})),w>.01?(h=P,v=-1):v=P;return w<.01&&h>0&&v>h?[h,v]:null}isZoomDependent(){const y=this._transitionable._values.exaggeration;return y!=null&&y.value!=null&&y.value.expression!=null&&y.value.expression instanceof i.ad}};const _t=45,st=65,yt=.05;function Kt(y,s,h,v){const w=i.ah(_t,st,h),[P,O]=Bt(y,v);let L=1-Math.min(1,Math.exp((s-P)/(O-P)*-6));return L*=L*L,L=Math.min(1,1.00747*L),L*w*y.alpha}function Bt(y,s){const h=.5/Math.tan(.5*s);return[y.range[0]+h,y.range[1]+h]}function Tr(y,s,h,v,w){const P=i.af([],[s,h,v],w.mercatorFogMatrix);return Kt(y,i.ag(P),w.pitch,w._fov)}function Kr(y,s,h,v,w,P,O){const L=[[h,v,0],[w,v,0],[w,P,0],[h,P,0]];let z=Number.MAX_VALUE,G=-Number.MAX_VALUE;for(const H of L){const Q=i.af([],H,s),K=i.ag(Q);z=Math.min(z,K),G=Math.max(G,K)}return[Kt(y,z,O.pitch,O._fov),Kt(y,G,O.pitch,O._fov)]}const Wr=i.a6.fog;class Ir extends i.E{constructor(s,h,v,w){super();const P=new i.a9({range:new i.aa(Wr.range),color:new i.aa(Wr.color),"color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.aa(Wr["high-color"]),"high-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.aa(Wr["space-color"]),"space-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.aa(Wr["horizon-blend"]),"star-intensity":new i.aa(Wr["star-intensity"]),"vertical-range":new i.aa(Wr["vertical-range"])});this._transitionable=new i.a8(P,v,new Map(w)),this.set(s,w),this._transitioning=this._transitionable.untransitioned(),this._transform=h,this.properties=new i.ai(P),this.scope=v}get state(){const s=this._transform,h=s.projection.name==="globe",v=i.aj(s.zoom),w=this.properties.get("range"),P=[.5,3];return{range:h?[i.ak(P[0],w[0],v),i.ak(P[1],w[1],v)]:w,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,h,v={}){if(this._validate(Mt,s,v))return;const w=Object.assign({},s);for(const P of Object.keys(Wr))w[P]===void 0&&(w[P]=Wr[P].default);this._options=w,this._transitionable.setTransitionOrValue(this._options,h)}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.ah(_t,st,s))*h.a}getOpacityAtLatLng(s,h){return this._transform.projection.supportsFog?function(v,w,P){const O=i.ae.fromLngLat(w),L=P.elevation?P.elevation.getAtPointOrZero(O):0;return Tr(v,O.x,O.y,L,P)}(this.state,s,h):0}getOpacityForTile(s){if(!this._transform.projection.supportsFog)return[1,1];const h=this._transform.calculateFogTileMatrix(s.toUnwrapped());return Kr(this.state,h,0,0,i.al,i.al,this._transform)}getOpacityForBounds(s,h,v,w,P){return this._transform.projection.supportsFog?Kr(this.state,s,h,v,w,P,this._transform):[1,1]}getFovAdjustedRange(s){return this._transform.projection.supportsFog?Bt(this.state,s):[0,1]}isVisibleOnFrustum(s){if(!this._transform.projection.supportsFog)return!1;const h=[4,5,6,7];for(const v of h){const w=s.points[v];let P;if(w[2]>=0)P=w;else{const O=s.points[v-4];P=i.am(O,w,O[2]/(O[2]-w[2]))}if(Tr(this.state,P[0],P[1],0,this._transform)>=yt)return!0}return!1}updateConfig(s){this._transitionable.setTransitionOrValue(this._options,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,v){return(!v||v.validate!==!1)&&fe(this,s.call(Sn,Object.assign({value:h,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}let yn,En,pi,ca,za=class extends i.E{constructor(y,s,h,v){super();const w=yn||(yn=new i.a9({density:new i.aa(i.a6.snow.density),intensity:new i.aa(i.a6.snow.intensity),color:new i.aa(i.a6.snow.color),opacity:new i.aa(i.a6.snow.opacity),vignette:new i.aa(i.a6.snow.vignette),"vignette-color":new i.aa(i.a6.snow["vignette-color"]),"center-thinning":new i.aa(i.a6.snow["center-thinning"]),direction:new i.aa(i.a6.snow.direction),"flake-size":new i.aa(i.a6.snow["flake-size"])}));this._transitionable=new i.a8(w,h,new Map(v)),this.set(y,v),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(w),this.scope=h}get state(){const y=this.properties.get("opacity"),s=this.properties.get("color"),h=this.properties.get("direction"),v=i.an(h[0]),w=-Math.max(i.an(h[1]),.01),P=[Math.cos(v)*Math.cos(w),Math.sin(v)*Math.cos(w),Math.sin(w)],O=this.properties.get("vignette"),L=this.properties.get("vignette-color");return L.a=O,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(s.r,s.g,s.b,s.a*y),direction:P,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:L}}get(){return this._transitionable.serialize()}set(y,s,h={}){if(this._validate(Vo,y,h))return;const v=Object.assign({},y),w=i.a6.snow;for(const P of Object.keys(w))v[P]===void 0&&(v[P]=w[P].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,s)}updateConfig(y){this._transitionable.setTransitionOrValue(this._options,new Map(y))}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}_validate(y,s,h){return(!h||h.validate!==!1)&&fe(this,y.call(Sn,Object.assign({value:s,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}},Ea=class extends i.E{constructor(y,s,h,v){super();const w=En||(En=new i.a9({density:new i.aa(i.a6.rain.density),intensity:new i.aa(i.a6.rain.intensity),color:new i.aa(i.a6.rain.color),opacity:new i.aa(i.a6.rain.opacity),vignette:new i.aa(i.a6.rain.vignette),"vignette-color":new i.aa(i.a6.rain["vignette-color"]),"center-thinning":new i.aa(i.a6.rain["center-thinning"]),direction:new i.aa(i.a6.rain.direction),"droplet-size":new i.aa(i.a6.rain["droplet-size"]),"distortion-strength":new i.aa(i.a6.rain["distortion-strength"])}));this._transitionable=new i.a8(w,h,new Map(v)),this.set(y,v),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(w),this.scope=h}get state(){const y=this.properties.get("opacity"),s=this.properties.get("color"),h=this.properties.get("direction"),v=i.an(h[0]),w=-Math.max(i.an(h[1]),.01),P=[Math.cos(v)*Math.cos(w),Math.sin(v)*Math.cos(w),Math.sin(w)],O=this.properties.get("vignette-color");return O.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(s.r,s.g,s.b,s.a*y),direction:P,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:O}}get(){return this._transitionable.serialize()}set(y,s,h={}){if(this._validate(yl,y,h))return;const v=Object.assign({},y),w=i.a6.rain;for(const P of Object.keys(w))v[P]===void 0&&(v[P]=w[P].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,s)}updateConfig(y){this._transitionable.setTransitionOrValue(this._options,new Map(y))}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}_validate(y,s,h){return(!h||h.validate!==!1)&&fe(this,y.call(Sn,Object.assign({value:s,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}};class xa extends i.E{constructor(s,h,v,w){super(),this.scope=v,this._options=s,this.properties=new i.ai(h),this._transitionable=new i.a8(h,v,new Map(w)),this._transitionable.setTransitionOrValue(s.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(s){this._transitionable.setTransitionOrValue(this._options.properties,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(s,h){this._options=s,this._transitionable.setTransitionOrValue(s.properties,h)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class ci{constructor(s,h,v){this.screenBounds=s,this.cameraPoint=v.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(s,h){let v,w;if(s instanceof i.P||typeof s[0]=="number"){const P=i.P.convert(s);v=[P],w=h.isPointAboveHorizon(P)}else{const P=i.P.convert(s[0]),O=i.P.convert(s[1]),L=P.add(O)._div(2);v=[P,O],w=i.aq(P,O).every(z=>h.isPointAboveHorizon(z))&&h.isPointAboveHorizon(L)}return new ci(v,w,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return i.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const h=this.screenBounds[0],v=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],w=i.aq(h,v,0,!1);return this.cameraPoint.y>v.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<v.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=v.x?w[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(w[3]=this.cameraPoint)),i.ar(w,s)}bufferedCameraGeometryGlobe(s){const h=this.screenBounds[0],v=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],w=i.aq(h,v,s),P=this.cameraPoint.clone();switch(3*((P.y>h.y)+(P.y>v.y))+((P.x>h.x)+(P.x>v.x))){case 0:w[0]=P,w[4]=P.clone();break;case 1:w.splice(1,0,P);break;case 2:w[1]=P;break;case 3:w.splice(4,0,P);break;case 5:w.splice(2,0,P);break;case 6:w[3]=P;break;case 7:w.splice(3,0,P);break;case 8:w[2]=P}return w}containsTile(s,h,v,w=0){const P=Math.max(s.queryPadding,s.evaluateQueryRenderedFeaturePadding())/h._pixelsPerMercatorPixel+1,O=v?this._bufferedCameraMercator(P,h):this._bufferedScreenMercator(P,h);let L=s.tileID.wrap+(O.unwrapped?w:0);const z=O.polygon.map(_e=>i.as(s.tileTransform,_e,L));if(!i.at(z,0,0,i.al,i.al))return;L=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?w:0);const G=this.screenGeometryMercator.polygon.map(_e=>i.au(s.tileTransform,_e,L)),H=G.map(_e=>new i.P(_e[0],_e[1])),Q=h.getFreeCameraOptions().position||new i.ae(0,0,0),K=i.au(s.tileTransform,Q,L),re=G.map(_e=>{const ge=i.av(_e,_e,K);return i.aw(ge,ge),new i.ax(K,ge)}),le=i.ay(s,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:H,tilespaceRays:re,bufferedTilespaceGeometry:z,bufferedTilespaceBounds:(ue=i.az(z),ue.min.x=i.aA(ue.min.x,0,i.al),ue.min.y=i.aA(ue.min.y,0,i.al),ue.max.x=i.aA(ue.max.x,0,i.al),ue.max.y=i.aA(ue.max.y,0,i.al),ue),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:le};var ue}_bufferedScreenMercator(s,h){const v=aa(s);if(this._screenRaycastCache[v])return this._screenRaycastCache[v];{let w;return w=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(s),h):{polygon:this.bufferedScreenGeometry(s).map(P=>h.pointCoordinate3D(P)),unwrapped:!0},this._screenRaycastCache[v]=w,w}}_bufferedCameraMercator(s,h){const v=aa(s);if(this._cameraRaycastCache[v])return this._cameraRaycastCache[v];{let w;return w=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),h):{polygon:this.bufferedCameraGeometry(s).map(P=>h.pointCoordinate3D(P)),unwrapped:!0},this._cameraRaycastCache[v]=w,w}}_projectAndResample(s,h){const v=function(P,O){const L=i.aB([],O.pixelMatrix,O.globeMatrix),z=[0,-i.aD,0,1],G=[0,i.aD,0,1],H=[0,0,0,1];i.aC(z,z,L),i.aC(G,G,L),i.aC(H,H,L);const Q=new i.P(z[0]/z[3],z[1]/z[3]),K=new i.P(G[0]/G[3],G[1]/G[3]),re=i.aE(P,Q)&&z[3]<H[3],le=i.aE(P,K)&&G[3]<H[3];if(!re&&!le)return null;const ue=function(Ve,Be,De){for(let We=1;We<Ve.length;We++){const lt=zi(Be.pointCoordinate3D(Ve[We-1]).x),it=zi(Be.pointCoordinate3D(Ve[We]).x);if(De<0){if(lt<it)return{idx:We,t:-lt/(it-1-lt)}}else if(it<lt)return{idx:We,t:(1-lt)/(it+1-lt)}}return null}(P,O,re?-1:1);if(!ue)return null;const{idx:_e,t:ge}=ue;let Se=_e>1?Nn(P.slice(0,_e),O):[],ke=_e<P.length?Nn(P.slice(_e),O):[];Se=Se.map(Ve=>new i.P(zi(Ve.x),Ve.y)),ke=ke.map(Ve=>new i.P(zi(Ve.x),Ve.y));const Te=[...Se];Te.length===0&&Te.push(ke[ke.length-1]);const $e=i.ak(Te[Te.length-1].y,(ke.length===0?Se[0]:ke[0]).y,ge);let Re;return Re=re?[new i.P(0,$e),new i.P(0,0),new i.P(1,0),new i.P(1,$e)]:[new i.P(1,$e),new i.P(1,1),new i.P(0,1),new i.P(0,$e)],Te.push(...Re),ke.length===0?Te.push(Se[0]):Te.push(...ke),{polygon:Te.map(Ve=>new i.ae(Ve.x,Ve.y)),unwrapped:!1}}(s,h);if(v)return v;const w=function(P,O){let L=!1,z=-1/0,G=0;for(let Q=0;Q<P.length-1;Q++)P[Q].x>z&&(z=P[Q].x,G=Q);for(let Q=0;Q<P.length-1;Q++){const K=(G+Q)%(P.length-1),re=P[K],le=P[K+1];Math.abs(re.x-le.x)>.5&&(re.x<le.x?(re.x+=1,K===0&&(P[P.length-1].x+=1)):(le.x+=1,K+1===P.length-1&&(P[0].x+=1)),L=!0)}const H=i.aF(O.center.lng);return L&&H<Math.abs(H-1)&&P.forEach(Q=>{Q.x-=1}),{polygon:P,unwrapped:L}}(Nn(s,h).map(P=>new i.P(zi(P.x),P.y)),h);return{polygon:w.polygon.map(P=>new i.ae(P.x,P.y)),unwrapped:w.unwrapped}}}function Nn(y,s){return i.aG(y,h=>{const v=s.pointCoordinate3D(h);h.x=v.x,h.y=v.y},1/256)}function zi(y){return y<0?1+y%1:y%1}function aa(y){return 100*y|0}function yi(y,s,h,v,w){const P=function(L,z){if(L)return w(L);if(z){if(y.url&&z.tiles&&y.tiles&&delete y.tiles,z.variants){if(!Array.isArray(z.variants))return w(new Error("variants must be an array"));for(const H of z.variants){if(H==null||typeof H!="object"||H.constructor!==Object)return w(new Error("variant must be an object"));if(!Array.isArray(H.capabilities))return w(new Error("capabilities must be an array"));if(H.capabilities.length===1&&H.capabilities[0]==="meshopt"){z=Object.assign(z,H);break}}}const G=i.aH(Object.assign({},z,y),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);G.tiles=s.canonicalizeTileset(G,y.url),w(null,G)}},O=function(L,z,G){if(!L)return null;if(!z&&!G)return L;G=G||L.worldview_default;const H=Object.values(L.language||{});if(H.length===0)return null;const Q=Object.values(L.worldview||{});if(Q.length===0)return null;const K=H.every(le=>le===z),re=Q.every(le=>le===G);return K&&re?L:z in(L.language_options||{})||G in(L.worldview_options||{})?null:L.language_options&&L.worldview_options?L:null}(y.data,h,v);return O?i.o.frame(()=>P(null,O)):y.url?i.m(s.transformRequest(s.normalizeSourceURL(y.url,null,h,v),i.R.Source),P):i.o.frame(()=>{const{data:L,...z}=y;P(null,z)})}function Bi(y,s){const h=Math.pow(2,s.z),v=Math.floor(i.aF(y.getWest())*h),w=Math.floor(i.aJ(y.getNorth())*h),P=Math.ceil(i.aF(y.getEast())*h),O=Math.ceil(i.aJ(y.getSouth())*h);return s.x>=v&&s.x<P&&s.y>=w&&s.y<O}class Qa{constructor(s,h,v){this.bounds=s?i.aI.convert(this.validateBounds(s)):null,this.minzoom=h||0,this.maxzoom=v||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}addExtraBounds(s){if(s){this.extraBounds||(this.extraBounds=[]);for(const h of s)this.extraBounds.push(i.aI.convert(this.validateBounds(h)))}}contains(s){if(s.z>this.maxzoom||s.z<this.minzoom||this.bounds&&!Bi(this.bounds,s))return!1;if(!this.extraBounds)return!0;for(const h of this.extraBounds)if(Bi(h,s))return!0;return!1}static fromTileJSON(s){if(!s.bounds&&!s.extra_bounds)return null;const h=new Qa(s.bounds,s.minzoom,s.maxzoom);return h.addExtraBounds(s.extra_bounds),h}}class as extends i.E{constructor(s,h,v,w){if(super(),this.id=s,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,i.aH(h,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w),this._tileWorkers={},this._deduped=new i.aK}load(s){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,v=this.map.getWorldview();this._tileJSONRequest=yi(this._options,this.map._requestManager,h,v,(w,P)=>{if(this._tileJSONRequest=null,this._loaded=!0,w)h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),v&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${v}`),this.fire(new i.y(w));else if(P){if(Object.assign(this,P),this.hasWorldviews=!!P.worldview_options,P.worldview_default&&(this.worldviewDefault=P.worldview_default),P.vector_layers){this.vectorLayers=P.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const O of P.vector_layers)this.vectorLayerIds.push(O.id),P.worldview&&P.worldview[O.source]&&this.localizableLayerIds.add(O.id)}this.tileBounds=Qa.fromTileJSON(P),pe(P.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}s&&s(w)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(s,h){const v=s.tileID.canonical.url(this.tiles,this.scheme),w=this.map._requestManager.normalizeTileURL(v),P=this.map._requestManager.transformRequest(w,i.R.Tile),O=this.map.style?this.map.style.getLut(this.scope):null,L=O?{image:O.image.clone()}:null,z={request:P,data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,lut:L,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:s.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&i.h(v)&&(z.localizableLayerIds=this.localizableLayerIds),z.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired")s.state==="loading"?s.reloadCallback=h:s.request=s.actor.send("reloadTile",z,G.bind(this));else if(s.actor=this._tileWorkers[w]=this._tileWorkers[w]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",z,G.bind(this),void 0,!0);else{const H=i.aL.call({deduped:this._deduped},z,(Q,K)=>{if(Q||!K)G.call(this,Q);else{const re=i.aM(K.responseHeaders);z.data={cacheControl:re.cacheControl,expires:re.expires,rawData:K.rawData.slice(0)},s.actor&&s.actor.send("loadTile",z,G.bind(this),void 0,!0)}},!0);s.request={cancel:H}}function G(H,Q){return delete s.request,s.aborted?h(null):H&&H.status!==404?h(H):(Q&&Q.resourceTiming&&(s.resourceTiming=Q.resourceTiming),this.map._refreshExpiredTiles&&Q&&s.setExpiryData(Q),s.loadVectorData(Q,this.map.painter),i.aN(this.dispatcher),h(null,Q),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,h){s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope}),s.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Yl extends i.E{constructor(s,h,v,w){super(),this.id=s,this.dispatcher=v,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},h),Object.assign(this,i.aH(h,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const h=this.map.getWorldview();this._tileJSONRequest=yi(this._options,this.map._requestManager,null,h,(v,w)=>{this._tileJSONRequest=null,this._loaded=!0,v?this.fire(new i.y(v)):w&&(Object.assign(this,w),w.raster_layers&&(this.rasterLayers=w.raster_layers,this.rasterLayerIds=this.rasterLayers.map(P=>P.id)),this.tileBounds=Qa.fromTileJSON(w),pe(w.tiles),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),s&&s(v)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){const v=i.o.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),v,this.tileSize);s.request=i.n(this.map._requestManager.transformRequest(w,i.R.Tile),(P,O,L)=>{if(delete s.request,s.aborted)return s.state="unloaded",h(null);if(P)return s.state="errored",h(P);if(!O)return h(null);const z=i.aM(L);this.map._refreshExpiredTiles&&s.setExpiryData(z),s.setTexture(O,this.map.painter),s.state="loaded",i.aN(this.dispatcher),h(null)})}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h&&h()}unloadTile(s,h){s.texture&&s.texture instanceof i.T?(s.destroy(!0),s.texture&&s.texture instanceof i.T&&this.map.painter.saveTileTexture(s.texture)):s.destroy(),h&&h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Lh([y,s],h,v,{scaled:w=!0}={}){const{tileSize:P,buffer:O}=v,{x:L,y:z,z:G}=h;if(!isFinite(L)||!isFinite(z)||!isFinite(G))throw new Error("Invalid MRT header");const H=2**G,Q=H*i.aF(y),K=H*i.aJ(s);return function([re,le],ue,{scaled:_e=!0}={}){if(!ue)throw new Error("bandView is undefined");const{data:ge,tileSize:Se,buffer:ke,offset:Te,scale:$e,dimension:Re}=ue;if(re<-ke||re>Se+ke||le<-ke||le>Se+ke)throw new Error(`Point (${re}, ${le}) out of bounds for tileSize=${Se}, buffer=${ke}`);const Ve=(le+ke)*(Se+2*ke)+(re+ke);if(new Uint32Array(ge.buffer)[Ve]===4294967295)return null;let Be=[];Be=_e?[]:new ue.data.constructor(Re);for(let De=0;De<Re;De++)Be[De]=Math.round(1e12*(ge[Re*Ve+De]*$e+Te))/1e12;return Be}([Math.min(Math.max(-O,Math.floor((Q-L)*P)),P-1+O),Math.min(Math.max(-O,Math.floor((K-z)*P)),P-1+O)],v,{scaled:w})}class lo extends Yl{constructor(s,h,v,w){super(s,h,v,w),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},h)}triggerRepaint(s){const h=this.map.painter._terrain,v=this.map.style.getSourceCache(this.id);h&&h.enabled&&v&&h._clearRenderCacheForTile(v.id,s.tileID),this.map.triggerRepaint()}loadTile(s,h){const v=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),w=this.map._requestManager.transformRequest(v,i.R.Tile),P={request:w,uid:s.uid,tileID:s.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};s.source=this.id,s.scope=this.scope,s.requestParams=w,s.actor||(s.actor=this.dispatcher.getActor());const O=(L,z,G)=>{if(delete s.request,s.aborted)return s.state="unloaded",h(null);if(L)return L.name==="AbortError"?void 0:(s.state="errored",h(L));if(this.map._refreshExpiredTiles&&z){const H=i.aM(G);s.setExpiryData(H)}if(this.partial&&s.state!=="expired")s.state="empty";else if(!this.partial){if(!z)return h(null);s.state="loaded",s._isHeaderLoaded=!0,s._mrt=z}h(null)};s.request=this.partial?s.fetchHeader(void 0,O.bind(this)):s.actor.send("loadTile",P,O.bind(this),void 0,!0)}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,h){const v=s.texturePerLayer;if(s.flushAllQueues(),v.size){s.destroy(!0);for(const w of v.values())this.map.painter.saveTileTexture(w)}else s.destroy()}prepareTile(s,h,v,w){s._isHeaderLoaded&&(s.state!=="empty"&&(s.state="reloading"),s.fetchBandForRender(h,v,w,(P,O)=>{if(P)return s.state="errored",this.fire(new i.y(P)),void this.triggerRepaint(s);O&&(s._isHeaderLoaded=!0,s.setTexturePerLayer(v,O,this.map.painter),s.state="loaded",this.triggerRepaint(s))}))}getInitialBand(s){if(!this.rasterLayers)return 0;const h=this.rasterLayers.find(({id:P})=>P===s),v=h&&h.fields,w=v&&v.bands&&v.bands;return w?w[0]:0}getTextureDescriptor(s,h,v){if(!s)return;const w=h.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!w)return;let P=null;h instanceof i.aQ?P=h.paint.get("raster-array-band"):h instanceof i.aR&&(P=h.paint.get("raster-particle-array-band"));const O=P||this.getInitialBand(w);if(O==null)return;if(!s.textureDescriptorPerLayer.get(h.id))return void this.prepareTile(s,w,h.id,O);if(s.updateNeeded(h.id,O)&&!v)return;const L=s.textureDescriptorPerLayer.get(h.id);return Object.assign({},L,{texture:s.texturePerLayer.get(h.id)})}getImages(s,h){const v=new Map;for(const w of s)for(const P of h){const[O,L]=P.split("/"),z=w.getLayer(O);if(!z||!z.hasBand(L)||!z.hasDataForBand(L))continue;const{bytes:G,tileSize:H,buffer:Q}=z.getBandView(L),K=H+2*Q,re={data:new i.q({width:K,height:K},G),pixelRatio:2,sdf:!1,usvg:!1,version:0};v.set(P,re)}return v}queryRasterArrayValueByBandId(s,h,v){const w=h._mrt;return new Promise(P=>{const O={},L=new Set;for(const[z,G]of Object.entries(w.layers)){if(v.layerName&&z!==v.layerName)continue;const H={};O[z]=H;for(const{bands:Q}of G.dataIndex)for(const K of Q)v.bands&&!v.bands.includes(K)||(L.add(i.B(z,K)),h.fetchBand(z,null,K,re=>{i.o.frame(()=>{H[K]=re?null:Lh([s.lng,s.lat],w,G.getBandView(K)),L.delete(i.B(z,K)),L.size===0&&P(O)})},!1))}L.size===0&&P(O)})}_loadTileForQuery(s,h){if(this._loadTileLoaded[s.uid])return void h(null,s._mrt);if(this._loadTilePending[s.uid])return void this._loadTilePending[s.uid].push(h);this._loadTilePending[s.uid]=[h];const v=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),w=this.map._requestManager.transformRequest(v,i.R.Tile);s.actor.send("loadTile",{request:w,uid:s.uid,tileID:s.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(P,O,L)=>{if(P)return this._loadTilePending[s.uid].forEach(z=>z(P,null)),void delete this._loadTilePending[s.uid];if(!O)return this._loadTilePending[s.uid].forEach(z=>z(null,null)),void delete this._loadTilePending[s.uid];if(this.map._refreshExpiredTiles&&O){const z=i.aM(L);s.setExpiryData(z)}s._mrt=O,s._isHeaderLoaded=!0,s.state="loaded",this._loadTilePending[s.uid].forEach(z=>z(null,O)),this._loadTileLoaded[s.uid]=!0,delete this._loadTilePending[s.uid]},void 0,!0)}queryRasterArrayValueByAllBands(s,h,v){return new Promise((w,P)=>{this._loadTileForQuery(h,(O,L)=>{O?P(O):w(L?this.queryRasterArrayValueByBandId(s,h,v):null)})})}queryRasterArrayValue(s,h){const v=i.aS.convert(s),w=this.findLoadedParent(v);return w&&w._mrt?h.bands||!this.partial?this.queryRasterArrayValueByBandId(v,w,h):this.queryRasterArrayValueByAllBands(v,w,h):Promise.resolve(null)}findLoadedParent(s){const h=i.ae.fromLngLat(s,this.map.transform.tileSize),v=this.maxzoom+1,w=1<<v,P=Math.floor(h.x),O=Math.floor((h.x-P)*w),L=Math.floor(h.y*w),z=this.map.style.getSourceCache(this.id),G=new i.aP(v,P,v,O,L);return z.findLoadedParent(G,this.minzoom)}}const Jl={vector:as,raster:Yl,"raster-dem":class extends Yl{constructor(y,s,h,v){super(y,s,h,v),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(y,s){const h=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function v(w,P){w&&(y.state="errored",s(w)),P&&(y.dem=P,y.dem.onDeserialize(),y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0,y.state="loaded",s(null))}y.request=i.n(this.map._requestManager.transformRequest(h,i.R.Tile),(function(w,P,O){if(delete y.request,y.aborted)y.state="unloaded",s(null);else if(w)y.state="errored",s(w);else if(P){const L=i.aM(O);this.map._refreshExpiredTiles&&y.setExpiryData(L);const z=ImageBitmap&&P instanceof ImageBitmap&&i.r(),G=1-(P.width-i.aO(P.width))/2;G<1||y.neighboringTiles||(y.neighboringTiles=this._getNeighboringTiles(y.tileID));const H=z?P:i.o.getImageData(P,G),Q={uid:y.uid,tileID:y.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:H,encoding:this.encoding,padding:G};y.actor&&y.state!=="expired"||(y.actor=this.dispatcher.getActor(),y.actor.send("loadTile",Q,v.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(y){const s=y.canonical,h=Math.pow(2,s.z),v=(s.x-1+h)%h,w=s.x===0?y.wrap-1:y.wrap,P=(s.x+1+h)%h,O=s.x+1===h?y.wrap+1:y.wrap,L={};return L[new i.aP(y.overscaledZ,w,s.z,v,s.y).key]={backfilled:!1},L[new i.aP(y.overscaledZ,O,s.z,P,s.y).key]={backfilled:!1},s.y>0&&(L[new i.aP(y.overscaledZ,w,s.z,v,s.y-1).key]={backfilled:!1},L[new i.aP(y.overscaledZ,y.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},L[new i.aP(y.overscaledZ,O,s.z,P,s.y-1).key]={backfilled:!1}),s.y+1<h&&(L[new i.aP(y.overscaledZ,w,s.z,v,s.y+1).key]={backfilled:!1},L[new i.aP(y.overscaledZ,y.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},L[new i.aP(y.overscaledZ,O,s.z,P,s.y+1).key]={backfilled:!1}),L}},"raster-array":lo,geojson:class extends i.E{constructor(y,s,h,v){super(),this.id=y,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(v),this._data=s.data,this._options=Object.assign({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.minzoom!==void 0&&(this.minzoom=s.minzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const w=i.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*w,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*w,extent:i.al,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:i.al,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*w,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter,dynamic:s.dynamic},s.workerOptions)}onAdd(y){this.map=y,this.setData(this._data)}setData(y){return this._data=y,this._updateWorkerData(),this}updateData(y){if(!this._options.dynamic)return this.fire(new i.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof y!="string"&&(y.type==="Feature"&&(y={type:"FeatureCollection",features:[y]}),y.type!=="FeatureCollection"))return this.fire(new i.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof y!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const s=new Map;for(const h of this._data.features)s.set(h.id,h);for(const h of y.features)s.set(h.id,h);this._data.features=[...s.values()]}else this._data=y;return this._updateWorkerData(!0),this}getClusterExpansionZoom(y,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:y,source:this.id,scope:this.scope},s),this}getClusterChildren(y,s){return this.actor.send("geojson.getClusterChildren",{clusterId:y,source:this.id,scope:this.scope},s),this}getClusterLeaves(y,s,h,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:y,limit:s,offset:h},v),this}_updateWorkerData(y=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.z("dataloading",{dataType:"source"})),this._loaded=!1;const s=Object.assign({append:y},this.workerOptions);s.scope=this.scope;const h=this._data;typeof h=="string"?(s.request=this.map._requestManager.transformRequest(i.o.resolveURL(h),i.R.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,s,(v,w)=>{if(this._loaded=!0,this._pendingLoad=null,v)this.fire(new i.y(v));else{const P={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&w&&w.resourceTiming&&w.resourceTiming[this.id]&&(P.resourceTiming=w.resourceTiming[this.id]),y&&(this._partialReload=!0),this.fire(new i.z("data",P)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(y),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const y=i.B(this.id,this.scope);this.map.style.clearSource(y),this._updateWorkerData()}loadTile(y,s){const h=y.actor?"reloadTile":"loadTile";y.actor=this.actor;const v=this.map.style?this.map.style.getLut(this.scope):null,w=v?{image:v.image.clone()}:null,P=this._partialReload,O={type:this.type,uid:y.uid,tileID:y.tileID,tileZoom:y.tileZoom,zoom:y.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:w,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:y.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:P,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};y.request=this.actor.send(h,O,(L,z)=>P&&!z?(y.state="loaded",s(null)):(delete y.request,y.destroy(),y.aborted?s(null):L?s(L):(y.loadVectorData(z,this.map.painter,h==="reloadTile"),s(null))),void 0,h==="loadTile")}abortTile(y){y.request&&(y.request.cancel(),delete y.request),y.aborted=!0}unloadTile(y,s){this.actor.send("removeTile",{uid:y.uid,type:this.type,source:this.id,scope:this.scope}),y.destroy()}onRemove(y){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aT{constructor(y,s,h,v){super(y,s,h,v),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const y=this.options;this.urls=[];for(const s of y.urls)this.urls.push(this.map._requestManager.transformRequest(s,i.R.Source).url);i.aU(this.urls,(s,h)=>{this._loaded=!0,s?this.fire(new i.y(s)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(y){if(this.video){const s=this.video.seekable;y<s.start(0)||y>s.end(0)?this.fire(new i.y(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=y}}getVideo(){return this.video}onAdd(y){this.map||(this.map=y,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const y=this.map.painter.context,s=y.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(y,this.video,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(y)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aT,model:i.aW,"batched-model":class extends i.E{constructor(y,s,h,v){super(),this.type="batched-model",this.id=y,this.tileSize=512,this._options=s,this.tiles=this._options.tiles,this.maxzoom=s.maxzoom||19,this.minzoom=s.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(v)}onAdd(y){this.map=y,this.load()}reload(){this.cancelTileJSONRequest();const y=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(y))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(y){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map.getWorldview();this._tileJSONRequest=yi(this._options,this.map._requestManager,s,h,(v,w)=>{this._tileJSONRequest=null,this._loaded=!0,v?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new i.y(v))):w&&(Object.assign(this,w),w.bounds&&(this.tileBounds=new Qa(w.bounds,this.minzoom,this.maxzoom)),pe(w.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),y&&y(v)})}hasTransition(){return!1}hasTile(y){return!this.tileBounds||this.tileBounds.contains(y.canonical)}loaded(){return this._loaded}loadTile(y,s){const h=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme)),v={request:this.map._requestManager.transformRequest(h,i.R.Tile),data:void 0,uid:y.uid,tileID:y.tileID,tileZoom:y.tileZoom,zoom:y.tileID.overscaledZ,tileSize:this.tileSize*y.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:y.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.o.devicePixelRatio,promoteId:this.promoteId};if(y.actor&&y.state!=="expired")if(y.state==="loading")y.reloadCallback=s;else{if(y.buckets){const P=Object.values(y.buckets);for(const O of P)O.dirty=!0;return void(y.state="loaded")}y.request=y.actor.send("reloadTile",v,w.bind(this))}else y.actor=this.dispatcher.getActor(),y.request=y.actor.send("loadTile",v,w.bind(this),void 0,!0);function w(P,O){return y.aborted?s(null):P&&P.status!==404?s(P):(this.map._refreshExpiredTiles&&O&&y.setExpiryData(O),y.loadModelData(O,this.map.painter),y.state="loaded",void s(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends i.aT{constructor(y,s,h,v){super(y,s,h,v),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(P=>typeof P!="number"))||this.fire(new i.y(new i.V(`sources.${y}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.y(new i.V(`sources.${y}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new i.y(new i.V(`sources.${y}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new i.y(new i.V(`sources.${y}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.y(new i.V(`sources.${y}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(y){this.map=y,this.load(),this.canvas&&this.animate&&this.play()}onRemove(y){this.pause()}prepare(){let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context;this.texture?!y&&!this._playing||this.texture instanceof i.aV||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(s,this.canvas,s.gl.RGBA8,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const y of[this.canvas.width,this.canvas.height])if(isNaN(y)||y<=0)return!0;return!1}},custom:class extends i.E{constructor(y,s,h,v){super(),this.id=y,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=s,this.setEventedParent(v),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Qa(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,i.aH(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(y){this.map=y,this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(y),this.load()}onRemove(y){this._implementation.onRemove&&this._implementation.onRemove(y)}hasTile(y){if(this._implementation.hasTile){const{x:s,y:h,z:v}=y.canonical;return this._implementation.hasTile({x:s,y:h,z:v})}return!this.tileBounds||this.tileBounds.contains(y.canonical)}loadTile(y,s){const{x:h,y:v,z:w}=y.tileID.canonical,P=new AbortController;y.request=Promise.resolve(this._implementation.loadTile({x:h,y:v,z:w},{signal:P.signal})).then((function(O){return delete y.request,y.aborted?(y.state="unloaded",s(null)):O===void 0?(y.state="errored",s(null)):O===null?(this.loadTileData(y,{width:this.tileSize,height:this.tileSize,data:null}),y.state="loaded",s(null)):function(L){return L instanceof ImageData||L instanceof HTMLCanvasElement||L instanceof ImageBitmap||L instanceof HTMLImageElement}(O)?(this.loadTileData(y,O),y.state="loaded",void s(null)):(y.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(O=>{O.name!=="AbortError"&&(y.state="errored",s(O))}),y.request.cancel=()=>P.abort()}loadTileData(y,s){y.setTexture(s,this.map.painter)}unloadTile(y,s){if(y.texture&&y.texture instanceof i.T?(y.destroy(!0),y.texture&&y.texture instanceof i.T&&this.map.painter.saveTileTexture(y.texture)):y.destroy(),this._implementation.unloadTile){const{x:h,y:v,z:w}=y.tileID.canonical;this._implementation.unloadTile({x:h,y:v,z:w})}s&&s()}abortTile(y,s){y.request&&y.request.cancel&&(y.request.cancel(),delete y.request),s&&s()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(y=>({x:y.canonical.x,y:y.canonical.y,z:y.canonical.z}))}_clearTiles(){const y=i.B(this.id,this.scope);this.map.style.clearSource(y)}_update(){this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}}},ws=function(y,s,h,v){const w=new Jl[s.type](y,s,h,v);if(w.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${w.id}`);return i.aX(["load","abort","unload","serialize","prepare"],w),w};function Cc(y,s,h=""){return`${h}:${s.id||""}:${s.layer.id}:${function(v){if("layerId"in v)return`layer:${v.layerId}`;{const{featuresetId:w,importId:P}=v;return`featureset:${w}${P?`:import:${P}`:""}`}}(y.target)}`}function Xs(y,s,h,v=""){if(y.uniqueFeatureID){const w=Cc(y,s,v);if(h.has(w))return!0;h.add(w)}return!1}function Ys(y,s,h,v,w=!1){const P=s.sourceCache.transform,O=s.sourceCache.tilesIn(y,s.has3DLayers,w);O.sort(gg);const L=[];for(const z of O){const G=z.tile.queryRenderedFeatures(s,z,h,v,P,w);Object.keys(G).length&&L.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:G})}for(const z in s.layers){const G=s.layers[z];if(G.styleLayer){const H=G.styleLayer.queryRenderedFeatures(y,s.sourceCache,v);Object.keys(H).length&&L.push({wrappedTileID:0,queryResults:H})}}return L.length===0?{}:function(z){const G={},H={};for(const Q of z){const K=Q.queryResults,re=Q.wrappedTileID,le=H[re]=H[re]||{};for(const ue in K){const _e=K[ue],ge=le[ue]=le[ue]||{},Se=G[ue]=G[ue]||[];for(const ke of _e)ge[ke.featureIndex]||(ge[ke.featureIndex]=!0,Se.push(ke))}}return G}(L)}function Fv(y,s,h,v,w,P){const O={},L=v.queryRenderedSymbols(y),z=[];for(const G of Object.keys(L).map(Number))z.push(w[G]);z.sort(gg);for(const G of z){const H=G.featureIndex.lookupSymbolFeatures(L[G.bucketInstanceId],G.bucketIndex,G.sourceLayerIndex,s,h,P);for(const Q in H){const K=O[Q]=O[Q]||[],re=H[Q];re.sort((le,ue)=>{const _e=G.featureSortOrder;if(_e){const ge=_e.indexOf(le.featureIndex);return _e.indexOf(ue.featureIndex)-ge}return ue.featureIndex-le.featureIndex});for(const le of re)K.push(le)}}return O}function mg(y,s){const h=y.getRenderableIds().map(P=>y.getTileByID(P)),v=[],w={};for(let P=0;P<h.length;P++){const O=h[P],L=O.tileID.canonical.key;w[L]||(w[L]=!0,O.querySourceFeatures(v,s))}return v}function gg(y,s){const h=y.tileID,v=s.tileID;return h.overscaledZ-v.overscaledZ||h.canonical.y-v.canonical.y||h.wrap-v.wrap||h.canonical.x-v.canonical.x}function yg(y,s){const h={};if(!s)return h;for(const v of y){const w=v.layerIds.map(P=>s.getLayer(P)).filter(Boolean);if(w.length!==0){v.layers=w,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(P=>w.filter(O=>O.id===P)[0]));for(const P of w)h[P.fqid]=v}}return h}const Ms=32,Oc=33,Ss=new Uint16Array(8184);for(let y=0;y<2046;y++){let s=y+2,h=0,v=0,w=0,P=0,O=0,L=0;for(1&s?w=P=O=Ms:h=v=L=Ms;(s>>=1)>1;){const G=h+w>>1,H=v+P>>1;1&s?(w=h,P=v,h=O,v=L):(h=w,v=P,w=O,P=L),O=G,L=H}const z=4*y;Ss[z+0]=h,Ss[z+1]=v,Ss[z+2]=w,Ss[z+3]=P}const vl=new Uint16Array(2178),zu=new Uint8Array(1089),Fh=new Uint16Array(1089);function zv(y){return y===0?-.03125:y===32?.03125:0}const Bv={type:2,extent:i.al,loadGeometry:()=>[[new i.P(0,0),new i.P(i.al+1,0),new i.P(i.al+1,i.al+1),new i.P(0,i.al+1),new i.P(0,0)]]};class iu{constructor(s,h,v,w,P,O){this.tileID=s,this.uid=i.b1(),this.uses=0,this.tileSize=h,this.tileZoom=v,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=P,w&&w.style&&(this._lastUpdatedBrightness=w.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",w&&w.transform&&(this.projection=w.transform.projection),this.worldview=O,this._hasAppearances=null}registerFadeDuration(s){const h=s+this.timeAdded;h<i.o.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aY(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(s,h,v){if(this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=yg(s.buckets,h.style),this.hasSymbolBuckets=!1;for(const w in this.buckets){const P=this.buckets[w];if(P instanceof i.b3){if(this.hasSymbolBuckets=!0,!v)break;P.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const w in this.buckets){const P=this.buckets[w];if(P instanceof i.b3&&P.hasRTLText){this.hasRTLText=!0,i.b4();break}}this.queryPadding=0;for(const w in this.buckets){const P=this.buckets[w],O=h.style.getOwnLayer(w);if(!O)continue;const L=O.queryRadius(P);this.queryPadding=Math.max(this.queryPadding,L)}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage),s.lineAtlas&&(this.lineAtlas=s.lineAtlas),this._lastUpdatedBrightness=s.brightness}else this.collisionBoxArray=new i.b2}unloadVectorData(){if(this.hasData()){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(s,h,v){s&&(s.resourceTiming&&(this.resourceTiming=s.resourceTiming),this.buckets=Object.assign({},this.buckets,yg(s.buckets,h.style)),s.featureIndex&&(this.latestFeatureIndex=s.featureIndex))}getBucket(s){return this.buckets[s.fqid]}upload(s,h){for(const P in this.buckets){const O=this.buckets[P];if(O.uploadPending()){let L={},z=[],G={zoom:0,pitch:0,brightness:0,worldview:""};if(h){if(h.style){z=h.style.listImages();const H=O.layers[0],Q=H.sourceLayer||"_geojsonTileLayer",K=h.style.getLayerSourceCache(H);K&&(L=K._state.getState(Q,void 0))}G={zoom:h.transform.zoom||0,pitch:h.transform.pitch||0,brightness:h.style.getBrightness()||0,worldview:h.worldview||""}}O.upload(s,this.tileID.canonical,L,z,G)}}const v=s.gl,w=this.imageAtlas;w&&!w.uploaded&&(this.imageAtlasTexture=new i.T(s,w.image,v.RGBA8,{useMipmap:!!w.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(s,this.glyphAtlasImage,v.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(s,this.lineAtlas.image,v.R8),this.lineAtlas.uploaded=!0)}prepare(s,h,v){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture,v),!h||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const w=h.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(h)),(this._lastUpdatedBrightness||w||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&w&&Math.abs(this._lastUpdatedBrightness-w)<.001||(this.updateBuckets(h,this._lastUpdatedBrightness!==w),this._lastUpdatedBrightness=w))}evaluateQueryRenderedFeaturePadding(){let s=0;for(const h in this.buckets){const v=this.buckets[h];v.evaluateQueryRenderedFeaturePadding&&(s=Math.max(s,v.evaluateQueryRenderedFeaturePadding()))}return s}queryRenderedFeatures(s,h,v,w,P,O){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const L=this.evaluateQueryRenderedFeaturePadding(),z=function(G,H){const Q=i.bp([],[.5*G.width,.5*-G.height,1]);return i.bq(Q,Q,[1,-1,0]),i.aB(Q,Q,G.calculateProjMatrix(H.toUnwrapped())),Float32Array.from(Q)}(P,this.tileID);return this.latestFeatureIndex.query(s,{tilespaceGeometry:h,pixelPosMatrix:z,transform:w,availableImages:v,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:L})}querySourceFeatures(s,h){const v=this.latestFeatureIndex;if(!v||!v.rawTileData)return;const w=v.loadVTLayers(),P=h?h.sourceLayer:"",O=w._geojsonTileLayer||w[P];if(!O)return;const L=i.b5(h&&h.filter),{z,x:G,y:H}=this.tileID.canonical,Q={z,x:G,y:H};for(let K=0;K<O.length;K++){const re=O.feature(K);if(L.needGeometry){const _e=i.b6(re,!0);if(!L.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),_e,this.tileID.canonical))continue}else if(!L.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),re))continue;const le=v.getId(re,P),ue=new i.b7(re,z,G,H,le);ue.tile=Q,s.push(ue)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(s){const h=this.expirationTime;if(s.cacheControl){const v=i.b8(s.cacheControl);v["max-age"]&&(this.expirationTime=Date.now()+1e3*v["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const v=Date.now();let w=!1;if(this.expirationTime>v)w=!1;else if(h)if(this.expirationTime<h)w=!0;else{const P=this.expirationTime-h;P?this.expirationTime=v+Math.max(P,3e4):w=!0}else w=!0;w?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(s){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&s&&this.updateBuckets(s)}hasAppearances(s){for(const h in this.buckets)if(s.style.hasLayer(h)&&this.buckets[h].layers.some(v=>v.appearances&&v.appearances.length>0))return!0;return!1}updateBuckets(s,h){if(!this.latestFeatureIndex||!s.style)return;const v=this.latestFeatureIndex.loadVTLayers(),w=s.style.listImages(),P=s.style.getBrightness();for(const O in this.buckets){if(!s.style.hasLayer(O))continue;const L=this.buckets[O],z=L.layers[0],G=z.sourceLayer||"_geojsonTileLayer",H=v[G],Q=s.style.getLayerSourceCache(z);let K={};Q&&(K=Q._state.getState(G,void 0));const re=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},le=Object.keys(K).length>0&&!h;if(L.hasAppearances=L.layers.some(_e=>_e.appearances&&_e.appearances.length>0),(le&&L.stateDependentLayers.length!==0||h)&&L.update(K,H,w,re,le?L.stateDependentLayers:L.layers,h,P),le&&L.stateDependentLayers.length!==0||h||L.hasAppearances){const _e={zoom:s.transform.zoom,pitch:s.transform.pitch,brightness:s.style.getBrightness()||0,worldview:s.worldview};L.updateAppearances(this.tileID.canonical,K,w,_e)}(L instanceof i.b9||L instanceof i.ba)&&s._terrain&&s._terrain.enabled&&Q&&L.uploadPending()&&s._terrain._clearRenderCacheForTile(Q.id,this.tileID);const ue=s&&s.style&&s.style.getOwnLayer(O);ue&&(this.queryPadding=Math.max(this.queryPadding,ue.queryRadius(L)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=i.o.now()+s}setTexture(s,h){const v=h.context,w=v.gl;this.texture=this.texture||h.getTileTexture(s.width),this.texture&&this.texture instanceof i.T?this.texture.update(s):(this.texture=new i.T(v,s,w.RGBA8,{useMipmap:!0}),this.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE))}setDependencies(s,h){const v={};for(const w of h)v[w]=!0;this.dependencies[s]=v}hasDependency(s,h){for(const v of s){const w=this.dependencies[v];if(w){for(const P of h)if(w[P])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(s,h){if(!h||h.name==="mercator"||this._tileDebugBuffer)return;const v=i.bb(Bv,this.tileID.canonical,this.tileTransform)[0],w=new i.bc,P=new i.bd;for(let O=0;O<v.length;O++){const{x:L,y:z}=v[O];w.emplaceBack(L,z),P.emplaceBack(O)}P.emplaceBack(0),this._tileDebugIndexBuffer=s.createIndexBuffer(P),this._tileDebugBuffer=s.createVertexBuffer(w,i.be.members),this._tileDebugSegments=i.bf.simpleSegment(0,0,w.length,P.length)}_makeTileBoundsBuffers(s,h){if(this._tileBoundsBuffer||!h||h.name==="mercator")return;const v=i.bb(Bv,this.tileID.canonical,this.tileTransform)[0];let w,P;if(this.isRaster){const O=function(L,z){const G=i.aY(L,z),H=Math.pow(2,L.z);for(let _e=0;_e<Oc;_e++)for(let ge=0;ge<Oc;ge++){const Se=i.aZ((L.x+(ge+zv(ge))/Ms)/H),ke=i.a_((L.y+(_e+zv(_e))/Ms)/H),Te=z.project(Se,ke),$e=_e*Oc+ge;vl[2*$e+0]=Math.round((Te.x*G.scale-G.x)*i.al),vl[2*$e+1]=Math.round((Te.y*G.scale-G.y)*i.al)}zu.fill(0),Fh.fill(0);for(let _e=2045;_e>=0;_e--){const ge=4*_e,Se=Ss[ge+0],ke=Ss[ge+1],Te=Ss[ge+2],$e=Ss[ge+3],Re=Se+Te>>1,Ve=ke+$e>>1,Be=Re+Ve-ke,De=Ve+Se-Re,We=ke*Oc+Se,lt=$e*Oc+Te,it=Ve*Oc+Re,bt=Math.hypot((vl[2*We+0]+vl[2*lt+0])/2-vl[2*it+0],(vl[2*We+1]+vl[2*lt+1])/2-vl[2*it+1])>=16;zu[it]=zu[it]||(bt?1:0),_e<1022&&(zu[it]=zu[it]||zu[(ke+De>>1)*Oc+(Se+Be>>1)]||zu[($e+De>>1)*Oc+(Te+Be>>1)])}const Q=new i.a$,K=new i.b0;let re=0;function le(_e,ge){const Se=ge*Oc+_e;return Fh[Se]===0&&(Q.emplaceBack(vl[2*Se+0],vl[2*Se+1],_e*i.al/Ms,ge*i.al/Ms),Fh[Se]=++re),Fh[Se]-1}function ue(_e,ge,Se,ke,Te,$e){const Re=_e+Se>>1,Ve=ge+ke>>1;if(Math.abs(_e-Te)+Math.abs(ge-$e)>1&&zu[Ve*Oc+Re])ue(Te,$e,_e,ge,Re,Ve),ue(Se,ke,Te,$e,Re,Ve);else{const Be=le(_e,ge),De=le(Se,ke),We=le(Te,$e);K.emplaceBack(Be,De,We)}}return ue(0,0,Ms,Ms,Ms,0),ue(Ms,Ms,0,0,0,Ms),{vertices:Q,indices:K}}(this.tileID.canonical,h);w=O.vertices,P=O.indices}else{w=new i.a$,P=new i.b0;for(const{x:L,y:z}of v)w.emplaceBack(L,z,0,0);const O=i.bg(w.int16.subarray(0,4*w.length),void 0,4);for(let L=0;L<O.length;L+=3)P.emplaceBack(O[L],O[L+1],O[L+2])}this._tileBoundsBuffer=s.createVertexBuffer(w,i.bh.members),this._tileBoundsIndexBuffer=s.createIndexBuffer(P),this._tileBoundsSegments=i.bf.simpleSegment(0,0,w.length,P.length)}_makeGlobeTileDebugBuffers(s,h){const v=h.projection;if(!v||v.name!=="globe"||h.freezeTileCoverage)return;const w=this.tileID.canonical,P=i.bi(w,h),O=i.bj(P),L=i.aj(h.zoom);let z;L>0&&(z=i.bk(new Float64Array(16),h.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(s,w,h,O,z,L),this._makeGlobeTileDebugTextBuffer(s,w,h,O,z,L)}_globePoint(s,h,v,w,P,O,L){let z=i.bl(s,h,v);if(O){const G=1<<v.z,H=i.aF(w.center.lng),Q=i.aJ(w.center.lat),K=(v.x+.5)/G-H;let re=0;K>.5?re=-1:K<-.5&&(re=1);let le=(s/i.al+v.x)/G+re,ue=(h/i.al+v.y)/G;le=(le-H)*w._pixelsPerMercatorPixel+H,ue=(ue-Q)*w._pixelsPerMercatorPixel+Q;const _e=[le*w.worldSize,ue*w.worldSize,0];i.af(_e,_e,O),z=i.bm(z,_e,L)}return i.af(z,z,P)}_makeGlobeTileDebugBorderBuffer(s,h,v,w,P,O){const L=new i.bc,z=new i.bd,G=new i.bn,H=(K,re,le,ue,_e)=>{const ge=(le-K)/(_e-1),Se=(ue-re)/(_e-1),ke=L.length;for(let Te=0;Te<_e;Te++){const $e=K+Te*ge,Re=re+Te*Se;L.emplaceBack($e,Re);const Ve=this._globePoint($e,Re,h,v,w,P,O);G.emplaceBack(Ve[0],Ve[1],Ve[2]),z.emplaceBack(ke+Te)}},Q=i.al;H(0,0,Q,0,16),H(Q,0,Q,Q,16),H(Q,Q,0,Q,16),H(0,Q,0,0,16),this._tileDebugIndexBuffer=s.createIndexBuffer(z),this._tileDebugBuffer=s.createVertexBuffer(L,i.be.members),this._globeTileDebugBorderBuffer=s.createVertexBuffer(G,i.bo.members),this._tileDebugSegments=i.bf.simpleSegment(0,0,L.length,z.length)}_makeGlobeTileDebugTextBuffer(s,h,v,w,P,O){const L=i.al/4,z=new i.bc,G=new i.b0,H=new i.bn,Q=25;G.reserve(32),z.reserve(Q),H.reserve(Q);const K=(re,le)=>Q*re+le;for(let re=0;re<Q;re++){const le=re*L;for(let ue=0;ue<Q;ue++){const _e=ue*L;z.emplaceBack(_e,le);const ge=this._globePoint(_e,le,h,v,w,P,O);H.emplaceBack(ge[0],ge[1],ge[2])}}for(let re=0;re<4;re++)for(let le=0;le<4;le++){const ue=K(re,le),_e=K(re,le+1),ge=K(re+1,le),Se=K(re+1,le+1);G.emplaceBack(ue,_e,ge),G.emplaceBack(ge,_e,Se)}this._tileDebugTextIndexBuffer=s.createIndexBuffer(G),this._tileDebugTextBuffer=s.createVertexBuffer(z,i.be.members),this._globeTileDebugTextBuffer=s.createVertexBuffer(H,i.bo.members),this._tileDebugTextSegments=i.bf.simpleSegment(0,0,Q,32)}destroy(s=!1){for(const h in this.buckets)this.buckets[h].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!s&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.br.setPbf(i.bs);class Ld extends iu{constructor(s,h,v,w,P){super(s,h,v,w,P),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(s){return this._mrt&&this._mrt.getLayer(s)}setTexturePerLayer(s,h,v){const w=v.context,P=w.gl;let O=this.texturePerLayer.get(s)||v.getTileTexture(h.width);O&&O instanceof i.T?O.update(h,{premultiply:!1}):O=new i.T(w,h,P.RGBA8,{premultiply:!1}),this.texturePerLayer.has(s)||this.texturePerLayer.set(s,O)}flushQueues(s){const h=this._workQueuePerLayer.get(s)||[],v=this._fetchQueuePerLayer.get(s)||[];for(;h.length;)h.pop()();for(;v.length;)v.pop()()}flushAllQueues(){for(const s of this._workQueuePerLayer.keys()){const h=this._workQueuePerLayer.get(s)||[];for(;h.length;)h.pop()()}for(const s of this._fetchQueuePerLayer.keys()){const h=this._fetchQueuePerLayer.get(s)||[];for(;h.length;)h.pop()()}}fetchHeader(s=16384,h){const v=this._mrt=new i.br(30),w=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(s-1)}});return this.entireBuffer=null,this.request=i.bt(w,(P,O,L)=>{if(P)h(P);else try{const z=v.getHeaderLength(O);if(z>s)return void(this.request=this.fetchHeader(z,h));v.parseHeader(O),this._isHeaderLoaded=!0;let G=0;for(const H of Object.values(v.layers))G=Math.max(G,H.dataIndex[H.dataIndex.length-1].lastByte);O.byteLength>=G&&(this.entireBuffer=O),h(null,this.entireBuffer||O,L)}catch(z){h(z)}}),this.request}fetchBandForRender(s,h,v,w){this.fetchBand(s,h,v,P=>{if(P)return void w(P);this.updateTextureDescriptor(s,h,v);const O=this.textureDescriptorPerLayer.get(h);w(null,O?O.img:null)})}fetchBand(s,h,v,w,P=!0){const O=this._mrt;if(!this._isHeaderLoaded||!O)return void w(new Error("Tile header is not ready"));const L=this.actor;if(!L)return void w(new Error("Can't fetch tile band without an actor"));let z;const G=i.B(String(v),i.B(this.tileID.key,s));let H=this._taskQueue.get(G);H?H.add(w):(H=new Set,H.add(w),this._taskQueue.set(G,H));const Q=(ue,_e)=>{z.complete(ue,_e),ue?w(ue):(H.values().forEach(ge=>ge(null,_e)),this._taskQueue.delete(G))},K=(ue,_e)=>{if(ue)return w(ue);const ge=L.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:_e,task:z},Q,void 0,!0);if(h!==null){const Se=this._workQueuePerLayer.get(h)||[];Se.push(()=>{ge&&ge.cancel(),z.cancel()}),this._workQueuePerLayer.has(h)||this._workQueuePerLayer.set(h,Se)}};let re;try{re=O.getLayer(s)}catch(ue){if(this.state==="reloading")return;throw ue}if(!re)return void w(new Error(`Unknown sourceLayer "${s}"`));if(re.hasDataForBand(v))return H.values().forEach(ue=>ue(null,null)),void this._taskQueue.delete(G);const le=re.getDataRange([v]);if(z=O.createDecodingTask(le),!z||z.tasks.length)if(h!==null&&this.flushQueues(h),this.entireBuffer)K(null,this.entireBuffer.slice(le.firstByte,le.lastByte+1));else{const ue=Object.assign({},this.requestParams,{headers:{Range:`bytes=${le.firstByte}-${le.lastByte}`}}),_e=i.bt(ue,K);if(h!==null){const ge=this._fetchQueuePerLayer.get(h)||[];ge.push(()=>{_e.cancel(),z.cancel()}),this._fetchQueuePerLayer.has(h)||this._fetchQueuePerLayer.set(h,ge)}}}updateNeeded(s,h){return(!this.textureDescriptorPerLayer.get(s)||this.textureDescriptorPerLayer.get(s).band!==h||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(s,h,v){if(!this._mrt)return;const w=this._mrt.getLayer(s);if(!w||!w.hasBand(v)||!w.hasDataForBand(v))return;const{bytes:P,tileSize:O,buffer:L,offset:z,scale:G}=w.getBandView(v),H=O+2*L,Q=new i.q({width:H,height:H},P),K=this.texturePerLayer.get(h);K&&K instanceof i.T&&K.update(Q,{premultiply:!1}),this.textureDescriptorPerLayer.set(h,{layer:s,band:v,img:Q,buffer:L,offset:z,tileSize:O,format:w.pixelFormat,mix:[G,256*G,65536*G,16777216*G]})}destroy(s=!1){if(super.destroy(s),delete this._mrt,!s)for(const h of this.texturePerLayer.values())h&&h instanceof i.T&&h.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Zb{constructor(s,h){this.max=s,this.onRemove=h,this.reset()}reset(){for(const s in this.data)for(const h of this.data[s])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(s,h,v){const w=s.wrapped().key;this.data[w]===void 0&&(this.data[w]=[]);const P={value:h,timeout:void 0};if(v!==void 0&&(P.timeout=setTimeout(()=>{this.remove(s,P)},v)),this.data[w].push(P),this.order.push(w),this.order.length>this.max){const O=this._getAndRemoveByKey(this.order[0]);O&&this.onRemove(O)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const h=this.data[s].shift();return h.timeout&&clearTimeout(h.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),h.value}getByKey(s){const h=this.data[s];return h?h[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,h){if(!this.has(s))return this;const v=s.wrapped().key,w=h===void 0?0:this.data[v].indexOf(h),P=this.data[v][w];return this.data[v].splice(w,1),P.timeout&&clearTimeout(P.timeout),this.data[v].length===0&&delete this.data[v],this.onRemove(P.value),this.order.splice(this.order.indexOf(v),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(s){const h=[];for(const v in this.data)for(const w of this.data[v])s(w.value)||h.push(w);for(const v of h)this.remove(v.value.tileID,v)}}class u2{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,h,v){const w=String(h);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][w]=this.stateChanges[s][w]||{},Object.assign(this.stateChanges[s][w],v),this.deletedStates[s]===null){this.deletedStates[s]={};for(const P in this.state[s])P!==w&&(this.deletedStates[s][P]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][w]===null){this.deletedStates[s][w]={};for(const P in this.state[s][w])v[P]||(this.deletedStates[s][w][P]=null)}else for(const P in v)this.deletedStates[s]&&this.deletedStates[s][w]&&this.deletedStates[s][w][P]===null&&delete this.deletedStates[s][w][P]}removeFeatureState(s,h,v){if(this.deletedStates[s]===null)return;const w=String(h);if(this.deletedStates[s]=this.deletedStates[s]||{},v&&h!==void 0)this.deletedStates[s][w]!==null&&(this.deletedStates[s][w]=this.deletedStates[s][w]||{},this.deletedStates[s][w][v]=null);else if(h!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][w])for(v in this.deletedStates[s][w]={},this.stateChanges[s][w])this.deletedStates[s][w][v]=null;else this.deletedStates[s][w]=null;else this.deletedStates[s]=null}getState(s,h){const v=this.state[s]||{},w=this.stateChanges[s]||{},P=this.deletedStates[s];if(P===null)return{};if(h!==void 0){const L=String(h),z=Object.assign({},v[L],w[L]);if(P){const G=P[h];if(G===null)return{};for(const H in G)delete z[H]}return z}const O=Object.assign({},v,w);if(P)for(const L in P)delete O[L];return O}initializeTileState(s,h){s.refreshFeatureState(h)}coalesceChanges(s,h){const v={};for(const w in this.stateChanges){this.state[w]=this.state[w]||{};const P={};for(const O in this.stateChanges[w])this.state[w][O]||(this.state[w][O]={}),Object.assign(this.state[w][O],this.stateChanges[w][O]),P[O]=this.state[w][O];v[w]=P}for(const w in this.deletedStates){this.state[w]=this.state[w]||{};const P={};if(this.deletedStates[w]===null)for(const O in this.state[w])P[O]={},this.state[w][O]={};else for(const O in this.deletedStates[w]){if(this.deletedStates[w][O]===null)this.state[w][O]={};else if(this.state[w][O])for(const L of Object.keys(this.deletedStates[w][O]))delete this.state[w][O][L];P[O]=this.state[w][O]}v[w]=v[w]||{},Object.assign(v[w],P)}if(this.stateChanges={},this.deletedStates={},Object.keys(v).length!==0)for(const w in s)s[w].refreshFeatureState(h)}}class Ql extends i.E{constructor(s,h,v){super(),this.id=s,this._onlySymbols=v,h.on("data",w=>{w.dataType==="source"&&w.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&w.dataType==="source"&&w.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),h.on("error",()=>{this._sourceErrored=!0}),this._source=h,this._tiles={},this._cache=new Zb(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new u2,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(s){this.map=s,this._minTileCacheSize=this._minTileCacheSize===void 0&&s?s._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&s?s._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles)if(!this._tiles[s].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(s,h){return s.isSymbolTile=this._onlySymbols,s.isExtraShadowCaster=this._shadowCasterTiles[s.tileID.key],this._source.loadTile(s,h)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s)}_abortTile(s){if(this._source.abortTile)return this._source.abortTile(s)}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const v=this._tiles[h];v.upload(s,this.map?this.map.painter:void 0),v.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(Xb).map(s=>s.key)}getRenderableIds(s,h){const v=[];for(const w in this._tiles)this._isIdRenderable(+w,s,h)&&v.push(this._tiles[w]);return s?v.sort((w,P)=>{const O=w.tileID,L=P.tileID,z=new i.P(O.canonical.x,O.canonical.y)._rotate(this.transform.angle),G=new i.P(L.canonical.x,L.canonical.y)._rotate(this.transform.angle);return O.overscaledZ-L.overscaledZ||G.y-z.y||G.x-z.x}).map(w=>w.tileID.key):v.map(w=>w.tileID).sort(Xb).map(w=>w.key)}hasRenderableParent(s){const h=this.findLoadedParent(s,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(s,h,v){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(h||!this._tiles[s].holdingForFade())&&(v||!this._shadowCasterTiles[s])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(+s,"reloading")}}_reloadTile(s,h){const v=this._tiles[s];v&&(v.state!=="loading"&&(v.state=h),this._loadTile(v,this._tileLoaded.bind(this,v,s,h)))}_tileLoaded(s,h,v,w,P){if(w){if(s.state="errored",w.status!==404)this._source.fire(new i.y(w,{tile:s}));else{if(this._source.fire(new i.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:s})),!(s.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const L=this.map.painter.terrain;this.update(this.transform,L.getScaledDemTileSize(),!0),L.resetTileLookupCache(this.id)}else this.update(this.transform)}return}s.timeAdded=i.o.now(),v==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(h,s),this._source.type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null);let O=new Map;P&&P.responseHeaders&&(O=P.responseHeaders),this._source.fire(new i.z("data",{dataType:"source",tile:s,coord:s.tileID,sourceCacheId:this.id,responseHeaders:O}))}_backfillDEM(s){const h=this.getRenderableIds();for(let w=0;w<h.length;w++){const P=h[w];if(s.neighboringTiles&&s.neighboringTiles[P]){const O=this.getTileByID(P);v(s,O),v(O,s)}}function v(w,P){if(!w.dem||w.dem.borderReady)return;w.needsHillshadePrepare=!0,w.needsDEMTextureUpload=!0;let O=P.tileID.canonical.x-w.tileID.canonical.x;const L=P.tileID.canonical.y-w.tileID.canonical.y,z=Math.pow(2,w.tileID.canonical.z),G=P.tileID.key;O===0&&L===0||Math.abs(L)>1||(Math.abs(O)>1&&(Math.abs(O+z)===1?O+=z:Math.abs(O-z)===1&&(O-=z)),P.dem&&w.dem&&(w.dem.backfillBorder(P.dem,O,L),w.neighboringTiles&&w.neighboringTiles[G]&&(w.neighboringTiles[G].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,h,v,w){for(const P in this._tiles){let O=this._tiles[P];if(w[P]||!O.hasData()||O.tileID.overscaledZ<=h||O.tileID.overscaledZ>v)continue;let L=O.tileID;for(;O&&O.tileID.overscaledZ>h+1;){const G=O.tileID.scaledTo(O.tileID.overscaledZ-1);O=this._tiles[G.key],O&&O.hasData()&&(L=G)}let z=L;for(;z.overscaledZ>h;)if(z=z.scaledTo(z.overscaledZ-1),s[z.key]){w[L.key]=L;break}}}findLoadedParent(s,h){if(s.key in this._loadedParentTiles){const v=this._loadedParentTiles[s.key];return v&&v.tileID.overscaledZ>=h?v:null}for(let v=s.overscaledZ-1;v>=h;v--){const w=s.scaledTo(v),P=this._getLoadedTile(w);if(P)return P}}_getLoadedTile(s){const h=this._tiles[s.key];return h&&h.hasData()?h:this._cache.getByKey(this._source.reparseOverscaled?s.wrapped().key:s.canonical.key)}updateCacheSize(s,h){h=h||this._source.tileSize;const v=Math.ceil(s.width/h)+1,w=Math.ceil(s.height/h)+1,P=Math.floor(v*w*5),O=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,P):P,L=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,O):O;this._cache.setMaxSize(L)}handleWrapJump(s){const h=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,h){const v={};for(const w in this._tiles){const P=this._tiles[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+h),v[P.tileID.key]=P}this._tiles=v;for(const w in this._timers)clearTimeout(this._timers[w]),delete this._timers[w];for(const w in this._tiles)this._setTileReloadTimer(+w,this._tiles[w])}}update(s,h,v,w,P){if(this.transform=s,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!v)return;this.updateCacheSize(s,h),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const O=this._source.type==="batched-model";let L,z=this._source.maxzoom;const G=this.map&&this.map.painter?this.map.painter._terrain:null;if(G&&G.sourceCache===this&&G.attenuationRange()){const K=G.attenuationRange()[0],re=Math.floor(K)-Math.log2(G.getDemUpscale());z>re&&(z=re)}if(this.used||this.usedForTerrain){if(this._source.tileID)L=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(K=>new i.aP(K.canonical.z,K.wrap,K.canonical.z,K.canonical.x,K.canonical.y));else if(this.tileCoverLift!==0){const K=s.clone();K.tileCoverLift=this.tileCoverLift,L=K.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:z,roundZoom:this._source.roundZoom&&!v,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:O}),this._source.minzoom<=1&&s.projection.name==="globe"&&(L.push(new i.aP(1,0,1,0,0)),L.push(new i.aP(1,0,1,1,0)),L.push(new i.aP(1,0,1,0,1)),L.push(new i.aP(1,0,1,1,1)))}else if(L=s.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:z,roundZoom:this._source.roundZoom&&!v,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:O}),this._source.hasTile){const K=this._source.hasTile.bind(this._source);L=L.filter(re=>K(re))}}else L=[];if(L.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!zh(this._source.type)){const K=s.coveringZoomLevel({tileSize:h||this._source.tileSize,roundZoom:this._source.roundZoom&&!v}),re=Math.min(K,this._source.maxzoom);if(O){const le=s.extendTileCover(L,re);for(const ue of le)L.push(ue)}else if(P){const le=s.extendTileCoverToNearPlane(L,this.transform.getFrustum(re),re);for(const ue of le)L.push(ue)}else if(this.castsShadows&&w){const le=s.extendTileCover(L,re,w);for(const ue of le)this._shadowCasterTiles[ue.key]=!0,L.push(ue)}}const H=this._updateRetainedTiles(L);if(zh(this._source.type)&&L.length!==0){const K={},re={},le=Object.keys(H);for(const _e of le){const ge=H[_e],Se=this._tiles[_e];if(!Se||Se.fadeEndTime&&Se.fadeEndTime<=i.o.now())continue;const ke=this.findLoadedParent(ge,Math.max(ge.overscaledZ-Ql.maxOverzooming,this._source.minzoom));ke&&(this._addTile(ke.tileID),K[ke.tileID.key]=ke.tileID),re[_e]=ge}const ue=L[L.length-1].overscaledZ;for(const _e in this._tiles){const ge=this._tiles[_e];if(H[_e]||!ge.hasData())continue;let Se=ge.tileID;for(;Se.overscaledZ>ue;){Se=Se.scaledTo(Se.overscaledZ-1);const ke=this._tiles[Se.key];if(ke&&ke.hasData()&&re[Se.key]){H[_e]=ge.tileID;break}}}for(const _e in K)H[_e]||(this._coveredTiles[_e]=!0,H[_e]=K[_e])}for(const K in H)this._tiles[K].clearFadeHold();const Q=i.bu(this._tiles,H);for(const K of Q){const re=this._tiles[K];re.hasSymbolBuckets&&!re.holdingForFade()?re.setHoldDuration(this.map._fadeDuration):re.hasSymbolBuckets&&!re.symbolFadeFinished()||this._removeTile(+K)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(+s)}_updateRetainedTiles(s){const h={};if(s.length===0)return h;const v={},w=s.reduce((G,H)=>Math.min(G,H.overscaledZ),1/0),P=s[0].overscaledZ,O=Math.max(P-Ql.maxOverzooming,this._source.minzoom),L=Math.max(P+Ql.maxUnderzooming,this._source.minzoom),z={};for(const G of s){const H=this._addTile(G);h[G.key]=G,H.hasData()||w<this._source.maxzoom&&(z[G.key]=G)}this._retainLoadedChildren(z,w,L,h);for(const G of s){let H=this._tiles[G.key];if(H.hasData())continue;if(G.canonical.z>=this._source.maxzoom){const K=G.children(this._source.maxzoom)[0],re=this.getTile(K);if(re&&re.hasData()){h[K.key]=K;continue}}else{const K=G.children(this._source.maxzoom);if(h[K[0].key]&&h[K[1].key]&&h[K[2].key]&&h[K[3].key])continue}let Q=H.wasRequested();for(let K=G.overscaledZ-1;K>=O;--K){const re=G.scaledTo(K);if(v[re.key]||(v[re.key]=!0,H=this.getTile(re),!H&&Q&&(H=this._addTile(re)),H&&(h[re.key]=re,Q=H.wasRequested(),H.hasData())))break}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const h=[];let v,w=this._tiles[s].tileID;for(;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){v=this._loadedParentTiles[w.key];break}h.push(w.key);const P=w.scaledTo(w.overscaledZ-1);if(v=this._getLoadedTile(P),v)break;w=P}for(const P of h)this._loadedParentTiles[P]=v}}_addTile(s){let h=this._tiles[s.key];if(h)return h.isExtraShadowCaster!==!0||this._shadowCasterTiles[s.key]||this._reloadTile(s.key,"reloading"),h;h=this._cache.getAndRemove(s),h&&(this._setTileReloadTimer(s.key,h),h.tileID=s,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,h)));const v=!!h;if(!v){const w=this.map?this.map.painter:null,P=this._source.tileSize*s.overscaleFactor();h=this._source.type==="raster-array"?new Ld(s,P,this.transform.tileZoom,w,this._isRaster):new iu(s,P,this.transform.tileZoom,w,this._isRaster,this._source.worldview),this._loadTile(h,this._tileLoaded.bind(this,h,s.key,h.state))}return h.uses++,this._tiles[s.key]=h,v||this._source.fire(new i.z("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(s,h){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const v=h.getExpiryTimeout();v&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},v))}_removeTile(s){const h=this._tiles[s];h&&(h.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),h.uses>0||(h.hasData()&&h.state!=="reloading"||h.state==="empty"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(+s);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(s,h,v){const w=[],P=this.transform;if(!P)return w;const O=P.projection.name==="globe",L=i.aF(P.center.lng);for(const z in this._tiles){const G=this._tiles[z];if(v&&G.clearQueryDebugViz(),G.holdingForFade())continue;let H;if(O){const Q=G.tileID.canonical;if(Q.z===0){const K=[Math.abs(i.aA(L,...Bh(Q,-1))-L),Math.abs(i.aA(L,...Bh(Q,1))-L)];H=[0,2*K.indexOf(Math.min(...K))-1]}else{const K=[Math.abs(i.aA(L,...Bh(Q,-1))-L),Math.abs(i.aA(L,...Bh(Q,0))-L),Math.abs(i.aA(L,...Bh(Q,1))-L)];H=[K.indexOf(Math.min(...K))-1]}}else H=[0];for(const Q of H){const K=s.containsTile(G,P,h,Q);K&&w.push(K)}}return w}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(s){return this._getRenderableCoordinates(s)}_getRenderableCoordinates(s,h){const v=this.getRenderableIds(s,h).map(P=>this._tiles[P].tileID),w=this.transform.projection.name==="globe";for(const P of v)P.projMatrix=this.transform.calculateProjMatrix(P.toUnwrapped()),P.expandedProjMatrix=w?this.transform.calculateProjMatrix(P.toUnwrapped(),!1,!0):P.projMatrix;return v}sortCoordinatesByDistance(s){const h=s.slice(),v=this.transform._camera.position,w=this.transform._camera.forward(),P={};for(const O of h){const L=1/(1<<O.canonical.z);P[O.key]=((O.canonical.x+.5)*L+O.wrap-v[0])*w[0]+((O.canonical.y+.5)*L-v[1])*w[1]-v[2]*w[2]}return h.sort((O,L)=>P[O.key]-P[L.key]),h}hasTransition(){if(this._source.hasTransition())return!0;if(zh(this._source.type))for(const s in this._tiles){const h=this._tiles[s];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=i.o.now())return!0}return!1}setFeatureState(s,h,v){this._state.updateState(s=s||"_geojsonTileLayer",h,v)}removeFeatureState(s,h,v){this._state.removeFeatureState(s=s||"_geojsonTileLayer",h,v)}getFeatureState(s,h){return this._state.getState(s=s||"_geojsonTileLayer",h)}setDependencies(s,h,v){const w=this._tiles[s];w&&w.setDependencies(h,v)}reloadTilesForDependencies(s,h){for(const v in this._tiles)this._tiles[v].hasDependency(s,h)&&this._reloadTile(+v,"reloading");this._cache.filter(v=>!v.hasDependency(s,h))}_preloadTiles(s,h){if(!this._sourceLoaded){const z=()=>{this._sourceLoaded&&(this._source.off("data",z),this._preloadTiles(s,h))};return void this._source.on("data",z)}const v=new Map,w=Array.isArray(s)?s:[s],P=this.map.painter.terrain,O=this.usedForTerrain&&P?P.getScaledDemTileSize():this._source.tileSize;for(const z of w){const G=z.coveringTiles({tileSize:O,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const H of G)v.set(H.key,H);this.usedForTerrain&&z.updateElevation(!1)}const L=Array.from(v.values());i.bv(L,(z,G)=>{const H=new iu(z,this._source.tileSize*z.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(H,Q=>{this._source.type==="raster-dem"&&H.dem&&this._backfillDEM(H),G(Q,H)})},h)}}function Xb(y,s){const h=Math.abs(2*y.wrap)-+(y.wrap<0),v=Math.abs(2*s.wrap)-+(s.wrap<0);return y.overscaledZ-s.overscaledZ||v-h||s.canonical.y-y.canonical.y||s.canonical.x-y.canonical.x}function zh(y){return y==="raster"||y==="image"||y==="video"||y==="custom"}function Bh(y,s){const h=1<<y.z;return[y.x/h+s,(y.x+1)/h+s]}Ql.maxOverzooming=10,Ql.maxUnderzooming=3;class Yb{constructor(s){this.style=s,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const s=!1,h=!1;for(const v in this.style._mergedLayers){const w=this.style._mergedLayers[v];if(w.type==="fill-extrusion"||w.type==="building")this.layers.push({layer:w,visible:s,visibilityChanged:h});else if(w.type==="model"){const P=this.style.getLayerSource(w);P&&P.type==="batched-model"&&this.layers.push({layer:w,visible:s,visibilityChanged:h})}}}onNewFrame(s){this.layersGotHidden=!1;for(const h of this.layers){const v=h.layer;let w=!1;v.type==="fill-extrusion"?w=!v.isHidden(s)&&v.paint.get("fill-extrusion-opacity")>0:v.type==="building"?w=!v.isHidden(s)&&v.paint.get("building-opacity")>0:v.type==="model"&&(w=!v.isHidden(s)&&v.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!w&&h.visible,h.visible=w}}updateZOffset(s,h){this.currentBuildingBuckets=[];for(const w of this.layers){const P=w.layer,O=this.style.getLayerSourceCache(P);let L=1;P.type==="fill-extrusion"?L=w.visible?P.paint.get("fill-extrusion-vertical-scale"):0:P.type==="building"&&(L=w.visible?P.paint.get("building-vertical-scale"):0);let z=O?O.getTile(h):null;if(!z&&O)for(const G in O._tiles){const H=O._tiles[G];if(h.canonical.isChildOf(H.tileID.canonical)){z=H;break}}this.currentBuildingBuckets.push({bucket:z?z.getBucket(P):null,tileID:z?z.tileID:h,verticalScale:L})}s.hasAnyZOffset=!1;let v=!1;for(let w=0;w<s.symbolInstances.length;w++){const P=s.symbolInstances.get(w),O=P.zOffset,L=this._getHeightAtTileOffset(h,P.tileAnchorX,P.tileAnchorY);P.zOffset=L!==Number.NEGATIVE_INFINITY?L:O,v||O===P.zOffset||(v=!0),s.hasAnyZOffset||P.zOffset===0||(s.hasAnyZOffset=!0)}v&&(s.zOffsetBuffersNeedUpload=!0,s.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(s,h,v,w){let P=h,O=v;if(s.canonical.z!==w.canonical.z){const L=w.canonical,z=1/(1<<s.canonical.z-L.z);P=(h+s.canonical.x*i.al)*z-L.x*i.al|0,O=(v+s.canonical.y*i.al)*z-L.y*i.al|0}return{tileX:P,tileY:O}}_getHeightAtTileOffset(s,h,v){let w,P;for(let O=0;O<this.layers.length;++O){const L=this.layers[O].layer;if(L.type!=="fill-extrusion"&&L.type!=="building")continue;const{bucket:z,tileID:G,verticalScale:H}=this.currentBuildingBuckets[O];if(!z)continue;const{tileX:Q,tileY:K}=this._mapCoordToOverlappingTile(s,h,v,G),re=z.getHeightAtTileCoord(Q,K);re&&re.height!==void 0&&(re.hidden?w=re.height:P=Math.max(re.height*H,P||0))}if(P!==void 0)return P;for(let O=0;O<this.layers.length;++O){const L=this.layers[O];if(L.layer.type!=="model"||!L.visible)continue;const{bucket:z,tileID:G}=this.currentBuildingBuckets[O];if(!z)continue;const{tileX:H,tileY:Q}=this._mapCoordToOverlappingTile(s,h,v,G),K=z.getHeightAtTileCoord(H,Q);if(K&&!K.hidden)return K.height===void 0&&w!==void 0?Math.min(K.maxHeight,w)*K.verticalScale:K.height?K.height*K.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function vg(y,s){const h={};for(const v in y)v!=="ref"&&(h[v]=y[v]);return i.bw.forEach(v=>{v in s&&(h[v]=s[v])}),h}function Xf(y){y=y.slice();const s=Object.create(null);for(let h=0;h<y.length;h++)s[y[h].id]=y[h];for(let h=0;h<y.length;h++)"ref"in y[h]&&(y[h]=vg(y[h],s[y[h].ref]));return y}const Yn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Jb(y,s,h){h.push({command:Yn.addSource,args:[y,s[y]]})}function _g(y,s,h){s.push({command:Yn.removeSource,args:[y]}),h[y]=!0}function xg(y,s,h,v){_g(y,h,v),Jb(y,s,h)}function Qb(y,s,h){let v;for(v in y[h])if(y[h].hasOwnProperty(v)&&v!=="data"&&!i.bx(y[h][v],s[h][v]))return!1;for(v in s[h])if(s[h].hasOwnProperty(v)&&v!=="data"&&!i.bx(y[h][v],s[h][v]))return!1;return!0}function bg(y,s,h,v,w,P){let O;for(O in s=s||{},y=y||{})y.hasOwnProperty(O)&&(i.bx(y[O],s[O])||h.push({command:P,args:[v,O,s[O],w]}));for(O in s)s.hasOwnProperty(O)&&!y.hasOwnProperty(O)&&(i.bx(y[O],s[O])||h.push({command:P,args:[v,O,s[O],w]}))}function wg(y){return y.id}function Sg(y,s){return y[s.id]=s,y}function $h(y,s,h){const v=s.createTileMatrix(y,y.worldSize,h.toUnwrapped());return i.aB(new Float32Array(16),y.projMatrix,v)}function d2(y,s,h){if(s.projection.name===h.projection.name)return y.projMatrix;const v=h.clone();return v.setProjection(s.projection),$h(v,s.getProjection(),y)}function $v(y,s,h){return s.name===h.projection.name?y.projMatrix:$h(h,s,y)}class WR{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=i.aA(s,0,1);let h=1,v=this._distances[h];const w=s*this.paddedLength+this.padding;for(;v<w&&h<this._distances.length;)v=this._distances[++h];const P=h-1,O=this._distances[P],L=v-O,z=L>0?(w-O)/L:0;return this.points[P].mult(1-z).add(this.points[h].mult(z))}}class Eg{constructor(s,h,v){const w=this.boxCells=[],P=this.circleCells=[];this.xCellCount=Math.ceil(s/v),this.yCellCount=Math.ceil(h/v);for(let O=0;O<this.xCellCount*this.yCellCount;O++)w.push([]),P.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,v,w,P){this._forEachCell(h,v,w,P,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(v),this.bboxes.push(w),this.bboxes.push(P)}insertCircle(s,h,v,w){this._forEachCell(h-w,v-w,h+w,v+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(v),this.circles.push(w)}_insertBoxCell(s,h,v,w,P,O){this.boxCells[P].push(O)}_insertCircleCell(s,h,v,w,P,O){this.circleCells[P].push(O)}_query(s,h,v,w,P,O){if(v<0||s>this.width||w<0||h>this.height)return!P&&[];const L=[];if(s<=0&&h<=0&&this.width<=v&&this.height<=w){if(P)return!0;for(let z=0;z<this.boxKeys.length;z++)L.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const G=this.circles[3*z],H=this.circles[3*z+1],Q=this.circles[3*z+2];L.push({key:this.circleKeys[z],x1:G-Q,y1:H-Q,x2:G+Q,y2:H+Q})}return O?L.filter(O):L}return this._forEachCell(s,h,v,w,this._queryCell,L,{hitTest:P,seenUids:{box:{},circle:{}}},O),P?L.length>0:L}_queryCircle(s,h,v,w,P){const O=s-v,L=s+v,z=h-v,G=h+v;if(L<0||O>this.width||G<0||z>this.height)return!w&&[];const H=[];return this._forEachCell(O,z,L,G,this._queryCellCircle,H,{hitTest:w,circle:{x:s,y:h,radius:v},seenUids:{box:{},circle:{}}},P),w?H.length>0:H}query(s,h,v,w,P){return this._query(s,h,v,w,!1,P)}hitTest(s,h,v,w,P){return this._query(s,h,v,w,!0,P)}hitTestCircle(s,h,v,w){return this._queryCircle(s,h,v,!0,w)}_queryCell(s,h,v,w,P,O,L,z){const G=L.seenUids,H=this.boxCells[P];if(H!==null){const K=this.bboxes;for(const re of H)if(!G.box[re]){G.box[re]=!0;const le=4*re;if(s<=K[le+2]&&h<=K[le+3]&&v>=K[le+0]&&w>=K[le+1]&&(!z||z(this.boxKeys[re]))){if(L.hitTest)return O.push(!0),!0;O.push({key:this.boxKeys[re],x1:K[le],y1:K[le+1],x2:K[le+2],y2:K[le+3]})}}}const Q=this.circleCells[P];if(Q!==null){const K=this.circles;for(const re of Q)if(!G.circle[re]){G.circle[re]=!0;const le=3*re;if(this._circleAndRectCollide(K[le],K[le+1],K[le+2],s,h,v,w)&&(!z||z(this.circleKeys[re]))){if(L.hitTest)return O.push(!0),!0;{const ue=K[le],_e=K[le+1],ge=K[le+2];O.push({key:this.circleKeys[re],x1:ue-ge,y1:_e-ge,x2:ue+ge,y2:_e+ge})}}}}}_queryCellCircle(s,h,v,w,P,O,L,z){const G=L.circle,H=L.seenUids,Q=this.boxCells[P];if(Q!==null){const re=this.bboxes;for(const le of Q)if(!H.box[le]){H.box[le]=!0;const ue=4*le;if(this._circleAndRectCollide(G.x,G.y,G.radius,re[ue+0],re[ue+1],re[ue+2],re[ue+3])&&(!z||z(this.boxKeys[le])))return O.push(!0),!0}}const K=this.circleCells[P];if(K!==null){const re=this.circles;for(const le of K)if(!H.circle[le]){H.circle[le]=!0;const ue=3*le;if(this._circlesCollide(re[ue],re[ue+1],re[ue+2],G.x,G.y,G.radius)&&(!z||z(this.circleKeys[le])))return O.push(!0),!0}}}_forEachCell(s,h,v,w,P,O,L,z){const G=this._convertToXCellCoord(s),H=this._convertToYCellCoord(h),Q=this._convertToXCellCoord(v),K=this._convertToYCellCoord(w);for(let re=G;re<=Q;re++)for(let le=H;le<=K;le++)if(P.call(this,s,h,v,w,this.xCellCount*le+re,O,L,z))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,v,w,P,O){const L=w-s,z=P-h,G=v+O;return G*G>L*L+z*z}_circleAndRectCollide(s,h,v,w,P,O,L){const z=(O-w)/2,G=Math.abs(s-(w+z));if(G>z+v)return!1;const H=(L-P)/2,Q=Math.abs(h-(P+H));if(Q>H+v)return!1;if(G<=z||Q<=H)return!0;const K=G-z,re=Q-H;return K*K+re*re<=v*v}}const _l={unknown:0,flipRequired:1,flipNotRequired:2},Tg=Math.tan(85*Math.PI/180);function Yf(y,s,h,v,w,P,O){const L=i.bB();if(h)if(P.name==="globe"){const z=i.bC(w,s);i.aB(L,L,z)}else{const z=i.bD([],O);L[0]=z[0],L[1]=z[1],L[4]=z[2],L[5]=z[3],v||i.bA(L,L,w.angle)}else i.aB(L,w.labelPlaneMatrix,y);return L}function Ag(y,s,h,v,w,P,O){const L=Yf(y,s,h,v,w,P,O);return P.name==="globe"&&h||(L[2]=L[6]=L[10]=L[14]=0),L}function Bu(y,s,h,v,w,P,O){if(h){if(P.name==="globe"){const L=Yf(y,s,h,v,w,P,O);return i.bk(L,L),i.aB(L,y,L),L}{const L=i.by(y),z=i.bz([]);return z[0]=O[0],z[1]=O[1],z[4]=O[2],z[5]=O[3],i.aB(L,L,z),v||i.bA(L,L,-w.angle),L}}return w.glCoordMatrix}function eo(y,s,h,v){const w=[y,s,h,1];h?i.aC(w,w,v):ec(w,w,v);const P=w[3];return w[0]/=P,w[1]/=P,w[2]/=P,w}function ew(y,s){return Math.min(.5+y/s*.5,1.5)}function tw(y,s){const h=y[0]/y[3],v=y[1]/y[3];return h>=-s[0]&&h<=s[0]&&v>=-s[1]&&v<=s[1]}function rw(y,s,h,v,w,P,O,L,z,G,H=1){const Q=h.transform,K=v?y.textSizeData:y.iconSizeData,re=i.bJ(K,h.transform.zoom,H),le=Q.projection.name==="globe",ue=[256/h.width*2+1,256/h.height*2+1],_e=v?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;_e.clear();let ge=null;le&&(ge=v?y.text.globeExtVertexArray:y.icon.globeExtVertexArray);const Se=y.lineVertexArray,ke=v?y.text.placedSymbolArray:y.icon.placedSymbolArray,Te=h.transform.width/h.transform.height;let $e,Re=!1;for(let Ve=0;Ve<ke.length;Ve++){const Be=ke.get(Ve),{numGlyphs:De,writingMode:We}=Be;if(We!==i.bK.vertical||Re||$e===i.bK.horizontal||(Re=!0),$e=We,(Be.hidden||We===i.bK.vertical)&&!Re){$u(De,_e);continue}Re=!1;const lt=new i.P(Be.tileAnchorX,Be.tileAnchorY),it=y.elevationType==="road",bt=!!Q.elevation||it;let{x:mt,y:Ot,z:Zt}=Q.projection.projectTilePoint(lt.x,lt.y,G.canonical),pt=null;if(bt){const fr=it?y.getElevationFeatureForText(Ve):null;pt={getElevation:z,elevation:Q.elevation,elevationFeature:fr};const[Mr,An,Dn]=z(lt,Q.elevation,fr);mt+=Mr,Ot+=An,Zt+=Dn}const et=[mt,Ot,Zt,1];if(i.aC(et,et,s),!tw(et,ue)){$u(De,_e);continue}const kt=et[3],gt=ew(h.transform.getCameraToCenterDistance(Q.projection),kt),Lt=i.bL(K,re,Be),Qt=O?Lt/gt:Lt*gt,vr=eo(mt,Ot,Zt,w);if(vr[3]<=0){$u(De,_e);continue}let Gt={};const Yt=i.an(y.layers[0].layout.get("text-max-angle")),br=Math.cos(Yt),hr=O?null:pt,cr=h2(Be,Qt,!1,L,s,w,P,y.glyphOffsetArray,Se,_e,ge,vr,lt,Gt,Te,hr,Q.projection,G,O,br);Re=cr.useVertical,hr&&cr.needsFlipping&&(Gt={}),(cr.notEnoughRoom||Re||cr.needsFlipping&&h2(Be,Qt,!0,L,s,w,P,y.glyphOffsetArray,Se,_e,ge,vr,lt,Gt,Te,hr,Q.projection,G,O,br).notEnoughRoom)&&$u(De,_e)}v?(y.text.dynamicLayoutVertexBuffer.updateData(_e),ge&&y.text.globeExtVertexBuffer&&y.text.globeExtVertexBuffer.updateData(ge)):(y.icon.dynamicLayoutVertexBuffer.updateData(_e),ge&&y.icon.globeExtVertexBuffer&&y.icon.globeExtVertexBuffer.updateData(ge))}function ni(y,s,h,v,w,P,O,L,z,G,H,Q,K,re,le,ue,_e){const{lineStartIndex:ge,glyphStartIndex:Se,segment:ke}=L,Te=Se+L.numGlyphs,$e=ge+L.lineLength,Re=s.getoffsetX(Se),Ve=s.getoffsetX(Te-1),Be=Pg(y*Re,h,v,w,P,O,ke,ge,$e,z,G,H,Q,K,!0,re,le,ue,_e);if(!Be)return null;const De=Pg(y*Ve,h,v,w,P,O,ke,ge,$e,z,G,H,Q,K,!0,re,le,ue,_e);return De?{first:Be,last:De}:null}function nw(y,s,h,v){return y===i.bK.horizontal&&Math.abs(v)>Math.abs(h)?{useVertical:!0}:y===i.bK.vertical?v>0?{needsFlipping:!0}:null:s!==_l.unknown&&function(w,P){return w===0||Math.abs(P/w)>Tg}(h,v)?s===_l.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function h2(y,s,h,v,w,P,O,L,z,G,H,Q,K,re,le,ue,_e,ge,Se,ke){const Te=s/24,$e=y.lineOffsetX*Te,Re=y.lineOffsetY*Te,{lineStartIndex:Ve,glyphStartIndex:Be,numGlyphs:De,segment:We,writingMode:lt,flipState:it}=y,bt=Ve+y.lineLength,mt=Ot=>{if(H){const[kt,gt,Lt]=Ot.up,Qt=G.length;i.bM(H,Qt+0,kt,gt,Lt),i.bM(H,Qt+1,kt,gt,Lt),i.bM(H,Qt+2,kt,gt,Lt),i.bM(H,Qt+3,kt,gt,Lt)}const[Zt,pt,et]=Ot.point;i.bN(G,Zt,pt,et,Ot.angle)};if(De>1){const Ot=ni(Te,L,$e,Re,h,Q,K,y,z,P,re,ue,!1,_e,ge,Se,ke);if(!Ot)return{notEnoughRoom:!0};if(v&&!h){let[Zt,pt,et]=Ot.first.point,[kt,gt,Lt]=Ot.last.point;[Zt,pt]=eo(Zt,pt,et,O),[kt,gt]=eo(kt,gt,Lt,O);const Qt=nw(lt,it,(kt-Zt)*le,gt-pt);if(y.flipState=Qt&&Qt.needsFlipping?_l.flipRequired:_l.flipNotRequired,Qt)return Qt}mt(Ot.first);for(let Zt=Be+1;Zt<Be+De-1;Zt++){const pt=Pg(Te*L.getoffsetX(Zt),$e,Re,h,Q,K,We,Ve,bt,z,P,re,ue,!1,!1,_e,ge,Se,ke);if(!pt)return G.length-=4*(Zt-Be),{notEnoughRoom:!0};mt(pt)}mt(Ot.last)}else{if(v&&!h){const Zt=eo(K.x,K.y,0,w),pt=Ve+We+1,et=new i.P(z.getx(pt),z.gety(pt)),kt=eo(et.x,et.y,0,w),gt=kt[3]>0?kt:qr(K,et,Zt,1,w,void 0,_e,ge.canonical),Lt=nw(lt,it,(gt[0]-Zt[0])*le,gt[1]-Zt[1]);if(y.flipState=Lt&&Lt.needsFlipping?_l.flipRequired:_l.flipNotRequired,Lt)return Lt}const Ot=Pg(Te*L.getoffsetX(Be),$e,Re,h,Q,K,We,Ve,bt,z,P,re,ue,!1,!1,_e,ge,Se,ke);if(!Ot)return{notEnoughRoom:!0};mt(Ot)}return{}}function f2(y,s,h,v,w){const{x:P,y:O,z:L}=v.projectTilePoint(y.x,y.y,s);if(!w)return eo(P,O,L,h);const[z,G,H]=w.getElevation(y,w.elevation,w.elevationFeature);return eo(P+z,O+G,L+H,h)}function qr(y,s,h,v,w,P,O,L){const z=f2(y.sub(s)._unit()._add(y),L,w,O,P);return i.av(z,h,z),i.aw(z,z),i.bG(z,h,z,v)}function Pg(y,s,h,v,w,P,O,L,z,G,H,Q,K,re,le,ue,_e,ge,Se){const ke=v?y-s:y+s;let Te=ke>0?1:-1,$e=0;v&&(Te*=-1,$e=Math.PI),Te<0&&($e+=Math.PI);let Re=L+O+(Te>0?0:1)|0,Ve=w,Be=w,De=0,We=0;const lt=Math.abs(ke),it=[],bt=[];let mt=P,Ot=mt,Zt=i.bE([]);const pt=()=>qr(Ot,mt,Be,lt-De+1,H,K,ue,_e.canonical);for(;De+We<=lt;){if(Re+=Te,Re<L||Re>=z)return null;if(Be=Ve,Ot=mt,it.push(Be),re&&bt.push(Ot),mt=new i.P(G.getx(Re),G.gety(Re)),Ve=Q[Re],!Ve){const hr=f2(mt,_e.canonical,H,ue,K);Ve=hr[3]>0?Q[Re]=hr:pt()}De+=We;const Yt=i.av([],Ve,Be),br=i.bF(Be,Ve);if(h&&br>0&&We>0&&i.bI(Zt,Yt)/(We*br)<Se)return null;We=br,Zt=Yt}le&&K&&(Q[Re]&&(Ve=pt(),We=i.bF(Be,Ve),Zt=i.av([],Ve,Be)),Q[Re]=Ve);const et=(lt-De)/We,kt=mt.sub(Ot)._mult(et)._add(Ot),gt=i.bG([],Be,Zt,et);let Lt=[0,0,1],Qt=Zt[0],vr=Zt[1];if(ge&&(Lt=ue.upVector(_e.canonical,kt.x,kt.y),Lt[0]!==0||Lt[1]!==0||Lt[2]!==1)){const Yt=[Lt[2],0,-Lt[0]],br=i.bH([],Lt,Yt);i.aw(Yt,Yt),i.aw(br,br),Qt=i.bI(Zt,Yt),vr=i.bI(Zt,br)}if(h){const Yt=i.bH([],Lt,Zt);i.aw(Yt,Yt),i.bG(gt,gt,Yt,h*Te)}const Gt=$e+Math.atan2(vr,Qt);return it.push(gt),re&&bt.push(kt),{point:gt,angle:Gt,path:it,tilePath:bt,up:Lt}}function $u(y,s){const h=s.length,v=h+4*y;s.resize(v),s.float32.fill(-1/0,4*h,4*v)}function ec(y,s,h){const v=s[0],w=s[1];return y[0]=h[0]*v+h[4]*w+h[12],y[1]=h[1]*v+h[5]*w+h[13],y[3]=h[3]*v+h[7]*w+h[15],y}const tc=100;class Jf{constructor(s,h,v=new Eg(s.width+200,s.height+200,25),w=new Eg(s.width+200,s.height+200,25)){this.transform=s,this.grid=v,this.ignoredGrid=w,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+tc,this.screenBottomBoundary=s.height+tc,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=h}placeCollisionBox(s,h,v,w,P,O,L,z,G,H,Q){let K=v.projectedAnchorX,re=v.projectedAnchorY,le=v.projectedAnchorZ;const ue=v.tileAnchorX,_e=v.tileAnchorY,ge=v.elevation,Se=v.tileID,ke=s.getProjection();if(ge&&Se){const[bt,mt,Ot]=ke.upVector(Se.canonical,v.tileAnchorX,v.tileAnchorY),Zt=ke.upVectorScale(Se.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;K+=bt*ge*Zt,re+=mt*ge*Zt,le+=Ot*ge*Zt}const Te=s.projection.name==="globe",$e=s.projection.name==="globe"?i.aj(this.transform.zoom):0;if(Se&&Te&&$e<1&&!O){const bt=1<<Se.canonical.z,mt=i.bO(ue,_e);i.bP(mt,mt,1/i.al),i.bQ(mt,mt,i.bO(Se.canonical.x,Se.canonical.y)),i.bP(mt,mt,1/bt),i.bR(mt,mt,i.bO(w[0],w[1])),mt[0]=i.bS(mt[0],-.5,.5),i.bP(mt,mt,i.al);const Ot=i.bT(mt[0],mt[1],i.al/(2*Math.PI),1);i.aC(Ot,Ot,P),K=i.ak(K,Ot[0],$e),re=i.ak(re,Ot[1],$e),le=i.ak(le,Ot[2],$e)}const Re=this.projectAndGetPerspectiveRatio(H,K,re,le,v.tileID,ke.name==="globe"||!!ge||this.transform.pitch>0,ke),Ve=G*Re.perspectiveRatio,Be=(v.x1*h+L.x-v.padding)*Ve+Re.point.x,De=(v.y1*h+L.y-v.padding)*Ve+Re.point.y,We=(v.x2*h+L.x+v.padding)*Ve+Re.point.x,lt=(v.y2*h+L.y+v.padding)*Ve+Re.point.y,it=Re.perspectiveRatio<=.55||Re.occluded;return!this.isInsideGrid(Be,De,We,lt)||!z&&this.grid.hitTest(Be,De,We,lt,Q)||it?{box:[],offscreen:!1,occluded:Re.occluded}:{box:[Be,De,We,lt],offscreen:this.isOffscreen(Be,De,We,lt),occluded:!1}}placeCollisionCircles(s,h,v,w,P,O,L,z,G,H,Q,K,re,le,ue,_e){const ge=[],Se=this.transform.elevation,ke=s.getProjection(),Te=s.elevationType==="road",$e=!!Se||Te,Re=i.bU.getAtTileOffsetFunc(_e,this.transform.center.lat,this.transform.worldSize,ke),Ve=new i.P(v.tileAnchorX,v.tileAnchorY),Be=new i.P(v.tileAnchorX,v.tileAnchorY);let{x:De,y:We,z:lt}=ke.projectTilePoint(Be.x,Be.y,_e.canonical),it=null;if($e){const br=Te?s.getElevationFeatureForText(w):null;it={getElevation:Re,elevation:Se,elevationFeature:br};const[hr,cr,fr]=Re(Ve,Se,br);De+=hr,We+=cr,lt+=fr}const bt=ke.name==="globe",mt=this.projectAndGetPerspectiveRatio(z,De,We,lt,_e,bt||!!Se||this.transform.pitch>0,ke),{perspectiveRatio:Ot}=mt,Zt=(K?L/Ot:L*Ot)/i.bX,pt=eo(De,We,lt,G),et=v.lineOffsetX*Zt,kt=v.lineOffsetY*Zt,gt=i.an(s.layers[0].layout.get("text-max-angle")),Lt=Math.cos(gt),Qt=mt.signedDistanceFromCamera>0?ni(Zt,O,et,kt,Te&&v.flipState===1,pt,Be,v,P,G,{},$e&&!K?it:null,K&&$e,ke,_e,K,Lt):null;let vr=!1,Gt=!1,Yt=!0;if(Qt&&!mt.occluded){const br=.5*le*Ot+ue,hr=new i.P(-100,-100),cr=new i.P(this.screenRightBoundary,this.screenBottomBoundary),fr=new WR,{first:Mr,last:An}=Qt,Dn=Mr.path.length;let mi=[];for(let sn=Dn-1;sn>=1;sn--)mi.push(Mr.path[sn]);for(let sn=1;sn<An.path.length;sn++)mi.push(An.path[sn]);const Hr=2.5*br;H&&(mi=mi.map(([sn,si,Ln],Ai)=>($e&&!bt&&(Ln=Re(Ai<Dn-1?Mr.tilePath[Dn-1-Ai]:An.tilePath[Ai-Dn+2],Se,it.elevationFeature)[2]),eo(sn,si,Ln,H))),mi.some(sn=>sn[3]<=0)&&(mi=[]));let Mn=[];if(mi.length>0){let sn=1/0,si=-1/0,Ln=1/0,Ai=-1/0;for(const qn of mi)sn=Math.min(sn,qn[0]),Ln=Math.min(Ln,qn[1]),si=Math.max(si,qn[0]),Ai=Math.max(Ai,qn[1]);si>=hr.x&&sn<=cr.x&&Ai>=hr.y&&Ln<=cr.y&&(Mn=[mi.map(qn=>new i.P(qn[0],qn[1]))],(sn<hr.x||si>cr.x||Ln<hr.y||Ai>cr.y)&&(Mn=i.bV(Mn,hr.x,hr.y,cr.x,cr.y)))}for(const sn of Mn){fr.reset(sn,.25*br);let si=0;si=fr.length<=.5*br?1:Math.ceil(fr.paddedLength/Hr)+1;for(let Ln=0;Ln<si;Ln++){const Ai=Ln/Math.max(si-1,1),qn=fr.lerp(Ai),dn=qn.x+tc,Jn=qn.y+tc;ge.push(dn,Jn,br,0);const gn=dn-br,Mi=Jn-br,ri=dn+br,Zr=Jn+br;if(Yt=Yt&&this.isOffscreen(gn,Mi,ri,Zr),Gt=Gt||this.isInsideGrid(gn,Mi,ri,Zr),!h&&this.grid.hitTestCircle(dn,Jn,br,re)&&(vr=!0,!Q))return{circles:[],offscreen:!1,collisionDetected:vr,occluded:!1}}}}return{circles:!Q&&vr||!Gt?[]:ge,offscreen:Yt,collisionDetected:vr,occluded:mt.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let v=1/0,w=1/0,P=-1/0,O=-1/0;for(const H of s){const Q=new i.P(H.x+tc,H.y+tc);v=Math.min(v,Q.x),w=Math.min(w,Q.y),P=Math.max(P,Q.x),O=Math.max(O,Q.y),h.push(Q)}const L=this.grid.query(v,w,P,O).concat(this.ignoredGrid.query(v,w,P,O)),z={},G={};for(const H of L){const Q=H.key;if(z[Q.bucketInstanceId]===void 0&&(z[Q.bucketInstanceId]={}),z[Q.bucketInstanceId][Q.featureIndex])continue;const K=[new i.P(H.x1,H.y1),new i.P(H.x2,H.y1),new i.P(H.x2,H.y2),new i.P(H.x1,H.y2)];i.bW(h,K)&&(z[Q.bucketInstanceId][Q.featureIndex]=!0,G[Q.bucketInstanceId]===void 0&&(G[Q.bucketInstanceId]=[]),G[Q.bucketInstanceId].push(Q.featureIndex))}return G}insertCollisionBox(s,h,v,w,P){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:w,collisionGroupID:P},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,v,w,P){const O=h?this.ignoredGrid:this.grid,L={bucketInstanceId:v,featureIndex:w,collisionGroupID:P};for(let z=0;z<s.length;z+=4)O.insertCircle(L,s[z],s[z+1],s[z+2])}projectAndGetPerspectiveRatio(s,h,v,w,P,O,L){const z=[h,v,w,1];let G=!1;w||this.transform.pitch>0?(i.aC(z,z,s),this.fogState&&P&&L.name!=="globe"&&(G=function(K,re,le,ue,_e,ge){const Se=ge.calculateFogTileMatrix(_e),ke=[re,le,ue];return i.af(ke,ke,Se),Kt(K,i.ag(ke),ge.pitch,ge._fov)}(this.fogState,h,v,w,P.toUnwrapped(),this.transform)>.9)):ec(z,z,s);const H=z[3];return{point:new i.P((z[0]/H+1)/2*this.transform.width+tc,(-z[1]/H+1)/2*this.transform.height+tc),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(L)/H*.5,1.5),signedDistanceFromCamera:H,occluded:O&&z[2]>H||G}}isOffscreen(s,h,v,w){return v<tc||s>=this.screenRightBoundary||w<tc||h>this.screenBottomBoundary}isInsideGrid(s,h,v,w){return v>=0&&s<this.gridRightBoundary&&w>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const s=i.bz([]);return i.bq(s,s,[-100,-100,0]),s}}class Cr{constructor(s,h,v,w){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):w&&v?1:0,this.placed=v}isHidden(){return this.opacity===0&&!this.placed}}class Vn{constructor(s,h,v,w,P,O=!1){this.text=new Cr(s?s.text:null,h,v,P),this.icon=new Cr(s?s.icon:null,h,w,P),this.clipped=O}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ti{constructor(s,h,v,w=!1){this.text=s,this.icon=h,this.skipFade=v,this.clipped=w}}class Js{constructor(){this.invProjMatrix=i.bB(),this.viewportMatrix=i.bB(),this.circles=[]}}class Qf{constructor(s,h,v,w,P){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=v,this.bucketIndex=w,this.tileID=P}}class oi{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:v=>v.collisionGroupID===h}}return this.collisionGroups[s]}}function Cg(y,s,h,v,w){const{horizontalAlign:P,verticalAlign:O}=i.c0(y),L=-(P-.5)*s,z=-(O-.5)*h,G=i.c1(y,v);return new i.P(L+G[0]*w,z+G[1]*w)}function Uh(y,s,h,v,w){const P=new i.P(y,s);return h&&P._rotate(v?w:-w),P}class Og{constructor(s,h,v,w,P,O){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new Jf(this.transform,P),this.buildingIndex=O,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new oi(v),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,h,v,w,P=1){const O=v.getBucket(h),L=v.latestFeatureIndex;if(!O||!L||h.fqid!==O.layerIds[0])return;const z=O.layers[0].layout,G=O.layers[0].paint,H=v.collisionBoxArray,Q=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),K=v.tileSize/i.al,re=v.tileID.toUnwrapped();this.transform.setProjection(O.projection);const le=(ue=v.tileID,_e=O.getProjection(),ge=this.transform,_e.name===this.projection?ge.calculateProjMatrix(ue.toUnwrapped()):$h(ge,_e,ue));var ue,_e,ge;const Se=z.get("text-pitch-alignment")==="map",ke=z.get("text-rotation-alignment")==="map";h.compileFilter(h.options);const Te=h.dynamicFilter(),$e=h.dynamicFilterNeedsFeature(),Re=this.transform.calculatePixelsToTileUnitsMatrix(v),Ve=Ag(le,v.tileID.canonical,Se,ke,this.transform,O.getProjection(),Re);let Be=null;const De=O.getProjection().createInversionMatrix(this.transform,v.tileID.canonical);if(Se){const et=Bu(le,v.tileID.canonical,Se,ke,this.transform,O.getProjection(),Re);Be=i.aB([],this.transform.labelPlaneMatrix,et)}let We=null;Te&&v.latestFeatureIndex&&(We={unwrappedTileID:re,dynamicFilter:Te,dynamicFilterNeedsFeature:$e}),this.retainedQueryData[O.bucketInstanceId]=new Qf(O.bucketInstanceId,L,O.sourceLayerIndex,O.index,v.tileID);const[lt,it]=O.layers[0].layout.get("text-size-scale-range"),bt=i.aA(P,lt,it),[mt,Ot]=z.get("icon-size-scale-range"),Zt=i.aA(P,mt,Ot),pt={bucket:O,layout:z,paint:G,posMatrix:le,invMatrix:De,mercatorCenter:[i.aF(this.transform.center.lng),i.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Ve,labelToScreenMatrix:Be,clippingData:We,scale:Q,textPixelRatio:K,holdingForFade:v.holdingForFade(),collisionBoxArray:H,partiallyEvaluatedTextSize:i.bJ(O.textSizeData,this.transform.zoom,bt),partiallyEvaluatedIconSize:i.bJ(O.iconSizeData,this.transform.zoom,Zt),collisionGroup:this.collisionGroups.get(O.sourceID),latestFeatureIndex:v.latestFeatureIndex};if(w)for(const et of O.sortKeyRanges){const{sortKey:kt,symbolInstanceStart:gt,symbolInstanceEnd:Lt}=et;s.push({sortKey:kt,symbolInstanceStart:gt,symbolInstanceEnd:Lt,parameters:pt})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:O.symbolInstances.length,parameters:pt})}attemptAnchorPlacement(s,h,v,w,P,O,L,z,G,H,Q,K,re,le,ue,_e,ge,Se,ke,Te,$e){const{textOffset0:Re,textOffset1:Ve,crossTileID:Be}=ue,De=[Re,Ve],We=Cg(s,O,L,De,z),lt=this.collisionIndex.placeCollisionBox(ge,z,h,v,w,P,Uh(We.x,We.y,G,H,this.transform.angle),le,Q,K,re.predicate);if(ke){const it=ge.getSymbolInstanceIconSize($e,this.transform.zoom,ue.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ge,it,ke,v,w,P,Uh(We.x,We.y,G,H,this.transform.angle),le,Q,K,re.predicate).box.length===0)return}if(lt.box.length>0){let it;return this.prevPlacement&&this.prevPlacement.variableOffsets[Be]&&this.prevPlacement.placements[Be]&&this.prevPlacement.placements[Be].text&&(it=this.prevPlacement.variableOffsets[Be].anchor),this.variableOffsets[Be]={textOffset:De,width:O,height:L,anchor:s,textScale:z,prevAnchor:it},this.markUsedJustification(ge,s,ue,Se),ge.allowVerticalPlacement&&(this.markUsedOrientation(ge,Se,ue),this.placedOrientations[Be]=Se),{shift:We,placedGlyphBoxes:lt}}}placeLayerBucketPart(s,h,v,w,P=1){const{bucket:O,layout:L,paint:z,posMatrix:G,textLabelPlaneMatrix:H,labelToScreenMatrix:Q,clippingData:K,textPixelRatio:re,mercatorCenter:le,invMatrix:ue,holdingForFade:_e,collisionBoxArray:ge,partiallyEvaluatedTextSize:Se,partiallyEvaluatedIconSize:ke,collisionGroup:Te,latestFeatureIndex:$e}=s.parameters,Re=L.get("text-optional"),Ve=L.get("icon-optional"),Be=L.get("text-allow-overlap"),De=L.get("icon-allow-overlap"),We=L.get("text-rotation-alignment")==="map",lt=L.get("icon-rotation-alignment")==="map",it=L.get("text-pitch-alignment")==="map",bt=z.get("symbol-z-offset"),mt=L.get("symbol-elevation-reference")==="sea",Ot=L.get("symbol-placement"),[Zt,pt]=L.get("text-size-scale-range"),[et,kt]=L.get("icon-size-scale-range"),gt=i.aA(P,Zt,pt),Lt=i.aA(P,et,kt),Qt=L.get("text-variable-anchor"),vr=We&&Ot!=="point",Gt=lt&&Ot!=="point",Yt=Qt&&O.hasTextData(),br=O.hasIconTextFit()&&Yt&&O.hasIconData();this.transform.setProjection(O.projection);const hr=Yt||vr,cr=Gt||br;let fr=Be&&(De||!O.hasIconData()||Ve),Mr=De&&(Be||!O.hasTextData()||Re);const An=!bt.isConstant();!O.collisionArrays&&ge&&O.deserializeCollisionBoxes(ge),v&&w&&O.updateCollisionDebugBuffers(this.transform.zoom,ge,gt,Lt);const Dn=(Hr,Mn,sn)=>{const{crossTileID:si,numVerticalGlyphVertices:Ln}=Hr;let Ai=null;if(K&&K.dynamicFilterNeedsFeature||An){const oa=this.retainedQueryData[O.bucketInstanceId];Ai=$e.loadFeature({featureIndex:Hr.featureIndex,bucketIndex:oa.bucketIndex,sourceLayerIndex:oa.sourceLayerIndex,layoutVertexArrayOffset:0})}if(K&&!(0,K.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:O.worldview},Ai,this.retainedQueryData[O.bucketInstanceId].tileID.canonical,new i.P(Hr.tileAnchorX,Hr.tileAnchorY),this.transform.calculateDistanceTileData(K.unwrappedTileID)))return this.placements[si]=new ti(!1,!1,!1,!0),void h.add(si);const qn=bt.evaluate(Ai,{});if(h.has(si))return;if(_e)return void(this.placements[si]=new ti(!1,!1,!1));let dn=!1,Jn=!1,gn=!0,Mi=!1,ri=!1,Zr=null,zn={box:null,offscreen:null,occluded:null},Xi={box:null},ba=null,ra=null,da=null,zs=0,Ts=0,jo=0;sn.textFeatureIndex?zs=sn.textFeatureIndex:Hr.useRuntimeCollisionCircles&&(zs=Hr.featureIndex),sn.verticalTextFeatureIndex&&(Ts=sn.verticalTextFeatureIndex);const Wo=O.elevationFeatures?O.elevationFeatures[Hr.elevationFeatureIndex]:void 0,El=oa=>{oa.tileID=this.retainedQueryData[O.bucketInstanceId].tileID;const wa=this.transform.elevation;oa.elevation=mt?qn:qn+i.bU.getAtTileOffset(oa.tileID,new i.P(oa.tileAnchorX,oa.tileAnchorY),wa,Wo),oa.elevation+=Hr.zOffset},No=sn.textBox;if(No){El(No);const oa=Ei=>{let Aa=i.bK.horizontal;if(O.allowVerticalPlacement&&!Ei&&this.prevPlacement){const go=this.prevPlacement.placedOrientations[si];go&&(this.placedOrientations[si]=go,Aa=go,this.markUsedOrientation(O,Aa,Hr))}return Aa},wa=(Ei,Aa)=>{if(O.allowVerticalPlacement&&Ln>0&&sn.verticalTextBox){for(const go of O.writingModes)if(go===i.bK.vertical?(zn=Aa(),Xi=zn):zn=Ei(),zn&&zn.box&&zn.box.length)break}else zn=Ei()};if(Qt){let Ei=Qt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[si]){const sa=this.prevPlacement.variableOffsets[si];Ei.indexOf(sa.anchor)>0&&(Ei=Ei.filter(Al=>Al!==sa.anchor),Ei.unshift(sa.anchor))}const Aa=(sa,Al,kp)=>{const Yu=O.getSymbolInstanceTextSize(Se,Hr,this.transform.zoom,Mn),Ip=(sa.x2-sa.x1)*Yu+2*sa.padding,Rp=(sa.y2-sa.y1)*Yu+2*sa.padding,Pl=Hr.hasIconTextFit&&!De?Al:null;Pl&&El(Pl);let uu={box:[],offscreen:!1,occluded:!1};const uo=Be?2*Ei.length:Ei.length;for(let Cl=0;Cl<uo;++Cl){const rf=this.attemptAnchorPlacement(Ei[Cl%Ei.length],sa,le,ue,hr,Ip,Rp,Yu,We,it,re,G,Te,Cl>=Ei.length,Hr,Mn,O,kp,Pl,Se,ke);if(rf&&(uu=rf.placedGlyphBoxes,uu&&uu.box&&uu.box.length)){dn=!0,Zr=rf.shift;break}}return uu};wa(()=>Aa(No,sn.iconBox,i.bK.horizontal),()=>{const sa=sn.verticalTextBox;return sa&&El(sa),O.allowVerticalPlacement&&!(zn&&zn.box&&zn.box.length)&&Ln>0&&sa?Aa(sa,sn.verticalIconBox,i.bK.vertical):{box:null,offscreen:null,occluded:null}}),zn&&(dn=zn.box,gn=zn.offscreen,Mi=zn.occluded);const go=oa(!(!zn||!zn.box));if(!dn&&this.prevPlacement){const sa=this.prevPlacement.variableOffsets[si];sa&&(this.variableOffsets[si]=sa,this.markUsedJustification(O,sa.anchor,Hr,go))}}else{const Ei=(Aa,go)=>{const sa=O.getSymbolInstanceTextSize(Se,Hr,this.transform.zoom,Mn),Al=this.collisionIndex.placeCollisionBox(O,sa,Aa,le,ue,hr,new i.P(0,0),Be,re,G,Te.predicate);return Al&&Al.box&&Al.box.length&&(this.markUsedOrientation(O,go,Hr),this.placedOrientations[si]=go),Al};wa(()=>Ei(No,i.bK.horizontal),()=>{const Aa=sn.verticalTextBox;return O.allowVerticalPlacement&&Ln>0&&Aa?(El(Aa),Ei(Aa,i.bK.vertical)):{box:null,offscreen:null,occluded:null}}),oa(!!(zn&&zn.box&&zn.box.length))}}if(ba=zn,dn=ba&&ba.box&&ba.box.length>0,gn=ba&&ba.offscreen,Mi=ba&&ba.occluded,Hr.useRuntimeCollisionCircles){const oa=Hr.centerJustifiedTextSymbolIndex>=0?Hr.centerJustifiedTextSymbolIndex:Hr.verticalPlacedTextSymbolIndex,wa=O.text.placedSymbolArray.get(oa),Ei=i.bL(O.textSizeData,Se,wa),Aa=L.get("text-padding");ra=this.collisionIndex.placeCollisionCircles(O,Be,wa,oa,O.lineVertexArray,O.glyphOffsetArray,Ei,G,H,Q,v,it,Te.predicate,Hr.collisionCircleDiameter*Ei/i.bX,Aa,this.retainedQueryData[O.bucketInstanceId].tileID),dn=Be||ra.circles.length>0&&!ra.collisionDetected,gn=gn&&ra.offscreen,Mi=ra.occluded}if(sn.iconFeatureIndex&&(jo=sn.iconFeatureIndex),sn.iconBox){const oa=wa=>{El(wa);const Ei=Hr.hasIconTextFit&&Zr?Uh(Zr.x,Zr.y,We,it,this.transform.angle):new i.P(0,0),Aa=O.getSymbolInstanceIconSize(ke,this.transform.zoom,Hr.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(O,Aa,wa,le,ue,cr,Ei,De,re,G,Te.predicate)};Xi&&Xi.box&&Xi.box.length&&sn.verticalIconBox?(da=oa(sn.verticalIconBox),Jn=da.box.length>0):(da=oa(sn.iconBox),Jn=da.box.length>0),gn=gn&&da.offscreen,ri=da.occluded}const Tl=Re||Hr.numHorizontalGlyphVertices===0&&Ln===0,lc=Ve||Hr.numIconVertices===0;if(Tl||lc?lc?Tl||(Jn=Jn&&dn):dn=Jn&&dn:Jn=dn=Jn&&dn,dn&&ba&&ba.box&&this.collisionIndex.insertCollisionBox(ba.box,L.get("text-ignore-placement"),O.bucketInstanceId,Xi&&Xi.box&&Ts?Ts:zs,Te.ID),Jn&&da&&this.collisionIndex.insertCollisionBox(da.box,L.get("icon-ignore-placement"),O.bucketInstanceId,jo,Te.ID),ra&&(dn&&this.collisionIndex.insertCollisionCircles(ra.circles,L.get("text-ignore-placement"),O.bucketInstanceId,zs,Te.ID),v)){const oa=O.bucketInstanceId;let wa=this.collisionCircleArrays[oa];wa===void 0&&(wa=this.collisionCircleArrays[oa]=new Js);for(let Ei=0;Ei<ra.circles.length;Ei+=4)wa.circles.push(ra.circles[Ei+0]),wa.circles.push(ra.circles[Ei+1]),wa.circles.push(ra.circles[Ei+2]),wa.circles.push(ra.collisionDetected?1:0)}const mo=O.projection.name!=="globe";fr=fr&&(mo||!Mi),Mr=Mr&&(mo||!ri),this.placements[si]=new ti(dn||fr,Jn||Mr,gn||O.justReloaded),h.add(si)},mi=this.retainedQueryData[O.bucketInstanceId].tileID;if(O.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(O,mi),O.elevationType==="road"&&O.updateRoadElevation(mi.canonical),O.updateZOffset(),O.sortFeaturesByY){const Hr=O.getSortedSymbolIndexes(this.transform.angle);for(let Mn=Hr.length-1;Mn>=0;--Mn){const sn=Hr[Mn];Dn(O.symbolInstances.get(sn),sn,O.collisionArrays[sn])}O.hasAnyZOffset&&i.w(`${O.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(O.hasAnyZOffset){const Hr=O.getSortedIndexesByZOffset();for(let Mn=0;Mn<Hr.length;++Mn){const sn=Hr[Mn];Dn(O.symbolInstances.get(sn),sn,O.collisionArrays[sn])}}else for(let Hr=s.symbolInstanceStart;Hr<s.symbolInstanceEnd;Hr++)Dn(O.symbolInstances.get(Hr),Hr,O.collisionArrays[Hr]);if(v&&O.bucketInstanceId in this.collisionCircleArrays){const Hr=this.collisionCircleArrays[O.bucketInstanceId];i.bk(Hr.invProjMatrix,G),Hr.viewportMatrix=this.collisionIndex.getViewportMatrix()}O.justReloaded=!1}markUsedJustification(s,h,v,w){const{leftJustifiedTextSymbolIndex:P,centerJustifiedTextSymbolIndex:O,rightJustifiedTextSymbolIndex:L,verticalPlacedTextSymbolIndex:z,crossTileID:G}=v,H=i.c2(h),Q=w===i.bK.vertical?z:H==="left"?P:H==="center"?O:H==="right"?L:-1;P>=0&&(s.text.placedSymbolArray.get(P).crossTileID=Q>=0&&P!==Q?0:G),O>=0&&(s.text.placedSymbolArray.get(O).crossTileID=Q>=0&&O!==Q?0:G),L>=0&&(s.text.placedSymbolArray.get(L).crossTileID=Q>=0&&L!==Q?0:G),z>=0&&(s.text.placedSymbolArray.get(z).crossTileID=Q>=0&&z!==Q?0:G)}markUsedOrientation(s,h,v){const w=h===i.bK.horizontal||h===i.bK.horizontalOnly?h:0,P=h===i.bK.vertical?h:0,{leftJustifiedTextSymbolIndex:O,centerJustifiedTextSymbolIndex:L,rightJustifiedTextSymbolIndex:z,verticalPlacedTextSymbolIndex:G}=v,H=s.text.placedSymbolArray;O>=0&&(H.get(O).placedOrientation=w),L>=0&&(H.get(L).placedOrientation=w),z>=0&&(H.get(z).placedOrientation=w),G>=0&&(H.get(G).placedOrientation=P)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let v=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const w=h?h.symbolFadeChange(s):1,P=h?h.opacities:{},O=h?h.variableOffsets:{},L=h?h.placedOrientations:{};for(const z in this.placements){const G=this.placements[z],H=P[z];H?(this.opacities[z]=new Vn(H,w,G.text,G.icon,null,G.clipped),v=v||G.text!==H.text.placed||G.icon!==H.icon.placed):(this.opacities[z]=new Vn(null,w,G.text,G.icon,G.skipFade,G.clipped),v=v||G.text||G.icon)}for(const z in P){const G=P[z];if(!this.opacities[z]){const H=new Vn(G,w,!1,!1);H.isHidden()||(this.opacities[z]=H,v=v||G.text.placed||G.icon.placed)}}for(const z in O)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=O[z]);for(const z in L)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=L[z]);v?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h,v,w){const P=new Set;for(const O of h){const L=O.getBucket(s);L&&O.latestFeatureIndex&&s.fqid===L.layerIds[0]&&(this.updateBucketOpacities(L,P,O,O.collisionBoxArray,v,w,O.tileID,s.scope),L.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(L,O.tileID),L.elevationType==="road"&&L.updateRoadElevation(O.tileID.canonical),L.updateZOffset())}}updateBucketOpacities(s,h,v,w,P,O,L,z){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const G=s.layers[0].layout,H=s.layers[0].paint,Q=!!s.layers[0].dynamicFilter(),K=new Vn(null,0,!1,!1,!0),re=G.get("text-allow-overlap"),le=G.get("icon-allow-overlap"),ue=G.get("text-variable-anchor"),_e=G.get("text-rotation-alignment")==="map",ge=G.get("text-pitch-alignment")==="map",Se=H.get("symbol-z-offset"),ke=G.get("symbol-elevation-reference")==="sea",Te=!Se.isConstant(),$e=new Vn(null,0,re&&(le||!s.hasIconData()||G.get("icon-optional")),le&&(re||!s.hasTextData()||G.get("text-optional")),!0);!s.collisionArrays&&w&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(w);const Re=(Be,De,We)=>{for(let lt=0;lt<De/4;lt++)Be.opacityVertexArray.emplaceBack(We)};let Ve=0;O&&s.updateReplacement(L,O);for(let Be=0;Be<s.symbolInstances.length;Be++){const De=s.symbolInstances.get(Be),{numHorizontalGlyphVertices:We,numVerticalGlyphVertices:lt,crossTileID:it,numIconVertices:bt,tileAnchorX:mt,tileAnchorY:Ot}=De;let Zt=null;const pt=this.retainedQueryData[s.bucketInstanceId];Te&&De&&pt&&(Zt=v.latestFeatureIndex.loadFeature({featureIndex:De.featureIndex,bucketIndex:pt.bucketIndex,sourceLayerIndex:pt.sourceLayerIndex,layoutVertexArrayOffset:0}));const et=Se.evaluate(Zt,{}),kt=h.has(it);let gt=this.opacities[it];kt?gt=K:gt||(gt=$e,this.opacities[it]=gt),h.add(it);const Lt=We>0||lt>0,Qt=bt>0,vr=this.placedOrientations[it],Gt=vr===i.bK.vertical,Yt=vr===i.bK.horizontal||vr===i.bK.horizontalOnly;!Lt&&!Qt||gt.isHidden()||Ve++;let br=!1;if((Lt||Qt)&&O)for(const hr of s.activeReplacements){if(i.bY(hr,P,i.bZ.Symbol,z)||hr.min.x>mt||mt>hr.max.x||hr.min.y>Ot||Ot>hr.max.y)continue;const cr=i.b_(mt,Ot,L.canonical,hr.footprintTileId.canonical);if(br=i.b$(cr,hr.footprint),br)break}if(Lt){const hr=br?po:Rg(gt.text);Re(s.text,We,Gt?po:hr),Re(s.text,lt,Yt?po:hr);const cr=gt.text.isHidden(),{leftJustifiedTextSymbolIndex:fr,centerJustifiedTextSymbolIndex:Mr,rightJustifiedTextSymbolIndex:An,verticalPlacedTextSymbolIndex:Dn}=De,mi=s.text.placedSymbolArray,Hr=cr||Gt?1:0;fr>=0&&(mi.get(fr).hidden=Hr),Mr>=0&&(mi.get(Mr).hidden=Hr),An>=0&&(mi.get(An).hidden=Hr),Dn>=0&&(mi.get(Dn).hidden=cr||Yt?1:0);const Mn=this.variableOffsets[it];Mn&&this.markUsedJustification(s,Mn.anchor,De,vr);const sn=this.placedOrientations[it];sn&&(this.markUsedJustification(s,"left",De,sn),this.markUsedOrientation(s,sn,De))}if(Qt){const hr=br?po:Rg(gt.icon),{placedIconSymbolIndex:cr,verticalPlacedIconSymbolIndex:fr}=De,Mr=s.icon.placedSymbolArray,An=gt.icon.isHidden()?1:0;cr>=0&&(Re(s.icon,bt,Gt?po:hr),Mr.get(cr).hidden=An),fr>=0&&(Re(s.icon,De.numVerticalIconVertices,Yt?po:hr),Mr.get(fr).hidden=An)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const hr=s.collisionArrays[Be];if(hr){let cr=new i.P(0,0),fr=!0;if(hr.textBox||hr.verticalTextBox){if(ue){const An=this.variableOffsets[it];An?(cr=Cg(An.anchor,An.width,An.height,An.textOffset,An.textScale),_e&&cr._rotate(ge?this.transform.angle:-this.transform.angle)):fr=!1}Q&&(fr=!gt.clipped),hr.textBox&&wo(s.textCollisionBox.collisionVertexArray,gt.text.placed,!fr||Gt,et,ke,cr.x,cr.y),hr.verticalTextBox&&wo(s.textCollisionBox.collisionVertexArray,gt.text.placed,!fr||Yt,et,ke,cr.x,cr.y)}const Mr=fr&&!!(!Yt&&hr.verticalIconBox);hr.iconBox&&wo(s.iconCollisionBox.collisionVertexArray,gt.icon.placed,Mr,et,ke,De.hasIconTextFit?cr.x:0,De.hasIconTextFit?cr.y:0),hr.verticalIconBox&&wo(s.iconCollisionBox.collisionVertexArray,gt.icon.placed,!Mr,et,ke,De.hasIconTextFit?cr.x:0,De.hasIconTextFit?cr.y:0)}}}if(s.fullyClipped=Ve===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const Be=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=Be.invProjMatrix,s.placementViewportMatrix=Be.viewportMatrix,s.collisionCircleArray=Be.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){const v=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*v>s}setStale(){this.stale=!0}}function wo(y,s,h,v,w,P,O){y.emplaceBack(s?1:0,h?1:0,P||0,O||0,v,w?1:0),y.emplaceBack(s?1:0,h?1:0,P||0,O||0,v,w?1:0),y.emplaceBack(s?1:0,h?1:0,P||0,O||0,v,w?1:0),y.emplaceBack(s?1:0,h?1:0,P||0,O||0,v,w?1:0)}const qa=Math.pow(2,25),GR=Math.pow(2,24),kg=Math.pow(2,17),iw=Math.pow(2,16),Ig=Math.pow(2,9),Uv=Math.pow(2,8),aw=Math.pow(2,1);function Rg(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const s=y.placed?1:0,h=Math.floor(127*y.opacity);return h*qa+s*GR+h*kg+s*iw+h*Ig+s*Uv+h*aw+s}const po=0;class Uu{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,h,v,w,P,O){const L=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(L,w,s[this._currentTileIndex],this._sortAcrossTiles,O),this._currentTileIndex++,P())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,L.sort((z,G)=>z.sortKey-G.sortKey));this._currentPartIndex<L.length;){const z=L[this._currentPartIndex];if(h.placeLayerBucketPart(z,this._seenCrossTileIDs,v,z.symbolInstanceStart===0,O),this._currentPartIndex++,P())return!0}return!1}}class Ds{constructor(s,h,v,w,P,O,L,z,G){this.placement=new Og(s,P,O,L,z,G),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(s,h,v,w,P){const O=i.o.now(),L=()=>{const z=i.o.now()-O;return!this._forceFullPlacement&&z>2};for(;this._currentPlacementIndex>=0;){const z=h[s[this._currentPlacementIndex]],G=this.placement.collisionIndex.transform.zoom;if(z.type==="symbol"&&(!z.minzoom||z.minzoom<=G)&&(!z.maxzoom||z.maxzoom>G)){const H=z,Q=H.layout.get("symbol-z-elevate"),K=H.layout.get("symbol-sort-key").constantOr(1)!==void 0,re=H.layout.get("symbol-z-order"),le=re==="viewport-y"||re==="auto"&&!(re!=="viewport-y"&&K),ue=H.layout.get("text-allow-overlap")||H.layout.get("icon-allow-overlap")||H.layout.get("text-ignore-placement")||H.layout.get("icon-ignore-placement"),_e=le&&ue,ge=this._inProgressLayer=this._inProgressLayer||new Uu(H),Se=i.B(z.source,z.scope);if(ge.continuePlacement(Q||_e?w[Se]:v[Se],this.placement,this._showCollisionBoxes,z,L,P))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const Vv=512/i.al/2;class ep{constructor(s,h,v){this.tileID=s,this.bucketInstanceId=v,this.index=new i.c3(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const w=s.canonical.x*i.al,P=s.canonical.y*i.al;for(let O=0;O<h.length;O++){const{key:L,crossTileID:z,tileAnchorX:G,tileAnchorY:H}=h.get(O),Q=Math.floor((w+G)*Vv),K=Math.floor((P+H)*Vv);this.index.add(Q,K),this.keys.push(L),this.crossTileIDs.push(z)}this.index.finish()}findMatches(s,h,v){const w=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),P=Vv/Math.pow(2,h.canonical.z-this.tileID.canonical.z),O=h.canonical.x*i.al,L=h.canonical.y*i.al;for(let z=0;z<s.length;z++){const G=s.get(z);if(G.crossTileID)continue;const{key:H,tileAnchorX:Q,tileAnchorY:K}=G,re=Math.floor((O+Q)*P),le=Math.floor((L+K)*P),ue=this.index.range(re-w,le-w,re+w,le+w).sort((_e,ge)=>_e-ge);for(const _e of ue){const ge=this.crossTileIDs[_e];if(this.keys[_e]===H&&!v.has(ge)){v.add(ge),G.crossTileID=ge;break}}}}}class co{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class au{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const h=Math.round((s-this.lng)/360);if(h!==0)for(const v in this.indexes){const w=this.indexes[v],P={};for(const O in w){const L=w[O];L.tileID=L.tileID.unwrapTo(L.tileID.wrap+h),P[L.tileID.key]=L}this.indexes[v]=P}this.lng=s}addBucket(s,h,v){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let P=0;P<h.symbolInstances.length;P++)h.symbolInstances.get(P).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);const w=this.usedCrossTileIDs[s.overscaledZ];for(const P in this.indexes){const O=this.indexes[P];if(Number(P)>s.overscaledZ)for(const L in O){const z=O[L];z.tileID.isChildOf(s)&&z.findMatches(h.symbolInstances,s,w)}else{const L=O[s.scaledTo(Number(P)).key];L&&L.findMatches(h.symbolInstances,s,w)}}for(let P=0;P<h.symbolInstances.length;P++){const O=h.symbolInstances.get(P);O.crossTileID||(O.crossTileID=v.generate(),w.add(O.crossTileID))}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new ep(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(const v of h.crossTileIDs)this.usedCrossTileIDs[s].delete(v)}removeStaleBuckets(s){let h=!1;for(const v in this.indexes){const w=this.indexes[v];for(const P in w)s[w[P].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,w[P]),delete w[P],h=!0)}return h}}class Vu{constructor(){this.layerIndexes={},this.crossTileIDs=new co,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,v,w){let P=this.layerIndexes[s.fqid];P===void 0&&(P=this.layerIndexes[s.fqid]=new au);let O=!1;const L={};w.name!=="globe"&&P.handleWrapJump(v);for(const z of h){const G=z.getBucket(s);G&&s.fqid===G.layerIds[0]&&(G.bucketInstanceId||(G.bucketInstanceId=++this.maxBucketInstanceId),P.addBucket(z.tileID,G,this.crossTileIDs)&&(O=!0),L[G.bucketInstanceId]=!0)}return P.removeStaleBuckets(L)&&(O=!0),O}pruneUnusedLayers(s){const h={};s.forEach(v=>{h[v]=!0});for(const v in this.layerIndexes)h[v]||delete this.layerIndexes[v]}}const Ta=771;class mn{constructor(s,h,v,w){this.blendFunction=s,this.blendColor=h.toNonPremultipliedRenderColor(null),this.mask=v,this.blendEquation=w}}mn.Replace=[1,0,1,0],mn.disabled=new mn(mn.Replace,i.ao.transparent,[!1,!1,!1,!1]),mn.unblended=new mn(mn.Replace,i.ao.transparent,[!0,!0,!0,!0]),mn.alphaBlended=new mn([1,Ta,1,Ta],i.ao.transparent,[!0,!0,!0,!0]),mn.alphaBlendedNonPremultiplied=new mn([770,Ta,770,Ta],i.ao.transparent,[!0,!0,!0,!0]),mn.multiply=new mn([774,0,774,0],i.ao.transparent,[!0,!0,!0,!0]),mn.additive=new mn([1,1,1,1],i.ao.transparent,[!0,!0,!0,!0]);class Sr{constructor(s,h,v){this.func=s,this.mask=h,this.range=v}}Sr.ReadOnly=!1,Sr.ReadWrite=!0,Sr.disabled=new Sr(519,Sr.ReadOnly,[0,1]);const Vh=7680;class Yr{constructor(s,h,v,w,P,O){this.test=s,this.ref=h,this.mask=v,this.fail=w,this.depthFail=P,this.pass=O}}Yr.disabled=new Yr({func:519,mask:0},0,0,Vh,Vh,Vh);const tp=1029,qv=2305;class Gr{constructor(s,h,v){this.enable=s,this.mode=h,this.frontFace=v}}function jg(y,s){const h=i.c9(y,3);i.cb(y,s),i.cf(y,3,h)}function Wv(y,s){const h=i.c6([]);return i.c7(h,h,-s),i.c8(h,h,-y),h}function p2(y,s){const h=[y[0],y[1],0],v=[s[0],s[1],0];if(i.ag(h)>=1e-15){const O=i.aw([],h);i.c4(v,O,i.bI(v,O)),s[0]=v[0],s[1]=v[1]}const w=i.bH([],s,y);if(i.c5(w)<1e-15)return null;const P=Math.atan2(-w[1],w[0]);return Wv(Math.atan2(Math.sqrt(y[0]*y[0]+y[1]*y[1]),-y[2]),P)}Gr.disabled=new Gr(!1,tp,qv),Gr.backCCW=new Gr(!0,tp,qv),Gr.backCW=new Gr(!0,tp,2304),Gr.frontCW=new Gr(!0,1028,2304),Gr.frontCCW=new Gr(!0,1028,qv);class ou{constructor(s,h){this.position=s,this.orientation=h}get position(){return this._position}set position(s){if(s){const h=s instanceof i.ae?s:new i.ae(s[0],s[1],s[2]);this._renderWorldCopies&&(h.x=i.bS(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(s,h,v){if(this.orientation=null,!this.position)return;const w=this.position,P=v||(this._elevation?this._elevation.getAtPointOrZero(i.ae.fromLngLat(s)):0),O=i.ae.fromLngLat(s,P),L=[O.x-w.x,O.y-w.y,O.z-w.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=p2(L,h)}setPitchBearing(s,h){this.orientation=Wv(i.an(s),i.an(-h))}}class Gv{constructor(s,h){this._transform=i.bz([]),this.orientation=h,this.position=s}get mercatorPosition(){const s=this.position;return new i.ae(s[0],s[1],s[2])}get position(){const s=i.c9(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var h;s&&i.cf(this._transform,3,[(h=s)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||i.c6([]),s&&jg(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,h){this._orientation=Wv(s,h),jg(this._transform,this._orientation)}forward(){const s=i.c9(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=i.c9(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=i.c9(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,h){const v=new Float64Array(16);return i.bk(v,this.getWorldToCamera(s,h)),v}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(s,h,v){const w=this.position;i.c4(w,w,-s);const P=new Float64Array(16);return i.bp(P,[v,v,v]),i.bq(P,P,w),P[10]*=h,P}getWorldToCamera(s,h){const v=new Float64Array(16),w=new Float64Array(4),P=this.position;return i.ca(w,this._orientation),i.c4(P,P,-s),i.cb(v,w),i.bq(v,v,P),v[1]*=-1,v[5]*=-1,v[9]*=-1,v[13]*=-1,v[8]*=h,v[9]*=h,v[10]*=h,v[11]*=h,v}getCameraToClipPerspective(s,h,v,w){const P=new Float64Array(16);return i.cc(P,s,h,v,w),P}getCameraToClipOrthographic(s,h,v,w,P,O){const L=new Float64Array(16);return i.cd(L,s,h,v,w,P,O),L}getDistanceToElevation(s,h=!1){const v=s===0?0:i.ce(s,h?i.a_(this.position[1]):this.position[1]),w=this.forward();return(v-this.position[2])/w[2]}clone(){return new Gv([...this.position],[...this.orientation])}}const So={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class os{constructor(s=0,h=0,v=0,w=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(v)||v<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=v,this.right=w}interpolate(s,h,v){return h.top!=null&&s.top!=null&&(this.top=i.ak(s.top,h.top,v)),h.bottom!=null&&s.bottom!=null&&(this.bottom=i.ak(s.bottom,h.bottom,v)),h.left!=null&&s.left!=null&&(this.left=i.ak(s.left,h.left,v)),h.right!=null&&s.right!=null&&(this.right=i.ak(s.right,h.right,v)),this}getCenter(s,h){const v=i.aA((this.left+s-this.right)/2,0,s),w=i.aA((this.top+h-this.bottom)/2,0,h);return new i.P(v,w)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new os(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const qh=15;class rp{constructor(s,h,v,w,P,O,L){this.tileSize=512,this._renderWorldCopies=P===void 0||P,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=v??0,this._maxPitch=w??60,this.setProjection(O),this.setMaxBounds(L),this.width=0,this.height=0,this._center=new i.aS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new os,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Gv,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const s=new rp(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s._allowWorldUnderZoom=this._allowWorldUnderZoom,s}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<qh}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(s,h=!1){const v=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||v)&&this._updateCameraOnTerrain(),(s||v)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return i.aH(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=i.cl(this.projectionOptions);const v=this.getProjection(),w=!i.bx(h,v);return w&&this._calcMatrices(),this.mercatorFromTransition=!1,w}setOrthographicProjectionAtLowPitch(s){return this._orthographicProjectionAtLowPitch!==s&&(this._orthographicProjectionAtLowPitch=s,this._calcMatrices(),!0)}setMercatorFromTransition(){const s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.cl({name:"mercator"});const h=s!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bS(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const h=-s*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=i.cm(),i.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const h=i.aA(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=i.an(s),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){const h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(s){this._tileCoverLift!==s&&(this._tileCoverLift=s)}_updateCameraOnTerrain(){const s=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&s===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||s===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const v=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&v.exaggeration()&&this._centerAltitudeValidForExaggeration!==v.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*v.exaggeration(),this._centerAltitudeValidForExaggeration=v.exaggeration()):(this._centerAltitude=s||0,this._centerAltitudeValidForExaggeration=v.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const s=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(s)}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],v=this.horizonLineFromTop();let w=0,P=0;for(let O=0;O<h.length;O++){const L=new i.P(h[O][0]*this.width,v+h[O][1]*(this.height-v)),z=s.pointCoordinate(L);if(!z)continue;const G=1/Math.hypot(z[0]-this._camera.position[0],z[1]-this._camera.position[1]);w+=z[3]*G,P+=G}return P===0?NaN:w/P}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const s=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),v=this.pixelsPerMeter/this.worldSize*h,w=this._mercatorZfromZoom(s),P=this._mercatorZfromZoom(this._maxZoom),O=Math.max(w-v,P);this._setZoom(this._zoomFromMercatorZ(O))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let v;v=s.z<this._camera.position[2]?[h.x,h.y,h.z]:[s.x,s.y,s.z];const w=i.ag(i.av([],this._camera.position,v));return i.aA(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let h=!1;if(s.orientation&&!i.co(s.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(s.orientation)),s.position){const v=[s.position.x,s.position.y,s.position.z];i.cp(v,this._camera.position)||(this._setCameraPosition(v),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,h=new ou;return h.position=new i.ae(s[0],s[1],s[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(s){if(!i.cq(s))return!1;i.cr(s,s);const h=i.cs([],[0,0,-1],s),v=i.cs([],[0,-1,0],s);if(v[2]<0)return!1;const w=p2(h,v);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(s){const h=this.zoomScale(this.minZoom)*this.tileSize,v=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;s[2]=i.aA(s[2],w/v,w/h),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,v){this._unmodified=!1,this._edgeInsets.interpolate(s,h,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){const h=[new i.ct(0,s)];if(this.renderWorldCopies){const v=this.pointCoordinate(new i.P(0,0)),w=this.pointCoordinate(new i.P(this.width,0)),P=this.pointCoordinate(new i.P(this.width,this.height)),O=this.pointCoordinate(new i.P(0,this.height)),L=Math.floor(Math.min(v.x,w.x,P.x,O.x)),z=Math.floor(Math.max(v.x,w.x,P.x,O.x)),G=1;for(let H=L-G;H<=z+G;H++)H!==0&&h.push(new i.ct(H,s))}return h}isLODDisabled(s){return(!s||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(s,h,v){let w=[];const P=v!=null,O=!P;if(O&&this.zoom<h||P&&v[0]===0&&v[1]===0)return w;const L=new Set,z=(H,Q,K,re,le)=>{const ue=i.cX(Q,H,K,re,le);L.has(ue)||(w.push(new i.aP(H,Q,K,re,le)),L.add(ue))};for(let H=0;H<s.length;H++){const Q=s[H];if(O&&Q.canonical.z!==h)continue;const K=Q.canonical,re=Q.overscaledZ,le=Q.wrap,ue=1<<K.z,_e=K.x+1<ue,ge=K.x>0,Se=K.y+1<ue,ke=K.y>0,Te=Q.wrap-(ge?0:1),$e=Q.wrap+(_e?0:1),Re=ge?K.x-1:ue-1,Ve=_e?K.x+1:0;if(P)v[0]<0?(z(re,$e,K.z,Ve,K.y),v[1]<0&&Se&&(z(re,le,K.z,K.x,K.y+1),z(re,$e,K.z,Ve,K.y+1)),v[1]>0&&ke&&(z(re,le,K.z,K.x,K.y-1),z(re,$e,K.z,Ve,K.y-1))):v[0]>0?(z(re,Te,K.z,Re,K.y),v[1]<0&&Se&&(z(re,le,K.z,K.x,K.y+1),z(re,Te,K.z,Re,K.y+1)),v[1]>0&&ke&&(z(re,le,K.z,K.x,K.y-1),z(re,Te,K.z,Re,K.y-1))):v[1]<0&&Se?z(re,le,K.z,K.x,K.y+1):ke&&z(re,le,K.z,K.x,K.y-1);else{const Be=Q.visibleQuadrants;1&Be&&(z(re,Te,K.z,Re,K.y),ke&&(z(re,le,K.z,K.x,K.y-1),z(re,Te,K.z,Re,K.y-1))),2&Be&&(z(re,$e,K.z,Ve,K.y),ke&&(z(re,le,K.z,K.x,K.y-1),z(re,$e,K.z,Ve,K.y-1))),4&Be&&(z(re,Te,K.z,Re,K.y),Se&&(z(re,le,K.z,K.x,K.y+1),z(re,Te,K.z,Re,K.y+1))),8&Be&&(z(re,$e,K.z,Ve,K.y),Se&&(z(re,le,K.z,K.x,K.y+1),z(re,$e,K.z,Ve,K.y+1)))}}const G=[];for(const H of w)w.some(Q=>H.isChildOf(Q))||G.push(H);if(w=G.filter(H=>!s.some(Q=>!!(H.overscaledZ<h&&Q.isChildOf(H))||H.equals(Q)||H.isChildOf(Q))),O){const H=1<<h,Q=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=[H*Q.x,H*Q.y],re=4,le=re*re;w=w.filter(ue=>{const _e=ue.canonical.x+.5-K[0],ge=ue.canonical.y+.5-K[1];return _e*_e+ge*ge<le})}return w}extendTileCoverToNearPlane(s,h,v){const w=[],P=new Set;for(const Se of s)P.add(Se.key);const O=(Se,ke,Te,$e,Re)=>{const Ve=i.cX(ke,Se,Te,$e,Re);P.has(Ve)||(w.push(new i.aP(Se,ke,Te,$e,Re)),P.add(Ve))},L=s.reduce((Se,ke)=>Math.max(Se,ke.overscaledZ),v),z=1<<v,G=[new i.P(0,0),new i.P(i.al,0),new i.P(i.al,i.al),new i.P(0,i.al)],H=new i.P(0,0),Q=new i.P(0,0),K=(Se,ke)=>{const Te=Math.floor(Se[0]),$e=Math.floor(Se[1]),Re=(Se[0]-Te)*i.al,Ve=(Se[1]-$e)*i.al,Be=Math.floor(ke[0]),De=Math.floor(ke[1]),We=(ke[0]-Be)*i.al,lt=(ke[1]-De)*i.al;for(let it=-1;it<=1;it++){const bt=Te+it;if(!(bt<0||bt>=z)){H.x=Re-it*i.al,Q.x=We-(bt-Be)*i.al;for(let mt=-1;mt<=1;mt++){const Ot=$e+mt;H.y=Ve-mt*i.al,Q.y=lt-(Ot-De)*i.al,i.cY(H,Q,G)&&O(L,0,v,bt,Ot)}}}},re=h.points,le=re[i.cu],ue=re[i.cv],_e=this._projectToGround(le,re[i.cw]),ge=this._projectToGround(ue,re[i.cx]);return K(le,_e),K(ue,ge),w}_projectToGround(s,h){return i.cy(i.cz(),s,h,s[2]/(s[2]-h[2]))}coveringTiles(s){let h=this.coveringZoomLevel(s);const v=h,w=this.elevation&&this.elevation.exaggeration(),P=w&&!s.isTerrainDEM,O=this.projection.name==="mercator";if(s.minzoom!==void 0&&h<s.minzoom)return[];s.maxzoom!==void 0&&h>s.maxzoom&&(h=s.maxzoom);const L=this.locationCoordinate(this.center),z=this.center.lat,G=1<<h,H=[G*L.x,G*L.y,0],Q=this.projection.name==="globe",K=!Q,re=i.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,K),le=Q?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ue=G*i.ce(1,this.center.lat),_e=this._camera.position[2]/i.ce(1,this.center.lat),ge=[G*le.x,G*le.y,_e*(K?1:ue)],Se=Q||w,ke=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),Te=this.isLODDisabled(!0)?h:0;let $e;if(this._elevation&&s.isTerrainDEM)$e=1e4*this._elevation.exaggeration();else if(this._elevation){const et=this._elevation.getMinMaxForVisibleTiles();$e=et?et.max:this._centerAltitude}else $e=this._centerAltitude;const Re=s.isTerrainDEM?-$e:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ve=this.projection.isReprojectedInTileSpace?i.cB(this):1,Be=et=>{const gt=new i.ae(et.x+25e-6,et.y,et.z),Lt=new i.ae(et.x,et.y+25e-6,et.z),Qt=et.toLngLat(),vr=gt.toLngLat(),Gt=Lt.toLngLat(),Yt=this.locationCoordinate(Qt),br=this.locationCoordinate(vr),hr=this.locationCoordinate(Gt),cr=Math.hypot(br.x-Yt.x,br.y-Yt.y),fr=Math.hypot(hr.x-Yt.x,hr.y-Yt.y);return Math.sqrt(cr*fr)*Ve/25e-6},De=et=>{const kt=$e,gt=Re;return{aabb:i.cE(this,G,0,0,0,et,gt,kt,this.projection),zoom:0,x:0,y:0,minZ:gt,maxZ:kt,wrap:et,fullyVisible:!1}},We=[];let lt=[];const it=h,bt=s.reparseOverscaled?v:h,mt=(_e-this._centerAltitude)*ue,Ot=et=>{if(!this._elevation||!et.tileID||!O)return;const kt=this._elevation.getMinMaxForTile(et.tileID),gt=et.aabb;kt?(gt.min[2]=kt.min,gt.max[2]=kt.max,gt.center[2]=(gt.min[2]+gt.max[2])/2):(et.shouldSplit=pt(et),et.shouldSplit||(gt.min[2]=gt.max[2]=gt.center[2]=this._centerAltitude))},Zt=(et,kt)=>{if(.707*kt<et)return 1;const gt=kt/et;return gt/(1.4144271570014144+(Math.pow(1.1,gt-1.4144271570014144+1)-1)/(1.1-1)-1)},pt=et=>{if(et.zoom<Te)return!0;if(et.zoom===it)return!1;if(et.shouldSplit!=null)return et.shouldSplit;const kt=et.aabb.distanceX(ge),gt=et.aabb.distanceY(ge);let Lt=mt,Qt=1;if(Q){Lt=et.aabb.distanceZ(ge);const fr=Math.pow(2,et.zoom),Mr=i.a_((et.y+1)/fr),An=i.a_(et.y/fr),Dn=Math.min(Math.max(z,Mr),An),mi=i.d0(Dn)/i.d0(z);if(Qt=Dn===z?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,mi/this._mercatorScaleRatio),this.zoom<=i.cZ&&et.zoom===it-1&&mi>=.9)return!0}else if(P&&(Lt=et.aabb.distanceZ(ge)*ue),this.projection.isReprojectedInTileSpace&&v<=5){const fr=Math.pow(2,et.zoom),Mr=Be(new i.ae((et.x+.5)/fr,(et.y+.5)/fr));Qt=Mr>.85?1:Mr}if(!O&&!Q){const fr=Math.sqrt(kt*kt+gt*gt+Lt*Lt);let Mr=(1<<it-et.zoom)*ke*Qt;return Mr*=Zt(Math.max(Lt,mt),fr),fr<Mr}let vr=Number.MAX_VALUE,Gt=0;const Yt=et.aabb.getCorners(),br=[];for(const fr of Yt){i.av(br,fr,ge),Q||(P?br[2]*=ue:br[2]=mt);const Mr=i.bI(br,this._camera.forward());Mr<vr&&(vr=Mr,Gt=Math.abs(br[2]))}let hr=(1<<it-et.zoom)*ke*Qt;if(hr*=Zt(Math.max(Gt,mt),vr),vr<hr)return!0;const cr=et.aabb.closestPoint(H);return cr[0]===H[0]&&cr[1]===H[1]};if(this.renderWorldCopies)for(let et=1;et<=3;et++)We.push(De(-et)),We.push(De(et));for(We.push(De(0));We.length>0;){const et=We.pop(),kt=et.x,gt=et.y;let Lt=et.fullyVisible;const Qt=()=>this.projection.name==="globe"&&(et.y===0||et.y===(1<<et.zoom)-1);if(!Lt){let vr=Se?et.aabb.intersects(re):et.aabb.intersectsFlat(re);if(vr===0&&Qt()){const Gt=new i.cC(et.zoom,kt,gt);vr=i.cD(this,G,Gt,!0).intersects(re)}if(vr===0)continue;Lt=vr===2}if(et.zoom!==it&&pt(et))for(let vr=0;vr<4;vr++){const Gt=(kt<<1)+vr%2,Yt=(gt<<1)+(vr>>1),br={aabb:O?et.aabb.quadrant(vr):i.cE(this,G,et.zoom+1,Gt,Yt,et.wrap,et.minZ,et.maxZ,this.projection),zoom:et.zoom+1,x:Gt,y:Yt,wrap:et.wrap,fullyVisible:Lt,tileID:void 0,shouldSplit:void 0,minZ:et.minZ,maxZ:et.maxZ};P&&!Q&&(br.tileID=new i.aP(et.zoom+1===it?bt:et.zoom+1,et.wrap,et.zoom+1,Gt,Yt),Ot(br)),We.push(br)}else{const vr=et.zoom===it?bt:et.zoom;if(s.minzoom&&s.minzoom>vr)continue;let Gt=0;if(!Lt){let cr=Se?et.aabb.intersectsPrecise(re):et.aabb.intersectsPreciseFlat(re);if(cr===0&&Qt()){const fr=new i.cC(et.zoom,kt,gt);cr=i.cD(this,G,fr,!0).intersectsPrecise(re)}if(cr===0)continue;if(s.calculateQuadrantVisibility)if(re.containsPoint(et.aabb.center))Gt=15;else for(let fr=0;fr<4;fr++)et.aabb.quadrant(fr).intersects(re)!==0&&(Gt|=1<<fr)}const Yt=H[0]-(.5+kt+(et.wrap<<et.zoom))*(1<<h-et.zoom),br=H[1]-.5-gt,hr=et.tileID?et.tileID:new i.aP(vr,et.wrap,et.zoom,kt,gt);s.calculateQuadrantVisibility&&(hr.visibleQuadrants=Gt),lt.push({tileID:hr,distanceSq:Yt*Yt+br*br})}}if(this.fogCullDistSq){const et=this.fogCullDistSq,kt=this.horizonLineFromTop();lt=lt.filter(gt=>{const Lt=[0,0,0,1],Qt=[i.al,i.al,0,1],vr=this.calculateFogTileMatrix(gt.tileID.toUnwrapped());i.aC(Lt,Lt,vr),i.aC(Qt,Qt,vr);const Gt=i.cF([],Lt,Qt),Yt=i.cG([],Lt,Qt),br=i.c_(Gt,Yt);if(br===0)return!0;let hr=!1;const cr=this._elevation;if(cr&&br>et&&kt!==0){const fr=this.calculateProjMatrix(gt.tileID.toUnwrapped());let Mr;s.isTerrainDEM||(Mr=cr.getMinMaxForTile(gt.tileID)),Mr||(Mr={min:Re,max:$e});const An=i.cH(this.rotation),Dn=[An[0]*i.al,An[1]*i.al,Mr.max];i.af(Dn,Dn,fr),hr=(1-Dn[1])*this.height*.5<kt}return br<et||hr})}return lt.sort((et,kt)=>et.distanceSq-kt.distanceSq).map(et=>et.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log2(s)}project(s){const h=i.aA(s.lat,-i.cI,i.cI),v=this.projection.project(s.lng,h);return new i.P(v.x*this.worldSize,v.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,h){let v,w;const P=this.centerPoint;if(this.projection.name==="globe"){const L=this.worldSize;v=(h.x-P.x)/L,w=(h.y-P.y)/L}else{const L=this.pointCoordinate(h),z=this.pointCoordinate(P);v=L.x-z.x,w=L.y-z.y}const O=this.locationCoordinate(s);this.setLocation(new i.ae(O.x-v,O.y-w))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s,h){return this.projection.locationPoint(this,s,h)}locationPoint3D(s,h){return this.projection.locationPoint(this,s,h,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s,h){return this.coordinateLocation(this.pointCoordinate3D(s,h))}locationCoordinate(s,h){const v=h?i.ce(h,s.lat):void 0,w=this.projection.project(s.lng,s.lat);return new i.ae(w.x,w.y,v)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,h){const v=h??this._centerAltitude,w=[s.x,s.y,0,1],P=[s.x,s.y,1,1];i.aC(w,w,this.pixelMatrixInverse),i.aC(P,P,this.pixelMatrixInverse);const O=P[3];i.cJ(w,w,1/w[3]),i.cJ(P,P,1/O);const L=w[2],z=P[2];return{p0:w,p1:P,t:L===z?0:(v-L)/(z-L)}}screenPointToMercatorRay(s){const h=[s.x,s.y,0,1],v=[s.x,s.y,1,1];return i.aC(h,h,this.pixelMatrixInverse),i.aC(v,v,this.pixelMatrixInverse),i.cJ(h,h,1/h[3]),i.cJ(v,v,1/v[3]),h[2]=i.ce(h[2],this._center.lat)*this.worldSize,v[2]=i.ce(v[2],this._center.lat)*this.worldSize,i.cJ(h,h,1/this.worldSize),i.cJ(v,v,1/this.worldSize),new i.ax([h[0],h[1],h[2]],i.aw([],i.av([],v,h)))}rayIntersectionCoordinate(s){const{p0:h,p1:v,t:w}=s,P=i.ce(h[2],this._center.lat),O=i.ce(v[2],this._center.lat);return new i.ae(i.ak(h[0],v[0],w)/this.worldSize,i.ak(h[1],v[1],w)/this.worldSize,i.ak(P,O,w))}pointCoordinate(s,h=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,h)}pointCoordinate3D(s,h){if(!this.elevation)return this.pointCoordinate(s,h);let v=this.projection.pointCoordinate3D(this,s.x,s.y);if(v)return new i.ae(v[0],v[1],v[2]);let w=0,P=this.horizonLineFromTop();if(s.y>P)return this.pointCoordinate(s,h);const O=.02*P,L=s.clone();for(let z=0;z<10&&P-w>O;z++){L.y=i.ak(w,P,.66);const G=this.projection.pointCoordinate3D(this,L.x,L.y);G?(P=L.y,v=G):w=L.y}return v?new i.ae(v[0],v[1],v[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=i.cK)return!this.isPointAboveHorizon(s);const h=this.pointCoordinate(s);return h.y>=0&&h.y<=1}_coordinatePoint(s,h){const v=h&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,w=[s.x*this.worldSize,s.y*this.worldSize,v+s.toAltitude(),1];return i.aC(w,w,this.pixelMatrix),w[3]>0?new i.P(w[0]/w[3],w[1]/w[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:s,left:h}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,P=this.pointLocation3D(new i.P(h,s)),O=this.pointLocation3D(new i.P(w,s)),L=this.pointLocation3D(new i.P(w,v)),z=this.pointLocation3D(new i.P(h,v));let G=Math.min(P.lng,O.lng,L.lng,z.lng),H=Math.max(P.lng,O.lng,L.lng,z.lng),Q=Math.min(P.lat,O.lat,L.lat,z.lat),K=Math.max(P.lat,O.lat,L.lat,z.lat);const re=Math.pow(2,-this.zoom)/16*270,le=this.projection.name==="globe"?1:4,ue=(_e,ge,Se,ke,Te)=>{const $e=(_e+Se)/2,Re=(ge+ke)/2,Ve=new i.P($e,Re),{lng:Be,lat:De}=this.pointLocation3D(Ve),We=Math.max(0,G-Be,Q-De,Be-H,De-K);G=Math.min(G,Be),H=Math.max(H,Be),Q=Math.min(Q,De),K=Math.max(K,De),(Te<le||We>re)&&(ue(_e,ge,$e,Re,Te+1),ue($e,Re,Se,ke,Te+1))};if(ue(h,s,w,s,1),ue(w,s,w,v,1),ue(w,v,h,v,1),ue(h,v,h,s,1),this.projection.name==="globe"){const[_e,ge]=i.cL(this);_e?(K=90,H=180,G=-180):ge&&(Q=-90,H=180,G=-180)}return new i.aI(new i.aS(G,Q),new i.aS(H,K))}_getBoundsRectangular(s,h){const{top:v,left:w}=this._edgeInsets,P=this.height-this._edgeInsets.bottom,O=this.width-this._edgeInsets.right,L=new i.P(w,v),z=new i.P(O,v),G=new i.P(O,P),H=new i.P(w,P);let Q=this.pointCoordinate(L,s),K=this.pointCoordinate(z,s);const re=this.pointCoordinate(G,h),le=this.pointCoordinate(H,h),ue=(_e,ge)=>(ge.y-_e.y)/(ge.x-_e.x);return Q.y>1&&K.y>=0?Q=new i.ae((1-le.y)/ue(le,Q)+le.x,1):Q.y<0&&K.y<=1&&(Q=new i.ae(-le.y/ue(le,Q)+le.x,0)),K.y>1&&Q.y>=0?K=new i.ae((1-re.y)/ue(re,K)+re.x,1):K.y<0&&Q.y<=1&&(K=new i.ae(-re.y/ue(re,K)+re.x,0)),new i.aI().extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(le)).extend(this.coordinateLocation(re))}_getBoundsRectangularTerrain(){const s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=s.visibleDemTiles.reduce((v,w)=>{if(w.dem){const P=w.dem.tree;v.min=Math.min(v.min,P.minimums[0]),v.max=Math.max(v.max,P.maximums[0])}return v},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*s.exaggeration(),h.max*s.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,v=this.height/2-h*(1-this._horizonShift);return s?Math.max(0,v):v}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-i.cI,this.maxLat=i.cI,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.aF(this.minLng)*this.tileSize,this.worldMaxX=i.aF(this.maxLng)*this.tileSize,this.worldMinY=i.aJ(this.maxLat)*this.tileSize,this.worldMaxY=i.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,h){return this.projection.createTileMatrix(this,h,s)}calculateDistanceTileData(s){const h=s.key,v=this._distanceTileDataCache;if(v[h])return v[h];const w=s.canonical,P=1/this.height,O=this.cameraWorldSize,L=O/this.zoomScale(w.z),z=(w.x+Math.pow(2,w.z)*s.wrap)*L,G=w.y*L,H=this.point;H.x*=O/this.worldSize,H.y*=O/this.worldSize;const Q=this.angle,K=Math.sin(-Q),re=-Math.cos(-Q);return v[h]={bearing:[K,re],center:[(H.x-z)*P,(H.y-G)*P],scale:L/i.al*P},v[h]}calculateFogTileMatrix(s){const h=s.key,v=this._fogTileMatrixCache;if(v[h])return v[h];const w=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return i.aB(w,this.worldToFogMatrix,w),v[h]=new Float32Array(w),v[h]}calculateProjMatrix(s,h=!1,v=!1){const w=s.key;let P;if(P=v?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,P[w])return P[w];const O=this.calculatePosMatrix(s,this.worldSize);let L;return L=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:v?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,i.aB(O,L,O),P[w]=new Float32Array(O),P[w]}calculatePixelsToTileUnitsMatrix(s){const h=s.tileID.key,v=this._pixelsToTileUnitsCache;if(v[h])return v[h];const w=i.cM(s,this);return v[h]=w,v[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const s=1/this.worldSize,h=i.bp([],[s,s,s]);return i.aB(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const s=this._elevation;this._updateCameraState();const h=i.ce(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(h),w=this._camera.forward(),P=i.ce(1,this._center.lat);v[2]/=P,w[2]/=P,i.aw(w,w);const O=s.raycast(v,w,s.exaggeration());if(O){const L=i.bG([],v,w,O),z=new i.ae(L[0],L[1],i.ce(L[2],i.a_(L[1]))),G=(z.z+i.ag([z.x-v[0],z.y-v[1],z.z-v[2]*P]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(G),this._centerAltitude=z.toAltitude(),this._center=this.coordinateLocation(z),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;const h=this._elevation,v=i.ce(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(v),P=h.getAtPointOrZero(new i.ae(...w)),O=this.pixelsPerMeter/this.worldSize*P,L=this._minimumHeightOverTerrain(),z=w[2]-O;if(z<=L)if(z<0||s){const G=this.locationCoordinate(this._center,this._centerAltitude),H=[w[0],w[1],G.z-w[2]],Q=i.ag(H);H[2]-=(L-z)/this._pixelsPerMercatorPixel;const K=i.ag(H);if(K===0)return;i.c4(H,H,Q/K*this._pixelsPerMercatorPixel),this._camera.position=[w[0],w[1],G.z*this._pixelsPerMercatorPixel-H[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const K=this.center;return K.lat=i.aA(K.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(K.lng=i.aA(K.lng,this.minLng,this.maxLng)),this.center=K,void(this._constraining=!1)}const h=this._unmodified,{x:v,y:w}=this.point;let P=0,O=v,L=w;const z=this.width/2,G=this.height/2,H=this.worldMinY*this.scale,Q=this.worldMaxY*this.scale;if(w-G<H&&(L=H+G),w+G>Q&&(L=Q-G),Q-H<this.height&&(P=Math.max(P,this.height/(Q-H)),L=(Q+H)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const K=this.worldMinX*this.scale,re=this.worldMaxX*this.scale,le=this.worldSize/2-(K+re)/2;O=(v+le+this.worldSize)%this.worldSize-le,O-z<K&&(O=K+z),O+z>re&&(O=re-z),re-K<this.width&&(P=Math.max(P,this.width/(re-K)),O=(re+K)/2)}O===v&&L===w||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(O,L))),P&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(P)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,h=this.projection.name==="globe",v=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.ce(1,this.center.lat)/i.ce(1,i.d1));const w=i.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,w),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const P=this.projection.zAxisUnit==="meters"?v:1,O=this._camera.getWorldToCamera(this.worldSize,P);let L;const z=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(z[8]=2*-s.x/this.width,z[9]=2*s.y/this.height,this.isOrthographic){let De=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),We=De*this.aspect,lt=-We,it=-De;We-=s.x,lt-=s.x,De+=s.y,it+=s.y,L=this._camera.getCameraToClipOrthographic(lt,We,it,De,this._nearZ,this._farZ),((bt,mt,Ot,Zt)=>{for(let pt=0;pt<16;pt++)bt[pt]=i.ak(mt[pt],Ot[pt],Zt)})(L,L,z,i.c$(this.pitch>=qh?1:this.pitch/qh))}else L=z;const G=i.cO([],z,O);let H=i.cO([],L,O);if(this.projection.isReprojectedInTileSpace){const De=this.locationCoordinate(this.center),We=i.bz([]);i.bq(We,We,[De.x*this.worldSize,De.y*this.worldSize,0]),i.aB(We,We,i.cP(this)),i.bq(We,We,[-De.x*this.worldSize,-De.y*this.worldSize,0]),i.aB(H,H,We),i.aB(G,G,We),this.inverseAdjustmentMatrix=i.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.cR([],H,[this.worldSize,this.worldSize,this.worldSize/P,1]),this.projMatrix=H,this.invProjMatrix=i.bk(new Float64Array(16),this.projMatrix),h){const De=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);De[8]=2*-s.x/this.width,De[9]=2*s.y/this.height,this.expandedFarZProjMatrix=i.cO([],De,O)}else this.expandedFarZProjMatrix=this.projMatrix;const Q=i.bk([],L);this.frustumCorners=i.cS.fromInvProjectionMatrix(Q,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);const K=new Float32Array(16);i.bz(K),i.cR(K,K,[1,-1,1]),i.cT(K,K,this._pitch),i.bA(K,K,this.angle);const re=i.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.by(re);const le=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;re[8]=2*-s.x/this.width,re[9]=2*(s.y+le)/this.height,this.skyboxMatrix=i.aB(K,re,K);const ue=this.point,_e=ue.x,ge=ue.y,Se=this.width%2/2,ke=this.height%2/2,Te=Math.cos(this.angle),$e=Math.sin(this.angle),Re=_e-Math.round(_e)+Te*Se+$e*ke,Ve=ge-Math.round(ge)+Te*ke+$e*Se,Be=new Float64Array(H);if(i.bq(Be,Be,[Re>.5?Re-1:Re,Ve>.5?Ve-1:Ve,0]),this.alignedProjMatrix=Be,H=i.bB(),i.cR(H,H,[this.width/2,-this.height/2,1]),i.bq(H,H,[1,-1,0]),this.labelPlaneMatrix=H,H=i.bB(),i.cR(H,H,[1,-1,1]),i.bq(H,H,[-1,-1,0]),i.cR(H,H,[2/this.width,2/this.height,1]),this.glCoordMatrix=H,this.pixelMatrix=i.aB(new Float64Array(16),this.labelPlaneMatrix,G),this._calcFogMatrices(),this._distanceTileDataCache={},H=i.bk(new Float64Array(16),this.pixelMatrix),!H)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=H,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.cU(this);const De=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.af(De,De,O),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=H;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,v=this._camera.position,w=1/this.height/this._pixelsPerMercatorPixel,P=[s,s,h];i.c4(P,P,w),i.c4(v,v,-1),i.cV(v,v,P);const O=i.bB();i.bq(O,O,v),i.cR(O,O,P),this.mercatorFogMatrix=O,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,h,w)}_computeCameraPosition(s){const h=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,v=this._camera.forward(),w=this.point,P=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-s/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-v[0]*P,w.y/this.worldSize-v[1]*P,s/this.worldSize*this._centerAltitude-v[2]*P]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),v=this._camera.position[2],w=s[2];let P=1;this.projection.wrap&&(this.center=this.center.wrap()),w>0&&(P=Math.min((h-v)/w,1)),this._camera.position=i.bG([],this._camera.position,s,P),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,h=this._camera.forward(),{pitch:v,bearing:w}=this._camera.getPitchBearing(),P=i.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,O=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.an(this._maxPitch)),L=Math.max((s[2]-P)/Math.cos(v),O),z=this._zoomFromMercatorZ(L);i.bG(s,s,h,L),this._pitch=i.aA(v,i.an(this.minPitch),i.an(this.maxPitch)),this.angle=i.bS(w,-Math.PI,Math.PI),this._setZoom(i.aA(z,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ae(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,s)*this.tileSize))}zoomFromMercatorZAdjusted(s){let h=0,v=i.cK,w=0,P=1/0;for(;v-h>1e-6&&v>h;){const O=h+.5*(v-h),L=this.tileSize*Math.pow(2,O),z=this.getCameraToCenterDistance(this.projection,O,L),G=this.scaleZoom(z/(Math.max(0,s)*this.tileSize)),H=Math.abs(O-G);H<P&&(P=H,w=O),O<G?h=O:v=O}return w}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,h){const v=Math.min(s.x,h.x),w=Math.max(s.x,h.x),P=Math.min(s.y,h.y),O=Math.max(s.y,h.y);if(P<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const L=[new i.P(v,P),new i.P(w,O),new i.P(v,O),new i.P(w,P)],z=this.renderWorldCopies?-3:0,G=this.renderWorldCopies?4:1;for(const H of L){const Q=this.pointRayIntersection(H);if(Q.t<0)return!0;const K=this.rayIntersectionCoordinate(Q);if(K.x<z||K.y<0||K.x>G||K.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(s,h){const v=i.ag(i.av([],this._camera.position,s)),w=this._zoomFromMercatorZ(v)+h;return v-this._mercatorZfromZoom(w)}getCameraPoint(){if(this.projection.name==="globe"){const s=function([h,v,w],P){const O=[h,v,w,1];i.aC(O,O,P);const L=O[3]=Math.max(O[3],1e-6);return O[0]/=L,O[1]/=L,O[2]/=L,O}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(s[0],s[1])}{const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,s))}}getCameraToCenterDistance(s,h=this.zoom,v=this.worldSize){const w=i.cN(s,h,this.width,this.height,1024),P=s.pixelSpaceConversion(this.center.lat,v,w);let O=.5/Math.tan(.5*this._fov)*this.height*P;return this.isOrthographic&&(O=i.ak(1,O,i.c$(this.pitch>=qh?1:this.pitch/qh))),O}getWorldToCameraMatrix(){const s=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.aB(s,s,this.globeMatrix),s}getFrustum(s){return i.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,this.projection.zAxisUnit==="meters")}}const qu=(y,s)=>{if(s>0&&y.terrain&&i.w("Cutoff is currently disabled on terrain"),s<=0||y.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const h=y.transform,v=Math.max(Math.abs(h._zoom-(y.minCutoffZoom-1)),1),w=h.isLODDisabled(!1)?i.ah(60,45,h.pitch):i.ah(30,15,h.pitch),P=h._farZ-h._nearZ,O=s*h.height,L=((1-(z=w))*h.cameraToCenterDistance+z*(h._farZ+O))*v;var z;return{shouldRenderCutoff:w<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,(L-h._nearZ)/P,(L-O-h._nearZ)/P]}}},Eo={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class HR{constructor(s,h){this.aabb=s,this.lastCascade=h}}class KR{add(s,h){const v=this.receivers[s.key];v!==void 0?(v.aabb.min[0]=Math.min(v.aabb.min[0],h.min[0]),v.aabb.min[1]=Math.min(v.aabb.min[1],h.min[1]),v.aabb.min[2]=Math.min(v.aabb.min[2],h.min[2]),v.aabb.max[0]=Math.max(v.aabb.max[0],h.max[0]),v.aabb.max[1]=Math.max(v.aabb.max[1],h.max[1]),v.aabb.max[2]=Math.max(v.aabb.max[2],h.max[2])):this.receivers[s.key]=new HR(h,null)}clear(){this.receivers={}}get(s){return this.receivers[s.key]}computeRequiredCascades(s,h,v){const w=i.d8.fromPoints(s.points);let P=0;for(const O in this.receivers){const L=this.receivers[O];if(!L||!w.intersectsAabb(L.aabb))continue;L.aabb.min=w.closestPoint(L.aabb.min),L.aabb.max=w.closestPoint(L.aabb.max);const z=L.aabb.getCorners();for(let G=0;G<v.length;G++){let H=!0;for(const Q of z){const K=[Q[0]*h,Q[1]*h,Q[2]];if(i.af(K,K,v[G].matrix),K[0]<-1||K[0]>1||K[1]<-1||K[1]>1){H=!1;break}}if(L.lastCascade=G,P=Math.max(P,G),H)break}}return P+1}}class Ng{constructor(s){this.painter=s,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new KR,this._depthMode=new Sr(s.context.gl.LEQUAL,Sr.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,s.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),s.tp.registerParameter(Eo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),s.tp.registerParameter(Eo,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),s.tp.registerParameter(Eo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),s.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const s of this._cascades)s.texture.destroy(),s.framebuffer.destroy();this._cascades=[]}updateShadowParameters(s,h){const v=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!h||!h.properties)return;const w=h.properties.get("shadow-intensity");if(!h.shadowsEnabled()||w<=0||(this._shadowLayerCount=v.style.order.reduce((le,ue)=>{const _e=v.style._mergedLayers[ue];return le+(_e.hasShadowPass()&&!_e.isHidden(s.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const P=v.context,O=Eo.shadowMapResolution,L=Eo.shadowMapResolution;if(this._cascades.length===0||Eo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let le=0;le<Eo.cascadeCount;++le){const ue=v._shadowMapDebug,_e=P.gl,ge=P.createFramebuffer(O,L,ue,"texture"),Se=new i.T(P,{width:O,height:L,data:null},_e.DEPTH_COMPONENT16);if(ge.depthAttachment.set(Se.texture),ue){const ke=new i.T(P,{width:O,height:L,data:null},_e.RGBA8);ge.colorAttachment.set(ke.texture)}this._cascades.push({framebuffer:ge,texture:Se,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.cA,scale:0})}}this.shadowDirection=m2(h);let z=0;if(s.elevation){const le=s.elevation,ue=[1e4,-1e4];le.visibleDemTiles.filter(_e=>_e.dem).forEach(_e=>{const ge=_e.dem.tree;ue[0]=Math.min(ue[0],ge.minimums[0]),ue[1]=Math.max(ue[1],ge.maximums[0])}),ue[0]!==1e4&&(z=(ue[1]-ue[0])*le.exaggeration())}const G=1.5*s.cameraToCenterDistance,H=3*G,Q=new Float64Array(16);for(let le=0;le<this._cascades.length;++le){const ue=this._cascades[le];let _e=s.height/50,ge=1;Eo.cascadeCount===1?ge=H:le===0?ge=G:(_e=G,ge=H);const[Se,ke]=g2(s,this.shadowDirection,_e,ge,Eo.shadowMapResolution,z);ue.scale=s.scale,ue.matrix=Se,ue.boundingSphereRadius=ke,i.bk(Q,ue.matrix),ue.frustum=i.cA.fromInvProjectionMatrix(Q,1,0,!0),ue.far=ge}const K=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[K].far,this._cascades[K].far],this._uniformValues.u_shadow_intensity=w,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Eo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Eo.shadowMapResolution,this._uniformValues.u_shadowmap_0=So.ShadowMap0,this._uniformValues.u_shadowmap_1=So.ShadowMap0+1,this._groundShadowTiles=v.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const re=v.transform.elevation;for(const le of this._groundShadowTiles){let ue={min:0,max:0};if(re){const _e=re.getMinMaxForTile(le);_e&&(ue=_e)}this.addShadowReceiver(le.toUnwrapped(),ue.min,ue.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(s){this._enabled=s}drawShadowPass(s,h){if(!this.enabled)return;const v=this.painter,w=v.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(v.transform.getFrustum(0),v.transform.worldSize,this._cascades),w.viewport.set([0,0,Eo.shadowMapResolution,Eo.shadowMapResolution]);for(let P=0;P<this._numCascadesToRender;++P){v.currentShadowCascade=P,w.bindFramebuffer.set(this._cascades[P].framebuffer.framebuffer),w.clear({color:i.ao.white,depth:1});for(const O of s.order){const L=s._mergedLayers[O];if(!L.hasShadowPass()||L.isHidden(v.transform.zoom))continue;const z=s.getLayerSourceCache(L),G=z?h[z.id]:void 0;(L.type==="model"||G&&G.length)&&v.renderLayer(v,z,L,G)}}v.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const s=this.painter,h=s.style,v=s.context,w=v.gl,P=h.directionalLight,O=h.ambientLight;if(!P||!O)return;const L=[],z=qu(s,s.longestCutoffRange);z.shouldRenderCutoff&&L.push("RENDER_CUTOFF"),L.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&L.push("NORMAL_OFFSET");const G=rc(h,P,O),H=new Sr(w.LEQUAL,Sr.ReadOnly,s.depthRangeFor3D),Q=new Yr({func:w.EQUAL,mask:255},0,255,w.KEEP,w.KEEP,w.KEEP);for(const K of this._groundShadowTiles){const re=K.toUnwrapped(),le=s.isTileAffectedByFog(K),ue=s.getOrCreateProgram("groundShadow",{defines:L,overrideFog:le});this.setupShadows(re,ue),s.uploadCommonUniforms(v,ue,re,null,z);const _e={u_matrix:s.transform.calculateProjMatrix(re),u_ground_shadow_factor:G};ue.draw(s,w.TRIANGLES,H,Q,mn.multiply,Gr.disabled,_e,"ground_shadow",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments,null,s.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?mn.unblended:mn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(s){const h=this.painter.transform,v=h.calculatePosMatrix(s,h.worldSize);return i.aB(v,this._cascades[this.painter.currentShadowCascade].matrix,v),Float32Array.from(v)}calculateShadowPassMatrixFromMatrix(s){const h=i.by(s);return i.aB(h,this._cascades[this.painter.currentShadowCascade].matrix,s),h}setupShadows(s,h,v){if(!this.enabled)return;const w=this.painter.transform,P=this.painter.context,O=P.gl,L=this._uniformValues,z=new Float64Array(16),G=w.calculatePosMatrix(s,w.worldSize);for(let H=0;H<this._cascades.length;H++)i.aB(z,this._cascades[H].matrix,G),L[H===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(z),P.activeTexture.set(O.TEXTURE0+So.ShadowMap0+H),this._cascades[H].texture.bindExtraParam(O.LINEAR,O.LINEAR,O.CLAMP_TO_EDGE,O.CLAMP_TO_EDGE,O.GREATER);if(this.useNormalOffset=!!v,this.useNormalOffset){const H=i.d6(s.canonical),Q=2/w.tileSize*i.al/Eo.shadowMapResolution,K=Q*this._cascades[0].boundingSphereRadius,re=Q*this._cascades[this._cascades.length-1].boundingSphereRadius,le=(v==="vector-tile"?1:3)*function(ue,_e,ge,Se,ke){const Te=i.aA((ue-22)/-22,0,1);return .125*(1-Te)+4*Te}(w.zoom);L.u_shadow_normal_offset=[H,K*le,re*le],L.u_shadow_bias=[1e-4,.0012,.012]}else L.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(P,L)}setupShadowsFromMatrix(s,h,v=!1){if(!this.enabled)return;const w=this.painter.context,P=w.gl,O=this._uniformValues,L=new Float64Array(16);for(let z=0;z<Eo.cascadeCount;z++)i.aB(L,this._cascades[z].matrix,s),O[z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(L),w.activeTexture.set(P.TEXTURE0+So.ShadowMap0+z),this._cascades[z].texture.bindExtraParam(P.LINEAR,P.LINEAR,P.CLAMP_TO_EDGE,P.CLAMP_TO_EDGE,P.GREATER);if(this.useNormalOffset=v,v){const z=Eo.normalOffset;O.u_shadow_normal_offset=[1,z,z],O.u_shadow_bias=[6e-5,.0012,.012]}else O.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(w,O)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(s,h,v,w){if(w[2]>=0)return{};const P=function(z,G,H){const Q=H/(1<<z.canonical.z);return new i.d8([z.canonical.x*Q+z.wrap*H,z.canonical.y*Q+z.wrap*H,0],[(z.canonical.x+1)*Q+z.wrap*H,(z.canonical.y+1)*Q+z.wrap*H,G])}(s,h,v).getCorners(),O=h/-w[2];w[0]<0?(i.d7(P[0],P[0],[w[0]*O,0,0]),i.d7(P[3],P[3],[w[0]*O,0,0])):w[0]>0&&(i.d7(P[1],P[1],[w[0]*O,0,0]),i.d7(P[2],P[2],[w[0]*O,0,0])),w[1]<0?(i.d7(P[0],P[0],[0,w[1]*O,0]),i.d7(P[1],P[1],[0,w[1]*O,0])):w[1]>0&&(i.d7(P[2],P[2],[0,w[1]*O,0]),i.d7(P[3],P[3],[0,w[1]*O,0]));const L={};return L.vertices=P,L.planes=[Fd(P[1],P[0],P[4]),Fd(P[2],P[1],P[5]),Fd(P[3],P[2],P[6]),Fd(P[0],P[3],P[7])],L}addShadowReceiver(s,h,v){this._receivers.add(s,i.d8.fromTileIdAndHeight(s,h,v))}getMaxCascadeForTile(s){const h=this._receivers.get(s);return h&&h.lastCascade?h.lastCascade:0}}function Fd(y,s,h){const v=i.av([],h,s),w=i.av([],y,s),P=i.bH([],v,w),O=i.ag(P);return O===0?[0,0,1,0]:(i.c4(P,P,1/O),[P[0],P[1],P[2],-i.bI(P,s)])}function m2(y){const s=y.properties.get("direction"),h=i.d3(s.x,s.y,s.z);h[2]=i.aA(h[2],0,75);const v=i.d5([h[0],h[1],h[2]]);return i.d4(v.x,v.y,v.z)}function rc(y,s,h){const v=s.properties.get("color-use-theme")==="none",w=s.properties.get("color"),P=s.properties.get("intensity"),O=s.properties.get("direction"),L=[O.x,O.y,O.z],z=h.properties.get("color-use-theme")==="none",G=h.properties.get("color"),H=h.properties.get("intensity"),Q=Math.max(i.bI([0,0,1],L),0),K=[0,0,0];i.c4(K,G.toPremultipliedRenderColor(z?null:y.getLut(s.scope)).toArray01Linear().slice(0,3),H);const re=[0,0,0];return i.c4(re,w.toPremultipliedRenderColor(v?null:y.getLut(h.scope)).toArray01Linear().slice(0,3),Q*P),i.da([K[0]>0?K[0]/(K[0]+re[0]):0,K[1]>0?K[1]/(K[1]+re[1]):0,K[2]>0?K[2]/(K[2]+re[2]):0])}function g2(y,s,h,v,w,P){const O=y.zoom,L=y.scale,z=y.worldSize,G=1/z,H=y.aspect,Q=Math.sqrt(1+H*H)*Math.tan(.5*y.fovX),K=Q*Q,re=v-h,le=v+h;let ue,_e;K>re/le?(ue=v,_e=v*Q):(ue=.5*le*(1+K),_e=.5*Math.sqrt(re*re+2*(v*v+h*h)*K+le*le*K*K));const ge=y.projection.pixelsPerMeter(y.center.lat,z),Se=y._camera.getCameraToWorldMercator(),ke=[0,0,-ue*G];i.af(ke,ke,Se);let Te=_e*G;const $e=y._edgeInsets;if(!($e.left===0&&$e.top===0&&$e.right===0&&$e.bottom===0||$e.left===$e.right&&$e.top===$e.bottom)){const Lt=y._camera.getWorldToCamera(y.worldSize,y.projection.zAxisUnit==="meters"?ge:1),Qt=y._camera.getCameraToClipPerspective(y._fov,y.width/y.height,h,v);Qt[8]=2*-y.centerOffset.x/y.width,Qt[9]=2*y.centerOffset.y/y.height;const vr=new Float64Array(16);i.cO(vr,Qt,Lt);const Gt=new Float64Array(16);i.bk(Gt,vr);const Yt=i.cA.fromInvProjectionMatrix(Gt,z,O,!0);for(const br of Yt.points){const hr=((Re=br)[0]/=L,Re[1]/=L,Re[2]=i.ce(Re[2],y._center.lat),Re);Te=Math.max(Te,i.c5(i.d9([],ke,hr)))}}var Re;Te*=w/(w-1);const Ve=Math.acos(s[2]),Be=Math.atan2(-s[0],-s[1]),De=new Gv;De.position=ke,De.setPitchBearing(Ve,Be);const We=De.getWorldToCamera(z,ge),lt=Te*z,it=Math.min(y._mercatorZfromZoom(17)*z*-2,-2*lt),bt=De.getCameraToClipOrthographic(-lt,lt,-lt,lt,it,(lt+P*ge)/s[2]),mt=new Float64Array(16);i.aB(mt,bt,We);const Ot=i.d4(Math.floor(1e6*ke[0])/1e6*z,Math.floor(1e6*ke[1])/1e6*z,0),Zt=.5*w,pt=[0,0,0];i.af(pt,Ot,mt),i.c4(pt,pt,Zt);const et=[Math.floor(pt[0]),Math.floor(pt[1]),Math.floor(pt[2])],kt=[0,0,0];i.av(kt,pt,et),i.c4(kt,kt,-1/Zt);const gt=new Float64Array(16);return i.bz(gt),i.bq(gt,gt,kt),i.aB(mt,gt,mt),[mt,lt]}class Hv extends i.E{constructor(s){super(),this.requestManager=s,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(s,h){return i.db(this.requestManager.transformRequest(h,i.R.Model).url).then(v=>{if(!v)return;const w=i.dc(v),P=new i.dd(s,h,void 0,void 0,w);return P.computeBoundsAndApplyParent(),P}).catch(v=>{if(v&&v.status===404)return null;this.fire(new i.y(new Error(`Could not load model ${s} from ${h}: ${v.message}`)))})}load(s,h,v={forceReload:!1}){this.models[h]||(this.models[h]={});const w=Object.keys(s),P=[],O=[];for(const L of w){const z=s[L];this.hasURLBeenRequested(z)&&!v.forceReload||(this.modelByURL[z]={modelId:L,scope:h},P.push(this.loadModel(L,z)),O.push(L)),this.models[h][L]||(this.models[h][L]={model:null,numReferences:1})}this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+O.length,Promise.allSettled(P).then(L=>{for(let z=0;z<L.length;z++){const{status:G}=L[z];if(G==="rejected")continue;const{value:H}=L[z];this.models[h][O[z]]||(this.models[h][O[z]]={model:null,numReferences:1}),this.models[h][O[z]].model=H}this.numModelsLoading[h]-=O.length,this.fire(new i.z("data",{dataType:"style"}))}).catch(L=>{this.fire(new i.y(new Error(`Could not load models: ${L.message}`)))})}isLoaded(){for(const s in this.numModelsLoading)if(this.numModelsLoading[s]>0)return!1;return!0}hasModel(s,h,v={exactIdMatch:!1}){return!!(v.exactIdMatch?this.getModel(s,h):this.getModelByURL(this.modelUris[h][s]))}getModel(s,h){return this.models[h]||(this.models[h]={}),this.models[h][s]?this.models[h][s].model:void 0}getModelByURL(s){if(!s)return null;const h=this.modelByURL[s];return h?this.models[h.scope][h.modelId].model:null}hasModelBeenAdded(s,h){return this.models[h]&&this.models[h][s]!==void 0}getModelURIs(s){return this.modelUris[s]||{}}addModel(s,h,v){this.models[v]||(this.models[v]={}),this.modelUris[v]||(this.modelUris[v]={});const w=this.requestManager.normalizeModelURL(h);if((this.hasModel(s,v,{exactIdMatch:!0})||this.hasModelBeenAdded(s,v))&&this.modelUris[v][s]===w)this.models[v][s].numReferences++;else if(this.hasURLBeenRequested(w)){const{scope:P,modelId:O}=this.modelByURL[w];this.models[P][O].numReferences++}else this.modelUris[v][s]=w,this.load({[s]:this.modelUris[v][s]},v)}addModelURLs(s,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const v=this.modelUris[h];for(const w in s)v[w]=this.requestManager.normalizeModelURL(s[w])}reloadModels(s){this.load(this.modelUris[s],s,{forceReload:!0})}addModelsFromBucket(s,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const v={};for(const w of s)this.hasModel(w,h,{exactIdMatch:!0})||this.hasURLBeenRequested(w)?this.models[h][w].numReferences++:this.modelUris[h][w]&&!this.hasURLBeenRequested(w)?v[w]=this.modelUris[h][w]:!this.hasURLBeenRequested(w)&&i.de(w,!1)&&(this.modelUris[h][w]=this.requestManager.normalizeModelURL(w),v[w]=this.modelUris[h][w]);this.load(v,h)}hasURLBeenRequested(s){return this.modelByURL[s]!==void 0}removeModel(s,h,v=!1,w=!1){if(this.models[h]&&this.models[h][s]&&(this.models[h][s].numReferences--,this.models[h][s].numReferences===0||w)){const P=this.modelUris[h][s];v||delete this.modelUris[h][s],delete this.modelByURL[P];const O=this.models[h][s].model;if(!O)return;delete this.models[h][s],O.destroy()}}destroy(){for(const s of Object.keys(this.models))for(const h of Object.keys(this.models[s])){const v=this.models[s][h].model;delete this.models[s][h],v&&v.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(s){return this.models[s]||(this.models[s]={}),Object.keys(this.models[s])}upload(s,h){this.models[h]||(this.models[h]={});for(const v in this.models[h])this.models[h][v].model&&this.models[h][v].model.upload(s.context)}}const Mg=i.a6.colorTheme,zd=new i.a9({data:new i.aa(Mg.data)});function ZR(y){if(!y.metadata||!y.metadata.content_area)return;const s=i.o.devicePixelRatio,{left:h,top:v,width:w,height:P}=y.metadata.content_area,O=h*s,L=v*s;return[O,L,O+w*s,L+P*s]}function y2(y){if(y)return y.map(([s,h])=>[s*i.o.devicePixelRatio,h*i.o.devicePixelRatio])}class XR{constructor(s,h,v){this.id=s,this.scope=h,this.sourceCache=v,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(s){this.missingRequests.has(s.name)||this.pendingRequests.has(s.name)||this.pendingRequests.add(s.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const s=new Map;if(!this.sourceCache.loaded())return s;const h=this.sourceCache.getVisibleCoordinates();if(h.length===0)return s;const v=this.sourceCache.getSource();if(!(v instanceof lo))return s;const w=h.map(O=>this.sourceCache.getTile(O)),P=v.getImages(w,Array.from(this.pendingRequests));for(const[O,L]of P)s.set(i.I.from({name:O,iconsetId:this.id}),L),this.pendingRequests.delete(O);for(const O of this.pendingRequests)this.missingRequests.add(O);return this.pendingRequests.clear(),s}}const Bd=(y,s)=>fe(y,s&&s.filter(h=>h.identifier!=="source.canvas")),YR=i.aH(Yn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),ow=i.aH(Yn,["setCenter","setZoom","setBearing","setPitch"]),Kv=new Set(["background","sky","slot","custom"]),sw={version:8,layers:[],sources:{}},lw={duration:300,delay:0};class nc extends i.E{constructor(s,h={}){super(),this.map=s,this.scope=h.scope||"",this.globalId=null,this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=Object.assign({},lw),this._buildingIndex=new Yb(this),this.crossTileSymbolIndex=new Vu,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=h.styleChanges||new dr,this.dispatcher=h.dispatcher?h.dispatcher:new i.D(i.dg(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new Jr(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new i.dh(s._requestManager,h.localFontFamily?i.di.all:h.localIdeographFontFamily?i.di.ideographs:i.di.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new Hv(s._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._indoorDependentLayers=h.indoorDependentLayers?h.indoorDependentLayers:new Set,this._config=h.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:h.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=h.initialConfig,this.dispatcher.broadcast("setReferrer",i.dj());const v=this;this._rtlTextPluginCallback=nc.registerForPluginStateChange(w=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(P,O)=>{if(i.dk(P),O&&O.every(L=>L))for(const L in v._sourceCaches){const z=v._sourceCaches[L],G=z.getSource().type;G!=="vector"&&G!=="geojson"||z.reload()}})}),this.on("data",w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const P=this.getOwnSource(w.sourceId);if(P&&P.vectorLayerIds)for(const O in this._layers){const L=this._layers[O];L.source===P.id&&this._validateLayer(L)}})}load(s){return s?(typeof s=="string"?this.loadURL(s):this.loadJSON(s),this):this}_getGlobalId(s){if(!s)return null;if(typeof s=="string"){if(i.h(s))return s;const h=i.dl(s);if(!h.startsWith("http"))try{return new URL(h,location.href).toString()}catch{return h}return h}return`json://${i.dm(JSON.stringify(s))}`}_diffStyle(s,h,v){this.globalId=this._getGlobalId(s);const w=(P,O)=>{try{O(null,this.setState(P,v))}catch(L){O(L,!1)}};if(typeof s=="string"){const P=this.map._requestManager.normalizeStyleURL(s),O=this.map._requestManager.transformRequest(P,i.R.Style);i.m(O,(L,z)=>{L?this.fire(new i.y(L)):z&&w(z,h)})}else typeof s=="object"&&w(s,h)}loadURL(s,h={}){this.fire(new i.z("dataloading",{dataType:"style"}));const v=typeof h.validate=="boolean"?h.validate:!i.h(s);this.globalId=this._getGlobalId(s),s=this.map._requestManager.normalizeStyleURL(s,h.accessToken),this.resolvedImports.add(s);const w=this.importsCache.get(s);if(w)return this._load(w,v);const P=this.map._requestManager.transformRequest(s,i.R.Style);this._request=i.m(P,(O,L)=>{if(this._request=null,O)this.fire(new i.y(O));else if(L)return this.importsCache.set(s,L),this._load(L,v)})}loadJSON(s,h={}){this.fire(new i.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(s),this._request=i.o.frame(()=>{this._request=null,this._load(s,h.validate!==!1)})}loadEmpty(){this.fire(new i.z("dataloading",{dataType:"style"})),this._load(sw,!1)}_loadImports(s,h,v){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const w=[];for(const P of s){const O=this._createFragmentStyle(P),L=new Promise(H=>{O.once("style.import.load",H),O.once("error",H)}).then(()=>this.mergeAll());if(w.push(L),this.resolvedImports.has(P.url)){O.loadEmpty();continue}const z=P.data||this.importsCache.get(P.url);z?(O.loadJSON(z,{validate:h}),this._isInternalStyle(z)&&(O.globalId=null)):P.url?O.loadURL(P.url,{validate:h}):O.loadEmpty();const G={style:O,id:P.id,config:P.config};if(v){const H=this.fragments.findIndex(({id:Q})=>Q===v);this.fragments=this.fragments.slice(0,H).concat(G).concat(this.fragments.slice(H))}else this.fragments.push(G)}return Promise.allSettled(w)}getImportGlobalIds(s=this,h=new Set){for(const v of s.fragments)v.style.globalId&&h.add(v.style.globalId),this.getImportGlobalIds(v.style,h);return[...h.values()]}_createFragmentStyle(s){const h=this.scope?i.B(s.id,this.scope):s.id;let v;const w=this._initialConfig&&this._initialConfig[h];(s.config||w)&&(v=Object.assign({},s.config,w));const P=new nc(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:v,configOptions:this.options,colorThemeOverride:s["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return P.setEventedParent(this.map,{style:P}),P}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(s){return this.isRootStyle()&&(s.fragment||!!s.schema&&s.fragment!==!1)}_load(s,h){if(this._isInternalStyle(s)){const P=Object.assign({},sw,{imports:[{id:"basemap",data:s,url:""}]},s.center?{center:s.center}:{},s.bearing?{bearing:s.bearing}:{},s.pitch?{pitch:s.pitch}:{},s.zoom?{zoom:s.zoom}:{},s.light?{light:s.light}:{});return this._importedAsBasemap=!0,void this._load(P,h)}if(this.updateConfig(this._config,s.schema),h&&Bd(this,Sn(s)))return;this._loaded=!0,this.stylesheet=i.dn(s);const v=()=>{for(const z in s.sources)this.addSource(z,s.sources[z],{validate:!1,isInitialLoad:!0});if(s.iconsets)for(const z in s.iconsets)this.addIconset(z,s.iconsets[z]);s.sprite?this._loadIconset(s.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&s.glyphs&&this.glyphManager.setURL(s.glyphs);const P=Xf(this.stylesheet.layers);if(this._order=P.map(z=>z.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const z=this.stylesheet.lights[0];this.light=new Je(z.properties,z.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Je(this.stylesheet.light)),this._layers={};for(const z of P){const G=i.dt(z,this.scope,this._styleColorTheme.lut,this.options);G.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(G.fqid),G.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(G.fqid),this._hasAppearances=this._hasAppearances||G.getAppearances().length!==0,G.setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G;const H=this.getOwnLayerSourceCache(G),Q=!!this.directionalLight&&this.directionalLight.shadowsEnabled();H&&G.canCastShadows()&&Q&&(H.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const O=this.stylesheet.terrain;O&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(O,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.z("data",{dataType:"style"}));const L=this.isRootStyle();s.imports?this._loadImports(s.imports,h).then(()=>{this._reloadImports(),this.fire(new i.z(L?"style.load":"style.import.load"))}).catch(z=>{this.fire(new i.y(new Error("Failed to load imports",z))),this.fire(new i.z(L?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.z(L?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const w=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(w){const P=this._evaluateColorThemeData(w);this._loadColorTheme(P).then(()=>{v()}).catch(O=>{i.w(`Couldn't load color theme from the stylesheet: ${O}`),v()})}else this._styleColorTheme.lut=null,v()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances}mergeAll(){let s,h,v,w,P,O,L,z,G,H;const Q={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(K=>{if(K.stylesheet){if(K.light!=null&&(s=K.light),K.stylesheet.lights)for(const re of K.stylesheet.lights)re.type==="ambient"&&K.ambientLight!=null&&(h=K.ambientLight),re.type==="directional"&&K.directionalLight!=null&&(v=K.directionalLight);w=this._prioritizeTerrain(w,K.terrain,K.stylesheet.terrain),K.stylesheet.fog&&K.fog!=null&&(P=K.fog),K.stylesheet.snow&&K.snow!=null&&(O=K.snow),K.stylesheet.rain&&K.rain!=null&&(L=K.rain),K.stylesheet.camera!=null&&(H=K.stylesheet.camera),K.stylesheet.projection!=null&&(z=K.stylesheet.projection),K.stylesheet.transition!=null&&(G=K.stylesheet.transition),Q[K.scope]=K._styleColorTheme}}),this.light=s,this.ambientLight=h,this.directionalLight=v,this.fog=P,this.snow=O,this.rain=L,this._styleColorThemeForScope=Q,w===null?delete this.terrain:this.terrain=w,this.camera=H||{"camera-projection":"perspective"},this.projection=z||{name:"mercator"},this.transition=Object.assign({},lw,G),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(s){const h=v=>{for(const w of v.fragments)h(w.style);s(v)};h(this)}_prioritizeTerrain(s,h,v){const w=s&&s.drapeRenderMode===0;return v===null?h&&h.drapeRenderMode===0?h:w?s:null:h!=null&&(!s||w||h&&h.drapeRenderMode===1)?h:s}mergeTerrain(){let s;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{s=this._prioritizeTerrain(s,h.terrain,h.stylesheet.terrain)}),s===null?delete this.terrain:this.terrain=s}mergeProjection(){let s;this.forEachFragmentStyle(h=>{h.stylesheet.projection!=null&&(s=h.stylesheet.projection)}),this.projection=s||{name:"mercator"}}mergeSources(){const s={},h={},v={};this.forEachFragmentStyle(w=>{for(const P in w._sourceCaches){const O=i.B(P,w.scope);s[O]=w._sourceCaches[P]}for(const P in w._otherSourceCaches){const O=i.B(P,w.scope);h[O]=w._otherSourceCaches[P]}for(const P in w._symbolSourceCaches){const O=i.B(P,w.scope);v[O]=w._symbolSourceCaches[P]}}),this._mergedSourceCaches=s,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=v}mergeIndoor(){this.forEachFragmentStyle(s=>{if(s.stylesheet&&s.stylesheet.indoor)for(const h of Object.values(s.stylesheet.indoor)){const v=h,w=i.B(v.sourceId,s.scope);this._mergedIndoor[w]=new Set(v.sourceLayers||[])}})}mergeLayers(){const s={},h=[],v={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(O=>{for(const L of O._order){const z=O._layers[L];if(z.type==="slot"){const G=i.dp(L);if(s[G])continue;s[G]=[]}z.slot&&s[z.slot]?s[z.slot].push(z):h.push(z)}}),this._mergedOrder=[];let w=-1;const P=(O=[])=>{for(const L of O)if(L.type==="slot"){const z=i.dp(L.id);s[z]&&P(s[z]),this._mergedSlots.push(z)}else{const z=i.B(L.id,L.scope);this._mergedOrder.push(z),v[z]=L,L.is3D(!!this.terrain)&&(this._has3DLayers=!0,w=this._mergedOrder.length-1),L.type==="circle"&&(this._hasCircleLayers=!0),L.type==="symbol"&&(this._hasSymbolLayers=!0),L.type==="clip"&&(this._clipLayerPresent=!0)}};if(P(h),this._has3DLayers){const O={};for(let L=0;L<this._mergedOrder.length;++L){const z=this._mergedOrder[L];O[z]=L===w?1:L<w?v[z].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((L,z)=>O[L]-O[z])}this._mergedLayers=v,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(s){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,s),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(s){return s.data?function(h,v,w,P){const O=Object.assign({},v);for(const z of Object.keys(Mg))O[z]===void 0&&(O[z]=Mg[z].default);const L=new i.a8(zd,h,new Map(w));return L.setTransitionOrValue(O,w),L.untransitioned().possiblyEvaluate(new i.ac(0,{worldview:void 0}))}(this.scope,s,this.options).get("data"):null}_loadColorTheme(s){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const h=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((v,w)=>{const P="data:image/png;base64,";if(!s||s.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void v();let O=s;O.startsWith(P)||(O=P+O);const L=i.I.from("mapbox-reserved-lut"),z=new Image;z.src=O,z.onerror=()=>{this._styleColorTheme.lutLoading=!1,w(new Error("Failed to load image data"))},z.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==h)return void v();this._styleColorTheme.lutLoading=!1;const{width:G,height:H,data:Q}=i.o.getImageData(z);if(H>32)return void w(new Error("The height of the image must be less than or equal to 32 pixels."));if(G!==H*H)return void w(new Error("The width of the image must be equal to the height squared."));this.getImage(L)&&this.removeImage(L),this.addImage(L,{data:new i.q({width:G,height:H},Q),pixelRatio:1,sdf:!1,usvg:!1,version:0});const K=this.imageManager.getImage(L,this.scope);K?(this._styleColorTheme.lut={image:K.data,data:s},v()):w(new Error("Missing LUT image."))}})}getLut(s){const h=this._styleColorThemeForScope[s];return h?h.lut:null}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(s){this._spriteRequest=function(h,v,w){let P,O,L;const z=i.o.devicePixelRatio>1?"@2x":"";let G=i.m(v.transformRequest(v.normalizeSpriteURL(h,z,".json"),i.R.SpriteJSON),(K,re)=>{G=null,L||(L=K,P=re,Q())}),H=i.n(v.transformRequest(v.normalizeSpriteURL(h,z,".png"),i.R.SpriteImage),(K,re)=>{H=null,L||(L=K,O=re,Q())});function Q(){if(L)w(L);else if(P&&O){const K=i.o.getImageData(O),re={};for(const le in P){const{width:ue,height:_e,x:ge,y:Se,sdf:ke,pixelRatio:Te,stretchX:$e,stretchY:Re,content:Ve}=P[le],Be=new i.q({width:ue,height:_e});i.q.copy(K,Be,{x:ge,y:Se},{x:0,y:0},{width:ue,height:_e},null),re[le]={data:Be,pixelRatio:Te!==void 0?Te:1,sdf:ke!==void 0&&ke,stretchX:$e,stretchY:Re,content:Ve,usvg:!1,version:0}}w(null,re)}}return{cancel(){G&&(G.cancel(),G=null),H&&(H.cancel(),H=null)}}}(s,this.map._requestManager,(h,v)=>{if(this._spriteRequest=null,h)this.fire(new i.y(h));else if(v){const w=new Map;for(const P in v)w.set(i.I.from(P),v[P]);this.addImages(w)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))})}addIconset(s,h){if(h.type==="sprite")return void this._loadSprite(h.url);const v=this.getOwnSourceCache(h.source);if(!v)return void this.fire(new i.y(new Error(`Source "${h.source}" as specified by iconset "${s}" does not exist and cannot be used as an iconset source`)));const w=v.getSource();if(w.type!=="raster-array")return void this.fire(new i.y(new Error(`Source "${h.source}" as specified by iconset "${s}" is not a "raster-array" source and cannot be used as an iconset source`)));w.partial=!1;const P=new XR(s,this.scope,v);this.imageManager.addImageProvider(P,this.scope)}removeIconset(s){this.imageManager.removeImageProvider(s,this.scope)}_loadIconset(s){if(!i.h(s)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(s);const h=this.map._spriteFormat==="auto";var v,w;this._spriteRequest=(w=(P,O)=>{if(this._spriteRequest=null,P)h?this._loadSprite(s):this.fire(new i.y(P));else if(O){const L=new Map;for(const z in O)L.set(i.I.from(z),O[z]);this.addImages(L)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))},i.bt((v=this.map._requestManager).transformRequest(v.normalizeIconsetURL(s),i.R.Iconset),(P,O)=>{if(P)return void w(P);const L={},z=i.df(new i.bs(O));for(const G of z.icons){const H={version:1,pixelRatio:i.o.devicePixelRatio,content:ZR(G),stretchX:G.metadata?y2(G.metadata.stretch_x_areas):void 0,stretchY:G.metadata?y2(G.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:G};L[G.name]=H}w(null,L)}))}_validateLayer(s){const h=this.getOwnSource(s.source);if(!h)return;const v=s.sourceLayer;v&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(v)===-1)&&this.fire(new i.y(new Error(`Source layer "${v}" does not exist on source "${h.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:s}of this.fragments)if(!s.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((s,h)=>{const v=this.fragments[h];return v&&v.style&&(s.data=v.style.serialize()),s})}_serializeSources(){const s={};for(const h in this._sourceCaches){const v=this._sourceCaches[h].getSource();s[v.id]||(s[v.id]=v.serialize())}return s}_serializeLayers(s){const h=[];for(const v of s){const w=this._layers[v];w&&w.type!=="custom"&&h.push(w.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(s){return s?this.order:this._mergedOrder}isLayerDraped(s){return!!this.terrain&&s.isDraped(this.getLayerSourceCache(s))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(s){const h=this.getOwnLayer(s);if(h)return h;this.fire(new i.y(new Error(`The layer '${s}' does not exist in the map's style.`)))}_checkSource(s){const h=this.getOwnSource(s);if(h)return h;this.fire(new i.y(new Error(`The source '${s}' does not exist in the map's style.`)))}precompilePrograms(s,h){const v=this.map.painter;if(v)for(let w=s.minzoom||0;w<(s.maxzoom||25.5);w++){const P=s.getProgramIds();if(P)for(const O of P){const L=s.getDefaultProgramParams(O,h.zoom,this._styleColorTheme.lut);L&&(v.style=this,this.fog&&(v._fogVisible=!0,L.overrideFog=!0,v.getOrCreateProgram(O,L)),v._fogVisible=!1,L.overrideFog=!1,v.getOrCreateProgram(O,L),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(L.overrideRtt=!0,v.getOrCreateProgram(O,L)))}}}update(s){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s);const h=this.calculateLightsBrightness();s.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h)),s.worldview!==this._worldview&&(this._worldview=s.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const v=this._changes.isDirty();let w=!1;if(this._changes.isDirty()){const L=this._changes.getLayerUpdatesByScope();for(const z in L){const{updatedIds:G,removedIds:H}=L[z];(G||H)&&(this._updateWorkerLayers(z,G,H),w=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(s),this.light&&this.light.updateTransitions(s),this.ambientLight&&this.ambientLight.updateTransitions(s),this.directionalLight&&this.directionalLight.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this.snow&&this.snow.updateTransitions(s),this.rain&&this.rain.updateTransitions(s),this._changes.reset()}const P={};for(const L in this._mergedSourceCaches){const z=this._mergedSourceCaches[L];P[L]=z.used,z.used=!1,z.tileCoverLift=0}for(const L of this._mergedOrder){const z=this._mergedLayers[L];if(z.recalculate(s,this._availableImages),!z.isHidden(s.zoom)){const G=this.getLayerSourceCache(z);G&&(G.used=!0,G.tileCoverLift=Math.max(G.tileCoverLift,z.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(z,s)}):this.precompilePrograms(z,s))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&w&&this.mergeLayers();const O=this.imageManager.getPendingImageProviders();for(const L of O)L.sourceCache.used=!0;for(const L in P){const z=this._mergedSourceCaches[L];P[L]!==z.used&&z.getSource().fire(new i.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:z.getSource().id}))}this.light&&this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.snow&&this.snow.recalculate(s),this.rain&&this.rain.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),v&&this.fire(new i.z("data",{dataType:"style"}))}updateImageProviders(){const s=this.imageManager.getPendingImageProviders();for(const h of s){const v=h.resolvePendingRequests(),w=this.getFragmentStyle(h.scope);w&&w.addImages(v)}}_updateTilesForChangedImages(){const s={};for(const h in this._mergedSourceCaches){const v=this._mergedSourceCaches[h].getSource().scope;s[v]=s[v]||this._changes.getUpdatedImages(v),s[v].length!==0&&this._mergedSourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s[v])}for(const h in s)this._changes.resetUpdatedImages(h)}_updateWorkerLayers(s,h,v){const w=this.getFragmentStyle(s);w&&this.dispatcher.broadcast("updateLayers",{layers:h?w._serializeLayers(h):[],scope:s,removedIds:v||[],options:w.options})}setState(s,h){if(this._checkLoaded(),Bd(this,Sn(s)))return!1;(s=i.dn(s)).layers=Xf(s.layers);const v=function(O,L){if(!O)return[{command:Yn.setStyle,args:[L]}];let z=[];try{if(!i.bx(O.version,L.version))return[{command:Yn.setStyle,args:[L]}];if(i.bx(O.center,L.center)||z.push({command:Yn.setCenter,args:[L.center]}),i.bx(O.zoom,L.zoom)||z.push({command:Yn.setZoom,args:[L.zoom]}),i.bx(O.bearing,L.bearing)||z.push({command:Yn.setBearing,args:[L.bearing]}),i.bx(O.pitch,L.pitch)||z.push({command:Yn.setPitch,args:[L.pitch]}),i.bx(O.sprite,L.sprite)||z.push({command:Yn.setSprite,args:[L.sprite]}),i.bx(O.glyphs,L.glyphs)||z.push({command:Yn.setGlyphs,args:[L.glyphs]}),i.bx(O.imports,L.imports)||function(re=[],le=[],ue){le=le||[];const _e=(re=re||[]).map(wg),ge=le.map(wg),Se=re.reduce(Sg,{}),ke=le.reduce(Sg,{}),Te=_e.slice();let $e,Re,Ve,Be;for($e=0,Re=0;$e<_e.length;$e++)Ve=_e[$e],ke.hasOwnProperty(Ve)?Re++:(ue.push({command:Yn.removeImport,args:[Ve]}),Te.splice(Te.indexOf(Ve,Re),1));for($e=0,Re=0;$e<ge.length;$e++)Ve=ge[ge.length-1-$e],Te[Te.length-1-$e]!==Ve&&(Se.hasOwnProperty(Ve)?(ue.push({command:Yn.removeImport,args:[Ve]}),Te.splice(Te.lastIndexOf(Ve,Te.length-Re),1)):Re++,Be=Te[Te.length-$e],ue.push({command:Yn.addImport,args:[ke[Ve],Be]}),Te.splice(Te.length-$e,0,Ve));for(const De of le){const We=Se[De.id];We&&(delete We.data,i.bx(We,De)||ue.push({command:Yn.updateImport,args:[De.id,De]}))}}(O.imports,L.imports,z),i.bx(O.transition,L.transition)||z.push({command:Yn.setTransition,args:[L.transition]}),i.bx(O.light,L.light)||z.push({command:Yn.setLight,args:[L.light]}),i.bx(O.fog,L.fog)||z.push({command:Yn.setFog,args:[L.fog]}),i.bx(O.snow,L.snow)||z.push({command:Yn.setSnow,args:[L.snow]}),i.bx(O.rain,L.rain)||z.push({command:Yn.setRain,args:[L.rain]}),i.bx(O.projection,L.projection)||z.push({command:Yn.setProjection,args:[L.projection]}),i.bx(O.lights,L.lights)||z.push({command:Yn.setLights,args:[L.lights]}),i.bx(O.camera,L.camera)||z.push({command:Yn.setCamera,args:[L.camera]}),i.bx(O.iconsets,L.iconsets)||function(re,le,ue){let _e;for(_e in le=le||{},re=re||{})re.hasOwnProperty(_e)&&(le.hasOwnProperty(_e)||ue.push({command:Yn.removeIconset,args:[_e]}));for(_e in le){if(!le.hasOwnProperty(_e))continue;const ge=le[_e];re.hasOwnProperty(_e)?i.bx(re[_e],ge)||(ue.push({command:Yn.removeIconset,args:[_e]}),ue.push({command:Yn.addIconset,args:[_e,ge]})):ue.push({command:Yn.addIconset,args:[_e,ge]})}}(O.iconsets,L.iconsets,z),!i.bx(O["color-theme"],L["color-theme"]))return[{command:Yn.setStyle,args:[L]}];const G={},H=[];(function(re,le,ue,_e){let ge;for(ge in le=le||{},re=re||{})re.hasOwnProperty(ge)&&(le.hasOwnProperty(ge)||_g(ge,ue,_e));for(ge in le){if(!le.hasOwnProperty(ge))continue;const Se=le[ge];re.hasOwnProperty(ge)?i.bx(re[ge],Se)||(re[ge].type==="geojson"&&Se.type==="geojson"&&Qb(re,le,ge)?ue.push({command:Yn.setGeoJSONSourceData,args:[ge,Se.data]}):xg(ge,le,ue,_e)):Jb(ge,le,ue)}})(O.sources,L.sources,H,G);const Q=[];O.layers&&O.layers.forEach(re=>{re.source&&G[re.source]?z.push({command:Yn.removeLayer,args:[re.id]}):Q.push(re)});let K=O.terrain;K&&G[K.source]&&(z.push({command:Yn.setTerrain,args:[void 0]}),K=void 0),z=z.concat(H),i.bx(K,L.terrain)||z.push({command:Yn.setTerrain,args:[L.terrain]}),function(re,le,ue){le=le||[];const _e=(re=re||[]).map(wg),ge=le.map(wg),Se=re.reduce(Sg,{}),ke=le.reduce(Sg,{}),Te=_e.slice(),$e=Object.create(null);let Re,Ve,Be,De,We,lt,it;for(Re=0,Ve=0;Re<_e.length;Re++)Be=_e[Re],ke.hasOwnProperty(Be)?Ve++:(ue.push({command:Yn.removeLayer,args:[Be]}),Te.splice(Te.indexOf(Be,Ve),1));for(Re=0,Ve=0;Re<ge.length;Re++)Be=ge[ge.length-1-Re],Te[Te.length-1-Re]!==Be&&(Se.hasOwnProperty(Be)?(ue.push({command:Yn.removeLayer,args:[Be]}),Te.splice(Te.lastIndexOf(Be,Te.length-Ve),1)):Ve++,lt=Te[Te.length-Re],ue.push({command:Yn.addLayer,args:[ke[Be],lt]}),Te.splice(Te.length-Re,0,Be),$e[Be]=!0);for(Re=0;Re<ge.length;Re++)if(Be=ge[Re],De=Se[Be],We=ke[Be],!$e[Be]&&!i.bx(De,We))if(i.bx(De.source,We.source)&&i.bx(De["source-layer"],We["source-layer"])&&i.bx(De.type,We.type)){for(it in bg(De.layout,We.layout,ue,Be,null,Yn.setLayoutProperty),bg(De.paint,We.paint,ue,Be,null,Yn.setPaintProperty),i.bx(De.slot,We.slot)||ue.push({command:Yn.setSlot,args:[Be,We.slot]}),i.bx(De.filter,We.filter)||ue.push({command:Yn.setFilter,args:[Be,We.filter]}),i.bx(De.minzoom,We.minzoom)&&i.bx(De.maxzoom,We.maxzoom)||ue.push({command:Yn.setLayerZoomRange,args:[Be,We.minzoom,We.maxzoom]}),De)De.hasOwnProperty(it)&&it!=="layout"&&it!=="paint"&&it!=="filter"&&it!=="metadata"&&it!=="minzoom"&&it!=="maxzoom"&&it!=="slot"&&(it.indexOf("paint.")===0?bg(De[it],We[it],ue,Be,it.slice(6),Yn.setPaintProperty):i.bx(De[it],We[it])||ue.push({command:Yn.setLayerProperty,args:[Be,it,We[it]]}));for(it in We)We.hasOwnProperty(it)&&!De.hasOwnProperty(it)&&it!=="layout"&&it!=="paint"&&it!=="filter"&&it!=="metadata"&&it!=="minzoom"&&it!=="maxzoom"&&it!=="slot"&&(it.indexOf("paint.")===0?bg(De[it],We[it],ue,Be,it.slice(6),Yn.setPaintProperty):i.bx(De[it],We[it])||ue.push({command:Yn.setLayerProperty,args:[Be,it,We[it]]}))}else ue.push({command:Yn.removeLayer,args:[Be]}),lt=Te[Te.lastIndexOf(Be)+1],ue.push({command:Yn.addLayer,args:[We,lt]})}(Q,L.layers,z)}catch(G){console.warn("Unable to compute style diff:",G),z=[{command:Yn.setStyle,args:[L]}]}return z}(this.serialize(),s).filter(O=>!(O.command in ow));if(v.length===0)return!1;const w=v.filter(O=>!(O.command in YR));if(w.length>0)throw new Error(`Unimplemented: ${w.map(O=>O.command).join(", ")}.`);const P=[];return v.forEach(O=>{P.push(this[O.command](...O.args))}),h&&Promise.all(P).then(h).catch(h),this.stylesheet=s,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(s){if(s.size===0)return this;for(const[h,v]of s.entries()){if(this.getImage(h))return this.fire(new i.y(new Error(`An image with the name "${h.name}" already exists.`)));this.imageManager.addImage(h,this.scope,v),this._changes.updateImage(h,this.scope)}return this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this}addImage(s,h){return this.getImage(s)?this.fire(new i.y(new Error(`An image with the name "${s.name}" already exists.`))):(this.imageManager.addImage(s,this.scope,h),this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this)}updateImage(s,h,v=!1){this.imageManager.updateImage(s,this.scope,h),v&&(this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})))}getImage(s){return this.imageManager.getImage(s,this.scope)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s,this.scope),this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(s){return this.modelManager.addModelURLs(s,this.scope),this._updateWorkerModels(),this.fire(new i.z("data",{dataType:"style"})),this}addModel(s,h,v={}){return this._checkLoaded(),this._validate(pg,`models.${s}`,h,null,v)||(this.modelManager.addModel(s,h,this.scope),this.fire(new i.z("data",{dataType:"style"}))),this}hasModel(s){return this.modelManager.hasModel(s,this.scope)}removeModel(s){return this.hasModel(s)?(this.modelManager.removeModel(s,this.scope,!1,!0),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(s,h,v={}){if(this._checkLoaded(),this.getOwnSource(s)!==void 0)throw new Error(`There is already a source with ID "${s}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(kn,`sources.${s}`,h,null,v))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const w=ws(s,h,this.dispatcher,this);w.scope=this.scope,w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(w.id),source:w.serialize(),sourceId:w.id}));const P=O=>{const L=(O?"symbol:":"other:")+w.id,z=i.B(L,this.scope),G=this._sourceCaches[L]=new Ql(z,w,O);(O?this._symbolSourceCaches:this._otherSourceCaches)[w.id]=G,G.onAdd(this.map)};P(!1),h.type!=="vector"&&h.type!=="geojson"||P(!0),w.onAdd&&w.onAdd(this.map),v.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(s){this._checkLoaded();const h=this.getOwnSource(s);if(!h)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===s)return this.fire(new i.y(new Error(`Source "${s}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===s)return this.fire(new i.y(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const w=Object.entries(this.stylesheet.iconsets).find(([P,O])=>O.type==="source"&&O.source===s);if(w)return this.fire(new i.y(new Error(`Source "${s}" cannot be removed while iconset "${w[0]}" is using it.`)))}const v=this.getOwnSourceCaches(s);for(const w of v){const P=i.dp(w.id);delete this._sourceCaches[P],this._changes.discardSourceCacheUpdate(w.id),w.fire(new i.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles()}return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(s,h){this._checkLoaded(),this.getOwnSource(s).setData(h),this._changes.setDirty()}getOwnSource(s){const h=this.getOwnSourceCache(s);return h&&h.getSource()}getOwnSources(){const s=[];for(const h in this._otherSourceCaches){const v=this.getOwnSourceCache(h);v&&s.push(v.getSource())}return s}areTilesLoaded(){const s=this._mergedSourceCaches;for(const h in s){const v=s[h]._tiles;for(const w in v){const P=v[w];if(P.state!=="loaded"&&P.state!=="errored")return!1}}return!0}setLights(s){if(this._checkLoaded(),!s)return delete this.ambientLight,void delete this.directionalLight;const h=this._getTransitionParameters();for(const P of s){if(this._validate(pa,"lights",P))return;switch(P.type){case"ambient":if(this.ambientLight){const O=this.ambientLight;O.set(P),O.updateTransitions(h)}else this.ambientLight=new xa(P,pi||(pi=new i.a9({color:new i.aa(i.a6.properties_light_ambient.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const O=this.directionalLight;O.set(P),O.updateTransitions(h)}else this.directionalLight=new xa(P,ca||(ca=new i.a9({direction:new i.ap(i.a6.properties_light_directional.direction),color:new i.aa(i.a6.properties_light_directional.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_directional.intensity),"cast-shadows":new i.aa(i.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new i.aa(i.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.aa(i.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const v=Object.assign(h,{worldview:this.map.getWorldview()}),w=new i.ac(this.z||0,v);this.ambientLight&&this.ambientLight.recalculate(w),this.directionalLight&&this.directionalLight.recalculate(w),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const s=this.directionalLight,h=this.ambientLight;if(!s||!h)return;const v=K=>.2126*(K[0]<=.03928?K[0]/12.92:Math.pow((K[0]+.055)/1.055,2.4))+.7152*(K[1]<=.03928?K[1]/12.92:Math.pow((K[1]+.055)/1.055,2.4))+.0722*(K[2]<=.03928?K[2]/12.92:Math.pow((K[2]+.055)/1.055,2.4)),w=s.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),P=s.properties.get("intensity"),O=s.properties.get("direction"),L=1-i.d3(O.x,O.y,O.z)[2]/90,z=v(w)*P*L,G=h.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),H=h.properties.get("intensity"),Q=v(G)*H;return Number(((z+Q)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const s=[];return this.directionalLight&&s.push(this.directionalLight.get()),this.ambientLight&&s.push(this.ambientLight.get()),s}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(s){if(s==null||s===""&&this.isRootStyle())return this;if(i.dq(s)){const h=i.dr(s),v=this.fragments.find(({id:P})=>P===h);if(!v)return;const w=i.dp(s);return v.style.getFragmentStyle(w)}{const h=this.fragments.find(({id:v})=>v===s);return h?h.style:void 0}}setFeaturesetSelectors(s){if(!s)return;const h={},v=(w,P="")=>`${w}::${P}`;this._featuresetSelectors={};for(const w in s){const P=this._featuresetSelectors[w]=[];for(const O of s[w].selectors){if(O.featureNamespace){const z=this.getOwnLayer(O.layer);if(!z){i.w(`Layer is undefined for selector: ${O.layer}`);continue}const G=v(z.source,z.sourceLayer);if(G in h&&h[G]!==O.featureNamespace){i.w(`"featureNamespace ${O.featureNamespace} of featureset ${w}'s selector is not associated to the same source, skip this selector`);continue}h[G]=O.featureNamespace}let L;if(O.properties)for(const z in O.properties){const G=i.U(O.properties[z]);G.result==="success"&&(L=L||{},L[z]=G.value)}P.push({layerId:O.layer,namespace:O.featureNamespace,properties:L,uniqueFeatureID:O._uniqueFeatureID})}}}getFeaturesetDescriptors(s){const h=this.getFragmentStyle(s);if(!h||!h.stylesheet.featuresets)return[];const v=[];for(const w in h.stylesheet.featuresets)v.push({featuresetId:w,importId:h.scope?h.scope:void 0});return v}getFeaturesetLayers(s,h){const v=this.getFragmentStyle(h),w=v.stylesheet.featuresets;if(!w||!w[s])return this.fire(new i.y(new Error(`The featureset '${s}' does not exist in the map's style and cannot be queried.`))),[];const P=[];for(const O of w[s].selectors){const L=v.getOwnLayer(O.layer);L&&P.push(L)}return P}getConfigProperty(s,h){const v=this.getFragmentStyle(s);if(!v)return null;const w=i.B(h,v.scope),P=v.options.get(w),O=P?P.value||P.default:null;return O?O.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(s,h){const v=i.B(s,h);return this._mergedIndoor[v]}setIndoorData(s,h){this.map.indoor.setIndoorData(h)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(s,h,v){const w=this.getFragmentStyle(s);if(!w)return;const P=w.stylesheet.schema;if(!P||!P[h])return;const O=i.U(v);if(O.result!=="success")return void Bd(this,O.value);const L=O.value.expression,z=i.B(h,w.scope),G=w.options.get(z);if(!G)return;let H;const{minValue:Q,maxValue:K,stepValue:re,type:le,values:ue}=P[h],_e=i.U(P[h].default);_e.result==="success"&&(H=_e.value.expression),H?(this.options.set(z,Object.assign({},G,{value:L,default:H,minValue:Q,maxValue:K,stepValue:re,type:le,values:ue})),this.updateConfigDependencies(h)):this.fire(new i.y(new Error(`No schema defined for the config option "${h}" in the "${s}" fragment.`)))}getConfig(s){const h=this.getFragmentStyle(s);if(!h)return null;const v=h.stylesheet.schema;if(!v)return null;const w={};for(const P in v){const O=i.B(P,h.scope),L=h.options.get(O),z=L?L.value||L.default:null;w[P]=z?z.serialize():null}return w}setConfig(s,h){const v=this.getFragmentStyle(s);v&&(v.updateConfig(h,v.stylesheet.schema),this.updateConfigDependencies())}getSchema(s){const h=this.getFragmentStyle(s);return h?h.stylesheet.schema:null}setSchema(s,h){const v=this.getFragmentStyle(s);v&&(v.stylesheet.schema=h,v.updateConfig(v._config,h),this.updateConfigDependencies())}updateConfig(s,h){if(this._config=s,s||h)if(h)for(const v in h){let w,P;const O=i.U(h[v].default);if(O.result==="success"&&(w=O.value.expression),s&&s[v]!==void 0){const K=i.U(s[v]);K.result==="success"&&(P=K.value.expression)}const{minValue:L,maxValue:z,stepValue:G,type:H,values:Q}=h[v];if(w){const K=i.B(v,this.scope);this.options.set(K,{default:w,value:P,minValue:L,maxValue:z,stepValue:G,type:H,values:Q})}else this.fire(new i.y(new Error(`No schema defined for config option "${v}".`)))}else this.fire(new i.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(s,h=()=>!0){for(const v of s){const w=this.getLayer(v);w&&h(w)&&(w.possiblyEvaluateVisibility(),this._updateLayer(w),this._changes.setDirty())}}updateConfigDependencies(s){this._updateLayers(this._configDependentLayers,h=>!s||h.expressionDependencies.configDependencies.has(s)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(h=>{const v=h._styleColorTheme.colorThemeOverride?h._styleColorTheme.colorThemeOverride:h._styleColorTheme.colorTheme;if(v){const w=h._evaluateColorThemeData(v);(!h._styleColorTheme.lut&&w!==""||h._styleColorTheme.lut&&w!==h._styleColorTheme.lut.data)&&h.setColorTheme(v)}}),this._changes.setDirty()}addLayer(s,h,v={}){this._checkLoaded();const w=s.id;if(this._layers[w])return void this.fire(new i.y(new Error(`Layer with id "${w}" already exists on this map`)));let P;if(s.type==="custom"){if(Bd(this,i.ds(s)))return;P=i.dt(s,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof s.source=="object"&&(this.addSource(w,s.source),s=i.dn(s),s=Object.assign(s,{source:w})),this._validate(ns,`layers.${w}`,s,{arrayIndex:-1},v))return;P=i.dt(s,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(P),P.setEventedParent(this,{layer:{id:w}})}const O=i.B(P.source,P.scope);P.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(O),P.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(O);let L=this._order.length;if(h){const Q=this._order.indexOf(h);if(Q===-1)return void this.fire(new i.y(new Error(`Layer with id "${h}" does not exist on this map.`)));P.slot===this._layers[h].slot?L=Q:i.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(L,0,w),this._layerOrderChanged=!0,this._layers[w]=P;const z=this.getOwnLayerSourceCache(P),G=!!this.directionalLight&&this.directionalLight.shadowsEnabled();z&&P.canCastShadows()&&G&&(z.castsShadows=!0);const H=this._changes.getRemovedLayer(P);if(H&&P.source&&z&&P.type!=="custom"){this._changes.discardLayerRemoval(P);const Q=i.B(P.source,P.scope);H.type!==P.type?this._changes.updateSourceCache(Q,"clear"):(this._changes.updateSourceCache(Q,"reload"),z.pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map),P.scope=this.scope,this.mergeLayers()}moveLayer(s,h){this._checkLoaded();const v=this._checkLayer(s);if(!v||s===h)return;const w=this._order.indexOf(s);this._order.splice(w,1);let P=this._order.length;if(h){const O=this._order.indexOf(h);if(O===-1)return void this.fire(new i.y(new Error(`Layer with id "${h}" does not exist on this map.`)));v.slot===this._layers[h].slot?P=O:i.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(P,0,s),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(s){this._checkLoaded();const h=this._checkLayer(s);if(!h)return;h.setEventedParent(null);const v=this._order.indexOf(s);this._order.splice(v,1),delete this._layers[s],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(h.fqid),this._indoorDependentLayers.delete(h.fqid),this._changes.removeLayer(h);const w=this.getOwnLayerSourceCache(h);if(w&&w.castsShadows){let P=!1;for(const O in this._layers)if(this._layers[O].source===h.source&&this._layers[O].canCastShadows()){P=!0;break}w.castsShadows=P}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(s){return this._layers[s]}hasLayer(s){return s in this._mergedLayers}hasLayerType(s){for(const h in this._layers)if(this._layers[h].type===s)return!0;return!1}setLayerZoomRange(s,h,v){this._checkLoaded();const w=this._checkLayer(s);w&&(w.minzoom===h&&w.maxzoom===v||(h!=null&&(w.minzoom=h),v!=null&&(w.maxzoom=v),this._updateLayer(w)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(s,h){this._checkLoaded();const v=this._checkLayer(s);v&&v.slot!==h&&(v.slot=h,this._updateLayer(v))}setFilter(s,h,v={}){this._checkLoaded();const w=this._checkLayer(s);if(w&&!i.bx(w.filter,h))return h==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(bn,`layers.${w.id}.filter`,h,{layerType:w.type},v)||(w.filter=i.dn(h),this._updateLayer(w)))}getFilter(s){const h=this._checkLayer(s);if(h)return i.dn(h.filter)}setLayoutProperty(s,h,v,w={}){this._checkLoaded();const P=this._checkLayer(s);if(P&&!i.bx(P.getLayoutProperty(h),v)){if(v!=null&&(!w||w.validate!==!1)&&Bd(P,Kb.call(Sn,{key:`layers.${s}.layout.${h}`,layerType:P.type,objectKey:h,value:v,styleSpec:i.a6,style:{glyphs:!0,sprite:!0}})))return;P.setLayoutProperty(h,v),P.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(P.fqid),P.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(P.fqid),this._updateLayer(P)}}setLayerProperty(s,h,v,w={}){this._checkLoaded();const P=this._checkLayer(s);P&&(h==="appearances"?(P.setAppearances(v),this._changes.setDirty()):P.isPaintProperty(h)?this.setPaintProperty(s,h,v,w):this.setLayoutProperty(s,h,v,w))}getLayoutProperty(s,h){const v=this._checkLayer(s);if(v)return v.getLayoutProperty(h)}setPaintProperty(s,h,v,w={}){this._checkLoaded();const P=this._checkLayer(s);if(!P||i.bx(P.getPaintProperty(h),v)||v!=null&&(!w||w.validate!==!1)&&Bd(P,is.call(Sn,{key:`layers.${s}.paint.${h}`,layerType:P.type,objectKey:h,value:v,styleSpec:i.a6})))return;const O=P.setPaintProperty(h,v);P.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(P.fqid),P.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(P.fqid),O&&this._updateLayer(P),this._changes.updatePaintProperties(P)}getPaintProperty(s,h){const v=this._checkLayer(s);if(v)return v.getPaintProperty(h)}setFeatureState(s,h){if(this._checkLoaded(),"target"in s){if("featuresetId"in s.target){const{featuresetId:z,importId:G}=s.target,H=this.getFragmentStyle(G),Q=H.getFeaturesetLayers(z);for(const{source:K,sourceLayer:re}of Q)H.setFeatureState({id:s.id,source:K,sourceLayer:re},h)}else if("layerId"in s.target){const{layerId:z}=s.target,G=this.getLayer(z);this.setFeatureState({id:s.id,source:G.source,sourceLayer:G.sourceLayer},h)}return}const v=s.source,w=s.sourceLayer,P=this._checkSource(v);if(!P)return;const O=P.type;if(O==="geojson"&&w)return void this.fire(new i.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(O==="vector"&&!w)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided.")));const L=this.getOwnSourceCaches(v);for(const z of L)z.setFeatureState(w,s.id,h)}removeFeatureState(s,h){if(this._checkLoaded(),"target"in s){if("featuresetId"in s.target){const{featuresetId:z,importId:G}=s.target,H=this.getFragmentStyle(G),Q=H.getFeaturesetLayers(z);for(const{source:K,sourceLayer:re}of Q)H.removeFeatureState({id:s.id,source:K,sourceLayer:re},h)}else if("layerId"in s.target){const{layerId:z}=s.target,G=this.getLayer(z);this.removeFeatureState({id:s.id,source:G.source,sourceLayer:G.sourceLayer},h)}return}const v=s.source,w=this._checkSource(v);if(!w)return;const P=w.type,O=P==="vector"?s.sourceLayer:void 0;if(P==="vector"&&!O)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new i.y(new Error("A feature id is required to remove its specific state property.")));const L=this.getOwnSourceCaches(v);for(const z of L)z.removeFeatureState(O,s.id,h)}getFeatureState(s){if(this._checkLoaded(),"target"in s){let P;if("featuresetId"in s.target){const{featuresetId:O,importId:L}=s.target,z=this.getFragmentStyle(L),G=z.getFeaturesetLayers(O);for(const{source:H,sourceLayer:Q}of G){const K=z.getFeatureState({id:s.id,source:H,sourceLayer:Q});if(K&&!P)P=K;else if(!i.bx(P,K))return void this.fire(new i.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in s.target){const{layerId:O}=s.target,L=this.getLayer(O);P=this.getFeatureState({id:s.id,source:L.source,sourceLayer:L.sourceLayer})}return P}const h=s.source,v=s.sourceLayer,w=this._checkSource(h);if(w){if(w.type!=="vector"||v)return s.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(v,s.id);this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(s){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,s),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const s=this.getTerrain(),h=s&&this.terrain&&this.terrain.scope===this.scope?s:this.stylesheet.terrain;return i.du({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},v=>v!==void 0)}_updateFilteredLayers(s){for(const h of Object.values(this._mergedLayers))s(h)&&this._updateLayer(h)}_updateLayer(s){this._changes.updateLayer(s);const h=this.getLayerSourceCache(s),v=i.B(s.source,s.scope),w=this._changes.getUpdatedSourceCaches();s.source&&!w[v]&&h&&h.getSource().type!=="raster"&&(this._changes.updateSourceCache(v,"reload"),h.pause()),s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const h=L=>this._mergedLayers[L].is3D(!!this.terrain),v=this.order,w={},P=[];for(let L=v.length-1;L>=0;L--){const z=v[L];if(h(z)){w[z]=L;for(const G of s){const H=G[z];if(H)for(const Q of H)P.push(Q)}}}P.sort((L,z)=>z.intersectionZ-L.intersectionZ);const O=[];for(let L=v.length-1;L>=0;L--){const z=v[L];if(h(z))for(let G=P.length-1;G>=0;G--){const H=P[G].feature;if(H.layer&&w[H.layer.id]<L)break;O.push(H),P.pop()}else for(const G of s){const H=G[z];if(H)for(const Q of H)O.push(Q.feature)}}return O}queryRasterValue(s,h,v){const w=this.getOwnSource(s);return w?w.type!=="raster-array"?(this.fire(new i.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):w.queryRasterArrayValue(h,v):(this.fire(new i.y(new Error(`Source with id "${s}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(s,h,v){let w;h&&!Array.isArray(h)&&h.filter&&(this._validate(bn,"queryRenderedFeatures.filter",h.filter,null,h),w=i.b5(h.filter));const P={},O=H=>{if(Kv.has(H.type))return;const Q=this.getOwnLayerSourceCache(H),K=P[Q.id]=P[Q.id]||{sourceCache:Q,layers:{},has3DLayers:!1};H.is3D(!!this.terrain)&&(K.has3DLayers=!0),K.layers[H.fqid]=K.layers[H.fqid]||{styleLayer:H,targets:[]},K.layers[H.fqid].targets.push({filter:w})};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new i.y(new Error("parameters.layers must be an Array."))),[];for(const H of h.layers){const Q=this._layers[H];if(!Q)return this.fire(new i.y(new Error(`The layer '${H}' does not exist in the map's style and cannot be queried for features.`))),[];O(Q)}}else for(const H in this._layers)O(this._layers[H]);const L=this._queryRenderedFeatures(s,P,v),z=this._flattenAndSortRenderedFeatures(L),G=[];for(const H of z)i.dv(H.layer.id)===this.scope&&G.push(H);return G}queryRenderedFeatureset(s,h,v){let w;h&&!Array.isArray(h)&&h.filter&&(this._validate(bn,"queryRenderedFeatures.filter",h.filter,null,h),w=i.b5(h.filter));const P="mock",O=[];if(h&&h.target)O.push(Object.assign({},h,{targetId:P,filter:w}));else{const H=this.getFeaturesetDescriptors();for(const Q of H)O.push({targetId:P,filter:w,target:Q});for(const{style:Q}of this.fragments){const K=Q.getFeaturesetDescriptors();for(const re of K)O.push({targetId:P,filter:w,target:re})}}const L=this.queryRenderedTargets(s,O,v),z=[],G=new Set;for(const H of L)for(const Q of H.variants[P])Xs(Q,H,G)||z.push(new i.dw(H,Q));return z}queryRenderedTargets(s,h,v){const w={},P=(L,z,G,H)=>{const Q=w[z.id]=w[z.id]||{sourceCache:z,layers:{},has3DLayers:!1};if(Q.layers[L.fqid]=Q.layers[L.fqid]||{styleLayer:L,targets:[]},L.is3D(!!this.terrain)&&(Q.has3DLayers=!0),!H)return G.uniqueFeatureID=!1,void Q.layers[L.fqid].targets.push(G);Q.layers[L.fqid].targets.push(Object.assign({},G,{namespace:H.namespace,properties:H.properties,uniqueFeatureID:H.uniqueFeatureID}))};for(const L of h)if("featuresetId"in L.target){const{featuresetId:z,importId:G}=L.target,H=this.getFragmentStyle(G);if(!H||!H._featuresetSelectors)continue;const Q=H._featuresetSelectors[z];if(!Q){this.fire(new i.y(new Error(`The featureset '${z}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const K of Q){const re=H.getOwnLayer(K.layerId);re&&!Kv.has(re.type)&&P(re,H.getOwnLayerSourceCache(re),L,K)}}else if("layerId"in L.target){const{layerId:z}=L.target,G=this.getLayer(z);if(!G||Kv.has(G.type))continue;P(G,this.getLayerSourceCache(G),L)}const O=this._queryRenderedFeatures(s,w,v);return this._flattenAndSortRenderedFeatures(O)}_queryRenderedFeatures(s,h,v){const w=[],P=!!this.map._showQueryGeometry,O=ci.createFromScreenPoints(s,v);for(const L in h){const z=Ys(O,h[L],this._availableImages,v,P);Object.keys(z).length&&w.push(z)}if(this.placement)for(const L in h){if(!h[L].sourceCache._onlySymbols)continue;const z=Fv(O.screenGeometry,h[L],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(z).length&&w.push(z)}return w}querySourceFeatures(s,h){const v=h&&h.filter;v&&this._validate(bn,"querySourceFeatures.filter",v,null,h);let w=[];const P=this.getOwnSourceCaches(s);for(const O of P)w=w.concat(mg(O,h));return w}addSourceType(s,h,v){return nc.getSourceType(s)?v(new Error(`A source type called "${s}" already exists.`)):(nc.setSourceType(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},v):v(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(s,h,v={}){this._checkLoaded();const w=this.light.getLight();let P=!1;for(const L in s)if(!i.bx(s[L],w[L])){P=!0;break}if(!P)return;const O=this._getTransitionParameters();this.light.setLight(s,h,v),this.light.updateTransitions(O)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(s,h=1){if(this._checkLoaded(),!s)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),h===0&&delete this.terrain,s===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let v=s;const w=s.source==null;if(h===1){if(this.disableElevatedTerrain)return;if(typeof v.source=="object"){const L="terrain-dem-src";this.addSource(L,v.source),v=i.dn(v),v=Object.assign(v,{source:L})}const P=Object.assign({},v),O={};if(this.terrain&&w){P.source=this.terrain.get().source;const L=this.terrain?this.getFragmentStyle(this.terrain.scope):null;L&&(O.style=L.serialize())}if(this._validate(Uo,"terrain",P,O))return}if(!this.terrain||this.terrain.scope!==this.scope&&!w||this.terrain&&h!==this.terrain.drapeRenderMode){if(!v)return;this._createTerrain(v,h),this.fire(new i.z("data",{dataType:"style"}))}else{const P=this.terrain,O=P.get();for(const L of Object.keys(i.a6.terrain))!v.hasOwnProperty(L)&&i.a6.terrain[L].default&&(v[L]=i.a6.terrain[L].default);for(const L in s)if(!i.bx(s[L],O[L])){P.set(s,this.options),this.stylesheet.terrain=s;const z=this._getTransitionParameters({duration:0});P.updateTransitions(z),this.fire(new i.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){const h=this.fog=new Ir(s,this.map.transform,this.scope,this.options);this.stylesheet.fog=h.get();const v=this._getTransitionParameters({duration:0});h.updateTransitions(v)}_createSnow(s){const h=this.snow=new za(s,this.map.transform,this.scope,this.options);this.stylesheet.snow=h.get();const v=this._getTransitionParameters({duration:0});h.updateTransitions(v)}_createRain(s){const h=this.rain=new Ea(s,this.map.transform,this.scope,this.options);this.stylesheet.rain=h.get();const v=this._getTransitionParameters({duration:0});h.updateTransitions(v)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog;if(!i.bx(h.get(),s)){h.set(s,this.options),this.stylesheet.fog=h.get();const v=this._getTransitionParameters({duration:0});h.updateTransitions(v)}}else this._createFog(s);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(s){if(this._checkLoaded(),!s)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const h=this.snow;if(!i.bx(h.get(),s)){h.set(s,this.options),this.stylesheet.snow=h.get();const v=this._getTransitionParameters({duration:0});h.updateTransitions(v)}}else this._createSnow(s);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(s){if(this._checkLoaded(),!s)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const h=this.rain;if(!i.bx(h.get(),s)){h.set(s,this.options),this.stylesheet.rain=h.get();const v=this._getTransitionParameters({duration:0});h.updateTransitions(v)}}else this._createRain(s);this._markersNeedUpdate=!0}_reloadColorTheme(){const s=()=>{for(const w in this._layers)this._layers[w].lut=this._styleColorTheme.lut;for(const w in this._sourceCaches)this._sourceCaches[w].clearTiles()},h=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!h)return this._styleColorTheme.lut=null,void s();const v=this._evaluateColorThemeData(h);this._loadColorTheme(v).then(()=>{this.fire(new i.z("colorthemeset")),s()}).catch(w=>{i.w(`Couldn't set color theme: ${w}`)})}setColorTheme(s){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=s,this._reloadColorTheme()}setImportColorTheme(s,h){const v=this.getFragmentStyle(s);v&&(v._styleColorTheme.colorThemeOverride=h,v._reloadColorTheme())}_getTransitionParameters(s){return{now:i.o.now(),transition:Object.assign(this.transition,s)}}updateDrapeFirstLayers(){if(!this.terrain)return;const s=[],h=[];for(const v of this._mergedOrder)this.isLayerDraped(this._mergedLayers[v])?s.push(v):h.push(v);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...h)}_createTerrain(s,h){const v=this.terrain=new at(s,h,this.scope,this.options,this.map.getWorldview());h===1&&(this.stylesheet.terrain=s),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const w=this._getTransitionParameters({duration:0});v.updateTransitions(w)}_force3DLayerUpdate(){for(const s in this._layers){const h=this._layers[s];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const s in this._layers){const h=this._layers[s];h.type==="symbol"&&this._updateLayer(h)}}_validate(s,h,v,w,P={}){if(P&&P.validate===!1)return!1;const O=Object.assign({},this.serialize());return Bd(this,s.call(Sn,Object.assign({key:h,style:O,value:v,styleSpec:i.a6},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.dx.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._mergedLayers)this._mergedLayers[s].setEventedParent(null);for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles(),this._mergedSourceCaches[s].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(s){const h=this.getSourceCaches(s);for(const v of h)v.clearTiles()}clearSources(){for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles()}clearLayers(){for(const s in this._mergedLayers){const h=this._mergedLayers[s];h._clear&&h._clear()}}reloadSource(s){const h=this.getSourceCaches(s);for(const v of h)v.resume(),v.reload()}reloadSources(){for(const s of this.getSources())s.reload&&s.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(s=>{s.modelManager.reloadModels(s.scope)})}updateSources(s){let h;this.directionalLight&&(h=m2(this.directionalLight));const v=new Set;for(const w in this._mergedLayers){const P=this._mergedLayers[w];P.hasElevation()&&!v.has(P.source)&&v.add(P.source)}for(const w in this._mergedSourceCaches){const P=this._mergedSourceCaches[w],O=v.has(P._source.id);P.update(s,void 0,void 0,h,O)}}_generateCollisionBoxes(){for(const s in this._sourceCaches){const h=this._sourceCaches[s];h.resume(),h.reload()}}_updatePlacement(s,h,v,w,P,O,L=!1){let z=!1,G=!1;const H={},Q={};for(const K of this._mergedOrder){const re=this._mergedLayers[K];if(re.type!=="symbol")continue;const le=i.B(re.source,re.scope);let ue=H[le];if(!ue){const ge=this.getLayerSourceCache(re);if(!ge)continue;const Se=ge.getRenderableIds(!0).map(ke=>ge.getTileByID(ke));Q[le]=Se.slice(),ue=H[le]=Se.sort((ke,Te)=>Te.tileID.overscaledZ-ke.tileID.overscaledZ||(ke.tileID.isLessThan(Te.tileID)?-1:1))}const _e=this.crossTileSymbolIndex.addLayer(re,ue,h.center.lng,h.projection);z=z||_e}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),L=L||this._layerOrderChanged||w===0,this._layerOrderChanged&&this.fire(new i.z("neworder")),(L||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.o.now(),h.zoom))&&(this.pauseablePlacement=new Ds(h,this._mergedOrder,L,v,w,P,this.placement,this.fog&&h.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,H,Q,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.o.now()),G=!0),z&&this.pauseablePlacement.placement.setStale()),G||z){this._buildingIndex.onNewFrame(h.zoom);for(let K=0;K<this._mergedOrder.length;K++){const re=this._mergedLayers[this._mergedOrder[K]];if(re.type!=="symbol")continue;const le=this.isLayerClipped(re);this.placement.updateLayerOpacities(re,H[i.B(re.source,re.scope)],K,le?O:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.o.now())}}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}addImport(s,h){this._checkLoaded();const v=this.stylesheet.imports=this.stylesheet.imports||[];if(v.findIndex(({id:P})=>P===s.id)!==-1)return void this.fire(new i.y(new Error(`Import with id '${s.id}' already exists in the map's style.`)));if(!h)return v.push(s),this._loadImports([s],!0);const w=v.findIndex(({id:P})=>P===h);return w===-1&&this.fire(new i.y(new Error(`Import with id "${h}" does not exist on this map.`))),this.stylesheet.imports=v.slice(0,w).concat(s).concat(v.slice(w)),this._loadImports([s],!0,h)}updateImport(s,h){this._checkLoaded();const v=this.stylesheet.imports||[],w=this.getImportIndex(s);return w===-1?this:typeof h=="string"?(this.setImportUrl(s,h),this):(h.url&&h.url!==v[w].url&&this.setImportUrl(s,h.url),i.bx(h.config,v[w].config)||this.setImportConfig(s,h.config,h.data.schema),i.bx(h.data,v[w].data)||this.setImportData(s,h.data),this)}moveImport(s,h){this._checkLoaded();let v=this.stylesheet.imports||[];const w=this.getImportIndex(s);if(w===-1)return this;const P=this.getImportIndex(h);if(P===-1)return this;const O=v[w],L=this.fragments[w];return v=v.filter(({id:z})=>z!==s),this.fragments=this.fragments.filter(({id:z})=>z!==s),this.stylesheet.imports=v.slice(0,P).concat(O).concat(v.slice(P)),this.fragments=this.fragments.slice(0,P).concat(L).concat(this.fragments.slice(P)),this.mergeLayers(),this}setImportUrl(s,h){this._checkLoaded();const v=this.stylesheet.imports||[],w=this.getImportIndex(s);if(w===-1)return this;v[w].url=h;const P=this.fragments[w];return P.style=this._createFragmentStyle(v[w]),P.style.on("style.import.load",()=>this.mergeAll()),P.style.loadURL(h),this}setImportData(s,h){this._checkLoaded();const v=this.getImportIndex(s),w=this.stylesheet.imports||[];return v===-1?this:h?(this.fragments[v].style.setState(h),this._reloadImports(),this):(delete w[v].data,this.setImportUrl(s,w[v].url))}setImportConfig(s,h,v){this._checkLoaded();const w=this.getImportIndex(s),P=this.stylesheet.imports||[];if(w===-1)return this;h?P[w].config=h:delete P[w].config;const O=this.fragments[w];v&&O.style.stylesheet&&(O.style.stylesheet.schema=v);const L=O.style.stylesheet&&O.style.stylesheet.schema;return O.config=h,O.style.updateConfig(h,L),this.updateConfigDependencies(),this}removeImport(s){this._checkLoaded();const h=this.stylesheet.imports||[],v=this.getImportIndex(s);v!==-1&&(h.splice(v,1),this.fragments[v].style._remove(),this.fragments.splice(v,1),this._reloadImports())}getImportIndex(s){const h=(this.stylesheet.imports||[]).findIndex(v=>v.id===s);return h===-1&&this.fire(new i.y(new Error(`Import '${s}' does not exist in the map's style and cannot be updated.`))),h}getLayer(s){return this._mergedLayers[s]}getSources(){const s=[];for(const h in this._mergedOtherSourceCaches){const v=this._mergedOtherSourceCaches[h];v&&s.push(v.getSource())}return s}getSource(s,h){const v=this.getSourceCache(s,h);return v&&v.getSource()}getLayerSource(s){const h=this.getLayerSourceCache(s);return h&&h.getSource()}getSourceCache(s,h){const v=i.B(s,h);return this._mergedOtherSourceCaches[v]}getLayerSourceCache(s){const h=i.B(s.source,s.scope);return s.type==="symbol"?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(s){if(s==null)return Object.values(this._mergedSourceCaches);const h=[];return this._mergedOtherSourceCaches[s]&&h.push(this._mergedOtherSourceCaches[s]),this._mergedSymbolSourceCaches[s]&&h.push(this._mergedSymbolSourceCaches[s]),h}updateSourceCaches(){const s=this._changes.getUpdatedSourceCaches();for(const h in s){const v=s[h];v==="reload"?this.reloadSource(h):v==="clear"&&this.clearSource(h)}}updateLayers(s){const h=this._changes.getUpdatedPaintProperties();for(const v of h){const w=this.getLayer(v);w&&w.updateTransitions(s)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(s){this.stylesheet.glyphs=s,this.glyphManager.setURL(s)}getImages(s,h,v){this.imageManager.getImages(h.images,h.scope,v),this._updateTilesForChangedImages();const w=O=>{if(O){const L=h.images.map(z=>i.I.toString(z));O.setDependencies(h.tileID.key,h.type,L)}},P=i.B(h.source,h.scope);w(this._mergedOtherSourceCaches[P]),w(this._mergedSymbolSourceCaches[P]),h.images.some(O=>O.iconsetId)&&this.fire(new i.z("data",{dataType:"style"}))}rasterizeImages(s,h,v){this.imageManager.rasterizeImages(h,v)}getGlyphs(s,h,v){this.glyphManager.getGlyphs(h.stacks,v)}getResource(s,h,v){return i.dy(h,v)}getOwnSourceCache(s){return this._otherSourceCaches[s]}getOwnLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}getOwnSourceCaches(s){const h=[];return this._otherSourceCaches[s]&&h.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&h.push(this._symbolSourceCaches[s]),h}_isSourceCacheLoaded(s){const h=this.getOwnSourceCaches(s);return h.length===0?(this.fire(new i.y(new Error(`There is no source with ID '${s}'`))),!1):h.every(v=>v.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(s,h){if(!this._clipLayerPresent&&s.type!=="fill-extrusion"&&s.type!=="building")return!1;const v=s.type==="fill-extrusion"&&(s.sourceLayer==="building"||s.sourceLayer==="procedural_buildings"),w=s.type==="building";if(s.is3D(!!this.terrain)){if(v||w||h&&h.type==="batched-model"||s.type==="model")return!0}else if(s.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(s=>{s.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}nc.getSourceType=function(y){return Jl[y]},nc.setSourceType=function(y,s){Jl[y]=s},nc.registerForPluginStateChange=i.dz;class Wh extends i.E{constructor(s){super(),this._style=s,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},i.aX(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(s){s===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=s,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(s){this._activeFloorsVisible=s,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(s){for(const[h,v]of Object.entries(s.buildings))if(this._buildings[h])for(const w of v.floorIds)this._buildings[h].floors[w]||(this._buildings[h].floors[w]=v.floors[w]);else this._buildings[h]=v;for(const h of s.activeFloors)this._activeFloors.add(h);this._updateIndoorSelector()}getIndoorTileOptions(s,h){const v=this._style.getIndoorSourceLayers(s,h);return v&&this._indoorState?{sourceLayers:v,indoorState:this._indoorState}:null}_updateUI(s,h,v){const w=function(P,O,L,z){let G=null,H=Number.MAX_SAFE_INTEGER;if(z<16)return null;for(const[Q,K]of Object.entries(P)){const re=K.center;if(re){const le=O.distanceTo(i.aS.convert(re));le<H&&L.contains(re)&&(H=le,G=Q)}}return G}(this._buildings,h,v,s);w!==this._closestBuildingId&&(this._closestBuildingId=w,this._updateIndoorSelector())}_updateIndoorSelector(){const s=this._buildings,h=this._closestBuildingId,v=h&&s?s[h]:void 0;if(!v)return void this.fire(new i.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let w=null;for(const O of v.floorIds)if(this._activeFloors&&this._activeFloors.has(O)){w=O;break}const P=Array.from(v.floorIds).map(O=>({id:O,name:v.floors[O].name,zIndex:v.floors[O].zIndex})).sort((O,L)=>L.zIndex-O.zIndex);this.fire(new i.z("selector-update",{selectedFloorId:w,activeFloorsVisible:this._activeFloorsVisible,floors:P}))}_updateActiveFloors(){const s=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:s,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Dg=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,cw=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,uw=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,np="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ip=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,dw=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Zv=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,xl=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Xv=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Jt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,hw=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const ap=[];ic(Dg,ap),ic(uw,ap),ic(cw,ap);const op={"_prelude_fog.vertex.glsl":dw,"_prelude_terrain.vertex.glsl":ip,"_prelude_shadow.vertex.glsl":Jt,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Zv,"_prelude_shadow.fragment.glsl":hw,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":xl,"_prelude_raster_particle.glsl":Xv},Lg={};In("",ip),In(Zv,dw),In(hw,Jt),In(xl,""),In(Xv,"");const Fg=In(cw,uw),su=Dg;var Yv={background:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:In(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:In(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:In("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:In(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:In(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:In("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:In("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:In("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:In(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:In(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:In(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:In(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:In(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:In(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:In("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:In("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:In(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:In(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:In("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:In(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,np),skyboxGradient:In(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,np),skyboxCapture:In(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:In(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:In(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:In(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:In("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:In("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:In("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:In("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function ic(y,s){const h=y.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let v of h)if(v=v.trim(),v[0]==="#"&&v.includes("if")&&!v.includes("endif")){v=v.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const w=v.split(" ");for(const P of w)s.includes(P)||s.push(P)}}function In(y,s){const h=/#include\s+"([^"]+)"/g,v=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,w={},P=[],O=[];if(y=y.replace(h,(z,G)=>(O.push(G),"")),(s=s.replace(h,(z,G)=>(P.push(G),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let L=[...ap];ic(y,L),ic(s,L);for(const z of[...P,...O])op[z]||console.error(`Undefined include: ${z}`),Lg[z]||(Lg[z]=[],ic(op[z],Lg[z])),L=[...L,...Lg[z]];return{fragmentSource:y=y.replace(v,(z,G,H,Q,K)=>(w[K]=!0,G==="define"?`
#ifndef HAS_UNIFORM_u_${K}
in ${H} ${Q} ${K};
#else
uniform ${H} ${Q} u_${K};
#endif
`:G==="initialize"?`
#ifdef HAS_UNIFORM_u_${K}
    ${H} ${Q} ${K} = u_${K};
#endif
`:G==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    in ${H} ${Q} ${K};
#endif
`:G==="initialize-attribute"?"":void 0)),vertexSource:s=s.replace(v,(z,G,H,Q,K)=>{const re=`MATERIAL_ATTRIBUTE_OFFSET_${K}`,le=Q==="float"?"vec2":Q,ue=`GET_ATTRIBUTE_${le}(a_${K}, materialInfo, ${re})`,_e=K.match(/color/)?"color":le;return G==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${K}
in ${H} ${Q} a_${K};
#endif
`:w[K]?G==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
    #if !defined(${re})
        in ${H} ${le} a_${K};
    #endif
out ${H} ${Q} ${K};
#else
uniform ${H} ${Q} u_${K};
#endif
`:G==="initialize"?_e==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = a_${K};
#else
    ${H} ${Q} ${K} = u_${K};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${K}) 
    #ifdef ${re}
        ${K} = unpack_mix_${_e}(${ue}, u_${K}_t);
    #else
        ${K} = unpack_mix_${_e}(a_${K}, u_${K}_t);
    #endif
#else
    ${H} ${Q} ${K} = u_${K};
#endif
`:G==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    in ${H} ${Q} a_${K};
    out ${H} ${Q} ${K};
#endif
`:G==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    ${K} = a_${K};
#endif
`:void 0:G==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
    #if !defined(${re})
        in ${H} ${le} a_${K};
    #endif  
#else
uniform ${H} ${Q} u_${K};
#endif
`:G==="define-instanced"?_e==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${K}0;
in vec4 a_${K}1;
in vec4 a_${K}2;
in vec4 a_${K}3;
#else
uniform ${H} ${Q} u_${K};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${H} ${le} a_${K};
#else
uniform ${H} ${Q} u_${K};
#endif
`:G==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    ${H} ${Q} ${K} = a_${K};
#endif
`:_e==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    #ifdef ${re}
        ${H} ${Q} ${K} = ${ue};
    #else
        ${H} ${Q} ${K} = a_${K};
    #endif
#else
    ${H} ${Q} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    #ifdef ${re}
        ${H} ${Q} ${K} = unpack_mix_${_e}(${ue}, u_${K}_t);
    #else
        ${H} ${Q} ${K} = unpack_mix_${_e}(a_${K}, u_${K}_t);
    #endif
#else
    ${H} ${Q} ${K} = u_${K};
#endif
`}),usedDefines:L,vertexIncludes:P,fragmentIncludes:O}}class sp{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,h,v,w,P,O,L,z){this.context=s;let G=this.boundPaintVertexBuffers.length!==w.length;for(let Q=0;!G&&Q<w.length;Q++)this.boundPaintVertexBuffers[Q]!==w[Q]&&(G=!0);let H=this.boundDynamicVertexBuffers.length!==L.length;for(let Q=0;!H&&Q<L.length;Q++)this.boundDynamicVertexBuffers[Q]!==L[Q]&&(H=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==v||G||H||this.boundIndexBuffer!==P||this.boundVertexOffset!==O)this.freshBind(h,v,w,P,O,L,z);else{s.bindVertexArrayOES.set(this.vao);for(const Q of L)Q&&(Q.bind(),z&&Q.instanceCount&&Q.setVertexAttribDivisor(s.gl,h,z));P&&P.dynamicDraw&&P.bind()}}freshBind(s,h,v,w,P,O,L){const z=this.context,G=z.gl;this.vao&&this.destroy(),this.vao=z.gl.createVertexArray(),z.bindVertexArrayOES.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=w,this.boundVertexOffset=P,this.boundDynamicVertexBuffers=O,h.enableAttributes(G,s),h.bind(),h.setVertexAttribPointers(G,s,P);for(const H of v)H.enableAttributes(G,s),H.bind(),H.setVertexAttribPointers(G,s,P);for(const H of O)H&&(H.enableAttributes(G,s),H.bind(),H.setVertexAttribPointers(G,s,P),L&&H.instanceCount&&H.setVertexAttribDivisor(G,s,L));w&&w.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function JR(y,s){const h=Math.pow(2,s.canonical.z),v=s.canonical.y;return[new i.ae(0,v/h).toLngLat().lat,new i.ae(0,(v+1)/h).toLngLat().lat]}function QR(y,s,h,v,w,P,O){const L=y.context,z=L.gl,G=h.hillshadeFBO;if(!G)return;y.prepareDrawTile();const H=y.isTileAffectedByFog(s),Q=y.getOrCreateProgram("hillshade",{overrideFog:H});L.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,G.colorAttachment.get());const K=((_e,ge,Se,ke)=>{const Te=Se.paint.get("hillshade-shadow-color"),$e=Se.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Re=Se.paint.get("hillshade-highlight-color"),Ve=Se.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Be=Se.paint.get("hillshade-accent-color"),De=Se.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",We=Se.paint.get("hillshade-emissive-strength");let lt=i.an(Se.paint.get("hillshade-illumination-direction"));if(Se.paint.get("hillshade-illumination-anchor")==="viewport")lt-=_e.transform.angle;else if(_e.style&&_e.style.enable3dLights()&&_e.style.directionalLight){const bt=_e.style.directionalLight.properties.get("direction"),mt=i.d3(bt.x,bt.y,bt.z);lt=i.an(mt[1])}const it=!_e.options.moving;return{u_matrix:ke||_e.transform.calculateProjMatrix(ge.tileID.toUnwrapped(),it),u_image:0,u_latrange:JR(0,ge.tileID),u_light:[Se.paint.get("hillshade-exaggeration"),lt],u_shadow:Te.toPremultipliedRenderColor($e?null:Se.lut),u_highlight:Re.toPremultipliedRenderColor(Ve?null:Se.lut),u_emissive_strength:We,u_accent:Be.toPremultipliedRenderColor(De?null:Se.lut)}})(y,h,v,y.terrain?s.projMatrix:null);y.uploadCommonUniforms(L,Q,s.toUnwrapped());const{tileBoundsBuffer:re,tileBoundsIndexBuffer:le,tileBoundsSegments:ue}=y.getTileBoundsBuffers(h);Q.draw(y,z.TRIANGLES,w,P,O,Gr.disabled,K,v.id,re,le,ue)}function Jv(y,s,h){if(!s.needsDEMTextureUpload)return;const v=y.context,w=v.gl;v.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||y.getTileTexture(h.stride);const P=h.getPixels();s.demTexture?s.demTexture.update(P,{premultiply:!1}):s.demTexture=new i.T(v,P,w.R32F,{premultiply:!1}),s.needsDEMTextureUpload=!1}function ej(y,s,h){const v=y.context,w=v.gl;if(!s.dem)return;const P=s.dem;if(v.activeTexture.set(w.TEXTURE1),Jv(y,s,P),!s.demTexture)return;s.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);const O=P.dim;v.activeTexture.set(w.TEXTURE0);let L=s.hillshadeFBO;if(!L){const K=new i.T(v,{width:O,height:O,data:null},w.RGBA8);K.bind(w.LINEAR,w.CLAMP_TO_EDGE),L=s.hillshadeFBO=v.createFramebuffer(O,O,!0,"renderbuffer"),L.colorAttachment.set(K.texture)}v.bindFramebuffer.set(L.framebuffer),v.viewport.set([0,0,O,O]);const{tileBoundsBuffer:z,tileBoundsIndexBuffer:G,tileBoundsSegments:H}=y.getMercatorTileBoundsBuffers(),Q=[];y.linearFloatFilteringSupported()&&Q.push("TERRAIN_DEM_FLOAT_FORMAT"),y.getOrCreateProgram("hillshadePrepare",{defines:Q}).draw(y,w.TRIANGLES,Sr.disabled,Yr.disabled,mn.unblended,Gr.disabled,((K,re)=>{const le=re.stride,ue=i.bB();return i.cd(ue,0,i.al,-i.al,0,0,1),i.bq(ue,ue,[0,-i.al,0]),{u_matrix:ue,u_image:1,u_dimension:[le,le],u_zoom:K.overscaledZ}})(s.tileID,P),h.id,z,G,H),s.needsHillshadePrepare=!1}class ea{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class v2 extends ea{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class fw extends ea{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class tj extends ea{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class rj extends ea{getDefault(){return[!0,!0,!0,!0]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class nj extends ea{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class ij extends ea{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class _2 extends ea{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class aj extends ea{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Qv extends ea{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class oj extends ea{getDefault(){return[0,1]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class x2 extends ea{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class pw extends ea{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class e_ extends ea{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class mw extends ea{getDefault(){const s=this.gl;return[s.ONE,s.ZERO,s.ONE,s.ZERO]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Gh extends ea{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class lp extends ea{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(s,s),this.current=s,this.dirty=!1)}}class zg extends ea{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class cp extends ea{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class b2 extends ea{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let gw=class extends ea{getDefault(){return null}set(y){(y!==this.current||this.dirty)&&(this.gl.useProgram(y),this.current=y,this.dirty=!1)}};class w2 extends ea{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class up extends ea{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class t_ extends ea{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class r_ extends ea{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class yw extends ea{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class n_ extends ea{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Bg extends ea{getDefault(){return null}set(s){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class S2 extends ea{getDefault(){return null}set(s){this.gl&&(s!==this.current||this.dirty)&&(this.gl.bindVertexArray(s),this.current=s,this.dirty=!1)}}class E2 extends ea{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class T2 extends ea{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class dp extends ea{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class i_ extends ea{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class sj extends i_{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class A2 extends i_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class lj extends i_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class vw extends A2{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const _w=(y,s,h)=>({u_matrix:y,u_image0:0,u_skirt_height:s,u_ground_shadow_factor:h}),a_=(y,s,h,v,w,P,O,L,z,G,H,Q,K,re,le,ue)=>({u_proj_matrix:Float32Array.from(y),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(v),u_merc_matrix:h,u_zoom_transition:w,u_merc_center:P,u_image0:0,u_frustum_tl:O,u_frustum_tr:L,u_frustum_br:z,u_frustum_bl:G,u_globe_pos:H,u_globe_radius:Q,u_viewport:K,u_grid_matrix:ue?Float32Array.from(ue):new Float32Array(9),u_skirt_height:re,u_far_z_cutoff:le});function o_(y,s){return y!=null&&s!=null&&!(!y.hasData()||!s.hasData())&&y.demTexture!=null&&s.demTexture!=null&&y.tileID.key!==s.tileID.key}const Hh=new class{constructor(){this.operations={}}newMorphing(y,s,h,v,w){if(y in this.operations){const P=this.operations[y];P.to.tileID.key!==h.tileID.key&&(P.queued=h)}else this.operations[y]={startTime:v,phase:0,duration:w,from:s,to:h,queued:null}}getMorphValuesForProxy(y){if(!(y in this.operations))return null;const s=this.operations[y];return{from:s.from,to:s.to,phase:s.phase}}update(y){for(const s in this.operations){const h=this.operations[s];for(h.phase=(y-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,y)){delete this.operations[s];break}}}_nextOp(y,s){return!!y.queued&&(y.from=y.to,y.to=y.queued,y.queued=null,y.phase=0,y.startTime=s,!0)}_validOp(y){return y.from.hasData()&&y.to.hasData()}},xw={0:null,1:"TERRAIN_VERTEX_MORPHING"};function P2(y,s,h){if(s===0)return 0;const v=s<1&&h===514?.25/s:1;return 6*Math.pow(1.5,22-y)*Math.max(s,1)*v}function $g(y,s){const h=1<<y.z;return!s&&(y.x===0||y.x===h-1)||y.y===0||y.y===h-1}const Kh=y=>({u_matrix:y});function s_(y,s,h,v,w){if(w>0){const P=i.o.now(),O=(P-y.timeAdded)/w,L=s?(P-s.timeAdded)/w:-1,z=h.getSource(),G=v.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),H=!s||Math.abs(s.tileID.overscaledZ-G)>Math.abs(y.tileID.overscaledZ-G),Q=H&&y.refreshedUponExpiration?1:i.aA(H?O:1-L,0,1);return s?{opacity:1,mix:1-Q,isFading:O<1}:{opacity:Q,mix:0,isFading:O<1}}return{opacity:1,mix:0,isFading:!1}}class bl extends Ql{constructor(s){const h=ws("mock-dem",{type:"raster-dem",maxzoom:s.transform.maxZoom},s.style.dispatcher,s.style);super("mock-dem",h,!1),h.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,h){s.state="loaded",h(null)}}class bw extends Ql{constructor(s){const h=ws("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},s.style.dispatcher,s.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,h,v){if(s.freezeTileCoverage)return;this.transform=s;const w=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((P,O)=>{if(P[O.key]="",!this._tiles[O.key]){const L=new iu(O,this._source.tileSize*O.overscaleFactor(),s.tileZoom,void 0,void 0,this._source.worldview);L.state="loaded",this._tiles[O.key]=L}return P},{});for(const P in this._tiles)P in w||(this.freeFBO(P),this._tiles[P].unloadVectorData(),delete this._tiles[P])}freeFBO(s){const h=this.proxyCachedFBO[s];if(h!==void 0){const v=Object.values(h);this.renderCachePool.push(...v),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ug extends i.aP{constructor(s,h,v){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=h,this.projMatrix=v}}class Vg extends i.bU{constructor(s,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},s.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[v,w,P]=function(z){const G=new i.bc,H=new i.b0,Q=131;G.reserve(17161),H.reserve(33800);const K=i.al/128,re=i.al+K/2,le=re+K;for(let _e=-K;_e<le;_e+=K)for(let ge=-K;ge<le;ge+=K){const Se=ge<0||ge>re||_e<0||_e>re?24575:0,ke=i.aA(Math.round(ge),0,i.al),Te=i.aA(Math.round(_e),0,i.al);G.emplaceBack(ke+Se,Te)}const ue=(_e,ge)=>{const Se=ge*Q+_e;H.emplaceBack(Se+1,Se,Se+Q),H.emplaceBack(Se+Q,Se+Q+1,Se+1)};for(let _e=1;_e<129;_e++)for(let ge=1;ge<129;ge++)ue(ge,_e);return[0,129].forEach(_e=>{for(let ge=0;ge<130;ge++)ue(ge,_e),ue(_e,ge)}),[G,H,32768]}(),O=s.context;this.gridBuffer=O.createVertexBuffer(v,i.be.members),this.gridIndexBuffer=O.createIndexBuffer(w),this.gridSegments=i.bf.simpleSegment(0,0,v.length,w.length),this.gridNoSkirtSegments=i.bf.simpleSegment(0,0,v.length,P),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new bw(h.map),this.orthoMatrix=i.bB(),i.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.al,0,i.al,0,1);const L=O.gl;this._overlapStencilMode=new Yr({func:L.GEQUAL,mask:255},0,255,L.KEEP,L.KEEP,L.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new bl(h.map),this._pendingGroundEffectLayers=[]}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),this._style=s,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,h,v){if(s&&s.terrain){this._style!==s&&(this.style=s,this._evaluationZoom=void 0);const w=s.terrain.properties,P=s.terrain.drapeRenderMode===0,O=s.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.o.now();const L=s.terrain&&s.terrain.scope,z=w.get("source"),G=P?this._mockSourceCache:s.getSourceCache(z,L);if(!G)return void i.w(`Couldn't find terrain source "${z}".`);if(this.sourceCache=G,this._attenuationRange=s.terrain.getAttenuationRange(),this._exaggeration=O?this.calculateExaggeration(h):w.get("exaggeration"),!h.projection.requiresDraping&&O&&this._exaggeration===0)return void this._disable();this.enabled=!0;const H=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Q=this.getScaledDemTileSize();this.sourceCache.update(h,Q,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,H(),this._initializing=!0),H(),h.updateElevation(!0,v),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(s){if(this._attenuationRange&&s.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(s.zoom);const h=this._previousCameraAltitude,v=s.getFreeCameraOptions().position.z/s.pixelsPerMeter*s.worldSize;this._previousCameraAltitude=v;const w=h!=null?v-h:Number.MAX_VALUE;if(Math.abs(w)<2)return this._exaggeration;const P=s.zoom,O=this._style.terrain;if(!this._previousUpdateTimestamp)return O.getExaggeration(P);let L=P-this._previousZoom;const z=this._previousUpdateTimestamp;let G=P;this._evaluationZoom!=null&&(G=this._evaluationZoom,Math.abs(P-G)>.5&&(L=.5*(P-G+L)),L*w<0&&(G+=L)),this._evaluationZoom=G;const H=O.getExaggeration(G),Q=H===O.getExaggeration(Math.max(0,G-.1));if(Q&&Math.abs(H-this._exaggeration)<.01)return H;let K=Math.min(.1,.00375*(this._updateTimestamp-z));return(Q||H<.1||Math.abs(L)<1e-4)&&(K=Math.min(.2,4*K)),i.ak(this._exaggeration,H,K)}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(s){s.dataType==="source"&&s.coord?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._mergedSourceCaches)this._style._mergedSourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,v=this.painter.transform;this._initializing&&(this._initializing=v._centerAltitude===0&&this.getAtPointOrZero(i.ae.fromLngLat(v.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=h.getIds().map(z=>{const G=h.getTileByID(z).tileID;return G.projMatrix=v.calculateProjMatrix(G.toUnwrapped()),G});(function(z,G){const H=G.transform.pointCoordinate(G.transform.getCameraPoint()),Q=new i.P(H.x,H.y);z.sort((K,re)=>{if(re.overscaledZ-K.overscaledZ)return re.overscaledZ-K.overscaledZ;const le=new i.P(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),ue=new i.P(re.canonical.x+(1<<re.canonical.z)*re.wrap,re.canonical.y),_e=Q.mult(1<<K.canonical.z);return _e.x-=.5,_e.y-=.5,_e.distSqr(le)-_e.distSqr(ue)})})(w,this.painter);const P=this.proxyToSource||{};this.proxyToSource={},w.forEach(z=>{this.proxyToSource[z.key]={}}),this.terrainTileForTile={};const O=this._style._mergedSourceCaches;for(const z in O){const G=O[z];if(!G.used||(G!==this.sourceCache&&this.resetTileLookupCache(G.id),this._setupProxiedCoordsForOrtho(G,s[z],P),G.usedForTerrain))continue;const H=s[z];G.getSource().reparseOverscaled&&this._assignTerrainTiles(H)}this.proxiedCoords[h.id]=w.map(z=>new Ug(z,z.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(P),this.renderingToTexture=!1;const L={};this._visibleDemTiles=[];for(const z of this.proxyCoords){const G=this.terrainTileForTile[z.key];if(!G)continue;const H=G.tileID.key;H in L||(this._visibleDemTiles.push(G),L[H]=H)}}_assignTerrainTiles(s){this._initializing||s.forEach(h=>{if(this.terrainTileForTile[h.key])return;const v=this._findTileCoveringTileID(h,this.sourceCache);v&&(this.terrainTileForTile[h.key]=v)})}_prepareDEMTextures(){const s=this.painter.context,h=s.gl;for(const v in this.terrainTileForTile){const w=this.terrainTileForTile[v],P=w.dem;!P||w.demTexture&&!w.needsDEMTextureUpload||(s.activeTexture.set(h.TEXTURE1),Jv(this.painter,w,P))}}_prepareDemTileUniforms(s,h,v,w){if(!h||h.demTexture==null)return!1;const P=s.tileID.canonical,O=Math.pow(2,h.tileID.canonical.z-P.z),L=w||"";return v[`u_dem_tl${L}`]=[P.x*O%1,P.y*O%1],v[`u_dem_scale${L}`]=O,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let s=0;const h=this._visibleDemTiles.reduce((v,w)=>{if(!w.dem)return v;const P=w.dem.tree.minimums[0];return P>0&&s++,v+P},0);return s?h/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,h=s.gl;s.activeTexture.set(h.TEXTURE2);const v=this._getLoadedAreaMinimum(),w=new i.dK({width:1,height:1},new Float32Array([v]));this._emptyDEMTextureDirty=!1;let P=this._emptyDEMTexture;return P?P.update(w,{premultiply:!1}):P=this._emptyDEMTexture=new i.T(s,w,h.R32F,{premultiply:!1}),P}setupElevationDraw(s,h,v){const w=this.painter.context,P=w.gl,O={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};O.u_exaggeration=this.exaggeration();let L=null,z=null,G=1;if(v&&v.morphing&&this._useVertexMorphing){const re=v.morphing.srcDemTile,le=v.morphing.dstDemTile;G=v.morphing.phase,re&&le&&(this._prepareDemTileUniforms(s,re,O,"_prev")&&(z=re),this._prepareDemTileUniforms(s,le,O)&&(L=le))}const H=re=>re&&re.demTexture&&this.painter.linearFloatFilteringSupported()?P.LINEAR:P.NEAREST;let Q=null;var K;if(this.enabled?z&&L?(Q=L.demTexture,w.activeTexture.set(P.TEXTURE4),z.demTexture.bind(H(z),P.CLAMP_TO_EDGE),O.u_dem_lerp=G):(L=this.terrainTileForTile[s.tileID.key],Q=this._prepareDemTileUniforms(s,L,O)?L.demTexture:this.emptyDEMTexture):Q=this.emptyDEMTexture,w.activeTexture.set(P.TEXTURE2),Q&&(O.u_dem_size=(K=Q).size[0]===1?1:K.size[0]-2,Q.bind(H(L),P.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(v&&v.useDepthForOcclusion,h,O),v&&v.useMeterToDem&&L){const re=(1<<L.tileID.canonical.z)*i.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;O.u_meter_to_dem=re}if(v&&v.labelPlaneMatrixInv&&(O.u_label_plane_matrix_inv=v.labelPlaneMatrixInv),h.setTerrainUniformValues(w,O),this.painter.transform.projection.name==="globe"){const re=this.globeUniformValues(this.painter.transform,s.tileID.canonical,v&&v.useDenormalizedUpVectorScale);h.setGlobeUniformValues(w,re)}}globeUniformValues(s,h,v){const w=s.projection;return{u_tile_tl_up:w.upVector(h,0,0),u_tile_tr_up:w.upVector(h,i.al,0),u_tile_br_up:w.upVector(h,i.al,i.al),u_tile_bl_up:w.upVector(h,0,i.al),u_tile_up_scale:v?i.dL(1):w.upVectorScale(h,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){const h=this.painter,v=this.painter.context;s.length!==0&&(v.bindFramebuffer.set(null),v.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(w,P,O,L,z){if(w.transform.projection.name==="globe")(function(G,H,Q,K,re){const le=G.context,ue=le.gl;let _e,ge;const Se=G.transform,ke=i.dD(G,le,Se),Te=(bt,mt)=>{if(ge===mt)return;const Ot=[xw[mt],"PROJECTION_GLOBE_VIEW"];ke&&Ot.push("CUSTOM_ANTIALIASING");const Zt=G.isTileAffectedByFog(bt);_e=G.getOrCreateProgram("globeRaster",{defines:Ot,overrideFog:Zt}),ge=mt},$e=G.colorModeForRenderPass(),Re=new Sr(ue.LEQUAL,Sr.ReadWrite,G.depthRangeFor3D);Hh.update(re);const Ve=i.dE(Se),Be=[i.aF(Se.center.lng),i.aJ(Se.center.lat)],De=G.globeSharedBuffers,We=[Se.width*i.o.devicePixelRatio,Se.height*i.o.devicePixelRatio],lt=Float32Array.from(Se.globeMatrix),it={useDenormalizedUpVectorScale:!0};{const bt=G.transform,mt=P2(bt.zoom,H.exaggeration(),H.sourceCache._source.tileSize);ge=-1;const Ot=ue.TRIANGLES;for(const Zt of K){const pt=Q.getTile(Zt),et=Yr.disabled,kt=H.prevTerrainTileForTile[Zt.key],gt=H.terrainTileForTile[Zt.key];o_(kt,gt)&&Hh.newMorphing(Zt.key,kt,gt,re,250),le.activeTexture.set(ue.TEXTURE0),pt.texture&&pt.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);const Lt=Hh.getMorphValuesForProxy(Zt.key),Qt=Lt?1:0;Lt&&Object.assign(it,{morphing:{srcDemTile:Lt.from,dstDemTile:Lt.to,phase:i.dC(Lt.phase)}});const vr=i.dF(Zt.canonical),Gt=i.dG(vr.getCenter().lat),Yt=i.dH(Zt.canonical,vr,Gt,bt.worldSize/bt._pixelsPerMercatorPixel),br=i.bj(i.dI(Zt.canonical)),hr=a_(bt.expandedFarZProjMatrix,lt,Ve,br,i.aj(bt.zoom),Be,bt.frustumCorners.TL,bt.frustumCorners.TR,bt.frustumCorners.BR,bt.frustumCorners.BL,bt.globeCenterInViewSpace,bt.globeRadius,We,mt,bt._farZ,Yt);if(Te(Zt,Qt),_e&&(H.setupElevationDraw(pt,_e,it),G.uploadCommonUniforms(le,_e,Zt.toUnwrapped()),De)){const[cr,fr,Mr]=De.getGridBuffers(Gt,mt!==0);_e.draw(G,Ot,Re,et,$e,Gr.backCCW,hr,"globe_raster",cr,fr,Mr)}}}if(De&&(G.renderDefaultNorthPole||G.renderDefaultSouthPole)){const bt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ke&&bt.push("CUSTOM_ANTIALIASING"),_e=G.getOrCreateProgram("globeRaster",{defines:bt});for(const mt of K){const{x:Ot,y:Zt,z:pt}=mt.canonical,et=Zt===0,kt=Zt===(1<<pt)-1,[gt,Lt,Qt,vr]=De.getPoleBuffers(pt,!1);if(vr&&(et||kt)){const Gt=Q.getTile(mt);le.activeTexture.set(ue.TEXTURE0),Gt.texture&&Gt.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);let Yt=i.dJ(pt,Ot,Se);const br=i.bj(i.dI(mt.canonical)),hr=(cr,fr)=>cr.draw(G,ue.TRIANGLES,Re,Yr.disabled,$e,Gr.disabled,a_(Se.expandedFarZProjMatrix,Yt,Yt,br,0,Be,Se.frustumCorners.TL,Se.frustumCorners.TR,Se.frustumCorners.BR,Se.frustumCorners.BL,Se.globeCenterInViewSpace,Se.globeRadius,We,0,Se._farZ),"globe_pole_raster",fr,Qt,vr);H.setupElevationDraw(Gt,_e,it),G.uploadCommonUniforms(le,_e,mt.toUnwrapped()),et&&G.renderDefaultNorthPole&&hr(_e,gt),kt&&G.renderDefaultSouthPole&&(Yt=i.cR(i.bB(),Yt,[1,-1,1]),hr(_e,Lt))}}}})(w,P,O,L,z);else{const G=w.context,H=G.gl;let Q,K;const re=w.shadowRenderer,le=qu(w,w.longestCutoffRange),ue=$e=>{if(K===$e)return;const Re=[];Re.push(xw[$e]),le.shouldRenderCutoff&&Re.push("RENDER_CUTOFF"),re&&(Re.push("RENDER_SHADOWS","DEPTH_TEXTURE"),re.useNormalOffset&&Re.push("NORMAL_OFFSET")),Q=w.getOrCreateProgram("terrainRaster",{defines:Re}),K=$e},_e=w.colorModeForRenderPass(),ge=new Sr(H.LEQUAL,Sr.ReadWrite,w.depthRangeFor3D);Hh.update(z);const Se=w.transform,ke=P2(Se.zoom,P.exaggeration(),P.sourceCache._source.tileSize);let Te=[0,0,0];if(re){const $e=w.style.directionalLight,Re=w.style.ambientLight;$e&&Re&&(Te=rc(w.style,$e,Re))}{K=-1;const $e=H.TRIANGLES,[Re,Ve]=[P.gridIndexBuffer,P.gridSegments];for(const Be of L){const De=O.getTile(Be),We=Yr.disabled,lt=P.prevTerrainTileForTile[Be.key],it=P.terrainTileForTile[Be.key];o_(lt,it)&&Hh.newMorphing(Be.key,lt,it,z,250),G.activeTexture.set(H.TEXTURE0),De.texture&&De.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const bt=Hh.getMorphValuesForProxy(Be.key),mt=bt?1:0;let Ot;bt&&(Ot={morphing:{srcDemTile:bt.from,dstDemTile:bt.to,phase:i.dC(bt.phase)}});const Zt=_w(Be.projMatrix,$g(Be.canonical,Se.renderWorldCopies)?ke/10:ke,Te);if(ue(mt),!Q)continue;P.setupElevationDraw(De,Q,Ot);const pt=Be.toUnwrapped();re&&re.setupShadows(pt,Q),w.uploadCommonUniforms(G,Q,pt,null,le),Q.draw(w,$e,ge,We,_e,Gr.backCCW,Zt,"terrain_raster",P.gridBuffer,Re,Ve)}}}}(h,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;const h=this.painter,v=this.painter.context,w=this.proxySourceCache,P=this.proxiedCoords[w.id],O=this._drapedRenderBatches.shift(),L=h.style.order,z=[];let G=0;for(const H of P){const Q=w.getTileByID(H.proxyTileKey),K=w.proxyCachedFBO[H.key]?w.proxyCachedFBO[H.key][s]:void 0,re=K!==void 0?w.renderCache[K]:this.pool[G++],le=K!==void 0;if(Q.texture=re.tex,le&&!re.dirty){z.push(Q.tileID);continue}let ue;v.bindFramebuffer.set(re.fb.framebuffer),this.renderedToTile=!1,re.dirty&&(v.clear({color:i.ao.transparent,stencil:0}),re.dirty=!1);for(let _e=O.start;_e<=O.end;++_e){const ge=h.style._mergedLayers[L[_e]];if(ge.isHidden(h.transform.zoom))continue;const Se=h.style.getLayerSourceCache(ge),ke=Se?this.proxyToSource[H.key][Se.id]:[H];if(!ke)continue;const Te=ke;v.viewport.set([0,0,re.fb.width,re.fb.height]),ue!==(Se?Se.id:null)&&(this._setupStencil(re,ke,ge,Se),ue=Se?Se.id:null),h.renderLayer(h,Se,ge,Te)}if(this._drapedRenderBatches.length===0)for(const _e of this._pendingGroundEffectLayers){const ge=h.style._mergedLayers[L[_e]];if(ge.isHidden(h.transform.zoom))continue;const Se=h.style.getLayerSourceCache(ge),ke=Se?this.proxyToSource[H.key][Se.id]:[H];if(!ke)continue;const Te=ke;v.viewport.set([0,0,re.fb.width,re.fb.height]),ue!==(Se?Se.id:null)&&(this._setupStencil(re,ke,ge,Se),ue=Se?Se.id:null),h.renderLayer(h,Se,ge,Te)}this.renderedToTile?(re.dirty=!0,z.push(Q.tileID)):le||--G,G===5&&(G=0,this.renderToBackBuffer(z))}return this.renderToBackBuffer(z),this.renderingToTexture=!1,v.bindFramebuffer.set(null),v.viewport.set([0,0,h.width,h.height]),O.end+1}postRender(){}isLayerOrderingCorrect(s){const h=s.order.length;let v=-1,w=h;for(let P=0;P<h;++P)this._style.isLayerDraped(s._mergedLayers[s.order[P]])?v=Math.max(v,P):w=Math.min(w,P);return w>v}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{s=Math.min(s,h.dem.tree.minimums[0])}),s===0?s:(s-30)*this._exaggeration}raycast(s,h,v){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(P=>P.dem).map(P=>{const O=P.tileID,L=1<<O.overscaledZ,{x:z,y:G}=O.canonical,H=z/L,Q=(z+1)/L,K=G/L,re=(G+1)/L;return{minx:H,miny:K,maxx:Q,maxy:re,t:P.dem.tree.raycastRoot(H,K,Q,re,s,h,v),tile:P}});w.sort((P,O)=>(P.t!==null?P.t:Number.MAX_VALUE)-(O.t!==null?O.t:Number.MAX_VALUE));for(const P of w){if(P.t==null)return null;const O=P.tile.dem.tree.raycast(P.minx,P.miny,P.maxx,P.maxy,s,h,v);if(O!=null)return O}return null}_createFBO(){const s=this.painter.context,h=s.gl,v=this.drapeBufferSize;s.activeTexture.set(h.TEXTURE0);const w=new i.T(s,{width:v[0],height:v[1],data:null},h.RGBA8);w.bind(h.LINEAR,h.CLAMP_TO_EDGE);const P=s.createFramebuffer(v[0],v[1],!0,null);return P.colorAttachment.set(w.texture),P.depthAttachment=new vw(s,P.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,v[0],v[1]),this._stencilRef=0,P.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):P.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:P,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const h=this._style._mergedLayers[s],v=h.isHidden(this.painter.transform.zoom);return h.type==="hillshade"||h.type==="custom"?!v&&h.shouldRedrape():!v&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(const v of this._style.getSources())if(v instanceof as){s=!0;break}if(!s)return;const h={};for(let v=0;v<this._style.order.length;++v){const w=this._style._mergedLayers[this._style.order[v]],P=this._style.getLayerSourceCache(w);if(P&&!h[P.id]&&!w.isHidden(this.painter.transform.zoom)&&w.type==="line"&&w.widthExpression()instanceof i.ad){h[P.id]=!0;for(const O of this.proxyCoords){const L=this.proxyToSource[O.key][P.id];if(L)for(const z of L)this._clearRenderCacheForTile(P.id,z)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(const v in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[v]._source instanceof Yl){s=!0;break}if(!s)return;const h={};for(let v=0;v<this._style.order.length;++v){const w=this._style._mergedLayers[this._style.order[v]],P=this._style.getLayerSourceCache(w);if(!P||h[P.id]||w.isHidden(this.painter.transform.zoom)||w.type!=="raster")continue;const O=w.paint.get("raster-fade-duration");for(const L of this.proxyCoords){const z=this.proxyToSource[L.key][P.id];if(z)for(const G of z){const H=s_(P.getTile(G),P.findLoadedParent(G,0),P,this.painter.transform,O);(H.opacity!==1||H.mix!==0)&&this._clearRenderCacheForTile(P.id,G)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const s=this._style.order,h=s.length;if(h===0)return;const v=[];this._pendingGroundEffectLayers=[];let w,P=0,O=this._style._mergedLayers[s[P]];for(;!this._style.isLayerDraped(O)&&O.isHidden(this.painter.transform.zoom)&&++P<h;)O=this._style._mergedLayers[s[P]];for(;P<h;++P){const L=this._style._mergedLayers[s[P]];L.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(L)?w===void 0&&(w=P):(L.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(P),w!==void 0&&(v.push({start:w,end:P-1}),w=void 0)))}if(w!==void 0&&v.push({start:w,end:P-1}),v.length!==0){const L=v[v.length-1];this._pendingGroundEffectLayers.every(z=>z>L.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=v}_setupRenderCache(s){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const O=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let L=0;L<O.length;++L){const z=Object.values(O[L]);h.renderCachePool.push(...z)}}return}this._clearRasterLayersFromRenderCache();const v=this.proxyCoords,w=this._tilesDirty;for(let O=v.length-1;O>=0;O--){const L=v[O];if(h.getTileByID(L.key),h.proxyCachedFBO[L.key]!==void 0){const z=s[L.key],G=this.proxyToSource[L.key];let H=0;for(const Q in G){const K=G[Q],re=z[Q];if(!re||re.length!==K.length||K.some((le,ue)=>le!==re[ue]||w[Q]&&w[Q].hasOwnProperty(le.key))){H=-1;break}++H}for(const Q in h.proxyCachedFBO[L.key])h.renderCache[h.proxyCachedFBO[L.key][Q]].dirty=H<0||H!==Object.values(z).length}}const P=[...this._drapedRenderBatches];P.sort((O,L)=>L.end-L.start-(O.end-O.start));for(const O of P)for(const L of v){if(h.proxyCachedFBO[L.key])continue;let z=h.renderCachePool.pop();z===void 0&&h.renderCache.length<50&&(z=h.renderCache.length,h.renderCache.push(this._createFBO())),z!==void 0&&(h.proxyCachedFBO[L.key]={},h.proxyCachedFBO[L.key][O.start]=z,h.renderCache[z].dirty=!0)}this._tilesDirty={}}_setupStencil(s,h,v,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const P=this.painter.context,O=P.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let L;if(v.isTileClipped())L=h.length,this._overlapStencilMode.test={func:O.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);L=1,this._overlapStencilMode.test={func:O.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+L>255&&(P.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=L,this._overlapStencilMode.ref=this._stencilRef,v.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):Yr.disabled}_renderTileClippingMasks(s,h){const v=this.painter,w=this.painter.context,P=w.gl;v._tileClippingMaskIDs={},w.setColorMode(mn.disabled),w.setDepthMode(Sr.disabled);const O=v.getOrCreateProgram("clippingMask");for(const L of s){const z=v._tileClippingMaskIDs[L.key]=--h;O.draw(v,P.TRIANGLES,Sr.disabled,new Yr({func:P.ALWAYS,mask:0},z,255,P.KEEP,P.KEEP,P.REPLACE),mn.disabled,Gr.disabled,Kh(L.projMatrix),"$clipping",v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}pointCoordinate(s){const h=this.painter.transform;if(s.x<0||s.x>h.width||s.y<0||s.y>h.height)return null;const v=[s.x,s.y,1,1];i.aC(v,v,h.pixelMatrixInverse),i.cJ(v,v,1/v[3]),v[0]/=h.worldSize,v[1]/=h.worldSize;const w=h._camera.position,P=i.ce(1,h.center.lat),O=[w[0],w[1],w[2]/P,0],L=i.d9([],v.slice(0,3),O);i.aw(L,L);const z=this.raycast(O,L,this._exaggeration);return z!==null&&z?(i.bG(O,O,L,z),O[3]=O[2],O[2]*=P,O):null}_setupProxiedCoordsForOrtho(s,h,v){if(s.getSource()instanceof i.aT)return this._setupProxiedCoordsForImageSource(s,h,v);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const w=this.proxiedCoords[s.id]=[],P=this.proxyCoords;for(let z=0;z<P.length;z++){const G=P[z],H=this._findTileCoveringTileID(G,s);if(H){const Q=this._createProxiedId(G,H,v[G.key]&&v[G.key][s.id]);w.push(Q),this.proxyToSource[G.key][s.id]=[Q]}}let O=!1;const L=new Set;for(let z=0;z<h.length;z++){const G=s.getTile(h[z]);if(!G||!G.hasData())continue;const H=this._findTileCoveringTileID(G.tileID,this.proxySourceCache);if(H&&H.tileID.canonical.z!==G.tileID.canonical.z){const Q=this.proxyToSource[H.tileID.key][s.id],K=this._createProxiedId(H.tileID,G,v[H.tileID.key]&&v[H.tileID.key][s.id]);Q?Q.splice(Q.length-1,0,K):this.proxyToSource[H.tileID.key][s.id]=[K];const re=this.proxyToSource[H.tileID.key][s.id];L.has(re)||L.add(re),w.push(K),O=!0}}if(this._sourceTilesOverlap[s.id]=O,O&&this._debugParams.sortTilesHiZFirst)for(const z of L)z.sort((G,H)=>H.overscaledZ-G.overscaledZ)}_setupProxiedCoordsForImageSource(s,h,v){if(!s.getSource().loaded())return;const w=this.proxiedCoords[s.id]=[],P=this.proxyCoords,O=s.getSource(),L=O.tileID;if(!L)return;const z=new i.P(L.x,L.y)._div(1<<L.z),G=O.coordinates.map(i.ae.fromLngLat).reduce((Q,K)=>(Q.min.x=Math.min(Q.min.x,K.x-z.x),Q.min.y=Math.min(Q.min.y,K.y-z.y),Q.max.x=Math.max(Q.max.x,K.x-z.x),Q.max.y=Math.max(Q.max.y,K.y-z.y),Q),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),H=(Q,K)=>{const re=Q.wrap+Q.canonical.x/(1<<Q.canonical.z),le=Q.canonical.y/(1<<Q.canonical.z),ue=i.al/(1<<Q.canonical.z),_e=K.wrap+K.canonical.x/(1<<K.canonical.z),ge=K.canonical.y/(1<<K.canonical.z);return re+ue<_e+G.min.x||re>_e+G.max.x||le+ue<ge+G.min.y||le>ge+G.max.y};for(let Q=0;Q<P.length;Q++){const K=P[Q];for(let re=0;re<h.length;re++){const le=s.getTile(h[re]);if(!le||!le.hasData()||H(K,le.tileID))continue;const ue=this._createProxiedId(K,le,v[K.key]&&v[K.key][s.id]),_e=this.proxyToSource[K.key][s.id];_e?_e.push(ue):this.proxyToSource[K.key][s.id]=[ue],w.push(ue)}}}_createProxiedId(s,h,v){let w=this.orthoMatrix;if(v){const P=v.find(O=>O.key===h.tileID.key);if(P)return P}if(h.tileID.key!==s.key){const P=s.canonical.z-h.tileID.canonical.z;let O,L,z;w=i.bB();const G=h.tileID.wrap-s.wrap<<s.overscaledZ;P>0?(O=i.al>>P,L=O*((h.tileID.canonical.x<<P)-s.canonical.x+G),z=O*((h.tileID.canonical.y<<P)-s.canonical.y)):(O=i.al<<-P,L=i.al*(h.tileID.canonical.x-(s.canonical.x+G<<-P)),z=i.al*(h.tileID.canonical.y-(s.canonical.y<<-P))),i.cd(w,0,O,0,O,0,1),i.bq(w,w,[L,z,0])}return new Ug(h.tileID,s.key,w)}_findTileCoveringTileID(s,h){let v=h.getTile(s);if(v&&v.hasData())return v;const w=this._findCoveringTileCache[h.id],P=w[s.key];if(v=P?h.getTileByID(P):null,v&&v.hasData()||P===null)return v;let O=v?v.tileID:s,L=O.overscaledZ;const z=h.getSource().minzoom,G=[];if(!P){const Q=h.getSource().maxzoom;if(s.canonical.z>=Q){const K=s.canonical.z-Q;h.getSource().reparseOverscaled?(L=Math.max(s.canonical.z+2,h.transform.tileZoom),O=new i.aP(L,s.wrap,Q,s.canonical.x>>K,s.canonical.y>>K)):K!==0&&(L=Q,O=new i.aP(L,s.wrap,Q,s.canonical.x>>K,s.canonical.y>>K))}O.key!==s.key&&(G.push(O.key),v=h.getTile(O))}const H=Q=>{G.forEach(K=>{w[K]=Q}),G.length=0};for(L-=1;L>=z&&(!v||!v.hasData());L--){v&&H(v.tileID.key);const Q=O.calculateScaledKey(L);if(v=h.getTileByID(Q),v&&v.hasData())break;const K=w[Q];if(K===null)break;K===void 0?G.push(Q):v=h.getTileByID(K)}return H(v?v.tileID.key:null),v&&v.hasData()?v:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,h){let v=this._tilesDirty[s];v||(v=this._tilesDirty[s]={}),v[h.key]=!0}}function ww(y,s,h){const v=function(L,z,G){const H=i.bI(z,L),Q=i.bI(G,[.2126,.7152,.0722]),K=(le,ue,_e)=>(1-_e)*le+_e*ue,re=K(1-.3*Math.min(Q,1),1,Math.min(H+1,1));return K(.92,1,Math.asin(i.aA(z[2],-1,1))/Math.PI+.5)*re}(y,[0,0,1],s),w=[0,0,0];i.c4(w,h.slice(0,3),v);const P=[0,0,0];i.c4(P,s.slice(0,3),y[2]);const O=[0,0,0];return i.d7(O,w,P),i.da(O)}const Sw=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Ew=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class qg{static cacheKey(s,h,v,w){let P=`${h}${w?w.cacheKey:""}`;for(const O of v)s.usedDefines.includes(O)&&(P+=`/${O}`);return P}constructor(s,h,v,w,P,O){const L=s.gl;this.program=L.createProgram(),this.configuration=w,this.name=h,this.fixedDefines=[...O];let z=w?w.defines():[];z=z.concat(O.map(le=>`#define ${le}`));const G=`#version 300 es
`;let H=G+z.concat("precision mediump float;",su,Fg.fragmentSource).join(`
`);for(const le of v.fragmentIncludes)H+=`
${op[le]}`;H+=`
${v.fragmentSource}`;let Q=G+z.concat("precision highp float;",su,Fg.vertexSource).join(`
`);for(const le of v.vertexIncludes)Q+=`
${op[le]}`;this.forceManualRenderingForInstanceIDShaders=s.forceManualRenderingForInstanceIDShaders&&v.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(Q+=`
uniform int u_instanceID;
`),Q+=`
${v.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(Q=Q.replaceAll("gl_InstanceID","u_instanceID"));const K=L.createShader(L.FRAGMENT_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);L.shaderSource(K,H),L.compileShader(K),L.attachShader(this.program,K);const re=L.createShader(L.VERTEX_SHADER);L.isContextLost()?this.failedToCreate=!0:(L.shaderSource(re,Q),L.compileShader(re),L.attachShader(this.program,re),this.attributes={},L.linkProgram(this.program),L.deleteShader(re),L.deleteShader(K),this.fixedUniforms=P(s),this.binderUniforms=w?w.getUniforms(s):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(le=>({u_instanceID:new i.cg(le)}))(s)),(O.includes("TERRAIN")||h.indexOf("symbol")!==-1||h.indexOf("circle")!==-1)&&(this.terrainUniforms=(le=>({u_dem:new i.cg(le),u_dem_prev:new i.cg(le),u_dem_tl:new i.cj(le),u_dem_scale:new i.ci(le),u_dem_tl_prev:new i.cj(le),u_dem_scale_prev:new i.ci(le),u_dem_size:new i.ci(le),u_dem_lerp:new i.ci(le),u_exaggeration:new i.ci(le),u_depth:new i.cg(le),u_depth_size_inv:new i.cj(le),u_depth_range_unpack:new i.cj(le),u_occluder_half_size:new i.ci(le),u_occlusion_depth_offset:new i.ci(le),u_meter_to_dem:new i.ci(le),u_label_plane_matrix_inv:new i.ck(le)}))(s)),O.includes("GLOBE")&&(this.globeUniforms=(le=>({u_tile_tl_up:new i.ch(le),u_tile_tr_up:new i.ch(le),u_tile_br_up:new i.ch(le),u_tile_bl_up:new i.ch(le),u_tile_up_scale:new i.ci(le)}))(s)),O.includes("FOG")&&(this.fogUniforms=(le=>({u_fog_matrix:new i.ck(le),u_fog_range:new i.cj(le),u_fog_color:new i.d2(le),u_fog_horizon_blend:new i.ci(le),u_fog_vertical_limit:new i.cj(le),u_fog_temporal_offset:new i.ci(le),u_frustum_tl:new i.ch(le),u_frustum_tr:new i.ch(le),u_frustum_br:new i.ch(le),u_frustum_bl:new i.ch(le),u_globe_pos:new i.ch(le),u_globe_radius:new i.ci(le),u_globe_transition:new i.ci(le),u_is_globe:new i.cg(le),u_viewport:new i.cj(le)}))(s)),O.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(le=>({u_cutoff_params:new i.d2(le)}))(s)),O.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(le=>({u_lighting_ambient_color:new i.ch(le),u_lighting_directional_dir:new i.ch(le),u_lighting_directional_color:new i.ch(le),u_ground_radiance:new i.ch(le)}))(s)),O.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(le=>({u_light_matrix_0:new i.ck(le),u_light_matrix_1:new i.ck(le),u_fade_range:new i.cj(le),u_shadow_normal_offset:new i.ch(le),u_shadow_intensity:new i.ci(le),u_shadow_texel_size:new i.ci(le),u_shadow_map_resolution:new i.ci(le),u_shadow_direction:new i.ch(le),u_shadow_bias:new i.ch(le),u_shadowmap_0:new i.cg(le),u_shadowmap_1:new i.cg(le)}))(s)))}getAttributeLocation(s,h){let v=this.attributes[h];return v===void 0&&(v=this.attributes[h]=s.getAttribLocation(this.program,h)),v}setTerrainUniformValues(s,h){if(!this.terrainUniforms)return;const v=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const w in h)v[w]&&v[w].set(this.program,w,h[w])}}setGlobeUniformValues(s,h){if(!this.globeUniforms)return;const v=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const w in h)v[w]&&v[w].set(this.program,w,h[w])}}setFogUniformValues(s,h){if(!this.fogUniforms)return;const v=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const w in h)v[w].set(this.program,w,h[w])}}setCutoffUniformValues(s,h){if(!this.cutoffUniforms)return;const v=this.cutoffUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const w in h)v[w].set(this.program,w,h[w])}}setLightsUniformValues(s,h){if(!this.lightsUniforms)return;const v=this.lightsUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const w in h)v[w].set(this.program,w,h[w])}}setShadowUniformValues(s,h){if(this.failedToCreate||!this.shadowUniforms)return;const v=this.shadowUniforms;s.program.set(this.program);for(const w in h)v[w].set(this.program,w,h[w])}_drawDebugWireframe(s,h,v,w,P,O,L,z,G,H){const Q=s.options.wireframe;if(Q.terrain===!1&&Q.layers2D===!1&&Q.layers3D===!1)return;const K=s.context;if(!(!(!Q.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!Q.layers2D||s._terrain&&s._terrain.renderingToTexture||!Sw.includes(this.name))||!(!Q.layers3D||!Ew.includes(this.name))))return;const re=K.gl,le=s.wireframeDebugCache.getLinesFromTrianglesBuffer(s.frameCounter,P,K);if(!le)return;const ue=[...this.fixedDefines];ue.push("DEBUG_WIREFRAME");const _e=s.getOrCreateProgram(this.name,{config:this.configuration,defines:ue});K.program.set(_e.program);const ge=(Te,$e,Re)=>{if($e[Te]&&Re[Te])for(const Ve in $e[Te])Re[Te][Ve]&&Re[Te][Ve].set(Re.program,Ve,$e[Te][Ve].current)};G&&G.setUniforms(_e.program,K,_e.binderUniforms,L,{zoom:z}),ge("fixedUniforms",this,_e),ge("terrainUniforms",this,_e),ge("globeUniforms",this,_e),ge("fogUniforms",this,_e),ge("lightsUniforms",this,_e),ge("shadowUniforms",this,_e),le.bind(),K.setColorMode(new mn([re.ONE,re.ONE_MINUS_SRC_ALPHA,re.ZERO,re.ONE],i.ao.transparent,[!0,!0,!0,!1])),K.setDepthMode(new Sr(h.func===re.LESS?re.LEQUAL:h.func,Sr.ReadOnly,h.range)),K.setStencilMode(Yr.disabled);const Se=3*O.primitiveLength*2,ke=3*O.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Te=H||1;for(let $e=0;$e<Te;++$e)_e.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",$e),re.drawElements(re.LINES,Se,re.UNSIGNED_SHORT,ke)}else H&&H>1?re.drawElementsInstanced(re.LINES,Se,re.UNSIGNED_SHORT,ke,H):re.drawElements(re.LINES,Se,re.UNSIGNED_SHORT,ke);P.bind(),K.program.set(this.program),K.setDepthMode(h),K.setStencilMode(v),K.setColorMode(w)}checkUniforms(s,h,v){if(this.fixedDefines.includes(h)){for(const w of Object.keys(v))if(!v[w].initialized)throw new Error(`Program '${this.name}', from draw '${s}': uniform ${w} not set but required by ${h} being defined`)}}draw(s,h,v,w,P,O,L,z,G,H,Q,K,re,le,ue,_e){const ge=s.context,Se=ge.gl;if(this.failedToCreate)return;ge.program.set(this.program),ge.setDepthMode(v),ge.setStencilMode(w),ge.setColorMode(P),ge.setCullFace(O);for(const $e of Object.keys(this.fixedUniforms))this.fixedUniforms[$e].set(this.program,$e,L[$e]);le&&le.setUniforms(this.program,ge,this.binderUniforms,K,{zoom:re});const ke={[Se.POINTS]:1,[Se.LINES]:2,[Se.TRIANGLES]:3,[Se.LINE_STRIP]:1}[h];this.checkUniforms(z,"RENDER_SHADOWS",this.shadowUniforms);const Te=_e&&_e>0?1:void 0;for(const $e of Q.get()){const Re=$e.vaos||($e.vaos={});if((Re[z]||(Re[z]=new sp)).bind(ge,this,G,le?le.getPaintVertexBuffers():[],H,$e.vertexOffset,ue||[],Te),this.forceManualRenderingForInstanceIDShaders){const Ve=_e||1;for(let Be=0;Be<Ve;++Be)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Be),H?Se.drawElements(h,$e.primitiveLength*ke,Se.UNSIGNED_SHORT,$e.primitiveOffset*ke*2):Se.drawArrays(h,$e.vertexOffset,$e.vertexLength)}else _e&&_e>1?Se.drawElementsInstanced(h,$e.primitiveLength*ke,Se.UNSIGNED_SHORT,$e.primitiveOffset*ke*2,_e):H?Se.drawElements(h,$e.primitiveLength*ke,Se.UNSIGNED_SHORT,$e.primitiveOffset*ke*2):Se.drawArrays(h,$e.vertexOffset,$e.vertexLength);h===Se.TRIANGLES&&H&&this._drawDebugWireframe(s,v,w,P,H,$e,K,re,le,_e)}}}function l_(y,s,h=0){const v=Math.pow(2,s.tileID.overscaledZ),w=s.tileSize*Math.pow(2,y.transform.tileZoom)/v,P=w*(s.tileID.canonical.x+s.tileID.wrap*v),O=w*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.ay(s,1,y.transform.tileZoom),u_pixel_coord_upper:[P>>16,O>>16],u_pixel_coord_lower:[65535&P,65535&O],u_pattern_transition:h}}const hp={terrain:0,flat:1},c_=i.bB(),u_=(y,s,h,v,w,P,O,L,z,G,H,Q,K,re,le,ue,_e,ge)=>{const Se=s.style.light,ke=Se.properties.get("position"),Te=[ke.x,ke.y,ke.z],$e=i.dN();Se.properties.get("anchor")==="viewport"&&(i.dO($e,-s.transform.angle),i.dP(Te,Te,$e));const Re=Se.properties.get("color").toPremultipliedRenderColor(null),Ve=s.transform,Be={u_matrix:y,u_lightpos:Te,u_lightintensity:Se.properties.get("intensity"),u_lightcolor:[Re.r,Re.g,Re.b],u_vertical_gradient:+h,u_opacity:v,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:c_,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:hp[G],u_base_type:hp[H],u_ao:w,u_edge_radius:P,u_width_scale:O,u_flood_light_color:le,u_vertical_scale:ue,u_flood_light_intensity:_e,u_ground_shadow_factor:ge};return Ve.projection.name==="globe"&&(Be.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],Be.u_zoom_transition=Q,Be.u_inv_rot_matrix=re,Be.u_merc_center=K,Be.u_up_dir=Ve.projection.upVector(new i.cC(0,0,0),K[0]*i.al,K[1]*i.al),Be.u_height_lift=z),Be},C2=(y,s,h,v,w,P)=>({u_matrix:y,u_edge_radius:s,u_width_scale:h,u_vertical_scale:v,u_height_type:hp[w],u_base_type:hp[P]}),O2=(y,s,h,v,w,P,O,L,z,G,H,Q,K,re,le,ue,_e,ge)=>{const Se=u_(y,s,h,v,w,P,O,L,G,H,Q,K,re,le,ue,_e,1,[0,0,0]),ke={u_height_factor:-Math.pow(2,L.overscaledZ)/z.tileSize/8};return Object.assign(Se,l_(s,z,ge),ke)},fp=(y,s,h,v,w,P,O,L,z,G,H)=>({u_matrix:s,u_opacity:h,u_ao_pass:v?1:0,u_meter_to_tile:w,u_ao:P,u_flood_light_intensity:O,u_flood_light_color:L,u_attenuation:z,u_edge_radius:G,u_fb:0,u_fb_size:H,u_dynamic_offset:1}),k2=(y,s,h)=>({u_matrix:y,u_emissive_strength:s,u_ground_shadow_factor:h}),I2=(y,s,h,v,w,P=0)=>Object.assign(k2(y,s,w),l_(h,v,P)),cj=(y,s,h,v)=>({u_matrix:y,u_world:h,u_emissive_strength:s,u_ground_shadow_factor:v}),uj=(y,s,h,v,w,P,O=0)=>Object.assign(I2(y,s,h,v,P,O),{u_world:w}),dj=(y,s)=>({u_matrix:y,u_ground_shadow_factor:s}),d_=(y,s,h,v,w)=>({u_matrix:y,u_camera_pos:[s[0],s[1],s[2]],u_depth_bias:h,u_height_scale:v,u_reset_depth:w}),Tw=(y,s,h,v,w,P,O,L,z)=>({u_matrix:y,u_normal_matrix:s,u_opacity:h,u_faux_facade_ao_intensity:v,u_camera_pos:w,u_tile_to_meter:P,u_facade_emissive_chance:O,u_flood_light_color:L,u_flood_light_intensity:z}),Aw=y=>({u_matrix:y}),R2=y=>({u_matrix:y}),pp=(y,s,h,v,w,P,O,L)=>{const z=i.al/P.tileSize;return{u_matrix:y,u_inv_rot_matrix:s,u_camera_to_center_distance:h.getCameraToCenterDistance(L),u_extrude_scale:[h.pixelsToGLUnits[0]/z,h.pixelsToGLUnits[1]/z],u_zoom_transition:v,u_tile_id:O,u_merc_center:w}},Pw=(y,s,h=1)=>({u_matrix:y,u_color:s,u_overlay:0,u_overlay_scale:h}),j2=i.bB(),N2=(y,s,h,v,w,P,O)=>{const L=y.transform,z=L.projection.name==="globe",G=z?i.dQ(L.zoom,s.canonical)*L._pixelsPerMercatorPixel:i.ay(h,1,P),H={u_matrix:s.projMatrix,u_extrude_scale:G,u_intensity:O,u_inv_rot_matrix:j2,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(z){H.u_inv_rot_matrix=v,H.u_merc_center=w,H.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],H.u_zoom_transition=i.aj(L.zoom);const Q=w[0]*i.al,K=w[1]*i.al;H.u_up_dir=L.projection.upVector(new i.cC(0,0,0),Q,K)}return H};function h_(y,[s,h,v,w],[P,O]){if(P===O)return[0,0,0,0];const L=255*(y-1)/(y*(O-P));return[s*L,h*L,v*L,w*L]}function Wu(y,s,[h,v]){return h===v?0:.5/y+(s-h)*(y-1)/(y*(v-h))}const Wg=(y,s,h,v,w,P,O,L,z,G,H,Q,K,re,le,ue,_e,ge,Se,ke,Te)=>({u_matrix:y,u_normalize_matrix:s,u_globe_matrix:h,u_merc_matrix:v,u_grid_matrix:w,u_tl_parent:P,u_scale_parent:G,u_fade_t:H.mix,u_opacity:H.opacity*Q.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Q.paint.get("raster-brightness-min"),u_brightness_high:Q.paint.get("raster-brightness-max"),u_saturation_factor:i.dS(Q.paint.get("raster-saturation")),u_contrast_factor:i.dR(Q.paint.get("raster-contrast")),u_spin_weights:f_(Q.paint.get("raster-hue-rotate")),u_perspective_transform:K,u_raster_elevation:re,u_zoom_transition:O,u_merc_center:L,u_cutoff_params:z,u_colorization_mix:h_(i.dT,ue,ge),u_colorization_offset:Wu(i.dT,_e,ge),u_color_ramp:le,u_texture_offset:[ke/(Se+2*ke),Se/(Se+2*ke)],u_texture_res:[Se+2*ke,Se+2*ke],u_emissive_strength:Te});function f_(y){y*=Math.PI/180;const s=Math.sin(y),h=Math.cos(y);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}const Zh=.05,$d=(y,s,h,v,w,P,O,L,z,G,H,Q)=>({u_matrix:y,u_normalize_matrix:s,u_globe_matrix:h,u_merc_matrix:v,u_grid_matrix:w,u_tl_parent:P,u_scale_parent:G,u_fade_t:H.mix,u_opacity:H.opacity,u_image0:0,u_image1:1,u_raster_elevation:Q,u_zoom_transition:O,u_merc_center:L,u_cutoff_params:z}),Cw=(y,s,h,v,w,P,O,L,z,G)=>({u_particle_texture:y,u_particle_texture_side_len:s,u_tile_offset:h,u_velocity:v,u_color_ramp:P,u_velocity_res:w,u_max_speed:O,u_uv_offset:L,u_data_scale:[255*z[0],255*z[1]],u_data_offset:G,u_particle_pos_scale:1.1,u_particle_pos_offset:[Zh,Zh]}),p_=(y,s,h,v,w,P,O,L,z,G)=>({u_particle_texture:y,u_particle_texture_side_len:s,u_velocity:h,u_velocity_res:v,u_max_speed:w,u_speed_factor:P,u_reset_rate:O,u_rand_seed:Math.random(),u_uv_offset:L,u_data_scale:[255*z[0],255*z[1]],u_data_offset:G,u_particle_pos_scale:1.1,u_particle_pos_offset:[Zh,Zh]}),Ow=i.bB(),kw=(y,s,h,v,w,P,O,L,z,G,H,Q,K,re,le,ue,_e,ge,Se,ke,Te,$e,Re,Ve)=>{const Be=w.transform,De={u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:Be.getCameraToCenterDistance(Se),u_rotate_symbol:+h,u_aspect_ratio:Be.width/Be.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:P,u_label_plane_matrix:O,u_coord_matrix:L,u_is_text:+G,u_elevation_from_sea:z?1:0,u_pitch_with_map:+v,u_texsize:H,u_texsize_icon:Q,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ow,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ow,u_up_vector:[0,-1,0],u_color_adj_mat:$e,u_icon_transition:Re||0,u_gamma_scale:v?w.transform.getCameraToCenterDistance(Se)*Math.cos(w.terrain?0:w.transform._pitch):1,u_device_pixel_ratio:i.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Ve||1,u_ground_shadow_factor:ke,u_inv_matrix:i.bk(i.bB(),O),u_normal_scale:Te,u_lutTexture:So.LUT};return Se.name==="globe"&&(De.u_tile_id=[re.canonical.x,re.canonical.y,1<<re.canonical.z],De.u_zoom_transition=le,De.u_inv_rot_matrix=_e,De.u_merc_center=ue,De.u_camera_forward=Be._camera.forward(),De.u_ecef_origin=i.dU(Be.globeMatrix,re.toUnwrapped()),De.u_tile_matrix=Float32Array.from(Be.globeMatrix),De.u_up_vector=ge),De},m_=(y,s,h,v)=>({u_matrix:y,u_emissive_strength:s,u_opacity:h,u_color:v}),g_=(y,s,h,v,w,P,O,L,z)=>Object.assign(function(G,H,Q,K,re,le){const{width:ue,height:_e}=K.imageManager.getPixelSize(H),ge=Math.pow(2,le.tileID.overscaledZ),Se=le.tileSize*Math.pow(2,K.transform.tileZoom)/ge,ke=Se*(le.tileID.canonical.x+le.tileID.wrap*ge),Te=Se*le.tileID.canonical.y;return{u_image:0,u_pattern_tl:Q.tl,u_pattern_br:Q.br,u_texsize:[ue,_e],u_pattern_size:Q.displaySize,u_pattern_units_to_pixels:re?[K.transform.width,-1*K.transform.height]:[1/i.ay(le,1,K.transform.tileZoom),1/i.ay(le,1,K.transform.tileZoom)],u_pixel_coord_upper:[ke>>16,Te>>16],u_pixel_coord_lower:[65535&ke,65535&Te]}}(0,P,O,v,L,z),{u_matrix:y,u_emissive_strength:s,u_opacity:h}),Iw=new Float32Array(i.bz([])),y_=(y,s,h,v,w,P,O,L,z,G,H,Q,K,re=[0,0,0],le,ue,_e)=>{const ge=w.style.light,Se=ge.properties.get("position"),ke=[-Se.x,-Se.y,Se.z],Te=i.dN();ge.properties.get("anchor")==="viewport"&&(i.dO(Te,-w.transform.angle),i.dP(ke,ke,Te));const $e=H.alphaMode==="MASK",Re=ge.properties.get("color").toNonPremultipliedRenderColor(null),Ve=K.paint.get("model-ambient-occlusion-intensity"),Be=K.paint.get("model-color").constantOr(i.ao.white).toNonPremultipliedRenderColor(null);return Be.a=K.paint.get("model-color-mix-intensity").constantOr(0),_e&&(Be.r=_e[0],Be.g=_e[1],Be.b=_e[2],Be.a=_e[3]),ue&&(Be.r=ue.color.r,Be.g=ue.color.g,Be.b=ue.color.b,Be.a=ue.colorMix,Q=ue.emissionStrength,P=ue.opacity),{u_matrix:y,u_lighting_matrix:s,u_normal_matrix:h,u_node_matrix:v||Iw,u_lightpos:ke,u_lightintensity:ge.properties.get("intensity"),u_lightcolor:[Re.r,Re.g,Re.b],u_camera_pos:re,u_opacity:P,u_baseTextureIsAlpha:0,u_alphaMask:+$e,u_alphaCutoff:H.alphaCutoff,u_baseColorFactor:O.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:L.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:z,u_roughnessFactor:G,u_baseColorTexture:So.BaseColor,u_metallicRoughnessTexture:So.MetallicRoughness,u_normalTexture:So.Normal,u_occlusionTexture:So.Occlusion,u_emissionTexture:So.Emission,u_lutTexture:So.LUT,u_color_mix:Be.toArray01(),u_aoIntensity:Ve,u_emissive_strength:Q,u_occlusionTextureTransform:le||[0,0,0,0]}},mp=(y,s=Iw,h=Iw)=>({u_matrix:y,u_instance:s,u_node_matrix:h}),hj={fillExtrusion:y=>({u_matrix:new i.ck(y),u_lightpos:new i.ch(y),u_lightintensity:new i.ci(y),u_lightcolor:new i.ch(y),u_vertical_gradient:new i.ci(y),u_opacity:new i.ci(y),u_edge_radius:new i.ci(y),u_width_scale:new i.ci(y),u_ao:new i.cj(y),u_height_type:new i.cg(y),u_base_type:new i.cg(y),u_tile_id:new i.ch(y),u_zoom_transition:new i.ci(y),u_inv_rot_matrix:new i.ck(y),u_merc_center:new i.cj(y),u_up_dir:new i.ch(y),u_height_lift:new i.ci(y),u_flood_light_color:new i.ch(y),u_vertical_scale:new i.ci(y),u_flood_light_intensity:new i.ci(y),u_ground_shadow_factor:new i.ch(y)}),fillExtrusionDepth:y=>({u_matrix:new i.ck(y),u_edge_radius:new i.ci(y),u_width_scale:new i.ci(y),u_vertical_scale:new i.ci(y),u_height_type:new i.cg(y),u_base_type:new i.cg(y)}),fillExtrusionPattern:y=>({u_matrix:new i.ck(y),u_lightpos:new i.ch(y),u_lightintensity:new i.ci(y),u_lightcolor:new i.ch(y),u_vertical_gradient:new i.ci(y),u_height_factor:new i.ci(y),u_edge_radius:new i.ci(y),u_width_scale:new i.ci(y),u_ao:new i.cj(y),u_height_type:new i.cg(y),u_base_type:new i.cg(y),u_tile_id:new i.ch(y),u_zoom_transition:new i.ci(y),u_inv_rot_matrix:new i.ck(y),u_merc_center:new i.cj(y),u_up_dir:new i.ch(y),u_height_lift:new i.ci(y),u_image:new i.cg(y),u_texsize:new i.cj(y),u_pixel_coord_upper:new i.cj(y),u_pixel_coord_lower:new i.cj(y),u_tile_units_to_pixels:new i.ci(y),u_opacity:new i.ci(y),u_pattern_transition:new i.ci(y)}),fillExtrusionGroundEffect:y=>({u_matrix:new i.ck(y),u_opacity:new i.ci(y),u_ao_pass:new i.ci(y),u_meter_to_tile:new i.ci(y),u_ao:new i.cj(y),u_flood_light_intensity:new i.ci(y),u_flood_light_color:new i.ch(y),u_attenuation:new i.ci(y),u_edge_radius:new i.ci(y),u_fb:new i.cg(y),u_fb_size:new i.ci(y),u_dynamic_offset:new i.ci(y)}),fill:y=>({u_matrix:new i.ck(y),u_emissive_strength:new i.ci(y),u_ground_shadow_factor:new i.ch(y)}),fillPattern:y=>({u_matrix:new i.ck(y),u_emissive_strength:new i.ci(y),u_image:new i.cg(y),u_texsize:new i.cj(y),u_pixel_coord_upper:new i.cj(y),u_pixel_coord_lower:new i.cj(y),u_tile_units_to_pixels:new i.ci(y),u_ground_shadow_factor:new i.ch(y),u_pattern_transition:new i.ci(y)}),fillOutline:y=>({u_matrix:new i.ck(y),u_emissive_strength:new i.ci(y),u_world:new i.cj(y),u_ground_shadow_factor:new i.ch(y)}),fillOutlinePattern:y=>({u_matrix:new i.ck(y),u_emissive_strength:new i.ci(y),u_world:new i.cj(y),u_image:new i.cg(y),u_texsize:new i.cj(y),u_pixel_coord_upper:new i.cj(y),u_pixel_coord_lower:new i.cj(y),u_tile_units_to_pixels:new i.ci(y),u_ground_shadow_factor:new i.ch(y),u_pattern_transition:new i.ci(y)}),building:y=>({u_matrix:new i.ck(y),u_normal_matrix:new i.ck(y),u_opacity:new i.ci(y),u_faux_facade_ao_intensity:new i.ci(y),u_camera_pos:new i.ch(y),u_tile_to_meter:new i.ci(y),u_facade_emissive_chance:new i.ci(y),u_flood_light_color:new i.ch(y),u_flood_light_intensity:new i.ci(y)}),buildingBloom:y=>({u_matrix:new i.ck(y)}),buildingDepth:y=>({u_matrix:new i.ck(y)}),elevatedStructuresDepth:y=>({u_matrix:new i.ck(y),u_depth_bias:new i.ci(y)}),elevatedStructures:y=>({u_matrix:new i.ck(y),u_ground_shadow_factor:new i.ch(y)}),elevatedStructuresDepthReconstruct:y=>({u_matrix:new i.ck(y),u_camera_pos:new i.ch(y),u_depth_bias:new i.ci(y),u_height_scale:new i.ci(y),u_reset_depth:new i.ci(y)}),circle:i.dX,collisionBox:y=>({u_matrix:new i.ck(y),u_inv_rot_matrix:new i.ck(y),u_camera_to_center_distance:new i.ci(y),u_extrude_scale:new i.cj(y),u_zoom_transition:new i.ci(y),u_merc_center:new i.cj(y),u_tile_id:new i.ch(y)}),collisionCircle:y=>({u_matrix:new i.ck(y),u_inv_matrix:new i.ck(y),u_camera_to_center_distance:new i.ci(y),u_viewport_size:new i.cj(y)}),debug:y=>({u_color:new i.dA(y),u_matrix:new i.ck(y),u_overlay:new i.cg(y),u_overlay_scale:new i.ci(y)}),clippingMask:y=>({u_matrix:new i.ck(y)}),heatmap:y=>({u_extrude_scale:new i.ci(y),u_intensity:new i.ci(y),u_matrix:new i.ck(y),u_inv_rot_matrix:new i.ck(y),u_merc_center:new i.cj(y),u_tile_id:new i.ch(y),u_zoom_transition:new i.ci(y),u_up_dir:new i.ch(y)}),heatmapTexture:y=>({u_image:new i.cg(y),u_color_ramp:new i.cg(y),u_opacity:new i.ci(y)}),hillshade:y=>({u_matrix:new i.ck(y),u_image:new i.cg(y),u_latrange:new i.cj(y),u_light:new i.cj(y),u_shadow:new i.dA(y),u_highlight:new i.dA(y),u_emissive_strength:new i.ci(y),u_accent:new i.dA(y)}),hillshadePrepare:y=>({u_matrix:new i.ck(y),u_image:new i.cg(y),u_dimension:new i.cj(y),u_zoom:new i.ci(y)}),line:i.dW,linePattern:i.dV,raster:y=>({u_matrix:new i.ck(y),u_normalize_matrix:new i.ck(y),u_globe_matrix:new i.ck(y),u_merc_matrix:new i.ck(y),u_grid_matrix:new i.dB(y),u_tl_parent:new i.cj(y),u_scale_parent:new i.ci(y),u_fade_t:new i.ci(y),u_opacity:new i.ci(y),u_image0:new i.cg(y),u_image1:new i.cg(y),u_brightness_low:new i.ci(y),u_brightness_high:new i.ci(y),u_saturation_factor:new i.ci(y),u_contrast_factor:new i.ci(y),u_spin_weights:new i.ch(y),u_perspective_transform:new i.cj(y),u_raster_elevation:new i.ci(y),u_zoom_transition:new i.ci(y),u_merc_center:new i.cj(y),u_cutoff_params:new i.d2(y),u_colorization_mix:new i.d2(y),u_colorization_offset:new i.ci(y),u_color_ramp:new i.cg(y),u_texture_offset:new i.cj(y),u_texture_res:new i.cj(y),u_emissive_strength:new i.ci(y)}),rasterParticle:y=>({u_matrix:new i.ck(y),u_normalize_matrix:new i.ck(y),u_globe_matrix:new i.ck(y),u_merc_matrix:new i.ck(y),u_grid_matrix:new i.dB(y),u_tl_parent:new i.cj(y),u_scale_parent:new i.ci(y),u_fade_t:new i.ci(y),u_opacity:new i.ci(y),u_image0:new i.cg(y),u_image1:new i.cg(y),u_raster_elevation:new i.ci(y),u_zoom_transition:new i.ci(y),u_merc_center:new i.cj(y),u_cutoff_params:new i.d2(y)}),rasterParticleTexture:y=>({u_texture:new i.cg(y),u_opacity:new i.ci(y)}),rasterParticleDraw:y=>({u_particle_texture:new i.cg(y),u_particle_texture_side_len:new i.ci(y),u_tile_offset:new i.cj(y),u_velocity:new i.cg(y),u_color_ramp:new i.cg(y),u_velocity_res:new i.cj(y),u_max_speed:new i.ci(y),u_uv_offset:new i.cj(y),u_data_scale:new i.cj(y),u_data_offset:new i.ci(y),u_particle_pos_scale:new i.ci(y),u_particle_pos_offset:new i.cj(y)}),rasterParticleUpdate:y=>({u_particle_texture:new i.cg(y),u_particle_texture_side_len:new i.ci(y),u_velocity:new i.cg(y),u_velocity_res:new i.cj(y),u_max_speed:new i.ci(y),u_speed_factor:new i.ci(y),u_reset_rate:new i.ci(y),u_rand_seed:new i.ci(y),u_uv_offset:new i.cj(y),u_data_scale:new i.cj(y),u_data_offset:new i.ci(y),u_particle_pos_scale:new i.ci(y),u_particle_pos_offset:new i.cj(y)}),symbol:y=>({u_is_size_zoom_constant:new i.cg(y),u_is_size_feature_constant:new i.cg(y),u_size_t:new i.ci(y),u_size:new i.ci(y),u_camera_to_center_distance:new i.ci(y),u_rotate_symbol:new i.cg(y),u_aspect_ratio:new i.ci(y),u_fade_change:new i.ci(y),u_matrix:new i.ck(y),u_label_plane_matrix:new i.ck(y),u_coord_matrix:new i.ck(y),u_is_text:new i.cg(y),u_elevation_from_sea:new i.cg(y),u_pitch_with_map:new i.cg(y),u_texsize:new i.cj(y),u_texsize_icon:new i.cj(y),u_texture:new i.cg(y),u_texture_icon:new i.cg(y),u_gamma_scale:new i.ci(y),u_device_pixel_ratio:new i.ci(y),u_tile_id:new i.ch(y),u_zoom_transition:new i.ci(y),u_inv_rot_matrix:new i.ck(y),u_merc_center:new i.cj(y),u_camera_forward:new i.ch(y),u_tile_matrix:new i.ck(y),u_up_vector:new i.ch(y),u_ecef_origin:new i.ch(y),u_is_halo:new i.cg(y),u_icon_transition:new i.ci(y),u_color_adj_mat:new i.ck(y),u_scale_factor:new i.ci(y),u_ground_shadow_factor:new i.ch(y),u_inv_matrix:new i.ck(y),u_normal_scale:new i.ci(y),u_lutTexture:new i.cg(y)}),background:y=>({u_matrix:new i.ck(y),u_emissive_strength:new i.ci(y),u_opacity:new i.ci(y),u_color:new i.dA(y)}),backgroundPattern:y=>({u_matrix:new i.ck(y),u_emissive_strength:new i.ci(y),u_opacity:new i.ci(y),u_image:new i.cg(y),u_pattern_tl:new i.cj(y),u_pattern_br:new i.cj(y),u_texsize:new i.cj(y),u_pattern_size:new i.cj(y),u_pixel_coord_upper:new i.cj(y),u_pixel_coord_lower:new i.cj(y),u_pattern_units_to_pixels:new i.cj(y)}),terrainRaster:y=>({u_matrix:new i.ck(y),u_image0:new i.cg(y),u_skirt_height:new i.ci(y),u_ground_shadow_factor:new i.ch(y)}),skybox:y=>({u_matrix:new i.ck(y),u_sun_direction:new i.ch(y),u_cubemap:new i.cg(y),u_opacity:new i.ci(y),u_temporal_offset:new i.ci(y)}),skyboxGradient:y=>({u_matrix:new i.ck(y),u_color_ramp:new i.cg(y),u_center_direction:new i.ch(y),u_radius:new i.ci(y),u_opacity:new i.ci(y),u_temporal_offset:new i.ci(y)}),skyboxCapture:y=>({u_matrix_3f:new i.dB(y),u_sun_direction:new i.ch(y),u_sun_intensity:new i.ci(y),u_color_tint_r:new i.d2(y),u_color_tint_m:new i.d2(y),u_luminance:new i.ci(y)}),globeRaster:y=>({u_proj_matrix:new i.ck(y),u_globe_matrix:new i.ck(y),u_normalize_matrix:new i.ck(y),u_merc_matrix:new i.ck(y),u_zoom_transition:new i.ci(y),u_merc_center:new i.cj(y),u_image0:new i.cg(y),u_grid_matrix:new i.dB(y),u_skirt_height:new i.ci(y),u_far_z_cutoff:new i.ci(y),u_frustum_tl:new i.ch(y),u_frustum_tr:new i.ch(y),u_frustum_br:new i.ch(y),u_frustum_bl:new i.ch(y),u_globe_pos:new i.ch(y),u_globe_radius:new i.ci(y),u_viewport:new i.cj(y)}),globeAtmosphere:y=>({u_frustum_tl:new i.ch(y),u_frustum_tr:new i.ch(y),u_frustum_br:new i.ch(y),u_frustum_bl:new i.ch(y),u_horizon:new i.ci(y),u_transition:new i.ci(y),u_fadeout_range:new i.ci(y),u_atmosphere_fog_color:new i.d2(y),u_high_color:new i.d2(y),u_space_color:new i.d2(y),u_temporal_offset:new i.ci(y),u_horizon_angle:new i.ci(y)}),model:y=>({u_matrix:new i.ck(y),u_lighting_matrix:new i.ck(y),u_normal_matrix:new i.ck(y),u_node_matrix:new i.ck(y),u_lightpos:new i.ch(y),u_lightintensity:new i.ci(y),u_lightcolor:new i.ch(y),u_camera_pos:new i.ch(y),u_opacity:new i.ci(y),u_baseColorFactor:new i.d2(y),u_emissiveFactor:new i.d2(y),u_metallicFactor:new i.ci(y),u_roughnessFactor:new i.ci(y),u_baseTextureIsAlpha:new i.cg(y),u_alphaMask:new i.cg(y),u_alphaCutoff:new i.ci(y),u_baseColorTexture:new i.cg(y),u_metallicRoughnessTexture:new i.cg(y),u_normalTexture:new i.cg(y),u_occlusionTexture:new i.cg(y),u_emissionTexture:new i.cg(y),u_lutTexture:new i.cg(y),u_color_mix:new i.d2(y),u_aoIntensity:new i.ci(y),u_emissive_strength:new i.ci(y),u_occlusionTextureTransform:new i.d2(y)}),modelDepth:y=>({u_matrix:new i.ck(y),u_instance:new i.ck(y),u_node_matrix:new i.ck(y)}),groundShadow:y=>({u_matrix:new i.ck(y),u_ground_shadow_factor:new i.ch(y)}),stars:y=>({u_matrix:new i.ck(y),u_up:new i.ch(y),u_right:new i.ch(y),u_intensity_multiplier:new i.ci(y)}),snowParticle:y=>({u_modelview:new i.ck(y),u_projection:new i.ck(y),u_time:new i.ci(y),u_cam_pos:new i.ch(y),u_velocityConeAperture:new i.ci(y),u_velocity:new i.ci(y),u_horizontalOscillationRadius:new i.ci(y),u_horizontalOscillationRate:new i.ci(y),u_boxSize:new i.ci(y),u_billboardSize:new i.ci(y),u_simpleShapeParameters:new i.cj(y),u_screenSize:new i.cj(y),u_thinningCenterPos:new i.cj(y),u_thinningShape:new i.ch(y),u_thinningAffectedRatio:new i.ci(y),u_thinningParticleOffset:new i.ci(y),u_particleColor:new i.d2(y),u_direction:new i.ch(y)}),rainParticle:y=>({u_modelview:new i.ck(y),u_projection:new i.ck(y),u_time:new i.ci(y),u_cam_pos:new i.ch(y),u_texScreen:new i.cg(y),u_velocityConeAperture:new i.ci(y),u_velocity:new i.ci(y),u_boxSize:new i.ci(y),u_rainDropletSize:new i.cj(y),u_distortionStrength:new i.ci(y),u_rainDirection:new i.ch(y),u_color:new i.d2(y),u_screenSize:new i.cj(y),u_thinningCenterPos:new i.cj(y),u_thinningShape:new i.ch(y),u_thinningAffectedRatio:new i.ci(y),u_thinningParticleOffset:new i.ci(y),u_shapeDirectionalPower:new i.ci(y),u_shapeNormalPower:new i.ci(y),u_mode:new i.ci(y)}),vignette:y=>({u_vignetteShape:new i.ch(y),u_vignetteColor:new i.d2(y)}),occlusion:y=>({u_matrix:new i.ck(y),u_anchorPos:new i.ch(y),u_screenSizePx:new i.cj(y),u_occluderSizePx:new i.cj(y),u_color:new i.d2(y)})};class Ud{constructor(s,h,v,w){this.id=Ud.uniqueIdxCounter,Ud.uniqueIdxCounter++,this.context=s;const P=s.gl;this.buffer=P.createBuffer(),this.dynamicDraw=!!v,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),P.bufferData(P.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?P.DYNAMIC_DRAW:P.STATIC_DRAW),this.dynamicDraw||w||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){this.id=Ud.uniqueIdxCounter,Ud.uniqueIdxCounter++;const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Ud.uniqueIdxCounter=0;const M2={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class fj{constructor(s,h,v,w,P,O){this.length=h.length,this.attributes=v,this.itemSize=h.bytesPerElement,this.dynamicDraw=w,this.instanceCount=O,this.context=s;const L=s.gl;this.buffer=L.createBuffer(),s.bindVertexBuffer.set(this.buffer),L.bufferData(L.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?L.DYNAMIC_DRAW:L.STATIC_DRAW),this.dynamicDraw||P||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let v=0;v<this.attributes.length;v++){const w=h.getAttributeLocation(s,this.attributes[v].name);w!==-1&&s.enableVertexAttribArray(w)}}setVertexAttribPointers(s,h,v){for(let w=0;w<this.attributes.length;w++){const P=this.attributes[w],O=h.getAttributeLocation(s,P.name);O!==-1&&s.vertexAttribPointer(O,P.components,s[M2[P.type]],!1,this.itemSize,P.offset+this.itemSize*(v||0))}}setVertexAttribDivisor(s,h,v){for(let w=0;w<this.attributes.length;w++){const P=h.getAttributeLocation(s,this.attributes[w].name);P!==-1&&this.instanceCount&&this.instanceCount>0&&s.vertexAttribDivisor(P,v)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class v_{constructor(s,h,v,w,P){this.context=s,this.width=h,this.height=v;const O=this.framebuffer=s.gl.createFramebuffer();w&&(this.colorAttachment=new sj(s,O)),P&&(this.depthAttachmentType=P,this.depthAttachment=P==="renderbuffer"?new A2(s,O):new lj(s,O))}destroy(){const s=this.context.gl;if(this.colorAttachment){const h=this.colorAttachment.get();h&&s.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const h=this.depthAttachment.get();h&&s.deleteRenderbuffer(h)}else{const h=this.depthAttachment.get();h&&s.deleteTexture(h)}s.deleteFramebuffer(this.framebuffer)}}class __{constructor(s,h){this.gl=s,this.clearColor=new v2(this),this.clearDepth=new fw(this),this.clearStencil=new tj(this),this.colorMask=new rj(this),this.depthMask=new nj(this),this.stencilMask=new ij(this),this.stencilFunc=new _2(this),this.stencilOp=new aj(this),this.stencilTest=new Qv(this),this.depthRange=new oj(this),this.depthTest=new x2(this),this.depthFunc=new pw(this),this.blend=new e_(this),this.blendFunc=new mw(this),this.blendColor=new Gh(this),this.blendEquation=new lp(this),this.cullFace=new zg(this),this.cullFaceSide=new cp(this),this.frontFace=new b2(this),this.program=new gw(this),this.activeTexture=new w2(this),this.viewport=new up(this),this.bindFramebuffer=new t_(this),this.bindRenderbuffer=new r_(this),this.bindTexture=new yw(this),this.bindVertexBuffer=new n_(this),this.bindElementBuffer=new Bg(this),this.bindVertexArrayOES=new S2(this),this.pixelStoreUnpack=new E2(this),this.pixelStoreUnpackPremultiplyAlpha=new T2(this),this.pixelStoreUnpackFlipY=new dp(this),this.options=h?Object.assign({},h):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=h&&!!h.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=s.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),this.maxPointSize=s.getParameter(s.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h,v){return new Ud(this,s,h,v)}createVertexBuffer(s,h,v,w,P){return new fj(this,s,h,v,w,P)}createRenderbuffer(s,h,v){const w=this.gl,P=w.createRenderbuffer();return this.bindRenderbuffer.set(P),w.renderbufferStorage(w.RENDERBUFFER,s,h,v),this.bindRenderbuffer.set(null),P}createFramebuffer(s,h,v,w){return new v_(this,s,h,v,w)}clear({color:s,depth:h,stencil:v,colorMask:w}){const P=this.gl;let O=0;s&&(O|=P.COLOR_BUFFER_BIT,this.clearColor.set(s.toNonPremultipliedRenderColor(null)),this.colorMask.set(w||[!0,!0,!0,!0])),h!==void 0&&(O|=P.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),v!==void 0&&(O|=P.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),P.clear(O)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){i.bx(s.blendFunction,mn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor),s.blendEquation?this.blendEquation.set(s.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(s.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let lu;function Gg(y,s,h,v,w,P,O){const L=y.context,z=L.gl,G=y.transform,H=[i.aF(G.center.lng),i.aJ(G.center.lat)],Q=h.layout.get("symbol-placement"),K=h.layout.get("text-variable-anchor"),re=h.layout.get("icon-rotation-alignment")==="map",le=h.layout.get("text-rotation-alignment")==="map",ue=Q!=="point",_e=[];let ge=0,Se=0;for(let De=0;De<v.length;De++){const We=v[De],lt=s.getTile(We),it=lt.getBucket(h);if(!it)continue;const bt=it.getProjection().createInversionMatrix(G,We.canonical),mt=[],Ot=d2(We,it,G),Zt=!O&&re&&ue,pt=O&&le&&ue,et=K&&it.hasTextData(),kt=it.hasIconTextFit()&&et&&it.hasIconData(),gt=Zt||pt||O&&et||kt,Lt=it.projection.name==="globe",Qt=Lt?i.aj(G.zoom):0;Lt&&(mt.push("PROJECTION_GLOBE_VIEW"),gt&&mt.push("PROJECTED_POS_ON_VIEWPORT"));const vr=y.getOrCreateProgram("collisionBox",{defines:mt});let Gt=Ot;w[0]===0&&w[1]===0||(Gt=y.translatePosMatrix(Ot,lt,w,P));const Yt=O?it.textCollisionBox:it.iconCollisionBox,br=it.collisionCircleArray;if(br.length>0){const cr=i.bB(),fr=Gt;i.cO(cr,it.placementInvProjMatrix,G.glCoordMatrix),i.cO(cr,cr,it.placementViewportMatrix),_e.push({circleArray:br,circleOffset:Se,transform:fr,invTransform:cr,projection:it.getProjection()}),ge+=br.length/4,Se=ge}if(!Yt)continue;y.terrain&&y.terrain.setupElevationDraw(lt,vr);const hr=Lt?[We.canonical.x,We.canonical.y,1<<We.canonical.z]:[0,0,0];vr.draw(y,z.LINES,Sr.disabled,Yr.disabled,y.colorModeForRenderPass(),Gr.disabled,pp(Gt,bt,G,Qt,H,lt,hr,it.getProjection()),h.id,Yt.layoutVertexBuffer,Yt.indexBuffer,Yt.segments,null,G.zoom,null,[Yt.collisionVertexBuffer,Yt.collisionVertexBufferExt])}if(!O||!_e.length)return;const ke=y.getOrCreateProgram("collisionCircle"),Te=new i.dY;Te.resize(4*ge),Te._trim();let $e=0;for(const De of _e)for(let We=0;We<De.circleArray.length/4;We++){const lt=4*We,it=De.circleArray[lt+0],bt=De.circleArray[lt+1],mt=De.circleArray[lt+2],Ot=De.circleArray[lt+3];Te.emplace($e++,it,bt,mt,Ot,0),Te.emplace($e++,it,bt,mt,Ot,1),Te.emplace($e++,it,bt,mt,Ot,2),Te.emplace($e++,it,bt,mt,Ot,3)}(!lu||lu.length<2*ge)&&(lu=function(De){const We=2*De,lt=new i.b0;lt.resize(We),lt._trim();for(let it=0;it<We;it++){const bt=6*it;lt.uint16[bt+0]=4*it+0,lt.uint16[bt+1]=4*it+1,lt.uint16[bt+2]=4*it+2,lt.uint16[bt+3]=4*it+2,lt.uint16[bt+4]=4*it+3,lt.uint16[bt+5]=4*it+0}return lt}(ge));const Re=L.createIndexBuffer(lu,!0),Ve=L.createVertexBuffer(Te,i.dZ.members,!0);for(const De of _e){const We={u_matrix:De.transform,u_inv_matrix:De.invTransform,u_camera_to_center_distance:(Be=G).getCameraToCenterDistance(De.projection),u_viewport_size:[Be.width,Be.height]};ke.draw(y,z.TRIANGLES,Sr.disabled,Yr.disabled,y.colorModeForRenderPass(),Gr.disabled,We,h.id,Ve,Re,i.bf.simpleSegment(0,2*De.circleOffset,De.circleArray.length,De.circleArray.length/2),null,G.zoom)}var Be;Ve.destroy(),Re.destroy()}const Vd=i.bB();function Rw(y){const s=y._camera.getWorldToCamera(y.worldSize,1),h=i.aB([],s,y.globeMatrix);i.bk(h,h);const v=[0,0,0],w=[0,1,0,0];return i.aC(w,w,h),v[0]=w[0],v[1]=w[1],v[2]=w[2],i.aw(v,v),v}function x_({width:y,height:s,anchor:h,textOffset:v,textScale:w},P){const{horizontalAlign:O,verticalAlign:L}=i.c0(h),z=-(O-.5)*y,G=-(L-.5)*s,H=i.c1(h,v);return new i.P((z/w+H[0])*P,(G/w+H[1])*P)}function b_(y,s,h,v,w,P,O,L,z,G){const H=y.text.placedSymbolArray,Q=y.text.dynamicLayoutVertexArray,K=y.icon.dynamicLayoutVertexArray,re={},le=y.getProjection(),ue=$v(O,le,w),_e=w.elevation,ge=le.upVectorScale(O.canonical,w.center.lat,w.worldSize).metersToTile;Q.clear();for(let Se=0;Se<H.length;Se++){const ke=H.get(Se),{tileAnchorX:Te,tileAnchorY:$e,numGlyphs:Re}=ke,Ve=ke.hidden||!ke.crossTileID||y.allowVerticalPlacement&&!ke.placedOrientation?null:v[ke.crossTileID];if(Ve){let Be=0,De=0,We=0;const lt=y.elevationType==="road";if(_e||lt){const gt=lt?y.getElevationFeatureForText(Se):null,Lt=i.bU.getAtTileOffset(O,new i.P(Te,$e),_e,gt),[Qt,vr,Gt]=le.upVector(O.canonical,Te,$e);Be=Lt*Qt*ge,De=Lt*vr*ge,We=Lt*Gt*ge}let[it,bt,mt,Ot]=eo(ke.projectedAnchorX+Be,ke.projectedAnchorY+De,ke.projectedAnchorZ+We,h?ue:P);const Zt=ew(w.getCameraToCenterDistance(le),Ot);let pt=i.bL(y.textSizeData,z,ke)*Zt/i.bX;h&&(pt*=y.tilePixelRatio/L);const et=x_(Ve,pt);h?({x:it,y:bt,z:mt}=le.projectTilePoint(Te+et.x,$e+et.y,O.canonical),[it,bt,mt]=eo(it+Be,bt+De,mt+We,P)):(s&&et._rotate(-w.angle),it+=et.x,bt+=et.y,mt=0);const kt=y.allowVerticalPlacement&&ke.placedOrientation===i.bK.vertical?Math.PI/2:0;for(let gt=0;gt<Re;gt++)i.bN(Q,it,bt,mt,kt);G&&ke.associatedIconIndex>=0&&(re[ke.associatedIconIndex]={x:it,y:bt,z:mt,angle:kt})}else $u(Re,Q)}if(G){K.clear();const Se=y.icon.placedSymbolArray;for(let ke=0;ke<Se.length;ke++){const Te=Se.get(ke),{numGlyphs:$e}=Te,Re=re[ke];if(Te.hidden||!Re)$u($e,K);else{const{x:Ve,y:Be,z:De,angle:We}=Re;for(let lt=0;lt<$e;lt++)i.bN(K,Ve,Be,De,We)}}y.icon.dynamicLayoutVertexBuffer.updateData(K)}y.text.dynamicLayoutVertexBuffer.updateData(Q)}function Hg(y,s,h,v,w,P,O={}){const L=h.paint.get("icon-translate"),z=h.paint.get("text-translate"),G=h.paint.get("icon-translate-anchor"),H=h.paint.get("text-translate-anchor"),Q=h.layout.get("icon-rotation-alignment"),K=h.layout.get("text-rotation-alignment"),re=h.layout.get("icon-pitch-alignment"),le=h.layout.get("text-pitch-alignment"),ue=h.layout.get("icon-keep-upright"),_e=h.layout.get("text-keep-upright"),ge=h.paint.get("icon-color-saturation"),Se=h.paint.get("icon-color-contrast"),ke=h.paint.get("icon-color-brightness-min"),Te=h.paint.get("icon-color-brightness-max"),$e=h.layout.get("symbol-elevation-reference")==="sea",Re=h.layout.get("icon-image-use-theme")==="none",Ve=y.context,Be=Ve.gl,De=y.transform,We=Q==="map",lt=K==="map",it=re==="map",bt=le==="map",mt=h.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Ot=!1;const Zt=y.depthModeForSublayer(0,Sr.ReadOnly),pt=new Sr(y.context.gl.LEQUAL,Sr.ReadOnly,y.depthRangeFor3D),et=[i.aF(De.center.lng),i.aJ(De.center.lat)],kt=h.layout.get("text-variable-anchor"),gt=De.projection.name==="globe",Lt=[],Qt=[0,-1,0];for(const vr of v){const Gt=s.getTile(vr),Yt=Gt.getBucket(h);if(!Yt||Yt.projection.name==="mercator"&&gt||Yt.fullyClipped)continue;const br=Yt.projection.name==="globe",hr=br?i.aj(De.zoom):0,cr=$v(vr,Yt.getProjection(),De),fr=De.calculatePixelsToTileUnitsMatrix(Gt),Mr=kt&&Yt.hasTextData(),An=Yt.hasIconTextFit()&&Mr&&Yt.hasIconData(),Dn=Yt.getProjection().createInversionMatrix(De,vr.canonical),mi=(1<<Gt.tileID.canonical.z)*i.al/y.transform.worldSize,Hr=ri=>{let Zr=[0,0,0];if(ri){const zn=y.style.directionalLight,Xi=y.style.ambientLight;zn&&Xi&&(Zr=rc(y.style,zn,Xi))}return Zr},Mn=ri=>{De.depthOcclusionForSymbolsAndCircles&&(h.hasOcclusionOpacityProperties||y.terrain)&&(ri.push("DEPTH_D24"),ri.push("DEPTH_OCCLUSION"))},sn=ri=>{h.lut&&!Re&&(h.lut.texture||(h.lut.texture=new i.d_(y.context,h.lut.image,[h.lut.image.height,h.lut.image.height,h.lut.image.height],Ve.gl.RGBA8)),Ve.activeTexture.set(Ve.gl.TEXTURE0+So.LUT),h.lut.texture&&h.lut.texture.bind(Ve.gl.LINEAR,Ve.gl.CLAMP_TO_EDGE),ri.push("APPLY_LUT_ON_GPU"))},si=()=>{const ri=We&&h.layout.get("symbol-placement")!=="point",Zr=[];Mn(Zr),sn(Zr);const zn=ri||An,Xi=Yt.elevationType==="road",ba=y.shadowRenderer,ra=Xi&&it&&!!ba&&ba.enabled,da=Hr(ra),zs=Xi&&it&&!y.terrain?pt:Zt,Ts=h.paint.get("icon-image-cross-fade");y.terrainRenderModeElevated()&&it&&Zr.push("PITCH_WITH_MAP_TERRAIN"),br&&(Zr.push("PROJECTION_GLOBE_VIEW"),zn&&Zr.push("PROJECTED_POS_ON_VIEWPORT")),Ts>0&&Yt.hasAnySecondaryIcon&&Zr.push("ICON_TRANSITION"),!Yt.icon.zOffsetVertexBuffer||Xi&&y.terrain||Zr.push("Z_OFFSET"),ge===0&&Se===0&&ke===0&&Te===1||Zr.push("COLOR_ADJUSTMENT"),Yt.sdfIcons&&Zr.push("RENDER_SDF"),ra&&Zr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Xi&&it&&!y.terrain&&Yt.icon.orientationVertexBuffer&&Zr.push("ELEVATED_ROADS");const jo=Yt.icon.programConfigurations.get(h.id),Wo=y.getOrCreateProgram("symbol",{config:jo,defines:Zr}),El=Gt.imageAtlasTexture?Gt.imageAtlasTexture.size:[0,0],No=Yt.iconSizeData,Tl=i.bJ(No,De.zoom),lc=it||!De.isOrthographic,mo=Yf(cr,Gt.tileID.canonical,it,We,De,Yt.getProjection(),fr),oa=Bu(cr,Gt.tileID.canonical,it,We,De,Yt.getProjection(),fr),wa=y.translatePosMatrix(oa,Gt,L,G,!0),Ei=y.translatePosMatrix(cr,Gt,L,G),Aa=zn?Vd:mo,go=We&&!it&&!ri;let sa=Qt;!gt&&!De.mercatorFromTransition||We||(sa=Rw(De));const Al=br?sa:Qt,kp=h.getColorAdjustmentMatrix(ge,Se,ke,Te),Yu=kw(No.kind,Tl,go,it,y,Ei,Aa,wa,$e,!1,El,[0,0],0,vr,hr,et,Dn,Al,Yt.getProjection(),da,mi,kp,Ts,null),Ip=Gt.imageAtlasTexture?Gt.imageAtlasTexture:null,Rp=h.layout.get("icon-size").constantOr(0)!==1||Yt.iconsNeedLinear,Pl=Yt.sdfIcons||y.options.rotating||y.options.zooming||Rp||lc?Be.LINEAR:Be.NEAREST,uu=Yt.sdfIcons&&h.paint.get("icon-halo-width").constantOr(1)!==0,uo=y.terrain&&it&&ri?i.bk(i.bB(),mo):Vd;if(ri&&Yt.icon){const Cl=i.bU.getAtTileOffsetFunc(vr,De.center.lat,De.worldSize,Yt.getProjection()),rf=Ag(cr,Gt.tileID.canonical,it,We,De,Yt.getProjection(),fr),aA=h.layout.get("icon-size-scale-range"),U_=i.aA(y.scaleFactor,aA[0],aA[1]);rw(Yt,cr,y,!1,rf,oa,it,ue,Cl,vr,U_)}return{program:Wo,buffers:Yt.icon,uniformValues:Yu,atlasTexture:Ip,atlasTextureIcon:null,atlasInterpolation:Pl,atlasInterpolationIcon:null,isSDF:Yt.sdfIcons,hasHalo:uu,depthMode:zs,tile:Gt,renderWithShadows:ra,labelPlaneMatrixInv:uo}},Ln=()=>{const ri=lt&&h.layout.get("symbol-placement")!=="point",Zr=[],zn=ri||kt||An,Xi=Yt.elevationType==="road",ba=y.shadowRenderer,ra=Xi&&bt&&!!ba&&ba.enabled,da=Hr(ra),zs=Xi&&bt&&!y.terrain?pt:Zt;y.terrainRenderModeElevated()&&bt&&Zr.push("PITCH_WITH_MAP_TERRAIN"),br&&(Zr.push("PROJECTION_GLOBE_VIEW"),zn&&Zr.push("PROJECTED_POS_ON_VIEWPORT")),!Yt.text.zOffsetVertexBuffer||Xi&&y.terrain||Zr.push("Z_OFFSET"),Yt.iconsInText&&Zr.push("RENDER_TEXT_AND_SYMBOL"),Zr.push("RENDER_SDF"),ra&&Zr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Xi&&bt&&!y.terrain&&Yt.text.orientationVertexBuffer&&Zr.push("ELEVATED_ROADS"),Mn(Zr);const Ts=Yt.text.programConfigurations.get(h.id),jo=y.getOrCreateProgram("symbol",{config:Ts,defines:Zr});let Wo,El=[0,0],No=null;const Tl=Yt.textSizeData;Yt.iconsInText&&(El=Gt.imageAtlasTexture?Gt.imageAtlasTexture.size:[0,0],No=Gt.imageAtlasTexture?Gt.imageAtlasTexture:null,Wo=bt||!De.isOrthographic||y.options.rotating||y.options.zooming||Tl.kind==="composite"||Tl.kind==="camera"?Be.LINEAR:Be.NEAREST);const lc=Gt.glyphAtlasTexture?Gt.glyphAtlasTexture.size:[0,0],mo=h.layout.get("text-size-scale-range"),oa=i.aA(y.scaleFactor,mo[0],mo[1]),wa=i.bJ(Tl,De.zoom,oa),Ei=Yf(cr,Gt.tileID.canonical,bt,lt,De,Yt.getProjection(),fr),Aa=Bu(cr,Gt.tileID.canonical,bt,lt,De,Yt.getProjection(),fr),go=y.translatePosMatrix(Aa,Gt,z,H,!0),sa=y.translatePosMatrix(cr,Gt,z,H),Al=zn?Vd:Ei,kp=lt&&!bt&&!ri;let Yu=Qt;!gt&&!De.mercatorFromTransition||lt||(Yu=Rw(De));const Ip=kw(Tl.kind,wa,kp,bt,y,sa,Al,go,$e,!0,lc,El,0,vr,hr,et,Dn,br?Yu:Qt,Yt.getProjection(),da,mi,null,null,oa),Rp=Gt.glyphAtlasTexture?Gt.glyphAtlasTexture:null,Pl=Be.LINEAR,uu=h.paint.get("text-halo-width").constantOr(1)!==0,uo=y.terrain&&bt&&ri?i.bk(i.bB(),Ei):Vd;if(ri&&Yt.text){const Cl=i.bU.getAtTileOffsetFunc(vr,De.center.lat,De.worldSize,Yt.getProjection()),rf=Ag(cr,Gt.tileID.canonical,bt,lt,De,Yt.getProjection(),fr);rw(Yt,cr,y,!0,rf,Aa,bt,_e,Cl,vr,oa)}return{program:jo,buffers:Yt.text,uniformValues:Ip,atlasTexture:Rp,atlasTextureIcon:No,atlasInterpolation:Pl,atlasInterpolationIcon:Wo,isSDF:!0,hasHalo:uu,depthMode:zs,tile:Gt,renderWithShadows:ra,labelPlaneMatrixInv:uo}},Ai=Yt.icon.segments.get().length,qn=Yt.text.segments.get().length,dn=Ai&&!O.onlyText?si():null,Jn=qn&&!O.onlyIcons?Ln():null,gn=h.paint.get("icon-opacity").constantOr(1),Mi=h.paint.get("text-opacity").constantOr(1);if(mt&&Yt.canOverlap){Ot=!0;const ri=gn&&!O.onlyText?Yt.icon.segments.get():[],Zr=Mi&&!O.onlyIcons?Yt.text.segments.get():[];for(const zn of ri)Lt.push({segments:new i.bf([zn]),sortKey:zn.sortKey,state:dn});for(const zn of Zr)Lt.push({segments:new i.bf([zn]),sortKey:zn.sortKey,state:Jn})}else O.onlyText||Lt.push({segments:gn?Yt.icon.segments:new i.bf([]),sortKey:0,state:dn}),O.onlyIcons||Lt.push({segments:Mi?Yt.text.segments:new i.bf([]),sortKey:0,state:Jn})}Ot&&Lt.sort((vr,Gt)=>vr.sortKey-Gt.sortKey);for(const vr of Lt){const Gt=vr.state;if(Gt)if(y.terrain?y.terrain.setupElevationDraw(Gt.tile,Gt.program,{useDepthForOcclusion:De.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Gt.labelPlaneMatrixInv}):y.setupDepthForOcclusion(De.depthOcclusionForSymbolsAndCircles,Gt.program),Ve.activeTexture.set(Be.TEXTURE0),Gt.atlasTexture&&Gt.atlasTexture.bind(Gt.atlasInterpolation,Be.CLAMP_TO_EDGE,!0),Gt.atlasTextureIcon&&(Ve.activeTexture.set(Be.TEXTURE1),Gt.atlasTextureIcon&&Gt.atlasTextureIcon.bind(Gt.atlasInterpolationIcon,Be.CLAMP_TO_EDGE,!0)),Gt.renderWithShadows&&y.shadowRenderer.setupShadows(Gt.tile.tileID.toUnwrapped(),Gt.program,"vector-tile"),y.uploadCommonLightUniforms(y.context,Gt.program),Gt.hasHalo){const Yt=Gt.uniformValues;Yt.u_is_halo=1,w_(Gt.buffers,vr.segments,h,y,Gt.program,Gt.depthMode,w,P,Yt,2),Yt.u_is_halo=0}else{if(Gt.isSDF){const Yt=Gt.uniformValues;Gt.hasHalo&&(Yt.u_is_halo=1,w_(Gt.buffers,vr.segments,h,y,Gt.program,Gt.depthMode,w,P,Yt,1)),Yt.u_is_halo=0}w_(Gt.buffers,vr.segments,h,y,Gt.program,Gt.depthMode,w,P,Gt.uniformValues,1)}}}function w_(y,s,h,v,w,P,O,L,z,G){const H=[y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer,y.iconTransitioningVertexBuffer,y.globeExtVertexBuffer,y.zOffsetVertexBuffer,y.orientationVertexBuffer];w.draw(v,v.context.gl.TRIANGLES,P,O,L,Gr.disabled,z,h.id,y.layoutVertexBuffer,y.indexBuffer,s,h.paint,v.transform.zoom,y.programConfigurations.get(h.id),H,G)}function D2(y,s){const h=1<<y.canonical.z,v=(s.x*h-y.canonical.x-y.wrap*h)*i.al,w=(s.y*h-y.canonical.y)*i.al,P=i.e7(s.z,s.y);return i.d4(v,w,P)}function Xh(y,s,h,v,w){if(!h.layout||h.layout.get("fill-elevation-reference")==="none"||h.paint.get("fill-opacity").constantOr(1)===0)return;const P=y.context.gl,O=new Sr(y.context.gl.LEQUAL,Sr.ReadWrite,y.depthRangeFor3D),L=new Sr(y.context.gl.GREATER,Sr.ReadWrite,y.depthRangeFor3D),z=function(re){let le=.01;return re.isOrthographic&&(le=i.ak(1e-4,le,i.c$(re.pitch>=qh?1:re.pitch/qh))),2*le}(y.transform),G=y.transform.getFreeCameraOptions().position,H="elevatedStructuresDepthReconstruct",Q=y.getOrCreateProgram(H,{defines:["DEPTH_RECONSTRUCTION"]}),K=y.getOrCreateProgram(H);for(const re of v){const le=s.getTile(re),ue=le.getBucket(h);if(!ue)continue;const _e=ue.elevatedStructures;if(!_e)continue;const ge=ue.elevationBufferData.heightRange,Se=D2(re.toUnwrapped(),G),ke=y.translatePosMatrix(re.projMatrix,le,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));let Te,$e,Re,Ve;if(w==="initialize"){if(!ge||ge.min>=1||_e.depthSegments.segments[0].primitiveLength===0)continue;Te=d_(ke,Se,z,1,0),$e=O,Re=_e.depthSegments,Ve=Q}else if(w==="reset"){if(!ge||ge.min>=0||_e.maskSegments.segments[0].primitiveLength===0)continue;Te=d_(ke,Se,0,0,1),$e=L,Re=_e.maskSegments,Ve=Q}else if(w==="geometry"){if(_e.depthSegments.segments[0].primitiveLength===0)continue;Te=d_(ke,Se,z,1,0),$e=O,Re=_e.depthSegments,Ve=K}Ve.draw(y,P.TRIANGLES,$e,Yr.disabled,mn.disabled,Gr.disabled,Te,h.id,_e.vertexBuffer,_e.indexBuffer,Re,h.paint,y.transform.zoom)}}function gp(y,s,h){const{painter:v,sourceCache:w,layer:P,coords:O,colorMode:L,elevationType:z,terrainEnabled:G,pass:H}=y,Q=v.context.gl,K=P.paint.get("fill-pattern"),re=P.paint.get("fill-pattern-cross-fade"),le=K.constantOr(null);let ue=z;z!=="road"||s&&!G||(ue="none");const _e=ue==="road",ge=y.painter.shadowRenderer,Se=_e&&!!ge&&ge.enabled,ke=new Sr(v.context.gl.LEQUAL,Sr.ReadOnly,v.depthRangeFor3D);let Te=[0,0,0];if(Se){const Ve=v.style.directionalLight,Be=v.style.ambientLight;Ve&&Be&&(Te=rc(v.style,Ve,Be))}const $e=K&&K.constantOr(1),Re=(Ve,Be)=>{let De,We,lt,it,bt;Be?(De=$e&&!P.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",lt=Q.LINES):(De=$e?"fillPattern":"fill",lt=Q.TRIANGLES);for(const mt of O){const Ot=w.getTile(mt);if($e&&!Ot.patternsLoaded())continue;const Zt=Ot.getBucket(P);if(!Zt)continue;const pt=s?Zt.elevationBufferData:Zt.bufferData;if(pt.isEmpty())continue;v.prepareDrawTile();const et=pt.programConfigurations.get(P.id),kt=v.isTileAffectedByFog(mt),gt=[],Lt=[];_e&&(gt.push("ELEVATED_ROADS"),Lt.push(pt.elevatedLayoutVertexBuffer)),Se&&gt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),$e&&(v.context.activeTexture.set(Q.TEXTURE0),Ot.imageAtlasTexture&&Ot.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),et.updatePaintBuffers());let Qt=!1;if(le&&Ot.imageAtlas){const hr=Ot.imageAtlas,cr=i.e2.from(le),fr=cr.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),Mr=cr.getSecondary(),An=hr.patternPositions.get(fr),Dn=Mr?hr.patternPositions.get(Mr.scaleSelf(i.o.devicePixelRatio).toString()):null;Qt=!!An&&!!Dn,An&&et.setConstantPatternPositions(An,Dn)}re>0&&(Qt||et.getPatternTransitionVertexBuffer("fill-pattern"))&&gt.push("FILL_PATTERN_TRANSITION");const vr=v.getOrCreateProgram(De,{config:et,overrideFog:kt,defines:gt}),Gt=v.translatePosMatrix(mt.projMatrix,Ot,P.paint.get("fill-translate"),P.paint.get("fill-translate-anchor"));Se&&ge.setupShadows(Ot.tileID.toUnwrapped(),vr,"vector-tile");const Yt=P.paint.get("fill-emissive-strength");if(Be){it=pt.lineIndexBuffer,bt=pt.lineSegments;const hr=v.terrain&&v.terrain.renderingToTexture?v.terrain.drapeBufferSize:[Q.drawingBufferWidth,Q.drawingBufferHeight];We=De==="fillOutlinePattern"&&$e?uj(Gt,Yt,v,Ot,hr,Te,re):cj(Gt,Yt,hr,Te)}else it=pt.indexBuffer,bt=pt.triangleSegments,We=$e?I2(Gt,Yt,v,Ot,Te,re):k2(Gt,Yt,Te);v.uploadCommonUniforms(v.context,vr,mt.toUnwrapped());let br=Ve;(z==="road"&&!G||z==="offset")&&(br=ke),vr.draw(v,lt,br,h||v.stencilModeForClipping(mt),L,Gr.disabled,We,P.id,pt.layoutVertexBuffer,it,bt,P.paint,v.transform.zoom,et,Lt)}};v.renderPass===H&&Re(v.depthModeForSublayer(1,v.renderPass==="opaque"?Sr.ReadWrite:Sr.ReadOnly),!1),ue==="none"&&v.renderPass==="translucent"&&P.paint.get("fill-antialias")&&Re(v.depthModeForSublayer(P.getPaintProperty("fill-outline-color")?2:0,Sr.ReadOnly),!0)}function gr(y,s,h,v,w,P,O,L){h.resetLayerRenderingStats(y);const z=y.context,G=z.gl,H=y.transform,Q=h.paint.get("fill-extrusion-pattern"),K=h.paint.get("fill-extrusion-pattern-cross-fade"),re=Q.constantOr(null),le=Q.constantOr(1),ue=h.paint.get("fill-extrusion-opacity"),_e=y.style.enable3dLights(),ge=h.paint.get(_e&&!le?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Se=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),ge],ke=h.layout.get("fill-extrusion-edge-radius"),Te=ke>0&&!h.paint.get("fill-extrusion-rounded-roof"),$e=Te?0:ke,Re=H.projection.name==="globe"?i.ea():0,Ve=H.projection.name==="globe",Be=Ve?i.aj(H.zoom):0,De=[i.aF(H.center.lng),i.aJ(H.center.lat)],We=h.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",lt=h.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(We?null:h.lut).toArray01().slice(0,3),it=h.paint.get("fill-extrusion-flood-light-intensity"),bt=h.paint.get("fill-extrusion-vertical-scale"),mt=h.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Ot=h.paint.get("fill-extrusion-height-alignment"),Zt=h.paint.get("fill-extrusion-base-alignment"),pt=qu(y,h.paint.get("fill-extrusion-cutoff-fade-range")),et=[];let kt;Ve&&et.push("PROJECTION_GLOBE_VIEW"),Se[0]>0&&et.push("FAUX_AO"),Te&&et.push("ZERO_ROOF_RADIUS"),L&&et.push("HAS_CENTROID"),it>0&&et.push("FLOOD_LIGHT"),pt.shouldRenderCutoff&&et.push("RENDER_CUTOFF"),mt&&et.push("RENDER_WALL_MODE");const gt=y.renderPass==="shadow",Lt=y.shadowRenderer,Qt=gt&&!!Lt,vr=gt?Gr.disabled:Gr.backCCW;y.shadowRenderer&&(y.shadowRenderer.useNormalOffset=!0);let Gt=[0,0,0];if(Lt){const hr=y.style.directionalLight,cr=y.style.ambientLight;hr&&cr&&(Gt=rc(y.style,hr,cr)),gt||(et.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Lt.useNormalOffset&&et.push("NORMAL_OFFSET")),kt=et.concat(["SHADOWS_SINGLE_CASCADE"])}const Yt=Qt?"fillExtrusionDepth":le?"fillExtrusionPattern":"fillExtrusion",br=h.getLayerRenderingStats();for(const hr of v){const cr=s.getTile(hr),fr=cr.getBucket(h);if(!fr||fr.projection.name!==H.projection.name)continue;let Mr=!1;Lt&&(Mr=Lt.getMaxCascadeForTile(hr.toUnwrapped())===0);const An=y.isTileAffectedByFog(hr),Dn=fr.programConfigurations.get(h.id);let mi=!1;if(re&&cr.imageAtlas){const qn=cr.imageAtlas,dn=i.e2.from(re),Jn=dn.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),gn=dn.getSecondary(),Mi=qn.patternPositions.get(Jn),ri=gn?qn.patternPositions.get(gn.scaleSelf(i.o.devicePixelRatio).toString()):null;mi=!!Mi&&!!ri,Mi&&Dn.setConstantPatternPositions(Mi,ri)}K>0&&(mi||Dn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&et.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Hr=y.getOrCreateProgram(Yt,{config:Dn,defines:Mr?kt:et,overrideFog:An});if(y.terrain&&y.terrain.setupElevationDraw(cr,Hr,{useMeterToDem:!0}),!fr.centroidVertexBuffer){const qn=Hr.getAttributeLocation(G,"a_centroid_pos");qn!==-1&&G.vertexAttrib2f(qn,0,0)}!gt&&Lt&&Lt.setupShadows(cr.tileID.toUnwrapped(),Hr,"vector-tile"),le&&(y.context.activeTexture.set(G.TEXTURE0),cr.imageAtlasTexture&&cr.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Dn.updatePaintBuffers());const Mn=h.paint.get("fill-extrusion-vertical-gradient"),sn=1/fr.tileToMeter;let si;if(gt&&Lt){if(L2(cr.tileID,fr.maxHeight,y))continue;const qn=Lt.calculateShadowPassMatrixFromTile(cr.tileID.toUnwrapped());si=C2(qn,$e,sn,bt,Ot,Zt)}else{const qn=y.translatePosMatrix(hr.expandedProjMatrix,cr,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),dn=H.projection.createInversionMatrix(H,hr.canonical);si=le?O2(qn,y,Mn,ue,Se,$e,sn,hr,cr,Re,Ot,Zt,Be,De,dn,lt,bt,K):u_(qn,y,Mn,ue,Se,$e,sn,hr,Re,Ot,Zt,Be,De,dn,lt,bt,it,Gt)}y.uploadCommonUniforms(z,Hr,hr.toUnwrapped(),null,pt);let Ln=fr.segments;if(H.projection.name==="mercator"&&!gt&&(Ln=fr.getVisibleSegments(cr.tileID,y.terrain,y.transform.getFrustum(0)),!Ln.get().length))continue;if(br)if(gt)for(const qn of Ln.get())br.numRenderedVerticesInShadowPass+=qn.primitiveLength;else for(const qn of Ln.get())br.numRenderedVerticesInTransparentPass+=qn.primitiveLength;const Ai=[];(y.terrain||L)&&Ai.push(fr.centroidVertexBuffer),Ve&&Ai.push(fr.layoutVertexExtBuffer),mt&&Ai.push(fr.wallVertexBuffer),Hr.draw(y,z.gl.TRIANGLES,w,P,O,vr,si,h.id,fr.layoutVertexBuffer,fr.indexBuffer,Ln,h.paint,y.transform.zoom,Dn,Ai)}y.shadowRenderer&&(y.shadowRenderer.useNormalOffset=!1)}class jw{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Gu(y,s,h,v,w,P,O,L,z,G,H,Q,K,re,le,ue,_e,ge,Se,ke){const Te=s.context,$e=Te.gl,Re=s.transform,Ve=s.transform.zoom,Be=[],De=y.translate,We=y.translateAnchor,lt=y.edgeRadius,it=qu(s,y.cutoffFadeRange);H==="clear"?(Be.push("CLEAR_SUBPASS"),ke&&(Be.push("CLEAR_FROM_TEXTURE"),Te.activeTexture.set($e.TEXTURE0),ke.bind($e.LINEAR,$e.CLAMP_TO_EDGE))):H==="sdf"&&Be.push("SDF_SUBPASS"),ge&&Be.push("HAS_CENTROID"),it.shouldRenderCutoff&&Be.push("RENDER_CUTOFF");const bt=(mt,Ot,Zt,pt,et)=>{let kt=Be;Ot.groundRadiusBuffer!=null&&(kt=Be.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const gt=Ot.programConfigurations.get(v.id),Lt=s.isTileAffectedByFog(mt),Qt=s.getOrCreateProgram("fillExtrusionGroundEffect",{config:gt,defines:kt,overrideFog:Lt}),vr=fp(s,pt,Q,G,et,[K,re*et],le,ue,_e,Ve>=17?0:lt*et,ke?ke.size[0]:0),Gt=[];ge&&Gt.push(Ot.hiddenByLandmarkVertexBuffer),Ot.groundRadiusBuffer!=null&&Gt.push(Ot.groundRadiusBuffer),s.uploadCommonUniforms(Te,Qt,mt.toUnwrapped(),null,it),Qt.draw(s,Te.gl.TRIANGLES,P,O,L,z,vr,v.id,Ot.vertexBuffer,Ot.indexBuffer,Zt,v.paint,Ve,gt,Gt)};for(const mt of w){const Ot=h.getTile(mt),Zt=Ot.getBucket(v);if(!Zt||Zt.projection.name!==Re.projection.name||!Zt.groundEffect||Zt.groundEffect&&!Zt.groundEffect.hasData())continue;const pt=Zt.groundEffect,et=1/Zt.tileToMeter;{const kt=s.translatePosMatrix(mt.projMatrix,Ot,De,We),gt=pt.getDefaultSegment();bt(mt,pt,gt,kt,et)}if(Se)for(let kt=0;kt<4;kt++){const gt=i.e8[kt](mt),Lt=h.getTile(gt);if(!Lt)continue;const Qt=Lt.getBucket(v);if(!Qt||Qt.projection.name!==Re.projection.name||!Qt.groundEffect||Qt.groundEffect&&!Qt.groundEffect.hasData())continue;const vr=Qt.groundEffect;let Gt,Yt;kt===0?(Gt=[-i.al,0,0],Yt=1):kt===1?(Gt=[i.al,0,0],Yt=0):kt===2?(Gt=[0,-i.al,0],Yt=3):(Gt=[0,i.al,0],Yt=2);const br=vr.regionSegments[Yt];if(!br)continue;const hr=new Float32Array(16);i.bq(hr,mt.projMatrix,Gt),bt(mt,vr,br,s.translatePosMatrix(hr,Ot,De,We),et)}}}function qd(y,s,h,v,w,P,O){v.centroidVertexArray.length===0&&v.createCentroidsBuffer();const L=P?P.findDEMTileFor(h):null;if(!(L&&L.dem||O))return;P&&L&&L.dem&&v.selfDEMTileTimestamp!==L.dem._timestamp&&(v.borderDoneWithNeighborZ=[-1,-1,-1,-1],v.selfDEMTileTimestamp=L.dem._timestamp);const z=ge=>new i.P(Math.ceil((ge+i.ec)*i.ed),0),G=ge=>{const Se=s.getSource().minzoom,ke=$e=>{const Re=s.getTileByID($e);if(Re&&Re.hasData())return Re.getBucket(w)},Te=[0,-1,1];for(const $e of Te){if(ge.overscaledZ+$e<Se)continue;const Re=ke(ge.calculateScaledKey(ge.overscaledZ+$e));if(Re)return Re}},H=[0,0,0],Q=(ge,Se)=>(H[0]=Math.min(ge.min.y,Se.min.y),H[1]=Math.max(ge.max.y,Se.max.y),H[2]=i.al-Se.min.x>ge.max.x?Se.min.x-i.al:ge.max.x,H),K=(ge,Se)=>(H[0]=Math.min(ge.min.x,Se.min.x),H[1]=Math.max(ge.max.x,Se.max.x),H[2]=i.al-Se.min.y>ge.max.y?Se.min.y-i.al:ge.max.y,H),re=[(ge,Se)=>Q(ge,Se),(ge,Se)=>Q(Se,ge),(ge,Se)=>K(ge,Se),(ge,Se)=>K(Se,ge)],le=(ge,Se,ke,Te,$e,Re,Ve)=>{if(!P)return 0;const Be=[[Re?ke:ge,Re?ge:ke,0],[Re?ke:Se,Re?Se:ke,0]],De=Ve<0?i.al+Ve:Ve,We=[Re?De:(ge+Se)/2,Re?(ge+Se)/2:De,0];return ke===0&&Ve<0||ke!==0&&Ve>0?P.getForTilePoints($e,[We],!0,Te):Be.push(We),P.getForTilePoints(h,Be,!0,L),Math.max(Be[0][2],Be[1][2],We[2])/P.exaggeration()};for(let ge=0;ge<4;ge++){const Se=v.borderFeatureIndices[ge];if(Se.length===0)continue;const ke=i.e8[ge](h),Te=G(ke);if(!(Te&&Te instanceof i.e9))continue;const $e=P?P.findDEMTileFor(ke):null;if(!($e&&$e.dem||O)||(P&&$e&&$e.dem&&v.borderDEMTileTimestamp[ge]!==$e.dem._timestamp&&(v.borderDoneWithNeighborZ[ge]=-1,v.borderDEMTileTimestamp[ge]=$e.dem._timestamp),v.borderDoneWithNeighborZ[ge]===Te.canonical.z))continue;Te.centroidVertexArray.length===0&&Te.createCentroidsBuffer();const Re=(ge<2?1:5)-ge,Ve=Te.borderDoneWithNeighborZ[Re]!==v.canonical.z,Be=Te.borderFeatureIndices[Re];let De=0;if(v.canonical.z!==Te.canonical.z){for(const We of Se)v.showCentroid(v.featuresOnBorder[We]);if(Ve)for(const We of Be)Te.showCentroid(Te.featuresOnBorder[We]);v.borderDoneWithNeighborZ[ge]=Te.canonical.z,Te.borderDoneWithNeighborZ[Re]=v.canonical.z}for(const We of Se){const lt=v.featuresOnBorder[We],it=v.centroidData[lt.centroidDataIndex],bt=lt.borders[ge];let mt;for(;De<Be.length;){mt=Te.featuresOnBorder[Be[De]];const Ot=mt.borders[Re];if(Ot[1]>bt[0]+3||Ot[0]>bt[0]-3)break;Te.showCentroid(mt),De++}if(mt&&De<Be.length){const Ot=De;let Zt=0;for(;!(mt.borders[Re][0]>bt[1]-3)&&(Zt++,++De!==Be.length);)mt=Te.featuresOnBorder[Be[De]];mt=Te.featuresOnBorder[Be[Ot]];let pt=!1;if(Zt>=1){const gt=mt.borders[Re];Math.abs(bt[0]-gt[0])<3&&Math.abs(bt[1]-gt[1])<3&&(Zt=1,pt=!0,De=Ot+1)}else if(Zt===0){v.showCentroid(lt);continue}const et=Te.centroidData[mt.centroidDataIndex];O&&pt&&(((ue=it).flags|(_e=et).flags)&i.eb?(ue.flags|=i.eb,_e.flags|=i.eb):(ue.flags&=~i.eb,_e.flags&=~i.eb));const kt=lt.intersectsCount()>1||mt.intersectsCount()>1;if(Zt>1)De=Ot,it.centroidXY=et.centroidXY=new i.P(0,0);else if($e&&$e.dem&&!kt){const gt=re[ge](it,et),Lt=ge%2?i.al-1:0,Qt=le(gt[0],Math.min(i.al-1,gt[1]),Lt,$e,ke,ge<2,gt[2]);it.centroidXY=et.centroidXY=z(Qt)}else kt?it.centroidXY=et.centroidXY=new i.P(0,0):(it.centroidXY=v.encodeBorderCentroid(lt),et.centroidXY=Te.encodeBorderCentroid(mt));v.writeCentroidToBuffer(it),Te.writeCentroidToBuffer(et)}else v.showCentroid(lt)}v.borderDoneWithNeighborZ[ge]=Te.canonical.z,Te.borderDoneWithNeighborZ[Re]=v.canonical.z}var ue,_e;(v.needsCentroidUpdate||!v.centroidVertexBuffer&&v.centroidVertexArray.length!==0)&&v.uploadCentroid(y)}const Wd=[1,0,0],Nr=[0,1,0],Nw=[0,0,1];function L2(y,s,h){const v=h.transform,w=h.shadowRenderer;if(!w)return!0;const P=y.toUnwrapped(),O=v.tileSize*w._cascades[h.currentShadowCascade].scale;let L=s;if(v.elevation){const ue=v.elevation.getMinMaxForTile(y);ue&&(L+=ue.max)}const z=[...w.shadowDirection];z[2]=-z[2];const G=w.computeSimplifiedTileShadowVolume(P,L,O,z);if(!G)return!1;const H=[Wd,Nr,Nw,z,[z[0],0,z[2]],[0,z[1],z[2]]],Q=v.projection.name==="globe",K=v.scaleZoom(O),re=i.cA.fromInvProjectionMatrix(v.invProjMatrix,v.worldSize,K,!Q),le=w.getCurrentCascadeFrustum();return re.intersectsPrecise(G.vertices,G.planes,H)===0||le.intersectsPrecise(G.vertices,G.planes,H)===0}function S_(y){const{painter:s,source:h,layer:v,coords:w}=y;let P=y.defines;const O=s.context,L=s.renderPass==="shadow",z=s.renderPass==="light-beam",G=s.shadowRenderer,H=i.ee(s.transform.center.lat,s.transform.zoom),Q=qu(s,v.paint.get("building-cutoff-fade-range"));Q.shouldRenderCutoff&&(P=P.concat("RENDER_CUTOFF")),y.floodLightIntensity>0&&(P=P.concat("FLOOD_LIGHT"));for(const K of w){const re=h.getTile(K),le=re.getBucket(v);if(!le)continue;G&&G.getMaxCascadeForTile(K.toUnwrapped())===0&&(P=P.concat("SHADOWS_SINGLE_CASCADE"));const ue=le.programConfigurations.get(v.id);let _e,ge,Se,ke=s.translatePosMatrix(K.expandedProjMatrix,re,[0,0],"map");if(ke=i.cR(i.bB(),ke,[1,1,y.verticalScale]),L&&G){if(L2(re.tileID,le.maxHeight*H,s))continue;let $e=G.calculateShadowPassMatrixFromTile(re.tileID.toUnwrapped());$e=i.cR(i.bB(),$e,[1,1,y.verticalScale]),Se=R2($e),_e=ge=s.getOrCreateProgram("buildingDepth",{config:ue,defines:P,overrideFog:!1})}else if(z)_e=ge=s.getOrCreateProgram("buildingBloom",{config:ue,defines:P,overrideFog:!1}),Se=Aw(ke);else{const $e=s.transform.calculatePosMatrix(K.toUnwrapped(),s.transform.worldSize);i.cR($e,$e,[1,1,y.verticalScale]);const Re=i.bB();i.cR(Re,$e,[1,-1,1/H]),i.bk(Re,Re),i.ef(Re,Re);const Ve=s.transform.getFreeCameraOptions().position,Be=1<<K.canonical.z;if(Se=Tw(ke,Re,y.opacity,y.facadeAOIntensity,[((Ve.x-K.wrap)*Be-K.canonical.x)*i.al,(Ve.y*Be-K.canonical.y)*i.al,Ve.z*Be*i.al],le.tileToMeter,y.facadeEmissiveChance,y.floodLightColor,y.floodLightIntensity),ge=s.getOrCreateProgram("building",{config:ue,defines:P,overrideFog:!1}),y.depthOnly===!0)_e=ge;else{const De=P.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);_e=s.getOrCreateProgram("building",{config:ue,defines:De,overrideFog:!1})}G&&(G.setupShadowsFromMatrix($e,ge,!0),_e!==ge&&G.setupShadowsFromMatrix($e,_e,!0))}const Te=($e,Re)=>{if(z){const Ve=$e.entranceBloom;Re.draw(s,O.gl.TRIANGLES,y.depthMode,Yr.disabled,y.blendMode,Gr.disabled,Se,v.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segmentsBucket,v.paint,s.transform.zoom,ue,[Ve.layoutAttenuationBuffer,Ve.layoutColorBuffer])}else{const Ve=$e.segmentsBucket;let Be=[$e.layoutNormalBuffer,$e.layoutCentroidBuffer,$e.layoutColorBuffer,$e.layoutFloodLightDataBuffer];$e.layoutFacadePaintBuffer&&(Be=Be.concat([$e.layoutFacadeDataBuffer,$e.layoutFacadeVerticalRangeBuffer,$e.layoutFacadePaintBuffer])),Re.draw(s,O.gl.TRIANGLES,y.depthMode,Yr.disabled,y.blendMode,L?Gr.disabled:Gr.backCW,Se,v.id,$e.layoutVertexBuffer,$e.indexBuffer,Ve,v.paint,s.transform.zoom,ue,Be)}};s.uploadCommonUniforms(O,ge,K.toUnwrapped(),null,Q),le.buildingWithoutFacade&&Te(le.buildingWithoutFacade,ge),le.buildingWithFacade&&(_e!==ge&&s.uploadCommonUniforms(O,_e,K.toUnwrapped(),null,Q),Te(le.buildingWithFacade,_e))}}function E_(y,s,h,v,w,P,O,L,z,G,H,Q,K){const re=y.context.gl,le=y.depthModeForSublayer(1,Sr.ReadOnly,re.LEQUAL,!0),ue=.1*(1-(_e=H))+3*_e;var _e;const ge=y._showOverdrawInspector,Se=Q,ke=new jw;ge||Gu(ke,y,s,h,v,le,new Yr({func:re.ALWAYS,mask:255},255,255,re.KEEP,re.KEEP,re.REPLACE),new mn([re.ONE,re.ONE,re.ONE,re.ONE],i.ao.transparent,[!1,!1,!1,!0],re.MIN),Gr.disabled,w,"sdf",P,O,L,z,G,ue,Se,!1);{const Te=ge?Yr.disabled:new Yr({func:re.EQUAL,mask:255},255,255,re.KEEP,re.DECR,re.DECR),$e=ge?y.colorModeForRenderPass():new mn([re.ONE_MINUS_DST_ALPHA,re.DST_ALPHA,re.ONE,re.ONE],i.ao.transparent,[!0,!0,!0,!0]);Gu(ke,y,s,h,v,le,Te,$e,Gr.disabled,w,"color",P,O,L,z,G,ue,Se,!1)}}function Mw(y){return[y[0]*i.eg,y[1]*i.eg,y[2]*i.eg,0]}function Dw(y,s,h,v,w,P,O,L,z){const G=v.getSource(),H=h.globeSharedBuffers;if(!H)return;let Q,K,re;if(s&&(Q=v.getTile(s)),G instanceof i.aT?(K=G.texture,re=i.dJ(0,0,h.transform)):Q&&s&&(K=Q.texture,re=i.dJ(s.canonical.z,s.canonical.x,h.transform)),!K||!re)return;y||(re=i.cR(i.bB(),re,[1,-1,1]));const le=h.context,ue=le.gl,_e=w.paint.get("raster-resampling")==="nearest"?ue.NEAREST:ue.LINEAR,ge=h.colorModeForDrapableLayerRenderPass(P),Se=O.defines;Se.push("GLOBE_POLES");const ke=new Sr(ue.LEQUAL,Sr.ReadWrite,h.depthRangeFor3D),Te=Float32Array.from(h.transform.expandedFarZProjMatrix),$e=Float32Array.from(i.bj(i.dI(new i.cC(0,0,0))));h.terrain&&h.terrain.prepareDrawTile(),le.activeTexture.set(ue.TEXTURE0),K.bind(_e,ue.CLAMP_TO_EDGE),le.activeTexture.set(ue.TEXTURE1),K.bind(_e,ue.CLAMP_TO_EDGE),"useMipmap"in K&&le.extTextureFilterAnisotropic&&h.transform.pitch>20&&ue.texParameterf(ue.TEXTURE_2D,le.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,le.extTextureFilterAnisotropicMax);const[Re,Ve,Be,De]=s?H.getPoleBuffers(s.canonical.z,!1):H.getPoleBuffers(0,!0),We=w.paint.get("raster-elevation");let lt;y?(lt=Re,h.renderDefaultNorthPole=We!==0):(lt=Ve,h.renderDefaultSouthPole=We!==0);const it=Mw(O.mix),bt=((Ot,Zt,pt,et,kt,gt,Lt,Qt,vr,Gt,Yt,br,hr)=>Wg(Ot,Zt,pt,new Float32Array(16),new Float32Array(9),[0,0],et,[0,0],[0,0,0,0],1,{opacity:1,mix:0},gt,[0,0],Qt,2,Gt,Yt,br,1,0,hr))(Te,$e,re,i.aj(h.transform.zoom),0,w,0,We,0,it,O.offset,O.range,P),mt=h.getOrCreateProgram("raster",{defines:Se});h.uploadCommonUniforms(le,mt,null),mt.draw(h,ue.TRIANGLES,ke,z,ge,L,bt,w.id,lt,Be,De)}function F2(y){const s=y._nearZ,h=y.projection.farthestPixelDistance(y),v=h-s,w=.2*y.height,P=s+w;return[s,h,(P-w-s)/v,(P-s)/v]}function pj(y,s,h,v){if(y)return s instanceof lo&&y instanceof Ld?s.getTextureDescriptor(y,h,!0):{texture:y.texture,mix:Mw(v.mix),offset:v.offset,buffer:0,tileSize:1}}var mj=i.eh([{name:"a_index",type:"Int16",components:1}]);class Qs{constructor(s,h,v,w){const P={width:v[0],height:v[1],data:null},O=s.gl;this.targetColorTexture=new i.T(s,P,O.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(s,P,O.RGBA8,{useMipmap:!1}),this.context=s,this.updateParticleTexture(h,w),this.lastInvalidatedAt=0}updateParticleTexture(s,h){if(this.particleTextureDimension===h.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const v=this.context.gl,w=h.width*h.height;this.particleTexture0=new i.T(this.context,h,v.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,h,v.RGBA8,{premultiply:!1,useMipmap:!1});const P=new i.ei;P.reserve(w);for(let O=0;O<w;O++)P.emplaceBack(O);this.particleIndexBuffer=this.context.createVertexBuffer(P,mj.members,!0),this.particleSegment=i.bf.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=h.width}update(s){return!(this.lastInvalidatedAt<s&&(this.lastInvalidatedAt=i.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Lw(y,s,h){if(!y)return null;const v=s.getTextureDescriptor(y,h,!0);if(!v)return null;let{texture:w,mix:P,offset:O,tileSize:L,buffer:z,format:G}=v;if(!w||!G)return null;let H=!1;return G==="uint32"&&(H=!0,P[3]=0,P=h_(i.ej,P,[0,h.paint.get("raster-particle-max-speed")]),O=Wu(i.ej,O,[0,h.paint.get("raster-particle-max-speed")])),{texture:w,textureOffset:[z/(L+2*z),L/(L+2*z)],tileSize:L,scalarData:H,scale:P,offset:O,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[G]]}}function Es(y){const s=y._nearZ,h=y.projection.farthestPixelDistance(y),v=h-s,w=.2*y.height,P=s+w;return[s,h,(P-w-s)/v,(P-s)/v]}const Gd=new i.ao(1,0,0,1),z2=new i.ao(0,1,0,1),Fw=new i.ao(0,0,1,1),zw=new i.ao(1,0,1,1),Bw=new i.ao(0,1,1,1);function $w(y,s,h,v,w,P){for(let O=0;O<h.length;O++)if(w){const G=new i.ao(v.r*.8,v.g*.8,v.b*.8,1);el(y,s,h[O],v,-1,-1,P),el(y,s,h[O],v,-1,1,P),el(y,s,h[O],v,1,1,P),el(y,s,h[O],v,1,-1,P),el(y,s,h[O],G,0,0,P)}else el(y,s,h[O],v,0,0,P)}function el(y,s,h,v,w,P,O){const L=y.context,z=y.transform,G=L.gl,H=z.projection.name==="globe",Q=H?["PROJECTION_GLOBE_VIEW"]:[];let K=i.by(h.projMatrix);if(H&&i.aj(z.zoom)>0){const it=i.bi(h.canonical,z),bt=i.ek(it);K=i.aB(new Float32Array(16),z.globeMatrix,bt),i.aB(K,z.projMatrix,K)}const re=i.bB();re[12]+=2*w/(i.o.devicePixelRatio*z.width),re[13]+=2*P/(i.o.devicePixelRatio*z.height),i.aB(K,re,K);const le=y.getOrCreateProgram("debug",{defines:Q}),ue=s.getTileByID(h.key);y.terrain&&y.terrain.setupElevationDraw(ue,le);const _e=Sr.disabled,ge=Yr.disabled,Se=y.colorModeForRenderPass(),ke="$debug";L.activeTexture.set(G.TEXTURE0),y.emptyTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),H?ue._makeGlobeTileDebugBuffers(y.context,z):ue._makeDebugTileBoundsBuffers(y.context,z.projection);const Te=ue._tileDebugBuffer||y.debugBuffer,$e=ue._tileDebugIndexBuffer||y.debugIndexBuffer,Re=ue._tileDebugSegments||y.debugSegments;if(le.draw(y,G.LINE_STRIP,_e,ge,Se,Gr.disabled,Pw(K,v.toPremultipliedRenderColor(null)),ke,Te,$e,Re,null,null,null,[ue._globeTileDebugBorderBuffer]),O){const it=ue.latestRawTileData,bt=Math.floor((it&&it.byteLength||0)/1024);let mt=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(mt+=` => ${h.overscaledZ}`),mt+=` ${ue.state}`,mt+=` ${bt}kb`,function(Ot,Zt){Ot.initDebugOverlayCanvas();const pt=Ot.debugOverlayCanvas,et=Ot.context.gl,kt=Ot.debugOverlayCanvas.getContext("2d");kt.clearRect(0,0,pt.width,pt.height),kt.shadowColor="white",kt.shadowBlur=2,kt.lineWidth=1.5,kt.strokeStyle="white",kt.textBaseline="top",kt.font="bold 36px Open Sans, sans-serif",kt.fillText(Zt,5,5),kt.strokeText(Zt,5,5),Ot.debugOverlayTexture.update(pt),Ot.debugOverlayTexture.bind(et.LINEAR,et.CLAMP_TO_EDGE)}(y,mt)}const Ve=s.getTile(h).tileSize,Be=512/Math.min(Ve,512)*(h.overscaledZ/z.zoom)*.5,De=ue._tileDebugTextBuffer||y.debugBuffer,We=ue._tileDebugTextIndexBuffer||y.quadTriangleIndexBuffer,lt=ue._tileDebugTextSegments||y.debugSegments;le.draw(y,G.TRIANGLES,_e,ge,mn.alphaBlended,Gr.disabled,Pw(K,i.ao.transparent.toPremultipliedRenderColor(null),Be),ke,De,We,lt,null,null,null,[ue._globeTileDebugTextBuffer])}function Ri(y,s,h,v){yp(y,0,s+h/2,y.transform.width,h,v)}function Kg(y,s,h,v){yp(y,s-h/2,0,h,y.transform.height,v)}function yp(y,s,h,v,w,P){const O=y.context,L=O.gl;L.enable(L.SCISSOR_TEST),L.scissor(s*i.o.devicePixelRatio,h*i.o.devicePixelRatio,v*i.o.devicePixelRatio,w*i.o.devicePixelRatio),O.clear({color:P}),L.disable(L.SCISSOR_TEST)}const B2=i.eh([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:$2}=B2;function Hu(y,s,h,v){y.emplaceBack(s,h,v)}class Uw{constructor(s){this.vertexArray=new i.el,this.indices=new i.b0,Hu(this.vertexArray,-1,-1,1),Hu(this.vertexArray,1,-1,1),Hu(this.vertexArray,-1,1,1),Hu(this.vertexArray,1,1,1),Hu(this.vertexArray,-1,-1,-1),Hu(this.vertexArray,1,-1,-1),Hu(this.vertexArray,-1,1,-1),Hu(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,$2),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=i.bf.simpleSegment(0,0,36,12)}}function ac(y,s,h,v,w,P){const O=y.context.gl,L=s.paint.get("sky-atmosphere-color"),z=s.paint.get("sky-atmosphere-halo-color"),G=s.paint.get("sky-atmosphere-sun-intensity"),H=((Q,K,re,le,ue)=>({u_matrix_3f:Q,u_sun_direction:K,u_sun_intensity:re,u_color_tint_r:[le.r,le.g,le.b,le.a],u_color_tint_m:[ue.r,ue.g,ue.b,ue.a],u_luminance:5e-5}))(i.en(i.dN(),v),w,G,L.toPremultipliedRenderColor(null),z.toPremultipliedRenderColor(null));O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_CUBE_MAP_POSITIVE_X+P,s.skyboxTexture,0),h.draw(y,O.TRIANGLES,Sr.disabled,Yr.disabled,mn.unblended,Gr.frontCW,H,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const Yh=i.eh([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Wt{constructor(s){const h=new i.eo;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const v=new i.b0;v.emplaceBack(0,1,2),v.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(h,Yh.members),this.indexBuffer=s.createIndexBuffer(v),this.segments=i.bf.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const lr=i.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class vp{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class ua{constructor(s){this.colorModeAlphaBlendedWriteRGB=new mn([1,Ta,1,Ta],i.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new mn([1,0,1,0],i.ao.transparent,[!1,!1,!1,!0]),this.params=new vp,this.updateNeeded=!0,s.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),s.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(s){const h=s.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Wt(h);const v=this.params.sizeRange,w=this.params.intensityRange,P=function(H){const Q=i.eq(30),K=[];for(let re=0;re<H;++re){const le=2*Math.PI*Q(),ue=Math.acos(1-2*Q())-.5*Math.PI;K.push(i.d4(Math.cos(ue)*Math.cos(le),Math.cos(ue)*Math.sin(le),Math.sin(ue)))}return K}(this.params.starsCount),O=i.eq(300),L=new i.ep,z=new i.b0;let G=0;for(let H=0;H<P.length;++H){const Q=i.c4([],P[H],200),K=Math.max(0,1+.01*v*(1*O()-.5)),re=Math.max(0,1+.01*w*(1*O()-.5));L.emplaceBack(Q[0],Q[1],Q[2],-1,-1,K,re),L.emplaceBack(Q[0],Q[1],Q[2],1,-1,K,re),L.emplaceBack(Q[0],Q[1],Q[2],1,1,K,re),L.emplaceBack(Q[0],Q[1],Q[2],-1,1,K,re),z.emplaceBack(G+0,G+1,G+2),z.emplaceBack(G+0,G+2,G+3),G+=4}this.starsVx=h.createVertexBuffer(L,lr.members),this.starsIdx=h.createIndexBuffer(z),this.starsSegments=i.bf.simpleSegment(0,0,L.length,z.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(s,h){const v=s.context,w=v.gl,P=s.transform,O=new Sr(w.LEQUAL,Sr.ReadOnly,[0,1]),L=i.aj(P.zoom),z=s.style.getLut(h.scope),G=h.properties.get("color-use-theme")==="none",H=h.properties.get("color").toNonPremultipliedRenderColor(G?null:z),Q=h.properties.get("high-color-use-theme")==="none",K=h.properties.get("high-color").toNonPremultipliedRenderColor(Q?null:z),re=h.properties.get("space-color-use-theme")==="none",le=h.properties.get("space-color").toNonPremultipliedRenderColor(re?null:z),ue=5e-4,_e=i.er(h.properties.get("horizon-blend"),0,1,ue,.25),ge=i.dD(s,v,P)&&_e===ue?P.worldSize/(2*Math.PI*1.025)-1:P.globeRadius,Se=s.frameCounter/1e3%1,ke=i.ag(P.globeCenterInViewSpace),Te=Math.sqrt(Math.pow(ke,2)-Math.pow(ge,2)),$e=Math.acos(Te/ke),Re=Ve=>{const Be=P.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ve&&Be.push("ALPHA_PASS");const De=s.getOrCreateProgram("globeAtmosphere",{defines:Be}),We=((it,bt,mt,Ot,Zt,pt,et,kt,gt,Lt,Qt,vr)=>({u_frustum_tl:it,u_frustum_tr:bt,u_frustum_br:mt,u_frustum_bl:Ot,u_horizon:Zt,u_transition:pt,u_fadeout_range:et,u_atmosphere_fog_color:kt.toArray01(),u_high_color:gt.toArray01(),u_space_color:Lt.toArray01(),u_temporal_offset:Qt,u_horizon_angle:vr}))(P.frustumCorners.TL,P.frustumCorners.TR,P.frustumCorners.BR,P.frustumCorners.BL,P.frustumCorners.horizon,L,_e,H,K,le,Se,$e);s.uploadCommonUniforms(v,De);const lt=this.atmosphereBuffer;lt&&De.draw(s,w.TRIANGLES,O,Yr.disabled,Ve?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Gr.backCW,We,Ve?"atmosphere_glow_alpha":"atmosphere_glow",lt.vertexBuffer,lt.indexBuffer,lt.segments)};Re(!1),Re(!0)}drawStars(s,h){const v=i.aA(h.properties.get("star-intensity"),0,1);if(v===0)return;const w=s.context,P=w.gl,O=s.transform,L=s.getOrCreateProgram("stars"),z=i.c6([]);i.c8(z,z,-O._pitch),i.c7(z,z,-O.angle),i.c8(z,z,i.an(O._center.lat)),i.es(z,z,-i.an(O._center.lng));const G=i.cb(new Float32Array(16),z),H=i.aB([],O.starsProjMatrix,G),Q=i.en([],G),K=i.et([],Q),re=[0,1,0];i.dP(re,re,K),i.c4(re,re,this.params.sizeMultiplier);const le=[1,0,0];i.dP(le,le,K),i.c4(le,le,this.params.sizeMultiplier);const ue=(_e=re,ge=le,Se=v,{u_matrix:Float32Array.from(H),u_up:_e,u_right:ge,u_intensity_multiplier:Se});var _e,ge,Se;s.uploadCommonUniforms(w,L),this.starsVx&&this.starsIdx&&L.draw(s,P.TRIANGLES,Sr.disabled,Yr.disabled,this.colorModeAlphaBlendedWriteRGB,Gr.disabled,ue,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class ht{constructor(){this.visibleTiles=[]}updateBorders(s,h){const v=[],w=[],P=s._getRenderableCoordinates(!1,!0);for(const z of P){const G=s.getTile(z);if(!G.hasData())continue;const H=G.getBucket(h);H&&(H.isEmpty()||(v.push(z.key),w.push({bucket:H,tileID:z.canonical})))}let O=v.length!==this.visibleTiles.length;if(!O){v.sort();for(let z=0;z<v.length;z++)if(v[z]!==this.visibleTiles[z]){O=!0;break}}if(!O)return;const L=new Set;this.visibleTiles=v,w.sort((z,G)=>z.tileID.z-G.tileID.z||z.tileID.x-G.tileID.x||z.tileID.y-G.tileID.y);for(const z of w){const G=new Array,H=new Array,Q=z.bucket;for(const K of Q.featuresOnBorder)L.has(K.featureId)?H.push(K.footprintIndex):(L.add(K.featureId),G.push(K.footprintIndex));Q.updateFootprintHiddenFlags(G,i.eu,!1),Q.updateFootprintHiddenFlags(H,i.eu,!0)}}}function Vw(y,s){const h=[...y],v=s.cameraWorldSizeForFog/s.worldSize,w=i.bz([]);return i.cR(w,w,[v,v,1]),i.aB(h,w,h),i.aB(h,s.worldToFogMatrix,h),h}function _p(y,s,h,v,w){const P=h.material,O=v.context,{baseColorTexture:L,metallicRoughnessTexture:z}=P.pbrMetallicRoughness,{normalTexture:G,occlusionTexture:H,emissionTexture:Q}=P;function K(le,ue,_e){if(le&&(y.push(ue),O.activeTexture.set(O.gl.TEXTURE0+_e),le.gfxTexture)){const{minFilter:ge,magFilter:Se,wrapS:ke,wrapT:Te}=le.sampler;le.gfxTexture.bindExtraParam(ge,Se,ke,Te)}}K(L,"HAS_TEXTURE_u_baseColorTexture",So.BaseColor),K(z,"HAS_TEXTURE_u_metallicRoughnessTexture",So.MetallicRoughness),K(G,"HAS_TEXTURE_u_normalTexture",So.Normal),K(H,"HAS_TEXTURE_u_occlusionTexture",So.Occlusion),K(Q,"HAS_TEXTURE_u_emissionTexture",So.Emission),w&&(w.texture||(w.texture=new i.d_(v.context,w.image,[w.image.height,w.image.height,w.image.height],O.gl.RGBA8)),O.activeTexture.set(O.gl.TEXTURE0+So.LUT),w.texture&&w.texture.bind(O.gl.LINEAR,O.gl.CLAMP_TO_EDGE),y.push("APPLY_LUT_ON_GPU")),h.texcoordBuffer&&(y.push("HAS_ATTRIBUTE_a_uv_2f"),s.push(h.texcoordBuffer)),h.colorBuffer&&(y.push(h.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),s.push(h.colorBuffer)),h.normalBuffer&&(y.push("HAS_ATTRIBUTE_a_normal_3f"),s.push(h.normalBuffer)),h.pbrBuffer&&(y.push("HAS_ATTRIBUTE_a_pbr"),y.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),s.push(h.pbrBuffer)),P.alphaMode!=="OPAQUE"&&P.alphaMode!=="MASK"||y.push("UNPREMULT_TEXTURE_IN_SHADER"),P.defined||y.push("DIFFUSE_SHADED");const re=v.shadowRenderer;re&&(y.push("RENDER_SHADOWS","DEPTH_TEXTURE"),re.useNormalOffset&&y.push("NORMAL_OFFSET"))}function xp(y,s,h,v,w,P){const O=h.paint.get("model-opacity").constantOr(1),L=s.context,z=new Sr(s.context.gl.LEQUAL,y.isLightMesh?Sr.ReadOnly:Sr.ReadWrite,s.depthRangeFor3D),G=s.transform,H=y.mesh,Q=H.material,K=Q.pbrMetallicRoughness,re=s.style.fog;let le;le=s.transform.projection.zAxisUnit==="pixels"?[...y.nodeModelMatrix]:i.aB([],v.zScaleMatrix,y.nodeModelMatrix),i.aB(le,v.negCameraPosMatrix,le);const ue=i.bk([],le);i.ef(ue,ue);const _e=h.paint.get("model-color-use-theme").constantOr("default")==="none",ge=h.paint.get("model-emissive-strength").constantOr(0),Se=y_(new Float32Array(y.worldViewProjection),new Float32Array(le),new Float32Array(ue),null,s,O,K.baseColorFactor,Q.emissiveFactor,K.metallicFactor,K.roughnessFactor,Q,ge,h,void 0,void 0,y.materialOverride,y.modelColor),ke={defines:[]},Te=[],$e=s.shadowRenderer;$e&&($e.useNormalOffset=!1),_p(ke.defines,Te,H,s,_e?null:h.lut);let Re=null;if(re){const De=Vw(y.nodeModelMatrix,s.transform);if(Re=new Float32Array(De),G.projection.name!=="globe"){const We=H.aabb.min,lt=H.aabb.max,[it,bt]=re.getOpacityForBounds(De,We[0],We[1],lt[0],lt[1]);ke.overrideFog=it>=yt||bt>=yt}}const Ve=qu(s,h.paint.get("model-cutoff-fade-range"));Ve.shouldRenderCutoff&&ke.defines.push("RENDER_CUTOFF");const Be=s.getOrCreateProgram("model",ke);s.uploadCommonUniforms(L,Be,null,Re,Ve),s.renderPass!=="shadow"&&$e&&$e.setupShadowsFromMatrix(y.nodeModelMatrix,Be),Be.draw(s,L.gl.TRIANGLES,z,w,P,H.material.doubleSided?Gr.disabled:Gr.backCCW,Se,h.id,H.vertexBuffer,H.indexBuffer,H.segments,h.paint,s.transform.zoom,void 0,Te)}function T_(y,s,h){return y.type==="vector"?s.scope:h?"basemap":""}function A_(y,s,h,v,w,P,O,L,z){const G=y.transform,H=!!s.isGeometryBloom&&s.isGeometryBloom;if(H&&y.renderPass==="shadow")return;const Q=G.projection.name==="globe"?i.eC(h,G):[...h];i.aB(Q,Q,s.globalMatrix);const K=i.aB([],v,Q);if(s.meshes)for(const re of s.meshes){const le=L.get(re.material.name);if(le&&le.opacity<=0)continue;if(re.material.alphaMode!=="BLEND"){O.push({mesh:re,depth:0,modelIndex:w,worldViewProjection:K,nodeModelMatrix:Q,isLightMesh:H,materialOverride:le,modelColor:z});continue}const ue=i.af([],re.centroid,K);!G.isOrthographic&&ue[2]<=0||P.push({mesh:re,depth:ue[2],modelIndex:w,worldViewProjection:K,nodeModelMatrix:Q,isLightMesh:H,materialOverride:le,modelColor:z})}if(s.children)for(const re of s.children)A_(y,re,h,v,w,P,O,L,z)}function bp(y,s,h,v){const w=h.shadowRenderer;if(!w)return;const P=w.getShadowPassDepthMode(),O=w.getShadowPassColorMode(),L=w.calculateShadowPassMatrixFromMatrix(s),z=mp(L);h.getOrCreateProgram("modelDepth",{defines:h._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,P,Yr.disabled,O,Gr.disabled,z,v.id,y.vertexBuffer,y.indexBuffer,y.segments,v.paint,h.transform.zoom,void 0,void 0)}function wp(y,s,h,v,w,P){for(const O of w){const L=Object.assign({},v);L.part=O;const z={type:"Unknown",id:s,properties:L},G={orientation:y.paint.get("model-rotation").evaluate(z,h)};P.set(O,G)}}function gj(y,s,h,v,w,P){for(const O of w){const L=Object.assign({},v);L.part=O;const z={type:"Unknown",id:s,properties:L},G={color:y.paint.get("model-color").evaluate(z,h),colorMix:y.paint.get("model-color-mix-intensity").evaluate(z,h),opacity:y.paint.get("model-opacity").evaluate(z,h),emissionStrength:y.paint.get("model-emissive-strength").evaluate(z,h)};P.set(O,G)}}function U2(y,s,h,v,w,P){if(h===1)for(const L of w)xp(L,y,s,P[L.modelIndex],Yr.disabled,y.colorModeForRenderPass());else{for(const L of w)xp(L,y,s,P[L.modelIndex],Yr.disabled,mn.disabled);for(const L of w)xp(L,y,s,P[L.modelIndex],y.stencilModeFor3D(),y.colorModeForRenderPass());y.resetStencilClippingMasks()}const O=mn.additive;for(const L of v)xp(L,y,s,P[L.modelIndex],Yr.disabled,L.isLightMesh?O:y.colorModeForRenderPass())}function V2(y,s,h){const v=s.updateZoomBasedPaintProperties(),w=function(P,O,L){let z,G,H,Q=P.terrain?P.terrain.exaggeration():0;if(P.terrain&&Q>0){const K=P.terrain,re=K.findDEMTileFor(L);re&&re.dem?z=i.eE.create(K,L,re):Q=0}if(Q===0&&(O.terrainElevationMin=0,O.terrainElevationMax=0),Q===O.validForExaggeration&&(Q===0||z&&z._demTile&&z._demTile.tileID===O.validForDEMTile.id&&z._dem._timestamp===O.validForDEMTile.timestamp))return!1;for(const K in O.instancesPerModel){const re=O.instancesPerModel[K];for(let le=0;le<re.instancedDataArray.length;++le){const ue=(z?Q*z.getElevationAt(0|re.instancedDataArray.float32[16*le],0|re.instancedDataArray.float32[16*le+1],!0,!0):0)+re.instancesEvaluatedElevation[le];re.instancedDataArray.float32[16*le+6]=ue,G=G?Math.min(O.terrainElevationMin,ue):ue,H=H?Math.max(O.terrainElevationMax,ue):ue}}return O.terrainElevationMin=G||0,O.terrainElevationMax=H||0,O.validForExaggeration=Q,O.validForDEMTile=z&&z._demTile?{id:z._demTile.tileID,timestamp:z._dem._timestamp}:{id:void 0,timestamp:0},!0}(y,s,h);(v||w)&&(s.uploaded=!1,s.upload(y.context))}const wl={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.d8([0,0,0],[i.al,i.al,0])};function qw(y,s){const h=1<<y.canonical.z,v=s.getFreeCameraOptions().position,w=s.elevation,P=y.canonical.x/h,O=(y.canonical.x+1)/h,L=y.canonical.y/h,z=(y.canonical.y+1)/h;let G=s._centerAltitude;if(w){const re=w.getMinMaxForTile(y);re&&re.max>G&&(G=re.max)}const H=i.aA(v.x,P,O)-v.x,Q=i.aA(v.y,L,z)-v.y,K=i.ce(G,s.center.lat)-v.z;return s._zoomFromMercatorZ(Math.sqrt(H*H+Q*Q+K*K))}function Ww(y,s,h,v,w,P,O){const L=y.context,z=y.renderPass==="shadow",G=y.shadowRenderer,H=z&&G?G.getShadowPassDepthMode():new Sr(L.gl.LEQUAL,Sr.ReadWrite,y.depthRangeFor3D),Q=y.isTileAffectedByFog(P),K=y.transform.projection.name==="globe";if(h.meshes)for(const re of h.meshes){const le=K?[]:["MODEL_POSITION_ON_GPU"],ue=[];let _e,ge,Se;const ke=!K&&v.instancedDataArray.length>20;ke&&le.push("INSTANCED_ARRAYS");const Te=qu(y,s.paint.get("model-cutoff-fade-range"));if(Te.shouldRenderCutoff&&le.push("RENDER_CUTOFF"),z&&G)_e=y.getOrCreateProgram("modelDepth",{defines:le}),ge=mp(O.shadowTileMatrix,O.shadowTileMatrix,Float32Array.from(h.globalMatrix)),Se=G.getShadowPassColorMode();else{_p(le,ue,re,y,s.paint.get("model-color-use-theme").constantOr("default")==="none"?null:s.lut),_e=y.getOrCreateProgram("model",{defines:le,overrideFog:Q});const Re=re.material,Ve=Re.pbrMetallicRoughness,Be=s.paint.get("model-opacity").constantOr(1),De=s.paint.get("model-emissive-strength").constantOr(0);ge=y_(P.expandedProjMatrix,Float32Array.from(h.globalMatrix),new Float32Array(16),null,y,Be,Ve.baseColorFactor,Re.emissiveFactor,Ve.metallicFactor,Ve.roughnessFactor,Re,De,s,w),G&&(O.shadowUniformsInitialized?_e.setShadowUniformValues(L,G.getShadowUniformValues()):(G.setupShadows(P.toUnwrapped(),_e,"model-tile"),O.shadowUniformsInitialized=!0)),Se=Te.shouldRenderCutoff||Be<1||Re.alphaMode!=="OPAQUE"?mn.alphaBlended:mn.unblended}y.uploadCommonUniforms(L,_e,P.toUnwrapped(),null,Te);const $e=re.material.doubleSided?Gr.disabled:Gr.backCCW;if(ke)ue.push(v.instancedDataBuffer),_e.draw(y,L.gl.TRIANGLES,H,Yr.disabled,Se,$e,ge,s.id,re.vertexBuffer,re.indexBuffer,re.segments,s.paint,y.transform.zoom,void 0,ue,v.instancedDataArray.length);else{const Re=z?"u_instance":"u_normal_matrix";for(let Ve=0;Ve<v.instancedDataArray.length;++Ve)ge[Re]=new Float32Array(v.instancedDataArray.arrayBuffer,64*Ve,16),_e.draw(y,L.gl.TRIANGLES,H,Yr.disabled,Se,$e,ge,s.id,re.vertexBuffer,re.indexBuffer,re.segments,s.paint,y.transform.zoom,void 0,ue)}}if(h.children)for(const re of h.children)Ww(y,s,re,v,w,P,O)}const q2=[1,-1,1];function P_(y,s,h,v){if(!h.modelManager)return!0;const w=h.modelManager;if(!h.shadowRenderer)return!0;const P=h.shadowRenderer,O=s.aabb;let L=!0,z=y.maxHeight;if(z===0){let H=0;for(const Q in y.instancesPerModel){const K=w.getModel(Q,v);K?H=Math.max(H,Math.max(Math.max(K.aabb.max[0],K.aabb.max[1]),K.aabb.max[2])):L=!1}z=y.maxScale*H*1.41+y.maxVerticalOffset,L&&(y.maxHeight=z)}O.max[2]=z,O.min[2]+=y.terrainElevationMin,O.max[2]+=y.terrainElevationMax,i.af(O.min,O.min,s.tileMatrix),i.af(O.max,O.max,s.tileMatrix);const G=O.intersects(P.getCurrentCascadeFrustum());return h.currentShadowCascade===0&&(y.isInsideFirstShadowMapFrustum=G===2),G===0}function Zg(y,s){const h=y.uniformValues.u_cutoff_params[0],v=y.uniformValues.u_cutoff_params[1],w=y.uniformValues.u_cutoff_params[2],P=y.uniformValues.u_cutoff_params[3];return v===h||P===w?1:i.aA(((s-h)/(v-h)-w)/(P-w),0,1)}function Jh(y,s,h,v){if(s.pitch<20)return 1;const w=s.getWorldToCameraMatrix();i.aB(w,w,y);const P=i.bT(h.min[0],h.min[1],h.min[2],1);let O=i.aC(i.eF(),P,w),L=O,z=O;P[1]=h.max[1],O=i.aC(i.eF(),P,w),L=O[1]<L[1]?O:L,z=O[1]>z[1]?O:z,P[0]=h.max[0],O=i.aC(i.eF(),P,w),L=O[1]<L[1]?O:L,z=O[1]>z[1]?O:z,P[1]=h.min[1],O=i.aC(i.eF(),P,w),L=O[1]<L[1]?O:L,z=O[1]>z[1]?O:z;const G=i.aA(v[0],0,1),H=100*s.pixelsPerMeter*i.aA(v[1],0,1),Q=i.aA(v[2],0,1),K=i.eG(i.eF(),L,z,G),re=Math.tan(.5*s.fovX),le=-K[2]*re;if(H===0)return K[1]<-Math.abs(le)?Q:1;const ue=(-Math.abs(le)-K[1])/H,_e=(Se,ke,Te)=>(1-Te)*Se+Te*ke,ge=i.aA(_e(1,Q,ue),Q,1);return _e(1,ge,i.aA((s.pitch-20)/20,0,1))}class W2{}class G2{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(s,h,v){{const Q=this._storage.get(h.id);if(Q)return Q.lastUsedFrameIdx=s,Q.buf}const w=v.gl,P=w.getBufferParameter(w.ELEMENT_ARRAY_BUFFER,w.BUFFER_SIZE),O=new ArrayBuffer(P),L=new Int16Array(O);w.getBufferSubData(w.ELEMENT_ARRAY_BUFFER,0,new Int16Array(O));const z=new i.eI;for(let Q=0;Q<P/2;Q+=3){const K=L[Q],re=L[Q+1],le=L[Q+2];z.emplaceBack(K,re),z.emplaceBack(re,le),z.emplaceBack(le,K)}const G=v.bindVertexArrayOES.current,H=new W2;return H.buf=new Ud(v,z),H.lastUsedFrameIdx=s,this._storage.set(h.id,H),v.bindVertexArrayOES.set(G),H.buf}update(s){for(const[h,v]of this._storage)s-v.lastUsedFrameIdx>30&&(v.buf.destroy(),this._storage.delete(h))}destroy(){for(const[s,h]of this._storage)h.buf.destroy(),this._storage.delete(s)}}class yj{constructor(s){this.occluderSize=30,this.depthOffset=-1e-4,s.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),s.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const H2=i.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class vj{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class ss{constructor(s,h){this.revealStart=11,this.revealRange=2,s.registerParameter(this,[...h,"Reveal"],"revealStart",{min:0,max:17,step:.05}),s.registerParameter(this,[...h,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const _j=i.eh([{type:"Float32",name:"a_pos_2f",components:2}]);class Xg{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(s,h){const v=s.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const O=new i.eJ,L=new i.b0;O.emplaceBack(-1,-1),O.emplaceBack(1,-1),O.emplaceBack(1,1),O.emplaceBack(-1,1),L.emplaceBack(0,1,2),L.emplaceBack(0,2,3),this.vignetteVx=s.context.createVertexBuffer(O,_j.members),this.vignetteIdx=s.context.createIndexBuffer(L)}const w=i.bf.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){s.uploadCommonUniforms(s.context,v);const O={u_vignetteShape:(P={vignetteShape:[h.start,h.range,Math.pow(10,h.fadePower)],vignetteColor:[h.color.r,h.color.g,h.color.b,h.color.a*h.strength]}).vignetteShape,u_vignetteColor:P.vignetteColor};v.draw(s,s.context.gl.TRIANGLES,Sr.disabled,Yr.disabled,mn.alphaBlended,Gr.disabled,O,"vignette",this.vignetteVx,this.vignetteIdx,w)}var P}}class $i{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(s,h){const v=s.getFreeCameraOptions().position,w=v.toAltitude(),P=v.toLngLat(),O=i.an(P.lng),L=i.an(P.lat),z=s.pixelsPerMeter/h,G=O*i.eL,H=i.eL*Math.log(Math.tan(Math.PI/4+L/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const Q=-this._offsetYPrev+H,K=-this._elevationPrev+w;this._accumulatedOffsetX+=(-this._offsetXPrev+G)*z,this._accumulatedOffsetY+=Q*z,this._accumulatedElevation+=K*z,this._offsetXPrev=G,this._offsetYPrev=H,this._elevationPrev=w}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Tn(y,s){return[-(y[0]-Math.floor(y[0]/s)*s),-(y[1]-Math.floor(y[1]/s)*s),-(y[2]-Math.floor(y[2]/s)*s)]}function Gw(y){const s=i.eq(1323123451230),h=[];for(let v=0;v<y;++v){const w=2*s()-1,P=2*s()-1,O=2*s()-1;h.push(i.d4(w,P,O))}return h}function Ls(y,s,h,v,w){const P=i.aA((w-h)/(v-h),0,1);return(1-P)*y+P*s}class Qh{constructor(s){this._movement=new $i,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Xg,this._ppmScaleFactor=s}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(s,h){const v=s.transform;this._movement.update(v,this._ppmScaleFactor);const w=v.starsProjMatrix,P=i.c6([]);i.c8(P,P,i.an(90)-v._pitch),i.c7(P,P,-v.angle);const O=i.cb(new Float32Array(16),P),L=i.eK(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),z=i.ef([],L),G=i.aB([],z,O),H=Date.now()/1e3;return this._accumulatedTimeFromStart+=(H-this._prevTime)*h,this._prevTime=H,{projectionMatrix:w,modelviewMatrix:G}}}class Sp extends Qh{constructor(s){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new ss(s.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(s){const h=s.context;if(!this.particlesVx){const v=Gw(this.particlesCount),w=new i.eM,P=new i.b0;let O=0;const L=i.eq(1323123451230);for(let z=0;z<v.length;++z){const G=v[z],H=[2*L()-1,L(),L(),L()];w.emplaceBack(G[0],G[1],G[2],-1,-1,...H),w.emplaceBack(G[0],G[1],G[2],1,-1,...H),w.emplaceBack(G[0],G[1],G[2],1,1,...H),w.emplaceBack(G[0],G[1],G[2],-1,1,...H),P.emplaceBack(O+0,O+1,O+2),P.emplaceBack(O+0,O+2,O+3),O+=4}this.particlesVx=h.createVertexBuffer(w,H2.members),this.particlesIdx=h.createIndexBuffer(P)}}draw(s){if(!this._params.overrideStyleParameters&&!s.style.rain)return;const h=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},v=s.transform.zoom;if(h.revealStart>v)return;const w=Ls(0,1,h.revealStart,h.revealStart+h.revealRange,v);if(!this.particlesVx||!this.particlesIdx)return;const P=structuredClone(this._params);let O=[-P.direction.x,P.direction.y,-100];i.aw(O,O);const L=structuredClone(this._vignetteParams);L.strength*=w,P.overrideStyleParameters||(P.intensity=s.style.rain.state.density,P.timeFactor=s.style.rain.state.intensity,P.color=structuredClone(s.style.rain.state.color),O=structuredClone(s.style.rain.state.direction),P.screenThinning.intensity=s.style.rain.state.centerThinning,P.dropletSizeX=s.style.rain.state.dropletSize[0],P.dropletSizeYScale=s.style.rain.state.dropletSize[1]/s.style.rain.state.dropletSize[0],P.distortionStrength=100*s.style.rain.state.distortionStrength,L.strength=1,L.color=structuredClone(s.style.rain.state.vignetteColor));const z=this.updateOnRender(s,P.timeFactor),G=s.context,H=G.gl,Q=s.transform;this.screenTexture&&this.screenTexture.size[0]===s.width&&this.screenTexture.size[1]===s.height||(this.screenTexture=new i.T(G,{width:s.width,height:s.height,data:null},H.RGBA8)),P.distortionStrength>0&&(G.activeTexture.set(H.TEXTURE0),this.screenTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),H.copyTexSubImage2D(H.TEXTURE_2D,0,0,0,0,0,s.width,s.height));const K=s.getOrCreateProgram("rainParticle");s.uploadCommonUniforms(G,K),G.activeTexture.set(H.TEXTURE0),this.screenTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const re=[P.color.r,P.color.g,P.color.b,P.color.a],le=(ue,_e)=>{const ge=Tn(this._movement.getPosition(),ue),Se=P.dropletSizeX,ke=P.dropletSizeX*P.dropletSizeYScale,Te=s.width/2,$e=s.height/2,Re=Ls(0,P.screenThinning.start,0,1,P.screenThinning.intensity),Ve=Ls(.001,P.screenThinning.range,0,1,P.screenThinning.intensity),Be=Ls(0,P.screenThinning.particleOffset,0,1,P.screenThinning.intensity),De=(We={modelview:z.modelviewMatrix,projection:z.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ge,velocityConeAperture:P.velocityConeAperture,velocity:P.velocity,boxSize:ue,rainDropletSize:[Se,ke],distortionStrength:P.distortionStrength,rainDirection:O,color:re,screenSize:[Q.width,Q.height],thinningCenterPos:[Te,$e],thinningShape:[Re,Ve,Math.pow(10,P.screenThinning.fadePower)],thinningAffectedRatio:P.screenThinning.affectedRatio,thinningParticleOffset:Be,shapeDirectionalPower:P.shapeDirPower,shapeNormalPower:P.shapeNormalPower,mode:_e?0:1},{u_modelview:Float32Array.from(We.modelview),u_projection:Float32Array.from(We.projection),u_time:We.time,u_cam_pos:We.camPos,u_texScreen:0,u_velocityConeAperture:We.velocityConeAperture,u_velocity:We.velocity,u_boxSize:We.boxSize,u_rainDropletSize:We.rainDropletSize,u_distortionStrength:We.distortionStrength,u_rainDirection:We.rainDirection,u_color:We.color,u_screenSize:We.screenSize,u_thinningCenterPos:We.thinningCenterPos,u_thinningShape:We.thinningShape,u_thinningAffectedRatio:We.thinningAffectedRatio,u_thinningParticleOffset:We.thinningParticleOffset,u_shapeDirectionalPower:We.shapeDirectionalPower,u_shapeNormalPower:We.shapeNormalPower,u_mode:We.mode});var We;const lt=Math.round(P.intensity*this.particlesCount),it=i.bf.simpleSegment(0,0,4*lt,2*lt);K.draw(s,H.TRIANGLES,Sr.disabled,Yr.disabled,mn.alphaBlended,Gr.disabled,De,"rain_particles",this.particlesVx,this.particlesIdx,it)};P.distortionStrength>0&&le(P.boxSize,!0),le(P.boxSize,!1),this._vignette.draw(s,L)}}const Ku=i.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Hw extends Qh{constructor(s){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new ss(s.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(s){const h=s.context;if(!this.particlesVx){const v=Gw(this.particlesCount),w=new i.eN,P=new i.b0;let O=0;const L=i.eq(1323123451230);for(let z=0;z<v.length;++z){const G=v[z],H=L(),Q=L(),K=L(),re=[z/v.length,H,Q,K],le=[L(),L()];w.emplaceBack(G[0],G[1],G[2],-1,-1,...re,...le),w.emplaceBack(G[0],G[1],G[2],1,-1,...re,...le),w.emplaceBack(G[0],G[1],G[2],1,1,...re,...le),w.emplaceBack(G[0],G[1],G[2],-1,1,...re,...le),P.emplaceBack(O+0,O+1,O+2),P.emplaceBack(O+0,O+2,O+3),O+=4}this.particlesVx=h.createVertexBuffer(w,Ku.members),this.particlesIdx=h.createIndexBuffer(P)}}draw(s){if(!this._params.overrideStyleParameters&&!s.style.snow)return;const h=structuredClone(this._params);let v=[-h.direction.x,h.direction.y,-100];i.aw(v,v);const w=structuredClone(this._vignetteParams),P=h.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},O=s.transform.zoom;if(P.revealStart>O)return;const L=Ls(0,1,P.revealStart,P.revealStart+P.revealRange,O);w.strength*=L,h.overrideStyleParameters||(h.intensity=s.style.snow.state.density,h.timeFactor=s.style.snow.state.intensity,h.color=structuredClone(s.style.snow.state.color),v=structuredClone(s.style.snow.state.direction),h.screenThinning.intensity=s.style.snow.state.centerThinning,h.billboardSize=2.79*s.style.snow.state.flakeSize,w.strength=1,w.color=structuredClone(s.style.snow.state.vignetteColor));const z=this.updateOnRender(s,h.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const G=s.context,H=G.gl,Q=s.transform,K=s.getOrCreateProgram("snowParticle");s.uploadCommonUniforms(G,K),((re,le,ue)=>{const _e=Tn(this._movement.getPosition(),re),ge=Q.width/2,Se=Q.height/2,ke=Ls(0,ue.screenThinning.start,0,1,ue.screenThinning.intensity),Te=Ls(.001,ue.screenThinning.range,0,1,ue.screenThinning.intensity),$e=Ls(0,ue.screenThinning.particleOffset,0,1,ue.screenThinning.intensity),Re=(Ve={modelview:z.modelviewMatrix,projection:z.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:_e,velocityConeAperture:ue.velocityConeAperture,velocity:ue.velocity,horizontalOscillationRadius:ue.horizontalOscillationRadius,horizontalOscillationRate:ue.horizontalOscillationRate,boxSize:re,billboardSize:1*ue.billboardSize,simpleShapeParameters:[ue.shapeFadeStart,ue.shapeFadePower],screenSize:[Q.width,Q.height],thinningCenterPos:[ge,Se],thinningShape:[ke,Te,Math.pow(10,ue.screenThinning.fadePower)],thinningAffectedRatio:ue.screenThinning.affectedRatio,thinningParticleOffset:$e,color:[ue.color.r,ue.color.g,ue.color.b,ue.color.a],direction:v},{u_modelview:Float32Array.from(Ve.modelview),u_projection:Float32Array.from(Ve.projection),u_time:Ve.time,u_cam_pos:Ve.camPos,u_velocityConeAperture:Ve.velocityConeAperture,u_velocity:Ve.velocity,u_horizontalOscillationRadius:Ve.horizontalOscillationRadius,u_horizontalOscillationRate:Ve.horizontalOscillationRate,u_boxSize:Ve.boxSize,u_billboardSize:Ve.billboardSize,u_simpleShapeParameters:Ve.simpleShapeParameters,u_screenSize:Ve.screenSize,u_thinningCenterPos:Ve.thinningCenterPos,u_thinningShape:Ve.thinningShape,u_thinningAffectedRatio:Ve.thinningAffectedRatio,u_thinningParticleOffset:Ve.thinningParticleOffset,u_particleColor:Ve.color,u_direction:Ve.direction});var Ve;const Be=Math.round(ue.intensity*this.particlesCount),De=i.bf.simpleSegment(0,0,4*Be,2*Be);this.particlesVx&&this.particlesIdx&&K.draw(s,H.TRIANGLES,Sr.disabled,Yr.disabled,mn.alphaBlended,Gr.disabled,Re,"snow_particles",this.particlesVx,this.particlesIdx,De)})(h.boxSize,0,h),this._vignette.draw(s,w)}}const Kw={symbol:function(y,s,h,v,w){if(y.renderPass!=="translucent")return;const P=Yr.disabled,O=y.colorModeForRenderPass(),L=h.layout.get("text-variable-anchor"),z=h.layout.get("text-size-scale-range"),G=i.aA(y.scaleFactor,z[0],z[1]);L&&function(K,re,le,ue,_e,ge,Se,ke){const Te=re.transform,$e=_e==="map",Re=ge==="map";for(const Ve of K){const Be=ue.getTile(Ve),De=Be.getBucket(le);if(!De||!De.text||!De.text.segments.get().length)continue;const We=i.bJ(De.textSizeData,Te.zoom,ke),lt=$v(Ve,De.getProjection(),Te),it=Te.calculatePixelsToTileUnitsMatrix(Be),bt=Yf(lt,Be.tileID.canonical,Re,$e,Te,De.getProjection(),it),mt=De.hasIconTextFit()&&De.hasIconData();We&&b_(De,$e,Re,Se,Te,bt,Ve,Math.pow(2,Te.zoom-Be.tileID.overscaledZ),We,mt)}}(v,y,h,s,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),w,G);const H=h.paint.get("icon-opacity").constantOr(1)!==0,Q=h.paint.get("text-opacity").constantOr(1)!==0;h.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(H||Q)?Hg(y,s,h,v,P,O):(H&&Hg(y,s,h,v,P,O,{onlyIcons:!0}),Q&&Hg(y,s,h,v,P,O,{onlyText:!0})),s.map.showCollisionBoxes&&(Gg(y,s,h,v,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Gg(y,s,h,v,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(y,s,h,v){if(y.renderPass!=="translucent")return;const w=h.paint.get("circle-opacity"),P=h.paint.get("circle-stroke-width"),O=h.paint.get("circle-stroke-opacity"),L=h.layout.get("circle-sort-key").constantOr(1)!==void 0,z=h.paint.get("circle-emissive-strength");if(w.constantOr(1)===0&&(P.constantOr(1)===0||O.constantOr(1)===0))return;const G=y.context,H=G.gl,Q=y.transform,K=!(!y.terrain||!y.terrain.enabled),re=h.layout.get("circle-elevation-reference"),le=y.depthModeForSublayer(0,Sr.ReadOnly),ue=new Sr(y.context.gl.LEQUAL,Sr.ReadOnly,y.depthRangeFor3D),_e=re==="none"||K?le:ue,ge=Yr.disabled,Se=y.colorModeForDrapableLayerRenderPass(z),ke=Q.projection.name==="globe",Te=[i.aF(Q.center.lng),i.aJ(Q.center.lat)],$e=[];for(let Ve=0;Ve<v.length;Ve++){const Be=v[Ve],De=s.getTile(Be),We=De.getBucket(h);if(!We||We.projection.name!==Q.projection.name)continue;const lt=We.programConfigurations.get(h.id),it=We.layoutVertexBuffer,bt=We.globeExtVertexBuffer,mt=We.indexBuffer,Ot=i.d$(h),Zt=[bt],pt=y.isTileAffectedByFog(Be);ke&&Ot.push("PROJECTION_GLOBE_VIEW"),Ot.push("DEPTH_D24"),y.terrain&&Q.depthOcclusionForSymbolsAndCircles&&Ot.push("DEPTH_OCCLUSION"),We.hasElevation&&!y.terrain&&(Ot.push("ELEVATED_ROADS"),Zt.push(We.elevatedLayoutVertexBuffer));const et=y.getOrCreateProgram("circle",{config:lt,defines:Ot,overrideFog:pt}),kt=Q.projection.createInversionMatrix(Q,Be.canonical),gt={programConfiguration:lt,program:et,layoutVertexBuffer:it,dynamicBuffers:Zt,indexBuffer:mt,uniformValues:i.e0(y,Be,De,kt,Te,h),tile:De};if(L){const Lt=We.segments.get();for(const Qt of Lt)$e.push({segments:new i.bf([Qt]),sortKey:Qt.sortKey,state:gt})}else $e.push({segments:We.segments,sortKey:0,state:gt})}L&&$e.sort((Ve,Be)=>Ve.sortKey-Be.sortKey);const Re={useDepthForOcclusion:Q.depthOcclusionForSymbolsAndCircles};for(const Ve of $e){const{programConfiguration:Be,program:De,layoutVertexBuffer:We,dynamicBuffers:lt,indexBuffer:it,uniformValues:bt,tile:mt}=Ve.state,Ot=Ve.segments;y.terrain&&y.terrain.setupElevationDraw(mt,De,Re),y.uploadCommonUniforms(G,De,mt.tileID.toUnwrapped()),De.draw(y,H.TRIANGLES,_e,ge,Se,Gr.disabled,bt,h.id,We,it,Ot,h.paint,Q.zoom,Be,lt)}},heatmap:function(y,s,h,v){if(h.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const w=y.context,P=w.gl,O=Yr.disabled,L=new mn([P.ONE,P.ONE,P.ONE,P.ONE],i.ao.transparent,[!0,!0,!0,!0]);(function(re,le,ue,_e){const ge=re.gl,Se=le.width*_e,ke=le.height*_e;re.activeTexture.set(ge.TEXTURE1),re.viewport.set([0,0,Se,ke]);let Te=ue.heatmapFbo;if(!Te||Te&&(Te.width!==Se||Te.height!==ke)){Te&&Te.destroy();const $e=ge.createTexture();ge.bindTexture(ge.TEXTURE_2D,$e),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_S,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_T,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MIN_FILTER,ge.LINEAR),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MAG_FILTER,ge.LINEAR),Te=ue.heatmapFbo=re.createFramebuffer(Se,ke,!0,null),function(Re,Ve,Be,De,We,lt){const it=Re.gl;it.texImage2D(it.TEXTURE_2D,0,Re.extRenderToTextureHalfFloat?it.RGBA16F:it.RGBA,We,lt,0,it.RGBA,Re.extRenderToTextureHalfFloat?it.HALF_FLOAT:it.UNSIGNED_BYTE,null),De.colorAttachment.set(Be)}(re,0,$e,Te,Se,ke)}else ge.bindTexture(ge.TEXTURE_2D,Te.colorAttachment.get()),re.bindFramebuffer.set(Te.framebuffer)})(w,y,h,y.transform.projection.name==="globe"?.5:.25),w.clear({color:i.ao.transparent});const z=y.transform,G=z.projection.name==="globe",H=G?["PROJECTION_GLOBE_VIEW"]:[],Q=G?Gr.frontCCW:Gr.disabled,K=[i.aF(z.center.lng),i.aJ(z.center.lat)];for(let re=0;re<v.length;re++){const le=v[re];if(s.hasRenderableParent(le))continue;const ue=s.getTile(le),_e=ue.getBucket(h);if(!_e||_e.projection.name!==z.projection.name)continue;const ge=y.isTileAffectedByFog(le),Se=_e.programConfigurations.get(h.id),ke=y.getOrCreateProgram("heatmap",{config:Se,defines:H,overrideFog:ge}),{zoom:Te}=y.transform;y.terrain&&y.terrain.setupElevationDraw(ue,ke),y.uploadCommonUniforms(w,ke,le.toUnwrapped());const $e=z.projection.createInversionMatrix(z,le.canonical);ke.draw(y,P.TRIANGLES,Sr.disabled,O,L,Q,N2(y,le,ue,$e,K,Te,h.paint.get("heatmap-intensity")),h.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,h.paint,y.transform.zoom,Se,G?[_e.globeExtVertexBuffer]:null)}w.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),function(w,P){const O=w.context,L=O.gl,z=P.heatmapFbo;if(!z)return;O.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,z.colorAttachment.get()),O.activeTexture.set(L.TEXTURE1);let G=P.colorRampTexture;G||(G=P.colorRampTexture=new i.T(O,P.colorRamp,L.RGBA8)),G.bind(L.LINEAR,L.CLAMP_TO_EDGE),w.getOrCreateProgram("heatmapTexture").draw(w,L.TRIANGLES,Sr.disabled,Yr.disabled,w.colorModeForRenderPass(),Gr.disabled,((H,Q,K,re)=>({u_image:0,u_color_ramp:1,u_opacity:Q.paint.get("heatmap-opacity")}))(0,P),P.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,P.paint,w.transform.zoom)}(y,h))},line:function(y,s,h,v){if(y.renderPass!=="translucent")return;const w=h.paint.get("line-opacity"),P=h.paint.get("line-width");if(w.constantOr(1)===0||P.constantOr(1)===0)return;const O=h.paint.get("line-emissive-strength"),L=h.paint.get("line-occlusion-opacity"),z=h.layout.get("line-elevation-reference"),G=h.layout.get("line-width-unit")==="meters",H=z==="sea",Q=!(!y.terrain||!y.terrain.enabled),K=y.context,re=K.gl;if(h.hasElevatedBuckets&&y.transform.projection.name==="globe")return;const le=h.layout.get("line-cross-slope"),ue=le!==void 0,_e=le<1,ge=y.colorModeForDrapableLayerRenderPass(O),Se=y.terrain&&y.terrain.renderingToTexture,ke=Se?1:i.o.devicePixelRatio,Te=h.paint.get("line-dasharray"),$e=Te.constantOr(1),Re=h.layout.get("line-cap"),Ve=Te.constantOr(null),Be=Re.constantOr(null),De=h.paint.get("line-pattern"),We=De.constantOr(1),lt=h.paint.get("line-pattern-cross-fade"),it=De.constantOr(null),bt=h.paint.get("line-opacity").constantOr(1);let mt=!We&&bt!==1||y.depthOcclusion&&L>0&&L<1;const Ot=h.paint.get("line-gradient"),Zt=We?"linePattern":"line",pt=i.e1(h);let et;if(Se&&y.terrain&&y.terrain.clipOrMaskOverlapStencilType()&&(mt=!1),L!==0&&y.depthOcclusion){const Qt=h.paint._values["line-opacity"];Qt&&Qt.value&&Qt.value.kind==="constant"?et=Qt.value:i.w(`Occlusion opacity for layer ${h.id} is supported only when line-opacity isn't data-driven.`)}P.value.kind!=="constant"&&P.value.isLineProgressConstant===!1&&pt.push("VARIABLE_LINE_WIDTH");const kt=(Qt,vr,Gt,Yt,br,hr)=>{for(const cr of Qt){const fr=s.getTile(cr);if(We&&!fr.patternsLoaded())continue;const Mr=fr.getBucket(h);if(!Mr||Mr.elevationType!=="none"&&!br||Mr.elevationType==="none"&&br)continue;y.prepareDrawTile();const An=[...vr],Dn=y.shadowRenderer,mi=Mr.elevationType==="road"&&!!Dn&&Dn.enabled;let Hr=[0,0,0];if(mi){const Zr=y.style.directionalLight,zn=y.style.ambientLight;Zr&&zn&&(Hr=rc(y.style,Zr,zn)),An.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Mn=Mr.programConfigurations.get(h.id);let sn=!1;if(it&&fr.imageAtlas){const Zr=i.e2.from(it),zn=Zr.getPrimary().scaleSelf(ke).toString(),Xi=fr.imageAtlas.patternPositions.get(zn),ba=Zr.getSecondary(),ra=ba?fr.imageAtlas.patternPositions.get(ba.scaleSelf(ke).toString()):null;sn=!!Xi&&!!ra,Xi&&Mn.setConstantPatternPositions(Xi,ra)}lt>0&&(sn||Mn.getPatternTransitionVertexBuffer("line-pattern"))&&An.push("LINE_PATTERN_TRANSITION");const si=y.isTileAffectedByFog(cr),Ln=y.getOrCreateProgram(Zt,{config:Mn,defines:An,overrideFog:si});if(!We&&Ve&&Be&&fr.lineAtlas){const Zr=fr.lineAtlas.getDash(Ve,Be);Zr&&Mn.setConstantPatternPositions(Zr)}mi&&Dn.setupShadows(fr.tileID.toUnwrapped(),Ln,"vector-tile");let[Ai,qn]=h.paint.get("line-trim-offset");(Be==="round"||Be==="square")&&Ai!==qn&&(Ai===0&&(Ai-=1),qn===1&&(qn+=1));const dn=Se?cr.projMatrix:null,Jn=G?1/Mr.tileToMeter/i.ay(fr,1,y.transform.zoom):1,gn=G?1/Mr.tileToMeter/i.ay(fr,1,Math.floor(y.transform.zoom)):1,Mi=We?i.e3(y,fr,h,dn,ke,Jn,gn,[Ai,qn],Hr,lt):i.e4(y,fr,h,dn,Mr.lineClipsArray.length,ke,Jn,gn,[Ai,qn],Hr);if(Ot){const Zr=Mr.gradients[h.id];let zn=Zr.texture;if(h.gradientVersion!==Zr.version){let Xi=256;if(h.stepInterpolant){const ba=s.getSource().maxzoom,ra=cr.canonical.z===ba?Math.ceil(1<<y.transform.maxZoom-cr.canonical.z):1;Xi=i.aA(i.e5(Mr.maxLineLength/i.al*1024*ra),256,K.maxTextureSize)}Zr.gradient=i.e6({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Xi,image:Zr.gradient||void 0,clips:Mr.lineClipsArray}),Zr.texture?Zr.texture.update(Zr.gradient):Zr.texture=new i.T(K,Zr.gradient,re.RGBA8),Zr.version=h.gradientVersion,zn=Zr.texture}K.activeTexture.set(re.TEXTURE1),zn.bind(h.stepInterpolant?re.NEAREST:re.LINEAR,re.CLAMP_TO_EDGE)}$e&&(K.activeTexture.set(re.TEXTURE0),fr.lineAtlasTexture&&fr.lineAtlasTexture.bind(re.LINEAR,re.REPEAT),Mn.updatePaintBuffers()),We&&(K.activeTexture.set(re.TEXTURE0),fr.imageAtlasTexture&&fr.imageAtlasTexture.bind(re.LINEAR,re.CLAMP_TO_EDGE),Mn.updatePaintBuffers()),br&&!H&&y.terrain.setupElevationDraw(fr,Ln),y.uploadCommonUniforms(K,Ln,cr.toUnwrapped());const ri=Zr=>{et!=null&&(et.value=bt*L),Ln.draw(y,re.TRIANGLES,Gt,Zr,ge,Gr.disabled,Mi,h.id,Mr.layoutVertexBuffer,Mr.indexBuffer,Mr.segments,h.paint,y.transform.zoom,Mn,[Mr.layoutVertexBuffer2,Mr.patternVertexBuffer,Mr.zOffsetVertexBuffer]),et!=null&&(et.value=bt)};if(mt&&!br){const Zr=y.stencilModeForClipping(cr).ref;Zr===0&&Se&&K.clear({stencil:0});const zn={func:re.EQUAL,mask:255};Mi.u_alpha_discard_threshold=.8,ri(new Yr(zn,Zr,255,re.KEEP,re.KEEP,re.INVERT)),Mi.u_alpha_discard_threshold=0,ri(new Yr(zn,Zr,255,re.KEEP,re.KEEP,re.KEEP))}else Mi.u_alpha_discard_threshold=mt&&br&&hr?.8:0,ri(br?Yt:y.stencilModeForClipping(cr))}};let gt=y.depthModeForSublayer(0,Sr.ReadOnly);const Lt=new Sr(y.depthOcclusion?re.GREATER:re.LEQUAL,Sr.ReadOnly,y.depthRangeFor3D);if(h.hasNonElevatedBuckets){const Qt=!Se&&y.terrain;L!==0&&Qt?i.w(`Occlusion opacity for layer ${h.id} is supported on terrain only if the layer has line-z-offset enabled.`):Qt?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${h.id}.`):kt(v,pt,gt,Yr.disabled,!1,!0)}if(h.hasElevatedBuckets){z==="hd-road-markup"?Q||(gt=Lt,pt.push("ELEVATED_ROADS")):(pt.push("ELEVATED"),gt=Lt,ue&&pt.push(_e?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),H&&pt.push("ELEVATION_REFERENCE_SEA"));const Qt=mt?y.stencilModeFor3D():Yr.disabled;y.forceTerrainMode=!0,kt(v,pt,gt,Qt,!0,!0),mt&&kt(v,pt,gt,Qt,!0,!1),y.forceTerrainMode=!1}mt&&(y.resetStencilClippingMasks(),Se&&K.clear({stencil:0})),L===0||y.depthOcclusion||Se||y.layersWithOcclusionOpacity.push(y.currentLayer)},fill:function(y,s,h,v){const w=h.paint.get("fill-color"),P=h.paint.get("fill-opacity");if(P.constantOr(1)===0)return;const O=h.paint.get("fill-emissive-strength"),L=y.colorModeForDrapableLayerRenderPass(O),z=h.paint.get("fill-pattern"),G=y.opaquePassEnabledForLayer()&&!z.constantOr(1)&&w.constantOr(i.ao.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";let H="none";h.layout.get("fill-elevation-reference")!=="none"?H="road":h.paint.get("fill-z-offset").constantOr(1)!==0&&(H="offset");const Q=!(!y.terrain||!y.terrain.enabled),K={painter:y,sourceCache:s,layer:h,coords:v,colorMode:L,elevationType:H,terrainEnabled:Q,pass:G};if(y.renderPass!=="shadow")if(H!=="offset"){if(gp(K,!1),H==="road"){const re=!Q&&y.renderPass==="translucent";re&&Xh(y,s,h,v,"geometry"),gp(K,!0,Yr.disabled),re&&function(le){const{painter:ue,sourceCache:_e,layer:ge,coords:Se,colorMode:ke}=le,Te=ue.context.gl,$e=le.painter.shadowRenderer,Re=!!$e&&$e.enabled,Ve=new Sr(ue.context.gl.LEQUAL,Sr.ReadOnly,ue.depthRangeFor3D);let Be=[0,0,0];if(Re){const We=ue.style.directionalLight,lt=ue.style.ambientLight;We&&lt&&(Be=rc(ue.style,We,lt))}const De=We=>{for(const lt of Se){const it=_e.getTile(lt),bt=it.getBucket(ge);if(!bt)continue;const mt=bt.elevatedStructures;if(!mt)continue;let Ot,Zt;if(We?(Ot=mt.renderableBridgeSegments,Zt=mt.bridgeProgramConfigurations.get(ge.id)):(Ot=mt.renderableTunnelSegments,Zt=mt.tunnelProgramConfigurations.get(ge.id)),!Ot||Ot.segments[0].primitiveLength===0)continue;Zt.updatePaintBuffers(),ue.prepareDrawTile();const pt=ue.isTileAffectedByFog(lt),et=[];Re&&et.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const kt=ue.getOrCreateProgram("elevatedStructures",{config:Zt,overrideFog:pt,defines:et}),gt=ue.translatePosMatrix(lt.projMatrix,it,ge.paint.get("fill-translate"),ge.paint.get("fill-translate-anchor"));Re&&$e.setupShadows(it.tileID.toUnwrapped(),kt,"vector-tile");const Lt=dj(gt,Be);ue.uploadCommonUniforms(ue.context,kt,lt.toUnwrapped()),kt.draw(ue,Te.TRIANGLES,Ve,Yr.disabled,ke,Gr.backCCW,Lt,ge.id,mt.vertexBuffer,mt.indexBuffer,Ot,ge.paint,ue.transform.zoom,Zt,[mt.vertexBufferNormal])}};De(!0),De(!1)}(K)}}else gp(K,!1,y.stencilModeFor3D());else y.shadowRenderer&&H==="road"&&!Q&&function(re){const{painter:le,sourceCache:ue,layer:_e,coords:ge}=re,Se=le.context.gl,ke=re.painter.shadowRenderer;for(const Te of ge){const $e=ue.getTile(Te),Re=$e.getBucket(_e);if(!Re)continue;const Ve=Re.elevatedStructures;if(!Ve||!Ve.shadowCasterSegments||Ve.shadowCasterSegments.segments[0].primitiveLength===0)continue;le.prepareDrawTile();const Be=Re.bufferData.programConfigurations.get(_e.id),De=le.isTileAffectedByFog(Te),We=le.getOrCreateProgram("elevatedStructuresDepth",{config:Be,overrideFog:De}),lt=ke.calculateShadowPassMatrixFromTile($e.tileID.toUnwrapped());le.uploadCommonUniforms(le.context,We,Te.toUnwrapped());const it={u_matrix:lt,u_depth_bias:0};We.draw(le,Se.TRIANGLES,ke.getShadowPassDepthMode(),Yr.disabled,ke.getShadowPassColorMode(),Gr.disabled,it,_e.id,Ve.vertexBuffer,Ve.indexBuffer,Ve.shadowCasterSegments,_e.paint,le.transform.zoom,Be)}}(K)},"fill-extrusion":function(y,s,h,v){const w=h.paint.get("fill-extrusion-opacity"),P=y.context,O=P.gl,L=y.terrain,z=L&&L.renderingToTexture;if(w===0)return;const G=y.conflationActive&&y.style.isLayerClipped(h,s.getSource()),H=y.style.order.indexOf(h.fqid);if(G&&function(Q,K,re,le,ue){for(const _e of le){const ge=K.getTile(_e).getBucket(re);ge&&(ge.updateReplacement(_e,Q.replacementSource,ue),ge.uploadCentroid(Q.context))}}(y,s,h,v,H),L||G)for(const Q of v){const K=s.getTile(Q).getBucket(h);K&&qd(y.context,s,Q,K,h,L,G)}if(y.renderPass==="shadow"&&y.shadowRenderer){const Q=y.shadowRenderer;if(L&&w<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ad)return;const K=Q.getShadowPassDepthMode(),re=Q.getShadowPassColorMode();gr(y,s,h,v,K,Yr.disabled,re,G)}else if(y.renderPass==="translucent"){const Q=!h.paint.get("fill-extrusion-pattern").constantOr(1),K=h.paint.get("fill-extrusion-color").constantOr(i.ao.white);if(!z&&K.a!==0){const re=new Sr(y.context.gl.LEQUAL,Sr.ReadWrite,y.depthRangeFor3D);w===1&&Q?gr(y,s,h,v,re,Yr.disabled,mn.unblended,G):(gr(y,s,h,v,re,Yr.disabled,mn.disabled,G),gr(y,s,h,v,re,y.stencilModeFor3D(),y.colorModeForRenderPass(),G),y.resetStencilClippingMasks())}if(y.style.enable3dLights()&&Q&&(!L&&y.transform.projection.name!=="globe"||z)){const re=h.paint.get("fill-extrusion-opacity"),le=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),ue=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),_e=h.paint.get("fill-extrusion-flood-light-intensity"),ge=h.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Se=h.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ge?null:h.lut).toArray01().slice(0,3),ke=le>0&&ue>0,Te=_e>0,$e=(Be,De,We)=>(1-We)*Be+We*De,Re=new jw;Re.translate=h.paint.get("fill-extrusion-translate"),Re.translateAnchor=h.paint.get("fill-extrusion-translate-anchor"),Re.edgeRadius=h.layout.get("fill-extrusion-edge-radius"),Re.cutoffFadeRange=h.paint.get("fill-extrusion-cutoff-fade-range");const Ve=Be=>{const De=y.depthModeForSublayer(1,Sr.ReadOnly,O.LEQUAL,!0),We=h.paint.get(Be?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),lt=$e(.1,3,We),it=y._showOverdrawInspector;if(!it){const bt=new Yr({func:O.ALWAYS,mask:255},255,255,O.KEEP,O.KEEP,O.REPLACE),mt=new mn([O.ONE,O.ONE,O.ONE,O.ONE],i.ao.transparent,[!1,!1,!1,!0],O.MIN);Gu(Re,y,s,h,v,De,bt,mt,Gr.disabled,Be,"sdf",re,le,ue,_e,Se,lt,G,!1)}{const bt=it?Yr.disabled:new Yr({func:O.EQUAL,mask:255},255,255,O.KEEP,O.DECR,O.DECR),mt=it?y.colorModeForRenderPass():new mn([O.ONE_MINUS_DST_ALPHA,O.DST_ALPHA,O.ONE,O.ONE],i.ao.transparent,[!0,!0,!0,!0]);Gu(Re,y,s,h,v,De,bt,mt,Gr.disabled,Be,"color",re,le,ue,_e,Se,lt,G,!1)}};if(z){const Be=(De,We,lt)=>{const it=y.depthModeForSublayer(1,Sr.ReadOnly,O.LEQUAL,!1),bt=h.paint.get(De?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),mt=$e(.1,3,bt);{const Ot=new mn([O.ONE,O.ONE,O.ONE,O.ONE],i.ao.transparent,[!1,!1,!1,!0]);Gu(Re,y,s,h,v,it,Yr.disabled,Ot,Gr.disabled,De,"clear",re,le,ue,_e,Se,mt,G,We)}{const Ot=new Yr({func:O.ALWAYS,mask:255},255,255,O.KEEP,O.KEEP,O.REPLACE),Zt=new mn([O.ONE,O.ONE,O.ONE,O.ONE],i.ao.transparent,[!1,!1,!1,!0],O.MIN);Gu(Re,y,s,h,v,it,Ot,Zt,Gr.disabled,De,"sdf",re,le,ue,_e,Se,mt,G,We)}{const Ot=De?O.ZERO:O.ONE_MINUS_DST_ALPHA,Zt=new Yr({func:O.EQUAL,mask:255},255,255,O.KEEP,O.DECR,O.DECR),pt=new mn([Ot,O.DST_ALPHA,O.ONE_MINUS_DST_ALPHA,O.ZERO],i.ao.transparent,[!0,!0,!0,!0]);Gu(Re,y,s,h,v,it,Zt,pt,Gr.disabled,De,"color",re,le,ue,_e,Se,mt,G,We)}{const Ot=new mn([O.ONE,O.ONE,O.ONE,De?O.ZERO:O.ONE],i.ao.transparent,[!1,!1,!1,!0],De?O.FUNC_ADD:O.MAX);Gu(Re,y,s,h,v,it,Yr.disabled,Ot,Gr.disabled,De,"clear",re,le,ue,_e,Se,mt,G,We,lt)}};if(ke||Te){let De;if(y.prepareDrawTile(),L){const We=L.drapeBufferSize[0],lt=L.drapeBufferSize[1];De=L.framebufferCopyTexture,De&&(!De||De.size[0]===We&&De.size[1]===lt)||(De&&De.destroy(),De=L.framebufferCopyTexture=new i.T(P,new i.q({width:We,height:lt}),O.RGBA8)),De.bind(O.LINEAR,O.CLAMP_TO_EDGE),O.copyTexSubImage2D(O.TEXTURE_2D,0,0,0,0,0,We,lt)}ke&&Be(!0,!1,De),Te&&Be(!1,!0,De)}}else ke&&Ve(!0),Te&&Ve(!1),(ke||Te)&&y.resetStencilClippingMasks()}}},building:function(y,s,h,v){y.currentLayer<y.firstLightBeamLayer&&(y.firstLightBeamLayer=y.currentLayer);const w=h.paint.get("building-ambient-occlusion-ground-intensity"),P=h.paint.get("building-ambient-occlusion-ground-radius"),O=h.paint.get("building-ambient-occlusion-ground-attenuation"),L=h.paint.get("building-opacity");if(L<=0)return;let z=w>0&&P>0,G=!0;const H=h.paint.get("building-vertical-scale");if(H<=0)return;(!y.shadowRenderer||H<1)&&(G=!1);const Q=y.conflationActive&&y.style.isLayerClipped(h,s.getSource()),K=y.style.order.indexOf(h.fqid);if(function(re,le,ue,_e,ge,Se){for(const ke of Se){const Te=le.getTile(ke).getBucket(ue);Te&&(ge&&Te.updateReplacement(ke,re.replacementSource,_e),Te.uploadUpdatedIndexBuffer(re.context))}}(y,s,h,K,Q,v),function(re,le,ue,_e){for(const ge of _e){const Se=le.getTile(ge).getBucket(ue);Se&&Se.needsEvaluation()&&Se.uploadUpdatedColorBuffer(re.context)}}(y,s,h,v),h.resetLayerRenderingStats(y),y.shadowRenderer&&(y.shadowRenderer.useNormalOffset=!0),y.renderPass==="shadow"&&y.shadowRenderer){const re=y.shadowRenderer,le=[],ue=re.getShadowPassDepthMode();S_({painter:y,source:s,layer:h,coords:v,defines:le,blendMode:re.getShadowPassColorMode(),depthMode:ue,opacity:L,verticalScale:H,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(y.renderPass==="translucent"){let re=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];G&&(re=re.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),y.shadowRenderer&&y.shadowRenderer.useNormalOffset&&(re=re.concat("NORMAL_OFFSET"));const le=h.paint.get("building-facade-emissive-chance"),ue=h.paint.get("building-ambient-occlusion-intensity"),_e=h.paint.get("building-flood-light-intensity"),ge=h.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",Se=h.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(ge?null:h.lut).toArray01().slice(0,3),ke=h.paint.get("building-flood-light-ground-attenuation"),Te=_e>0,$e=new Sr(y.context.gl.LEQUAL,Sr.ReadWrite,y.depthRangeFor3D);L<1&&S_({painter:y,source:s,layer:h,coords:v,defines:re,blendMode:mn.disabled,depthMode:$e,opacity:L,verticalScale:H,facadeEmissiveChance:le,facadeAOIntensity:ue,floodLightIntensity:_e,floodLightColor:Se,depthOnly:!0});const Re=y.colorModeForRenderPass();S_({painter:y,source:s,layer:h,coords:v,defines:re,blendMode:Re,depthMode:$e,opacity:L,verticalScale:H,facadeEmissiveChance:le,facadeAOIntensity:ue,floodLightIntensity:_e,floodLightColor:Se}),z&&E_(y,s,h,v,!0,L,w,P,_e,Se,O,Q),Te&&E_(y,s,h,v,!1,L,w,P,_e,Se,ke,Q)}else if(y.renderPass==="light-beam"){const re=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],le=new Sr(y.context.gl.LEQUAL,Sr.ReadOnly,y.depthRangeFor3D);S_({painter:y,source:s,layer:h,coords:v,defines:re,blendMode:mn.alphaBlended,depthMode:le,opacity:L,verticalScale:H,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}y.shadowRenderer&&(y.shadowRenderer.useNormalOffset=!1),y.resetStencilClippingMasks()},hillshade:function(y,s,h,v){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent"||y.style.disableElevatedTerrain)return;const w=y.context,P=y.terrain&&y.terrain.renderingToTexture,[O,L]=y.renderPass!=="translucent"||P?[{},v]:y.stencilConfigForOverlap(v);for(const z of L){const G=s.getTile(z);if(G.needsHillshadePrepare&&y.renderPass==="offscreen")ej(y,G,h);else if(y.renderPass==="translucent"){const H=y.depthModeForSublayer(0,Sr.ReadOnly),Q=h.paint.get("hillshade-emissive-strength"),K=y.colorModeForDrapableLayerRenderPass(Q),re=P&&y.terrain?y.terrain.stencilModeForRTTOverlap(z):O[z.overscaledZ];QR(y,z,G,h,H,re,K)}}w.viewport.set([0,0,y.width,y.height]),y.resetStencilClippingMasks()},raster:function(y,s,h,v,w,P){if(y.renderPass!=="translucent"||h.paint.get("raster-opacity")===0)return;const O=y.transform.projection.name==="globe",L=h.paint.get("raster-elevation")!==0,z=L&&O;if(y.renderElevatedRasterBackface&&!z)return;const G=y.context,H=G.gl,Q=s.getSource(),K=function(Re,Ve,Be,De){const We=Ve.paint.get("raster-color"),lt=Re.type==="raster-array",it=[],bt=Ve.paint.get("raster-resampling"),mt=Ve.paint.get("raster-color-mix");let Ot=Ve.paint.get("raster-color-range");const Zt=[mt[0],mt[1],mt[2],0],pt=mt[3];let et=bt==="nearest"?De.NEAREST:De.LINEAR;if(lt&&(it.push("RASTER_ARRAY"),We||it.push("RASTER_COLOR"),bt==="linear"&&it.push("RASTER_ARRAY_LINEAR"),et=De.NEAREST,!Ot&&Re.rasterLayers)){const kt=Re.rasterLayers.find(({id:gt})=>gt===Ve.sourceLayer);kt&&kt.fields&&kt.fields.range&&(Ot=kt.fields.range)}if(Ot=Ot||[0,1],We){it.push("RASTER_COLOR"),Be.activeTexture.set(De.TEXTURE2),Ve.updateColorRamp(Ot);let kt=Ve.colorRampTexture;kt||(kt=Ve.colorRampTexture=new i.T(Be,Ve.colorRamp,De.RGBA8)),kt.bind(De.LINEAR,De.CLAMP_TO_EDGE)}return{mix:Zt,range:Ot,offset:pt,defines:it,resampling:et}}(Q,h,G,H);if(Q instanceof i.aT&&!v.length&&!O)return;const re=h.paint.get("raster-emissive-strength"),le=y.colorModeForDrapableLayerRenderPass(re),ue=y.terrain&&y.terrain.renderingToTexture,_e=!y.options.moving,ge=h.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR;if(Q instanceof i.aT&&!v.length&&(Q.onNorthPole||Q.onSouthPole)){const Re=L?y.stencilModeFor3D():Yr.disabled;return void Dw(!!Q.onNorthPole,null,y,s,h,re,K,Gr.disabled,Re)}if(!v.length)return;const[Se,ke]=Q instanceof i.aT||ue?[{},v]:y.stencilConfigForOverlap(v),Te=ke[ke.length-1].overscaledZ;z&&K.defines.push("PROJECTION_GLOBE_VIEW"),L&&K.defines.push("RENDER_CUTOFF");const $e=(Re,Ve,Be)=>{for(const De of Re){const We=De.toUnwrapped(),lt=s.getTile(De);if(ue&&(!lt||!lt.hasData()))continue;G.activeTexture.set(H.TEXTURE0);const it=pj(lt,Q,h,K);if(!it||!it.texture)continue;const{texture:bt,mix:mt,offset:Ot,tileSize:Zt,buffer:pt}=it;let et,kt;ue?(et=Sr.disabled,kt=De.projMatrix):L?(et=new Sr(H.LEQUAL,Sr.ReadWrite,y.depthRangeFor3D),kt=O?Float32Array.from(y.transform.expandedFarZProjMatrix):y.transform.calculateProjMatrix(We,_e)):(et=y.depthModeForSublayer(De.overscaledZ-Te,h.paint.get("raster-opacity")===1?Sr.ReadWrite:Sr.ReadOnly,H.LESS),kt=y.transform.calculateProjMatrix(We,_e));const gt=y.terrain&&ue?y.terrain.stencilModeForRTTOverlap(De):Se[De.overscaledZ],Lt=P?0:h.paint.get("raster-fade-duration");lt.registerFadeDuration(Lt);const Qt=s.findLoadedParent(De,0),vr=s_(lt,Qt,s,y.transform,Lt);let Gt,Yt;!vr.isFading&&lt.refreshedUponExpiration&&(lt.refreshedUponExpiration=!1),y.terrain&&y.terrain.prepareDrawTile(),G.activeTexture.set(H.TEXTURE0),bt.bind(ge,H.CLAMP_TO_EDGE),G.activeTexture.set(H.TEXTURE1),Qt?(Qt.texture&&Qt.texture.bind(ge,H.CLAMP_TO_EDGE),Gt=Math.pow(2,Qt.tileID.overscaledZ-lt.tileID.overscaledZ),Yt=[lt.tileID.canonical.x*Gt%1,lt.tileID.canonical.y*Gt%1]):bt.bind(ge,H.CLAMP_TO_EDGE),"useMipmap"in bt&&G.extTextureFilterAnisotropic&&y.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax);const br=y.transform;let hr;const cr=L?F2(br):[0,0,0,0];let fr,Mr,An,Dn,mi,Hr=0;if(z&&Q instanceof i.aT&&Q.coordinates.length>3)fr=Float32Array.from(i.bj(i.dI(new i.cC(0,0,0)))),Mr=Float32Array.from(br.globeMatrix),An=Float32Array.from(i.dE(br)),Dn=[i.aF(br.center.lng),i.aJ(br.center.lat)],hr=Q.elevatedGlobePerspectiveTransform,mi=Q.elevatedGlobeGridMatrix||new Float32Array(9);else if(z){const Ln=i.dF(De.canonical);Hr=i.dG(Ln.getCenter().lat),fr=Float32Array.from(i.bj(i.dI(De.canonical))),Mr=Float32Array.from(br.globeMatrix),An=Float32Array.from(i.dE(br)),Dn=[i.aF(br.center.lng),i.aJ(br.center.lat)],hr=[0,0],mi=Float32Array.from(i.dH(De.canonical,Ln,Hr,br.worldSize/br._pixelsPerMercatorPixel))}else hr=Q instanceof i.aT?Q.perspectiveTransform:[0,0],fr=new Float32Array(16),Mr=new Float32Array(9),An=new Float32Array(16),Dn=[0,0],mi=new Float32Array(9);const Mn=Wg(kt,fr,Mr,An,mi,Yt||[0,0],i.aj(y.transform.zoom),Dn,cr,Gt||1,vr,h,hr,L?h.paint.get("raster-elevation"):0,2,mt,Ot,K.range,Zt,pt,re),sn=y.isTileAffectedByFog(De),si=y.getOrCreateProgram("raster",{defines:K.defines,overrideFog:sn});if(y.uploadCommonUniforms(G,si,We),Q instanceof i.aT){const Ln=Q.elevatedGlobeVertexBuffer,Ai=Q.elevatedGlobeIndexBuffer;if(ue||!O)Q.boundsBuffer&&Q.boundsSegments&&si.draw(y,H.TRIANGLES,et,Yr.disabled,le,Gr.disabled,Mn,h.id,Q.boundsBuffer,y.quadTriangleIndexBuffer,Q.boundsSegments);else if(Ln&&Ai){const qn=br.zoom<=i.cZ?Q.elevatedGlobeSegments:Q.getSegmentsForLongitude(br.center.lng);qn&&si.draw(y,H.TRIANGLES,et,Yr.disabled,le,Ve,Mn,h.id,Ln,Ai,qn)}}else if(z){et=new Sr(H.LEQUAL,Sr.ReadOnly,y.depthRangeFor3D);const Ln=y.globeSharedBuffers;if(Ln){const[Ai,qn,dn]=Ln.getGridBuffers(Hr,!1);si.draw(y,H.TRIANGLES,et,Be||gt,y.colorModeForRenderPass(),Ve,Mn,h.id,Ai,qn,dn)}}else{const{tileBoundsBuffer:Ln,tileBoundsIndexBuffer:Ai,tileBoundsSegments:qn}=y.getTileBoundsBuffers(lt);si.draw(y,H.TRIANGLES,et,gt,le,Gr.disabled,Mn,h.id,Ln,Ai,qn)}}if(!(Q instanceof i.aT)&&z)for(const De of Re){const We=De.canonical.y===(1<<De.canonical.z)-1;De.canonical.y===0&&Dw(!0,De,y,s,h,re,K,Ve,Be||Yr.disabled),We&&Dw(!1,De,y,s,h,re,K,Ve===Gr.frontCW?Gr.backCW:Gr.frontCW,Be||Yr.disabled)}};z?$e(ke,y.renderElevatedRasterBackface?Gr.backCW:Gr.frontCW,y.stencilModeFor3D()):$e(ke,Gr.disabled,void 0),y.resetStencilClippingMasks()},"raster-particle":function(y,s,h,v,w,P){y.renderPass==="offscreen"&&function(O,L,z,G){if(!G.length)return;const H=O.context,Q=H.gl,K=L.getSource();if(!(K instanceof lo))return;const re=Math.ceil(Math.sqrt(z.paint.get("raster-particle-count")));let le=z.particlePositionRGBAImage;if(!le||le.width!==re){const ke=function(Te){const $e=Te*Te,Re=new Uint8Array(4*$e),Ve=function(De){return De|=0,De=Math.imul(2747636419^De,2654435769),De=Math.imul(De^De>>>16,2654435769),((De=Math.imul(De^De>>>16,2654435769))>>>0)/4294967296},Be=1/1.1;for(let De=0;De<$e;De++){const We=Be*(Ve(2*De+0)+Zh),lt=Be*(Ve(2*De+1)+Zh),it=255*We%1,bt=255*lt%1,mt=it,Ot=lt-bt/255,Zt=bt;Re[4*De+0]=255*(We-it/255),Re[4*De+1]=255*mt,Re[4*De+2]=255*Ot,Re[4*De+3]=255*Zt}return Re}(re);le=z.particlePositionRGBAImage=new i.q({width:re,height:re},ke)}let ue=z.particleFramebuffer;ue?ue.width!==re&&(ue.destroy(),ue=z.particleFramebuffer=H.createFramebuffer(re,re,!0,null)):ue=z.particleFramebuffer=H.createFramebuffer(re,re,!0,null);const _e=[];for(const ke of G){const Te=L.getTile(ke);if(!(Te instanceof Ld))continue;const $e=Lw(Te,K,z);if(!$e)continue;const Re=[Te.tileSize,Te.tileSize];let Ve=z.tileFramebuffer;Ve||(Ve=z.tileFramebuffer=H.createFramebuffer(Re[0],Re[1],!0,null));let Be=Te.rasterParticleState;Be||(Be=Te.rasterParticleState=new Qs(H,ke,Re,le));const De=Be.update(z.lastInvalidatedAt);Be.particleTextureDimension!==re&&Be.updateParticleTexture(ke,le);const We=Be.targetColorTexture;Be.targetColorTexture=Be.backgroundColorTexture,Be.backgroundColorTexture=We;const lt=Be.particleTexture0;Be.particleTexture0=Be.particleTexture1,Be.particleTexture1=lt,_e.push([ke,$e,Be,De])}if(_e.length===0)return;const ge=i.o.now(),Se=z.previousDrawTimestamp?.001*(ge-z.previousDrawTimestamp):.0167;if(z.previousDrawTimestamp=ge,z.hasColorMap()){H.activeTexture.set(Q.TEXTURE0+2);let ke=z.colorRampTexture;ke||(ke=z.colorRampTexture=new i.T(H,z.colorRamp,Q.RGBA8)),ke.bind(Q.LINEAR,Q.CLAMP_TO_EDGE)}H.bindFramebuffer.set(z.tileFramebuffer.framebuffer),function(ke,Te,$e){const Re=ke.context,Ve=Re.gl,Be=Te.tileFramebuffer;Re.activeTexture.set(Ve.TEXTURE0);const De={u_texture:0,u_opacity:1.05*(lt=Te.paint.get("raster-particle-fade-opacity-factor"))/(lt+.05)},We=ke.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var lt;for(const it of $e){const[,,bt,mt]=it;Be.colorAttachment.set(bt.targetColorTexture.texture),Re.viewport.set([0,0,Be.width,Be.height]),Re.clear({color:i.ao.transparent}),mt&&(bt.backgroundColorTexture.bind(Ve.NEAREST,Ve.CLAMP_TO_EDGE),We.draw(ke,Ve.TRIANGLES,Sr.disabled,Yr.disabled,mn.alphaBlended,Gr.disabled,De,Te.id,ke.viewportBuffer,ke.quadTriangleIndexBuffer,ke.viewportSegments))}}(O,z,_e),function(ke,Te,$e,Re){const Ve=ke.context,Be=Ve.gl,De=$e.tileFramebuffer,We=ke.transform.projection.name==="globe",lt=$e.paint.get("raster-particle-max-speed");for(const it of Re){const[bt,mt,Ot]=it;Ve.activeTexture.set(Be.TEXTURE0+0),mt.texture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE),De.colorAttachment.set(Ot.targetColorTexture.texture);const Zt=ke.getOrCreateProgram("rasterParticleDraw",{defines:mt.defines,overrideFog:!1});Ve.activeTexture.set(Be.TEXTURE0+1);const pt=mt.scalarData?[]:[0,1,2,3].map(gt=>i.e8[gt](bt));pt.push(bt);const et=bt.canonical.x,kt=bt.canonical.y;for(const gt of pt){const Lt=Te.getTile(We?gt.wrapped():gt);if(!Lt)continue;const Qt=Lt.rasterParticleState;if(!Qt)continue;const vr=gt.canonical.x+(1<<gt.canonical.z)*(gt.wrap-bt.wrap),Gt=gt.canonical.y;Qt.particleTexture0.bind(Be.NEAREST,Be.CLAMP_TO_EDGE);const Yt=Cw(1,Qt.particleTexture0.size[0],[vr-et,Gt-kt],0,mt.texture.size,2,lt,mt.textureOffset,mt.scale,mt.offset);Zt.draw(ke,Be.POINTS,Sr.disabled,Yr.disabled,mn.alphaBlended,Gr.disabled,Yt,$e.id,Qt.particleIndexBuffer,void 0,Qt.particleSegment)}}}(O,L,z,_e),H.bindFramebuffer.set(z.particleFramebuffer.framebuffer),function(ke,Te,$e,Re){const Ve=ke.context,Be=Ve.gl,De=Te.paint.get("raster-particle-max-speed"),We=Re*Te.paint.get("raster-particle-speed-factor")*.15,lt=function(bt){return Math.pow(bt,6)}(.01+1*Te.paint.get("raster-particle-reset-rate-factor")),it=Te.particleFramebuffer;Ve.viewport.set([0,0,it.width,it.height]);for(const bt of $e){const[,mt,Ot]=bt;Ve.activeTexture.set(Be.TEXTURE0+0),mt.texture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE),Ve.activeTexture.set(Be.TEXTURE0+1);const Zt=Ot.particleTexture0;Zt.bind(Be.NEAREST,Be.CLAMP_TO_EDGE);const pt=p_(1,Zt.size[0],0,mt.texture.size,De,We,lt,mt.textureOffset,mt.scale,mt.offset);it.colorAttachment.set(Ot.particleTexture1.texture),Ve.clear({color:i.ao.transparent}),ke.getOrCreateProgram("rasterParticleUpdate",{defines:mt.defines}).draw(ke,Be.TRIANGLES,Sr.disabled,Yr.disabled,mn.unblended,Gr.disabled,pt,Te.id,ke.viewportBuffer,ke.quadTriangleIndexBuffer,ke.viewportSegments)}}(O,z,_e,Se)}(y,s,h,v),y.renderPass==="translucent"&&(function(O,L,z,G,H){const Q=O.context,K=Q.gl,re=L.getSource().tileSize,le=5*(1-i.ah(i.cK,i.cK+1,O.transform.zoom))*re+z.paint.get("raster-particle-elevation"),ue=!O.options.moving,_e=O.transform.projection.name==="globe";if(!G.length)return;const[ge,Se]=O.stencilConfigForOverlap(G),ke=[];_e&&ke.push("PROJECTION_GLOBE_VIEW");const Te=O.stencilModeFor3D();for(const $e of Se){const Re=$e.toUnwrapped(),Ve=L.getTile($e);if(!Ve.rasterParticleState)continue;const Be=Ve.rasterParticleState,De=100;Ve.registerFadeDuration(De);const We=L.findLoadedParent($e,0),lt=s_(Ve,We,L,O.transform,De);let it,bt;O.terrain&&O.terrain.prepareDrawTile(),Q.activeTexture.set(K.TEXTURE0),Be.targetColorTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),Q.activeTexture.set(K.TEXTURE1),We&&We.rasterParticleState?(We.rasterParticleState.targetColorTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),it=Math.pow(2,We.tileID.overscaledZ-Ve.tileID.overscaledZ),bt=[Ve.tileID.canonical.x*it%1,Ve.tileID.canonical.y*it%1]):Be.targetColorTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const mt=_e?Float32Array.from(O.transform.expandedFarZProjMatrix):O.transform.calculateProjMatrix(Re,ue),Ot=O.transform,Zt=Es(Ot),pt=i.dF($e.canonical),et=i.dG(pt.getCenter().lat);let kt,gt,Lt,Qt,vr;_e?(kt=Float32Array.from(i.bj(i.dI($e.canonical))),gt=Float32Array.from(Ot.globeMatrix),Lt=Float32Array.from(i.dE(Ot)),Qt=[i.aF(Ot.center.lng),i.aJ(Ot.center.lat)],vr=Float32Array.from(i.dH($e.canonical,pt,et,Ot.worldSize/Ot._pixelsPerMercatorPixel))):(kt=new Float32Array(16),gt=new Float32Array(9),Lt=new Float32Array(16),Qt=[0,0],vr=new Float32Array(9));const Gt=$d(mt,kt,gt,Lt,vr,bt||[0,0],i.aj(O.transform.zoom),Qt,Zt,it||1,lt,le),Yt=O.isTileAffectedByFog($e),br=O.getOrCreateProgram("rasterParticle",{defines:ke,overrideFog:Yt});if(O.uploadCommonUniforms(Q,br,Re),_e){const hr=new Sr(K.LEQUAL,Sr.ReadOnly,O.depthRangeFor3D),cr=0,fr=O.globeSharedBuffers;if(fr){const[Mr,An,Dn]=fr.getGridBuffers(et,cr!==0);br.draw(O,K.TRIANGLES,hr,Te,mn.alphaBlended,O.renderElevatedRasterBackface?Gr.frontCCW:Gr.backCCW,Gt,z.id,Mr,An,Dn)}}else{const hr=O.depthModeForSublayer(0,Sr.ReadOnly),cr=ge[$e.overscaledZ],{tileBoundsBuffer:fr,tileBoundsIndexBuffer:Mr,tileBoundsSegments:An}=O.getTileBoundsBuffers(Ve);br.draw(O,K.TRIANGLES,hr,cr,mn.alphaBlended,Gr.disabled,Gt,z.id,fr,Mr,An)}}O.resetStencilClippingMasks()}(y,s,h,v),y.style.map.triggerRepaint())},background:function(y,s,h,v){const w=h.paint.get("background-color"),P=h.paint.get("background-color-use-theme").constantOr("default")==="none",O=h.paint.get("background-opacity"),L=h.paint.get("background-emissive-strength"),z=h.paint.get("background-pitch-alignment")==="viewport";if(O===0)return;const G=y.context,H=G.gl,Q=y.transform,K=Q.tileSize,re=h.paint.get("background-pattern");let le;if(re!==void 0&&(re===null||(le=y.imageManager.getPattern(i.I.from(re.toString()),h.scope,y.style.getLut(h.scope)),!le)))return;const ue=!re&&w.a===1&&O===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==ue)return;const _e=Yr.disabled,ge=y.depthModeForSublayer(0,ue==="opaque"?Sr.ReadWrite:Sr.ReadOnly),Se=y.colorModeForDrapableLayerRenderPass(L),ke=re?"backgroundPattern":"background";let Te,$e=v;if($e||(Te=y.getBackgroundTiles(),$e=Object.values(Te).map(Re=>Re.tileID)),re&&(G.activeTexture.set(H.TEXTURE0),y.imageManager.bind(y.context,h.scope)),z){const Re=y.getOrCreateProgram(ke,{overrideFog:!1,overrideRtt:!0}),Ve=new Float32Array(i.bz([])),Be=new i.aP(0,0,0,0,0),De=re?g_(Ve,L,O,y,0,h.scope,le,z,{tileID:Be,tileSize:K}):m_(Ve,L,O,w.toPremultipliedRenderColor(P?null:h.lut));Re.draw(y,H.TRIANGLES,ge,_e,Se,Gr.disabled,De,h.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments)}else for(const Re of $e){const Ve=y.isTileAffectedByFog(Re),Be=y.getOrCreateProgram(ke,{overrideFog:Ve}),De=Re.toUnwrapped(),We=v?Re.projMatrix:y.transform.calculateProjMatrix(De);y.prepareDrawTile();const lt=s?s.getTile(Re):Te?Te[Re.key]:new iu(Re,K,Q.zoom,y),it=re?g_(We,L,O,y,0,h.scope,le,z,{tileID:Re,tileSize:K}):m_(We,L,O,w.toPremultipliedRenderColor(P?null:h.lut));y.uploadCommonUniforms(G,Be,De);const{tileBoundsBuffer:bt,tileBoundsIndexBuffer:mt,tileBoundsSegments:Ot}=y.getTileBoundsBuffers(lt);Be.draw(y,H.TRIANGLES,ge,_e,Se,Gr.disabled,it,h.id,bt,mt,Ot)}},sky:function(y,s,h){const v=y._atmosphere?i.aj(y.transform.zoom):1,w=h.paint.get("sky-opacity")*v;if(w===0)return;const P=y.context,O=h.paint.get("sky-type"),L=new Sr(P.gl.LEQUAL,Sr.ReadOnly,[0,1]),z=y.frameCounter/1e3%1;O==="atmosphere"?y.renderPass==="offscreen"?h.needsSkyboxCapture(y)&&(function(G,H,Q,K){const re=G.context,le=re.gl;let ue=H.skyboxFbo;if(!ue){ue=H.skyboxFbo=re.createFramebuffer(32,32,!0,null),H.skyboxGeometry=new Uw(re),H.skyboxTexture=re.gl.createTexture(),le.bindTexture(le.TEXTURE_CUBE_MAP,H.skyboxTexture),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_S,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_T,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MIN_FILTER,le.LINEAR),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MAG_FILTER,le.LINEAR);for(let ke=0;ke<6;++ke)le.texImage2D(le.TEXTURE_CUBE_MAP_POSITIVE_X+ke,0,le.RGBA,32,32,0,le.RGBA,le.UNSIGNED_BYTE,null)}re.bindFramebuffer.set(ue.framebuffer),re.viewport.set([0,0,32,32]);const _e=H.getCenter(G,!0),ge=G.getOrCreateProgram("skyboxCapture"),Se=new Float64Array(16);i.bz(Se),i.em(Se,Se,.5*-Math.PI),ac(G,H,ge,Se,_e,0),i.bz(Se),i.em(Se,Se,.5*Math.PI),ac(G,H,ge,Se,_e,1),i.bz(Se),i.cT(Se,Se,.5*-Math.PI),ac(G,H,ge,Se,_e,2),i.bz(Se),i.cT(Se,Se,.5*Math.PI),ac(G,H,ge,Se,_e,3),i.bz(Se),ac(G,H,ge,Se,_e,4),i.bz(Se),i.em(Se,Se,Math.PI),ac(G,H,ge,Se,_e,5),re.viewport.set([0,0,G.width,G.height])}(y,h),h.markSkyboxValid(y)):y.renderPass==="sky"&&function(G,H,Q,K,re){const le=G.context,ue=le.gl,_e=G.transform,ge=G.getOrCreateProgram("skybox");le.activeTexture.set(ue.TEXTURE0),ue.bindTexture(ue.TEXTURE_CUBE_MAP,H.skyboxTexture);const Se=((ke,Te,$e,Re,Ve)=>({u_matrix:ke,u_sun_direction:Te,u_cubemap:0,u_opacity:Re,u_temporal_offset:Ve}))(_e.skyboxMatrix,H.getCenter(G,!1),0,K,re);G.uploadCommonUniforms(le,ge),ge.draw(G,ue.TRIANGLES,Q,Yr.disabled,G.colorModeForRenderPass(),Gr.backCW,Se,"skybox",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(y,h,L,w,z):O==="gradient"&&y.renderPass==="sky"&&function(G,H,Q,K,re){const le=G.context,ue=le.gl,_e=G.transform,ge=G.getOrCreateProgram("skyboxGradient");H.skyboxGeometry||(H.skyboxGeometry=new Uw(le)),le.activeTexture.set(ue.TEXTURE0);let Se=H.colorRampTexture;Se||(Se=H.colorRampTexture=new i.T(le,H.colorRamp,ue.RGBA8)),Se.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);const ke=((Te,$e,Re,Ve,Be)=>({u_matrix:Te,u_color_ramp:0,u_center_direction:$e,u_radius:i.an(Re),u_opacity:Ve,u_temporal_offset:Be}))(_e.skyboxMatrix,H.getCenter(G,!1),H.paint.get("sky-gradient-radius"),K,re);G.uploadCommonUniforms(le,ge),ge.draw(G,ue.TRIANGLES,Q,Yr.disabled,G.colorModeForRenderPass(),Gr.backCW,ke,"skyboxGradient",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(y,h,L,w,z)},custom:function(y,s,h,v){const w=y.context,P=h.implementation;if(!y.transform.projection.unsupportedLayers||!y.transform.projection.unsupportedLayers.includes("custom")||y.terrain&&(y.terrain.renderingToTexture||y.renderPass==="offscreen")&&h.isDraped(s)){if(y.renderPass==="offscreen"){const O=P.prerender;if(O){if(y.setCustomLayerDefaults(),w.setColorMode(y.colorModeForRenderPass()),y.transform.projection.name==="globe"){const L=y.transform.pointMerc;O.call(P,w.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),i.aj(y.transform.zoom),[L.x,L.y],y.transform.pixelsPerMeterRatio)}else O.call(P,w.gl,y.transform.customLayerMatrix());w.setDirty(),y.setBaseState()}}else if(y.renderPass==="translucent"){if(y.terrain&&y.terrain.renderingToTexture){const L=P.renderToTile;if(L){const z=v[0].canonical,G={x:z.x+v[0].wrap*(P.wrapTileId?0:1<<z.z),y:z.y,z:z.z};w.setDepthMode(Sr.disabled),w.setStencilMode(Yr.disabled),w.setColorMode(y.colorModeForRenderPass()),y.setCustomLayerDefaults(),L.call(P,w.gl,G),w.setDirty(),y.setBaseState()}return}y.setCustomLayerDefaults(),w.setColorMode(y.colorModeForRenderPass()),w.setStencilMode(Yr.disabled);const O=P.renderingMode==="3d"?new Sr(y.context.gl.LEQUAL,Sr.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,Sr.ReadOnly);if(w.setDepthMode(O),y.transform.projection.name==="globe"){const L=y.transform.pointMerc;P.render(w.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),i.aj(y.transform.zoom),[L.x,L.y],y.transform.pixelsPerMeterRatio)}else P.render(w.gl,y.transform.customLayerMatrix());w.setDirty(),y.setBaseState(),w.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(y,s,h,v){if(y.renderPass==="opaque")return;const w=h.paint.get("model-opacity").constantOr(1),P=h.paint.get("model-elevation-reference"),O=P==="ground",L=P==="ground";if(w===0)return;const z=h.paint.get("model-cast-shadows");if(y.renderPass==="shadow"&&(!z||y.terrain&&w<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof i.ad))return;const G=y.shadowRenderer,H=h.paint.get("model-receive-shadows");G&&(G.useNormalOffset=!0,H||(G.enabled=!1));const Q=()=>{G&&(G.useNormalOffset=!0,H||(G.enabled=!0))},K=s.getSource();if(y.renderPass==="light-beam"&&K.type!=="batched-model")return;if(K.type==="vector"||K.type==="geojson")return function(Te,$e,Re,Ve,Be){const De=Te.transform,We=De.projection.name==="globe",lt=De.getFreeCameraOptions().position;if(!Te.modelManager)return;const it=Te.modelManager;Re.modelManager=it;const bt=Te.shadowRenderer;if(!Re._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const mt=Re._unevaluatedLayout._values["model-id"],Ot=Object.assign({},Re.layout.get("model-id").parameters),Zt=Te.style.order.indexOf(Re.fqid);for(const pt of Ve){const et=$e.getTile(pt).getBucket(Re);if(!et||et.projection.name!==De.projection.name)continue;const kt=et.getModelUris();if(kt&&!et.modelsRequested&&(it.addModelsFromBucket(kt,Be),et.modelsRequested=!0),We)Ot.zoom=pt.overscaledZ;else{const hr=qw(pt,De);Ot.zoom=hr}const gt=mt.possiblyEvaluate(Ot);if(V2(Te,et,pt),wl.shadowUniformsInitialized=!1,wl.useSingleShadowCascade=!!bt&&bt.getMaxCascadeForTile(pt.toUnwrapped())===0,Te.renderPass==="shadow"&&bt){if(Te.currentShadowCascade===1&&et.isInsideFirstShadowMapFrustum)continue;const hr=De.calculatePosMatrix(pt.toUnwrapped(),De.worldSize);if(wl.tileMatrix.set(hr),wl.shadowTileMatrix=Float32Array.from(bt.calculateShadowPassMatrixFromMatrix(hr)),wl.aabb.min=[0,0,0],wl.aabb.max[0]=wl.aabb.max[1]=i.al,wl.aabb.max[2]=0,P_(et,wl,Te,Re.scope))continue}const Lt=1<<pt.canonical.z,Qt=[((lt.x-pt.wrap)*Lt-pt.canonical.x)*i.al,(lt.y*Lt-pt.canonical.y)*i.al,lt.z*Lt*i.al];Te.conflationActive&&Object.keys(et.instancesPerModel).length>0&&Te.style.isLayerClipped(Re,$e.getSource())&&et.updateReplacement(pt,Te.replacementSource,Zt,Be)&&(et.uploaded=!1,et.upload(Te.context));let vr=0;const Gt=new Array,Yt=new Array,br=new Array;for(let hr in et.instancesPerModel){const cr=et.instancesPerModel[hr];cr.features.length>0&&!We&&(hr=gt.evaluate(cr.features[0].feature,{}));const fr=it.getModel(hr,Be);if(fr||it.hasURLBeenRequested(hr)||et.modelUris.includes(hr)||(et.modelUris.push(hr),et.modelsRequested=!1),fr&&fr.uploaded)if(We){const Mr=i.c4([],[lt.x,lt.y,lt.z],Te.transform.worldSize);i.ev(Mr,Mr);for(let An=0;An<cr.instancedDataArray.length;++An){const Dn=[0,0,0],mi=[1,1,1],Hr=i.ew(),Mn=cr.tileCoordinatesForInstance(An),sn=cr.transformForInstance(An);i.ex(mi,sn),i.ey(Hr,sn),i.ez(Dn,Hr);const si=cr.translationForInstance(An),Ln=new i.aS(0,0);i.eA(et.canonical,Ln,Mn.x,Mn.y);const Ai=i.bB();i.eB(Ai,fr,Te.transform,Ln,Dn,mi,si,!0,!1,!1);const qn=cr.colorForInstance(An),dn=i.bz([]),Jn=i.ee(Ln.lat,Te.transform.zoom),gn=i.bp([],[1,1,1/Jn]);i.bq(dn,dn,Mr),br.push({zScaleMatrix:gn,negCameraPosMatrix:dn});for(const Mi of fr.nodes)A_(Te,Mi,Ai,Te.transform.expandedFarZProjMatrix,vr,Gt,Yt,fr.materialOverrides,qn);++vr}}else for(const Mr of fr.nodes)Ww(Te,Re,Mr,cr,Qt,pt,wl)}if(We)if(Te.renderPass==="shadow"){for(const hr of Yt)bp(hr.mesh,hr.nodeModelMatrix,Te,Re);for(const hr of Gt)bp(hr.mesh,hr.nodeModelMatrix,Te,Re)}else U2(Te,Re,1,Gt,Yt,br)}}(y,s,h,v,T_(K,h,y.style._importedAsBasemap)),void Q();if(!K.loaded())return;if(K.type==="batched-model")return function(Te,$e,Re,Ve){Re.resetLayerRenderingStats(Te);const Be=Te.context,De=Te.transform,We=Te.style.fog,lt=Te.shadowRenderer;if(De.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${De.projection.name} projection is not yet implemented`);const it=Te.transform.getFreeCameraOptions().position,bt=i.c4([],[it.x,it.y,it.z],Te.transform.worldSize),mt=i.ev([],bt),Ot=i.bz([]),Zt=i.ee(De.center.lat,De.zoom),pt=i.bp([],[1,1,1/Zt]);i.bq(Ot,Ot,mt);const et=Re.paint.get("model-opacity").constantOr(1),kt=new Sr(Be.gl.LEQUAL,Sr.ReadWrite,Te.depthRangeFor3D),gt=new Sr(Be.gl.LEQUAL,Sr.ReadOnly,Te.depthRangeFor3D),Lt=new i.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Qt=Te.renderPass==="shadow",vr=Qt&&lt?lt.getCurrentCascadeFrustum():De.getFrustum(De.scaleZoom(De.worldSize)),Gt=Re.paint.get("model-front-cutoff"),Yt=Gt[2]<1,br=qu(Te,Re.paint.get("model-cutoff-fade-range")),hr=Re.getLayerRenderingStats();(function(cr,fr,Mr,An){const Dn=cr.terrain?cr.terrain.exaggeration():0,mi=cr.transform.zoom;for(const Hr of An){const Mn=fr.getTile(Hr).getBucket(Mr);Mn&&(Mn.setFilter(Mr.filter),cr.conflationActive&&Mn.updateReplacement(Hr,cr.replacementSource),Mn.evaluateTransform(cr,Mr),cr.terrain&&Dn>0&&Mn.elevationUpdate(cr.terrain,Dn,Hr,Mr.source),Mn.needsReEvaluation(cr,mi,Mr)&&Mn.evaluate(Mr))}})(Te,$e,Re,Ve),function(){let cr,fr,Mr;Yt?(cr=Ve.length-1,fr=-1,Mr=-1):(cr=0,fr=Ve.length,Mr=1);const An=new Float64Array(16),Dn=i.cz(),mi=new i.P(0,0);for(let Hr=cr;Hr!==fr;Hr+=Mr){const Mn=Ve[Hr],sn=$e.getTile(Mn).getBucket(Re);if(!sn||!sn.uploaded)continue;let si=!1;lt&&(si=lt.getMaxCascadeForTile(Mn.toUnwrapped())===0);const Ln=De.calculatePosMatrix(Mn.toUnwrapped(),De.worldSize),Ai=sn.modelTraits;!Qt&&Yt&&(i.bk(An,Ln),i.af(Dn,bt,An),mi.x=Dn[0],mi.y=Dn[1]);const qn=[];sn.setFilter(Re.filter);for(const dn of sn.getNodesInfo()){if(dn.hiddenByReplacement||!dn.node.meshes)continue;const Jn=dn.node;let gn=0;Te.terrain&&Jn.elevation&&(gn=Jn.elevation*Te.terrain.exaggeration());const Mi=(()=>{const Wo=dn.aabb;return Lt.min=[...Wo.min],Lt.max=[...Wo.max],Lt.min[2]+=gn,Lt.max[2]+=gn,i.af(Lt.min,Lt.min,Ln),i.af(Lt.max,Lt.max,Ln),Lt})(),ri=dn.evaluatedScale;if(ri[0]<=1&&ri[1]<=1&&ri[2]<=1&&Mi.intersects(vr)===0)continue;if(!Qt&&Yt){const Wo=.16666666666666666;dn.cameraCollisionOpacity=bt[0]>Mi.min[0]&&bt[0]<Mi.max[0]&&bt[1]>Mi.min[1]&&bt[1]<Mi.max[1]&&bt[2]*Zt<Mi.max[2]&&Jn.footprint&&i.b$(mi,Jn.footprint)?Math.max(dn.cameraCollisionOpacity-Wo,0):Math.min(1,dn.cameraCollisionOpacity+Wo)}const Zr=[...Ln],zn=1/i.d6(Mn.canonical),Xi=Jn.anchor?Jn.anchor[0]:0,ba=Jn.anchor?Jn.anchor[1]:0;i.bq(Zr,Zr,[Xi*(ri[0]-1)+dn.evaluatedTranslation[0]*zn,ba*(ri[1]-1)+dn.evaluatedTranslation[1]*zn,gn+dn.evaluatedTranslation[2]]),i.cp(ri,i.eD)||i.cR(Zr,Zr,ri);const ra=i.aB([],Zr,Jn.globalMatrix),da=i.aB([],De.expandedFarZProjMatrix,ra),zs=i.aB([],De.expandedFarZProjMatrix,Zr),Ts=i.aC([],[Xi,ba,gn,1],da)[2];Jn.hidden=!1;let jo=et;Qt||(Yt&&(jo*=dn.cameraCollisionOpacity,jo*=Jh(Zr,De,dn.aabb,Gt)),jo*=Zg(br,Ts)),jo!==0?qn.push({nodeInfo:dn,depth:Ts,opacity:jo,wvpForNode:da,wvpForTile:zs,nodeModelMatrix:ra,tileModelMatrix:Zr}):Jn.hidden=!0}Qt||qn.sort((dn,Jn)=>!Yt||dn.opacity===1&&Jn.opacity===1?dn.depth<Jn.depth?-1:1:dn.opacity===1?-1:Jn.opacity===1?1:dn.depth>Jn.depth?-1:1);for(const dn of qn){const Jn=dn.nodeInfo,gn=Jn.node;let Mi=i.aB([],pt,dn.tileModelMatrix);i.aB(Mi,Ot,Mi);const ri=i.bk([],Mi);i.ef(ri,ri),i.cR(ri,ri,q2),Mi=i.aB(Mi,Mi,gn.globalMatrix);const Zr=Te.renderPass==="light-beam",zn=Re.paint.get("model-color-use-theme").constantOr("default")==="none",Xi=Ai&i.eH.HasMapboxMeshFeatures,ba=Xi?0:Jn.evaluatedRMEA[0][2];for(let ra=0;ra<gn.meshes.length;++ra){const da=gn.meshes[ra],zs=ra===gn.lightMeshIndex;let Ts=dn.wvpForNode;if(zs){if(!Zr&&!Te.terrain&&Te.shadowRenderer){Te.currentLayer<Te.firstLightBeamLayer&&(Te.firstLightBeamLayer=Te.currentLayer);continue}Ts=dn.wvpForTile}else if(Zr)continue;const jo={defines:[]},Wo=[];if(!Qt&&lt&&(lt.useNormalOffset=!!da.normalBuffer),_p(jo.defines,Wo,da,Te,zn?null:Re.lut),Xi||jo.defines.push("DIFFUSE_SHADED"),si&&jo.defines.push("SHADOWS_SINGLE_CASCADE"),hr&&(Qt?hr.numRenderedVerticesInShadowPass+=da.vertexArray.length:hr.numRenderedVerticesInTransparentPass+=da.vertexArray.length),Qt){bp(da,dn.nodeModelMatrix,Te,Re);continue}let El=null;if(We){const wa=Vw(dn.nodeModelMatrix,Te.transform);if(El=new Float32Array(wa),De.projection.name!=="globe"){const Ei=da.aabb.min,Aa=da.aabb.max,[go,sa]=We.getOpacityForBounds(wa,Ei[0],Ei[1],Aa[0],Aa[1]);jo.overrideFog=go>=yt||sa>=yt}}const No=da.material;let Tl;No.occlusionTexture&&No.occlusionTexture.offsetScale&&(Tl=No.occlusionTexture.offsetScale,jo.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const lc=Te.getOrCreateProgram("model",jo);!Qt&&lt&&lt.setupShadowsFromMatrix(dn.tileModelMatrix,lc,lt.useNormalOffset),Te.uploadCommonUniforms(Be,lc,null,El);const mo=No.pbrMetallicRoughness;mo.metallicFactor=.9,mo.roughnessFactor=.5;const oa=y_(new Float32Array(Ts),new Float32Array(Mi),new Float32Array(ri),new Float32Array(gn.globalMatrix),Te,dn.opacity,mo.baseColorFactor,No.emissiveFactor,mo.metallicFactor,mo.roughnessFactor,No,ba,Re,[0,0,0],Tl);!zs&&(Jn.hasTranslucentParts||dn.opacity<1)&&lc.draw(Te,Be.gl.TRIANGLES,kt,Yr.disabled,mn.disabled,Gr.backCCW,oa,Re.id,da.vertexBuffer,da.indexBuffer,da.segments,Re.paint,Te.transform.zoom,void 0,Wo),lc.draw(Te,Be.gl.TRIANGLES,zs?gt:kt,Yr.disabled,zs||dn.opacity<1||Jn.hasTranslucentParts?mn.alphaBlended:mn.unblended,Gr.backCCW,oa,Re.id,da.vertexBuffer,da.indexBuffer,da.segments,Re.paint,Te.transform.zoom,void 0,Wo)}}}}()}(y,s,h,v),void Q();if(K.type!=="model")return;const re=K.getModels(),le=[],ue=y.transform.getFreeCameraOptions().position,_e=i.c4([],[ue.x,ue.y,ue.z],y.transform.worldSize);i.ev(_e,_e);const ge=[],Se=[];let ke=0;for(const Te of re){const $e=s.getFeatureState("",Te.id),Re={type:"Unknown",id:Te.id,properties:Te.featureProperties},Ve=h.paint.get("model-rotation").evaluate(Re,$e),Be=h.paint.get("model-scale").evaluate(Re,$e),De=h.paint.get("model-translation").evaluate(Re,$e);wp(h,Te.id,$e,Te.featureProperties,Te.nodeOverrideNames,Te.nodeOverrides),gj(h,Te.id,$e,Te.featureProperties,Te.materialOverrideNames,Te.materialOverrides),Te.nodeOverrides.size>0&&Te.computeBoundsAndApplyParent(),Te.computeModelMatrix(y,Ve,Be,De,L,O,!1);const We=i.bz([]),lt=i.ee(Te.position.lat,y.transform.zoom),it=i.bp([],[1,1,1/lt]);i.bq(We,We,_e),le.push({zScaleMatrix:it,negCameraPosMatrix:We});for(const bt of Te.nodes)A_(y,bt,Te.matrix,y.transform.expandedFarZProjMatrix,ke,ge,Se,Te.materialOverrides);ke++}if(ge.sort((Te,$e)=>$e.depth-Te.depth),y.renderPass!=="shadow")U2(y,h,w,ge,Se,le),Q();else{for(const Te of Se)bp(Te.mesh,Te.nodeModelMatrix,y,h);for(const Te of ge)bp(Te.mesh,Te.nodeModelMatrix,y,h);Q()}}},C_={line:function(y,s,h){if(y.hasElevatedBuckets=!1,y.hasNonElevatedBuckets=!1,y._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||y._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(s){const v=s.getVisibleCoordinates();for(const w of v){const P=s.getTile(w).getBucket(y);if(P&&(P.elevationType!=="none"?y.hasElevatedBuckets=!0:y.hasNonElevatedBuckets=!0,y.hasElevatedBuckets&&y.hasNonElevatedBuckets))break}}}else y.hasNonElevatedBuckets=!0},model:function(y,s,h){const v=s.getSource();if(!v.loaded())return;if(v.type==="vector"||v.type==="geojson"){const P=T_(v,y,h.style._importedAsBasemap);return void(h.modelManager&&h.modelManager.upload(h,P))}if(v.type==="batched-model"||v.type!=="model")return;const w=v.getModels();for(const P of w)P.upload(h.context)},raster:function(y,s,h){const v=s.getSource();if(!(v instanceof lo&&v.loaded()))return;const w=y.sourceLayer||v.rasterLayerIds&&v.rasterLayerIds[0];if(!w)return;const P=y.paint.get("raster-array-band")||v.getInitialBand(w);if(P==null)return;const O=s.getIds().map(L=>s.getTileByID(L));for(const L of O)L.updateNeeded(y.id,P)&&v.prepareTile(L,w,y.id,P)},"raster-particle":function(y,s,h){const v=s.getSource();if(!(v instanceof lo&&v.loaded()))return;const w=y.sourceLayer||v.rasterLayerIds&&v.rasterLayerIds[0];if(!w)return;const P=y.paint.get("raster-particle-array-band")||v.getInitialBand(w);if(P==null)return;const O=s.getIds().map(L=>s.getTileByID(L));for(const L of O)L.updateNeeded(y.id,P)&&v.prepareTile(L,w,y.id,P)}},O_={fill:Xh},Sl={fill:function(y,s,h,v){if(!h.layout||h.layout.get("fill-elevation-reference")==="none"||h.paint.get("fill-opacity").constantOr(1)===0)return;const w=y.context.gl,P=new Sr(w.LEQUAL,Sr.ReadOnly,y.depthRangeFor3D),O=new Yr({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),L=y.transform.getFreeCameraOptions().position,z=y.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const G of v){const H=s.getTile(G),Q=H.getBucket(h);if(!Q)continue;const K=Q.elevatedStructures;if(!K||K.depthSegments.segments[0].primitiveLength===0)continue;const re=D2(G.toUnwrapped(),L),le=y.translatePosMatrix(G.projMatrix,H,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor")),ue=d_(le,re,0,1,0);z.draw(y,w.TRIANGLES,P,O,mn.disabled,Gr.disabled,ue,h.id,K.vertexBuffer,K.indexBuffer,K.depthSegments,h.paint,y.transform.zoom)}}};class Hd{constructor(s,h,v,w,P,O){this.context=new __(s,h),this.transform=v,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=P,this._timeStamp=i.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const L=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const G of L)this._debugParams.enabledLayers[G]=!0;P.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),P.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),P.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),P.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),P.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),P.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const G of L)P.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],G);this.occlusionParams=new yj(P),this.setup(),this.numSublayers=Ql.maxUnderzooming+Ql.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.eO,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Ng(this),this._wireframeDebugCache=new G2,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const z=new i.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,z,s.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=w,this.worldview=O}updateTerrain(s,h){const v=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(v||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Vg(this,s));const w=this._terrain;this.transform.elevation=v?w:null,w.update(s,this.transform,h),this.transform.elevation&&!w.enabled&&(this.transform.elevation=null)}_updateFog(s){const h=s.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[v,w]=h.getFovAdjustedRange(this.transform._fov);if(v>w)return void(this.transform.fogCullDistSq=null);const P=v+.78*(w-v);this.transform.fogCullDistSq=P*P}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(s){s&&!this._terrain&&(this._terrain=new Vg(this,this.style)),this._forceTerrainMode=s}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(s,h){if(this.width=s*i.o.devicePixelRatio,this.height=h*i.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style.order)this.style._mergedLayers[v].resize()}setup(){const s=this.context,h=new i.bc;h.emplaceBack(0,0),h.emplaceBack(i.al,0),h.emplaceBack(0,i.al),h.emplaceBack(i.al,i.al),this.tileExtentBuffer=s.createVertexBuffer(h,i.be.members),this.tileExtentSegments=i.bf.simpleSegment(0,0,4,2);const v=new i.bc;v.emplaceBack(0,0),v.emplaceBack(i.al,0),v.emplaceBack(0,i.al),v.emplaceBack(i.al,i.al),this.debugBuffer=s.createVertexBuffer(v,i.be.members),this.debugSegments=i.bf.simpleSegment(0,0,4,5);const w=new i.bc;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(w,i.be.members),this.viewportSegments=i.bf.simpleSegment(0,0,4,2);const P=new i.a$;P.emplaceBack(0,0,0,0),P.emplaceBack(i.al,0,i.al,0),P.emplaceBack(0,i.al,0,i.al),P.emplaceBack(i.al,i.al,i.al,i.al),this.mercatorBoundsBuffer=s.createVertexBuffer(P,i.bh.members),this.mercatorBoundsSegments=i.bf.simpleSegment(0,0,4,2);const O=new i.b0;O.emplaceBack(0,1,2),O.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(O);const L=new i.bd;for(const G of[0,1,3,2,0])L.emplaceBack(G);this.debugIndexBuffer=s.createIndexBuffer(L),this.emptyTexture=new i.T(s,new i.q({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA8),this.identityMat=i.bB();const z=this.context.gl;this.stencilClearMode=new Yr({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,s.TRIANGLES,Sr.disabled,this.stencilClearMode,mn.disabled,Gr.disabled,Kh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,h,v){if(!h||this.currentStencilSource===h.id||!s.isTileClipped()||!v||v.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let L=!1;for(const z of v)if(this._tileClippingMaskIDs[z.key]===void 0){L=!0;break}if(!L)return}this.currentStencilSource=h.id;const w=this.context,P=w.gl;this.nextStencilID+v.length>256&&this.clearStencil(),w.setColorMode(mn.disabled),w.setDepthMode(Sr.disabled);const O=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const L of v){const z=h.getTile(L),G=this._tileClippingMaskIDs[L.key]=this.nextStencilID++,{tileBoundsBuffer:H,tileBoundsIndexBuffer:Q,tileBoundsSegments:K}=this.getTileBoundsBuffers(z);O.draw(this,P.TRIANGLES,Sr.disabled,new Yr({func:P.ALWAYS,mask:0},G,255,P.KEEP,P.KEEP,P.REPLACE),mn.disabled,Gr.disabled,Kh(L.projMatrix),"$clipping",H,Q,K)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,h=this.context.gl;return new Yr({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const h=this.context.gl;return new Yr({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){const h=this.context.gl,v=s.sort((O,L)=>L.overscaledZ-O.overscaledZ),w=v[v.length-1].overscaledZ,P=v[0].overscaledZ-w+1;if(P>1){this.currentStencilSource=void 0,this.nextStencilID+P>256&&this.clearStencil();const O={};for(let L=0;L<P;L++)O[L+w]=new Yr({func:h.GEQUAL,mask:255},L+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=P,[O,v]}return[{[w]:Yr.disabled},v]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new mn([s.CONSTANT_COLOR,s.ONE,s.CONSTANT_COLOR,s.ONE],new i.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?mn.unblended:mn.alphaBlended}colorModeForDrapableLayerRenderPass(s){const h=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new mn([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new i.ao(0,0,0,s===void 0?0:s),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(s,h,v,w=!1){if(this.depthOcclusion)return new Sr(this.context.gl.GREATER,Sr.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!w)return Sr.disabled;const P=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new Sr(v||this.context.gl.LEQUAL,h,[P,P])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const s=this.context.gl,h=Math.ceil(this.width),v=Math.ceil(this.height),w=this.context.bindFramebuffer.get(),P=s.getParameter(s.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===h&&this.depthFBO.height===v||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),h!==0&&v!==0&&(this.depthFBO=new v_(this.context,h,v,!1,"texture"),this.depthTexture=new i.T(this.context,{width:h,height:v,data:null},s.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(w),s.bindTexture(s.TEXTURE_2D,P),this.depthFBO&&(s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),s.blitFramebuffer(0,0,h,v,0,0,h,v,s.DEPTH_BUFFER_BIT,s.NEAREST),s.bindFramebuffer(s.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((s,h)=>s+h/this._fpsHistory.length,0))}render(s,h){const v=i.o.now();this._dt=v-this._timeStamp,this._timeStamp=v,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=s.map.repaint,this.style=s,this.options=h;const w=this.style._mergedLayers,P=!(!this.terrain||!this.terrain.enabled),O=()=>this.style._getOrder(P).filter(pt=>{const et=w[pt];return!(et.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[et.type]});let L=O(),z=!1,G=!1,H=null;for(const pt of L){const et=w[pt];et.type==="circle"?z=!0:et.type==="building"?H=et:et.type==="symbol"&&(et.hasOcclusionOpacityProperties?G=!0:z=!0)}let Q=L.map(pt=>w[pt]);const K=this.style._mergedSourceCaches;this.imageManager=s.imageManager,this.modelManager=s.modelManager,this.symbolFadeChange=s.placement.symbolFadeChange(i.o.now()),this.imageManager.beginFrame();let re=0,le=!1;for(const pt in K){const et=K[pt];et.used&&(et.prepare(this.context),et.getSource().usedInConflation&&++re)}let ue=!1;for(const pt of Q)pt.isHidden(this.transform.zoom)||(pt.type==="clip"&&(ue=!0),this.prepareLayer(pt));const _e={},ge={},Se={},ke={},Te={};for(const pt in K){const et=K[pt];_e[pt]=et.getVisibleCoordinates(),ge[pt]=_e[pt].slice().reverse(),Se[pt]=et.getVisibleCoordinates(!0).reverse(),ke[pt]=et.getShadowCasterCoordinates(),Te[pt]=et.sortCoordinatesByDistance(_e[pt])}const $e=pt=>{const et=this.style.getLayerSourceCache(pt);return et&&et.used?et.getSource():null};if(re||ue||this._clippingActiveLastFrame){const pt=[],et=[];let kt=0;for(const gt of Q)this.isSourceForClippingOrConflation(gt,$e(gt))&&(pt.push(gt),et.push(kt)),kt++;if(pt&&(ue||pt.length>1)||this._clippingActiveLastFrame){ue=!1;const gt=[];for(let Lt=0;Lt<pt.length;Lt++){const Qt=pt[Lt],vr=et[Lt],Gt=this.style.getLayerSourceCache(Qt);if(!Gt||!Gt.used||!Gt.getSource().usedInConflation&&Qt.type!=="clip"&&Qt.type!=="building")continue;let Yt=i.eP,br=i.bZ.None;const hr=[];let cr=!0;if(Qt.type==="building")Yt=i.eR;else if(Qt.type==="clip"){Yt=vr;for(const fr of Qt.layout.get("clip-layer-types"))br|=fr==="model"?i.bZ.Model:fr==="symbol"?i.bZ.Symbol:i.bZ.FillExtrusion;for(const fr of Qt.layout.get("clip-layer-scope"))hr.push(fr);Qt.isHidden(this.transform.zoom)?cr=!1:ue=!0}cr&&gt.push({layer:Qt.fqid,cache:Gt,order:Yt,clipMask:br,clipScope:hr})}this.replacementSource.setSources(gt),le=!0}}this._clippingActiveLastFrame=ue,le||this.replacementSource.clear(),this.conflationActive=le,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let pt=0;pt<Q.length;pt++){const et=Q[pt],kt=et.cutoffRange();if(this.longestCutoffRange=Math.max(kt,this.longestCutoffRange),kt>0){const gt=$e(et);gt&&(this.minCutoffZoom=Math.max(gt.minzoom,this.minCutoffZoom)),et.minzoom&&(this.minCutoffZoom=Math.max(et.minzoom,this.minCutoffZoom))}et.is3D(P)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=pt),this._lastOcclusionLayer=pt)}const Re=this.style&&this.style.fog;Re?(this._fogVisible=Re.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Re.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Se),this.opaquePassCutoff=0,L=O(),Q=L.map(pt=>w[pt]));const Ve=this._shadowRenderer;if(Ve){Ve.updateShadowParameters(this.transform,this.style.directionalLight);for(const pt in K)for(const et of _e[pt]){let kt={min:0,max:0};this.terrain&&(kt=this.terrain.getMinMaxForTile(et)||kt),Ve.addShadowReceiver(et.toUnwrapped(),kt.min,kt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.eQ(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new ua(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Be=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),De=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Be&&!this._snow&&(this._snow=new Hw(this)),!Be&&this._snow&&(this._snow.destroy(),delete this._snow),De&&!this._rain&&(this._rain=new Sp(this)),!De&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),H){this.buildingTileBorderManager||(this.buildingTileBorderManager=new ht);const pt=this.style.getLayerSourceCache(H);this.buildingTileBorderManager.updateBorders(pt,H)}if(!Ut.has(this.context.gl))return;this.renderPass="offscreen";for(const pt of Q){const et=s.getLayerSourceCache(pt);if(!pt.hasOffscreenPass()||pt.isHidden(this.transform.zoom))continue;const kt=et?ge[et.id]:void 0;(pt.type==="custom"||pt.type==="raster"||pt.type==="raster-particle"||pt.isSky()||kt&&kt.length)&&this.renderLayer(this,et,pt,kt)}this.depthRangeFor3D=[0,1-(Q.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ke)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const We=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),lt=(()=>{if(h.showOverdrawInspector)return i.ao.black;const pt=this.style.fog;if(pt&&this.transform.projection.supportsFog){const et=this.style.getLut(pt.scope);if(!We){const kt=pt.properties.get("color-use-theme")==="none",gt=pt.properties.get("color").toNonPremultipliedRenderColor(kt?null:et).toArray01();return new i.ao(...gt)}if(We){const kt=pt.properties.get("space-color-use-theme")==="none",gt=pt.properties.get("space-color").toNonPremultipliedRenderColor(kt?null:et).toArray01();return new i.ao(...gt)}}return i.ao.transparent})();if(this.context.clear({color:lt,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&We&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=L.length-1;this.currentLayer>=0;this.currentLayer--){const pt=Q[this.currentLayer],et=s.getLayerSourceCache(pt);if(pt.isSky())continue;const kt=et?(pt.is3D(P)?Te:ge)[et.id]:void 0;this._renderTileClippingMasks(pt,et,kt),this.renderLayer(this,et,pt,kt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&We&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<L.length;this.currentLayer++){const pt=Q[this.currentLayer],et=s.getLayerSourceCache(pt);pt.isSky()&&this.renderLayer(this,et,pt,et?ge[et.id]:void 0)}function it(pt,et){let kt;return et&&(kt=(pt.type==="symbol"?Se:pt.is3D(P)?Te:ge)[et.id]),kt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<L.length;){const pt=Q[this.currentLayer];if(pt.type==="raster"||pt.type==="raster-particle"){const et=s.getLayerSourceCache(pt);this.renderLayer(this,et,pt,it(pt,et))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let bt=0;Ve&&(bt=Ve.getShadowCastingLayerCount());let mt=!1,Ot=-1;for(let pt=0;pt<L.length;++pt){const et=Q[pt];et.isHidden(this.transform.zoom)||et.is3D(P)&&(Ot=pt)}G&&Ot===-1&&(z=!0);let Zt=!1;for(;this.currentLayer<L.length;){const pt=Q[this.currentLayer],et=s.getLayerSourceCache(pt);if(pt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(pt)){if(pt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Zt&&pt.is3D(P)&&!P){const kt=this.currentLayer,gt=Lt=>{for(this.currentLayer=0;this.currentLayer<Q.length;this.currentLayer++){const Qt=Q[this.currentLayer];if(O_[Qt.type]){const vr=this.style.getLayerSourceCache(Qt);O_[Qt.type](this,vr,Qt,it(Qt,vr),Lt)}}};gt("initialize"),gt("reset"),this.currentLayer=kt,Zt=!0}if(z&&!mt&&this.terrain&&!this.transform.isOrthographic&&(mt=!0,this.blitDepth()),G&&Ot!==-1&&this.currentLayer===Ot+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(pt,et,et?_e[et.id]:void 0),this.renderLayer(this,et,pt,it(pt,et)),!this.terrain&&Ve&&bt>0&&pt.hasShadowPass()&&--bt==0){{this.clearStencil(),this.resetStencilClippingMasks();const kt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<Q.length;this.currentLayer++){const gt=Q[this.currentLayer];if(Sl[gt.type]){const Lt=this.style.getLayerSourceCache(gt);Sl[gt.type](this,Lt,gt,it(gt,Lt))}}this.currentLayer=kt}if(Ve.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const kt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=kt;this.currentLayer++){const gt=Q[this.currentLayer];if(!gt.hasLightBeamPass())continue;const Lt=s.getLayerSourceCache(gt);this.renderLayer(this,Lt,gt,Lt?ge[Lt.id]:void 0)}this.currentLayer=kt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const kt=this.currentLayer;this.depthOcclusion=!0;for(const gt of this.layersWithOcclusionOpacity){this.currentLayer=gt;const Lt=Q[this.currentLayer],Qt=s.getLayerSourceCache(Lt),vr=Qt?ge[Qt.id]:void 0;this.terrain||this._renderTileClippingMasks(Lt,Qt,Qt?_e[Qt.id]:void 0),this.renderLayer(this,Qt,Lt,vr)}this.depthOcclusion=!1,this.currentLayer=kt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let pt=null;Q.forEach(et=>{const kt=s.getLayerSourceCache(et);kt&&!et.isHidden(this.transform.zoom)&&kt.getVisibleCoordinates().length&&(!pt||pt.getSource().maxzoom<kt.getSource().maxzoom)&&(pt=kt)}),pt&&this.options.showTileBoundaries&&$w(this,pt,pt.getVisibleCoordinates(),i.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&$w(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(pt){const et=pt.transform.padding;Ri(pt,pt.transform.height-(et.top||0),3,Gd),Ri(pt,et.bottom||0,3,z2),Kg(pt,et.left||0,3,Fw),Kg(pt,pt.transform.width-(et.right||0),3,zw);const kt=pt.transform.centerPoint;(function(gt,Lt,Qt,vr){yp(gt,Lt-1,Qt-10,2,20,vr),yp(gt,Lt-10,Qt-1,20,2,vr)})(pt,kt.x,pt.transform.height-kt.y,Bw)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),le||(this.conflationActive=!1)}prepareLayer(s){this.gpuTimingStart(s);const{unsupportedLayers:h}=this.transform.projection,v=!h||!h.includes(s.type);if(C_[s.type]&&(v||this.terrain&&s.type==="custom")){const w=this.style.getLayerSourceCache(s);C_[s.type](s,w,this)}this.gpuTimingEnd()}renderLayer(s,h,v,w){v.isHidden(this.transform.zoom)||(v.type==="background"||v.type==="sky"||v.type==="custom"||v.type==="model"||v.type==="raster"||v.type==="raster-particle"||w&&w.length)&&(this.id=v.id,this.gpuTimingStart(v),s.transform.projection.unsupportedLayers&&s.transform.projection.unsupportedLayers.includes(v.type)&&(!s.terrain||v.type!=="custom")||v.type==="clip"||Kw[v.type](s,h,v,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery,v=this.context.gl;let w=this.gpuTimers[s.id];w||(w=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:v.createQuery()}),w.calls++,v.beginQuery(h.TIME_ELAPSED_EXT,w.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const s=this.context.extTimerQuery,h=this.context.gl,v=h.createQuery();this.deferredRenderGpuTimeQueries.push(v),h.beginQuery(s.TIME_ELAPSED_EXT,v)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){const s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){const h={};for(const v in s){const w=s[v],P=this.context.extTimerQuery,O=P.getQueryParameter(w.query,this.context.gl.QUERY_RESULT)/1e6;P.deleteQueryEXT(w.query),h[v]=O}return h}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.gl;let v=0;for(const w of s)v+=h.getQueryParameter(w,h.QUERY_RESULT)/1e6,h.deleteQuery(w);return v}translatePosMatrix(s,h,v,w,P){if(!v[0]&&!v[1])return s;const O=P?w==="map"?this.transform.angle:0:w==="viewport"?-this.transform.angle:0;if(O){const G=Math.sin(O),H=Math.cos(O);v=[v[0]*H-v[1]*G,v[0]*G+v[1]*H]}const L=[P?v[0]:i.ay(h,v[0],this.transform.zoom),P?v[1]:i.ay(h,v[1],this.transform.zoom),0],z=new Float32Array(16);return i.bq(z,s,L),z}saveTileTexture(s){if(s.context!==this.context)return;const h=s.size[0],v=this._tileTextures[h];v?v.push(s):this._tileTextures[h]=[s]}getTileTexture(s){const h=this._tileTextures[s];return h&&h.length>0?h.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(s,h,v){const w=v===void 0?this.terrain&&this.terrain.renderingToTexture:v,P=[];return this.style&&this.style.enable3dLights()&&(s==="globeRaster"||s==="terrainRaster"?(P.push("LIGHTING_3D_MODE"),P.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):w||P.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||P.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(P.push("TERRAIN"),this.linearFloatFilteringSupported()&&P.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&P.push("GLOBE"),!this._fogVisible||w||h!==void 0&&!h||P.push("FOG","FOG_DITHERING"),w&&P.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&P.push("OVERDRAW_INSPECTOR"),P}getOrCreateProgram(s,h){this.cache=this.cache||{};const v=h&&h.defines||[],w=h&&h.config,P=this.currentGlobalDefines(s,h&&h.overrideFog,h&&h.overrideRtt).concat(v),O=qg.cacheKey(Yv[s],s,P,w);return this.cache[O]||(this.cache[O]=new qg(this.context,s,Yv[s],w,hj[s],P)),this.cache[O]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(s,h){if(this.style.enable3dLights()){const v=this.style.directionalLight,w=this.style.ambientLight;if(v&&w){const P=((O,L,z)=>{const G=O.properties.get("direction"),H=O.properties.get("color-use-theme")==="none",Q=O.properties.get("color").toNonPremultipliedRenderColor(H?null:z.getLut(O.scope)).toArray01(),K=O.properties.get("intensity"),re=L.properties.get("color-use-theme")==="none",le=L.properties.get("color").toNonPremultipliedRenderColor(re?null:z.getLut(L.scope)).toArray01(),ue=L.properties.get("intensity"),_e=[G.x,G.y,G.z],ge=i.dM(le,ue),Se=i.dM(Q,K);return{u_lighting_ambient_color:ge,u_lighting_directional_dir:_e,u_lighting_directional_color:Se,u_ground_radiance:ww(_e,Se,ge)}})(v,w,this.style);h.setLightsUniformValues(s,P)}}}uploadCommonUniforms(s,h,v,w,P){if(this.uploadCommonLightUniforms(s,h),this.terrain&&this.terrain.renderingToTexture)return;const O=this.style.fog;if(O){const L=O.getOpacity(this.transform.pitch),z=((G,H,Q,K,re,le,ue,_e,ge,Se,ke,Te)=>{const $e=G.transform,Re=H.properties.get("color-use-theme")==="none",Ve=H.properties.get("color").toNonPremultipliedRenderColor(Re?null:G.style.getLut(H.scope)).toArray01();Ve[3]=K;const Be=G.frameCounter/1e3%1,[De,We]=H.properties.get("vertical-range");return{u_fog_matrix:Q?$e.calculateFogTileMatrix(Q):Te||G.identityMat,u_fog_range:H.getFovAdjustedRange($e._fov),u_fog_color:Ve,u_fog_horizon_blend:H.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(De,We),We],u_fog_temporal_offset:Be,u_frustum_tl:re,u_frustum_tr:le,u_frustum_br:ue,u_frustum_bl:_e,u_globe_pos:ge,u_globe_radius:Se,u_viewport:ke,u_globe_transition:i.aj($e.zoom),u_is_globe:+($e.projection.name==="globe")}})(this,O,v,L,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.o.devicePixelRatio,this.transform.height*i.o.devicePixelRatio],w);h.setFogUniformValues(s,z)}P&&h.setCutoffUniformValues(s,P.uniformValues)}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){const s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){const s=this.context.gl,h=s.createTexture();return s.bindTexture(s.TEXTURE_2D,h),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const s=this._backgroundTiles,h=this._backgroundTiles={},v=this.transform.coveringTiles({tileSize:512});for(const w of v)h[w.key]=s[w.key]||new iu(w,512,this.transform.tileZoom,this,void 0,this.worldview);return h}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(s,h){return!(!s.is3D(!(!this.terrain||!this.terrain.enabled))||s.type!=="clip"&&s.type!=="building"&&(s.minzoom&&s.minzoom>this.transform.zoom||(this.style._clipLayerPresent||s.sourceLayer!=="building"&&s.sourceLayer!=="procedural_buildings")&&(!h||h.type!=="batched-model")))}isTileAffectedByFog(s){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let h=this._cachedTileFogOpacities[s.key];return h||(this._cachedTileFogOpacities[s.key]=h=this.style.fog.getOpacityForTile(s)),h[0]>=yt||h[1]>=yt}setupDepthForOcclusion(s,h,v){const w=this.context,P=w.gl,O=!!v;var L;v||(v={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),w.activeTexture.set(P.TEXTURE3),s&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE),v.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],v.u_depth_range_unpack=[2/((L=this.depthRangeFor3D)[1]-L[0]),-1-2*L[0]/(L[1]-L[0])],v.u_occluder_half_size=.5*this.occlusionParams.occluderSize,v.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE),w.activeTexture.set(P.TEXTURE0),O||h.setTerrainUniformValues(w,v)}}function ef(y,s){let h=!1,v=null;const w=()=>{v=null,h&&(y(),v=setTimeout(w,s),h=!1)};return()=>(h=!0,v||w(),v)}class k_{constructor(s){this._hashName=s&&encodeURIComponent(s),i.aX(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ef(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const s=this._map;if(!s)return"";const h=I_(s);if(this._hashName){const v=this._hashName;let w=!1;const P=location.hash.slice(1).split("&").map(O=>{const L=O.split("=")[0];return L===v?(w=!0,`${L}=${h}`):O}).filter(O=>O);return w||P.push(`${v}=${h}`),`#${P.join("&")}`}return`#${h}`}_getCurrentHash(){const s=location.hash.replace("#","");if(this._hashName){let h;return s.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(h=v)}),(h&&h[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._map;if(!s)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(v=>isNaN(Number(v)))){const v=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(h[3]||0):s.getBearing();return s.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:v,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function I_(y,s){const h=y.getCenter(),v=Math.round(100*y.getZoom())/100,w=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),P=Math.pow(10,w),O=Math.round(h.lng*P)/P,L=Math.round(h.lat*P)/P,z=y.getBearing(),G=y.getPitch();let H=s?`/${O}/${L}/${v}`:`${v}/${L}/${O}`;return(z||G)&&(H+="/"+Math.round(10*z)/10),G&&(H+=`/${Math.round(G)}`),H}const Ep={linearity:.3,easing:i.eS(0,0,.3,1)},Kd=Object.assign({deceleration:2500,maxSpeed:1400},Ep),Zw=Object.assign({deceleration:20,maxSpeed:1400},Ep),oc=Object.assign({deceleration:1e3,maxSpeed:360},Ep),Xw=Object.assign({deceleration:1e3,maxSpeed:90},Ep);class R_{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.o.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,h=i.o.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:P}of this._inertiaBuffer)h.zoom+=P.zoomDelta||0,h.bearing+=P.bearingDelta||0,h.pitch+=P.pitchDelta||0,P.panDelta&&h.pan._add(P.panDelta),P.around&&(h.around=P.around),P.pinchAround&&(h.pinchAround=P.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(h.pan.mag()){const P=Ap(h.pan.mag(),v,Object.assign({},Kd,s||{}));w.offset=h.pan.mult(P.amount/h.pan.mag()),w.center=this._map.transform.center,Tp(w,P)}if(h.zoom){const P=Ap(h.zoom,v,Zw);w.zoom=this._map.transform.zoom+P.amount,Tp(w,P)}if(h.bearing){const P=Ap(h.bearing,v,oc);w.bearing=this._map.transform.bearing+i.aA(P.amount,-179,179),Tp(w,P)}if(h.pitch){const P=Ap(h.pitch,v,Xw);w.pitch=this._map.transform.pitch+P.amount,Tp(w,P)}if(w.zoom||w.bearing){const P=h.pinchAround===void 0?h.around:h.pinchAround;w.around=P?this._map.unproject(P):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function Tp(y,s){(!y.duration||y.duration<s.duration)&&(y.duration=s.duration,y.easing=s.easing)}function Ap(y,s,h){const{maxSpeed:v,linearity:w,deceleration:P}=h,O=i.aA(y*w/(s/1e3),-v,v),L=Math.abs(O)/(P*w);return{easing:h.easing,duration:1e3*L,amount:O*(L/2)}}class Gi extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,v,w={}){const P=te(h.getCanvasContainer(),v),O=h.unproject(P);super(s,Object.assign({point:P,lngLat:O,originalEvent:v},w)),this._defaultPrevented=!1,this.target=h}}class Pp extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,v){const w=s==="touchend"?v.changedTouches:v.touches,P=ae(h.getCanvasContainer(),w),O=P.map(z=>h.unproject(z)),L=P.reduce((z,G,H,Q)=>z.add(G.div(Q.length)),new i.P(0,0));super(s,{points:P,point:L,lngLats:O,lngLat:h.unproject(L),originalEvent:v}),this._defaultPrevented=!1}}class Yw extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h){super("wheel",{originalEvent:h}),this._defaultPrevented=!1}}class Jw{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new Yw(this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new Gi(s.type,this._map,s))}mouseup(s){this._map.fire(new Gi(s.type,this._map,s))}preclick(s){const h=new MouseEvent("preclick",s);this._map.fire(new Gi(h.type,this._map,h))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(s),this._map.fire(new Gi(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new Gi(s.type,this._map,s))}mouseover(s){this._map.fire(new Gi(s.type,this._map,s))}mouseout(s){this._map.fire(new Gi(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Pp(s.type,this._map,s))}touchmove(s){this._map.fire(new Pp(s.type,this._map,s))}touchend(s){this._map.fire(new Pp(s.type,this._map,s))}touchcancel(s){this._map.fire(new Pp(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class tf{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new Gi(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new Gi(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qw{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&s.button===0&&(B(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;const v=h,w=this._startPos,P=this._lastPos;if(!w||!P||P.equals(v)||!this._box&&v.dist(w)<this._clickTolerance)return;this._lastPos=v,this._box||(this._box=I("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const O=Math.min(w.x,v.x),L=Math.max(w.x,v.x),z=Math.min(w.y,v.y),G=Math.max(w.y,v.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${O}px,${z}px)`,this._box.style.width=L-O+"px",this._box.style.height=G-z+"px")})}mouseupWindow(s,h){if(!this._active)return;const v=this._startPos,w=h;if(v&&s.button===0){if(this.reset(),J(),v.x!==w.x||v.y!==w.y)return this._map.fire(new i.z("boxzoomend",{originalEvent:s})),{cameraAnimation:P=>P.fitScreenCoordinates(v,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),U(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new i.z(s,{originalEvent:h}))}}function Yg(y,s){const h={};for(let v=0;v<y.length;v++)h[y[v].identifier]=s[v];return h}class e1{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,h,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),v.length===this.numTouches&&(this.centroid=function(w){const P=new i.P(0,0);for(const O of w)P._add(O);return P.div(w.length)}(h),this.touches=Yg(v,h)))}touchmove(s,h,v){if(this.aborted||!this.centroid)return;const w=Yg(v,h);for(const P in this.touches){const O=w[P];(!O||O.dist(this.touches[P])>30)&&(this.aborted=!0)}}touchend(s,h,v){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),v.length===0){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class Zd{constructor(s){this.singleTap=new e1(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,h,v){this.singleTap.touchstart(s,h,v)}touchmove(s,h,v){this.singleTap.touchmove(s,h,v)}touchend(s,h,v){const w=this.singleTap.touchend(s,h,v);if(w){const P=s.timeStamp-this.lastTime<500,O=!this.lastTap||this.lastTap.dist(w)<30;if(P&&O||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class t1{constructor(){this._zoomIn=new Zd({numTouches:1,numTaps:2}),this._zoomOut=new Zd({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,v){this._zoomIn.touchstart(s,h,v),this._zoomOut.touchstart(s,h,v)}touchmove(s,h,v){this._zoomIn.touchmove(s,h,v),this._zoomOut.touchmove(s,h,v)}touchend(s,h,v){const w=this._zoomIn.touchend(s,h,v),P=this._zoomOut.touchend(s,h,v);return w?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:O.getZoom()+1,around:O.unproject(w)},{originalEvent:s})}):P?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:O.getZoom()-1,around:O.unproject(P)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const j_={0:1,2:2},N_={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Cp{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,h){return!1}_move(s,h){return{}}mousedown(s,h){if(this._lastPoint)return;const v=ne(s);this._correctButton(s,v)&&(this._lastPoint=h,this._eventButton=v)}mousemoveWindow(s,h){const v=this._lastPoint;if(v){if(s.preventDefault(),this._eventButton!=null&&function(w,P){const O=j_[P];return w.buttons===void 0||(w.buttons&O)!==O}(s,this._eventButton))this.reset();else if(this._moved||!(h.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(v,h)}}mouseupWindow(s){this._lastPoint&&ne(s)===this._eventButton&&(this._moved&&J(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class r1 extends Cp{mousedown(s,h){super.mousedown(s,h),this._lastPoint&&(this._active=!0)}_correctButton(s,h){return h===0&&!s.ctrlKey}_move(s,h){return{around:h,panDelta:h.sub(s)}}}class M_ extends Cp{constructor(s){super(s),this._pitchRotateKey=s.pitchRotateKey?N_[s.pitchRotateKey]:void 0}_correctButton(s,h){return this._pitchRotateKey?h===0&&s[this._pitchRotateKey]:h===0&&s.ctrlKey||h===2}_move(s,h){const v=.8*(h.x-s.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(s){this._pitchRotateKey||s.preventDefault()}}class n1 extends Cp{constructor(s){super(s),this._pitchRotateKey=s.pitchRotateKey?N_[s.pitchRotateKey]:void 0}_correctButton(s,h){return this._pitchRotateKey?h===0&&s[this._pitchRotateKey]:h===0&&s.ctrlKey||h===2}_move(s,h){const v=-.5*(h.y-s.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(s){this._pitchRotateKey||s.preventDefault()}}class K2{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),i.aX(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(s,h,v){return this._calculateTransform(s,h,v)}touchmove(s,h,v){if(this._active&&!(v.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(v.length===1&&!i.eT())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,h,v)}}touchend(s,h,v){this._calculateTransform(s,h,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,v){v.length>0&&(this._active=!0);const w=Yg(v,h),P=new i.P(0,0),O=new i.P(0,0);let L=0;for(const G in w){const H=w[G],Q=this._touches[G];Q&&(P._add(H),O._add(H.sub(Q)),L++,w[G]=H)}if(this._touches=w,L<this._minTouches||!O.mag())return;const z=O.div(L);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:P.div(L),panDelta:z}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=I("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class D_{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,h,v){return{}}touchstart(s,h,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,v){const w=this._firstTwoTouches;if(!w)return;s.preventDefault();const[P,O]=w,L=Jg(v,h,P),z=Jg(v,h,O);if(!L||!z)return;const G=this._aroundCenter?null:L.add(z).div(2);return this._move([L,z],G,s)}touchend(s,h,v){if(!this._firstTwoTouches)return;const[w,P]=this._firstTwoTouches,O=Jg(v,h,w),L=Jg(v,h,P);O&&L||(this._active&&J(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Jg(y,s,h){for(let v=0;v<y.length;v++)if(y[v].identifier===h)return s[v]}function i1(y,s){return Math.log2(y/s)}class Z2 extends D_{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){const v=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(i1(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:i1(this._distance,v),pinchAround:h}}}function a1(y,s){return 180*y.angleWith(s)/Math.PI}class X2 extends D_{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){const v=this._vector;if(this._vector=s[0].sub(s[1]),v&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:a1(this._vector,v),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const h=25/(Math.PI*this._minDiameter)*360,v=this._startVector;if(!v)return!1;const w=a1(s,v);return Math.abs(w)<h}}function L_(y){return Math.abs(y.y)>Math.abs(y.x)}class Y2 extends D_{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,L_(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,v){const w=this._lastPoints;if(!w)return;const P=s[0].sub(w[0]),O=s[1].sub(w[1]);return this._map._cooperativeGestures&&!i.eT()&&v.touches.length<3||(this._valid=this.gestureBeginsVertically(P,O,v.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(P.y+O.y)/2*-.5})}gestureBeginsVertically(s,h,v){if(this._valid!==void 0)return this._valid;const w=s.mag()>=2,P=h.mag()>=2;if(!w&&!P)return;if(!w||!P)return this._firstMove==null&&(this._firstMove=v),v-this._firstMove<100&&void 0;const O=s.y>0==h.y>0;return L_(s)&&L_(h)&&O}}const J2={panStep:100,bearingStep:15,pitchStep:10};class Q2{constructor(){const s=J2;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,v=0,w=0,P=0,O=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?v=-1:(s.preventDefault(),P=-1);break;case 39:s.shiftKey?v=1:(s.preventDefault(),P=1);break;case 38:s.shiftKey?w=1:(s.preventDefault(),O=-1);break;case 40:s.shiftKey?w=-1:(s.preventDefault(),O=1);break;default:return}return this._rotationDisabled&&(v=0,w=0),{cameraAnimation:L=>{const z=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:eA,zoom:h?Math.round(z)+h*(s.shiftKey?2:1):z,bearing:L.getBearing()+v*this._bearingStep,pitch:L.getPitch()+w*this._pitchStep,offset:[-P*this._panStep,-O*this._panStep],center:L.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function eA(y){return y*(2-y)}const tA=4.000244140625,xj=1/450;class bj{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=xj,i.aX(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||i.eT()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const v=i.o.now(),w=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,h!==0&&h%tA==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=h,this._timeout=window.setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(w*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=te(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;this._type==="wheel"&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){const G=this._type==="wheel"&&Math.abs(this._delta)>tA?this._wheelZoomRate:this._defaultZoomRate;let H=2/(1+Math.exp(-Math.abs(this._delta*G)));this._delta<0&&H!==0&&(H=1/H);const Q=h(),K=Math.pow(2,Q),re=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):K;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(re*H))),this._type==="wheel"&&(this._startZoom=Q,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const v=typeof this._targetZoom=="number"?this._targetZoom:h(),w=this._startZoom,P=this._easing;let O,L=!1;if(this._type==="wheel"&&w&&P){const G=Math.min((i.o.now()-this._lastWheelEventTime)/200,1),H=P(G);O=i.ak(w,v,H),G<1?this._frameId||(this._frameId=!0):L=!0}else O=v,L=!0;this._active=!0,L&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let z=O-h();return z*this._lastDelta<0&&(z=0),{noInertia:!0,needsRenderFrame:!L,zoomDelta:z,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=i.eU;if(this._prevEase){const v=this._prevEase,w=(i.o.now()-v.start)/v.duration,P=v.easing(w+.01)-v.easing(w),O=.27/Math.sqrt(P*P+1e-4)*.01,L=Math.sqrt(.0729-O*O);h=i.eS(O,L,.25,1)}return this._prevEase={start:i.o.now(),duration:s,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=I("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class ta{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class rA{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,h){return s.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(s.shiftKey?-1:1),around:v.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wj{constructor(){this._tap=new Zd({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,h,v){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=h[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(s,h,v))}touchmove(s,h,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const w=h[0],P=w.y-this._swipePoint.y;return this._swipePoint=w,s.preventDefault(),this._active=!0,{zoomDelta:P/128}}}else this._tap.touchmove(s,h,v)}touchend(s,h,v){this._tapTime?this._swipePoint&&v.length===0&&this.reset():this._tap.touchend(s,h,v)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sj{constructor(s,h,v){this._el=s,this._mousePan=h,this._touchPan=v}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ej{constructor(s,h,v){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Qg{constructor(s,h,v,w){this._el=s,this._touchZoom=h,this._touchRotate=v,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ey=y=>y.zoom||y.drag||y.pitch||y.rotate;class o1 extends i.z{}class F_{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,h){const v=i.av([],h,s);this.radius=i.ag(v[2]<0?i.eW([],v,this.constants):[v[0],v[1],0])}projectRay(s){i.eW(s,s,this.constants),i.aw(s,s),i.eX(s,s,this.constants);const h=i.c4([],s,this.radius);if(h[2]>0){const v=i.c4([],[0,0,1],i.bI(h,[0,0,1])),w=i.c4([],i.aw([],[h[0],h[1],0]),this.radius),P=i.d7([],h,i.c4([],i.av([],i.d7([],w,v),h),2));h[0]=P[0],h[1]=P[1]}return h}}function sc(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class z_{constructor(s,h){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new R_(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new F_,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),i.aX(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[window,"blur",void 0]];for(const[w,P,O]of this._listeners){const L=w===document?this.handleWindowEvent:this.handleEvent;w.addEventListener(P,L,O)}}destroy(){for(const[s,h,v]of this._listeners){const w=s===document?this.handleWindowEvent:this.handleEvent;s.removeEventListener(h,w,v)}}_addDefaultHandlers(s){const h=this._map,v=h.getCanvasContainer();this._add("mapEvent",new Jw(h,s));const w=h.boxZoom=new Qw(h,s);this._add("boxZoom",w);const P=new t1,O=new rA;h.doubleClickZoom=new ta(O,P),this._add("tapZoom",P),this._add("clickZoom",O);const L=new wj;this._add("tapDragZoom",L);const z=h.touchPitch=new Y2(h);this._add("touchPitch",z);const G=new M_(s),H=new n1(s);h.dragRotate=new Ej(s,G,H),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);const Q=new r1(s),K=new K2(h,s);h.dragPan=new Sj(v,Q,K),this._add("mousePan",Q),this._add("touchPan",K,["touchZoom","touchRotate"]);const re=new X2,le=new Z2;h.touchZoomRotate=new Qg(v,le,re,L),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",le,["touchPan","touchRotate"]),this._add("blockableMapEvent",new tf(h));const ue=h.scrollZoom=new bj(h,this);this._add("scrollZoom",ue,["mousePan"]);const _e=h.keyboard=new Q2;this._add("keyboard",_e);for(const ge of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[ge]&&h[ge].enable(s[ge])}_add(s,h,v){this._handlers.push({handlerName:s,handler:h,allowed:v}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ey(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,h,v){for(const w in s)if(w!==v&&(!h||h.indexOf(w)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const h=[];for(const v of s)this._el.contains(v.target)&&h.push(v);return h}handleEvent(s,h){this._updatingCamera=!0;const v=s.type==="renderFrame",w=v?void 0:s,P={needsRenderFrame:!1},O={},L={},z=s.touches?this._getMapTouches(s.touches):void 0,G=z?ae(this._el,z):v?void 0:te(this._el,s);for(const{handlerName:K,handler:re,allowed:le}of this._handlers){if(!re.isEnabled())continue;let ue;this._blockedByActive(L,le,K)?re.reset():re[h||s.type]&&(ue=re[h||s.type](s,G,z),this.mergeHandlerResult(P,O,ue,K,w),ue&&ue.needsRenderFrame&&this._triggerRenderFrame()),(ue||re.isActive())&&(L[K]=re)}const H={};for(const K in this._previousActiveHandlers)L[K]||(H[K]=w);this._previousActiveHandlers=L,(Object.keys(H).length||sc(P))&&(this._changes.push([P,O,H]),this._triggerRenderFrame()),(Object.keys(L).length||sc(P))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Q}=P;Q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Q(this._map))}mergeHandlerResult(s,h,v,w,P){if(!v)return;Object.assign(s,v);const O={handlerName:w,originalEvent:v.originalEvent||P};v.zoomDelta!==void 0&&(h.zoom=O),v.panDelta!==void 0&&(h.drag=O),v.pitchDelta!==void 0&&(h.pitch=O),v.bearingDelta!==void 0&&(h.rotate=O)}_applyChanges(){const s={},h={},v={};for(const[w,P,O]of this._changes)w.panDelta&&(s.panDelta=(s.panDelta||new i.P(0,0))._add(w.panDelta)),w.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+w.pitchDelta),w.around!==void 0&&(s.around=w.around),w.aroundCoord!==void 0&&(s.aroundCoord=w.aroundCoord),w.pinchAround!==void 0&&(s.pinchAround=w.pinchAround),w.noInertia&&(s.noInertia=w.noInertia),Object.assign(h,P),Object.assign(v,O);this._updateMapTransform(s,h,v),this._changes=[]}_updateMapTransform(s,h,v){const w=this._map,P=w.transform,O=Se=>[Se.x,Se.y,Se.z];if((Se=>{const ke=this._eventsInProgress.drag;return ke&&!this._handlersById[ke.handlerName].isActive()})()&&!sc(s)){const Se=P.zoom;P.cameraElevationReference="sea",this._originalZoom!=null&&P._orthographicProjectionAtLowPitch&&P.projection.name!=="globe"&&P.pitch===0?(P.cameraElevationReference="ground",P.zoom=this._originalZoom):(P.recenterOnTerrain(),P.cameraElevationReference="ground"),Se!==P.zoom&&this._map._update(!0)}if(P._isCameraConstrained&&w._stop(!0),!sc(s))return void this._fireEvents(h,v,!0);let{panDelta:L,zoomDelta:z,bearingDelta:G,pitchDelta:H,around:Q,aroundCoord:K,pinchAround:re}=s;P._isCameraConstrained&&(z>0&&(z=0),P._isCameraConstrained=!1),re!==void 0&&(Q=re),(z||(Se=>h[Se]&&!this._eventsInProgress[Se])("drag"))&&Q&&(this._dragOrigin=O(P.pointCoordinate3D(Q)),this._originalZoom=P.zoom,this._trackingEllipsoid.setup(P._camera.position,this._dragOrigin)),P.cameraElevationReference="sea",w._stop(!0),Q=Q||w.transform.centerPoint,G&&(P.bearing+=G),H&&(P.pitch+=H),P._updateCameraState();const le=[0,0,0];if(L)if(P.projection.name==="mercator"){const Se=this._trackingEllipsoid.projectRay(P.screenPointToMercatorRay(Q).dir),ke=this._trackingEllipsoid.projectRay(P.screenPointToMercatorRay(Q.sub(L)).dir);le[0]=ke[0]-Se[0],le[1]=ke[1]-Se[1]}else{const Se=P.pointCoordinate(Q);if(P.projection.name==="globe"){L=L.rotate(-P.angle);const ke=P._pixelsPerMercatorPixel/P.worldSize;le[0]=-L.x*i.eV(i.a_(Se.y))*ke,le[1]=-L.y*i.eV(P.center.lat)*ke}else{const ke=P.pointCoordinate(Q.sub(L));Se&&ke&&(le[0]=ke.x-Se.x,le[1]=ke.y-Se.y)}}const ue=P.zoom,_e=[0,0,0];if(z){const Se=O(K||P.pointCoordinate3D(Q)),ke={dir:i.aw([],i.av([],Se,P._camera.position))};if(ke.dir[2]<0){const Te=P.zoomDeltaToMovement(Se,z);i.c4(_e,ke.dir,Te)}}const ge=i.d7(le,le,_e);P._translateCameraConstrained(ge),z&&Math.abs(P.zoom-ue)>1e-4&&P.recenterOnTerrain(),P.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,v,!0)}_fireEvents(s,h,v){const w=ey(this._eventsInProgress),P=ey(s),O={};for(const H in s){const{originalEvent:Q}=s[H];this._eventsInProgress[H]||(O[`${H}start`]=Q),this._eventsInProgress[H]=s[H]}!w&&P&&this._fireEvent("movestart",P.originalEvent);for(const H in O)this._fireEvent(H,O[H]);P&&this._fireEvent("move",P.originalEvent);for(const H in s){const{originalEvent:Q}=s[H];this._fireEvent(H,Q)}const L={};let z;for(const H in this._eventsInProgress){const{handlerName:Q,originalEvent:K}=this._eventsInProgress[H];this._handlersById[Q].isActive()||(delete this._eventsInProgress[H],z=h[Q]||K,L[`${H}end`]=z)}for(const H in L)this._fireEvent(H,L[H]);const G=ey(this._eventsInProgress);if(v&&(w||P)&&!G){this._updatingCamera=!0;const H=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Q=K=>K!==0&&-this._bearingSnap<K&&K<this._bearingSnap;H?(Q(H.bearing||this._map.getBearing())&&(H.bearing=0),this._map.easeTo(H,{originalEvent:z})):(this._map.fire(new i.z("moveend",{originalEvent:z})),Q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new i.z(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new o1("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ia="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class cu extends i.E{constructor(s,h){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,i.aX(["_renderFrameCallback"],this)}getCenter(){return new i.aS(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,v){return s=i.P.convert(s).mult(-1),this.panTo(this.transform.center,Object.assign({offset:s},h),v)}panTo(s,h,v){return this.easeTo(Object.assign({center:s},h),v)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,v){return this.easeTo(Object.assign({zoom:s},h),v)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,v){return this.easeTo(Object.assign({bearing:s},h),v)}resetNorth(s,h){return this.rotateTo(0,Object.assign({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=i.aI.convert(s);const v=h&&h.bearing||0,w=h&&h.pitch||0,P=s.getNorthWest(),O=s.getSouthEast();return this._cameraForBounds(this.transform,P,O,v,w,h)}_extendPadding(s){const h={top:0,right:0,bottom:0,left:0};return s==null?Object.assign({},h,this.transform.padding):typeof s=="number"?{top:s,bottom:s,right:s,left:s}:Object.assign({},h,s)}_extendCameraOptions(s){return(s=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=this._extendPadding(s.padding),s}_minimumAABBFrustumDistance(s,h){const v=h.max[0]-h.min[0],w=h.max[1]-h.min[1];return v/w>s.aspect?v/(2*Math.tan(.5*s.fovX)*s.aspect):w/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,h,v,w,P,O){const L=s.clone(),z=this._extendCameraOptions(O);L.bearing=w,L.pitch=P;const G=i.aS.convert(h),H=i.aS.convert(v),Q=.5*(G.lat+H.lat),K=.5*(G.lng+H.lng),re=i.eY(Q,K),le=i.aw([],re),ue=i.aw([],i.bH([],le,[0,1,0])),_e=i.bH([],ue,le),ge=[ue[0],ue[1],ue[2],0,_e[0],_e[1],_e[2],0,le[0],le[1],le[2],0,0,0,0,1],Se=[re,i.eY(G.lat,G.lng),i.eY(H.lat,G.lng),i.eY(H.lat,H.lng),i.eY(G.lat,H.lng),i.eY(Q,G.lng),i.eY(Q,H.lng),i.eY(G.lat,K),i.eY(H.lat,K)];let ke=i.d8.fromPoints(Se.map(gt=>[i.bI(ue,gt),i.bI(_e,gt),i.bI(le,gt)]));const Te=i.af([],ke.center,ge);i.eZ(Te)===0&&i.e_(Te,0,0,1),i.aw(Te,Te),i.c4(Te,Te,i.aD),L.center=i.e$(Te);const $e=L.getWorldToCameraMatrix(),Re=i.bk(new Float64Array(16),$e);ke=i.d8.applyTransform(ke,i.aB([],$e,ge));const Ve=this._extendAABB(ke,L,z,w);if(!Ve)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ke=Ve,i.af(Te,Te,$e);const Be=.5*(ke.max[2]-ke.min[2]),De=this._minimumAABBFrustumDistance(L,ke),We=i.c4([],[0,0,1],Be),lt=i.d7(We,Te,We),it=De+(L.pitch===0?0:i.bF(Te,lt)),bt=L.globeCenterInViewSpace,mt=i.av([],Te,[bt[0],bt[1],bt[2]]);i.aw(mt,mt),i.c4(mt,mt,it);const Ot=i.d7([],Te,mt);i.af(Ot,Ot,Re);const Zt=i.eL/i.aD,pt=i.ag(Ot),et=i.ce(Math.max(pt*Zt-i.eL,Number.EPSILON),0),kt=Math.min(L.zoomFromMercatorZAdjusted(et),z.maxZoom);return kt>.5*(i.cZ+i.cK)?(L.setProjection({name:"mercator"}),L.zoom=kt,this._cameraForBounds(L,h,v,w,P,O)):{center:L.center,zoom:kt,bearing:w,pitch:P}}_extendAABB(s,h,v,w){const P=.5*((v.padding.left||0)+(v.padding.right||0)),O=.5*((v.padding.top||0)+(v.padding.bottom||0)),L=O,z=P,G=P,H=O,Q=h.width-(z+G),K=h.height-(L+H),re=i.av([],s.max,s.min),le=Math.min(Q/re[0],K/re[1]),ue=Math.min(h.scaleZoom(h.scale*le),v.maxZoom);if(isNaN(ue))return null;const _e=h.scale/h.zoomScale(ue),ge=new i.d8([s.min[0]-z*_e,s.min[1]-H*_e,s.min[2]],[s.max[0]+G*_e,s.max[1]+L*_e,s.max[2]]),Se=(typeof v.offset.x=="number"&&typeof v.offset.y=="number"?new i.P(v.offset.x,v.offset.y):i.P.convert(v.offset)).rotate(-i.an(w));return ge.center[0]-=Se.x*_e,ge.center[1]+=Se.y*_e,ge}queryTerrainElevation(s,h){const v=this.transform.elevation;return v?(h=Object.assign({},{exaggerated:!0},h),v.getAtPoint(i.ae.fromLngLat(s),null,h.exaggerated)):null}_cameraForBounds(s,h,v,w,P,O){if(s.projection.name==="globe")return this._cameraForBoundsOnGlobe(s,h,v,w,P,O);const L=s.clone(),z=this._extendCameraOptions(O);L.bearing=w,L.pitch=P;const G=i.aS.convert(h),H=i.aS.convert(v),Q=new i.aS(G.lng,H.lat),K=new i.aS(H.lng,G.lat),re=L.project(G),le=L.project(H),ue=this.queryTerrainElevation(G),_e=this.queryTerrainElevation(H),ge=this.queryTerrainElevation(Q),Se=this.queryTerrainElevation(K),ke=[[re.x,re.y,Math.min(ue||0,_e||0,ge||0,Se||0)],[le.x,le.y,Math.max(ue||0,_e||0,ge||0,Se||0)]];let Te=i.d8.fromPoints(ke);const $e=L.getWorldToCameraMatrix(),Re=i.bk(new Float64Array(16),$e);Te=i.d8.applyTransform(Te,$e);const Ve=this._extendAABB(Te,L,z,w);if(!Ve)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Te=Ve;const Be=.5*i.av([],Te.max,Te.min)[2],De=this._minimumAABBFrustumDistance(L,Te),We=[0,0,1,0];i.aC(We,We,$e),i.f0(We,We);const lt=i.c4([],We,De+Be),it=i.d7([],Te.center,lt);i.af(Te.center,Te.center,Re),i.af(it,it,Re);const bt=L.unproject(new i.P(Te.center[0],Te.center[1])),mt=i.f1(L.projection,bt),Ot=Math.pow(2,mt),Zt=Math.min(L._zoomFromMercatorZ(it[2]*L.pixelsPerMeter*Ot/L.worldSize),z.maxZoom);return L.mercatorFromTransition&&Zt<.5*(i.cZ+i.cK)?(L.setProjection({name:"globe"}),L.zoom=Zt,this._cameraForBounds(L,h,v,w,P,O)):{center:bt,zoom:Zt,bearing:w,pitch:P}}fitBounds(s,h,v){const w=this.cameraForBounds(s,h);return this._fitInternal(w,h,v)}fitScreenCoordinates(s,h,v,w,P){const O=i.P.convert(s),L=i.P.convert(h),z=new i.P(Math.min(O.x,L.x),Math.min(O.y,L.y)),G=new i.P(Math.max(O.x,L.x),Math.max(O.y,L.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(O,L))return this;const H=this.transform.pointLocation3D(z),Q=this.transform.pointLocation3D(G),K=this.transform.pointLocation3D(new i.P(z.x,G.y)),re=this.transform.pointLocation3D(new i.P(G.x,z.y)),le=[Math.min(H.lng,Q.lng,K.lng,re.lng),Math.min(H.lat,Q.lat,K.lat,re.lat)],ue=[Math.max(H.lng,Q.lng,K.lng,re.lng),Math.max(H.lat,Q.lat,K.lat,re.lat)],_e=w&&w.pitch?w.pitch:this.getPitch(),ge=this._cameraForBounds(this.transform,le,ue,v,_e,w);return this._fitInternal(ge,w,P)}_fitInternal(s,h,v){return s?(h=Object.assign(s,h)).linear?this.easeTo(h,v):this.flyTo(h,v):this}jumpTo(s,h){this.stop();const v=s.preloadOnly?this.transform.clone():this.transform;let w=!1,P=!1,O=!1;"zoom"in s&&v.zoom!==+s.zoom&&(w=!0,v.zoom=+s.zoom),s.center!==void 0&&(v.center=i.aS.convert(s.center)),"bearing"in s&&v.bearing!==+s.bearing&&(P=!0,v.bearing=+s.bearing),"pitch"in s&&v.pitch!==+s.pitch&&(O=!0,v.pitch=+s.pitch);const L=typeof s.padding=="number"?this._extendPadding(s.padding):s.padding;if(s.padding!=null&&!v.isPaddingEqual(L))if(s.retainPadding===!1){const z=v.clone();z.padding=L,v.setLocationAtPoint(v.center,z.centerPoint)}else v.padding=L;return s.preloadOnly?(this._preloadTiles(v),this):(this.fire(new i.z("movestart",h)).fire(new i.z("move",h)),w&&this.fire(new i.z("zoomstart",h)).fire(new i.z("zoom",h)).fire(new i.z("zoomend",h)),P&&this.fire(new i.z("rotatestart",h)).fire(new i.z("rotate",h)).fire(new i.z("rotateend",h)),O&&this.fire(new i.z("pitchstart",h)).fire(new i.z("pitch",h)).fire(new i.z("pitchend",h)),this.fire(new i.z("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(Ia),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,h){const v=this.transform;if(!v.projection.supportsFreeCamera)return i.w(Ia),this;this.stop();const w=v.zoom,P=v.pitch,O=v.bearing;v.setFreeCameraOptions(s);const L=w!==v.zoom,z=P!==v.pitch,G=O!==v.bearing;return this.fire(new i.z("movestart",h)).fire(new i.z("move",h)),L&&this.fire(new i.z("zoomstart",h)).fire(new i.z("zoom",h)).fire(new i.z("zoomend",h)),G&&this.fire(new i.z("rotatestart",h)).fire(new i.z("rotate",h)).fire(new i.z("rotateend",h)),z&&this.fire(new i.z("pitchstart",h)).fire(new i.z("pitch",h)).fire(new i.z("pitchend",h)),this.fire(new i.z("moveend",h)),this}easeTo(s,h){this._stop(!1,s.easeId),((s=Object.assign({offset:[0,0],duration:500,easing:i.eU},s)).animate===!1||this._prefersReducedMotion(s))&&(s.duration=0);const v=this.transform,w=this.getZoom(),P=this.getBearing(),O=this.getPitch(),L=this.getPadding(),z="zoom"in s?+s.zoom:w,G="bearing"in s?this._normalizeBearing(s.bearing,P):P,H="pitch"in s?+s.pitch:O,Q=this._extendPadding(s.padding),K=i.P.convert(s.offset);let re,le,ue;if(v.projection.name==="globe"){const We=i.ae.fromLngLat(v.center),lt=K.rotate(-v.angle);We.x+=lt.x/v.worldSize,We.y+=lt.y/v.worldSize;const it=We.toLngLat(),bt=i.aS.convert(s.center||it);this._normalizeCenter(bt),re=v.centerPoint.add(lt),le=new i.P(We.x,We.y).mult(v.worldSize),ue=new i.P(i.aF(bt.lng),i.aJ(bt.lat)).mult(v.worldSize).sub(le)}else{re=v.centerPoint.add(K);const We=v.pointLocation(re),lt=i.aS.convert(s.center||We);this._normalizeCenter(lt),le=v.project(We),ue=v.project(lt).sub(le)}const _e=v.zoomScale(z-w);let ge,Se;s.around&&(ge=i.aS.convert(s.around),Se=v.locationPoint(ge));const ke=this._zooming||z!==w,Te=this._rotating||P!==G,$e=this._pitching||H!==O,Re=!v.isPaddingEqual(Q),Ve=s.retainPadding===!1?v.clone():v,Be=We=>lt=>{if(ke&&(We.zoom=i.ak(w,z,lt)),Te&&(We.bearing=i.ak(P,G,lt)),$e&&(We.pitch=i.ak(O,H,lt)),Re&&(Ve.interpolatePadding(L,Q,lt),re=Ve.centerPoint.add(K)),ge)We.setLocationAtPoint(ge,Se);else{const it=We.zoomScale(We.zoom-w),bt=z>w?Math.min(2,_e):Math.max(.5,_e),mt=Math.pow(bt,1-lt),Ot=We.unproject(le.add(ue.mult(lt*mt)).mult(it));We.setLocationAtPoint(We.renderWorldCopies?Ot.wrap():Ot,re)}return s.preloadOnly||this._fireMoveEvents(h),We};if(s.preloadOnly){const We=this._emulate(Be,s.duration,v);return this._preloadTiles(We),this}const De={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ke,this._rotating=Te,this._pitching=$e,this._padding=Re,this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,De),this._ease(Be(v),We=>{v.cameraElevationReference==="sea"&&v.recenterOnTerrain(),this._afterEase(h,We)},s),this}_prepareEase(s,h,v={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),h||v.moving||this.fire(new i.z("movestart",s)),this._zooming&&!v.zooming&&this.fire(new i.z("zoomstart",s)),this._rotating&&!v.rotating&&this.fire(new i.z("rotatestart",s)),this._pitching&&!v.pitching&&this.fire(new i.z("pitchstart",s))}_fireMoveEvents(s){this.fire(new i.z("move",s)),this._zooming&&this.fire(new i.z("zoom",s)),this._rotating&&this.fire(new i.z("rotate",s)),this._pitching&&this.fire(new i.z("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const v=this._zooming,w=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,v&&this.fire(new i.z("zoomend",s)),w&&this.fire(new i.z("rotateend",s)),P&&this.fire(new i.z("pitchend",s)),this.fire(new i.z("moveend",s))}flyTo(s,h){if(this._prefersReducedMotion(s)){const gt=i.aH(s,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(gt,h)}this.stop(),s=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:i.eU},s);const v=this.transform,w=this.getZoom(),P=this.getBearing(),O=this.getPitch(),L=this.getPadding(),z="zoom"in s?i.aA(+s.zoom,v.minZoom,v.maxZoom):w,G="bearing"in s?this._normalizeBearing(s.bearing,P):P,H="pitch"in s?+s.pitch:O,Q=this._extendPadding(s.padding),K=v.zoomScale(z-w),re=i.P.convert(s.offset);let le=v.centerPoint.add(re);const ue=v.pointLocation(le),_e=i.aS.convert(s.center||ue);this._normalizeCenter(_e);const ge=v.project(ue),Se=v.project(_e).sub(ge);let ke=s.curve;const Te=Math.max(v.width,v.height),$e=Te/K,Re=Se.mag();if("minZoom"in s){const gt=i.aA(Math.min(s.minZoom,w,z),v.minZoom,v.maxZoom),Lt=Te/v.zoomScale(gt-w);ke=Math.sqrt(Lt/Re*2)}const Ve=ke*ke;function Be(gt){const Lt=($e*$e-Te*Te+(gt?-1:1)*Ve*Ve*Re*Re)/(2*(gt?$e:Te)*Ve*Re);return Math.log(Math.sqrt(Lt*Lt+1)-Lt)}function De(gt){return(Math.exp(gt)-Math.exp(-gt))/2}function We(gt){return(Math.exp(gt)+Math.exp(-gt))/2}const lt=Be(0);let it=function(gt){return We(lt)/We(lt+ke*gt)},bt=function(gt){return Te*((We(lt)*(De(Lt=lt+ke*gt)/We(Lt))-De(lt))/Ve)/Re;var Lt},mt=(Be(1)-lt)/ke;if(Math.abs(Re)<1e-6||!isFinite(mt)){if(Math.abs(Te-$e)<1e-6)return this.easeTo(s,h);const gt=$e<Te?-1:1;mt=Math.abs(Math.log($e/Te))/ke,bt=function(){return 0},it=function(Lt){return Math.exp(gt*ke*Lt)}}s.duration="duration"in s?+s.duration:1e3*mt/("screenSpeed"in s?+s.screenSpeed/ke:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);const Ot=P!==G,Zt=H!==O,pt=!v.isPaddingEqual(Q),et=s.retainPadding===!1?v.clone():v,kt=gt=>Lt=>{const Qt=Lt*mt,vr=1/it(Qt);gt.zoom=Lt===1?z:w+gt.scaleZoom(vr),Ot&&(gt.bearing=i.ak(P,G,Lt)),Zt&&(gt.pitch=i.ak(O,H,Lt)),pt&&(et.interpolatePadding(L,Q,Lt),le=et.centerPoint.add(re));const Gt=Lt===1?_e:gt.unproject(ge.add(Se.mult(bt(Qt))).mult(vr));return gt.setLocationAtPoint(gt.renderWorldCopies?Gt.wrap():Gt,le),gt._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(h),gt};if(s.preloadOnly){const gt=this._emulate(kt,s.duration,v);return this._preloadTiles(gt),this}return this._zooming=!0,this._rotating=Ot,this._pitching=Zt,this._padding=pt,this._prepareEase(h,!1),this._ease(kt(v),()=>this._afterEase(h),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(s){}_cancelRenderFrame(s){}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const v=this._onEaseEnd;this._onEaseEnd=void 0,v.call(this,h)}if(!s){const v=this.handlers;v&&v.stop(!1)}return this}_ease(s,h,v){v.animate===!1||v.duration===0?(s(1),h()):(this._easeStart=i.o.now(),this._easeOptions=v,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((i.o.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,h){s=i.bS(s,-180,180);const v=Math.abs(s-h);return Math.abs(s-360-h)<v&&(s-=360),Math.abs(s+360-h)<v&&(s+=360),s}_normalizeCenter(s){const h=this.transform;if(h.maxBounds||h.projection.name!=="globe"&&!h.renderWorldCopies)return;const v=s.lng-h.center.lng;s.lng+=v>180?-360:v<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&i.o.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,h,v){const w=Math.ceil(15*h/1e3),P=[],O=s(v.clone());for(let L=0;L<=w;L++){const z=O(L/w);P.push(z.clone())}return P}_preloadTiles(s,h){}}class Op{constructor(s={}){this.options=s,i.aX(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const h=this.options&&this.options.compact,v=s._getUIString("AttributionControl.ToggleAttribution");this._map=s,this._container=I("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=I("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",v);const w=I("span","mapboxgl-ctrl-icon",this._compactButton);return w.setAttribute("aria-hidden","true"),w.setAttribute("title",v),this._innerContainer=I("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(s){const v=h.reduce((w,P,O)=>(P.value&&(w+=`${P.key}=${P.value}${O<h.length-1?"&":""}`),w),"?");s.href=`${i.e.FEEDBACK_URL}/${v}#${I_(this._map,!0)}`,s.rel="noopener nofollow"}}_updateData(s){!s||(s.dataType!=="source"||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility")&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const h=this._map.style._mergedSourceCaches;for(const w in h){const P=h[w];if(P.used){const O=P.getSource();O.attribution&&s.indexOf(O.attribution)<0&&s.push(O.attribution)}}s.sort((w,P)=>w.length-P.length),s=s.filter((w,P)=>{for(let O=P+1;O<s.length;O++)if(s[O].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));const v=s.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,s.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ty{constructor(){i.aX(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=I("div","mapboxgl-ctrl");const h=I("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(const h in s){const v=s[h].getSource();if(v.hasOwnProperty("mapbox_logo")&&!v.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const h=s[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class s1{constructor(){i.aX(["_onIndoorUpdate"],this)}onAdd(s){return this._map=s,this._container=I("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",h=>this._onIndoorUpdate(h)),this._container}_createButton(s,h){const v=I("button",s,this._container);return v.type="button",v.addEventListener("click",h),v}_createSeparator(){return I("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(s,h){this._map&&(s.setAttribute("aria-label",h),s.textContent=h)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(s){if(!s||!s.floors)return this._model=s,void(this._container.style.display="none");const h=this._model;this._model=s,this._container.style.display="inline-block",this._container.style.borderRadius="8px",h&&Array.from(this._container.children).forEach(v=>v.remove()),s.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(s.floors,s.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const s=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const h=this._map;this._model&&h&&h._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});I("span","mapboxgl-ctrl-icon",s).setAttribute("aria-hidden","true"),s.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&s.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(s),this._createSeparator()}_updateBuildingsButtonState(){const s=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");s&&this._model&&(this._model.activeFloorsVisible?s.classList.remove("mapboxgl-ctrl-level-button-selected"):s.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(s,h){for(let v=0;v<s.length;v++){const w=s[v],P=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(w.id)});this._setButtonTitle(P,w.zIndex.toString()),this._model&&w.id===this._model.selectedFloorId&&h&&P.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(P),v<s.length-1&&this._createSeparator()}}}class nA{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){const h=this._currentlyRunning,v=h?this._queue.concat(h):this._queue;for(const w of v)if(w.id===s)return void(w.cancelled=!0)}run(s=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const v of h)if(!v.cancelled&&(v.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class ry{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const h=i.dC((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,h,v){this._start=this.getValue(h),this._end=s,this._startTime=h,this._endTime=h+v}}const Tj={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class iA extends i.z{constructor(s,h,v,w){const{point:P,lngLat:O,originalEvent:L,target:z}=s;super(s.type,{point:P,lngLat:O,originalEvent:L,target:z}),this.preventDefault=()=>{s.preventDefault()},this.id=h,this.interaction=v,this.feature=w}}class l1{constructor(s){this.map=s,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(s,h){if(this.typeById.has(s))throw new Error(`Interaction id "${s}" already exists.`);const v=h.filter;let w=h.type;v&&this.filters.set(s,i.b5(v)),w==="mouseover"&&(w="mouseenter"),w==="mouseout"&&(w="mouseleave");const P=this.interactionsByType.get(w)||new Map;w==="mouseenter"||w==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(s,h)):P.size===0&&this.map.on(w,this.handleType),P.size===0&&this.interactionsByType.set(w,P),P.set(s,h),this.typeById.set(s,w)}get(s){const h=this.typeById.get(s);if(!h)return;const v=this.interactionsByType.get(h);return v?v.get(s):void 0}remove(s){const h=this.typeById.get(s);if(!h)return;this.typeById.delete(s),this.filters.delete(s);const v=this.interactionsByType.get(h);v&&(v.delete(s),h==="mouseenter"||h==="mouseleave"?(this.delegatedInteractions.delete(s),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):v.size===0&&this.map.off(h,this.handleType))}queryTargets(s,h){const v=[];for(const[w,P]of h)P.target&&v.push({targetId:w,target:P.target,filter:this.filters.get(w)});return this.map.style.queryRenderedTargets(s,v,this.map.transform)}handleMove(s){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const h=this.queryTargets(s.point,Array.from(this.delegatedInteractions).reverse());h.length&&(s.type="mouseenter",this.handleType(s,h));const v=new Map;for(const[w,{feature:P}]of this.prevHoveredFeatures)this.hoveredFeatures.has(w)||v.set(P.id,P);v.size&&(s.type="mouseleave",this.handleType(s,Array.from(v.values())))}handleOut(s){const h=Array.from(this.hoveredFeatures.values()).map(({feature:v})=>v);h.length&&(s.type="mouseleave",this.handleType(s,h)),this.hoveredFeatures.clear()}handleType(s,h){const v=s.type==="mouseenter";if(v&&!this.interactionsByType.has(s.type))return void i.w("mouseenter interaction required for mouseleave to work.");const w=Array.from(this.interactionsByType.get(s.type)).reverse(),P=!!h;h=h||this.queryTargets(s.point,w);let O=!1;const L=new Set;for(const z of h){for(const[G,H]of w){if(!H.target)continue;const Q=z.variants?z.variants[G]:null;if(Q){for(const K of Q){if(Xs(K,z,L,G))continue;const re=new i.dw(z,K),le=Cc(K,z,G);P&&re.id!==void 0&&(re.state=this.map.getFeatureState(re));const ue=v?this.prevHoveredFeatures.get(le):null,_e=new iA(s,G,H,re),ge=ue?ue.stop:H.handler(_e);if(v&&this.hoveredFeatures.set(le,{feature:z,stop:ge}),ge!==!1){O=!0;break}}if(O)break}}if(O)break}if(!O)for(const[z,G]of w){const{handler:H,target:Q}=G;if(!Q&&H(new iA(s,z,G,null))!==!1)break}}}function c1(y,s){if(Array.isArray(y)&&Array.isArray(s)){const h=new Set(y),v=new Set(s);return h.size===v.size&&y.every(w=>v.has(w))}return i.bx(y,s)}const B_={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},$_={showCompass:!0,showZoom:!0,visualizePitch:!1};class ny{constructor(s,h,v=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new M_({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,v&&(this.mousePitch=new n1({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),i.aX(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(s,h){this.mouseRotate.mousedown(s,h),this.mousePitch&&this.mousePitch.mousedown(s,h),B()}move(s,h){const v=this.map,w=this.mouseRotate.mousemoveWindow(s,h),P=w&&w.bearingDelta;if(P&&v.setBearing(v.getBearing()+P),this.mousePitch){const O=this.mousePitch.mousemoveWindow(s,h),L=O&&O.pitchDelta;L&&v.setPitch(v.getPitch()+L)}}off(){const s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){U(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(Object.assign({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),te(this.element,s)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,te(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ae(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=ae(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Zu(y,s,h){if(y=new i.aS(y.lng,y.lat),s){const v=new i.aS(y.lng-360,y.lat),w=new i.aS(y.lng+360,y.lat),P=360*Math.ceil(Math.abs(y.lng-h.center.lng)/360),O=h.locationPoint3D(y).distSqr(s),L=s.x<0||s.y<0||s.x>h.width||s.y>h.height;h.locationPoint3D(v).distSqr(s)<O&&(L||Math.abs(v.lng-h.center.lng)<P)?y=v:h.locationPoint3D(w).distSqr(s)<O&&(L||Math.abs(w.lng-h.center.lng)<P)&&(y=w)}for(;Math.abs(y.lng-h.center.lng)>180;){const v=h.locationPoint3D(y);if(v.x>=0&&v.y>=0&&v.x<=h.width&&v.y<=h.height)break;y.lng>h.center.lng?y.lng-=360:y.lng+=360}return y}const kc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},qo={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Xu extends i.E{constructor(s,h){super(),(s instanceof HTMLElement||h)&&(s=Object.assign({element:s},h)),i.aX(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:v="center",color:w="#3FB1CE",scale:P=1,draggable:O=!1,clickTolerance:L=0,rotation:z=qo.rotation,rotationAlignment:G=qo.rotationAlignment,pitchAlignment:H=qo.pitchAlignment,occludedOpacity:Q=qo.occludedOpacity,altitude:K=qo.altitude}=s||{};this._anchor=v,this._color=w,this._scale=P,this._draggable=O,this._clickTolerance=L,this._rotation=z,this._rotationAlignment=G,this._pitchAlignment=H,this._occludedOpacity=Q,this._altitude=K,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),s&&s.element?(this._element=s.element,this._offset=i.P.convert(s&&s.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(s&&s.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",ue=>{ue.preventDefault()}),this._element.addEventListener("mousedown",ue=>{ue.preventDefault()});const re=this._element.classList;for(const ue in kc)re.remove(`mapboxgl-marker-anchor-${ue}`);re.add(`mapboxgl-marker-anchor-${this._anchor}`);const le=s&&s.className?s.className.trim().split(/\s+/):[];re.add(...le),this._popup=null}_createDefaultMarker(){const s=I("div"),h=j("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},s);if(this._altitude===0){const v=j("radialGradient",{id:"shadowGradient"},j("defs",{},h));j("stop",{offset:"10%","stop-opacity":.4},v),j("stop",{offset:"100%","stop-opacity":.05},v),j("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},h)}return j("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},h),j("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},h),j("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},h),s}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){const s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=i.aS.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(s){return s===this._altitude||(this._defaultMarker&&(this._altitude===0&&s!==0||this._altitude!==0&&s===0)&&(this._element=this._createDefaultMarker()),this._altitude=s||qo.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(38.1-13.5+w)],"bottom-right":[-w,-1*(38.1-13.5+w)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,s._marker=this,s._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const h=s.code,v=s.charCode||s.keyCode;h!=="Space"&&h!=="Enter"&&v!==32&&v!==13||this.togglePopup()}_onMapClick(s){const h=s.originalEvent.target,v=this._element;this._popup&&(h===v||v.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const s=this._map,h=this._pos;if(!s||!h)return!1;const v=s.unproject(h,this._altitude),w=s.getFreeCameraOptions();if(!w.position)return!1;const P=w.position.toLngLat();return P.distanceTo(v)<.9*P.distanceTo(this._lngLat)}_evaluateOpacity(){const s=this._map;if(!s)return;const h=this._pos;if(!h||h.x<0||h.x>s.transform.width||h.y<0||h.y>s.transform.height)return void this._clearFadeTimer();const v=s.unproject(h,this._altitude);let w;s._showingGlobe()&&i.f4(s.transform,this._lngLat)?w=0:(w=1-s._queryFogOpacity(v),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(w*=this._occludedOpacity)),this._element.style.opacity=`${w}`,this._element.style.pointerEvents=w>0?"auto":"none",this._popup&&this._popup._setOpacity(w),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const s=this._pos;if(!s||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${s.x}px,${s.y}px)
            ${kc[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){const s=this._pos,h=this._map,v=this.getPitchAlignment();if(!h||!s||v!=="map")return"";if(!h._showingGlobe()){const z=h.getPitch();return z?`rotateX(${z}deg)`:""}const w=i.cW(i.f5(h.transform,this._lngLat)),P=s.sub(i.f6(h.transform)),O=Math.abs(P.x)+Math.abs(P.y);if(O===0)return"";const L=w/O;return`rotateX(${-P.y*L}deg) rotateY(${P.x*L}deg)`}_calculateZTransform(){const s=this._pos,h=this._map;if(!h||!s)return"";let v=0;const w=this.getRotationAlignment();if(w==="map")if(h._showingGlobe()){const P=h.project(new i.aS(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),O=h.project(new i.aS(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(P);v=i.cW(Math.atan2(O.y,O.x))-90}else v=-h.getBearing();else if(w==="horizon"){const P=i.ah(4,6,h.getZoom()),O=i.f6(h.transform);O.y+=P*h.transform.height;const L=s.sub(O),z=i.cW(Math.atan2(L.y,L.x));v=(z>90?z-270:z+90)*(1-P)}return v+=this._rotation,v?`rotateZ(${v}deg)`:""}_update(s){cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Zu(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat,this._altitude),s===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=i.P.convert(s),this._update(),this}addClassName(s){return this._element.classList.add(s),this}removeClassName(s){return this._element.classList.remove(s),this}toggleClassName(s){return this._element.classList.toggle(s)}_onMove(s){const h=this._map;if(!h)return;const v=this._pointerdownPos,w=this._positionDelta;if(v&&w){if(!this._isDragging){const P=this._clickTolerance||h._clickTolerance;if(s.point.dist(v)<P)return;this._isDragging=!0}this._pos=s.point.sub(w),this._lngLat=h.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.z("dragstart"))),this.fire(new i.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.z("dragend")),this._state="inactive"}_addDragHandler(s){const h=this._map,v=this._pos;h&&v&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(v),this._pointerdownPos=s.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;const h=this._map;return h&&(s?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||qo.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||qo.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||qo.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||qo.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ic={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Aj={maxWidth:100,unit:"metric"},Pj={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Cj={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Oj=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function u1(y=new i.P(0,0),s="bottom"){if(typeof y=="number"){const h=Math.round(Math.sqrt(.5*Math.pow(y,2)));switch(s){case"top":return new i.P(0,y);case"top-left":return new i.P(h,h);case"top-right":return new i.P(-h,h);case"bottom":return new i.P(0,-y);case"bottom-left":return new i.P(h,-h);case"bottom-right":return new i.P(-h,-h);case"left":return new i.P(y,0);case"right":return new i.P(-y,0)}return new i.P(0,0)}return y instanceof i.P||Array.isArray(y)?i.P.convert(y):i.P.convert(y[s]||[0,0])}return{version:g,supported:N.supported,setRTLTextPlugin:i.fa,getRTLTextPluginStatus:i.f9,Map:class extends cu{constructor(y){S.mark(_.create);const s=y;if((y=Object.assign({},B_,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(y.antialias&&i.f2(window)&&(y.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new rp(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies,null,null),y),this._repaint=!!y.repaint,this._interactive=y.interactive,this._minTileCacheSize=y.minTileCacheSize,this._maxTileCacheSize=y.maxTileCacheSize,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=y.crossSourceCollisions,this._collectResourceTiming=y.collectResourceTiming,this._language=this._parseLanguage(y.language),this._worldview=y.worldview,this._renderTaskQueue=new nA,this._domRenderTaskQueue=new nA,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.b1(),this._locale=Object.assign({},Tj,y.locale),this._clickTolerance=y.clickTolerance,this._cooperativeGestures=y.cooperativeGestures,this._performanceMetricsCollection=y.performanceMetricsCollection,this._tessellationStep=y.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=y.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ry(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=y.scaleFactor,this._requestManager=new de(y.transformRequest,y.accessToken,y.testMode),this._silenceAuthErrors=!!y.testMode,this._contextCreateOptions=y.contextCreateOptions?Object.assign({},y.contextCreateOptions):{},typeof y.container=="string"){const h=document.getElementById(y.container);if(!h)throw new Error(`Container '${y.container.toString()}' not found.`);this._container=h}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),y.maxBounds&&this.setMaxBounds(y.maxBounds),this._spriteFormat=y.spriteFormat,i.aX(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new vj),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new z_(this,y),this._localFontFamily=y.localFontFamily,this._localIdeographFontFamily=y.localIdeographFontFamily,(y.style||!y.testMode)&&this.setStyle(y.style||i.e.DEFAULT_STYLE,{config:y.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),y.projection&&this.setProjection(y.projection),y.hash&&(this._hash=new k_(typeof y.hash=="string"&&y.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){s.center==null&&s.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch});const h=y.bounds;h&&(this.resize(),this.fitBounds(h,Object.assign({},y.fitBoundsOptions,{duration:0})))}this.resize(),y.attributionControl&&this.addControl(new Op({customAttribution:y.customAttribution})),this._logoControl=new ty,this.addControl(this._logoControl,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new i.z(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new i.z(`${h.dataType}dataloading`,h))}),this._interactions=new l1(this)}_getMapId(){return this._mapId}addControl(y,s){if(s===void 0&&(s=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new i.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=y.onAdd(this);this._controls.push(y);const v=this._controlPositions[s];return s.indexOf("bottom")!==-1?v.insertBefore(h,v.firstChild):v.appendChild(h),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new i.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(y);return s>-1&&this._controls.splice(s,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(y){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const s=!this._moving;return s&&this.fire(new i.z("movestart",y)).fire(new i.z("move",y)),this.fire(new i.z("resize",y)),s&&this.fire(new i.z("moveend",y)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(y){return this.transform.setMaxBounds(i.aI.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y?this.setZoom(y):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y?this.setZoom(y):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y?this.setPitch(y):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y?this.setPitch(y):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(y){return this._scaleFactor=y,this.painter.scaleFactor=y,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(s=>s.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(y){return y==="auto"?navigator.language:Array.isArray(y)?y.length===0?void 0:y.map(s=>s==="auto"?navigator.language:s):y}setLanguage(y){const s=this._parseLanguage(y);if(!this.style||s===this._language)return this;this._language=s,this.style.reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(y){return this.style&&y!==this._worldview?(this._worldview=y,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(y){return this._lazyInitEmptyStyle(),y?typeof y=="string"&&(y={name:y}):y=null,this._useExplicitProjection=!!y,this._prioritizeAndUpdateProjection(y,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const y=this.transform,s=y.projection.name;let h;s==="globe"&&y.zoom>=i.cK?(y.setMercatorFromTransition(),h=!0):s==="mercator"&&y.zoom<i.cK&&(y.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(y,s){return this._updateProjection(y||s||{name:"mercator"})}_updateProjection(y){let s;const h=this.transform.mercatorFromTransition;s=y.name==="globe"&&this.transform.zoom>=i.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(y),this.style.applyProjectionUpdate();const v=this.transform.getProjection().name==="mercator"&&h!==this.transform.mercatorFromTransition;return(s||v)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(y,s){return this.transform.locationPoint3D(i.aS.convert(y),s)}unproject(y,s){return this.transform.pointLocation3D(i.P.convert(y),s)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(y,s,h){const v=w=>{let P=[];if(Array.isArray(s)){const O=s.filter(L=>this.getLayer(L));P=O.length?this.queryRenderedFeatures(w,{layers:O}):[]}else P=this.queryRenderedFeatures(w,{target:s});return P};if(y==="mouseenter"||y==="mouseover"){let w=!1;return{listener:h,targets:s,delegates:{mousemove:O=>{const L=v(O.point);L.length?w||(w=!0,h.call(this,new Gi(y,this,O.originalEvent,{features:L}))):w=!1},mouseout:()=>{w=!1}}}}if(y==="mouseleave"||y==="mouseout"){let w=!1;return{listener:h,targets:s,delegates:{mousemove:L=>{v(L.point).length?w=!0:w&&(w=!1,h.call(this,new Gi(y,this,L.originalEvent)))},mouseout:L=>{w&&(w=!1,h.call(this,new Gi(y,this,L.originalEvent)))}}}}{const w=P=>{const O=v(P.point);O.length&&(P.features=O,h.call(this,P),delete P.features)};return{listener:h,targets:s,delegates:{[y]:w}}}}on(y,s,h){if(typeof s=="function"||h===void 0)return super.on(y,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const v=this._createDelegatedListener(y,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(v);for(const w in v.delegates)this.on(w,v.delegates[w]);return this}once(y,s,h){if(typeof s=="function"||h===void 0)return super.once(y,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const v=this._createDelegatedListener(y,s,h);for(const w in v.delegates)this.once(w,v.delegates[w]);return this}off(y,s,h){if(typeof s=="function"||h===void 0)return super.off(y,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const v=this._delegatedListeners?this._delegatedListeners[y]:void 0;return v&&(w=>{for(let P=0;P<w.length;P++){const O=w[P];if(O.listener===h&&c1(O.targets,s)){for(const L in O.delegates)this.off(L,O.delegates[L]);return w.splice(P,1),this}}})(v),this}queryRenderedFeatures(y,s){if(!this.style)return[];if(y===void 0||y instanceof i.P||Array.isArray(y)||s!==void 0||(s=y,y=void 0),y=y||[[0,0],[this.transform.width,this.transform.height]],!s){const P=this.style.queryRenderedFeatures(y,void 0,this.transform),O=this.style.queryRenderedFeatureset(y,void 0,this.transform);return P.concat(O)}let h=!0;if(s.target&&(h=this._isTargetValid(s.target),h&&!s.layers))return this.style.queryRenderedFeatureset(y,s,this.transform);let v=!0;if(s.layers&&Array.isArray(s.layers)){for(const P of s.layers)if(!this._isValidId(P)){v=!1;break}if(v&&!s.target)return this.style.queryRenderedFeatures(y,s,this.transform)}let w=[];return v&&(w=w.concat(this.style.queryRenderedFeatures(y,s,this.transform))),h&&(w=w.concat(this.style.queryRenderedFeatureset(y,s,this.transform))),w}querySourceFeatures(y,s){return!y||typeof y=="string"&&!this._isValidId(y)?[]:this.style.querySourceFeatures(y,s)}queryRasterValue(y,s,h){return this._isValidId(y)?this.style.queryRasterValue(y,s,h):Promise.resolve(null)}isPointOnSurface(y){const{name:s}=this.transform.projection;return s!=="globe"&&s!=="mercator"&&i.w(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(y))}addInteraction(y,s){return this._interactions.add(y,s),this}removeInteraction(y){return this._interactions.remove(y),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(y){return this._cooperativeGestures=y,this}setStyle(y,s){return s=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s),this.style&&y&&s.diff!==!1&&s.localFontFamily===this._localFontFamily&&s.localIdeographFontFamily===this._localIdeographFontFamily&&!s.config?(this.style._diffStyle(y,(h,v)=>{if(h){const w=typeof h=="string"?h:h instanceof Error?h.message:h.error;i.w(`Unable to perform style diff: ${w}. Rebuilding the style from scratch.`),this._updateStyle(y,s)}else v&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(y,s))}_getUIString(y){const s=this._locale[y];if(s==null)throw new Error(`Missing UI string '${y}'`);return s}_updateStyle(y,s){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),y){const h=Object.assign({},s);s&&s.config&&(h.initialConfig=s.config,delete h.config),this.style=new nc(this,h).load(y),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new nc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(y){return y==null?(this.fire(new i.y(new Error("IDs can't be empty."))),!1):!i.dq(y)||(this.fire(new i.y(new Error(`IDs can't contain special symbols: "${y}".`))),!1)}_isTargetValid(y){return"featuresetId"in y?this._isValidId("importId"in y?y.importId:y.featuresetId):"layerId"in y&&this._isValidId(y.layerId)}_areTargetsValid(y){if(Array.isArray(y)){for(const s of y)if(!this._isValidId(s))return!1;return!0}return this._isTargetValid(y)}addSource(y,s){return this._isValidId(y)?(this._lazyInitEmptyStyle(),this.style.addSource(y,s),this._update(!0)):this}isSourceLoaded(y){return!!this._isValidId(y)&&!!this.style&&this.style._isSourceCacheLoaded(y)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(y,s,h){this._lazyInitEmptyStyle(),this.style.addSourceType(y,s,h)}removeSource(y){return this._isValidId(y)?(this.style.removeSource(y),this._updateTerrain(),this._update(!0)):this}getSource(y){return this._isValidId(y)?this.style.getOwnSource(y):null}addImage(y,s,{pixelRatio:h=1,sdf:v=!1,stretchX:w,stretchY:P,content:O}={}){this._lazyInitEmptyStyle();const L=i.I.from(y);if(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap){const{width:z,height:G,data:H}=i.o.getImageData(s);this.style.addImage(L,{data:new i.q({width:z,height:G},H),pixelRatio:h,stretchX:w,stretchY:P,content:O,sdf:v,version:0,usvg:!1})}else if(s.width===void 0||s.height===void 0)this.fire(new i.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:z,height:G}=s,H=s;this.style.addImage(L,{data:new i.q({width:z,height:G},new Uint8Array(H.data)),pixelRatio:h,stretchX:w,stretchY:P,content:O,sdf:v,usvg:!1,version:0,userImage:H}),H.onAdd&&H.onAdd(this,y)}}updateImage(y,s){this._lazyInitEmptyStyle();const h=i.I.from(y),v=this.style.getImage(h);if(!v)return void this.fire(new i.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const w=s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap?i.o.getImageData(s):s,{width:P,height:O,data:L}=w;if(P===void 0||O===void 0)return void this.fire(new i.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(P!==(v.usvg?v.icon.usvg_tree.width:v.data.width)||O!==(v.usvg?v.icon.usvg_tree.height:v.data.height))return void this.fire(new i.y(new Error(`The width and height of the updated image (${P}, ${O})
                must be that same as the previous version of the image
                (${v.data.width}, ${v.data.height})`)));const z=!(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap);let G=!1;v.usvg?(v.data=new i.q({width:P,height:O},new Uint8Array(L)),v.usvg=!1,v.icon=void 0,G=!0):v.data.replace(L,z),this.style.updateImage(h,v,G)}hasImage(y){return y?!!this.style&&!!this.style.getImage(i.I.from(y)):(this.fire(new i.y(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(i.I.from(y))}loadImage(y,s){i.n(this._requestManager.transformRequest(y,i.R.Image),(h,v)=>{s(h,v instanceof HTMLImageElement?i.o.getImageData(v):v)})}listImages(){return this.style.listImages().map(y=>y.name)}addModel(y,s){this._lazyInitEmptyStyle(),this.style.addModel(y,s)}hasModel(y){return y?this.style.hasModel(y):(this.fire(new i.y(new Error("Missing required model id"))),!1)}removeModel(y){this.style.removeModel(y)}listModels(){return this.style.listModels()}addLayer(y,s){return this._isValidId(y.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(y,s),this._update(!0)):this}getSlot(y){const s=this.getLayer(y);return s&&s.slot||null}setSlot(y,s){return this.style.setSlot(y,s),this.style.mergeLayers(),this._update(!0)}addImport(y,s){return this.style.addImport(y,s).catch(h=>this.fire(new i.y(new Error("Failed to add import",h)))),this}updateImport(y,s){return typeof s!="string"&&s.id!==y?(this.removeImport(y),this.addImport(s)):(this.style.updateImport(y,s),this._update(!0))}removeImport(y){return this.style.removeImport(y),this}moveImport(y,s){return this.style.moveImport(y,s),this._update(!0)}moveLayer(y,s){return this._isValidId(y)?(this.style.moveLayer(y,s),this._update(!0)):this}removeLayer(y){return this._isValidId(y)?(this.style.removeLayer(y),this._update(!0)):this}getLayer(y){if(!this._isValidId(y))return null;const s=this.style.getOwnLayer(y);return s?s.type==="custom"?s.implementation:s.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(y,s,h){return this._isValidId(y)?(this.style.setLayerZoomRange(y,s,h),this._update(!0)):this}setFilter(y,s,h={}){return this._isValidId(y)?(this.style.setFilter(y,s,h),this._update(!0)):this}getFilter(y){return this._isValidId(y)?this.style.getFilter(y):null}setPaintProperty(y,s,h,v={}){return this._isValidId(y)?(this.style.setPaintProperty(y,s,h,v),this._update(!0)):this}getPaintProperty(y,s){return this._isValidId(y)?this.style.getPaintProperty(y,s):null}setLayoutProperty(y,s,h,v={}){return this._isValidId(y)?(this.style.setLayoutProperty(y,s,h,v),this._update(!0)):this}getLayoutProperty(y,s){return this._isValidId(y)?this.style.getLayoutProperty(y,s):null}setLayerProperty(y,s,h,v={}){return this._isValidId(y)?(this.style.setLayerProperty(y,s,h,v),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(y){return this.style.setGlyphsUrl(y),this._update(!0)}getSchema(y){return this.style.getSchema(y)}setSchema(y,s){return this.style.setSchema(y,s),this._update(!0)}getConfig(y){return this.style.getConfig(y)}setConfig(y,s){return this.style.setConfig(y,s),this._update(!0)}getConfigProperty(y,s){return this.style.getConfigProperty(y,s)}setConfigProperty(y,s,h){return this.style.setConfigProperty(y,s,h),this._update(!0)}getFeaturesetDescriptors(y){return this.style.getFeaturesetDescriptors(y)}setLights(y){if(this._lazyInitEmptyStyle(),y&&y.length===1&&y[0].type==="flat"){const s=y[0];s.properties?this.style.setFlatLight(s.properties,s.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(y),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const y=this.style.getLights()||[];return y.length===0&&y.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),y}setLight(y,s={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:y}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(y){return this._lazyInitEmptyStyle(),!y&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(y),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(y){return this._lazyInitEmptyStyle(),this.style.setFog(y),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(y){return this._lazyInitEmptyStyle(),this.style.setSnow(y),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(y){return this._lazyInitEmptyStyle(),this.style.setRain(y),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(y){return this._lazyInitEmptyStyle(),this.style.setColorTheme(y),this._update(!0)}setImportColorTheme(y,s){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(y,s),this._update(!0)}setCamera(y){return this.style.setCamera(y),this._triggerCameraUpdate(y)}_triggerCameraUpdate(y){return this._update(this.transform.setOrthographicProjectionAtLowPitch(y["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(y){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.aS.convert(y),this.transform):0}setFeatureState(y,s){return y.source&&!this._isValidId(y.source)?this:(this.style.setFeatureState(y,s),this._update())}removeFeatureState(y,s){return y.source&&!this._isValidId(y.source)?this:(this.style.removeFeatureState(y,s),this._update())}getFeatureState(y){return y.source&&!this._isValidId(y.source)?null:this.style.getFeatureState(y)}_selectIndoorFloor(y){this.indoor.selectFloor(y)}_setIndoorActiveFloorsVisibility(y){this.indoor.setActiveFloorsVisibility(y)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new s1),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const y=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300;let h,v,w,P=this._container;for(;P&&(!v||!w);){const O=window.getComputedStyle(P).transform;O&&O!=="none"&&(h=O.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(v=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(w=h[3])),P=P.parentElement}this._containerWidth=v?Math.abs(y/v):y,this._containerHeight=w?Math.abs(s/w):s}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new Wh(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const y=this._container;y.classList.add("mapboxgl-map"),(this._missingCSSCanary=I("div","mapboxgl-canary",y)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=I("div","mapboxgl-canvas-container",y);this._canvas=I("canvas","mapboxgl-canvas",s),this._interactive&&(s.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=I("div","mapboxgl-control-container",y),v=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(w=>{v[w]=I("div",`mapboxgl-ctrl-${w}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,s){const h=i.o.devicePixelRatio||1;this._canvas.width=h*Math.ceil(y),this._canvas.height=h*Math.ceil(s),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${s}px`}_addMarker(y){this._markers.push(y)}_removeMarker(y){const s=this._markers.indexOf(y);s!==-1&&this._markers.splice(s,1)}_addPopup(y){this._popups.push(y)}_removePopup(y){const s=this._popups.indexOf(y);s!==-1&&this._popups.splice(s,1)}_setupPainter(){const y=Object.assign({},N.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl2",y);s?(Ft(s,!0),this.painter=new Hd(s,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.k.testSupport(s)):this.fire(new i.y(new Error("Failed to initialize WebGL")))}_contextLost(y){y.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.z("webglcontextlost",{originalEvent:y}))}_contextRestored(y){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new i.z("webglcontextrestored",{originalEvent:y}))}_onMapScroll(y){if(y.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(y){return this.style?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_requestDomTask(y){!this.loaded()||this.loaded()&&!this.isMoving()?y():this._domRenderTaskQueue.add(y)}_render(y){let s;this.fire(new i.z("renderstart")),++this._frameId;const h=this.painter.context.extTimerQuery,v=i.o.now(),w=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(s=w.createQuery(),w.beginQuery(h.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(y),this._domRenderTaskQueue.run(y),this._removed)return;this._updateProjectionTransition();const P=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const G=this.transform.zoom,H=this.transform.pitch,Q=i.o.now(),K=new i.ac(G,{now:Q,fadeDuration:P,pitch:H,transition:this.style.transition,worldview:this._worldview});this.style.update(K)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let O=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),O=this._updateAverageElevation(v),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):O=this._updateAverageElevation(v);const L=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,P,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),L&&(this._placementDirty=L.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:P,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,S.mark(_.load),this.fire(new i.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){const G=i.o.now()-v;w.endQuery(h.TIME_ELAPSED_EXT),setTimeout(()=>{const H=w.getQueryParameter(s,w.QUERY_RESULT)/1e6;w.deleteQuery(s),this.fire(new i.z("gpu-timing-frame",{cpuTime:G,gpuTime:H}))},50)}if(this.listens("gpu-timing-layer")){const G=this.painter.collectGpuTimers();setTimeout(()=>{const H=this.painter.queryGpuTimers(G);this.fire(new i.z("gpu-timing-layer",{layerTimes:H}))},50)}if(this.listens("gpu-timing-deferred-render")){const G=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const H=this.painter.queryGpuTimeDeferredRender(G);this.fire(new i.z("gpu-timing-deferred-render",{gpuTime:H}))},50)}const z=this._sourcesDirty||this._styleDirty||this._placementDirty||O;if(z||this._repaint)this.triggerRepaint();else{const G=this.idle();if(G&&(O=this._updateAverageElevation(v,!0)),O)this.triggerRepaint();else if(this._triggerFrame(!1),G&&(this.fire(new i.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const H=this._calculateSpeedIndex();this.fire(new i.z("speedindexcompleted",{speedIndex:H})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,S.mark(_.fullLoad),this._performanceMetricsCollection&&ot(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(y){for(const s of this._markers)y&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(const s of this._popups)!y||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(y,s=!1){const h=w=>(this.transform.averageElevation=w,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);const v=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(v||(s||y-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(y)){const w=this.transform.averageElevation;let P=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(P)?P=0:this._averageElevationLastSampledAt=y;const O=Math.abs(w-P);if(O>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(P),h(P);this._averageElevation.easeTo(P,y,300)}else if(O>1e-4)return this._averageElevation.jumpTo(P),h(P)}return!!this._averageElevation.isEasing(y)&&h(this._averageElevation.getValue(y))}_authenticate(){rt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,y=>{if(y&&(y.message===oe||y.status===401)){const s=this.painter.context.gl;Ft(s,!1),this._logoControl instanceof ty&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),tt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Le(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Ge(this._requestManager._customAccessToken)}_updateTerrain(){const y=this._isDragging();this.painter.updateTerrain(this.style,y)}_calculateSpeedIndex(){const y=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const h=this.painter.context.gl,v=h.createFramebuffer();function w(P){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,P,0);const O=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,O),O}return h.bindFramebuffer(h.FRAMEBUFFER,v),this._canvasPixelComparison(w(y),s.canvasCopies.map(w),s.timeStamps)}_canvasPixelComparison(y,s,h){let v=h[1]-h[0];const w=y.length/4;for(let P=0;P<s.length;P++){const O=s[P];let L=0;for(let z=0;z<O.length;z+=4)O[z]===y[z]&&O[z+1]===y[z+1]&&O[z+2]===y[z+2]&&O[z+3]===y[z+3]&&(L+=1);v+=(h[P+2]-h[P+1])*(1-L/w)}return v}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const y=this.painter.context.gl.getExtension("WEBGL_lose_context");y&&y.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Ut.delete(this.painter.context.gl),St.remove(),Ie.remove(),this._removed=!0,this.fire(new i.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(y){this._renderNextFrame=this._renderNextFrame||y,this.style&&!this._frame&&(this._frame=i.o.frame(s=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(s)}))}_preloadTiles(y){const s=this.style?this.style.getSourceCaches():[];return i.bv(s,(h,v)=>h._preloadTiles(y,v),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(y){this._trackResize&&this.resize({originalEvent:y})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(y){this._showParseStatus!==y&&(this._showParseStatus=y,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(y){this._showTerrainWireframe!==y&&(this._showTerrainWireframe=y,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(y){this._showLayers2DWireframe!==y&&(this._showLayers2DWireframe=y,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(y){this._showLayers3DWireframe!==y&&(this._showLayers3DWireframe=y,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(y){this._speedIndexTiming!==y&&(this._speedIndexTiming=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,this._tp.refreshUI(),y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(y){this._showTileAABBs!==y&&(this._showTileAABBs=y,this._tp.refreshUI(),y&&this._update())}_setCacheLimits(y,s){i.f3(y,s)}get version(){return g}},NavigationControl:class{constructor(y={}){this.options=Object.assign({},$_,y),this._container=I("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(i.aX(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),I("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),I("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aX(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:s}):h.resetNorth({},{originalEvent:s}))}),this._compassIcon=I("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const y=this._map;if(!y)return;const s=y.getZoom(),h=s===y.getMaxZoom(),v=s===y.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())}_rotateCompassArrow(){const y=this._map;if(!y)return;const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(y.transform.pitch*(Math.PI/180)),.5)}) rotateX(${y.transform.pitch}deg) rotateZ(${y.transform.angle*(180/Math.PI)}deg)`:`rotate(${y.transform.angle*(180/Math.PI)}deg)`;y._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),y.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&y.on("pitch",this._rotateCompassArrow),y.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ny(y,this._compass,this.options.visualizePitch)),this._container}onRemove(){const y=this._map;y&&(this._container.remove(),this.options.showZoom&&y.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&y.off("pitch",this._rotateCompassArrow),y.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(y,s){const h=I("button",y,this._container);return h.type="button",h.addEventListener("click",s),h}_setButtonTitle(y,s){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${s}`);y.setAttribute("aria-label",h),y.firstElementChild&&y.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends i.E{constructor(y={}){super();const s=navigator.geolocation;this.options=Object.assign({geolocation:s},Ic,y),i.aX(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ef(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(y){return this._map=y,this._container=I("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(y){const s=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,y(h)};this._supportsGeolocation!==void 0?y(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(h=>s(h.state!=="denied")).catch(()=>s()):s()}_isOutOfMapMaxBounds(y){const s=this._map.getMaxBounds(),h=y.coords;return!!s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(y){if(this._map){if(this._isOutOfMapMaxBounds(y))return this._setErrorState(),this.fire(new i.z("outofmaxbounds",y)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=y,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(y),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(y),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("geolocate",Object.assign({coords:y.coords,timestamp:y.timestamp},y.toJSON?{toJSON:y.toJSON.bind(y)}:{}))),this._finish()}}_updateCamera(y){const s=new i.aS(y.coords.longitude,y.coords.latitude),h=y.coords.accuracy,v=this._map.getBearing(),w=Object.assign({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(h),w,{geolocateSource:!0})}_updateMarker(y){if(y){const s=new i.aS(y.coords.longitude,y.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=y.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const y=this._map.transform,s=i.ce(1,y._center.lat)*y.worldSize,h=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(y){if(this._map){if(this.options.trackUserLocation)if(y.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(y.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("error",y)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(y){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=I("button","mapboxgl-ctrl-geolocate",this._container),I("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",y===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=I("div","mapboxgl-user-location"),this._dotElement.appendChild(I("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(I("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Xu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=I("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.z("trackuserlocationend")))})}}_onDeviceOrientation(y){this._userLocationDotMarker&&(y.webkitCompassHeading?this._heading=y.webkitCompassHeading:y.absolute===!0&&(this._heading=-1*y.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(y={maximumAge:6e5,timeout:0},this._noTimeout=!0):(y=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,y),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const y=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&y()}).catch(console.error):y()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Op,ScaleControl:class{constructor(y={}){this.options=Object.assign({},Aj,y),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.aX(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const y=this.options.maxWidth||100,s=this._map,h=s._containerHeight/2,v=s._containerWidth/2-y/2,w=s.unproject([v,h]),P=s.unproject([v+y,h]),O=w.distanceTo(P);if(this.options.unit==="imperial"){const L=3.2808*O;L>5280?this._setScale(y,L/5280,"mile"):this._setScale(y,L,"foot")}else this.options.unit==="nautical"?this._setScale(y,O/1852,"nautical-mile"):O>=1e3?this._setScale(y,O/1e3,"kilometer"):this._setScale(y,O,"meter")}_setScale(y,s,h){this._map._requestDomTask(()=>{const v=function(P){const O=Math.pow(10,`${Math.floor(P)}`.length-1);let L=P/O;return L=L>=10?10:L>=5?5:L>=3?3:L>=2?2:L>=1?1:function(z){const G=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*G)/G}(L),O*L}(s),w=v/s;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(v):`${v}&nbsp;${Pj[h]}`,this._container.style.width=y*w+"px"})}onAdd(y){return this._map=y,this._language=y.getLanguage(),this._container=I("div","mapboxgl-ctrl mapboxgl-ctrl-scale",y.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(y){this._language=y,this._update()}setUnit(y){this.options.unit=y,this._update()}},FullscreenControl:class{constructor(y={}){this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:i.w("Full screen control 'container' must be a DOM element.")),i.aX(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=I("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const y=this._fullscreenButton=I("button","mapboxgl-ctrl-fullscreen",this._controlContainer);I("span","mapboxgl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",y)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:s1,Popup:class extends i.E{constructor(y){super(),this.options=Object.assign(Object.create(Cj),y),this._altitude=this.options.altitude,i.aX(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(y&&y.className?y.className.trim().split(/\s+/):[])}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&y.on("preclick",this._onClose),this.options.closeOnMove&&y.on("move",this._onClose),y.on("remove",this.remove),this._update(),y._addPopup(this),this._focusFirstElement(),this._trackPointer?(y.on("mousemove",this._onMouseEvent),y.on("mouseup",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")):y.on("move",this._update),this.fire(new i.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const y=this._map;return y&&(y.off("move",this._update),y.off("move",this._onClose),y.off("preclick",this._onClose),y.off("click",this._onClose),y.off("remove",this.remove),y.off("mousemove",this._onMouseEvent),y.off("mouseup",this._onMouseEvent),y.off("drag",this._onMouseEvent),y._canvasContainer&&y._canvasContainer.classList.remove("mapboxgl-track-pointer"),y._removePopup(this),this._map=void 0),this.fire(new i.z("close")),this}getLngLat(){return this._lngLat}setLngLat(y){this._lngLat=i.aS.convert(y),this._pos=null,this._trackPointer=!1,this._update();const s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(y){return this._altitude=y,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const y=this._map;return y&&(y.off("move",this._update),y.on("mousemove",this._onMouseEvent),y.on("drag",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const s=document.createDocumentFragment(),h=document.createElement("body");let v;for(h.innerHTML=y;v=h.firstChild,v;)s.appendChild(v);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=I("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(y),this.options.closeButton){const h=this._closeButton=I("button","mapboxgl-popup-close-button",s);h.type="button",h.setAttribute("aria-label","Close popup"),h.innerHTML='<span aria-hidden="true">&#215;</span>',h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(y){return this._classList.add(y),this._updateClassList(),this}removeClassName(y){return this._classList.delete(y),this._updateClassList(),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){let s;return this._classList.delete(y)?s=!1:(this._classList.add(y),s=!0),this._updateClassList(),s}_onMouseEvent(y){this._update(y.point)}_getAnchor(y){if(this.options.anchor)return this.options.anchor;const s=this._map,h=this._container,v=this._pos;if(!s||!h||!v)return"bottom";const w=h.offsetWidth,P=h.offsetHeight,O=v.x<w/2,L=v.x>s.transform.width-w/2;if(v.y+y<P)return O?"top-left":L?"top-right":"top";if(v.y>s.transform.height-P){if(O)return"bottom-left";if(L)return"bottom-right"}return O?"left":L?"right":"bottom"}_updateClassList(){const y=this._container;if(!y)return;const s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),y.className=s.join(" ")}_update(y){const s=this._map,h=this._content;if(!s||!this._lngLat&&!this._trackPointer||!h)return;let v=this._container;if(v||(v=this._container=I("div","mapboxgl-popup",s.getContainer()),this._tip=I("div","mapboxgl-popup-tip",v),v.appendChild(h)),this.options.maxWidth&&v.style.maxWidth!==this.options.maxWidth&&(v.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Zu(this._lngLat,this._pos,s.transform)),!this._trackPointer||y){const w=this._pos=this._trackPointer&&y instanceof i.P?y:s.project(this._lngLat,this._altitude),P=u1(this.options.offset),O=this._anchor=this._getAnchor(P.y),L=u1(this.options.offset,O),z=w.add(L).round();s._requestDomTask(()=>{this._container&&O&&(this._container.style.transform=`${kc[O]} translate(${z.x}px,${z.y}px)`)})}if(!this._marker&&s._showingGlobe()){const w=i.f4(s.transform,this._lngLat)?0:1;this._setOpacity(w)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Oj);y&&y.focus()}_onClose(){this.remove()}_setOpacity(y){this._container&&(this._container.style.opacity=`${y}`),this._content&&(this._content.style.pointerEvents=y?"auto":"none")}},Marker:Xu,Style:nc,LngLat:i.aS,LngLatBounds:i.aI,Point:i.P,MercatorCoordinate:i.ae,FreeCameraOptions:ou,Evented:i.E,config:i.e,prewarm:i.f8,clearPrewarmedResources:i.f7,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(y){i.e.ACCESS_TOKEN=y},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(y){i.e.API_URL=y},get workerCount(){return i.fh.workerCount},set workerCount(y){i.fh.workerCount=y},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(y){i.e.MAX_PARALLEL_IMAGE_REQUESTS=y},clearStorage(y){i.fg(y)},get workerUrl(){return i.ff.workerUrl},set workerUrl(y){i.ff.workerUrl=y},get workerClass(){return i.ff.workerClass},set workerClass(y){i.ff.workerClass=y},get workerParams(){return i.ff.workerParams},set workerParams(y){i.ff.workerParams=y},get dracoUrl(){return i.fe()},set dracoUrl(y){i.fd(y)},get meshoptUrl(){return i.fc()},set meshoptUrl(y){i.fb(y)},setNow:i.o.setNow,restoreNow:i.o.restoreNow}});var d=o;return d})})(fne);var mPe=fne.exports;const Jo=_a(mPe),mne=({restaurants:e,onRestaurantClick:t,userLocation:r,radiusFilter:n,onMapInit:o,onMarkerClick:l,showViewDetailsButton:d=!1})=>{const{i18n:i,t:g}=Ki(),_=W.useRef(null),S=W.useRef(null),E=W.useRef([]),[T,C]=W.useState(!1),N=W.useRef(null);return W.useEffect(()=>{if(!_.current||S.current)return;const I="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";Jo.accessToken=I;const j=r?[r.lng,r.lat]:[-9.1393,38.7223];return S.current=new Jo.Map({container:_.current,style:"mapbox://styles/mapbox/light-v11",center:j,zoom:13,cooperativeGestures:!0,doubleClickZoom:!1}),S.current.addControl(new Jo.NavigationControl({visualizePitch:!0}),"top-right"),S.current.on("load",()=>{C(!0),o&&S.current&&o(S.current)}),()=>{var D;E.current.forEach(R=>R.remove()),E.current=[],N.current&&(N.current.remove(),N.current=null),(D=S.current)==null||D.remove(),S.current=null,C(!1)}},[]),W.useEffect(()=>{S.current&&r&&T&&S.current.flyTo({center:[r.lng,r.lat],zoom:14,duration:1500})},[r,T]),W.useEffect(()=>{if(!S.current||!T)return;E.current.forEach(j=>j.remove()),E.current=[],N.current&&(N.current.remove(),N.current=null);let I=e;if(r&&n&&(I=e.filter(j=>HT(r.lat,r.lng,j.lat,j.lng)<=n)),I.forEach(j=>{const D=document.createElement("div");D.className="p-3 min-w-[200px]",D.innerHTML=`
        <div class="space-y-2">
          <h3 class="font-bold text-base text-foreground">${j.name}</h3>
          ${j.type&&j.type.length>0?`
            <div class="flex flex-wrap gap-1">
              ${j.type.slice(0,2).map(Z=>`<span class="text-xs bg-secondary text-secondary-foreground px-2 py-0.5 rounded">${Z}</span>`).join("")}
            </div>
          `:""}
          ${j.rating?`
            <div class="flex items-center gap-1">
              <span style="color: #016450;"></span>
              <span class="font-semibold text-sm">${j.rating.toFixed(1)}</span>
            </div>
          `:""}
          <p class="text-xs text-muted-foreground">${j.address}</p>
          ${d?`
            <button 
              id="view-details-${j.id}" 
              class="w-full mt-2 px-3 py-1.5 text-sm font-medium text-white rounded-md transition-colors"
              style="background-color: #016450;"
              onmouseover="this.style.opacity='0.9'"
              onmouseout="this.style.opacity='1'"
            >
              ${g("restaurants.viewDetails")}
            </button>
          `:""}
        </div>
      `;const R=new Jo.Popup({offset:25,closeButton:!0,closeOnClick:!1,closeOnMove:!1,maxWidth:"300px"}).setLngLat([j.lng,j.lat]).setDOMContent(D),F=new Jo.Marker({color:"#016450",draggable:!1}).setLngLat([j.lng,j.lat]).addTo(S.current),B=F.getElement();B.style.cursor="pointer";const U=Z=>{Z.stopPropagation(),Z.preventDefault(),N.current&&N.current!==R&&N.current.remove(),R.addTo(S.current),N.current=R,S.current.easeTo({center:[j.lng,j.lat],zoom:17,duration:800}),l&&l(j)};B.addEventListener("click",U,!0),d&&R.on("open",()=>{const Z=document.getElementById(`view-details-${j.id}`);Z&&Z.addEventListener("click",J=>{J.stopPropagation(),t(j)})}),R.on("close",()=>{N.current===R&&(N.current=null)}),E.current.push(F)}),I.length>0){const j=new Jo.LngLatBounds;I.forEach(D=>{j.extend([D.lng,D.lat])}),r&&j.extend([r.lng,r.lat]),S.current.fitBounds(j,{padding:50,maxZoom:15})}},[e,n,r,T,t,i.language,d,g,l]),W.useEffect(()=>{if(!S.current||!r||!T)return;const I=document.createElement("div");I.className="user-location-marker",I.style.backgroundColor="#3b82f6",I.style.width="20px",I.style.height="20px",I.style.borderRadius="50%",I.style.border="3px solid white",I.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)";const j=new Jo.Marker(I).setLngLat([r.lng,r.lat]).addTo(S.current);return()=>{j.remove()}},[r,T]),m.jsx("div",{ref:_,className:"w-full h-full rounded-lg overflow-hidden"})},Id=()=>{const{i18n:e}=Ki(),t=e.language,r=(l,d)=>{let i;if(t==="zh"){const g=`${d}_zh`;i=l[g]||l[d]}else if(t==="pt"){const g=`${d}_pt`;i=l[g]||l[`${d}_en`]||l[d]}else{const g=`${d}_en`;i=l[g]||l[d]}return(d==="name"||d==="title"||d.startsWith("title_"))&&Array.isArray(i)?i.join(", "):i||""};return{getLocalizedField:r,localizeRestaurant:l=>({...l,name:r(l,"name"),type:r(l,"type"),description:r(l,"description")}),localizeActivity:l=>({...l,title:r(l,"title"),content:r(l,"content")}),currentLang:t}},gne=e=>{if(typeof e=="string")return e;const r=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][new Date().getDay()],n=e[r];return n?n.closed?"Closed today":n.splitShift?`${n.open} - ${n.close}, ${n.open2} - ${n.close2}`:`${n.open} - ${n.close}`:"Hours not available"},gPe=e=>(Ki(),Li({queryKey:["restaurant-activities",e],queryFn:async()=>{const{data:t,error:r}=await qt.from("activity_restaurants").select(`
          activity_id,
          activities (
            id,
            title_zh,
            title_en,
            title_pt,
            badge_text_zh,
            badge_text_en,
            badge_text_pt,
            badge_color,
            start_date,
            end_date
          )
        `).eq("restaurant_id",e);if(r)throw r;const n=new Date;return t.filter(l=>{const d=l.activities;if(!d)return!1;const i=new Date(d.start_date),g=d.end_date?new Date(d.end_date):null;return i<=n&&(!g||g>=n)}).map(l=>({activity_id:l.activity_id,title_zh:l.activities.title_zh,title_en:l.activities.title_en,title_pt:l.activities.title_pt,badge_text_zh:l.activities.badge_text_zh,badge_text_en:l.activities.badge_text_en,badge_text_pt:l.activities.badge_text_pt,badge_color:l.activities.badge_color}))},enabled:!!e})),yne=e=>(Ki(),Li({queryKey:["batch-restaurant-activities",e.join(",")],queryFn:async()=>{if(e.length===0)return{};const{data:t,error:r}=await qt.from("activity_restaurants").select(`
          restaurant_id,
          activity_id,
          activities (
            id,
            title_zh,
            title_en,
            title_pt,
            badge_text_zh,
            badge_text_en,
            badge_text_pt,
            badge_color,
            start_date,
            end_date
          )
        `).in("restaurant_id",e);if(r)throw r;const n=new Date,o={};return t.forEach(l=>{const d=l.activities;if(!d)return;const i=new Date(d.start_date),g=d.end_date?new Date(d.end_date):null;i<=n&&(!g||g>=n)&&(o[l.restaurant_id]||(o[l.restaurant_id]=[]),o[l.restaurant_id].push({activity_id:l.activity_id,title_zh:d.title_zh,title_en:d.title_en,title_pt:d.title_pt,badge_text_zh:d.badge_text_zh,badge_text_en:d.badge_text_en,badge_text_pt:d.badge_text_pt,badge_color:d.badge_color}))}),o},enabled:e.length>0})),S4=(e,t)=>{let r="";return t==="zh"?r=e.badge_text_zh||e.title_zh:t==="pt"?r=e.badge_text_pt||e.title_pt:r=e.badge_text_en||e.title_en,r},zI=()=>Li({queryKey:["activities"],queryFn:async()=>{const{data:e,error:t}=await qt.from("activities").select("*").order("pinned",{ascending:!1}).order("sort_order",{ascending:!0}).order("start_date",{ascending:!1});if(t)throw t;return await Promise.all((e||[]).map(async n=>{const{count:o}=await qt.from("subscriptions").select("*",{count:"exact",head:!0}).eq("activity_id",n.id);return{...n,subscriber_count:o||0}}))}}),yPe=e=>Li({queryKey:["activity",e],queryFn:async()=>{const{data:t,error:r}=await qt.from("activities").select("*").eq("id",e).single();if(r)throw r;return t},enabled:!!e}),vPe=e=>Li({queryKey:["activityRestaurants",e],queryFn:async()=>{const{data:t,error:r}=await qt.from("activity_restaurants").select("*").eq("activity_id",e);if(r)throw r;if(!t||t.length===0)return[];const n=t.map(d=>d.restaurant_id),{data:o,error:l}=await qt.from("restaurants").select("id, name, name_en, name_pt, type, type_en, type_pt, address, image_url, rating, lat, lng").in("id",n);if(l)throw l;return t.map(d=>({...d,restaurants:(o==null?void 0:o.find(i=>i.id===d.restaurant_id))||{id:d.restaurant_id,name:"",name_en:null,name_pt:null,type:[],type_en:null,type_pt:null,address:"",image_url:null,rating:null,lat:null,lng:null}}))},enabled:!!e}),E4=()=>{const{user:e}=Fi();return Li({queryKey:["subscriptions",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await qt.from("subscriptions").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});if(r)throw r;return await Promise.all((t||[]).map(async o=>{const{data:l}=await qt.from("activities").select("*").eq("id",o.activity_id).single();return{...o,activity:l}}))},enabled:!!e})},vne=()=>{const{user:e}=Fi(),{toast:t}=Sa(),r=Ma();return Ya({mutationFn:async n=>{if(!e)throw new Error("User not authenticated");const{data:o}=await qt.from("subscriptions").select("id").eq("activity_id",n).eq("user_id",e.id).maybeSingle();if(o){const{error:l}=await qt.from("subscriptions").delete().eq("id",o.id);if(l)throw l;return{action:"unsubscribed"}}else{const{error:l}=await qt.from("subscriptions").insert({activity_id:n,user_id:e.id});if(l)throw l;return{action:"subscribed"}}},onSuccess:n=>{r.invalidateQueries({queryKey:["subscriptions"]}),t({title:n.action==="subscribed"?jr.t("toast.subscribed"):jr.t("toast.unsubscribed"),description:n.action==="subscribed"?jr.t("toast.subscribedDesc"):jr.t("toast.unsubscribedDesc")})},onError:()=>{t({title:jr.t("common.error"),description:jr.t("toast.subscriptionFailed"),variant:"destructive"})}})},_Pe=e=>Li({queryKey:["subscriberCount",e],queryFn:async()=>{const{count:t,error:r}=await qt.from("subscriptions").select("*",{count:"exact",head:!0}).eq("activity_id",e);if(r)throw r;return t||0},enabled:!!e});function _ne({data:e,initialItemsPerPage:t=12,incrementPerPage:r=12}){const[n,o]=W.useState(t),l=(e==null?void 0:e.length)||0,d=W.useMemo(()=>e?e.slice(0,n):[],[e,n]),i=n<l;return{displayedData:d,hasMore:i,loadMore:()=>{i&&o(S=>Math.min(S+r,l))},reset:()=>{o(t)},totalItems:l,displayedCount:n}}const xPe=({restaurant:e,activities:t,language:r})=>{const[n,o]=W.useState(999),l=W.useRef(null),d=[...e.type.map((_,S)=>({key:`type-${S}`,label:_,variant:"secondary",color:void 0})),...t.map((_,S)=>({key:`activity-${S}`,label:S4(_,r),variant:"default",color:_.badge_color||"#9b87f5"}))];W.useEffect(()=>{const _=()=>{var I;if(!l.current)return;const E=l.current,T=Array.from(E.querySelectorAll(".tag-badge"));if(T.length===0){setTimeout(_,50);return}const C=(I=T[0])==null?void 0:I.offsetTop;let N=T.length;for(let j=0;j<T.length;j++)if(T[j].offsetTop>C){N=j;break}N<T.length&&(N=Math.max(1,N-1)),o(N)};o(999);const S=setTimeout(_,100);return window.addEventListener("resize",_),()=>{clearTimeout(S),window.removeEventListener("resize",_)}},[d.length,e.id]);const i=d.slice(0,n),g=d.length>n;return m.jsxs("div",{className:"flex items-center gap-2 -mt-1",children:[m.jsx("div",{ref:l,className:"flex gap-2 flex-wrap flex-1",children:i.map(_=>m.jsx(jn,{variant:_.variant,className:"text-xs whitespace-nowrap tag-badge",style:_.color?{backgroundColor:_.color,color:"white"}:void 0,children:_.label},_.key))}),g&&m.jsxs(EO,{children:[m.jsx(TO,{asChild:!0,children:m.jsx(ir,{variant:"ghost",size:"sm",className:"h-6 px-2 text-muted-foreground hover:text-foreground flex-shrink-0",children:m.jsx(mB,{className:"h-4 w-4"})})}),m.jsx(jE,{className:"w-80",children:m.jsx("div",{className:"flex flex-wrap gap-2",children:d.map(_=>m.jsx(jn,{variant:_.variant,className:"text-xs",style:_.color?{backgroundColor:_.color,color:"white"}:void 0,children:_.label},_.key))})})]})]})},bPe=()=>{const e=qf(),{t,i18n:r}=Ki(),{toast:n}=Sa(),{localizeRestaurant:o}=Id(),[l,d]=W.useState(""),[i,g]=W.useState([]),[_,S]=W.useState(null),[E,T]=W.useState([]),[C,N]=W.useState("list"),[I,j]=W.useState(null),[D,R]=W.useState(null),[F,B]=W.useState(!1),[U,Z]=W.useState(!1),[J,te]=W.useState(!1),{user:ae}=Fi(),{data:ne,isLoading:ie}=w4(l,i.length>0?i.join(","):void 0),{data:ee=[]}=cne(),{data:oe=[]}=dne(),{data:de=[]}=zI(),xe=une(),we=(rt,Ut)=>{Ut.preventDefault(),Ut.stopPropagation(),ae&&xe.mutate(rt)},Ae=rt=>{g(Ut=>Ut.includes(rt)?Ut.filter(Ft=>Ft!==rt):[...Ut,rt])},Ce=async()=>{try{const rt=await FI();R({lat:rt.coords.latitude,lng:rt.coords.longitude}),B(!0),n({title:t("restaurants.locationEnabled"),description:t("restaurants.sortByDistance")})}catch{}},me=rt=>{j(rt),rt&&!D&&Ce()},Pe=async rt=>{if(_===rt)S(null),T([]);else{S(rt);const{data:Ut,error:Ft}=await qt.from("activity_restaurants").select("restaurant_id").eq("activity_id",rt);Ft?(console.error("Error fetching activity restaurants:",Ft),T([])):T(Ut.map(dr=>dr.restaurant_id))}},ye=(ne==null?void 0:ne.map(rt=>{const Ut=o(rt);if(D){const Ft=HT(D.lat,D.lng,rt.lat,rt.lng);return{...Ut,distance:Ft}}return Ut}))||[],pe=_&&E.length>0?ye.filter(rt=>E.includes(rt.id)):ye,Ie=I&&D?pe.filter(rt=>rt.distance&&rt.distance<=I):pe,tt=F&&D?[...Ie].sort((rt,Ut)=>(rt.distance||0)-(Ut.distance||0)):Ie,{displayedData:Ze,hasMore:Le,loadMore:qe,reset:Ge}=_ne({data:tt,initialItemsPerPage:12,incrementPerPage:12});W.useEffect(()=>{Ge()},[l,i,_,I,F,Ge]);const je=(Ze==null?void 0:Ze.map(rt=>rt.id))||[],{data:ot={}}=yne(je),St=rt=>{e(`/restaurant/${rt.id}`)};return m.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4 animate-fade-in",children:m.jsxs("div",{className:"container mx-auto max-w-7xl",children:[m.jsxs("div",{className:"mb-8",children:[m.jsx("h1",{className:"text-4xl font-bold mb-4 text-foreground",children:t("restaurants.title")}),m.jsxs("div",{className:"flex flex-col gap-4",children:[m.jsxs("div",{className:"flex flex-col gap-4",children:[m.jsx(en,{placeholder:t("restaurants.search"),value:l,onChange:rt=>d(rt.target.value),className:"w-full md:max-w-md"}),m.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[m.jsx(ir,{variant:C==="list"?"default":"outline",size:"icon",onClick:()=>N("list"),title:t("restaurants.listView"),className:"flex-shrink-0",children:m.jsx(tJ,{className:"w-4 h-4"})}),m.jsx(ir,{variant:C==="map"?"default":"outline",size:"icon",onClick:()=>N("map"),title:t("restaurants.mapView"),className:"flex-shrink-0",children:m.jsx(nJ,{className:"w-4 h-4"})}),D?m.jsx(ir,{variant:F?"default":"outline",onClick:()=>B(!F),className:"flex-1 md:flex-initial",children:t("restaurants.sortByDistance")}):m.jsxs(ir,{variant:"outline",onClick:Ce,className:"flex-1 md:flex-initial",children:[m.jsx(uh,{className:"w-4 h-4 mr-2"}),m.jsx("span",{className:"hidden sm:inline",children:t("restaurants.getLocation")}),m.jsx("span",{className:"sm:hidden",children:t("restaurants.getLocation")})]})]})]}),m.jsxs("div",{className:"space-y-3 bg-card/50 backdrop-blur-sm rounded-lg p-4 border border-border/50 animate-fade-in",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center justify-between gap-2",children:[m.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[m.jsxs("span",{className:"text-sm font-semibold text-foreground whitespace-nowrap",children:[t("restaurants.restaurantTypes"),":"]}),i.length>0&&m.jsx(jn,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0.5 text-xs",onClick:()=>g([]),children:t("common.actions.clearFilter")})]}),oe.length>8&&m.jsx(ir,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-primary hover:text-primary/80 hidden sm:flex transition-all duration-200 flex-shrink-0",onClick:()=>Z(!U),children:t(U?"common.showLess":"common.showMore")})]}),m.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${U?"animate-expand-height":""}`,children:(U?oe:oe.slice(0,8)).map((rt,Ut)=>m.jsx(jn,{variant:i.includes(rt)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${i.includes(rt)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${Ut*30}ms`},onClick:()=>Ae(rt),children:rt},rt))}),m.jsx("div",{className:"sm:hidden -mx-4 px-4",children:m.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:oe.map((rt,Ut)=>m.jsx(jn,{variant:i.includes(rt)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1 text-xs whitespace-nowrap flex-shrink-0 hover:scale-105 active:animate-tag-select rounded-md ${i.includes(rt)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${Ut*30}ms`},onClick:()=>Ae(rt),children:rt},rt))})})]}),de.length>0&&m.jsxs("div",{className:"space-y-2 pt-2 border-t border-border/30",children:[m.jsxs("div",{className:"flex items-center justify-between gap-2",children:[m.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[m.jsxs("span",{className:"text-sm font-semibold text-foreground whitespace-nowrap",children:[t("nav.activities"),":"]}),_&&m.jsx(jn,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0.5 text-xs",onClick:()=>{S(null),T([])},children:t("common.actions.clearFilter")})]}),de.length>8&&m.jsx(ir,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-primary hover:text-primary/80 hidden sm:flex transition-all duration-200 flex-shrink-0",onClick:()=>te(!J),children:t(J?"common.showLess":"common.showMore")})]}),m.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${J?"animate-expand-height":""}`,children:(J?de:de.slice(0,8)).map((rt,Ut)=>{const Ft=r.language==="zh"?rt.title_zh:r.language==="pt"?rt.title_pt:rt.title_en;return m.jsx(jn,{variant:_===rt.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${_===rt.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${Ut*30}ms`},onClick:()=>Pe(rt.id),children:Ft},rt.id)})}),m.jsx("div",{className:"sm:hidden -mx-4 px-4",children:m.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:de.map((rt,Ut)=>{const Ft=r.language==="zh"?rt.title_zh:r.language==="pt"?rt.title_pt:rt.title_en;return m.jsx(jn,{variant:_===rt.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1 text-xs whitespace-nowrap flex-shrink-0 hover:scale-105 active:animate-tag-select rounded-md ${_===rt.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${Ut*30}ms`},onClick:()=>Pe(rt.id),children:Ft},rt.id)})})})]}),D&&m.jsxs("div",{className:"space-y-2 pt-1 border-t border-border/30",children:[m.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[t("restaurants.radius"),":"]}),m.jsxs("div",{className:"flex gap-2 flex-wrap",children:[m.jsx(jn,{variant:I===null?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform px-3 py-1.5 text-xs",onClick:()=>me(null),children:t("restaurants.allRestaurants")}),m.jsx(jn,{variant:I===5?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform px-3 py-1.5 text-xs",onClick:()=>me(5),children:t("restaurants.radius5km")}),m.jsx(jn,{variant:I===10?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform px-3 py-1.5 text-xs",onClick:()=>me(10),children:t("restaurants.radius10km")}),m.jsx(jn,{variant:I===20?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform px-3 py-1.5 text-xs",onClick:()=>me(20),children:t("restaurants.radius20km")})]})]})]})]})]}),ie&&m.jsx("div",{className:"flex justify-center items-center py-20",children:m.jsx(Gs,{className:"w-8 h-8 animate-spin text-primary"})}),!ie&&tt&&tt.length===0&&m.jsxs("div",{className:"text-center py-20",children:[m.jsx("p",{className:"text-xl text-muted-foreground",children:t("restaurants.noResults")}),m.jsx("p",{className:"text-muted-foreground mt-2",children:t("restaurants.noResultsDesc")})]}),!ie&&C==="map"&&tt&&tt.length>0&&m.jsx("div",{className:"h-[400px] md:h-[500px] lg:h-[600px] xl:h-[700px] rounded-lg overflow-hidden shadow-lg",children:m.jsx(mne,{restaurants:tt,onRestaurantClick:St,userLocation:D,radiusFilter:I,showViewDetailsButton:!0})}),!ie&&C==="list"&&tt&&tt.length>0&&m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:Ze.map(rt=>{var Ut;return m.jsxs(rn,{className:"overflow-hidden hover:shadow-large transition-shadow flex flex-col h-full",children:[m.jsxs("div",{className:"relative h-48 overflow-hidden",children:[m.jsx("img",{src:rt.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=600&q=80",alt:rt.name,className:"w-full h-full object-cover transition-transform hover:scale-105"}),m.jsx(ir,{size:"icon",variant:"secondary",className:"absolute top-3 right-3",onClick:Ft=>we(rt.id,Ft),disabled:!ae,children:m.jsx(yB,{className:`w-5 h-5 ${ae&&ee.includes(rt.id)?"fill-destructive text-destructive":""}`})})]}),m.jsx(Di,{className:"mb-px pb-[15px]",children:m.jsxs("div",{className:"flex items-start justify-between",children:[m.jsx("h3",{className:"text-xl font-semibold text-card-foreground",children:rt.name}),m.jsxs("div",{className:"flex items-center gap-2",children:[rt.distance!==void 0&&m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(uh,{className:"w-4 h-4 text-primary"}),m.jsxs("span",{className:"font-semibold text-sm text-foreground",children:[rt.distance.toFixed(1)," km"]})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(Ec,{className:"w-5 h-5 fill-accent text-accent"}),m.jsx("span",{className:"font-semibold text-card-foreground",children:((Ut=rt.rating)==null?void 0:Ut.toFixed(1))||"0.0"})]})]})]})}),m.jsxs(ln,{className:"space-y-2 flex-grow",children:[m.jsx(xPe,{restaurant:rt,activities:ot[rt.id]||[],language:r.language}),m.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[m.jsx(ys,{className:"w-4 h-4 flex-shrink-0"}),m.jsx("span",{className:"line-clamp-1",children:rt.address})]}),rt.phone&&m.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[m.jsx(RT,{className:"w-4 h-4 flex-shrink-0"}),m.jsx("span",{children:rt.phone})]}),rt.opening_hours&&m.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[m.jsx(IT,{className:"w-4 h-4 flex-shrink-0"}),m.jsx("span",{children:gne(rt.opening_hours)})]})]}),m.jsxs(DI,{className:"gap-2 mt-auto",children:[m.jsx(ir,{asChild:!0,className:"flex-1",children:m.jsx(ia,{to:`/restaurant/${rt.id}`,children:t("restaurants.viewDetails")})}),D&&m.jsx(ir,{variant:"outline",size:"icon",onClick:()=>hne(rt.lat,rt.lng,rt.name),title:t("restaurants.directions"),children:m.jsx(uh,{className:"w-4 h-4"})})]})]},rt.id)})}),Le&&m.jsx("div",{className:"flex justify-center mt-8",children:m.jsxs(ir,{onClick:qe,size:"lg",variant:"outline",children:[t("common.loadMore")," (",Ze.length," / ",tt.length,")"]})})]})]})})};var wPe="Separator",uW="horizontal",SPe=["horizontal","vertical"],xne=W.forwardRef((e,t)=>{const{decorative:r,orientation:n=uW,...o}=e,l=EPe(n)?n:uW,i=r?{role:"none"}:{"aria-orientation":l==="vertical"?l:void 0,role:"separator"};return m.jsx(wn.div,{"data-orientation":l,...i,...o,ref:t})});xne.displayName=wPe;function EPe(e){return SPe.includes(e)}var bne=xne;const xu=W.forwardRef(({className:e,orientation:t="horizontal",decorative:r=!0,...n},o)=>m.jsx(bne,{ref:o,decorative:r,orientation:t,className:yr("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...n}));xu.displayName=bne.displayName;var BI="Collapsible",[TPe,Yet]=Zs(BI),[APe,T4]=TPe(BI),wne=W.forwardRef((e,t)=>{const{__scopeCollapsible:r,open:n,defaultOpen:o,disabled:l,onOpenChange:d,...i}=e,[g,_]=Ru({prop:n,defaultProp:o??!1,onChange:d,caller:BI});return m.jsx(APe,{scope:r,disabled:l,contentId:Kc(),open:g,onOpenToggle:W.useCallback(()=>_(S=>!S),[_]),children:m.jsx(wn.div,{"data-state":P4(g),"data-disabled":l?"":void 0,...i,ref:t})})});wne.displayName=BI;var Sne="CollapsibleTrigger",Ene=W.forwardRef((e,t)=>{const{__scopeCollapsible:r,...n}=e,o=T4(Sne,r);return m.jsx(wn.button,{type:"button","aria-controls":o.contentId,"aria-expanded":o.open||!1,"data-state":P4(o.open),"data-disabled":o.disabled?"":void 0,disabled:o.disabled,...n,ref:t,onClick:Rr(e.onClick,o.onOpenToggle)})});Ene.displayName=Sne;var A4="CollapsibleContent",Tne=W.forwardRef((e,t)=>{const{forceMount:r,...n}=e,o=T4(A4,e.__scopeCollapsible);return m.jsx(_s,{present:r||o.open,children:({present:l})=>m.jsx(PPe,{...n,ref:t,present:l})})});Tne.displayName=A4;var PPe=W.forwardRef((e,t)=>{const{__scopeCollapsible:r,present:n,children:o,...l}=e,d=T4(A4,r),[i,g]=W.useState(n),_=W.useRef(null),S=fi(t,_),E=W.useRef(0),T=E.current,C=W.useRef(0),N=C.current,I=d.open||i,j=W.useRef(I),D=W.useRef(void 0);return W.useEffect(()=>{const R=requestAnimationFrame(()=>j.current=!1);return()=>cancelAnimationFrame(R)},[]),Ro(()=>{const R=_.current;if(R){D.current=D.current||{transitionDuration:R.style.transitionDuration,animationName:R.style.animationName},R.style.transitionDuration="0s",R.style.animationName="none";const F=R.getBoundingClientRect();E.current=F.height,C.current=F.width,j.current||(R.style.transitionDuration=D.current.transitionDuration,R.style.animationName=D.current.animationName),g(n)}},[d.open,n]),m.jsx(wn.div,{"data-state":P4(d.open),"data-disabled":d.disabled?"":void 0,id:d.contentId,hidden:!I,...l,ref:S,style:{"--radix-collapsible-content-height":T?`${T}px`:void 0,"--radix-collapsible-content-width":N?`${N}px`:void 0,...e.style},children:I&&o})});function P4(e){return e?"open":"closed"}var CPe=wne;const SC=CPe,EC=Ene,TC=Tne,C4=(e,t="restaurant")=>Li({queryKey:["comments",e,t],queryFn:async()=>{const{data:r,error:n}=await qt.from("comments").select("*").eq("target_id",e).eq("target_type",t).order("created_at",{ascending:!1});if(n)throw n;if(!r||r.length===0)return[];const o=[...new Set(r.map(E=>E.user_id))],{data:l}=await qt.from("profiles").select("id, display_name, avatar_url").in("id",o),d=new Map((l||[]).map(E=>[E.id,{display_name:E.display_name,avatar_url:E.avatar_url}])),i=r.filter(E=>!E.parent_id),g=r.filter(E=>E.parent_id),_=new Map;return g.forEach(E=>{const T=E.parent_id;_.has(T)||_.set(T,[]),_.get(T).push(E)}),i.map(E=>({...E,profiles:d.get(E.user_id),replies:(_.get(E.id)||[]).sort((T,C)=>new Date(T.created_at).getTime()-new Date(C.created_at).getTime()).map(T=>({...T,profiles:d.get(T.user_id)}))}))},enabled:!!e,staleTime:3e4}),OPe=()=>{const{user:e}=Fi(),{toast:t}=Sa(),r=Ma();return Ya({mutationFn:async({targetId:n,targetType:o,content:l,ratingValue:d,priceRange:i,imageUrl:g,parentId:_})=>{if(!e)throw new Error("User not authenticated");const S={user_id:e.id,target_id:n,target_type:o,content:l,parent_id:_};_||(d&&(S.rating_value=d),i&&(S.price_range=i)),g&&(S.image_url=g);const{data:E,error:T}=await qt.from("comments").insert(S).select().single();if(T)throw T;return E},onSuccess:(n,o)=>{r.invalidateQueries({queryKey:["comments",o.targetId,o.targetType]}),r.invalidateQueries({queryKey:["restaurants"]}),r.invalidateQueries({queryKey:["restaurant",o.targetId]}),t({title:"Success",description:"Comment added successfully"})},onError:()=>{t({title:"Error",description:"Failed to add comment",variant:"destructive"})}})},kPe=()=>{const{toast:e}=Sa(),t=Ma();return Ya({mutationFn:async r=>{const{error:n}=await qt.from("comments").delete().eq("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["comments"]}),e({title:"Success",description:"Comment deleted successfully"})},onError:()=>{e({title:"Error",description:"Failed to delete comment",variant:"destructive"})}})},IPe=[{value:"0-5",label:"0-5"},{value:"5-10",label:"5-10"},{value:"10-15",label:"10-15"},{value:"15-20",label:"15-20"},{value:"20-25",label:"20-25"},{value:"25-30",label:"25-30"},{value:"30-40",label:"30-40"},{value:"40-50",label:"40-50"},{value:"50+",label:"50+"}],RPe=({restaurantId:e})=>{var g;const{t}=Ki(),{data:r}=C4(e,"restaurant"),n=(r==null?void 0:r.filter(_=>_.rating_value))||[],o=n.length?n.reduce((_,S)=>_+(S.rating_value||0),0)/n.length:0,l=[5,4,3,2,1].map(_=>({star:_,count:n.filter(S=>S.rating_value===_).length,percentage:n.length?(n.filter(S=>S.rating_value===_).length/n.length*100).toFixed(0):0})),d=n.reduce((_,S)=>(S.price_range&&(_[S.price_range]=(_[S.price_range]||0)+1),_),{}),i=d&&Object.keys(d).length>0?Object.entries(d).sort((_,S)=>S[1]-_[1])[0]:null;return m.jsxs(rn,{children:[m.jsx(Di,{children:m.jsx(Qi,{children:t("restaurant.rating")})}),m.jsxs(ln,{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-6",children:[m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"text-5xl font-bold",children:o.toFixed(1)}),m.jsx("div",{className:"flex items-center justify-center mt-2",children:[1,2,3,4,5].map(_=>m.jsx(Ec,{className:yr("w-5 h-5",_<=Math.round(o)?"fill-accent text-accent":"text-muted-foreground")},_))}),m.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[n.length," ",t("restaurant.ratingsCount")]}),i&&m.jsxs("div",{className:"flex items-center justify-center gap-1 mt-2 text-sm",children:[m.jsx(OL,{className:"w-4 h-4 text-primary"}),m.jsx("span",{className:"font-semibold text-foreground",children:(g=IPe.find(_=>_.value===i[0]))==null?void 0:g.label})]})]}),m.jsx("div",{className:"flex-1 space-y-2",children:l.map(({star:_,count:S,percentage:E})=>m.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[m.jsxs("span",{className:"w-8",children:[_," "]}),m.jsx("div",{className:"flex-1 h-2 bg-secondary rounded-full overflow-hidden",children:m.jsx("div",{className:"h-full bg-accent transition-all",style:{width:`${E}%`}})}),m.jsx("span",{className:"w-12 text-right text-muted-foreground",children:S})]},_))})]}),m.jsx("div",{className:"pt-4 border-t text-center text-sm text-muted-foreground",children:t("restaurant.signInToRate")})]})]})},Lm=W.forwardRef(({className:e,...t},r)=>m.jsx("textarea",{className:yr("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...t}));Lm.displayName="Textarea";function O4(e){const t=W.useRef({value:e,previous:e});return W.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var jPe=[" ","Enter","ArrowUp","ArrowDown"],NPe=[" ","Enter"],mv="Select",[$I,UI,MPe]=nI(mv),[jb,Jet]=Zs(mv,[MPe,rg]),VI=rg(),[DPe,lg]=jb(mv),[LPe,FPe]=jb(mv),Ane=e=>{const{__scopeSelect:t,children:r,open:n,defaultOpen:o,onOpenChange:l,value:d,defaultValue:i,onValueChange:g,dir:_,name:S,autoComplete:E,disabled:T,required:C,form:N}=e,I=VI(t),[j,D]=W.useState(null),[R,F]=W.useState(null),[B,U]=W.useState(!1),Z=UT(_),[J,te]=Ru({prop:n,defaultProp:o??!1,onChange:l,caller:mv}),[ae,ne]=Ru({prop:d,defaultProp:i,onChange:g,caller:mv}),ie=W.useRef(null),ee=j?N||!!j.closest("form"):!0,[oe,de]=W.useState(new Set),xe=Array.from(oe).map(we=>we.props.value).join(";");return m.jsx(hI,{...I,children:m.jsxs(DPe,{required:C,scope:t,trigger:j,onTriggerChange:D,valueNode:R,onValueNodeChange:F,valueNodeHasChildren:B,onValueNodeHasChildrenChange:U,contentId:Kc(),value:ae,onValueChange:ne,open:J,onOpenChange:te,dir:Z,triggerPointerDownPosRef:ie,disabled:T,children:[m.jsx($I.Provider,{scope:t,children:m.jsx(LPe,{scope:e.__scopeSelect,onNativeOptionAdd:W.useCallback(we=>{de(Ae=>new Set(Ae).add(we))},[]),onNativeOptionRemove:W.useCallback(we=>{de(Ae=>{const Ce=new Set(Ae);return Ce.delete(we),Ce})},[]),children:r})}),ee?m.jsxs(Xne,{"aria-hidden":!0,required:C,tabIndex:-1,name:S,autoComplete:E,value:ae,onChange:we=>ne(we.target.value),disabled:T,form:N,children:[ae===void 0?m.jsx("option",{value:""}):null,Array.from(oe)]},xe):null]})})};Ane.displayName=mv;var Pne="SelectTrigger",Cne=W.forwardRef((e,t)=>{const{__scopeSelect:r,disabled:n=!1,...o}=e,l=VI(r),d=lg(Pne,r),i=d.disabled||n,g=fi(t,d.onTriggerChange),_=UI(r),S=W.useRef("touch"),[E,T,C]=Jne(I=>{const j=_().filter(F=>!F.disabled),D=j.find(F=>F.value===d.value),R=Qne(j,I,D);R!==void 0&&d.onValueChange(R.value)}),N=I=>{i||(d.onOpenChange(!0),C()),I&&(d.triggerPointerDownPosRef.current={x:Math.round(I.pageX),y:Math.round(I.pageY)})};return m.jsx(NT,{asChild:!0,...l,children:m.jsx(wn.button,{type:"button",role:"combobox","aria-controls":d.contentId,"aria-expanded":d.open,"aria-required":d.required,"aria-autocomplete":"none",dir:d.dir,"data-state":d.open?"open":"closed",disabled:i,"data-disabled":i?"":void 0,"data-placeholder":Yne(d.value)?"":void 0,...o,ref:g,onClick:Rr(o.onClick,I=>{I.currentTarget.focus(),S.current!=="mouse"&&N(I)}),onPointerDown:Rr(o.onPointerDown,I=>{S.current=I.pointerType;const j=I.target;j.hasPointerCapture(I.pointerId)&&j.releasePointerCapture(I.pointerId),I.button===0&&I.ctrlKey===!1&&I.pointerType==="mouse"&&(N(I),I.preventDefault())}),onKeyDown:Rr(o.onKeyDown,I=>{const j=E.current!=="";!(I.ctrlKey||I.altKey||I.metaKey)&&I.key.length===1&&T(I.key),!(j&&I.key===" ")&&jPe.includes(I.key)&&(N(),I.preventDefault())})})})});Cne.displayName=Pne;var One="SelectValue",kne=W.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:o,children:l,placeholder:d="",...i}=e,g=lg(One,r),{onValueNodeHasChildrenChange:_}=g,S=l!==void 0,E=fi(t,g.onValueNodeChange);return Ro(()=>{_(S)},[_,S]),m.jsx(wn.span,{...i,ref:E,style:{pointerEvents:"none"},children:Yne(g.value)?m.jsx(m.Fragment,{children:d}):l})});kne.displayName=One;var zPe="SelectIcon",Ine=W.forwardRef((e,t)=>{const{__scopeSelect:r,children:n,...o}=e;return m.jsx(wn.span,{"aria-hidden":!0,...o,ref:t,children:n||""})});Ine.displayName=zPe;var BPe="SelectPortal",Rne=e=>m.jsx(bb,{asChild:!0,...e});Rne.displayName=BPe;var gv="SelectContent",jne=W.forwardRef((e,t)=>{const r=lg(gv,e.__scopeSelect),[n,o]=W.useState();if(Ro(()=>{o(new DocumentFragment)},[]),!r.open){const l=n;return l?tg.createPortal(m.jsx(Nne,{scope:e.__scopeSelect,children:m.jsx($I.Slot,{scope:e.__scopeSelect,children:m.jsx("div",{children:e.children})})}),l):null}return m.jsx(Mne,{...e,ref:t})});jne.displayName=gv;var sd=10,[Nne,cg]=jb(gv),$Pe="SelectContentImpl",UPe=Vm("SelectContent.RemoveScroll"),Mne=W.forwardRef((e,t)=>{const{__scopeSelect:r,position:n="item-aligned",onCloseAutoFocus:o,onEscapeKeyDown:l,onPointerDownOutside:d,side:i,sideOffset:g,align:_,alignOffset:S,arrowPadding:E,collisionBoundary:T,collisionPadding:C,sticky:N,hideWhenDetached:I,avoidCollisions:j,...D}=e,R=lg(gv,r),[F,B]=W.useState(null),[U,Z]=W.useState(null),J=fi(t,qe=>B(qe)),[te,ae]=W.useState(null),[ne,ie]=W.useState(null),ee=UI(r),[oe,de]=W.useState(!1),xe=W.useRef(!1);W.useEffect(()=>{if(F)return TI(F)},[F]),SI();const we=W.useCallback(qe=>{const[Ge,...je]=ee().map(rt=>rt.ref.current),[ot]=je.slice(-1),St=document.activeElement;for(const rt of qe)if(rt===St||(rt==null||rt.scrollIntoView({block:"nearest"}),rt===Ge&&U&&(U.scrollTop=0),rt===ot&&U&&(U.scrollTop=U.scrollHeight),rt==null||rt.focus(),document.activeElement!==St))return},[ee,U]),Ae=W.useCallback(()=>we([te,F]),[we,te,F]);W.useEffect(()=>{oe&&Ae()},[oe,Ae]);const{onOpenChange:Ce,triggerPointerDownPosRef:me}=R;W.useEffect(()=>{if(F){let qe={x:0,y:0};const Ge=ot=>{var St,rt;qe={x:Math.abs(Math.round(ot.pageX)-(((St=me.current)==null?void 0:St.x)??0)),y:Math.abs(Math.round(ot.pageY)-(((rt=me.current)==null?void 0:rt.y)??0))}},je=ot=>{qe.x<=10&&qe.y<=10?ot.preventDefault():F.contains(ot.target)||Ce(!1),document.removeEventListener("pointermove",Ge),me.current=null};return me.current!==null&&(document.addEventListener("pointermove",Ge),document.addEventListener("pointerup",je,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Ge),document.removeEventListener("pointerup",je,{capture:!0})}}},[F,Ce,me]),W.useEffect(()=>{const qe=()=>Ce(!1);return window.addEventListener("blur",qe),window.addEventListener("resize",qe),()=>{window.removeEventListener("blur",qe),window.removeEventListener("resize",qe)}},[Ce]);const[Pe,ye]=Jne(qe=>{const Ge=ee().filter(St=>!St.disabled),je=Ge.find(St=>St.ref.current===document.activeElement),ot=Qne(Ge,qe,je);ot&&setTimeout(()=>ot.ref.current.focus())}),pe=W.useCallback((qe,Ge,je)=>{const ot=!xe.current&&!je;(R.value!==void 0&&R.value===Ge||ot)&&(ae(qe),ot&&(xe.current=!0))},[R.value]),Ie=W.useCallback(()=>F==null?void 0:F.focus(),[F]),tt=W.useCallback((qe,Ge,je)=>{const ot=!xe.current&&!je;(R.value!==void 0&&R.value===Ge||ot)&&ie(qe)},[R.value]),Ze=n==="popper"?T3:Dne,Le=Ze===T3?{side:i,sideOffset:g,align:_,alignOffset:S,arrowPadding:E,collisionBoundary:T,collisionPadding:C,sticky:N,hideWhenDetached:I,avoidCollisions:j}:{};return m.jsx(Nne,{scope:r,content:F,viewport:U,onViewportChange:Z,itemRefCallback:pe,selectedItem:te,onItemLeave:Ie,itemTextRefCallback:tt,focusSelectedItem:Ae,selectedItemText:ne,position:n,isPositioned:oe,searchRef:Pe,children:m.jsx(LT,{as:UPe,allowPinchZoom:!0,children:m.jsx(DT,{asChild:!0,trapped:R.open,onMountAutoFocus:qe=>{qe.preventDefault()},onUnmountAutoFocus:Rr(o,qe=>{var Ge;(Ge=R.trigger)==null||Ge.focus({preventScroll:!0}),qe.preventDefault()}),children:m.jsx(Pv,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:qe=>qe.preventDefault(),onDismiss:()=>R.onOpenChange(!1),children:m.jsx(Ze,{role:"listbox",id:R.contentId,"data-state":R.open?"open":"closed",dir:R.dir,onContextMenu:qe=>qe.preventDefault(),...D,...Le,onPlaced:()=>de(!0),ref:J,style:{display:"flex",flexDirection:"column",outline:"none",...D.style},onKeyDown:Rr(D.onKeyDown,qe=>{const Ge=qe.ctrlKey||qe.altKey||qe.metaKey;if(qe.key==="Tab"&&qe.preventDefault(),!Ge&&qe.key.length===1&&ye(qe.key),["ArrowUp","ArrowDown","Home","End"].includes(qe.key)){let ot=ee().filter(St=>!St.disabled).map(St=>St.ref.current);if(["ArrowUp","End"].includes(qe.key)&&(ot=ot.slice().reverse()),["ArrowUp","ArrowDown"].includes(qe.key)){const St=qe.target,rt=ot.indexOf(St);ot=ot.slice(rt+1)}setTimeout(()=>we(ot)),qe.preventDefault()}})})})})})})});Mne.displayName=$Pe;var VPe="SelectItemAlignedPosition",Dne=W.forwardRef((e,t)=>{const{__scopeSelect:r,onPlaced:n,...o}=e,l=lg(gv,r),d=cg(gv,r),[i,g]=W.useState(null),[_,S]=W.useState(null),E=fi(t,J=>S(J)),T=UI(r),C=W.useRef(!1),N=W.useRef(!0),{viewport:I,selectedItem:j,selectedItemText:D,focusSelectedItem:R}=d,F=W.useCallback(()=>{if(l.trigger&&l.valueNode&&i&&_&&I&&j&&D){const J=l.trigger.getBoundingClientRect(),te=_.getBoundingClientRect(),ae=l.valueNode.getBoundingClientRect(),ne=D.getBoundingClientRect();if(l.dir!=="rtl"){const St=ne.left-te.left,rt=ae.left-St,Ut=J.left-rt,Ft=J.width+Ut,dr=Math.max(Ft,te.width),Lr=window.innerWidth-sd,Jr=w3(rt,[sd,Math.max(sd,Lr-dr)]);i.style.minWidth=Ft+"px",i.style.left=Jr+"px"}else{const St=te.right-ne.right,rt=window.innerWidth-ae.right-St,Ut=window.innerWidth-J.right-rt,Ft=J.width+Ut,dr=Math.max(Ft,te.width),Lr=window.innerWidth-sd,Jr=w3(rt,[sd,Math.max(sd,Lr-dr)]);i.style.minWidth=Ft+"px",i.style.right=Jr+"px"}const ie=T(),ee=window.innerHeight-sd*2,oe=I.scrollHeight,de=window.getComputedStyle(_),xe=parseInt(de.borderTopWidth,10),we=parseInt(de.paddingTop,10),Ae=parseInt(de.borderBottomWidth,10),Ce=parseInt(de.paddingBottom,10),me=xe+we+oe+Ce+Ae,Pe=Math.min(j.offsetHeight*5,me),ye=window.getComputedStyle(I),pe=parseInt(ye.paddingTop,10),Ie=parseInt(ye.paddingBottom,10),tt=J.top+J.height/2-sd,Ze=ee-tt,Le=j.offsetHeight/2,qe=j.offsetTop+Le,Ge=xe+we+qe,je=me-Ge;if(Ge<=tt){const St=ie.length>0&&j===ie[ie.length-1].ref.current;i.style.bottom="0px";const rt=_.clientHeight-I.offsetTop-I.offsetHeight,Ut=Math.max(Ze,Le+(St?Ie:0)+rt+Ae),Ft=Ge+Ut;i.style.height=Ft+"px"}else{const St=ie.length>0&&j===ie[0].ref.current;i.style.top="0px";const Ut=Math.max(tt,xe+I.offsetTop+(St?pe:0)+Le)+je;i.style.height=Ut+"px",I.scrollTop=Ge-tt+I.offsetTop}i.style.margin=`${sd}px 0`,i.style.minHeight=Pe+"px",i.style.maxHeight=ee+"px",n==null||n(),requestAnimationFrame(()=>C.current=!0)}},[T,l.trigger,l.valueNode,i,_,I,j,D,l.dir,n]);Ro(()=>F(),[F]);const[B,U]=W.useState();Ro(()=>{_&&U(window.getComputedStyle(_).zIndex)},[_]);const Z=W.useCallback(J=>{J&&N.current===!0&&(F(),R==null||R(),N.current=!1)},[F,R]);return m.jsx(WPe,{scope:r,contentWrapper:i,shouldExpandOnScrollRef:C,onScrollButtonChange:Z,children:m.jsx("div",{ref:g,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:B},children:m.jsx(wn.div,{...o,ref:E,style:{boxSizing:"border-box",maxHeight:"100%",...o.style}})})})});Dne.displayName=VPe;var qPe="SelectPopperPosition",T3=W.forwardRef((e,t)=>{const{__scopeSelect:r,align:n="start",collisionPadding:o=sd,...l}=e,d=VI(r);return m.jsx(fI,{...d,...l,ref:t,align:n,collisionPadding:o,style:{boxSizing:"border-box",...l.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});T3.displayName=qPe;var[WPe,k4]=jb(gv,{}),A3="SelectViewport",Lne=W.forwardRef((e,t)=>{const{__scopeSelect:r,nonce:n,...o}=e,l=cg(A3,r),d=k4(A3,r),i=fi(t,l.onViewportChange),g=W.useRef(0);return m.jsxs(m.Fragment,{children:[m.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),m.jsx($I.Slot,{scope:r,children:m.jsx(wn.div,{"data-radix-select-viewport":"",role:"presentation",...o,ref:i,style:{position:"relative",flex:1,overflow:"hidden auto",...o.style},onScroll:Rr(o.onScroll,_=>{const S=_.currentTarget,{contentWrapper:E,shouldExpandOnScrollRef:T}=d;if(T!=null&&T.current&&E){const C=Math.abs(g.current-S.scrollTop);if(C>0){const N=window.innerHeight-sd*2,I=parseFloat(E.style.minHeight),j=parseFloat(E.style.height),D=Math.max(I,j);if(D<N){const R=D+C,F=Math.min(N,R),B=R-F;E.style.height=F+"px",E.style.bottom==="0px"&&(S.scrollTop=B>0?B:0,E.style.justifyContent="flex-end")}}}g.current=S.scrollTop})})})]})});Lne.displayName=A3;var Fne="SelectGroup",[GPe,HPe]=jb(Fne),KPe=W.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,o=Kc();return m.jsx(GPe,{scope:r,id:o,children:m.jsx(wn.div,{role:"group","aria-labelledby":o,...n,ref:t})})});KPe.displayName=Fne;var zne="SelectLabel",Bne=W.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,o=HPe(zne,r);return m.jsx(wn.div,{id:o.id,...n,ref:t})});Bne.displayName=zne;var AO="SelectItem",[ZPe,$ne]=jb(AO),Une=W.forwardRef((e,t)=>{const{__scopeSelect:r,value:n,disabled:o=!1,textValue:l,...d}=e,i=lg(AO,r),g=cg(AO,r),_=i.value===n,[S,E]=W.useState(l??""),[T,C]=W.useState(!1),N=fi(t,R=>{var F;return(F=g.itemRefCallback)==null?void 0:F.call(g,R,n,o)}),I=Kc(),j=W.useRef("touch"),D=()=>{o||(i.onValueChange(n),i.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return m.jsx(ZPe,{scope:r,value:n,disabled:o,textId:I,isSelected:_,onItemTextChange:W.useCallback(R=>{E(F=>F||((R==null?void 0:R.textContent)??"").trim())},[]),children:m.jsx($I.ItemSlot,{scope:r,value:n,disabled:o,textValue:S,children:m.jsx(wn.div,{role:"option","aria-labelledby":I,"data-highlighted":T?"":void 0,"aria-selected":_&&T,"data-state":_?"checked":"unchecked","aria-disabled":o||void 0,"data-disabled":o?"":void 0,tabIndex:o?void 0:-1,...d,ref:N,onFocus:Rr(d.onFocus,()=>C(!0)),onBlur:Rr(d.onBlur,()=>C(!1)),onClick:Rr(d.onClick,()=>{j.current!=="mouse"&&D()}),onPointerUp:Rr(d.onPointerUp,()=>{j.current==="mouse"&&D()}),onPointerDown:Rr(d.onPointerDown,R=>{j.current=R.pointerType}),onPointerMove:Rr(d.onPointerMove,R=>{var F;j.current=R.pointerType,o?(F=g.onItemLeave)==null||F.call(g):j.current==="mouse"&&R.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Rr(d.onPointerLeave,R=>{var F;R.currentTarget===document.activeElement&&((F=g.onItemLeave)==null||F.call(g))}),onKeyDown:Rr(d.onKeyDown,R=>{var B;((B=g.searchRef)==null?void 0:B.current)!==""&&R.key===" "||(NPe.includes(R.key)&&D(),R.key===" "&&R.preventDefault())})})})})});Une.displayName=AO;var jS="SelectItemText",Vne=W.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:o,...l}=e,d=lg(jS,r),i=cg(jS,r),g=$ne(jS,r),_=FPe(jS,r),[S,E]=W.useState(null),T=fi(t,D=>E(D),g.onItemTextChange,D=>{var R;return(R=i.itemTextRefCallback)==null?void 0:R.call(i,D,g.value,g.disabled)}),C=S==null?void 0:S.textContent,N=W.useMemo(()=>m.jsx("option",{value:g.value,disabled:g.disabled,children:C},g.value),[g.disabled,g.value,C]),{onNativeOptionAdd:I,onNativeOptionRemove:j}=_;return Ro(()=>(I(N),()=>j(N)),[I,j,N]),m.jsxs(m.Fragment,{children:[m.jsx(wn.span,{id:g.textId,...l,ref:T}),g.isSelected&&d.valueNode&&!d.valueNodeHasChildren?tg.createPortal(l.children,d.valueNode):null]})});Vne.displayName=jS;var qne="SelectItemIndicator",Wne=W.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return $ne(qne,r).isSelected?m.jsx(wn.span,{"aria-hidden":!0,...n,ref:t}):null});Wne.displayName=qne;var P3="SelectScrollUpButton",Gne=W.forwardRef((e,t)=>{const r=cg(P3,e.__scopeSelect),n=k4(P3,e.__scopeSelect),[o,l]=W.useState(!1),d=fi(t,n.onScrollButtonChange);return Ro(()=>{if(r.viewport&&r.isPositioned){let i=function(){const _=g.scrollTop>0;l(_)};const g=r.viewport;return i(),g.addEventListener("scroll",i),()=>g.removeEventListener("scroll",i)}},[r.viewport,r.isPositioned]),o?m.jsx(Kne,{...e,ref:d,onAutoScroll:()=>{const{viewport:i,selectedItem:g}=r;i&&g&&(i.scrollTop=i.scrollTop-g.offsetHeight)}}):null});Gne.displayName=P3;var C3="SelectScrollDownButton",Hne=W.forwardRef((e,t)=>{const r=cg(C3,e.__scopeSelect),n=k4(C3,e.__scopeSelect),[o,l]=W.useState(!1),d=fi(t,n.onScrollButtonChange);return Ro(()=>{if(r.viewport&&r.isPositioned){let i=function(){const _=g.scrollHeight-g.clientHeight,S=Math.ceil(g.scrollTop)<_;l(S)};const g=r.viewport;return i(),g.addEventListener("scroll",i),()=>g.removeEventListener("scroll",i)}},[r.viewport,r.isPositioned]),o?m.jsx(Kne,{...e,ref:d,onAutoScroll:()=>{const{viewport:i,selectedItem:g}=r;i&&g&&(i.scrollTop=i.scrollTop+g.offsetHeight)}}):null});Hne.displayName=C3;var Kne=W.forwardRef((e,t)=>{const{__scopeSelect:r,onAutoScroll:n,...o}=e,l=cg("SelectScrollButton",r),d=W.useRef(null),i=UI(r),g=W.useCallback(()=>{d.current!==null&&(window.clearInterval(d.current),d.current=null)},[]);return W.useEffect(()=>()=>g(),[g]),Ro(()=>{var S;const _=i().find(E=>E.ref.current===document.activeElement);(S=_==null?void 0:_.ref.current)==null||S.scrollIntoView({block:"nearest"})},[i]),m.jsx(wn.div,{"aria-hidden":!0,...o,ref:t,style:{flexShrink:0,...o.style},onPointerDown:Rr(o.onPointerDown,()=>{d.current===null&&(d.current=window.setInterval(n,50))}),onPointerMove:Rr(o.onPointerMove,()=>{var _;(_=l.onItemLeave)==null||_.call(l),d.current===null&&(d.current=window.setInterval(n,50))}),onPointerLeave:Rr(o.onPointerLeave,()=>{g()})})}),XPe="SelectSeparator",Zne=W.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return m.jsx(wn.div,{"aria-hidden":!0,...n,ref:t})});Zne.displayName=XPe;var O3="SelectArrow",YPe=W.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,o=VI(r),l=lg(O3,r),d=cg(O3,r);return l.open&&d.position==="popper"?m.jsx(pI,{...o,...n,ref:t}):null});YPe.displayName=O3;var JPe="SelectBubbleInput",Xne=W.forwardRef(({__scopeSelect:e,value:t,...r},n)=>{const o=W.useRef(null),l=fi(n,o),d=O4(t);return W.useEffect(()=>{const i=o.current;if(!i)return;const g=window.HTMLSelectElement.prototype,S=Object.getOwnPropertyDescriptor(g,"value").set;if(d!==t&&S){const E=new Event("change",{bubbles:!0});S.call(i,t),i.dispatchEvent(E)}},[d,t]),m.jsx(wn.select,{...r,style:{...IY,...r.style},ref:l,defaultValue:t})});Xne.displayName=JPe;function Yne(e){return e===""||e===void 0}function Jne(e){const t=Io(e),r=W.useRef(""),n=W.useRef(0),o=W.useCallback(d=>{const i=r.current+d;t(i),function g(_){r.current=_,window.clearTimeout(n.current),_!==""&&(n.current=window.setTimeout(()=>g(""),1e3))}(i)},[t]),l=W.useCallback(()=>{r.current="",window.clearTimeout(n.current)},[]);return W.useEffect(()=>()=>window.clearTimeout(n.current),[]),[r,o,l]}function Qne(e,t,r){const o=t.length>1&&Array.from(t).every(_=>_===t[0])?t[0]:t,l=r?e.indexOf(r):-1;let d=QPe(e,Math.max(l,0));o.length===1&&(d=d.filter(_=>_!==r));const g=d.find(_=>_.textValue.toLowerCase().startsWith(o.toLowerCase()));return g!==r?g:void 0}function QPe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var eCe=Ane,eie=Cne,tCe=kne,rCe=Ine,nCe=Rne,tie=jne,iCe=Lne,rie=Bne,nie=Une,aCe=Vne,oCe=Wne,iie=Gne,aie=Hne,oie=Zne;const wd=eCe,Sd=tCe,Cu=W.forwardRef(({className:e,children:t,...r},n)=>m.jsxs(eie,{ref:n,className:yr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...r,children:[t,m.jsx(rCe,{asChild:!0,children:m.jsx(ev,{className:"h-4 w-4 opacity-50"})})]}));Cu.displayName=eie.displayName;const sie=W.forwardRef(({className:e,...t},r)=>m.jsx(iie,{ref:r,className:yr("flex cursor-default items-center justify-center py-1",e),...t,children:m.jsx(fye,{className:"h-4 w-4"})}));sie.displayName=iie.displayName;const lie=W.forwardRef(({className:e,...t},r)=>m.jsx(aie,{ref:r,className:yr("flex cursor-default items-center justify-center py-1",e),...t,children:m.jsx(ev,{className:"h-4 w-4"})}));lie.displayName=aie.displayName;const Ou=W.forwardRef(({className:e,children:t,position:r="popper",...n},o)=>m.jsx(nCe,{children:m.jsxs(tie,{ref:o,className:yr("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...n,children:[m.jsx(sie,{}),m.jsx(iCe,{className:yr("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),m.jsx(lie,{})]})}));Ou.displayName=tie.displayName;const sCe=W.forwardRef(({className:e,...t},r)=>m.jsx(rie,{ref:r,className:yr("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));sCe.displayName=rie.displayName;const Fa=W.forwardRef(({className:e,children:t,...r},n)=>m.jsxs(nie,{ref:n,className:yr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...r,children:[m.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:m.jsx(oCe,{children:m.jsx(Af,{className:"h-4 w-4"})})}),m.jsx(aCe,{children:t})]}));Fa.displayName=nie.displayName;const lCe=W.forwardRef(({className:e,...t},r)=>m.jsx(oie,{ref:r,className:yr("-mx-1 my-1 h-px bg-muted",e),...t}));lCe.displayName=oie.displayName;var cCe="Label",cie=W.forwardRef((e,t)=>m.jsx(wn.label,{...e,ref:t,onMouseDown:r=>{var o;r.target.closest("button, input, select, textarea")||((o=e.onMouseDown)==null||o.call(e,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));cie.displayName=cCe;var uie=cie;const uCe=wb("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Vr=W.forwardRef(({className:e,...t},r)=>m.jsx(uie,{ref:r,className:yr(uCe(),e),...t}));Vr.displayName=uie.displayName;const Nh=JB,jv=QB,dCe=e4,die=W.forwardRef(({className:e,...t},r)=>m.jsx(FT,{ref:r,className:yr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));die.displayName=FT.displayName;const Rd=W.forwardRef(({className:e,children:t,...r},n)=>m.jsxs(dCe,{children:[m.jsx(die,{}),m.jsxs(zT,{ref:n,className:yr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[t,m.jsxs(PI,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[m.jsx(ju,{className:"h-4 w-4"}),m.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Rd.displayName=zT.displayName;const jd=({className:e,...t})=>m.jsx("div",{className:yr("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});jd.displayName="DialogHeader";const I4=({className:e,...t})=>m.jsx("div",{className:yr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});I4.displayName="DialogFooter";const Nd=W.forwardRef(({className:e,...t},r)=>m.jsx(BT,{ref:r,className:yr("text-lg font-semibold leading-none tracking-tight",e),...t}));Nd.displayName=BT.displayName;const Md=W.forwardRef(({className:e,...t},r)=>m.jsx($T,{ref:r,className:yr("text-sm text-muted-foreground",e),...t}));Md.displayName=$T.displayName;var hie="AlertDialog",[hCe,Qet]=Zs(hie,[qee]),Gf=qee(),fie=e=>{const{__scopeAlertDialog:t,...r}=e,n=Gf(t);return m.jsx(JB,{...n,...r,modal:!0})};fie.displayName=hie;var fCe="AlertDialogTrigger",pie=W.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,o=Gf(r);return m.jsx(QB,{...o,...n,ref:t})});pie.displayName=fCe;var pCe="AlertDialogPortal",mie=e=>{const{__scopeAlertDialog:t,...r}=e,n=Gf(t);return m.jsx(e4,{...n,...r})};mie.displayName=pCe;var mCe="AlertDialogOverlay",gie=W.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,o=Gf(r);return m.jsx(FT,{...o,...n,ref:t})});gie.displayName=mCe;var a0="AlertDialogContent",[gCe,yCe]=hCe(a0),vCe=PY("AlertDialogContent"),yie=W.forwardRef((e,t)=>{const{__scopeAlertDialog:r,children:n,...o}=e,l=Gf(r),d=W.useRef(null),i=fi(t,d),g=W.useRef(null);return m.jsx(_Se,{contentName:a0,titleName:vie,docsSlug:"alert-dialog",children:m.jsx(gCe,{scope:r,cancelRef:g,children:m.jsxs(zT,{role:"alertdialog",...l,...o,ref:i,onOpenAutoFocus:Rr(o.onOpenAutoFocus,_=>{var S;_.preventDefault(),(S=g.current)==null||S.focus({preventScroll:!0})}),onPointerDownOutside:_=>_.preventDefault(),onInteractOutside:_=>_.preventDefault(),children:[m.jsx(vCe,{children:n}),m.jsx(xCe,{contentRef:d})]})})})});yie.displayName=a0;var vie="AlertDialogTitle",_ie=W.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,o=Gf(r);return m.jsx(BT,{...o,...n,ref:t})});_ie.displayName=vie;var xie="AlertDialogDescription",bie=W.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,o=Gf(r);return m.jsx($T,{...o,...n,ref:t})});bie.displayName=xie;var _Ce="AlertDialogAction",wie=W.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,o=Gf(r);return m.jsx(PI,{...o,...n,ref:t})});wie.displayName=_Ce;var Sie="AlertDialogCancel",Eie=W.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,{cancelRef:o}=yCe(Sie,r),l=Gf(r),d=fi(t,o);return m.jsx(PI,{...l,...n,ref:d})});Eie.displayName=Sie;var xCe=({contentRef:e})=>{const t=`\`${a0}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${a0}\` by passing a \`${xie}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${a0}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return W.useEffect(()=>{var n;document.getElementById((n=e.current)==null?void 0:n.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},bCe=fie,wCe=pie,SCe=mie,Tie=gie,Aie=yie,Pie=wie,Cie=Eie,Oie=_ie,kie=bie;const Bl=bCe,NE=wCe,ECe=SCe,Iie=W.forwardRef(({className:e,...t},r)=>m.jsx(Tie,{className:yr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));Iie.displayName=Tie.displayName;const sl=W.forwardRef(({className:e,...t},r)=>m.jsxs(ECe,{children:[m.jsx(Iie,{}),m.jsx(Aie,{ref:r,className:yr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));sl.displayName=Aie.displayName;const ll=({className:e,...t})=>m.jsx("div",{className:yr("flex flex-col space-y-2 text-center sm:text-left",e),...t});ll.displayName="AlertDialogHeader";const cl=({className:e,...t})=>m.jsx("div",{className:yr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});cl.displayName="AlertDialogFooter";const ul=W.forwardRef(({className:e,...t},r)=>m.jsx(Oie,{ref:r,className:yr("text-lg font-semibold",e),...t}));ul.displayName=Oie.displayName;const dl=W.forwardRef(({className:e,...t},r)=>m.jsx(kie,{ref:r,className:yr("text-sm text-muted-foreground",e),...t}));dl.displayName=kie.displayName;const Vs=W.forwardRef(({className:e,...t},r)=>m.jsx(Pie,{ref:r,className:yr(M0(),e),...t}));Vs.displayName=Pie.displayName;const hl=W.forwardRef(({className:e,...t},r)=>m.jsx(Cie,{ref:r,className:yr(M0({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));hl.displayName=Cie.displayName;var TCe=Object.defineProperty,ACe=Object.defineProperties,PCe=Object.getOwnPropertyDescriptors,PO=Object.getOwnPropertySymbols,Rie=Object.prototype.hasOwnProperty,jie=Object.prototype.propertyIsEnumerable,dW=(e,t,r)=>t in e?TCe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,CCe=(e,t)=>{for(var r in t||(t={}))Rie.call(t,r)&&dW(e,r,t[r]);if(PO)for(var r of PO(t))jie.call(t,r)&&dW(e,r,t[r]);return e},OCe=(e,t)=>ACe(e,PCe(t)),kCe=(e,t)=>{var r={};for(var n in e)Rie.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&PO)for(var n of PO(e))t.indexOf(n)<0&&jie.call(e,n)&&(r[n]=e[n]);return r};function ICe(e){let t=setTimeout(e,0),r=setTimeout(e,10),n=setTimeout(e,50);return[t,r,n]}function RCe(e){let t=W.useRef();return W.useEffect(()=>{t.current=e}),t.current}var jCe=18,Nie=40,NCe=`${Nie}px`,MCe=["[data-lastpass-icon-root]","com-1password-button","[data-dashlanecreated]",'[style$="2147483647 !important;"]'].join(",");function DCe({containerRef:e,inputRef:t,pushPasswordManagerStrategy:r,isFocused:n}){let[o,l]=W.useState(!1),[d,i]=W.useState(!1),[g,_]=W.useState(!1),S=W.useMemo(()=>r==="none"?!1:(r==="increase-width"||r==="experimental-no-flickering")&&o&&d,[o,d,r]),E=W.useCallback(()=>{let T=e.current,C=t.current;if(!T||!C||g||r==="none")return;let N=T,I=N.getBoundingClientRect().left+N.offsetWidth,j=N.getBoundingClientRect().top+N.offsetHeight/2,D=I-jCe,R=j;document.querySelectorAll(MCe).length===0&&document.elementFromPoint(D,R)===T||(l(!0),_(!0))},[e,t,g,r]);return W.useEffect(()=>{let T=e.current;if(!T||r==="none")return;function C(){let I=window.innerWidth-T.getBoundingClientRect().right;i(I>=Nie)}C();let N=setInterval(C,1e3);return()=>{clearInterval(N)}},[e,r]),W.useEffect(()=>{let T=n||document.activeElement===t.current;if(r==="none"||!T)return;let C=setTimeout(E,0),N=setTimeout(E,2e3),I=setTimeout(E,5e3),j=setTimeout(()=>{_(!0)},6e3);return()=>{clearTimeout(C),clearTimeout(N),clearTimeout(I),clearTimeout(j)}},[t,n,r,E]),{hasPWMBadge:o,willPushPWMBadge:S,PWM_BADGE_SPACE_WIDTH:NCe}}var Mie=W.createContext({}),Die=W.forwardRef((e,t)=>{var r=e,{value:n,onChange:o,maxLength:l,textAlign:d="left",pattern:i,placeholder:g,inputMode:_="numeric",onComplete:S,pushPasswordManagerStrategy:E="increase-width",pasteTransformer:T,containerClassName:C,noScriptCSSFallback:N=LCe,render:I,children:j}=r,D=kCe(r,["value","onChange","maxLength","textAlign","pattern","placeholder","inputMode","onComplete","pushPasswordManagerStrategy","pasteTransformer","containerClassName","noScriptCSSFallback","render","children"]),R,F,B,U,Z;let[J,te]=W.useState(typeof D.defaultValue=="string"?D.defaultValue:""),ae=n??J,ne=RCe(ae),ie=W.useCallback(Ft=>{o==null||o(Ft),te(Ft)},[o]),ee=W.useMemo(()=>i?typeof i=="string"?new RegExp(i):i:null,[i]),oe=W.useRef(null),de=W.useRef(null),xe=W.useRef({value:ae,onChange:ie,isIOS:typeof window<"u"&&((F=(R=window==null?void 0:window.CSS)==null?void 0:R.supports)==null?void 0:F.call(R,"-webkit-touch-callout","none"))}),we=W.useRef({prev:[(B=oe.current)==null?void 0:B.selectionStart,(U=oe.current)==null?void 0:U.selectionEnd,(Z=oe.current)==null?void 0:Z.selectionDirection]});W.useImperativeHandle(t,()=>oe.current,[]),W.useEffect(()=>{let Ft=oe.current,dr=de.current;if(!Ft||!dr)return;xe.current.value!==Ft.value&&xe.current.onChange(Ft.value),we.current.prev=[Ft.selectionStart,Ft.selectionEnd,Ft.selectionDirection];function Lr(){if(document.activeElement!==Ft){pe(null),tt(null);return}let At=Ft.selectionStart,Xe=Ft.selectionEnd,ut=Ft.selectionDirection,dt=Ft.maxLength,rr=Ft.value,er=we.current.prev,tr=-1,Pr=-1,un;if(rr.length!==0&&At!==null&&Xe!==null){let Zi=At===Xe,js=At===rr.length&&rr.length<dt;if(Zi&&!js){let Va=At;if(Va===0)tr=0,Pr=1,un="forward";else if(Va===dt)tr=Va-1,Pr=Va,un="backward";else if(dt>1&&rr.length>1){let Si=0;if(er[0]!==null&&er[1]!==null){un=Va<er[1]?"backward":"forward";let bs=er[0]===er[1]&&er[0]<dt;un==="backward"&&!bs&&(Si=-1)}tr=Si+Va,Pr=Si+Va+1}}tr!==-1&&Pr!==-1&&tr!==Pr&&oe.current.setSelectionRange(tr,Pr,un)}let pn=tr!==-1?tr:At,Pi=Pr!==-1?Pr:Xe,gi=un??ut;pe(pn),tt(Pi),we.current.prev=[pn,Pi,gi]}if(document.addEventListener("selectionchange",Lr,{capture:!0}),Lr(),document.activeElement===Ft&&Pe(!0),!document.getElementById("input-otp-style")){let At=document.createElement("style");if(At.id="input-otp-style",document.head.appendChild(At),At.sheet){let Xe="background: transparent !important; color: transparent !important; border-color: transparent !important; opacity: 0 !important; box-shadow: none !important; -webkit-box-shadow: none !important; -webkit-text-fill-color: transparent !important;";uS(At.sheet,"[data-input-otp]::selection { background: transparent !important; color: transparent !important; }"),uS(At.sheet,`[data-input-otp]:autofill { ${Xe} }`),uS(At.sheet,`[data-input-otp]:-webkit-autofill { ${Xe} }`),uS(At.sheet,"@supports (-webkit-touch-callout: none) { [data-input-otp] { letter-spacing: -.6em !important; font-weight: 100 !important; font-stretch: ultra-condensed; font-optical-sizing: none !important; left: -1px !important; right: 1px !important; } }"),uS(At.sheet,"[data-input-otp] + * { pointer-events: all !important; }")}}let Jr=()=>{dr&&dr.style.setProperty("--root-height",`${Ft.clientHeight}px`)};Jr();let Rt=new ResizeObserver(Jr);return Rt.observe(Ft),()=>{document.removeEventListener("selectionchange",Lr,{capture:!0}),Rt.disconnect()}},[]);let[Ae,Ce]=W.useState(!1),[me,Pe]=W.useState(!1),[ye,pe]=W.useState(null),[Ie,tt]=W.useState(null);W.useEffect(()=>{ICe(()=>{var Ft,dr,Lr,Jr;(Ft=oe.current)==null||Ft.dispatchEvent(new Event("input"));let Rt=(dr=oe.current)==null?void 0:dr.selectionStart,At=(Lr=oe.current)==null?void 0:Lr.selectionEnd,Xe=(Jr=oe.current)==null?void 0:Jr.selectionDirection;Rt!==null&&At!==null&&(pe(Rt),tt(At),we.current.prev=[Rt,At,Xe])})},[ae,me]),W.useEffect(()=>{ne!==void 0&&ae!==ne&&ne.length<l&&ae.length===l&&(S==null||S(ae))},[l,S,ne,ae]);let Ze=DCe({containerRef:de,inputRef:oe,pushPasswordManagerStrategy:E,isFocused:me}),Le=W.useCallback(Ft=>{let dr=Ft.currentTarget.value.slice(0,l);if(dr.length>0&&ee&&!ee.test(dr)){Ft.preventDefault();return}typeof ne=="string"&&dr.length<ne.length&&document.dispatchEvent(new Event("selectionchange")),ie(dr)},[l,ie,ne,ee]),qe=W.useCallback(()=>{var Ft;if(oe.current){let dr=Math.min(oe.current.value.length,l-1),Lr=oe.current.value.length;(Ft=oe.current)==null||Ft.setSelectionRange(dr,Lr),pe(dr),tt(Lr)}Pe(!0)},[l]),Ge=W.useCallback(Ft=>{var dr,Lr;let Jr=oe.current;if(!T&&(!xe.current.isIOS||!Ft.clipboardData||!Jr))return;let Rt=Ft.clipboardData.getData("text/plain"),At=T?T(Rt):Rt;Ft.preventDefault();let Xe=(dr=oe.current)==null?void 0:dr.selectionStart,ut=(Lr=oe.current)==null?void 0:Lr.selectionEnd,dt=(Xe!==ut?ae.slice(0,Xe)+At+ae.slice(ut):ae.slice(0,Xe)+At+ae.slice(Xe)).slice(0,l);if(dt.length>0&&ee&&!ee.test(dt))return;Jr.value=dt,ie(dt);let rr=Math.min(dt.length,l-1),er=dt.length;Jr.setSelectionRange(rr,er),pe(rr),tt(er)},[l,ie,ee,ae]),je=W.useMemo(()=>({position:"relative",cursor:D.disabled?"default":"text",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"none"}),[D.disabled]),ot=W.useMemo(()=>({position:"absolute",inset:0,width:Ze.willPushPWMBadge?`calc(100% + ${Ze.PWM_BADGE_SPACE_WIDTH})`:"100%",clipPath:Ze.willPushPWMBadge?`inset(0 ${Ze.PWM_BADGE_SPACE_WIDTH} 0 0)`:void 0,height:"100%",display:"flex",textAlign:d,opacity:"1",color:"transparent",pointerEvents:"all",background:"transparent",caretColor:"transparent",border:"0 solid transparent",outline:"0 solid transparent",boxShadow:"none",lineHeight:"1",letterSpacing:"-.5em",fontSize:"var(--root-height)",fontFamily:"monospace",fontVariantNumeric:"tabular-nums"}),[Ze.PWM_BADGE_SPACE_WIDTH,Ze.willPushPWMBadge,d]),St=W.useMemo(()=>W.createElement("input",OCe(CCe({autoComplete:D.autoComplete||"one-time-code"},D),{"data-input-otp":!0,"data-input-otp-placeholder-shown":ae.length===0||void 0,"data-input-otp-mss":ye,"data-input-otp-mse":Ie,inputMode:_,pattern:ee==null?void 0:ee.source,"aria-placeholder":g,style:ot,maxLength:l,value:ae,ref:oe,onPaste:Ft=>{var dr;Ge(Ft),(dr=D.onPaste)==null||dr.call(D,Ft)},onChange:Le,onMouseOver:Ft=>{var dr;Ce(!0),(dr=D.onMouseOver)==null||dr.call(D,Ft)},onMouseLeave:Ft=>{var dr;Ce(!1),(dr=D.onMouseLeave)==null||dr.call(D,Ft)},onFocus:Ft=>{var dr;qe(),(dr=D.onFocus)==null||dr.call(D,Ft)},onBlur:Ft=>{var dr;Pe(!1),(dr=D.onBlur)==null||dr.call(D,Ft)}})),[Le,qe,Ge,_,ot,l,Ie,ye,D,ee==null?void 0:ee.source,ae]),rt=W.useMemo(()=>({slots:Array.from({length:l}).map((Ft,dr)=>{var Lr;let Jr=me&&ye!==null&&Ie!==null&&(ye===Ie&&dr===ye||dr>=ye&&dr<Ie),Rt=ae[dr]!==void 0?ae[dr]:null,At=ae[0]!==void 0?null:(Lr=g==null?void 0:g[dr])!=null?Lr:null;return{char:Rt,placeholderChar:At,isActive:Jr,hasFakeCaret:Jr&&Rt===null}}),isFocused:me,isHovering:!D.disabled&&Ae}),[me,Ae,l,Ie,ye,D.disabled,ae]),Ut=W.useMemo(()=>I?I(rt):W.createElement(Mie.Provider,{value:rt},j),[j,rt,I]);return W.createElement(W.Fragment,null,N!==null&&W.createElement("noscript",null,W.createElement("style",null,N)),W.createElement("div",{ref:de,"data-input-otp-container":!0,style:je,className:C},Ut,W.createElement("div",{style:{position:"absolute",inset:0,pointerEvents:"none"}},St)))});Die.displayName="Input";function uS(e,t){try{e.insertRule(t)}catch{console.error("input-otp could not insert CSS rule:",t)}}var LCe=`
[data-input-otp] {
  --nojs-bg: white !important;
  --nojs-fg: black !important;

  background-color: var(--nojs-bg) !important;
  color: var(--nojs-fg) !important;
  caret-color: var(--nojs-fg) !important;
  letter-spacing: .25em !important;
  text-align: center !important;
  border: 1px solid var(--nojs-fg) !important;
  border-radius: 4px !important;
  width: 100% !important;
}
@media (prefers-color-scheme: dark) {
  [data-input-otp] {
    --nojs-bg: black !important;
    --nojs-fg: white !important;
  }
}`;const R4=W.forwardRef(({className:e,containerClassName:t,...r},n)=>m.jsx(Die,{ref:n,containerClassName:yr("flex items-center gap-2 has-[:disabled]:opacity-50",t),className:yr("disabled:cursor-not-allowed",e),...r}));R4.displayName="InputOTP";const j4=W.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,className:yr("flex items-center",e),...t}));j4.displayName="InputOTPGroup";const bf=W.forwardRef(({index:e,className:t,...r},n)=>{const o=W.useContext(Mie),{char:l,hasFakeCaret:d,isActive:i}=o.slots[e];return m.jsxs("div",{ref:n,className:yr("relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",i&&"z-10 ring-2 ring-ring ring-offset-background",t),...r,children:[l,d&&m.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:m.jsx("div",{className:"animate-caret-blink h-4 w-px bg-foreground duration-1000"})})]})});bf.displayName="InputOTPSlot";const FCe=W.forwardRef(({...e},t)=>m.jsx("div",{ref:t,role:"separator",...e,children:m.jsx(_ye,{})}));FCe.displayName="InputOTPSeparator";const N4=({targetType:e,targetId:t,trigger:r})=>{const{t:n}=Ki(),{user:o}=Fi(),[l,d]=W.useState(!1),[i,g]=W.useState(!1),[_,S]=W.useState(!1),[E,T]=W.useState(""),[C,N]=W.useState(""),[I,j]=W.useState((o==null?void 0:o.email)||""),[D,R]=W.useState([""]),[F,B]=W.useState([]),[U,Z]=W.useState(!1),[J,te]=W.useState("form"),[ae,ne]=W.useState(""),[ie,ee]=W.useState(0),[oe,de]=W.useState(!1),xe=je=>{d(je),je&&(o!=null&&o.email)&&j(o.email),je||(te("form"),ne(""),ee(0))};W.useEffect(()=>{let je;return ie>0&&(je=setTimeout(()=>ee(ie-1),1e3)),()=>clearTimeout(je)},[ie]);const we=["spam","harassment","inappropriate_content","misinformation","copyright","fraud","hate_speech","violence","other"],Ae=()=>{R([...D,""])},Ce=je=>{R(D.filter((ot,St)=>St!==je))},me=(je,ot)=>{const St=[...D];St[je]=ot,R(St)},Pe=je=>{const ot=Array.from(je.target.files||[]);if(ot.filter(Ft=>Ft.size>5*1024*1024).length>0){Br.error(n("report.imageTooLarge"));return}const rt=["image/jpeg","image/png","image/webp","image/gif"];if(ot.filter(Ft=>!rt.includes(Ft.type)).length>0){Br.error(n("report.invalidImageType"));return}B(Ft=>[...Ft,...ot])},ye=je=>{B(ot=>ot.filter((St,rt)=>rt!==je))},pe=async()=>{if(F.length===0)return[];Z(!0);const je=[];try{for(const ot of F){const St=ot.name.split(".").pop(),Ut=`${`${Date.now()}-${Math.random().toString(36).substring(7)}.${St}`}`,{error:Ft}=await qt.storage.from("report-evidence").upload(Ut,ot);if(Ft)throw Ft;const{data:dr}=qt.storage.from("report-evidence").getPublicUrl(Ut);je.push(dr.publicUrl)}return je}catch(ot){throw console.error("Error uploading images:",ot),ot}finally{Z(!1)}},Ie=async()=>{if(!I.trim()){Br.error(n("report.contactRequired"));return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(I)){Br.error(n("report.invalidEmail"));return}de(!0);try{const{error:je}=await qt.functions.invoke("send-verification-code",{body:{email:I}});if(je){Br.error(n("auth.verificationCodeFailed")),console.error(je);return}te("verify"),Br.success(n("auth.verificationCodeSent")),ee(30)}catch(je){Br.error(je.message||n("error.general"))}finally{de(!1)}},tt=async()=>{ie>0||await Ie()},Ze=async()=>{if(ae.length!==4){Br.error(n("auth.invalidVerificationCode"));return}S(!0);try{const{data:je,error:ot}=await qt.functions.invoke("verify-email-code",{body:{email:I,code:ae}});if(ot||!(je!=null&&je.success)){(je==null?void 0:je.error)==="This verification code has already been used"?Br.error(n("auth.verificationCodeUsed")):Br.error((je==null?void 0:je.error)||n("auth.invalidVerificationCode")),S(!1);return}te("submitting"),await qe()}catch(je){Br.error(je.message||n("error.general")),S(!1)}},Le=async()=>{if(!E){Br.error(n("report.reasonPlaceholder"));return}if(!C||C.length<20){Br.error(n("report.detailsMin"));return}if(!I.trim()){Br.error(n("report.contactRequired"));return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(I)){Br.error(n("report.invalidEmail"));return}if(D.filter(ot=>ot.trim()!=="").length===0&&F.length===0){Br.error(n("report.evidenceRequired"));return}o?g(!0):await Ie()},qe=async()=>{S(!0);try{let je=[];try{je=await pe()}catch{Br.error(n("report.imageUploadFailed")),S(!1);return}const St=[...D.filter(Rt=>Rt.trim()!==""),...je],rt={reporter_id:(o==null?void 0:o.id)||null,target_type:e,target_id:t,reason:E,description:C,evidence_urls:St,reporter_contact:I};console.log("Attempting to insert report:",rt);const{data:Ut,error:Ft}=await qt.from("reports").insert(rt).select().single();if(console.log("Insert result:",{report:Ut,error:Ft}),Ft)throw Ft;let dr="Anonymous",Lr=I;if(o){const{data:Rt}=await qt.from("profiles").select("display_name").eq("id",o.id).single();dr=(Rt==null?void 0:Rt.display_name)||"Unknown",Lr=o.email||I}await qt.functions.invoke("send-report-email",{body:{reportId:Ut.id,reporterName:dr,reporterEmail:Lr,targetType:e,targetId:t,reason:E,description:C,evidenceUrls:St.length>0?St:void 0,reporterContact:I||void 0}});const Jr=Ut.id.substring(0,8).toUpperCase();Br.success(n("report.successDetailed",{reference:Jr}),{description:n("report.successDescription"),duration:8e3}),d(!1),g(!1),T(""),N(""),o||j(""),R([""]),B([]),te("form"),ne("")}catch(je){console.error("Error submitting report:",je),Br.error(n("report.failed"))}finally{S(!1)}},Ge=()=>{switch(e){case"comment":return n("report.reportComment");case"restaurant":return n("report.reportRestaurant");case"activity":return n("report.reportActivity");case"user":return n("report.reportUser");default:return n("report.title")}};return m.jsxs(m.Fragment,{children:[m.jsxs(Nh,{open:l,onOpenChange:xe,children:[m.jsx(jv,{asChild:!0,children:r||m.jsxs(ir,{variant:"ghost",size:"sm",children:[m.jsx(lI,{className:"w-4 h-4 mr-2"}),n("report.title")]})}),m.jsxs(Rd,{className:"max-w-[90vw] sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[m.jsxs(jd,{children:[m.jsx(Nd,{children:Ge()}),m.jsx(Md,{children:n(J==="verify"?"auth.verificationCodeSent":"report.description")})]}),J==="form"?m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"space-y-4 py-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"reason",children:n("report.reason")}),m.jsxs(wd,{value:E,onValueChange:T,children:[m.jsx(Cu,{children:m.jsx(Sd,{placeholder:n("report.reasonPlaceholder")})}),m.jsx(Ou,{children:we.map(je=>m.jsx(Fa,{value:je,children:n(`report.reasons.${je}`)},je))})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"description",children:n("report.detailsLabel")}),m.jsx(Lm,{id:"description",value:C,onChange:je=>N(je.target.value),placeholder:n("report.detailsPlaceholder"),rows:5,className:"resize-none"}),m.jsxs("p",{className:"text-xs text-muted-foreground",children:[C.length,"/20 ",n("common.characters")]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs(Vr,{htmlFor:"contact",children:[n("report.contactLabel"),m.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),m.jsx(en,{id:"contact",type:"email",value:I,onChange:je=>j(je.target.value),placeholder:n("report.contactPlaceholder"),required:!0})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs(Vr,{children:[n("report.evidenceLabel"),m.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),m.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:n("report.evidenceRequiredNote")}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"image-upload",className:"text-sm font-medium",children:n("report.uploadImages")}),m.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:F.map((je,ot)=>m.jsxs("div",{className:"relative group",children:[m.jsx("img",{src:URL.createObjectURL(je),alt:`Evidence ${ot+1}`,className:"w-20 h-20 object-cover rounded border"}),m.jsx(ir,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>ye(ot),children:m.jsx(ju,{className:"w-3 h-3"})})]},ot))}),m.jsx(en,{id:"image-upload",type:"file",accept:"image/jpeg,image/png,image/webp,image/gif",multiple:!0,onChange:Pe,className:"cursor-pointer"}),m.jsx("p",{className:"text-xs text-muted-foreground",children:n("report.imageUploadHint")})]}),m.jsxs("div",{className:"space-y-2 pt-2",children:[m.jsx(Vr,{className:"text-sm font-medium",children:n("report.evidenceUrls")}),D.map((je,ot)=>m.jsxs("div",{className:"flex gap-2",children:[m.jsx(en,{value:je,onChange:St=>me(ot,St.target.value),placeholder:n("report.evidencePlaceholder")}),D.length>1&&m.jsx(ir,{variant:"ghost",size:"icon",onClick:()=>Ce(ot),children:m.jsx(ju,{className:"w-4 h-4"})})]},ot)),m.jsxs(ir,{variant:"outline",size:"sm",onClick:Ae,className:"w-full",children:[m.jsx(_B,{className:"w-4 h-4 mr-2"}),n("report.addEvidence")]})]})]})]}),m.jsxs("div",{className:"flex justify-end gap-2",children:[m.jsx(ir,{variant:"outline",onClick:()=>d(!1),children:n("report.cancel")}),m.jsx(ir,{onClick:Le,disabled:!E||C.length<20||!I.trim()||D.filter(je=>je.trim()!=="").length===0&&F.length===0||U||oe,children:n(U?"common.uploading":oe?"auth.sendingCode":"report.submit")})]})]}):J==="submitting"?m.jsx("div",{className:"space-y-4 py-8",children:m.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4",children:[m.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"}),m.jsx("p",{className:"text-center text-muted-foreground",children:n("report.submitting")})]})}):m.jsxs("div",{className:"space-y-4 py-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{children:n("auth.verificationCode")}),m.jsx("div",{className:"flex justify-center",children:m.jsx(R4,{maxLength:4,value:ae,onChange:je=>ne(je),children:m.jsxs(j4,{children:[m.jsx(bf,{index:0}),m.jsx(bf,{index:1}),m.jsx(bf,{index:2}),m.jsx(bf,{index:3})]})})}),m.jsx("p",{className:"text-xs text-muted-foreground text-center",children:n("auth.verificationCodeHint",{email:I})})]}),m.jsx("div",{className:"flex justify-center",children:m.jsx(ir,{variant:"link",size:"sm",onClick:tt,disabled:ie>0||_,children:ie>0?`${n("auth.resendCode")} (${ie}s)`:n("auth.resendCode")})}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(ir,{variant:"outline",className:"w-full",onClick:()=>{te("form"),ne("")},disabled:_,children:n("common.back")}),m.jsx(ir,{className:"w-full",onClick:Ze,disabled:ae.length!==4||_,children:n(_?"auth.verifying":"auth.verify")})]})]})]})]}),m.jsx(Bl,{open:i,onOpenChange:g,children:m.jsxs(sl,{children:[m.jsxs(ll,{children:[m.jsx(ul,{children:n("report.confirmTitle")}),m.jsx(dl,{children:n("report.confirmMessage")})]}),m.jsxs(cl,{children:[m.jsx(hl,{children:n("report.cancel")}),m.jsx(Vs,{onClick:qe,disabled:_,children:n(_?"report.submitting":"report.submit")})]})]})})]})},hW=[{value:"0-5",label:"0-5"},{value:"5-10",label:"5-10"},{value:"10-15",label:"10-15"},{value:"15-20",label:"15-20"},{value:"20-25",label:"20-25"},{value:"25-30",label:"25-30"},{value:"30-40",label:"30-40"},{value:"40-50",label:"40-50"},{value:"50+",label:"50+"}],Lie=({restaurantId:e,targetType:t="restaurant"})=>{var Ie,tt;const{t:r}=Ki(),{user:n}=Fi(),{data:o}=d4(),{toast:l}=Sa(),[d,i]=W.useState(""),[g,_]=W.useState(0),[S,E]=W.useState(0),[T,C]=W.useState(""),[N,I]=W.useState(null),[j,D]=W.useState(""),[R,F]=W.useState(null),[B,U]=W.useState(null),[Z,J]=W.useState(null),[te,ae]=W.useState(null),[ne,ie]=W.useState(!1),{data:ee,isLoading:oe}=C4(e,t),de=OPe(),xe=kPe(),we=W.useCallback(async Ze=>{try{const Le=Ze.name.split(".").pop(),Ge=`${`${n==null?void 0:n.id}-${Date.now()}.${Le}`}`,{error:je,data:ot}=await qt.storage.from("comment-images").upload(Ge,Ze);if(je)throw je;const{data:{publicUrl:St}}=qt.storage.from("comment-images").getPublicUrl(Ge);return St}catch(Le){return console.error("Error uploading image:",Le),l({title:r("common.error"),description:r("restaurant.imageUploadFailed"),variant:"destructive"}),null}},[n,l,r]),Ae=W.useCallback((Ze,Le=!1)=>{var Ge;const qe=(Ge=Ze.target.files)==null?void 0:Ge[0];if(qe){if(qe.size>5*1024*1024){l({title:r("common.error"),description:r("restaurant.imageTooLarge"),variant:"destructive"});return}Le?(J(qe),ae(URL.createObjectURL(qe))):(F(qe),U(URL.createObjectURL(qe)))}},[l,r]),Ce=W.useCallback((Ze=!1)=>{Ze?(J(null),ae(null)):(F(null),U(null))},[]),me=W.useCallback(async()=>{if(!d.trim()||!n)return;if(t==="restaurant"&&!g){l({title:r("common.error"),description:r("toast.pleaseSelectRating"),variant:"destructive"});return}ie(!0);let Ze;if(R){const Le=await we(R);Le&&(Ze=Le)}await de.mutateAsync({targetId:e,targetType:t,content:d,ratingValue:t==="restaurant"?g:void 0,priceRange:t==="restaurant"&&T?T:void 0,imageUrl:Ze}),i(""),_(0),C(""),F(null),U(null),ie(!1)},[d,n,t,g,l,r,R,we,de,e,T]),Pe=W.useCallback(async Ze=>{if(!j.trim()||!n)return;ie(!0);let Le;if(Z){const qe=await we(Z);qe&&(Le=qe)}await de.mutateAsync({targetId:e,targetType:t,content:j,parentId:Ze,imageUrl:Le}),D(""),I(null),J(null),ae(null),ie(!1)},[j,n,Z,we,de,e,t]),ye=W.useCallback(async Ze=>{window.confirm(r("restaurant.confirmDelete"))&&await xe.mutateAsync(Ze)},[xe,r]),pe=W.memo(({comment:Ze,isReply:Le=!1})=>{var qe,Ge,je,ot,St;return m.jsxs("div",{className:`flex gap-2 sm:gap-3 ${Le?"ml-8 sm:ml-12 mt-3":""}`,children:[m.jsxs(Gm,{className:"w-8 h-8 sm:w-10 sm:h-10 shrink-0",children:[m.jsx(Hm,{src:(qe=Ze.profiles)==null?void 0:qe.avatar_url}),m.jsx(Km,{className:"text-xs sm:text-sm",children:((je=(Ge=Ze.profiles)==null?void 0:Ge.display_name)==null?void 0:je.charAt(0).toUpperCase())||"U"})]}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[m.jsx("span",{className:"font-semibold text-xs sm:text-sm truncate",children:(ot=Ze.profiles)==null?void 0:ot.display_name}),m.jsx("span",{className:"text-xs text-muted-foreground shrink-0",children:og(new Date(Ze.created_at),{addSuffix:!0})}),Ze.edited&&m.jsxs("span",{className:"text-xs text-muted-foreground italic",children:["(",r("restaurant.edited"),")"]})]}),!Le&&Ze.rating_value&&m.jsxs("div",{className:"flex items-center gap-3 mt-1 mb-2",children:[m.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(rt=>m.jsx(Ec,{className:yr("w-4 h-4",rt<=Ze.rating_value?"fill-accent text-accent":"text-muted-foreground")},rt))}),Ze.price_range&&m.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[m.jsx(OL,{className:"w-3 h-3"}),m.jsx("span",{children:(St=hW.find(rt=>rt.value===Ze.price_range))==null?void 0:St.label})]})]}),m.jsx("p",{className:"text-xs sm:text-sm mt-1 text-foreground break-words",children:Ze.content}),Ze.image_url&&m.jsx("img",{src:Ze.image_url,alt:"Comment attachment",className:"mt-2 rounded-lg max-w-full sm:max-w-sm w-full"}),m.jsxs("div",{className:"flex gap-2 sm:gap-3 mt-2",children:[!Le&&n&&m.jsxs(ir,{variant:"ghost",size:"sm",onClick:()=>I(Ze.id),className:"h-7 text-xs px-2 sm:px-3",children:[m.jsx(Pye,{className:"w-3 h-3 mr-1"}),m.jsx("span",{className:"hidden xs:inline",children:r("restaurant.reply")})]}),(n==null?void 0:n.id)===Ze.user_id&&m.jsxs(ir,{variant:"ghost",size:"sm",onClick:()=>ye(Ze.id),className:"h-7 text-xs text-destructive hover:text-destructive px-2 sm:px-3",children:[m.jsx(Sb,{className:"w-3 h-3 mr-1"}),m.jsx("span",{className:"hidden xs:inline",children:r("common.delete")})]}),n&&n.id!==Ze.user_id&&m.jsx(N4,{targetType:"comment",targetId:Ze.id,trigger:m.jsxs(ir,{variant:"ghost",size:"sm",className:"h-7 text-xs px-2 sm:px-3",children:[m.jsx(lI,{className:"w-3 h-3 mr-1"}),m.jsx("span",{className:"hidden xs:inline",children:r("report.title")})]})})]}),N===Ze.id&&m.jsx("div",{className:"mt-3 space-y-2",children:m.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[m.jsxs("div",{className:"flex-1 space-y-2",children:[m.jsx(Lm,{value:j,onChange:rt=>D(rt.target.value),placeholder:r("restaurant.writeReply"),className:"min-h-[80px] text-sm"}),te&&m.jsxs("div",{className:"relative inline-block max-w-full",children:[m.jsx("img",{src:te,alt:"Preview",className:"max-w-full sm:max-w-xs rounded-lg"}),m.jsx(ir,{size:"icon",variant:"destructive",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full",onClick:()=>Ce(!0),children:m.jsx(ju,{className:"h-4 w-4"})})]})]}),m.jsxs("div",{className:"flex sm:flex-col gap-2",children:[m.jsx(ir,{size:"sm",onClick:()=>Pe(Ze.id),disabled:!j.trim()||ne,className:"text-xs",children:r(ne?"common.loading":"restaurant.reply")}),m.jsx(en,{type:"file",accept:"image/*",onChange:rt=>Ae(rt,!0),className:"hidden",id:`reply-image-${Ze.id}`,disabled:ne}),m.jsxs(ir,{size:"sm",variant:"outline",onClick:()=>{var rt;return(rt=document.getElementById(`reply-image-${Ze.id}`))==null?void 0:rt.click()},disabled:ne,className:"text-xs sm:px-3",children:[m.jsx(Tq,{className:"h-4 w-4 sm:mr-1"}),m.jsx("span",{className:"hidden sm:inline",children:r("restaurant.addImage")})]}),m.jsx(ir,{size:"sm",variant:"outline",onClick:()=>{I(null),D(""),Ce(!0)},className:"text-xs",children:r("common.cancel")})]})]})}),Ze.replies&&Ze.replies.length>0&&m.jsx("div",{className:"mt-3 space-y-3",children:Ze.replies.map(rt=>m.jsx(pe,{comment:rt,isReply:!0},rt.id))})]})]})});return pe.displayName="CommentItem",oe?m.jsx("div",{className:"text-center py-8",children:r("common.loading")}):m.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(vB,{className:"w-4 sm:w-5 h-4 sm:h-5"}),m.jsxs("h2",{className:"text-xl sm:text-2xl font-bold",children:[r("restaurant.reviews")," (",(ee==null?void 0:ee.length)||0,")"]})]}),n?m.jsx(rn,{children:m.jsx(ln,{className:"pt-4 sm:pt-6 px-3 sm:px-6",children:m.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[m.jsxs(Gm,{className:"w-8 h-8 sm:w-10 sm:h-10 shrink-0",children:[m.jsx(Hm,{src:(o==null?void 0:o.avatar_url)||void 0}),m.jsx(Km,{className:"text-xs sm:text-sm",children:((Ie=o==null?void 0:o.display_name)==null?void 0:Ie.charAt(0).toUpperCase())||((tt=n==null?void 0:n.email)==null?void 0:tt.charAt(0).toUpperCase())||"U"})]}),m.jsxs("div",{className:"flex-1 space-y-2 sm:space-y-3 min-w-0",children:[t==="restaurant"&&m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[m.jsx(Ec,{className:"w-4 h-4 text-accent"})," ",m.jsx("span",{className:"text-destructive",children:"*"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[[1,2,3,4,5].map(Ze=>m.jsx("button",{type:"button",onMouseEnter:()=>E(Ze),onMouseLeave:()=>E(0),onClick:()=>_(Ze),className:"transition-transform hover:scale-110",children:m.jsx(Ec,{className:yr("w-7 h-7 cursor-pointer transition-colors",Ze<=(S||g)?"fill-accent text-accent":"text-muted-foreground hover:text-accent")})},Ze)),g>0&&m.jsxs("span",{className:"ml-2 text-sm text-muted-foreground",children:["(",g,"/5)"]})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[m.jsx(OL,{className:"w-4 h-4"}),r("restaurant.priceRange")]}),m.jsxs(wd,{value:T,onValueChange:C,children:[m.jsx(Cu,{className:"w-full",children:m.jsx(Sd,{placeholder:r("restaurant.selectPriceRange")})}),m.jsx(Ou,{className:"bg-background",children:hW.map(Ze=>m.jsx(Fa,{value:Ze.value,children:Ze.label},Ze.value))})]})]})]}),m.jsx(Lm,{value:d,onChange:Ze=>i(Ze.target.value),placeholder:r("restaurant.writeComment"),className:"min-h-[80px] sm:min-h-[100px] text-sm"}),B&&m.jsxs("div",{className:"relative inline-block max-w-full",children:[m.jsx("img",{src:B,alt:"Preview",className:"max-w-full sm:max-w-xs rounded-lg"}),m.jsx(ir,{size:"icon",variant:"destructive",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full",onClick:()=>Ce(!1),children:m.jsx(ju,{className:"h-4 w-4"})})]}),m.jsxs("div",{className:"flex flex-wrap gap-2",children:[m.jsx(en,{type:"file",accept:"image/*",onChange:Ze=>Ae(Ze,!1),className:"hidden",id:"comment-image",disabled:ne}),m.jsxs(ir,{variant:"outline",size:"sm",onClick:()=>{var Ze;return(Ze=document.getElementById("comment-image"))==null?void 0:Ze.click()},disabled:ne,className:"text-xs",children:[m.jsx(Tq,{className:"h-4 w-4 sm:mr-2"}),m.jsx("span",{className:"hidden sm:inline",children:r("restaurant.addImage")})]}),m.jsx(ir,{onClick:me,disabled:!d.trim()||de.isPending||ne,size:"sm",className:"text-xs",children:ne||de.isPending?r("common.loading"):r("restaurant.postComment")})]})]})]})})}):m.jsx(rn,{children:m.jsx(ln,{className:"py-4 sm:py-6 px-3 sm:px-6 text-center text-muted-foreground text-sm",children:r("restaurant.signInToComment")})}),m.jsx("div",{className:"space-y-4 sm:space-y-6",children:ee==null?void 0:ee.map(Ze=>m.jsx(rn,{children:m.jsx(Di,{className:"p-3 sm:p-6",children:m.jsx(pe,{comment:Ze})})},Ze.id))}),(ee==null?void 0:ee.length)===0&&m.jsx(rn,{children:m.jsx(ln,{className:"py-8 sm:py-12 px-3 sm:px-6 text-center text-muted-foreground text-sm",children:r("restaurant.noComments")})})]})},KT=()=>{const{user:e}=Fi();return Li({queryKey:["merchantRestaurants",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await qt.from("merchant_restaurants").select(`
          restaurant_id,
          restaurants:restaurant_id (
            id,
            name,
            name_en,
            name_pt,
            address,
            image_url,
            lat,
            lng,
            rating,
            type,
            type_en,
            type_pt,
            phone,
            website_url,
            description,
            description_en,
            description_pt,
            opening_hours,
            show_website_button,
            created_at,
            updated_at
          )
        `).eq("user_id",e.id);if(r)throw r;return(t==null?void 0:t.map(n=>n.restaurants).filter(Boolean))||[]},enabled:!!e})},zCe=e=>{const{user:t}=Fi(),{data:r=[]}=KT();return Li({queryKey:["myParticipatingRestaurants",e,t==null?void 0:t.id],queryFn:async()=>{if(!t||r.length===0)return[];const n=r.map(d=>d.id),{data:o,error:l}=await qt.from("activity_restaurants").select("restaurant_id").eq("activity_id",e).in("restaurant_id",n);if(l)throw l;return(o==null?void 0:o.map(d=>d.restaurant_id))||[]},enabled:!!t&&!!e&&r.length>0})},BCe=()=>{const{user:e}=Fi(),{toast:t}=Sa(),r=Ma();return Ya({mutationFn:async({activityId:n,restaurantId:o})=>{if(!e)throw new Error("User not authenticated");const{data:l}=await qt.from("activity_restaurants").select("id").eq("activity_id",n).eq("restaurant_id",o).maybeSingle();if(l){const{error:d}=await qt.from("activity_restaurants").delete().eq("id",l.id);if(d)throw d;return{action:"removed"}}else{const{error:d}=await qt.from("activity_restaurants").insert({activity_id:n,restaurant_id:o});if(d)throw d;return{action:"added"}}},onSuccess:n=>{r.invalidateQueries({queryKey:["activityRestaurants"]}),r.invalidateQueries({queryKey:["myParticipatingRestaurants"]}),t({title:jr.t(n.action==="added"?"toast.restaurantJoined":"toast.restaurantLeft"),description:jr.t(n.action==="added"?"toast.restaurantJoinedDesc":"toast.restaurantLeftDesc")})},onError:()=>{t({title:jr.t("toast.participationUpdateFailed"),description:jr.t("toast.participationUpdateFailedDesc"),variant:"destructive"})}})};var ZT=e=>e.type==="checkbox",Ly=e=>e instanceof Date,zl=e=>e==null;const Fie=e=>typeof e=="object";var zo=e=>!zl(e)&&!Array.isArray(e)&&Fie(e)&&!Ly(e),zie=e=>zo(e)&&e.target?ZT(e.target)?e.target.checked:e.target.value:e,$Ce=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,Bie=(e,t)=>e.has($Ce(t)),UCe=e=>{const t=e.constructor&&e.constructor.prototype;return zo(t)&&t.hasOwnProperty("isPrototypeOf")},M4=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function hs(e){let t;const r=Array.isArray(e),n=typeof FileList<"u"?e instanceof FileList:!1;if(e instanceof Date)t=new Date(e);else if(!(M4&&(e instanceof Blob||n))&&(r||zo(e)))if(t=r?[]:{},!r&&!UCe(e))t=e;else for(const o in e)e.hasOwnProperty(o)&&(t[o]=hs(e[o]));else return e;return t}var qI=e=>/^\w*$/.test(e),Mo=e=>e===void 0,D4=e=>Array.isArray(e)?e.filter(Boolean):[],L4=e=>D4(e.replace(/["|']|\]/g,"").split(/\.|\[/)),tn=(e,t,r)=>{if(!t||!zo(e))return r;const n=(qI(t)?[t]:L4(t)).reduce((o,l)=>zl(o)?o:o[l],e);return Mo(n)||n===e?Mo(e[t])?r:e[t]:n},Bc=e=>typeof e=="boolean",Ra=(e,t,r)=>{let n=-1;const o=qI(t)?[t]:L4(t),l=o.length,d=l-1;for(;++n<l;){const i=o[n];let g=r;if(n!==d){const _=e[i];g=zo(_)||Array.isArray(_)?_:isNaN(+o[n+1])?{}:[]}if(i==="__proto__"||i==="constructor"||i==="prototype")return;e[i]=g,e=e[i]}};const CO={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},yd={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},cf={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},F4=He.createContext(null);F4.displayName="HookFormContext";const WI=()=>He.useContext(F4),VCe=e=>{const{children:t,...r}=e;return He.createElement(F4.Provider,{value:r},t)};var $ie=(e,t,r,n=!0)=>{const o={defaultValues:t._defaultValues};for(const l in e)Object.defineProperty(o,l,{get:()=>{const d=l;return t._proxyFormState[d]!==yd.all&&(t._proxyFormState[d]=!n||yd.all),r&&(r[d]=!0),e[d]}});return o};const z4=typeof window<"u"?He.useLayoutEffect:He.useEffect;function qCe(e){const t=WI(),{control:r=t.control,disabled:n,name:o,exact:l}=e||{},[d,i]=He.useState(r._formState),g=He.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return z4(()=>r._subscribe({name:o,formState:g.current,exact:l,callback:_=>{!n&&i({...r._formState,..._})}}),[o,n,l]),He.useEffect(()=>{g.current.isValid&&r._setValid(!0)},[r]),He.useMemo(()=>$ie(d,r,g.current,!1),[d,r])}var ph=e=>typeof e=="string",Uie=(e,t,r,n,o)=>ph(e)?(n&&t.watch.add(e),tn(r,e,o)):Array.isArray(e)?e.map(l=>(n&&t.watch.add(l),tn(r,l))):(n&&(t.watchAll=!0),r),k3=e=>zl(e)||!Fie(e);function vf(e,t,r=new WeakSet){if(k3(e)||k3(t))return e===t;if(Ly(e)&&Ly(t))return e.getTime()===t.getTime();const n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length)return!1;if(r.has(e)||r.has(t))return!0;r.add(e),r.add(t);for(const l of n){const d=e[l];if(!o.includes(l))return!1;if(l!=="ref"){const i=t[l];if(Ly(d)&&Ly(i)||zo(d)&&zo(i)||Array.isArray(d)&&Array.isArray(i)?!vf(d,i,r):d!==i)return!1}}return!0}function WCe(e){const t=WI(),{control:r=t.control,name:n,defaultValue:o,disabled:l,exact:d,compute:i}=e||{},g=He.useRef(o),_=He.useRef(i),S=He.useRef(void 0);_.current=i;const E=He.useMemo(()=>r._getWatch(n,g.current),[r,n]),[T,C]=He.useState(_.current?_.current(E):E);return z4(()=>r._subscribe({name:n,formState:{values:!0},exact:d,callback:N=>{if(!l){const I=Uie(n,r._names,N.values||r._formValues,!1,g.current);if(_.current){const j=_.current(I);vf(j,S.current)||(C(j),S.current=j)}else C(I)}}}),[r,l,n,d]),He.useEffect(()=>r._removeUnmounted()),T}function GCe(e){const t=WI(),{name:r,disabled:n,control:o=t.control,shouldUnregister:l,defaultValue:d}=e,i=Bie(o._names.array,r),g=He.useMemo(()=>tn(o._formValues,r,tn(o._defaultValues,r,d)),[o,r,d]),_=WCe({control:o,name:r,defaultValue:g,exact:!0}),S=qCe({control:o,name:r,exact:!0}),E=He.useRef(e),T=He.useRef(o.register(r,{...e.rules,value:_,...Bc(e.disabled)?{disabled:e.disabled}:{}}));E.current=e;const C=He.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!tn(S.errors,r)},isDirty:{enumerable:!0,get:()=>!!tn(S.dirtyFields,r)},isTouched:{enumerable:!0,get:()=>!!tn(S.touchedFields,r)},isValidating:{enumerable:!0,get:()=>!!tn(S.validatingFields,r)},error:{enumerable:!0,get:()=>tn(S.errors,r)}}),[S,r]),N=He.useCallback(R=>T.current.onChange({target:{value:zie(R),name:r},type:CO.CHANGE}),[r]),I=He.useCallback(()=>T.current.onBlur({target:{value:tn(o._formValues,r),name:r},type:CO.BLUR}),[r,o._formValues]),j=He.useCallback(R=>{const F=tn(o._fields,r);F&&R&&(F._f.ref={focus:()=>R.focus&&R.focus(),select:()=>R.select&&R.select(),setCustomValidity:B=>R.setCustomValidity(B),reportValidity:()=>R.reportValidity()})},[o._fields,r]),D=He.useMemo(()=>({name:r,value:_,...Bc(n)||S.disabled?{disabled:S.disabled||n}:{},onChange:N,onBlur:I,ref:j}),[r,n,S.disabled,N,I,j,_]);return He.useEffect(()=>{const R=o._options.shouldUnregister||l;o.register(r,{...E.current.rules,...Bc(E.current.disabled)?{disabled:E.current.disabled}:{}});const F=(B,U)=>{const Z=tn(o._fields,B);Z&&Z._f&&(Z._f.mount=U)};if(F(r,!0),R){const B=hs(tn(o._options.defaultValues,r));Ra(o._defaultValues,r,B),Mo(tn(o._formValues,r))&&Ra(o._formValues,r,B)}return!i&&o.register(r),()=>{(i?R&&!o._state.action:R)?o.unregister(r):F(r,!1)}},[r,o,i,l]),He.useEffect(()=>{o._setDisabledField({disabled:n,name:r})},[n,r,o]),He.useMemo(()=>({field:D,formState:S,fieldState:C}),[D,S,C])}const NS=e=>e.render(GCe(e));var Vie=(e,t,r,n,o)=>t?{...r[e],types:{...r[e]&&r[e].types?r[e].types:{},[n]:o||!0}}:{},YS=e=>Array.isArray(e)?e:[e],fW=()=>{let e=[];return{get observers(){return e},next:o=>{for(const l of e)l.next&&l.next(o)},subscribe:o=>(e.push(o),{unsubscribe:()=>{e=e.filter(l=>l!==o)}}),unsubscribe:()=>{e=[]}}},hc=e=>zo(e)&&!Object.keys(e).length,B4=e=>e.type==="file",vd=e=>typeof e=="function",OO=e=>{if(!M4)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},qie=e=>e.type==="select-multiple",$4=e=>e.type==="radio",HCe=e=>$4(e)||ZT(e),YM=e=>OO(e)&&e.isConnected;function KCe(e,t){const r=t.slice(0,-1).length;let n=0;for(;n<r;)e=Mo(e)?n++:e[t[n++]];return e}function ZCe(e){for(const t in e)if(e.hasOwnProperty(t)&&!Mo(e[t]))return!1;return!0}function Zo(e,t){const r=Array.isArray(t)?t:qI(t)?[t]:L4(t),n=r.length===1?e:KCe(e,r),o=r.length-1,l=r[o];return n&&delete n[l],o!==0&&(zo(n)&&hc(n)||Array.isArray(n)&&ZCe(n))&&Zo(e,r.slice(0,-1)),e}var Wie=e=>{for(const t in e)if(vd(e[t]))return!0;return!1};function kO(e,t={}){const r=Array.isArray(e);if(zo(e)||r)for(const n in e)Array.isArray(e[n])||zo(e[n])&&!Wie(e[n])?(t[n]=Array.isArray(e[n])?[]:{},kO(e[n],t[n])):zl(e[n])||(t[n]=!0);return t}function Gie(e,t,r){const n=Array.isArray(e);if(zo(e)||n)for(const o in e)Array.isArray(e[o])||zo(e[o])&&!Wie(e[o])?Mo(t)||k3(r[o])?r[o]=Array.isArray(e[o])?kO(e[o],[]):{...kO(e[o])}:Gie(e[o],zl(t)?{}:t[o],r[o]):r[o]=!vf(e[o],t[o]);return r}var dS=(e,t)=>Gie(e,t,kO(t));const pW={value:!1,isValid:!1},mW={value:!0,isValid:!0};var Hie=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(r=>r&&r.checked&&!r.disabled).map(r=>r.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!Mo(e[0].attributes.value)?Mo(e[0].value)||e[0].value===""?mW:{value:e[0].value,isValid:!0}:mW:pW}return pW},Kie=(e,{valueAsNumber:t,valueAsDate:r,setValueAs:n})=>Mo(e)?e:t?e===""?NaN:e&&+e:r&&ph(e)?new Date(e):n?n(e):e;const gW={isValid:!1,value:null};var Zie=e=>Array.isArray(e)?e.reduce((t,r)=>r&&r.checked&&!r.disabled?{isValid:!0,value:r.value}:t,gW):gW;function yW(e){const t=e.ref;return B4(t)?t.files:$4(t)?Zie(e.refs).value:qie(t)?[...t.selectedOptions].map(({value:r})=>r):ZT(t)?Hie(e.refs).value:Kie(Mo(t.value)?e.ref.value:t.value,e)}var XCe=(e,t,r,n)=>{const o={};for(const l of e){const d=tn(t,l);d&&Ra(o,l,d._f)}return{criteriaMode:r,names:[...e],fields:o,shouldUseNativeValidation:n}},IO=e=>e instanceof RegExp,hS=e=>Mo(e)?e:IO(e)?e.source:zo(e)?IO(e.value)?e.value.source:e.value:e,vW=e=>({isOnSubmit:!e||e===yd.onSubmit,isOnBlur:e===yd.onBlur,isOnChange:e===yd.onChange,isOnAll:e===yd.all,isOnTouch:e===yd.onTouched});const _W="AsyncFunction";var YCe=e=>!!e&&!!e.validate&&!!(vd(e.validate)&&e.validate.constructor.name===_W||zo(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===_W)),JCe=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate),xW=(e,t,r)=>!r&&(t.watchAll||t.watch.has(e)||[...t.watch].some(n=>e.startsWith(n)&&/^\.\w+/.test(e.slice(n.length))));const JS=(e,t,r,n)=>{for(const o of r||Object.keys(e)){const l=tn(e,o);if(l){const{_f:d,...i}=l;if(d){if(d.refs&&d.refs[0]&&t(d.refs[0],o)&&!n)return!0;if(d.ref&&t(d.ref,d.name)&&!n)return!0;if(JS(i,t))break}else if(zo(i)&&JS(i,t))break}}};function bW(e,t,r){const n=tn(e,r);if(n||qI(r))return{error:n,name:r};const o=r.split(".");for(;o.length;){const l=o.join("."),d=tn(t,l),i=tn(e,l);if(d&&!Array.isArray(d)&&r!==l)return{name:r};if(i&&i.type)return{name:l,error:i};if(i&&i.root&&i.root.type)return{name:`${l}.root`,error:i.root};o.pop()}return{name:r}}var QCe=(e,t,r,n)=>{r(e);const{name:o,...l}=e;return hc(l)||Object.keys(l).length>=Object.keys(t).length||Object.keys(l).find(d=>t[d]===(!n||yd.all))},eOe=(e,t,r)=>!e||!t||e===t||YS(e).some(n=>n&&(r?n===t:n.startsWith(t)||t.startsWith(n))),tOe=(e,t,r,n,o)=>o.isOnAll?!1:!r&&o.isOnTouch?!(t||e):(r?n.isOnBlur:o.isOnBlur)?!e:(r?n.isOnChange:o.isOnChange)?e:!0,rOe=(e,t)=>!D4(tn(e,t)).length&&Zo(e,t),nOe=(e,t,r)=>{const n=YS(tn(e,r));return Ra(n,"root",t[r]),Ra(e,r,n),e},AC=e=>ph(e);function wW(e,t,r="validate"){if(AC(e)||Array.isArray(e)&&e.every(AC)||Bc(e)&&!e)return{type:r,message:AC(e)?e:"",ref:t}}var wx=e=>zo(e)&&!IO(e)?e:{value:e,message:""},SW=async(e,t,r,n,o,l)=>{const{ref:d,refs:i,required:g,maxLength:_,minLength:S,min:E,max:T,pattern:C,validate:N,name:I,valueAsNumber:j,mount:D}=e._f,R=tn(r,I);if(!D||t.has(I))return{};const F=i?i[0]:d,B=ee=>{o&&F.reportValidity&&(F.setCustomValidity(Bc(ee)?"":ee||""),F.reportValidity())},U={},Z=$4(d),J=ZT(d),te=Z||J,ae=(j||B4(d))&&Mo(d.value)&&Mo(R)||OO(d)&&d.value===""||R===""||Array.isArray(R)&&!R.length,ne=Vie.bind(null,I,n,U),ie=(ee,oe,de,xe=cf.maxLength,we=cf.minLength)=>{const Ae=ee?oe:de;U[I]={type:ee?xe:we,message:Ae,ref:d,...ne(ee?xe:we,Ae)}};if(l?!Array.isArray(R)||!R.length:g&&(!te&&(ae||zl(R))||Bc(R)&&!R||J&&!Hie(i).isValid||Z&&!Zie(i).isValid)){const{value:ee,message:oe}=AC(g)?{value:!!g,message:g}:wx(g);if(ee&&(U[I]={type:cf.required,message:oe,ref:F,...ne(cf.required,oe)},!n))return B(oe),U}if(!ae&&(!zl(E)||!zl(T))){let ee,oe;const de=wx(T),xe=wx(E);if(!zl(R)&&!isNaN(R)){const we=d.valueAsNumber||R&&+R;zl(de.value)||(ee=we>de.value),zl(xe.value)||(oe=we<xe.value)}else{const we=d.valueAsDate||new Date(R),Ae=Pe=>new Date(new Date().toDateString()+" "+Pe),Ce=d.type=="time",me=d.type=="week";ph(de.value)&&R&&(ee=Ce?Ae(R)>Ae(de.value):me?R>de.value:we>new Date(de.value)),ph(xe.value)&&R&&(oe=Ce?Ae(R)<Ae(xe.value):me?R<xe.value:we<new Date(xe.value))}if((ee||oe)&&(ie(!!ee,de.message,xe.message,cf.max,cf.min),!n))return B(U[I].message),U}if((_||S)&&!ae&&(ph(R)||l&&Array.isArray(R))){const ee=wx(_),oe=wx(S),de=!zl(ee.value)&&R.length>+ee.value,xe=!zl(oe.value)&&R.length<+oe.value;if((de||xe)&&(ie(de,ee.message,oe.message),!n))return B(U[I].message),U}if(C&&!ae&&ph(R)){const{value:ee,message:oe}=wx(C);if(IO(ee)&&!R.match(ee)&&(U[I]={type:cf.pattern,message:oe,ref:d,...ne(cf.pattern,oe)},!n))return B(oe),U}if(N){if(vd(N)){const ee=await N(R,r),oe=wW(ee,F);if(oe&&(U[I]={...oe,...ne(cf.validate,oe.message)},!n))return B(oe.message),U}else if(zo(N)){let ee={};for(const oe in N){if(!hc(ee)&&!n)break;const de=wW(await N[oe](R,r),F,oe);de&&(ee={...de,...ne(oe,de.message)},B(de.message),n&&(U[I]=ee))}if(!hc(ee)&&(U[I]={ref:F,...ee},!n))return U}}return B(!0),U};const iOe={mode:yd.onSubmit,reValidateMode:yd.onChange,shouldFocusError:!0};function aOe(e={}){let t={...iOe,...e},r={submitCount:0,isDirty:!1,isReady:!1,isLoading:vd(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},n={},o=zo(t.defaultValues)||zo(t.values)?hs(t.defaultValues||t.values)||{}:{},l=t.shouldUnregister?{}:hs(o),d={action:!1,mount:!1,watch:!1},i={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},g,_=0;const S={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let E={...S};const T={array:fW(),state:fW()},C=t.criteriaMode===yd.all,N=Xe=>ut=>{clearTimeout(_),_=setTimeout(Xe,ut)},I=async Xe=>{if(!t.disabled&&(S.isValid||E.isValid||Xe)){const ut=t.resolver?hc((await J()).errors):await ae(n,!0);ut!==r.isValid&&T.state.next({isValid:ut})}},j=(Xe,ut)=>{!t.disabled&&(S.isValidating||S.validatingFields||E.isValidating||E.validatingFields)&&((Xe||Array.from(i.mount)).forEach(dt=>{dt&&(ut?Ra(r.validatingFields,dt,ut):Zo(r.validatingFields,dt))}),T.state.next({validatingFields:r.validatingFields,isValidating:!hc(r.validatingFields)}))},D=(Xe,ut=[],dt,rr,er=!0,tr=!0)=>{if(rr&&dt&&!t.disabled){if(d.action=!0,tr&&Array.isArray(tn(n,Xe))){const Pr=dt(tn(n,Xe),rr.argA,rr.argB);er&&Ra(n,Xe,Pr)}if(tr&&Array.isArray(tn(r.errors,Xe))){const Pr=dt(tn(r.errors,Xe),rr.argA,rr.argB);er&&Ra(r.errors,Xe,Pr),rOe(r.errors,Xe)}if((S.touchedFields||E.touchedFields)&&tr&&Array.isArray(tn(r.touchedFields,Xe))){const Pr=dt(tn(r.touchedFields,Xe),rr.argA,rr.argB);er&&Ra(r.touchedFields,Xe,Pr)}(S.dirtyFields||E.dirtyFields)&&(r.dirtyFields=dS(o,l)),T.state.next({name:Xe,isDirty:ie(Xe,ut),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else Ra(l,Xe,ut)},R=(Xe,ut)=>{Ra(r.errors,Xe,ut),T.state.next({errors:r.errors})},F=Xe=>{r.errors=Xe,T.state.next({errors:r.errors,isValid:!1})},B=(Xe,ut,dt,rr)=>{const er=tn(n,Xe);if(er){const tr=tn(l,Xe,Mo(dt)?tn(o,Xe):dt);Mo(tr)||rr&&rr.defaultChecked||ut?Ra(l,Xe,ut?tr:yW(er._f)):de(Xe,tr),d.mount&&I()}},U=(Xe,ut,dt,rr,er)=>{let tr=!1,Pr=!1;const un={name:Xe};if(!t.disabled){if(!dt||rr){(S.isDirty||E.isDirty)&&(Pr=r.isDirty,r.isDirty=un.isDirty=ie(),tr=Pr!==un.isDirty);const pn=vf(tn(o,Xe),ut);Pr=!!tn(r.dirtyFields,Xe),pn?Zo(r.dirtyFields,Xe):Ra(r.dirtyFields,Xe,!0),un.dirtyFields=r.dirtyFields,tr=tr||(S.dirtyFields||E.dirtyFields)&&Pr!==!pn}if(dt){const pn=tn(r.touchedFields,Xe);pn||(Ra(r.touchedFields,Xe,dt),un.touchedFields=r.touchedFields,tr=tr||(S.touchedFields||E.touchedFields)&&pn!==dt)}tr&&er&&T.state.next(un)}return tr?un:{}},Z=(Xe,ut,dt,rr)=>{const er=tn(r.errors,Xe),tr=(S.isValid||E.isValid)&&Bc(ut)&&r.isValid!==ut;if(t.delayError&&dt?(g=N(()=>R(Xe,dt)),g(t.delayError)):(clearTimeout(_),g=null,dt?Ra(r.errors,Xe,dt):Zo(r.errors,Xe)),(dt?!vf(er,dt):er)||!hc(rr)||tr){const Pr={...rr,...tr&&Bc(ut)?{isValid:ut}:{},errors:r.errors,name:Xe};r={...r,...Pr},T.state.next(Pr)}},J=async Xe=>{j(Xe,!0);const ut=await t.resolver(l,t.context,XCe(Xe||i.mount,n,t.criteriaMode,t.shouldUseNativeValidation));return j(Xe),ut},te=async Xe=>{const{errors:ut}=await J(Xe);if(Xe)for(const dt of Xe){const rr=tn(ut,dt);rr?Ra(r.errors,dt,rr):Zo(r.errors,dt)}else r.errors=ut;return ut},ae=async(Xe,ut,dt={valid:!0})=>{for(const rr in Xe){const er=Xe[rr];if(er){const{_f:tr,...Pr}=er;if(tr){const un=i.array.has(tr.name),pn=er._f&&YCe(er._f);pn&&S.validatingFields&&j([rr],!0);const Pi=await SW(er,i.disabled,l,C,t.shouldUseNativeValidation&&!ut,un);if(pn&&S.validatingFields&&j([rr]),Pi[tr.name]&&(dt.valid=!1,ut))break;!ut&&(tn(Pi,tr.name)?un?nOe(r.errors,Pi,tr.name):Ra(r.errors,tr.name,Pi[tr.name]):Zo(r.errors,tr.name))}!hc(Pr)&&await ae(Pr,ut,dt)}}return dt.valid},ne=()=>{for(const Xe of i.unMount){const ut=tn(n,Xe);ut&&(ut._f.refs?ut._f.refs.every(dt=>!YM(dt)):!YM(ut._f.ref))&&qe(Xe)}i.unMount=new Set},ie=(Xe,ut)=>!t.disabled&&(Xe&&ut&&Ra(l,Xe,ut),!vf(Pe(),o)),ee=(Xe,ut,dt)=>Uie(Xe,i,{...d.mount?l:Mo(ut)?o:ph(Xe)?{[Xe]:ut}:ut},dt,ut),oe=Xe=>D4(tn(d.mount?l:o,Xe,t.shouldUnregister?tn(o,Xe,[]):[])),de=(Xe,ut,dt={})=>{const rr=tn(n,Xe);let er=ut;if(rr){const tr=rr._f;tr&&(!tr.disabled&&Ra(l,Xe,Kie(ut,tr)),er=OO(tr.ref)&&zl(ut)?"":ut,qie(tr.ref)?[...tr.ref.options].forEach(Pr=>Pr.selected=er.includes(Pr.value)):tr.refs?ZT(tr.ref)?tr.refs.forEach(Pr=>{(!Pr.defaultChecked||!Pr.disabled)&&(Array.isArray(er)?Pr.checked=!!er.find(un=>un===Pr.value):Pr.checked=er===Pr.value||!!er)}):tr.refs.forEach(Pr=>Pr.checked=Pr.value===er):B4(tr.ref)?tr.ref.value="":(tr.ref.value=er,tr.ref.type||T.state.next({name:Xe,values:hs(l)})))}(dt.shouldDirty||dt.shouldTouch)&&U(Xe,er,dt.shouldTouch,dt.shouldDirty,!0),dt.shouldValidate&&me(Xe)},xe=(Xe,ut,dt)=>{for(const rr in ut){if(!ut.hasOwnProperty(rr))return;const er=ut[rr],tr=Xe+"."+rr,Pr=tn(n,tr);(i.array.has(Xe)||zo(er)||Pr&&!Pr._f)&&!Ly(er)?xe(tr,er,dt):de(tr,er,dt)}},we=(Xe,ut,dt={})=>{const rr=tn(n,Xe),er=i.array.has(Xe),tr=hs(ut);Ra(l,Xe,tr),er?(T.array.next({name:Xe,values:hs(l)}),(S.isDirty||S.dirtyFields||E.isDirty||E.dirtyFields)&&dt.shouldDirty&&T.state.next({name:Xe,dirtyFields:dS(o,l),isDirty:ie(Xe,tr)})):rr&&!rr._f&&!zl(tr)?xe(Xe,tr,dt):de(Xe,tr,dt),xW(Xe,i)&&T.state.next({...r,name:Xe}),T.state.next({name:d.mount?Xe:void 0,values:hs(l)})},Ae=async Xe=>{d.mount=!0;const ut=Xe.target;let dt=ut.name,rr=!0;const er=tn(n,dt),tr=pn=>{rr=Number.isNaN(pn)||Ly(pn)&&isNaN(pn.getTime())||vf(pn,tn(l,dt,pn))},Pr=vW(t.mode),un=vW(t.reValidateMode);if(er){let pn,Pi;const gi=ut.type?yW(er._f):zie(Xe),Zi=Xe.type===CO.BLUR||Xe.type===CO.FOCUS_OUT,js=!JCe(er._f)&&!t.resolver&&!tn(r.errors,dt)&&!er._f.deps||tOe(Zi,tn(r.touchedFields,dt),r.isSubmitted,un,Pr),Va=xW(dt,i,Zi);Ra(l,dt,gi),Zi?(er._f.onBlur&&er._f.onBlur(Xe),g&&g(0)):er._f.onChange&&er._f.onChange(Xe);const Si=U(dt,gi,Zi),bs=!hc(Si)||Va;if(!Zi&&T.state.next({name:dt,type:Xe.type,values:hs(l)}),js)return(S.isValid||E.isValid)&&(t.mode==="onBlur"?Zi&&I():Zi||I()),bs&&T.state.next({name:dt,...Va?{}:Si});if(!Zi&&Va&&T.state.next({...r}),t.resolver){const{errors:Bo}=await J([dt]);if(tr(gi),rr){const Ns=bW(r.errors,n,dt),$o=bW(Bo,n,Ns.name||dt);pn=$o.error,dt=$o.name,Pi=hc(Bo)}}else j([dt],!0),pn=(await SW(er,i.disabled,l,C,t.shouldUseNativeValidation))[dt],j([dt]),tr(gi),rr&&(pn?Pi=!1:(S.isValid||E.isValid)&&(Pi=await ae(n,!0)));rr&&(er._f.deps&&me(er._f.deps),Z(dt,Pi,pn,Si))}},Ce=(Xe,ut)=>{if(tn(r.errors,ut)&&Xe.focus)return Xe.focus(),1},me=async(Xe,ut={})=>{let dt,rr;const er=YS(Xe);if(t.resolver){const tr=await te(Mo(Xe)?Xe:er);dt=hc(tr),rr=Xe?!er.some(Pr=>tn(tr,Pr)):dt}else Xe?(rr=(await Promise.all(er.map(async tr=>{const Pr=tn(n,tr);return await ae(Pr&&Pr._f?{[tr]:Pr}:Pr)}))).every(Boolean),!(!rr&&!r.isValid)&&I()):rr=dt=await ae(n);return T.state.next({...!ph(Xe)||(S.isValid||E.isValid)&&dt!==r.isValid?{}:{name:Xe},...t.resolver||!Xe?{isValid:dt}:{},errors:r.errors}),ut.shouldFocus&&!rr&&JS(n,Ce,Xe?er:i.mount),rr},Pe=Xe=>{const ut={...d.mount?l:o};return Mo(Xe)?ut:ph(Xe)?tn(ut,Xe):Xe.map(dt=>tn(ut,dt))},ye=(Xe,ut)=>({invalid:!!tn((ut||r).errors,Xe),isDirty:!!tn((ut||r).dirtyFields,Xe),error:tn((ut||r).errors,Xe),isValidating:!!tn(r.validatingFields,Xe),isTouched:!!tn((ut||r).touchedFields,Xe)}),pe=Xe=>{Xe&&YS(Xe).forEach(ut=>Zo(r.errors,ut)),T.state.next({errors:Xe?r.errors:{}})},Ie=(Xe,ut,dt)=>{const rr=(tn(n,Xe,{_f:{}})._f||{}).ref,er=tn(r.errors,Xe)||{},{ref:tr,message:Pr,type:un,...pn}=er;Ra(r.errors,Xe,{...pn,...ut,ref:rr}),T.state.next({name:Xe,errors:r.errors,isValid:!1}),dt&&dt.shouldFocus&&rr&&rr.focus&&rr.focus()},tt=(Xe,ut)=>vd(Xe)?T.state.subscribe({next:dt=>"values"in dt&&Xe(ee(void 0,ut),dt)}):ee(Xe,ut,!0),Ze=Xe=>T.state.subscribe({next:ut=>{eOe(Xe.name,ut.name,Xe.exact)&&QCe(ut,Xe.formState||S,Jr,Xe.reRenderRoot)&&Xe.callback({values:{...l},...r,...ut,defaultValues:o})}}).unsubscribe,Le=Xe=>(d.mount=!0,E={...E,...Xe.formState},Ze({...Xe,formState:E})),qe=(Xe,ut={})=>{for(const dt of Xe?YS(Xe):i.mount)i.mount.delete(dt),i.array.delete(dt),ut.keepValue||(Zo(n,dt),Zo(l,dt)),!ut.keepError&&Zo(r.errors,dt),!ut.keepDirty&&Zo(r.dirtyFields,dt),!ut.keepTouched&&Zo(r.touchedFields,dt),!ut.keepIsValidating&&Zo(r.validatingFields,dt),!t.shouldUnregister&&!ut.keepDefaultValue&&Zo(o,dt);T.state.next({values:hs(l)}),T.state.next({...r,...ut.keepDirty?{isDirty:ie()}:{}}),!ut.keepIsValid&&I()},Ge=({disabled:Xe,name:ut})=>{(Bc(Xe)&&d.mount||Xe||i.disabled.has(ut))&&(Xe?i.disabled.add(ut):i.disabled.delete(ut))},je=(Xe,ut={})=>{let dt=tn(n,Xe);const rr=Bc(ut.disabled)||Bc(t.disabled);return Ra(n,Xe,{...dt||{},_f:{...dt&&dt._f?dt._f:{ref:{name:Xe}},name:Xe,mount:!0,...ut}}),i.mount.add(Xe),dt?Ge({disabled:Bc(ut.disabled)?ut.disabled:t.disabled,name:Xe}):B(Xe,!0,ut.value),{...rr?{disabled:ut.disabled||t.disabled}:{},...t.progressive?{required:!!ut.required,min:hS(ut.min),max:hS(ut.max),minLength:hS(ut.minLength),maxLength:hS(ut.maxLength),pattern:hS(ut.pattern)}:{},name:Xe,onChange:Ae,onBlur:Ae,ref:er=>{if(er){je(Xe,ut),dt=tn(n,Xe);const tr=Mo(er.value)&&er.querySelectorAll&&er.querySelectorAll("input,select,textarea")[0]||er,Pr=HCe(tr),un=dt._f.refs||[];if(Pr?un.find(pn=>pn===tr):tr===dt._f.ref)return;Ra(n,Xe,{_f:{...dt._f,...Pr?{refs:[...un.filter(YM),tr,...Array.isArray(tn(o,Xe))?[{}]:[]],ref:{type:tr.type,name:Xe}}:{ref:tr}}}),B(Xe,!1,void 0,tr)}else dt=tn(n,Xe,{}),dt._f&&(dt._f.mount=!1),(t.shouldUnregister||ut.shouldUnregister)&&!(Bie(i.array,Xe)&&d.action)&&i.unMount.add(Xe)}}},ot=()=>t.shouldFocusError&&JS(n,Ce,i.mount),St=Xe=>{Bc(Xe)&&(T.state.next({disabled:Xe}),JS(n,(ut,dt)=>{const rr=tn(n,dt);rr&&(ut.disabled=rr._f.disabled||Xe,Array.isArray(rr._f.refs)&&rr._f.refs.forEach(er=>{er.disabled=rr._f.disabled||Xe}))},0,!1))},rt=(Xe,ut)=>async dt=>{let rr;dt&&(dt.preventDefault&&dt.preventDefault(),dt.persist&&dt.persist());let er=hs(l);if(T.state.next({isSubmitting:!0}),t.resolver){const{errors:tr,values:Pr}=await J();r.errors=tr,er=hs(Pr)}else await ae(n);if(i.disabled.size)for(const tr of i.disabled)Zo(er,tr);if(Zo(r.errors,"root"),hc(r.errors)){T.state.next({errors:{}});try{await Xe(er,dt)}catch(tr){rr=tr}}else ut&&await ut({...r.errors},dt),ot(),setTimeout(ot);if(T.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:hc(r.errors)&&!rr,submitCount:r.submitCount+1,errors:r.errors}),rr)throw rr},Ut=(Xe,ut={})=>{tn(n,Xe)&&(Mo(ut.defaultValue)?we(Xe,hs(tn(o,Xe))):(we(Xe,ut.defaultValue),Ra(o,Xe,hs(ut.defaultValue))),ut.keepTouched||Zo(r.touchedFields,Xe),ut.keepDirty||(Zo(r.dirtyFields,Xe),r.isDirty=ut.defaultValue?ie(Xe,hs(tn(o,Xe))):ie()),ut.keepError||(Zo(r.errors,Xe),S.isValid&&I()),T.state.next({...r}))},Ft=(Xe,ut={})=>{const dt=Xe?hs(Xe):o,rr=hs(dt),er=hc(Xe),tr=er?o:rr;if(ut.keepDefaultValues||(o=dt),!ut.keepValues){if(ut.keepDirtyValues){const Pr=new Set([...i.mount,...Object.keys(dS(o,l))]);for(const un of Array.from(Pr))tn(r.dirtyFields,un)?Ra(tr,un,tn(l,un)):we(un,tn(tr,un))}else{if(M4&&Mo(Xe))for(const Pr of i.mount){const un=tn(n,Pr);if(un&&un._f){const pn=Array.isArray(un._f.refs)?un._f.refs[0]:un._f.ref;if(OO(pn)){const Pi=pn.closest("form");if(Pi){Pi.reset();break}}}}if(ut.keepFieldsRef)for(const Pr of i.mount)we(Pr,tn(tr,Pr));else n={}}l=t.shouldUnregister?ut.keepDefaultValues?hs(o):{}:hs(tr),T.array.next({values:{...tr}}),T.state.next({values:{...tr}})}i={mount:ut.keepDirtyValues?i.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},d.mount=!S.isValid||!!ut.keepIsValid||!!ut.keepDirtyValues,d.watch=!!t.shouldUnregister,T.state.next({submitCount:ut.keepSubmitCount?r.submitCount:0,isDirty:er?!1:ut.keepDirty?r.isDirty:!!(ut.keepDefaultValues&&!vf(Xe,o)),isSubmitted:ut.keepIsSubmitted?r.isSubmitted:!1,dirtyFields:er?{}:ut.keepDirtyValues?ut.keepDefaultValues&&l?dS(o,l):r.dirtyFields:ut.keepDefaultValues&&Xe?dS(o,Xe):ut.keepDirty?r.dirtyFields:{},touchedFields:ut.keepTouched?r.touchedFields:{},errors:ut.keepErrors?r.errors:{},isSubmitSuccessful:ut.keepIsSubmitSuccessful?r.isSubmitSuccessful:!1,isSubmitting:!1})},dr=(Xe,ut)=>Ft(vd(Xe)?Xe(l):Xe,ut),Lr=(Xe,ut={})=>{const dt=tn(n,Xe),rr=dt&&dt._f;if(rr){const er=rr.refs?rr.refs[0]:rr.ref;er.focus&&(er.focus(),ut.shouldSelect&&vd(er.select)&&er.select())}},Jr=Xe=>{r={...r,...Xe}},At={control:{register:je,unregister:qe,getFieldState:ye,handleSubmit:rt,setError:Ie,_subscribe:Ze,_runSchema:J,_focusError:ot,_getWatch:ee,_getDirty:ie,_setValid:I,_setFieldArray:D,_setDisabledField:Ge,_setErrors:F,_getFieldArray:oe,_reset:Ft,_resetDefaultValues:()=>vd(t.defaultValues)&&t.defaultValues().then(Xe=>{dr(Xe,t.resetOptions),T.state.next({isLoading:!1})}),_removeUnmounted:ne,_disableForm:St,_subjects:T,_proxyFormState:S,get _fields(){return n},get _formValues(){return l},get _state(){return d},set _state(Xe){d=Xe},get _defaultValues(){return o},get _names(){return i},set _names(Xe){i=Xe},get _formState(){return r},get _options(){return t},set _options(Xe){t={...t,...Xe}}},subscribe:Le,trigger:me,register:je,handleSubmit:rt,watch:tt,setValue:we,getValues:Pe,reset:dr,resetField:Ut,clearErrors:pe,unregister:qe,setError:Ie,setFocus:Lr,getFieldState:ye};return{...At,formControl:At}}function sm(e={}){const t=He.useRef(void 0),r=He.useRef(void 0),[n,o]=He.useState({isDirty:!1,isValidating:!1,isLoading:vd(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,isReady:!1,defaultValues:vd(e.defaultValues)?void 0:e.defaultValues});if(!t.current)if(e.formControl)t.current={...e.formControl,formState:n},e.defaultValues&&!vd(e.defaultValues)&&e.formControl.reset(e.defaultValues,e.resetOptions);else{const{formControl:d,...i}=aOe(e);t.current={...i,formState:n}}const l=t.current.control;return l._options=e,z4(()=>{const d=l._subscribe({formState:l._proxyFormState,callback:()=>o({...l._formState}),reRenderRoot:!0});return o(i=>({...i,isReady:!0})),l._formState.isReady=!0,d},[l]),He.useEffect(()=>l._disableForm(e.disabled),[l,e.disabled]),He.useEffect(()=>{e.mode&&(l._options.mode=e.mode),e.reValidateMode&&(l._options.reValidateMode=e.reValidateMode)},[l,e.mode,e.reValidateMode]),He.useEffect(()=>{e.errors&&(l._setErrors(e.errors),l._focusError())},[l,e.errors]),He.useEffect(()=>{e.shouldUnregister&&l._subjects.state.next({values:l._getWatch()})},[l,e.shouldUnregister]),He.useEffect(()=>{if(l._proxyFormState.isDirty){const d=l._getDirty();d!==n.isDirty&&l._subjects.state.next({isDirty:d})}},[l,n.isDirty]),He.useEffect(()=>{e.values&&!vf(e.values,r.current)?(l._reset(e.values,{keepFieldsRef:!0,...l._options.resetOptions}),r.current=e.values,o(d=>({...d}))):l._resetDefaultValues()},[l,e.values]),He.useEffect(()=>{l._state.mount||(l._setValid(),l._state.mount=!0),l._state.watch&&(l._state.watch=!1,l._subjects.state.next({...l._formState})),l._removeUnmounted()}),t.current.formState=$ie(n,l),t.current}const EW=(e,t,r)=>{if(e&&"reportValidity"in e){const n=tn(r,t);e.setCustomValidity(n&&n.message||""),e.reportValidity()}},Xie=(e,t)=>{for(const r in t.fields){const n=t.fields[r];n&&n.ref&&"reportValidity"in n.ref?EW(n.ref,r,e):n.refs&&n.refs.forEach(o=>EW(o,r,e))}},oOe=(e,t)=>{t.shouldUseNativeValidation&&Xie(e,t);const r={};for(const n in e){const o=tn(t.fields,n),l=Object.assign(e[n]||{},{ref:o&&o.ref});if(sOe(t.names||Object.keys(e),n)){const d=Object.assign({},tn(r,n));Ra(d,"root",l),Ra(r,n,d)}else Ra(r,n,l)}return r},sOe=(e,t)=>e.some(r=>r.startsWith(t+"."));var lOe=function(e,t){for(var r={};e.length;){var n=e[0],o=n.code,l=n.message,d=n.path.join(".");if(!r[d])if("unionErrors"in n){var i=n.unionErrors[0].errors[0];r[d]={message:i.message,type:i.code}}else r[d]={message:l,type:o};if("unionErrors"in n&&n.unionErrors.forEach(function(S){return S.errors.forEach(function(E){return e.push(E)})}),t){var g=r[d].types,_=g&&g[n.code];r[d]=Vie(d,t,r,o,_?[].concat(_,n.message):n.message)}e.shift()}return r},lm=function(e,t,r){return r===void 0&&(r={}),function(n,o,l){try{return Promise.resolve(function(d,i){try{var g=Promise.resolve(e[r.mode==="sync"?"parse":"parseAsync"](n,t)).then(function(_){return l.shouldUseNativeValidation&&Xie({},l),{errors:{},values:r.raw?n:_}})}catch(_){return i(_)}return g&&g.then?g.then(void 0,i):g}(0,function(d){if(function(i){return Array.isArray(i==null?void 0:i.errors)}(d))return{values:{},errors:oOe(lOe(d.errors,!l.shouldUseNativeValidation&&l.criteriaMode==="all"),l)};throw d}))}catch(d){return Promise.reject(d)}}},ga;(function(e){e.assertEqual=o=>{};function t(o){}e.assertIs=t;function r(o){throw new Error}e.assertNever=r,e.arrayToEnum=o=>{const l={};for(const d of o)l[d]=d;return l},e.getValidEnumValues=o=>{const l=e.objectKeys(o).filter(i=>typeof o[o[i]]!="number"),d={};for(const i of l)d[i]=o[i];return e.objectValues(d)},e.objectValues=o=>e.objectKeys(o).map(function(l){return o[l]}),e.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{const l=[];for(const d in o)Object.prototype.hasOwnProperty.call(o,d)&&l.push(d);return l},e.find=(o,l)=>{for(const d of o)if(l(d))return d},e.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&Number.isFinite(o)&&Math.floor(o)===o;function n(o,l=" | "){return o.map(d=>typeof d=="string"?`'${d}'`:d).join(l)}e.joinValues=n,e.jsonStringifyReplacer=(o,l)=>typeof l=="bigint"?l.toString():l})(ga||(ga={}));var TW;(function(e){e.mergeShapes=(t,r)=>({...t,...r})})(TW||(TW={}));const Pn=ga.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),em=e=>{switch(typeof e){case"undefined":return Pn.undefined;case"string":return Pn.string;case"number":return Number.isNaN(e)?Pn.nan:Pn.number;case"boolean":return Pn.boolean;case"function":return Pn.function;case"bigint":return Pn.bigint;case"symbol":return Pn.symbol;case"object":return Array.isArray(e)?Pn.array:e===null?Pn.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?Pn.promise:typeof Map<"u"&&e instanceof Map?Pn.map:typeof Set<"u"&&e instanceof Set?Pn.set:typeof Date<"u"&&e instanceof Date?Pn.date:Pn.object;default:return Pn.unknown}},Dr=ga.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Ff extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}format(t){const r=t||function(l){return l.message},n={_errors:[]},o=l=>{for(const d of l.issues)if(d.code==="invalid_union")d.unionErrors.map(o);else if(d.code==="invalid_return_type")o(d.returnTypeError);else if(d.code==="invalid_arguments")o(d.argumentsError);else if(d.path.length===0)n._errors.push(r(d));else{let i=n,g=0;for(;g<d.path.length;){const _=d.path[g];g===d.path.length-1?(i[_]=i[_]||{_errors:[]},i[_]._errors.push(r(d))):i[_]=i[_]||{_errors:[]},i=i[_],g++}}};return o(this),n}static assert(t){if(!(t instanceof Ff))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ga.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){const r={},n=[];for(const o of this.issues)if(o.path.length>0){const l=o.path[0];r[l]=r[l]||[],r[l].push(t(o))}else n.push(t(o));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}}Ff.create=e=>new Ff(e);const I3=(e,t)=>{let r;switch(e.code){case Dr.invalid_type:e.received===Pn.undefined?r="Required":r=`Expected ${e.expected}, received ${e.received}`;break;case Dr.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,ga.jsonStringifyReplacer)}`;break;case Dr.unrecognized_keys:r=`Unrecognized key(s) in object: ${ga.joinValues(e.keys,", ")}`;break;case Dr.invalid_union:r="Invalid input";break;case Dr.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ga.joinValues(e.options)}`;break;case Dr.invalid_enum_value:r=`Invalid enum value. Expected ${ga.joinValues(e.options)}, received '${e.received}'`;break;case Dr.invalid_arguments:r="Invalid function arguments";break;case Dr.invalid_return_type:r="Invalid function return type";break;case Dr.invalid_date:r="Invalid date";break;case Dr.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:ga.assertNever(e.validation):e.validation!=="regex"?r=`Invalid ${e.validation}`:r="Invalid";break;case Dr.too_small:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?r=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:r="Invalid input";break;case Dr.too_big:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?r=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:r="Invalid input";break;case Dr.custom:r="Invalid input";break;case Dr.invalid_intersection_types:r="Intersection results could not be merged";break;case Dr.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case Dr.not_finite:r="Number must be finite";break;default:r=t.defaultError,ga.assertNever(e)}return{message:r}};let cOe=I3;function uOe(){return cOe}const dOe=e=>{const{data:t,path:r,errorMaps:n,issueData:o}=e,l=[...r,...o.path||[]],d={...o,path:l};if(o.message!==void 0)return{...o,path:l,message:o.message};let i="";const g=n.filter(_=>!!_).slice().reverse();for(const _ of g)i=_(d,{data:t,defaultError:i}).message;return{...o,path:l,message:i}};function fn(e,t){const r=uOe(),n=dOe({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===I3?void 0:I3].filter(o=>!!o)});e.common.issues.push(n)}class Qc{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,r){const n=[];for(const o of r){if(o.status==="aborted")return xi;o.status==="dirty"&&t.dirty(),n.push(o.value)}return{status:t.value,value:n}}static async mergeObjectAsync(t,r){const n=[];for(const o of r){const l=await o.key,d=await o.value;n.push({key:l,value:d})}return Qc.mergeObjectSync(t,n)}static mergeObjectSync(t,r){const n={};for(const o of r){const{key:l,value:d}=o;if(l.status==="aborted"||d.status==="aborted")return xi;l.status==="dirty"&&t.dirty(),d.status==="dirty"&&t.dirty(),l.value!=="__proto__"&&(typeof d.value<"u"||o.alwaysSet)&&(n[l.value]=d.value)}return{status:t.value,value:n}}}const xi=Object.freeze({status:"aborted"}),MS=e=>({status:"dirty",value:e}),Du=e=>({status:"valid",value:e}),AW=e=>e.status==="aborted",PW=e=>e.status==="dirty",$0=e=>e.status==="valid",RO=e=>typeof Promise<"u"&&e instanceof Promise;var Cn;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(Cn||(Cn={}));class Xm{constructor(t,r,n,o){this._cachedPath=[],this.parent=t,this.data=r,this._path=n,this._key=o}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const CW=(e,t)=>{if($0(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new Ff(e.common.issues);return this._error=r,this._error}}};function Wi(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:n,description:o}=e;if(t&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:o}:{errorMap:(d,i)=>{const{message:g}=e;return d.code==="invalid_enum_value"?{message:g??i.defaultError}:typeof i.data>"u"?{message:g??n??i.defaultError}:d.code!=="invalid_type"?{message:i.defaultError}:{message:g??r??i.defaultError}},description:o}}class fa{get description(){return this._def.description}_getType(t){return em(t.data)}_getOrReturnCtx(t,r){return r||{common:t.parent.common,data:t.data,parsedType:em(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Qc,ctx:{common:t.parent.common,data:t.data,parsedType:em(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const r=this._parse(t);if(RO(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(t){const r=this._parse(t);return Promise.resolve(r)}parse(t,r){const n=this.safeParse(t,r);if(n.success)return n.data;throw n.error}safeParse(t,r){const n={common:{issues:[],async:(r==null?void 0:r.async)??!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:em(t)},o=this._parseSync({data:t,path:n.path,parent:n});return CW(n,o)}"~validate"(t){var n,o;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:em(t)};if(!this["~standard"].async)try{const l=this._parseSync({data:t,path:[],parent:r});return $0(l)?{value:l.value}:{issues:r.common.issues}}catch(l){(o=(n=l==null?void 0:l.message)==null?void 0:n.toLowerCase())!=null&&o.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:r}).then(l=>$0(l)?{value:l.value}:{issues:r.common.issues})}async parseAsync(t,r){const n=await this.safeParseAsync(t,r);if(n.success)return n.data;throw n.error}async safeParseAsync(t,r){const n={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:em(t)},o=this._parse({data:t,path:n.path,parent:n}),l=await(RO(o)?o:Promise.resolve(o));return CW(n,l)}refine(t,r){const n=o=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(o):r;return this._refinement((o,l)=>{const d=t(o),i=()=>l.addIssue({code:Dr.custom,...n(o)});return typeof Promise<"u"&&d instanceof Promise?d.then(g=>g?!0:(i(),!1)):d?!0:(i(),!1)})}refinement(t,r){return this._refinement((n,o)=>t(n)?!0:(o.addIssue(typeof r=="function"?r(n,o):r),!1))}_refinement(t){return new q0({schema:this,typeName:bi.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Fm.create(this,this._def)}nullable(){return W0.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return wh.create(this)}promise(){return MO.create(this,this._def)}or(t){return jO.create([this,t],this._def)}and(t){return NO.create(this,t,this._def)}transform(t){return new q0({...Wi(this._def),schema:this,typeName:bi.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const r=typeof t=="function"?t:()=>t;return new N3({...Wi(this._def),innerType:this,defaultValue:r,typeName:bi.ZodDefault})}brand(){return new NOe({typeName:bi.ZodBranded,type:this,...Wi(this._def)})}catch(t){const r=typeof t=="function"?t:()=>t;return new M3({...Wi(this._def),innerType:this,catchValue:r,typeName:bi.ZodCatch})}describe(t){const r=this.constructor;return new r({...this._def,description:t})}pipe(t){return U4.create(this,t)}readonly(){return D3.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const hOe=/^c[^\s-]{8,}$/i,fOe=/^[0-9a-z]+$/,pOe=/^[0-9A-HJKMNP-TV-Z]{26}$/i,mOe=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,gOe=/^[a-z0-9_-]{21}$/i,yOe=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,vOe=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,_Oe=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,xOe="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let JM;const bOe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,wOe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,SOe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,EOe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,TOe=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,AOe=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Yie="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",POe=new RegExp(`^${Yie}$`);function Jie(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function COe(e){return new RegExp(`^${Jie(e)}$`)}function OOe(e){let t=`${Yie}T${Jie(e)}`;const r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}function kOe(e,t){return!!((t==="v4"||!t)&&bOe.test(e)||(t==="v6"||!t)&&SOe.test(e))}function IOe(e,t){if(!yOe.test(e))return!1;try{const[r]=e.split(".");if(!r)return!1;const n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),o=JSON.parse(atob(n));return!(typeof o!="object"||o===null||"typ"in o&&(o==null?void 0:o.typ)!=="JWT"||!o.alg||t&&o.alg!==t)}catch{return!1}}function ROe(e,t){return!!((t==="v4"||!t)&&wOe.test(e)||(t==="v6"||!t)&&EOe.test(e))}class Em extends fa{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==Pn.string){const l=this._getOrReturnCtx(t);return fn(l,{code:Dr.invalid_type,expected:Pn.string,received:l.parsedType}),xi}const n=new Qc;let o;for(const l of this._def.checks)if(l.kind==="min")t.data.length<l.value&&(o=this._getOrReturnCtx(t,o),fn(o,{code:Dr.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),n.dirty());else if(l.kind==="max")t.data.length>l.value&&(o=this._getOrReturnCtx(t,o),fn(o,{code:Dr.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),n.dirty());else if(l.kind==="length"){const d=t.data.length>l.value,i=t.data.length<l.value;(d||i)&&(o=this._getOrReturnCtx(t,o),d?fn(o,{code:Dr.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):i&&fn(o,{code:Dr.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),n.dirty())}else if(l.kind==="email")_Oe.test(t.data)||(o=this._getOrReturnCtx(t,o),fn(o,{validation:"email",code:Dr.invalid_string,message:l.message}),n.dirty());else if(l.kind==="emoji")JM||(JM=new RegExp(xOe,"u")),JM.test(t.data)||(o=this._getOrReturnCtx(t,o),fn(o,{validation:"emoji",code:Dr.invalid_string,message:l.message}),n.dirty());else if(l.kind==="uuid")mOe.test(t.data)||(o=this._getOrReturnCtx(t,o),fn(o,{validation:"uuid",code:Dr.invalid_string,message:l.message}),n.dirty());else if(l.kind==="nanoid")gOe.test(t.data)||(o=this._getOrReturnCtx(t,o),fn(o,{validation:"nanoid",code:Dr.invalid_string,message:l.message}),n.dirty());else if(l.kind==="cuid")hOe.test(t.data)||(o=this._getOrReturnCtx(t,o),fn(o,{validation:"cuid",code:Dr.invalid_string,message:l.message}),n.dirty());else if(l.kind==="cuid2")fOe.test(t.data)||(o=this._getOrReturnCtx(t,o),fn(o,{validation:"cuid2",code:Dr.invalid_string,message:l.message}),n.dirty());else if(l.kind==="ulid")pOe.test(t.data)||(o=this._getOrReturnCtx(t,o),fn(o,{validation:"ulid",code:Dr.invalid_string,message:l.message}),n.dirty());else if(l.kind==="url")try{new URL(t.data)}catch{o=this._getOrReturnCtx(t,o),fn(o,{validation:"url",code:Dr.invalid_string,message:l.message}),n.dirty()}else l.kind==="regex"?(l.regex.lastIndex=0,l.regex.test(t.data)||(o=this._getOrReturnCtx(t,o),fn(o,{validation:"regex",code:Dr.invalid_string,message:l.message}),n.dirty())):l.kind==="trim"?t.data=t.data.trim():l.kind==="includes"?t.data.includes(l.value,l.position)||(o=this._getOrReturnCtx(t,o),fn(o,{code:Dr.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),n.dirty()):l.kind==="toLowerCase"?t.data=t.data.toLowerCase():l.kind==="toUpperCase"?t.data=t.data.toUpperCase():l.kind==="startsWith"?t.data.startsWith(l.value)||(o=this._getOrReturnCtx(t,o),fn(o,{code:Dr.invalid_string,validation:{startsWith:l.value},message:l.message}),n.dirty()):l.kind==="endsWith"?t.data.endsWith(l.value)||(o=this._getOrReturnCtx(t,o),fn(o,{code:Dr.invalid_string,validation:{endsWith:l.value},message:l.message}),n.dirty()):l.kind==="datetime"?OOe(l).test(t.data)||(o=this._getOrReturnCtx(t,o),fn(o,{code:Dr.invalid_string,validation:"datetime",message:l.message}),n.dirty()):l.kind==="date"?POe.test(t.data)||(o=this._getOrReturnCtx(t,o),fn(o,{code:Dr.invalid_string,validation:"date",message:l.message}),n.dirty()):l.kind==="time"?COe(l).test(t.data)||(o=this._getOrReturnCtx(t,o),fn(o,{code:Dr.invalid_string,validation:"time",message:l.message}),n.dirty()):l.kind==="duration"?vOe.test(t.data)||(o=this._getOrReturnCtx(t,o),fn(o,{validation:"duration",code:Dr.invalid_string,message:l.message}),n.dirty()):l.kind==="ip"?kOe(t.data,l.version)||(o=this._getOrReturnCtx(t,o),fn(o,{validation:"ip",code:Dr.invalid_string,message:l.message}),n.dirty()):l.kind==="jwt"?IOe(t.data,l.alg)||(o=this._getOrReturnCtx(t,o),fn(o,{validation:"jwt",code:Dr.invalid_string,message:l.message}),n.dirty()):l.kind==="cidr"?ROe(t.data,l.version)||(o=this._getOrReturnCtx(t,o),fn(o,{validation:"cidr",code:Dr.invalid_string,message:l.message}),n.dirty()):l.kind==="base64"?TOe.test(t.data)||(o=this._getOrReturnCtx(t,o),fn(o,{validation:"base64",code:Dr.invalid_string,message:l.message}),n.dirty()):l.kind==="base64url"?AOe.test(t.data)||(o=this._getOrReturnCtx(t,o),fn(o,{validation:"base64url",code:Dr.invalid_string,message:l.message}),n.dirty()):ga.assertNever(l);return{status:n.value,value:t.data}}_regex(t,r,n){return this.refinement(o=>t.test(o),{validation:r,code:Dr.invalid_string,...Cn.errToObj(n)})}_addCheck(t){return new Em({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...Cn.errToObj(t)})}url(t){return this._addCheck({kind:"url",...Cn.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...Cn.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...Cn.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...Cn.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...Cn.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...Cn.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...Cn.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...Cn.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...Cn.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...Cn.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...Cn.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...Cn.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...Cn.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...Cn.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...Cn.errToObj(t)})}regex(t,r){return this._addCheck({kind:"regex",regex:t,...Cn.errToObj(r)})}includes(t,r){return this._addCheck({kind:"includes",value:t,position:r==null?void 0:r.position,...Cn.errToObj(r==null?void 0:r.message)})}startsWith(t,r){return this._addCheck({kind:"startsWith",value:t,...Cn.errToObj(r)})}endsWith(t,r){return this._addCheck({kind:"endsWith",value:t,...Cn.errToObj(r)})}min(t,r){return this._addCheck({kind:"min",value:t,...Cn.errToObj(r)})}max(t,r){return this._addCheck({kind:"max",value:t,...Cn.errToObj(r)})}length(t,r){return this._addCheck({kind:"length",value:t,...Cn.errToObj(r)})}nonempty(t){return this.min(1,Cn.errToObj(t))}trim(){return new Em({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Em({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Em({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxLength(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}Em.create=e=>new Em({checks:[],typeName:bi.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...Wi(e)});function jOe(e,t){const r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,o=r>n?r:n,l=Number.parseInt(e.toFixed(o).replace(".","")),d=Number.parseInt(t.toFixed(o).replace(".",""));return l%d/10**o}class U0 extends fa{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==Pn.number){const l=this._getOrReturnCtx(t);return fn(l,{code:Dr.invalid_type,expected:Pn.number,received:l.parsedType}),xi}let n;const o=new Qc;for(const l of this._def.checks)l.kind==="int"?ga.isInteger(t.data)||(n=this._getOrReturnCtx(t,n),fn(n,{code:Dr.invalid_type,expected:"integer",received:"float",message:l.message}),o.dirty()):l.kind==="min"?(l.inclusive?t.data<l.value:t.data<=l.value)&&(n=this._getOrReturnCtx(t,n),fn(n,{code:Dr.too_small,minimum:l.value,type:"number",inclusive:l.inclusive,exact:!1,message:l.message}),o.dirty()):l.kind==="max"?(l.inclusive?t.data>l.value:t.data>=l.value)&&(n=this._getOrReturnCtx(t,n),fn(n,{code:Dr.too_big,maximum:l.value,type:"number",inclusive:l.inclusive,exact:!1,message:l.message}),o.dirty()):l.kind==="multipleOf"?jOe(t.data,l.value)!==0&&(n=this._getOrReturnCtx(t,n),fn(n,{code:Dr.not_multiple_of,multipleOf:l.value,message:l.message}),o.dirty()):l.kind==="finite"?Number.isFinite(t.data)||(n=this._getOrReturnCtx(t,n),fn(n,{code:Dr.not_finite,message:l.message}),o.dirty()):ga.assertNever(l);return{status:o.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,Cn.toString(r))}gt(t,r){return this.setLimit("min",t,!1,Cn.toString(r))}lte(t,r){return this.setLimit("max",t,!0,Cn.toString(r))}lt(t,r){return this.setLimit("max",t,!1,Cn.toString(r))}setLimit(t,r,n,o){return new U0({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:Cn.toString(o)}]})}_addCheck(t){return new U0({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:Cn.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Cn.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Cn.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Cn.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Cn.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:Cn.toString(r)})}finite(t){return this._addCheck({kind:"finite",message:Cn.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Cn.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Cn.toString(t)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&ga.isInteger(t.value))}get isFinite(){let t=null,r=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(t===null||n.value<t)&&(t=n.value)}return Number.isFinite(r)&&Number.isFinite(t)}}U0.create=e=>new U0({checks:[],typeName:bi.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...Wi(e)});class ME extends fa{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==Pn.bigint)return this._getInvalidInput(t);let n;const o=new Qc;for(const l of this._def.checks)l.kind==="min"?(l.inclusive?t.data<l.value:t.data<=l.value)&&(n=this._getOrReturnCtx(t,n),fn(n,{code:Dr.too_small,type:"bigint",minimum:l.value,inclusive:l.inclusive,message:l.message}),o.dirty()):l.kind==="max"?(l.inclusive?t.data>l.value:t.data>=l.value)&&(n=this._getOrReturnCtx(t,n),fn(n,{code:Dr.too_big,type:"bigint",maximum:l.value,inclusive:l.inclusive,message:l.message}),o.dirty()):l.kind==="multipleOf"?t.data%l.value!==BigInt(0)&&(n=this._getOrReturnCtx(t,n),fn(n,{code:Dr.not_multiple_of,multipleOf:l.value,message:l.message}),o.dirty()):ga.assertNever(l);return{status:o.value,value:t.data}}_getInvalidInput(t){const r=this._getOrReturnCtx(t);return fn(r,{code:Dr.invalid_type,expected:Pn.bigint,received:r.parsedType}),xi}gte(t,r){return this.setLimit("min",t,!0,Cn.toString(r))}gt(t,r){return this.setLimit("min",t,!1,Cn.toString(r))}lte(t,r){return this.setLimit("max",t,!0,Cn.toString(r))}lt(t,r){return this.setLimit("max",t,!1,Cn.toString(r))}setLimit(t,r,n,o){return new ME({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:Cn.toString(o)}]})}_addCheck(t){return new ME({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Cn.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Cn.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Cn.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Cn.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:Cn.toString(r)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}ME.create=e=>new ME({checks:[],typeName:bi.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...Wi(e)});class R3 extends fa{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==Pn.boolean){const n=this._getOrReturnCtx(t);return fn(n,{code:Dr.invalid_type,expected:Pn.boolean,received:n.parsedType}),xi}return Du(t.data)}}R3.create=e=>new R3({typeName:bi.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...Wi(e)});class DE extends fa{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==Pn.date){const l=this._getOrReturnCtx(t);return fn(l,{code:Dr.invalid_type,expected:Pn.date,received:l.parsedType}),xi}if(Number.isNaN(t.data.getTime())){const l=this._getOrReturnCtx(t);return fn(l,{code:Dr.invalid_date}),xi}const n=new Qc;let o;for(const l of this._def.checks)l.kind==="min"?t.data.getTime()<l.value&&(o=this._getOrReturnCtx(t,o),fn(o,{code:Dr.too_small,message:l.message,inclusive:!0,exact:!1,minimum:l.value,type:"date"}),n.dirty()):l.kind==="max"?t.data.getTime()>l.value&&(o=this._getOrReturnCtx(t,o),fn(o,{code:Dr.too_big,message:l.message,inclusive:!0,exact:!1,maximum:l.value,type:"date"}),n.dirty()):ga.assertNever(l);return{status:n.value,value:new Date(t.data.getTime())}}_addCheck(t){return new DE({...this._def,checks:[...this._def.checks,t]})}min(t,r){return this._addCheck({kind:"min",value:t.getTime(),message:Cn.toString(r)})}max(t,r){return this._addCheck({kind:"max",value:t.getTime(),message:Cn.toString(r)})}get minDate(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t!=null?new Date(t):null}}DE.create=e=>new DE({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:bi.ZodDate,...Wi(e)});class OW extends fa{_parse(t){if(this._getType(t)!==Pn.symbol){const n=this._getOrReturnCtx(t);return fn(n,{code:Dr.invalid_type,expected:Pn.symbol,received:n.parsedType}),xi}return Du(t.data)}}OW.create=e=>new OW({typeName:bi.ZodSymbol,...Wi(e)});class kW extends fa{_parse(t){if(this._getType(t)!==Pn.undefined){const n=this._getOrReturnCtx(t);return fn(n,{code:Dr.invalid_type,expected:Pn.undefined,received:n.parsedType}),xi}return Du(t.data)}}kW.create=e=>new kW({typeName:bi.ZodUndefined,...Wi(e)});class IW extends fa{_parse(t){if(this._getType(t)!==Pn.null){const n=this._getOrReturnCtx(t);return fn(n,{code:Dr.invalid_type,expected:Pn.null,received:n.parsedType}),xi}return Du(t.data)}}IW.create=e=>new IW({typeName:bi.ZodNull,...Wi(e)});class RW extends fa{constructor(){super(...arguments),this._any=!0}_parse(t){return Du(t.data)}}RW.create=e=>new RW({typeName:bi.ZodAny,...Wi(e)});class jW extends fa{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Du(t.data)}}jW.create=e=>new jW({typeName:bi.ZodUnknown,...Wi(e)});class Ym extends fa{_parse(t){const r=this._getOrReturnCtx(t);return fn(r,{code:Dr.invalid_type,expected:Pn.never,received:r.parsedType}),xi}}Ym.create=e=>new Ym({typeName:bi.ZodNever,...Wi(e)});class NW extends fa{_parse(t){if(this._getType(t)!==Pn.undefined){const n=this._getOrReturnCtx(t);return fn(n,{code:Dr.invalid_type,expected:Pn.void,received:n.parsedType}),xi}return Du(t.data)}}NW.create=e=>new NW({typeName:bi.ZodVoid,...Wi(e)});class wh extends fa{_parse(t){const{ctx:r,status:n}=this._processInputParams(t),o=this._def;if(r.parsedType!==Pn.array)return fn(r,{code:Dr.invalid_type,expected:Pn.array,received:r.parsedType}),xi;if(o.exactLength!==null){const d=r.data.length>o.exactLength.value,i=r.data.length<o.exactLength.value;(d||i)&&(fn(r,{code:d?Dr.too_big:Dr.too_small,minimum:i?o.exactLength.value:void 0,maximum:d?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),n.dirty())}if(o.minLength!==null&&r.data.length<o.minLength.value&&(fn(r,{code:Dr.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),n.dirty()),o.maxLength!==null&&r.data.length>o.maxLength.value&&(fn(r,{code:Dr.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((d,i)=>o.type._parseAsync(new Xm(r,d,r.path,i)))).then(d=>Qc.mergeArray(n,d));const l=[...r.data].map((d,i)=>o.type._parseSync(new Xm(r,d,r.path,i)));return Qc.mergeArray(n,l)}get element(){return this._def.type}min(t,r){return new wh({...this._def,minLength:{value:t,message:Cn.toString(r)}})}max(t,r){return new wh({...this._def,maxLength:{value:t,message:Cn.toString(r)}})}length(t,r){return new wh({...this._def,exactLength:{value:t,message:Cn.toString(r)}})}nonempty(t){return this.min(1,t)}}wh.create=(e,t)=>new wh({type:e,minLength:null,maxLength:null,exactLength:null,typeName:bi.ZodArray,...Wi(t)});function Ox(e){if(e instanceof Co){const t={};for(const r in e.shape){const n=e.shape[r];t[r]=Fm.create(Ox(n))}return new Co({...e._def,shape:()=>t})}else return e instanceof wh?new wh({...e._def,type:Ox(e.element)}):e instanceof Fm?Fm.create(Ox(e.unwrap())):e instanceof W0?W0.create(Ox(e.unwrap())):e instanceof yv?yv.create(e.items.map(t=>Ox(t))):e}class Co extends fa{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),r=ga.objectKeys(t);return this._cached={shape:t,keys:r},this._cached}_parse(t){if(this._getType(t)!==Pn.object){const _=this._getOrReturnCtx(t);return fn(_,{code:Dr.invalid_type,expected:Pn.object,received:_.parsedType}),xi}const{status:n,ctx:o}=this._processInputParams(t),{shape:l,keys:d}=this._getCached(),i=[];if(!(this._def.catchall instanceof Ym&&this._def.unknownKeys==="strip"))for(const _ in o.data)d.includes(_)||i.push(_);const g=[];for(const _ of d){const S=l[_],E=o.data[_];g.push({key:{status:"valid",value:_},value:S._parse(new Xm(o,E,o.path,_)),alwaysSet:_ in o.data})}if(this._def.catchall instanceof Ym){const _=this._def.unknownKeys;if(_==="passthrough")for(const S of i)g.push({key:{status:"valid",value:S},value:{status:"valid",value:o.data[S]}});else if(_==="strict")i.length>0&&(fn(o,{code:Dr.unrecognized_keys,keys:i}),n.dirty());else if(_!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const _=this._def.catchall;for(const S of i){const E=o.data[S];g.push({key:{status:"valid",value:S},value:_._parse(new Xm(o,E,o.path,S)),alwaysSet:S in o.data})}}return o.common.async?Promise.resolve().then(async()=>{const _=[];for(const S of g){const E=await S.key,T=await S.value;_.push({key:E,value:T,alwaysSet:S.alwaysSet})}return _}).then(_=>Qc.mergeObjectSync(n,_)):Qc.mergeObjectSync(n,g)}get shape(){return this._def.shape()}strict(t){return Cn.errToObj,new Co({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(r,n)=>{var l,d;const o=((d=(l=this._def).errorMap)==null?void 0:d.call(l,r,n).message)??n.defaultError;return r.code==="unrecognized_keys"?{message:Cn.errToObj(t).message??o}:{message:o}}}:{}})}strip(){return new Co({...this._def,unknownKeys:"strip"})}passthrough(){return new Co({...this._def,unknownKeys:"passthrough"})}extend(t){return new Co({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new Co({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:bi.ZodObject})}setKey(t,r){return this.augment({[t]:r})}catchall(t){return new Co({...this._def,catchall:t})}pick(t){const r={};for(const n of ga.objectKeys(t))t[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new Co({...this._def,shape:()=>r})}omit(t){const r={};for(const n of ga.objectKeys(this.shape))t[n]||(r[n]=this.shape[n]);return new Co({...this._def,shape:()=>r})}deepPartial(){return Ox(this)}partial(t){const r={};for(const n of ga.objectKeys(this.shape)){const o=this.shape[n];t&&!t[n]?r[n]=o:r[n]=o.optional()}return new Co({...this._def,shape:()=>r})}required(t){const r={};for(const n of ga.objectKeys(this.shape))if(t&&!t[n])r[n]=this.shape[n];else{let l=this.shape[n];for(;l instanceof Fm;)l=l._def.innerType;r[n]=l}return new Co({...this._def,shape:()=>r})}keyof(){return Qie(ga.objectKeys(this.shape))}}Co.create=(e,t)=>new Co({shape:()=>e,unknownKeys:"strip",catchall:Ym.create(),typeName:bi.ZodObject,...Wi(t)});Co.strictCreate=(e,t)=>new Co({shape:()=>e,unknownKeys:"strict",catchall:Ym.create(),typeName:bi.ZodObject,...Wi(t)});Co.lazycreate=(e,t)=>new Co({shape:e,unknownKeys:"strip",catchall:Ym.create(),typeName:bi.ZodObject,...Wi(t)});class jO extends fa{_parse(t){const{ctx:r}=this._processInputParams(t),n=this._def.options;function o(l){for(const i of l)if(i.result.status==="valid")return i.result;for(const i of l)if(i.result.status==="dirty")return r.common.issues.push(...i.ctx.common.issues),i.result;const d=l.map(i=>new Ff(i.ctx.common.issues));return fn(r,{code:Dr.invalid_union,unionErrors:d}),xi}if(r.common.async)return Promise.all(n.map(async l=>{const d={...r,common:{...r.common,issues:[]},parent:null};return{result:await l._parseAsync({data:r.data,path:r.path,parent:d}),ctx:d}})).then(o);{let l;const d=[];for(const g of n){const _={...r,common:{...r.common,issues:[]},parent:null},S=g._parseSync({data:r.data,path:r.path,parent:_});if(S.status==="valid")return S;S.status==="dirty"&&!l&&(l={result:S,ctx:_}),_.common.issues.length&&d.push(_.common.issues)}if(l)return r.common.issues.push(...l.ctx.common.issues),l.result;const i=d.map(g=>new Ff(g));return fn(r,{code:Dr.invalid_union,unionErrors:i}),xi}}get options(){return this._def.options}}jO.create=(e,t)=>new jO({options:e,typeName:bi.ZodUnion,...Wi(t)});function j3(e,t){const r=em(e),n=em(t);if(e===t)return{valid:!0,data:e};if(r===Pn.object&&n===Pn.object){const o=ga.objectKeys(t),l=ga.objectKeys(e).filter(i=>o.indexOf(i)!==-1),d={...e,...t};for(const i of l){const g=j3(e[i],t[i]);if(!g.valid)return{valid:!1};d[i]=g.data}return{valid:!0,data:d}}else if(r===Pn.array&&n===Pn.array){if(e.length!==t.length)return{valid:!1};const o=[];for(let l=0;l<e.length;l++){const d=e[l],i=t[l],g=j3(d,i);if(!g.valid)return{valid:!1};o.push(g.data)}return{valid:!0,data:o}}else return r===Pn.date&&n===Pn.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class NO extends fa{_parse(t){const{status:r,ctx:n}=this._processInputParams(t),o=(l,d)=>{if(AW(l)||AW(d))return xi;const i=j3(l.value,d.value);return i.valid?((PW(l)||PW(d))&&r.dirty(),{status:r.value,value:i.data}):(fn(n,{code:Dr.invalid_intersection_types}),xi)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([l,d])=>o(l,d)):o(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}NO.create=(e,t,r)=>new NO({left:e,right:t,typeName:bi.ZodIntersection,...Wi(r)});class yv extends fa{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==Pn.array)return fn(n,{code:Dr.invalid_type,expected:Pn.array,received:n.parsedType}),xi;if(n.data.length<this._def.items.length)return fn(n,{code:Dr.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),xi;!this._def.rest&&n.data.length>this._def.items.length&&(fn(n,{code:Dr.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const l=[...n.data].map((d,i)=>{const g=this._def.items[i]||this._def.rest;return g?g._parse(new Xm(n,d,n.path,i)):null}).filter(d=>!!d);return n.common.async?Promise.all(l).then(d=>Qc.mergeArray(r,d)):Qc.mergeArray(r,l)}get items(){return this._def.items}rest(t){return new yv({...this._def,rest:t})}}yv.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new yv({items:e,typeName:bi.ZodTuple,rest:null,...Wi(t)})};class MW extends fa{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==Pn.map)return fn(n,{code:Dr.invalid_type,expected:Pn.map,received:n.parsedType}),xi;const o=this._def.keyType,l=this._def.valueType,d=[...n.data.entries()].map(([i,g],_)=>({key:o._parse(new Xm(n,i,n.path,[_,"key"])),value:l._parse(new Xm(n,g,n.path,[_,"value"]))}));if(n.common.async){const i=new Map;return Promise.resolve().then(async()=>{for(const g of d){const _=await g.key,S=await g.value;if(_.status==="aborted"||S.status==="aborted")return xi;(_.status==="dirty"||S.status==="dirty")&&r.dirty(),i.set(_.value,S.value)}return{status:r.value,value:i}})}else{const i=new Map;for(const g of d){const _=g.key,S=g.value;if(_.status==="aborted"||S.status==="aborted")return xi;(_.status==="dirty"||S.status==="dirty")&&r.dirty(),i.set(_.value,S.value)}return{status:r.value,value:i}}}}MW.create=(e,t,r)=>new MW({valueType:t,keyType:e,typeName:bi.ZodMap,...Wi(r)});class LE extends fa{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==Pn.set)return fn(n,{code:Dr.invalid_type,expected:Pn.set,received:n.parsedType}),xi;const o=this._def;o.minSize!==null&&n.data.size<o.minSize.value&&(fn(n,{code:Dr.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),r.dirty()),o.maxSize!==null&&n.data.size>o.maxSize.value&&(fn(n,{code:Dr.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),r.dirty());const l=this._def.valueType;function d(g){const _=new Set;for(const S of g){if(S.status==="aborted")return xi;S.status==="dirty"&&r.dirty(),_.add(S.value)}return{status:r.value,value:_}}const i=[...n.data.values()].map((g,_)=>l._parse(new Xm(n,g,n.path,_)));return n.common.async?Promise.all(i).then(g=>d(g)):d(i)}min(t,r){return new LE({...this._def,minSize:{value:t,message:Cn.toString(r)}})}max(t,r){return new LE({...this._def,maxSize:{value:t,message:Cn.toString(r)}})}size(t,r){return this.min(t,r).max(t,r)}nonempty(t){return this.min(1,t)}}LE.create=(e,t)=>new LE({valueType:e,minSize:null,maxSize:null,typeName:bi.ZodSet,...Wi(t)});class DW extends fa{get schema(){return this._def.getter()}_parse(t){const{ctx:r}=this._processInputParams(t);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}DW.create=(e,t)=>new DW({getter:e,typeName:bi.ZodLazy,...Wi(t)});class LW extends fa{_parse(t){if(t.data!==this._def.value){const r=this._getOrReturnCtx(t);return fn(r,{received:r.data,code:Dr.invalid_literal,expected:this._def.value}),xi}return{status:"valid",value:t.data}}get value(){return this._def.value}}LW.create=(e,t)=>new LW({value:e,typeName:bi.ZodLiteral,...Wi(t)});function Qie(e,t){return new V0({values:e,typeName:bi.ZodEnum,...Wi(t)})}class V0 extends fa{_parse(t){if(typeof t.data!="string"){const r=this._getOrReturnCtx(t),n=this._def.values;return fn(r,{expected:ga.joinValues(n),received:r.parsedType,code:Dr.invalid_type}),xi}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const r=this._getOrReturnCtx(t),n=this._def.values;return fn(r,{received:r.data,code:Dr.invalid_enum_value,options:n}),xi}return Du(t.data)}get options(){return this._def.values}get enum(){const t={};for(const r of this._def.values)t[r]=r;return t}get Values(){const t={};for(const r of this._def.values)t[r]=r;return t}get Enum(){const t={};for(const r of this._def.values)t[r]=r;return t}extract(t,r=this._def){return V0.create(t,{...this._def,...r})}exclude(t,r=this._def){return V0.create(this.options.filter(n=>!t.includes(n)),{...this._def,...r})}}V0.create=Qie;class FW extends fa{_parse(t){const r=ga.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(t);if(n.parsedType!==Pn.string&&n.parsedType!==Pn.number){const o=ga.objectValues(r);return fn(n,{expected:ga.joinValues(o),received:n.parsedType,code:Dr.invalid_type}),xi}if(this._cache||(this._cache=new Set(ga.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const o=ga.objectValues(r);return fn(n,{received:n.data,code:Dr.invalid_enum_value,options:o}),xi}return Du(t.data)}get enum(){return this._def.values}}FW.create=(e,t)=>new FW({values:e,typeName:bi.ZodNativeEnum,...Wi(t)});class MO extends fa{unwrap(){return this._def.type}_parse(t){const{ctx:r}=this._processInputParams(t);if(r.parsedType!==Pn.promise&&r.common.async===!1)return fn(r,{code:Dr.invalid_type,expected:Pn.promise,received:r.parsedType}),xi;const n=r.parsedType===Pn.promise?r.data:Promise.resolve(r.data);return Du(n.then(o=>this._def.type.parseAsync(o,{path:r.path,errorMap:r.common.contextualErrorMap})))}}MO.create=(e,t)=>new MO({type:e,typeName:bi.ZodPromise,...Wi(t)});class q0 extends fa{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===bi.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:r,ctx:n}=this._processInputParams(t),o=this._def.effect||null,l={addIssue:d=>{fn(n,d),d.fatal?r.abort():r.dirty()},get path(){return n.path}};if(l.addIssue=l.addIssue.bind(l),o.type==="preprocess"){const d=o.transform(n.data,l);if(n.common.async)return Promise.resolve(d).then(async i=>{if(r.value==="aborted")return xi;const g=await this._def.schema._parseAsync({data:i,path:n.path,parent:n});return g.status==="aborted"?xi:g.status==="dirty"||r.value==="dirty"?MS(g.value):g});{if(r.value==="aborted")return xi;const i=this._def.schema._parseSync({data:d,path:n.path,parent:n});return i.status==="aborted"?xi:i.status==="dirty"||r.value==="dirty"?MS(i.value):i}}if(o.type==="refinement"){const d=i=>{const g=o.refinement(i,l);if(n.common.async)return Promise.resolve(g);if(g instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return i};if(n.common.async===!1){const i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?xi:(i.status==="dirty"&&r.dirty(),d(i.value),{status:r.value,value:i.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>i.status==="aborted"?xi:(i.status==="dirty"&&r.dirty(),d(i.value).then(()=>({status:r.value,value:i.value}))))}if(o.type==="transform")if(n.common.async===!1){const d=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!$0(d))return xi;const i=o.transform(d.value,l);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:i}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(d=>$0(d)?Promise.resolve(o.transform(d.value,l)).then(i=>({status:r.value,value:i})):xi);ga.assertNever(o)}}q0.create=(e,t,r)=>new q0({schema:e,typeName:bi.ZodEffects,effect:t,...Wi(r)});q0.createWithPreprocess=(e,t,r)=>new q0({schema:t,effect:{type:"preprocess",transform:e},typeName:bi.ZodEffects,...Wi(r)});class Fm extends fa{_parse(t){return this._getType(t)===Pn.undefined?Du(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Fm.create=(e,t)=>new Fm({innerType:e,typeName:bi.ZodOptional,...Wi(t)});class W0 extends fa{_parse(t){return this._getType(t)===Pn.null?Du(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}W0.create=(e,t)=>new W0({innerType:e,typeName:bi.ZodNullable,...Wi(t)});class N3 extends fa{_parse(t){const{ctx:r}=this._processInputParams(t);let n=r.data;return r.parsedType===Pn.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}N3.create=(e,t)=>new N3({innerType:e,typeName:bi.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...Wi(t)});class M3 extends fa{_parse(t){const{ctx:r}=this._processInputParams(t),n={...r,common:{...r.common,issues:[]}},o=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return RO(o)?o.then(l=>({status:"valid",value:l.status==="valid"?l.value:this._def.catchValue({get error(){return new Ff(n.common.issues)},input:n.data})})):{status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new Ff(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}M3.create=(e,t)=>new M3({innerType:e,typeName:bi.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...Wi(t)});class zW extends fa{_parse(t){if(this._getType(t)!==Pn.nan){const n=this._getOrReturnCtx(t);return fn(n,{code:Dr.invalid_type,expected:Pn.nan,received:n.parsedType}),xi}return{status:"valid",value:t.data}}}zW.create=e=>new zW({typeName:bi.ZodNaN,...Wi(e)});class NOe extends fa{_parse(t){const{ctx:r}=this._processInputParams(t),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}}class U4 extends fa{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.common.async)return(async()=>{const l=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return l.status==="aborted"?xi:l.status==="dirty"?(r.dirty(),MS(l.value)):this._def.out._parseAsync({data:l.value,path:n.path,parent:n})})();{const o=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?xi:o.status==="dirty"?(r.dirty(),{status:"dirty",value:o.value}):this._def.out._parseSync({data:o.value,path:n.path,parent:n})}}static create(t,r){return new U4({in:t,out:r,typeName:bi.ZodPipeline})}}class D3 extends fa{_parse(t){const r=this._def.innerType._parse(t),n=o=>($0(o)&&(o.value=Object.freeze(o.value)),o);return RO(r)?r.then(o=>n(o)):n(r)}unwrap(){return this._def.innerType}}D3.create=(e,t)=>new D3({innerType:e,typeName:bi.ZodReadonly,...Wi(t)});Co.lazycreate;var bi;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(bi||(bi={}));const Ji=Em.create,L3=U0.create,eae=R3.create,BW=DE.create;Ym.create;const PC=wh.create,cm=Co.create;Co.strictCreate;jO.create;NO.create;yv.create;const tae=V0.create;MO.create;Fm.create;W0.create;var GI="Checkbox",[MOe,ett]=Zs(GI),[DOe,V4]=MOe(GI);function LOe(e){const{__scopeCheckbox:t,checked:r,children:n,defaultChecked:o,disabled:l,form:d,name:i,onCheckedChange:g,required:_,value:S="on",internal_do_not_use_render:E}=e,[T,C]=Ru({prop:r,defaultProp:o??!1,onChange:g,caller:GI}),[N,I]=W.useState(null),[j,D]=W.useState(null),R=W.useRef(!1),F=N?!!d||!!N.closest("form"):!0,B={checked:T,disabled:l,setChecked:C,control:N,setControl:I,name:i,form:d,value:S,hasConsumerStoppedPropagationRef:R,required:_,defaultChecked:zm(o)?!1:o,isFormControl:F,bubbleInput:j,setBubbleInput:D};return m.jsx(DOe,{scope:t,...B,children:FOe(E)?E(B):n})}var rae="CheckboxTrigger",nae=W.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:r,...n},o)=>{const{control:l,value:d,disabled:i,checked:g,required:_,setControl:S,setChecked:E,hasConsumerStoppedPropagationRef:T,isFormControl:C,bubbleInput:N}=V4(rae,e),I=fi(o,S),j=W.useRef(g);return W.useEffect(()=>{const D=l==null?void 0:l.form;if(D){const R=()=>E(j.current);return D.addEventListener("reset",R),()=>D.removeEventListener("reset",R)}},[l,E]),m.jsx(wn.button,{type:"button",role:"checkbox","aria-checked":zm(g)?"mixed":g,"aria-required":_,"data-state":lae(g),"data-disabled":i?"":void 0,disabled:i,value:d,...n,ref:I,onKeyDown:Rr(t,D=>{D.key==="Enter"&&D.preventDefault()}),onClick:Rr(r,D=>{E(R=>zm(R)?!0:!R),N&&C&&(T.current=D.isPropagationStopped(),T.current||D.stopPropagation())})})});nae.displayName=rae;var q4=W.forwardRef((e,t)=>{const{__scopeCheckbox:r,name:n,checked:o,defaultChecked:l,required:d,disabled:i,value:g,onCheckedChange:_,form:S,...E}=e;return m.jsx(LOe,{__scopeCheckbox:r,checked:o,defaultChecked:l,disabled:i,required:d,onCheckedChange:_,name:n,form:S,value:g,internal_do_not_use_render:({isFormControl:T})=>m.jsxs(m.Fragment,{children:[m.jsx(nae,{...E,ref:t,__scopeCheckbox:r}),T&&m.jsx(sae,{__scopeCheckbox:r})]})})});q4.displayName=GI;var iae="CheckboxIndicator",aae=W.forwardRef((e,t)=>{const{__scopeCheckbox:r,forceMount:n,...o}=e,l=V4(iae,r);return m.jsx(_s,{present:n||zm(l.checked)||l.checked===!0,children:m.jsx(wn.span,{"data-state":lae(l.checked),"data-disabled":l.disabled?"":void 0,...o,ref:t,style:{pointerEvents:"none",...e.style}})})});aae.displayName=iae;var oae="CheckboxBubbleInput",sae=W.forwardRef(({__scopeCheckbox:e,...t},r)=>{const{control:n,hasConsumerStoppedPropagationRef:o,checked:l,defaultChecked:d,required:i,disabled:g,name:_,value:S,form:E,bubbleInput:T,setBubbleInput:C}=V4(oae,e),N=fi(r,C),I=O4(l),j=OB(n);W.useEffect(()=>{const R=T;if(!R)return;const F=window.HTMLInputElement.prototype,U=Object.getOwnPropertyDescriptor(F,"checked").set,Z=!o.current;if(I!==l&&U){const J=new Event("click",{bubbles:Z});R.indeterminate=zm(l),U.call(R,zm(l)?!1:l),R.dispatchEvent(J)}},[T,I,l,o]);const D=W.useRef(zm(l)?!1:l);return m.jsx(wn.input,{type:"checkbox","aria-hidden":!0,defaultChecked:d??D.current,required:i,disabled:g,name:_,value:S,form:E,...t,tabIndex:-1,ref:N,style:{...t.style,...j,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});sae.displayName=oae;function FOe(e){return typeof e=="function"}function zm(e){return e==="indeterminate"}function lae(e){return zm(e)?"indeterminate":e?"checked":"unchecked"}const Hs=W.forwardRef(({className:e,...t},r)=>m.jsx(q4,{ref:r,className:yr("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:m.jsx(aae,{className:yr("flex items-center justify-center text-current"),children:m.jsx(Af,{className:"h-4 w-4"})})}));Hs.displayName=q4.displayName;var HI="Tabs",[zOe,ttt]=Zs(HI,[OI]),cae=OI(),[BOe,W4]=zOe(HI),uae=W.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,onValueChange:o,defaultValue:l,orientation:d="horizontal",dir:i,activationMode:g="automatic",..._}=e,S=UT(i),[E,T]=Ru({prop:n,onChange:o,defaultProp:l??"",caller:HI});return m.jsx(BOe,{scope:r,baseId:Kc(),value:E,onValueChange:T,orientation:d,dir:S,activationMode:g,children:m.jsx(wn.div,{dir:S,"data-orientation":d,..._,ref:t})})});uae.displayName=HI;var dae="TabsList",hae=W.forwardRef((e,t)=>{const{__scopeTabs:r,loop:n=!0,...o}=e,l=W4(dae,r),d=cae(r);return m.jsx(Ite,{asChild:!0,...d,orientation:l.orientation,dir:l.dir,loop:n,children:m.jsx(wn.div,{role:"tablist","aria-orientation":l.orientation,...o,ref:t})})});hae.displayName=dae;var fae="TabsTrigger",pae=W.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,disabled:o=!1,...l}=e,d=W4(fae,r),i=cae(r),g=yae(d.baseId,n),_=vae(d.baseId,n),S=n===d.value;return m.jsx(Rte,{asChild:!0,...i,focusable:!o,active:S,children:m.jsx(wn.button,{type:"button",role:"tab","aria-selected":S,"aria-controls":_,"data-state":S?"active":"inactive","data-disabled":o?"":void 0,disabled:o,id:g,...l,ref:t,onMouseDown:Rr(e.onMouseDown,E=>{!o&&E.button===0&&E.ctrlKey===!1?d.onValueChange(n):E.preventDefault()}),onKeyDown:Rr(e.onKeyDown,E=>{[" ","Enter"].includes(E.key)&&d.onValueChange(n)}),onFocus:Rr(e.onFocus,()=>{const E=d.activationMode!=="manual";!S&&!o&&E&&d.onValueChange(n)})})})});pae.displayName=fae;var mae="TabsContent",gae=W.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,forceMount:o,children:l,...d}=e,i=W4(mae,r),g=yae(i.baseId,n),_=vae(i.baseId,n),S=n===i.value,E=W.useRef(S);return W.useEffect(()=>{const T=requestAnimationFrame(()=>E.current=!1);return()=>cancelAnimationFrame(T)},[]),m.jsx(_s,{present:o||S,children:({present:T})=>m.jsx(wn.div,{"data-state":S?"active":"inactive","data-orientation":i.orientation,role:"tabpanel","aria-labelledby":g,hidden:!T,id:_,tabIndex:0,...d,ref:t,style:{...e.style,animationDuration:E.current?"0s":void 0},children:T&&l})})});gae.displayName=mae;function yae(e,t){return`${e}-trigger-${t}`}function vae(e,t){return`${e}-content-${t}`}var $Oe=uae,_ae=hae,xae=pae,bae=gae;const FE=$Oe,G0=W.forwardRef(({className:e,...t},r)=>m.jsx(_ae,{ref:r,className:yr("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));G0.displayName=_ae.displayName;const Ul=W.forwardRef(({className:e,...t},r)=>m.jsx(xae,{ref:r,className:yr("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",e),...t}));Ul.displayName=xae.displayName;const Vl=W.forwardRef(({className:e,...t},r)=>m.jsx(bae,{ref:r,className:yr("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));Vl.displayName=bae.displayName;const UOe=cm({name:Ji().min(1,jr.t("validation.nameRequired")),name_en:Ji().min(1,jr.t("validation.nameRequired")),name_pt:Ji().min(1,jr.t("validation.nameRequired")),type:PC(Ji()).min(1,jr.t("validation.typeRequired")).max(3,jr.t("validation.typeMaximum")),type_en:PC(Ji()).min(1,jr.t("validation.typeRequired")).max(3,jr.t("validation.typeMaximum")),type_pt:PC(Ji()).min(1,jr.t("validation.typeRequired")).max(3,jr.t("validation.typeMaximum")),description:Ji().optional(),description_en:Ji().optional(),description_pt:Ji().optional(),address:Ji().min(1,jr.t("validation.addressRequired")),lat:L3(),lng:L3(),phone:Ji().optional(),website_url:Ji().optional(),show_website_button:eae().default(!0)}),$W=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"];function DO({restaurant:e,trigger:t}){const{t:r}=Ki(),{toast:n}=Sa(),o=Ma(),[l,d]=W.useState(!1),[i,g]=W.useState(null),[_,S]=W.useState((e==null?void 0:e.image_url)||null),[E,T]=W.useState(!1),C=W.useRef(null),N=W.useRef(null),I=W.useRef(null),[j,D]=W.useState(()=>{const me={};return $W.forEach(Pe=>{me[Pe]={open:"12:00",close:"23:00",closed:!1,splitShift:!1,open2:"19:00",close2:"23:00"}}),e!=null&&e.opening_hours?{...me,...e.opening_hours}:me}),[R,F]=W.useState(()=>e!=null&&e.type&&Array.isArray(e.type)?e.type.map((me,Pe)=>{var ye,pe;return{zh:me,en:((ye=e.type_en)==null?void 0:ye[Pe])||"",pt:((pe=e.type_pt)==null?void 0:pe[Pe])||""}}):[{zh:"",en:"",pt:""}]),{register:B,handleSubmit:U,formState:{errors:Z},setValue:J,watch:te}=sm({resolver:lm(UOe),defaultValues:e?{name:e.name,name_en:e.name_en||"",name_pt:e.name_pt||"",type:Array.isArray(e.type)?e.type:[e.type],type_en:Array.isArray(e.type_en)?e.type_en:e.type_en?[e.type_en]:[""],type_pt:Array.isArray(e.type_pt)?e.type_pt:e.type_pt?[e.type_pt]:[""],description:e.description||"",description_en:e.description_en||"",description_pt:e.description_pt||"",address:e.address,lat:typeof e.lat=="number"&&!isNaN(e.lat)?e.lat:38.7223,lng:typeof e.lng=="number"&&!isNaN(e.lng)?e.lng:-9.1393,phone:e.phone||"",website_url:e.website_url||"",show_website_button:e.show_website_button??!0}:{name:"",name_en:"",name_pt:"",type:[""],type_en:[""],type_pt:[""],description:"",description_en:"",description_pt:"",address:"",lat:38.7223,lng:-9.1393,phone:"",website_url:"",show_website_button:!0}}),ae=()=>{R.length<3&&F([...R,{zh:"",en:"",pt:""}])},ne=me=>{R.length>1&&F(R.filter((Pe,ye)=>ye!==me))},ie=(me,Pe,ye)=>{const pe=[...R];pe[me][Pe]=ye,F(pe),J("type",pe.map(Ie=>Ie.zh).filter(Boolean)),J("type_en",pe.map(Ie=>Ie.en).filter(Boolean)),J("type_pt",pe.map(Ie=>Ie.pt).filter(Boolean))},ee=te("lat"),oe=te("lng"),de=te("show_website_button"),xe=(me,Pe)=>typeof me=="number"&&typeof Pe=="number"&&!isNaN(me)&&!isNaN(Pe)&&isFinite(me)&&isFinite(Pe);W.useEffect(()=>{if(!l){N.current&&(N.current.remove(),N.current=null,I.current=null);return}if(N.current)return;const me="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g",ye=setTimeout(()=>{if(!C.current){console.error("Map container not found");return}try{Jo.accessToken=me;const pe=xe(ee,oe)?oe:-9.1393,Ie=xe(ee,oe)?ee:38.7223;N.current=new Jo.Map({container:C.current,style:"mapbox://styles/mapbox/light-v11",center:[pe,Ie],zoom:15}),N.current.scrollZoom.disable(),N.current.on("load",()=>{N.current&&(xe(ee,oe)&&(I.current=new Jo.Marker({draggable:!0}).setLngLat([oe,ee]).addTo(N.current)),I.current.on("dragend",()=>{const Ze=I.current.getLngLat();J("lng",Ze.lng),J("lat",Ze.lat)}),setTimeout(()=>{var Ze;(Ze=N.current)==null||Ze.resize()},100))});const tt=Ze=>{var Le,qe;Ze.ctrlKey||Ze.metaKey?(Le=N.current)==null||Le.scrollZoom.enable():(qe=N.current)==null||qe.scrollZoom.disable()};C.current.addEventListener("wheel",tt),N.current.on("click",Ze=>{var Ge;const{lng:Le,lat:qe}=Ze.lngLat;J("lng",Le),J("lat",qe),(Ge=I.current)==null||Ge.setLngLat([Le,qe])}),N.current.on("error",Ze=>{console.error("Map error:",Ze)})}catch(pe){console.error("Failed to initialize map:",pe)}},500);return()=>{clearTimeout(ye)}},[l,ee,oe]),W.useEffect(()=>{I.current&&N.current&&xe(ee,oe)&&(I.current.setLngLat([oe,ee]),N.current.setCenter([oe,ee]))},[ee,oe]);const we=me=>{var ye;const Pe=(ye=me.target.files)==null?void 0:ye[0];if(Pe){g(Pe);const pe=new FileReader;pe.onloadend=()=>{S(pe.result)},pe.readAsDataURL(Pe)}},Ae=async()=>{if(!i)return(e==null?void 0:e.image_url)||null;const me=i.name.split(".").pop(),ye=`${`${Math.random()}.${me}`}`,{error:pe}=await qt.storage.from("restaurant-images").upload(ye,i);if(pe)throw pe;const{data:{publicUrl:Ie}}=qt.storage.from("restaurant-images").getPublicUrl(ye);return Ie},Ce=async me=>{T(!0);try{const{data:{user:Pe}}=await qt.auth.getUser();if(!Pe)throw new Error("Not authenticated");const ye=await Ae(),pe={name:me.name,name_en:me.name_en,name_pt:me.name_pt,type:me.type,type_en:me.type_en,type_pt:me.type_pt,description:me.description||null,description_en:me.description_en||null,description_pt:me.description_pt||null,address:me.address,lat:me.lat,lng:me.lng,phone:me.phone||null,website_url:me.website_url||null,show_website_button:me.show_website_button,image_url:ye,opening_hours:j};if(e){const{error:Ie}=await qt.from("restaurants").update({...pe,updated_by:Pe.id}).eq("id",e.id);if(Ie)throw Ie;n({title:r("common.success"),description:r("admin.restaurantUpdated")})}else{const{error:Ie}=await qt.from("restaurants").insert([{...pe,created_by:Pe.id}]);if(Ie)throw Ie;n({title:r("common.success"),description:r("admin.restaurantCreated")})}o.invalidateQueries({queryKey:["restaurants"]}),d(!1)}catch(Pe){n({title:r("common.error"),description:Pe.message,variant:"destructive"})}finally{T(!1)}};return m.jsxs(Nh,{open:l,onOpenChange:d,children:[m.jsx(jv,{asChild:!0,children:t}),m.jsxs(Rd,{className:"max-w-[95vw] sm:max-w-6xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[m.jsxs(jd,{className:"px-6 pt-6 pb-4 border-b bg-muted/30",children:[m.jsxs(Nd,{className:"text-2xl flex items-center gap-2",children:[m.jsx(es,{className:"w-6 h-6 text-primary"}),r(e?"admin.editRestaurant":"admin.addRestaurant")]}),m.jsx(Md,{className:"text-base",children:r(e?"admin.editRestaurantDetails":"admin.createRestaurantWithInfo")})]}),m.jsx(fv,{className:"px-6 h-[calc(95vh-220px)]",children:m.jsxs("form",{onSubmit:U(Ce),className:"space-y-6 py-6",children:[m.jsx(rn,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:m.jsxs(ln,{className:"p-6",children:[m.jsxs(Vr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[m.jsx(O0,{className:"w-5 h-5 text-primary"}),r("admin.restaurantImage")]}),m.jsxs("div",{className:"flex items-center gap-6",children:[_&&m.jsxs("div",{className:"relative group",children:[m.jsx("img",{src:_,alt:"Preview",className:"w-40 h-40 object-cover rounded-lg shadow-lg ring-2 ring-primary/20 transition-transform duration-200 group-hover:scale-105"}),m.jsx(ir,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-8 w-8 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{g(null),S(null)},children:m.jsx(ju,{className:"h-4 w-4"})})]}),m.jsxs(Vr,{htmlFor:"image-upload",className:"cursor-pointer",children:[m.jsxs("div",{className:"flex flex-col items-center gap-3 px-8 py-6 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[m.jsx(O0,{className:"h-8 w-8 text-primary"}),m.jsxs("div",{className:"text-center",children:[m.jsx("p",{className:"font-medium text-sm",children:r("admin.uploadImage")}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r("admin.imageMaxSize")})]})]}),m.jsx(en,{id:"image-upload",type:"file",accept:"image/*",className:"hidden",onChange:we})]})]})]})}),m.jsx(rn,{className:"border-primary/20",children:m.jsxs(ln,{className:"p-6",children:[m.jsxs(Vr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[m.jsx(C0,{className:"w-5 h-5 text-primary"}),r("admin.multilingualContent")]}),m.jsxs(FE,{defaultValue:"zh",className:"w-full",children:[m.jsxs(G0,{className:"grid w-full grid-cols-3 mb-6",children:[m.jsxs(Ul,{value:"zh",className:"gap-2",children:[" ",r("admin.chinese")]}),m.jsxs(Ul,{value:"en",className:"gap-2",children:[" ",r("admin.english")]}),m.jsxs(Ul,{value:"pt",className:"gap-2",children:[" ",r("admin.portuguese")]})]}),m.jsxs(Vl,{value:"zh",className:"space-y-4 mt-0",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"name",className:"text-sm font-medium",children:r("admin.restaurantName")}),m.jsx(en,{id:"name",...B("name"),placeholder:r("admin.enterRestaurantName"),className:"text-base"}),Z.name&&m.jsx("p",{className:"text-sm text-destructive",children:Z.name.message})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx(Vr,{className:"text-sm font-medium",children:r("admin.restaurantType")}),R.length<3&&m.jsx(ir,{type:"button",variant:"outline",size:"sm",onClick:ae,children:r("admin.addType")})]}),R.map((me,Pe)=>m.jsxs("div",{className:"flex gap-2 items-center",children:[m.jsx(en,{placeholder:r("admin.typeExample"),value:me.zh,onChange:ye=>ie(Pe,"zh",ye.target.value)}),m.jsx(ir,{type:"button",variant:"ghost",size:"icon",onClick:()=>ne(Pe),disabled:R.length===1,children:m.jsx(ju,{className:"h-4 w-4"})})]},Pe)),Z.type&&m.jsx("p",{className:"text-sm text-destructive",children:Z.type.message})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"description",className:"text-sm font-medium",children:r("admin.description")}),m.jsx(Lm,{id:"description",...B("description"),rows:3,placeholder:"..."})]})]}),m.jsxs(Vl,{value:"en",className:"space-y-4 mt-0",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"name_en",className:"text-sm font-medium",children:"Restaurant Name"}),m.jsx(en,{id:"name_en",...B("name_en"),placeholder:"Enter restaurant name...",className:"text-base"}),Z.name_en&&m.jsx("p",{className:"text-sm text-destructive",children:Z.name_en.message})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx(Vr,{className:"text-sm font-medium",children:"Restaurant Types (1-3 tags)"}),R.map((me,Pe)=>m.jsx("div",{className:"flex gap-2 items-center",children:m.jsx(en,{placeholder:"e.g. Cantonese",value:me.en,onChange:ye=>ie(Pe,"en",ye.target.value)})},Pe))]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"description_en",className:"text-sm font-medium",children:"Description"}),m.jsx(Lm,{id:"description_en",...B("description_en"),rows:3,placeholder:"Enter restaurant description..."})]})]}),m.jsxs(Vl,{value:"pt",className:"space-y-4 mt-0",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"name_pt",className:"text-sm font-medium",children:"Nome do Restaurante"}),m.jsx(en,{id:"name_pt",...B("name_pt"),placeholder:"Digite o nome do restaurante...",className:"text-base"}),Z.name_pt&&m.jsx("p",{className:"text-sm text-destructive",children:Z.name_pt.message})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx(Vr,{className:"text-sm font-medium",children:"Tipos de Restaurante (1-3 tags)"}),R.map((me,Pe)=>m.jsx("div",{className:"flex gap-2 items-center",children:m.jsx(en,{placeholder:"ex: Cantonesa",value:me.pt,onChange:ye=>ie(Pe,"pt",ye.target.value)})},Pe))]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"description_pt",className:"text-sm font-medium",children:"Descrio"}),m.jsx(Lm,{id:"description_pt",...B("description_pt"),rows:3,placeholder:"Digite a descrio do restaurante..."})]})]})]})]})}),m.jsx(rn,{className:"border-primary/20",children:m.jsxs(ln,{className:"p-6 space-y-4",children:[m.jsxs(Vr,{className:"text-base font-semibold flex items-center gap-2",children:[m.jsx(ys,{className:"w-5 h-5 text-primary"}),""]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsxs(Vr,{htmlFor:"address",className:"text-sm font-medium flex items-center gap-2",children:[m.jsx(ys,{className:"w-4 h-4"}),r("admin.address")]}),m.jsx(en,{id:"address",...B("address"),placeholder:"..."}),Z.address&&m.jsx("p",{className:"text-sm text-destructive",children:Z.address.message})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs(Vr,{htmlFor:"phone",className:"text-sm font-medium flex items-center gap-2",children:[m.jsx(RT,{className:"w-4 h-4"}),r("admin.phone")]}),m.jsx(en,{id:"phone",...B("phone"),placeholder:"+351..."})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsxs(Vr,{htmlFor:"website_url",className:"text-sm font-medium flex items-center gap-2",children:[m.jsx(C0,{className:"w-4 h-4"}),r("admin.website")]}),m.jsx(en,{id:"website_url",...B("website_url"),placeholder:"https://"})]}),m.jsxs("div",{className:"flex items-center space-x-2 pt-8",children:[m.jsx(Hs,{id:"show_website_button",checked:de,onCheckedChange:me=>J("show_website_button",me)}),m.jsx(Vr,{htmlFor:"show_website_button",className:"cursor-pointer text-sm",children:r("admin.showWebsiteButton")})]})]})]})}),m.jsx(rn,{className:"border-primary/20",children:m.jsxs(ln,{className:"p-6 space-y-4",children:[m.jsxs(Vr,{className:"text-base font-semibold flex items-center gap-2",children:[m.jsx(ys,{className:"w-5 h-5 text-primary"}),r("admin.location")]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"lat",className:"text-sm font-medium",children:r("admin.latitude")}),m.jsx(en,{id:"lat",type:"number",step:"any",...B("lat",{valueAsNumber:!0})})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"lng",className:"text-sm font-medium",children:r("admin.longitude")}),m.jsx(en,{id:"lng",type:"number",step:"any",...B("lng",{valueAsNumber:!0})})]})]}),m.jsx("div",{ref:C,className:"h-96 w-full rounded-lg border-2 border-primary/20 shadow-sm",style:{minHeight:"384px"}}),m.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[m.jsx(ys,{className:"w-4 h-4"}),r("admin.clickOrDragToSetLocation")]})]})}),m.jsx(rn,{className:"border-primary/20",children:m.jsxs(ln,{className:"p-6 space-y-4",children:[m.jsxs(Vr,{className:"text-base font-semibold flex items-center gap-2",children:[m.jsx(IT,{className:"w-5 h-5 text-primary"}),r("admin.openingHours")]}),m.jsx("div",{className:"space-y-3",children:$W.map(me=>m.jsxs("div",{className:"space-y-2 p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[m.jsxs("div",{className:"grid grid-cols-[120px_1fr_auto] gap-4 items-center",children:[m.jsx(Vr,{className:"capitalize font-semibold",children:r(`admin.day.${me}`)}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(Hs,{id:`split-${me}`,checked:j[me].splitShift,onCheckedChange:Pe=>D({...j,[me]:{...j[me],splitShift:Pe}}),disabled:j[me].closed}),m.jsx(Vr,{htmlFor:`split-${me}`,className:"cursor-pointer text-sm",children:""})]}),m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx(Hs,{id:`closed-${me}`,checked:j[me].closed,onCheckedChange:Pe=>D({...j,[me]:{...j[me],closed:Pe}})}),m.jsx(Vr,{htmlFor:`closed-${me}`,className:"cursor-pointer",children:r("admin.closed")})]})]}),!j[me].closed&&m.jsx("div",{className:"ml-[120px] space-y-2",children:j[me].splitShift?m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-sm text-muted-foreground w-12",children:""}),m.jsx(en,{type:"time",value:j[me].open,onChange:Pe=>D({...j,[me]:{...j[me],open:Pe.target.value}}),className:"w-32"}),m.jsx("span",{className:"text-muted-foreground",children:"-"}),m.jsx(en,{type:"time",value:j[me].close,onChange:Pe=>D({...j,[me]:{...j[me],close:Pe.target.value}}),className:"w-32"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-sm text-muted-foreground w-12",children:""}),m.jsx(en,{type:"time",value:j[me].open2||"19:00",onChange:Pe=>D({...j,[me]:{...j[me],open2:Pe.target.value}}),className:"w-32"}),m.jsx("span",{className:"text-muted-foreground",children:"-"}),m.jsx(en,{type:"time",value:j[me].close2||"23:00",onChange:Pe=>D({...j,[me]:{...j[me],close2:Pe.target.value}}),className:"w-32"})]})]}):m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(en,{type:"time",value:j[me].open,onChange:Pe=>D({...j,[me]:{...j[me],open:Pe.target.value}}),className:"w-32"}),m.jsx("span",{className:"text-muted-foreground",children:"-"}),m.jsx(en,{type:"time",value:j[me].close,onChange:Pe=>D({...j,[me]:{...j[me],close:Pe.target.value}}),className:"w-32"})]})})]},me))})]})})]})}),m.jsxs("div",{className:"flex justify-end gap-2 px-6 py-4 border-t bg-muted/30",children:[m.jsx(ir,{type:"button",variant:"outline",onClick:()=>d(!1),children:r("common.cancel")}),m.jsxs(ir,{type:"submit",disabled:E,onClick:U(Ce),className:"gap-2",children:[m.jsx(es,{className:"w-4 h-4"}),r(E?"common.saving":"common.save")]})]})]})]})}const QM=768;function G4(){const[e,t]=W.useState(void 0);return W.useEffect(()=>{const r=window.matchMedia(`(max-width: ${QM-1}px)`),n=()=>{t(window.innerWidth<QM)};return r.addEventListener("change",n),t(window.innerWidth<QM),()=>r.removeEventListener("change",n)},[]),!!e}const VOe=()=>{var Ie,tt,Ze;const{id:e}=pQ(),t=Rh(),{t:r,i18n:n}=Ki(),{user:o}=Fi(),{localizeRestaurant:l,getLocalizedField:d}=Id(),i=G4(),g=W.useRef(null),_=W.useRef(null),[S,E]=W.useState(null),[T,C]=W.useState(!1),[N,I]=W.useState(!0),[j,D]=W.useState(!1),R=(Ie=t.state)==null?void 0:Ie.fromActivity,B=((tt=t.state)==null?void 0:tt.from)==="admin"?"/admin/restaurants":R?`/activity/${R}`:"/restaurants",{data:U,isLoading:Z}=pPe(e),{data:J=[]}=cne(),{data:te}=C4(e,"restaurant"),ae=une(),{role:ne,isAdmin:ie}=nu(),{data:ee=[]}=KT(),{data:oe=[]}=gPe(e),de=U&&ee.some(Le=>Le.id===U.id),xe=U?l(U):null,we=U?J.includes(U.id):!1;W.useMemo(()=>[{value:"",label:" (0-10)"},{value:"",label:" (10-20)"},{value:"",label:" (20+)"}],[]);const Ae=W.useMemo(()=>te==null?void 0:te.reduce((Le,qe)=>(qe.price_range&&(Le[qe.price_range]=(Le[qe.price_range]||0)+1),Le),{}),[te]),Ce=W.useMemo(()=>{var Le;return Ae?(Le=Object.entries(Ae).sort(([,qe],[,Ge])=>Ge-qe)[0])==null?void 0:Le[0]:null},[Ae]);W.useEffect(()=>{U&&FI().then(Le=>{const qe=HT(Le.coords.latitude,Le.coords.longitude,U.lat,U.lng);E(qe)}).catch(()=>{E(null)})},[U]);const me=W.useCallback(()=>{!o||!U||ae.mutate(U.id)},[o,U,ae]),Pe=W.useCallback(async()=>{try{await navigator.clipboard.writeText(window.location.href),Br.success(r("common.linkCopied"))}catch(Le){console.error("Error copying link:",Le),Br.error(r("common.shareError"))}},[r]),ye=W.useCallback(async()=>{if(!U||!xe)return;const Le={title:xe.name,text:`${xe.name} - Xiaoxiong Market

${xe.description||xe.address}`,url:window.location.href};try{navigator.share&&navigator.canShare&&navigator.canShare(Le)?(await navigator.share(Le),Br.success(r("common.shareSuccess"))):Pe()}catch(qe){qe.name!=="AbortError"&&(console.error("Error sharing:",qe),Br.error(r("common.shareError")))}},[U,xe,Pe,r]),pe=W.useCallback(Le=>{if(!U||!xe)return;const qe=encodeURIComponent(window.location.href),Ge=encodeURIComponent(xe.name);let je="";switch(Le){case"whatsapp":je=`https://wa.me/?text=${Ge}%20${qe}`;break;case"facebook":je=`https://www.facebook.com/sharer/sharer.php?u=${qe}`;break;case"twitter":je=`https://twitter.com/intent/tweet?text=${Ge}&url=${qe}`;break;case"telegram":je=`https://t.me/share/url?url=${qe}&text=${Ge}`;break;case"wechat":Pe(),Br.info(r("common.shareVia")+" WeChat");return;default:return}window.open(je,"_blank","width=600,height=400")},[U,xe,Pe,r]);return W.useEffect(()=>{if(!g.current||_.current||!U)return;const Le="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";return Jo.accessToken=Le,_.current=new Jo.Map({container:g.current,style:"mapbox://styles/mapbox/light-v11",center:[U.lng,U.lat],zoom:15,cooperativeGestures:!0}),new Jo.Marker({color:"#016450"}).setLngLat([U.lng,U.lat]).addTo(_.current),_.current.addControl(new Jo.NavigationControl),()=>{var qe;(qe=_.current)==null||qe.remove(),_.current=null}},[U]),Z?m.jsx("div",{className:"min-h-screen flex items-center justify-center",children:m.jsx(Gs,{className:"w-8 h-8 animate-spin text-primary"})}):!U||!xe?m.jsx("div",{className:"min-h-screen flex items-center justify-center",children:m.jsxs("div",{className:"text-center",children:[m.jsx("p",{className:"text-xl text-muted-foreground",children:r("error.notFound")}),m.jsx(ir,{asChild:!0,className:"mt-4",children:m.jsx(ia,{to:B,children:r("common.back")})})]})}):m.jsxs("div",{className:"min-h-screen bg-secondary/20",children:[m.jsxs("div",{className:"relative h-[33vh] overflow-hidden",children:[m.jsx("img",{src:U.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80",alt:xe.name,className:"w-full h-full object-cover"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),m.jsx(ir,{asChild:!0,variant:"secondary",size:"icon",className:"absolute top-4 left-4",children:m.jsx(ia,{to:B,children:m.jsx(oI,{className:"w-5 h-5"})})}),o&&m.jsx(ir,{variant:"secondary",size:"icon",className:"absolute top-4 right-4",onClick:me,children:m.jsx(yB,{className:`w-5 h-5 ${we?"fill-destructive text-destructive":""}`})}),i&&navigator.share?m.jsx(ir,{variant:"secondary",size:"icon",className:"absolute top-4 right-16 shadow-lg",onClick:ye,children:m.jsx(ch,{className:"w-5 h-5"})}):m.jsxs(Iv,{children:[m.jsx(Rv,{asChild:!0,children:m.jsx(ir,{variant:"secondary",size:"icon",className:"absolute top-4 right-16 shadow-lg",children:m.jsx(ch,{className:"w-5 h-5"})})}),m.jsxs(ag,{align:"end",className:"w-48",children:[navigator.share&&m.jsxs(m.Fragment,{children:[m.jsxs(Oa,{onClick:ye,children:[m.jsx(ch,{className:"w-4 h-4 mr-2"}),r("common.moreOptions")]}),m.jsx(Pf,{})]}),m.jsxs(Oa,{onClick:()=>pe("wechat"),children:[m.jsx(im,{className:"w-4 h-4 mr-2"}),"WeChat"]}),m.jsxs(Oa,{onClick:()=>pe("whatsapp"),children:[m.jsx(im,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),m.jsxs(Oa,{onClick:()=>pe("facebook"),children:[m.jsx(ch,{className:"w-4 h-4 mr-2"}),"Facebook"]}),m.jsxs(Oa,{onClick:()=>pe("twitter"),children:[m.jsx(ch,{className:"w-4 h-4 mr-2"}),"X (Twitter)"]}),m.jsxs(Oa,{onClick:()=>pe("telegram"),children:[m.jsx(im,{className:"w-4 h-4 mr-2"}),"Telegram"]}),m.jsx(Pf,{}),m.jsxs(Oa,{onClick:Pe,children:[m.jsx(eJ,{className:"w-4 h-4 mr-2"}),r("common.copyLink")]})]})]}),(de||ie)&&U&&m.jsx(DO,{restaurant:U,trigger:m.jsx(ir,{variant:"secondary",size:"icon",className:"absolute top-4 right-28",children:m.jsx(xB,{className:"w-5 h-5"})})}),U&&m.jsx(N4,{targetType:"restaurant",targetId:U.id,trigger:m.jsx(ir,{variant:"secondary",size:"icon",className:`absolute top-4 ${de||ie?"right-40":"right-28"}`,children:m.jsx(lI,{className:"w-5 h-5"})})})]}),m.jsx("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12",children:m.jsxs(rn,{className:"shadow-large",children:[m.jsx(Di,{children:m.jsx("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:m.jsxs("div",{children:[m.jsxs("div",{className:"mb-2 flex flex-wrap gap-2",children:[xe.type.slice(0,3).map((Le,qe)=>m.jsx(jn,{variant:"secondary",children:Le},qe)),oe.map((Le,qe)=>m.jsx(jn,{variant:"default",className:"text-white",style:{backgroundColor:Le.badge_color||"#9b87f5"},children:S4(Le,n.language)},`activity-${qe}`))]}),m.jsx(Qi,{className:"text-3xl mb-2",children:xe.name}),m.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[S!==null&&m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(uh,{className:"w-4 h-4 text-primary"}),m.jsxs("span",{className:"font-semibold text-base",children:[S.toFixed(1)," km"]})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(Ec,{className:"w-5 h-5 fill-accent text-accent"}),m.jsx("span",{className:"font-semibold text-base",children:((Ze=U.rating)==null?void 0:Ze.toFixed(1))||"0.0"})]}),Ce&&m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(kye,{className:"w-4 h-4 text-primary"}),m.jsx("span",{className:"font-semibold text-base",children:Ce})]})]}),xe.description&&m.jsx("p",{className:"text-muted-foreground",children:xe.description})]})})}),m.jsxs(ln,{className:"space-y-6",children:[m.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[m.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[m.jsx(ys,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),m.jsxs("div",{children:[m.jsx("p",{className:"font-medium text-card-foreground",children:r("restaurant.address")}),m.jsx("p",{className:"text-muted-foreground",children:U.address})]})]}),U.phone&&m.jsxs("a",{href:`tel:${U.phone}`,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors cursor-pointer",children:[m.jsx(RT,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),m.jsxs("div",{children:[m.jsx("p",{className:"font-medium text-card-foreground",children:r("restaurant.phone")}),m.jsx("p",{className:"text-primary underline",children:U.phone})]})]}),U.opening_hours&&m.jsxs(SC,{open:T,onOpenChange:C,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[m.jsx(IT,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),m.jsxs("div",{className:"flex-1",children:[m.jsx(EC,{className:"w-full",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex flex-col items-start",children:[m.jsx("p",{className:"font-medium text-card-foreground",children:r("restaurant.hours")}),!T&&m.jsxs("p",{className:"text-sm text-muted-foreground mt-0.5",children:[r("restaurant.today")," ",gne(U.opening_hours)]})]}),m.jsx(ev,{className:`w-5 h-5 text-muted-foreground transition-transform ${T?"rotate-180":""}`})]})}),m.jsx(TC,{className:"mt-3",children:m.jsx("div",{className:"space-y-2",children:(()=>{const Le=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],qe={monday:"dayMon",tuesday:"dayTue",wednesday:"dayWed",thursday:"dayThu",friday:"dayFri",saturday:"daySat",sunday:"daySun"},Ge=Le[new Date().getDay()===0?6:new Date().getDay()-1];return Le.map(je=>{const ot=U.opening_hours[je],St=je===Ge,rt=r(`restaurant.${qe[je]}`);let Ut="N/A";return ot&&(ot.closed?Ut=r("restaurant.closed"):ot.splitShift?Ut=`${ot.open} - ${ot.close}, ${ot.open2} - ${ot.close2}`:Ut=`${ot.open} - ${ot.close}`),m.jsxs("div",{className:`flex justify-between items-center py-1.5 px-2 rounded ${St?"bg-primary/10 border border-primary/20":""}`,children:[m.jsxs("span",{className:`text-sm font-medium ${St?"text-primary":"text-foreground"}`,children:[rt,St&&m.jsxs("span",{className:"ml-2 text-xs",children:["(",r("restaurant.today"),")"]})]}),m.jsx("span",{className:`text-sm ${St?"text-primary font-semibold":"text-muted-foreground"} ${ot!=null&&ot.closed?"italic":""}`,children:Ut})]},je)})})()})})]})]}),U&&(d(U,"announcement")||U.announcement_zh)&&m.jsxs(SC,{open:j,onOpenChange:D,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[m.jsx(im,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),m.jsxs("div",{className:"flex-1",children:[m.jsx(EC,{className:"w-full",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("p",{className:"font-medium text-card-foreground",children:r("restaurant.announcement")}),m.jsx(ev,{className:`w-5 h-5 text-muted-foreground transition-transform ${j?"rotate-180":""}`})]})}),m.jsx(TC,{className:"mt-3",children:m.jsx("div",{className:"p-3 rounded-md bg-primary/5 border border-primary/10",children:m.jsx("p",{className:"text-sm text-foreground whitespace-pre-wrap",children:d(U,"announcement")||U.announcement_zh})})})]})]})]}),m.jsxs("div",{className:"flex flex-col gap-3",children:[m.jsxs(ir,{variant:"secondary",className:"w-full",onClick:()=>hne(U.lat,U.lng,xe.name),children:[m.jsx(uh,{className:"w-4 h-4 mr-2"}),r("restaurant.getDirections")]}),U.show_website_button&&U.website_url&&m.jsxs(ir,{className:"w-full",onClick:()=>window.open(U.website_url,"_blank"),children:[m.jsx(im,{className:"w-4 h-4 mr-2"}),r("restaurant.joinPrivate")]})]}),m.jsxs(SC,{open:N,onOpenChange:I,className:"p-4 rounded-lg bg-muted/50",children:[m.jsx(EC,{className:"w-full",children:m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsx("h2",{className:"text-2xl font-bold",children:r("restaurant.address")}),m.jsx(ev,{className:`w-5 h-5 text-muted-foreground transition-transform ${N?"rotate-180":""}`})]})}),m.jsx(TC,{children:m.jsx("div",{ref:g,className:"h-[350px] rounded-lg overflow-hidden"})})]}),m.jsx(xu,{}),m.jsx(RPe,{restaurantId:U.id}),m.jsx(xu,{}),m.jsx(Lie,{restaurantId:U.id})]})]})})]})},UW=({restaurant:e,activities:t,language:r})=>{const[n,o]=W.useState(999),l=W.useRef(null),d=[...e.type.slice(0,3).map((_,S)=>({key:`type-${S}`,label:_,variant:"secondary",color:void 0})),...t.map((_,S)=>({key:`activity-${S}`,label:S4(_,r),variant:"default",color:_.badge_color||"#9b87f5"}))];W.useEffect(()=>{const _=()=>{var I;if(!l.current)return;const E=l.current,T=Array.from(E.querySelectorAll(".tag-badge"));if(T.length===0){setTimeout(_,50);return}const C=(I=T[0])==null?void 0:I.offsetTop;let N=T.length;for(let j=0;j<T.length;j++)if(T[j].offsetTop>C){N=j;break}N<T.length&&(N=Math.max(1,N-1)),o(N)};o(999);const S=setTimeout(_,100);return window.addEventListener("resize",_),()=>{clearTimeout(S),window.removeEventListener("resize",_)}},[d.length,e.id]);const i=d.slice(0,n),g=d.length>n;return m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{ref:l,className:"flex gap-1.5 flex-wrap flex-1",children:i.map(_=>m.jsx(jn,{variant:_.variant,className:"text-xs font-medium whitespace-nowrap tag-badge",style:_.color?{backgroundColor:_.color,color:"white"}:void 0,children:_.label},_.key))}),g&&m.jsxs(EO,{children:[m.jsx(TO,{asChild:!0,children:m.jsx(ir,{variant:"ghost",size:"sm",className:"h-6 px-2 text-muted-foreground hover:text-foreground flex-shrink-0",children:m.jsx(mB,{className:"h-4 w-4"})})}),m.jsx(jE,{className:"w-80",children:m.jsx("div",{className:"flex flex-wrap gap-2",children:d.map(_=>m.jsx(jn,{variant:_.variant,className:"text-xs font-medium",style:_.color?{backgroundColor:_.color,color:"white"}:void 0,children:_.label},_.key))})})]})]})},qOe=()=>{const e=qf(),{t,i18n:r}=Ki(),{toast:n}=Sa(),{localizeRestaurant:o}=Id(),[l,d]=W.useState(""),[i,g]=W.useState([]),[_,S]=W.useState(null),[E,T]=W.useState([]),[C,N]=W.useState(null),[I,j]=W.useState(null),[D,R]=W.useState(!1),[F,B]=W.useState(!1),[U,Z]=W.useState(!1),J=W.useRef(null),te=W.useRef(null),ae=W.useRef({}),[ne,ie]=W.useState(null),{data:ee,isLoading:oe}=w4(l,i.length>0?i.join(","):void 0),{data:de=[]}=dne(),{data:xe=[]}=zI(),we=Ge=>{g(je=>je.includes(Ge)?je.filter(ot=>ot!==Ge):[...je,Ge])},Ae=async()=>{try{const Ge=await FI();j({lat:Ge.coords.latitude,lng:Ge.coords.longitude}),n({title:t("restaurants.locationEnabled"),description:t("restaurants.sortByDistance")})}catch{}},Ce=Ge=>{N(Ge),Ge&&!I&&Ae()},me=async Ge=>{if(_===Ge)S(null),T([]);else{S(Ge);const{data:je,error:ot}=await qt.from("activity_restaurants").select("restaurant_id").eq("activity_id",Ge);ot?(console.error("Error fetching activity restaurants:",ot),T([])):T(je.map(St=>St.restaurant_id))}},Pe=(ee==null?void 0:ee.map(Ge=>{const je=o(Ge);if(I){const ot=HT(I.lat,I.lng,Ge.lat,Ge.lng);return{...je,distance:ot}}return je}))||[],ye=_&&E.length>0?Pe.filter(Ge=>E.includes(Ge.id)):Pe,pe=C&&I?ye.filter(Ge=>Ge.distance&&Ge.distance<=C).sort((Ge,je)=>(Ge.distance||0)-(je.distance||0)):I?ye.sort((Ge,je)=>(Ge.distance||0)-(je.distance||0)):ye,Ie=(pe==null?void 0:pe.map(Ge=>Ge.id))||[],{data:tt={}}=yne(Ie),Ze=Ge=>{e(`/restaurant/${Ge.id}`)},Le=Ge=>{ie(Ge.id);const je=ae.current[Ge.id];je&&je.scrollIntoView({behavior:"smooth",block:"center"})},qe=()=>{const Ge=document.getElementById("map-container");if(Ge)if(D)document.exitFullscreen&&document.exitFullscreen();else{if(J.current){const je=J.current.getCenter(),ot=J.current.getZoom();te.current={center:[je.lng,je.lat],zoom:ot}}Ge.requestFullscreen&&Ge.requestFullscreen()}};return W.useEffect(()=>{const Ge=()=>{const je=!!document.fullscreenElement;R(je),!je&&te.current&&J.current&&setTimeout(()=>{var ot;(ot=J.current)==null||ot.jumpTo({center:te.current.center,zoom:te.current.zoom})},100)};return document.addEventListener("fullscreenchange",Ge),()=>{document.removeEventListener("fullscreenchange",Ge)}},[]),m.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4 animate-fade-in",children:m.jsxs("div",{className:"container mx-auto max-w-7xl lg:h-screen lg:flex lg:flex-col",children:[m.jsxs("div",{className:"mb-6 flex-shrink-0",children:[m.jsx("h1",{className:"text-4xl font-bold mb-2 bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:t("nav.mapView")}),m.jsx("p",{className:"text-muted-foreground",children:t("map.subtitle")})]}),m.jsxs("div",{className:"mb-6 space-y-4 flex-shrink-0",children:[m.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[m.jsx("div",{className:"flex-1 max-w-md",children:m.jsx(en,{placeholder:t("restaurants.search"),value:l,onChange:Ge=>d(Ge.target.value),className:"h-11 bg-background/60 backdrop-blur-sm border-primary/20 focus:border-primary"})}),m.jsxs(ir,{variant:I?"default":"outline",onClick:Ae,className:"gap-2 h-11 px-6",children:[m.jsx(uh,{className:`w-4 h-4 ${I?"animate-pulse":""}`}),t(I?"restaurants.locationEnabled":"restaurants.getLocation")]})]}),m.jsxs("div",{className:"space-y-3 bg-card/50 backdrop-blur-sm rounded-lg p-4 border border-border/50 animate-fade-in",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[m.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[t("restaurants.restaurantTypes"),":"]}),i.length>0&&m.jsx(jn,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5",onClick:()=>g([]),children:t("common.actions.clearFilter")}),de.length>8&&m.jsx(ir,{variant:"ghost",size:"sm",className:"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200",onClick:()=>B(!F),children:t(F?"common.showLess":"common.showMore")})]}),m.jsxs("div",{className:"relative overflow-hidden",children:[m.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${F?"animate-expand-height":""}`,children:(F?de:de.slice(0,8)).map((Ge,je)=>m.jsx(jn,{variant:i.includes(Ge)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${i.includes(Ge)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${je*30}ms`},onClick:()=>we(Ge),children:Ge},Ge))}),m.jsxs("div",{className:"sm:hidden relative -mx-1 px-1",children:[m.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth",children:de.map((Ge,je)=>m.jsx(jn,{variant:i.includes(Ge)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${i.includes(Ge)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${je*30}ms`},onClick:()=>we(Ge),children:Ge},Ge))}),m.jsx("div",{className:"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none"}),m.jsx("div",{className:"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none"})]})]})]}),xe.length>0&&m.jsxs("div",{className:"space-y-2 pt-1 border-t border-border/30",children:[m.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[m.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[t("nav.activities"),":"]}),_&&m.jsx(jn,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5",onClick:()=>{S(null),T([])},children:t("common.actions.clearFilter")}),xe.length>8&&m.jsx(ir,{variant:"ghost",size:"sm",className:"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200",onClick:()=>Z(!U),children:t(U?"common.showLess":"common.showMore")})]}),m.jsxs("div",{className:"relative overflow-hidden",children:[m.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${U?"animate-expand-height":""}`,children:(U?xe:xe.slice(0,8)).map((Ge,je)=>{const ot=r.language==="zh"?Ge.title_zh:r.language==="pt"?Ge.title_pt:Ge.title_en;return m.jsx(jn,{variant:_===Ge.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${_===Ge.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${je*30}ms`},onClick:()=>me(Ge.id),children:ot},Ge.id)})}),m.jsxs("div",{className:"sm:hidden relative -mx-1 px-1",children:[m.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth",children:xe.map((Ge,je)=>{const ot=r.language==="zh"?Ge.title_zh:r.language==="pt"?Ge.title_pt:Ge.title_en;return m.jsx(jn,{variant:_===Ge.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${_===Ge.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${je*30}ms`},onClick:()=>me(Ge.id),children:ot},Ge.id)})}),m.jsx("div",{className:"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none"}),m.jsx("div",{className:"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none"})]})]})]})]}),I&&m.jsxs("div",{className:"flex gap-2 flex-wrap items-center bg-muted/30 backdrop-blur-sm rounded-lg p-3 border border-primary/10",children:[m.jsxs("span",{className:"text-sm font-semibold text-primary",children:[t("restaurants.radius"),":"]}),m.jsx(jn,{variant:C===null?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>Ce(null),children:t("restaurants.allRestaurants")}),m.jsx(jn,{variant:C===5?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>Ce(5),children:t("restaurants.radius5km")}),m.jsx(jn,{variant:C===10?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>Ce(10),children:t("restaurants.radius10km")}),m.jsx(jn,{variant:C===20?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>Ce(20),children:t("restaurants.radius20km")})]})]}),!oe&&pe&&m.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 lg:flex-1 lg:min-h-0 lg:overflow-hidden",children:[m.jsx("div",{className:"w-full lg:flex-1 h-[500px] lg:h-full",children:m.jsxs("div",{id:"map-container",className:`${D?"fixed inset-0 z-50 bg-background":"w-full h-full"} rounded-xl overflow-hidden shadow-2xl border border-primary/10 relative group`,children:[m.jsx(ir,{variant:"secondary",size:"icon",className:"absolute bottom-4 right-4 z-10 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:qe,children:D?m.jsx(Eye,{className:"w-5 h-5"}):m.jsx(Sye,{className:"w-5 h-5"})}),m.jsx("div",{className:"h-full",children:m.jsx(mne,{restaurants:pe,onRestaurantClick:Ze,userLocation:I,radiusFilter:C,onMarkerClick:Le,showViewDetailsButton:!0,onMapInit:Ge=>{J.current=Ge}})})]})}),m.jsxs("div",{className:"w-full lg:w-[420px] flex flex-col lg:min-h-0 lg:h-full",children:[m.jsxs("div",{className:"mb-4 pb-4 border-b border-border flex-shrink-0",children:[m.jsxs("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[m.jsx(ys,{className:"w-6 h-6 text-primary"}),t("restaurants.title"),m.jsx(jn,{variant:"secondary",className:"ml-2",children:pe.length})]}),I&&m.jsxs("p",{className:"text-sm text-muted-foreground mt-2 flex items-center gap-1.5",children:[m.jsx(uh,{className:"w-4 h-4"}),t("restaurants.sortedByDistance")]})]}),pe.length===0?m.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[m.jsx(ys,{className:"w-16 h-16 text-muted-foreground/40 mb-4"}),m.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2",children:t("restaurants.noResults")}),m.jsx("p",{className:"text-muted-foreground max-w-xs",children:t("restaurants.noResultsDesc")})]}):m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"lg:hidden space-y-3 pb-4",children:pe.map(Ge=>m.jsx(rn,{ref:je=>ae.current[Ge.id]=je,className:`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${ne===Ge.id?"border-primary ring-2 ring-primary ring-offset-2":"border-transparent"}`,onClick:()=>Ze(Ge),children:m.jsxs("div",{className:"flex flex-col gap-3",children:[m.jsxs("div",{className:"flex items-start justify-between gap-2",children:[m.jsx("h3",{className:"font-bold text-lg text-foreground line-clamp-1 flex-1",children:Ge.name}),m.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[Ge.distance!==void 0&&m.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full",children:[m.jsx(uh,{className:"w-4 h-4 text-primary"}),m.jsx("span",{className:"font-bold text-sm text-primary",children:Ge.distance<1?`${(Ge.distance*1e3).toFixed(0)} m`:`${Ge.distance.toFixed(1)} km`})]}),Ge.rating>0&&m.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full",children:[m.jsx(Ec,{className:"w-4 h-4",style:{fill:"#016450",color:"#016450"}}),m.jsx("span",{className:"font-bold text-sm text-primary",children:Ge.rating})]})]})]}),Ge.type&&Ge.type.length>0&&m.jsx(UW,{restaurant:Ge,activities:tt[Ge.id]||[],language:r.language}),m.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[m.jsx(ys,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60"}),m.jsx("span",{className:"line-clamp-2",children:Ge.address})]})]})},Ge.id))}),m.jsx(fv,{className:"hidden lg:block lg:flex-1 pr-4",children:m.jsx("div",{className:"space-y-3 pb-4",children:pe.map(Ge=>m.jsx(rn,{ref:je=>ae.current[Ge.id]=je,className:`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${ne===Ge.id?"border-primary ring-2 ring-primary ring-offset-2":"border-transparent"}`,onClick:()=>Ze(Ge),children:m.jsxs("div",{className:"flex flex-col gap-3",children:[m.jsxs("div",{className:"flex items-start justify-between gap-2",children:[m.jsx("h3",{className:"font-bold text-lg text-foreground line-clamp-1 flex-1",children:Ge.name}),m.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[Ge.distance!==void 0&&m.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full",children:[m.jsx(uh,{className:"w-4 h-4 text-primary"}),m.jsx("span",{className:"font-bold text-sm text-primary",children:Ge.distance<1?`${(Ge.distance*1e3).toFixed(0)} m`:`${Ge.distance.toFixed(1)} km`})]}),Ge.rating>0&&m.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full",children:[m.jsx(Ec,{className:"w-4 h-4",style:{fill:"#016450",color:"#016450"}}),m.jsx("span",{className:"font-bold text-sm text-primary",children:Ge.rating})]})]})]}),Ge.type&&Ge.type.length>0&&m.jsx(UW,{restaurant:Ge,activities:tt[Ge.id]||[],language:r.language}),m.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[m.jsx(ys,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60"}),m.jsx("span",{className:"line-clamp-2",children:Ge.address})]})]})},Ge.id))})})]})]})]})]})})},WOe=()=>{const{t:e}=Ki(),{user:t}=Fi(),{localizeActivity:r}=Id(),{data:n,isLoading:o}=zI(),{data:l=[]}=E4(),d=l.map(T=>T.activity_id),i=vne(),{displayedData:g,hasMore:_,loadMore:S}=_ne({data:n,initialItemsPerPage:6,incrementPerPage:6}),E=(T,C)=>{if(C.preventDefault(),C.stopPropagation(),!t){Fc({title:e("activities.signInToSubscribe")||"",description:e("activities.signInToSubscribeDesc")||"",variant:"destructive"});return}i.mutate(T)};return m.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4 animate-fade-in",children:m.jsxs("div",{className:"container mx-auto max-w-7xl",children:[m.jsxs("div",{className:"mb-8",children:[m.jsx("h1",{className:"text-4xl font-bold mb-2 text-foreground",children:e("activities.title")}),m.jsx("p",{className:"text-muted-foreground text-lg",children:e("activities.description")})]}),o&&m.jsx("div",{className:"flex justify-center items-center py-20",children:m.jsx(Gs,{className:"w-8 h-8 animate-spin text-primary"})}),!o&&(!n||n.length===0)&&m.jsx("div",{className:"text-center py-20",children:m.jsx("p",{className:"text-xl text-muted-foreground",children:e("activities.noActivities")||"No activities available"})}),!o&&n&&n.length>0&&m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:g.map(T=>{const C=r(T);return m.jsx(rn,{className:"overflow-hidden hover:shadow-large transition-shadow",children:m.jsxs(ia,{to:`/activity/${T.id}`,children:[m.jsxs("div",{className:"relative h-48 overflow-hidden",children:[m.jsx("img",{src:T.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=600&q=80",alt:C.title,className:"w-full h-full object-cover transition-transform hover:scale-105"}),T.pinned&&m.jsx(jn,{className:"absolute top-3 left-3 bg-accent",children:e("activities.pinned")}),T.end_date&&new Date(T.end_date)<new Date?m.jsx(jn,{className:"absolute top-3 right-3 bg-secondary",children:e("activities.ended")}):T.subscriber_count!==void 0&&m.jsxs(jn,{variant:"secondary",className:"absolute top-3 right-3 flex items-center gap-1.5",children:[m.jsx(_u,{className:"w-3.5 h-3.5"}),m.jsx("span",{children:T.subscriber_count})]})]}),m.jsx(Di,{children:m.jsx("h3",{className:"text-xl font-semibold text-card-foreground line-clamp-2",children:C.title})}),m.jsxs(ln,{className:"space-y-3",children:[m.jsx("div",{className:`text-muted-foreground text-sm line-clamp-3\r
                          [&_h1]:text-base [&_h1]:font-bold [&_h1]:text-foreground\r
                          [&_h2]:text-sm [&_h2]:font-semibold [&_h2]:text-foreground\r
                          [&_h3]:text-sm [&_h3]:font-medium [&_h3]:text-foreground\r
                          [&_strong]:font-semibold [&_strong]:text-foreground\r
                          [&_p]:my-1\r
                          [&_ul]:list-disc [&_ul]:ml-4\r
                          [&_ol]:list-decimal [&_ol]:ml-4`,dangerouslySetInnerHTML:{__html:C.content}}),m.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[m.jsx(Sc,{className:"w-4 h-4"}),m.jsx("span",{children:Is(new Date(T.start_date),"PPP")})]}),T.end_date&&m.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[m.jsx(IT,{className:"w-4 h-4"}),m.jsxs("span",{children:[e("activities.until")," ",Is(new Date(T.end_date),"PPP")]})]})]}),m.jsxs(DI,{className:"gap-2",children:[m.jsx(ir,{asChild:!0,className:"flex-1",children:m.jsx("span",{children:e("activities.viewDetails")})}),m.jsx(ir,{variant:d.includes(T.id)?"outline":"default",onClick:N=>E(T.id,N),disabled:i.isPending,title:d.includes(T.id)?e("activities.subscribed"):e("activities.subscribe"),children:d.includes(T.id)?m.jsx(lye,{className:"w-4 h-4"}):m.jsx(QY,{className:"w-4 h-4"})})]})]})},T.id)})}),_&&m.jsx("div",{className:"flex justify-center mt-8",children:m.jsxs(ir,{onClick:S,size:"lg",variant:"outline",children:[e("common.loadMore")," (",g.length," / ",n.length,")"]})})]})]})})},wae=W.memo(({restaurants:e,onMarkerClick:t})=>{const r=W.useRef(null),n=W.useRef(null),o=W.useRef([]),[l,d]=W.useState(!1),i=W.useRef(null);return W.useEffect(()=>{if(!r.current||n.current)return;const g="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";Jo.accessToken=g;const _=e.reduce((E,T)=>E+Number(T.restaurants.lat||0),0)/e.length,S=e.reduce((E,T)=>E+Number(T.restaurants.lng||0),0)/e.length;return n.current=new Jo.Map({container:r.current,style:"mapbox://styles/mapbox/light-v11",center:[S,_],zoom:12,cooperativeGestures:!0,doubleClickZoom:!1}),n.current.addControl(new Jo.NavigationControl,"top-right"),n.current.on("load",()=>{d(!0)}),()=>{var E;o.current.forEach(T=>T.remove()),o.current=[],i.current&&(i.current.remove(),i.current=null),(E=n.current)==null||E.remove(),n.current=null,d(!1)}},[]),W.useEffect(()=>{if(!n.current||!l||e.length===0)return;(()=>{var _;if(o.current.forEach(S=>S.remove()),o.current=[],i.current&&(i.current.remove(),i.current=null),e.forEach(S=>{const E=Number(S.restaurants.lat),T=Number(S.restaurants.lng);if(isNaN(E)||isNaN(T))return;const C=document.createElement("div");C.className="p-3 min-w-[200px]",C.innerHTML=`
          <div class="space-y-2">
            <h3 class="font-bold text-base text-foreground">${S.restaurants.name}</h3>
            <p class="text-xs text-muted-foreground">${S.restaurants.address}</p>
          </div>
        `;const N=new Jo.Popup({offset:25,closeButton:!0,closeOnClick:!1,closeOnMove:!1,maxWidth:"300px"}).setLngLat([T,E]).setDOMContent(C),I=new Jo.Marker({color:"#016450",draggable:!1}).setLngLat([T,E]).addTo(n.current),j=I.getElement();j.style.cursor="pointer";const D=R=>{R.stopPropagation(),R.preventDefault(),i.current&&i.current!==N&&i.current.remove(),N.addTo(n.current),i.current=N,n.current.easeTo({center:[T,E],zoom:17,duration:800}),t&&t(S.restaurant_id)};j.addEventListener("click",D,!0),N.on("close",()=>{i.current===N&&(i.current=null)}),o.current.push(I)}),e.length>1){const S=new Jo.LngLatBounds;e.forEach(E=>{const T=Number(E.restaurants.lat),C=Number(E.restaurants.lng);!isNaN(T)&&!isNaN(C)&&S.extend([C,T])}),(_=n.current)==null||_.fitBounds(S,{padding:50,maxZoom:14})}})()},[e,l,t]),e.length===0?null:m.jsx("div",{ref:r,className:"w-full h-[350px] rounded-lg"})});wae.displayName="ActivityParticipationMap";const GOe=({open:e,onOpenChange:t,restaurants:r,participatingRestaurantIds:n,onConfirm:o,isPending:l,isParticipating:d})=>{const{t:i}=Ki(),{localizeRestaurant:g}=Id(),[_,S]=W.useState(d?n:[]),E=N=>{S(I=>I.includes(N)?I.filter(j=>j!==N):[...I,N])},T=()=>{_.length===r.length?S([]):S(r.map(N=>N.id))},C=()=>{o(_)};return m.jsx(Nh,{open:e,onOpenChange:t,children:m.jsxs(Rd,{className:"max-w-[90vw] sm:max-w-[600px] max-h-[90vh] overflow-hidden flex flex-col",children:[m.jsxs(jd,{children:[m.jsxs(Nd,{className:"flex items-center gap-2",children:[m.jsx(es,{className:"w-5 h-5"}),d?"":""]}),m.jsx(Md,{children:d?"":""})]}),m.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 py-4",children:[m.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[m.jsx(Hs,{id:"select-all",checked:_.length===r.length,onCheckedChange:T}),m.jsxs(Vr,{htmlFor:"select-all",className:"cursor-pointer font-semibold",children:["/ (",_.length,"/",r.length,")"]})]}),m.jsx("div",{className:"space-y-3",children:r.map(N=>{const I=g(N),j=_.includes(N.id),D=n.includes(N.id);return m.jsx(rn,{className:`transition-all ${j?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,children:m.jsx(ln,{className:"p-4",children:m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx(Hs,{id:N.id,checked:j,onCheckedChange:()=>E(N.id)}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs(Vr,{htmlFor:N.id,className:"cursor-pointer flex items-center gap-2",children:[m.jsx("span",{className:"font-semibold truncate",children:I.name}),D&&m.jsxs(jn,{variant:"secondary",className:"text-xs",children:[m.jsx(Af,{className:"w-3 h-3 mr-1"}),""]})]}),m.jsx("p",{className:"text-sm text-muted-foreground truncate",children:N.address}),I.type&&I.type.length>0&&m.jsx("div",{className:"flex gap-1 mt-1 flex-wrap",children:I.type.slice(0,2).map((R,F)=>m.jsx(jn,{variant:"outline",className:"text-xs",children:R},F))})]})]})})},N.id)})})]}),m.jsxs(I4,{children:[m.jsx(ir,{variant:"outline",onClick:()=>t(!1),disabled:l,children:i("common.cancel")}),m.jsx(ir,{onClick:C,disabled:l,children:l?m.jsxs(m.Fragment,{children:[m.jsx(Gs,{className:"w-4 h-4 mr-2 animate-spin"}),i("common.loading")]}):m.jsxs(m.Fragment,{children:[m.jsx(Af,{className:"w-4 h-4 mr-2"})," (",_.length,")"]})})]})]})})},HOe=()=>{var Rt;const{id:e}=pQ(),t=Rh(),r=qf(),{t:n}=Ki(),{user:o}=Fi(),{isMerchant:l,isSupervisor:d}=nu(),{localizeActivity:i,localizeRestaurant:g}=Id(),_=G4(),[S,E]=He.useState(!1),[T,C]=He.useState(!1),[N,I]=He.useState(null),[j,D]=He.useState(!1),[R,F]=He.useState(!1),[B,U]=He.useState(!1),Z=He.useCallback(At=>{r(`/restaurant/${At}`,{state:{fromActivity:e}})},[r,e]),J=((Rt=t.state)==null?void 0:Rt.from)==="admin"?"/admin/activities":"/activities",{data:te,isLoading:ae}=yPe(e),{data:ne,isLoading:ie}=vPe(e),{data:ee=[]}=E4(),oe=ee.map(At=>At.activity_id),{data:de=0}=_Pe(e),xe=vne(),{data:we=[]}=KT(),{data:Ae=[]}=zCe(e),Ce=BCe(),me=te?i(te):null,Pe=te?oe.includes(te.id):!1,ye=l||d,pe=W.useCallback(()=>{!o||!te||xe.mutate(te.id)},[o,te,xe]),Ie=we.filter(At=>Ae.includes(At.id)).length,tt=Ie>0,Ze=Ie===we.length,Le=Ie>0&&Ie<we.length,qe=W.useCallback(()=>{if(!(!te||!ye||we.length===0))if(d)U(!0);else if(tt)for(const At of we)Ae.includes(At.id)&&Ce.mutate({activityId:te.id,restaurantId:At.id});else for(const At of we)Ce.mutate({activityId:te.id,restaurantId:At.id})},[te,ye,we,d,tt,Ae,Ce]),Ge=W.useCallback(At=>{if(!te)return;const Xe=At.filter(dt=>!Ae.includes(dt)),ut=Ae.filter(dt=>!At.includes(dt));Xe.forEach(dt=>{Ce.mutate({activityId:te.id,restaurantId:dt})}),ut.forEach(dt=>{Ce.mutate({activityId:te.id,restaurantId:dt})}),U(!1)},[te,Ae,Ce]),je=W.useCallback(async()=>{F(!0);try{const At=await FI();I({lat:At.coords.latitude,lng:At.coords.longitude}),D(!0),Br.success(n("map.locationEnabled"))}catch{Br.error(n("map.locationError")),D(!1)}finally{F(!1)}},[n]),ot=W.useCallback(()=>{I(null),D(!1)},[]),St=W.useCallback(async()=>{try{await navigator.clipboard.writeText(window.location.href),Br.success(n("common.linkCopied"))}catch(At){console.error("Error copying link:",At),Br.error(n("common.shareError"))}},[n]),rt=W.useCallback(async()=>{if(!te||!me)return;const At={title:me.title,text:`${me.title} - Xiaoxiong Market

${me.content.replace(/<[^>]*>/g,"").substring(0,200)}...`,url:window.location.href};try{navigator.share&&navigator.canShare&&navigator.canShare(At)?(await navigator.share(At),Br.success(n("common.shareSuccess"))):St()}catch(Xe){Xe.name!=="AbortError"&&(console.error("Error sharing:",Xe),Br.error(n("common.shareError")))}},[te,me,St,n]),Ut=W.useCallback(At=>{const Xe=encodeURIComponent(window.location.href);encodeURIComponent((me==null?void 0:me.title)||te.title_zh);const ut=encodeURIComponent(`${(me==null?void 0:me.title)||te.title_zh} - Xiaoxiong Market`);let dt="";switch(At){case"whatsapp":dt=`https://wa.me/?text=${ut}%20${Xe}`;break;case"facebook":dt=`https://www.facebook.com/sharer/sharer.php?u=${Xe}`;break;case"twitter":dt=`https://twitter.com/intent/tweet?text=${ut}&url=${Xe}`;break;case"telegram":dt=`https://t.me/share/url?url=${Xe}&text=${ut}`;break;case"wechat":St(),Br.info(n("common.shareVia")+" WeChat");return;default:return}window.open(dt,"_blank","noopener,noreferrer")},[te,me,St,n]),Ft=W.useMemo(()=>ne?!j||!N?ne:ne.filter(At=>HT(N.lat,N.lng,Number(At.restaurants.lat),Number(At.restaurants.lng))<=15):[],[ne,j,N]);if(ae)return m.jsx("div",{className:"min-h-screen flex items-center justify-center",children:m.jsx(Gs,{className:"w-8 h-8 animate-spin text-primary"})});if(!te||!me)return m.jsx("div",{className:"min-h-screen flex items-center justify-center",children:m.jsxs("div",{className:"text-center",children:[m.jsx("p",{className:"text-xl text-muted-foreground",children:n("error.notFound")}),m.jsx(ir,{asChild:!0,className:"mt-4",children:m.jsx(ia,{to:J,children:n("common.back")})})]})});const dr=new Date(te.start_date),Lr=te.end_date?new Date(te.end_date):null,Jr=Lr?new Date<=Lr:new Date>=dr;return m.jsxs("div",{className:"min-h-screen bg-secondary/20",children:[m.jsxs("div",{className:"relative h-[33vh] overflow-hidden",children:[m.jsx("img",{src:te.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=1200&q=80",alt:me.title,className:"w-full h-full object-cover"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),m.jsx(ir,{asChild:!0,variant:"secondary",size:"icon",className:"absolute top-4 left-4",children:m.jsx(ia,{to:J,children:m.jsx(oI,{className:"w-5 h-5"})})}),m.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[te.pinned&&m.jsx(jn,{className:"bg-accent",children:n("activities.pinned")}),m.jsx(N4,{targetType:"activity",targetId:te.id,trigger:m.jsx(ir,{variant:"secondary",size:"icon",className:"shadow-lg",children:m.jsx(lI,{className:"w-5 h-5"})})}),_&&navigator.share?m.jsx(ir,{variant:"secondary",size:"icon",className:"shadow-lg",onClick:rt,children:m.jsx(ch,{className:"w-5 h-5"})}):m.jsxs(Iv,{children:[m.jsx(Rv,{asChild:!0,children:m.jsx(ir,{variant:"secondary",size:"icon",className:"shadow-lg",children:m.jsx(ch,{className:"w-5 h-5"})})}),m.jsxs(ag,{align:"end",className:"w-48",children:[navigator.share&&m.jsxs(m.Fragment,{children:[m.jsxs(Oa,{onClick:rt,children:[m.jsx(ch,{className:"w-4 h-4 mr-2"}),n("common.moreOptions")]}),m.jsx(Pf,{})]}),m.jsxs(Oa,{onClick:()=>Ut("wechat"),children:[m.jsx(im,{className:"w-4 h-4 mr-2"}),"WeChat"]}),m.jsxs(Oa,{onClick:()=>Ut("whatsapp"),children:[m.jsx(im,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),m.jsxs(Oa,{onClick:()=>Ut("facebook"),children:[m.jsx(ch,{className:"w-4 h-4 mr-2"}),"Facebook"]}),m.jsxs(Oa,{onClick:()=>Ut("twitter"),children:[m.jsx(ch,{className:"w-4 h-4 mr-2"}),"X (Twitter)"]}),m.jsxs(Oa,{onClick:()=>Ut("telegram"),children:[m.jsx(im,{className:"w-4 h-4 mr-2"}),"Telegram"]}),m.jsx(Pf,{}),m.jsxs(Oa,{onClick:St,children:[m.jsx(eJ,{className:"w-4 h-4 mr-2"}),n("common.copyLink")]})]})]})]})]}),m.jsx("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12",children:m.jsxs(rn,{className:"shadow-large",children:[m.jsx(Di,{children:m.jsxs("div",{className:"flex flex-col gap-4",children:[m.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[m.jsx(jn,{variant:Jr?"default":"secondary",children:n(Jr?"activities.ongoing":"activities.ended")}),te.repeat_mode&&te.repeat_mode!=="none"&&m.jsx(jn,{variant:"outline",children:n(`activities.repeat.${te.repeat_mode}`)})]}),m.jsx(Qi,{className:"text-3xl",children:me.title}),m.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 text-sm text-muted-foreground",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(Sc,{className:"w-4 h-4"}),m.jsxs("span",{children:[Is(dr,"PPP"),Lr&&` - ${Is(Lr,"PPP")}`]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(_u,{className:"w-4 h-4"}),m.jsxs("span",{children:[de," ",n("activities.subscribersCount")]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(es,{className:"w-4 h-4"}),m.jsxs("span",{children:[(ne==null?void 0:ne.length)||0," ",n("activities.restaurantsParticipating")]})]})]}),o&&m.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[ye&&we.length>0&&m.jsx(ir,{onClick:qe,disabled:Ce.isPending,size:"lg",variant:tt?"outline":"default",className:"w-full sm:w-auto",children:d?Le?m.jsxs(m.Fragment,{children:[m.jsx(es,{className:"w-4 h-4 mr-2"}),"/"]}):Ze?m.jsxs(m.Fragment,{children:[m.jsx(Af,{className:"w-4 h-4 mr-2"}),""]}):m.jsxs(m.Fragment,{children:[m.jsx(es,{className:"w-4 h-4 mr-2"}),""]}):tt?m.jsxs(m.Fragment,{children:[m.jsx(Af,{className:"w-4 h-4 mr-2"}),""]}):m.jsxs(m.Fragment,{children:[m.jsx(es,{className:"w-4 h-4 mr-2"}),""]})}),m.jsx(ir,{onClick:pe,disabled:xe.isPending,size:"lg",variant:Pe?"outline":"secondary",className:"w-full sm:w-auto",children:Pe?m.jsxs(m.Fragment,{children:[m.jsx(Af,{className:"w-4 h-4 mr-2"}),n("activities.subscribed")||""]}):m.jsxs(m.Fragment,{children:[m.jsx(_u,{className:"w-4 h-4 mr-2"}),n("activities.subscribe")||""]})})]}),!o&&m.jsx("p",{className:"text-sm text-muted-foreground",children:n("activities.signInToJoin")})]})}),m.jsxs(ln,{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsx("h2",{className:"text-2xl font-bold mb-4",children:n("activities.about")}),m.jsx("div",{className:`prose prose-sm max-w-none text-muted-foreground\r
                  prose-headings:text-foreground prose-headings:font-semibold\r
                  prose-h1:text-2xl prose-h2:text-xl prose-h3:text-lg\r
                  prose-p:leading-relaxed prose-p:my-3\r
                  prose-strong:text-foreground prose-strong:font-semibold\r
                  prose-ul:my-3 prose-ol:my-3\r
                  prose-li:my-1\r
                  prose-a:text-primary prose-a:no-underline hover:prose-a:underline`,dangerouslySetInnerHTML:{__html:me.content}})]}),m.jsx(xu,{}),ie?m.jsx("div",{className:"flex justify-center py-8",children:m.jsx(Gs,{className:"w-6 h-6 animate-spin text-primary"})}):ne&&ne.length>0?m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[m.jsx(ys,{className:"w-6 h-6"}),n("activities.participatingRestaurants")," (",Ft.length,j&&ne.length!==Ft.length&&` / ${ne.length}`,")"]}),m.jsxs(ir,{variant:j?"default":"outline",size:"sm",onClick:j?ot:je,disabled:R,children:[R?m.jsx(Gs,{className:"w-4 h-4 mr-2 animate-spin"}):m.jsx(uh,{className:"w-4 h-4 mr-2"}),j?"":"15"]})]}),m.jsx("div",{className:"mb-6",children:m.jsx(wae,{restaurants:Ft,onMarkerClick:Z})})]}),m.jsx(SC,{open:S,onOpenChange:E,children:m.jsxs(rn,{className:"border-primary/20 shadow-sm hover:shadow-md transition-shadow duration-300 overflow-hidden",children:[m.jsx(Di,{className:"pb-3",children:m.jsx(EC,{asChild:!0,children:m.jsxs("div",{className:"flex items-center justify-between cursor-pointer group",children:[m.jsxs(Qi,{className:"text-lg font-semibold flex items-center gap-2 transition-colors duration-200 group-hover:text-primary",children:[m.jsx(es,{className:"w-5 h-5 transition-transform duration-300 group-hover:scale-110"}),""]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(jn,{variant:"secondary",className:"transition-opacity duration-200",children:S?"":""}),m.jsx("div",{className:"transition-transform duration-300 ease-in-out",style:{transform:S?"rotate(180deg)":"rotate(0deg)"},children:m.jsx(ev,{className:"w-5 h-5 text-muted-foreground group-hover:text-primary"})})]})]})})}),m.jsx(TC,{className:"overflow-hidden transition-all duration-500 ease-in-out data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",children:m.jsxs(ln,{className:"pt-0 pb-6 space-y-4",children:[m.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:(T?Ft:Ft.slice(0,6)).map((At,Xe)=>{const ut=g(At.restaurants);return m.jsx(rn,{className:"overflow-hidden hover:shadow-lg transition-all duration-300 opacity-0 animate-fade-in",style:{animationDelay:`${Xe*50}ms`,animationFillMode:"forwards"},children:m.jsxs(ia,{to:`/restaurant/${At.restaurant_id}`,state:{fromActivity:te.id},children:[m.jsxs("div",{className:"relative h-40 overflow-hidden",children:[m.jsx("img",{src:At.restaurants.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400&q=80",alt:ut.name,className:"w-full h-full object-cover transition-transform hover:scale-105"}),ut.type&&ut.type.length>0&&m.jsx(jn,{className:"absolute top-2 left-2 bg-primary",children:ut.type[0]})]}),m.jsxs(ln,{className:"pt-4",children:[m.jsx("h3",{className:"font-semibold text-lg mb-2 line-clamp-1",children:ut.name}),m.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-2",children:[m.jsx(ys,{className:"w-4 h-4 flex-shrink-0"}),m.jsx("span",{className:"line-clamp-1",children:At.restaurants.address})]}),At.restaurants.rating&&m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(Ec,{className:"w-4 h-4 fill-accent text-accent"}),m.jsx("span",{className:"font-semibold",children:At.restaurants.rating.toFixed(1)})]})]})]})},At.id)})}),Ft.length>6&&!T&&m.jsxs(ir,{variant:"outline",className:"w-full hover:bg-primary hover:text-primary-foreground transition-all duration-200",onClick:()=>C(!0),children:[m.jsx(ev,{className:"w-4 h-4 mr-2"})," (",Ft.length-6," )"]})]})})]})})]}):null,m.jsx(xu,{}),m.jsx(Lie,{restaurantId:te.id,targetType:"activity"})]})]})}),d&&m.jsx(GOe,{open:B,onOpenChange:U,restaurants:we,participatingRestaurantIds:Ae,onConfirm:Ge,isPending:Ce.isPending,isParticipating:tt})]})},KOe="/assets/final-logo-B_8qCuvU.png",ZOe=()=>{const{signIn:e,signUp:t,signInWithGoogle:r,signInWithPhone:n,verifyOTP:o,user:l}=Fi(),d=qf(),[i,g]=W.useState(!1),[_,S]=W.useState("login"),[E,T]=W.useState("phone");W.useState(""),W.useState("+351");const[C,N]=W.useState("info"),[I,j]=W.useState(""),[D,R]=W.useState(null),[F,B]=W.useState(0),[U,Z]=W.useState(null),{t:J}=Ki(),te=cm({email:Ji().email(J("auth.invalidEmail")),password:Ji().min(6,J("auth.passwordMin"))}),ae=cm({displayName:Ji().min(2,J("auth.displayNameMin")),email:Ji().email(J("auth.invalidEmail")),password:Ji().min(6,J("auth.passwordMin")),confirmPassword:Ji()}).refine(ye=>ye.password===ye.confirmPassword,{message:J("auth.passwordsDontMatch"),path:["confirmPassword"]}),ne=cm({phone:Ji().min(6,J("auth.phoneMin"))}),ie=cm({otp:Ji().length(6,J("auth.otpLength"))}),ee=cm({code:Ji().length(4,"Verification code must be 4 digits")}),oe=sm({resolver:lm(te)}),de=sm({resolver:lm(ae)});sm({resolver:lm(ne)}),sm({resolver:lm(ie)});const xe=sm({resolver:lm(ee)});W.useEffect(()=>{l&&d("/")},[l,d]),W.useEffect(()=>{let ye;return F>0&&(ye=setTimeout(()=>B(F-1),1e3)),()=>clearTimeout(ye)},[F]);const we=ye=>{let pe=0;return ye.length>=6&&pe++,ye.length>=8&&pe++,/[a-z]/.test(ye)&&pe++,/[A-Z]/.test(ye)&&pe++,/[0-9]/.test(ye)&&pe++,/[^a-zA-Z0-9]/.test(ye)&&pe++,pe<=2?"weak":pe<=4?"medium":"strong"},Ae=async ye=>{g(!0);try{const{error:pe}=await e(ye.email,ye.password);if(pe){pe.message.includes("Invalid login credentials")?Br.error(J("auth.invalidCredentials")):Br.error(pe.message);return}Br.success(J("auth.signInSuccess"))}catch(pe){Br.error(pe.message||J("error.general"))}finally{g(!1)}},Ce=async ye=>{g(!0);try{R(ye),j(ye.email);const{error:pe}=await qt.functions.invoke("send-verification-code",{body:{email:ye.email}});if(pe){Br.error(J("auth.verificationCodeFailed")),console.error(pe);return}N("verify"),Br.success(J("auth.verificationCodeSent")),B(30)}catch(pe){Br.error(pe.message||J("error.general"))}finally{g(!1)}},me=async ye=>{if(D){g(!0);try{const{data:pe,error:Ie}=await qt.functions.invoke("verify-email-code",{body:{email:I,code:ye.code}});if(Ie||!(pe!=null&&pe.success)){Br.error((pe==null?void 0:pe.error)||J("auth.invalidVerificationCode"));return}const{error:tt}=await t(D.email,D.password,D.displayName);if(tt){tt.message.includes("already registered")?Br.error(J("auth.emailExists")):Br.error(tt.message);return}Br.success(J("auth.signUpSuccess")),S("login"),N("info"),de.reset(),xe.reset(),R(null)}catch(pe){Br.error(pe.message||J("error.general"))}finally{g(!1)}}},Pe=async()=>{if(!(F>0)){g(!0);try{const{error:ye}=await qt.functions.invoke("send-verification-code",{body:{email:I}});if(ye){Br.error(J("toast.resendCodeFailed"));return}Br.success(J("toast.verificationCodeResent")),B(30)}catch(ye){Br.error(ye.message||"Failed to resend code")}finally{g(!1)}}};return m.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-hero p-4",children:m.jsxs(rn,{className:"w-full max-w-md shadow-large",children:[m.jsxs(Di,{className:"text-center",children:[m.jsx("div",{className:"flex justify-center mb-4",children:m.jsx("img",{src:KOe,alt:"Logo",style:{width:"35px",height:"35px"},className:"object-contain drop-shadow-md"})}),m.jsx(Qi,{className:"text-2xl",children:J("auth.welcome")}),m.jsx(Lo,{children:J("auth.subtitle")})]}),m.jsx(ln,{children:m.jsxs(FE,{value:_,onValueChange:ye=>{S(ye),T("phone"),N("info")},className:"w-full",children:[m.jsxs(G0,{className:"grid w-full grid-cols-2",children:[m.jsx(Ul,{value:"login",children:J("auth.login")}),m.jsx(Ul,{value:"register",children:J("auth.register")})]}),m.jsx(Vl,{value:"login",children:m.jsxs("form",{onSubmit:oe.handleSubmit(Ae),className:"space-y-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"email",children:J("auth.email")}),m.jsx(en,{id:"email",type:"email",placeholder:"you@example.com",...oe.register("email")}),oe.formState.errors.email&&m.jsx("p",{className:"text-sm text-destructive",children:oe.formState.errors.email.message})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"password",children:J("auth.password")}),m.jsx(en,{id:"password",type:"password",placeholder:"",...oe.register("password")}),oe.formState.errors.password&&m.jsx("p",{className:"text-sm text-destructive",children:oe.formState.errors.password.message})]}),m.jsx(ir,{type:"submit",className:"w-full",disabled:i,children:J(i?"auth.signingIn":"auth.signIn")})]})}),m.jsx(Vl,{value:"register",children:C==="info"?m.jsxs("form",{onSubmit:de.handleSubmit(Ce),className:"space-y-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"display-name",children:J("auth.displayName")}),m.jsx(en,{id:"display-name",placeholder:"John Doe",...de.register("displayName")}),de.formState.errors.displayName&&m.jsx("p",{className:"text-sm text-destructive",children:de.formState.errors.displayName.message})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"register-email",children:J("auth.email")}),m.jsx(en,{id:"register-email",type:"email",placeholder:"you@example.com",...de.register("email")}),de.formState.errors.email&&m.jsx("p",{className:"text-sm text-destructive",children:de.formState.errors.email.message})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"register-password",children:J("auth.password")}),m.jsx(en,{id:"register-password",type:"password",placeholder:J("auth.passwordPlaceholder"),...de.register("password"),onChange:ye=>{de.setValue("password",ye.target.value),ye.target.value?Z(we(ye.target.value)):Z(null)}}),de.formState.errors.password&&m.jsx("p",{className:"text-sm text-destructive",children:de.formState.errors.password.message}),U&&m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex gap-1",children:[m.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${U==="weak"?"bg-destructive":U==="medium"?"bg-warning":"bg-success"}`}),m.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${U==="medium"||U==="strong"?U==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),m.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${U==="strong"?"bg-success":"bg-muted"}`})]}),m.jsx("p",{className:`text-xs ${U==="weak"?"text-destructive":U==="medium"?"text-warning":"text-success"}`,children:J(`auth.passwordStrength.${U}`)})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"confirm-password",children:J("auth.confirmPassword")}),m.jsx(en,{id:"confirm-password",type:"password",placeholder:J("auth.passwordPlaceholder"),...de.register("confirmPassword")}),de.formState.errors.confirmPassword&&m.jsx("p",{className:"text-sm text-destructive",children:de.formState.errors.confirmPassword.message})]}),m.jsx(ir,{type:"submit",className:"w-full",disabled:i,children:i?"Sending code...":"Send Verification Code"})]}):m.jsxs("form",{onSubmit:xe.handleSubmit(me),className:"space-y-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"verification-code",children:"Verification Code"}),m.jsxs("p",{className:"text-xs text-muted-foreground mb-2",children:["Enter the 4-digit code sent to ",I]}),m.jsx("div",{className:"flex justify-center",children:m.jsx(R4,{maxLength:4,...xe.register("code"),onChange:ye=>xe.setValue("code",ye),children:m.jsxs(j4,{children:[m.jsx(bf,{index:0}),m.jsx(bf,{index:1}),m.jsx(bf,{index:2}),m.jsx(bf,{index:3})]})})}),xe.formState.errors.code&&m.jsx("p",{className:"text-sm text-destructive text-center",children:xe.formState.errors.code.message})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(ir,{type:"button",variant:"outline",className:"w-full",onClick:()=>{N("info"),xe.reset()},children:J("common.back")}),m.jsx(ir,{type:"submit",className:"w-full",disabled:i,children:i?J("auth.verifying"):"Verify & Register"})]}),m.jsx(ir,{type:"button",variant:"ghost",className:"w-full text-sm",onClick:Pe,disabled:i||F>0,children:F>0?`Resend Code (${F}s)`:"Resend Code"})]})})]})}),m.jsx(DI,{children:m.jsx("p",{className:"text-sm text-muted-foreground text-center w-full",children:m.jsx(ia,{to:"/",className:"text-primary hover:underline",children:J("auth.backToHome")})})})]})})},XOe=()=>{const{user:e}=Fi();return Li({queryKey:["favorites",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await qt.from("favorites").select("restaurant_id").eq("user_id",e.id);if(r)throw r;if(!t||t.length===0)return[];const n=t.map(d=>d.restaurant_id),{data:o,error:l}=await qt.from("restaurants").select("*").in("id",n);if(l)throw l;return o||[]},enabled:!!e})},YOe=()=>{const{user:e}=Fi();return Li({queryKey:["user-comments",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await qt.from("comments").select("*").eq("user_id",e.id).is("parent_id",null).order("created_at",{ascending:!1});if(r)throw r;if(!t||t.length===0)return[];const n=t.filter(i=>i.target_type==="restaurant").map(i=>i.target_id),o=t.filter(i=>i.target_type==="activity").map(i=>i.target_id),l=new Map;if(n.length>0){const{data:i}=await qt.from("restaurants").select("id, name, name_en, name_pt").in("id",n);i==null||i.forEach(g=>{l.set(g.id,{name:g.name,name_en:g.name_en||void 0,name_pt:g.name_pt||void 0})})}const d=new Map;if(o.length>0){const{data:i}=await qt.from("activities").select("id, title_zh, title_en, title_pt").in("id",o);i==null||i.forEach(g=>{d.set(g.id,{title_zh:g.title_zh,title_en:g.title_en,title_pt:g.title_pt})})}return t.map(i=>{if(i.target_type==="restaurant"){const g=l.get(i.target_id);return{...i,target_name:(g==null?void 0:g.name)||"Unknown Restaurant",target_name_en:g==null?void 0:g.name_en,target_name_pt:g==null?void 0:g.name_pt}}else if(i.target_type==="activity"){const g=d.get(i.target_id);return{...i,target_name:(g==null?void 0:g.title_zh)||"Unknown Activity",target_name_en:g==null?void 0:g.title_en,target_name_pt:g==null?void 0:g.title_pt}}return i})},enabled:!!e,staleTime:3e4})},JOe=()=>{const{user:e}=Fi(),{data:t=[]}=KT();return Li({queryKey:["merchantActivities",e==null?void 0:e.id],queryFn:async()=>{if(!e||t.length===0)return[];const r=t.map(_=>_.id),{data:n,error:o}=await qt.from("activity_restaurants").select("*").in("restaurant_id",r).order("created_at",{ascending:!1});if(o)throw o;if(!n||n.length===0)return[];const{data:l}=await qt.from("restaurants").select("id, name, name_en, name_pt, address").in("id",r),d=[...new Set(n.map(_=>_.activity_id))],{data:i}=await qt.from("activities").select("*").in("id",d);return n.map(_=>{const S=l==null?void 0:l.find(T=>T.id===_.restaurant_id),E=i==null?void 0:i.find(T=>T.id===_.activity_id);return{activity_id:_.activity_id,restaurant_id:_.restaurant_id,restaurant_name:(S==null?void 0:S.name)||"",restaurant_name_en:(S==null?void 0:S.name_en)||null,restaurant_name_pt:(S==null?void 0:S.name_pt)||null,restaurant_address:(S==null?void 0:S.address)||"",activity:E||null,created_at:_.created_at}})},enabled:!!e&&t.length>0})},QOe="modulepreload",eke=function(e){return"/"+e},VW={},tke=function(t,r,n){let o=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),i=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));o=Promise.allSettled(r.map(g=>{if(g=eke(g),g in VW)return;VW[g]=!0;const _=g.endsWith(".css"),S=_?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${S}`))return;const E=document.createElement("link");if(E.rel=_?"stylesheet":QOe,_||(E.as="script"),E.crossOrigin="",E.href=g,i&&E.setAttribute("nonce",i),document.head.appendChild(E),_)return new Promise((T,C)=>{E.addEventListener("load",T),E.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${g}`)))})}))}function l(d){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=d,window.dispatchEvent(i),!i.defaultPrevented)throw d}return o.then(d=>{for(const i of d||[])i.status==="rejected"&&l(i.reason);return t().catch(l)})},rke=({profile:e})=>{const{t}=Ki(),r=qf(),{user:n}=Fi(),{isAdmin:o}=nu(),[l,d]=W.useState(!1),[i,g]=W.useState(e.display_name),[_,S]=W.useState(e.phone||""),[E,T]=W.useState(null),[C,N]=W.useState(e.avatar_url||""),[I,j]=W.useState(!1),[D,R]=W.useState(!1),[F,B]=W.useState(""),[U,Z]=W.useState(!1),[J,te]=W.useState(!1),[ae,ne]=W.useState(!1),[ie,ee]=W.useState(!1),[oe,de]=W.useState(""),[xe,we]=W.useState(""),[Ae,Ce]=W.useState(""),[me,Pe]=W.useState(!1),[ye,pe]=W.useState(!1),[Ie,tt]=W.useState(!1),[Ze,Le]=W.useState(!1),[qe,Ge]=W.useState(!1),[je,ot]=W.useState(""),[St,rt]=W.useState(""),[Ut,Ft]=W.useState(""),[dr,Lr]=W.useState(!1),[Jr,Rt]=W.useState(""),[At,Xe]=W.useState(!1),[ut,dt]=W.useState(!1),[rr,er]=W.useState(null),tr=W.useRef(null),Pr=W.useRef(null),un=W.useRef(null),pn=ZTe(),Pi=YTe();W.useEffect(()=>{me&&tr.current&&tr.current.focus()},[me]),W.useEffect(()=>{ye&&Pr.current&&Pr.current.focus()},[ye]),W.useEffect(()=>{At&&un.current&&un.current.focus()},[At]);const gi=xr=>{var kn;const Sn=(kn=xr.target.files)==null?void 0:kn[0];if(Sn){if(Sn.size>2*1024*1024)return;T(Sn),N(URL.createObjectURL(Sn))}},Zi=async()=>{let xr=e.avatar_url;if(E){const Sn=await Pi.mutateAsync(E);Sn&&(xr=Sn)}await pn.mutateAsync({display_name:i,phone:_||void 0,avatar_url:xr||void 0}),d(!1)},js=async()=>{if(!(!n||F.toLowerCase()!=="delete")){Z(!0);try{const{error:xr}=await qt.functions.invoke("delete-account",{body:{userId:n.id}});if(xr){Br.error(t("profile.deleteAccountFailed")),console.error(xr),Z(!1);return}Br.success(t("profile.deleteAccountSuccess")),R(!1),j(!1),B(""),await new Promise(Sn=>setTimeout(Sn,1500)),await qt.auth.signOut(),r("/auth")}catch(xr){Br.error(xr.message||t("profile.deleteAccountFailed")),Z(!1)}finally{Z(!1)}}},Va=async()=>{if(n!=null&&n.email)try{const{error:xr}=await qt.functions.invoke("send-verification-code",{body:{email:n.email}});if(xr)throw xr;Pe(!0),Br.success(t("profile.codeSentToOldEmail"))}catch(xr){Br.error(t("profile.sendCodeFailed")),console.error(xr)}},Si=async()=>{if(!xe){Br.error(t("profile.enterCodePlaceholder"));return}try{const{data:xr,error:Sn}=await qt.functions.invoke("verify-email-code",{body:{email:n==null?void 0:n.email,code:xe}});if(Sn||!(xr!=null&&xr.success)){Br.error(t("profile.codeIncorrect"));return}Br.success(t("profile.oldEmailVerified")),te(!1),ne(!0)}catch(xr){Br.error(t("profile.verificationFailed")),console.error(xr)}},bs=async()=>{if(!oe||!oe.includes("@")){Br.error(t("profile.enterValidEmail"));return}try{const{error:xr}=await qt.functions.invoke("send-verification-code",{body:{email:oe}});if(xr)throw xr;Br.success(t("profile.codeSentToNewEmail")),pe(!0)}catch(xr){Br.error(t("profile.sendCodeFailed")),console.error(xr)}},Bo=async()=>{if(!Ae){Br.error(t("profile.enterCodePlaceholder"));return}try{const{data:xr,error:Sn}=await qt.functions.invoke("verify-email-code",{body:{email:oe,code:Ae}});if(Sn||!(xr!=null&&xr.success)){Br.error(t("profile.codeIncorrect"));return}Br.success(t("profile.newEmailVerified")),ne(!1),setTimeout(()=>{ee(!0)},100)}catch(xr){Br.error(t("toast.verificationFailed")),console.error(xr)}},Ns=async()=>{tt(!0);try{const{data:{session:xr}}=await qt.auth.getSession();if(!xr||!n){Br.error(t("toast.pleaseSignIn")),tt(!1);return}const{data:Sn,error:kn}=await qt.functions.invoke("update-email",{body:{userId:n.id,oldEmail:n.email,oldEmailCode:xe,newEmail:oe,newEmailCode:Ae},headers:{Authorization:`Bearer ${xr.access_token}`}});if(kn||!(Sn!=null&&Sn.success))throw new Error((Sn==null?void 0:Sn.error)||"Failed to update email");Br.success(t("toast.emailUpdatedSuccess")),ee(!1),d(!1),we(""),de(""),Ce(""),Pe(!1),pe(!1),await new Promise(Ii=>setTimeout(Ii,1500)),await qt.auth.signOut(),r("/auth")}catch(xr){Br.error(xr.message||t("toast.emailUpdateError")),console.error(xr)}finally{tt(!1)}},$o=xr=>{let Sn=0;return xr.length>=6&&Sn++,xr.length>=8&&Sn++,/[a-z]/.test(xr)&&Sn++,/[A-Z]/.test(xr)&&Sn++,/[0-9]/.test(xr)&&Sn++,/[^a-zA-Z0-9]/.test(xr)&&Sn++,Sn<=2?"weak":Sn<=4?"medium":"strong"},rs=async xr=>{if(xr==null||xr.preventDefault(),xr==null||xr.stopPropagation(),!je){Br.error(t("profile.enterCurrentPassword"));return}try{const{createClient:Sn}=await tke(async()=>{const{createClient:pa}=await Promise.resolve().then(()=>y1e);return{createClient:pa}},void 0),kn=Sn("https://tzdgqhwyzsxkxnncgzap.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",{auth:{persistSession:!1,autoRefreshToken:!1}}),{error:Ii}=await kn.auth.signInWithPassword({email:(n==null?void 0:n.email)||"",password:je});if(Ii){Br.error(t("profile.oldPasswordIncorrect"));return}Br.success(t("profile.oldPasswordVerified")),Le(!1),Ge(!0)}catch(Sn){Br.error(t("profile.verificationFailed")),console.error(Sn)}},Ni=async()=>{if(n!=null&&n.email)try{const{error:xr}=await qt.functions.invoke("send-verification-code",{body:{email:n.email}});if(xr)throw xr;Xe(!0),Br.success(t("profile.codeSentToOldEmail"))}catch(xr){Br.error(t("profile.sendCodeFailed")),console.error(xr)}},so=async xr=>{if(xr==null||xr.preventDefault(),xr==null||xr.stopPropagation(),!Jr){Br.error(t("profile.enterCodePlaceholder"));return}try{const{data:Sn,error:kn}=await qt.functions.invoke("verify-email-code",{body:{email:n==null?void 0:n.email,code:Jr}});if(kn||!(Sn!=null&&Sn.success)){Br.error(t("profile.codeIncorrect"));return}Br.success(t("profile.oldEmailVerified")),Le(!1),Ge(!0)}catch(Sn){Br.error(t("profile.verificationFailed")),console.error(Sn)}},gl=async xr=>{if(xr==null||xr.preventDefault(),xr==null||xr.stopPropagation(),!St||!Ut){Br.error(t("profile.enterNewPassword"));return}if(St.length<6){Br.error(t("profile.passwordTooShort"));return}if(St!==Ut){Br.error(t("profile.passwordsDontMatch"));return}dt(!0);try{const{error:Sn}=await qt.auth.updateUser({password:St});if(Sn)throw Sn;Br.success(t("profile.passwordUpdated")),Ge(!1),d(!1),ot(""),rt(""),Ft(""),Lr(!1),Rt(""),Xe(!1)}catch(Sn){Br.error(Sn.message||t("profile.passwordUpdateFailed")),console.error(Sn)}finally{dt(!1)}};return m.jsxs(Nh,{open:l,onOpenChange:d,children:[m.jsx(jv,{asChild:!0,children:m.jsxs(ir,{variant:"outline",children:[m.jsx(Cye,{className:"w-4 h-4 mr-2"}),t("profile.editProfile")]})}),m.jsxs(Rd,{className:"max-w-[90vw] sm:max-w-[425px] max-h-[90vh] overflow-y-auto",children:[m.jsxs(jd,{children:[m.jsx(Nd,{children:t("profile.editProfile")}),m.jsx(Md,{children:t("profile.editProfileDescription")})]}),m.jsxs("div",{className:"space-y-3 py-3",children:[m.jsxs("div",{className:"flex flex-col items-center gap-3",children:[m.jsxs(Gm,{className:"w-16 h-16 sm:w-24 sm:h-24",children:[m.jsx(Hm,{src:C}),m.jsx(Km,{children:i==null?void 0:i.charAt(0).toUpperCase()})]}),m.jsxs("div",{children:[m.jsx(en,{type:"file",accept:"image/*",onChange:gi,className:"hidden",id:"avatar-upload"}),m.jsxs(ir,{variant:"outline",size:"sm",onClick:()=>{var xr;return(xr=document.getElementById("avatar-upload"))==null?void 0:xr.click()},className:"text-xs sm:text-sm",children:[m.jsx(O0,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),t("profile.uploadAvatar")]})]})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx(Vr,{htmlFor:"displayName",className:"text-sm",children:t("profile.displayName")}),m.jsx(en,{id:"displayName",value:i,onChange:xr=>g(xr.target.value),placeholder:t("profile.displayName"),className:"h-9"})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx(Vr,{htmlFor:"phone",className:"text-sm",children:t("profile.phone")}),m.jsx(en,{id:"phone",value:_,onChange:xr=>S(xr.target.value),placeholder:t("profile.phone"),className:"h-9"})]}),!o&&m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"space-y-1.5 pt-2 border-t",children:[m.jsx(Vr,{className:"text-sm",children:""}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(en,{value:(n==null?void 0:n.email)||"",disabled:!0,className:"h-9 flex-1"}),m.jsxs(ir,{variant:"outline",size:"sm",onClick:()=>te(!0),className:"text-xs",children:[m.jsx(rJ,{className:"w-3 h-3 mr-1"}),""]})]})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx(Vr,{className:"text-sm",children:t("profile.changePassword")}),m.jsxs(ir,{variant:"outline",size:"sm",onClick:()=>Le(!0),className:"w-full justify-start h-9",children:[m.jsx(wye,{className:"w-3 h-3 mr-2"}),t("profile.changePassword")]})]})]})]}),m.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 pt-2 border-t",children:[!o&&m.jsxs(ir,{variant:"destructive",size:"sm",onClick:()=>j(!0),className:"w-full sm:w-auto text-xs sm:text-sm",children:[m.jsx(Sb,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),t("profile.deleteAccount")]}),m.jsxs("div",{className:`flex gap-2 w-full sm:w-auto ${o?"sm:ml-auto":""}`,children:[m.jsx(ir,{variant:"outline",size:"sm",onClick:()=>d(!1),className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:t("common.cancel")}),m.jsx(ir,{size:"sm",onClick:Zi,disabled:pn.isPending||Pi.isPending,className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:pn.isPending||Pi.isPending?t("common.loading"):t("common.save")})]})]})]}),m.jsx(Bl,{open:I,onOpenChange:j,children:m.jsxs(sl,{children:[m.jsxs(ll,{children:[m.jsx(ul,{children:t("profile.deleteAccountWarning")}),m.jsx(dl,{children:t("profile.deleteAccountDescription")})]}),m.jsxs(cl,{children:[m.jsx(hl,{children:t("common.cancel")}),m.jsx(Vs,{onClick:()=>{j(!1),R(!0)},className:"bg-destructive hover:bg-destructive/90",children:t("common.continue")})]})]})}),m.jsx(Bl,{open:D,onOpenChange:R,children:m.jsxs(sl,{children:[m.jsxs(ll,{children:[m.jsx(ul,{children:t("profile.confirmDeleteAccount")}),m.jsxs(dl,{className:"space-y-4",children:[m.jsx("p",{children:t("profile.confirmDeleteDescription")}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"confirm-delete",children:t("profile.typeDeleteToConfirm")}),m.jsx(en,{id:"confirm-delete",value:F,onChange:xr=>B(xr.target.value),placeholder:"DELETE",className:"uppercase"})]})]})]}),m.jsxs(cl,{children:[m.jsx(hl,{onClick:()=>B(""),children:t("common.cancel")}),m.jsx(Vs,{onClick:js,disabled:F.toLowerCase()!=="delete"||U,className:"bg-destructive hover:bg-destructive/90",children:t(U?"common.loading":"profile.deleteAccount")})]})]})}),m.jsx(Bl,{open:J,onOpenChange:te,children:m.jsxs(sl,{className:"max-w-[90vw] sm:max-w-md",children:[m.jsxs(ll,{children:[m.jsx(ul,{children:t("profile.verifyOldEmail")}),m.jsx(dl,{children:t("profile.oldEmailStep")})]}),m.jsxs("div",{className:"space-y-4 py-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{children:t("profile.currentEmail")}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(en,{value:(n==null?void 0:n.email)||"",disabled:!0,className:"flex-1"}),m.jsx(ir,{variant:"outline",size:"sm",onClick:Va,disabled:me,children:t(me?"profile.codeSent":"profile.sendCode")})]})]}),me&&m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{children:t("profile.verificationCode")}),m.jsx(en,{ref:tr,value:xe,onChange:xr=>we(xr.target.value),placeholder:t("profile.enterCode"),maxLength:4})]})]}),m.jsxs(cl,{children:[m.jsx(hl,{onClick:()=>{te(!1),setTimeout(()=>{we(""),Pe(!1)},300)},children:t("common.cancel")}),me&&m.jsx(Vs,{onClick:Si,children:t("profile.verify")})]})]})}),m.jsx(Bl,{open:ae,onOpenChange:ne,children:m.jsxs(sl,{className:"max-w-[90vw] sm:max-w-md",children:[m.jsxs(ll,{className:"text-center space-y-3",children:[m.jsx(ul,{className:"text-xl",children:t("profile.verifyNewEmail")}),m.jsx(dl,{className:"text-center",children:t("profile.newEmailStep")})]}),m.jsxs("div",{className:"space-y-4 py-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{className:"text-sm font-normal",children:t("profile.newEmail")}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(en,{type:"email",value:oe,onChange:xr=>de(xr.target.value),placeholder:t("profile.enterNewEmail"),disabled:ye,className:"border-2 focus:border-primary flex-1"}),m.jsx(ir,{variant:"outline",size:"sm",onClick:bs,disabled:!oe||ye,className:"text-xs whitespace-nowrap px-3",children:t(ye?"profile.codeSent":"profile.sendCode")})]})]}),ye&&m.jsxs("div",{className:"space-y-2 animate-in fade-in slide-in-from-top-2 duration-300",children:[m.jsx(Vr,{className:"text-sm font-normal",children:t("profile.verificationCode")}),m.jsx(en,{ref:Pr,value:Ae,onChange:xr=>Ce(xr.target.value),placeholder:t("profile.enterCode"),maxLength:4,className:"border-2 focus:border-primary"})]})]}),m.jsxs(cl,{className:"flex-col sm:flex-col gap-2",children:[ye&&m.jsx(Vs,{onClick:Bo,disabled:!Ae||Ae.length!==4,className:"w-full bg-primary hover:bg-primary/90",children:""}),m.jsx(hl,{onClick:()=>{ne(!1),setTimeout(()=>{de(""),Ce(""),pe(!1)},300)},className:"w-full mt-0",children:""})]})]})}),m.jsx(Bl,{open:ie,onOpenChange:ee,children:m.jsxs(sl,{className:"max-w-[90vw] sm:max-w-md",children:[m.jsxs(ll,{children:[m.jsx(ul,{children:""}),m.jsx(dl,{children:" 3/3: "})]}),m.jsxs("div",{className:"space-y-4 py-4",children:[m.jsxs("div",{className:"rounded-lg bg-green-50 dark:bg-green-950 p-4 text-sm",children:[m.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:""}),m.jsx("p",{className:"text-green-700 dark:text-green-300 mt-1",children:'""'})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex justify-between text-sm",children:[m.jsx("span",{className:"text-muted-foreground",children:":"}),m.jsx("span",{className:"font-medium",children:n==null?void 0:n.email})]}),m.jsxs("div",{className:"flex justify-between text-sm",children:[m.jsx("span",{className:"text-muted-foreground",children:":"}),m.jsx("span",{className:"font-medium",children:oe})]})]})]}),m.jsxs(cl,{children:[m.jsx(hl,{onClick:()=>{ee(!1),setTimeout(()=>{we(""),de(""),Ce(""),Pe(!1),pe(!1)},300)},children:""}),m.jsx(Vs,{onClick:Ns,disabled:Ie,children:Ie?"...":""})]})]})}),m.jsx(Bl,{open:Ze,onOpenChange:Le,children:m.jsxs(sl,{className:"max-w-[90vw] sm:max-w-md",children:[m.jsxs(ll,{children:[m.jsx(ul,{children:t("profile.verifyOldPassword")}),m.jsx(dl,{children:t("profile.oldPasswordStep")})]}),m.jsx("div",{className:"space-y-4 py-4",children:dr?m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{children:t("profile.currentEmail")}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(en,{value:(n==null?void 0:n.email)||"",disabled:!0,className:"flex-1"}),m.jsx(ir,{variant:"outline",size:"sm",onClick:Ni,disabled:At,children:t(At?"profile.codeSent":"profile.sendCode")})]})]}),At&&m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{children:t("profile.verificationCode")}),m.jsx(en,{ref:un,value:Jr,onChange:xr=>Rt(xr.target.value),placeholder:t("profile.enterCode"),maxLength:4})]})]}):m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{children:t("profile.currentPassword")}),m.jsx(en,{type:"password",value:je,onChange:xr=>ot(xr.target.value),placeholder:t("profile.enterCurrentPassword")})]}),m.jsxs(ir,{variant:"link",size:"sm",onClick:()=>Lr(!0),className:"text-xs p-0 h-auto",children:[t("profile.forgotPassword")," ",t("profile.useEmailVerification")]})]})}),m.jsxs(cl,{children:[m.jsx(hl,{onClick:()=>{Le(!1),setTimeout(()=>{ot(""),Lr(!1),Rt(""),Xe(!1)},300)},children:t("common.cancel")}),dr?At&&m.jsx(Vs,{onClick:so,children:t("profile.verify")}):m.jsx(Vs,{onClick:rs,children:t("profile.verify")})]})]})}),m.jsx(Bl,{open:qe,onOpenChange:Ge,children:m.jsxs(sl,{className:"max-w-[90vw] sm:max-w-md",children:[m.jsxs(ll,{children:[m.jsx(ul,{children:t("profile.setNewPassword")}),m.jsx(dl,{children:t("profile.newPasswordStep")})]}),m.jsxs("div",{className:"space-y-4 py-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{children:t("profile.newPassword")}),m.jsx(en,{type:"password",value:St,onChange:xr=>{rt(xr.target.value),xr.target.value?er($o(xr.target.value)):er(null)},placeholder:t("profile.enterNewPassword")}),rr&&m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex gap-1",children:[m.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${rr==="weak"?"bg-destructive":rr==="medium"?"bg-warning":"bg-success"}`}),m.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${rr==="medium"||rr==="strong"?rr==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),m.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${rr==="strong"?"bg-success":"bg-muted"}`})]}),m.jsx("p",{className:`text-xs ${rr==="weak"?"text-destructive":rr==="medium"?"text-warning":"text-success"}`,children:t(`auth.passwordStrength.${rr}`)})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{children:t("profile.confirmNewPassword")}),m.jsx(en,{type:"password",value:Ut,onChange:xr=>Ft(xr.target.value),placeholder:t("profile.confirmNewPasswordPlaceholder")})]}),St&&Ut&&St!==Ut&&m.jsx("p",{className:"text-sm text-destructive",children:t("profile.passwordsDontMatch")})]}),m.jsxs(cl,{children:[m.jsx(hl,{onClick:()=>{Ge(!1),setTimeout(()=>{rt(""),Ft(""),er(null)},300)},children:t("common.cancel")}),m.jsx(Vs,{onClick:gl,disabled:!St||!Ut||St!==Ut||ut,children:t(ut?"common.loading":"profile.updatePassword")})]})]})})]})},Sae=W.memo(({comment:e,getLocalizedField:t})=>m.jsxs(ia,{to:`/${e.target_type}/${e.target_id}`,className:"block p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsx("h3",{className:"font-semibold text-card-foreground",children:t(e,"target_name")}),m.jsx("span",{className:"text-sm text-muted-foreground",children:og(new Date(e.created_at),{addSuffix:!0})})]}),m.jsx("p",{className:"text-muted-foreground line-clamp-2",children:e.content}),e.image_url&&m.jsx("img",{src:e.image_url,alt:"Comment",className:"mt-2 rounded-lg max-w-xs",loading:"lazy"})]}));Sae.displayName="CommentItem";const Eae=W.memo(({restaurant:e,getLocalizedField:t})=>m.jsxs(ia,{to:`/restaurant/${e.id}`,className:"flex gap-4 p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[m.jsx("div",{className:"w-24 h-24 rounded-lg overflow-hidden bg-secondary/30 flex-shrink-0",children:m.jsx("img",{src:e.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80",alt:String(t(e,"name")),className:"w-full h-full object-cover",loading:"lazy",onError:r=>{r.currentTarget.src="https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80"}})}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("h3",{className:"font-semibold text-lg text-card-foreground line-clamp-1",children:t(e,"name")}),m.jsx("p",{className:"text-muted-foreground text-sm mb-2 line-clamp-1",children:t(e,"type")}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(Ec,{className:"w-4 h-4 fill-accent text-accent"}),m.jsx("span",{className:"font-medium",children:e.rating||0})]})]})]}));Eae.displayName="FavoriteRestaurantItem";const F3=W.memo(({subscription:e,getLocalizedField:t,t:r})=>{var n;return m.jsx(ia,{to:`/activity/${e.activity_id}`,className:"block p-4 rounded-lg border hover:shadow-medium transition-shadow",children:m.jsxs("div",{className:"flex items-start gap-4",children:[((n=e.activity)==null?void 0:n.image_url)&&m.jsx("img",{src:e.activity.image_url,alt:String(t(e.activity,"title")),className:"w-24 h-24 rounded-lg object-cover flex-shrink-0",loading:"lazy"}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("h3",{className:"font-semibold text-card-foreground mb-1",children:t(e.activity,"title")}),m.jsx("div",{className:"text-sm text-muted-foreground line-clamp-2 prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:t(e.activity,"content")}}),m.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[r("profile.joinedOn"),":"," ",og(new Date(e.created_at),{addSuffix:!0})]})]}),m.jsx(Sc,{className:"w-5 h-5 text-primary flex-shrink-0"})]})})});F3.displayName="ActivitySubscriptionItem";const Tae=W.memo(({participation:e,getLocalizedField:t})=>{var r;return m.jsx(ia,{to:`/activity/${e.activity_id}`,className:"block p-4 rounded-lg border hover:shadow-medium transition-shadow",children:m.jsxs("div",{className:"flex items-start gap-4",children:[((r=e.activity)==null?void 0:r.image_url)&&m.jsx("img",{src:e.activity.image_url,alt:String(t(e.activity,"title")),className:"w-24 h-24 rounded-lg object-cover flex-shrink-0",loading:"lazy"}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("h3",{className:"font-semibold text-card-foreground mb-1",children:t(e.activity,"title")}),m.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[m.jsx(es,{className:"w-4 h-4 text-primary"}),m.jsx("span",{className:"text-sm font-medium text-primary",children:t(e,"restaurant_name")})]}),m.jsx("div",{className:"text-sm text-muted-foreground line-clamp-2 prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:t(e.activity,"content")}}),m.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[""," ",og(new Date(e.created_at),{addSuffix:!0})]})]}),m.jsx(Sc,{className:"w-5 h-5 text-primary flex-shrink-0"})]})})});Tae.displayName="MerchantActivityItem";const nke=()=>{var R;const{t:e}=Ki(),{user:t}=Fi(),{data:r,isLoading:n}=d4(),{data:o,isLoading:l}=XOe(),{data:d,isLoading:i}=YOe(),{data:g,isLoading:_}=E4(),{data:S,isLoading:E}=JOe(),{role:T,isMerchant:C,isSupervisor:N}=nu(),{getLocalizedField:I}=Id(),j=C||N;if(!t||n)return m.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4",children:m.jsx("div",{className:"container mx-auto max-w-6xl",children:m.jsx("div",{className:"text-center",children:e("common.loading")})})});const D=e(T?`profile.role.${T}`:"profile.role.user");return m.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4",children:m.jsxs("div",{className:"container mx-auto max-w-6xl",children:[m.jsx(rn,{className:"mb-8",children:m.jsx(ln,{className:"pt-6",children:m.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-6",children:[m.jsxs(Gm,{className:"w-24 h-24",children:[m.jsx(Hm,{src:(r==null?void 0:r.avatar_url)||""}),m.jsx(Km,{children:((R=r==null?void 0:r.display_name)==null?void 0:R.charAt(0).toUpperCase())||"U"})]}),m.jsxs("div",{className:"flex-1 text-center md:text-left",children:[m.jsx("h1",{className:"text-3xl font-bold mb-2 text-foreground",children:r==null?void 0:r.display_name}),m.jsx("p",{className:"text-muted-foreground mb-3",children:t.email}),(r==null?void 0:r.phone)&&m.jsx("p",{className:"text-muted-foreground mb-3",children:r.phone}),T&&T!=="user"&&m.jsx(jn,{className:"bg-primary capitalize",children:D})]}),r&&m.jsx(rke,{profile:r})]})})}),m.jsxs(FE,{defaultValue:"favorites",className:"space-y-6",children:[m.jsxs(G0,{className:"grid w-full grid-cols-3",children:[m.jsxs(Ul,{value:"favorites",children:[m.jsx(yB,{className:"w-4 h-4 mr-2"}),e("profile.favorites")]}),m.jsxs(Ul,{value:"comments",children:[m.jsx(vB,{className:"w-4 h-4 mr-2"}),e("profile.comments")]}),m.jsxs(Ul,{value:"activities",children:[m.jsx(Sc,{className:"w-4 h-4 mr-2"}),e("profile.activities")]})]}),m.jsx(Vl,{value:"favorites",className:"space-y-4",children:m.jsxs(rn,{children:[m.jsxs(Di,{children:[m.jsx(Qi,{children:e("profile.favoriteRestaurants")}),m.jsx(Lo,{children:e("profile.favoritesDesc")})]}),m.jsx(ln,{children:l?m.jsx("div",{className:"text-center py-8",children:e("common.loading")}):o&&o.length>0?m.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:o.map(F=>m.jsx(Eae,{restaurant:F,getLocalizedField:I},F.id))}):m.jsx("p",{className:"text-muted-foreground text-center py-8",children:e("profile.noFavorites")})})]})}),m.jsx(Vl,{value:"comments",children:m.jsxs(rn,{children:[m.jsxs(Di,{children:[m.jsx(Qi,{children:e("profile.myComments")}),m.jsx(Lo,{children:e("profile.commentsDesc")})]}),m.jsx(ln,{className:"space-y-4",children:i?m.jsx("div",{className:"text-center py-8",children:e("common.loading")}):d&&d.length>0?d.map(F=>m.jsx(Sae,{comment:F,getLocalizedField:I},F.id)):m.jsx("p",{className:"text-muted-foreground text-center py-8",children:e("profile.noComments")})})]})}),m.jsx(Vl,{value:"activities",children:m.jsxs(rn,{children:[m.jsxs(Di,{children:[m.jsx(Qi,{children:j?"":e("profile.joinedActivities")}),m.jsx(Lo,{children:j?"":e("profile.activitiesDesc")})]}),m.jsx(ln,{children:j?m.jsxs("div",{className:"space-y-6",children:[_?m.jsx("div",{className:"text-center py-8",children:e("common.loading")}):g&&g.length>0?m.jsxs("div",{children:[m.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[m.jsx(_u,{className:"w-5 h-5"}),""]}),m.jsx("div",{className:"space-y-4",children:g.map(F=>m.jsx(F3,{subscription:F,getLocalizedField:I,t:e},F.activity_id))})]}):null,E?m.jsx("div",{className:"text-center py-8",children:e("common.loading")}):S&&S.length>0?m.jsxs("div",{children:[m.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[m.jsx(es,{className:"w-5 h-5"}),""]}),m.jsx("div",{className:"space-y-4",children:S.map(F=>m.jsx(Tae,{participation:F,getLocalizedField:I},`${F.activity_id}-${F.restaurant_id}`))})]}):null,(!g||g.length===0)&&(!S||S.length===0)&&m.jsxs("p",{className:"text-muted-foreground text-center py-8",children:[""," ",m.jsx(ia,{to:"/activities",className:"text-primary hover:underline",children:""})]})]}):_?m.jsx("div",{className:"text-center py-8",children:e("common.loading")}):g&&g.length>0?m.jsx("div",{className:"space-y-4",children:g.map(F=>m.jsx(F3,{subscription:F,getLocalizedField:I,t:e},F.activity_id))}):m.jsxs("p",{className:"text-muted-foreground text-center py-8",children:[e("profile.noActivities")," ",m.jsx(ia,{to:"/activities",className:"text-primary hover:underline",children:e("profile.upcomingEvents")})]})})]})})]})]})})},ike=VCe,Aae=W.createContext({}),my=({...e})=>m.jsx(Aae.Provider,{value:{name:e.name},children:m.jsx(NS,{...e})}),KI=()=>{const e=W.useContext(Aae),t=W.useContext(Pae),{getFieldState:r,formState:n}=WI(),o=r(e.name,n);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:l}=t;return{id:l,name:e.name,formItemId:`${l}-form-item`,formDescriptionId:`${l}-form-item-description`,formMessageId:`${l}-form-item-message`,...o}},Pae=W.createContext({}),Kp=W.forwardRef(({className:e,...t},r)=>{const n=W.useId();return m.jsx(Pae.Provider,{value:{id:n},children:m.jsx("div",{ref:r,className:yr("space-y-2",e),...t})})});Kp.displayName="FormItem";const Zp=W.forwardRef(({className:e,...t},r)=>{const{error:n,formItemId:o}=KI();return m.jsx(Vr,{ref:r,className:yr(n&&"text-destructive",e),htmlFor:o,...t})});Zp.displayName="FormLabel";const Ty=W.forwardRef(({...e},t)=>{const{error:r,formItemId:n,formDescriptionId:o,formMessageId:l}=KI();return m.jsx(Av,{ref:t,id:n,"aria-describedby":r?`${o} ${l}`:`${o}`,"aria-invalid":!!r,...e})});Ty.displayName="FormControl";const Cae=W.forwardRef(({className:e,...t},r)=>{const{formDescriptionId:n}=KI();return m.jsx("p",{ref:r,id:n,className:yr("text-sm text-muted-foreground",e),...t})});Cae.displayName="FormDescription";const Ay=W.forwardRef(({className:e,children:t,...r},n)=>{const{error:o,formMessageId:l}=KI(),d=o?String(o==null?void 0:o.message):t;return d?m.jsx("p",{ref:n,id:l,className:yr("text-sm font-medium text-destructive",e),...r,children:d}):null});Ay.displayName="FormMessage";const qW=["booking","delivery","qrcode"],ake=()=>{const{t:e}=Ki(),[t,r]=W.useState(!1),[n,o]=W.useState(!1),l=W.useMemo(()=>cm({name:Ji().min(2,{message:e("joinUs.nameMin")}),email:Ji().email({message:e("joinUs.emailInvalid")}),phone:Ji().min(6,{message:e("joinUs.phoneMin")}),restaurant_name:Ji().min(2,{message:e("joinUs.restaurantNameMin")}),restaurant_address:Ji().min(2,{message:e("joinUs.addressMin")}),features_selected:PC(tae(qW)).min(1,{message:e("joinUs.featuresMin")})}),[e]),d=sm({resolver:lm(l),defaultValues:{name:"",email:"",phone:"",restaurant_name:"",restaurant_address:"",features_selected:[]}}),i=async g=>{r(!0);try{const{error:_}=await qt.functions.invoke("send-join-request-email",{body:g});if(_){if(_.message.includes("rate_limit_exceeded"))Fc({title:e("joinUs.rateLimitError"),description:e("joinUs.rateLimitErrorDesc"),variant:"destructive"});else throw _;return}o(!0),d.reset(),Fc({title:e("joinUs.successTitle"),description:e("joinUs.successDescription")})}catch(_){console.error("Error submitting join request:",_),Fc({title:e("common.error"),description:e("joinUs.submitError"),variant:"destructive"})}finally{r(!1)}};return n?m.jsx("div",{className:"min-h-screen pt-20 pb-12 px-4 bg-secondary/20",children:m.jsx("div",{className:"container mx-auto max-w-2xl",children:m.jsx(rn,{className:"border-primary",children:m.jsxs(ln,{className:"pt-12 pb-12 text-center",children:[m.jsx(gye,{className:"w-16 h-16 text-primary mx-auto mb-4"}),m.jsx("h2",{className:"text-2xl font-bold text-foreground mb-4",children:e("joinUs.successTitle")}),m.jsx("p",{className:"text-lg font-semibold text-foreground mb-2",children:e("joinUs.successDescription")}),m.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:e("joinUs.successMessage")}),m.jsx(ir,{onClick:()=>o(!1),children:e("joinUs.submitAnother")})]})})})}):m.jsx("div",{className:"min-h-screen pt-20 pb-12 px-4 bg-secondary/20",children:m.jsx("div",{className:"container mx-auto max-w-3xl",children:m.jsxs(rn,{children:[m.jsxs(Di,{className:"text-center space-y-2",children:[m.jsx("div",{className:"flex justify-center mb-4",children:m.jsx(es,{className:"w-12 h-12 text-primary"})}),m.jsx(Qi,{className:"text-3xl font-bold",children:e("joinUs.title")}),m.jsx(Lo,{className:"text-base",children:e("joinUs.description")})]}),m.jsx(ln,{children:m.jsx(ike,{...d,children:m.jsxs("form",{onSubmit:d.handleSubmit(i),className:"space-y-6",children:[m.jsx(my,{control:d.control,name:"name",render:({field:g})=>m.jsxs(Kp,{children:[m.jsx(Zp,{children:e("joinUs.name")}),m.jsx(Ty,{children:m.jsx(en,{placeholder:e("joinUs.namePlaceholder"),...g})}),m.jsx(Ay,{})]})}),m.jsx(my,{control:d.control,name:"email",render:({field:g})=>m.jsxs(Kp,{children:[m.jsx(Zp,{children:e("joinUs.email")}),m.jsx(Ty,{children:m.jsx(en,{type:"email",placeholder:e("joinUs.emailPlaceholder"),...g})}),m.jsx(Ay,{})]})}),m.jsx(my,{control:d.control,name:"phone",render:({field:g})=>m.jsxs(Kp,{children:[m.jsx(Zp,{children:e("joinUs.phone")}),m.jsx(Ty,{children:m.jsx(en,{type:"tel",placeholder:e("joinUs.phonePlaceholder"),...g})}),m.jsx(Ay,{})]})}),m.jsx(my,{control:d.control,name:"restaurant_name",render:({field:g})=>m.jsxs(Kp,{children:[m.jsx(Zp,{children:e("joinUs.restaurantName")}),m.jsx(Ty,{children:m.jsx(en,{placeholder:e("joinUs.restaurantNamePlaceholder"),...g})}),m.jsx(Ay,{})]})}),m.jsx(my,{control:d.control,name:"restaurant_address",render:({field:g})=>m.jsxs(Kp,{children:[m.jsx(Zp,{children:e("joinUs.restaurantAddress")}),m.jsx(Ty,{children:m.jsx(en,{placeholder:e("joinUs.restaurantAddressPlaceholder"),...g})}),m.jsx(Ay,{})]})}),m.jsx(my,{control:d.control,name:"features_selected",render:()=>m.jsxs(Kp,{children:[m.jsxs("div",{className:"mb-4",children:[m.jsx(Zp,{children:e("joinUs.featuresNeeded")}),m.jsx(Cae,{children:e("joinUs.featuresDescription")})]}),qW.map(g=>m.jsx(my,{control:d.control,name:"features_selected",render:({field:_})=>{var S;return m.jsxs(Kp,{className:"flex flex-row items-start space-x-3 space-y-0",children:[m.jsx(Ty,{children:m.jsx(Hs,{checked:(S=_.value)==null?void 0:S.includes(g),onCheckedChange:E=>{var T;return E?_.onChange([..._.value,g]):_.onChange((T=_.value)==null?void 0:T.filter(C=>C!==g))}})}),m.jsx(Zp,{className:"font-normal cursor-pointer",children:e(`joinUs.feature.${g}`)})]},g)}},g)),m.jsx(Ay,{})]})}),m.jsx("div",{className:"text-xs text-muted-foreground text-center pb-4",children:e("joinUs.consentText")}),m.jsxs(ir,{type:"submit",className:"w-full",size:"lg",disabled:t,children:[t&&m.jsx(Gs,{className:"mr-2 h-4 w-4 animate-spin"}),e("joinUs.submit")]})]})})})]})})})},oke=()=>{const e=Rh();return W.useEffect(()=>{},[e.pathname]),m.jsx("div",{className:"flex min-h-screen items-center justify-center bg-muted",children:m.jsxs("div",{className:"text-center",children:[m.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),m.jsx("p",{className:"mb-4 text-xl text-muted-foreground",children:"Oops! Page not found"}),m.jsx("a",{href:"/",className:"text-primary underline hover:text-primary/90",children:"Return to Home"})]})})},XT=async e=>{const{data:t}=await qt.from("user_roles").select("role").eq("user_id",e).single();return t==null?void 0:t.role},ske=()=>{const{user:e}=Fi();return Li({queryKey:["admin-users",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await qt.from("profiles").select("*").order("created_at",{ascending:!1});if(r)throw r;const n=await Promise.all((t||[]).map(async l=>{const{data:d}=await qt.from("user_roles").select("role").eq("user_id",l.id).single();return{...l,role:(d==null?void 0:d.role)||"user"}})),{data:o}=await qt.from("user_roles").select("role").eq("user_id",e.id).single();if((o==null?void 0:o.role)==="supervisor"){const{data:l,error:d}=await qt.from("merchant_restaurants").select("restaurant_id").eq("user_id",e.id);if(d)throw d;if(!l||l.length===0)return[];const i=l.map(N=>N.restaurant_id),{data:g,error:_}=await qt.from("merchant_restaurants").select("user_id, restaurant_id").in("restaurant_id",i);if(_)throw _;if(!g||g.length===0)return[];const S=[...new Set(g.map(N=>N.user_id).filter(N=>N!==e.id))];if(S.length===0)return[];const{data:E,error:T}=await qt.from("user_roles").select("user_id").in("user_id",S).eq("role","merchant");if(T)throw T;const C=(E==null?void 0:E.map(N=>N.user_id))||[];return n.filter(N=>C.includes(N.id))}return n}})},lke=()=>{const{toast:e}=Sa(),t=Ma();return Ya({mutationFn:async({userId:r,role:n})=>{const{error:o}=await qt.from("user_roles").upsert({user_id:r,role:n},{onConflict:"user_id"});if(o)throw o},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-users"]}),t.invalidateQueries({queryKey:["user-roles"]}),e({title:jr.t("common.success"),description:jr.t("toast.roleChanged")})},onError:r=>{console.error("Role change error:",r),e({title:jr.t("common.error"),description:r.message||jr.t("toast.roleChangeFailed"),variant:"destructive"})}})},cke=()=>{const{user:e}=Fi();return Li({queryKey:["admin-restaurants",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];if(await XT(e.id)==="supervisor"){const{data:n,error:o}=await qt.from("merchant_restaurants").select("restaurant_id").eq("user_id",e.id);if(o)throw o;const l=(n==null?void 0:n.map(g=>g.restaurant_id))||[];if(l.length===0)return[];const{data:d,error:i}=await qt.from("restaurants").select("*").in("id",l).order("rating",{ascending:!1});if(i)throw i;return d||[]}else{const{data:n,error:o}=await qt.from("restaurants").select("*").order("rating",{ascending:!1});if(o)throw o;return n||[]}},enabled:!!e})},uke=()=>Li({queryKey:["operation-logs"],queryFn:async()=>{const{data:e,error:t}=await qt.from("operation_logs").select("*").order("created_at",{ascending:!1}).limit(100);if(t)throw t;return await Promise.all((e||[]).map(async n=>{const{data:o}=await qt.from("profiles").select("display_name").eq("id",n.user_id).single();return{...n,user_name:(o==null?void 0:o.display_name)||"Unknown User"}}))}}),dke=()=>{const{toast:e}=Sa(),t=Ma();return Ya({mutationFn:async({userId:r,display_name:n,phone:o,avatar_url:l})=>{const{data:d,error:i}=await qt.from("profiles").update({display_name:n,phone:o,avatar_url:l}).eq("id",r).select().single();if(i)throw i;return d},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-users"]}),e({title:jr.t("common.success"),description:jr.t("toast.profileUpdated")})},onError:()=>{e({title:jr.t("common.error"),description:jr.t("toast.profileUpdateFailed"),variant:"destructive"})}})},hke=()=>{const{toast:e}=Sa();return Ya({mutationFn:async({file:t,userId:r})=>{const n=t.name.split(".").pop(),o=`${Date.now()}.${n}`,l=`${r}/${o}`,{error:d}=await qt.storage.from("avatars").upload(l,t,{upsert:!0});if(d)throw d;const{data:{publicUrl:i}}=qt.storage.from("avatars").getPublicUrl(l);return i},onError:()=>{e({title:jr.t("common.error"),description:jr.t("toast.avatarUploadFailed"),variant:"destructive"})}})},fke=()=>{const{user:e}=Fi();return Li({queryKey:["admin-stats",e==null?void 0:e.id],queryFn:async()=>{if(!e)return{totalUsers:0,totalRestaurants:0,totalActivities:0,totalComments:0};if(await XT(e.id)==="supervisor"){const{data:i}=await qt.from("merchant_restaurants").select("restaurant_id, user_id").eq("user_id",e.id),g=(i==null?void 0:i.map(C=>C.restaurant_id))||[],S=(Array.from(new Set(i==null?void 0:i.map(C=>C.user_id)))||[]).length,E=g.length;let T=0;if(g.length>0){const{count:C}=await qt.from("comments").select("*",{count:"exact",head:!0}).eq("target_type","restaurant").in("target_id",g);T=C||0}return{totalUsers:S,totalRestaurants:E,totalActivities:0,totalComments:T}}const[n,o,l,d]=await Promise.all([qt.from("profiles").select("*",{count:"exact",head:!0}),qt.from("restaurants").select("*",{count:"exact",head:!0}),qt.from("activities").select("*",{count:"exact",head:!0}),qt.from("comments").select("*",{count:"exact",head:!0})]);return{totalUsers:n.count||0,totalRestaurants:o.count||0,totalActivities:l.count||0,totalComments:d.count||0}}})},pke=()=>{const{user:e}=Fi();return Li({queryKey:["top-restaurants",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const r=await XT(e.id)==="supervisor";let n=qt.from("restaurants").select("id, name, rating").order("rating",{ascending:!1,nullsFirst:!1}).limit(10);if(r){const{data:i}=await qt.from("merchant_restaurants").select("restaurant_id").eq("user_id",e.id),g=(i==null?void 0:i.map(_=>_.restaurant_id))||[];if(g.length===0)return[];n=qt.from("restaurants").select("id, name, rating").in("id",g).order("rating",{ascending:!1,nullsFirst:!1}).limit(10)}const{data:o,error:l}=await n;if(l)throw l;return await Promise.all((o||[]).map(async i=>{const{count:g}=await qt.from("comments").select("*",{count:"exact",head:!0}).eq("target_id",i.id).eq("target_type","restaurant");return{name:i.name,rating:i.rating||0,comments:g||0}}))}})},mke=()=>{const{user:e}=Fi();return Li({queryKey:["restaurant-rating-trends",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const r=await XT(e.id)==="supervisor";let n=[],o={};if(r){const{data:_}=await qt.from("merchant_restaurants").select("restaurant_id").eq("user_id",e.id);n=(_==null?void 0:_.map(S=>S.restaurant_id))||[]}else{const{data:_}=await qt.from("restaurants").select("id, name").order("rating",{ascending:!1,nullsFirst:!1}).limit(5);n=(_==null?void 0:_.map(S=>S.id))||[],_==null||_.forEach(S=>{o[S.id]=S.name})}if(n.length===0)return[];const{data:l}=await qt.from("comments").select("target_id, rating_value, created_at").eq("target_type","restaurant").in("target_id",n).not("rating_value","is",null).order("created_at",{ascending:!0});if(!l||l.length===0)return[];if(Object.keys(o).length===0){const{data:_}=await qt.from("restaurants").select("id, name").in("id",n);_==null||_.forEach(S=>{o[S.id]=S.name})}const d={};l.forEach(_=>{const S=new Date(_.created_at),E=`${S.getFullYear()}-${String(S.getMonth()+1).padStart(2,"0")}`;d[_.target_id]||(d[_.target_id]={}),d[_.target_id][E]||(d[_.target_id][E]={sum:0,count:0}),d[_.target_id][E].sum+=_.rating_value,d[_.target_id][E].count+=1});const i=new Set;return Object.values(d).forEach(_=>{Object.keys(_).forEach(S=>i.add(S))}),Array.from(i).sort().map(_=>{const S={month:_};return Object.keys(d).forEach(E=>{const T=d[E][_],C=T?(T.sum/T.count).toFixed(1):null;S[o[E]||E]=C}),S})}})},gke=()=>{const{user:e}=Fi();return Li({queryKey:["restaurant-comment-trends",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const r=await XT(e.id)==="supervisor";let n=[],o={};if(r){const{data:_}=await qt.from("merchant_restaurants").select("restaurant_id").eq("user_id",e.id);n=(_==null?void 0:_.map(S=>S.restaurant_id))||[]}else{const{data:_}=await qt.from("restaurants").select("id, name").order("rating",{ascending:!1,nullsFirst:!1}).limit(5);n=(_==null?void 0:_.map(S=>S.id))||[],_==null||_.forEach(S=>{o[S.id]=S.name})}if(n.length===0)return[];const{data:l}=await qt.from("comments").select("target_id, created_at").eq("target_type","restaurant").in("target_id",n).order("created_at",{ascending:!0});if(!l||l.length===0)return[];if(Object.keys(o).length===0){const{data:_}=await qt.from("restaurants").select("id, name").in("id",n);_==null||_.forEach(S=>{o[S.id]=S.name})}const d={};l.forEach(_=>{const S=new Date(_.created_at),E=`${S.getFullYear()}-${String(S.getMonth()+1).padStart(2,"0")}`;d[_.target_id]||(d[_.target_id]={}),d[_.target_id][E]=(d[_.target_id][E]||0)+1});const i=new Set;return Object.values(d).forEach(_=>{Object.keys(_).forEach(S=>i.add(S))}),Array.from(i).sort().map(_=>{const S={month:_};return Object.keys(d).forEach(E=>{const T=d[E][_]||0;S[o[E]||E]=T}),S})}})},yke=()=>Li({queryKey:["activity-engagement"],queryFn:async()=>{const{data:e,error:t}=await qt.from("activities").select("id, title_en").order("created_at",{ascending:!1}).limit(10);if(t)throw t;return await Promise.all((e||[]).map(async n=>{const[o,l]=await Promise.all([qt.from("subscriptions").select("*",{count:"exact",head:!0}).eq("activity_id",n.id),qt.from("comments").select("*",{count:"exact",head:!0}).eq("target_id",n.id).eq("target_type","activity")]);return{name:n.title_en,subscribers:o.count||0,comments:l.count||0}}))}}),vke=()=>{const{toast:e}=Sa(),t=Ma();return Ya({mutationFn:async r=>{await qt.from("activity_restaurants").delete().eq("activity_id",r);const{error:n}=await qt.from("activities").delete().eq("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["activities"]}),e({title:jr.t("common.success"),description:jr.t("toast.activityDeleted")})},onError:()=>{e({title:jr.t("common.error"),description:jr.t("toast.activityDeleteFailed"),variant:"destructive"})}})},_ke=()=>{const{toast:e}=Sa(),t=Ma();return Ya({mutationFn:async r=>{const{error:n}=await qt.from("restaurants").delete().eq("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["restaurants"]}),e({title:jr.t("common.success"),description:jr.t("toast.restaurantDeleted")})},onError:()=>{e({title:jr.t("common.error"),description:jr.t("toast.restaurantDeleteFailed"),variant:"destructive"})}})},xke=()=>{const{toast:e}=Sa(),t=Ma();return Ya({mutationFn:async r=>{const n=r.map(async o=>{const{error:l}=await qt.functions.invoke("delete-account",{body:{userId:o}});if(l)throw l});await Promise.all(n)},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-users"]}),e({title:jr.t("common.success"),description:jr.t("toast.usersDeleted")})},onError:()=>{e({title:jr.t("common.error"),description:jr.t("toast.usersDeleteFailed"),variant:"destructive"})}})},bke=()=>{const{toast:e}=Sa(),t=Ma();return Ya({mutationFn:async r=>{const{error:n}=await qt.from("restaurants").delete().in("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["restaurants"]}),e({title:jr.t("common.success"),description:jr.t("toast.restaurantsDeleted")})},onError:()=>{e({title:jr.t("common.error"),description:jr.t("toast.restaurantsDeleteFailed"),variant:"destructive"})}})},wke=()=>{const{toast:e}=Sa(),t=Ma();return Ya({mutationFn:async r=>{await qt.from("activity_restaurants").delete().in("activity_id",r);const{error:n}=await qt.from("activities").delete().in("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["activities"]}),e({title:jr.t("common.success"),description:jr.t("toast.activitiesDeleted")})},onError:()=>{e({title:jr.t("common.error"),description:jr.t("toast.activitiesDeleteFailed"),variant:"destructive"})}})},Ske=()=>{const{toast:e}=Sa(),t=Ma();return Ya({mutationFn:async({userIds:r,role:n})=>{const o=r.map(d=>({user_id:d,role:n})),{error:l}=await qt.from("user_roles").upsert(o,{onConflict:"user_id"});if(l)throw l},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-users"]}),e({title:jr.t("common.success"),description:jr.t("toast.rolesChanged")})},onError:r=>{console.error("Batch role change error:",r),e({title:jr.t("common.error"),description:r.message||jr.t("toast.rolesChangeFailed"),variant:"destructive"})}})},Eke=()=>{const{toast:e}=Sa(),t=Ma();return Ya({mutationFn:async({restaurantId:r,visible:n})=>{const{error:o}=await qt.from("restaurants").update({visible:n}).eq("id",r);if(o)throw o},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-restaurants"]}),t.invalidateQueries({queryKey:["restaurants"]}),e({title:jr.t("common.success"),description:jr.t("toast.visibilityUpdated")})},onError:()=>{e({title:jr.t("common.error"),description:jr.t("toast.visibilityUpdateFailed"),variant:"destructive"})}})};function WW({className:e,...t}){return m.jsx("div",{className:yr("animate-pulse rounded-md bg-muted",e),...t})}const Tke="sidebar:state",Ake=60*60*24*7,Pke="16rem",Cke="18rem",Oke="3rem",kke="b",Oae=W.createContext(null);function YT(){const e=W.useContext(Oae);if(!e)throw new Error("useSidebar must be used within a SidebarProvider.");return e}const kae=W.forwardRef(({defaultOpen:e=!0,open:t,onOpenChange:r,className:n,style:o,children:l,...d},i)=>{const g=G4(),[_,S]=W.useState(!1),[E,T]=W.useState(e),C=t??E,N=W.useCallback(R=>{const F=typeof R=="function"?R(C):R;r?r(F):T(F),document.cookie=`${Tke}=${F}; path=/; max-age=${Ake}`},[r,C]),I=W.useCallback(()=>g?S(R=>!R):N(R=>!R),[g,N,S]);W.useEffect(()=>{const R=F=>{F.key===kke&&(F.metaKey||F.ctrlKey)&&(F.preventDefault(),I())};return window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)},[I]);const j=C?"expanded":"collapsed",D=W.useMemo(()=>({state:j,open:C,setOpen:N,isMobile:g,openMobile:_,setOpenMobile:S,toggleSidebar:I}),[j,C,N,g,_,S,I]);return m.jsx(Oae.Provider,{value:D,children:m.jsx(HJ,{delayDuration:0,children:m.jsx("div",{style:{"--sidebar-width":Pke,"--sidebar-width-icon":Oke,...o},className:yr("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",n),ref:i,...d,children:l})})})});kae.displayName="SidebarProvider";const Iae=W.forwardRef(({side:e="left",variant:t="sidebar",collapsible:r="offcanvas",className:n,children:o,...l},d)=>{const{isMobile:i,state:g,openMobile:_,setOpenMobile:S}=YT();return r==="none"?m.jsx("div",{className:yr("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",n),ref:d,...l,children:o}):i?m.jsx(ote,{open:_,onOpenChange:S,...l,children:m.jsx(t4,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":Cke},side:e,children:m.jsx("div",{className:"flex h-full w-full flex-col",children:o})})}):m.jsxs("div",{ref:d,className:"group peer hidden text-sidebar-foreground md:block","data-state":g,"data-collapsible":g==="collapsed"?r:"","data-variant":t,"data-side":e,children:[m.jsx("div",{className:yr("relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",t==="floating"||t==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),m.jsx("div",{className:yr("fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex",e==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",t==="floating"||t==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",n),...l,children:m.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:o})})]})});Iae.displayName="Sidebar";const Rae=W.forwardRef(({className:e,onClick:t,...r},n)=>{const{toggleSidebar:o}=YT();return m.jsxs(ir,{ref:n,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:yr("h-7 w-7",e),onClick:l=>{t==null||t(l),o()},...r,children:[m.jsx(Tye,{}),m.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});Rae.displayName="SidebarTrigger";const Ike=W.forwardRef(({className:e,...t},r)=>{const{toggleSidebar:n}=YT();return m.jsx("button",{ref:r,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:n,title:"Toggle Sidebar",className:yr("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] group-data-[side=left]:-right-4 group-data-[side=right]:left-0 hover:after:bg-sidebar-border sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",e),...t})});Ike.displayName="SidebarRail";const Rke=W.forwardRef(({className:e,...t},r)=>m.jsx("main",{ref:r,className:yr("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",e),...t}));Rke.displayName="SidebarInset";const jke=W.forwardRef(({className:e,...t},r)=>m.jsx(en,{ref:r,"data-sidebar":"input",className:yr("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",e),...t}));jke.displayName="SidebarInput";const Nke=W.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,"data-sidebar":"header",className:yr("flex flex-col gap-2 p-2",e),...t}));Nke.displayName="SidebarHeader";const Mke=W.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,"data-sidebar":"footer",className:yr("flex flex-col gap-2 p-2",e),...t}));Mke.displayName="SidebarFooter";const Dke=W.forwardRef(({className:e,...t},r)=>m.jsx(xu,{ref:r,"data-sidebar":"separator",className:yr("mx-2 w-auto bg-sidebar-border",e),...t}));Dke.displayName="SidebarSeparator";const jae=W.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,"data-sidebar":"content",className:yr("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",e),...t}));jae.displayName="SidebarContent";const Nae=W.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,"data-sidebar":"group",className:yr("relative flex w-full min-w-0 flex-col p-2",e),...t}));Nae.displayName="SidebarGroup";const Mae=W.forwardRef(({className:e,asChild:t=!1,...r},n)=>{const o=t?Av:"div";return m.jsx(o,{ref:n,"data-sidebar":"group-label",className:yr("flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",e),...r})});Mae.displayName="SidebarGroupLabel";const Lke=W.forwardRef(({className:e,asChild:t=!1,...r},n)=>{const o=t?Av:"button";return m.jsx(o,{ref:n,"data-sidebar":"group-action",className:yr("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",e),...r})});Lke.displayName="SidebarGroupAction";const Dae=W.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,"data-sidebar":"group-content",className:yr("w-full text-sm",e),...t}));Dae.displayName="SidebarGroupContent";const Lae=W.forwardRef(({className:e,...t},r)=>m.jsx("ul",{ref:r,"data-sidebar":"menu",className:yr("flex w-full min-w-0 flex-col gap-1",e),...t}));Lae.displayName="SidebarMenu";const Fae=W.forwardRef(({className:e,...t},r)=>m.jsx("li",{ref:r,"data-sidebar":"menu-item",className:yr("group/menu-item relative",e),...t}));Fae.displayName="SidebarMenuItem";const Fke=wb("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),zae=W.forwardRef(({asChild:e=!1,isActive:t=!1,variant:r="default",size:n="default",tooltip:o,className:l,...d},i)=>{const g=e?Av:"button",{isMobile:_,state:S}=YT(),E=m.jsx(g,{ref:i,"data-sidebar":"menu-button","data-size":n,"data-active":t,className:yr(Fke({variant:r,size:n}),l),...d});return o?(typeof o=="string"&&(o={children:o}),m.jsxs(kxe,{children:[m.jsx(Ixe,{asChild:!0,children:E}),m.jsx(KJ,{side:"right",align:"center",hidden:S!=="collapsed"||_,...o})]})):E});zae.displayName="SidebarMenuButton";const zke=W.forwardRef(({className:e,asChild:t=!1,showOnHover:r=!1,...n},o)=>{const l=t?Av:"button";return m.jsx(l,{ref:o,"data-sidebar":"menu-action",className:yr("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform peer-hover/menu-button:text-sidebar-accent-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",r&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",e),...n})});zke.displayName="SidebarMenuAction";const Bke=W.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,"data-sidebar":"menu-badge",className:yr("pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",e),...t}));Bke.displayName="SidebarMenuBadge";const $ke=W.forwardRef(({className:e,showIcon:t=!1,...r},n)=>{const o=W.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return m.jsxs("div",{ref:n,"data-sidebar":"menu-skeleton",className:yr("flex h-8 items-center gap-2 rounded-md px-2",e),...r,children:[t&&m.jsx(WW,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),m.jsx(WW,{className:"h-4 max-w-[--skeleton-width] flex-1","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":o}})]})});$ke.displayName="SidebarMenuSkeleton";const Uke=W.forwardRef(({className:e,...t},r)=>m.jsx("ul",{ref:r,"data-sidebar":"menu-sub",className:yr("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",e),...t}));Uke.displayName="SidebarMenuSub";const Vke=W.forwardRef(({...e},t)=>m.jsx("li",{ref:t,...e}));Vke.displayName="SidebarMenuSubItem";const qke=W.forwardRef(({asChild:e=!1,size:t="md",isActive:r,className:n,...o},l)=>{const d=e?Av:"a";return m.jsx(d,{ref:l,"data-sidebar":"menu-sub-button","data-size":t,"data-active":r,className:yr("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring aria-disabled:pointer-events-none aria-disabled:opacity-50 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",t==="sm"&&"text-xs",t==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",n),...o})});qke.displayName="SidebarMenuSubButton";const Wke=()=>{const{t:e}=Ki(),{state:t}=YT(),{isAdmin:r}=nu(),o=Rh().pathname,d=[{title:e("admin.dashboard"),url:"/admin",icon:bye,allowedRoles:["admin","supervisor"]},{title:e("admin.users"),url:"/admin/users",icon:_u,allowedRoles:["admin","supervisor"]},{title:e("admin.restaurants"),url:"/admin/restaurants",icon:sJ,allowedRoles:["admin","supervisor"]},{title:e("admin.activities"),url:"/admin/activities",icon:Sc,allowedRoles:["admin"]},{title:e("admin.reports"),url:"/admin/reports",icon:fC,allowedRoles:["admin"]},{title:e("joinUs.adminTitle"),url:"/admin/join-requests",icon:es,allowedRoles:["admin"]},{title:e("admin.logs"),url:"/admin/logs",icon:xye,allowedRoles:["admin"]}].filter(g=>r||g.allowedRoles.includes("supervisor")),i=g=>g==="/admin"?o===g:o.startsWith(g);return m.jsx(Iae,{className:t==="collapsed"?"w-14":"w-60",children:m.jsx(jae,{children:m.jsxs(Nae,{children:[m.jsx(Mae,{className:t==="collapsed"?"text-center":"",children:t==="collapsed"?m.jsx(iJ,{className:"h-4 w-4"}):e("admin.management")}),m.jsx(Dae,{children:m.jsx(Lae,{className:"mt-[30px]",children:d.map(g=>m.jsx(Fae,{children:m.jsx(zae,{asChild:!0,isActive:i(g.url),children:m.jsxs(ia,{to:g.url,children:[m.jsx(g.icon,{className:"h-4 w-4"}),t!=="collapsed"&&m.jsx("span",{children:g.title})]})})},g.url))})})]})})})},eu=({children:e})=>{const{t}=Ki(),{user:r}=Fi(),{isAdmin:n,isSupervisor:o,isLoading:l}=nu();return l?m.jsx("div",{className:"min-h-screen flex items-center justify-center",children:m.jsx("div",{className:"text-center",children:t("common.loading")})}):!r||!n&&!o?m.jsx(Y0e,{to:"/",replace:!0}):m.jsx(kae,{children:m.jsxs("div",{className:"min-h-screen flex flex-col w-full",children:[m.jsx("header",{className:"h-14 flex items-center border-b bg-background px-4 sticky top-0 z-10",children:m.jsx(Rae,{})}),m.jsxs("div",{className:"flex flex-1 w-full",children:[m.jsx(Wke,{}),m.jsx("main",{className:"flex-1 p-3 md:p-6 bg-secondary/20 overflow-x-hidden",children:m.jsx("div",{className:"max-w-full overflow-x-hidden",children:e})})]})]})})};var Gke=Array.isArray,Pc=Gke,Hke=typeof gc=="object"&&gc&&gc.Object===Object&&gc,Bae=Hke,Kke=Bae,Zke=typeof self=="object"&&self&&self.Object===Object&&self,Xke=Kke||Zke||Function("return this")(),Mh=Xke,Yke=Mh,Jke=Yke.Symbol,JT=Jke,GW=JT,$ae=Object.prototype,Qke=$ae.hasOwnProperty,eIe=$ae.toString,fS=GW?GW.toStringTag:void 0;function tIe(e){var t=Qke.call(e,fS),r=e[fS];try{e[fS]=void 0;var n=!0}catch{}var o=eIe.call(e);return n&&(t?e[fS]=r:delete e[fS]),o}var rIe=tIe,nIe=Object.prototype,iIe=nIe.toString;function aIe(e){return iIe.call(e)}var oIe=aIe,HW=JT,sIe=rIe,lIe=oIe,cIe="[object Null]",uIe="[object Undefined]",KW=HW?HW.toStringTag:void 0;function dIe(e){return e==null?e===void 0?uIe:cIe:KW&&KW in Object(e)?sIe(e):lIe(e)}var Hf=dIe;function hIe(e){return e!=null&&typeof e=="object"}var Kf=hIe,fIe=Hf,pIe=Kf,mIe="[object Symbol]";function gIe(e){return typeof e=="symbol"||pIe(e)&&fIe(e)==mIe}var Nb=gIe,yIe=Pc,vIe=Nb,_Ie=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,xIe=/^\w*$/;function bIe(e,t){if(yIe(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||vIe(e)?!0:xIe.test(e)||!_Ie.test(e)||t!=null&&e in Object(t)}var H4=bIe;function wIe(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var ug=wIe;const Mb=_a(ug);var SIe=Hf,EIe=ug,TIe="[object AsyncFunction]",AIe="[object Function]",PIe="[object GeneratorFunction]",CIe="[object Proxy]";function OIe(e){if(!EIe(e))return!1;var t=SIe(e);return t==AIe||t==PIe||t==TIe||t==CIe}var K4=OIe;const li=_a(K4);var kIe=Mh,IIe=kIe["__core-js_shared__"],RIe=IIe,eD=RIe,ZW=function(){var e=/[^.]+$/.exec(eD&&eD.keys&&eD.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function jIe(e){return!!ZW&&ZW in e}var NIe=jIe,MIe=Function.prototype,DIe=MIe.toString;function LIe(e){if(e!=null){try{return DIe.call(e)}catch{}try{return e+""}catch{}}return""}var Uae=LIe,FIe=K4,zIe=NIe,BIe=ug,$Ie=Uae,UIe=/[\\^$.*+?()[\]{}|]/g,VIe=/^\[object .+?Constructor\]$/,qIe=Function.prototype,WIe=Object.prototype,GIe=qIe.toString,HIe=WIe.hasOwnProperty,KIe=RegExp("^"+GIe.call(HIe).replace(UIe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ZIe(e){if(!BIe(e)||zIe(e))return!1;var t=FIe(e)?KIe:VIe;return t.test($Ie(e))}var XIe=ZIe;function YIe(e,t){return e==null?void 0:e[t]}var JIe=YIe,QIe=XIe,eRe=JIe;function tRe(e,t){var r=eRe(e,t);return QIe(r)?r:void 0}var Nv=tRe,rRe=Nv,nRe=rRe(Object,"create"),ZI=nRe,XW=ZI;function iRe(){this.__data__=XW?XW(null):{},this.size=0}var aRe=iRe;function oRe(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var sRe=oRe,lRe=ZI,cRe="__lodash_hash_undefined__",uRe=Object.prototype,dRe=uRe.hasOwnProperty;function hRe(e){var t=this.__data__;if(lRe){var r=t[e];return r===cRe?void 0:r}return dRe.call(t,e)?t[e]:void 0}var fRe=hRe,pRe=ZI,mRe=Object.prototype,gRe=mRe.hasOwnProperty;function yRe(e){var t=this.__data__;return pRe?t[e]!==void 0:gRe.call(t,e)}var vRe=yRe,_Re=ZI,xRe="__lodash_hash_undefined__";function bRe(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=_Re&&t===void 0?xRe:t,this}var wRe=bRe,SRe=aRe,ERe=sRe,TRe=fRe,ARe=vRe,PRe=wRe;function Db(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Db.prototype.clear=SRe;Db.prototype.delete=ERe;Db.prototype.get=TRe;Db.prototype.has=ARe;Db.prototype.set=PRe;var CRe=Db;function ORe(){this.__data__=[],this.size=0}var kRe=ORe;function IRe(e,t){return e===t||e!==e&&t!==t}var Z4=IRe,RRe=Z4;function jRe(e,t){for(var r=e.length;r--;)if(RRe(e[r][0],t))return r;return-1}var XI=jRe,NRe=XI,MRe=Array.prototype,DRe=MRe.splice;function LRe(e){var t=this.__data__,r=NRe(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():DRe.call(t,r,1),--this.size,!0}var FRe=LRe,zRe=XI;function BRe(e){var t=this.__data__,r=zRe(t,e);return r<0?void 0:t[r][1]}var $Re=BRe,URe=XI;function VRe(e){return URe(this.__data__,e)>-1}var qRe=VRe,WRe=XI;function GRe(e,t){var r=this.__data__,n=WRe(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var HRe=GRe,KRe=kRe,ZRe=FRe,XRe=$Re,YRe=qRe,JRe=HRe;function Lb(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Lb.prototype.clear=KRe;Lb.prototype.delete=ZRe;Lb.prototype.get=XRe;Lb.prototype.has=YRe;Lb.prototype.set=JRe;var YI=Lb,QRe=Nv,eje=Mh,tje=QRe(eje,"Map"),X4=tje,YW=CRe,rje=YI,nje=X4;function ije(){this.size=0,this.__data__={hash:new YW,map:new(nje||rje),string:new YW}}var aje=ije;function oje(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var sje=oje,lje=sje;function cje(e,t){var r=e.__data__;return lje(t)?r[typeof t=="string"?"string":"hash"]:r.map}var JI=cje,uje=JI;function dje(e){var t=uje(this,e).delete(e);return this.size-=t?1:0,t}var hje=dje,fje=JI;function pje(e){return fje(this,e).get(e)}var mje=pje,gje=JI;function yje(e){return gje(this,e).has(e)}var vje=yje,_je=JI;function xje(e,t){var r=_je(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var bje=xje,wje=aje,Sje=hje,Eje=mje,Tje=vje,Aje=bje;function Fb(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Fb.prototype.clear=wje;Fb.prototype.delete=Sje;Fb.prototype.get=Eje;Fb.prototype.has=Tje;Fb.prototype.set=Aje;var Y4=Fb,Vae=Y4,Pje="Expected a function";function J4(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(Pje);var r=function(){var n=arguments,o=t?t.apply(this,n):n[0],l=r.cache;if(l.has(o))return l.get(o);var d=e.apply(this,n);return r.cache=l.set(o,d)||l,d};return r.cache=new(J4.Cache||Vae),r}J4.Cache=Vae;var qae=J4;const Cje=_a(qae);var Oje=qae,kje=500;function Ije(e){var t=Oje(e,function(n){return r.size===kje&&r.clear(),n}),r=t.cache;return t}var Rje=Ije,jje=Rje,Nje=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Mje=/\\(\\)?/g,Dje=jje(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Nje,function(r,n,o,l){t.push(o?l.replace(Mje,"$1"):n||r)}),t}),Lje=Dje;function Fje(e,t){for(var r=-1,n=e==null?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o}var Q4=Fje,JW=JT,zje=Q4,Bje=Pc,$je=Nb,Uje=1/0,QW=JW?JW.prototype:void 0,eG=QW?QW.toString:void 0;function Wae(e){if(typeof e=="string")return e;if(Bje(e))return zje(e,Wae)+"";if($je(e))return eG?eG.call(e):"";var t=e+"";return t=="0"&&1/e==-Uje?"-0":t}var Vje=Wae,qje=Vje;function Wje(e){return e==null?"":qje(e)}var Gae=Wje,Gje=Pc,Hje=H4,Kje=Lje,Zje=Gae;function Xje(e,t){return Gje(e)?e:Hje(e,t)?[e]:Kje(Zje(e))}var Hae=Xje,Yje=Nb,Jje=1/0;function Qje(e){if(typeof e=="string"||Yje(e))return e;var t=e+"";return t=="0"&&1/e==-Jje?"-0":t}var QI=Qje,eNe=Hae,tNe=QI;function rNe(e,t){t=eNe(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[tNe(t[r++])];return r&&r==n?e:void 0}var e5=rNe,nNe=e5;function iNe(e,t,r){var n=e==null?void 0:nNe(e,t);return n===void 0?r:n}var Kae=iNe;const Xc=_a(Kae);function aNe(e){return e==null}var oNe=aNe;const wi=_a(oNe);var sNe=Hf,lNe=Pc,cNe=Kf,uNe="[object String]";function dNe(e){return typeof e=="string"||!lNe(e)&&cNe(e)&&sNe(e)==uNe}var hNe=dNe;const vv=_a(hNe);var Zae={exports:{}},Da={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var t5=Symbol.for("react.element"),r5=Symbol.for("react.portal"),eR=Symbol.for("react.fragment"),tR=Symbol.for("react.strict_mode"),rR=Symbol.for("react.profiler"),nR=Symbol.for("react.provider"),iR=Symbol.for("react.context"),fNe=Symbol.for("react.server_context"),aR=Symbol.for("react.forward_ref"),oR=Symbol.for("react.suspense"),sR=Symbol.for("react.suspense_list"),lR=Symbol.for("react.memo"),cR=Symbol.for("react.lazy"),pNe=Symbol.for("react.offscreen"),Xae;Xae=Symbol.for("react.module.reference");function Lu(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case t5:switch(e=e.type,e){case eR:case rR:case tR:case oR:case sR:return e;default:switch(e=e&&e.$$typeof,e){case fNe:case iR:case aR:case cR:case lR:case nR:return e;default:return t}}case r5:return t}}}Da.ContextConsumer=iR;Da.ContextProvider=nR;Da.Element=t5;Da.ForwardRef=aR;Da.Fragment=eR;Da.Lazy=cR;Da.Memo=lR;Da.Portal=r5;Da.Profiler=rR;Da.StrictMode=tR;Da.Suspense=oR;Da.SuspenseList=sR;Da.isAsyncMode=function(){return!1};Da.isConcurrentMode=function(){return!1};Da.isContextConsumer=function(e){return Lu(e)===iR};Da.isContextProvider=function(e){return Lu(e)===nR};Da.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===t5};Da.isForwardRef=function(e){return Lu(e)===aR};Da.isFragment=function(e){return Lu(e)===eR};Da.isLazy=function(e){return Lu(e)===cR};Da.isMemo=function(e){return Lu(e)===lR};Da.isPortal=function(e){return Lu(e)===r5};Da.isProfiler=function(e){return Lu(e)===rR};Da.isStrictMode=function(e){return Lu(e)===tR};Da.isSuspense=function(e){return Lu(e)===oR};Da.isSuspenseList=function(e){return Lu(e)===sR};Da.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===eR||e===rR||e===tR||e===oR||e===sR||e===pNe||typeof e=="object"&&e!==null&&(e.$$typeof===cR||e.$$typeof===lR||e.$$typeof===nR||e.$$typeof===iR||e.$$typeof===aR||e.$$typeof===Xae||e.getModuleId!==void 0)};Da.typeOf=Lu;Zae.exports=Da;var mNe=Zae.exports,gNe=Hf,yNe=Kf,vNe="[object Number]";function _Ne(e){return typeof e=="number"||yNe(e)&&gNe(e)==vNe}var Yae=_Ne;const xNe=_a(Yae);var bNe=Yae;function wNe(e){return bNe(e)&&e!=+e}var SNe=wNe;const QT=_a(SNe);var ql=function(t){return t===0?0:t>0?1:-1},Fy=function(t){return vv(t)&&t.indexOf("%")===t.length-1},$r=function(t){return xNe(t)&&!QT(t)},ENe=function(t){return wi(t)},vs=function(t){return $r(t)||vv(t)},TNe=0,zb=function(t){var r=++TNe;return"".concat(t||"").concat(r)},Wl=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!$r(t)&&!vv(t))return n;var l;if(Fy(t)){var d=t.indexOf("%");l=r*parseFloat(t.slice(0,d))/100}else l=+t;return QT(l)&&(l=n),o&&l>r&&(l=r),l},um=function(t){if(!t)return null;var r=Object.keys(t);return r&&r.length?t[r[0]]:null},ANe=function(t){if(!Array.isArray(t))return!1;for(var r=t.length,n={},o=0;o<r;o++)if(!n[t[o]])n[t[o]]=!0;else return!0;return!1},Uc=function(t,r){return $r(t)&&$r(r)?function(n){return t+n*(r-t)}:function(){return r}};function LO(e,t,r){return!e||!e.length?null:e.find(function(n){return n&&(typeof t=="function"?t(n):Xc(n,t))===r})}var PNe=function(t,r){return $r(t)&&$r(r)?t-r:vv(t)&&vv(r)?t.localeCompare(r):t instanceof Date&&r instanceof Date?t.getTime()-r.getTime():String(t).localeCompare(String(r))};function o0(e,t){for(var r in e)if({}.hasOwnProperty.call(e,r)&&(!{}.hasOwnProperty.call(t,r)||e[r]!==t[r]))return!1;for(var n in t)if({}.hasOwnProperty.call(t,n)&&!{}.hasOwnProperty.call(e,n))return!1;return!0}function z3(e){"@babel/helpers - typeof";return z3=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},z3(e)}var CNe=["viewBox","children"],ONe=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],tG=["points","pathLength"],tD={svg:CNe,polygon:tG,polyline:tG},n5=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],FO=function(t,r){if(!t||typeof t=="function"||typeof t=="boolean")return null;var n=t;if(W.isValidElement(t)&&(n=t.props),!Mb(n))return null;var o={};return Object.keys(n).forEach(function(l){n5.includes(l)&&(o[l]=r||function(d){return n[l](n,d)})}),o},kNe=function(t,r,n){return function(o){return t(r,n,o),null}},_v=function(t,r,n){if(!Mb(t)||z3(t)!=="object")return null;var o=null;return Object.keys(t).forEach(function(l){var d=t[l];n5.includes(l)&&typeof d=="function"&&(o||(o={}),o[l]=kNe(d,r,n))}),o},INe=["children"],RNe=["children"];function rG(e,t){if(e==null)return{};var r=jNe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function jNe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function B3(e){"@babel/helpers - typeof";return B3=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B3(e)}var nG={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},Cf=function(t){return typeof t=="string"?t:t?t.displayName||t.name||"Component":""},iG=null,rD=null,i5=function e(t){if(t===iG&&Array.isArray(rD))return rD;var r=[];return W.Children.forEach(t,function(n){wi(n)||(mNe.isFragment(n)?r=r.concat(e(n.props.children)):r.push(n))}),rD=r,iG=t,r};function Yc(e,t){var r=[],n=[];return Array.isArray(t)?n=t.map(function(o){return Cf(o)}):n=[Cf(t)],i5(e).forEach(function(o){var l=Xc(o,"type.displayName")||Xc(o,"type.name");n.indexOf(l)!==-1&&r.push(o)}),r}function zc(e,t){var r=Yc(e,t);return r&&r[0]}var aG=function(t){if(!t||!t.props)return!1;var r=t.props,n=r.width,o=r.height;return!(!$r(n)||n<=0||!$r(o)||o<=0)},NNe=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],MNe=function(t){return t&&t.type&&vv(t.type)&&NNe.indexOf(t.type)>=0},DNe=function(t){return t&&B3(t)==="object"&&"clipDot"in t},LNe=function(t,r,n,o){var l,d=(l=tD==null?void 0:tD[o])!==null&&l!==void 0?l:[];return r.startsWith("data-")||!li(t)&&(o&&d.includes(r)||ONe.includes(r))||n&&n5.includes(r)},Gn=function(t,r,n){if(!t||typeof t=="function"||typeof t=="boolean")return null;var o=t;if(W.isValidElement(t)&&(o=t.props),!Mb(o))return null;var l={};return Object.keys(o).forEach(function(d){var i;LNe((i=o)===null||i===void 0?void 0:i[d],d,r,n)&&(l[d]=o[d])}),l},$3=function e(t,r){if(t===r)return!0;var n=W.Children.count(t);if(n!==W.Children.count(r))return!1;if(n===0)return!0;if(n===1)return oG(Array.isArray(t)?t[0]:t,Array.isArray(r)?r[0]:r);for(var o=0;o<n;o++){var l=t[o],d=r[o];if(Array.isArray(l)||Array.isArray(d)){if(!e(l,d))return!1}else if(!oG(l,d))return!1}return!0},oG=function(t,r){if(wi(t)&&wi(r))return!0;if(!wi(t)&&!wi(r)){var n=t.props||{},o=n.children,l=rG(n,INe),d=r.props||{},i=d.children,g=rG(d,RNe);return o&&i?o0(l,g)&&$3(o,i):!o&&!i?o0(l,g):!1}return!1},sG=function(t,r){var n=[],o={};return i5(t).forEach(function(l,d){if(MNe(l))n.push(l);else if(l){var i=Cf(l.type),g=r[i]||{},_=g.handler,S=g.once;if(_&&(!S||!o[i])){var E=_(l,i,d);n.push(E),o[i]=!0}}}),n},FNe=function(t){var r=t&&t.type;return r&&nG[r]?nG[r]:null},zNe=function(t,r){return i5(r).indexOf(t)},BNe=["children","width","height","viewBox","className","style","title","desc"];function U3(){return U3=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},U3.apply(this,arguments)}function $Ne(e,t){if(e==null)return{};var r=UNe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function UNe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function V3(e){var t=e.children,r=e.width,n=e.height,o=e.viewBox,l=e.className,d=e.style,i=e.title,g=e.desc,_=$Ne(e,BNe),S=o||{width:r,height:n,x:0,y:0},E=Ti("recharts-surface",l);return He.createElement("svg",U3({},Gn(_,!0,"svg"),{className:E,width:r,height:n,style:d,viewBox:"".concat(S.x," ").concat(S.y," ").concat(S.width," ").concat(S.height)}),He.createElement("title",null,i),He.createElement("desc",null,g),t)}var VNe=["children","className"];function q3(){return q3=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},q3.apply(this,arguments)}function qNe(e,t){if(e==null)return{};var r=WNe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function WNe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var ya=He.forwardRef(function(e,t){var r=e.children,n=e.className,o=qNe(e,VNe),l=Ti("recharts-layer",n);return He.createElement("g",q3({className:l},Gn(o,!0),{ref:t}),r)}),Ed=function(t,r){for(var n=arguments.length,o=new Array(n>2?n-2:0),l=2;l<n;l++)o[l-2]=arguments[l]};function GNe(e,t,r){var n=-1,o=e.length;t<0&&(t=-t>o?0:o+t),r=r>o?o:r,r<0&&(r+=o),o=t>r?0:r-t>>>0,t>>>=0;for(var l=Array(o);++n<o;)l[n]=e[n+t];return l}var HNe=GNe,KNe=HNe;function ZNe(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:KNe(e,t,r)}var XNe=ZNe,YNe="\\ud800-\\udfff",JNe="\\u0300-\\u036f",QNe="\\ufe20-\\ufe2f",eMe="\\u20d0-\\u20ff",tMe=JNe+QNe+eMe,rMe="\\ufe0e\\ufe0f",nMe="\\u200d",iMe=RegExp("["+nMe+YNe+tMe+rMe+"]");function aMe(e){return iMe.test(e)}var Jae=aMe;function oMe(e){return e.split("")}var sMe=oMe,Qae="\\ud800-\\udfff",lMe="\\u0300-\\u036f",cMe="\\ufe20-\\ufe2f",uMe="\\u20d0-\\u20ff",dMe=lMe+cMe+uMe,hMe="\\ufe0e\\ufe0f",fMe="["+Qae+"]",W3="["+dMe+"]",G3="\\ud83c[\\udffb-\\udfff]",pMe="(?:"+W3+"|"+G3+")",eoe="[^"+Qae+"]",toe="(?:\\ud83c[\\udde6-\\uddff]){2}",roe="[\\ud800-\\udbff][\\udc00-\\udfff]",mMe="\\u200d",noe=pMe+"?",ioe="["+hMe+"]?",gMe="(?:"+mMe+"(?:"+[eoe,toe,roe].join("|")+")"+ioe+noe+")*",yMe=ioe+noe+gMe,vMe="(?:"+[eoe+W3+"?",W3,toe,roe,fMe].join("|")+")",_Me=RegExp(G3+"(?="+G3+")|"+vMe+yMe,"g");function xMe(e){return e.match(_Me)||[]}var bMe=xMe,wMe=sMe,SMe=Jae,EMe=bMe;function TMe(e){return SMe(e)?EMe(e):wMe(e)}var AMe=TMe,PMe=XNe,CMe=Jae,OMe=AMe,kMe=Gae;function IMe(e){return function(t){t=kMe(t);var r=CMe(t)?OMe(t):void 0,n=r?r[0]:t.charAt(0),o=r?PMe(r,1).join(""):t.slice(1);return n[e]()+o}}var RMe=IMe,jMe=RMe,NMe=jMe("toUpperCase"),MMe=NMe;const uR=_a(MMe);function Ka(e){return function(){return e}}const aoe=Math.cos,zO=Math.sin,Dd=Math.sqrt,BO=Math.PI,dR=2*BO,H3=Math.PI,K3=2*H3,Py=1e-6,DMe=K3-Py;function ooe(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function LMe(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return ooe;const r=10**t;return function(n){this._+=n[0];for(let o=1,l=n.length;o<l;++o)this._+=Math.round(arguments[o]*r)/r+n[o]}}class FMe{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?ooe:LMe(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,o){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+o}`}bezierCurveTo(t,r,n,o,l,d){this._append`C${+t},${+r},${+n},${+o},${this._x1=+l},${this._y1=+d}`}arcTo(t,r,n,o,l){if(t=+t,r=+r,n=+n,o=+o,l=+l,l<0)throw new Error(`negative radius: ${l}`);let d=this._x1,i=this._y1,g=n-t,_=o-r,S=d-t,E=i-r,T=S*S+E*E;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(T>Py)if(!(Math.abs(E*g-_*S)>Py)||!l)this._append`L${this._x1=t},${this._y1=r}`;else{let C=n-d,N=o-i,I=g*g+_*_,j=C*C+N*N,D=Math.sqrt(I),R=Math.sqrt(T),F=l*Math.tan((H3-Math.acos((I+T-j)/(2*D*R)))/2),B=F/R,U=F/D;Math.abs(B-1)>Py&&this._append`L${t+B*S},${r+B*E}`,this._append`A${l},${l},0,0,${+(E*C>S*N)},${this._x1=t+U*g},${this._y1=r+U*_}`}}arc(t,r,n,o,l,d){if(t=+t,r=+r,n=+n,d=!!d,n<0)throw new Error(`negative radius: ${n}`);let i=n*Math.cos(o),g=n*Math.sin(o),_=t+i,S=r+g,E=1^d,T=d?o-l:l-o;this._x1===null?this._append`M${_},${S}`:(Math.abs(this._x1-_)>Py||Math.abs(this._y1-S)>Py)&&this._append`L${_},${S}`,n&&(T<0&&(T=T%K3+K3),T>DMe?this._append`A${n},${n},0,1,${E},${t-i},${r-g}A${n},${n},0,1,${E},${this._x1=_},${this._y1=S}`:T>Py&&this._append`A${n},${n},0,${+(T>=H3)},${E},${this._x1=t+n*Math.cos(l)},${this._y1=r+n*Math.sin(l)}`)}rect(t,r,n,o){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+o}h${-n}Z`}toString(){return this._}}function a5(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new FMe(t)}function o5(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function soe(e){this._context=e}soe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function hR(e){return new soe(e)}function loe(e){return e[0]}function coe(e){return e[1]}function uoe(e,t){var r=Ka(!0),n=null,o=hR,l=null,d=a5(i);e=typeof e=="function"?e:e===void 0?loe:Ka(e),t=typeof t=="function"?t:t===void 0?coe:Ka(t);function i(g){var _,S=(g=o5(g)).length,E,T=!1,C;for(n==null&&(l=o(C=d())),_=0;_<=S;++_)!(_<S&&r(E=g[_],_,g))===T&&((T=!T)?l.lineStart():l.lineEnd()),T&&l.point(+e(E,_,g),+t(E,_,g));if(C)return l=null,C+""||null}return i.x=function(g){return arguments.length?(e=typeof g=="function"?g:Ka(+g),i):e},i.y=function(g){return arguments.length?(t=typeof g=="function"?g:Ka(+g),i):t},i.defined=function(g){return arguments.length?(r=typeof g=="function"?g:Ka(!!g),i):r},i.curve=function(g){return arguments.length?(o=g,n!=null&&(l=o(n)),i):o},i.context=function(g){return arguments.length?(g==null?n=l=null:l=o(n=g),i):n},i}function zP(e,t,r){var n=null,o=Ka(!0),l=null,d=hR,i=null,g=a5(_);e=typeof e=="function"?e:e===void 0?loe:Ka(+e),t=typeof t=="function"?t:Ka(t===void 0?0:+t),r=typeof r=="function"?r:r===void 0?coe:Ka(+r);function _(E){var T,C,N,I=(E=o5(E)).length,j,D=!1,R,F=new Array(I),B=new Array(I);for(l==null&&(i=d(R=g())),T=0;T<=I;++T){if(!(T<I&&o(j=E[T],T,E))===D)if(D=!D)C=T,i.areaStart(),i.lineStart();else{for(i.lineEnd(),i.lineStart(),N=T-1;N>=C;--N)i.point(F[N],B[N]);i.lineEnd(),i.areaEnd()}D&&(F[T]=+e(j,T,E),B[T]=+t(j,T,E),i.point(n?+n(j,T,E):F[T],r?+r(j,T,E):B[T]))}if(R)return i=null,R+""||null}function S(){return uoe().defined(o).curve(d).context(l)}return _.x=function(E){return arguments.length?(e=typeof E=="function"?E:Ka(+E),n=null,_):e},_.x0=function(E){return arguments.length?(e=typeof E=="function"?E:Ka(+E),_):e},_.x1=function(E){return arguments.length?(n=E==null?null:typeof E=="function"?E:Ka(+E),_):n},_.y=function(E){return arguments.length?(t=typeof E=="function"?E:Ka(+E),r=null,_):t},_.y0=function(E){return arguments.length?(t=typeof E=="function"?E:Ka(+E),_):t},_.y1=function(E){return arguments.length?(r=E==null?null:typeof E=="function"?E:Ka(+E),_):r},_.lineX0=_.lineY0=function(){return S().x(e).y(t)},_.lineY1=function(){return S().x(e).y(r)},_.lineX1=function(){return S().x(n).y(t)},_.defined=function(E){return arguments.length?(o=typeof E=="function"?E:Ka(!!E),_):o},_.curve=function(E){return arguments.length?(d=E,l!=null&&(i=d(l)),_):d},_.context=function(E){return arguments.length?(E==null?l=i=null:i=d(l=E),_):l},_}class doe{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}}function zMe(e){return new doe(e,!0)}function BMe(e){return new doe(e,!1)}const s5={draw(e,t){const r=Dd(t/BO);e.moveTo(r,0),e.arc(0,0,r,0,dR)}},$Me={draw(e,t){const r=Dd(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},hoe=Dd(1/3),UMe=hoe*2,VMe={draw(e,t){const r=Dd(t/UMe),n=r*hoe;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}},qMe={draw(e,t){const r=Dd(t),n=-r/2;e.rect(n,n,r,r)}},WMe=.8908130915292852,foe=zO(BO/10)/zO(7*BO/10),GMe=zO(dR/10)*foe,HMe=-aoe(dR/10)*foe,KMe={draw(e,t){const r=Dd(t*WMe),n=GMe*r,o=HMe*r;e.moveTo(0,-r),e.lineTo(n,o);for(let l=1;l<5;++l){const d=dR*l/5,i=aoe(d),g=zO(d);e.lineTo(g*r,-i*r),e.lineTo(i*n-g*o,g*n+i*o)}e.closePath()}},nD=Dd(3),ZMe={draw(e,t){const r=-Dd(t/(nD*3));e.moveTo(0,r*2),e.lineTo(-nD*r,-r),e.lineTo(nD*r,-r),e.closePath()}},hu=-.5,fu=Dd(3)/2,Z3=1/Dd(12),XMe=(Z3/2+1)*3,YMe={draw(e,t){const r=Dd(t/XMe),n=r/2,o=r*Z3,l=n,d=r*Z3+r,i=-l,g=d;e.moveTo(n,o),e.lineTo(l,d),e.lineTo(i,g),e.lineTo(hu*n-fu*o,fu*n+hu*o),e.lineTo(hu*l-fu*d,fu*l+hu*d),e.lineTo(hu*i-fu*g,fu*i+hu*g),e.lineTo(hu*n+fu*o,hu*o-fu*n),e.lineTo(hu*l+fu*d,hu*d-fu*l),e.lineTo(hu*i+fu*g,hu*g-fu*i),e.closePath()}};function JMe(e,t){let r=null,n=a5(o);e=typeof e=="function"?e:Ka(e||s5),t=typeof t=="function"?t:Ka(t===void 0?64:+t);function o(){let l;if(r||(r=l=n()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),l)return r=null,l+""||null}return o.type=function(l){return arguments.length?(e=typeof l=="function"?l:Ka(l),o):e},o.size=function(l){return arguments.length?(t=typeof l=="function"?l:Ka(+l),o):t},o.context=function(l){return arguments.length?(r=l??null,o):r},o}function $O(){}function UO(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function poe(e){this._context=e}poe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:UO(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:UO(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function QMe(e){return new poe(e)}function moe(e){this._context=e}moe.prototype={areaStart:$O,areaEnd:$O,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:UO(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function eDe(e){return new moe(e)}function goe(e){this._context=e}goe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,n=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:UO(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function tDe(e){return new goe(e)}function yoe(e){this._context=e}yoe.prototype={areaStart:$O,areaEnd:$O,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function rDe(e){return new yoe(e)}function lG(e){return e<0?-1:1}function cG(e,t,r){var n=e._x1-e._x0,o=t-e._x1,l=(e._y1-e._y0)/(n||o<0&&-0),d=(r-e._y1)/(o||n<0&&-0),i=(l*o+d*n)/(n+o);return(lG(l)+lG(d))*Math.min(Math.abs(l),Math.abs(d),.5*Math.abs(i))||0}function uG(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function iD(e,t,r){var n=e._x0,o=e._y0,l=e._x1,d=e._y1,i=(l-n)/3;e._context.bezierCurveTo(n+i,o+i*t,l-i,d-i*r,l,d)}function VO(e){this._context=e}VO.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:iD(this,this._t0,uG(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,iD(this,uG(this,r=cG(this,e,t)),r);break;default:iD(this,this._t0,r=cG(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function voe(e){this._context=new _oe(e)}(voe.prototype=Object.create(VO.prototype)).point=function(e,t){VO.prototype.point.call(this,t,e)};function _oe(e){this._context=e}_oe.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,n,o,l){this._context.bezierCurveTo(t,e,n,r,l,o)}};function nDe(e){return new VO(e)}function iDe(e){return new voe(e)}function xoe(e){this._context=e}xoe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var n=dG(e),o=dG(t),l=0,d=1;d<r;++l,++d)this._context.bezierCurveTo(n[0][l],o[0][l],n[1][l],o[1][l],e[d],t[d]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function dG(e){var t,r=e.length-1,n,o=new Array(r),l=new Array(r),d=new Array(r);for(o[0]=0,l[0]=2,d[0]=e[0]+2*e[1],t=1;t<r-1;++t)o[t]=1,l[t]=4,d[t]=4*e[t]+2*e[t+1];for(o[r-1]=2,l[r-1]=7,d[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=o[t]/l[t-1],l[t]-=n,d[t]-=n*d[t-1];for(o[r-1]=d[r-1]/l[r-1],t=r-2;t>=0;--t)o[t]=(d[t]-o[t+1])/l[t];for(l[r-1]=(e[r]+o[r-1])/2,t=0;t<r-1;++t)l[t]=2*e[t+1]-o[t+1];return[o,l]}function aDe(e){return new xoe(e)}function fR(e,t){this._context=e,this._t=t}fR.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function oDe(e){return new fR(e,.5)}function sDe(e){return new fR(e,0)}function lDe(e){return new fR(e,1)}function H0(e,t){if((d=e.length)>1)for(var r=1,n,o,l=e[t[0]],d,i=l.length;r<d;++r)for(o=l,l=e[t[r]],n=0;n<i;++n)l[n][1]+=l[n][0]=isNaN(o[n][1])?o[n][0]:o[n][1]}function X3(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}function cDe(e,t){return e[t]}function uDe(e){const t=[];return t.key=e,t}function dDe(){var e=Ka([]),t=X3,r=H0,n=cDe;function o(l){var d=Array.from(e.apply(this,arguments),uDe),i,g=d.length,_=-1,S;for(const E of l)for(i=0,++_;i<g;++i)(d[i][_]=[0,+n(E,d[i].key,_,l)]).data=E;for(i=0,S=o5(t(d));i<g;++i)d[S[i]].index=i;return r(d,S),d}return o.keys=function(l){return arguments.length?(e=typeof l=="function"?l:Ka(Array.from(l)),o):e},o.value=function(l){return arguments.length?(n=typeof l=="function"?l:Ka(+l),o):n},o.order=function(l){return arguments.length?(t=l==null?X3:typeof l=="function"?l:Ka(Array.from(l)),o):t},o.offset=function(l){return arguments.length?(r=l??H0,o):r},o}function hDe(e,t){if((n=e.length)>0){for(var r,n,o=0,l=e[0].length,d;o<l;++o){for(d=r=0;r<n;++r)d+=e[r][o][1]||0;if(d)for(r=0;r<n;++r)e[r][o][1]/=d}H0(e,t)}}function fDe(e,t){if((o=e.length)>0){for(var r=0,n=e[t[0]],o,l=n.length;r<l;++r){for(var d=0,i=0;d<o;++d)i+=e[d][r][1]||0;n[r][1]+=n[r][0]=-i/2}H0(e,t)}}function pDe(e,t){if(!(!((d=e.length)>0)||!((l=(o=e[t[0]]).length)>0))){for(var r=0,n=1,o,l,d;n<l;++n){for(var i=0,g=0,_=0;i<d;++i){for(var S=e[t[i]],E=S[n][1]||0,T=S[n-1][1]||0,C=(E-T)/2,N=0;N<i;++N){var I=e[t[N]],j=I[n][1]||0,D=I[n-1][1]||0;C+=j-D}g+=E,_+=C*E}o[n-1][1]+=o[n-1][0]=r,g&&(r-=_/g)}o[n-1][1]+=o[n-1][0]=r,H0(e,t)}}function zE(e){"@babel/helpers - typeof";return zE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zE(e)}var mDe=["type","size","sizeType"];function Y3(){return Y3=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Y3.apply(this,arguments)}function hG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function fG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?hG(Object(r),!0).forEach(function(n){gDe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function gDe(e,t,r){return t=yDe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function yDe(e){var t=vDe(e,"string");return zE(t)=="symbol"?t:t+""}function vDe(e,t){if(zE(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(zE(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function _De(e,t){if(e==null)return{};var r=xDe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function xDe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var boe={symbolCircle:s5,symbolCross:$Me,symbolDiamond:VMe,symbolSquare:qMe,symbolStar:KMe,symbolTriangle:ZMe,symbolWye:YMe},bDe=Math.PI/180,wDe=function(t){var r="symbol".concat(uR(t));return boe[r]||s5},SDe=function(t,r,n){if(r==="area")return t;switch(n){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var o=18*bDe;return 1.25*t*t*(Math.tan(o)-Math.tan(o*2)*Math.pow(Math.tan(o),2))}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},EDe=function(t,r){boe["symbol".concat(uR(t))]=r},l5=function(t){var r=t.type,n=r===void 0?"circle":r,o=t.size,l=o===void 0?64:o,d=t.sizeType,i=d===void 0?"area":d,g=_De(t,mDe),_=fG(fG({},g),{},{type:n,size:l,sizeType:i}),S=function(){var j=wDe(n),D=JMe().type(j).size(SDe(l,i,n));return D()},E=_.className,T=_.cx,C=_.cy,N=Gn(_,!0);return T===+T&&C===+C&&l===+l?He.createElement("path",Y3({},N,{className:Ti("recharts-symbols",E),transform:"translate(".concat(T,", ").concat(C,")"),d:S()})):null};l5.registerSymbol=EDe;function K0(e){"@babel/helpers - typeof";return K0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K0(e)}function J3(){return J3=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},J3.apply(this,arguments)}function pG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function TDe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?pG(Object(r),!0).forEach(function(n){BE(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ADe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function PDe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Soe(n.key),n)}}function CDe(e,t,r){return t&&PDe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function ODe(e,t,r){return t=qO(t),kDe(e,woe()?Reflect.construct(t,r||[],qO(e).constructor):t.apply(e,r))}function kDe(e,t){if(t&&(K0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return IDe(e)}function IDe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function woe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(woe=function(){return!!e})()}function qO(e){return qO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},qO(e)}function RDe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Q3(e,t)}function Q3(e,t){return Q3=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},Q3(e,t)}function BE(e,t,r){return t=Soe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Soe(e){var t=jDe(e,"string");return K0(t)=="symbol"?t:t+""}function jDe(e,t){if(K0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(K0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var pu=32,c5=function(e){function t(){return ADe(this,t),ODe(this,t,arguments)}return RDe(t,e),CDe(t,[{key:"renderIcon",value:function(n){var o=this.props.inactiveColor,l=pu/2,d=pu/6,i=pu/3,g=n.inactive?o:n.color;if(n.type==="plainline")return He.createElement("line",{strokeWidth:4,fill:"none",stroke:g,strokeDasharray:n.payload.strokeDasharray,x1:0,y1:l,x2:pu,y2:l,className:"recharts-legend-icon"});if(n.type==="line")return He.createElement("path",{strokeWidth:4,fill:"none",stroke:g,d:"M0,".concat(l,"h").concat(i,`
            A`).concat(d,",").concat(d,",0,1,1,").concat(2*i,",").concat(l,`
            H`).concat(pu,"M").concat(2*i,",").concat(l,`
            A`).concat(d,",").concat(d,",0,1,1,").concat(i,",").concat(l),className:"recharts-legend-icon"});if(n.type==="rect")return He.createElement("path",{stroke:"none",fill:g,d:"M0,".concat(pu/8,"h").concat(pu,"v").concat(pu*3/4,"h").concat(-pu,"z"),className:"recharts-legend-icon"});if(He.isValidElement(n.legendIcon)){var _=TDe({},n);return delete _.legendIcon,He.cloneElement(n.legendIcon,_)}return He.createElement(l5,{fill:g,cx:l,cy:l,size:pu,sizeType:"diameter",type:n.type})}},{key:"renderItems",value:function(){var n=this,o=this.props,l=o.payload,d=o.iconSize,i=o.layout,g=o.formatter,_=o.inactiveColor,S={x:0,y:0,width:pu,height:pu},E={display:i==="horizontal"?"inline-block":"block",marginRight:10},T={display:"inline-block",verticalAlign:"middle",marginRight:4};return l.map(function(C,N){var I=C.formatter||g,j=Ti(BE(BE({"recharts-legend-item":!0},"legend-item-".concat(N),!0),"inactive",C.inactive));if(C.type==="none")return null;var D=li(C.value)?null:C.value;Ed(!li(C.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var R=C.inactive?_:C.color;return He.createElement("li",J3({className:j,style:E,key:"legend-item-".concat(N)},_v(n.props,C,N)),He.createElement(V3,{width:d,height:d,viewBox:S,style:T},n.renderIcon(C)),He.createElement("span",{className:"recharts-legend-item-text",style:{color:R}},I?I(D,C,N):D))})}},{key:"render",value:function(){var n=this.props,o=n.payload,l=n.layout,d=n.align;if(!o||!o.length)return null;var i={padding:0,margin:0,textAlign:l==="horizontal"?d:"left"};return He.createElement("ul",{className:"recharts-default-legend",style:i},this.renderItems())}}])}(W.PureComponent);BE(c5,"displayName","Legend");BE(c5,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var NDe=YI;function MDe(){this.__data__=new NDe,this.size=0}var DDe=MDe;function LDe(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var FDe=LDe;function zDe(e){return this.__data__.get(e)}var BDe=zDe;function $De(e){return this.__data__.has(e)}var UDe=$De,VDe=YI,qDe=X4,WDe=Y4,GDe=200;function HDe(e,t){var r=this.__data__;if(r instanceof VDe){var n=r.__data__;if(!qDe||n.length<GDe-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new WDe(n)}return r.set(e,t),this.size=r.size,this}var KDe=HDe,ZDe=YI,XDe=DDe,YDe=FDe,JDe=BDe,QDe=UDe,eLe=KDe;function Bb(e){var t=this.__data__=new ZDe(e);this.size=t.size}Bb.prototype.clear=XDe;Bb.prototype.delete=YDe;Bb.prototype.get=JDe;Bb.prototype.has=QDe;Bb.prototype.set=eLe;var Eoe=Bb,tLe="__lodash_hash_undefined__";function rLe(e){return this.__data__.set(e,tLe),this}var nLe=rLe;function iLe(e){return this.__data__.has(e)}var aLe=iLe,oLe=Y4,sLe=nLe,lLe=aLe;function WO(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new oLe;++t<r;)this.add(e[t])}WO.prototype.add=WO.prototype.push=sLe;WO.prototype.has=lLe;var Toe=WO;function cLe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var Aoe=cLe;function uLe(e,t){return e.has(t)}var Poe=uLe,dLe=Toe,hLe=Aoe,fLe=Poe,pLe=1,mLe=2;function gLe(e,t,r,n,o,l){var d=r&pLe,i=e.length,g=t.length;if(i!=g&&!(d&&g>i))return!1;var _=l.get(e),S=l.get(t);if(_&&S)return _==t&&S==e;var E=-1,T=!0,C=r&mLe?new dLe:void 0;for(l.set(e,t),l.set(t,e);++E<i;){var N=e[E],I=t[E];if(n)var j=d?n(I,N,E,t,e,l):n(N,I,E,e,t,l);if(j!==void 0){if(j)continue;T=!1;break}if(C){if(!hLe(t,function(D,R){if(!fLe(C,R)&&(N===D||o(N,D,r,n,l)))return C.push(R)})){T=!1;break}}else if(!(N===I||o(N,I,r,n,l))){T=!1;break}}return l.delete(e),l.delete(t),T}var Coe=gLe,yLe=Mh,vLe=yLe.Uint8Array,_Le=vLe;function xLe(e){var t=-1,r=Array(e.size);return e.forEach(function(n,o){r[++t]=[o,n]}),r}var bLe=xLe;function wLe(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var u5=wLe,mG=JT,gG=_Le,SLe=Z4,ELe=Coe,TLe=bLe,ALe=u5,PLe=1,CLe=2,OLe="[object Boolean]",kLe="[object Date]",ILe="[object Error]",RLe="[object Map]",jLe="[object Number]",NLe="[object RegExp]",MLe="[object Set]",DLe="[object String]",LLe="[object Symbol]",FLe="[object ArrayBuffer]",zLe="[object DataView]",yG=mG?mG.prototype:void 0,aD=yG?yG.valueOf:void 0;function BLe(e,t,r,n,o,l,d){switch(r){case zLe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case FLe:return!(e.byteLength!=t.byteLength||!l(new gG(e),new gG(t)));case OLe:case kLe:case jLe:return SLe(+e,+t);case ILe:return e.name==t.name&&e.message==t.message;case NLe:case DLe:return e==t+"";case RLe:var i=TLe;case MLe:var g=n&PLe;if(i||(i=ALe),e.size!=t.size&&!g)return!1;var _=d.get(e);if(_)return _==t;n|=CLe,d.set(e,t);var S=ELe(i(e),i(t),n,o,l,d);return d.delete(e),S;case LLe:if(aD)return aD.call(e)==aD.call(t)}return!1}var $Le=BLe;function ULe(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}var Ooe=ULe,VLe=Ooe,qLe=Pc;function WLe(e,t,r){var n=t(e);return qLe(e)?n:VLe(n,r(e))}var GLe=WLe;function HLe(e,t){for(var r=-1,n=e==null?0:e.length,o=0,l=[];++r<n;){var d=e[r];t(d,r,e)&&(l[o++]=d)}return l}var KLe=HLe;function ZLe(){return[]}var XLe=ZLe,YLe=KLe,JLe=XLe,QLe=Object.prototype,e3e=QLe.propertyIsEnumerable,vG=Object.getOwnPropertySymbols,t3e=vG?function(e){return e==null?[]:(e=Object(e),YLe(vG(e),function(t){return e3e.call(e,t)}))}:JLe,r3e=t3e;function n3e(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var i3e=n3e,a3e=Hf,o3e=Kf,s3e="[object Arguments]";function l3e(e){return o3e(e)&&a3e(e)==s3e}var c3e=l3e,_G=c3e,u3e=Kf,koe=Object.prototype,d3e=koe.hasOwnProperty,h3e=koe.propertyIsEnumerable,f3e=_G(function(){return arguments}())?_G:function(e){return u3e(e)&&d3e.call(e,"callee")&&!h3e.call(e,"callee")},d5=f3e,GO={exports:{}};function p3e(){return!1}var m3e=p3e;GO.exports;(function(e,t){var r=Mh,n=m3e,o=t&&!t.nodeType&&t,l=o&&!0&&e&&!e.nodeType&&e,d=l&&l.exports===o,i=d?r.Buffer:void 0,g=i?i.isBuffer:void 0,_=g||n;e.exports=_})(GO,GO.exports);var Ioe=GO.exports,g3e=9007199254740991,y3e=/^(?:0|[1-9]\d*)$/;function v3e(e,t){var r=typeof e;return t=t??g3e,!!t&&(r=="number"||r!="symbol"&&y3e.test(e))&&e>-1&&e%1==0&&e<t}var h5=v3e,_3e=9007199254740991;function x3e(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=_3e}var f5=x3e,b3e=Hf,w3e=f5,S3e=Kf,E3e="[object Arguments]",T3e="[object Array]",A3e="[object Boolean]",P3e="[object Date]",C3e="[object Error]",O3e="[object Function]",k3e="[object Map]",I3e="[object Number]",R3e="[object Object]",j3e="[object RegExp]",N3e="[object Set]",M3e="[object String]",D3e="[object WeakMap]",L3e="[object ArrayBuffer]",F3e="[object DataView]",z3e="[object Float32Array]",B3e="[object Float64Array]",$3e="[object Int8Array]",U3e="[object Int16Array]",V3e="[object Int32Array]",q3e="[object Uint8Array]",W3e="[object Uint8ClampedArray]",G3e="[object Uint16Array]",H3e="[object Uint32Array]",io={};io[z3e]=io[B3e]=io[$3e]=io[U3e]=io[V3e]=io[q3e]=io[W3e]=io[G3e]=io[H3e]=!0;io[E3e]=io[T3e]=io[L3e]=io[A3e]=io[F3e]=io[P3e]=io[C3e]=io[O3e]=io[k3e]=io[I3e]=io[R3e]=io[j3e]=io[N3e]=io[M3e]=io[D3e]=!1;function K3e(e){return S3e(e)&&w3e(e.length)&&!!io[b3e(e)]}var Z3e=K3e;function X3e(e){return function(t){return e(t)}}var Roe=X3e,HO={exports:{}};HO.exports;(function(e,t){var r=Bae,n=t&&!t.nodeType&&t,o=n&&!0&&e&&!e.nodeType&&e,l=o&&o.exports===n,d=l&&r.process,i=function(){try{var g=o&&o.require&&o.require("util").types;return g||d&&d.binding&&d.binding("util")}catch{}}();e.exports=i})(HO,HO.exports);var Y3e=HO.exports,J3e=Z3e,Q3e=Roe,xG=Y3e,bG=xG&&xG.isTypedArray,eFe=bG?Q3e(bG):J3e,joe=eFe,tFe=i3e,rFe=d5,nFe=Pc,iFe=Ioe,aFe=h5,oFe=joe,sFe=Object.prototype,lFe=sFe.hasOwnProperty;function cFe(e,t){var r=nFe(e),n=!r&&rFe(e),o=!r&&!n&&iFe(e),l=!r&&!n&&!o&&oFe(e),d=r||n||o||l,i=d?tFe(e.length,String):[],g=i.length;for(var _ in e)(t||lFe.call(e,_))&&!(d&&(_=="length"||o&&(_=="offset"||_=="parent")||l&&(_=="buffer"||_=="byteLength"||_=="byteOffset")||aFe(_,g)))&&i.push(_);return i}var uFe=cFe,dFe=Object.prototype;function hFe(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||dFe;return e===r}var fFe=hFe;function pFe(e,t){return function(r){return e(t(r))}}var Noe=pFe,mFe=Noe,gFe=mFe(Object.keys,Object),yFe=gFe,vFe=fFe,_Fe=yFe,xFe=Object.prototype,bFe=xFe.hasOwnProperty;function wFe(e){if(!vFe(e))return _Fe(e);var t=[];for(var r in Object(e))bFe.call(e,r)&&r!="constructor"&&t.push(r);return t}var SFe=wFe,EFe=K4,TFe=f5;function AFe(e){return e!=null&&TFe(e.length)&&!EFe(e)}var e2=AFe,PFe=uFe,CFe=SFe,OFe=e2;function kFe(e){return OFe(e)?PFe(e):CFe(e)}var pR=kFe,IFe=GLe,RFe=r3e,jFe=pR;function NFe(e){return IFe(e,jFe,RFe)}var MFe=NFe,wG=MFe,DFe=1,LFe=Object.prototype,FFe=LFe.hasOwnProperty;function zFe(e,t,r,n,o,l){var d=r&DFe,i=wG(e),g=i.length,_=wG(t),S=_.length;if(g!=S&&!d)return!1;for(var E=g;E--;){var T=i[E];if(!(d?T in t:FFe.call(t,T)))return!1}var C=l.get(e),N=l.get(t);if(C&&N)return C==t&&N==e;var I=!0;l.set(e,t),l.set(t,e);for(var j=d;++E<g;){T=i[E];var D=e[T],R=t[T];if(n)var F=d?n(R,D,T,t,e,l):n(D,R,T,e,t,l);if(!(F===void 0?D===R||o(D,R,r,n,l):F)){I=!1;break}j||(j=T=="constructor")}if(I&&!j){var B=e.constructor,U=t.constructor;B!=U&&"constructor"in e&&"constructor"in t&&!(typeof B=="function"&&B instanceof B&&typeof U=="function"&&U instanceof U)&&(I=!1)}return l.delete(e),l.delete(t),I}var BFe=zFe,$Fe=Nv,UFe=Mh,VFe=$Fe(UFe,"DataView"),qFe=VFe,WFe=Nv,GFe=Mh,HFe=WFe(GFe,"Promise"),KFe=HFe,ZFe=Nv,XFe=Mh,YFe=ZFe(XFe,"Set"),Moe=YFe,JFe=Nv,QFe=Mh,eze=JFe(QFe,"WeakMap"),tze=eze,eF=qFe,tF=X4,rF=KFe,nF=Moe,iF=tze,Doe=Hf,$b=Uae,SG="[object Map]",rze="[object Object]",EG="[object Promise]",TG="[object Set]",AG="[object WeakMap]",PG="[object DataView]",nze=$b(eF),ize=$b(tF),aze=$b(rF),oze=$b(nF),sze=$b(iF),Cy=Doe;(eF&&Cy(new eF(new ArrayBuffer(1)))!=PG||tF&&Cy(new tF)!=SG||rF&&Cy(rF.resolve())!=EG||nF&&Cy(new nF)!=TG||iF&&Cy(new iF)!=AG)&&(Cy=function(e){var t=Doe(e),r=t==rze?e.constructor:void 0,n=r?$b(r):"";if(n)switch(n){case nze:return PG;case ize:return SG;case aze:return EG;case oze:return TG;case sze:return AG}return t});var lze=Cy,oD=Eoe,cze=Coe,uze=$Le,dze=BFe,CG=lze,OG=Pc,kG=Ioe,hze=joe,fze=1,IG="[object Arguments]",RG="[object Array]",BP="[object Object]",pze=Object.prototype,jG=pze.hasOwnProperty;function mze(e,t,r,n,o,l){var d=OG(e),i=OG(t),g=d?RG:CG(e),_=i?RG:CG(t);g=g==IG?BP:g,_=_==IG?BP:_;var S=g==BP,E=_==BP,T=g==_;if(T&&kG(e)){if(!kG(t))return!1;d=!0,S=!1}if(T&&!S)return l||(l=new oD),d||hze(e)?cze(e,t,r,n,o,l):uze(e,t,g,r,n,o,l);if(!(r&fze)){var C=S&&jG.call(e,"__wrapped__"),N=E&&jG.call(t,"__wrapped__");if(C||N){var I=C?e.value():e,j=N?t.value():t;return l||(l=new oD),o(I,j,r,n,l)}}return T?(l||(l=new oD),dze(e,t,r,n,o,l)):!1}var gze=mze,yze=gze,NG=Kf;function Loe(e,t,r,n,o){return e===t?!0:e==null||t==null||!NG(e)&&!NG(t)?e!==e&&t!==t:yze(e,t,r,n,Loe,o)}var p5=Loe,vze=Eoe,_ze=p5,xze=1,bze=2;function wze(e,t,r,n){var o=r.length,l=o,d=!n;if(e==null)return!l;for(e=Object(e);o--;){var i=r[o];if(d&&i[2]?i[1]!==e[i[0]]:!(i[0]in e))return!1}for(;++o<l;){i=r[o];var g=i[0],_=e[g],S=i[1];if(d&&i[2]){if(_===void 0&&!(g in e))return!1}else{var E=new vze;if(n)var T=n(_,S,g,e,t,E);if(!(T===void 0?_ze(S,_,xze|bze,n,E):T))return!1}}return!0}var Sze=wze,Eze=ug;function Tze(e){return e===e&&!Eze(e)}var Foe=Tze,Aze=Foe,Pze=pR;function Cze(e){for(var t=Pze(e),r=t.length;r--;){var n=t[r],o=e[n];t[r]=[n,o,Aze(o)]}return t}var Oze=Cze;function kze(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var zoe=kze,Ize=Sze,Rze=Oze,jze=zoe;function Nze(e){var t=Rze(e);return t.length==1&&t[0][2]?jze(t[0][0],t[0][1]):function(r){return r===e||Ize(r,e,t)}}var Mze=Nze;function Dze(e,t){return e!=null&&t in Object(e)}var Lze=Dze,Fze=Hae,zze=d5,Bze=Pc,$ze=h5,Uze=f5,Vze=QI;function qze(e,t,r){t=Fze(t,e);for(var n=-1,o=t.length,l=!1;++n<o;){var d=Vze(t[n]);if(!(l=e!=null&&r(e,d)))break;e=e[d]}return l||++n!=o?l:(o=e==null?0:e.length,!!o&&Uze(o)&&$ze(d,o)&&(Bze(e)||zze(e)))}var Wze=qze,Gze=Lze,Hze=Wze;function Kze(e,t){return e!=null&&Hze(e,t,Gze)}var Zze=Kze,Xze=p5,Yze=Kae,Jze=Zze,Qze=H4,eBe=Foe,tBe=zoe,rBe=QI,nBe=1,iBe=2;function aBe(e,t){return Qze(e)&&eBe(t)?tBe(rBe(e),t):function(r){var n=Yze(r,e);return n===void 0&&n===t?Jze(r,e):Xze(t,n,nBe|iBe)}}var oBe=aBe;function sBe(e){return e}var Ub=sBe;function lBe(e){return function(t){return t==null?void 0:t[e]}}var cBe=lBe,uBe=e5;function dBe(e){return function(t){return uBe(t,e)}}var hBe=dBe,fBe=cBe,pBe=hBe,mBe=H4,gBe=QI;function yBe(e){return mBe(e)?fBe(gBe(e)):pBe(e)}var vBe=yBe,_Be=Mze,xBe=oBe,bBe=Ub,wBe=Pc,SBe=vBe;function EBe(e){return typeof e=="function"?e:e==null?bBe:typeof e=="object"?wBe(e)?xBe(e[0],e[1]):_Be(e):SBe(e)}var Dh=EBe;function TBe(e,t,r,n){for(var o=e.length,l=r+(n?1:-1);n?l--:++l<o;)if(t(e[l],l,e))return l;return-1}var Boe=TBe;function ABe(e){return e!==e}var PBe=ABe;function CBe(e,t,r){for(var n=r-1,o=e.length;++n<o;)if(e[n]===t)return n;return-1}var OBe=CBe,kBe=Boe,IBe=PBe,RBe=OBe;function jBe(e,t,r){return t===t?RBe(e,t,r):kBe(e,IBe,r)}var NBe=jBe,MBe=NBe;function DBe(e,t){var r=e==null?0:e.length;return!!r&&MBe(e,t,0)>-1}var LBe=DBe;function FBe(e,t,r){for(var n=-1,o=e==null?0:e.length;++n<o;)if(r(t,e[n]))return!0;return!1}var zBe=FBe;function BBe(){}var $Be=BBe,sD=Moe,UBe=$Be,VBe=u5,qBe=1/0,WBe=sD&&1/VBe(new sD([,-0]))[1]==qBe?function(e){return new sD(e)}:UBe,GBe=WBe,HBe=Toe,KBe=LBe,ZBe=zBe,XBe=Poe,YBe=GBe,JBe=u5,QBe=200;function e4e(e,t,r){var n=-1,o=KBe,l=e.length,d=!0,i=[],g=i;if(r)d=!1,o=ZBe;else if(l>=QBe){var _=t?null:YBe(e);if(_)return JBe(_);d=!1,o=XBe,g=new HBe}else g=t?[]:i;e:for(;++n<l;){var S=e[n],E=t?t(S):S;if(S=r||S!==0?S:0,d&&E===E){for(var T=g.length;T--;)if(g[T]===E)continue e;t&&g.push(E),i.push(S)}else o(g,E,r)||(g!==i&&g.push(E),i.push(S))}return i}var t4e=e4e,r4e=Dh,n4e=t4e;function i4e(e,t){return e&&e.length?n4e(e,r4e(t)):[]}var a4e=i4e;const MG=_a(a4e);function $oe(e,t,r){return t===!0?MG(e,r):li(t)?MG(e,t):e}function Z0(e){"@babel/helpers - typeof";return Z0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z0(e)}var o4e=["ref"];function DG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function uf(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?DG(Object(r),!0).forEach(function(n){mR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):DG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function s4e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function LG(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Voe(n.key),n)}}function l4e(e,t,r){return t&&LG(e.prototype,t),r&&LG(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function c4e(e,t,r){return t=KO(t),u4e(e,Uoe()?Reflect.construct(t,r||[],KO(e).constructor):t.apply(e,r))}function u4e(e,t){if(t&&(Z0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return d4e(e)}function d4e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Uoe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Uoe=function(){return!!e})()}function KO(e){return KO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},KO(e)}function h4e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&aF(e,t)}function aF(e,t){return aF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},aF(e,t)}function mR(e,t,r){return t=Voe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Voe(e){var t=f4e(e,"string");return Z0(t)=="symbol"?t:t+""}function f4e(e,t){if(Z0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Z0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function p4e(e,t){if(e==null)return{};var r=m4e(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function m4e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function g4e(e){return e.value}function y4e(e,t){if(He.isValidElement(e))return He.cloneElement(e,t);if(typeof e=="function")return He.createElement(e,t);t.ref;var r=p4e(t,o4e);return He.createElement(c5,r)}var FG=1,mh=function(e){function t(){var r;s4e(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return r=c4e(this,t,[].concat(o)),mR(r,"lastBoundingBox",{width:-1,height:-1}),r}return h4e(t,e),l4e(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();return n.height=this.wrapperNode.offsetHeight,n.width=this.wrapperNode.offsetWidth,n}return null}},{key:"updateBBox",value:function(){var n=this.props.onBBoxUpdate,o=this.getBBox();o?(Math.abs(o.width-this.lastBoundingBox.width)>FG||Math.abs(o.height-this.lastBoundingBox.height)>FG)&&(this.lastBoundingBox.width=o.width,this.lastBoundingBox.height=o.height,n&&n(o)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,n&&n(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?uf({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(n){var o=this.props,l=o.layout,d=o.align,i=o.verticalAlign,g=o.margin,_=o.chartWidth,S=o.chartHeight,E,T;if(!n||(n.left===void 0||n.left===null)&&(n.right===void 0||n.right===null))if(d==="center"&&l==="vertical"){var C=this.getBBoxSnapshot();E={left:((_||0)-C.width)/2}}else E=d==="right"?{right:g&&g.right||0}:{left:g&&g.left||0};if(!n||(n.top===void 0||n.top===null)&&(n.bottom===void 0||n.bottom===null))if(i==="middle"){var N=this.getBBoxSnapshot();T={top:((S||0)-N.height)/2}}else T=i==="bottom"?{bottom:g&&g.bottom||0}:{top:g&&g.top||0};return uf(uf({},E),T)}},{key:"render",value:function(){var n=this,o=this.props,l=o.content,d=o.width,i=o.height,g=o.wrapperStyle,_=o.payloadUniqBy,S=o.payload,E=uf(uf({position:"absolute",width:d||"auto",height:i||"auto"},this.getDefaultPosition(g)),g);return He.createElement("div",{className:"recharts-legend-wrapper",style:E,ref:function(C){n.wrapperNode=C}},y4e(l,uf(uf({},this.props),{},{payload:$oe(S,_,g4e)})))}}],[{key:"getWithHeight",value:function(n,o){var l=uf(uf({},this.defaultProps),n.props),d=l.layout;return d==="vertical"&&$r(n.props.height)?{height:n.props.height}:d==="horizontal"?{width:n.props.width||o}:null}}])}(W.PureComponent);mR(mh,"displayName","Legend");mR(mh,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var zG=JT,v4e=d5,_4e=Pc,BG=zG?zG.isConcatSpreadable:void 0;function x4e(e){return _4e(e)||v4e(e)||!!(BG&&e&&e[BG])}var b4e=x4e,w4e=Ooe,S4e=b4e;function qoe(e,t,r,n,o){var l=-1,d=e.length;for(r||(r=S4e),o||(o=[]);++l<d;){var i=e[l];t>0&&r(i)?t>1?qoe(i,t-1,r,n,o):w4e(o,i):n||(o[o.length]=i)}return o}var Woe=qoe;function E4e(e){return function(t,r,n){for(var o=-1,l=Object(t),d=n(t),i=d.length;i--;){var g=d[e?i:++o];if(r(l[g],g,l)===!1)break}return t}}var T4e=E4e,A4e=T4e,P4e=A4e(),C4e=P4e,O4e=C4e,k4e=pR;function I4e(e,t){return e&&O4e(e,t,k4e)}var Goe=I4e,R4e=e2;function j4e(e,t){return function(r,n){if(r==null)return r;if(!R4e(r))return e(r,n);for(var o=r.length,l=t?o:-1,d=Object(r);(t?l--:++l<o)&&n(d[l],l,d)!==!1;);return r}}var N4e=j4e,M4e=Goe,D4e=N4e,L4e=D4e(M4e),m5=L4e,F4e=m5,z4e=e2;function B4e(e,t){var r=-1,n=z4e(e)?Array(e.length):[];return F4e(e,function(o,l,d){n[++r]=t(o,l,d)}),n}var Hoe=B4e;function $4e(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}var U4e=$4e,$G=Nb;function V4e(e,t){if(e!==t){var r=e!==void 0,n=e===null,o=e===e,l=$G(e),d=t!==void 0,i=t===null,g=t===t,_=$G(t);if(!i&&!_&&!l&&e>t||l&&d&&g&&!i&&!_||n&&d&&g||!r&&g||!o)return 1;if(!n&&!l&&!_&&e<t||_&&r&&o&&!n&&!l||i&&r&&o||!d&&o||!g)return-1}return 0}var q4e=V4e,W4e=q4e;function G4e(e,t,r){for(var n=-1,o=e.criteria,l=t.criteria,d=o.length,i=r.length;++n<d;){var g=W4e(o[n],l[n]);if(g){if(n>=i)return g;var _=r[n];return g*(_=="desc"?-1:1)}}return e.index-t.index}var H4e=G4e,lD=Q4,K4e=e5,Z4e=Dh,X4e=Hoe,Y4e=U4e,J4e=Roe,Q4e=H4e,e5e=Ub,t5e=Pc;function r5e(e,t,r){t.length?t=lD(t,function(l){return t5e(l)?function(d){return K4e(d,l.length===1?l[0]:l)}:l}):t=[e5e];var n=-1;t=lD(t,J4e(Z4e));var o=X4e(e,function(l,d,i){var g=lD(t,function(_){return _(l)});return{criteria:g,index:++n,value:l}});return Y4e(o,function(l,d){return Q4e(l,d,r)})}var n5e=r5e;function i5e(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var a5e=i5e,o5e=a5e,UG=Math.max;function s5e(e,t,r){return t=UG(t===void 0?e.length-1:t,0),function(){for(var n=arguments,o=-1,l=UG(n.length-t,0),d=Array(l);++o<l;)d[o]=n[t+o];o=-1;for(var i=Array(t+1);++o<t;)i[o]=n[o];return i[t]=r(d),o5e(e,this,i)}}var l5e=s5e;function c5e(e){return function(){return e}}var u5e=c5e,d5e=Nv,h5e=function(){try{var e=d5e(Object,"defineProperty");return e({},"",{}),e}catch{}}(),Koe=h5e,f5e=u5e,VG=Koe,p5e=Ub,m5e=VG?function(e,t){return VG(e,"toString",{configurable:!0,enumerable:!1,value:f5e(t),writable:!0})}:p5e,g5e=m5e,y5e=800,v5e=16,_5e=Date.now;function x5e(e){var t=0,r=0;return function(){var n=_5e(),o=v5e-(n-r);if(r=n,o>0){if(++t>=y5e)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var b5e=x5e,w5e=g5e,S5e=b5e,E5e=S5e(w5e),T5e=E5e,A5e=Ub,P5e=l5e,C5e=T5e;function O5e(e,t){return C5e(P5e(e,t,A5e),e+"")}var k5e=O5e,I5e=Z4,R5e=e2,j5e=h5,N5e=ug;function M5e(e,t,r){if(!N5e(r))return!1;var n=typeof t;return(n=="number"?R5e(r)&&j5e(t,r.length):n=="string"&&t in r)?I5e(r[t],e):!1}var gR=M5e,D5e=Woe,L5e=n5e,F5e=k5e,qG=gR,z5e=F5e(function(e,t){if(e==null)return[];var r=t.length;return r>1&&qG(e,t[0],t[1])?t=[]:r>2&&qG(t[0],t[1],t[2])&&(t=[t[0]]),L5e(e,D5e(t,1),[])}),B5e=z5e;const g5=_a(B5e);function $E(e){"@babel/helpers - typeof";return $E=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$E(e)}function oF(){return oF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},oF.apply(this,arguments)}function $5e(e,t){return W5e(e)||q5e(e,t)||V5e(e,t)||U5e()}function U5e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function V5e(e,t){if(e){if(typeof e=="string")return WG(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return WG(e,t)}}function WG(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function q5e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,_=!1;try{if(l=(r=r.call(e)).next,t!==0)for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){_=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(_)throw o}}return i}}function W5e(e){if(Array.isArray(e))return e}function GG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function cD(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?GG(Object(r),!0).forEach(function(n){G5e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):GG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function G5e(e,t,r){return t=H5e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function H5e(e){var t=K5e(e,"string");return $E(t)=="symbol"?t:t+""}function K5e(e,t){if($E(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if($E(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Z5e(e){return Array.isArray(e)&&vs(e[0])&&vs(e[1])?e.join(" ~ "):e}var X5e=function(t){var r=t.separator,n=r===void 0?" : ":r,o=t.contentStyle,l=o===void 0?{}:o,d=t.itemStyle,i=d===void 0?{}:d,g=t.labelStyle,_=g===void 0?{}:g,S=t.payload,E=t.formatter,T=t.itemSorter,C=t.wrapperClassName,N=t.labelClassName,I=t.label,j=t.labelFormatter,D=t.accessibilityLayer,R=D===void 0?!1:D,F=function(){if(S&&S.length){var ee={padding:0,margin:0},oe=(T?g5(S,T):S).map(function(de,xe){if(de.type==="none")return null;var we=cD({display:"block",paddingTop:4,paddingBottom:4,color:de.color||"#000"},i),Ae=de.formatter||E||Z5e,Ce=de.value,me=de.name,Pe=Ce,ye=me;if(Ae&&Pe!=null&&ye!=null){var pe=Ae(Ce,me,de,xe,S);if(Array.isArray(pe)){var Ie=$5e(pe,2);Pe=Ie[0],ye=Ie[1]}else Pe=pe}return He.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(xe),style:we},vs(ye)?He.createElement("span",{className:"recharts-tooltip-item-name"},ye):null,vs(ye)?He.createElement("span",{className:"recharts-tooltip-item-separator"},n):null,He.createElement("span",{className:"recharts-tooltip-item-value"},Pe),He.createElement("span",{className:"recharts-tooltip-item-unit"},de.unit||""))});return He.createElement("ul",{className:"recharts-tooltip-item-list",style:ee},oe)}return null},B=cD({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},l),U=cD({margin:0},_),Z=!wi(I),J=Z?I:"",te=Ti("recharts-default-tooltip",C),ae=Ti("recharts-tooltip-label",N);Z&&j&&S!==void 0&&S!==null&&(J=j(I,S));var ne=R?{role:"status","aria-live":"assertive"}:{};return He.createElement("div",oF({className:te,style:B},ne),He.createElement("p",{className:ae,style:U},He.isValidElement(J)?J:"".concat(J)),F())};function UE(e){"@babel/helpers - typeof";return UE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},UE(e)}function $P(e,t,r){return t=Y5e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Y5e(e){var t=J5e(e,"string");return UE(t)=="symbol"?t:t+""}function J5e(e,t){if(UE(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(UE(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var pS="recharts-tooltip-wrapper",Q5e={visibility:"hidden"};function e$e(e){var t=e.coordinate,r=e.translateX,n=e.translateY;return Ti(pS,$P($P($P($P({},"".concat(pS,"-right"),$r(r)&&t&&$r(t.x)&&r>=t.x),"".concat(pS,"-left"),$r(r)&&t&&$r(t.x)&&r<t.x),"".concat(pS,"-bottom"),$r(n)&&t&&$r(t.y)&&n>=t.y),"".concat(pS,"-top"),$r(n)&&t&&$r(t.y)&&n<t.y))}function HG(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.key,o=e.offsetTopLeft,l=e.position,d=e.reverseDirection,i=e.tooltipDimension,g=e.viewBox,_=e.viewBoxDimension;if(l&&$r(l[n]))return l[n];var S=r[n]-i-o,E=r[n]+o;if(t[n])return d[n]?S:E;if(d[n]){var T=S,C=g[n];return T<C?Math.max(E,g[n]):Math.max(S,g[n])}var N=E+i,I=g[n]+_;return N>I?Math.max(S,g[n]):Math.max(E,g[n])}function t$e(e){var t=e.translateX,r=e.translateY,n=e.useTranslate3d;return{transform:n?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}function r$e(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.offsetTopLeft,o=e.position,l=e.reverseDirection,d=e.tooltipBox,i=e.useTranslate3d,g=e.viewBox,_,S,E;return d.height>0&&d.width>0&&r?(S=HG({allowEscapeViewBox:t,coordinate:r,key:"x",offsetTopLeft:n,position:o,reverseDirection:l,tooltipDimension:d.width,viewBox:g,viewBoxDimension:g.width}),E=HG({allowEscapeViewBox:t,coordinate:r,key:"y",offsetTopLeft:n,position:o,reverseDirection:l,tooltipDimension:d.height,viewBox:g,viewBoxDimension:g.height}),_=t$e({translateX:S,translateY:E,useTranslate3d:i})):_=Q5e,{cssProperties:_,cssClasses:e$e({translateX:S,translateY:E,coordinate:r})}}function X0(e){"@babel/helpers - typeof";return X0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},X0(e)}function KG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function ZG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?KG(Object(r),!0).forEach(function(n){lF(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):KG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function n$e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i$e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Xoe(n.key),n)}}function a$e(e,t,r){return t&&i$e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function o$e(e,t,r){return t=ZO(t),s$e(e,Zoe()?Reflect.construct(t,r||[],ZO(e).constructor):t.apply(e,r))}function s$e(e,t){if(t&&(X0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return l$e(e)}function l$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Zoe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Zoe=function(){return!!e})()}function ZO(e){return ZO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},ZO(e)}function c$e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&sF(e,t)}function sF(e,t){return sF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},sF(e,t)}function lF(e,t,r){return t=Xoe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Xoe(e){var t=u$e(e,"string");return X0(t)=="symbol"?t:t+""}function u$e(e,t){if(X0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(X0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var XG=1,d$e=function(e){function t(){var r;n$e(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return r=o$e(this,t,[].concat(o)),lF(r,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),lF(r,"handleKeyDown",function(d){if(d.key==="Escape"){var i,g,_,S;r.setState({dismissed:!0,dismissedAtCoordinate:{x:(i=(g=r.props.coordinate)===null||g===void 0?void 0:g.x)!==null&&i!==void 0?i:0,y:(_=(S=r.props.coordinate)===null||S===void 0?void 0:S.y)!==null&&_!==void 0?_:0}})}}),r}return c$e(t,e),a$e(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();(Math.abs(n.width-this.state.lastBoundingBox.width)>XG||Math.abs(n.height-this.state.lastBoundingBox.height)>XG)&&this.setState({lastBoundingBox:{width:n.width,height:n.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var n,o;this.props.active&&this.updateBBox(),this.state.dismissed&&(((n=this.props.coordinate)===null||n===void 0?void 0:n.x)!==this.state.dismissedAtCoordinate.x||((o=this.props.coordinate)===null||o===void 0?void 0:o.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var n=this,o=this.props,l=o.active,d=o.allowEscapeViewBox,i=o.animationDuration,g=o.animationEasing,_=o.children,S=o.coordinate,E=o.hasPayload,T=o.isAnimationActive,C=o.offset,N=o.position,I=o.reverseDirection,j=o.useTranslate3d,D=o.viewBox,R=o.wrapperStyle,F=r$e({allowEscapeViewBox:d,coordinate:S,offsetTopLeft:C,position:N,reverseDirection:I,tooltipBox:this.state.lastBoundingBox,useTranslate3d:j,viewBox:D}),B=F.cssClasses,U=F.cssProperties,Z=ZG(ZG({transition:T&&l?"transform ".concat(i,"ms ").concat(g):void 0},U),{},{pointerEvents:"none",visibility:!this.state.dismissed&&l&&E?"visible":"hidden",position:"absolute",top:0,left:0},R);return He.createElement("div",{tabIndex:-1,className:B,style:Z,ref:function(te){n.wrapperNode=te}},_)}}])}(W.PureComponent),h$e=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},Sh={isSsr:h$e(),get:function(t){return Sh[t]},set:function(t,r){if(typeof t=="string")Sh[t]=r;else{var n=Object.keys(t);n&&n.length&&n.forEach(function(o){Sh[o]=t[o]})}}};function Y0(e){"@babel/helpers - typeof";return Y0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y0(e)}function YG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function JG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?YG(Object(r),!0).forEach(function(n){y5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):YG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function f$e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p$e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Joe(n.key),n)}}function m$e(e,t,r){return t&&p$e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function g$e(e,t,r){return t=XO(t),y$e(e,Yoe()?Reflect.construct(t,r||[],XO(e).constructor):t.apply(e,r))}function y$e(e,t){if(t&&(Y0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return v$e(e)}function v$e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Yoe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Yoe=function(){return!!e})()}function XO(e){return XO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},XO(e)}function _$e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&cF(e,t)}function cF(e,t){return cF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},cF(e,t)}function y5(e,t,r){return t=Joe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Joe(e){var t=x$e(e,"string");return Y0(t)=="symbol"?t:t+""}function x$e(e,t){if(Y0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Y0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function b$e(e){return e.dataKey}function w$e(e,t){return He.isValidElement(e)?He.cloneElement(e,t):typeof e=="function"?He.createElement(e,t):He.createElement(X5e,t)}var qs=function(e){function t(){return f$e(this,t),g$e(this,t,arguments)}return _$e(t,e),m$e(t,[{key:"render",value:function(){var n=this,o=this.props,l=o.active,d=o.allowEscapeViewBox,i=o.animationDuration,g=o.animationEasing,_=o.content,S=o.coordinate,E=o.filterNull,T=o.isAnimationActive,C=o.offset,N=o.payload,I=o.payloadUniqBy,j=o.position,D=o.reverseDirection,R=o.useTranslate3d,F=o.viewBox,B=o.wrapperStyle,U=N??[];E&&U.length&&(U=$oe(N.filter(function(J){return J.value!=null&&(J.hide!==!0||n.props.includeHidden)}),I,b$e));var Z=U.length>0;return He.createElement(d$e,{allowEscapeViewBox:d,animationDuration:i,animationEasing:g,isAnimationActive:T,active:l,coordinate:S,hasPayload:Z,offset:C,position:j,reverseDirection:D,useTranslate3d:R,viewBox:F,wrapperStyle:B},w$e(_,JG(JG({},this.props),{},{payload:U})))}}])}(W.PureComponent);y5(qs,"displayName","Tooltip");y5(qs,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!Sh.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var S$e=Mh,E$e=function(){return S$e.Date.now()},T$e=E$e,A$e=/\s/;function P$e(e){for(var t=e.length;t--&&A$e.test(e.charAt(t)););return t}var C$e=P$e,O$e=C$e,k$e=/^\s+/;function I$e(e){return e&&e.slice(0,O$e(e)+1).replace(k$e,"")}var R$e=I$e,j$e=R$e,QG=ug,N$e=Nb,eH=NaN,M$e=/^[-+]0x[0-9a-f]+$/i,D$e=/^0b[01]+$/i,L$e=/^0o[0-7]+$/i,F$e=parseInt;function z$e(e){if(typeof e=="number")return e;if(N$e(e))return eH;if(QG(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=QG(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=j$e(e);var r=D$e.test(e);return r||L$e.test(e)?F$e(e.slice(2),r?2:8):M$e.test(e)?eH:+e}var Qoe=z$e,B$e=ug,uD=T$e,tH=Qoe,$$e="Expected a function",U$e=Math.max,V$e=Math.min;function q$e(e,t,r){var n,o,l,d,i,g,_=0,S=!1,E=!1,T=!0;if(typeof e!="function")throw new TypeError($$e);t=tH(t)||0,B$e(r)&&(S=!!r.leading,E="maxWait"in r,l=E?U$e(tH(r.maxWait)||0,t):l,T="trailing"in r?!!r.trailing:T);function C(Z){var J=n,te=o;return n=o=void 0,_=Z,d=e.apply(te,J),d}function N(Z){return _=Z,i=setTimeout(D,t),S?C(Z):d}function I(Z){var J=Z-g,te=Z-_,ae=t-J;return E?V$e(ae,l-te):ae}function j(Z){var J=Z-g,te=Z-_;return g===void 0||J>=t||J<0||E&&te>=l}function D(){var Z=uD();if(j(Z))return R(Z);i=setTimeout(D,I(Z))}function R(Z){return i=void 0,T&&n?C(Z):(n=o=void 0,d)}function F(){i!==void 0&&clearTimeout(i),_=0,n=g=o=i=void 0}function B(){return i===void 0?d:R(uD())}function U(){var Z=uD(),J=j(Z);if(n=arguments,o=this,g=Z,J){if(i===void 0)return N(g);if(E)return clearTimeout(i),i=setTimeout(D,t),C(g)}return i===void 0&&(i=setTimeout(D,t)),d}return U.cancel=F,U.flush=B,U}var W$e=q$e,G$e=W$e,H$e=ug,K$e="Expected a function";function Z$e(e,t,r){var n=!0,o=!0;if(typeof e!="function")throw new TypeError(K$e);return H$e(r)&&(n="leading"in r?!!r.leading:n,o="trailing"in r?!!r.trailing:o),G$e(e,t,{leading:n,maxWait:t,trailing:o})}var X$e=Z$e;const ese=_a(X$e);function VE(e){"@babel/helpers - typeof";return VE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},VE(e)}function rH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function UP(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rH(Object(r),!0).forEach(function(n){Y$e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Y$e(e,t,r){return t=J$e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function J$e(e){var t=Q$e(e,"string");return VE(t)=="symbol"?t:t+""}function Q$e(e,t){if(VE(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(VE(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function eUe(e,t){return iUe(e)||nUe(e,t)||rUe(e,t)||tUe()}function tUe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rUe(e,t){if(e){if(typeof e=="string")return nH(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return nH(e,t)}}function nH(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function nUe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,_=!1;try{if(l=(r=r.call(e)).next,t!==0)for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){_=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(_)throw o}}return i}}function iUe(e){if(Array.isArray(e))return e}var Tm=W.forwardRef(function(e,t){var r=e.aspect,n=e.initialDimension,o=n===void 0?{width:-1,height:-1}:n,l=e.width,d=l===void 0?"100%":l,i=e.height,g=i===void 0?"100%":i,_=e.minWidth,S=_===void 0?0:_,E=e.minHeight,T=e.maxHeight,C=e.children,N=e.debounce,I=N===void 0?0:N,j=e.id,D=e.className,R=e.onResize,F=e.style,B=F===void 0?{}:F,U=W.useRef(null),Z=W.useRef();Z.current=R,W.useImperativeHandle(t,function(){return Object.defineProperty(U.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),U.current},configurable:!0})});var J=W.useState({containerWidth:o.width,containerHeight:o.height}),te=eUe(J,2),ae=te[0],ne=te[1],ie=W.useCallback(function(oe,de){ne(function(xe){var we=Math.round(oe),Ae=Math.round(de);return xe.containerWidth===we&&xe.containerHeight===Ae?xe:{containerWidth:we,containerHeight:Ae}})},[]);W.useEffect(function(){var oe=function(me){var Pe,ye=me[0].contentRect,pe=ye.width,Ie=ye.height;ie(pe,Ie),(Pe=Z.current)===null||Pe===void 0||Pe.call(Z,pe,Ie)};I>0&&(oe=ese(oe,I,{trailing:!0,leading:!1}));var de=new ResizeObserver(oe),xe=U.current.getBoundingClientRect(),we=xe.width,Ae=xe.height;return ie(we,Ae),de.observe(U.current),function(){de.disconnect()}},[ie,I]);var ee=W.useMemo(function(){var oe=ae.containerWidth,de=ae.containerHeight;if(oe<0||de<0)return null;Ed(Fy(d)||Fy(g),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,d,g),Ed(!r||r>0,"The aspect(%s) must be greater than zero.",r);var xe=Fy(d)?oe:d,we=Fy(g)?de:g;r&&r>0&&(xe?we=xe/r:we&&(xe=we*r),T&&we>T&&(we=T)),Ed(xe>0||we>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,xe,we,d,g,S,E,r);var Ae=!Array.isArray(C)&&Cf(C.type).endsWith("Chart");return He.Children.map(C,function(Ce){return He.isValidElement(Ce)?W.cloneElement(Ce,UP({width:xe,height:we},Ae?{style:UP({height:"100%",width:"100%",maxHeight:we,maxWidth:xe},Ce.props.style)}:{})):Ce})},[r,C,g,T,E,S,ae,d]);return He.createElement("div",{id:j?"".concat(j):void 0,className:Ti("recharts-responsive-container",D),style:UP(UP({},B),{},{width:d,height:g,minWidth:S,minHeight:E,maxHeight:T}),ref:U},ee)}),qE=function(t){return null};qE.displayName="Cell";function WE(e){"@babel/helpers - typeof";return WE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},WE(e)}function iH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function uF(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?iH(Object(r),!0).forEach(function(n){aUe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function aUe(e,t,r){return t=oUe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function oUe(e){var t=sUe(e,"string");return WE(t)=="symbol"?t:t+""}function sUe(e,t){if(WE(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(WE(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Sx={widthCache:{},cacheCount:0},lUe=2e3,cUe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},aH="recharts_measurement_span";function uUe(e){var t=uF({},e);return Object.keys(t).forEach(function(r){t[r]||delete t[r]}),t}var QS=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||Sh.isSsr)return{width:0,height:0};var n=uUe(r),o=JSON.stringify({text:t,copyStyle:n});if(Sx.widthCache[o])return Sx.widthCache[o];try{var l=document.getElementById(aH);l||(l=document.createElement("span"),l.setAttribute("id",aH),l.setAttribute("aria-hidden","true"),document.body.appendChild(l));var d=uF(uF({},cUe),n);Object.assign(l.style,d),l.textContent="".concat(t);var i=l.getBoundingClientRect(),g={width:i.width,height:i.height};return Sx.widthCache[o]=g,++Sx.cacheCount>lUe&&(Sx.cacheCount=0,Sx.widthCache={}),g}catch{return{width:0,height:0}}},dUe=function(t){return{top:t.top+window.scrollY-document.documentElement.clientTop,left:t.left+window.scrollX-document.documentElement.clientLeft}};function GE(e){"@babel/helpers - typeof";return GE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},GE(e)}function YO(e,t){return mUe(e)||pUe(e,t)||fUe(e,t)||hUe()}function hUe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fUe(e,t){if(e){if(typeof e=="string")return oH(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return oH(e,t)}}function oH(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function pUe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,_=!1;try{if(l=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;g=!1}else for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){_=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(_)throw o}}return i}}function mUe(e){if(Array.isArray(e))return e}function gUe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function sH(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,vUe(n.key),n)}}function yUe(e,t,r){return t&&sH(e.prototype,t),r&&sH(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function vUe(e){var t=_Ue(e,"string");return GE(t)=="symbol"?t:t+""}function _Ue(e,t){if(GE(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(GE(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var lH=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,cH=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,xUe=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,bUe=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,tse={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},wUe=Object.keys(tse),Ux="NaN";function SUe(e,t){return e*tse[t]}var VP=function(){function e(t,r){gUe(this,e),this.num=t,this.unit=r,this.num=t,this.unit=r,Number.isNaN(t)&&(this.unit=""),r!==""&&!xUe.test(r)&&(this.num=NaN,this.unit=""),wUe.includes(r)&&(this.num=SUe(t,r),this.unit="px")}return yUe(e,[{key:"add",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num+r.num,this.unit)}},{key:"subtract",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num-r.num,this.unit)}},{key:"multiply",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num*r.num,this.unit||r.unit)}},{key:"divide",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num/r.num,this.unit||r.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(r){var n,o=(n=bUe.exec(r))!==null&&n!==void 0?n:[],l=YO(o,3),d=l[1],i=l[2];return new e(parseFloat(d),i??"")}}])}();function rse(e){if(e.includes(Ux))return Ux;for(var t=e;t.includes("*")||t.includes("/");){var r,n=(r=lH.exec(t))!==null&&r!==void 0?r:[],o=YO(n,4),l=o[1],d=o[2],i=o[3],g=VP.parse(l??""),_=VP.parse(i??""),S=d==="*"?g.multiply(_):g.divide(_);if(S.isNaN())return Ux;t=t.replace(lH,S.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var E,T=(E=cH.exec(t))!==null&&E!==void 0?E:[],C=YO(T,4),N=C[1],I=C[2],j=C[3],D=VP.parse(N??""),R=VP.parse(j??""),F=I==="+"?D.add(R):D.subtract(R);if(F.isNaN())return Ux;t=t.replace(cH,F.toString())}return t}var uH=/\(([^()]*)\)/;function EUe(e){for(var t=e;t.includes("(");){var r=uH.exec(t),n=YO(r,2),o=n[1];t=t.replace(uH,rse(o))}return t}function TUe(e){var t=e.replace(/\s+/g,"");return t=EUe(t),t=rse(t),t}function AUe(e){try{return TUe(e)}catch{return Ux}}function dD(e){var t=AUe(e.slice(5,-1));return t===Ux?"":t}var PUe=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],CUe=["dx","dy","angle","className","breakAll"];function dF(){return dF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},dF.apply(this,arguments)}function dH(e,t){if(e==null)return{};var r=OUe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function OUe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function hH(e,t){return jUe(e)||RUe(e,t)||IUe(e,t)||kUe()}function kUe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function IUe(e,t){if(e){if(typeof e=="string")return fH(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fH(e,t)}}function fH(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function RUe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,_=!1;try{if(l=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;g=!1}else for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){_=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(_)throw o}}return i}}function jUe(e){if(Array.isArray(e))return e}var nse=/[ \f\n\r\t\v\u2028\u2029]+/,ise=function(t){var r=t.children,n=t.breakAll,o=t.style;try{var l=[];wi(r)||(n?l=r.toString().split(""):l=r.toString().split(nse));var d=l.map(function(g){return{word:g,width:QS(g,o).width}}),i=n?0:QS("",o).width;return{wordsWithComputedWidth:d,spaceWidth:i}}catch{return null}},NUe=function(t,r,n,o,l){var d=t.maxLines,i=t.children,g=t.style,_=t.breakAll,S=$r(d),E=i,T=function(){var xe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return xe.reduce(function(we,Ae){var Ce=Ae.word,me=Ae.width,Pe=we[we.length-1];if(Pe&&(o==null||l||Pe.width+me+n<Number(o)))Pe.words.push(Ce),Pe.width+=me+n;else{var ye={words:[Ce],width:me};we.push(ye)}return we},[])},C=T(r),N=function(xe){return xe.reduce(function(we,Ae){return we.width>Ae.width?we:Ae})};if(!S)return C;for(var I="",j=function(xe){var we=E.slice(0,xe),Ae=ise({breakAll:_,style:g,children:we+I}).wordsWithComputedWidth,Ce=T(Ae),me=Ce.length>d||N(Ce).width>Number(o);return[me,Ce]},D=0,R=E.length-1,F=0,B;D<=R&&F<=E.length-1;){var U=Math.floor((D+R)/2),Z=U-1,J=j(Z),te=hH(J,2),ae=te[0],ne=te[1],ie=j(U),ee=hH(ie,1),oe=ee[0];if(!ae&&!oe&&(D=U+1),ae&&oe&&(R=U-1),!ae&&oe){B=ne;break}F++}return B||C},pH=function(t){var r=wi(t)?[]:t.toString().split(nse);return[{words:r}]},MUe=function(t){var r=t.width,n=t.scaleToFit,o=t.children,l=t.style,d=t.breakAll,i=t.maxLines;if((r||n)&&!Sh.isSsr){var g,_,S=ise({breakAll:d,children:o,style:l});if(S){var E=S.wordsWithComputedWidth,T=S.spaceWidth;g=E,_=T}else return pH(o);return NUe({breakAll:d,children:o,maxLines:i,style:l},g,_,r,n)}return pH(o)},mH="#808080",xv=function(t){var r=t.x,n=r===void 0?0:r,o=t.y,l=o===void 0?0:o,d=t.lineHeight,i=d===void 0?"1em":d,g=t.capHeight,_=g===void 0?"0.71em":g,S=t.scaleToFit,E=S===void 0?!1:S,T=t.textAnchor,C=T===void 0?"start":T,N=t.verticalAnchor,I=N===void 0?"end":N,j=t.fill,D=j===void 0?mH:j,R=dH(t,PUe),F=W.useMemo(function(){return MUe({breakAll:R.breakAll,children:R.children,maxLines:R.maxLines,scaleToFit:E,style:R.style,width:R.width})},[R.breakAll,R.children,R.maxLines,E,R.style,R.width]),B=R.dx,U=R.dy,Z=R.angle,J=R.className,te=R.breakAll,ae=dH(R,CUe);if(!vs(n)||!vs(l))return null;var ne=n+($r(B)?B:0),ie=l+($r(U)?U:0),ee;switch(I){case"start":ee=dD("calc(".concat(_,")"));break;case"middle":ee=dD("calc(".concat((F.length-1)/2," * -").concat(i," + (").concat(_," / 2))"));break;default:ee=dD("calc(".concat(F.length-1," * -").concat(i,")"));break}var oe=[];if(E){var de=F[0].width,xe=R.width;oe.push("scale(".concat(($r(xe)?xe/de:1)/de,")"))}return Z&&oe.push("rotate(".concat(Z,", ").concat(ne,", ").concat(ie,")")),oe.length&&(ae.transform=oe.join(" ")),He.createElement("text",dF({},Gn(ae,!0),{x:ne,y:ie,className:Ti("recharts-text",J),textAnchor:C,fill:D.includes("url")?mH:D}),F.map(function(we,Ae){var Ce=we.words.join(te?"":" ");return He.createElement("tspan",{x:ne,dy:Ae===0?ee:i,key:"".concat(Ce,"-").concat(Ae)},Ce)}))};function Bm(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function DUe(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function v5(e){let t,r,n;e.length!==2?(t=Bm,r=(i,g)=>Bm(e(i),g),n=(i,g)=>e(i)-g):(t=e===Bm||e===DUe?e:LUe,r=e,n=e);function o(i,g,_=0,S=i.length){if(_<S){if(t(g,g)!==0)return S;do{const E=_+S>>>1;r(i[E],g)<0?_=E+1:S=E}while(_<S)}return _}function l(i,g,_=0,S=i.length){if(_<S){if(t(g,g)!==0)return S;do{const E=_+S>>>1;r(i[E],g)<=0?_=E+1:S=E}while(_<S)}return _}function d(i,g,_=0,S=i.length){const E=o(i,g,_,S-1);return E>_&&n(i[E-1],g)>-n(i[E],g)?E-1:E}return{left:o,center:d,right:l}}function LUe(){return 0}function ase(e){return e===null?NaN:+e}function*FUe(e,t){for(let r of e)r!=null&&(r=+r)>=r&&(yield r)}const zUe=v5(Bm),t2=zUe.right;v5(ase).center;class gH extends Map{constructor(t,r=UUe){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const[n,o]of t)this.set(n,o)}get(t){return super.get(yH(this,t))}has(t){return super.has(yH(this,t))}set(t,r){return super.set(BUe(this,t),r)}delete(t){return super.delete($Ue(this,t))}}function yH({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):r}function BUe({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function $Ue({_intern:e,_key:t},r){const n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function UUe(e){return e!==null&&typeof e=="object"?e.valueOf():e}function VUe(e=Bm){if(e===Bm)return ose;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{const n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function ose(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const qUe=Math.sqrt(50),WUe=Math.sqrt(10),GUe=Math.sqrt(2);function JO(e,t,r){const n=(t-e)/Math.max(0,r),o=Math.floor(Math.log10(n)),l=n/Math.pow(10,o),d=l>=qUe?10:l>=WUe?5:l>=GUe?2:1;let i,g,_;return o<0?(_=Math.pow(10,-o)/d,i=Math.round(e*_),g=Math.round(t*_),i/_<e&&++i,g/_>t&&--g,_=-_):(_=Math.pow(10,o)*d,i=Math.round(e/_),g=Math.round(t/_),i*_<e&&++i,g*_>t&&--g),g<i&&.5<=r&&r<2?JO(e,t,r*2):[i,g,_]}function hF(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];const n=t<e,[o,l,d]=n?JO(t,e,r):JO(e,t,r);if(!(l>=o))return[];const i=l-o+1,g=new Array(i);if(n)if(d<0)for(let _=0;_<i;++_)g[_]=(l-_)/-d;else for(let _=0;_<i;++_)g[_]=(l-_)*d;else if(d<0)for(let _=0;_<i;++_)g[_]=(o+_)/-d;else for(let _=0;_<i;++_)g[_]=(o+_)*d;return g}function fF(e,t,r){return t=+t,e=+e,r=+r,JO(e,t,r)[2]}function pF(e,t,r){t=+t,e=+e,r=+r;const n=t<e,o=n?fF(t,e,r):fF(e,t,r);return(n?-1:1)*(o<0?1/-o:o)}function vH(e,t){let r;for(const n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);return r}function _H(e,t){let r;for(const n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);return r}function sse(e,t,r=0,n=1/0,o){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(o=o===void 0?ose:VUe(o);n>r;){if(n-r>600){const g=n-r+1,_=t-r+1,S=Math.log(g),E=.5*Math.exp(2*S/3),T=.5*Math.sqrt(S*E*(g-E)/g)*(_-g/2<0?-1:1),C=Math.max(r,Math.floor(t-_*E/g+T)),N=Math.min(n,Math.floor(t+(g-_)*E/g+T));sse(e,t,C,N,o)}const l=e[t];let d=r,i=n;for(mS(e,r,t),o(e[n],l)>0&&mS(e,r,n);d<i;){for(mS(e,d,i),++d,--i;o(e[d],l)<0;)++d;for(;o(e[i],l)>0;)--i}o(e[r],l)===0?mS(e,r,i):(++i,mS(e,i,n)),i<=t&&(r=i+1),t<=i&&(n=i-1)}return e}function mS(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function HUe(e,t,r){if(e=Float64Array.from(FUe(e)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return _H(e);if(t>=1)return vH(e);var n,o=(n-1)*t,l=Math.floor(o),d=vH(sse(e,l).subarray(0,l+1)),i=_H(e.subarray(l+1));return d+(i-d)*(o-l)}}function KUe(e,t,r=ase){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,o=(n-1)*t,l=Math.floor(o),d=+r(e[l],l,e),i=+r(e[l+1],l+1,e);return d+(i-d)*(o-l)}}function ZUe(e,t,r){e=+e,t=+t,r=(o=arguments.length)<2?(t=e,e=0,1):o<3?1:+r;for(var n=-1,o=Math.max(0,Math.ceil((t-e)/r))|0,l=new Array(o);++n<o;)l[n]=e+n*r;return l}function Fu(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Zf(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const mF=Symbol("implicit");function _5(){var e=new gH,t=[],r=[],n=mF;function o(l){let d=e.get(l);if(d===void 0){if(n!==mF)return n;e.set(l,d=t.push(l)-1)}return r[d%r.length]}return o.domain=function(l){if(!arguments.length)return t.slice();t=[],e=new gH;for(const d of l)e.has(d)||e.set(d,t.push(d)-1);return o},o.range=function(l){return arguments.length?(r=Array.from(l),o):r.slice()},o.unknown=function(l){return arguments.length?(n=l,o):n},o.copy=function(){return _5(t,r).unknown(n)},Fu.apply(o,arguments),o}function HE(){var e=_5().unknown(void 0),t=e.domain,r=e.range,n=0,o=1,l,d,i=!1,g=0,_=0,S=.5;delete e.unknown;function E(){var T=t().length,C=o<n,N=C?o:n,I=C?n:o;l=(I-N)/Math.max(1,T-g+_*2),i&&(l=Math.floor(l)),N+=(I-N-l*(T-g))*S,d=l*(1-g),i&&(N=Math.round(N),d=Math.round(d));var j=ZUe(T).map(function(D){return N+l*D});return r(C?j.reverse():j)}return e.domain=function(T){return arguments.length?(t(T),E()):t()},e.range=function(T){return arguments.length?([n,o]=T,n=+n,o=+o,E()):[n,o]},e.rangeRound=function(T){return[n,o]=T,n=+n,o=+o,i=!0,E()},e.bandwidth=function(){return d},e.step=function(){return l},e.round=function(T){return arguments.length?(i=!!T,E()):i},e.padding=function(T){return arguments.length?(g=Math.min(1,_=+T),E()):g},e.paddingInner=function(T){return arguments.length?(g=Math.min(1,T),E()):g},e.paddingOuter=function(T){return arguments.length?(_=+T,E()):_},e.align=function(T){return arguments.length?(S=Math.max(0,Math.min(1,T)),E()):S},e.copy=function(){return HE(t(),[n,o]).round(i).paddingInner(g).paddingOuter(_).align(S)},Fu.apply(E(),arguments)}function lse(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return lse(t())},e}function eE(){return lse(HE.apply(null,arguments).paddingInner(1))}function x5(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function cse(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function r2(){}var KE=.7,QO=1/KE,s0="\\s*([+-]?\\d+)\\s*",ZE="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Eh="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",XUe=/^#([0-9a-f]{3,8})$/,YUe=new RegExp(`^rgb\\(${s0},${s0},${s0}\\)$`),JUe=new RegExp(`^rgb\\(${Eh},${Eh},${Eh}\\)$`),QUe=new RegExp(`^rgba\\(${s0},${s0},${s0},${ZE}\\)$`),eVe=new RegExp(`^rgba\\(${Eh},${Eh},${Eh},${ZE}\\)$`),tVe=new RegExp(`^hsl\\(${ZE},${Eh},${Eh}\\)$`),rVe=new RegExp(`^hsla\\(${ZE},${Eh},${Eh},${ZE}\\)$`),xH={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};x5(r2,XE,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:bH,formatHex:bH,formatHex8:nVe,formatHsl:iVe,formatRgb:wH,toString:wH});function bH(){return this.rgb().formatHex()}function nVe(){return this.rgb().formatHex8()}function iVe(){return use(this).formatHsl()}function wH(){return this.rgb().formatRgb()}function XE(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=XUe.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?SH(t):r===3?new _c(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?qP(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?qP(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=YUe.exec(e))?new _c(t[1],t[2],t[3],1):(t=JUe.exec(e))?new _c(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=QUe.exec(e))?qP(t[1],t[2],t[3],t[4]):(t=eVe.exec(e))?qP(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=tVe.exec(e))?AH(t[1],t[2]/100,t[3]/100,1):(t=rVe.exec(e))?AH(t[1],t[2]/100,t[3]/100,t[4]):xH.hasOwnProperty(e)?SH(xH[e]):e==="transparent"?new _c(NaN,NaN,NaN,0):null}function SH(e){return new _c(e>>16&255,e>>8&255,e&255,1)}function qP(e,t,r,n){return n<=0&&(e=t=r=NaN),new _c(e,t,r,n)}function aVe(e){return e instanceof r2||(e=XE(e)),e?(e=e.rgb(),new _c(e.r,e.g,e.b,e.opacity)):new _c}function gF(e,t,r,n){return arguments.length===1?aVe(e):new _c(e,t,r,n??1)}function _c(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}x5(_c,gF,cse(r2,{brighter(e){return e=e==null?QO:Math.pow(QO,e),new _c(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?KE:Math.pow(KE,e),new _c(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new _c(tv(this.r),tv(this.g),tv(this.b),ek(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:EH,formatHex:EH,formatHex8:oVe,formatRgb:TH,toString:TH}));function EH(){return`#${zy(this.r)}${zy(this.g)}${zy(this.b)}`}function oVe(){return`#${zy(this.r)}${zy(this.g)}${zy(this.b)}${zy((isNaN(this.opacity)?1:this.opacity)*255)}`}function TH(){const e=ek(this.opacity);return`${e===1?"rgb(":"rgba("}${tv(this.r)}, ${tv(this.g)}, ${tv(this.b)}${e===1?")":`, ${e})`}`}function ek(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function tv(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function zy(e){return e=tv(e),(e<16?"0":"")+e.toString(16)}function AH(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new _d(e,t,r,n)}function use(e){if(e instanceof _d)return new _d(e.h,e.s,e.l,e.opacity);if(e instanceof r2||(e=XE(e)),!e)return new _d;if(e instanceof _d)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,o=Math.min(t,r,n),l=Math.max(t,r,n),d=NaN,i=l-o,g=(l+o)/2;return i?(t===l?d=(r-n)/i+(r<n)*6:r===l?d=(n-t)/i+2:d=(t-r)/i+4,i/=g<.5?l+o:2-l-o,d*=60):i=g>0&&g<1?0:d,new _d(d,i,g,e.opacity)}function sVe(e,t,r,n){return arguments.length===1?use(e):new _d(e,t,r,n??1)}function _d(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}x5(_d,sVe,cse(r2,{brighter(e){return e=e==null?QO:Math.pow(QO,e),new _d(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?KE:Math.pow(KE,e),new _d(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,o=2*r-n;return new _c(hD(e>=240?e-240:e+120,o,n),hD(e,o,n),hD(e<120?e+240:e-120,o,n),this.opacity)},clamp(){return new _d(PH(this.h),WP(this.s),WP(this.l),ek(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=ek(this.opacity);return`${e===1?"hsl(":"hsla("}${PH(this.h)}, ${WP(this.s)*100}%, ${WP(this.l)*100}%${e===1?")":`, ${e})`}`}}));function PH(e){return e=(e||0)%360,e<0?e+360:e}function WP(e){return Math.max(0,Math.min(1,e||0))}function hD(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const b5=e=>()=>e;function lVe(e,t){return function(r){return e+r*t}}function cVe(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function uVe(e){return(e=+e)==1?dse:function(t,r){return r-t?cVe(t,r,e):b5(isNaN(t)?r:t)}}function dse(e,t){var r=t-e;return r?lVe(e,r):b5(isNaN(e)?t:e)}const CH=function e(t){var r=uVe(t);function n(o,l){var d=r((o=gF(o)).r,(l=gF(l)).r),i=r(o.g,l.g),g=r(o.b,l.b),_=dse(o.opacity,l.opacity);return function(S){return o.r=d(S),o.g=i(S),o.b=g(S),o.opacity=_(S),o+""}}return n.gamma=e,n}(1);function dVe(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),o;return function(l){for(o=0;o<r;++o)n[o]=e[o]*(1-l)+t[o]*l;return n}}function hVe(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function fVe(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,o=new Array(n),l=new Array(r),d;for(d=0;d<n;++d)o[d]=Vb(e[d],t[d]);for(;d<r;++d)l[d]=t[d];return function(i){for(d=0;d<n;++d)l[d]=o[d](i);return l}}function pVe(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function tk(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function mVe(e,t){var r={},n={},o;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(o in t)o in e?r[o]=Vb(e[o],t[o]):n[o]=t[o];return function(l){for(o in r)n[o]=r[o](l);return n}}var yF=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,fD=new RegExp(yF.source,"g");function gVe(e){return function(){return e}}function yVe(e){return function(t){return e(t)+""}}function vVe(e,t){var r=yF.lastIndex=fD.lastIndex=0,n,o,l,d=-1,i=[],g=[];for(e=e+"",t=t+"";(n=yF.exec(e))&&(o=fD.exec(t));)(l=o.index)>r&&(l=t.slice(r,l),i[d]?i[d]+=l:i[++d]=l),(n=n[0])===(o=o[0])?i[d]?i[d]+=o:i[++d]=o:(i[++d]=null,g.push({i:d,x:tk(n,o)})),r=fD.lastIndex;return r<t.length&&(l=t.slice(r),i[d]?i[d]+=l:i[++d]=l),i.length<2?g[0]?yVe(g[0].x):gVe(t):(t=g.length,function(_){for(var S=0,E;S<t;++S)i[(E=g[S]).i]=E.x(_);return i.join("")})}function Vb(e,t){var r=typeof t,n;return t==null||r==="boolean"?b5(t):(r==="number"?tk:r==="string"?(n=XE(t))?(t=n,CH):vVe:t instanceof XE?CH:t instanceof Date?pVe:hVe(t)?dVe:Array.isArray(t)?fVe:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?mVe:tk)(e,t)}function w5(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function _Ve(e,t){t===void 0&&(t=e,e=Vb);for(var r=0,n=t.length-1,o=t[0],l=new Array(n<0?0:n);r<n;)l[r]=e(o,o=t[++r]);return function(d){var i=Math.max(0,Math.min(n-1,Math.floor(d*=n)));return l[i](d-i)}}function xVe(e){return function(){return e}}function rk(e){return+e}var OH=[0,1];function Gl(e){return e}function vF(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:xVe(isNaN(t)?NaN:.5)}function bVe(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function wVe(e,t,r){var n=e[0],o=e[1],l=t[0],d=t[1];return o<n?(n=vF(o,n),l=r(d,l)):(n=vF(n,o),l=r(l,d)),function(i){return l(n(i))}}function SVe(e,t,r){var n=Math.min(e.length,t.length)-1,o=new Array(n),l=new Array(n),d=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++d<n;)o[d]=vF(e[d],e[d+1]),l[d]=r(t[d],t[d+1]);return function(i){var g=t2(e,i,1,n)-1;return l[g](o[g](i))}}function n2(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function yR(){var e=OH,t=OH,r=Vb,n,o,l,d=Gl,i,g,_;function S(){var T=Math.min(e.length,t.length);return d!==Gl&&(d=bVe(e[0],e[T-1])),i=T>2?SVe:wVe,g=_=null,E}function E(T){return T==null||isNaN(T=+T)?l:(g||(g=i(e.map(n),t,r)))(n(d(T)))}return E.invert=function(T){return d(o((_||(_=i(t,e.map(n),tk)))(T)))},E.domain=function(T){return arguments.length?(e=Array.from(T,rk),S()):e.slice()},E.range=function(T){return arguments.length?(t=Array.from(T),S()):t.slice()},E.rangeRound=function(T){return t=Array.from(T),r=w5,S()},E.clamp=function(T){return arguments.length?(d=T?!0:Gl,S()):d!==Gl},E.interpolate=function(T){return arguments.length?(r=T,S()):r},E.unknown=function(T){return arguments.length?(l=T,E):l},function(T,C){return n=T,o=C,S()}}function S5(){return yR()(Gl,Gl)}function EVe(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function nk(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function J0(e){return e=nk(Math.abs(e)),e?e[1]:NaN}function TVe(e,t){return function(r,n){for(var o=r.length,l=[],d=0,i=e[0],g=0;o>0&&i>0&&(g+i+1>n&&(i=Math.max(1,n-g)),l.push(r.substring(o-=i,o+i)),!((g+=i+1)>n));)i=e[d=(d+1)%e.length];return l.reverse().join(t)}}function AVe(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var PVe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function YE(e){if(!(t=PVe.exec(e)))throw new Error("invalid format: "+e);var t;return new E5({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}YE.prototype=E5.prototype;function E5(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}E5.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function CVe(e){e:for(var t=e.length,r=1,n=-1,o;r<t;++r)switch(e[r]){case".":n=o=r;break;case"0":n===0&&(n=r),o=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(o+1):e}var hse;function OVe(e,t){var r=nk(e,t);if(!r)return e+"";var n=r[0],o=r[1],l=o-(hse=Math.max(-8,Math.min(8,Math.floor(o/3)))*3)+1,d=n.length;return l===d?n:l>d?n+new Array(l-d+1).join("0"):l>0?n.slice(0,l)+"."+n.slice(l):"0."+new Array(1-l).join("0")+nk(e,Math.max(0,t+l-1))[0]}function kH(e,t){var r=nk(e,t);if(!r)return e+"";var n=r[0],o=r[1];return o<0?"0."+new Array(-o).join("0")+n:n.length>o+1?n.slice(0,o+1)+"."+n.slice(o+1):n+new Array(o-n.length+2).join("0")}const IH={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:EVe,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>kH(e*100,t),r:kH,s:OVe,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function RH(e){return e}var jH=Array.prototype.map,NH=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function kVe(e){var t=e.grouping===void 0||e.thousands===void 0?RH:TVe(jH.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",o=e.decimal===void 0?".":e.decimal+"",l=e.numerals===void 0?RH:AVe(jH.call(e.numerals,String)),d=e.percent===void 0?"%":e.percent+"",i=e.minus===void 0?"":e.minus+"",g=e.nan===void 0?"NaN":e.nan+"";function _(E){E=YE(E);var T=E.fill,C=E.align,N=E.sign,I=E.symbol,j=E.zero,D=E.width,R=E.comma,F=E.precision,B=E.trim,U=E.type;U==="n"?(R=!0,U="g"):IH[U]||(F===void 0&&(F=12),B=!0,U="g"),(j||T==="0"&&C==="=")&&(j=!0,T="0",C="=");var Z=I==="$"?r:I==="#"&&/[boxX]/.test(U)?"0"+U.toLowerCase():"",J=I==="$"?n:/[%p]/.test(U)?d:"",te=IH[U],ae=/[defgprs%]/.test(U);F=F===void 0?6:/[gprs]/.test(U)?Math.max(1,Math.min(21,F)):Math.max(0,Math.min(20,F));function ne(ie){var ee=Z,oe=J,de,xe,we;if(U==="c")oe=te(ie)+oe,ie="";else{ie=+ie;var Ae=ie<0||1/ie<0;if(ie=isNaN(ie)?g:te(Math.abs(ie),F),B&&(ie=CVe(ie)),Ae&&+ie==0&&N!=="+"&&(Ae=!1),ee=(Ae?N==="("?N:i:N==="-"||N==="("?"":N)+ee,oe=(U==="s"?NH[8+hse/3]:"")+oe+(Ae&&N==="("?")":""),ae){for(de=-1,xe=ie.length;++de<xe;)if(we=ie.charCodeAt(de),48>we||we>57){oe=(we===46?o+ie.slice(de+1):ie.slice(de))+oe,ie=ie.slice(0,de);break}}}R&&!j&&(ie=t(ie,1/0));var Ce=ee.length+ie.length+oe.length,me=Ce<D?new Array(D-Ce+1).join(T):"";switch(R&&j&&(ie=t(me+ie,me.length?D-oe.length:1/0),me=""),C){case"<":ie=ee+ie+oe+me;break;case"=":ie=ee+me+ie+oe;break;case"^":ie=me.slice(0,Ce=me.length>>1)+ee+ie+oe+me.slice(Ce);break;default:ie=me+ee+ie+oe;break}return l(ie)}return ne.toString=function(){return E+""},ne}function S(E,T){var C=_((E=YE(E),E.type="f",E)),N=Math.max(-8,Math.min(8,Math.floor(J0(T)/3)))*3,I=Math.pow(10,-N),j=NH[8+N/3];return function(D){return C(I*D)+j}}return{format:_,formatPrefix:S}}var GP,T5,fse;IVe({thousands:",",grouping:[3],currency:["$",""]});function IVe(e){return GP=kVe(e),T5=GP.format,fse=GP.formatPrefix,GP}function RVe(e){return Math.max(0,-J0(Math.abs(e)))}function jVe(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(J0(t)/3)))*3-J0(Math.abs(e)))}function NVe(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,J0(t)-J0(e))+1}function pse(e,t,r,n){var o=pF(e,t,r),l;switch(n=YE(n??",f"),n.type){case"s":{var d=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(l=jVe(o,d))&&(n.precision=l),fse(n,d)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(l=NVe(o,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=l-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(l=RVe(o))&&(n.precision=l-(n.type==="%")*2);break}}return T5(n)}function dg(e){var t=e.domain;return e.ticks=function(r){var n=t();return hF(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var o=t();return pse(o[0],o[o.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),o=0,l=n.length-1,d=n[o],i=n[l],g,_,S=10;for(i<d&&(_=d,d=i,i=_,_=o,o=l,l=_);S-- >0;){if(_=fF(d,i,r),_===g)return n[o]=d,n[l]=i,t(n);if(_>0)d=Math.floor(d/_)*_,i=Math.ceil(i/_)*_;else if(_<0)d=Math.ceil(d*_)/_,i=Math.floor(i*_)/_;else break;g=_}return e},e}function ik(){var e=S5();return e.copy=function(){return n2(e,ik())},Fu.apply(e,arguments),dg(e)}function mse(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,rk),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return mse(e).unknown(t)},e=arguments.length?Array.from(e,rk):[0,1],dg(r)}function gse(e,t){e=e.slice();var r=0,n=e.length-1,o=e[r],l=e[n],d;return l<o&&(d=r,r=n,n=d,d=o,o=l,l=d),e[r]=t.floor(o),e[n]=t.ceil(l),e}function MH(e){return Math.log(e)}function DH(e){return Math.exp(e)}function MVe(e){return-Math.log(-e)}function DVe(e){return-Math.exp(-e)}function LVe(e){return isFinite(e)?+("1e"+e):e<0?0:e}function FVe(e){return e===10?LVe:e===Math.E?Math.exp:t=>Math.pow(e,t)}function zVe(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function LH(e){return(t,r)=>-e(-t,r)}function A5(e){const t=e(MH,DH),r=t.domain;let n=10,o,l;function d(){return o=zVe(n),l=FVe(n),r()[0]<0?(o=LH(o),l=LH(l),e(MVe,DVe)):e(MH,DH),t}return t.base=function(i){return arguments.length?(n=+i,d()):n},t.domain=function(i){return arguments.length?(r(i),d()):r()},t.ticks=i=>{const g=r();let _=g[0],S=g[g.length-1];const E=S<_;E&&([_,S]=[S,_]);let T=o(_),C=o(S),N,I;const j=i==null?10:+i;let D=[];if(!(n%1)&&C-T<j){if(T=Math.floor(T),C=Math.ceil(C),_>0){for(;T<=C;++T)for(N=1;N<n;++N)if(I=T<0?N/l(-T):N*l(T),!(I<_)){if(I>S)break;D.push(I)}}else for(;T<=C;++T)for(N=n-1;N>=1;--N)if(I=T>0?N/l(-T):N*l(T),!(I<_)){if(I>S)break;D.push(I)}D.length*2<j&&(D=hF(_,S,j))}else D=hF(T,C,Math.min(C-T,j)).map(l);return E?D.reverse():D},t.tickFormat=(i,g)=>{if(i==null&&(i=10),g==null&&(g=n===10?"s":","),typeof g!="function"&&(!(n%1)&&(g=YE(g)).precision==null&&(g.trim=!0),g=T5(g)),i===1/0)return g;const _=Math.max(1,n*i/t.ticks().length);return S=>{let E=S/l(Math.round(o(S)));return E*n<n-.5&&(E*=n),E<=_?g(S):""}},t.nice=()=>r(gse(r(),{floor:i=>l(Math.floor(o(i))),ceil:i=>l(Math.ceil(o(i)))})),t}function yse(){const e=A5(yR()).domain([1,10]);return e.copy=()=>n2(e,yse()).base(e.base()),Fu.apply(e,arguments),e}function FH(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function zH(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function P5(e){var t=1,r=e(FH(t),zH(t));return r.constant=function(n){return arguments.length?e(FH(t=+n),zH(t)):t},dg(r)}function vse(){var e=P5(yR());return e.copy=function(){return n2(e,vse()).constant(e.constant())},Fu.apply(e,arguments)}function BH(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function BVe(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function $Ve(e){return e<0?-e*e:e*e}function C5(e){var t=e(Gl,Gl),r=1;function n(){return r===1?e(Gl,Gl):r===.5?e(BVe,$Ve):e(BH(r),BH(1/r))}return t.exponent=function(o){return arguments.length?(r=+o,n()):r},dg(t)}function O5(){var e=C5(yR());return e.copy=function(){return n2(e,O5()).exponent(e.exponent())},Fu.apply(e,arguments),e}function UVe(){return O5.apply(null,arguments).exponent(.5)}function $H(e){return Math.sign(e)*e*e}function VVe(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function _se(){var e=S5(),t=[0,1],r=!1,n;function o(l){var d=VVe(e(l));return isNaN(d)?n:r?Math.round(d):d}return o.invert=function(l){return e.invert($H(l))},o.domain=function(l){return arguments.length?(e.domain(l),o):e.domain()},o.range=function(l){return arguments.length?(e.range((t=Array.from(l,rk)).map($H)),o):t.slice()},o.rangeRound=function(l){return o.range(l).round(!0)},o.round=function(l){return arguments.length?(r=!!l,o):r},o.clamp=function(l){return arguments.length?(e.clamp(l),o):e.clamp()},o.unknown=function(l){return arguments.length?(n=l,o):n},o.copy=function(){return _se(e.domain(),t).round(r).clamp(e.clamp()).unknown(n)},Fu.apply(o,arguments),dg(o)}function xse(){var e=[],t=[],r=[],n;function o(){var d=0,i=Math.max(1,t.length);for(r=new Array(i-1);++d<i;)r[d-1]=KUe(e,d/i);return l}function l(d){return d==null||isNaN(d=+d)?n:t[t2(r,d)]}return l.invertExtent=function(d){var i=t.indexOf(d);return i<0?[NaN,NaN]:[i>0?r[i-1]:e[0],i<r.length?r[i]:e[e.length-1]]},l.domain=function(d){if(!arguments.length)return e.slice();e=[];for(let i of d)i!=null&&!isNaN(i=+i)&&e.push(i);return e.sort(Bm),o()},l.range=function(d){return arguments.length?(t=Array.from(d),o()):t.slice()},l.unknown=function(d){return arguments.length?(n=d,l):n},l.quantiles=function(){return r.slice()},l.copy=function(){return xse().domain(e).range(t).unknown(n)},Fu.apply(l,arguments)}function bse(){var e=0,t=1,r=1,n=[.5],o=[0,1],l;function d(g){return g!=null&&g<=g?o[t2(n,g,0,r)]:l}function i(){var g=-1;for(n=new Array(r);++g<r;)n[g]=((g+1)*t-(g-r)*e)/(r+1);return d}return d.domain=function(g){return arguments.length?([e,t]=g,e=+e,t=+t,i()):[e,t]},d.range=function(g){return arguments.length?(r=(o=Array.from(g)).length-1,i()):o.slice()},d.invertExtent=function(g){var _=o.indexOf(g);return _<0?[NaN,NaN]:_<1?[e,n[0]]:_>=r?[n[r-1],t]:[n[_-1],n[_]]},d.unknown=function(g){return arguments.length&&(l=g),d},d.thresholds=function(){return n.slice()},d.copy=function(){return bse().domain([e,t]).range(o).unknown(l)},Fu.apply(dg(d),arguments)}function wse(){var e=[.5],t=[0,1],r,n=1;function o(l){return l!=null&&l<=l?t[t2(e,l,0,n)]:r}return o.domain=function(l){return arguments.length?(e=Array.from(l),n=Math.min(e.length,t.length-1),o):e.slice()},o.range=function(l){return arguments.length?(t=Array.from(l),n=Math.min(e.length,t.length-1),o):t.slice()},o.invertExtent=function(l){var d=t.indexOf(l);return[e[d-1],e[d]]},o.unknown=function(l){return arguments.length?(r=l,o):r},o.copy=function(){return wse().domain(e).range(t).unknown(r)},Fu.apply(o,arguments)}const pD=new Date,mD=new Date;function xs(e,t,r,n){function o(l){return e(l=arguments.length===0?new Date:new Date(+l)),l}return o.floor=l=>(e(l=new Date(+l)),l),o.ceil=l=>(e(l=new Date(l-1)),t(l,1),e(l),l),o.round=l=>{const d=o(l),i=o.ceil(l);return l-d<i-l?d:i},o.offset=(l,d)=>(t(l=new Date(+l),d==null?1:Math.floor(d)),l),o.range=(l,d,i)=>{const g=[];if(l=o.ceil(l),i=i==null?1:Math.floor(i),!(l<d)||!(i>0))return g;let _;do g.push(_=new Date(+l)),t(l,i),e(l);while(_<l&&l<d);return g},o.filter=l=>xs(d=>{if(d>=d)for(;e(d),!l(d);)d.setTime(d-1)},(d,i)=>{if(d>=d)if(i<0)for(;++i<=0;)for(;t(d,-1),!l(d););else for(;--i>=0;)for(;t(d,1),!l(d););}),r&&(o.count=(l,d)=>(pD.setTime(+l),mD.setTime(+d),e(pD),e(mD),Math.floor(r(pD,mD))),o.every=l=>(l=Math.floor(l),!isFinite(l)||!(l>0)?null:l>1?o.filter(n?d=>n(d)%l===0:d=>o.count(0,d)%l===0):o)),o}const ak=xs(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);ak.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?xs(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):ak);ak.range;const wf=1e3,Tu=wf*60,Sf=Tu*60,zf=Sf*24,k5=zf*7,UH=zf*30,gD=zf*365,By=xs(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*wf)},(e,t)=>(t-e)/wf,e=>e.getUTCSeconds());By.range;const I5=xs(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*wf)},(e,t)=>{e.setTime(+e+t*Tu)},(e,t)=>(t-e)/Tu,e=>e.getMinutes());I5.range;const R5=xs(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Tu)},(e,t)=>(t-e)/Tu,e=>e.getUTCMinutes());R5.range;const j5=xs(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*wf-e.getMinutes()*Tu)},(e,t)=>{e.setTime(+e+t*Sf)},(e,t)=>(t-e)/Sf,e=>e.getHours());j5.range;const N5=xs(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Sf)},(e,t)=>(t-e)/Sf,e=>e.getUTCHours());N5.range;const i2=xs(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Tu)/zf,e=>e.getDate()-1);i2.range;const vR=xs(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/zf,e=>e.getUTCDate()-1);vR.range;const Sse=xs(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/zf,e=>Math.floor(e/zf));Sse.range;function Mv(e){return xs(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*Tu)/k5)}const _R=Mv(0),ok=Mv(1),qVe=Mv(2),WVe=Mv(3),Q0=Mv(4),GVe=Mv(5),HVe=Mv(6);_R.range;ok.range;qVe.range;WVe.range;Q0.range;GVe.range;HVe.range;function Dv(e){return xs(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/k5)}const xR=Dv(0),sk=Dv(1),KVe=Dv(2),ZVe=Dv(3),eb=Dv(4),XVe=Dv(5),YVe=Dv(6);xR.range;sk.range;KVe.range;ZVe.range;eb.range;XVe.range;YVe.range;const M5=xs(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());M5.range;const D5=xs(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());D5.range;const Bf=xs(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Bf.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:xs(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});Bf.range;const $f=xs(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());$f.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:xs(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});$f.range;function Ese(e,t,r,n,o,l){const d=[[By,1,wf],[By,5,5*wf],[By,15,15*wf],[By,30,30*wf],[l,1,Tu],[l,5,5*Tu],[l,15,15*Tu],[l,30,30*Tu],[o,1,Sf],[o,3,3*Sf],[o,6,6*Sf],[o,12,12*Sf],[n,1,zf],[n,2,2*zf],[r,1,k5],[t,1,UH],[t,3,3*UH],[e,1,gD]];function i(_,S,E){const T=S<_;T&&([_,S]=[S,_]);const C=E&&typeof E.range=="function"?E:g(_,S,E),N=C?C.range(_,+S+1):[];return T?N.reverse():N}function g(_,S,E){const T=Math.abs(S-_)/E,C=v5(([,,j])=>j).right(d,T);if(C===d.length)return e.every(pF(_/gD,S/gD,E));if(C===0)return ak.every(Math.max(pF(_,S,E),1));const[N,I]=d[T/d[C-1][2]<d[C][2]/T?C-1:C];return N.every(I)}return[i,g]}const[JVe,QVe]=Ese($f,D5,xR,Sse,N5,R5),[e6e,t6e]=Ese(Bf,M5,_R,i2,j5,I5);function yD(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function vD(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function gS(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function r6e(e){var t=e.dateTime,r=e.date,n=e.time,o=e.periods,l=e.days,d=e.shortDays,i=e.months,g=e.shortMonths,_=yS(o),S=vS(o),E=yS(l),T=vS(l),C=yS(d),N=vS(d),I=yS(i),j=vS(i),D=yS(g),R=vS(g),F={a:Ae,A:Ce,b:me,B:Pe,c:null,d:KH,e:KH,f:T6e,g:M6e,G:L6e,H:w6e,I:S6e,j:E6e,L:Tse,m:A6e,M:P6e,p:ye,q:pe,Q:YH,s:JH,S:C6e,u:O6e,U:k6e,V:I6e,w:R6e,W:j6e,x:null,X:null,y:N6e,Y:D6e,Z:F6e,"%":XH},B={a:Ie,A:tt,b:Ze,B:Le,c:null,d:ZH,e:ZH,f:U6e,g:J6e,G:e8e,H:z6e,I:B6e,j:$6e,L:Pse,m:V6e,M:q6e,p:qe,q:Ge,Q:YH,s:JH,S:W6e,u:G6e,U:H6e,V:K6e,w:Z6e,W:X6e,x:null,X:null,y:Y6e,Y:Q6e,Z:t8e,"%":XH},U={a:ne,A:ie,b:ee,B:oe,c:de,d:GH,e:GH,f:v6e,g:WH,G:qH,H:HH,I:HH,j:p6e,L:y6e,m:f6e,M:m6e,p:ae,q:h6e,Q:x6e,s:b6e,S:g6e,u:s6e,U:l6e,V:c6e,w:o6e,W:u6e,x:xe,X:we,y:WH,Y:qH,Z:d6e,"%":_6e};F.x=Z(r,F),F.X=Z(n,F),F.c=Z(t,F),B.x=Z(r,B),B.X=Z(n,B),B.c=Z(t,B);function Z(je,ot){return function(St){var rt=[],Ut=-1,Ft=0,dr=je.length,Lr,Jr,Rt;for(St instanceof Date||(St=new Date(+St));++Ut<dr;)je.charCodeAt(Ut)===37&&(rt.push(je.slice(Ft,Ut)),(Jr=VH[Lr=je.charAt(++Ut)])!=null?Lr=je.charAt(++Ut):Jr=Lr==="e"?" ":"0",(Rt=ot[Lr])&&(Lr=Rt(St,Jr)),rt.push(Lr),Ft=Ut+1);return rt.push(je.slice(Ft,Ut)),rt.join("")}}function J(je,ot){return function(St){var rt=gS(1900,void 0,1),Ut=te(rt,je,St+="",0),Ft,dr;if(Ut!=St.length)return null;if("Q"in rt)return new Date(rt.Q);if("s"in rt)return new Date(rt.s*1e3+("L"in rt?rt.L:0));if(ot&&!("Z"in rt)&&(rt.Z=0),"p"in rt&&(rt.H=rt.H%12+rt.p*12),rt.m===void 0&&(rt.m="q"in rt?rt.q:0),"V"in rt){if(rt.V<1||rt.V>53)return null;"w"in rt||(rt.w=1),"Z"in rt?(Ft=vD(gS(rt.y,0,1)),dr=Ft.getUTCDay(),Ft=dr>4||dr===0?sk.ceil(Ft):sk(Ft),Ft=vR.offset(Ft,(rt.V-1)*7),rt.y=Ft.getUTCFullYear(),rt.m=Ft.getUTCMonth(),rt.d=Ft.getUTCDate()+(rt.w+6)%7):(Ft=yD(gS(rt.y,0,1)),dr=Ft.getDay(),Ft=dr>4||dr===0?ok.ceil(Ft):ok(Ft),Ft=i2.offset(Ft,(rt.V-1)*7),rt.y=Ft.getFullYear(),rt.m=Ft.getMonth(),rt.d=Ft.getDate()+(rt.w+6)%7)}else("W"in rt||"U"in rt)&&("w"in rt||(rt.w="u"in rt?rt.u%7:"W"in rt?1:0),dr="Z"in rt?vD(gS(rt.y,0,1)).getUTCDay():yD(gS(rt.y,0,1)).getDay(),rt.m=0,rt.d="W"in rt?(rt.w+6)%7+rt.W*7-(dr+5)%7:rt.w+rt.U*7-(dr+6)%7);return"Z"in rt?(rt.H+=rt.Z/100|0,rt.M+=rt.Z%100,vD(rt)):yD(rt)}}function te(je,ot,St,rt){for(var Ut=0,Ft=ot.length,dr=St.length,Lr,Jr;Ut<Ft;){if(rt>=dr)return-1;if(Lr=ot.charCodeAt(Ut++),Lr===37){if(Lr=ot.charAt(Ut++),Jr=U[Lr in VH?ot.charAt(Ut++):Lr],!Jr||(rt=Jr(je,St,rt))<0)return-1}else if(Lr!=St.charCodeAt(rt++))return-1}return rt}function ae(je,ot,St){var rt=_.exec(ot.slice(St));return rt?(je.p=S.get(rt[0].toLowerCase()),St+rt[0].length):-1}function ne(je,ot,St){var rt=C.exec(ot.slice(St));return rt?(je.w=N.get(rt[0].toLowerCase()),St+rt[0].length):-1}function ie(je,ot,St){var rt=E.exec(ot.slice(St));return rt?(je.w=T.get(rt[0].toLowerCase()),St+rt[0].length):-1}function ee(je,ot,St){var rt=D.exec(ot.slice(St));return rt?(je.m=R.get(rt[0].toLowerCase()),St+rt[0].length):-1}function oe(je,ot,St){var rt=I.exec(ot.slice(St));return rt?(je.m=j.get(rt[0].toLowerCase()),St+rt[0].length):-1}function de(je,ot,St){return te(je,t,ot,St)}function xe(je,ot,St){return te(je,r,ot,St)}function we(je,ot,St){return te(je,n,ot,St)}function Ae(je){return d[je.getDay()]}function Ce(je){return l[je.getDay()]}function me(je){return g[je.getMonth()]}function Pe(je){return i[je.getMonth()]}function ye(je){return o[+(je.getHours()>=12)]}function pe(je){return 1+~~(je.getMonth()/3)}function Ie(je){return d[je.getUTCDay()]}function tt(je){return l[je.getUTCDay()]}function Ze(je){return g[je.getUTCMonth()]}function Le(je){return i[je.getUTCMonth()]}function qe(je){return o[+(je.getUTCHours()>=12)]}function Ge(je){return 1+~~(je.getUTCMonth()/3)}return{format:function(je){var ot=Z(je+="",F);return ot.toString=function(){return je},ot},parse:function(je){var ot=J(je+="",!1);return ot.toString=function(){return je},ot},utcFormat:function(je){var ot=Z(je+="",B);return ot.toString=function(){return je},ot},utcParse:function(je){var ot=J(je+="",!0);return ot.toString=function(){return je},ot}}}var VH={"-":"",_:" ",0:"0"},Rs=/^\s*\d+/,n6e=/^%/,i6e=/[\\^$*+?|[\]().{}]/g;function va(e,t,r){var n=e<0?"-":"",o=(n?-e:e)+"",l=o.length;return n+(l<r?new Array(r-l+1).join(t)+o:o)}function a6e(e){return e.replace(i6e,"\\$&")}function yS(e){return new RegExp("^(?:"+e.map(a6e).join("|")+")","i")}function vS(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function o6e(e,t,r){var n=Rs.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function s6e(e,t,r){var n=Rs.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function l6e(e,t,r){var n=Rs.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function c6e(e,t,r){var n=Rs.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function u6e(e,t,r){var n=Rs.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function qH(e,t,r){var n=Rs.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function WH(e,t,r){var n=Rs.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function d6e(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function h6e(e,t,r){var n=Rs.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function f6e(e,t,r){var n=Rs.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function GH(e,t,r){var n=Rs.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function p6e(e,t,r){var n=Rs.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function HH(e,t,r){var n=Rs.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function m6e(e,t,r){var n=Rs.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function g6e(e,t,r){var n=Rs.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function y6e(e,t,r){var n=Rs.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function v6e(e,t,r){var n=Rs.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function _6e(e,t,r){var n=n6e.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function x6e(e,t,r){var n=Rs.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function b6e(e,t,r){var n=Rs.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function KH(e,t){return va(e.getDate(),t,2)}function w6e(e,t){return va(e.getHours(),t,2)}function S6e(e,t){return va(e.getHours()%12||12,t,2)}function E6e(e,t){return va(1+i2.count(Bf(e),e),t,3)}function Tse(e,t){return va(e.getMilliseconds(),t,3)}function T6e(e,t){return Tse(e,t)+"000"}function A6e(e,t){return va(e.getMonth()+1,t,2)}function P6e(e,t){return va(e.getMinutes(),t,2)}function C6e(e,t){return va(e.getSeconds(),t,2)}function O6e(e){var t=e.getDay();return t===0?7:t}function k6e(e,t){return va(_R.count(Bf(e)-1,e),t,2)}function Ase(e){var t=e.getDay();return t>=4||t===0?Q0(e):Q0.ceil(e)}function I6e(e,t){return e=Ase(e),va(Q0.count(Bf(e),e)+(Bf(e).getDay()===4),t,2)}function R6e(e){return e.getDay()}function j6e(e,t){return va(ok.count(Bf(e)-1,e),t,2)}function N6e(e,t){return va(e.getFullYear()%100,t,2)}function M6e(e,t){return e=Ase(e),va(e.getFullYear()%100,t,2)}function D6e(e,t){return va(e.getFullYear()%1e4,t,4)}function L6e(e,t){var r=e.getDay();return e=r>=4||r===0?Q0(e):Q0.ceil(e),va(e.getFullYear()%1e4,t,4)}function F6e(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+va(t/60|0,"0",2)+va(t%60,"0",2)}function ZH(e,t){return va(e.getUTCDate(),t,2)}function z6e(e,t){return va(e.getUTCHours(),t,2)}function B6e(e,t){return va(e.getUTCHours()%12||12,t,2)}function $6e(e,t){return va(1+vR.count($f(e),e),t,3)}function Pse(e,t){return va(e.getUTCMilliseconds(),t,3)}function U6e(e,t){return Pse(e,t)+"000"}function V6e(e,t){return va(e.getUTCMonth()+1,t,2)}function q6e(e,t){return va(e.getUTCMinutes(),t,2)}function W6e(e,t){return va(e.getUTCSeconds(),t,2)}function G6e(e){var t=e.getUTCDay();return t===0?7:t}function H6e(e,t){return va(xR.count($f(e)-1,e),t,2)}function Cse(e){var t=e.getUTCDay();return t>=4||t===0?eb(e):eb.ceil(e)}function K6e(e,t){return e=Cse(e),va(eb.count($f(e),e)+($f(e).getUTCDay()===4),t,2)}function Z6e(e){return e.getUTCDay()}function X6e(e,t){return va(sk.count($f(e)-1,e),t,2)}function Y6e(e,t){return va(e.getUTCFullYear()%100,t,2)}function J6e(e,t){return e=Cse(e),va(e.getUTCFullYear()%100,t,2)}function Q6e(e,t){return va(e.getUTCFullYear()%1e4,t,4)}function e8e(e,t){var r=e.getUTCDay();return e=r>=4||r===0?eb(e):eb.ceil(e),va(e.getUTCFullYear()%1e4,t,4)}function t8e(){return"+0000"}function XH(){return"%"}function YH(e){return+e}function JH(e){return Math.floor(+e/1e3)}var Ex,Ose,kse;r8e({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function r8e(e){return Ex=r6e(e),Ose=Ex.format,Ex.parse,kse=Ex.utcFormat,Ex.utcParse,Ex}function n8e(e){return new Date(e)}function i8e(e){return e instanceof Date?+e:+new Date(+e)}function L5(e,t,r,n,o,l,d,i,g,_){var S=S5(),E=S.invert,T=S.domain,C=_(".%L"),N=_(":%S"),I=_("%I:%M"),j=_("%I %p"),D=_("%a %d"),R=_("%b %d"),F=_("%B"),B=_("%Y");function U(Z){return(g(Z)<Z?C:i(Z)<Z?N:d(Z)<Z?I:l(Z)<Z?j:n(Z)<Z?o(Z)<Z?D:R:r(Z)<Z?F:B)(Z)}return S.invert=function(Z){return new Date(E(Z))},S.domain=function(Z){return arguments.length?T(Array.from(Z,i8e)):T().map(n8e)},S.ticks=function(Z){var J=T();return e(J[0],J[J.length-1],Z??10)},S.tickFormat=function(Z,J){return J==null?U:_(J)},S.nice=function(Z){var J=T();return(!Z||typeof Z.range!="function")&&(Z=t(J[0],J[J.length-1],Z??10)),Z?T(gse(J,Z)):S},S.copy=function(){return n2(S,L5(e,t,r,n,o,l,d,i,g,_))},S}function a8e(){return Fu.apply(L5(e6e,t6e,Bf,M5,_R,i2,j5,I5,By,Ose).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function o8e(){return Fu.apply(L5(JVe,QVe,$f,D5,xR,vR,N5,R5,By,kse).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function bR(){var e=0,t=1,r,n,o,l,d=Gl,i=!1,g;function _(E){return E==null||isNaN(E=+E)?g:d(o===0?.5:(E=(l(E)-r)*o,i?Math.max(0,Math.min(1,E)):E))}_.domain=function(E){return arguments.length?([e,t]=E,r=l(e=+e),n=l(t=+t),o=r===n?0:1/(n-r),_):[e,t]},_.clamp=function(E){return arguments.length?(i=!!E,_):i},_.interpolator=function(E){return arguments.length?(d=E,_):d};function S(E){return function(T){var C,N;return arguments.length?([C,N]=T,d=E(C,N),_):[d(0),d(1)]}}return _.range=S(Vb),_.rangeRound=S(w5),_.unknown=function(E){return arguments.length?(g=E,_):g},function(E){return l=E,r=E(e),n=E(t),o=r===n?0:1/(n-r),_}}function hg(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Ise(){var e=dg(bR()(Gl));return e.copy=function(){return hg(e,Ise())},Zf.apply(e,arguments)}function Rse(){var e=A5(bR()).domain([1,10]);return e.copy=function(){return hg(e,Rse()).base(e.base())},Zf.apply(e,arguments)}function jse(){var e=P5(bR());return e.copy=function(){return hg(e,jse()).constant(e.constant())},Zf.apply(e,arguments)}function F5(){var e=C5(bR());return e.copy=function(){return hg(e,F5()).exponent(e.exponent())},Zf.apply(e,arguments)}function s8e(){return F5.apply(null,arguments).exponent(.5)}function Nse(){var e=[],t=Gl;function r(n){if(n!=null&&!isNaN(n=+n))return t((t2(e,n,1)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(let o of n)o!=null&&!isNaN(o=+o)&&e.push(o);return e.sort(Bm),r},r.interpolator=function(n){return arguments.length?(t=n,r):t},r.range=function(){return e.map((n,o)=>t(o/(e.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(o,l)=>HUe(e,l/n))},r.copy=function(){return Nse(t).domain(e)},Zf.apply(r,arguments)}function wR(){var e=0,t=.5,r=1,n=1,o,l,d,i,g,_=Gl,S,E=!1,T;function C(I){return isNaN(I=+I)?T:(I=.5+((I=+S(I))-l)*(n*I<n*l?i:g),_(E?Math.max(0,Math.min(1,I)):I))}C.domain=function(I){return arguments.length?([e,t,r]=I,o=S(e=+e),l=S(t=+t),d=S(r=+r),i=o===l?0:.5/(l-o),g=l===d?0:.5/(d-l),n=l<o?-1:1,C):[e,t,r]},C.clamp=function(I){return arguments.length?(E=!!I,C):E},C.interpolator=function(I){return arguments.length?(_=I,C):_};function N(I){return function(j){var D,R,F;return arguments.length?([D,R,F]=j,_=_Ve(I,[D,R,F]),C):[_(0),_(.5),_(1)]}}return C.range=N(Vb),C.rangeRound=N(w5),C.unknown=function(I){return arguments.length?(T=I,C):T},function(I){return S=I,o=I(e),l=I(t),d=I(r),i=o===l?0:.5/(l-o),g=l===d?0:.5/(d-l),n=l<o?-1:1,C}}function Mse(){var e=dg(wR()(Gl));return e.copy=function(){return hg(e,Mse())},Zf.apply(e,arguments)}function Dse(){var e=A5(wR()).domain([.1,1,10]);return e.copy=function(){return hg(e,Dse()).base(e.base())},Zf.apply(e,arguments)}function Lse(){var e=P5(wR());return e.copy=function(){return hg(e,Lse()).constant(e.constant())},Zf.apply(e,arguments)}function z5(){var e=C5(wR());return e.copy=function(){return hg(e,z5()).exponent(e.exponent())},Zf.apply(e,arguments)}function l8e(){return z5.apply(null,arguments).exponent(.5)}const QH=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:HE,scaleDiverging:Mse,scaleDivergingLog:Dse,scaleDivergingPow:z5,scaleDivergingSqrt:l8e,scaleDivergingSymlog:Lse,scaleIdentity:mse,scaleImplicit:mF,scaleLinear:ik,scaleLog:yse,scaleOrdinal:_5,scalePoint:eE,scalePow:O5,scaleQuantile:xse,scaleQuantize:bse,scaleRadial:_se,scaleSequential:Ise,scaleSequentialLog:Rse,scaleSequentialPow:F5,scaleSequentialQuantile:Nse,scaleSequentialSqrt:s8e,scaleSequentialSymlog:jse,scaleSqrt:UVe,scaleSymlog:vse,scaleThreshold:wse,scaleTime:a8e,scaleUtc:o8e,tickFormat:pse},Symbol.toStringTag,{value:"Module"}));var c8e=Nb;function u8e(e,t,r){for(var n=-1,o=e.length;++n<o;){var l=e[n],d=t(l);if(d!=null&&(i===void 0?d===d&&!c8e(d):r(d,i)))var i=d,g=l}return g}var SR=u8e;function d8e(e,t){return e>t}var Fse=d8e,h8e=SR,f8e=Fse,p8e=Ub;function m8e(e){return e&&e.length?h8e(e,p8e,f8e):void 0}var g8e=m8e;const ER=_a(g8e);function y8e(e,t){return e<t}var zse=y8e,v8e=SR,_8e=zse,x8e=Ub;function b8e(e){return e&&e.length?v8e(e,x8e,_8e):void 0}var w8e=b8e;const TR=_a(w8e);var S8e=Q4,E8e=Dh,T8e=Hoe,A8e=Pc;function P8e(e,t){var r=A8e(e)?S8e:T8e;return r(e,E8e(t))}var C8e=P8e,O8e=Woe,k8e=C8e;function I8e(e,t){return O8e(k8e(e,t),1)}var R8e=I8e;const j8e=_a(R8e);var N8e=p5;function M8e(e,t){return N8e(e,t)}var Bse=M8e;const a2=_a(Bse);var qb=1e9,D8e={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},$5,fo=!0,Nu="[DecimalError] ",rv=Nu+"Invalid argument: ",B5=Nu+"Exponent out of range: ",Wb=Math.floor,Oy=Math.pow,L8e=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Wc,Ps=1e7,ao=7,$se=9007199254740991,lk=Wb($se/ao),xn={};xn.absoluteValue=xn.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};xn.comparedTo=xn.cmp=function(e){var t,r,n,o,l=this;if(e=new l.constructor(e),l.s!==e.s)return l.s||-e.s;if(l.e!==e.e)return l.e>e.e^l.s<0?1:-1;for(n=l.d.length,o=e.d.length,t=0,r=n<o?n:o;t<r;++t)if(l.d[t]!==e.d[t])return l.d[t]>e.d[t]^l.s<0?1:-1;return n===o?0:n>o^l.s<0?1:-1};xn.decimalPlaces=xn.dp=function(){var e=this,t=e.d.length-1,r=(t-e.e)*ao;if(t=e.d[t],t)for(;t%10==0;t/=10)r--;return r<0?0:r};xn.dividedBy=xn.div=function(e){return Of(this,new this.constructor(e))};xn.dividedToIntegerBy=xn.idiv=function(e){var t=this,r=t.constructor;return Ua(Of(t,new r(e),0,1),r.precision)};xn.equals=xn.eq=function(e){return!this.cmp(e)};xn.exponent=function(){return ts(this)};xn.greaterThan=xn.gt=function(e){return this.cmp(e)>0};xn.greaterThanOrEqualTo=xn.gte=function(e){return this.cmp(e)>=0};xn.isInteger=xn.isint=function(){return this.e>this.d.length-2};xn.isNegative=xn.isneg=function(){return this.s<0};xn.isPositive=xn.ispos=function(){return this.s>0};xn.isZero=function(){return this.s===0};xn.lessThan=xn.lt=function(e){return this.cmp(e)<0};xn.lessThanOrEqualTo=xn.lte=function(e){return this.cmp(e)<1};xn.logarithm=xn.log=function(e){var t,r=this,n=r.constructor,o=n.precision,l=o+5;if(e===void 0)e=new n(10);else if(e=new n(e),e.s<1||e.eq(Wc))throw Error(Nu+"NaN");if(r.s<1)throw Error(Nu+(r.s?"NaN":"-Infinity"));return r.eq(Wc)?new n(0):(fo=!1,t=Of(JE(r,l),JE(e,l),l),fo=!0,Ua(t,o))};xn.minus=xn.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?qse(t,e):Use(t,(e.s=-e.s,e))};xn.modulo=xn.mod=function(e){var t,r=this,n=r.constructor,o=n.precision;if(e=new n(e),!e.s)throw Error(Nu+"NaN");return r.s?(fo=!1,t=Of(r,e,0,1).times(e),fo=!0,r.minus(t)):Ua(new n(r),o)};xn.naturalExponential=xn.exp=function(){return Vse(this)};xn.naturalLogarithm=xn.ln=function(){return JE(this)};xn.negated=xn.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};xn.plus=xn.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?Use(t,e):qse(t,(e.s=-e.s,e))};xn.precision=xn.sd=function(e){var t,r,n,o=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(rv+e);if(t=ts(o)+1,n=o.d.length-1,r=n*ao+1,n=o.d[n],n){for(;n%10==0;n/=10)r--;for(n=o.d[0];n>=10;n/=10)r++}return e&&t>r?t:r};xn.squareRoot=xn.sqrt=function(){var e,t,r,n,o,l,d,i=this,g=i.constructor;if(i.s<1){if(!i.s)return new g(0);throw Error(Nu+"NaN")}for(e=ts(i),fo=!1,o=Math.sqrt(+i),o==0||o==1/0?(t=gh(i.d),(t.length+e)%2==0&&(t+="0"),o=Math.sqrt(t),e=Wb((e+1)/2)-(e<0||e%2),o==1/0?t="5e"+e:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),n=new g(t)):n=new g(o.toString()),r=g.precision,o=d=r+3;;)if(l=n,n=l.plus(Of(i,l,d+2)).times(.5),gh(l.d).slice(0,d)===(t=gh(n.d)).slice(0,d)){if(t=t.slice(d-3,d+1),o==d&&t=="4999"){if(Ua(l,r+1,0),l.times(l).eq(i)){n=l;break}}else if(t!="9999")break;d+=4}return fo=!0,Ua(n,r)};xn.times=xn.mul=function(e){var t,r,n,o,l,d,i,g,_,S=this,E=S.constructor,T=S.d,C=(e=new E(e)).d;if(!S.s||!e.s)return new E(0);for(e.s*=S.s,r=S.e+e.e,g=T.length,_=C.length,g<_&&(l=T,T=C,C=l,d=g,g=_,_=d),l=[],d=g+_,n=d;n--;)l.push(0);for(n=_;--n>=0;){for(t=0,o=g+n;o>n;)i=l[o]+C[n]*T[o-n-1]+t,l[o--]=i%Ps|0,t=i/Ps|0;l[o]=(l[o]+t)%Ps|0}for(;!l[--d];)l.pop();return t?++r:l.shift(),e.d=l,e.e=r,fo?Ua(e,E.precision):e};xn.toDecimalPlaces=xn.todp=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(Ch(e,0,qb),t===void 0?t=n.rounding:Ch(t,0,8),Ua(r,e+ts(r)+1,t))};xn.toExponential=function(e,t){var r,n=this,o=n.constructor;return e===void 0?r=bv(n,!0):(Ch(e,0,qb),t===void 0?t=o.rounding:Ch(t,0,8),n=Ua(new o(n),e+1,t),r=bv(n,!0,e+1)),r};xn.toFixed=function(e,t){var r,n,o=this,l=o.constructor;return e===void 0?bv(o):(Ch(e,0,qb),t===void 0?t=l.rounding:Ch(t,0,8),n=Ua(new l(o),e+ts(o)+1,t),r=bv(n.abs(),!1,e+ts(n)+1),o.isneg()&&!o.isZero()?"-"+r:r)};xn.toInteger=xn.toint=function(){var e=this,t=e.constructor;return Ua(new t(e),ts(e)+1,t.rounding)};xn.toNumber=function(){return+this};xn.toPower=xn.pow=function(e){var t,r,n,o,l,d,i=this,g=i.constructor,_=12,S=+(e=new g(e));if(!e.s)return new g(Wc);if(i=new g(i),!i.s){if(e.s<1)throw Error(Nu+"Infinity");return i}if(i.eq(Wc))return i;if(n=g.precision,e.eq(Wc))return Ua(i,n);if(t=e.e,r=e.d.length-1,d=t>=r,l=i.s,d){if((r=S<0?-S:S)<=$se){for(o=new g(Wc),t=Math.ceil(n/ao+4),fo=!1;r%2&&(o=o.times(i),t7(o.d,t)),r=Wb(r/2),r!==0;)i=i.times(i),t7(i.d,t);return fo=!0,e.s<0?new g(Wc).div(o):Ua(o,n)}}else if(l<0)throw Error(Nu+"NaN");return l=l<0&&e.d[Math.max(t,r)]&1?-1:1,i.s=1,fo=!1,o=e.times(JE(i,n+_)),fo=!0,o=Vse(o),o.s=l,o};xn.toPrecision=function(e,t){var r,n,o=this,l=o.constructor;return e===void 0?(r=ts(o),n=bv(o,r<=l.toExpNeg||r>=l.toExpPos)):(Ch(e,1,qb),t===void 0?t=l.rounding:Ch(t,0,8),o=Ua(new l(o),e,t),r=ts(o),n=bv(o,e<=r||r<=l.toExpNeg,e)),n};xn.toSignificantDigits=xn.tosd=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(Ch(e,1,qb),t===void 0?t=n.rounding:Ch(t,0,8)),Ua(new n(r),e,t)};xn.toString=xn.valueOf=xn.val=xn.toJSON=xn[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=ts(e),r=e.constructor;return bv(e,t<=r.toExpNeg||t>=r.toExpPos)};function Use(e,t){var r,n,o,l,d,i,g,_,S=e.constructor,E=S.precision;if(!e.s||!t.s)return t.s||(t=new S(e)),fo?Ua(t,E):t;if(g=e.d,_=t.d,d=e.e,o=t.e,g=g.slice(),l=d-o,l){for(l<0?(n=g,l=-l,i=_.length):(n=_,o=d,i=g.length),d=Math.ceil(E/ao),i=d>i?d+1:i+1,l>i&&(l=i,n.length=1),n.reverse();l--;)n.push(0);n.reverse()}for(i=g.length,l=_.length,i-l<0&&(l=i,n=_,_=g,g=n),r=0;l;)r=(g[--l]=g[l]+_[l]+r)/Ps|0,g[l]%=Ps;for(r&&(g.unshift(r),++o),i=g.length;g[--i]==0;)g.pop();return t.d=g,t.e=o,fo?Ua(t,E):t}function Ch(e,t,r){if(e!==~~e||e<t||e>r)throw Error(rv+e)}function gh(e){var t,r,n,o=e.length-1,l="",d=e[0];if(o>0){for(l+=d,t=1;t<o;t++)n=e[t]+"",r=ao-n.length,r&&(l+=tm(r)),l+=n;d=e[t],n=d+"",r=ao-n.length,r&&(l+=tm(r))}else if(d===0)return"0";for(;d%10===0;)d/=10;return l+d}var Of=function(){function e(n,o){var l,d=0,i=n.length;for(n=n.slice();i--;)l=n[i]*o+d,n[i]=l%Ps|0,d=l/Ps|0;return d&&n.unshift(d),n}function t(n,o,l,d){var i,g;if(l!=d)g=l>d?1:-1;else for(i=g=0;i<l;i++)if(n[i]!=o[i]){g=n[i]>o[i]?1:-1;break}return g}function r(n,o,l){for(var d=0;l--;)n[l]-=d,d=n[l]<o[l]?1:0,n[l]=d*Ps+n[l]-o[l];for(;!n[0]&&n.length>1;)n.shift()}return function(n,o,l,d){var i,g,_,S,E,T,C,N,I,j,D,R,F,B,U,Z,J,te,ae=n.constructor,ne=n.s==o.s?1:-1,ie=n.d,ee=o.d;if(!n.s)return new ae(n);if(!o.s)throw Error(Nu+"Division by zero");for(g=n.e-o.e,J=ee.length,U=ie.length,C=new ae(ne),N=C.d=[],_=0;ee[_]==(ie[_]||0);)++_;if(ee[_]>(ie[_]||0)&&--g,l==null?R=l=ae.precision:d?R=l+(ts(n)-ts(o))+1:R=l,R<0)return new ae(0);if(R=R/ao+2|0,_=0,J==1)for(S=0,ee=ee[0],R++;(_<U||S)&&R--;_++)F=S*Ps+(ie[_]||0),N[_]=F/ee|0,S=F%ee|0;else{for(S=Ps/(ee[0]+1)|0,S>1&&(ee=e(ee,S),ie=e(ie,S),J=ee.length,U=ie.length),B=J,I=ie.slice(0,J),j=I.length;j<J;)I[j++]=0;te=ee.slice(),te.unshift(0),Z=ee[0],ee[1]>=Ps/2&&++Z;do S=0,i=t(ee,I,J,j),i<0?(D=I[0],J!=j&&(D=D*Ps+(I[1]||0)),S=D/Z|0,S>1?(S>=Ps&&(S=Ps-1),E=e(ee,S),T=E.length,j=I.length,i=t(E,I,T,j),i==1&&(S--,r(E,J<T?te:ee,T))):(S==0&&(i=S=1),E=ee.slice()),T=E.length,T<j&&E.unshift(0),r(I,E,j),i==-1&&(j=I.length,i=t(ee,I,J,j),i<1&&(S++,r(I,J<j?te:ee,j))),j=I.length):i===0&&(S++,I=[0]),N[_++]=S,i&&I[0]?I[j++]=ie[B]||0:(I=[ie[B]],j=1);while((B++<U||I[0]!==void 0)&&R--)}return N[0]||N.shift(),C.e=g,Ua(C,d?l+ts(C)+1:l)}}();function Vse(e,t){var r,n,o,l,d,i,g=0,_=0,S=e.constructor,E=S.precision;if(ts(e)>16)throw Error(B5+ts(e));if(!e.s)return new S(Wc);for(t==null?(fo=!1,i=E):i=t,d=new S(.03125);e.abs().gte(.1);)e=e.times(d),_+=5;for(n=Math.log(Oy(2,_))/Math.LN10*2+5|0,i+=n,r=o=l=new S(Wc),S.precision=i;;){if(o=Ua(o.times(e),i),r=r.times(++g),d=l.plus(Of(o,r,i)),gh(d.d).slice(0,i)===gh(l.d).slice(0,i)){for(;_--;)l=Ua(l.times(l),i);return S.precision=E,t==null?(fo=!0,Ua(l,E)):l}l=d}}function ts(e){for(var t=e.e*ao,r=e.d[0];r>=10;r/=10)t++;return t}function _D(e,t,r){if(t>e.LN10.sd())throw fo=!0,r&&(e.precision=r),Error(Nu+"LN10 precision limit exceeded");return Ua(new e(e.LN10),t)}function tm(e){for(var t="";e--;)t+="0";return t}function JE(e,t){var r,n,o,l,d,i,g,_,S,E=1,T=10,C=e,N=C.d,I=C.constructor,j=I.precision;if(C.s<1)throw Error(Nu+(C.s?"NaN":"-Infinity"));if(C.eq(Wc))return new I(0);if(t==null?(fo=!1,_=j):_=t,C.eq(10))return t==null&&(fo=!0),_D(I,_);if(_+=T,I.precision=_,r=gh(N),n=r.charAt(0),l=ts(C),Math.abs(l)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)C=C.times(e),r=gh(C.d),n=r.charAt(0),E++;l=ts(C),n>1?(C=new I("0."+r),l++):C=new I(n+"."+r.slice(1))}else return g=_D(I,_+2,j).times(l+""),C=JE(new I(n+"."+r.slice(1)),_-T).plus(g),I.precision=j,t==null?(fo=!0,Ua(C,j)):C;for(i=d=C=Of(C.minus(Wc),C.plus(Wc),_),S=Ua(C.times(C),_),o=3;;){if(d=Ua(d.times(S),_),g=i.plus(Of(d,new I(o),_)),gh(g.d).slice(0,_)===gh(i.d).slice(0,_))return i=i.times(2),l!==0&&(i=i.plus(_D(I,_+2,j).times(l+""))),i=Of(i,new I(E),_),I.precision=j,t==null?(fo=!0,Ua(i,j)):i;i=g,o+=2}}function e7(e,t){var r,n,o;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;)++n;for(o=t.length;t.charCodeAt(o-1)===48;)--o;if(t=t.slice(n,o),t){if(o-=n,r=r-n-1,e.e=Wb(r/ao),e.d=[],n=(r+1)%ao,r<0&&(n+=ao),n<o){for(n&&e.d.push(+t.slice(0,n)),o-=ao;n<o;)e.d.push(+t.slice(n,n+=ao));t=t.slice(n),n=ao-t.length}else n-=o;for(;n--;)t+="0";if(e.d.push(+t),fo&&(e.e>lk||e.e<-lk))throw Error(B5+r)}else e.s=0,e.e=0,e.d=[0];return e}function Ua(e,t,r){var n,o,l,d,i,g,_,S,E=e.d;for(d=1,l=E[0];l>=10;l/=10)d++;if(n=t-d,n<0)n+=ao,o=t,_=E[S=0];else{if(S=Math.ceil((n+1)/ao),l=E.length,S>=l)return e;for(_=l=E[S],d=1;l>=10;l/=10)d++;n%=ao,o=n-ao+d}if(r!==void 0&&(l=Oy(10,d-o-1),i=_/l%10|0,g=t<0||E[S+1]!==void 0||_%l,g=r<4?(i||g)&&(r==0||r==(e.s<0?3:2)):i>5||i==5&&(r==4||g||r==6&&(n>0?o>0?_/Oy(10,d-o):0:E[S-1])%10&1||r==(e.s<0?8:7))),t<1||!E[0])return g?(l=ts(e),E.length=1,t=t-l-1,E[0]=Oy(10,(ao-t%ao)%ao),e.e=Wb(-t/ao)||0):(E.length=1,E[0]=e.e=e.s=0),e;if(n==0?(E.length=S,l=1,S--):(E.length=S+1,l=Oy(10,ao-n),E[S]=o>0?(_/Oy(10,d-o)%Oy(10,o)|0)*l:0),g)for(;;)if(S==0){(E[0]+=l)==Ps&&(E[0]=1,++e.e);break}else{if(E[S]+=l,E[S]!=Ps)break;E[S--]=0,l=1}for(n=E.length;E[--n]===0;)E.pop();if(fo&&(e.e>lk||e.e<-lk))throw Error(B5+ts(e));return e}function qse(e,t){var r,n,o,l,d,i,g,_,S,E,T=e.constructor,C=T.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new T(e),fo?Ua(t,C):t;if(g=e.d,E=t.d,n=t.e,_=e.e,g=g.slice(),d=_-n,d){for(S=d<0,S?(r=g,d=-d,i=E.length):(r=E,n=_,i=g.length),o=Math.max(Math.ceil(C/ao),i)+2,d>o&&(d=o,r.length=1),r.reverse(),o=d;o--;)r.push(0);r.reverse()}else{for(o=g.length,i=E.length,S=o<i,S&&(i=o),o=0;o<i;o++)if(g[o]!=E[o]){S=g[o]<E[o];break}d=0}for(S&&(r=g,g=E,E=r,t.s=-t.s),i=g.length,o=E.length-i;o>0;--o)g[i++]=0;for(o=E.length;o>d;){if(g[--o]<E[o]){for(l=o;l&&g[--l]===0;)g[l]=Ps-1;--g[l],g[o]+=Ps}g[o]-=E[o]}for(;g[--i]===0;)g.pop();for(;g[0]===0;g.shift())--n;return g[0]?(t.d=g,t.e=n,fo?Ua(t,C):t):new T(0)}function bv(e,t,r){var n,o=ts(e),l=gh(e.d),d=l.length;return t?(r&&(n=r-d)>0?l=l.charAt(0)+"."+l.slice(1)+tm(n):d>1&&(l=l.charAt(0)+"."+l.slice(1)),l=l+(o<0?"e":"e+")+o):o<0?(l="0."+tm(-o-1)+l,r&&(n=r-d)>0&&(l+=tm(n))):o>=d?(l+=tm(o+1-d),r&&(n=r-o-1)>0&&(l=l+"."+tm(n))):((n=o+1)<d&&(l=l.slice(0,n)+"."+l.slice(n)),r&&(n=r-d)>0&&(o+1===d&&(l+="."),l+=tm(n))),e.s<0?"-"+l:l}function t7(e,t){if(e.length>t)return e.length=t,!0}function Wse(e){var t,r,n;function o(l){var d=this;if(!(d instanceof o))return new o(l);if(d.constructor=o,l instanceof o){d.s=l.s,d.e=l.e,d.d=(l=l.d)?l.slice():l;return}if(typeof l=="number"){if(l*0!==0)throw Error(rv+l);if(l>0)d.s=1;else if(l<0)l=-l,d.s=-1;else{d.s=0,d.e=0,d.d=[0];return}if(l===~~l&&l<1e7){d.e=0,d.d=[l];return}return e7(d,l.toString())}else if(typeof l!="string")throw Error(rv+l);if(l.charCodeAt(0)===45?(l=l.slice(1),d.s=-1):d.s=1,L8e.test(l))e7(d,l);else throw Error(rv+l)}if(o.prototype=xn,o.ROUND_UP=0,o.ROUND_DOWN=1,o.ROUND_CEIL=2,o.ROUND_FLOOR=3,o.ROUND_HALF_UP=4,o.ROUND_HALF_DOWN=5,o.ROUND_HALF_EVEN=6,o.ROUND_HALF_CEIL=7,o.ROUND_HALF_FLOOR=8,o.clone=Wse,o.config=o.set=F8e,e===void 0&&(e={}),e)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return o.config(e),o}function F8e(e){if(!e||typeof e!="object")throw Error(Nu+"Object expected");var t,r,n,o=["precision",1,qb,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<o.length;t+=3)if((n=e[r=o[t]])!==void 0)if(Wb(n)===n&&n>=o[t+1]&&n<=o[t+2])this[r]=n;else throw Error(rv+r+": "+n);if((n=e[r="LN10"])!==void 0)if(n==Math.LN10)this[r]=new this(n);else throw Error(rv+r+": "+n);return this}var $5=Wse(D8e);Wc=new $5(1);const La=$5;function z8e(e){return V8e(e)||U8e(e)||$8e(e)||B8e()}function B8e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $8e(e,t){if(e){if(typeof e=="string")return _F(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _F(e,t)}}function U8e(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function V8e(e){if(Array.isArray(e))return _F(e)}function _F(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var q8e=function(t){return t},Gse={"@@functional/placeholder":!0},Hse=function(t){return t===Gse},r7=function(t){return function r(){return arguments.length===0||arguments.length===1&&Hse(arguments.length<=0?void 0:arguments[0])?r:t.apply(void 0,arguments)}},W8e=function e(t,r){return t===1?r:r7(function(){for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];var d=o.filter(function(i){return i!==Gse}).length;return d>=t?r.apply(void 0,o):e(t-d,r7(function(){for(var i=arguments.length,g=new Array(i),_=0;_<i;_++)g[_]=arguments[_];var S=o.map(function(E){return Hse(E)?g.shift():E});return r.apply(void 0,z8e(S).concat(g))}))})},AR=function(t){return W8e(t.length,t)},xF=function(t,r){for(var n=[],o=t;o<r;++o)n[o-t]=o;return n},G8e=AR(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(r){return t[r]}).map(e)}),H8e=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(!r.length)return q8e;var o=r.reverse(),l=o[0],d=o.slice(1);return function(){return d.reduce(function(i,g){return g(i)},l.apply(void 0,arguments))}},bF=function(t){return Array.isArray(t)?t.reverse():t.split("").reverse.join("")},Kse=function(t){var r=null,n=null;return function(){for(var o=arguments.length,l=new Array(o),d=0;d<o;d++)l[d]=arguments[d];return r&&l.every(function(i,g){return i===r[g]})||(r=l,n=t.apply(void 0,l)),n}};function K8e(e){var t;return e===0?t=1:t=Math.floor(new La(e).abs().log(10).toNumber())+1,t}function Z8e(e,t,r){for(var n=new La(e),o=0,l=[];n.lt(t)&&o<1e5;)l.push(n.toNumber()),n=n.add(r),o++;return l}var X8e=AR(function(e,t,r){var n=+e,o=+t;return n+r*(o-n)}),Y8e=AR(function(e,t,r){var n=t-+e;return n=n||1/0,(r-e)/n}),J8e=AR(function(e,t,r){var n=t-+e;return n=n||1/0,Math.max(0,Math.min(1,(r-e)/n))});const PR={rangeStep:Z8e,getDigitCount:K8e,interpolateNumber:X8e,uninterpolateNumber:Y8e,uninterpolateTruncation:J8e};function wF(e){return tqe(e)||eqe(e)||Zse(e)||Q8e()}function Q8e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function eqe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function tqe(e){if(Array.isArray(e))return SF(e)}function QE(e,t){return iqe(e)||nqe(e,t)||Zse(e,t)||rqe()}function rqe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Zse(e,t){if(e){if(typeof e=="string")return SF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return SF(e,t)}}function SF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function nqe(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,o=!1,l=void 0;try{for(var d=e[Symbol.iterator](),i;!(n=(i=d.next()).done)&&(r.push(i.value),!(t&&r.length===t));n=!0);}catch(g){o=!0,l=g}finally{try{!n&&d.return!=null&&d.return()}finally{if(o)throw l}}return r}}function iqe(e){if(Array.isArray(e))return e}function Xse(e){var t=QE(e,2),r=t[0],n=t[1],o=r,l=n;return r>n&&(o=n,l=r),[o,l]}function Yse(e,t,r){if(e.lte(0))return new La(0);var n=PR.getDigitCount(e.toNumber()),o=new La(10).pow(n),l=e.div(o),d=n!==1?.05:.1,i=new La(Math.ceil(l.div(d).toNumber())).add(r).mul(d),g=i.mul(o);return t?g:new La(Math.ceil(g))}function aqe(e,t,r){var n=1,o=new La(e);if(!o.isint()&&r){var l=Math.abs(e);l<1?(n=new La(10).pow(PR.getDigitCount(e)-1),o=new La(Math.floor(o.div(n).toNumber())).mul(n)):l>1&&(o=new La(Math.floor(e)))}else e===0?o=new La(Math.floor((t-1)/2)):r||(o=new La(Math.floor(e)));var d=Math.floor((t-1)/2),i=H8e(G8e(function(g){return o.add(new La(g-d).mul(n)).toNumber()}),xF);return i(0,t)}function Jse(e,t,r,n){var o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new La(0),tickMin:new La(0),tickMax:new La(0)};var l=Yse(new La(t).sub(e).div(r-1),n,o),d;e<=0&&t>=0?d=new La(0):(d=new La(e).add(t).div(2),d=d.sub(new La(d).mod(l)));var i=Math.ceil(d.sub(e).div(l).toNumber()),g=Math.ceil(new La(t).sub(d).div(l).toNumber()),_=i+g+1;return _>r?Jse(e,t,r,n,o+1):(_<r&&(g=t>0?g+(r-_):g,i=t>0?i:i+(r-_)),{step:l,tickMin:d.sub(new La(i).mul(l)),tickMax:d.add(new La(g).mul(l))})}function oqe(e){var t=QE(e,2),r=t[0],n=t[1],o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,d=Math.max(o,2),i=Xse([r,n]),g=QE(i,2),_=g[0],S=g[1];if(_===-1/0||S===1/0){var E=S===1/0?[_].concat(wF(xF(0,o-1).map(function(){return 1/0}))):[].concat(wF(xF(0,o-1).map(function(){return-1/0})),[S]);return r>n?bF(E):E}if(_===S)return aqe(_,o,l);var T=Jse(_,S,d,l),C=T.step,N=T.tickMin,I=T.tickMax,j=PR.rangeStep(N,I.add(new La(.1).mul(C)),C);return r>n?bF(j):j}function sqe(e,t){var r=QE(e,2),n=r[0],o=r[1],l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,d=Xse([n,o]),i=QE(d,2),g=i[0],_=i[1];if(g===-1/0||_===1/0)return[n,o];if(g===_)return[g];var S=Math.max(t,2),E=Yse(new La(_).sub(g).div(S-1),l,0),T=[].concat(wF(PR.rangeStep(new La(g),new La(_).sub(new La(.99).mul(E)),E)),[_]);return n>o?bF(T):T}var lqe=Kse(oqe),cqe=Kse(sqe),uqe="Invariant failed";function wv(e,t){throw new Error(uqe)}var dqe=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function tb(e){"@babel/helpers - typeof";return tb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tb(e)}function ck(){return ck=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ck.apply(this,arguments)}function hqe(e,t){return gqe(e)||mqe(e,t)||pqe(e,t)||fqe()}function fqe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pqe(e,t){if(e){if(typeof e=="string")return n7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n7(e,t)}}function n7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function mqe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,_=!1;try{if(l=(r=r.call(e)).next,t!==0)for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){_=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(_)throw o}}return i}}function gqe(e){if(Array.isArray(e))return e}function yqe(e,t){if(e==null)return{};var r=vqe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function vqe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function _qe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xqe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,tle(n.key),n)}}function bqe(e,t,r){return t&&xqe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function wqe(e,t,r){return t=uk(t),Sqe(e,Qse()?Reflect.construct(t,r||[],uk(e).constructor):t.apply(e,r))}function Sqe(e,t){if(t&&(tb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Eqe(e)}function Eqe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qse(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Qse=function(){return!!e})()}function uk(e){return uk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},uk(e)}function Tqe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&EF(e,t)}function EF(e,t){return EF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},EF(e,t)}function ele(e,t,r){return t=tle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tle(e){var t=Aqe(e,"string");return tb(t)=="symbol"?t:t+""}function Aqe(e,t){if(tb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(tb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var o2=function(e){function t(){return _qe(this,t),wqe(this,t,arguments)}return Tqe(t,e),bqe(t,[{key:"render",value:function(){var n=this.props,o=n.offset,l=n.layout,d=n.width,i=n.dataKey,g=n.data,_=n.dataPointFormatter,S=n.xAxis,E=n.yAxis,T=yqe(n,dqe),C=Gn(T,!1);this.props.direction==="x"&&S.type!=="number"&&wv();var N=g.map(function(I){var j=_(I,i),D=j.x,R=j.y,F=j.value,B=j.errorVal;if(!B)return null;var U=[],Z,J;if(Array.isArray(B)){var te=hqe(B,2);Z=te[0],J=te[1]}else Z=J=B;if(l==="vertical"){var ae=S.scale,ne=R+o,ie=ne+d,ee=ne-d,oe=ae(F-Z),de=ae(F+J);U.push({x1:de,y1:ie,x2:de,y2:ee}),U.push({x1:oe,y1:ne,x2:de,y2:ne}),U.push({x1:oe,y1:ie,x2:oe,y2:ee})}else if(l==="horizontal"){var xe=E.scale,we=D+o,Ae=we-d,Ce=we+d,me=xe(F-Z),Pe=xe(F+J);U.push({x1:Ae,y1:Pe,x2:Ce,y2:Pe}),U.push({x1:we,y1:me,x2:we,y2:Pe}),U.push({x1:Ae,y1:me,x2:Ce,y2:me})}return He.createElement(ya,ck({className:"recharts-errorBar",key:"bar-".concat(U.map(function(ye){return"".concat(ye.x1,"-").concat(ye.x2,"-").concat(ye.y1,"-").concat(ye.y2)}))},C),U.map(function(ye){return He.createElement("line",ck({},ye,{key:"line-".concat(ye.x1,"-").concat(ye.x2,"-").concat(ye.y1,"-").concat(ye.y2)}))}))});return He.createElement(ya,{className:"recharts-errorBars"},N)}}])}(He.Component);ele(o2,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});ele(o2,"displayName","ErrorBar");function eT(e){"@babel/helpers - typeof";return eT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},eT(e)}function i7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function gy(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?i7(Object(r),!0).forEach(function(n){Pqe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Pqe(e,t,r){return t=Cqe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Cqe(e){var t=Oqe(e,"string");return eT(t)=="symbol"?t:t+""}function Oqe(e,t){if(eT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(eT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var rle=function(t){var r=t.children,n=t.formattedGraphicalItems,o=t.legendWidth,l=t.legendContent,d=zc(r,mh);if(!d)return null;var i=mh.defaultProps,g=i!==void 0?gy(gy({},i),d.props):{},_;return d.props&&d.props.payload?_=d.props&&d.props.payload:l==="children"?_=(n||[]).reduce(function(S,E){var T=E.item,C=E.props,N=C.sectors||C.data||[];return S.concat(N.map(function(I){return{type:d.props.iconType||T.props.legendType,value:I.name,color:I.fill,payload:I}}))},[]):_=(n||[]).map(function(S){var E=S.item,T=E.type.defaultProps,C=T!==void 0?gy(gy({},T),E.props):{},N=C.dataKey,I=C.name,j=C.legendType,D=C.hide;return{inactive:D,dataKey:N,type:g.iconType||j||"square",color:U5(E),value:I||N,payload:C}}),gy(gy(gy({},g),mh.getWithHeight(d,o)),{},{payload:_,item:d})};function tT(e){"@babel/helpers - typeof";return tT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tT(e)}function a7(e){return jqe(e)||Rqe(e)||Iqe(e)||kqe()}function kqe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Iqe(e,t){if(e){if(typeof e=="string")return TF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return TF(e,t)}}function Rqe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function jqe(e){if(Array.isArray(e))return TF(e)}function TF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function ko(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?o7(Object(r),!0).forEach(function(n){l0(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function l0(e,t,r){return t=Nqe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Nqe(e){var t=Mqe(e,"string");return tT(t)=="symbol"?t:t+""}function Mqe(e,t){if(tT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(tT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ms(e,t,r){return wi(e)||wi(t)?r:vs(t)?Xc(e,t,r):li(t)?t(e):r}function tE(e,t,r,n){var o=j8e(e,function(i){return ms(i,t)});if(r==="number"){var l=o.filter(function(i){return $r(i)||parseFloat(i)});return l.length?[TR(l),ER(l)]:[1/0,-1/0]}var d=n?o.filter(function(i){return!wi(i)}):o;return d.map(function(i){return vs(i)||i instanceof Date?i:""})}var Dqe=function(t){var r,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],o=arguments.length>2?arguments[2]:void 0,l=arguments.length>3?arguments[3]:void 0,d=-1,i=(r=n==null?void 0:n.length)!==null&&r!==void 0?r:0;if(i<=1)return 0;if(l&&l.axisType==="angleAxis"&&Math.abs(Math.abs(l.range[1]-l.range[0])-360)<=1e-6)for(var g=l.range,_=0;_<i;_++){var S=_>0?o[_-1].coordinate:o[i-1].coordinate,E=o[_].coordinate,T=_>=i-1?o[0].coordinate:o[_+1].coordinate,C=void 0;if(ql(E-S)!==ql(T-E)){var N=[];if(ql(T-E)===ql(g[1]-g[0])){C=T;var I=E+g[1]-g[0];N[0]=Math.min(I,(I+S)/2),N[1]=Math.max(I,(I+S)/2)}else{C=S;var j=T+g[1]-g[0];N[0]=Math.min(E,(j+E)/2),N[1]=Math.max(E,(j+E)/2)}var D=[Math.min(E,(C+E)/2),Math.max(E,(C+E)/2)];if(t>D[0]&&t<=D[1]||t>=N[0]&&t<=N[1]){d=o[_].index;break}}else{var R=Math.min(S,T),F=Math.max(S,T);if(t>(R+E)/2&&t<=(F+E)/2){d=o[_].index;break}}}else for(var B=0;B<i;B++)if(B===0&&t<=(n[B].coordinate+n[B+1].coordinate)/2||B>0&&B<i-1&&t>(n[B].coordinate+n[B-1].coordinate)/2&&t<=(n[B].coordinate+n[B+1].coordinate)/2||B===i-1&&t>(n[B].coordinate+n[B-1].coordinate)/2){d=n[B].index;break}return d},U5=function(t){var r,n=t,o=n.type.displayName,l=(r=t.type)!==null&&r!==void 0&&r.defaultProps?ko(ko({},t.type.defaultProps),t.props):t.props,d=l.stroke,i=l.fill,g;switch(o){case"Line":g=d;break;case"Area":case"Radar":g=d&&d!=="none"?d:i;break;default:g=i;break}return g},Lqe=function(t){var r=t.barSize,n=t.totalSize,o=t.stackGroups,l=o===void 0?{}:o;if(!l)return{};for(var d={},i=Object.keys(l),g=0,_=i.length;g<_;g++)for(var S=l[i[g]].stackGroups,E=Object.keys(S),T=0,C=E.length;T<C;T++){var N=S[E[T]],I=N.items,j=N.cateAxisId,D=I.filter(function(J){return Cf(J.type).indexOf("Bar")>=0});if(D&&D.length){var R=D[0].type.defaultProps,F=R!==void 0?ko(ko({},R),D[0].props):D[0].props,B=F.barSize,U=F[j];d[U]||(d[U]=[]);var Z=wi(B)?r:B;d[U].push({item:D[0],stackList:D.slice(1),barSize:wi(Z)?void 0:Wl(Z,n,0)})}}return d},Fqe=function(t){var r=t.barGap,n=t.barCategoryGap,o=t.bandSize,l=t.sizeList,d=l===void 0?[]:l,i=t.maxBarSize,g=d.length;if(g<1)return null;var _=Wl(r,o,0,!0),S,E=[];if(d[0].barSize===+d[0].barSize){var T=!1,C=o/g,N=d.reduce(function(B,U){return B+U.barSize||0},0);N+=(g-1)*_,N>=o&&(N-=(g-1)*_,_=0),N>=o&&C>0&&(T=!0,C*=.9,N=g*C);var I=(o-N)/2>>0,j={offset:I-_,size:0};S=d.reduce(function(B,U){var Z={item:U.item,position:{offset:j.offset+j.size+_,size:T?C:U.barSize}},J=[].concat(a7(B),[Z]);return j=J[J.length-1].position,U.stackList&&U.stackList.length&&U.stackList.forEach(function(te){J.push({item:te,position:j})}),J},E)}else{var D=Wl(n,o,0,!0);o-2*D-(g-1)*_<=0&&(_=0);var R=(o-2*D-(g-1)*_)/g;R>1&&(R>>=0);var F=i===+i?Math.min(R,i):R;S=d.reduce(function(B,U,Z){var J=[].concat(a7(B),[{item:U.item,position:{offset:D+(R+_)*Z+(R-F)/2,size:F}}]);return U.stackList&&U.stackList.length&&U.stackList.forEach(function(te){J.push({item:te,position:J[J.length-1].position})}),J},E)}return S},zqe=function(t,r,n,o){var l=n.children,d=n.width,i=n.margin,g=d-(i.left||0)-(i.right||0),_=rle({children:l,legendWidth:g});if(_){var S=o||{},E=S.width,T=S.height,C=_.align,N=_.verticalAlign,I=_.layout;if((I==="vertical"||I==="horizontal"&&N==="middle")&&C!=="center"&&$r(t[C]))return ko(ko({},t),{},l0({},C,t[C]+(E||0)));if((I==="horizontal"||I==="vertical"&&C==="center")&&N!=="middle"&&$r(t[N]))return ko(ko({},t),{},l0({},N,t[N]+(T||0)))}return t},Bqe=function(t,r,n){return wi(r)?!0:t==="horizontal"?r==="yAxis":t==="vertical"||n==="x"?r==="xAxis":n==="y"?r==="yAxis":!0},nle=function(t,r,n,o,l){var d=r.props.children,i=Yc(d,o2).filter(function(_){return Bqe(o,l,_.props.direction)});if(i&&i.length){var g=i.map(function(_){return _.props.dataKey});return t.reduce(function(_,S){var E=ms(S,n);if(wi(E))return _;var T=Array.isArray(E)?[TR(E),ER(E)]:[E,E],C=g.reduce(function(N,I){var j=ms(S,I,0),D=T[0]-Math.abs(Array.isArray(j)?j[0]:j),R=T[1]+Math.abs(Array.isArray(j)?j[1]:j);return[Math.min(D,N[0]),Math.max(R,N[1])]},[1/0,-1/0]);return[Math.min(C[0],_[0]),Math.max(C[1],_[1])]},[1/0,-1/0])}return null},$qe=function(t,r,n,o,l){var d=r.map(function(i){return nle(t,i,n,l,o)}).filter(function(i){return!wi(i)});return d&&d.length?d.reduce(function(i,g){return[Math.min(i[0],g[0]),Math.max(i[1],g[1])]},[1/0,-1/0]):null},ile=function(t,r,n,o,l){var d=r.map(function(g){var _=g.props.dataKey;return n==="number"&&_&&nle(t,g,_,o)||tE(t,_,n,l)});if(n==="number")return d.reduce(function(g,_){return[Math.min(g[0],_[0]),Math.max(g[1],_[1])]},[1/0,-1/0]);var i={};return d.reduce(function(g,_){for(var S=0,E=_.length;S<E;S++)i[_[S]]||(i[_[S]]=!0,g.push(_[S]));return g},[])},ale=function(t,r){return t==="horizontal"&&r==="xAxis"||t==="vertical"&&r==="yAxis"||t==="centric"&&r==="angleAxis"||t==="radial"&&r==="radiusAxis"},ole=function(t,r,n,o){if(o)return t.map(function(g){return g.coordinate});var l,d,i=t.map(function(g){return g.coordinate===r&&(l=!0),g.coordinate===n&&(d=!0),g.coordinate});return l||i.push(r),d||i.push(n),i},Ef=function(t,r,n){if(!t)return null;var o=t.scale,l=t.duplicateDomain,d=t.type,i=t.range,g=t.realScaleType==="scaleBand"?o.bandwidth()/2:2,_=(r||n)&&d==="category"&&o.bandwidth?o.bandwidth()/g:0;if(_=t.axisType==="angleAxis"&&(i==null?void 0:i.length)>=2?ql(i[0]-i[1])*2*_:_,r&&(t.ticks||t.niceTicks)){var S=(t.ticks||t.niceTicks).map(function(E){var T=l?l.indexOf(E):E;return{coordinate:o(T)+_,value:E,offset:_}});return S.filter(function(E){return!QT(E.coordinate)})}return t.isCategorical&&t.categoricalDomain?t.categoricalDomain.map(function(E,T){return{coordinate:o(E)+_,value:E,index:T,offset:_}}):o.ticks&&!n?o.ticks(t.tickCount).map(function(E){return{coordinate:o(E)+_,value:E,offset:_}}):o.domain().map(function(E,T){return{coordinate:o(E)+_,value:l?l[E]:E,index:T,offset:_}})},xD=new WeakMap,HP=function(t,r){if(typeof r!="function")return t;xD.has(t)||xD.set(t,new WeakMap);var n=xD.get(t);if(n.has(r))return n.get(r);var o=function(){t.apply(void 0,arguments),r.apply(void 0,arguments)};return n.set(r,o),o},sle=function(t,r,n){var o=t.scale,l=t.type,d=t.layout,i=t.axisType;if(o==="auto")return d==="radial"&&i==="radiusAxis"?{scale:HE(),realScaleType:"band"}:d==="radial"&&i==="angleAxis"?{scale:ik(),realScaleType:"linear"}:l==="category"&&r&&(r.indexOf("LineChart")>=0||r.indexOf("AreaChart")>=0||r.indexOf("ComposedChart")>=0&&!n)?{scale:eE(),realScaleType:"point"}:l==="category"?{scale:HE(),realScaleType:"band"}:{scale:ik(),realScaleType:"linear"};if(vv(o)){var g="scale".concat(uR(o));return{scale:(QH[g]||eE)(),realScaleType:QH[g]?g:"point"}}return li(o)?{scale:o}:{scale:eE(),realScaleType:"point"}},s7=1e-4,lle=function(t){var r=t.domain();if(!(!r||r.length<=2)){var n=r.length,o=t.range(),l=Math.min(o[0],o[1])-s7,d=Math.max(o[0],o[1])+s7,i=t(r[0]),g=t(r[n-1]);(i<l||i>d||g<l||g>d)&&t.domain([r[0],r[n-1]])}},Uqe=function(t,r){if(!t)return null;for(var n=0,o=t.length;n<o;n++)if(t[n].item===r)return t[n].position;return null},Vqe=function(t,r){if(!r||r.length!==2||!$r(r[0])||!$r(r[1]))return t;var n=Math.min(r[0],r[1]),o=Math.max(r[0],r[1]),l=[t[0],t[1]];return(!$r(t[0])||t[0]<n)&&(l[0]=n),(!$r(t[1])||t[1]>o)&&(l[1]=o),l[0]>o&&(l[0]=o),l[1]<n&&(l[1]=n),l},qqe=function(t){var r=t.length;if(!(r<=0))for(var n=0,o=t[0].length;n<o;++n)for(var l=0,d=0,i=0;i<r;++i){var g=QT(t[i][n][1])?t[i][n][0]:t[i][n][1];g>=0?(t[i][n][0]=l,t[i][n][1]=l+g,l=t[i][n][1]):(t[i][n][0]=d,t[i][n][1]=d+g,d=t[i][n][1])}},Wqe=function(t){var r=t.length;if(!(r<=0))for(var n=0,o=t[0].length;n<o;++n)for(var l=0,d=0;d<r;++d){var i=QT(t[d][n][1])?t[d][n][0]:t[d][n][1];i>=0?(t[d][n][0]=l,t[d][n][1]=l+i,l=t[d][n][1]):(t[d][n][0]=0,t[d][n][1]=0)}},Gqe={sign:qqe,expand:hDe,none:H0,silhouette:fDe,wiggle:pDe,positive:Wqe},Hqe=function(t,r,n){var o=r.map(function(i){return i.props.dataKey}),l=Gqe[n],d=dDe().keys(o).value(function(i,g){return+ms(i,g,0)}).order(X3).offset(l);return d(t)},Kqe=function(t,r,n,o,l,d){if(!t)return null;var i=d?r.reverse():r,g={},_=i.reduce(function(E,T){var C,N=(C=T.type)!==null&&C!==void 0&&C.defaultProps?ko(ko({},T.type.defaultProps),T.props):T.props,I=N.stackId,j=N.hide;if(j)return E;var D=N[n],R=E[D]||{hasStack:!1,stackGroups:{}};if(vs(I)){var F=R.stackGroups[I]||{numericAxisId:n,cateAxisId:o,items:[]};F.items.push(T),R.hasStack=!0,R.stackGroups[I]=F}else R.stackGroups[zb("_stackId_")]={numericAxisId:n,cateAxisId:o,items:[T]};return ko(ko({},E),{},l0({},D,R))},g),S={};return Object.keys(_).reduce(function(E,T){var C=_[T];if(C.hasStack){var N={};C.stackGroups=Object.keys(C.stackGroups).reduce(function(I,j){var D=C.stackGroups[j];return ko(ko({},I),{},l0({},j,{numericAxisId:n,cateAxisId:o,items:D.items,stackedData:Hqe(t,D.items,l)}))},N)}return ko(ko({},E),{},l0({},T,C))},S)},cle=function(t,r){var n=r.realScaleType,o=r.type,l=r.tickCount,d=r.originalDomain,i=r.allowDecimals,g=n||r.scale;if(g!=="auto"&&g!=="linear")return null;if(l&&o==="number"&&d&&(d[0]==="auto"||d[1]==="auto")){var _=t.domain();if(!_.length)return null;var S=lqe(_,l,i);return t.domain([TR(S),ER(S)]),{niceTicks:S}}if(l&&o==="number"){var E=t.domain(),T=cqe(E,l,i);return{niceTicks:T}}return null};function l7(e){var t=e.axis,r=e.ticks,n=e.bandSize,o=e.entry,l=e.index,d=e.dataKey;if(t.type==="category"){if(!t.allowDuplicatedCategory&&t.dataKey&&!wi(o[t.dataKey])){var i=LO(r,"value",o[t.dataKey]);if(i)return i.coordinate+n/2}return r[l]?r[l].coordinate+n/2:null}var g=ms(o,wi(d)?t.dataKey:d);return wi(g)?null:t.scale(g)}var c7=function(t){var r=t.axis,n=t.ticks,o=t.offset,l=t.bandSize,d=t.entry,i=t.index;if(r.type==="category")return n[i]?n[i].coordinate+o:null;var g=ms(d,r.dataKey,r.domain[i]);return wi(g)?null:r.scale(g)-l/2+o},Zqe=function(t){var r=t.numericAxis,n=r.scale.domain();if(r.type==="number"){var o=Math.min(n[0],n[1]),l=Math.max(n[0],n[1]);return o<=0&&l>=0?0:l<0?l:o}return n[0]},Xqe=function(t,r){var n,o=(n=t.type)!==null&&n!==void 0&&n.defaultProps?ko(ko({},t.type.defaultProps),t.props):t.props,l=o.stackId;if(vs(l)){var d=r[l];if(d){var i=d.items.indexOf(t);return i>=0?d.stackedData[i]:null}}return null},Yqe=function(t){return t.reduce(function(r,n){return[TR(n.concat([r[0]]).filter($r)),ER(n.concat([r[1]]).filter($r))]},[1/0,-1/0])},ule=function(t,r,n){return Object.keys(t).reduce(function(o,l){var d=t[l],i=d.stackedData,g=i.reduce(function(_,S){var E=Yqe(S.slice(r,n+1));return[Math.min(_[0],E[0]),Math.max(_[1],E[1])]},[1/0,-1/0]);return[Math.min(g[0],o[0]),Math.max(g[1],o[1])]},[1/0,-1/0]).map(function(o){return o===1/0||o===-1/0?0:o})},u7=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,d7=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,AF=function(t,r,n){if(li(t))return t(r,n);if(!Array.isArray(t))return r;var o=[];if($r(t[0]))o[0]=n?t[0]:Math.min(t[0],r[0]);else if(u7.test(t[0])){var l=+u7.exec(t[0])[1];o[0]=r[0]-l}else li(t[0])?o[0]=t[0](r[0]):o[0]=r[0];if($r(t[1]))o[1]=n?t[1]:Math.max(t[1],r[1]);else if(d7.test(t[1])){var d=+d7.exec(t[1])[1];o[1]=r[1]+d}else li(t[1])?o[1]=t[1](r[1]):o[1]=r[1];return o},dk=function(t,r,n){if(t&&t.scale&&t.scale.bandwidth){var o=t.scale.bandwidth();if(!n||o>0)return o}if(t&&r&&r.length>=2){for(var l=g5(r,function(E){return E.coordinate}),d=1/0,i=1,g=l.length;i<g;i++){var _=l[i],S=l[i-1];d=Math.min((_.coordinate||0)-(S.coordinate||0),d)}return d===1/0?0:d}return n?void 0:0},h7=function(t,r,n){return!t||!t.length||a2(t,Xc(n,"type.defaultProps.domain"))?r:t},dle=function(t,r){var n=t.type.defaultProps?ko(ko({},t.type.defaultProps),t.props):t.props,o=n.dataKey,l=n.name,d=n.unit,i=n.formatter,g=n.tooltipType,_=n.chartType,S=n.hide;return ko(ko({},Gn(t,!1)),{},{dataKey:o,unit:d,formatter:i,name:l||o,color:U5(t),value:ms(r,o),type:g,payload:r,chartType:_,hide:S})};function rT(e){"@babel/helpers - typeof";return rT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rT(e)}function f7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function pf(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?f7(Object(r),!0).forEach(function(n){hle(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hle(e,t,r){return t=Jqe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Jqe(e){var t=Qqe(e,"string");return rT(t)=="symbol"?t:t+""}function Qqe(e,t){if(rT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(rT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function e9e(e,t){return i9e(e)||n9e(e,t)||r9e(e,t)||t9e()}function t9e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function r9e(e,t){if(e){if(typeof e=="string")return p7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return p7(e,t)}}function p7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function n9e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,_=!1;try{if(l=(r=r.call(e)).next,t!==0)for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){_=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(_)throw o}}return i}}function i9e(e){if(Array.isArray(e))return e}var hk=Math.PI/180,a9e=function(t){return t*180/Math.PI},Xa=function(t,r,n,o){return{x:t+Math.cos(-hk*o)*n,y:r+Math.sin(-hk*o)*n}},fle=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(t-(n.left||0)-(n.right||0)),Math.abs(r-(n.top||0)-(n.bottom||0)))/2},o9e=function(t,r,n,o,l){var d=t.width,i=t.height,g=t.startAngle,_=t.endAngle,S=Wl(t.cx,d,d/2),E=Wl(t.cy,i,i/2),T=fle(d,i,n),C=Wl(t.innerRadius,T,0),N=Wl(t.outerRadius,T,T*.8),I=Object.keys(r);return I.reduce(function(j,D){var R=r[D],F=R.domain,B=R.reversed,U;if(wi(R.range))o==="angleAxis"?U=[g,_]:o==="radiusAxis"&&(U=[C,N]),B&&(U=[U[1],U[0]]);else{U=R.range;var Z=U,J=e9e(Z,2);g=J[0],_=J[1]}var te=sle(R,l),ae=te.realScaleType,ne=te.scale;ne.domain(F).range(U),lle(ne);var ie=cle(ne,pf(pf({},R),{},{realScaleType:ae})),ee=pf(pf(pf({},R),ie),{},{range:U,radius:N,realScaleType:ae,scale:ne,cx:S,cy:E,innerRadius:C,outerRadius:N,startAngle:g,endAngle:_});return pf(pf({},j),{},hle({},D,ee))},{})},s9e=function(t,r){var n=t.x,o=t.y,l=r.x,d=r.y;return Math.sqrt(Math.pow(n-l,2)+Math.pow(o-d,2))},l9e=function(t,r){var n=t.x,o=t.y,l=r.cx,d=r.cy,i=s9e({x:n,y:o},{x:l,y:d});if(i<=0)return{radius:i};var g=(n-l)/i,_=Math.acos(g);return o>d&&(_=2*Math.PI-_),{radius:i,angle:a9e(_),angleInRadian:_}},c9e=function(t){var r=t.startAngle,n=t.endAngle,o=Math.floor(r/360),l=Math.floor(n/360),d=Math.min(o,l);return{startAngle:r-d*360,endAngle:n-d*360}},u9e=function(t,r){var n=r.startAngle,o=r.endAngle,l=Math.floor(n/360),d=Math.floor(o/360),i=Math.min(l,d);return t+i*360},m7=function(t,r){var n=t.x,o=t.y,l=l9e({x:n,y:o},r),d=l.radius,i=l.angle,g=r.innerRadius,_=r.outerRadius;if(d<g||d>_)return!1;if(d===0)return!0;var S=c9e(r),E=S.startAngle,T=S.endAngle,C=i,N;if(E<=T){for(;C>T;)C-=360;for(;C<E;)C+=360;N=C>=E&&C<=T}else{for(;C>E;)C-=360;for(;C<T;)C+=360;N=C>=T&&C<=E}return N?pf(pf({},r),{},{radius:d,angle:u9e(C,r)}):null},ple=function(t){return!W.isValidElement(t)&&!li(t)&&typeof t!="boolean"?t.className:""};function nT(e){"@babel/helpers - typeof";return nT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nT(e)}var d9e=["offset"];function h9e(e){return g9e(e)||m9e(e)||p9e(e)||f9e()}function f9e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function p9e(e,t){if(e){if(typeof e=="string")return PF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return PF(e,t)}}function m9e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function g9e(e){if(Array.isArray(e))return PF(e)}function PF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function y9e(e,t){if(e==null)return{};var r=v9e(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function v9e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function g7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function us(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?g7(Object(r),!0).forEach(function(n){_9e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _9e(e,t,r){return t=x9e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function x9e(e){var t=b9e(e,"string");return nT(t)=="symbol"?t:t+""}function b9e(e,t){if(nT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(nT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function iT(){return iT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},iT.apply(this,arguments)}var w9e=function(t){var r=t.value,n=t.formatter,o=wi(t.children)?r:t.children;return li(n)?n(o):o},S9e=function(t,r){var n=ql(r-t),o=Math.min(Math.abs(r-t),360);return n*o},E9e=function(t,r,n){var o=t.position,l=t.viewBox,d=t.offset,i=t.className,g=l,_=g.cx,S=g.cy,E=g.innerRadius,T=g.outerRadius,C=g.startAngle,N=g.endAngle,I=g.clockWise,j=(E+T)/2,D=S9e(C,N),R=D>=0?1:-1,F,B;o==="insideStart"?(F=C+R*d,B=I):o==="insideEnd"?(F=N-R*d,B=!I):o==="end"&&(F=N+R*d,B=I),B=D<=0?B:!B;var U=Xa(_,S,j,F),Z=Xa(_,S,j,F+(B?1:-1)*359),J="M".concat(U.x,",").concat(U.y,`
    A`).concat(j,",").concat(j,",0,1,").concat(B?0:1,`,
    `).concat(Z.x,",").concat(Z.y),te=wi(t.id)?zb("recharts-radial-line-"):t.id;return He.createElement("text",iT({},n,{dominantBaseline:"central",className:Ti("recharts-radial-bar-label",i)}),He.createElement("defs",null,He.createElement("path",{id:te,d:J})),He.createElement("textPath",{xlinkHref:"#".concat(te)},r))},T9e=function(t){var r=t.viewBox,n=t.offset,o=t.position,l=r,d=l.cx,i=l.cy,g=l.innerRadius,_=l.outerRadius,S=l.startAngle,E=l.endAngle,T=(S+E)/2;if(o==="outside"){var C=Xa(d,i,_+n,T),N=C.x,I=C.y;return{x:N,y:I,textAnchor:N>=d?"start":"end",verticalAnchor:"middle"}}if(o==="center")return{x:d,y:i,textAnchor:"middle",verticalAnchor:"middle"};if(o==="centerTop")return{x:d,y:i,textAnchor:"middle",verticalAnchor:"start"};if(o==="centerBottom")return{x:d,y:i,textAnchor:"middle",verticalAnchor:"end"};var j=(g+_)/2,D=Xa(d,i,j,T),R=D.x,F=D.y;return{x:R,y:F,textAnchor:"middle",verticalAnchor:"middle"}},A9e=function(t){var r=t.viewBox,n=t.parentViewBox,o=t.offset,l=t.position,d=r,i=d.x,g=d.y,_=d.width,S=d.height,E=S>=0?1:-1,T=E*o,C=E>0?"end":"start",N=E>0?"start":"end",I=_>=0?1:-1,j=I*o,D=I>0?"end":"start",R=I>0?"start":"end";if(l==="top"){var F={x:i+_/2,y:g-E*o,textAnchor:"middle",verticalAnchor:C};return us(us({},F),n?{height:Math.max(g-n.y,0),width:_}:{})}if(l==="bottom"){var B={x:i+_/2,y:g+S+T,textAnchor:"middle",verticalAnchor:N};return us(us({},B),n?{height:Math.max(n.y+n.height-(g+S),0),width:_}:{})}if(l==="left"){var U={x:i-j,y:g+S/2,textAnchor:D,verticalAnchor:"middle"};return us(us({},U),n?{width:Math.max(U.x-n.x,0),height:S}:{})}if(l==="right"){var Z={x:i+_+j,y:g+S/2,textAnchor:R,verticalAnchor:"middle"};return us(us({},Z),n?{width:Math.max(n.x+n.width-Z.x,0),height:S}:{})}var J=n?{width:_,height:S}:{};return l==="insideLeft"?us({x:i+j,y:g+S/2,textAnchor:R,verticalAnchor:"middle"},J):l==="insideRight"?us({x:i+_-j,y:g+S/2,textAnchor:D,verticalAnchor:"middle"},J):l==="insideTop"?us({x:i+_/2,y:g+T,textAnchor:"middle",verticalAnchor:N},J):l==="insideBottom"?us({x:i+_/2,y:g+S-T,textAnchor:"middle",verticalAnchor:C},J):l==="insideTopLeft"?us({x:i+j,y:g+T,textAnchor:R,verticalAnchor:N},J):l==="insideTopRight"?us({x:i+_-j,y:g+T,textAnchor:D,verticalAnchor:N},J):l==="insideBottomLeft"?us({x:i+j,y:g+S-T,textAnchor:R,verticalAnchor:C},J):l==="insideBottomRight"?us({x:i+_-j,y:g+S-T,textAnchor:D,verticalAnchor:C},J):Mb(l)&&($r(l.x)||Fy(l.x))&&($r(l.y)||Fy(l.y))?us({x:i+Wl(l.x,_),y:g+Wl(l.y,S),textAnchor:"end",verticalAnchor:"end"},J):us({x:i+_/2,y:g+S/2,textAnchor:"middle",verticalAnchor:"middle"},J)},P9e=function(t){return"cx"in t&&$r(t.cx)};function Os(e){var t=e.offset,r=t===void 0?5:t,n=y9e(e,d9e),o=us({offset:r},n),l=o.viewBox,d=o.position,i=o.value,g=o.children,_=o.content,S=o.className,E=S===void 0?"":S,T=o.textBreakAll;if(!l||wi(i)&&wi(g)&&!W.isValidElement(_)&&!li(_))return null;if(W.isValidElement(_))return W.cloneElement(_,o);var C;if(li(_)){if(C=W.createElement(_,o),W.isValidElement(C))return C}else C=w9e(o);var N=P9e(l),I=Gn(o,!0);if(N&&(d==="insideStart"||d==="insideEnd"||d==="end"))return E9e(o,C,I);var j=N?T9e(o):A9e(o);return He.createElement(xv,iT({className:Ti("recharts-label",E)},I,j,{breakAll:T}),C)}Os.displayName="Label";var mle=function(t){var r=t.cx,n=t.cy,o=t.angle,l=t.startAngle,d=t.endAngle,i=t.r,g=t.radius,_=t.innerRadius,S=t.outerRadius,E=t.x,T=t.y,C=t.top,N=t.left,I=t.width,j=t.height,D=t.clockWise,R=t.labelViewBox;if(R)return R;if($r(I)&&$r(j)){if($r(E)&&$r(T))return{x:E,y:T,width:I,height:j};if($r(C)&&$r(N))return{x:C,y:N,width:I,height:j}}return $r(E)&&$r(T)?{x:E,y:T,width:0,height:0}:$r(r)&&$r(n)?{cx:r,cy:n,startAngle:l||o||0,endAngle:d||o||0,innerRadius:_||0,outerRadius:S||g||i||0,clockWise:D}:t.viewBox?t.viewBox:{}},C9e=function(t,r){return t?t===!0?He.createElement(Os,{key:"label-implicit",viewBox:r}):vs(t)?He.createElement(Os,{key:"label-implicit",viewBox:r,value:t}):W.isValidElement(t)?t.type===Os?W.cloneElement(t,{key:"label-implicit",viewBox:r}):He.createElement(Os,{key:"label-implicit",content:t,viewBox:r}):li(t)?He.createElement(Os,{key:"label-implicit",content:t,viewBox:r}):Mb(t)?He.createElement(Os,iT({viewBox:r},t,{key:"label-implicit"})):null:null},O9e=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&n&&!t.label)return null;var o=t.children,l=mle(t),d=Yc(o,Os).map(function(g,_){return W.cloneElement(g,{viewBox:r||l,key:"label-".concat(_)})});if(!n)return d;var i=C9e(t.label,r||l);return[i].concat(h9e(d))};Os.parseViewBox=mle;Os.renderCallByParent=O9e;function k9e(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var I9e=k9e;const R9e=_a(I9e);function aT(e){"@babel/helpers - typeof";return aT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},aT(e)}var j9e=["valueAccessor"],N9e=["data","dataKey","clockWise","id","textBreakAll"];function M9e(e){return z9e(e)||F9e(e)||L9e(e)||D9e()}function D9e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function L9e(e,t){if(e){if(typeof e=="string")return CF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return CF(e,t)}}function F9e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function z9e(e){if(Array.isArray(e))return CF(e)}function CF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function fk(){return fk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},fk.apply(this,arguments)}function y7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function v7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?y7(Object(r),!0).forEach(function(n){B9e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function B9e(e,t,r){return t=$9e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $9e(e){var t=U9e(e,"string");return aT(t)=="symbol"?t:t+""}function U9e(e,t){if(aT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(aT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function _7(e,t){if(e==null)return{};var r=V9e(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function V9e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var q9e=function(t){return Array.isArray(t.value)?R9e(t.value):t.value};function kf(e){var t=e.valueAccessor,r=t===void 0?q9e:t,n=_7(e,j9e),o=n.data,l=n.dataKey,d=n.clockWise,i=n.id,g=n.textBreakAll,_=_7(n,N9e);return!o||!o.length?null:He.createElement(ya,{className:"recharts-label-list"},o.map(function(S,E){var T=wi(l)?r(S,E):ms(S&&S.payload,l),C=wi(i)?{}:{id:"".concat(i,"-").concat(E)};return He.createElement(Os,fk({},Gn(S,!0),_,C,{parentViewBox:S.parentViewBox,value:T,textBreakAll:g,viewBox:Os.parseViewBox(wi(d)?S:v7(v7({},S),{},{clockWise:d})),key:"label-".concat(E),index:E}))}))}kf.displayName="LabelList";function W9e(e,t){return e?e===!0?He.createElement(kf,{key:"labelList-implicit",data:t}):He.isValidElement(e)||li(e)?He.createElement(kf,{key:"labelList-implicit",data:t,content:e}):Mb(e)?He.createElement(kf,fk({data:t},e,{key:"labelList-implicit"})):null:null}function G9e(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var n=e.children,o=Yc(n,kf).map(function(d,i){return W.cloneElement(d,{data:t,key:"labelList-".concat(i)})});if(!r)return o;var l=W9e(e.label,t);return[l].concat(M9e(o))}kf.renderCallByParent=G9e;function oT(e){"@babel/helpers - typeof";return oT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oT(e)}function OF(){return OF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},OF.apply(this,arguments)}function x7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function b7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?x7(Object(r),!0).forEach(function(n){H9e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function H9e(e,t,r){return t=K9e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function K9e(e){var t=Z9e(e,"string");return oT(t)=="symbol"?t:t+""}function Z9e(e,t){if(oT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(oT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var X9e=function(t,r){var n=ql(r-t),o=Math.min(Math.abs(r-t),359.999);return n*o},KP=function(t){var r=t.cx,n=t.cy,o=t.radius,l=t.angle,d=t.sign,i=t.isExternal,g=t.cornerRadius,_=t.cornerIsExternal,S=g*(i?1:-1)+o,E=Math.asin(g/S)/hk,T=_?l:l+d*E,C=Xa(r,n,S,T),N=Xa(r,n,o,T),I=_?l-d*E:l,j=Xa(r,n,S*Math.cos(E*hk),I);return{center:C,circleTangency:N,lineTangency:j,theta:E}},gle=function(t){var r=t.cx,n=t.cy,o=t.innerRadius,l=t.outerRadius,d=t.startAngle,i=t.endAngle,g=X9e(d,i),_=d+g,S=Xa(r,n,l,d),E=Xa(r,n,l,_),T="M ".concat(S.x,",").concat(S.y,`
    A `).concat(l,",").concat(l,`,0,
    `).concat(+(Math.abs(g)>180),",").concat(+(d>_),`,
    `).concat(E.x,",").concat(E.y,`
  `);if(o>0){var C=Xa(r,n,o,d),N=Xa(r,n,o,_);T+="L ".concat(N.x,",").concat(N.y,`
            A `).concat(o,",").concat(o,`,0,
            `).concat(+(Math.abs(g)>180),",").concat(+(d<=_),`,
            `).concat(C.x,",").concat(C.y," Z")}else T+="L ".concat(r,",").concat(n," Z");return T},Y9e=function(t){var r=t.cx,n=t.cy,o=t.innerRadius,l=t.outerRadius,d=t.cornerRadius,i=t.forceCornerRadius,g=t.cornerIsExternal,_=t.startAngle,S=t.endAngle,E=ql(S-_),T=KP({cx:r,cy:n,radius:l,angle:_,sign:E,cornerRadius:d,cornerIsExternal:g}),C=T.circleTangency,N=T.lineTangency,I=T.theta,j=KP({cx:r,cy:n,radius:l,angle:S,sign:-E,cornerRadius:d,cornerIsExternal:g}),D=j.circleTangency,R=j.lineTangency,F=j.theta,B=g?Math.abs(_-S):Math.abs(_-S)-I-F;if(B<0)return i?"M ".concat(N.x,",").concat(N.y,`
        a`).concat(d,",").concat(d,",0,0,1,").concat(d*2,`,0
        a`).concat(d,",").concat(d,",0,0,1,").concat(-d*2,`,0
      `):gle({cx:r,cy:n,innerRadius:o,outerRadius:l,startAngle:_,endAngle:S});var U="M ".concat(N.x,",").concat(N.y,`
    A`).concat(d,",").concat(d,",0,0,").concat(+(E<0),",").concat(C.x,",").concat(C.y,`
    A`).concat(l,",").concat(l,",0,").concat(+(B>180),",").concat(+(E<0),",").concat(D.x,",").concat(D.y,`
    A`).concat(d,",").concat(d,",0,0,").concat(+(E<0),",").concat(R.x,",").concat(R.y,`
  `);if(o>0){var Z=KP({cx:r,cy:n,radius:o,angle:_,sign:E,isExternal:!0,cornerRadius:d,cornerIsExternal:g}),J=Z.circleTangency,te=Z.lineTangency,ae=Z.theta,ne=KP({cx:r,cy:n,radius:o,angle:S,sign:-E,isExternal:!0,cornerRadius:d,cornerIsExternal:g}),ie=ne.circleTangency,ee=ne.lineTangency,oe=ne.theta,de=g?Math.abs(_-S):Math.abs(_-S)-ae-oe;if(de<0&&d===0)return"".concat(U,"L").concat(r,",").concat(n,"Z");U+="L".concat(ee.x,",").concat(ee.y,`
      A`).concat(d,",").concat(d,",0,0,").concat(+(E<0),",").concat(ie.x,",").concat(ie.y,`
      A`).concat(o,",").concat(o,",0,").concat(+(de>180),",").concat(+(E>0),",").concat(J.x,",").concat(J.y,`
      A`).concat(d,",").concat(d,",0,0,").concat(+(E<0),",").concat(te.x,",").concat(te.y,"Z")}else U+="L".concat(r,",").concat(n,"Z");return U},J9e={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},yle=function(t){var r=b7(b7({},J9e),t),n=r.cx,o=r.cy,l=r.innerRadius,d=r.outerRadius,i=r.cornerRadius,g=r.forceCornerRadius,_=r.cornerIsExternal,S=r.startAngle,E=r.endAngle,T=r.className;if(d<l||S===E)return null;var C=Ti("recharts-sector",T),N=d-l,I=Wl(i,N,0,!0),j;return I>0&&Math.abs(S-E)<360?j=Y9e({cx:n,cy:o,innerRadius:l,outerRadius:d,cornerRadius:Math.min(I,N/2),forceCornerRadius:g,cornerIsExternal:_,startAngle:S,endAngle:E}):j=gle({cx:n,cy:o,innerRadius:l,outerRadius:d,startAngle:S,endAngle:E}),He.createElement("path",OF({},Gn(r,!0),{className:C,d:j,role:"img"}))};function sT(e){"@babel/helpers - typeof";return sT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sT(e)}function kF(){return kF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},kF.apply(this,arguments)}function w7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function S7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?w7(Object(r),!0).forEach(function(n){Q9e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Q9e(e,t,r){return t=eWe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function eWe(e){var t=tWe(e,"string");return sT(t)=="symbol"?t:t+""}function tWe(e,t){if(sT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(sT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var E7={curveBasisClosed:eDe,curveBasisOpen:tDe,curveBasis:QMe,curveBumpX:zMe,curveBumpY:BMe,curveLinearClosed:rDe,curveLinear:hR,curveMonotoneX:nDe,curveMonotoneY:iDe,curveNatural:aDe,curveStep:oDe,curveStepAfter:lDe,curveStepBefore:sDe},ZP=function(t){return t.x===+t.x&&t.y===+t.y},_S=function(t){return t.x},xS=function(t){return t.y},rWe=function(t,r){if(li(t))return t;var n="curve".concat(uR(t));return(n==="curveMonotone"||n==="curveBump")&&r?E7["".concat(n).concat(r==="vertical"?"Y":"X")]:E7[n]||hR},nWe=function(t){var r=t.type,n=r===void 0?"linear":r,o=t.points,l=o===void 0?[]:o,d=t.baseLine,i=t.layout,g=t.connectNulls,_=g===void 0?!1:g,S=rWe(n,i),E=_?l.filter(function(I){return ZP(I)}):l,T;if(Array.isArray(d)){var C=_?d.filter(function(I){return ZP(I)}):d,N=E.map(function(I,j){return S7(S7({},I),{},{base:C[j]})});return i==="vertical"?T=zP().y(xS).x1(_S).x0(function(I){return I.base.x}):T=zP().x(_S).y1(xS).y0(function(I){return I.base.y}),T.defined(ZP).curve(S),T(N)}return i==="vertical"&&$r(d)?T=zP().y(xS).x1(_S).x0(d):$r(d)?T=zP().x(_S).y1(xS).y0(d):T=uoe().x(_S).y(xS),T.defined(ZP).curve(S),T(E)},pk=function(t){var r=t.className,n=t.points,o=t.path,l=t.pathRef;if((!n||!n.length)&&!o)return null;var d=n&&n.length?nWe(t):o;return W.createElement("path",kF({},Gn(t,!1),FO(t),{className:Ti("recharts-curve",r),d,ref:l}))},vle={exports:{}},iWe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",aWe=iWe,oWe=aWe;function _le(){}function xle(){}xle.resetWarningCache=_le;var sWe=function(){function e(n,o,l,d,i,g){if(g!==oWe){var _=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw _.name="Invariant Violation",_}}e.isRequired=e;function t(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:xle,resetWarningCache:_le};return r.PropTypes=r,r};vle.exports=sWe();var lWe=vle.exports;const Ca=_a(lWe);var cWe=Object.getOwnPropertyNames,uWe=Object.getOwnPropertySymbols,dWe=Object.prototype.hasOwnProperty;function T7(e,t){return function(n,o,l){return e(n,o,l)&&t(n,o,l)}}function XP(e){return function(r,n,o){if(!r||!n||typeof r!="object"||typeof n!="object")return e(r,n,o);var l=o.cache,d=l.get(r),i=l.get(n);if(d&&i)return d===n&&i===r;l.set(r,n),l.set(n,r);var g=e(r,n,o);return l.delete(r),l.delete(n),g}}function A7(e){return cWe(e).concat(uWe(e))}var hWe=Object.hasOwn||function(e,t){return dWe.call(e,t)};function Lv(e,t){return e===t||!e&&!t&&e!==e&&t!==t}var fWe="__v",pWe="__o",mWe="_owner",P7=Object.getOwnPropertyDescriptor,C7=Object.keys;function gWe(e,t,r){var n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(!r.equals(e[n],t[n],n,n,e,t,r))return!1;return!0}function yWe(e,t){return Lv(e.getTime(),t.getTime())}function vWe(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function _We(e,t){return e===t}function O7(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var o=new Array(n),l=e.entries(),d,i,g=0;(d=l.next())&&!d.done;){for(var _=t.entries(),S=!1,E=0;(i=_.next())&&!i.done;){if(o[E]){E++;continue}var T=d.value,C=i.value;if(r.equals(T[0],C[0],g,E,e,t,r)&&r.equals(T[1],C[1],T[0],C[0],e,t,r)){S=o[E]=!0;break}E++}if(!S)return!1;g++}return!0}var xWe=Lv;function bWe(e,t,r){var n=C7(e),o=n.length;if(C7(t).length!==o)return!1;for(;o-- >0;)if(!ble(e,t,r,n[o]))return!1;return!0}function bS(e,t,r){var n=A7(e),o=n.length;if(A7(t).length!==o)return!1;for(var l,d,i;o-- >0;)if(l=n[o],!ble(e,t,r,l)||(d=P7(e,l),i=P7(t,l),(d||i)&&(!d||!i||d.configurable!==i.configurable||d.enumerable!==i.enumerable||d.writable!==i.writable)))return!1;return!0}function wWe(e,t){return Lv(e.valueOf(),t.valueOf())}function SWe(e,t){return e.source===t.source&&e.flags===t.flags}function k7(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var o=new Array(n),l=e.values(),d,i;(d=l.next())&&!d.done;){for(var g=t.values(),_=!1,S=0;(i=g.next())&&!i.done;){if(!o[S]&&r.equals(d.value,i.value,d.value,i.value,e,t,r)){_=o[S]=!0;break}S++}if(!_)return!1}return!0}function EWe(e,t){var r=e.length;if(t.length!==r)return!1;for(;r-- >0;)if(e[r]!==t[r])return!1;return!0}function TWe(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function ble(e,t,r,n){return(n===mWe||n===pWe||n===fWe)&&(e.$$typeof||t.$$typeof)?!0:hWe(t,n)&&r.equals(e[n],t[n],n,n,e,t,r)}var AWe="[object Arguments]",PWe="[object Boolean]",CWe="[object Date]",OWe="[object Error]",kWe="[object Map]",IWe="[object Number]",RWe="[object Object]",jWe="[object RegExp]",NWe="[object Set]",MWe="[object String]",DWe="[object URL]",LWe=Array.isArray,I7=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,R7=Object.assign,FWe=Object.prototype.toString.call.bind(Object.prototype.toString);function zWe(e){var t=e.areArraysEqual,r=e.areDatesEqual,n=e.areErrorsEqual,o=e.areFunctionsEqual,l=e.areMapsEqual,d=e.areNumbersEqual,i=e.areObjectsEqual,g=e.arePrimitiveWrappersEqual,_=e.areRegExpsEqual,S=e.areSetsEqual,E=e.areTypedArraysEqual,T=e.areUrlsEqual;return function(N,I,j){if(N===I)return!0;if(N==null||I==null)return!1;var D=typeof N;if(D!==typeof I)return!1;if(D!=="object")return D==="number"?d(N,I,j):D==="function"?o(N,I,j):!1;var R=N.constructor;if(R!==I.constructor)return!1;if(R===Object)return i(N,I,j);if(LWe(N))return t(N,I,j);if(I7!=null&&I7(N))return E(N,I,j);if(R===Date)return r(N,I,j);if(R===RegExp)return _(N,I,j);if(R===Map)return l(N,I,j);if(R===Set)return S(N,I,j);var F=FWe(N);return F===CWe?r(N,I,j):F===jWe?_(N,I,j):F===kWe?l(N,I,j):F===NWe?S(N,I,j):F===RWe?typeof N.then!="function"&&typeof I.then!="function"&&i(N,I,j):F===DWe?T(N,I,j):F===OWe?n(N,I,j):F===AWe?i(N,I,j):F===PWe||F===IWe||F===MWe?g(N,I,j):!1}}function BWe(e){var t=e.circular,r=e.createCustomConfig,n=e.strict,o={areArraysEqual:n?bS:gWe,areDatesEqual:yWe,areErrorsEqual:vWe,areFunctionsEqual:_We,areMapsEqual:n?T7(O7,bS):O7,areNumbersEqual:xWe,areObjectsEqual:n?bS:bWe,arePrimitiveWrappersEqual:wWe,areRegExpsEqual:SWe,areSetsEqual:n?T7(k7,bS):k7,areTypedArraysEqual:n?bS:EWe,areUrlsEqual:TWe};if(r&&(o=R7({},o,r(o))),t){var l=XP(o.areArraysEqual),d=XP(o.areMapsEqual),i=XP(o.areObjectsEqual),g=XP(o.areSetsEqual);o=R7({},o,{areArraysEqual:l,areMapsEqual:d,areObjectsEqual:i,areSetsEqual:g})}return o}function $We(e){return function(t,r,n,o,l,d,i){return e(t,r,i)}}function UWe(e){var t=e.circular,r=e.comparator,n=e.createState,o=e.equals,l=e.strict;if(n)return function(g,_){var S=n(),E=S.cache,T=E===void 0?t?new WeakMap:void 0:E,C=S.meta;return r(g,_,{cache:T,equals:o,meta:C,strict:l})};if(t)return function(g,_){return r(g,_,{cache:new WeakMap,equals:o,meta:void 0,strict:l})};var d={cache:void 0,equals:o,meta:void 0,strict:l};return function(g,_){return r(g,_,d)}}var VWe=fg();fg({strict:!0});fg({circular:!0});fg({circular:!0,strict:!0});fg({createInternalComparator:function(){return Lv}});fg({strict:!0,createInternalComparator:function(){return Lv}});fg({circular:!0,createInternalComparator:function(){return Lv}});fg({circular:!0,createInternalComparator:function(){return Lv},strict:!0});function fg(e){e===void 0&&(e={});var t=e.circular,r=t===void 0?!1:t,n=e.createInternalComparator,o=e.createState,l=e.strict,d=l===void 0?!1:l,i=BWe(e),g=zWe(i),_=n?n(g):$We(g);return UWe({circular:r,comparator:g,createState:o,equals:_,strict:d})}function qWe(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function j7(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=-1,n=function o(l){r<0&&(r=l),l-r>t?(e(l),r=-1):qWe(o)};requestAnimationFrame(n)}function IF(e){"@babel/helpers - typeof";return IF=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},IF(e)}function WWe(e){return ZWe(e)||KWe(e)||HWe(e)||GWe()}function GWe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function HWe(e,t){if(e){if(typeof e=="string")return N7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return N7(e,t)}}function N7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function KWe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function ZWe(e){if(Array.isArray(e))return e}function XWe(){var e={},t=function(){return null},r=!1,n=function o(l){if(!r){if(Array.isArray(l)){if(!l.length)return;var d=l,i=WWe(d),g=i[0],_=i.slice(1);if(typeof g=="number"){j7(o.bind(null,_),g);return}o(g),j7(o.bind(null,_));return}IF(l)==="object"&&(e=l,t(e)),typeof l=="function"&&l()}};return{stop:function(){r=!0},start:function(l){r=!1,n(l)},subscribe:function(l){return t=l,function(){t=function(){return null}}}}}function lT(e){"@babel/helpers - typeof";return lT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lT(e)}function M7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function D7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?M7(Object(r),!0).forEach(function(n){wle(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function wle(e,t,r){return t=YWe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function YWe(e){var t=JWe(e,"string");return lT(t)==="symbol"?t:String(t)}function JWe(e,t){if(lT(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(lT(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var QWe=function(t,r){return[Object.keys(t),Object.keys(r)].reduce(function(n,o){return n.filter(function(l){return o.includes(l)})})},eGe=function(t){return t},tGe=function(t){return t.replace(/([A-Z])/g,function(r){return"-".concat(r.toLowerCase())})},rE=function(t,r){return Object.keys(r).reduce(function(n,o){return D7(D7({},n),{},wle({},o,t(o,r[o])))},{})},L7=function(t,r,n){return t.map(function(o){return"".concat(tGe(o)," ").concat(r,"ms ").concat(n)}).join(",")};function rGe(e,t){return aGe(e)||iGe(e,t)||Sle(e,t)||nGe()}function nGe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iGe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,_=!1;try{if(l=(r=r.call(e)).next,t!==0)for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){_=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(_)throw o}}return i}}function aGe(e){if(Array.isArray(e))return e}function oGe(e){return cGe(e)||lGe(e)||Sle(e)||sGe()}function sGe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Sle(e,t){if(e){if(typeof e=="string")return RF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return RF(e,t)}}function lGe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function cGe(e){if(Array.isArray(e))return RF(e)}function RF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var mk=1e-4,Ele=function(t,r){return[0,3*t,3*r-6*t,3*t-3*r+1]},Tle=function(t,r){return t.map(function(n,o){return n*Math.pow(r,o)}).reduce(function(n,o){return n+o})},F7=function(t,r){return function(n){var o=Ele(t,r);return Tle(o,n)}},uGe=function(t,r){return function(n){var o=Ele(t,r),l=[].concat(oGe(o.map(function(d,i){return d*i}).slice(1)),[0]);return Tle(l,n)}},z7=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var o=r[0],l=r[1],d=r[2],i=r[3];if(r.length===1)switch(r[0]){case"linear":o=0,l=0,d=1,i=1;break;case"ease":o=.25,l=.1,d=.25,i=1;break;case"ease-in":o=.42,l=0,d=1,i=1;break;case"ease-out":o=.42,l=0,d=.58,i=1;break;case"ease-in-out":o=0,l=0,d=.58,i=1;break;default:{var g=r[0].split("(");if(g[0]==="cubic-bezier"&&g[1].split(")")[0].split(",").length===4){var _=g[1].split(")")[0].split(",").map(function(j){return parseFloat(j)}),S=rGe(_,4);o=S[0],l=S[1],d=S[2],i=S[3]}}}var E=F7(o,d),T=F7(l,i),C=uGe(o,d),N=function(D){return D>1?1:D<0?0:D},I=function(D){for(var R=D>1?1:D,F=R,B=0;B<8;++B){var U=E(F)-R,Z=C(F);if(Math.abs(U-R)<mk||Z<mk)return T(F);F=N(F-U/Z)}return T(F)};return I.isStepper=!1,I},dGe=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.stiff,n=r===void 0?100:r,o=t.damping,l=o===void 0?8:o,d=t.dt,i=d===void 0?17:d,g=function(S,E,T){var C=-(S-E)*n,N=T*l,I=T+(C-N)*i/1e3,j=T*i/1e3+S;return Math.abs(j-E)<mk&&Math.abs(I)<mk?[E,0]:[j,I]};return g.isStepper=!0,g.dt=i,g},hGe=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var o=r[0];if(typeof o=="string")switch(o){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return z7(o);case"spring":return dGe();default:if(o.split("(")[0]==="cubic-bezier")return z7(o)}return typeof o=="function"?o:null};function cT(e){"@babel/helpers - typeof";return cT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cT(e)}function B7(e){return mGe(e)||pGe(e)||Ale(e)||fGe()}function fGe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pGe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function mGe(e){if(Array.isArray(e))return NF(e)}function $7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function $s(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$7(Object(r),!0).forEach(function(n){jF(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jF(e,t,r){return t=gGe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gGe(e){var t=yGe(e,"string");return cT(t)==="symbol"?t:String(t)}function yGe(e,t){if(cT(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(cT(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function vGe(e,t){return bGe(e)||xGe(e,t)||Ale(e,t)||_Ge()}function _Ge(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ale(e,t){if(e){if(typeof e=="string")return NF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return NF(e,t)}}function NF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function xGe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,_=!1;try{if(l=(r=r.call(e)).next,t!==0)for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){_=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(_)throw o}}return i}}function bGe(e){if(Array.isArray(e))return e}var gk=function(t,r,n){return t+(r-t)*n},MF=function(t){var r=t.from,n=t.to;return r!==n},wGe=function e(t,r,n){var o=rE(function(l,d){if(MF(d)){var i=t(d.from,d.to,d.velocity),g=vGe(i,2),_=g[0],S=g[1];return $s($s({},d),{},{from:_,velocity:S})}return d},r);return n<1?rE(function(l,d){return MF(d)?$s($s({},d),{},{velocity:gk(d.velocity,o[l].velocity,n),from:gk(d.from,o[l].from,n)}):d},r):e(t,o,n-1)};const SGe=function(e,t,r,n,o){var l=QWe(e,t),d=l.reduce(function(j,D){return $s($s({},j),{},jF({},D,[e[D],t[D]]))},{}),i=l.reduce(function(j,D){return $s($s({},j),{},jF({},D,{from:e[D],velocity:0,to:t[D]}))},{}),g=-1,_,S,E=function(){return null},T=function(){return rE(function(D,R){return R.from},i)},C=function(){return!Object.values(i).filter(MF).length},N=function(D){_||(_=D);var R=D-_,F=R/r.dt;i=wGe(r,i,F),o($s($s($s({},e),t),T())),_=D,C()||(g=requestAnimationFrame(E))},I=function(D){S||(S=D);var R=(D-S)/n,F=rE(function(U,Z){return gk.apply(void 0,B7(Z).concat([r(R)]))},d);if(o($s($s($s({},e),t),F)),R<1)g=requestAnimationFrame(E);else{var B=rE(function(U,Z){return gk.apply(void 0,B7(Z).concat([r(1)]))},d);o($s($s($s({},e),t),B))}};return E=r.isStepper?N:I,function(){return requestAnimationFrame(E),function(){cancelAnimationFrame(g)}}};function rb(e){"@babel/helpers - typeof";return rb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rb(e)}var EGe=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function TGe(e,t){if(e==null)return{};var r=AGe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function AGe(e,t){if(e==null)return{};var r={},n=Object.keys(e),o,l;for(l=0;l<n.length;l++)o=n[l],!(t.indexOf(o)>=0)&&(r[o]=e[o]);return r}function bD(e){return kGe(e)||OGe(e)||CGe(e)||PGe()}function PGe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CGe(e,t){if(e){if(typeof e=="string")return DF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return DF(e,t)}}function OGe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function kGe(e){if(Array.isArray(e))return DF(e)}function DF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function U7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function ad(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?U7(Object(r),!0).forEach(function(n){DS(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function DS(e,t,r){return t=Ple(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function IGe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function RGe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ple(n.key),n)}}function jGe(e,t,r){return t&&RGe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ple(e){var t=NGe(e,"string");return rb(t)==="symbol"?t:String(t)}function NGe(e,t){if(rb(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(rb(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function MGe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&LF(e,t)}function LF(e,t){return LF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},LF(e,t)}function DGe(e){var t=LGe();return function(){var n=yk(e),o;if(t){var l=yk(this).constructor;o=Reflect.construct(n,arguments,l)}else o=n.apply(this,arguments);return FF(this,o)}}function FF(e,t){if(t&&(rb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return zF(e)}function zF(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function LGe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function yk(e){return yk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},yk(e)}var Oh=function(e){MGe(r,e);var t=DGe(r);function r(n,o){var l;IGe(this,r),l=t.call(this,n,o);var d=l.props,i=d.isActive,g=d.attributeName,_=d.from,S=d.to,E=d.steps,T=d.children,C=d.duration;if(l.handleStyleChange=l.handleStyleChange.bind(zF(l)),l.changeStyle=l.changeStyle.bind(zF(l)),!i||C<=0)return l.state={style:{}},typeof T=="function"&&(l.state={style:S}),FF(l);if(E&&E.length)l.state={style:E[0].style};else if(_){if(typeof T=="function")return l.state={style:_},FF(l);l.state={style:g?DS({},g,_):_}}else l.state={style:{}};return l}return jGe(r,[{key:"componentDidMount",value:function(){var o=this.props,l=o.isActive,d=o.canBegin;this.mounted=!0,!(!l||!d)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(o){var l=this.props,d=l.isActive,i=l.canBegin,g=l.attributeName,_=l.shouldReAnimate,S=l.to,E=l.from,T=this.state.style;if(i){if(!d){var C={style:g?DS({},g,S):S};this.state&&T&&(g&&T[g]!==S||!g&&T!==S)&&this.setState(C);return}if(!(VWe(o.to,S)&&o.canBegin&&o.isActive)){var N=!o.canBegin||!o.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var I=N||_?E:o.to;if(this.state&&T){var j={style:g?DS({},g,I):I};(g&&T[g]!==I||!g&&T!==I)&&this.setState(j)}this.runAnimation(ad(ad({},this.props),{},{from:I,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var o=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),o&&o()}},{key:"handleStyleChange",value:function(o){this.changeStyle(o)}},{key:"changeStyle",value:function(o){this.mounted&&this.setState({style:o})}},{key:"runJSAnimation",value:function(o){var l=this,d=o.from,i=o.to,g=o.duration,_=o.easing,S=o.begin,E=o.onAnimationEnd,T=o.onAnimationStart,C=SGe(d,i,hGe(_),g,this.changeStyle),N=function(){l.stopJSAnimation=C()};this.manager.start([T,S,N,g,E])}},{key:"runStepAnimation",value:function(o){var l=this,d=o.steps,i=o.begin,g=o.onAnimationStart,_=d[0],S=_.style,E=_.duration,T=E===void 0?0:E,C=function(I,j,D){if(D===0)return I;var R=j.duration,F=j.easing,B=F===void 0?"ease":F,U=j.style,Z=j.properties,J=j.onAnimationEnd,te=D>0?d[D-1]:j,ae=Z||Object.keys(U);if(typeof B=="function"||B==="spring")return[].concat(bD(I),[l.runJSAnimation.bind(l,{from:te.style,to:U,duration:R,easing:B}),R]);var ne=L7(ae,R,B),ie=ad(ad(ad({},te.style),U),{},{transition:ne});return[].concat(bD(I),[ie,R,J]).filter(eGe)};return this.manager.start([g].concat(bD(d.reduce(C,[S,Math.max(T,i)])),[o.onAnimationEnd]))}},{key:"runAnimation",value:function(o){this.manager||(this.manager=XWe());var l=o.begin,d=o.duration,i=o.attributeName,g=o.to,_=o.easing,S=o.onAnimationStart,E=o.onAnimationEnd,T=o.steps,C=o.children,N=this.manager;if(this.unSubscribe=N.subscribe(this.handleStyleChange),typeof _=="function"||typeof C=="function"||_==="spring"){this.runJSAnimation(o);return}if(T.length>1){this.runStepAnimation(o);return}var I=i?DS({},i,g):g,j=L7(Object.keys(I),d,_);N.start([S,l,ad(ad({},I),{},{transition:j}),d,E])}},{key:"render",value:function(){var o=this.props,l=o.children;o.begin;var d=o.duration;o.attributeName,o.easing;var i=o.isActive;o.steps,o.from,o.to,o.canBegin,o.onAnimationEnd,o.shouldReAnimate,o.onAnimationReStart;var g=TGe(o,EGe),_=W.Children.count(l),S=this.state.style;if(typeof l=="function")return l(S);if(!i||_===0||d<=0)return l;var E=function(C){var N=C.props,I=N.style,j=I===void 0?{}:I,D=N.className,R=W.cloneElement(C,ad(ad({},g),{},{style:ad(ad({},j),S),className:D}));return R};return _===1?E(W.Children.only(l)):He.createElement("div",null,W.Children.map(l,function(T){return E(T)}))}}]),r}(W.PureComponent);Oh.displayName="Animate";Oh.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};Oh.propTypes={from:Ca.oneOfType([Ca.object,Ca.string]),to:Ca.oneOfType([Ca.object,Ca.string]),attributeName:Ca.string,duration:Ca.number,begin:Ca.number,easing:Ca.oneOfType([Ca.string,Ca.func]),steps:Ca.arrayOf(Ca.shape({duration:Ca.number.isRequired,style:Ca.object.isRequired,easing:Ca.oneOfType([Ca.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),Ca.func]),properties:Ca.arrayOf("string"),onAnimationEnd:Ca.func})),children:Ca.oneOfType([Ca.node,Ca.func]),isActive:Ca.bool,canBegin:Ca.bool,onAnimationEnd:Ca.func,shouldReAnimate:Ca.bool,onAnimationStart:Ca.func,onAnimationReStart:Ca.func};function uT(e){"@babel/helpers - typeof";return uT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},uT(e)}function vk(){return vk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},vk.apply(this,arguments)}function FGe(e,t){return UGe(e)||$Ge(e,t)||BGe(e,t)||zGe()}function zGe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function BGe(e,t){if(e){if(typeof e=="string")return V7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return V7(e,t)}}function V7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function $Ge(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,_=!1;try{if(l=(r=r.call(e)).next,t!==0)for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){_=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(_)throw o}}return i}}function UGe(e){if(Array.isArray(e))return e}function q7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function W7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?q7(Object(r),!0).forEach(function(n){VGe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function VGe(e,t,r){return t=qGe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qGe(e){var t=WGe(e,"string");return uT(t)=="symbol"?t:t+""}function WGe(e,t){if(uT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(uT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var G7=function(t,r,n,o,l){var d=Math.min(Math.abs(n)/2,Math.abs(o)/2),i=o>=0?1:-1,g=n>=0?1:-1,_=o>=0&&n>=0||o<0&&n<0?1:0,S;if(d>0&&l instanceof Array){for(var E=[0,0,0,0],T=0,C=4;T<C;T++)E[T]=l[T]>d?d:l[T];S="M".concat(t,",").concat(r+i*E[0]),E[0]>0&&(S+="A ".concat(E[0],",").concat(E[0],",0,0,").concat(_,",").concat(t+g*E[0],",").concat(r)),S+="L ".concat(t+n-g*E[1],",").concat(r),E[1]>0&&(S+="A ".concat(E[1],",").concat(E[1],",0,0,").concat(_,`,
        `).concat(t+n,",").concat(r+i*E[1])),S+="L ".concat(t+n,",").concat(r+o-i*E[2]),E[2]>0&&(S+="A ".concat(E[2],",").concat(E[2],",0,0,").concat(_,`,
        `).concat(t+n-g*E[2],",").concat(r+o)),S+="L ".concat(t+g*E[3],",").concat(r+o),E[3]>0&&(S+="A ".concat(E[3],",").concat(E[3],",0,0,").concat(_,`,
        `).concat(t,",").concat(r+o-i*E[3])),S+="Z"}else if(d>0&&l===+l&&l>0){var N=Math.min(d,l);S="M ".concat(t,",").concat(r+i*N,`
            A `).concat(N,",").concat(N,",0,0,").concat(_,",").concat(t+g*N,",").concat(r,`
            L `).concat(t+n-g*N,",").concat(r,`
            A `).concat(N,",").concat(N,",0,0,").concat(_,",").concat(t+n,",").concat(r+i*N,`
            L `).concat(t+n,",").concat(r+o-i*N,`
            A `).concat(N,",").concat(N,",0,0,").concat(_,",").concat(t+n-g*N,",").concat(r+o,`
            L `).concat(t+g*N,",").concat(r+o,`
            A `).concat(N,",").concat(N,",0,0,").concat(_,",").concat(t,",").concat(r+o-i*N," Z")}else S="M ".concat(t,",").concat(r," h ").concat(n," v ").concat(o," h ").concat(-n," Z");return S},GGe=function(t,r){if(!t||!r)return!1;var n=t.x,o=t.y,l=r.x,d=r.y,i=r.width,g=r.height;if(Math.abs(i)>0&&Math.abs(g)>0){var _=Math.min(l,l+i),S=Math.max(l,l+i),E=Math.min(d,d+g),T=Math.max(d,d+g);return n>=_&&n<=S&&o>=E&&o<=T}return!1},HGe={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},V5=function(t){var r=W7(W7({},HGe),t),n=W.useRef(),o=W.useState(-1),l=FGe(o,2),d=l[0],i=l[1];W.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var B=n.current.getTotalLength();B&&i(B)}catch{}},[]);var g=r.x,_=r.y,S=r.width,E=r.height,T=r.radius,C=r.className,N=r.animationEasing,I=r.animationDuration,j=r.animationBegin,D=r.isAnimationActive,R=r.isUpdateAnimationActive;if(g!==+g||_!==+_||S!==+S||E!==+E||S===0||E===0)return null;var F=Ti("recharts-rectangle",C);return R?He.createElement(Oh,{canBegin:d>0,from:{width:S,height:E,x:g,y:_},to:{width:S,height:E,x:g,y:_},duration:I,animationEasing:N,isActive:R},function(B){var U=B.width,Z=B.height,J=B.x,te=B.y;return He.createElement(Oh,{canBegin:d>0,from:"0px ".concat(d===-1?1:d,"px"),to:"".concat(d,"px 0px"),attributeName:"strokeDasharray",begin:j,duration:I,isActive:D,easing:N},He.createElement("path",vk({},Gn(r,!0),{className:F,d:G7(J,te,U,Z,T),ref:n})))}):He.createElement("path",vk({},Gn(r,!0),{className:F,d:G7(g,_,S,E,T)}))},KGe=["points","className","baseLinePoints","connectNulls"];function Vx(){return Vx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Vx.apply(this,arguments)}function ZGe(e,t){if(e==null)return{};var r=XGe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function XGe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function H7(e){return eHe(e)||QGe(e)||JGe(e)||YGe()}function YGe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function JGe(e,t){if(e){if(typeof e=="string")return BF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return BF(e,t)}}function QGe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function eHe(e){if(Array.isArray(e))return BF(e)}function BF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var K7=function(t){return t&&t.x===+t.x&&t.y===+t.y},tHe=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=[[]];return t.forEach(function(n){K7(n)?r[r.length-1].push(n):r[r.length-1].length>0&&r.push([])}),K7(t[0])&&r[r.length-1].push(t[0]),r[r.length-1].length<=0&&(r=r.slice(0,-1)),r},nE=function(t,r){var n=tHe(t);r&&(n=[n.reduce(function(l,d){return[].concat(H7(l),H7(d))},[])]);var o=n.map(function(l){return l.reduce(function(d,i,g){return"".concat(d).concat(g===0?"M":"L").concat(i.x,",").concat(i.y)},"")}).join("");return n.length===1?"".concat(o,"Z"):o},rHe=function(t,r,n){var o=nE(t,n);return"".concat(o.slice(-1)==="Z"?o.slice(0,-1):o,"L").concat(nE(r.reverse(),n).slice(1))},nHe=function(t){var r=t.points,n=t.className,o=t.baseLinePoints,l=t.connectNulls,d=ZGe(t,KGe);if(!r||!r.length)return null;var i=Ti("recharts-polygon",n);if(o&&o.length){var g=d.stroke&&d.stroke!=="none",_=rHe(r,o,l);return He.createElement("g",{className:i},He.createElement("path",Vx({},Gn(d,!0),{fill:_.slice(-1)==="Z"?d.fill:"none",stroke:"none",d:_})),g?He.createElement("path",Vx({},Gn(d,!0),{fill:"none",d:nE(r,l)})):null,g?He.createElement("path",Vx({},Gn(d,!0),{fill:"none",d:nE(o,l)})):null)}var S=nE(r,l);return He.createElement("path",Vx({},Gn(d,!0),{fill:S.slice(-1)==="Z"?d.fill:"none",className:i,d:S}))};function $F(){return $F=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},$F.apply(this,arguments)}var CR=function(t){var r=t.cx,n=t.cy,o=t.r,l=t.className,d=Ti("recharts-dot",l);return r===+r&&n===+n&&o===+o?W.createElement("circle",$F({},Gn(t,!1),FO(t),{className:d,cx:r,cy:n,r:o})):null};function dT(e){"@babel/helpers - typeof";return dT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dT(e)}var iHe=["x","y","top","left","width","height","className"];function UF(){return UF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},UF.apply(this,arguments)}function Z7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function aHe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Z7(Object(r),!0).forEach(function(n){oHe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function oHe(e,t,r){return t=sHe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sHe(e){var t=lHe(e,"string");return dT(t)=="symbol"?t:t+""}function lHe(e,t){if(dT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(dT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function cHe(e,t){if(e==null)return{};var r=uHe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function uHe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var dHe=function(t,r,n,o,l,d){return"M".concat(t,",").concat(l,"v").concat(o,"M").concat(d,",").concat(r,"h").concat(n)},hHe=function(t){var r=t.x,n=r===void 0?0:r,o=t.y,l=o===void 0?0:o,d=t.top,i=d===void 0?0:d,g=t.left,_=g===void 0?0:g,S=t.width,E=S===void 0?0:S,T=t.height,C=T===void 0?0:T,N=t.className,I=cHe(t,iHe),j=aHe({x:n,y:l,top:i,left:_,width:E,height:C},I);return!$r(n)||!$r(l)||!$r(E)||!$r(C)||!$r(i)||!$r(_)?null:He.createElement("path",UF({},Gn(j,!0),{className:Ti("recharts-cross",N),d:dHe(n,l,E,C,i,_)}))},fHe=SR,pHe=Fse,mHe=Dh;function gHe(e,t){return e&&e.length?fHe(e,mHe(t),pHe):void 0}var yHe=gHe;const vHe=_a(yHe);var _He=SR,xHe=Dh,bHe=zse;function wHe(e,t){return e&&e.length?_He(e,xHe(t),bHe):void 0}var SHe=wHe;const EHe=_a(SHe);var THe=["cx","cy","angle","ticks","axisLine"],AHe=["ticks","tick","angle","tickFormatter","stroke"];function nb(e){"@babel/helpers - typeof";return nb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nb(e)}function iE(){return iE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},iE.apply(this,arguments)}function X7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function yy(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?X7(Object(r),!0).forEach(function(n){OR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Y7(e,t){if(e==null)return{};var r=PHe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function PHe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function CHe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function J7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ole(n.key),n)}}function OHe(e,t,r){return t&&J7(e.prototype,t),r&&J7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function kHe(e,t,r){return t=_k(t),IHe(e,Cle()?Reflect.construct(t,r||[],_k(e).constructor):t.apply(e,r))}function IHe(e,t){if(t&&(nb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return RHe(e)}function RHe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Cle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Cle=function(){return!!e})()}function _k(e){return _k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},_k(e)}function jHe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&VF(e,t)}function VF(e,t){return VF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},VF(e,t)}function OR(e,t,r){return t=Ole(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ole(e){var t=NHe(e,"string");return nb(t)=="symbol"?t:t+""}function NHe(e,t){if(nb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(nb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var kR=function(e){function t(){return CHe(this,t),kHe(this,t,arguments)}return jHe(t,e),OHe(t,[{key:"getTickValueCoord",value:function(n){var o=n.coordinate,l=this.props,d=l.angle,i=l.cx,g=l.cy;return Xa(i,g,o,d)}},{key:"getTickTextAnchor",value:function(){var n=this.props.orientation,o;switch(n){case"left":o="end";break;case"right":o="start";break;default:o="middle";break}return o}},{key:"getViewBox",value:function(){var n=this.props,o=n.cx,l=n.cy,d=n.angle,i=n.ticks,g=vHe(i,function(S){return S.coordinate||0}),_=EHe(i,function(S){return S.coordinate||0});return{cx:o,cy:l,startAngle:d,endAngle:d,innerRadius:_.coordinate||0,outerRadius:g.coordinate||0}}},{key:"renderAxisLine",value:function(){var n=this.props,o=n.cx,l=n.cy,d=n.angle,i=n.ticks,g=n.axisLine,_=Y7(n,THe),S=i.reduce(function(N,I){return[Math.min(N[0],I.coordinate),Math.max(N[1],I.coordinate)]},[1/0,-1/0]),E=Xa(o,l,S[0],d),T=Xa(o,l,S[1],d),C=yy(yy(yy({},Gn(_,!1)),{},{fill:"none"},Gn(g,!1)),{},{x1:E.x,y1:E.y,x2:T.x,y2:T.y});return He.createElement("line",iE({className:"recharts-polar-radius-axis-line"},C))}},{key:"renderTicks",value:function(){var n=this,o=this.props,l=o.ticks,d=o.tick,i=o.angle,g=o.tickFormatter,_=o.stroke,S=Y7(o,AHe),E=this.getTickTextAnchor(),T=Gn(S,!1),C=Gn(d,!1),N=l.map(function(I,j){var D=n.getTickValueCoord(I),R=yy(yy(yy(yy({textAnchor:E,transform:"rotate(".concat(90-i,", ").concat(D.x,", ").concat(D.y,")")},T),{},{stroke:"none",fill:_},C),{},{index:j},D),{},{payload:I});return He.createElement(ya,iE({className:Ti("recharts-polar-radius-axis-tick",ple(d)),key:"tick-".concat(I.coordinate)},_v(n.props,I,j)),t.renderTickItem(d,R,g?g(I.value,j):I.value))});return He.createElement(ya,{className:"recharts-polar-radius-axis-ticks"},N)}},{key:"render",value:function(){var n=this.props,o=n.ticks,l=n.axisLine,d=n.tick;return!o||!o.length?null:He.createElement(ya,{className:Ti("recharts-polar-radius-axis",this.props.className)},l&&this.renderAxisLine(),d&&this.renderTicks(),Os.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(n,o,l){var d;return He.isValidElement(n)?d=He.cloneElement(n,o):li(n)?d=n(o):d=He.createElement(xv,iE({},o,{className:"recharts-polar-radius-axis-tick-value"}),l),d}}])}(W.PureComponent);OR(kR,"displayName","PolarRadiusAxis");OR(kR,"axisType","radiusAxis");OR(kR,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function ib(e){"@babel/helpers - typeof";return ib=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ib(e)}function Ry(){return Ry=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ry.apply(this,arguments)}function Q7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function vy(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Q7(Object(r),!0).forEach(function(n){IR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function MHe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function eK(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ile(n.key),n)}}function DHe(e,t,r){return t&&eK(e.prototype,t),r&&eK(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function LHe(e,t,r){return t=xk(t),FHe(e,kle()?Reflect.construct(t,r||[],xk(e).constructor):t.apply(e,r))}function FHe(e,t){if(t&&(ib(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return zHe(e)}function zHe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function kle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(kle=function(){return!!e})()}function xk(e){return xk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},xk(e)}function BHe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&qF(e,t)}function qF(e,t){return qF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},qF(e,t)}function IR(e,t,r){return t=Ile(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ile(e){var t=$He(e,"string");return ib(t)=="symbol"?t:t+""}function $He(e,t){if(ib(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ib(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var UHe=Math.PI/180,tK=1e-5,RR=function(e){function t(){return MHe(this,t),LHe(this,t,arguments)}return BHe(t,e),DHe(t,[{key:"getTickLineCoord",value:function(n){var o=this.props,l=o.cx,d=o.cy,i=o.radius,g=o.orientation,_=o.tickSize,S=_||8,E=Xa(l,d,i,n.coordinate),T=Xa(l,d,i+(g==="inner"?-1:1)*S,n.coordinate);return{x1:E.x,y1:E.y,x2:T.x,y2:T.y}}},{key:"getTickTextAnchor",value:function(n){var o=this.props.orientation,l=Math.cos(-n.coordinate*UHe),d;return l>tK?d=o==="outer"?"start":"end":l<-tK?d=o==="outer"?"end":"start":d="middle",d}},{key:"renderAxisLine",value:function(){var n=this.props,o=n.cx,l=n.cy,d=n.radius,i=n.axisLine,g=n.axisLineType,_=vy(vy({},Gn(this.props,!1)),{},{fill:"none"},Gn(i,!1));if(g==="circle")return He.createElement(CR,Ry({className:"recharts-polar-angle-axis-line"},_,{cx:o,cy:l,r:d}));var S=this.props.ticks,E=S.map(function(T){return Xa(o,l,d,T.coordinate)});return He.createElement(nHe,Ry({className:"recharts-polar-angle-axis-line"},_,{points:E}))}},{key:"renderTicks",value:function(){var n=this,o=this.props,l=o.ticks,d=o.tick,i=o.tickLine,g=o.tickFormatter,_=o.stroke,S=Gn(this.props,!1),E=Gn(d,!1),T=vy(vy({},S),{},{fill:"none"},Gn(i,!1)),C=l.map(function(N,I){var j=n.getTickLineCoord(N),D=n.getTickTextAnchor(N),R=vy(vy(vy({textAnchor:D},S),{},{stroke:"none",fill:_},E),{},{index:I,payload:N,x:j.x2,y:j.y2});return He.createElement(ya,Ry({className:Ti("recharts-polar-angle-axis-tick",ple(d)),key:"tick-".concat(N.coordinate)},_v(n.props,N,I)),i&&He.createElement("line",Ry({className:"recharts-polar-angle-axis-tick-line"},T,j)),d&&t.renderTickItem(d,R,g?g(N.value,I):N.value))});return He.createElement(ya,{className:"recharts-polar-angle-axis-ticks"},C)}},{key:"render",value:function(){var n=this.props,o=n.ticks,l=n.radius,d=n.axisLine;return l<=0||!o||!o.length?null:He.createElement(ya,{className:Ti("recharts-polar-angle-axis",this.props.className)},d&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(n,o,l){var d;return He.isValidElement(n)?d=He.cloneElement(n,o):li(n)?d=n(o):d=He.createElement(xv,Ry({},o,{className:"recharts-polar-angle-axis-tick-value"}),l),d}}])}(W.PureComponent);IR(RR,"displayName","PolarAngleAxis");IR(RR,"axisType","angleAxis");IR(RR,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var VHe=Noe,qHe=VHe(Object.getPrototypeOf,Object),WHe=qHe,GHe=Hf,HHe=WHe,KHe=Kf,ZHe="[object Object]",XHe=Function.prototype,YHe=Object.prototype,Rle=XHe.toString,JHe=YHe.hasOwnProperty,QHe=Rle.call(Object);function e7e(e){if(!KHe(e)||GHe(e)!=ZHe)return!1;var t=HHe(e);if(t===null)return!0;var r=JHe.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&Rle.call(r)==QHe}var t7e=e7e;const r7e=_a(t7e);var n7e=Hf,i7e=Kf,a7e="[object Boolean]";function o7e(e){return e===!0||e===!1||i7e(e)&&n7e(e)==a7e}var s7e=o7e;const l7e=_a(s7e);function hT(e){"@babel/helpers - typeof";return hT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hT(e)}function bk(){return bk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},bk.apply(this,arguments)}function c7e(e,t){return f7e(e)||h7e(e,t)||d7e(e,t)||u7e()}function u7e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function d7e(e,t){if(e){if(typeof e=="string")return rK(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rK(e,t)}}function rK(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function h7e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,_=!1;try{if(l=(r=r.call(e)).next,t!==0)for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){_=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(_)throw o}}return i}}function f7e(e){if(Array.isArray(e))return e}function nK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function iK(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?nK(Object(r),!0).forEach(function(n){p7e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function p7e(e,t,r){return t=m7e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m7e(e){var t=g7e(e,"string");return hT(t)=="symbol"?t:t+""}function g7e(e,t){if(hT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(hT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var aK=function(t,r,n,o,l){var d=n-o,i;return i="M ".concat(t,",").concat(r),i+="L ".concat(t+n,",").concat(r),i+="L ".concat(t+n-d/2,",").concat(r+l),i+="L ".concat(t+n-d/2-o,",").concat(r+l),i+="L ".concat(t,",").concat(r," Z"),i},y7e={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},v7e=function(t){var r=iK(iK({},y7e),t),n=W.useRef(),o=W.useState(-1),l=c7e(o,2),d=l[0],i=l[1];W.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var F=n.current.getTotalLength();F&&i(F)}catch{}},[]);var g=r.x,_=r.y,S=r.upperWidth,E=r.lowerWidth,T=r.height,C=r.className,N=r.animationEasing,I=r.animationDuration,j=r.animationBegin,D=r.isUpdateAnimationActive;if(g!==+g||_!==+_||S!==+S||E!==+E||T!==+T||S===0&&E===0||T===0)return null;var R=Ti("recharts-trapezoid",C);return D?He.createElement(Oh,{canBegin:d>0,from:{upperWidth:0,lowerWidth:0,height:T,x:g,y:_},to:{upperWidth:S,lowerWidth:E,height:T,x:g,y:_},duration:I,animationEasing:N,isActive:D},function(F){var B=F.upperWidth,U=F.lowerWidth,Z=F.height,J=F.x,te=F.y;return He.createElement(Oh,{canBegin:d>0,from:"0px ".concat(d===-1?1:d,"px"),to:"".concat(d,"px 0px"),attributeName:"strokeDasharray",begin:j,duration:I,easing:N},He.createElement("path",bk({},Gn(r,!0),{className:R,d:aK(J,te,B,U,Z),ref:n})))}):He.createElement("g",null,He.createElement("path",bk({},Gn(r,!0),{className:R,d:aK(g,_,S,E,T)})))},_7e=["option","shapeType","propTransformer","activeClassName","isActive"];function fT(e){"@babel/helpers - typeof";return fT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fT(e)}function x7e(e,t){if(e==null)return{};var r=b7e(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function b7e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function oK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function wk(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?oK(Object(r),!0).forEach(function(n){w7e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function w7e(e,t,r){return t=S7e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function S7e(e){var t=E7e(e,"string");return fT(t)=="symbol"?t:t+""}function E7e(e,t){if(fT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(fT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function T7e(e,t){return wk(wk({},t),e)}function A7e(e,t){return e==="symbols"}function sK(e){var t=e.shapeType,r=e.elementProps;switch(t){case"rectangle":return He.createElement(V5,r);case"trapezoid":return He.createElement(v7e,r);case"sector":return He.createElement(yle,r);case"symbols":if(A7e(t))return He.createElement(l5,r);break;default:return null}}function P7e(e){return W.isValidElement(e)?e.props:e}function jle(e){var t=e.option,r=e.shapeType,n=e.propTransformer,o=n===void 0?T7e:n,l=e.activeClassName,d=l===void 0?"recharts-active-shape":l,i=e.isActive,g=x7e(e,_7e),_;if(W.isValidElement(t))_=W.cloneElement(t,wk(wk({},g),P7e(t)));else if(li(t))_=t(g);else if(r7e(t)&&!l7e(t)){var S=o(t,g);_=He.createElement(sK,{shapeType:r,elementProps:S})}else{var E=g;_=He.createElement(sK,{shapeType:r,elementProps:E})}return i?He.createElement(ya,{className:d},_):_}function jR(e,t){return t!=null&&"trapezoids"in e.props}function NR(e,t){return t!=null&&"sectors"in e.props}function pT(e,t){return t!=null&&"points"in e.props}function C7e(e,t){var r,n,o=e.x===(t==null||(r=t.labelViewBox)===null||r===void 0?void 0:r.x)||e.x===t.x,l=e.y===(t==null||(n=t.labelViewBox)===null||n===void 0?void 0:n.y)||e.y===t.y;return o&&l}function O7e(e,t){var r=e.endAngle===t.endAngle,n=e.startAngle===t.startAngle;return r&&n}function k7e(e,t){var r=e.x===t.x,n=e.y===t.y,o=e.z===t.z;return r&&n&&o}function I7e(e,t){var r;return jR(e,t)?r=C7e:NR(e,t)?r=O7e:pT(e,t)&&(r=k7e),r}function R7e(e,t){var r;return jR(e,t)?r="trapezoids":NR(e,t)?r="sectors":pT(e,t)&&(r="points"),r}function j7e(e,t){if(jR(e,t)){var r;return(r=t.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}if(NR(e,t)){var n;return(n=t.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}return pT(e,t)?t.payload:{}}function N7e(e){var t=e.activeTooltipItem,r=e.graphicalItem,n=e.itemData,o=R7e(r,t),l=j7e(r,t),d=n.filter(function(g,_){var S=a2(l,g),E=r.props[o].filter(function(N){var I=I7e(r,t);return I(N,t)}),T=r.props[o].indexOf(E[E.length-1]),C=_===T;return S&&C}),i=n.indexOf(d[d.length-1]);return i}var CC;function ab(e){"@babel/helpers - typeof";return ab=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ab(e)}function qx(){return qx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},qx.apply(this,arguments)}function lK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Ha(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?lK(Object(r),!0).forEach(function(n){wu(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function M7e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function cK(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Mle(n.key),n)}}function D7e(e,t,r){return t&&cK(e.prototype,t),r&&cK(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function L7e(e,t,r){return t=Sk(t),F7e(e,Nle()?Reflect.construct(t,r||[],Sk(e).constructor):t.apply(e,r))}function F7e(e,t){if(t&&(ab(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return z7e(e)}function z7e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Nle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Nle=function(){return!!e})()}function Sk(e){return Sk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Sk(e)}function B7e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&WF(e,t)}function WF(e,t){return WF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},WF(e,t)}function wu(e,t,r){return t=Mle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Mle(e){var t=$7e(e,"string");return ab(t)=="symbol"?t:t+""}function $7e(e,t){if(ab(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ab(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var kh=function(e){function t(r){var n;return M7e(this,t),n=L7e(this,t,[r]),wu(n,"pieRef",null),wu(n,"sectorRefs",[]),wu(n,"id",zb("recharts-pie-")),wu(n,"handleAnimationEnd",function(){var o=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),li(o)&&o()}),wu(n,"handleAnimationStart",function(){var o=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),li(o)&&o()}),n.state={isAnimationFinished:!r.isAnimationActive,prevIsAnimationActive:r.isAnimationActive,prevAnimationId:r.animationId,sectorToFocus:0},n}return B7e(t,e),D7e(t,[{key:"isActiveIndex",value:function(n){var o=this.props.activeIndex;return Array.isArray(o)?o.indexOf(n)!==-1:n===o}},{key:"hasActiveIndex",value:function(){var n=this.props.activeIndex;return Array.isArray(n)?n.length!==0:n||n===0}},{key:"renderLabels",value:function(n){var o=this.props.isAnimationActive;if(o&&!this.state.isAnimationFinished)return null;var l=this.props,d=l.label,i=l.labelLine,g=l.dataKey,_=l.valueKey,S=Gn(this.props,!1),E=Gn(d,!1),T=Gn(i,!1),C=d&&d.offsetRadius||20,N=n.map(function(I,j){var D=(I.startAngle+I.endAngle)/2,R=Xa(I.cx,I.cy,I.outerRadius+C,D),F=Ha(Ha(Ha(Ha({},S),I),{},{stroke:"none"},E),{},{index:j,textAnchor:t.getTextAnchor(R.x,I.cx)},R),B=Ha(Ha(Ha(Ha({},S),I),{},{fill:"none",stroke:I.fill},T),{},{index:j,points:[Xa(I.cx,I.cy,I.outerRadius,D),R]}),U=g;return wi(g)&&wi(_)?U="value":wi(g)&&(U=_),He.createElement(ya,{key:"label-".concat(I.startAngle,"-").concat(I.endAngle,"-").concat(I.midAngle,"-").concat(j)},i&&t.renderLabelLineItem(i,B,"line"),t.renderLabelItem(d,F,ms(I,U)))});return He.createElement(ya,{className:"recharts-pie-labels"},N)}},{key:"renderSectorsStatically",value:function(n){var o=this,l=this.props,d=l.activeShape,i=l.blendStroke,g=l.inactiveShape;return n.map(function(_,S){if((_==null?void 0:_.startAngle)===0&&(_==null?void 0:_.endAngle)===0&&n.length!==1)return null;var E=o.isActiveIndex(S),T=g&&o.hasActiveIndex()?g:null,C=E?d:T,N=Ha(Ha({},_),{},{stroke:i?_.fill:_.stroke,tabIndex:-1});return He.createElement(ya,qx({ref:function(j){j&&!o.sectorRefs.includes(j)&&o.sectorRefs.push(j)},tabIndex:-1,className:"recharts-pie-sector"},_v(o.props,_,S),{key:"sector-".concat(_==null?void 0:_.startAngle,"-").concat(_==null?void 0:_.endAngle,"-").concat(_.midAngle,"-").concat(S)}),He.createElement(jle,qx({option:C,isActive:E,shapeType:"sector"},N)))})}},{key:"renderSectorsWithAnimation",value:function(){var n=this,o=this.props,l=o.sectors,d=o.isAnimationActive,i=o.animationBegin,g=o.animationDuration,_=o.animationEasing,S=o.animationId,E=this.state,T=E.prevSectors,C=E.prevIsAnimationActive;return He.createElement(Oh,{begin:i,duration:g,isActive:d,easing:_,from:{t:0},to:{t:1},key:"pie-".concat(S,"-").concat(C),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(N){var I=N.t,j=[],D=l&&l[0],R=D.startAngle;return l.forEach(function(F,B){var U=T&&T[B],Z=B>0?Xc(F,"paddingAngle",0):0;if(U){var J=Uc(U.endAngle-U.startAngle,F.endAngle-F.startAngle),te=Ha(Ha({},F),{},{startAngle:R+Z,endAngle:R+J(I)+Z});j.push(te),R=te.endAngle}else{var ae=F.endAngle,ne=F.startAngle,ie=Uc(0,ae-ne),ee=ie(I),oe=Ha(Ha({},F),{},{startAngle:R+Z,endAngle:R+ee+Z});j.push(oe),R=oe.endAngle}}),He.createElement(ya,null,n.renderSectorsStatically(j))})}},{key:"attachKeyboardHandlers",value:function(n){var o=this;n.onkeydown=function(l){if(!l.altKey)switch(l.key){case"ArrowLeft":{var d=++o.state.sectorToFocus%o.sectorRefs.length;o.sectorRefs[d].focus(),o.setState({sectorToFocus:d});break}case"ArrowRight":{var i=--o.state.sectorToFocus<0?o.sectorRefs.length-1:o.state.sectorToFocus%o.sectorRefs.length;o.sectorRefs[i].focus(),o.setState({sectorToFocus:i});break}case"Escape":{o.sectorRefs[o.state.sectorToFocus].blur(),o.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var n=this.props,o=n.sectors,l=n.isAnimationActive,d=this.state.prevSectors;return l&&o&&o.length&&(!d||!a2(d,o))?this.renderSectorsWithAnimation():this.renderSectorsStatically(o)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var n=this,o=this.props,l=o.hide,d=o.sectors,i=o.className,g=o.label,_=o.cx,S=o.cy,E=o.innerRadius,T=o.outerRadius,C=o.isAnimationActive,N=this.state.isAnimationFinished;if(l||!d||!d.length||!$r(_)||!$r(S)||!$r(E)||!$r(T))return null;var I=Ti("recharts-pie",i);return He.createElement(ya,{tabIndex:this.props.rootTabIndex,className:I,ref:function(D){n.pieRef=D}},this.renderSectors(),g&&this.renderLabels(d),Os.renderCallByParent(this.props,null,!1),(!C||N)&&kf.renderCallByParent(this.props,d,!1))}}],[{key:"getDerivedStateFromProps",value:function(n,o){return o.prevIsAnimationActive!==n.isAnimationActive?{prevIsAnimationActive:n.isAnimationActive,prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:[],isAnimationFinished:!0}:n.isAnimationActive&&n.animationId!==o.prevAnimationId?{prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:o.curSectors,isAnimationFinished:!0}:n.sectors!==o.curSectors?{curSectors:n.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(n,o){return n>o?"start":n<o?"end":"middle"}},{key:"renderLabelLineItem",value:function(n,o,l){if(He.isValidElement(n))return He.cloneElement(n,o);if(li(n))return n(o);var d=Ti("recharts-pie-label-line",typeof n!="boolean"?n.className:"");return He.createElement(pk,qx({},o,{key:l,type:"linear",className:d}))}},{key:"renderLabelItem",value:function(n,o,l){if(He.isValidElement(n))return He.cloneElement(n,o);var d=l;if(li(n)&&(d=n(o),He.isValidElement(d)))return d;var i=Ti("recharts-pie-label-text",typeof n!="boolean"&&!li(n)?n.className:"");return He.createElement(xv,qx({},o,{alignmentBaseline:"middle",className:i}),d)}}])}(W.PureComponent);CC=kh;wu(kh,"displayName","Pie");wu(kh,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!Sh.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});wu(kh,"parseDeltaAngle",function(e,t){var r=ql(t-e),n=Math.min(Math.abs(t-e),360);return r*n});wu(kh,"getRealPieData",function(e){var t=e.data,r=e.children,n=Gn(e,!1),o=Yc(r,qE);return t&&t.length?t.map(function(l,d){return Ha(Ha(Ha({payload:l},n),l),o&&o[d]&&o[d].props)}):o&&o.length?o.map(function(l){return Ha(Ha({},n),l.props)}):[]});wu(kh,"parseCoordinateOfPie",function(e,t){var r=t.top,n=t.left,o=t.width,l=t.height,d=fle(o,l),i=n+Wl(e.cx,o,o/2),g=r+Wl(e.cy,l,l/2),_=Wl(e.innerRadius,d,0),S=Wl(e.outerRadius,d,d*.8),E=e.maxRadius||Math.sqrt(o*o+l*l)/2;return{cx:i,cy:g,innerRadius:_,outerRadius:S,maxRadius:E}});wu(kh,"getComposedData",function(e){var t=e.item,r=e.offset,n=t.type.defaultProps!==void 0?Ha(Ha({},t.type.defaultProps),t.props):t.props,o=CC.getRealPieData(n);if(!o||!o.length)return null;var l=n.cornerRadius,d=n.startAngle,i=n.endAngle,g=n.paddingAngle,_=n.dataKey,S=n.nameKey,E=n.valueKey,T=n.tooltipType,C=Math.abs(n.minAngle),N=CC.parseCoordinateOfPie(n,r),I=CC.parseDeltaAngle(d,i),j=Math.abs(I),D=_;wi(_)&&wi(E)?(Ed(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),D="value"):wi(_)&&(Ed(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),D=E);var R=o.filter(function(te){return ms(te,D,0)!==0}).length,F=(j>=360?R:R-1)*g,B=j-R*C-F,U=o.reduce(function(te,ae){var ne=ms(ae,D,0);return te+($r(ne)?ne:0)},0),Z;if(U>0){var J;Z=o.map(function(te,ae){var ne=ms(te,D,0),ie=ms(te,S,ae),ee=($r(ne)?ne:0)/U,oe;ae?oe=J.endAngle+ql(I)*g*(ne!==0?1:0):oe=d;var de=oe+ql(I)*((ne!==0?C:0)+ee*B),xe=(oe+de)/2,we=(N.innerRadius+N.outerRadius)/2,Ae=[{name:ie,value:ne,payload:te,dataKey:D,type:T}],Ce=Xa(N.cx,N.cy,we,xe);return J=Ha(Ha(Ha({percent:ee,cornerRadius:l,name:ie,tooltipPayload:Ae,midAngle:xe,middleRadius:we,tooltipPosition:Ce},te),N),{},{value:ms(te,D),startAngle:oe,endAngle:de,payload:te,paddingAngle:ql(I)*g}),J})}return Ha(Ha({},N),{},{sectors:Z,data:o})});var U7e=Math.ceil,V7e=Math.max;function q7e(e,t,r,n){for(var o=-1,l=V7e(U7e((t-e)/(r||1)),0),d=Array(l);l--;)d[n?l:++o]=e,e+=r;return d}var W7e=q7e,G7e=Qoe,uK=1/0,H7e=17976931348623157e292;function K7e(e){if(!e)return e===0?e:0;if(e=G7e(e),e===uK||e===-uK){var t=e<0?-1:1;return t*H7e}return e===e?e:0}var Dle=K7e,Z7e=W7e,X7e=gR,wD=Dle;function Y7e(e){return function(t,r,n){return n&&typeof n!="number"&&X7e(t,r,n)&&(r=n=void 0),t=wD(t),r===void 0?(r=t,t=0):r=wD(r),n=n===void 0?t<r?1:-1:wD(n),Z7e(t,r,n,e)}}var J7e=Y7e,Q7e=J7e,eKe=Q7e(),tKe=eKe;const Ek=_a(tKe);function mT(e){"@babel/helpers - typeof";return mT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mT(e)}function dK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function hK(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?dK(Object(r),!0).forEach(function(n){Lle(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Lle(e,t,r){return t=rKe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rKe(e){var t=nKe(e,"string");return mT(t)=="symbol"?t:t+""}function nKe(e,t){if(mT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(mT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var iKe=["Webkit","Moz","O","ms"],aKe=function(t,r){var n=t.replace(/(\w)/,function(l){return l.toUpperCase()}),o=iKe.reduce(function(l,d){return hK(hK({},l),{},Lle({},d+n,r))},{});return o[t]=r,o};function ob(e){"@babel/helpers - typeof";return ob=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ob(e)}function Tk(){return Tk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Tk.apply(this,arguments)}function fK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function SD(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?fK(Object(r),!0).forEach(function(n){Dc(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function oKe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pK(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,zle(n.key),n)}}function sKe(e,t,r){return t&&pK(e.prototype,t),r&&pK(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function lKe(e,t,r){return t=Ak(t),cKe(e,Fle()?Reflect.construct(t,r||[],Ak(e).constructor):t.apply(e,r))}function cKe(e,t){if(t&&(ob(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return uKe(e)}function uKe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Fle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Fle=function(){return!!e})()}function Ak(e){return Ak=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Ak(e)}function dKe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&GF(e,t)}function GF(e,t){return GF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},GF(e,t)}function Dc(e,t,r){return t=zle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function zle(e){var t=hKe(e,"string");return ob(t)=="symbol"?t:t+""}function hKe(e,t){if(ob(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ob(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var fKe=function(t){var r=t.data,n=t.startIndex,o=t.endIndex,l=t.x,d=t.width,i=t.travellerWidth;if(!r||!r.length)return{};var g=r.length,_=eE().domain(Ek(0,g)).range([l,l+d-i]),S=_.domain().map(function(E){return _(E)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:_(n),endX:_(o),scale:_,scaleValues:S}},mK=function(t){return t.changedTouches&&!!t.changedTouches.length},sb=function(e){function t(r){var n;return oKe(this,t),n=lKe(this,t,[r]),Dc(n,"handleDrag",function(o){n.leaveTimer&&(clearTimeout(n.leaveTimer),n.leaveTimer=null),n.state.isTravellerMoving?n.handleTravellerMove(o):n.state.isSlideMoving&&n.handleSlideDrag(o)}),Dc(n,"handleTouchMove",function(o){o.changedTouches!=null&&o.changedTouches.length>0&&n.handleDrag(o.changedTouches[0])}),Dc(n,"handleDragEnd",function(){n.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var o=n.props,l=o.endIndex,d=o.onDragEnd,i=o.startIndex;d==null||d({endIndex:l,startIndex:i})}),n.detachDragEndListener()}),Dc(n,"handleLeaveWrapper",function(){(n.state.isTravellerMoving||n.state.isSlideMoving)&&(n.leaveTimer=window.setTimeout(n.handleDragEnd,n.props.leaveTimeOut))}),Dc(n,"handleEnterSlideOrTraveller",function(){n.setState({isTextActive:!0})}),Dc(n,"handleLeaveSlideOrTraveller",function(){n.setState({isTextActive:!1})}),Dc(n,"handleSlideDragStart",function(o){var l=mK(o)?o.changedTouches[0]:o;n.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:l.pageX}),n.attachDragEndListener()}),n.travellerDragStartHandlers={startX:n.handleTravellerDragStart.bind(n,"startX"),endX:n.handleTravellerDragStart.bind(n,"endX")},n.state={},n}return dKe(t,e),sKe(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(n){var o=n.startX,l=n.endX,d=this.state.scaleValues,i=this.props,g=i.gap,_=i.data,S=_.length-1,E=Math.min(o,l),T=Math.max(o,l),C=t.getIndexInRange(d,E),N=t.getIndexInRange(d,T);return{startIndex:C-C%g,endIndex:N===S?S:N-N%g}}},{key:"getTextOfTick",value:function(n){var o=this.props,l=o.data,d=o.tickFormatter,i=o.dataKey,g=ms(l[n],i,n);return li(d)?d(g,n):g}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(n){var o=this.state,l=o.slideMoveStartX,d=o.startX,i=o.endX,g=this.props,_=g.x,S=g.width,E=g.travellerWidth,T=g.startIndex,C=g.endIndex,N=g.onChange,I=n.pageX-l;I>0?I=Math.min(I,_+S-E-i,_+S-E-d):I<0&&(I=Math.max(I,_-d,_-i));var j=this.getIndex({startX:d+I,endX:i+I});(j.startIndex!==T||j.endIndex!==C)&&N&&N(j),this.setState({startX:d+I,endX:i+I,slideMoveStartX:n.pageX})}},{key:"handleTravellerDragStart",value:function(n,o){var l=mK(o)?o.changedTouches[0]:o;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:n,brushMoveStartX:l.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(n){var o=this.state,l=o.brushMoveStartX,d=o.movingTravellerId,i=o.endX,g=o.startX,_=this.state[d],S=this.props,E=S.x,T=S.width,C=S.travellerWidth,N=S.onChange,I=S.gap,j=S.data,D={startX:this.state.startX,endX:this.state.endX},R=n.pageX-l;R>0?R=Math.min(R,E+T-C-_):R<0&&(R=Math.max(R,E-_)),D[d]=_+R;var F=this.getIndex(D),B=F.startIndex,U=F.endIndex,Z=function(){var te=j.length-1;return d==="startX"&&(i>g?B%I===0:U%I===0)||i<g&&U===te||d==="endX"&&(i>g?U%I===0:B%I===0)||i>g&&U===te};this.setState(Dc(Dc({},d,_+R),"brushMoveStartX",n.pageX),function(){N&&Z()&&N(F)})}},{key:"handleTravellerMoveKeyboard",value:function(n,o){var l=this,d=this.state,i=d.scaleValues,g=d.startX,_=d.endX,S=this.state[o],E=i.indexOf(S);if(E!==-1){var T=E+n;if(!(T===-1||T>=i.length)){var C=i[T];o==="startX"&&C>=_||o==="endX"&&C<=g||this.setState(Dc({},o,C),function(){l.props.onChange(l.getIndex({startX:l.state.startX,endX:l.state.endX}))})}}}},{key:"renderBackground",value:function(){var n=this.props,o=n.x,l=n.y,d=n.width,i=n.height,g=n.fill,_=n.stroke;return He.createElement("rect",{stroke:_,fill:g,x:o,y:l,width:d,height:i})}},{key:"renderPanorama",value:function(){var n=this.props,o=n.x,l=n.y,d=n.width,i=n.height,g=n.data,_=n.children,S=n.padding,E=W.Children.only(_);return E?He.cloneElement(E,{x:o,y:l,width:d,height:i,margin:S,compact:!0,data:g}):null}},{key:"renderTravellerLayer",value:function(n,o){var l,d,i=this,g=this.props,_=g.y,S=g.travellerWidth,E=g.height,T=g.traveller,C=g.ariaLabel,N=g.data,I=g.startIndex,j=g.endIndex,D=Math.max(n,this.props.x),R=SD(SD({},Gn(this.props,!1)),{},{x:D,y:_,width:S,height:E}),F=C||"Min value: ".concat((l=N[I])===null||l===void 0?void 0:l.name,", Max value: ").concat((d=N[j])===null||d===void 0?void 0:d.name);return He.createElement(ya,{tabIndex:0,role:"slider","aria-label":F,"aria-valuenow":n,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[o],onTouchStart:this.travellerDragStartHandlers[o],onKeyDown:function(U){["ArrowLeft","ArrowRight"].includes(U.key)&&(U.preventDefault(),U.stopPropagation(),i.handleTravellerMoveKeyboard(U.key==="ArrowRight"?1:-1,o))},onFocus:function(){i.setState({isTravellerFocused:!0})},onBlur:function(){i.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(T,R))}},{key:"renderSlide",value:function(n,o){var l=this.props,d=l.y,i=l.height,g=l.stroke,_=l.travellerWidth,S=Math.min(n,o)+_,E=Math.max(Math.abs(o-n)-_,0);return He.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:g,fillOpacity:.2,x:S,y:d,width:E,height:i})}},{key:"renderText",value:function(){var n=this.props,o=n.startIndex,l=n.endIndex,d=n.y,i=n.height,g=n.travellerWidth,_=n.stroke,S=this.state,E=S.startX,T=S.endX,C=5,N={pointerEvents:"none",fill:_};return He.createElement(ya,{className:"recharts-brush-texts"},He.createElement(xv,Tk({textAnchor:"end",verticalAnchor:"middle",x:Math.min(E,T)-C,y:d+i/2},N),this.getTextOfTick(o)),He.createElement(xv,Tk({textAnchor:"start",verticalAnchor:"middle",x:Math.max(E,T)+g+C,y:d+i/2},N),this.getTextOfTick(l)))}},{key:"render",value:function(){var n=this.props,o=n.data,l=n.className,d=n.children,i=n.x,g=n.y,_=n.width,S=n.height,E=n.alwaysShowText,T=this.state,C=T.startX,N=T.endX,I=T.isTextActive,j=T.isSlideMoving,D=T.isTravellerMoving,R=T.isTravellerFocused;if(!o||!o.length||!$r(i)||!$r(g)||!$r(_)||!$r(S)||_<=0||S<=0)return null;var F=Ti("recharts-brush",l),B=He.Children.count(d)===1,U=aKe("userSelect","none");return He.createElement(ya,{className:F,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:U},this.renderBackground(),B&&this.renderPanorama(),this.renderSlide(C,N),this.renderTravellerLayer(C,"startX"),this.renderTravellerLayer(N,"endX"),(I||j||D||R||E)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(n){var o=n.x,l=n.y,d=n.width,i=n.height,g=n.stroke,_=Math.floor(l+i/2)-1;return He.createElement(He.Fragment,null,He.createElement("rect",{x:o,y:l,width:d,height:i,fill:g,stroke:"none"}),He.createElement("line",{x1:o+1,y1:_,x2:o+d-1,y2:_,fill:"none",stroke:"#fff"}),He.createElement("line",{x1:o+1,y1:_+2,x2:o+d-1,y2:_+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(n,o){var l;return He.isValidElement(n)?l=He.cloneElement(n,o):li(n)?l=n(o):l=t.renderDefaultTraveller(o),l}},{key:"getDerivedStateFromProps",value:function(n,o){var l=n.data,d=n.width,i=n.x,g=n.travellerWidth,_=n.updateId,S=n.startIndex,E=n.endIndex;if(l!==o.prevData||_!==o.prevUpdateId)return SD({prevData:l,prevTravellerWidth:g,prevUpdateId:_,prevX:i,prevWidth:d},l&&l.length?fKe({data:l,width:d,x:i,travellerWidth:g,startIndex:S,endIndex:E}):{scale:null,scaleValues:null});if(o.scale&&(d!==o.prevWidth||i!==o.prevX||g!==o.prevTravellerWidth)){o.scale.range([i,i+d-g]);var T=o.scale.domain().map(function(C){return o.scale(C)});return{prevData:l,prevTravellerWidth:g,prevUpdateId:_,prevX:i,prevWidth:d,startX:o.scale(n.startIndex),endX:o.scale(n.endIndex),scaleValues:T}}return null}},{key:"getIndexInRange",value:function(n,o){for(var l=n.length,d=0,i=l-1;i-d>1;){var g=Math.floor((d+i)/2);n[g]>o?i=g:d=g}return o>=n[i]?i:d}}])}(W.PureComponent);Dc(sb,"displayName","Brush");Dc(sb,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var pKe=m5;function mKe(e,t){var r;return pKe(e,function(n,o,l){return r=t(n,o,l),!r}),!!r}var gKe=mKe,yKe=Aoe,vKe=Dh,_Ke=gKe,xKe=Pc,bKe=gR;function wKe(e,t,r){var n=xKe(e)?yKe:_Ke;return r&&bKe(e,t,r)&&(t=void 0),n(e,vKe(t))}var SKe=wKe;const EKe=_a(SKe);var Th=function(t,r){var n=t.alwaysShow,o=t.ifOverflow;return n&&(o="extendDomain"),o===r},gK=Koe;function TKe(e,t,r){t=="__proto__"&&gK?gK(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var AKe=TKe,PKe=AKe,CKe=Goe,OKe=Dh;function kKe(e,t){var r={};return t=OKe(t),CKe(e,function(n,o,l){PKe(r,o,t(n,o,l))}),r}var IKe=kKe;const RKe=_a(IKe);function jKe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}var NKe=jKe,MKe=m5;function DKe(e,t){var r=!0;return MKe(e,function(n,o,l){return r=!!t(n,o,l),r}),r}var LKe=DKe,FKe=NKe,zKe=LKe,BKe=Dh,$Ke=Pc,UKe=gR;function VKe(e,t,r){var n=$Ke(e)?FKe:zKe;return r&&UKe(e,t,r)&&(t=void 0),n(e,BKe(t))}var qKe=VKe;const Ble=_a(qKe);var WKe=["x","y"];function gT(e){"@babel/helpers - typeof";return gT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gT(e)}function HF(){return HF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},HF.apply(this,arguments)}function yK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function wS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yK(Object(r),!0).forEach(function(n){GKe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function GKe(e,t,r){return t=HKe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function HKe(e){var t=KKe(e,"string");return gT(t)=="symbol"?t:t+""}function KKe(e,t){if(gT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(gT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ZKe(e,t){if(e==null)return{};var r=XKe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function XKe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function YKe(e,t){var r=e.x,n=e.y,o=ZKe(e,WKe),l="".concat(r),d=parseInt(l,10),i="".concat(n),g=parseInt(i,10),_="".concat(t.height||o.height),S=parseInt(_,10),E="".concat(t.width||o.width),T=parseInt(E,10);return wS(wS(wS(wS(wS({},t),o),d?{x:d}:{}),g?{y:g}:{}),{},{height:S,width:T,name:t.name,radius:t.radius})}function vK(e){return He.createElement(jle,HF({shapeType:"rectangle",propTransformer:YKe,activeClassName:"recharts-active-bar"},e))}var JKe=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(n,o){if(typeof t=="number")return t;var l=$r(n)||ENe(n);return l?t(n,o):(l||wv(),r)}},QKe=["value","background"],$le;function lb(e){"@babel/helpers - typeof";return lb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lb(e)}function eZe(e,t){if(e==null)return{};var r=tZe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function tZe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Pk(){return Pk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Pk.apply(this,arguments)}function _K(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Xo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_K(Object(r),!0).forEach(function(n){Am(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_K(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function rZe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xK(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Vle(n.key),n)}}function nZe(e,t,r){return t&&xK(e.prototype,t),r&&xK(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function iZe(e,t,r){return t=Ck(t),aZe(e,Ule()?Reflect.construct(t,r||[],Ck(e).constructor):t.apply(e,r))}function aZe(e,t){if(t&&(lb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return oZe(e)}function oZe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ule(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ule=function(){return!!e})()}function Ck(e){return Ck=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Ck(e)}function sZe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&KF(e,t)}function KF(e,t){return KF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},KF(e,t)}function Am(e,t,r){return t=Vle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Vle(e){var t=lZe(e,"string");return lb(t)=="symbol"?t:t+""}function lZe(e,t){if(lb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(lb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Su=function(e){function t(){var r;rZe(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return r=iZe(this,t,[].concat(o)),Am(r,"state",{isAnimationFinished:!1}),Am(r,"id",zb("recharts-bar-")),Am(r,"handleAnimationEnd",function(){var d=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),d&&d()}),Am(r,"handleAnimationStart",function(){var d=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),d&&d()}),r}return sZe(t,e),nZe(t,[{key:"renderRectanglesStatically",value:function(n){var o=this,l=this.props,d=l.shape,i=l.dataKey,g=l.activeIndex,_=l.activeBar,S=Gn(this.props,!1);return n&&n.map(function(E,T){var C=T===g,N=C?_:d,I=Xo(Xo(Xo({},S),E),{},{isActive:C,option:N,index:T,dataKey:i,onAnimationStart:o.handleAnimationStart,onAnimationEnd:o.handleAnimationEnd});return He.createElement(ya,Pk({className:"recharts-bar-rectangle"},_v(o.props,E,T),{key:"rectangle-".concat(E==null?void 0:E.x,"-").concat(E==null?void 0:E.y,"-").concat(E==null?void 0:E.value,"-").concat(T)}),He.createElement(vK,I))})}},{key:"renderRectanglesWithAnimation",value:function(){var n=this,o=this.props,l=o.data,d=o.layout,i=o.isAnimationActive,g=o.animationBegin,_=o.animationDuration,S=o.animationEasing,E=o.animationId,T=this.state.prevData;return He.createElement(Oh,{begin:g,duration:_,isActive:i,easing:S,from:{t:0},to:{t:1},key:"bar-".concat(E),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(C){var N=C.t,I=l.map(function(j,D){var R=T&&T[D];if(R){var F=Uc(R.x,j.x),B=Uc(R.y,j.y),U=Uc(R.width,j.width),Z=Uc(R.height,j.height);return Xo(Xo({},j),{},{x:F(N),y:B(N),width:U(N),height:Z(N)})}if(d==="horizontal"){var J=Uc(0,j.height),te=J(N);return Xo(Xo({},j),{},{y:j.y+j.height-te,height:te})}var ae=Uc(0,j.width),ne=ae(N);return Xo(Xo({},j),{},{width:ne})});return He.createElement(ya,null,n.renderRectanglesStatically(I))})}},{key:"renderRectangles",value:function(){var n=this.props,o=n.data,l=n.isAnimationActive,d=this.state.prevData;return l&&o&&o.length&&(!d||!a2(d,o))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(o)}},{key:"renderBackground",value:function(){var n=this,o=this.props,l=o.data,d=o.dataKey,i=o.activeIndex,g=Gn(this.props.background,!1);return l.map(function(_,S){_.value;var E=_.background,T=eZe(_,QKe);if(!E)return null;var C=Xo(Xo(Xo(Xo(Xo({},T),{},{fill:"#eee"},E),g),_v(n.props,_,S)),{},{onAnimationStart:n.handleAnimationStart,onAnimationEnd:n.handleAnimationEnd,dataKey:d,index:S,className:"recharts-bar-background-rectangle"});return He.createElement(vK,Pk({key:"background-bar-".concat(S),option:n.props.background,isActive:S===i},C))})}},{key:"renderErrorBar",value:function(n,o){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var l=this.props,d=l.data,i=l.xAxis,g=l.yAxis,_=l.layout,S=l.children,E=Yc(S,o2);if(!E)return null;var T=_==="vertical"?d[0].height/2:d[0].width/2,C=function(j,D){var R=Array.isArray(j.value)?j.value[1]:j.value;return{x:j.x,y:j.y,value:R,errorVal:ms(j,D)}},N={clipPath:n?"url(#clipPath-".concat(o,")"):null};return He.createElement(ya,N,E.map(function(I){return He.cloneElement(I,{key:"error-bar-".concat(o,"-").concat(I.props.dataKey),data:d,xAxis:i,yAxis:g,layout:_,offset:T,dataPointFormatter:C})}))}},{key:"render",value:function(){var n=this.props,o=n.hide,l=n.data,d=n.className,i=n.xAxis,g=n.yAxis,_=n.left,S=n.top,E=n.width,T=n.height,C=n.isAnimationActive,N=n.background,I=n.id;if(o||!l||!l.length)return null;var j=this.state.isAnimationFinished,D=Ti("recharts-bar",d),R=i&&i.allowDataOverflow,F=g&&g.allowDataOverflow,B=R||F,U=wi(I)?this.id:I;return He.createElement(ya,{className:D},R||F?He.createElement("defs",null,He.createElement("clipPath",{id:"clipPath-".concat(U)},He.createElement("rect",{x:R?_:_-E/2,y:F?S:S-T/2,width:R?E:E*2,height:F?T:T*2}))):null,He.createElement(ya,{className:"recharts-bar-rectangles",clipPath:B?"url(#clipPath-".concat(U,")"):null},N?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(B,U),(!C||j)&&kf.renderCallByParent(this.props,l))}}],[{key:"getDerivedStateFromProps",value:function(n,o){return n.animationId!==o.prevAnimationId?{prevAnimationId:n.animationId,curData:n.data,prevData:o.curData}:n.data!==o.curData?{curData:n.data}:null}}])}(W.PureComponent);$le=Su;Am(Su,"displayName","Bar");Am(Su,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!Sh.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});Am(Su,"getComposedData",function(e){var t=e.props,r=e.item,n=e.barPosition,o=e.bandSize,l=e.xAxis,d=e.yAxis,i=e.xAxisTicks,g=e.yAxisTicks,_=e.stackedData,S=e.dataStartIndex,E=e.displayedData,T=e.offset,C=Uqe(n,r);if(!C)return null;var N=t.layout,I=r.type.defaultProps,j=I!==void 0?Xo(Xo({},I),r.props):r.props,D=j.dataKey,R=j.children,F=j.minPointSize,B=N==="horizontal"?d:l,U=_?B.scale.domain():null,Z=Zqe({numericAxis:B}),J=Yc(R,qE),te=E.map(function(ae,ne){var ie,ee,oe,de,xe,we;_?ie=Vqe(_[S+ne],U):(ie=ms(ae,D),Array.isArray(ie)||(ie=[Z,ie]));var Ae=JKe(F,$le.defaultProps.minPointSize)(ie[1],ne);if(N==="horizontal"){var Ce,me=[d.scale(ie[0]),d.scale(ie[1])],Pe=me[0],ye=me[1];ee=c7({axis:l,ticks:i,bandSize:o,offset:C.offset,entry:ae,index:ne}),oe=(Ce=ye??Pe)!==null&&Ce!==void 0?Ce:void 0,de=C.size;var pe=Pe-ye;if(xe=Number.isNaN(pe)?0:pe,we={x:ee,y:d.y,width:de,height:d.height},Math.abs(Ae)>0&&Math.abs(xe)<Math.abs(Ae)){var Ie=ql(xe||Ae)*(Math.abs(Ae)-Math.abs(xe));oe-=Ie,xe+=Ie}}else{var tt=[l.scale(ie[0]),l.scale(ie[1])],Ze=tt[0],Le=tt[1];if(ee=Ze,oe=c7({axis:d,ticks:g,bandSize:o,offset:C.offset,entry:ae,index:ne}),de=Le-Ze,xe=C.size,we={x:l.x,y:oe,width:l.width,height:xe},Math.abs(Ae)>0&&Math.abs(de)<Math.abs(Ae)){var qe=ql(de||Ae)*(Math.abs(Ae)-Math.abs(de));de+=qe}}return Xo(Xo(Xo({},ae),{},{x:ee,y:oe,width:de,height:xe,value:_?ie:ie[1],payload:ae,background:we},J&&J[ne]&&J[ne].props),{},{tooltipPayload:[dle(r,ae)],tooltipPosition:{x:ee+de/2,y:oe+xe/2}})});return Xo({data:te,layout:N},T)});function yT(e){"@babel/helpers - typeof";return yT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yT(e)}function cZe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bK(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,qle(n.key),n)}}function uZe(e,t,r){return t&&bK(e.prototype,t),r&&bK(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function wK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function pd(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?wK(Object(r),!0).forEach(function(n){MR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function MR(e,t,r){return t=qle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qle(e){var t=dZe(e,"string");return yT(t)=="symbol"?t:t+""}function dZe(e,t){if(yT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(yT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Wle=function(t,r,n,o,l){var d=t.width,i=t.height,g=t.layout,_=t.children,S=Object.keys(r),E={left:n.left,leftMirror:n.left,right:d-n.right,rightMirror:d-n.right,top:n.top,topMirror:n.top,bottom:i-n.bottom,bottomMirror:i-n.bottom},T=!!zc(_,Su);return S.reduce(function(C,N){var I=r[N],j=I.orientation,D=I.domain,R=I.padding,F=R===void 0?{}:R,B=I.mirror,U=I.reversed,Z="".concat(j).concat(B?"Mirror":""),J,te,ae,ne,ie;if(I.type==="number"&&(I.padding==="gap"||I.padding==="no-gap")){var ee=D[1]-D[0],oe=1/0,de=I.categoricalDomain.sort(PNe);if(de.forEach(function(tt,Ze){Ze>0&&(oe=Math.min((tt||0)-(de[Ze-1]||0),oe))}),Number.isFinite(oe)){var xe=oe/ee,we=I.layout==="vertical"?n.height:n.width;if(I.padding==="gap"&&(J=xe*we/2),I.padding==="no-gap"){var Ae=Wl(t.barCategoryGap,xe*we),Ce=xe*we/2;J=Ce-Ae-(Ce-Ae)/we*Ae}}}o==="xAxis"?te=[n.left+(F.left||0)+(J||0),n.left+n.width-(F.right||0)-(J||0)]:o==="yAxis"?te=g==="horizontal"?[n.top+n.height-(F.bottom||0),n.top+(F.top||0)]:[n.top+(F.top||0)+(J||0),n.top+n.height-(F.bottom||0)-(J||0)]:te=I.range,U&&(te=[te[1],te[0]]);var me=sle(I,l,T),Pe=me.scale,ye=me.realScaleType;Pe.domain(D).range(te),lle(Pe);var pe=cle(Pe,pd(pd({},I),{},{realScaleType:ye}));o==="xAxis"?(ie=j==="top"&&!B||j==="bottom"&&B,ae=n.left,ne=E[Z]-ie*I.height):o==="yAxis"&&(ie=j==="left"&&!B||j==="right"&&B,ae=E[Z]-ie*I.width,ne=n.top);var Ie=pd(pd(pd({},I),pe),{},{realScaleType:ye,x:ae,y:ne,scale:Pe,width:o==="xAxis"?n.width:I.width,height:o==="yAxis"?n.height:I.height});return Ie.bandSize=dk(Ie,pe),!I.hide&&o==="xAxis"?E[Z]+=(ie?-1:1)*Ie.height:I.hide||(E[Z]+=(ie?-1:1)*Ie.width),pd(pd({},C),{},MR({},N,Ie))},{})},Gle=function(t,r){var n=t.x,o=t.y,l=r.x,d=r.y;return{x:Math.min(n,l),y:Math.min(o,d),width:Math.abs(l-n),height:Math.abs(d-o)}},hZe=function(t){var r=t.x1,n=t.y1,o=t.x2,l=t.y2;return Gle({x:r,y:n},{x:o,y:l})},Hle=function(){function e(t){cZe(this,e),this.scale=t}return uZe(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=n.bandAware,l=n.position;if(r!==void 0){if(l)switch(l){case"start":return this.scale(r);case"middle":{var d=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+d}case"end":{var i=this.bandwidth?this.bandwidth():0;return this.scale(r)+i}default:return this.scale(r)}if(o){var g=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+g}return this.scale(r)}}},{key:"isInRange",value:function(r){var n=this.range(),o=n[0],l=n[n.length-1];return o<=l?r>=o&&r<=l:r>=l&&r<=o}}],[{key:"create",value:function(r){return new e(r)}}])}();MR(Hle,"EPS",1e-4);var q5=function(t){var r=Object.keys(t).reduce(function(n,o){return pd(pd({},n),{},MR({},o,Hle.create(t[o])))},{});return pd(pd({},r),{},{apply:function(o){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=l.bandAware,i=l.position;return RKe(o,function(g,_){return r[_].apply(g,{bandAware:d,position:i})})},isInRange:function(o){return Ble(o,function(l,d){return r[d].isInRange(l)})}})};function fZe(e){return(e%180+180)%180}var pZe=function(t){var r=t.width,n=t.height,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,l=fZe(o),d=l*Math.PI/180,i=Math.atan(n/r),g=d>i&&d<Math.PI-i?n/Math.sin(d):r/Math.cos(d);return Math.abs(g)},mZe=Dh,gZe=e2,yZe=pR;function vZe(e){return function(t,r,n){var o=Object(t);if(!gZe(t)){var l=mZe(r);t=yZe(t),r=function(i){return l(o[i],i,o)}}var d=e(t,r,n);return d>-1?o[l?t[d]:d]:void 0}}var _Ze=vZe,xZe=Dle;function bZe(e){var t=xZe(e),r=t%1;return t===t?r?t-r:t:0}var wZe=bZe,SZe=Boe,EZe=Dh,TZe=wZe,AZe=Math.max;function PZe(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var o=r==null?0:TZe(r);return o<0&&(o=AZe(n+o,0)),SZe(e,EZe(t),o)}var CZe=PZe,OZe=_Ze,kZe=CZe,IZe=OZe(kZe),RZe=IZe;const jZe=_a(RZe);var NZe=Cje(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),W5=W.createContext(void 0),G5=W.createContext(void 0),Kle=W.createContext(void 0),Zle=W.createContext({}),Xle=W.createContext(void 0),Yle=W.createContext(0),Jle=W.createContext(0),SK=function(t){var r=t.state,n=r.xAxisMap,o=r.yAxisMap,l=r.offset,d=t.clipPathId,i=t.children,g=t.width,_=t.height,S=NZe(l);return He.createElement(W5.Provider,{value:n},He.createElement(G5.Provider,{value:o},He.createElement(Zle.Provider,{value:l},He.createElement(Kle.Provider,{value:S},He.createElement(Xle.Provider,{value:d},He.createElement(Yle.Provider,{value:_},He.createElement(Jle.Provider,{value:g},i)))))))},MZe=function(){return W.useContext(Xle)},Qle=function(t){var r=W.useContext(W5);r==null&&wv();var n=r[t];return n==null&&wv(),n},DZe=function(){var t=W.useContext(W5);return um(t)},LZe=function(){var t=W.useContext(G5),r=jZe(t,function(n){return Ble(n.domain,Number.isFinite)});return r||um(t)},ece=function(t){var r=W.useContext(G5);r==null&&wv();var n=r[t];return n==null&&wv(),n},FZe=function(){var t=W.useContext(Kle);return t},zZe=function(){return W.useContext(Zle)},H5=function(){return W.useContext(Jle)},K5=function(){return W.useContext(Yle)};function cb(e){"@babel/helpers - typeof";return cb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cb(e)}function BZe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $Ze(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,rce(n.key),n)}}function UZe(e,t,r){return t&&$Ze(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function VZe(e,t,r){return t=Ok(t),qZe(e,tce()?Reflect.construct(t,r||[],Ok(e).constructor):t.apply(e,r))}function qZe(e,t){if(t&&(cb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return WZe(e)}function WZe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(tce=function(){return!!e})()}function Ok(e){return Ok=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Ok(e)}function GZe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ZF(e,t)}function ZF(e,t){return ZF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},ZF(e,t)}function EK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function TK(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?EK(Object(r),!0).forEach(function(n){Z5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):EK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Z5(e,t,r){return t=rce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rce(e){var t=HZe(e,"string");return cb(t)=="symbol"?t:t+""}function HZe(e,t){if(cb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(cb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function KZe(e,t){return JZe(e)||YZe(e,t)||XZe(e,t)||ZZe()}function ZZe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XZe(e,t){if(e){if(typeof e=="string")return AK(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return AK(e,t)}}function AK(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function YZe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,_=!1;try{if(l=(r=r.call(e)).next,t!==0)for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){_=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(_)throw o}}return i}}function JZe(e){if(Array.isArray(e))return e}function XF(){return XF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},XF.apply(this,arguments)}var QZe=function(t,r){var n;return He.isValidElement(t)?n=He.cloneElement(t,r):li(t)?n=t(r):n=He.createElement("line",XF({},r,{className:"recharts-reference-line-line"})),n},eXe=function(t,r,n,o,l,d,i,g,_){var S=l.x,E=l.y,T=l.width,C=l.height;if(n){var N=_.y,I=t.y.apply(N,{position:d});if(Th(_,"discard")&&!t.y.isInRange(I))return null;var j=[{x:S+T,y:I},{x:S,y:I}];return g==="left"?j.reverse():j}if(r){var D=_.x,R=t.x.apply(D,{position:d});if(Th(_,"discard")&&!t.x.isInRange(R))return null;var F=[{x:R,y:E+C},{x:R,y:E}];return i==="top"?F.reverse():F}if(o){var B=_.segment,U=B.map(function(Z){return t.apply(Z,{position:d})});return Th(_,"discard")&&EKe(U,function(Z){return!t.isInRange(Z)})?null:U}return null};function tXe(e){var t=e.x,r=e.y,n=e.segment,o=e.xAxisId,l=e.yAxisId,d=e.shape,i=e.className,g=e.alwaysShow,_=MZe(),S=Qle(o),E=ece(l),T=FZe();if(!_||!T)return null;Ed(g===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var C=q5({x:S.scale,y:E.scale}),N=vs(t),I=vs(r),j=n&&n.length===2,D=eXe(C,N,I,j,T,e.position,S.orientation,E.orientation,e);if(!D)return null;var R=KZe(D,2),F=R[0],B=F.x,U=F.y,Z=R[1],J=Z.x,te=Z.y,ae=Th(e,"hidden")?"url(#".concat(_,")"):void 0,ne=TK(TK({clipPath:ae},Gn(e,!0)),{},{x1:B,y1:U,x2:J,y2:te});return He.createElement(ya,{className:Ti("recharts-reference-line",i)},QZe(d,ne),Os.renderCallByParent(e,hZe({x1:B,y1:U,x2:J,y2:te})))}var X5=function(e){function t(){return BZe(this,t),VZe(this,t,arguments)}return GZe(t,e),UZe(t,[{key:"render",value:function(){return He.createElement(tXe,this.props)}}])}(He.Component);Z5(X5,"displayName","ReferenceLine");Z5(X5,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function YF(){return YF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},YF.apply(this,arguments)}function ub(e){"@babel/helpers - typeof";return ub=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ub(e)}function PK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function CK(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?PK(Object(r),!0).forEach(function(n){DR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):PK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function rXe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function nXe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ice(n.key),n)}}function iXe(e,t,r){return t&&nXe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function aXe(e,t,r){return t=kk(t),oXe(e,nce()?Reflect.construct(t,r||[],kk(e).constructor):t.apply(e,r))}function oXe(e,t){if(t&&(ub(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return sXe(e)}function sXe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(nce=function(){return!!e})()}function kk(e){return kk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},kk(e)}function lXe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&JF(e,t)}function JF(e,t){return JF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},JF(e,t)}function DR(e,t,r){return t=ice(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ice(e){var t=cXe(e,"string");return ub(t)=="symbol"?t:t+""}function cXe(e,t){if(ub(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ub(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var uXe=function(t){var r=t.x,n=t.y,o=t.xAxis,l=t.yAxis,d=q5({x:o.scale,y:l.scale}),i=d.apply({x:r,y:n},{bandAware:!0});return Th(t,"discard")&&!d.isInRange(i)?null:i},LR=function(e){function t(){return rXe(this,t),aXe(this,t,arguments)}return lXe(t,e),iXe(t,[{key:"render",value:function(){var n=this.props,o=n.x,l=n.y,d=n.r,i=n.alwaysShow,g=n.clipPathId,_=vs(o),S=vs(l);if(Ed(i===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!_||!S)return null;var E=uXe(this.props);if(!E)return null;var T=E.x,C=E.y,N=this.props,I=N.shape,j=N.className,D=Th(this.props,"hidden")?"url(#".concat(g,")"):void 0,R=CK(CK({clipPath:D},Gn(this.props,!0)),{},{cx:T,cy:C});return He.createElement(ya,{className:Ti("recharts-reference-dot",j)},t.renderDot(I,R),Os.renderCallByParent(this.props,{x:T-d,y:C-d,width:2*d,height:2*d}))}}])}(He.Component);DR(LR,"displayName","ReferenceDot");DR(LR,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});DR(LR,"renderDot",function(e,t){var r;return He.isValidElement(e)?r=He.cloneElement(e,t):li(e)?r=e(t):r=He.createElement(CR,YF({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),r});function QF(){return QF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},QF.apply(this,arguments)}function db(e){"@babel/helpers - typeof";return db=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},db(e)}function OK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function kK(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?OK(Object(r),!0).forEach(function(n){FR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):OK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function dXe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function hXe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,oce(n.key),n)}}function fXe(e,t,r){return t&&hXe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function pXe(e,t,r){return t=Ik(t),mXe(e,ace()?Reflect.construct(t,r||[],Ik(e).constructor):t.apply(e,r))}function mXe(e,t){if(t&&(db(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return gXe(e)}function gXe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ace(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ace=function(){return!!e})()}function Ik(e){return Ik=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Ik(e)}function yXe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ez(e,t)}function ez(e,t){return ez=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},ez(e,t)}function FR(e,t,r){return t=oce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function oce(e){var t=vXe(e,"string");return db(t)=="symbol"?t:t+""}function vXe(e,t){if(db(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(db(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var _Xe=function(t,r,n,o,l){var d=l.x1,i=l.x2,g=l.y1,_=l.y2,S=l.xAxis,E=l.yAxis;if(!S||!E)return null;var T=q5({x:S.scale,y:E.scale}),C={x:t?T.x.apply(d,{position:"start"}):T.x.rangeMin,y:n?T.y.apply(g,{position:"start"}):T.y.rangeMin},N={x:r?T.x.apply(i,{position:"end"}):T.x.rangeMax,y:o?T.y.apply(_,{position:"end"}):T.y.rangeMax};return Th(l,"discard")&&(!T.isInRange(C)||!T.isInRange(N))?null:Gle(C,N)},zR=function(e){function t(){return dXe(this,t),pXe(this,t,arguments)}return yXe(t,e),fXe(t,[{key:"render",value:function(){var n=this.props,o=n.x1,l=n.x2,d=n.y1,i=n.y2,g=n.className,_=n.alwaysShow,S=n.clipPathId;Ed(_===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var E=vs(o),T=vs(l),C=vs(d),N=vs(i),I=this.props.shape;if(!E&&!T&&!C&&!N&&!I)return null;var j=_Xe(E,T,C,N,this.props);if(!j&&!I)return null;var D=Th(this.props,"hidden")?"url(#".concat(S,")"):void 0;return He.createElement(ya,{className:Ti("recharts-reference-area",g)},t.renderRect(I,kK(kK({clipPath:D},Gn(this.props,!0)),j)),Os.renderCallByParent(this.props,j))}}])}(He.Component);FR(zR,"displayName","ReferenceArea");FR(zR,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});FR(zR,"renderRect",function(e,t){var r;return He.isValidElement(e)?r=He.cloneElement(e,t):li(e)?r=e(t):r=He.createElement(V5,QF({},t,{className:"recharts-reference-area-rect"})),r});function sce(e,t,r){if(t<1)return[];if(t===1&&r===void 0)return e;for(var n=[],o=0;o<e.length;o+=t)n.push(e[o]);return n}function xXe(e,t,r){var n={width:e.width+t.width,height:e.height+t.height};return pZe(n,r)}function bXe(e,t,r){var n=r==="width",o=e.x,l=e.y,d=e.width,i=e.height;return t===1?{start:n?o:l,end:n?o+d:l+i}:{start:n?o+d:l+i,end:n?o:l}}function Rk(e,t,r,n,o){if(e*t<e*n||e*t>e*o)return!1;var l=r();return e*(t-e*l/2-n)>=0&&e*(t+e*l/2-o)<=0}function wXe(e,t){return sce(e,t+1)}function SXe(e,t,r,n,o){for(var l=(n||[]).slice(),d=t.start,i=t.end,g=0,_=1,S=d,E=function(){var N=n==null?void 0:n[g];if(N===void 0)return{v:sce(n,_)};var I=g,j,D=function(){return j===void 0&&(j=r(N,I)),j},R=N.coordinate,F=g===0||Rk(e,R,D,S,i);F||(g=0,S=d,_+=1),F&&(S=R+e*(D()/2+o),g+=_)},T;_<=l.length;)if(T=E(),T)return T.v;return[]}function vT(e){"@babel/helpers - typeof";return vT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vT(e)}function IK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function ol(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?IK(Object(r),!0).forEach(function(n){EXe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):IK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function EXe(e,t,r){return t=TXe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function TXe(e){var t=AXe(e,"string");return vT(t)=="symbol"?t:t+""}function AXe(e,t){if(vT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(vT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function PXe(e,t,r,n,o){for(var l=(n||[]).slice(),d=l.length,i=t.start,g=t.end,_=function(T){var C=l[T],N,I=function(){return N===void 0&&(N=r(C,T)),N};if(T===d-1){var j=e*(C.coordinate+e*I()/2-g);l[T]=C=ol(ol({},C),{},{tickCoord:j>0?C.coordinate-j*e:C.coordinate})}else l[T]=C=ol(ol({},C),{},{tickCoord:C.coordinate});var D=Rk(e,C.tickCoord,I,i,g);D&&(g=C.tickCoord-e*(I()/2+o),l[T]=ol(ol({},C),{},{isShow:!0}))},S=d-1;S>=0;S--)_(S);return l}function CXe(e,t,r,n,o,l){var d=(n||[]).slice(),i=d.length,g=t.start,_=t.end;if(l){var S=n[i-1],E=r(S,i-1),T=e*(S.coordinate+e*E/2-_);d[i-1]=S=ol(ol({},S),{},{tickCoord:T>0?S.coordinate-T*e:S.coordinate});var C=Rk(e,S.tickCoord,function(){return E},g,_);C&&(_=S.tickCoord-e*(E/2+o),d[i-1]=ol(ol({},S),{},{isShow:!0}))}for(var N=l?i-1:i,I=function(R){var F=d[R],B,U=function(){return B===void 0&&(B=r(F,R)),B};if(R===0){var Z=e*(F.coordinate-e*U()/2-g);d[R]=F=ol(ol({},F),{},{tickCoord:Z<0?F.coordinate-Z*e:F.coordinate})}else d[R]=F=ol(ol({},F),{},{tickCoord:F.coordinate});var J=Rk(e,F.tickCoord,U,g,_);J&&(g=F.tickCoord+e*(U()/2+o),d[R]=ol(ol({},F),{},{isShow:!0}))},j=0;j<N;j++)I(j);return d}function Y5(e,t,r){var n=e.tick,o=e.ticks,l=e.viewBox,d=e.minTickGap,i=e.orientation,g=e.interval,_=e.tickFormatter,S=e.unit,E=e.angle;if(!o||!o.length||!n)return[];if($r(g)||Sh.isSsr)return wXe(o,typeof g=="number"&&$r(g)?g:0);var T=[],C=i==="top"||i==="bottom"?"width":"height",N=S&&C==="width"?QS(S,{fontSize:t,letterSpacing:r}):{width:0,height:0},I=function(F,B){var U=li(_)?_(F.value,B):F.value;return C==="width"?xXe(QS(U,{fontSize:t,letterSpacing:r}),N,E):QS(U,{fontSize:t,letterSpacing:r})[C]},j=o.length>=2?ql(o[1].coordinate-o[0].coordinate):1,D=bXe(l,j,C);return g==="equidistantPreserveStart"?SXe(j,D,I,o,d):(g==="preserveStart"||g==="preserveStartEnd"?T=CXe(j,D,I,o,d,g==="preserveStartEnd"):T=PXe(j,D,I,o,d),T.filter(function(R){return R.isShow}))}var OXe=["viewBox"],kXe=["viewBox"],IXe=["ticks"];function hb(e){"@babel/helpers - typeof";return hb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hb(e)}function Wx(){return Wx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Wx.apply(this,arguments)}function RK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function ls(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?RK(Object(r),!0).forEach(function(n){J5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):RK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ED(e,t){if(e==null)return{};var r=RXe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function RXe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function jXe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function jK(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,cce(n.key),n)}}function NXe(e,t,r){return t&&jK(e.prototype,t),r&&jK(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function MXe(e,t,r){return t=jk(t),DXe(e,lce()?Reflect.construct(t,r||[],jk(e).constructor):t.apply(e,r))}function DXe(e,t){if(t&&(hb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return LXe(e)}function LXe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function lce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(lce=function(){return!!e})()}function jk(e){return jk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},jk(e)}function FXe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tz(e,t)}function tz(e,t){return tz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},tz(e,t)}function J5(e,t,r){return t=cce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cce(e){var t=zXe(e,"string");return hb(t)=="symbol"?t:t+""}function zXe(e,t){if(hb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(hb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Gb=function(e){function t(r){var n;return jXe(this,t),n=MXe(this,t,[r]),n.state={fontSize:"",letterSpacing:""},n}return FXe(t,e),NXe(t,[{key:"shouldComponentUpdate",value:function(n,o){var l=n.viewBox,d=ED(n,OXe),i=this.props,g=i.viewBox,_=ED(i,kXe);return!o0(l,g)||!o0(d,_)||!o0(o,this.state)}},{key:"componentDidMount",value:function(){var n=this.layerReference;if(n){var o=n.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];o&&this.setState({fontSize:window.getComputedStyle(o).fontSize,letterSpacing:window.getComputedStyle(o).letterSpacing})}}},{key:"getTickLineCoord",value:function(n){var o=this.props,l=o.x,d=o.y,i=o.width,g=o.height,_=o.orientation,S=o.tickSize,E=o.mirror,T=o.tickMargin,C,N,I,j,D,R,F=E?-1:1,B=n.tickSize||S,U=$r(n.tickCoord)?n.tickCoord:n.coordinate;switch(_){case"top":C=N=n.coordinate,j=d+ +!E*g,I=j-F*B,R=I-F*T,D=U;break;case"left":I=j=n.coordinate,N=l+ +!E*i,C=N-F*B,D=C-F*T,R=U;break;case"right":I=j=n.coordinate,N=l+ +E*i,C=N+F*B,D=C+F*T,R=U;break;default:C=N=n.coordinate,j=d+ +E*g,I=j+F*B,R=I+F*T,D=U;break}return{line:{x1:C,y1:I,x2:N,y2:j},tick:{x:D,y:R}}}},{key:"getTickTextAnchor",value:function(){var n=this.props,o=n.orientation,l=n.mirror,d;switch(o){case"left":d=l?"start":"end";break;case"right":d=l?"end":"start";break;default:d="middle";break}return d}},{key:"getTickVerticalAnchor",value:function(){var n=this.props,o=n.orientation,l=n.mirror,d="end";switch(o){case"left":case"right":d="middle";break;case"top":d=l?"start":"end";break;default:d=l?"end":"start";break}return d}},{key:"renderAxisLine",value:function(){var n=this.props,o=n.x,l=n.y,d=n.width,i=n.height,g=n.orientation,_=n.mirror,S=n.axisLine,E=ls(ls(ls({},Gn(this.props,!1)),Gn(S,!1)),{},{fill:"none"});if(g==="top"||g==="bottom"){var T=+(g==="top"&&!_||g==="bottom"&&_);E=ls(ls({},E),{},{x1:o,y1:l+T*i,x2:o+d,y2:l+T*i})}else{var C=+(g==="left"&&!_||g==="right"&&_);E=ls(ls({},E),{},{x1:o+C*d,y1:l,x2:o+C*d,y2:l+i})}return He.createElement("line",Wx({},E,{className:Ti("recharts-cartesian-axis-line",Xc(S,"className"))}))}},{key:"renderTicks",value:function(n,o,l){var d=this,i=this.props,g=i.tickLine,_=i.stroke,S=i.tick,E=i.tickFormatter,T=i.unit,C=Y5(ls(ls({},this.props),{},{ticks:n}),o,l),N=this.getTickTextAnchor(),I=this.getTickVerticalAnchor(),j=Gn(this.props,!1),D=Gn(S,!1),R=ls(ls({},j),{},{fill:"none"},Gn(g,!1)),F=C.map(function(B,U){var Z=d.getTickLineCoord(B),J=Z.line,te=Z.tick,ae=ls(ls(ls(ls({textAnchor:N,verticalAnchor:I},j),{},{stroke:"none",fill:_},D),te),{},{index:U,payload:B,visibleTicksCount:C.length,tickFormatter:E});return He.createElement(ya,Wx({className:"recharts-cartesian-axis-tick",key:"tick-".concat(B.value,"-").concat(B.coordinate,"-").concat(B.tickCoord)},_v(d.props,B,U)),g&&He.createElement("line",Wx({},R,J,{className:Ti("recharts-cartesian-axis-tick-line",Xc(g,"className"))})),S&&t.renderTickItem(S,ae,"".concat(li(E)?E(B.value,U):B.value).concat(T||"")))});return He.createElement("g",{className:"recharts-cartesian-axis-ticks"},F)}},{key:"render",value:function(){var n=this,o=this.props,l=o.axisLine,d=o.width,i=o.height,g=o.ticksGenerator,_=o.className,S=o.hide;if(S)return null;var E=this.props,T=E.ticks,C=ED(E,IXe),N=T;return li(g)&&(N=T&&T.length>0?g(this.props):g(C)),d<=0||i<=0||!N||!N.length?null:He.createElement(ya,{className:Ti("recharts-cartesian-axis",_),ref:function(j){n.layerReference=j}},l&&this.renderAxisLine(),this.renderTicks(N,this.state.fontSize,this.state.letterSpacing),Os.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(n,o,l){var d,i=Ti(o.className,"recharts-cartesian-axis-tick-value");return He.isValidElement(n)?d=He.cloneElement(n,ls(ls({},o),{},{className:i})):li(n)?d=n(ls(ls({},o),{},{className:i})):d=He.createElement(xv,Wx({},o,{className:"recharts-cartesian-axis-tick-value"}),l),d}}])}(W.Component);J5(Gb,"displayName","CartesianAxis");J5(Gb,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var BXe=["x1","y1","x2","y2","key"],$Xe=["offset"];function Sv(e){"@babel/helpers - typeof";return Sv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sv(e)}function NK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function pl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?NK(Object(r),!0).forEach(function(n){UXe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):NK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function UXe(e,t,r){return t=VXe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function VXe(e){var t=qXe(e,"string");return Sv(t)=="symbol"?t:t+""}function qXe(e,t){if(Sv(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Sv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function $y(){return $y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},$y.apply(this,arguments)}function MK(e,t){if(e==null)return{};var r=WXe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function WXe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var GXe=function(t){var r=t.fill;if(!r||r==="none")return null;var n=t.fillOpacity,o=t.x,l=t.y,d=t.width,i=t.height,g=t.ry;return He.createElement("rect",{x:o,y:l,ry:g,width:d,height:i,stroke:"none",fill:r,fillOpacity:n,className:"recharts-cartesian-grid-bg"})};function uce(e,t){var r;if(He.isValidElement(e))r=He.cloneElement(e,t);else if(li(e))r=e(t);else{var n=t.x1,o=t.y1,l=t.x2,d=t.y2,i=t.key,g=MK(t,BXe),_=Gn(g,!1);_.offset;var S=MK(_,$Xe);r=He.createElement("line",$y({},S,{x1:n,y1:o,x2:l,y2:d,fill:"none",key:i}))}return r}function HXe(e){var t=e.x,r=e.width,n=e.horizontal,o=n===void 0?!0:n,l=e.horizontalPoints;if(!o||!l||!l.length)return null;var d=l.map(function(i,g){var _=pl(pl({},e),{},{x1:t,y1:i,x2:t+r,y2:i,key:"line-".concat(g),index:g});return uce(o,_)});return He.createElement("g",{className:"recharts-cartesian-grid-horizontal"},d)}function KXe(e){var t=e.y,r=e.height,n=e.vertical,o=n===void 0?!0:n,l=e.verticalPoints;if(!o||!l||!l.length)return null;var d=l.map(function(i,g){var _=pl(pl({},e),{},{x1:i,y1:t,x2:i,y2:t+r,key:"line-".concat(g),index:g});return uce(o,_)});return He.createElement("g",{className:"recharts-cartesian-grid-vertical"},d)}function ZXe(e){var t=e.horizontalFill,r=e.fillOpacity,n=e.x,o=e.y,l=e.width,d=e.height,i=e.horizontalPoints,g=e.horizontal,_=g===void 0?!0:g;if(!_||!t||!t.length)return null;var S=i.map(function(T){return Math.round(T+o-o)}).sort(function(T,C){return T-C});o!==S[0]&&S.unshift(0);var E=S.map(function(T,C){var N=!S[C+1],I=N?o+d-T:S[C+1]-T;if(I<=0)return null;var j=C%t.length;return He.createElement("rect",{key:"react-".concat(C),y:T,x:n,height:I,width:l,stroke:"none",fill:t[j],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return He.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},E)}function XXe(e){var t=e.vertical,r=t===void 0?!0:t,n=e.verticalFill,o=e.fillOpacity,l=e.x,d=e.y,i=e.width,g=e.height,_=e.verticalPoints;if(!r||!n||!n.length)return null;var S=_.map(function(T){return Math.round(T+l-l)}).sort(function(T,C){return T-C});l!==S[0]&&S.unshift(0);var E=S.map(function(T,C){var N=!S[C+1],I=N?l+i-T:S[C+1]-T;if(I<=0)return null;var j=C%n.length;return He.createElement("rect",{key:"react-".concat(C),x:T,y:d,width:I,height:g,stroke:"none",fill:n[j],fillOpacity:o,className:"recharts-cartesian-grid-bg"})});return He.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},E)}var YXe=function(t,r){var n=t.xAxis,o=t.width,l=t.height,d=t.offset;return ole(Y5(pl(pl(pl({},Gb.defaultProps),n),{},{ticks:Ef(n,!0),viewBox:{x:0,y:0,width:o,height:l}})),d.left,d.left+d.width,r)},JXe=function(t,r){var n=t.yAxis,o=t.width,l=t.height,d=t.offset;return ole(Y5(pl(pl(pl({},Gb.defaultProps),n),{},{ticks:Ef(n,!0),viewBox:{x:0,y:0,width:o,height:l}})),d.top,d.top+d.height,r)},Tx={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function Uy(e){var t,r,n,o,l,d,i=H5(),g=K5(),_=zZe(),S=pl(pl({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:Tx.stroke,fill:(r=e.fill)!==null&&r!==void 0?r:Tx.fill,horizontal:(n=e.horizontal)!==null&&n!==void 0?n:Tx.horizontal,horizontalFill:(o=e.horizontalFill)!==null&&o!==void 0?o:Tx.horizontalFill,vertical:(l=e.vertical)!==null&&l!==void 0?l:Tx.vertical,verticalFill:(d=e.verticalFill)!==null&&d!==void 0?d:Tx.verticalFill,x:$r(e.x)?e.x:_.left,y:$r(e.y)?e.y:_.top,width:$r(e.width)?e.width:_.width,height:$r(e.height)?e.height:_.height}),E=S.x,T=S.y,C=S.width,N=S.height,I=S.syncWithTicks,j=S.horizontalValues,D=S.verticalValues,R=DZe(),F=LZe();if(!$r(C)||C<=0||!$r(N)||N<=0||!$r(E)||E!==+E||!$r(T)||T!==+T)return null;var B=S.verticalCoordinatesGenerator||YXe,U=S.horizontalCoordinatesGenerator||JXe,Z=S.horizontalPoints,J=S.verticalPoints;if((!Z||!Z.length)&&li(U)){var te=j&&j.length,ae=U({yAxis:F?pl(pl({},F),{},{ticks:te?j:F.ticks}):void 0,width:i,height:g,offset:_},te?!0:I);Ed(Array.isArray(ae),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(Sv(ae),"]")),Array.isArray(ae)&&(Z=ae)}if((!J||!J.length)&&li(B)){var ne=D&&D.length,ie=B({xAxis:R?pl(pl({},R),{},{ticks:ne?D:R.ticks}):void 0,width:i,height:g,offset:_},ne?!0:I);Ed(Array.isArray(ie),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(Sv(ie),"]")),Array.isArray(ie)&&(J=ie)}return He.createElement("g",{className:"recharts-cartesian-grid"},He.createElement(GXe,{fill:S.fill,fillOpacity:S.fillOpacity,x:S.x,y:S.y,width:S.width,height:S.height,ry:S.ry}),He.createElement(HXe,$y({},S,{offset:_,horizontalPoints:Z,xAxis:R,yAxis:F})),He.createElement(KXe,$y({},S,{offset:_,verticalPoints:J,xAxis:R,yAxis:F})),He.createElement(ZXe,$y({},S,{horizontalPoints:Z})),He.createElement(XXe,$y({},S,{verticalPoints:J})))}Uy.displayName="CartesianGrid";var QXe=["type","layout","connectNulls","ref"],eYe=["key"];function fb(e){"@babel/helpers - typeof";return fb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fb(e)}function DK(e,t){if(e==null)return{};var r=tYe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function tYe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function aE(){return aE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},aE.apply(this,arguments)}function LK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Mc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?LK(Object(r),!0).forEach(function(n){md(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):LK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ax(e){return aYe(e)||iYe(e)||nYe(e)||rYe()}function rYe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nYe(e,t){if(e){if(typeof e=="string")return rz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rz(e,t)}}function iYe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function aYe(e){if(Array.isArray(e))return rz(e)}function rz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function oYe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function FK(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,hce(n.key),n)}}function sYe(e,t,r){return t&&FK(e.prototype,t),r&&FK(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function lYe(e,t,r){return t=Nk(t),cYe(e,dce()?Reflect.construct(t,r||[],Nk(e).constructor):t.apply(e,r))}function cYe(e,t){if(t&&(fb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return uYe(e)}function uYe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function dce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(dce=function(){return!!e})()}function Nk(e){return Nk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Nk(e)}function dYe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&nz(e,t)}function nz(e,t){return nz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},nz(e,t)}function md(e,t,r){return t=hce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hce(e){var t=hYe(e,"string");return fb(t)=="symbol"?t:t+""}function hYe(e,t){if(fb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(fb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Hb=function(e){function t(){var r;oYe(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return r=lYe(this,t,[].concat(o)),md(r,"state",{isAnimationFinished:!0,totalLength:0}),md(r,"generateSimpleStrokeDasharray",function(d,i){return"".concat(i,"px ").concat(d-i,"px")}),md(r,"getStrokeDasharray",function(d,i,g){var _=g.reduce(function(D,R){return D+R});if(!_)return r.generateSimpleStrokeDasharray(i,d);for(var S=Math.floor(d/_),E=d%_,T=i-d,C=[],N=0,I=0;N<g.length;I+=g[N],++N)if(I+g[N]>E){C=[].concat(Ax(g.slice(0,N)),[E-I]);break}var j=C.length%2===0?[0,T]:[T];return[].concat(Ax(t.repeat(g,S)),Ax(C),j).map(function(D){return"".concat(D,"px")}).join(", ")}),md(r,"id",zb("recharts-line-")),md(r,"pathRef",function(d){r.mainCurve=d}),md(r,"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0}),r.props.onAnimationEnd&&r.props.onAnimationEnd()}),md(r,"handleAnimationStart",function(){r.setState({isAnimationFinished:!1}),r.props.onAnimationStart&&r.props.onAnimationStart()}),r}return dYe(t,e),sYe(t,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();this.setState({totalLength:n})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();n!==this.state.totalLength&&this.setState({totalLength:n})}}},{key:"getTotalLength",value:function(){var n=this.mainCurve;try{return n&&n.getTotalLength&&n.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(n,o){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var l=this.props,d=l.points,i=l.xAxis,g=l.yAxis,_=l.layout,S=l.children,E=Yc(S,o2);if(!E)return null;var T=function(I,j){return{x:I.x,y:I.y,value:I.value,errorVal:ms(I.payload,j)}},C={clipPath:n?"url(#clipPath-".concat(o,")"):null};return He.createElement(ya,C,E.map(function(N){return He.cloneElement(N,{key:"bar-".concat(N.props.dataKey),data:d,xAxis:i,yAxis:g,layout:_,dataPointFormatter:T})}))}},{key:"renderDots",value:function(n,o,l){var d=this.props.isAnimationActive;if(d&&!this.state.isAnimationFinished)return null;var i=this.props,g=i.dot,_=i.points,S=i.dataKey,E=Gn(this.props,!1),T=Gn(g,!0),C=_.map(function(I,j){var D=Mc(Mc(Mc({key:"dot-".concat(j),r:3},E),T),{},{index:j,cx:I.x,cy:I.y,value:I.value,dataKey:S,payload:I.payload,points:_});return t.renderDotItem(g,D)}),N={clipPath:n?"url(#clipPath-".concat(o?"":"dots-").concat(l,")"):null};return He.createElement(ya,aE({className:"recharts-line-dots",key:"dots"},N),C)}},{key:"renderCurveStatically",value:function(n,o,l,d){var i=this.props,g=i.type,_=i.layout,S=i.connectNulls;i.ref;var E=DK(i,QXe),T=Mc(Mc(Mc({},Gn(E,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:o?"url(#clipPath-".concat(l,")"):null,points:n},d),{},{type:g,layout:_,connectNulls:S});return He.createElement(pk,aE({},T,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(n,o){var l=this,d=this.props,i=d.points,g=d.strokeDasharray,_=d.isAnimationActive,S=d.animationBegin,E=d.animationDuration,T=d.animationEasing,C=d.animationId,N=d.animateNewValues,I=d.width,j=d.height,D=this.state,R=D.prevPoints,F=D.totalLength;return He.createElement(Oh,{begin:S,duration:E,isActive:_,easing:T,from:{t:0},to:{t:1},key:"line-".concat(C),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(B){var U=B.t;if(R){var Z=R.length/i.length,J=i.map(function(ee,oe){var de=Math.floor(oe*Z);if(R[de]){var xe=R[de],we=Uc(xe.x,ee.x),Ae=Uc(xe.y,ee.y);return Mc(Mc({},ee),{},{x:we(U),y:Ae(U)})}if(N){var Ce=Uc(I*2,ee.x),me=Uc(j/2,ee.y);return Mc(Mc({},ee),{},{x:Ce(U),y:me(U)})}return Mc(Mc({},ee),{},{x:ee.x,y:ee.y})});return l.renderCurveStatically(J,n,o)}var te=Uc(0,F),ae=te(U),ne;if(g){var ie="".concat(g).split(/[,\s]+/gim).map(function(ee){return parseFloat(ee)});ne=l.getStrokeDasharray(ae,F,ie)}else ne=l.generateSimpleStrokeDasharray(F,ae);return l.renderCurveStatically(i,n,o,{strokeDasharray:ne})})}},{key:"renderCurve",value:function(n,o){var l=this.props,d=l.points,i=l.isAnimationActive,g=this.state,_=g.prevPoints,S=g.totalLength;return i&&d&&d.length&&(!_&&S>0||!a2(_,d))?this.renderCurveWithAnimation(n,o):this.renderCurveStatically(d,n,o)}},{key:"render",value:function(){var n,o=this.props,l=o.hide,d=o.dot,i=o.points,g=o.className,_=o.xAxis,S=o.yAxis,E=o.top,T=o.left,C=o.width,N=o.height,I=o.isAnimationActive,j=o.id;if(l||!i||!i.length)return null;var D=this.state.isAnimationFinished,R=i.length===1,F=Ti("recharts-line",g),B=_&&_.allowDataOverflow,U=S&&S.allowDataOverflow,Z=B||U,J=wi(j)?this.id:j,te=(n=Gn(d,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},ae=te.r,ne=ae===void 0?3:ae,ie=te.strokeWidth,ee=ie===void 0?2:ie,oe=DNe(d)?d:{},de=oe.clipDot,xe=de===void 0?!0:de,we=ne*2+ee;return He.createElement(ya,{className:F},B||U?He.createElement("defs",null,He.createElement("clipPath",{id:"clipPath-".concat(J)},He.createElement("rect",{x:B?T:T-C/2,y:U?E:E-N/2,width:B?C:C*2,height:U?N:N*2})),!xe&&He.createElement("clipPath",{id:"clipPath-dots-".concat(J)},He.createElement("rect",{x:T-we/2,y:E-we/2,width:C+we,height:N+we}))):null,!R&&this.renderCurve(Z,J),this.renderErrorBar(Z,J),(R||d)&&this.renderDots(Z,xe,J),(!I||D)&&kf.renderCallByParent(this.props,i))}}],[{key:"getDerivedStateFromProps",value:function(n,o){return n.animationId!==o.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:o.curPoints}:n.points!==o.curPoints?{curPoints:n.points}:null}},{key:"repeat",value:function(n,o){for(var l=n.length%2!==0?[].concat(Ax(n),[0]):n,d=[],i=0;i<o;++i)d=[].concat(Ax(d),Ax(l));return d}},{key:"renderDotItem",value:function(n,o){var l;if(He.isValidElement(n))l=He.cloneElement(n,o);else if(li(n))l=n(o);else{var d=o.key,i=DK(o,eYe),g=Ti("recharts-line-dot",typeof n!="boolean"?n.className:"");l=He.createElement(CR,aE({key:d},i,{className:g}))}return l}}])}(W.PureComponent);md(Hb,"displayName","Line");md(Hb,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Sh.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});md(Hb,"getComposedData",function(e){var t=e.props,r=e.xAxis,n=e.yAxis,o=e.xAxisTicks,l=e.yAxisTicks,d=e.dataKey,i=e.bandSize,g=e.displayedData,_=e.offset,S=t.layout,E=g.map(function(T,C){var N=ms(T,d);return S==="horizontal"?{x:l7({axis:r,ticks:o,bandSize:i,entry:T,index:C}),y:wi(N)?null:n.scale(N),value:N,payload:T}:{x:wi(N)?null:r.scale(N),y:l7({axis:n,ticks:l,bandSize:i,entry:T,index:C}),value:N,payload:T}});return Mc({points:E,layout:S},_)});function pb(e){"@babel/helpers - typeof";return pb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pb(e)}function fYe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pYe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,mce(n.key),n)}}function mYe(e,t,r){return t&&pYe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function gYe(e,t,r){return t=Mk(t),yYe(e,fce()?Reflect.construct(t,r||[],Mk(e).constructor):t.apply(e,r))}function yYe(e,t){if(t&&(pb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vYe(e)}function vYe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(fce=function(){return!!e})()}function Mk(e){return Mk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Mk(e)}function _Ye(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&iz(e,t)}function iz(e,t){return iz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},iz(e,t)}function pce(e,t,r){return t=mce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mce(e){var t=xYe(e,"string");return pb(t)=="symbol"?t:t+""}function xYe(e,t){if(pb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(pb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function az(){return az=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},az.apply(this,arguments)}function bYe(e){var t=e.xAxisId,r=H5(),n=K5(),o=Qle(t);return o==null?null:W.createElement(Gb,az({},o,{className:Ti("recharts-".concat(o.axisType," ").concat(o.axisType),o.className),viewBox:{x:0,y:0,width:r,height:n},ticksGenerator:function(d){return Ef(d,!0)}}))}var yh=function(e){function t(){return fYe(this,t),gYe(this,t,arguments)}return _Ye(t,e),mYe(t,[{key:"render",value:function(){return W.createElement(bYe,this.props)}}])}(W.Component);pce(yh,"displayName","XAxis");pce(yh,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function mb(e){"@babel/helpers - typeof";return mb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mb(e)}function wYe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function SYe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,vce(n.key),n)}}function EYe(e,t,r){return t&&SYe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function TYe(e,t,r){return t=Dk(t),AYe(e,gce()?Reflect.construct(t,r||[],Dk(e).constructor):t.apply(e,r))}function AYe(e,t){if(t&&(mb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return PYe(e)}function PYe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function gce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(gce=function(){return!!e})()}function Dk(e){return Dk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Dk(e)}function CYe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oz(e,t)}function oz(e,t){return oz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},oz(e,t)}function yce(e,t,r){return t=vce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vce(e){var t=OYe(e,"string");return mb(t)=="symbol"?t:t+""}function OYe(e,t){if(mb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(mb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function sz(){return sz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},sz.apply(this,arguments)}var kYe=function(t){var r=t.yAxisId,n=H5(),o=K5(),l=ece(r);return l==null?null:W.createElement(Gb,sz({},l,{className:Ti("recharts-".concat(l.axisType," ").concat(l.axisType),l.className),viewBox:{x:0,y:0,width:n,height:o},ticksGenerator:function(i){return Ef(i,!0)}}))},vh=function(e){function t(){return wYe(this,t),TYe(this,t,arguments)}return CYe(t,e),EYe(t,[{key:"render",value:function(){return W.createElement(kYe,this.props)}}])}(W.Component);yce(vh,"displayName","YAxis");yce(vh,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function zK(e){return NYe(e)||jYe(e)||RYe(e)||IYe()}function IYe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RYe(e,t){if(e){if(typeof e=="string")return lz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return lz(e,t)}}function jYe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function NYe(e){if(Array.isArray(e))return lz(e)}function lz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var cz=function(t,r,n,o,l){var d=Yc(t,X5),i=Yc(t,LR),g=[].concat(zK(d),zK(i)),_=Yc(t,zR),S="".concat(o,"Id"),E=o[0],T=r;if(g.length&&(T=g.reduce(function(I,j){if(j.props[S]===n&&Th(j.props,"extendDomain")&&$r(j.props[E])){var D=j.props[E];return[Math.min(I[0],D),Math.max(I[1],D)]}return I},T)),_.length){var C="".concat(E,"1"),N="".concat(E,"2");T=_.reduce(function(I,j){if(j.props[S]===n&&Th(j.props,"extendDomain")&&$r(j.props[C])&&$r(j.props[N])){var D=j.props[C],R=j.props[N];return[Math.min(I[0],D,R),Math.max(I[1],D,R)]}return I},T)}return l&&l.length&&(T=l.reduce(function(I,j){return $r(j)?[Math.min(I[0],j),Math.max(I[1],j)]:I},T)),T},_ce={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function o(g,_,S){this.fn=g,this.context=_,this.once=S||!1}function l(g,_,S,E,T){if(typeof S!="function")throw new TypeError("The listener must be a function");var C=new o(S,E||g,T),N=r?r+_:_;return g._events[N]?g._events[N].fn?g._events[N]=[g._events[N],C]:g._events[N].push(C):(g._events[N]=C,g._eventsCount++),g}function d(g,_){--g._eventsCount===0?g._events=new n:delete g._events[_]}function i(){this._events=new n,this._eventsCount=0}i.prototype.eventNames=function(){var _=[],S,E;if(this._eventsCount===0)return _;for(E in S=this._events)t.call(S,E)&&_.push(r?E.slice(1):E);return Object.getOwnPropertySymbols?_.concat(Object.getOwnPropertySymbols(S)):_},i.prototype.listeners=function(_){var S=r?r+_:_,E=this._events[S];if(!E)return[];if(E.fn)return[E.fn];for(var T=0,C=E.length,N=new Array(C);T<C;T++)N[T]=E[T].fn;return N},i.prototype.listenerCount=function(_){var S=r?r+_:_,E=this._events[S];return E?E.fn?1:E.length:0},i.prototype.emit=function(_,S,E,T,C,N){var I=r?r+_:_;if(!this._events[I])return!1;var j=this._events[I],D=arguments.length,R,F;if(j.fn){switch(j.once&&this.removeListener(_,j.fn,void 0,!0),D){case 1:return j.fn.call(j.context),!0;case 2:return j.fn.call(j.context,S),!0;case 3:return j.fn.call(j.context,S,E),!0;case 4:return j.fn.call(j.context,S,E,T),!0;case 5:return j.fn.call(j.context,S,E,T,C),!0;case 6:return j.fn.call(j.context,S,E,T,C,N),!0}for(F=1,R=new Array(D-1);F<D;F++)R[F-1]=arguments[F];j.fn.apply(j.context,R)}else{var B=j.length,U;for(F=0;F<B;F++)switch(j[F].once&&this.removeListener(_,j[F].fn,void 0,!0),D){case 1:j[F].fn.call(j[F].context);break;case 2:j[F].fn.call(j[F].context,S);break;case 3:j[F].fn.call(j[F].context,S,E);break;case 4:j[F].fn.call(j[F].context,S,E,T);break;default:if(!R)for(U=1,R=new Array(D-1);U<D;U++)R[U-1]=arguments[U];j[F].fn.apply(j[F].context,R)}}return!0},i.prototype.on=function(_,S,E){return l(this,_,S,E,!1)},i.prototype.once=function(_,S,E){return l(this,_,S,E,!0)},i.prototype.removeListener=function(_,S,E,T){var C=r?r+_:_;if(!this._events[C])return this;if(!S)return d(this,C),this;var N=this._events[C];if(N.fn)N.fn===S&&(!T||N.once)&&(!E||N.context===E)&&d(this,C);else{for(var I=0,j=[],D=N.length;I<D;I++)(N[I].fn!==S||T&&!N[I].once||E&&N[I].context!==E)&&j.push(N[I]);j.length?this._events[C]=j.length===1?j[0]:j:d(this,C)}return this},i.prototype.removeAllListeners=function(_){var S;return _?(S=r?r+_:_,this._events[S]&&d(this,S)):(this._events=new n,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=r,i.EventEmitter=i,e.exports=i})(_ce);var MYe=_ce.exports;const DYe=_a(MYe);var TD=new DYe,AD="recharts.syncMouseEvents";function _T(e){"@babel/helpers - typeof";return _T=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_T(e)}function LYe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function FYe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,xce(n.key),n)}}function zYe(e,t,r){return t&&FYe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function PD(e,t,r){return t=xce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xce(e){var t=BYe(e,"string");return _T(t)=="symbol"?t:t+""}function BYe(e,t){if(_T(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(_T(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var $Ye=function(){function e(){LYe(this,e),PD(this,"activeIndex",0),PD(this,"coordinateList",[]),PD(this,"layout","horizontal")}return zYe(e,[{key:"setDetails",value:function(r){var n,o=r.coordinateList,l=o===void 0?null:o,d=r.container,i=d===void 0?null:d,g=r.layout,_=g===void 0?null:g,S=r.offset,E=S===void 0?null:S,T=r.mouseHandlerCallback,C=T===void 0?null:T;this.coordinateList=(n=l??this.coordinateList)!==null&&n!==void 0?n:[],this.container=i??this.container,this.layout=_??this.layout,this.offset=E??this.offset,this.mouseHandlerCallback=C??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(r){if(this.coordinateList.length!==0)switch(r.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(r){this.activeIndex=r}},{key:"spoofMouse",value:function(){var r,n;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var o=this.container.getBoundingClientRect(),l=o.x,d=o.y,i=o.height,g=this.coordinateList[this.activeIndex].coordinate,_=((r=window)===null||r===void 0?void 0:r.scrollX)||0,S=((n=window)===null||n===void 0?void 0:n.scrollY)||0,E=l+g+_,T=d+this.offset.top+i/2+S;this.mouseHandlerCallback({pageX:E,pageY:T})}}}])}();function UYe(e,t,r){if(r==="number"&&t===!0&&Array.isArray(e)){var n=e==null?void 0:e[0],o=e==null?void 0:e[1];if(n&&o&&$r(n)&&$r(o))return!0}return!1}function VYe(e,t,r,n){var o=n/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-o:r.left+.5,y:e==="horizontal"?r.top+.5:t.y-o,width:e==="horizontal"?n:r.width-1,height:e==="horizontal"?r.height-1:n}}function bce(e){var t=e.cx,r=e.cy,n=e.radius,o=e.startAngle,l=e.endAngle,d=Xa(t,r,n,o),i=Xa(t,r,n,l);return{points:[d,i],cx:t,cy:r,radius:n,startAngle:o,endAngle:l}}function qYe(e,t,r){var n,o,l,d;if(e==="horizontal")n=t.x,l=n,o=r.top,d=r.top+r.height;else if(e==="vertical")o=t.y,d=o,n=r.left,l=r.left+r.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var i=t.cx,g=t.cy,_=t.innerRadius,S=t.outerRadius,E=t.angle,T=Xa(i,g,_,E),C=Xa(i,g,S,E);n=T.x,o=T.y,l=C.x,d=C.y}else return bce(t);return[{x:n,y:o},{x:l,y:d}]}function xT(e){"@babel/helpers - typeof";return xT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xT(e)}function BK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function YP(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?BK(Object(r),!0).forEach(function(n){WYe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):BK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function WYe(e,t,r){return t=GYe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function GYe(e){var t=HYe(e,"string");return xT(t)=="symbol"?t:t+""}function HYe(e,t){if(xT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(xT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function KYe(e){var t,r,n=e.element,o=e.tooltipEventType,l=e.isActive,d=e.activeCoordinate,i=e.activePayload,g=e.offset,_=e.activeTooltipIndex,S=e.tooltipAxisBandSize,E=e.layout,T=e.chartName,C=(t=n.props.cursor)!==null&&t!==void 0?t:(r=n.type.defaultProps)===null||r===void 0?void 0:r.cursor;if(!n||!C||!l||!d||T!=="ScatterChart"&&o!=="axis")return null;var N,I=pk;if(T==="ScatterChart")N=d,I=hHe;else if(T==="BarChart")N=VYe(E,d,g,S),I=V5;else if(E==="radial"){var j=bce(d),D=j.cx,R=j.cy,F=j.radius,B=j.startAngle,U=j.endAngle;N={cx:D,cy:R,startAngle:B,endAngle:U,innerRadius:F,outerRadius:F},I=yle}else N={points:qYe(E,d,g)},I=pk;var Z=YP(YP(YP(YP({stroke:"#ccc",pointerEvents:"none"},g),N),Gn(C,!1)),{},{payload:i,payloadIndex:_,className:Ti("recharts-tooltip-cursor",C.className)});return W.isValidElement(C)?W.cloneElement(C,Z):W.createElement(I,Z)}var ZYe=["item"],XYe=["children","className","width","height","style","compact","title","desc"];function gb(e){"@babel/helpers - typeof";return gb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gb(e)}function Gx(){return Gx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Gx.apply(this,arguments)}function $K(e,t){return QYe(e)||JYe(e,t)||Sce(e,t)||YYe()}function YYe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function JYe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,_=!1;try{if(l=(r=r.call(e)).next,t!==0)for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){_=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(_)throw o}}return i}}function QYe(e){if(Array.isArray(e))return e}function UK(e,t){if(e==null)return{};var r=eJe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function eJe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function tJe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function rJe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ece(n.key),n)}}function nJe(e,t,r){return t&&rJe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function iJe(e,t,r){return t=Lk(t),aJe(e,wce()?Reflect.construct(t,r||[],Lk(e).constructor):t.apply(e,r))}function aJe(e,t){if(t&&(gb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return oJe(e)}function oJe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(wce=function(){return!!e})()}function Lk(e){return Lk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Lk(e)}function sJe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&uz(e,t)}function uz(e,t){return uz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},uz(e,t)}function yb(e){return uJe(e)||cJe(e)||Sce(e)||lJe()}function lJe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Sce(e,t){if(e){if(typeof e=="string")return dz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return dz(e,t)}}function cJe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function uJe(e){if(Array.isArray(e))return dz(e)}function dz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function VK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function mr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?VK(Object(r),!0).forEach(function(n){Qn(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):VK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Qn(e,t,r){return t=Ece(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ece(e){var t=dJe(e,"string");return gb(t)=="symbol"?t:t+""}function dJe(e,t){if(gb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(gb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var hJe={xAxis:["bottom","top"],yAxis:["left","right"]},fJe={width:"100%",height:"100%"},Tce={x:0,y:0};function JP(e){return e}var pJe=function(t,r){return r==="horizontal"?t.x:r==="vertical"?t.y:r==="centric"?t.angle:t.radius},mJe=function(t,r,n,o){var l=r.find(function(S){return S&&S.index===n});if(l){if(t==="horizontal")return{x:l.coordinate,y:o.y};if(t==="vertical")return{x:o.x,y:l.coordinate};if(t==="centric"){var d=l.coordinate,i=o.radius;return mr(mr(mr({},o),Xa(o.cx,o.cy,i,d)),{},{angle:d,radius:i})}var g=l.coordinate,_=o.angle;return mr(mr(mr({},o),Xa(o.cx,o.cy,g,_)),{},{angle:_,radius:g})}return Tce},BR=function(t,r){var n=r.graphicalItems,o=r.dataStartIndex,l=r.dataEndIndex,d=(n??[]).reduce(function(i,g){var _=g.props.data;return _&&_.length?[].concat(yb(i),yb(_)):i},[]);return d.length>0?d:t&&t.length&&$r(o)&&$r(l)?t.slice(o,l+1):[]};function Ace(e){return e==="number"?[0,"auto"]:void 0}var hz=function(t,r,n,o){var l=t.graphicalItems,d=t.tooltipAxis,i=BR(r,t);return n<0||!l||!l.length||n>=i.length?null:l.reduce(function(g,_){var S,E=(S=_.props.data)!==null&&S!==void 0?S:r;E&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=n&&(E=E.slice(t.dataStartIndex,t.dataEndIndex+1));var T;if(d.dataKey&&!d.allowDuplicatedCategory){var C=E===void 0?i:E;T=LO(C,d.dataKey,o)}else T=E&&E[n]||i[n];return T?[].concat(yb(g),[dle(_,T)]):g},[])},qK=function(t,r,n,o){var l=o||{x:t.chartX,y:t.chartY},d=pJe(l,n),i=t.orderedTooltipTicks,g=t.tooltipAxis,_=t.tooltipTicks,S=Dqe(d,i,_,g);if(S>=0&&_){var E=_[S]&&_[S].value,T=hz(t,r,S,E),C=mJe(n,i,S,l);return{activeTooltipIndex:S,activeLabel:E,activePayload:T,activeCoordinate:C}}return null},gJe=function(t,r){var n=r.axes,o=r.graphicalItems,l=r.axisType,d=r.axisIdKey,i=r.stackGroups,g=r.dataStartIndex,_=r.dataEndIndex,S=t.layout,E=t.children,T=t.stackOffset,C=ale(S,l);return n.reduce(function(N,I){var j,D=I.type.defaultProps!==void 0?mr(mr({},I.type.defaultProps),I.props):I.props,R=D.type,F=D.dataKey,B=D.allowDataOverflow,U=D.allowDuplicatedCategory,Z=D.scale,J=D.ticks,te=D.includeHidden,ae=D[d];if(N[ae])return N;var ne=BR(t.data,{graphicalItems:o.filter(function(pe){var Ie,tt=d in pe.props?pe.props[d]:(Ie=pe.type.defaultProps)===null||Ie===void 0?void 0:Ie[d];return tt===ae}),dataStartIndex:g,dataEndIndex:_}),ie=ne.length,ee,oe,de;UYe(D.domain,B,R)&&(ee=AF(D.domain,null,B),C&&(R==="number"||Z!=="auto")&&(de=tE(ne,F,"category")));var xe=Ace(R);if(!ee||ee.length===0){var we,Ae=(we=D.domain)!==null&&we!==void 0?we:xe;if(F){if(ee=tE(ne,F,R),R==="category"&&C){var Ce=ANe(ee);U&&Ce?(oe=ee,ee=Ek(0,ie)):U||(ee=h7(Ae,ee,I).reduce(function(pe,Ie){return pe.indexOf(Ie)>=0?pe:[].concat(yb(pe),[Ie])},[]))}else if(R==="category")U?ee=ee.filter(function(pe){return pe!==""&&!wi(pe)}):ee=h7(Ae,ee,I).reduce(function(pe,Ie){return pe.indexOf(Ie)>=0||Ie===""||wi(Ie)?pe:[].concat(yb(pe),[Ie])},[]);else if(R==="number"){var me=$qe(ne,o.filter(function(pe){var Ie,tt,Ze=d in pe.props?pe.props[d]:(Ie=pe.type.defaultProps)===null||Ie===void 0?void 0:Ie[d],Le="hide"in pe.props?pe.props.hide:(tt=pe.type.defaultProps)===null||tt===void 0?void 0:tt.hide;return Ze===ae&&(te||!Le)}),F,l,S);me&&(ee=me)}C&&(R==="number"||Z!=="auto")&&(de=tE(ne,F,"category"))}else C?ee=Ek(0,ie):i&&i[ae]&&i[ae].hasStack&&R==="number"?ee=T==="expand"?[0,1]:ule(i[ae].stackGroups,g,_):ee=ile(ne,o.filter(function(pe){var Ie=d in pe.props?pe.props[d]:pe.type.defaultProps[d],tt="hide"in pe.props?pe.props.hide:pe.type.defaultProps.hide;return Ie===ae&&(te||!tt)}),R,S,!0);if(R==="number")ee=cz(E,ee,ae,l,J),Ae&&(ee=AF(Ae,ee,B));else if(R==="category"&&Ae){var Pe=Ae,ye=ee.every(function(pe){return Pe.indexOf(pe)>=0});ye&&(ee=Pe)}}return mr(mr({},N),{},Qn({},ae,mr(mr({},D),{},{axisType:l,domain:ee,categoricalDomain:de,duplicateDomain:oe,originalDomain:(j=D.domain)!==null&&j!==void 0?j:xe,isCategorical:C,layout:S})))},{})},yJe=function(t,r){var n=r.graphicalItems,o=r.Axis,l=r.axisType,d=r.axisIdKey,i=r.stackGroups,g=r.dataStartIndex,_=r.dataEndIndex,S=t.layout,E=t.children,T=BR(t.data,{graphicalItems:n,dataStartIndex:g,dataEndIndex:_}),C=T.length,N=ale(S,l),I=-1;return n.reduce(function(j,D){var R=D.type.defaultProps!==void 0?mr(mr({},D.type.defaultProps),D.props):D.props,F=R[d],B=Ace("number");if(!j[F]){I++;var U;return N?U=Ek(0,C):i&&i[F]&&i[F].hasStack?(U=ule(i[F].stackGroups,g,_),U=cz(E,U,F,l)):(U=AF(B,ile(T,n.filter(function(Z){var J,te,ae=d in Z.props?Z.props[d]:(J=Z.type.defaultProps)===null||J===void 0?void 0:J[d],ne="hide"in Z.props?Z.props.hide:(te=Z.type.defaultProps)===null||te===void 0?void 0:te.hide;return ae===F&&!ne}),"number",S),o.defaultProps.allowDataOverflow),U=cz(E,U,F,l)),mr(mr({},j),{},Qn({},F,mr(mr({axisType:l},o.defaultProps),{},{hide:!0,orientation:Xc(hJe,"".concat(l,".").concat(I%2),null),domain:U,originalDomain:B,isCategorical:N,layout:S})))}return j},{})},vJe=function(t,r){var n=r.axisType,o=n===void 0?"xAxis":n,l=r.AxisComp,d=r.graphicalItems,i=r.stackGroups,g=r.dataStartIndex,_=r.dataEndIndex,S=t.children,E="".concat(o,"Id"),T=Yc(S,l),C={};return T&&T.length?C=gJe(t,{axes:T,graphicalItems:d,axisType:o,axisIdKey:E,stackGroups:i,dataStartIndex:g,dataEndIndex:_}):d&&d.length&&(C=yJe(t,{Axis:l,graphicalItems:d,axisType:o,axisIdKey:E,stackGroups:i,dataStartIndex:g,dataEndIndex:_})),C},_Je=function(t){var r=um(t),n=Ef(r,!1,!0);return{tooltipTicks:n,orderedTooltipTicks:g5(n,function(o){return o.coordinate}),tooltipAxis:r,tooltipAxisBandSize:dk(r,n)}},WK=function(t){var r=t.children,n=t.defaultShowTooltip,o=zc(r,sb),l=0,d=0;return t.data&&t.data.length!==0&&(d=t.data.length-1),o&&o.props&&(o.props.startIndex>=0&&(l=o.props.startIndex),o.props.endIndex>=0&&(d=o.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:l,dataEndIndex:d,activeTooltipIndex:-1,isTooltipActive:!!n}},xJe=function(t){return!t||!t.length?!1:t.some(function(r){var n=Cf(r&&r.type);return n&&n.indexOf("Bar")>=0})},GK=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},bJe=function(t,r){var n=t.props,o=t.graphicalItems,l=t.xAxisMap,d=l===void 0?{}:l,i=t.yAxisMap,g=i===void 0?{}:i,_=n.width,S=n.height,E=n.children,T=n.margin||{},C=zc(E,sb),N=zc(E,mh),I=Object.keys(g).reduce(function(U,Z){var J=g[Z],te=J.orientation;return!J.mirror&&!J.hide?mr(mr({},U),{},Qn({},te,U[te]+J.width)):U},{left:T.left||0,right:T.right||0}),j=Object.keys(d).reduce(function(U,Z){var J=d[Z],te=J.orientation;return!J.mirror&&!J.hide?mr(mr({},U),{},Qn({},te,Xc(U,"".concat(te))+J.height)):U},{top:T.top||0,bottom:T.bottom||0}),D=mr(mr({},j),I),R=D.bottom;C&&(D.bottom+=C.props.height||sb.defaultProps.height),N&&r&&(D=zqe(D,o,n,r));var F=_-D.left-D.right,B=S-D.top-D.bottom;return mr(mr({brushBottom:R},D),{},{width:Math.max(F,0),height:Math.max(B,0)})},wJe=function(t,r){if(r==="xAxis")return t[r].width;if(r==="yAxis")return t[r].height},Q5=function(t){var r=t.chartName,n=t.GraphicalChild,o=t.defaultTooltipEventType,l=o===void 0?"axis":o,d=t.validateTooltipEventTypes,i=d===void 0?["axis"]:d,g=t.axisComponents,_=t.legendContent,S=t.formatAxisMap,E=t.defaultProps,T=function(D,R){var F=R.graphicalItems,B=R.stackGroups,U=R.offset,Z=R.updateId,J=R.dataStartIndex,te=R.dataEndIndex,ae=D.barSize,ne=D.layout,ie=D.barGap,ee=D.barCategoryGap,oe=D.maxBarSize,de=GK(ne),xe=de.numericAxisName,we=de.cateAxisName,Ae=xJe(F),Ce=[];return F.forEach(function(me,Pe){var ye=BR(D.data,{graphicalItems:[me],dataStartIndex:J,dataEndIndex:te}),pe=me.type.defaultProps!==void 0?mr(mr({},me.type.defaultProps),me.props):me.props,Ie=pe.dataKey,tt=pe.maxBarSize,Ze=pe["".concat(xe,"Id")],Le=pe["".concat(we,"Id")],qe={},Ge=g.reduce(function(ut,dt){var rr=R["".concat(dt.axisType,"Map")],er=pe["".concat(dt.axisType,"Id")];rr&&rr[er]||dt.axisType==="zAxis"||wv();var tr=rr[er];return mr(mr({},ut),{},Qn(Qn({},dt.axisType,tr),"".concat(dt.axisType,"Ticks"),Ef(tr)))},qe),je=Ge[we],ot=Ge["".concat(we,"Ticks")],St=B&&B[Ze]&&B[Ze].hasStack&&Xqe(me,B[Ze].stackGroups),rt=Cf(me.type).indexOf("Bar")>=0,Ut=dk(je,ot),Ft=[],dr=Ae&&Lqe({barSize:ae,stackGroups:B,totalSize:wJe(Ge,we)});if(rt){var Lr,Jr,Rt=wi(tt)?oe:tt,At=(Lr=(Jr=dk(je,ot,!0))!==null&&Jr!==void 0?Jr:Rt)!==null&&Lr!==void 0?Lr:0;Ft=Fqe({barGap:ie,barCategoryGap:ee,bandSize:At!==Ut?At:Ut,sizeList:dr[Le],maxBarSize:Rt}),At!==Ut&&(Ft=Ft.map(function(ut){return mr(mr({},ut),{},{position:mr(mr({},ut.position),{},{offset:ut.position.offset-At/2})})}))}var Xe=me&&me.type&&me.type.getComposedData;Xe&&Ce.push({props:mr(mr({},Xe(mr(mr({},Ge),{},{displayedData:ye,props:D,dataKey:Ie,item:me,bandSize:Ut,barPosition:Ft,offset:U,stackedData:St,layout:ne,dataStartIndex:J,dataEndIndex:te}))),{},Qn(Qn(Qn({key:me.key||"item-".concat(Pe)},xe,Ge[xe]),we,Ge[we]),"animationId",Z)),childIndex:zNe(me,D.children),item:me})}),Ce},C=function(D,R){var F=D.props,B=D.dataStartIndex,U=D.dataEndIndex,Z=D.updateId;if(!aG({props:F}))return null;var J=F.children,te=F.layout,ae=F.stackOffset,ne=F.data,ie=F.reverseStackOrder,ee=GK(te),oe=ee.numericAxisName,de=ee.cateAxisName,xe=Yc(J,n),we=Kqe(ne,xe,"".concat(oe,"Id"),"".concat(de,"Id"),ae,ie),Ae=g.reduce(function(pe,Ie){var tt="".concat(Ie.axisType,"Map");return mr(mr({},pe),{},Qn({},tt,vJe(F,mr(mr({},Ie),{},{graphicalItems:xe,stackGroups:Ie.axisType===oe&&we,dataStartIndex:B,dataEndIndex:U}))))},{}),Ce=bJe(mr(mr({},Ae),{},{props:F,graphicalItems:xe}),R==null?void 0:R.legendBBox);Object.keys(Ae).forEach(function(pe){Ae[pe]=S(F,Ae[pe],Ce,pe.replace("Map",""),r)});var me=Ae["".concat(de,"Map")],Pe=_Je(me),ye=T(F,mr(mr({},Ae),{},{dataStartIndex:B,dataEndIndex:U,updateId:Z,graphicalItems:xe,stackGroups:we,offset:Ce}));return mr(mr({formattedGraphicalItems:ye,graphicalItems:xe,offset:Ce,stackGroups:we},Pe),Ae)},N=function(j){function D(R){var F,B,U;return tJe(this,D),U=iJe(this,D,[R]),Qn(U,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),Qn(U,"accessibilityManager",new $Ye),Qn(U,"handleLegendBBoxUpdate",function(Z){if(Z){var J=U.state,te=J.dataStartIndex,ae=J.dataEndIndex,ne=J.updateId;U.setState(mr({legendBBox:Z},C({props:U.props,dataStartIndex:te,dataEndIndex:ae,updateId:ne},mr(mr({},U.state),{},{legendBBox:Z}))))}}),Qn(U,"handleReceiveSyncEvent",function(Z,J,te){if(U.props.syncId===Z){if(te===U.eventEmitterSymbol&&typeof U.props.syncMethod!="function")return;U.applySyncEvent(J)}}),Qn(U,"handleBrushChange",function(Z){var J=Z.startIndex,te=Z.endIndex;if(J!==U.state.dataStartIndex||te!==U.state.dataEndIndex){var ae=U.state.updateId;U.setState(function(){return mr({dataStartIndex:J,dataEndIndex:te},C({props:U.props,dataStartIndex:J,dataEndIndex:te,updateId:ae},U.state))}),U.triggerSyncEvent({dataStartIndex:J,dataEndIndex:te})}}),Qn(U,"handleMouseEnter",function(Z){var J=U.getMouseInfo(Z);if(J){var te=mr(mr({},J),{},{isTooltipActive:!0});U.setState(te),U.triggerSyncEvent(te);var ae=U.props.onMouseEnter;li(ae)&&ae(te,Z)}}),Qn(U,"triggeredAfterMouseMove",function(Z){var J=U.getMouseInfo(Z),te=J?mr(mr({},J),{},{isTooltipActive:!0}):{isTooltipActive:!1};U.setState(te),U.triggerSyncEvent(te);var ae=U.props.onMouseMove;li(ae)&&ae(te,Z)}),Qn(U,"handleItemMouseEnter",function(Z){U.setState(function(){return{isTooltipActive:!0,activeItem:Z,activePayload:Z.tooltipPayload,activeCoordinate:Z.tooltipPosition||{x:Z.cx,y:Z.cy}}})}),Qn(U,"handleItemMouseLeave",function(){U.setState(function(){return{isTooltipActive:!1}})}),Qn(U,"handleMouseMove",function(Z){Z.persist(),U.throttleTriggeredAfterMouseMove(Z)}),Qn(U,"handleMouseLeave",function(Z){U.throttleTriggeredAfterMouseMove.cancel();var J={isTooltipActive:!1};U.setState(J),U.triggerSyncEvent(J);var te=U.props.onMouseLeave;li(te)&&te(J,Z)}),Qn(U,"handleOuterEvent",function(Z){var J=FNe(Z),te=Xc(U.props,"".concat(J));if(J&&li(te)){var ae,ne;/.*touch.*/i.test(J)?ne=U.getMouseInfo(Z.changedTouches[0]):ne=U.getMouseInfo(Z),te((ae=ne)!==null&&ae!==void 0?ae:{},Z)}}),Qn(U,"handleClick",function(Z){var J=U.getMouseInfo(Z);if(J){var te=mr(mr({},J),{},{isTooltipActive:!0});U.setState(te),U.triggerSyncEvent(te);var ae=U.props.onClick;li(ae)&&ae(te,Z)}}),Qn(U,"handleMouseDown",function(Z){var J=U.props.onMouseDown;if(li(J)){var te=U.getMouseInfo(Z);J(te,Z)}}),Qn(U,"handleMouseUp",function(Z){var J=U.props.onMouseUp;if(li(J)){var te=U.getMouseInfo(Z);J(te,Z)}}),Qn(U,"handleTouchMove",function(Z){Z.changedTouches!=null&&Z.changedTouches.length>0&&U.throttleTriggeredAfterMouseMove(Z.changedTouches[0])}),Qn(U,"handleTouchStart",function(Z){Z.changedTouches!=null&&Z.changedTouches.length>0&&U.handleMouseDown(Z.changedTouches[0])}),Qn(U,"handleTouchEnd",function(Z){Z.changedTouches!=null&&Z.changedTouches.length>0&&U.handleMouseUp(Z.changedTouches[0])}),Qn(U,"handleDoubleClick",function(Z){var J=U.props.onDoubleClick;if(li(J)){var te=U.getMouseInfo(Z);J(te,Z)}}),Qn(U,"handleContextMenu",function(Z){var J=U.props.onContextMenu;if(li(J)){var te=U.getMouseInfo(Z);J(te,Z)}}),Qn(U,"triggerSyncEvent",function(Z){U.props.syncId!==void 0&&TD.emit(AD,U.props.syncId,Z,U.eventEmitterSymbol)}),Qn(U,"applySyncEvent",function(Z){var J=U.props,te=J.layout,ae=J.syncMethod,ne=U.state.updateId,ie=Z.dataStartIndex,ee=Z.dataEndIndex;if(Z.dataStartIndex!==void 0||Z.dataEndIndex!==void 0)U.setState(mr({dataStartIndex:ie,dataEndIndex:ee},C({props:U.props,dataStartIndex:ie,dataEndIndex:ee,updateId:ne},U.state)));else if(Z.activeTooltipIndex!==void 0){var oe=Z.chartX,de=Z.chartY,xe=Z.activeTooltipIndex,we=U.state,Ae=we.offset,Ce=we.tooltipTicks;if(!Ae)return;if(typeof ae=="function")xe=ae(Ce,Z);else if(ae==="value"){xe=-1;for(var me=0;me<Ce.length;me++)if(Ce[me].value===Z.activeLabel){xe=me;break}}var Pe=mr(mr({},Ae),{},{x:Ae.left,y:Ae.top}),ye=Math.min(oe,Pe.x+Pe.width),pe=Math.min(de,Pe.y+Pe.height),Ie=Ce[xe]&&Ce[xe].value,tt=hz(U.state,U.props.data,xe),Ze=Ce[xe]?{x:te==="horizontal"?Ce[xe].coordinate:ye,y:te==="horizontal"?pe:Ce[xe].coordinate}:Tce;U.setState(mr(mr({},Z),{},{activeLabel:Ie,activeCoordinate:Ze,activePayload:tt,activeTooltipIndex:xe}))}else U.setState(Z)}),Qn(U,"renderCursor",function(Z){var J,te=U.state,ae=te.isTooltipActive,ne=te.activeCoordinate,ie=te.activePayload,ee=te.offset,oe=te.activeTooltipIndex,de=te.tooltipAxisBandSize,xe=U.getTooltipEventType(),we=(J=Z.props.active)!==null&&J!==void 0?J:ae,Ae=U.props.layout,Ce=Z.key||"_recharts-cursor";return He.createElement(KYe,{key:Ce,activeCoordinate:ne,activePayload:ie,activeTooltipIndex:oe,chartName:r,element:Z,isActive:we,layout:Ae,offset:ee,tooltipAxisBandSize:de,tooltipEventType:xe})}),Qn(U,"renderPolarAxis",function(Z,J,te){var ae=Xc(Z,"type.axisType"),ne=Xc(U.state,"".concat(ae,"Map")),ie=Z.type.defaultProps,ee=ie!==void 0?mr(mr({},ie),Z.props):Z.props,oe=ne&&ne[ee["".concat(ae,"Id")]];return W.cloneElement(Z,mr(mr({},oe),{},{className:Ti(ae,oe.className),key:Z.key||"".concat(J,"-").concat(te),ticks:Ef(oe,!0)}))}),Qn(U,"renderPolarGrid",function(Z){var J=Z.props,te=J.radialLines,ae=J.polarAngles,ne=J.polarRadius,ie=U.state,ee=ie.radiusAxisMap,oe=ie.angleAxisMap,de=um(ee),xe=um(oe),we=xe.cx,Ae=xe.cy,Ce=xe.innerRadius,me=xe.outerRadius;return W.cloneElement(Z,{polarAngles:Array.isArray(ae)?ae:Ef(xe,!0).map(function(Pe){return Pe.coordinate}),polarRadius:Array.isArray(ne)?ne:Ef(de,!0).map(function(Pe){return Pe.coordinate}),cx:we,cy:Ae,innerRadius:Ce,outerRadius:me,key:Z.key||"polar-grid",radialLines:te})}),Qn(U,"renderLegend",function(){var Z=U.state.formattedGraphicalItems,J=U.props,te=J.children,ae=J.width,ne=J.height,ie=U.props.margin||{},ee=ae-(ie.left||0)-(ie.right||0),oe=rle({children:te,formattedGraphicalItems:Z,legendWidth:ee,legendContent:_});if(!oe)return null;var de=oe.item,xe=UK(oe,ZYe);return W.cloneElement(de,mr(mr({},xe),{},{chartWidth:ae,chartHeight:ne,margin:ie,onBBoxUpdate:U.handleLegendBBoxUpdate}))}),Qn(U,"renderTooltip",function(){var Z,J=U.props,te=J.children,ae=J.accessibilityLayer,ne=zc(te,qs);if(!ne)return null;var ie=U.state,ee=ie.isTooltipActive,oe=ie.activeCoordinate,de=ie.activePayload,xe=ie.activeLabel,we=ie.offset,Ae=(Z=ne.props.active)!==null&&Z!==void 0?Z:ee;return W.cloneElement(ne,{viewBox:mr(mr({},we),{},{x:we.left,y:we.top}),active:Ae,label:xe,payload:Ae?de:[],coordinate:oe,accessibilityLayer:ae})}),Qn(U,"renderBrush",function(Z){var J=U.props,te=J.margin,ae=J.data,ne=U.state,ie=ne.offset,ee=ne.dataStartIndex,oe=ne.dataEndIndex,de=ne.updateId;return W.cloneElement(Z,{key:Z.key||"_recharts-brush",onChange:HP(U.handleBrushChange,Z.props.onChange),data:ae,x:$r(Z.props.x)?Z.props.x:ie.left,y:$r(Z.props.y)?Z.props.y:ie.top+ie.height+ie.brushBottom-(te.bottom||0),width:$r(Z.props.width)?Z.props.width:ie.width,startIndex:ee,endIndex:oe,updateId:"brush-".concat(de)})}),Qn(U,"renderReferenceElement",function(Z,J,te){if(!Z)return null;var ae=U,ne=ae.clipPathId,ie=U.state,ee=ie.xAxisMap,oe=ie.yAxisMap,de=ie.offset,xe=Z.type.defaultProps||{},we=Z.props,Ae=we.xAxisId,Ce=Ae===void 0?xe.xAxisId:Ae,me=we.yAxisId,Pe=me===void 0?xe.yAxisId:me;return W.cloneElement(Z,{key:Z.key||"".concat(J,"-").concat(te),xAxis:ee[Ce],yAxis:oe[Pe],viewBox:{x:de.left,y:de.top,width:de.width,height:de.height},clipPathId:ne})}),Qn(U,"renderActivePoints",function(Z){var J=Z.item,te=Z.activePoint,ae=Z.basePoint,ne=Z.childIndex,ie=Z.isRange,ee=[],oe=J.props.key,de=J.item.type.defaultProps!==void 0?mr(mr({},J.item.type.defaultProps),J.item.props):J.item.props,xe=de.activeDot,we=de.dataKey,Ae=mr(mr({index:ne,dataKey:we,cx:te.x,cy:te.y,r:4,fill:U5(J.item),strokeWidth:2,stroke:"#fff",payload:te.payload,value:te.value},Gn(xe,!1)),FO(xe));return ee.push(D.renderActiveDot(xe,Ae,"".concat(oe,"-activePoint-").concat(ne))),ae?ee.push(D.renderActiveDot(xe,mr(mr({},Ae),{},{cx:ae.x,cy:ae.y}),"".concat(oe,"-basePoint-").concat(ne))):ie&&ee.push(null),ee}),Qn(U,"renderGraphicChild",function(Z,J,te){var ae=U.filterFormatItem(Z,J,te);if(!ae)return null;var ne=U.getTooltipEventType(),ie=U.state,ee=ie.isTooltipActive,oe=ie.tooltipAxis,de=ie.activeTooltipIndex,xe=ie.activeLabel,we=U.props.children,Ae=zc(we,qs),Ce=ae.props,me=Ce.points,Pe=Ce.isRange,ye=Ce.baseLine,pe=ae.item.type.defaultProps!==void 0?mr(mr({},ae.item.type.defaultProps),ae.item.props):ae.item.props,Ie=pe.activeDot,tt=pe.hide,Ze=pe.activeBar,Le=pe.activeShape,qe=!!(!tt&&ee&&Ae&&(Ie||Ze||Le)),Ge={};ne!=="axis"&&Ae&&Ae.props.trigger==="click"?Ge={onClick:HP(U.handleItemMouseEnter,Z.props.onClick)}:ne!=="axis"&&(Ge={onMouseLeave:HP(U.handleItemMouseLeave,Z.props.onMouseLeave),onMouseEnter:HP(U.handleItemMouseEnter,Z.props.onMouseEnter)});var je=W.cloneElement(Z,mr(mr({},ae.props),Ge));function ot(dt){return typeof oe.dataKey=="function"?oe.dataKey(dt.payload):null}if(qe)if(de>=0){var St,rt;if(oe.dataKey&&!oe.allowDuplicatedCategory){var Ut=typeof oe.dataKey=="function"?ot:"payload.".concat(oe.dataKey.toString());St=LO(me,Ut,xe),rt=Pe&&ye&&LO(ye,Ut,xe)}else St=me==null?void 0:me[de],rt=Pe&&ye&&ye[de];if(Le||Ze){var Ft=Z.props.activeIndex!==void 0?Z.props.activeIndex:de;return[W.cloneElement(Z,mr(mr(mr({},ae.props),Ge),{},{activeIndex:Ft})),null,null]}if(!wi(St))return[je].concat(yb(U.renderActivePoints({item:ae,activePoint:St,basePoint:rt,childIndex:de,isRange:Pe})))}else{var dr,Lr=(dr=U.getItemByXY(U.state.activeCoordinate))!==null&&dr!==void 0?dr:{graphicalItem:je},Jr=Lr.graphicalItem,Rt=Jr.item,At=Rt===void 0?Z:Rt,Xe=Jr.childIndex,ut=mr(mr(mr({},ae.props),Ge),{},{activeIndex:Xe});return[W.cloneElement(At,ut),null,null]}return Pe?[je,null,null]:[je,null]}),Qn(U,"renderCustomized",function(Z,J,te){return W.cloneElement(Z,mr(mr({key:"recharts-customized-".concat(te)},U.props),U.state))}),Qn(U,"renderMap",{CartesianGrid:{handler:JP,once:!0},ReferenceArea:{handler:U.renderReferenceElement},ReferenceLine:{handler:JP},ReferenceDot:{handler:U.renderReferenceElement},XAxis:{handler:JP},YAxis:{handler:JP},Brush:{handler:U.renderBrush,once:!0},Bar:{handler:U.renderGraphicChild},Line:{handler:U.renderGraphicChild},Area:{handler:U.renderGraphicChild},Radar:{handler:U.renderGraphicChild},RadialBar:{handler:U.renderGraphicChild},Scatter:{handler:U.renderGraphicChild},Pie:{handler:U.renderGraphicChild},Funnel:{handler:U.renderGraphicChild},Tooltip:{handler:U.renderCursor,once:!0},PolarGrid:{handler:U.renderPolarGrid,once:!0},PolarAngleAxis:{handler:U.renderPolarAxis},PolarRadiusAxis:{handler:U.renderPolarAxis},Customized:{handler:U.renderCustomized}}),U.clipPathId="".concat((F=R.id)!==null&&F!==void 0?F:zb("recharts"),"-clip"),U.throttleTriggeredAfterMouseMove=ese(U.triggeredAfterMouseMove,(B=R.throttleDelay)!==null&&B!==void 0?B:1e3/60),U.state={},U}return sJe(D,j),nJe(D,[{key:"componentDidMount",value:function(){var F,B;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(F=this.props.margin.left)!==null&&F!==void 0?F:0,top:(B=this.props.margin.top)!==null&&B!==void 0?B:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var F=this.props,B=F.children,U=F.data,Z=F.height,J=F.layout,te=zc(B,qs);if(te){var ae=te.props.defaultIndex;if(!(typeof ae!="number"||ae<0||ae>this.state.tooltipTicks.length-1)){var ne=this.state.tooltipTicks[ae]&&this.state.tooltipTicks[ae].value,ie=hz(this.state,U,ae,ne),ee=this.state.tooltipTicks[ae].coordinate,oe=(this.state.offset.top+Z)/2,de=J==="horizontal",xe=de?{x:ee,y:oe}:{y:ee,x:oe},we=this.state.formattedGraphicalItems.find(function(Ce){var me=Ce.item;return me.type.name==="Scatter"});we&&(xe=mr(mr({},xe),we.props.points[ae].tooltipPosition),ie=we.props.points[ae].tooltipPayload);var Ae={activeTooltipIndex:ae,isTooltipActive:!0,activeLabel:ne,activePayload:ie,activeCoordinate:xe};this.setState(Ae),this.renderCursor(te),this.accessibilityManager.setIndex(ae)}}}},{key:"getSnapshotBeforeUpdate",value:function(F,B){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==B.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==F.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==F.margin){var U,Z;this.accessibilityManager.setDetails({offset:{left:(U=this.props.margin.left)!==null&&U!==void 0?U:0,top:(Z=this.props.margin.top)!==null&&Z!==void 0?Z:0}})}return null}},{key:"componentDidUpdate",value:function(F){$3([zc(F.children,qs)],[zc(this.props.children,qs)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var F=zc(this.props.children,qs);if(F&&typeof F.props.shared=="boolean"){var B=F.props.shared?"axis":"item";return i.indexOf(B)>=0?B:l}return l}},{key:"getMouseInfo",value:function(F){if(!this.container)return null;var B=this.container,U=B.getBoundingClientRect(),Z=dUe(U),J={chartX:Math.round(F.pageX-Z.left),chartY:Math.round(F.pageY-Z.top)},te=U.width/B.offsetWidth||1,ae=this.inRange(J.chartX,J.chartY,te);if(!ae)return null;var ne=this.state,ie=ne.xAxisMap,ee=ne.yAxisMap,oe=this.getTooltipEventType(),de=qK(this.state,this.props.data,this.props.layout,ae);if(oe!=="axis"&&ie&&ee){var xe=um(ie).scale,we=um(ee).scale,Ae=xe&&xe.invert?xe.invert(J.chartX):null,Ce=we&&we.invert?we.invert(J.chartY):null;return mr(mr({},J),{},{xValue:Ae,yValue:Ce},de)}return de?mr(mr({},J),de):null}},{key:"inRange",value:function(F,B){var U=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,Z=this.props.layout,J=F/U,te=B/U;if(Z==="horizontal"||Z==="vertical"){var ae=this.state.offset,ne=J>=ae.left&&J<=ae.left+ae.width&&te>=ae.top&&te<=ae.top+ae.height;return ne?{x:J,y:te}:null}var ie=this.state,ee=ie.angleAxisMap,oe=ie.radiusAxisMap;if(ee&&oe){var de=um(ee);return m7({x:J,y:te},de)}return null}},{key:"parseEventsOfWrapper",value:function(){var F=this.props.children,B=this.getTooltipEventType(),U=zc(F,qs),Z={};U&&B==="axis"&&(U.props.trigger==="click"?Z={onClick:this.handleClick}:Z={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var J=FO(this.props,this.handleOuterEvent);return mr(mr({},J),Z)}},{key:"addListener",value:function(){TD.on(AD,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){TD.removeListener(AD,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(F,B,U){for(var Z=this.state.formattedGraphicalItems,J=0,te=Z.length;J<te;J++){var ae=Z[J];if(ae.item===F||ae.props.key===F.key||B===Cf(ae.item.type)&&U===ae.childIndex)return ae}return null}},{key:"renderClipPath",value:function(){var F=this.clipPathId,B=this.state.offset,U=B.left,Z=B.top,J=B.height,te=B.width;return He.createElement("defs",null,He.createElement("clipPath",{id:F},He.createElement("rect",{x:U,y:Z,height:J,width:te})))}},{key:"getXScales",value:function(){var F=this.state.xAxisMap;return F?Object.entries(F).reduce(function(B,U){var Z=$K(U,2),J=Z[0],te=Z[1];return mr(mr({},B),{},Qn({},J,te.scale))},{}):null}},{key:"getYScales",value:function(){var F=this.state.yAxisMap;return F?Object.entries(F).reduce(function(B,U){var Z=$K(U,2),J=Z[0],te=Z[1];return mr(mr({},B),{},Qn({},J,te.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(F){var B;return(B=this.state.xAxisMap)===null||B===void 0||(B=B[F])===null||B===void 0?void 0:B.scale}},{key:"getYScaleByAxisId",value:function(F){var B;return(B=this.state.yAxisMap)===null||B===void 0||(B=B[F])===null||B===void 0?void 0:B.scale}},{key:"getItemByXY",value:function(F){var B=this.state,U=B.formattedGraphicalItems,Z=B.activeItem;if(U&&U.length)for(var J=0,te=U.length;J<te;J++){var ae=U[J],ne=ae.props,ie=ae.item,ee=ie.type.defaultProps!==void 0?mr(mr({},ie.type.defaultProps),ie.props):ie.props,oe=Cf(ie.type);if(oe==="Bar"){var de=(ne.data||[]).find(function(Ce){return GGe(F,Ce)});if(de)return{graphicalItem:ae,payload:de}}else if(oe==="RadialBar"){var xe=(ne.data||[]).find(function(Ce){return m7(F,Ce)});if(xe)return{graphicalItem:ae,payload:xe}}else if(jR(ae,Z)||NR(ae,Z)||pT(ae,Z)){var we=N7e({graphicalItem:ae,activeTooltipItem:Z,itemData:ee.data}),Ae=ee.activeIndex===void 0?we:ee.activeIndex;return{graphicalItem:mr(mr({},ae),{},{childIndex:Ae}),payload:pT(ae,Z)?ee.data[we]:ae.props.data[we]}}}return null}},{key:"render",value:function(){var F=this;if(!aG(this))return null;var B=this.props,U=B.children,Z=B.className,J=B.width,te=B.height,ae=B.style,ne=B.compact,ie=B.title,ee=B.desc,oe=UK(B,XYe),de=Gn(oe,!1);if(ne)return He.createElement(SK,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},He.createElement(V3,Gx({},de,{width:J,height:te,title:ie,desc:ee}),this.renderClipPath(),sG(U,this.renderMap)));if(this.props.accessibilityLayer){var xe,we;de.tabIndex=(xe=this.props.tabIndex)!==null&&xe!==void 0?xe:0,de.role=(we=this.props.role)!==null&&we!==void 0?we:"application",de.onKeyDown=function(Ce){F.accessibilityManager.keyboardEvent(Ce)},de.onFocus=function(){F.accessibilityManager.focus()}}var Ae=this.parseEventsOfWrapper();return He.createElement(SK,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},He.createElement("div",Gx({className:Ti("recharts-wrapper",Z),style:mr({position:"relative",cursor:"default",width:J,height:te},ae)},Ae,{ref:function(me){F.container=me}}),He.createElement(V3,Gx({},de,{width:J,height:te,title:ie,desc:ee,style:fJe}),this.renderClipPath(),sG(U,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(W.Component);Qn(N,"displayName",r),Qn(N,"defaultProps",mr({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},E)),Qn(N,"getDerivedStateFromProps",function(j,D){var R=j.dataKey,F=j.data,B=j.children,U=j.width,Z=j.height,J=j.layout,te=j.stackOffset,ae=j.margin,ne=D.dataStartIndex,ie=D.dataEndIndex;if(D.updateId===void 0){var ee=WK(j);return mr(mr(mr({},ee),{},{updateId:0},C(mr(mr({props:j},ee),{},{updateId:0}),D)),{},{prevDataKey:R,prevData:F,prevWidth:U,prevHeight:Z,prevLayout:J,prevStackOffset:te,prevMargin:ae,prevChildren:B})}if(R!==D.prevDataKey||F!==D.prevData||U!==D.prevWidth||Z!==D.prevHeight||J!==D.prevLayout||te!==D.prevStackOffset||!o0(ae,D.prevMargin)){var oe=WK(j),de={chartX:D.chartX,chartY:D.chartY,isTooltipActive:D.isTooltipActive},xe=mr(mr({},qK(D,F,J)),{},{updateId:D.updateId+1}),we=mr(mr(mr({},oe),de),xe);return mr(mr(mr({},we),C(mr({props:j},we),D)),{},{prevDataKey:R,prevData:F,prevWidth:U,prevHeight:Z,prevLayout:J,prevStackOffset:te,prevMargin:ae,prevChildren:B})}if(!$3(B,D.prevChildren)){var Ae,Ce,me,Pe,ye=zc(B,sb),pe=ye&&(Ae=(Ce=ye.props)===null||Ce===void 0?void 0:Ce.startIndex)!==null&&Ae!==void 0?Ae:ne,Ie=ye&&(me=(Pe=ye.props)===null||Pe===void 0?void 0:Pe.endIndex)!==null&&me!==void 0?me:ie,tt=pe!==ne||Ie!==ie,Ze=!wi(F),Le=Ze&&!tt?D.updateId:D.updateId+1;return mr(mr({updateId:Le},C(mr(mr({props:j},D),{},{updateId:Le,dataStartIndex:pe,dataEndIndex:Ie}),D)),{},{prevChildren:B,dataStartIndex:pe,dataEndIndex:Ie})}return null}),Qn(N,"renderActiveDot",function(j,D,R){var F;return W.isValidElement(j)?F=W.cloneElement(j,D):li(j)?F=j(D):F=He.createElement(CR,D),He.createElement(ya,{className:"recharts-active-dot",key:R},F)});var I=W.forwardRef(function(D,R){return He.createElement(N,Gx({},D,{ref:R}))});return I.displayName=N.displayName,I},Pce=Q5({chartName:"LineChart",GraphicalChild:Hb,axisComponents:[{axisType:"xAxis",AxisComp:yh},{axisType:"yAxis",AxisComp:vh}],formatAxisMap:Wle}),OC=Q5({chartName:"BarChart",GraphicalChild:Su,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:yh},{axisType:"yAxis",AxisComp:vh}],formatAxisMap:Wle}),HK=Q5({chartName:"PieChart",GraphicalChild:kh,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:RR},{axisType:"radiusAxis",AxisComp:kR}],formatAxisMap:o9e,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const SJe=()=>{const{t:e}=Ki(),{isSupervisor:t}=nu(),{data:r,isLoading:n}=fke(),{data:o}=pke(),{data:l}=yke(),{data:d}=mke(),{data:i}=gke();return n?m.jsx(eu,{children:m.jsx("div",{className:"text-center",children:e("common.loading")})}):m.jsx(eu,{children:m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-3xl font-bold mb-2",children:e("admin.dashboard")}),m.jsx("p",{className:"text-muted-foreground",children:e("admin.dashboardDescription")})]}),m.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[m.jsxs(rn,{children:[m.jsxs(Di,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[m.jsx(Qi,{className:"text-sm font-medium",children:t?"":e("admin.totalUsers")}),m.jsx(_u,{className:"h-4 w-4 text-muted-foreground"})]}),m.jsxs(ln,{children:[m.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.totalUsers)||0}),m.jsx("p",{className:"text-xs text-muted-foreground",children:t?"":e("admin.registeredUsers")})]})]}),m.jsxs(rn,{children:[m.jsxs(Di,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[m.jsx(Qi,{className:"text-sm font-medium",children:t?"":e("admin.totalRestaurants")}),m.jsx(es,{className:"h-4 w-4 text-muted-foreground"})]}),m.jsxs(ln,{children:[m.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.totalRestaurants)||0}),m.jsx("p",{className:"text-xs text-muted-foreground",children:t?"":e("admin.listedRestaurants")})]})]}),!t&&m.jsxs(rn,{children:[m.jsxs(Di,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[m.jsx(Qi,{className:"text-sm font-medium",children:e("admin.totalActivities")}),m.jsx(Sc,{className:"h-4 w-4 text-muted-foreground"})]}),m.jsxs(ln,{children:[m.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.totalActivities)||0}),m.jsx("p",{className:"text-xs text-muted-foreground",children:e("admin.activeEvents")})]})]}),m.jsxs(rn,{children:[m.jsxs(Di,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[m.jsx(Qi,{className:"text-sm font-medium",children:t?"":e("admin.totalComments")}),m.jsx(vB,{className:"h-4 w-4 text-muted-foreground"})]}),m.jsxs(ln,{children:[m.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.totalComments)||0}),m.jsx("p",{className:"text-xs text-muted-foreground",children:t?"":e("admin.userReviews")})]})]})]}),m.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[m.jsxs(rn,{children:[m.jsxs(Di,{children:[m.jsxs(Qi,{className:"flex items-center gap-2",children:[m.jsx(aJ,{className:"h-5 w-5"}),""]}),m.jsx(Lo,{children:t?"":"Top 5 "})]}),m.jsx(ln,{children:d&&d.length>0?m.jsx(Tm,{width:"100%",height:300,children:m.jsxs(Pce,{data:d,children:[m.jsx(Uy,{strokeDasharray:"3 3"}),m.jsx(yh,{dataKey:"month"}),m.jsx(vh,{domain:[0,5]}),m.jsx(qs,{}),m.jsx(mh,{}),Object.keys(d[0]).filter(g=>g!=="month").map((g,_)=>m.jsx(Hb,{type:"monotone",dataKey:g,stroke:`hsl(${_*360/5}, 70%, 50%)`,strokeWidth:2},g))]})}):m.jsx("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:""})})]}),m.jsxs(rn,{children:[m.jsxs(Di,{children:[m.jsxs(Qi,{className:"flex items-center gap-2",children:[m.jsx(uye,{className:"h-5 w-5"}),""]}),m.jsx(Lo,{children:t?"":"Top 5 "})]}),m.jsx(ln,{children:i&&i.length>0?m.jsx(Tm,{width:"100%",height:300,children:m.jsxs(OC,{data:i,children:[m.jsx(Uy,{strokeDasharray:"3 3"}),m.jsx(yh,{dataKey:"month"}),m.jsx(vh,{}),m.jsx(qs,{}),m.jsx(mh,{}),Object.keys(i[0]).filter(g=>g!=="month").map((g,_)=>m.jsx(Su,{dataKey:g,fill:`hsl(${_*360/5}, 70%, 50%)`},g))]})}):m.jsx("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:""})})]}),!t&&l&&l.length>0&&m.jsxs(rn,{children:[m.jsxs(Di,{children:[m.jsxs(Qi,{className:"flex items-center gap-2",children:[m.jsx(KS,{className:"h-5 w-5"}),e("admin.activityEngagement")]}),m.jsx(Lo,{children:e("admin.activityEngagementDescription")})]}),m.jsx(ln,{children:m.jsx(Tm,{width:"100%",height:300,children:m.jsxs(OC,{data:l,children:[m.jsx(Uy,{strokeDasharray:"3 3"}),m.jsx(yh,{dataKey:"name",angle:-45,textAnchor:"end",height:100}),m.jsx(vh,{}),m.jsx(qs,{}),m.jsx(mh,{}),m.jsx(Su,{dataKey:"subscribers",name:e("admin.subscribers"),fill:"hsl(var(--primary))"}),m.jsx(Su,{dataKey:"comments",name:e("admin.comments"),fill:"hsl(var(--accent))"})]})})})]})]}),m.jsxs(rn,{children:[m.jsxs(Di,{children:[m.jsxs(Qi,{className:"flex items-center gap-2",children:[m.jsx(Ec,{className:"h-5 w-5"}),t?"":e("admin.topRestaurants")]}),m.jsx(Lo,{children:t?"":e("admin.topRestaurantsDescription")})]}),m.jsx(ln,{children:o&&o.length>0?m.jsx(Tm,{width:"100%",height:400,children:m.jsxs(OC,{data:o,layout:"horizontal",children:[m.jsx(Uy,{strokeDasharray:"3 3"}),m.jsx(yh,{type:"number"}),m.jsx(vh,{dataKey:"name",type:"category",width:150}),m.jsx(qs,{}),m.jsx(mh,{}),m.jsx(Su,{dataKey:"rating",name:e("admin.rating"),fill:"hsl(var(--primary))"}),m.jsx(Su,{dataKey:"comments",name:e("admin.comments"),fill:"hsl(var(--accent))"})]})}):m.jsx("div",{className:"h-[400px] flex items-center justify-center text-muted-foreground",children:t?"":e("admin.noData")})})]})]})})},EJe=({trigger:e})=>{const{t}=Ki(),{toast:r}=Sa(),n=Ma(),{isSupervisor:o}=nu(),[l,d]=W.useState(!1),[i,g]=W.useState(!1),[_,S]=W.useState({email:"",password:"",displayName:"",phone:"",role:"merchant"}),E=async T=>{T.preventDefault(),g(!0);try{const{data:{session:C}}=await qt.auth.getSession(),N=await fetch("https://tzdgqhwyzsxkxnncgzap.supabase.co/functions/v1/admin-create-user",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${C==null?void 0:C.access_token}`},body:JSON.stringify({email:_.email,password:_.password,displayName:_.displayName,phone:_.phone,role:_.role})}),I=await N.json();if(!N.ok)throw new Error(I.error||"Failed to create user");r({title:t("common.success"),description:t("admin.userCreated")}),d(!1),S({email:"",password:"",displayName:"",phone:"",role:"merchant"}),n.invalidateQueries({queryKey:["admin-users"]})}catch(C){console.error("Error creating user:",C),r({title:t("common.error"),description:C.message||t("admin.createUserError"),variant:"destructive"})}finally{g(!1)}};return m.jsxs(Nh,{open:l,onOpenChange:d,children:[m.jsx(jv,{asChild:!0,children:e||m.jsxs(ir,{children:[m.jsx(KS,{className:"mr-2 h-4 w-4"}),t("admin.createUser")]})}),m.jsx(Rd,{className:"max-w-[90vw] sm:max-w-[500px]",children:m.jsxs("form",{onSubmit:E,children:[m.jsxs(jd,{children:[m.jsx(Nd,{children:t("admin.createNewUser")}),m.jsx(Md,{children:t("admin.createUserDescription")})]}),m.jsxs("div",{className:"grid gap-4 py-4",children:[m.jsxs("div",{className:"grid gap-2",children:[m.jsx(Vr,{htmlFor:"email",children:t("auth.email")}),m.jsx(en,{id:"email",type:"email",required:!0,value:_.email,onChange:T=>S({..._,email:T.target.value}),placeholder:"user@example.com"})]}),m.jsxs("div",{className:"grid gap-2",children:[m.jsx(Vr,{htmlFor:"password",children:t("auth.password")}),m.jsx(en,{id:"password",type:"password",required:!0,value:_.password,onChange:T=>S({..._,password:T.target.value}),placeholder:"",minLength:6})]}),m.jsxs("div",{className:"grid gap-2",children:[m.jsx(Vr,{htmlFor:"displayName",children:t("profile.displayName")}),m.jsx(en,{id:"displayName",required:!0,value:_.displayName,onChange:T=>S({..._,displayName:T.target.value}),placeholder:t("profile.displayName")})]}),m.jsxs("div",{className:"grid gap-2",children:[m.jsx(Vr,{htmlFor:"phone",children:t("profile.phone")}),m.jsx(en,{id:"phone",type:"tel",value:_.phone,onChange:T=>S({..._,phone:T.target.value}),placeholder:"+351 XXX XXX XXX"})]}),m.jsxs("div",{className:"grid gap-2",children:[m.jsx(Vr,{htmlFor:"role",children:t("admin.role")}),o?m.jsx(en,{id:"role",value:t("admin.merchant"),disabled:!0,className:"bg-muted"}):m.jsxs(wd,{value:_.role,onValueChange:T=>S({..._,role:T}),children:[m.jsx(Cu,{children:m.jsx(Sd,{})}),m.jsxs(Ou,{children:[m.jsx(Fa,{value:"merchant",children:t("admin.merchant")}),m.jsx(Fa,{value:"supervisor",children:t("admin.supervisor")})]})]})]})]}),m.jsxs(I4,{children:[m.jsx(ir,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:i,children:t("common.cancel")}),m.jsxs(ir,{type:"submit",disabled:i,children:[i&&m.jsx(Gs,{className:"mr-2 h-4 w-4 animate-spin"}),t("admin.create")]})]})]})})]})},TJe=({open:e,onOpenChange:t,merchantId:r,merchantName:n,userRole:o})=>{const{t:l}=Ki(),{toast:d}=Sa(),i=Ma(),{localizeRestaurant:g}=Id(),{user:_}=Fi(),{isSupervisor:S}=nu(),[E,T]=W.useState([]),[C,N]=W.useState(""),{data:I}=Li({queryKey:["supervisorRestaurants",_==null?void 0:_.id],queryFn:async()=>{if(!_||!S)return null;const{data:ae,error:ne}=await qt.from("merchant_restaurants").select("restaurant_id").eq("user_id",_.id);if(ne)throw ne;return(ae==null?void 0:ae.map(ie=>ie.restaurant_id))||[]},enabled:e&&S&&!!_}),{data:j,isLoading:D}=Li({queryKey:["allRestaurants",I],queryFn:async()=>{let ae=qt.from("restaurants").select("*").order("name");S&&I&&I.length>0&&(ae=ae.in("id",I));const{data:ne,error:ie}=await ae;if(ie)throw ie;return ne},enabled:!S||S&&I!==void 0}),{data:R,isLoading:F}=Li({queryKey:["merchantRestaurants",r],queryFn:async()=>{const{data:ae,error:ne}=await qt.from("merchant_restaurants").select("restaurant_id").eq("user_id",r);if(ne)throw ne;return(ae==null?void 0:ae.map(ie=>ie.restaurant_id))||[]},enabled:e});W.useEffect(()=>{R&&T(R)},[R]);const B=Ya({mutationFn:async()=>{const{error:ae}=await qt.from("merchant_restaurants").delete().eq("user_id",r);if(ae)throw ae;if(E.length>0){const{error:ne}=await qt.from("merchant_restaurants").insert(E.map(ie=>({user_id:r,restaurant_id:ie})));if(ne)throw ne}},onSuccess:()=>{d({title:l("toast.merchantRestaurantsSaved"),description:l("toast.merchantRestaurantsDescription")}),i.invalidateQueries({queryKey:["merchantRestaurants"]}),i.invalidateQueries({queryKey:["adminUsers"]}),t(!1)},onError:ae=>{console.error("Error saving merchant restaurants:",ae),d({title:l("toast.merchantRestaurantsSaveFailed"),description:l("toast.merchantRestaurantsDescriptionFailed"),variant:"destructive"})}}),U=ae=>{T(o==="merchant"?[ae]:ne=>ne.includes(ae)?ne.filter(ie=>ie!==ae):[...ne,ae])},Z=()=>{B.mutate()},J=D||F,te=j==null?void 0:j.filter(ae=>C.trim()?g(ae).name.toLowerCase().includes(C.toLowerCase())||ae.address.toLowerCase().includes(C.toLowerCase()):!0);return m.jsx(Nh,{open:e,onOpenChange:t,children:m.jsxs(Rd,{className:"max-w-2xl max-h-[80vh]",children:[m.jsxs(jd,{children:[m.jsxs(Nd,{className:"flex items-center gap-2",children:[m.jsx(es,{className:"w-5 h-5"}),l(o==="merchant"?"merchant.manageRestaurants":"merchant.manageSupervisorRestaurants")]}),m.jsxs(Md,{children:[l("merchant.assignRestaurantsTo",{name:n}),o==="merchant"&&m.jsx("span",{className:"block mt-1 text-amber-600 dark:text-amber-500 font-medium",children:l("merchant.merchantOnlyOne")}),m.jsx("span",{className:"block mt-1 text-muted-foreground text-xs",children:l("merchant.saveReminder")})]})]}),J?m.jsx("div",{className:"flex justify-center py-8",children:m.jsx(Gs,{className:"w-6 h-6 animate-spin text-primary"})}):m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"relative mb-4",children:[m.jsx(Cv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),m.jsx(en,{placeholder:l("merchant.searchRestaurants"),value:C,onChange:ae=>N(ae.target.value),className:"pl-9"})]}),m.jsx(fv,{className:"h-[400px] pr-4",children:m.jsx("div",{className:"space-y-3",children:te==null?void 0:te.map(ae=>{const ne=E.includes(ae.id),ie=g(ae);return m.jsxs("div",{className:"flex items-start space-x-3 p-4 rounded-lg border hover:bg-accent/50 transition-all cursor-pointer",onClick:()=>U(ae.id),children:[o==="supervisor"?m.jsx(Hs,{checked:ne,className:"mt-1"}):m.jsx("input",{type:"radio",checked:ne,onChange:()=>{},className:"mt-1 h-4 w-4 text-primary focus:ring-primary"}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[m.jsx("p",{className:"text-sm font-medium leading-none",children:ie.name}),ne&&m.jsx(jn,{variant:"secondary",className:"text-xs",children:l("merchant.selected")})]}),m.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[m.jsx(ys,{className:"w-3 h-3"}),m.jsx("span",{className:"line-clamp-1",children:ae.address})]}),ae.type&&ae.type.length>0&&m.jsx("div",{className:"flex gap-1 mt-2",children:ae.type.slice(0,2).map((ee,oe)=>m.jsx(jn,{variant:"outline",className:"text-xs",children:ee},oe))})]})]},ae.id)})})}),m.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[m.jsx("div",{className:"text-sm text-muted-foreground",children:o==="merchant"?l("merchant.selectedCountOne",{count:E.length}):l("merchant.selectedCountMulti",{count:E.length})}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(ir,{variant:"outline",onClick:()=>t(!1),disabled:B.isPending,children:l("common.cancel")}),m.jsxs(ir,{onClick:Z,disabled:B.isPending,children:[B.isPending&&m.jsx(Gs,{className:"w-4 h-4 mr-2 animate-spin"}),l("common.save")]})]})]})]})]})})},AJe=({merchantId:e,merchantName:t,trigger:r})=>{Ki();const{toast:n}=Sa(),o=Ma(),[l,d]=W.useState(!1),[i,g]=W.useState(""),{data:_=[],isLoading:S}=Li({queryKey:["supervisors"],queryFn:async()=>{const{data:D,error:R}=await qt.from("user_roles").select("user_id").eq("role","supervisor");if(R)throw R;const F=D.map(Z=>Z.user_id);if(F.length===0)return[];const{data:B,error:U}=await qt.from("profiles").select("id, display_name").in("id",F);if(U)throw U;return B},enabled:l}),{data:E=[]}=Li({queryKey:["merchant-restaurants",e],queryFn:async()=>{const{data:D,error:R}=await qt.from("merchant_restaurants").select("restaurant_id").eq("user_id",e);if(R)throw R;return D.map(F=>F.restaurant_id)},enabled:l}),{data:T=[]}=Li({queryKey:["merchant-supervisors",e],queryFn:async()=>{if(E.length===0)return[];const{data:D,error:R}=await qt.from("merchant_restaurants").select("user_id, restaurant_id").in("restaurant_id",E).neq("user_id",e);if(R)throw R;const F=[...new Set(D.map(ae=>ae.user_id))];if(F.length===0)return[];const{data:B,error:U}=await qt.from("user_roles").select("user_id").in("user_id",F).eq("role","supervisor");if(U)throw U;const Z=B.map(ae=>ae.user_id);if(Z.length===0)return[];const{data:J,error:te}=await qt.from("profiles").select("id, display_name").in("id",Z);if(te)throw te;return J},enabled:l&&E.length>0}),C=Ya({mutationFn:async D=>{if(E.length===0)throw new Error("");const R=E.map(B=>({user_id:D,restaurant_id:B})),{error:F}=await qt.from("merchant_restaurants").upsert(R,{onConflict:"user_id,restaurant_id"});if(F)throw F},onSuccess:()=>{n({title:"",description:""}),o.invalidateQueries({queryKey:["merchant-supervisors"]}),g(""),d(!1)},onError:D=>{n({title:"",description:D.message,variant:"destructive"})}}),N=Ya({mutationFn:async D=>{const{error:R}=await qt.from("merchant_restaurants").delete().eq("user_id",D).in("restaurant_id",E);if(R)throw R},onSuccess:()=>{n({title:"",description:""}),o.invalidateQueries({queryKey:["merchant-supervisors"]})},onError:D=>{n({title:"",description:D.message,variant:"destructive"})}}),I=()=>{i&&C.mutate(i)},j=D=>{N.mutate(D)};return m.jsxs(Nh,{open:l,onOpenChange:d,children:[m.jsx(jv,{asChild:!0,children:r||m.jsxs(ir,{variant:"outline",size:"sm",children:[m.jsx(oJ,{className:"w-4 h-4 mr-2"}),""]})}),m.jsxs(Rd,{className:"max-w-md",children:[m.jsxs(jd,{children:[m.jsxs(Nd,{className:"flex items-center gap-2",children:[m.jsx(fc,{className:"w-5 h-5"}),""]}),m.jsxs(Md,{children:[" ",m.jsx("strong",{children:t})," "]})]}),m.jsxs("div",{className:"space-y-4",children:[T.length>0&&m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-sm font-medium",children:""}),m.jsx("div",{className:"space-y-2",children:T.map(D=>m.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-lg",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(fc,{className:"w-4 h-4 text-blue-500"}),m.jsx("span",{className:"text-sm",children:D.display_name})]}),m.jsx(ir,{variant:"ghost",size:"sm",onClick:()=>j(D.id),disabled:N.isPending,children:""})]},D.id))})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-sm font-medium",children:""}),m.jsxs(wd,{value:i,onValueChange:g,children:[m.jsx(Cu,{children:m.jsx(Sd,{placeholder:""})}),m.jsx(Ou,{children:S?m.jsx("div",{className:"p-2 text-center",children:m.jsx(Gs,{className:"w-4 h-4 animate-spin mx-auto"})}):_.length===0?m.jsx("div",{className:"p-2 text-center text-sm text-muted-foreground",children:""}):_.filter(D=>!T.find(R=>R.id===D.id)).map(D=>m.jsx(Fa,{value:D.id,children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(fc,{className:"w-4 h-4 text-blue-500"}),D.display_name]})},D.id))})]})]}),E.length===0&&m.jsx(jn,{variant:"secondary",className:"w-full justify-center",children:""}),m.jsxs("div",{className:"flex gap-2 justify-end",children:[m.jsx(ir,{variant:"outline",onClick:()=>d(!1),children:""}),m.jsx(ir,{onClick:I,disabled:!i||C.isPending||E.length===0,children:C.isPending?m.jsxs(m.Fragment,{children:[m.jsx(Gs,{className:"w-4 h-4 mr-2 animate-spin"}),"..."]}):""})]})]})]})]})},PJe=({merchant:e,trigger:t})=>{const{t:r}=Ki(),[n,o]=W.useState(!1),[l,d]=W.useState(e.display_name),[i,g]=W.useState(e.phone||""),[_,S]=W.useState(null),[E,T]=W.useState(e.avatar_url||""),C=dke(),N=hke(),I=D=>{var F;const R=(F=D.target.files)==null?void 0:F[0];if(R){if(R.size>2*1024*1024)return;S(R),T(URL.createObjectURL(R))}},j=async()=>{let D=e.avatar_url;if(_){const R=await N.mutateAsync({file:_,userId:e.id});R&&(D=R)}await C.mutateAsync({userId:e.id,display_name:l,phone:i||void 0,avatar_url:D||void 0}),o(!1)};return m.jsxs(Nh,{open:n,onOpenChange:o,children:[m.jsx(jv,{asChild:!0,children:t||m.jsxs(ir,{variant:"outline",size:"sm",children:[m.jsx(xB,{className:"w-4 h-4 mr-2"}),""]})}),m.jsxs(Rd,{className:"max-w-[90vw] sm:max-w-[425px]",children:[m.jsxs(jd,{children:[m.jsx(Nd,{children:""}),m.jsx(Md,{children:""})]}),m.jsxs("div",{className:"space-y-4 py-4",children:[m.jsxs("div",{className:"flex flex-col items-center gap-4",children:[m.jsxs(Gm,{className:"w-24 h-24",children:[m.jsx(Hm,{src:E}),m.jsx(Km,{children:l==null?void 0:l.charAt(0).toUpperCase()})]}),m.jsxs("div",{children:[m.jsx(en,{type:"file",accept:"image/*",onChange:I,className:"hidden",id:"avatar-upload"}),m.jsxs(ir,{variant:"outline",size:"sm",onClick:()=>{var D;return(D=document.getElementById("avatar-upload"))==null?void 0:D.click()},children:[m.jsx(O0,{className:"w-4 h-4 mr-2"}),r("profile.uploadAvatar")]})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"displayName",children:r("profile.displayName")}),m.jsx(en,{id:"displayName",value:l,onChange:D=>d(D.target.value),placeholder:r("profile.displayName")})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"phone",children:r("profile.phone")}),m.jsx(en,{id:"phone",value:i,onChange:D=>g(D.target.value),placeholder:r("profile.phone")})]})]}),m.jsxs("div",{className:"flex justify-end gap-2",children:[m.jsx(ir,{variant:"outline",onClick:()=>o(!1),children:r("common.cancel")}),m.jsx(ir,{onClick:j,disabled:C.isPending||N.isPending,children:C.isPending||N.isPending?m.jsxs(m.Fragment,{children:[m.jsx(Gs,{className:"w-4 h-4 mr-2 animate-spin"}),r("common.loading")]}):r("common.save")})]})]})]})};function e$(e,t){if(!e||e.length===0)return t.join(",");const r=[];r.push(t.join(","));for(const n of e){const o=t.map(l=>{const d=n[l];if(d==null)return"";if(Array.isArray(d))return`"${d.join(", ")}"`;if(typeof d=="object")return`"${JSON.stringify(d)}"`;const i=String(d);return i.includes(",")||i.includes('"')||i.includes(`
`)?`"${i.replace(/"/g,'""')}"`:i});r.push(o.join(","))}return r.join(`
`)}function t$(e,t){const r="\uFEFF",n=new Blob([r+e],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");if(o.download!==void 0){const l=URL.createObjectURL(n);o.setAttribute("href",l),o.setAttribute("download",t),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(l)}}function CJe(e){const t=["id","display_name","phone","created_at","roles"],r=e.map(l=>{var d;return{id:l.id,display_name:l.display_name,phone:l.phone||"",created_at:new Date(l.created_at).toLocaleDateString(),roles:((d=l.roles)==null?void 0:d.join(", "))||"user"}}),n=e$(r,t),o=`users_export_${new Date().toISOString().split("T")[0]}.csv`;t$(n,o)}function OJe(e){const t=["id","name","name_en","name_pt","type","type_en","type_pt","address","phone","website_url","rating","lat","lng","created_at"],r=e.map(l=>({id:l.id,name:l.name,name_en:l.name_en||"",name_pt:l.name_pt||"",type:l.type,type_en:l.type_en||"",type_pt:l.type_pt||"",address:l.address,phone:l.phone||"",website_url:l.website_url||"",rating:l.rating||0,lat:l.lat,lng:l.lng,created_at:new Date(l.created_at).toLocaleDateString()})),n=e$(r,t),o=`restaurants_export_${new Date().toISOString().split("T")[0]}.csv`;t$(n,o)}function kJe(e){const t=["id","title_en","title_zh","title_pt","start_date","end_date","repeat_mode","pinned","sort_order","created_at"],r=e.map(l=>({id:l.id,title_en:l.title_en,title_zh:l.title_zh,title_pt:l.title_pt,start_date:new Date(l.start_date).toLocaleDateString(),end_date:l.end_date?new Date(l.end_date).toLocaleDateString():"",repeat_mode:l.repeat_mode||"none",pinned:l.pinned?"Yes":"No",sort_order:l.sort_order||0,created_at:new Date(l.created_at).toLocaleDateString()})),n=e$(r,t),o=`activities_export_${new Date().toISOString().split("T")[0]}.csv`;t$(n,o)}const IJe=()=>{const{t:e}=Ki(),{toast:t}=Sa(),{isSupervisor:r,isAdmin:n}=nu(),{data:o,isLoading:l}=ske(),d=lke(),i=xke(),g=Ske(),[_,S]=W.useState(null),[E,T]=W.useState(""),[C,N]=W.useState([]),[I,j]=W.useState("user"),[D,R]=W.useState(""),[F,B]=W.useState("all"),[U,Z]=W.useState({open:!1,userId:"",userName:"",currentRole:"",newRole:""}),[J,te]=W.useState({open:!1,merchantId:"",merchantName:"",userRole:"merchant"}),ae=["user","merchant","supervisor","admin"],ne=r?ae.filter(pe=>pe==="user"||pe==="merchant"):ae,ie=W.useMemo(()=>o?{total:o.length,admins:o.filter(pe=>pe.role==="admin").length,supervisors:o.filter(pe=>pe.role==="supervisor").length,merchants:o.filter(pe=>pe.role==="merchant").length,regularUsers:o.filter(pe=>pe.role==="user").length}:{total:0,admins:0,supervisors:0,merchants:0,regularUsers:0},[o]),ee=W.useMemo(()=>o?o.filter(pe=>{var Ze;const Ie=D===""||pe.display_name.toLowerCase().includes(D.toLowerCase())||((Ze=pe.phone)==null?void 0:Ze.toLowerCase().includes(D.toLowerCase())),tt=F==="all"||pe.role===F;return Ie&&tt}):[],[o,D,F]),oe=()=>{if(!o||o.length===0){t({title:e("common.error"),description:e("admin.noDataToExport"),variant:"destructive"});return}CJe(o),t({title:e("common.success"),description:e("admin.exportSuccess")})},de=pe=>{N(Ie=>Ie.includes(pe)?Ie.filter(tt=>tt!==pe):[...Ie,pe])},xe=()=>{C.length===(ee==null?void 0:ee.length)?N([]):N((ee==null?void 0:ee.map(pe=>pe.id))||[])},we=()=>{C.length!==0&&(i.mutate(C),N([]))},Ae=()=>{C.length!==0&&(g.mutate({userIds:C,role:I}),N([]))},Ce=()=>{U.userId&&U.newRole&&d.mutate({userId:U.userId,role:U.newRole},{onSuccess:()=>{Z({open:!1,userId:"",userName:"",currentRole:"",newRole:""}),S(null),T("")}})},me=(pe,Ie,tt,Ze)=>{Z({open:!0,userId:pe,userName:Ie,currentRole:tt,newRole:Ze})},Pe=pe=>{switch(pe){case"admin":return"bg-primary text-primary-foreground hover:bg-primary/90";case"supervisor":return"bg-blue-500 text-white hover:bg-blue-600";case"merchant":return"bg-emerald-500 text-white hover:bg-emerald-600";default:return"bg-muted text-muted-foreground hover:bg-muted/80"}},ye=pe=>{switch(pe){case"admin":return m.jsx(fc,{className:"h-3.5 w-3.5"});case"supervisor":return m.jsx(fc,{className:"h-3.5 w-3.5"});case"merchant":return m.jsx(bP,{className:"h-3.5 w-3.5"});default:return m.jsx(_u,{className:"h-3.5 w-3.5"})}};return l?m.jsx(eu,{children:m.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:m.jsxs("div",{className:"text-center space-y-3",children:[m.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),m.jsx("p",{className:"text-muted-foreground",children:e("common.loading")})]})})}):m.jsx(eu,{children:m.jsxs("div",{className:"space-y-6",children:[m.jsx("div",{children:m.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[m.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:m.jsx(oJ,{className:"h-6 w-6 text-primary"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:e("admin.userManagement")}),m.jsx("p",{className:"text-muted-foreground",children:e("admin.manageUserRoles")})]})]})}),r?m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:m.jsx(rn,{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 border-emerald-200 dark:from-emerald-950/20 dark:to-emerald-900/20 dark:border-emerald-900/30",children:m.jsx(ln,{className:"pt-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),m.jsx("p",{className:"text-2xl font-bold",children:ie.merchants})]}),m.jsx(bP,{className:"h-8 w-8 text-emerald-500"})]})})})}):m.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[m.jsx(rn,{className:"bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20",children:m.jsx(ln,{className:"pt-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),m.jsx("p",{className:"text-2xl font-bold",children:ie.total})]}),m.jsx(_u,{className:"h-8 w-8 text-primary/60"})]})})}),m.jsx(rn,{className:"bg-gradient-to-br from-red-50 to-red-100 border-red-200 dark:from-red-950/20 dark:to-red-900/20 dark:border-red-900/30",children:m.jsx(ln,{className:"pt-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),m.jsx("p",{className:"text-2xl font-bold",children:ie.admins})]}),m.jsx(fc,{className:"h-8 w-8 text-red-500"})]})})}),m.jsx(rn,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200 dark:from-blue-950/20 dark:to-blue-900/20 dark:border-blue-900/30",children:m.jsx(ln,{className:"pt-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),m.jsx("p",{className:"text-2xl font-bold",children:ie.supervisors})]}),m.jsx(fc,{className:"h-8 w-8 text-blue-500"})]})})}),m.jsx(rn,{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 border-emerald-200 dark:from-emerald-950/20 dark:to-emerald-900/20 dark:border-emerald-900/30",children:m.jsx(ln,{className:"pt-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),m.jsx("p",{className:"text-2xl font-bold",children:ie.merchants})]}),m.jsx(bP,{className:"h-8 w-8 text-emerald-500"})]})})}),m.jsx(rn,{className:"bg-gradient-to-br from-gray-50 to-gray-100 border-gray-200 dark:from-gray-950/20 dark:to-gray-900/20 dark:border-gray-900/30",children:m.jsx(ln,{className:"pt-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),m.jsx("p",{className:"text-2xl font-bold",children:ie.regularUsers})]}),m.jsx(_u,{className:"h-8 w-8 text-gray-500"})]})})})]}),m.jsx(rn,{children:m.jsx(ln,{className:"pt-6",children:m.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[m.jsx("div",{className:"flex-1",children:m.jsxs("div",{className:"relative",children:[m.jsx(Cv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),m.jsx(en,{placeholder:"...",value:D,onChange:pe=>R(pe.target.value),className:"pl-10 pr-10"}),D&&m.jsx(ir,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-7 w-7 p-0",onClick:()=>R(""),children:m.jsx(ju,{className:"h-4 w-4"})})]})}),!r&&m.jsxs(wd,{value:F,onValueChange:B,children:[m.jsxs(Cu,{className:"w-full md:w-[200px]",children:[m.jsx(gB,{className:"h-4 w-4 mr-2"}),m.jsx(Sd,{placeholder:""})]}),m.jsxs(Ou,{children:[m.jsx(Fa,{value:"all",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(_u,{className:"h-4 w-4"}),""]})}),m.jsx(Fa,{value:"admin",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(fc,{className:"h-4 w-4 text-red-500"}),""]})}),m.jsx(Fa,{value:"supervisor",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(fc,{className:"h-4 w-4 text-blue-500"}),""]})}),m.jsx(Fa,{value:"merchant",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(bP,{className:"h-4 w-4 text-emerald-500"}),""]})}),m.jsx(Fa,{value:"user",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(_u,{className:"h-4 w-4 text-gray-500"}),""]})})]})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(EJe,{trigger:m.jsxs(ir,{variant:"default",size:"default",children:[m.jsx(KS,{className:"mr-2 h-4 w-4"}),m.jsx("span",{className:"hidden sm:inline",children:e("admin.createUser")}),m.jsx("span",{className:"sm:hidden",children:e("admin.create")})]})}),m.jsxs(ir,{variant:"outline",onClick:oe,children:[m.jsx(sI,{className:"h-4 w-4 md:mr-2"}),m.jsx("span",{className:"hidden md:inline",children:""})]})]})]})})}),C.length>0&&m.jsx(rn,{className:"border-primary/50 bg-primary/5",children:m.jsx(ln,{className:"pt-6",children:m.jsxs("div",{className:"flex flex-col gap-4",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(Hs,{checked:!0,onCheckedChange:()=>N([])}),m.jsxs("span",{className:"font-semibold",children:[" ",C.length," "]})]}),m.jsxs(ir,{variant:"ghost",size:"sm",onClick:()=>N([]),children:[m.jsx(ju,{className:"h-4 w-4 mr-1"}),""]})]}),m.jsx(xu,{}),m.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[m.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[m.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:""}),m.jsxs(wd,{value:I,onValueChange:pe=>j(pe),children:[m.jsx(Cu,{className:"w-full sm:w-[160px]",children:m.jsx(Sd,{})}),m.jsx(Ou,{children:ne.map(pe=>m.jsx(Fa,{value:pe,children:m.jsxs("div",{className:"flex items-center gap-2",children:[ye(pe),m.jsx("span",{className:"capitalize",children:pe})]})},pe))})]}),m.jsxs(ir,{onClick:Ae,size:"default",children:[m.jsx(KS,{className:"mr-2 h-4 w-4"}),""]})]}),m.jsxs(Bl,{children:[m.jsx(NE,{asChild:!0,children:m.jsxs(ir,{variant:"destructive",size:"default",children:[m.jsx(Sb,{className:"mr-2 h-4 w-4"}),""]})}),m.jsxs(sl,{className:"max-w-[90vw] sm:max-w-[425px]",children:[m.jsxs(ll,{children:[m.jsx(ul,{children:""}),m.jsxs(dl,{children:[" ",C.length," "]})]}),m.jsxs(cl,{children:[m.jsx(hl,{children:""}),m.jsx(Vs,{onClick:we,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:""})]})]})]})]})]})})}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx(Hs,{checked:C.length===(ee==null?void 0:ee.length)&&ee.length>0,onCheckedChange:xe}),m.jsx("span",{className:"font-semibold",children:""})]}),m.jsxs(jn,{variant:"secondary",className:"text-sm font-normal",children:[" ",ee==null?void 0:ee.length," / ",(o==null?void 0:o.length)||0," "]})]}),ee&&ee.length>0?m.jsx("div",{className:"grid gap-4",children:ee.map(pe=>{var Ie;return m.jsx(rn,{className:"hover:shadow-lg transition-all duration-200 border-l-4 border-l-transparent hover:border-l-primary",children:m.jsx(ln,{className:"pt-6",children:m.jsxs("div",{className:"flex flex-col gap-4",children:[m.jsxs("div",{className:"flex items-start sm:items-center justify-between gap-4",children:[m.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[m.jsx(Hs,{checked:C.includes(pe.id),onCheckedChange:()=>de(pe.id)}),m.jsxs(Gm,{className:"h-16 w-16 border-2 border-border",children:[m.jsx(Hm,{src:pe.avatar_url||""}),m.jsx(Km,{className:"text-lg font-semibold bg-primary/10 text-primary",children:((Ie=pe.display_name)==null?void 0:Ie.charAt(0).toUpperCase())||"U"})]}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("h3",{className:"font-bold text-lg truncate",children:pe.display_name}),m.jsx("p",{className:"text-sm text-muted-foreground truncate",children:pe.phone||""})]})]}),m.jsxs(jn,{className:`${Pe(pe.role)} px-3 py-1.5 font-medium`,children:[ye(pe.role),m.jsx("span",{className:"ml-1.5 capitalize",children:pe.role})]})]}),m.jsx(xu,{}),m.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[m.jsxs("div",{className:"flex-1",children:[m.jsx("label",{className:"text-sm font-medium text-muted-foreground mb-2 block",children:""}),m.jsxs(wd,{value:_===pe.id?E:"",onValueChange:tt=>{S(pe.id),T(tt)},children:[m.jsx(Cu,{className:"w-full",children:m.jsx(Sd,{placeholder:"..."})}),m.jsx(Ou,{children:ne.filter(tt=>tt!==pe.role).map(tt=>m.jsx(Fa,{value:tt,children:m.jsxs("div",{className:"flex items-center gap-2",children:[ye(tt),m.jsx("span",{className:"capitalize",children:tt})]})},tt))})]})]}),m.jsx("div",{className:"flex items-end",children:m.jsxs(ir,{onClick:()=>{_===pe.id&&E&&me(pe.id,pe.display_name,pe.role,E)},disabled:_!==pe.id||!E,className:"w-full sm:w-auto",size:"default",children:[m.jsx(KS,{className:"mr-2 h-4 w-4"}),""]})})]}),r&&pe.role==="merchant"&&m.jsxs(m.Fragment,{children:[m.jsx(xu,{}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-sm font-medium text-muted-foreground block",children:""}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:""})]}),m.jsx(PJe,{merchant:{id:pe.id,display_name:pe.display_name,phone:pe.phone,avatar_url:pe.avatar_url}})]})]}),(pe.role==="merchant"||pe.role==="supervisor")&&m.jsxs(m.Fragment,{children:[m.jsx(xu,{}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-sm font-medium text-muted-foreground block",children:""}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:pe.role==="merchant"?"1":""})]}),m.jsxs(ir,{variant:"outline",size:"default",onClick:()=>te({open:!0,merchantId:pe.id,merchantName:pe.display_name,userRole:pe.role}),children:[m.jsx(es,{className:"mr-2 h-4 w-4"}),""]})]}),n&&pe.role==="merchant"&&m.jsxs(m.Fragment,{children:[m.jsx(xu,{}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-sm font-medium text-muted-foreground block",children:""}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:""})]}),m.jsx(AJe,{merchantId:pe.id,merchantName:pe.display_name})]})]})]})]})]})})},pe.id)})}):m.jsx(rn,{children:m.jsx(ln,{className:"pt-12 pb-12",children:m.jsxs("div",{className:"text-center space-y-3",children:[m.jsx(_u,{className:"h-16 w-16 text-muted-foreground/50 mx-auto"}),m.jsx("h3",{className:"text-lg font-semibold",children:""}),m.jsx("p",{className:"text-muted-foreground",children:D||F!=="all"?"":""})]})})})]}),m.jsx(Bl,{open:U.open,onOpenChange:pe=>{pe||Z({open:!1,userId:"",userName:"",currentRole:"",newRole:""})},children:m.jsxs(sl,{className:"max-w-[90vw] sm:max-w-[500px]",children:[m.jsxs(ll,{children:[m.jsxs(ul,{className:"flex items-center gap-2",children:[m.jsx(fc,{className:"h-5 w-5 text-primary"}),""]}),m.jsxs(dl,{className:"space-y-4 pt-4",children:[m.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg space-y-3",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:""}),m.jsx("span",{className:"font-semibold text-foreground",children:U.userName})]}),m.jsx(xu,{}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:""}),m.jsxs(jn,{className:Pe(U.currentRole),children:[ye(U.currentRole),m.jsx("span",{className:"ml-1.5 capitalize",children:U.currentRole})]})]}),m.jsx("div",{className:"flex items-center justify-center",children:m.jsx("div",{className:"text-2xl text-primary",children:""})}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:""}),m.jsxs(jn,{className:Pe(U.newRole),children:[ye(U.newRole),m.jsx("span",{className:"ml-1.5 capitalize",children:U.newRole})]})]})]}),U.newRole==="admin"&&m.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 p-4 rounded-lg flex gap-3",children:[m.jsx(fc,{className:"h-5 w-5 text-destructive flex-shrink-0 mt-0.5"}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("p",{className:"font-semibold text-destructive text-sm",children:" "}),m.jsx("p",{className:"text-sm text-muted-foreground",children:""})]})]}),U.currentRole==="admin"&&m.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 p-4 rounded-lg flex gap-3",children:[m.jsx(fc,{className:"h-5 w-5 text-destructive flex-shrink-0 mt-0.5"}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("p",{className:"font-semibold text-destructive text-sm",children:" "}),m.jsx("p",{className:"text-sm text-muted-foreground",children:""})]})]}),m.jsx("p",{className:"text-sm text-center text-muted-foreground",children:""})]})]}),m.jsxs(cl,{children:[m.jsx(hl,{children:""}),m.jsx(Vs,{onClick:Ce,className:"bg-primary",children:""})]})]})}),m.jsx(TJe,{open:J.open,onOpenChange:pe=>te({...J,open:pe}),merchantId:J.merchantId,merchantName:J.merchantName,userRole:J.userRole})]})})};var $R="Switch",[RJe,rtt]=Zs($R),[jJe,NJe]=RJe($R),Cce=W.forwardRef((e,t)=>{const{__scopeSwitch:r,name:n,checked:o,defaultChecked:l,required:d,disabled:i,value:g="on",onCheckedChange:_,form:S,...E}=e,[T,C]=W.useState(null),N=fi(t,F=>C(F)),I=W.useRef(!1),j=T?S||!!T.closest("form"):!0,[D,R]=Ru({prop:o,defaultProp:l??!1,onChange:_,caller:$R});return m.jsxs(jJe,{scope:r,checked:D,disabled:i,children:[m.jsx(wn.button,{type:"button",role:"switch","aria-checked":D,"aria-required":d,"data-state":Rce(D),"data-disabled":i?"":void 0,disabled:i,value:g,...E,ref:N,onClick:Rr(e.onClick,F=>{R(B=>!B),j&&(I.current=F.isPropagationStopped(),I.current||F.stopPropagation())})}),j&&m.jsx(Ice,{control:T,bubbles:!I.current,name:n,value:g,checked:D,required:d,disabled:i,form:S,style:{transform:"translateX(-100%)"}})]})});Cce.displayName=$R;var Oce="SwitchThumb",kce=W.forwardRef((e,t)=>{const{__scopeSwitch:r,...n}=e,o=NJe(Oce,r);return m.jsx(wn.span,{"data-state":Rce(o.checked),"data-disabled":o.disabled?"":void 0,...n,ref:t})});kce.displayName=Oce;var MJe="SwitchBubbleInput",Ice=W.forwardRef(({__scopeSwitch:e,control:t,checked:r,bubbles:n=!0,...o},l)=>{const d=W.useRef(null),i=fi(d,l),g=O4(r),_=OB(t);return W.useEffect(()=>{const S=d.current;if(!S)return;const E=window.HTMLInputElement.prototype,C=Object.getOwnPropertyDescriptor(E,"checked").set;if(g!==r&&C){const N=new Event("click",{bubbles:n});C.call(S,r),S.dispatchEvent(N)}},[g,r,n]),m.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...o,tabIndex:-1,ref:i,style:{...o.style,..._,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Ice.displayName=MJe;function Rce(e){return e?"checked":"unchecked"}var jce=Cce,DJe=kce;const Nce=W.forwardRef(({className:e,...t},r)=>m.jsx(jce,{className:yr("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e),...t,ref:r,children:m.jsx(DJe,{className:yr("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Nce.displayName=jce.displayName;const Mce=({className:e,...t})=>m.jsx("nav",{role:"navigation","aria-label":"pagination",className:yr("mx-auto flex w-full justify-center",e),...t});Mce.displayName="Pagination";const Dce=W.forwardRef(({className:e,...t},r)=>m.jsx("ul",{ref:r,className:yr("flex flex-row items-center gap-1",e),...t}));Dce.displayName="PaginationContent";const LS=W.forwardRef(({className:e,...t},r)=>m.jsx("li",{ref:r,className:yr("",e),...t}));LS.displayName="PaginationItem";const UR=({className:e,isActive:t,size:r="icon",...n})=>m.jsx("a",{"aria-current":t?"page":void 0,className:yr(M0({variant:t?"outline":"ghost",size:r}),e),...n});UR.displayName="PaginationLink";const Lce=({className:e,...t})=>m.jsxs(UR,{"aria-label":"Go to previous page",size:"default",className:yr("gap-1 pl-2.5",e),...t,children:[m.jsx(oI,{className:"h-4 w-4"}),m.jsx("span",{children:"Previous"})]});Lce.displayName="PaginationPrevious";const Fce=({className:e,...t})=>m.jsxs(UR,{"aria-label":"Go to next page",size:"default",className:yr("gap-1 pr-2.5",e),...t,children:[m.jsx("span",{children:"Next"}),m.jsx(pB,{className:"h-4 w-4"})]});Fce.displayName="PaginationNext";const zce=({className:e,...t})=>m.jsxs("span",{"aria-hidden":!0,className:yr("flex h-9 w-9 items-center justify-center",e),...t,children:[m.jsx(mB,{className:"h-4 w-4"}),m.jsx("span",{className:"sr-only",children:"More pages"})]});zce.displayName="PaginationEllipsis";function LJe({data:e,itemsPerPage:t=10}){const[r,n]=W.useState(1),o=(e==null?void 0:e.length)||0,l=Math.ceil(o/t),d=W.useMemo(()=>{if(!e)return[];const N=(r-1)*t,I=N+t;return e.slice(N,I)},[e,r,t]),i=N=>{const I=Math.max(1,Math.min(N,l));n(I),window.scrollTo({top:0,behavior:"smooth"})},g=()=>i(r+1),_=()=>i(r-1),S=r<l,E=r>1,T=o===0?0:(r-1)*t+1,C=Math.min(r*t,o);return{currentPage:r,totalPages:l,paginatedData:d,goToPage:i,nextPage:g,previousPage:_,canGoNext:S,canGoPrevious:E,startIndex:T,endIndex:C,totalItems:o}}const FJe=()=>{const{t:e}=Ki(),{toast:t}=Sa(),{isSupervisor:r}=nu(),{data:n,isLoading:o}=cke(),{getLocalizedField:l}=Id(),d=_ke(),i=bke(),g=Eke(),[_,S]=W.useState([]),[E,T]=W.useState(""),[C,N]=W.useState("all"),I=W.useMemo(()=>{if(!n)return[];const we=new Set;return n.forEach(Ae=>{const Ce=l(Ae,"type");Array.isArray(Ce)?Ce.forEach(me=>we.add(me)):Ce&&we.add(Ce)}),Array.from(we)},[n,l]),j=W.useMemo(()=>n?n.filter(we=>{const Ae=E===""||l(we,"name").toString().toLowerCase().includes(E.toLowerCase())||we.address.toLowerCase().includes(E.toLowerCase()),Ce=l(we,"type"),me=C==="all"||(Array.isArray(Ce)?Ce.includes(C):Ce===C);return Ae&&me}):[],[n,E,C,l]),{currentPage:D,totalPages:R,paginatedData:F,goToPage:B,nextPage:U,previousPage:Z,canGoNext:J,canGoPrevious:te,startIndex:ae,endIndex:ne,totalItems:ie}=LJe({data:j,itemsPerPage:10}),ee=()=>{if(!n||n.length===0){t({title:e("common.error"),description:e("admin.noDataToExport"),variant:"destructive"});return}OJe(n),t({title:e("common.success"),description:e("admin.exportSuccess")})},oe=we=>{S(Ae=>Ae.includes(we)?Ae.filter(Ce=>Ce!==we):[...Ae,we])},de=()=>{_.length===(F==null?void 0:F.length)?S([]):S((F==null?void 0:F.map(we=>we.id))||[])},xe=()=>{_.length!==0&&(i.mutate(_),S([]))};return o?m.jsx(eu,{children:m.jsx("div",{className:"text-center",children:e("common.loading")})}):m.jsx(eu,{children:m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:e("admin.restaurantManagement")}),m.jsx("p",{className:"text-muted-foreground",children:e("admin.manageRestaurants")})]}),m.jsxs("div",{className:"flex gap-2 flex-wrap",children:[m.jsxs(ir,{variant:"outline",onClick:ee,className:"flex-1 sm:flex-initial",children:[m.jsx(sI,{className:"mr-2 h-4 w-4"}),m.jsx("span",{className:"hidden sm:inline",children:e("admin.exportCSV")})]}),m.jsx(DO,{trigger:m.jsxs(ir,{className:"flex-1 sm:flex-initial",children:[m.jsx(_B,{className:"mr-2 h-4 w-4"}),e("admin.addRestaurant")]})})]})]}),m.jsx(rn,{children:m.jsx(ln,{className:"pt-6",children:m.jsxs("div",{className:"flex gap-4 flex-wrap",children:[m.jsx("div",{className:"flex-1 min-w-[200px]",children:m.jsxs("div",{className:"relative",children:[m.jsx(Cv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),m.jsx(en,{placeholder:e("admin.searchRestaurants"),value:E,onChange:we=>T(we.target.value),className:"pl-9"})]})}),m.jsxs(wd,{value:C,onValueChange:N,children:[m.jsx(Cu,{className:"w-[180px]",children:m.jsx(Sd,{placeholder:e("admin.filterByType")})}),m.jsxs(Ou,{children:[m.jsx(Fa,{value:"all",children:e("admin.allTypes")}),I.map(we=>m.jsx(Fa,{value:we,children:we},we))]})]})]})})}),!r&&_.length>0&&m.jsx(rn,{className:"bg-muted/50",children:m.jsx(ln,{className:"pt-6",children:m.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[m.jsx("span",{className:"font-medium",children:e("admin.selectedCount",{count:_.length})}),m.jsxs("div",{className:"flex gap-2 flex-wrap w-full sm:w-auto",children:[m.jsxs(Bl,{children:[m.jsx(NE,{asChild:!0,children:m.jsxs(ir,{variant:"destructive",size:"sm",className:"flex-1 sm:flex-initial",children:[m.jsx(Sb,{className:"mr-2 h-4 w-4"}),e("admin.batchDelete")]})}),m.jsxs(sl,{className:"max-w-[90vw] sm:max-w-[425px]",children:[m.jsxs(ll,{children:[m.jsx(ul,{children:e("admin.confirmBatchDelete")}),m.jsx(dl,{children:e("admin.batchDeleteWarning",{count:_.length})})]}),m.jsxs(cl,{children:[m.jsx(hl,{children:e("common.cancel")}),m.jsx(Vs,{onClick:xe,children:e("common.delete")})]})]})]}),m.jsx(ir,{variant:"outline",size:"sm",onClick:()=>S([]),className:"flex-1 sm:flex-initial",children:e("admin.clearSelection")})]})]})})}),m.jsxs("div",{className:"flex items-center justify-between pb-2 border-b",children:[m.jsx("div",{className:"flex items-center gap-2",children:!r&&m.jsxs(m.Fragment,{children:[m.jsx(Hs,{checked:_.length===(F==null?void 0:F.length)&&F.length>0,onCheckedChange:de}),m.jsx("span",{className:"font-medium",children:e("admin.selectAll")})]})}),m.jsxs("span",{className:"text-sm text-muted-foreground",children:[e("admin.showing")," ",ae,"-",ne," ",e("admin.of")," ",ie]})]}),m.jsx("div",{className:"grid gap-4",children:F==null?void 0:F.map(we=>m.jsx(rn,{children:m.jsxs("div",{className:"flex flex-col md:flex-row",children:[m.jsx("div",{className:"p-4 flex items-start",children:!r&&m.jsx(Hs,{checked:_.includes(we.id),onCheckedChange:()=>oe(we.id),className:"mt-1"})}),we.image_url&&m.jsx("div",{className:"w-full md:w-48 h-48 flex items-center justify-center overflow-hidden",children:m.jsx("img",{src:we.image_url,alt:String(l(we,"name")),className:"object-cover object-center w-full h-full"})}),m.jsxs("div",{className:"flex-1",children:[m.jsxs(Di,{children:[m.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[m.jsx(Qi,{className:"text-lg md:text-xl",children:l(we,"name")}),m.jsx("div",{className:"flex items-center gap-2",children:m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(Ec,{className:"h-4 w-4 fill-accent text-accent"}),m.jsx("span",{className:"font-medium",children:we.rating||0})]})})]}),m.jsx(Lo,{children:m.jsxs("div",{className:"flex flex-col gap-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(ys,{className:"h-3 w-3 flex-shrink-0"}),m.jsx("span",{className:"text-xs sm:text-sm",children:we.address})]}),l(we,"description")&&m.jsx("div",{className:`prose prose-sm max-w-none line-clamp-2\r
                              [&_p]:inline [&_p]:m-0\r
                              [&_strong]:font-semibold [&_strong]:text-foreground\r
                              [&_em]:italic\r
                              [&_h1]:text-base [&_h2]:text-base [&_h3]:text-base\r
                              [&_*]:text-muted-foreground`,dangerouslySetInnerHTML:{__html:l(we,"description")}})]})})]}),m.jsxs(ln,{children:[m.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:(Array.isArray(l(we,"type"))?l(we,"type"):[l(we,"type")]).map((Ae,Ce)=>m.jsx(jn,{children:Ae},Ce))}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[m.jsxs("div",{className:"space-y-0.5",children:[m.jsx(Vr,{htmlFor:`visible-${we.id}`,className:"text-sm font-medium",children:""}),m.jsx("div",{className:"text-xs text-muted-foreground",children:we.visible?"":""})]}),m.jsx(Nce,{id:`visible-${we.id}`,checked:we.visible??!0,onCheckedChange:Ae=>g.mutate({restaurantId:we.id,visible:Ae})})]}),m.jsxs("div",{className:"flex gap-2 flex-wrap",children:[m.jsx(ir,{variant:"outline",size:"sm",asChild:!0,className:"flex-1 sm:flex-initial",children:m.jsx(ia,{to:`/restaurant/${we.id}`,state:{from:"admin"},children:e("admin.view")})}),m.jsx(DO,{restaurant:we,trigger:m.jsx(ir,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:e("common.edit")})}),!r&&m.jsxs(Bl,{children:[m.jsx(NE,{asChild:!0,children:m.jsx(ir,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:e("common.delete")})}),m.jsxs(sl,{className:"max-w-[90vw] sm:max-w-[425px]",children:[m.jsxs(ll,{children:[m.jsx(ul,{children:e("admin.confirmDelete")}),m.jsx(dl,{children:e("admin.deleteRestaurantWarning")})]}),m.jsxs(cl,{children:[m.jsx(hl,{children:e("common.cancel")}),m.jsx(Vs,{onClick:()=>d.mutate(we.id),children:e("common.delete")})]})]})]})]})]})]})]})]})},we.id))}),R>1&&m.jsx(Mce,{className:"mt-6",children:m.jsxs(Dce,{children:[m.jsx(LS,{children:m.jsx(Lce,{onClick:Z,className:te?"cursor-pointer":"pointer-events-none opacity-50"})}),Array.from({length:R},(we,Ae)=>Ae+1).map(we=>we===1||we===R||we>=D-1&&we<=D+1?m.jsx(LS,{children:m.jsx(UR,{onClick:()=>B(we),isActive:D===we,className:"cursor-pointer",children:we})},we):we===D-2||we===D+2?m.jsx(LS,{children:m.jsx(zce,{})},we):null),m.jsx(LS,{children:m.jsx(Fce,{onClick:U,className:J?"cursor-pointer":"pointer-events-none opacity-50"})})]})})]})})};var ai=function(){return ai=Object.assign||function(t){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(t[l]=r[l])}return t},ai.apply(this,arguments)};function zJe(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]]);return r}function Bce(e,t,r){for(var n=0,o=t.length,l;n<o;n++)(l||!(n in t))&&(l||(l=Array.prototype.slice.call(t,0,n)),l[n]=t[n]);return e.concat(l||Array.prototype.slice.call(t))}function s2(e){return e.mode==="multiple"}function l2(e){return e.mode==="range"}function VR(e){return e.mode==="single"}var BJe={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function $Je(e,t){return Is(e,"LLLL y",t)}function UJe(e,t){return Is(e,"d",t)}function VJe(e,t){return Is(e,"LLLL",t)}function qJe(e){return"".concat(e)}function WJe(e,t){return Is(e,"cccccc",t)}function GJe(e,t){return Is(e,"yyyy",t)}var HJe=Object.freeze({__proto__:null,formatCaption:$Je,formatDay:UJe,formatMonthCaption:VJe,formatWeekNumber:qJe,formatWeekdayName:WJe,formatYearCaption:GJe}),KJe=function(e,t,r){return Is(e,"do MMMM (EEEE)",r)},ZJe=function(){return"Month: "},XJe=function(){return"Go to next month"},YJe=function(){return"Go to previous month"},JJe=function(e,t){return Is(e,"cccc",t)},QJe=function(e){return"Week n. ".concat(e)},eQe=function(){return"Year: "},tQe=Object.freeze({__proto__:null,labelDay:KJe,labelMonthDropdown:ZJe,labelNext:XJe,labelPrevious:YJe,labelWeekNumber:QJe,labelWeekday:JJe,labelYearDropdown:eQe});function rQe(){var e="buttons",t=BJe,r=_4,n={},o={},l=1,d={},i=new Date;return{captionLayout:e,classNames:t,formatters:HJe,labels:tQe,locale:r,modifiersClassNames:n,modifiers:o,numberOfMonths:l,styles:d,today:i,mode:"default"}}function nQe(e){var t=e.fromYear,r=e.toYear,n=e.fromMonth,o=e.toMonth,l=e.fromDate,d=e.toDate;return n?l=Tc(n):t&&(l=new Date(t,0,1)),o?d=MI(o):r&&(d=new Date(r,11,31)),{fromDate:l?Zm(l):void 0,toDate:d?Zm(d):void 0}}var $ce=W.createContext(void 0);function iQe(e){var t,r=e.initialProps,n=rQe(),o=nQe(r),l=o.fromDate,d=o.toDate,i=(t=r.captionLayout)!==null&&t!==void 0?t:n.captionLayout;i!=="buttons"&&(!l||!d)&&(i="buttons");var g;(VR(r)||s2(r)||l2(r))&&(g=r.onSelect);var _=ai(ai(ai({},n),r),{captionLayout:i,classNames:ai(ai({},n.classNames),r.classNames),components:ai({},r.components),formatters:ai(ai({},n.formatters),r.formatters),fromDate:l,labels:ai(ai({},n.labels),r.labels),mode:r.mode||n.mode,modifiers:ai(ai({},n.modifiers),r.modifiers),modifiersClassNames:ai(ai({},n.modifiersClassNames),r.modifiersClassNames),onSelect:g,styles:ai(ai({},n.styles),r.styles),toDate:d});return m.jsx($ce.Provider,{value:_,children:e.children})}function Ja(){var e=W.useContext($ce);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function Uce(e){var t=Ja(),r=t.locale,n=t.classNames,o=t.styles,l=t.formatters.formatCaption;return m.jsx("div",{className:n.caption_label,style:o.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:l(e.displayMonth,{locale:r})})}function aQe(e){return m.jsx("svg",ai({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:m.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function Vce(e){var t,r,n=e.onChange,o=e.value,l=e.children,d=e.caption,i=e.className,g=e.style,_=Ja(),S=(r=(t=_.components)===null||t===void 0?void 0:t.IconDropdown)!==null&&r!==void 0?r:aQe;return m.jsxs("div",{className:i,style:g,children:[m.jsx("span",{className:_.classNames.vhidden,children:e["aria-label"]}),m.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:_.classNames.dropdown,style:_.styles.dropdown,value:o,onChange:n,children:l}),m.jsxs("div",{className:_.classNames.caption_label,style:_.styles.caption_label,"aria-hidden":"true",children:[d,m.jsx(S,{className:_.classNames.dropdown_icon,style:_.styles.dropdown_icon})]})]})}function oQe(e){var t,r=Ja(),n=r.fromDate,o=r.toDate,l=r.styles,d=r.locale,i=r.formatters.formatMonthCaption,g=r.classNames,_=r.components,S=r.labels.labelMonthDropdown;if(!n)return m.jsx(m.Fragment,{});if(!o)return m.jsx(m.Fragment,{});var E=[];if(KAe(n,o))for(var T=Tc(n),C=n.getMonth();C<=o.getMonth();C++)E.push(XM(T,C));else for(var T=Tc(new Date),C=0;C<=11;C++)E.push(XM(T,C));var N=function(j){var D=Number(j.target.value),R=XM(Tc(e.displayMonth),D);e.onChange(R)},I=(t=_==null?void 0:_.Dropdown)!==null&&t!==void 0?t:Vce;return m.jsx(I,{name:"months","aria-label":S(),className:g.dropdown_month,style:l.dropdown_month,onChange:N,value:e.displayMonth.getMonth(),caption:i(e.displayMonth,{locale:d}),children:E.map(function(j){return m.jsx("option",{value:j.getMonth(),children:i(j,{locale:d})},j.getMonth())})})}function sQe(e){var t,r=e.displayMonth,n=Ja(),o=n.fromDate,l=n.toDate,d=n.locale,i=n.styles,g=n.classNames,_=n.components,S=n.formatters.formatYearCaption,E=n.labels.labelYearDropdown,T=[];if(!o)return m.jsx(m.Fragment,{});if(!l)return m.jsx(m.Fragment,{});for(var C=o.getFullYear(),N=l.getFullYear(),I=C;I<=N;I++)T.push(cW(qre(new Date),I));var j=function(R){var F=cW(Tc(r),Number(R.target.value));e.onChange(F)},D=(t=_==null?void 0:_.Dropdown)!==null&&t!==void 0?t:Vce;return m.jsx(D,{name:"years","aria-label":E(),className:g.dropdown_year,style:i.dropdown_year,onChange:j,value:r.getFullYear(),caption:S(r,{locale:d}),children:T.map(function(R){return m.jsx("option",{value:R.getFullYear(),children:S(R,{locale:d})},R.getFullYear())})})}function lQe(e,t){var r=W.useState(e),n=r[0],o=r[1],l=t===void 0?n:t;return[l,o]}function cQe(e){var t=e.month,r=e.defaultMonth,n=e.today,o=t||r||n||new Date,l=e.toDate,d=e.fromDate,i=e.numberOfMonths,g=i===void 0?1:i;if(l&&z0(l,o)<0){var _=-1*(g-1);o=Cd(l,_)}return d&&z0(o,d)<0&&(o=d),Tc(o)}function uQe(){var e=Ja(),t=cQe(e),r=lQe(t,e.month),n=r[0],o=r[1],l=function(d){var i;if(!e.disableNavigation){var g=Tc(d);o(g),(i=e.onMonthChange)===null||i===void 0||i.call(e,g)}};return[n,l]}function dQe(e,t){for(var r=t.reverseMonths,n=t.numberOfMonths,o=Tc(e),l=Tc(Cd(o,n)),d=z0(l,o),i=[],g=0;g<d;g++){var _=Cd(o,g);i.push(_)}return r&&(i=i.reverse()),i}function hQe(e,t){if(!t.disableNavigation){var r=t.toDate,n=t.pagedNavigation,o=t.numberOfMonths,l=o===void 0?1:o,d=n?l:1,i=Tc(e);if(!r)return Cd(i,d);var g=z0(r,e);if(!(g<l))return Cd(i,d)}}function fQe(e,t){if(!t.disableNavigation){var r=t.fromDate,n=t.pagedNavigation,o=t.numberOfMonths,l=o===void 0?1:o,d=n?l:1,i=Tc(e);if(!r)return Cd(i,-d);var g=z0(i,r);if(!(g<=0))return Cd(i,-d)}}var qce=W.createContext(void 0);function pQe(e){var t=Ja(),r=uQe(),n=r[0],o=r[1],l=dQe(n,t),d=hQe(n,t),i=fQe(n,t),g=function(E){return l.some(function(T){return x4(E,T)})},_=function(E,T){g(E)||(T&&Xre(E,T)?o(Cd(E,1+t.numberOfMonths*-1)):o(E))},S={currentMonth:n,displayMonths:l,goToMonth:o,goToDate:_,previousMonth:i,nextMonth:d,isDateDisplayed:g};return m.jsx(qce.Provider,{value:S,children:e.children})}function c2(){var e=W.useContext(qce);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function KK(e){var t,r=Ja(),n=r.classNames,o=r.styles,l=r.components,d=c2().goToMonth,i=function(S){d(Cd(S,e.displayIndex?-e.displayIndex:0))},g=(t=l==null?void 0:l.CaptionLabel)!==null&&t!==void 0?t:Uce,_=m.jsx(g,{id:e.id,displayMonth:e.displayMonth});return m.jsxs("div",{className:n.caption_dropdowns,style:o.caption_dropdowns,children:[m.jsx("div",{className:n.vhidden,children:_}),m.jsx(oQe,{onChange:i,displayMonth:e.displayMonth}),m.jsx(sQe,{onChange:i,displayMonth:e.displayMonth})]})}function mQe(e){return m.jsx("svg",ai({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:m.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function gQe(e){return m.jsx("svg",ai({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:m.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var Fk=W.forwardRef(function(e,t){var r=Ja(),n=r.classNames,o=r.styles,l=[n.button_reset,n.button];e.className&&l.push(e.className);var d=l.join(" "),i=ai(ai({},o.button_reset),o.button);return e.style&&Object.assign(i,e.style),m.jsx("button",ai({},e,{ref:t,type:"button",className:d,style:i}))});function yQe(e){var t,r,n=Ja(),o=n.dir,l=n.locale,d=n.classNames,i=n.styles,g=n.labels,_=g.labelPrevious,S=g.labelNext,E=n.components;if(!e.nextMonth&&!e.previousMonth)return m.jsx(m.Fragment,{});var T=_(e.previousMonth,{locale:l}),C=[d.nav_button,d.nav_button_previous].join(" "),N=S(e.nextMonth,{locale:l}),I=[d.nav_button,d.nav_button_next].join(" "),j=(t=E==null?void 0:E.IconRight)!==null&&t!==void 0?t:gQe,D=(r=E==null?void 0:E.IconLeft)!==null&&r!==void 0?r:mQe;return m.jsxs("div",{className:d.nav,style:i.nav,children:[!e.hidePrevious&&m.jsx(Fk,{name:"previous-month","aria-label":T,className:C,style:i.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:o==="rtl"?m.jsx(j,{className:d.nav_icon,style:i.nav_icon}):m.jsx(D,{className:d.nav_icon,style:i.nav_icon})}),!e.hideNext&&m.jsx(Fk,{name:"next-month","aria-label":N,className:I,style:i.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:o==="rtl"?m.jsx(D,{className:d.nav_icon,style:i.nav_icon}):m.jsx(j,{className:d.nav_icon,style:i.nav_icon})})]})}function ZK(e){var t=Ja().numberOfMonths,r=c2(),n=r.previousMonth,o=r.nextMonth,l=r.goToMonth,d=r.displayMonths,i=d.findIndex(function(N){return x4(e.displayMonth,N)}),g=i===0,_=i===d.length-1,S=t>1&&(g||!_),E=t>1&&(_||!g),T=function(){n&&l(n)},C=function(){o&&l(o)};return m.jsx(yQe,{displayMonth:e.displayMonth,hideNext:S,hidePrevious:E,nextMonth:o,previousMonth:n,onPreviousClick:T,onNextClick:C})}function vQe(e){var t,r=Ja(),n=r.classNames,o=r.disableNavigation,l=r.styles,d=r.captionLayout,i=r.components,g=(t=i==null?void 0:i.CaptionLabel)!==null&&t!==void 0?t:Uce,_;return o?_=m.jsx(g,{id:e.id,displayMonth:e.displayMonth}):d==="dropdown"?_=m.jsx(KK,{displayMonth:e.displayMonth,id:e.id}):d==="dropdown-buttons"?_=m.jsxs(m.Fragment,{children:[m.jsx(KK,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),m.jsx(ZK,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):_=m.jsxs(m.Fragment,{children:[m.jsx(g,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),m.jsx(ZK,{displayMonth:e.displayMonth,id:e.id})]}),m.jsx("div",{className:n.caption,style:l.caption,children:_})}function _Qe(e){var t=Ja(),r=t.footer,n=t.styles,o=t.classNames.tfoot;return r?m.jsx("tfoot",{className:o,style:n.tfoot,children:m.jsx("tr",{children:m.jsx("td",{colSpan:8,children:r})})}):m.jsx(m.Fragment,{})}function xQe(e,t,r){for(var n=r?pv(new Date):Ph(new Date,{locale:e,weekStartsOn:t}),o=[],l=0;l<7;l++){var d=Fl(n,l);o.push(d)}return o}function bQe(){var e=Ja(),t=e.classNames,r=e.styles,n=e.showWeekNumber,o=e.locale,l=e.weekStartsOn,d=e.ISOWeek,i=e.formatters.formatWeekdayName,g=e.labels.labelWeekday,_=xQe(o,l,d);return m.jsxs("tr",{style:r.head_row,className:t.head_row,children:[n&&m.jsx("td",{style:r.head_cell,className:t.head_cell}),_.map(function(S,E){return m.jsx("th",{scope:"col",className:t.head_cell,style:r.head_cell,"aria-label":g(S,{locale:o}),children:i(S,{locale:o})},E)})]})}function wQe(){var e,t=Ja(),r=t.classNames,n=t.styles,o=t.components,l=(e=o==null?void 0:o.HeadRow)!==null&&e!==void 0?e:bQe;return m.jsx("thead",{style:n.head,className:r.head,children:m.jsx(l,{})})}function SQe(e){var t=Ja(),r=t.locale,n=t.formatters.formatDay;return m.jsx(m.Fragment,{children:n(e.date,{locale:r})})}var r$=W.createContext(void 0);function EQe(e){if(!s2(e.initialProps)){var t={selected:void 0,modifiers:{disabled:[]}};return m.jsx(r$.Provider,{value:t,children:e.children})}return m.jsx(TQe,{initialProps:e.initialProps,children:e.children})}function TQe(e){var t=e.initialProps,r=e.children,n=t.selected,o=t.min,l=t.max,d=function(_,S,E){var T,C;(T=t.onDayClick)===null||T===void 0||T.call(t,_,S,E);var N=!!(S.selected&&o&&(n==null?void 0:n.length)===o);if(!N){var I=!!(!S.selected&&l&&(n==null?void 0:n.length)===l);if(!I){var j=n?Bce([],n):[];if(S.selected){var D=j.findIndex(function(R){return vc(_,R)});j.splice(D,1)}else j.push(_);(C=t.onSelect)===null||C===void 0||C.call(t,j,_,S,E)}}},i={disabled:[]};n&&i.disabled.push(function(_){var S=l&&n.length>l-1,E=n.some(function(T){return vc(T,_)});return!!(S&&!E)});var g={selected:n,onDayClick:d,modifiers:i};return m.jsx(r$.Provider,{value:g,children:r})}function n$(){var e=W.useContext(r$);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}function AQe(e,t){var r=t||{},n=r.from,o=r.to;return n&&o?vc(o,e)&&vc(n,e)?void 0:vc(o,e)?{from:o,to:void 0}:vc(n,e)?void 0:E3(n,e)?{from:e,to:o}:{from:n,to:e}:o?E3(e,o)?{from:o,to:e}:{from:e,to:o}:n?Xre(e,n)?{from:e,to:n}:{from:n,to:e}:{from:e,to:void 0}}var i$=W.createContext(void 0);function PQe(e){if(!l2(e.initialProps)){var t={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return m.jsx(i$.Provider,{value:t,children:e.children})}return m.jsx(CQe,{initialProps:e.initialProps,children:e.children})}function CQe(e){var t=e.initialProps,r=e.children,n=t.selected,o=n||{},l=o.from,d=o.to,i=t.min,g=t.max,_=function(C,N,I){var j,D;(j=t.onDayClick)===null||j===void 0||j.call(t,C,N,I);var R=AQe(C,n);(D=t.onSelect)===null||D===void 0||D.call(t,R,C,N,I)},S={range_start:[],range_end:[],range_middle:[],disabled:[]};if(l?(S.range_start=[l],d?(S.range_end=[d],vc(l,d)||(S.range_middle=[{after:l,before:d}])):S.range_end=[l]):d&&(S.range_start=[d],S.range_end=[d]),i&&(l&&!d&&S.disabled.push({after:bC(l,i-1),before:Fl(l,i-1)}),l&&d&&S.disabled.push({after:l,before:Fl(l,i-1)}),!l&&d&&S.disabled.push({after:bC(d,i-1),before:Fl(d,i-1)})),g){if(l&&!d&&(S.disabled.push({before:Fl(l,-g+1)}),S.disabled.push({after:Fl(l,g-1)})),l&&d){var E=fh(d,l)+1,T=g-E;S.disabled.push({before:bC(l,T)}),S.disabled.push({after:Fl(d,T)})}!l&&d&&(S.disabled.push({before:Fl(d,-g+1)}),S.disabled.push({after:Fl(d,g-1)}))}return m.jsx(i$.Provider,{value:{selected:n,onDayClick:_,modifiers:S},children:r})}function a$(){var e=W.useContext(i$);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function kC(e){return Array.isArray(e)?Bce([],e):e!==void 0?[e]:[]}function OQe(e){var t={};return Object.entries(e).forEach(function(r){var n=r[0],o=r[1];t[n]=kC(o)}),t}var Od;(function(e){e.Outside="outside",e.Disabled="disabled",e.Selected="selected",e.Hidden="hidden",e.Today="today",e.RangeStart="range_start",e.RangeEnd="range_end",e.RangeMiddle="range_middle"})(Od||(Od={}));var kQe=Od.Selected,df=Od.Disabled,IQe=Od.Hidden,RQe=Od.Today,CD=Od.RangeEnd,OD=Od.RangeMiddle,kD=Od.RangeStart,jQe=Od.Outside;function NQe(e,t,r){var n,o=(n={},n[kQe]=kC(e.selected),n[df]=kC(e.disabled),n[IQe]=kC(e.hidden),n[RQe]=[e.today],n[CD]=[],n[OD]=[],n[kD]=[],n[jQe]=[],n);return e.fromDate&&o[df].push({before:e.fromDate}),e.toDate&&o[df].push({after:e.toDate}),s2(e)?o[df]=o[df].concat(t.modifiers[df]):l2(e)&&(o[df]=o[df].concat(r.modifiers[df]),o[kD]=r.modifiers[kD],o[OD]=r.modifiers[OD],o[CD]=r.modifiers[CD]),o}var Wce=W.createContext(void 0);function MQe(e){var t=Ja(),r=n$(),n=a$(),o=NQe(t,r,n),l=OQe(t.modifiers),d=ai(ai({},o),l);return m.jsx(Wce.Provider,{value:d,children:e.children})}function Gce(){var e=W.useContext(Wce);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function DQe(e){return!!(e&&typeof e=="object"&&"before"in e&&"after"in e)}function LQe(e){return!!(e&&typeof e=="object"&&"from"in e)}function FQe(e){return!!(e&&typeof e=="object"&&"after"in e)}function zQe(e){return!!(e&&typeof e=="object"&&"before"in e)}function BQe(e){return!!(e&&typeof e=="object"&&"dayOfWeek"in e)}function $Qe(e,t){var r,n=t.from,o=t.to;if(n&&o){var l=fh(o,n)<0;l&&(r=[o,n],n=r[0],o=r[1]);var d=fh(e,n)>=0&&fh(o,e)>=0;return d}return o?vc(o,e):n?vc(n,e):!1}function UQe(e){return y4(e)}function VQe(e){return Array.isArray(e)&&e.every(y4)}function qQe(e,t){return t.some(function(r){if(typeof r=="boolean")return r;if(UQe(r))return vc(e,r);if(VQe(r))return r.includes(e);if(LQe(r))return $Qe(e,r);if(BQe(r))return r.dayOfWeek.includes(e.getDay());if(DQe(r)){var n=fh(r.before,e),o=fh(r.after,e),l=n>0,d=o<0,i=E3(r.before,r.after);return i?d&&l:l||d}return FQe(r)?fh(e,r.after)>0:zQe(r)?fh(r.before,e)>0:typeof r=="function"?r(e):!1})}function o$(e,t,r){var n=Object.keys(t).reduce(function(l,d){var i=t[d];return qQe(e,i)&&l.push(d),l},[]),o={};return n.forEach(function(l){return o[l]=!0}),r&&!x4(e,r)&&(o.outside=!0),o}function WQe(e,t){for(var r=Tc(e[0]),n=MI(e[e.length-1]),o,l,d=r;d<=n;){var i=o$(d,t),g=!i.disabled&&!i.hidden;if(!g){d=Fl(d,1);continue}if(i.selected)return d;i.today&&!l&&(l=d),o||(o=d),d=Fl(d,1)}return l||o}var GQe=365;function Hce(e,t){var r=t.moveBy,n=t.direction,o=t.context,l=t.modifiers,d=t.retry,i=d===void 0?{count:0,lastFocused:e}:d,g=o.weekStartsOn,_=o.fromDate,S=o.toDate,E=o.locale,T={day:Fl,week:S3,month:Cd,year:D2e,startOfWeek:function(j){return o.ISOWeek?pv(j):Ph(j,{locale:E,weekStartsOn:g})},endOfWeek:function(j){return o.ISOWeek?Wre(j):v4(j,{locale:E,weekStartsOn:g})}},C=T[r](e,n==="after"?1:-1);n==="before"&&_?C=L2e([_,C]):n==="after"&&S&&(C=F2e([S,C]));var N=!0;if(l){var I=o$(C,l);N=!I.disabled&&!I.hidden}return N?C:i.count>GQe?i.lastFocused:Hce(C,{moveBy:r,direction:n,context:o,modifiers:l,retry:ai(ai({},i),{count:i.count+1})})}var Kce=W.createContext(void 0);function HQe(e){var t=c2(),r=Gce(),n=W.useState(),o=n[0],l=n[1],d=W.useState(),i=d[0],g=d[1],_=WQe(t.displayMonths,r),S=o??(i&&t.isDateDisplayed(i))?i:_,E=function(){g(o),l(void 0)},T=function(j){l(j)},C=Ja(),N=function(j,D){if(o){var R=Hce(o,{moveBy:j,direction:D,context:C,modifiers:r});vc(o,R)||(t.goToDate(R,o),T(R))}},I={focusedDay:o,focusTarget:S,blur:E,focus:T,focusDayAfter:function(){return N("day","after")},focusDayBefore:function(){return N("day","before")},focusWeekAfter:function(){return N("week","after")},focusWeekBefore:function(){return N("week","before")},focusMonthBefore:function(){return N("month","before")},focusMonthAfter:function(){return N("month","after")},focusYearBefore:function(){return N("year","before")},focusYearAfter:function(){return N("year","after")},focusStartOfWeek:function(){return N("startOfWeek","before")},focusEndOfWeek:function(){return N("endOfWeek","after")}};return m.jsx(Kce.Provider,{value:I,children:e.children})}function s$(){var e=W.useContext(Kce);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}function KQe(e,t){var r=Gce(),n=o$(e,r,t);return n}var l$=W.createContext(void 0);function ZQe(e){if(!VR(e.initialProps)){var t={selected:void 0};return m.jsx(l$.Provider,{value:t,children:e.children})}return m.jsx(XQe,{initialProps:e.initialProps,children:e.children})}function XQe(e){var t=e.initialProps,r=e.children,n=function(l,d,i){var g,_,S;if((g=t.onDayClick)===null||g===void 0||g.call(t,l,d,i),d.selected&&!t.required){(_=t.onSelect)===null||_===void 0||_.call(t,void 0,l,d,i);return}(S=t.onSelect)===null||S===void 0||S.call(t,l,l,d,i)},o={selected:t.selected,onDayClick:n};return m.jsx(l$.Provider,{value:o,children:r})}function Zce(){var e=W.useContext(l$);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function YQe(e,t){var r=Ja(),n=Zce(),o=n$(),l=a$(),d=s$(),i=d.focusDayAfter,g=d.focusDayBefore,_=d.focusWeekAfter,S=d.focusWeekBefore,E=d.blur,T=d.focus,C=d.focusMonthBefore,N=d.focusMonthAfter,I=d.focusYearBefore,j=d.focusYearAfter,D=d.focusStartOfWeek,R=d.focusEndOfWeek,F=function(Ae){var Ce,me,Pe,ye;VR(r)?(Ce=n.onDayClick)===null||Ce===void 0||Ce.call(n,e,t,Ae):s2(r)?(me=o.onDayClick)===null||me===void 0||me.call(o,e,t,Ae):l2(r)?(Pe=l.onDayClick)===null||Pe===void 0||Pe.call(l,e,t,Ae):(ye=r.onDayClick)===null||ye===void 0||ye.call(r,e,t,Ae)},B=function(Ae){var Ce;T(e),(Ce=r.onDayFocus)===null||Ce===void 0||Ce.call(r,e,t,Ae)},U=function(Ae){var Ce;E(),(Ce=r.onDayBlur)===null||Ce===void 0||Ce.call(r,e,t,Ae)},Z=function(Ae){var Ce;(Ce=r.onDayMouseEnter)===null||Ce===void 0||Ce.call(r,e,t,Ae)},J=function(Ae){var Ce;(Ce=r.onDayMouseLeave)===null||Ce===void 0||Ce.call(r,e,t,Ae)},te=function(Ae){var Ce;(Ce=r.onDayPointerEnter)===null||Ce===void 0||Ce.call(r,e,t,Ae)},ae=function(Ae){var Ce;(Ce=r.onDayPointerLeave)===null||Ce===void 0||Ce.call(r,e,t,Ae)},ne=function(Ae){var Ce;(Ce=r.onDayTouchCancel)===null||Ce===void 0||Ce.call(r,e,t,Ae)},ie=function(Ae){var Ce;(Ce=r.onDayTouchEnd)===null||Ce===void 0||Ce.call(r,e,t,Ae)},ee=function(Ae){var Ce;(Ce=r.onDayTouchMove)===null||Ce===void 0||Ce.call(r,e,t,Ae)},oe=function(Ae){var Ce;(Ce=r.onDayTouchStart)===null||Ce===void 0||Ce.call(r,e,t,Ae)},de=function(Ae){var Ce;(Ce=r.onDayKeyUp)===null||Ce===void 0||Ce.call(r,e,t,Ae)},xe=function(Ae){var Ce;switch(Ae.key){case"ArrowLeft":Ae.preventDefault(),Ae.stopPropagation(),r.dir==="rtl"?i():g();break;case"ArrowRight":Ae.preventDefault(),Ae.stopPropagation(),r.dir==="rtl"?g():i();break;case"ArrowDown":Ae.preventDefault(),Ae.stopPropagation(),_();break;case"ArrowUp":Ae.preventDefault(),Ae.stopPropagation(),S();break;case"PageUp":Ae.preventDefault(),Ae.stopPropagation(),Ae.shiftKey?I():C();break;case"PageDown":Ae.preventDefault(),Ae.stopPropagation(),Ae.shiftKey?j():N();break;case"Home":Ae.preventDefault(),Ae.stopPropagation(),D();break;case"End":Ae.preventDefault(),Ae.stopPropagation(),R();break}(Ce=r.onDayKeyDown)===null||Ce===void 0||Ce.call(r,e,t,Ae)},we={onClick:F,onFocus:B,onBlur:U,onKeyDown:xe,onKeyUp:de,onMouseEnter:Z,onMouseLeave:J,onPointerEnter:te,onPointerLeave:ae,onTouchCancel:ne,onTouchEnd:ie,onTouchMove:ee,onTouchStart:oe};return we}function JQe(){var e=Ja(),t=Zce(),r=n$(),n=a$(),o=VR(e)?t.selected:s2(e)?r.selected:l2(e)?n.selected:void 0;return o}function QQe(e){return Object.values(Od).includes(e)}function eet(e,t){var r=[e.classNames.day];return Object.keys(t).forEach(function(n){var o=e.modifiersClassNames[n];if(o)r.push(o);else if(QQe(n)){var l=e.classNames["day_".concat(n)];l&&r.push(l)}}),r}function tet(e,t){var r=ai({},e.styles.day);return Object.keys(t).forEach(function(n){var o;r=ai(ai({},r),(o=e.modifiersStyles)===null||o===void 0?void 0:o[n])}),r}function ret(e,t,r){var n,o,l,d=Ja(),i=s$(),g=KQe(e,t),_=YQe(e,g),S=JQe(),E=!!(d.onDayClick||d.mode!=="default");W.useEffect(function(){var Z;g.outside||i.focusedDay&&E&&vc(i.focusedDay,e)&&((Z=r.current)===null||Z===void 0||Z.focus())},[i.focusedDay,e,r,E,g.outside]);var T=eet(d,g).join(" "),C=tet(d,g),N=!!(g.outside&&!d.showOutsideDays||g.hidden),I=(l=(o=d.components)===null||o===void 0?void 0:o.DayContent)!==null&&l!==void 0?l:SQe,j=m.jsx(I,{date:e,displayMonth:t,activeModifiers:g}),D={style:C,className:T,children:j,role:"gridcell"},R=i.focusTarget&&vc(i.focusTarget,e)&&!g.outside,F=i.focusedDay&&vc(i.focusedDay,e),B=ai(ai(ai({},D),(n={disabled:g.disabled,role:"gridcell"},n["aria-selected"]=g.selected,n.tabIndex=F||R?0:-1,n)),_),U={isButton:E,isHidden:N,activeModifiers:g,selectedDays:S,buttonProps:B,divProps:D};return U}function net(e){var t=W.useRef(null),r=ret(e.date,e.displayMonth,t);return r.isHidden?m.jsx("div",{role:"gridcell"}):r.isButton?m.jsx(Fk,ai({name:"day",ref:t},r.buttonProps)):m.jsx("div",ai({},r.divProps))}function iet(e){var t=e.number,r=e.dates,n=Ja(),o=n.onWeekNumberClick,l=n.styles,d=n.classNames,i=n.locale,g=n.labels.labelWeekNumber,_=n.formatters.formatWeekNumber,S=_(Number(t),{locale:i});if(!o)return m.jsx("span",{className:d.weeknumber,style:l.weeknumber,children:S});var E=g(Number(t),{locale:i}),T=function(C){o(t,r,C)};return m.jsx(Fk,{name:"week-number","aria-label":E,className:d.weeknumber,style:l.weeknumber,onClick:T,children:S})}function aet(e){var t,r,n=Ja(),o=n.styles,l=n.classNames,d=n.showWeekNumber,i=n.components,g=(t=i==null?void 0:i.Day)!==null&&t!==void 0?t:net,_=(r=i==null?void 0:i.WeekNumber)!==null&&r!==void 0?r:iet,S;return d&&(S=m.jsx("td",{className:l.cell,style:o.cell,children:m.jsx(_,{number:e.weekNumber,dates:e.dates})})),m.jsxs("tr",{className:l.row,style:o.row,children:[S,e.dates.map(function(E){return m.jsx("td",{className:l.cell,style:o.cell,role:"presentation",children:m.jsx(g,{displayMonth:e.displayMonth,date:E})},WAe(E))})]})}function XK(e,t,r){for(var n=r!=null&&r.ISOWeek?Wre(t):v4(t,r),o=r!=null&&r.ISOWeek?pv(e):Ph(e,r),l=fh(n,o),d=[],i=0;i<=l;i++)d.push(Fl(o,i));var g=d.reduce(function(_,S){var E=r!=null&&r.ISOWeek?Gre(S):Kre(S,r),T=_.find(function(C){return C.weekNumber===E});return T?(T.dates.push(S),_):(_.push({weekNumber:E,dates:[S]}),_)},[]);return g}function oet(e,t){var r=XK(Tc(e),MI(e),t);if(t!=null&&t.useFixedWeeks){var n=HAe(e,t);if(n<6){var o=r[r.length-1],l=o.dates[o.dates.length-1],d=S3(l,6-n),i=XK(S3(l,1),d,t);r.push.apply(r,i)}}return r}function set(e){var t,r,n,o=Ja(),l=o.locale,d=o.classNames,i=o.styles,g=o.hideHead,_=o.fixedWeeks,S=o.components,E=o.weekStartsOn,T=o.firstWeekContainsDate,C=o.ISOWeek,N=oet(e.displayMonth,{useFixedWeeks:!!_,ISOWeek:C,locale:l,weekStartsOn:E,firstWeekContainsDate:T}),I=(t=S==null?void 0:S.Head)!==null&&t!==void 0?t:wQe,j=(r=S==null?void 0:S.Row)!==null&&r!==void 0?r:aet,D=(n=S==null?void 0:S.Footer)!==null&&n!==void 0?n:_Qe;return m.jsxs("table",{id:e.id,className:d.table,style:i.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!g&&m.jsx(I,{}),m.jsx("tbody",{className:d.tbody,style:i.tbody,children:N.map(function(R){return m.jsx(j,{displayMonth:e.displayMonth,dates:R.dates,weekNumber:R.weekNumber},R.weekNumber)})}),m.jsx(D,{displayMonth:e.displayMonth})]})}function cet(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var uet=cet()?W.useLayoutEffect:W.useEffect,ID=!1,det=0;function YK(){return"react-day-picker-".concat(++det)}function het(e){var t,r=e??(ID?YK():null),n=W.useState(r),o=n[0],l=n[1];return uet(function(){o===null&&l(YK())},[]),W.useEffect(function(){ID===!1&&(ID=!0)},[]),(t=e??o)!==null&&t!==void 0?t:void 0}function fet(e){var t,r,n=Ja(),o=n.dir,l=n.classNames,d=n.styles,i=n.components,g=c2().displayMonths,_=het(n.id?"".concat(n.id,"-").concat(e.displayIndex):void 0),S=n.id?"".concat(n.id,"-grid-").concat(e.displayIndex):void 0,E=[l.month],T=d.month,C=e.displayIndex===0,N=e.displayIndex===g.length-1,I=!C&&!N;o==="rtl"&&(t=[C,N],N=t[0],C=t[1]),C&&(E.push(l.caption_start),T=ai(ai({},T),d.caption_start)),N&&(E.push(l.caption_end),T=ai(ai({},T),d.caption_end)),I&&(E.push(l.caption_between),T=ai(ai({},T),d.caption_between));var j=(r=i==null?void 0:i.Caption)!==null&&r!==void 0?r:vQe;return m.jsxs("div",{className:E.join(" "),style:T,children:[m.jsx(j,{id:_,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),m.jsx(set,{id:S,"aria-labelledby":_,displayMonth:e.displayMonth})]},e.displayIndex)}function pet(e){var t=Ja(),r=t.classNames,n=t.styles;return m.jsx("div",{className:r.months,style:n.months,children:e.children})}function met(e){var t,r,n=e.initialProps,o=Ja(),l=s$(),d=c2(),i=W.useState(!1),g=i[0],_=i[1];W.useEffect(function(){o.initialFocus&&l.focusTarget&&(g||(l.focus(l.focusTarget),_(!0)))},[o.initialFocus,g,l.focus,l.focusTarget,l]);var S=[o.classNames.root,o.className];o.numberOfMonths>1&&S.push(o.classNames.multiple_months),o.showWeekNumber&&S.push(o.classNames.with_weeknumber);var E=ai(ai({},o.styles.root),o.style),T=Object.keys(n).filter(function(N){return N.startsWith("data-")}).reduce(function(N,I){var j;return ai(ai({},N),(j={},j[I]=n[I],j))},{}),C=(r=(t=n.components)===null||t===void 0?void 0:t.Months)!==null&&r!==void 0?r:pet;return m.jsx("div",ai({className:S.join(" "),style:E,dir:o.dir,id:o.id,nonce:n.nonce,title:n.title,lang:n.lang},T,{children:m.jsx(C,{children:d.displayMonths.map(function(N,I){return m.jsx(fet,{displayIndex:I,displayMonth:N},I)})})}))}function get(e){var t=e.children,r=zJe(e,["children"]);return m.jsx(iQe,{initialProps:r,children:m.jsx(pQe,{children:m.jsx(ZQe,{initialProps:r,children:m.jsx(EQe,{initialProps:r,children:m.jsx(PQe,{initialProps:r,children:m.jsx(MQe,{children:m.jsx(HQe,{children:t})})})})})})})}function yet(e){return m.jsx(get,ai({},e,{children:m.jsx(met,{initialProps:e})}))}function fz({className:e,classNames:t,showOutsideDays:r=!0,...n}){return m.jsx(yet,{showOutsideDays:r,className:yr("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:yr(M0({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:yr(M0({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...o})=>m.jsx(oI,{className:"h-4 w-4"}),IconRight:({...o})=>m.jsx(pB,{className:"h-4 w-4"})},...n})}fz.displayName="Calendar";var Xce={exports:{}};/*!
 * Quill Editor v1.3.7
 * https://quilljs.com/
 * Copyright (c) 2014, Jason Chen
 * Copyright (c) 2013, salesforce.com
 */(function(e,t){(function(n,o){e.exports=o()})(typeof self<"u"?self:gc,function(){return function(r){var n={};function o(l){if(n[l])return n[l].exports;var d=n[l]={i:l,l:!1,exports:{}};return r[l].call(d.exports,d,d.exports,o),d.l=!0,d.exports}return o.m=r,o.c=n,o.d=function(l,d,i){o.o(l,d)||Object.defineProperty(l,d,{configurable:!1,enumerable:!0,get:i})},o.n=function(l){var d=l&&l.__esModule?function(){return l.default}:function(){return l};return o.d(d,"a",d),d},o.o=function(l,d){return Object.prototype.hasOwnProperty.call(l,d)},o.p="",o(o.s=109)}([function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(17),d=o(18),i=o(19),g=o(45),_=o(46),S=o(47),E=o(48),T=o(49),C=o(12),N=o(32),I=o(33),j=o(31),D=o(1),R={Scope:D.Scope,create:D.create,find:D.find,query:D.query,register:D.register,Container:l.default,Format:d.default,Leaf:i.default,Embed:E.default,Scroll:g.default,Block:S.default,Inline:_.default,Text:T.default,Attributor:{Attribute:C.default,Class:N.default,Style:I.default,Store:j.default}};n.default=R},function(r,n,o){var l=this&&this.__extends||function(){var j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,R){D.__proto__=R}||function(D,R){for(var F in R)R.hasOwnProperty(F)&&(D[F]=R[F])};return function(D,R){j(D,R);function F(){this.constructor=D}D.prototype=R===null?Object.create(R):(F.prototype=R.prototype,new F)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=function(j){l(D,j);function D(R){var F=this;return R="[Parchment] "+R,F=j.call(this,R)||this,F.message=R,F.name=F.constructor.name,F}return D}(Error);n.ParchmentError=d;var i={},g={},_={},S={};n.DATA_KEY="__blot";var E;(function(j){j[j.TYPE=3]="TYPE",j[j.LEVEL=12]="LEVEL",j[j.ATTRIBUTE=13]="ATTRIBUTE",j[j.BLOT=14]="BLOT",j[j.INLINE=7]="INLINE",j[j.BLOCK=11]="BLOCK",j[j.BLOCK_BLOT=10]="BLOCK_BLOT",j[j.INLINE_BLOT=6]="INLINE_BLOT",j[j.BLOCK_ATTRIBUTE=9]="BLOCK_ATTRIBUTE",j[j.INLINE_ATTRIBUTE=5]="INLINE_ATTRIBUTE",j[j.ANY=15]="ANY"})(E=n.Scope||(n.Scope={}));function T(j,D){var R=N(j);if(R==null)throw new d("Unable to create "+j+" blot");var F=R,B=j instanceof Node||j.nodeType===Node.TEXT_NODE?j:F.create(D);return new F(B,D)}n.create=T;function C(j,D){return D===void 0&&(D=!1),j==null?null:j[n.DATA_KEY]!=null?j[n.DATA_KEY].blot:D?C(j.parentNode,D):null}n.find=C;function N(j,D){D===void 0&&(D=E.ANY);var R;if(typeof j=="string")R=S[j]||i[j];else if(j instanceof Text||j.nodeType===Node.TEXT_NODE)R=S.text;else if(typeof j=="number")j&E.LEVEL&E.BLOCK?R=S.block:j&E.LEVEL&E.INLINE&&(R=S.inline);else if(j instanceof HTMLElement){var F=(j.getAttribute("class")||"").split(/\s+/);for(var B in F)if(R=g[F[B]],R)break;R=R||_[j.tagName]}return R==null?null:D&E.LEVEL&R.scope&&D&E.TYPE&R.scope?R:null}n.query=N;function I(){for(var j=[],D=0;D<arguments.length;D++)j[D]=arguments[D];if(j.length>1)return j.map(function(B){return I(B)});var R=j[0];if(typeof R.blotName!="string"&&typeof R.attrName!="string")throw new d("Invalid definition");if(R.blotName==="abstract")throw new d("Cannot register abstract class");if(S[R.blotName||R.attrName]=R,typeof R.keyName=="string")i[R.keyName]=R;else if(R.className!=null&&(g[R.className]=R),R.tagName!=null){Array.isArray(R.tagName)?R.tagName=R.tagName.map(function(B){return B.toUpperCase()}):R.tagName=R.tagName.toUpperCase();var F=Array.isArray(R.tagName)?R.tagName:[R.tagName];F.forEach(function(B){(_[B]==null||R.className==null)&&(_[B]=R)})}return R}n.register=I},function(r,n,o){var l=o(51),d=o(11),i=o(3),g=o(20),_="\0",S=function(E){Array.isArray(E)?this.ops=E:E!=null&&Array.isArray(E.ops)?this.ops=E.ops:this.ops=[]};S.prototype.insert=function(E,T){var C={};return E.length===0?this:(C.insert=E,T!=null&&typeof T=="object"&&Object.keys(T).length>0&&(C.attributes=T),this.push(C))},S.prototype.delete=function(E){return E<=0?this:this.push({delete:E})},S.prototype.retain=function(E,T){if(E<=0)return this;var C={retain:E};return T!=null&&typeof T=="object"&&Object.keys(T).length>0&&(C.attributes=T),this.push(C)},S.prototype.push=function(E){var T=this.ops.length,C=this.ops[T-1];if(E=i(!0,{},E),typeof C=="object"){if(typeof E.delete=="number"&&typeof C.delete=="number")return this.ops[T-1]={delete:C.delete+E.delete},this;if(typeof C.delete=="number"&&E.insert!=null&&(T-=1,C=this.ops[T-1],typeof C!="object"))return this.ops.unshift(E),this;if(d(E.attributes,C.attributes)){if(typeof E.insert=="string"&&typeof C.insert=="string")return this.ops[T-1]={insert:C.insert+E.insert},typeof E.attributes=="object"&&(this.ops[T-1].attributes=E.attributes),this;if(typeof E.retain=="number"&&typeof C.retain=="number")return this.ops[T-1]={retain:C.retain+E.retain},typeof E.attributes=="object"&&(this.ops[T-1].attributes=E.attributes),this}}return T===this.ops.length?this.ops.push(E):this.ops.splice(T,0,E),this},S.prototype.chop=function(){var E=this.ops[this.ops.length-1];return E&&E.retain&&!E.attributes&&this.ops.pop(),this},S.prototype.filter=function(E){return this.ops.filter(E)},S.prototype.forEach=function(E){this.ops.forEach(E)},S.prototype.map=function(E){return this.ops.map(E)},S.prototype.partition=function(E){var T=[],C=[];return this.forEach(function(N){var I=E(N)?T:C;I.push(N)}),[T,C]},S.prototype.reduce=function(E,T){return this.ops.reduce(E,T)},S.prototype.changeLength=function(){return this.reduce(function(E,T){return T.insert?E+g.length(T):T.delete?E-T.delete:E},0)},S.prototype.length=function(){return this.reduce(function(E,T){return E+g.length(T)},0)},S.prototype.slice=function(E,T){E=E||0,typeof T!="number"&&(T=1/0);for(var C=[],N=g.iterator(this.ops),I=0;I<T&&N.hasNext();){var j;I<E?j=N.next(E-I):(j=N.next(T-I),C.push(j)),I+=g.length(j)}return new S(C)},S.prototype.compose=function(E){var T=g.iterator(this.ops),C=g.iterator(E.ops),N=[],I=C.peek();if(I!=null&&typeof I.retain=="number"&&I.attributes==null){for(var j=I.retain;T.peekType()==="insert"&&T.peekLength()<=j;)j-=T.peekLength(),N.push(T.next());I.retain-j>0&&C.next(I.retain-j)}for(var D=new S(N);T.hasNext()||C.hasNext();)if(C.peekType()==="insert")D.push(C.next());else if(T.peekType()==="delete")D.push(T.next());else{var R=Math.min(T.peekLength(),C.peekLength()),F=T.next(R),B=C.next(R);if(typeof B.retain=="number"){var U={};typeof F.retain=="number"?U.retain=R:U.insert=F.insert;var Z=g.attributes.compose(F.attributes,B.attributes,typeof F.retain=="number");if(Z&&(U.attributes=Z),D.push(U),!C.hasNext()&&d(D.ops[D.ops.length-1],U)){var J=new S(T.rest());return D.concat(J).chop()}}else typeof B.delete=="number"&&typeof F.retain=="number"&&D.push(B)}return D.chop()},S.prototype.concat=function(E){var T=new S(this.ops.slice());return E.ops.length>0&&(T.push(E.ops[0]),T.ops=T.ops.concat(E.ops.slice(1))),T},S.prototype.diff=function(E,T){if(this.ops===E.ops)return new S;var C=[this,E].map(function(R){return R.map(function(F){if(F.insert!=null)return typeof F.insert=="string"?F.insert:_;var B=R===E?"on":"with";throw new Error("diff() called "+B+" non-document")}).join("")}),N=new S,I=l(C[0],C[1],T),j=g.iterator(this.ops),D=g.iterator(E.ops);return I.forEach(function(R){for(var F=R[1].length;F>0;){var B=0;switch(R[0]){case l.INSERT:B=Math.min(D.peekLength(),F),N.push(D.next(B));break;case l.DELETE:B=Math.min(F,j.peekLength()),j.next(B),N.delete(B);break;case l.EQUAL:B=Math.min(j.peekLength(),D.peekLength(),F);var U=j.next(B),Z=D.next(B);d(U.insert,Z.insert)?N.retain(B,g.attributes.diff(U.attributes,Z.attributes)):N.push(Z).delete(B);break}F-=B}}),N.chop()},S.prototype.eachLine=function(E,T){T=T||`
`;for(var C=g.iterator(this.ops),N=new S,I=0;C.hasNext();){if(C.peekType()!=="insert")return;var j=C.peek(),D=g.length(j)-C.peekLength(),R=typeof j.insert=="string"?j.insert.indexOf(T,D)-D:-1;if(R<0)N.push(C.next());else if(R>0)N.push(C.next(R));else{if(E(N,C.next(1).attributes||{},I)===!1)return;I+=1,N=new S}}N.length()>0&&E(N,{},I)},S.prototype.transform=function(E,T){if(T=!!T,typeof E=="number")return this.transformPosition(E,T);for(var C=g.iterator(this.ops),N=g.iterator(E.ops),I=new S;C.hasNext()||N.hasNext();)if(C.peekType()==="insert"&&(T||N.peekType()!=="insert"))I.retain(g.length(C.next()));else if(N.peekType()==="insert")I.push(N.next());else{var j=Math.min(C.peekLength(),N.peekLength()),D=C.next(j),R=N.next(j);if(D.delete)continue;R.delete?I.push(R):I.retain(j,g.attributes.transform(D.attributes,R.attributes,T))}return I.chop()},S.prototype.transformPosition=function(E,T){T=!!T;for(var C=g.iterator(this.ops),N=0;C.hasNext()&&N<=E;){var I=C.peekLength(),j=C.peekType();if(C.next(),j==="delete"){E-=Math.min(I,E-N);continue}else j==="insert"&&(N<E||!T)&&(E+=I);N+=I}return E},r.exports=S},function(r,n){var o=Object.prototype.hasOwnProperty,l=Object.prototype.toString,d=Object.defineProperty,i=Object.getOwnPropertyDescriptor,g=function(C){return typeof Array.isArray=="function"?Array.isArray(C):l.call(C)==="[object Array]"},_=function(C){if(!C||l.call(C)!=="[object Object]")return!1;var N=o.call(C,"constructor"),I=C.constructor&&C.constructor.prototype&&o.call(C.constructor.prototype,"isPrototypeOf");if(C.constructor&&!N&&!I)return!1;var j;for(j in C);return typeof j>"u"||o.call(C,j)},S=function(C,N){d&&N.name==="__proto__"?d(C,N.name,{enumerable:!0,configurable:!0,value:N.newValue,writable:!0}):C[N.name]=N.newValue},E=function(C,N){if(N==="__proto__")if(o.call(C,N)){if(i)return i(C,N).value}else return;return C[N]};r.exports=function T(){var C,N,I,j,D,R,F=arguments[0],B=1,U=arguments.length,Z=!1;for(typeof F=="boolean"&&(Z=F,F=arguments[1]||{},B=2),(F==null||typeof F!="object"&&typeof F!="function")&&(F={});B<U;++B)if(C=arguments[B],C!=null)for(N in C)I=E(F,N),j=E(C,N),F!==j&&(Z&&j&&(_(j)||(D=g(j)))?(D?(D=!1,R=I&&g(I)?I:[]):R=I&&_(I)?I:{},S(F,{name:N,newValue:T(Z,R,j)})):typeof j<"u"&&S(F,{name:N,newValue:j}));return F}},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.BlockEmbed=n.bubbleFormats=void 0;var l=function(){function ie(ee,oe){for(var de=0;de<oe.length;de++){var xe=oe[de];xe.enumerable=xe.enumerable||!1,xe.configurable=!0,"value"in xe&&(xe.writable=!0),Object.defineProperty(ee,xe.key,xe)}}return function(ee,oe,de){return oe&&ie(ee.prototype,oe),de&&ie(ee,de),ee}}(),d=function ie(ee,oe,de){ee===null&&(ee=Function.prototype);var xe=Object.getOwnPropertyDescriptor(ee,oe);if(xe===void 0){var we=Object.getPrototypeOf(ee);return we===null?void 0:ie(we,oe,de)}else{if("value"in xe)return xe.value;var Ae=xe.get;return Ae===void 0?void 0:Ae.call(de)}},i=o(3),g=F(i),_=o(2),S=F(_),E=o(0),T=F(E),C=o(16),N=F(C),I=o(6),j=F(I),D=o(7),R=F(D);function F(ie){return ie&&ie.__esModule?ie:{default:ie}}function B(ie,ee){if(!(ie instanceof ee))throw new TypeError("Cannot call a class as a function")}function U(ie,ee){if(!ie)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ee&&(typeof ee=="object"||typeof ee=="function")?ee:ie}function Z(ie,ee){if(typeof ee!="function"&&ee!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof ee);ie.prototype=Object.create(ee&&ee.prototype,{constructor:{value:ie,enumerable:!1,writable:!0,configurable:!0}}),ee&&(Object.setPrototypeOf?Object.setPrototypeOf(ie,ee):ie.__proto__=ee)}var J=1,te=function(ie){Z(ee,ie);function ee(){return B(this,ee),U(this,(ee.__proto__||Object.getPrototypeOf(ee)).apply(this,arguments))}return l(ee,[{key:"attach",value:function(){d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"attach",this).call(this),this.attributes=new T.default.Attributor.Store(this.domNode)}},{key:"delta",value:function(){return new S.default().insert(this.value(),(0,g.default)(this.formats(),this.attributes.values()))}},{key:"format",value:function(de,xe){var we=T.default.query(de,T.default.Scope.BLOCK_ATTRIBUTE);we!=null&&this.attributes.attribute(we,xe)}},{key:"formatAt",value:function(de,xe,we,Ae){this.format(we,Ae)}},{key:"insertAt",value:function(de,xe,we){if(typeof xe=="string"&&xe.endsWith(`
`)){var Ae=T.default.create(ae.blotName);this.parent.insertBefore(Ae,de===0?this:this.next),Ae.insertAt(0,xe.slice(0,-1))}else d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"insertAt",this).call(this,de,xe,we)}}]),ee}(T.default.Embed);te.scope=T.default.Scope.BLOCK_BLOT;var ae=function(ie){Z(ee,ie);function ee(oe){B(this,ee);var de=U(this,(ee.__proto__||Object.getPrototypeOf(ee)).call(this,oe));return de.cache={},de}return l(ee,[{key:"delta",value:function(){return this.cache.delta==null&&(this.cache.delta=this.descendants(T.default.Leaf).reduce(function(de,xe){return xe.length()===0?de:de.insert(xe.value(),ne(xe))},new S.default).insert(`
`,ne(this))),this.cache.delta}},{key:"deleteAt",value:function(de,xe){d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"deleteAt",this).call(this,de,xe),this.cache={}}},{key:"formatAt",value:function(de,xe,we,Ae){xe<=0||(T.default.query(we,T.default.Scope.BLOCK)?de+xe===this.length()&&this.format(we,Ae):d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"formatAt",this).call(this,de,Math.min(xe,this.length()-de-1),we,Ae),this.cache={})}},{key:"insertAt",value:function(de,xe,we){if(we!=null)return d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"insertAt",this).call(this,de,xe,we);if(xe.length!==0){var Ae=xe.split(`
`),Ce=Ae.shift();Ce.length>0&&(de<this.length()-1||this.children.tail==null?d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"insertAt",this).call(this,Math.min(de,this.length()-1),Ce):this.children.tail.insertAt(this.children.tail.length(),Ce),this.cache={});var me=this;Ae.reduce(function(Pe,ye){return me=me.split(Pe,!0),me.insertAt(0,ye),ye.length},de+Ce.length)}}},{key:"insertBefore",value:function(de,xe){var we=this.children.head;d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"insertBefore",this).call(this,de,xe),we instanceof N.default&&we.remove(),this.cache={}}},{key:"length",value:function(){return this.cache.length==null&&(this.cache.length=d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"length",this).call(this)+J),this.cache.length}},{key:"moveChildren",value:function(de,xe){d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"moveChildren",this).call(this,de,xe),this.cache={}}},{key:"optimize",value:function(de){d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"optimize",this).call(this,de),this.cache={}}},{key:"path",value:function(de){return d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"path",this).call(this,de,!0)}},{key:"removeChild",value:function(de){d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"removeChild",this).call(this,de),this.cache={}}},{key:"split",value:function(de){var xe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(xe&&(de===0||de>=this.length()-J)){var we=this.clone();return de===0?(this.parent.insertBefore(we,this),this):(this.parent.insertBefore(we,this.next),we)}else{var Ae=d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"split",this).call(this,de,xe);return this.cache={},Ae}}}]),ee}(T.default.Block);ae.blotName="block",ae.tagName="P",ae.defaultChild="break",ae.allowedChildren=[j.default,T.default.Embed,R.default];function ne(ie){var ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ie==null||(typeof ie.formats=="function"&&(ee=(0,g.default)(ee,ie.formats())),ie.parent==null||ie.parent.blotName=="scroll"||ie.parent.statics.scope!==ie.statics.scope)?ee:ne(ie.parent,ee)}n.bubbleFormats=ne,n.BlockEmbed=te,n.default=ae},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.overload=n.expandConfig=void 0;var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(me){return typeof me}:function(me){return me&&typeof Symbol=="function"&&me.constructor===Symbol&&me!==Symbol.prototype?"symbol":typeof me},d=function(){function me(Pe,ye){var pe=[],Ie=!0,tt=!1,Ze=void 0;try{for(var Le=Pe[Symbol.iterator](),qe;!(Ie=(qe=Le.next()).done)&&(pe.push(qe.value),!(ye&&pe.length===ye));Ie=!0);}catch(Ge){tt=!0,Ze=Ge}finally{try{!Ie&&Le.return&&Le.return()}finally{if(tt)throw Ze}}return pe}return function(Pe,ye){if(Array.isArray(Pe))return Pe;if(Symbol.iterator in Object(Pe))return me(Pe,ye);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function me(Pe,ye){for(var pe=0;pe<ye.length;pe++){var Ie=ye[pe];Ie.enumerable=Ie.enumerable||!1,Ie.configurable=!0,"value"in Ie&&(Ie.writable=!0),Object.defineProperty(Pe,Ie.key,Ie)}}return function(Pe,ye,pe){return ye&&me(Pe.prototype,ye),pe&&me(Pe,pe),Pe}}();o(50);var g=o(2),_=ne(g),S=o(14),E=ne(S),T=o(8),C=ne(T),N=o(9),I=ne(N),j=o(0),D=ne(j),R=o(15),F=ne(R),B=o(3),U=ne(B),Z=o(10),J=ne(Z),te=o(34),ae=ne(te);function ne(me){return me&&me.__esModule?me:{default:me}}function ie(me,Pe,ye){return Pe in me?Object.defineProperty(me,Pe,{value:ye,enumerable:!0,configurable:!0,writable:!0}):me[Pe]=ye,me}function ee(me,Pe){if(!(me instanceof Pe))throw new TypeError("Cannot call a class as a function")}var oe=(0,J.default)("quill"),de=function(){i(me,null,[{key:"debug",value:function(ye){ye===!0&&(ye="log"),J.default.level(ye)}},{key:"find",value:function(ye){return ye.__quill||D.default.find(ye)}},{key:"import",value:function(ye){return this.imports[ye]==null&&oe.error("Cannot import "+ye+". Are you sure it was registered?"),this.imports[ye]}},{key:"register",value:function(ye,pe){var Ie=this,tt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(typeof ye!="string"){var Ze=ye.attrName||ye.blotName;typeof Ze=="string"?this.register("formats/"+Ze,ye,pe):Object.keys(ye).forEach(function(Le){Ie.register(Le,ye[Le],pe)})}else this.imports[ye]!=null&&!tt&&oe.warn("Overwriting "+ye+" with",pe),this.imports[ye]=pe,(ye.startsWith("blots/")||ye.startsWith("formats/"))&&pe.blotName!=="abstract"?D.default.register(pe):ye.startsWith("modules")&&typeof pe.register=="function"&&pe.register()}}]);function me(Pe){var ye=this,pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(ee(this,me),this.options=xe(Pe,pe),this.container=this.options.container,this.container==null)return oe.error("Invalid Quill container",Pe);this.options.debug&&me.debug(this.options.debug);var Ie=this.container.innerHTML.trim();this.container.classList.add("ql-container"),this.container.innerHTML="",this.container.__quill=this,this.root=this.addContainer("ql-editor"),this.root.classList.add("ql-blank"),this.root.setAttribute("data-gramm",!1),this.scrollingContainer=this.options.scrollingContainer||this.root,this.emitter=new C.default,this.scroll=D.default.create(this.root,{emitter:this.emitter,whitelist:this.options.formats}),this.editor=new E.default(this.scroll),this.selection=new F.default(this.scroll,this.emitter),this.theme=new this.options.theme(this,this.options),this.keyboard=this.theme.addModule("keyboard"),this.clipboard=this.theme.addModule("clipboard"),this.history=this.theme.addModule("history"),this.theme.init(),this.emitter.on(C.default.events.EDITOR_CHANGE,function(Ze){Ze===C.default.events.TEXT_CHANGE&&ye.root.classList.toggle("ql-blank",ye.editor.isBlank())}),this.emitter.on(C.default.events.SCROLL_UPDATE,function(Ze,Le){var qe=ye.selection.lastRange,Ge=qe&&qe.length===0?qe.index:void 0;we.call(ye,function(){return ye.editor.update(null,Le,Ge)},Ze)});var tt=this.clipboard.convert(`<div class='ql-editor' style="white-space: normal;">`+Ie+"<p><br></p></div>");this.setContents(tt),this.history.clear(),this.options.placeholder&&this.root.setAttribute("data-placeholder",this.options.placeholder),this.options.readOnly&&this.disable()}return i(me,[{key:"addContainer",value:function(ye){var pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(typeof ye=="string"){var Ie=ye;ye=document.createElement("div"),ye.classList.add(Ie)}return this.container.insertBefore(ye,pe),ye}},{key:"blur",value:function(){this.selection.setRange(null)}},{key:"deleteText",value:function(ye,pe,Ie){var tt=this,Ze=Ae(ye,pe,Ie),Le=d(Ze,4);return ye=Le[0],pe=Le[1],Ie=Le[3],we.call(this,function(){return tt.editor.deleteText(ye,pe)},Ie,ye,-1*pe)}},{key:"disable",value:function(){this.enable(!1)}},{key:"enable",value:function(){var ye=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.scroll.enable(ye),this.container.classList.toggle("ql-disabled",!ye)}},{key:"focus",value:function(){var ye=this.scrollingContainer.scrollTop;this.selection.focus(),this.scrollingContainer.scrollTop=ye,this.scrollIntoView()}},{key:"format",value:function(ye,pe){var Ie=this,tt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:C.default.sources.API;return we.call(this,function(){var Ze=Ie.getSelection(!0),Le=new _.default;if(Ze==null)return Le;if(D.default.query(ye,D.default.Scope.BLOCK))Le=Ie.editor.formatLine(Ze.index,Ze.length,ie({},ye,pe));else{if(Ze.length===0)return Ie.selection.format(ye,pe),Le;Le=Ie.editor.formatText(Ze.index,Ze.length,ie({},ye,pe))}return Ie.setSelection(Ze,C.default.sources.SILENT),Le},tt)}},{key:"formatLine",value:function(ye,pe,Ie,tt,Ze){var Le=this,qe=void 0,Ge=Ae(ye,pe,Ie,tt,Ze),je=d(Ge,4);return ye=je[0],pe=je[1],qe=je[2],Ze=je[3],we.call(this,function(){return Le.editor.formatLine(ye,pe,qe)},Ze,ye,0)}},{key:"formatText",value:function(ye,pe,Ie,tt,Ze){var Le=this,qe=void 0,Ge=Ae(ye,pe,Ie,tt,Ze),je=d(Ge,4);return ye=je[0],pe=je[1],qe=je[2],Ze=je[3],we.call(this,function(){return Le.editor.formatText(ye,pe,qe)},Ze,ye,0)}},{key:"getBounds",value:function(ye){var pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,Ie=void 0;typeof ye=="number"?Ie=this.selection.getBounds(ye,pe):Ie=this.selection.getBounds(ye.index,ye.length);var tt=this.container.getBoundingClientRect();return{bottom:Ie.bottom-tt.top,height:Ie.height,left:Ie.left-tt.left,right:Ie.right-tt.left,top:Ie.top-tt.top,width:Ie.width}}},{key:"getContents",value:function(){var ye=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-ye,Ie=Ae(ye,pe),tt=d(Ie,2);return ye=tt[0],pe=tt[1],this.editor.getContents(ye,pe)}},{key:"getFormat",value:function(){var ye=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.getSelection(!0),pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return typeof ye=="number"?this.editor.getFormat(ye,pe):this.editor.getFormat(ye.index,ye.length)}},{key:"getIndex",value:function(ye){return ye.offset(this.scroll)}},{key:"getLength",value:function(){return this.scroll.length()}},{key:"getLeaf",value:function(ye){return this.scroll.leaf(ye)}},{key:"getLine",value:function(ye){return this.scroll.line(ye)}},{key:"getLines",value:function(){var ye=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;return typeof ye!="number"?this.scroll.lines(ye.index,ye.length):this.scroll.lines(ye,pe)}},{key:"getModule",value:function(ye){return this.theme.modules[ye]}},{key:"getSelection",value:function(){var ye=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return ye&&this.focus(),this.update(),this.selection.getRange()[0]}},{key:"getText",value:function(){var ye=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-ye,Ie=Ae(ye,pe),tt=d(Ie,2);return ye=tt[0],pe=tt[1],this.editor.getText(ye,pe)}},{key:"hasFocus",value:function(){return this.selection.hasFocus()}},{key:"insertEmbed",value:function(ye,pe,Ie){var tt=this,Ze=arguments.length>3&&arguments[3]!==void 0?arguments[3]:me.sources.API;return we.call(this,function(){return tt.editor.insertEmbed(ye,pe,Ie)},Ze,ye)}},{key:"insertText",value:function(ye,pe,Ie,tt,Ze){var Le=this,qe=void 0,Ge=Ae(ye,0,Ie,tt,Ze),je=d(Ge,4);return ye=je[0],qe=je[2],Ze=je[3],we.call(this,function(){return Le.editor.insertText(ye,pe,qe)},Ze,ye,pe.length)}},{key:"isEnabled",value:function(){return!this.container.classList.contains("ql-disabled")}},{key:"off",value:function(){return this.emitter.off.apply(this.emitter,arguments)}},{key:"on",value:function(){return this.emitter.on.apply(this.emitter,arguments)}},{key:"once",value:function(){return this.emitter.once.apply(this.emitter,arguments)}},{key:"pasteHTML",value:function(ye,pe,Ie){this.clipboard.dangerouslyPasteHTML(ye,pe,Ie)}},{key:"removeFormat",value:function(ye,pe,Ie){var tt=this,Ze=Ae(ye,pe,Ie),Le=d(Ze,4);return ye=Le[0],pe=Le[1],Ie=Le[3],we.call(this,function(){return tt.editor.removeFormat(ye,pe)},Ie,ye)}},{key:"scrollIntoView",value:function(){this.selection.scrollIntoView(this.scrollingContainer)}},{key:"setContents",value:function(ye){var pe=this,Ie=arguments.length>1&&arguments[1]!==void 0?arguments[1]:C.default.sources.API;return we.call(this,function(){ye=new _.default(ye);var tt=pe.getLength(),Ze=pe.editor.deleteText(0,tt),Le=pe.editor.applyDelta(ye),qe=Le.ops[Le.ops.length-1];qe!=null&&typeof qe.insert=="string"&&qe.insert[qe.insert.length-1]===`
`&&(pe.editor.deleteText(pe.getLength()-1,1),Le.delete(1));var Ge=Ze.compose(Le);return Ge},Ie)}},{key:"setSelection",value:function(ye,pe,Ie){if(ye==null)this.selection.setRange(null,pe||me.sources.API);else{var tt=Ae(ye,pe,Ie),Ze=d(tt,4);ye=Ze[0],pe=Ze[1],Ie=Ze[3],this.selection.setRange(new R.Range(ye,pe),Ie),Ie!==C.default.sources.SILENT&&this.selection.scrollIntoView(this.scrollingContainer)}}},{key:"setText",value:function(ye){var pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:C.default.sources.API,Ie=new _.default().insert(ye);return this.setContents(Ie,pe)}},{key:"update",value:function(){var ye=arguments.length>0&&arguments[0]!==void 0?arguments[0]:C.default.sources.USER,pe=this.scroll.update(ye);return this.selection.update(ye),pe}},{key:"updateContents",value:function(ye){var pe=this,Ie=arguments.length>1&&arguments[1]!==void 0?arguments[1]:C.default.sources.API;return we.call(this,function(){return ye=new _.default(ye),pe.editor.applyDelta(ye,Ie)},Ie,!0)}}]),me}();de.DEFAULTS={bounds:null,formats:null,modules:{},placeholder:"",readOnly:!1,scrollingContainer:null,strict:!0,theme:"default"},de.events=C.default.events,de.sources=C.default.sources,de.version="1.3.7",de.imports={delta:_.default,parchment:D.default,"core/module":I.default,"core/theme":ae.default};function xe(me,Pe){if(Pe=(0,U.default)(!0,{container:me,modules:{clipboard:!0,keyboard:!0,history:!0}},Pe),!Pe.theme||Pe.theme===de.DEFAULTS.theme)Pe.theme=ae.default;else if(Pe.theme=de.import("themes/"+Pe.theme),Pe.theme==null)throw new Error("Invalid theme "+Pe.theme+". Did you register it?");var ye=(0,U.default)(!0,{},Pe.theme.DEFAULTS);[ye,Pe].forEach(function(tt){tt.modules=tt.modules||{},Object.keys(tt.modules).forEach(function(Ze){tt.modules[Ze]===!0&&(tt.modules[Ze]={})})});var pe=Object.keys(ye.modules).concat(Object.keys(Pe.modules)),Ie=pe.reduce(function(tt,Ze){var Le=de.import("modules/"+Ze);return Le==null?oe.error("Cannot load "+Ze+" module. Are you sure you registered it?"):tt[Ze]=Le.DEFAULTS||{},tt},{});return Pe.modules!=null&&Pe.modules.toolbar&&Pe.modules.toolbar.constructor!==Object&&(Pe.modules.toolbar={container:Pe.modules.toolbar}),Pe=(0,U.default)(!0,{},de.DEFAULTS,{modules:Ie},ye,Pe),["bounds","container","scrollingContainer"].forEach(function(tt){typeof Pe[tt]=="string"&&(Pe[tt]=document.querySelector(Pe[tt]))}),Pe.modules=Object.keys(Pe.modules).reduce(function(tt,Ze){return Pe.modules[Ze]&&(tt[Ze]=Pe.modules[Ze]),tt},{}),Pe}function we(me,Pe,ye,pe){if(this.options.strict&&!this.isEnabled()&&Pe===C.default.sources.USER)return new _.default;var Ie=ye==null?null:this.getSelection(),tt=this.editor.delta,Ze=me();if(Ie!=null&&(ye===!0&&(ye=Ie.index),pe==null?Ie=Ce(Ie,Ze,Pe):pe!==0&&(Ie=Ce(Ie,ye,pe,Pe)),this.setSelection(Ie,C.default.sources.SILENT)),Ze.length()>0){var Le,qe=[C.default.events.TEXT_CHANGE,Ze,tt,Pe];if((Le=this.emitter).emit.apply(Le,[C.default.events.EDITOR_CHANGE].concat(qe)),Pe!==C.default.sources.SILENT){var Ge;(Ge=this.emitter).emit.apply(Ge,qe)}}return Ze}function Ae(me,Pe,ye,pe,Ie){var tt={};return typeof me.index=="number"&&typeof me.length=="number"?typeof Pe!="number"?(Ie=pe,pe=ye,ye=Pe,Pe=me.length,me=me.index):(Pe=me.length,me=me.index):typeof Pe!="number"&&(Ie=pe,pe=ye,ye=Pe,Pe=0),(typeof ye>"u"?"undefined":l(ye))==="object"?(tt=ye,Ie=pe):typeof ye=="string"&&(pe!=null?tt[ye]=pe:Ie=ye),Ie=Ie||C.default.sources.API,[me,Pe,tt,Ie]}function Ce(me,Pe,ye,pe){if(me==null)return null;var Ie=void 0,tt=void 0;if(Pe instanceof _.default){var Ze=[me.index,me.index+me.length].map(function(je){return Pe.transformPosition(je,pe!==C.default.sources.USER)}),Le=d(Ze,2);Ie=Le[0],tt=Le[1]}else{var qe=[me.index,me.index+me.length].map(function(je){return je<Pe||je===Pe&&pe===C.default.sources.USER?je:ye>=0?je+ye:Math.max(Pe,je+ye)}),Ge=d(qe,2);Ie=Ge[0],tt=Ge[1]}return new R.Range(Ie,tt-Ie)}n.expandConfig=xe,n.overload=Ae,n.default=de},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function j(D,R){for(var F=0;F<R.length;F++){var B=R[F];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(D,B.key,B)}}return function(D,R,F){return R&&j(D.prototype,R),F&&j(D,F),D}}(),d=function j(D,R,F){D===null&&(D=Function.prototype);var B=Object.getOwnPropertyDescriptor(D,R);if(B===void 0){var U=Object.getPrototypeOf(D);return U===null?void 0:j(U,R,F)}else{if("value"in B)return B.value;var Z=B.get;return Z===void 0?void 0:Z.call(F)}},i=o(7),g=E(i),_=o(0),S=E(_);function E(j){return j&&j.__esModule?j:{default:j}}function T(j,D){if(!(j instanceof D))throw new TypeError("Cannot call a class as a function")}function C(j,D){if(!j)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D&&(typeof D=="object"||typeof D=="function")?D:j}function N(j,D){if(typeof D!="function"&&D!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof D);j.prototype=Object.create(D&&D.prototype,{constructor:{value:j,enumerable:!1,writable:!0,configurable:!0}}),D&&(Object.setPrototypeOf?Object.setPrototypeOf(j,D):j.__proto__=D)}var I=function(j){N(D,j);function D(){return T(this,D),C(this,(D.__proto__||Object.getPrototypeOf(D)).apply(this,arguments))}return l(D,[{key:"formatAt",value:function(F,B,U,Z){if(D.compare(this.statics.blotName,U)<0&&S.default.query(U,S.default.Scope.BLOT)){var J=this.isolate(F,B);Z&&J.wrap(U,Z)}else d(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"formatAt",this).call(this,F,B,U,Z)}},{key:"optimize",value:function(F){if(d(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"optimize",this).call(this,F),this.parent instanceof D&&D.compare(this.statics.blotName,this.parent.statics.blotName)>0){var B=this.parent.isolate(this.offset(),this.length());this.moveChildren(B),B.wrap(this)}}}],[{key:"compare",value:function(F,B){var U=D.order.indexOf(F),Z=D.order.indexOf(B);return U>=0||Z>=0?U-Z:F===B?0:F<B?-1:1}}]),D}(S.default.Inline);I.allowedChildren=[I,S.default.Embed,g.default],I.order=["cursor","inline","underline","strike","italic","bold","script","link","code"],n.default=I},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(0),d=i(l);function i(T){return T&&T.__esModule?T:{default:T}}function g(T,C){if(!(T instanceof C))throw new TypeError("Cannot call a class as a function")}function _(T,C){if(!T)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return C&&(typeof C=="object"||typeof C=="function")?C:T}function S(T,C){if(typeof C!="function"&&C!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof C);T.prototype=Object.create(C&&C.prototype,{constructor:{value:T,enumerable:!1,writable:!0,configurable:!0}}),C&&(Object.setPrototypeOf?Object.setPrototypeOf(T,C):T.__proto__=C)}var E=function(T){S(C,T);function C(){return g(this,C),_(this,(C.__proto__||Object.getPrototypeOf(C)).apply(this,arguments))}return C}(d.default.Text);n.default=E},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function R(F,B){for(var U=0;U<B.length;U++){var Z=B[U];Z.enumerable=Z.enumerable||!1,Z.configurable=!0,"value"in Z&&(Z.writable=!0),Object.defineProperty(F,Z.key,Z)}}return function(F,B,U){return B&&R(F.prototype,B),U&&R(F,U),F}}(),d=function R(F,B,U){F===null&&(F=Function.prototype);var Z=Object.getOwnPropertyDescriptor(F,B);if(Z===void 0){var J=Object.getPrototypeOf(F);return J===null?void 0:R(J,B,U)}else{if("value"in Z)return Z.value;var te=Z.get;return te===void 0?void 0:te.call(U)}},i=o(54),g=E(i),_=o(10),S=E(_);function E(R){return R&&R.__esModule?R:{default:R}}function T(R,F){if(!(R instanceof F))throw new TypeError("Cannot call a class as a function")}function C(R,F){if(!R)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return F&&(typeof F=="object"||typeof F=="function")?F:R}function N(R,F){if(typeof F!="function"&&F!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof F);R.prototype=Object.create(F&&F.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),F&&(Object.setPrototypeOf?Object.setPrototypeOf(R,F):R.__proto__=F)}var I=(0,S.default)("quill:events"),j=["selectionchange","mousedown","mouseup","click"];j.forEach(function(R){document.addEventListener(R,function(){for(var F=arguments.length,B=Array(F),U=0;U<F;U++)B[U]=arguments[U];[].slice.call(document.querySelectorAll(".ql-container")).forEach(function(Z){if(Z.__quill&&Z.__quill.emitter){var J;(J=Z.__quill.emitter).handleDOM.apply(J,B)}})})});var D=function(R){N(F,R);function F(){T(this,F);var B=C(this,(F.__proto__||Object.getPrototypeOf(F)).call(this));return B.listeners={},B.on("error",I.error),B}return l(F,[{key:"emit",value:function(){I.log.apply(I,arguments),d(F.prototype.__proto__||Object.getPrototypeOf(F.prototype),"emit",this).apply(this,arguments)}},{key:"handleDOM",value:function(U){for(var Z=arguments.length,J=Array(Z>1?Z-1:0),te=1;te<Z;te++)J[te-1]=arguments[te];(this.listeners[U.type]||[]).forEach(function(ae){var ne=ae.node,ie=ae.handler;(U.target===ne||ne.contains(U.target))&&ie.apply(void 0,[U].concat(J))})}},{key:"listenDOM",value:function(U,Z,J){this.listeners[U]||(this.listeners[U]=[]),this.listeners[U].push({node:Z,handler:J})}}]),F}(g.default);D.events={EDITOR_CHANGE:"editor-change",SCROLL_BEFORE_UPDATE:"scroll-before-update",SCROLL_OPTIMIZE:"scroll-optimize",SCROLL_UPDATE:"scroll-update",SELECTION_CHANGE:"selection-change",TEXT_CHANGE:"text-change"},D.sources={API:"api",SILENT:"silent",USER:"user"},n.default=D},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});function l(i,g){if(!(i instanceof g))throw new TypeError("Cannot call a class as a function")}var d=function i(g){var _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};l(this,i),this.quill=g,this.options=_};d.DEFAULTS={},n.default=d},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=["error","warn","log","info"],d="warn";function i(_){if(l.indexOf(_)<=l.indexOf(d)){for(var S,E=arguments.length,T=Array(E>1?E-1:0),C=1;C<E;C++)T[C-1]=arguments[C];(S=console)[_].apply(S,T)}}function g(_){return l.reduce(function(S,E){return S[E]=i.bind(console,E,_),S},{})}i.level=g.level=function(_){d=_},n.default=g},function(r,n,o){var l=Array.prototype.slice,d=o(52),i=o(53),g=r.exports=function(T,C,N){return N||(N={}),T===C?!0:T instanceof Date&&C instanceof Date?T.getTime()===C.getTime():!T||!C||typeof T!="object"&&typeof C!="object"?N.strict?T===C:T==C:E(T,C,N)};function _(T){return T==null}function S(T){return!(!T||typeof T!="object"||typeof T.length!="number"||typeof T.copy!="function"||typeof T.slice!="function"||T.length>0&&typeof T[0]!="number")}function E(T,C,N){var I,j;if(_(T)||_(C)||T.prototype!==C.prototype)return!1;if(i(T))return i(C)?(T=l.call(T),C=l.call(C),g(T,C,N)):!1;if(S(T)){if(!S(C)||T.length!==C.length)return!1;for(I=0;I<T.length;I++)if(T[I]!==C[I])return!1;return!0}try{var D=d(T),R=d(C)}catch{return!1}if(D.length!=R.length)return!1;for(D.sort(),R.sort(),I=D.length-1;I>=0;I--)if(D[I]!=R[I])return!1;for(I=D.length-1;I>=0;I--)if(j=D[I],!g(T[j],C[j],N))return!1;return typeof T==typeof C}},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(1),d=function(){function i(g,_,S){S===void 0&&(S={}),this.attrName=g,this.keyName=_;var E=l.Scope.TYPE&l.Scope.ATTRIBUTE;S.scope!=null?this.scope=S.scope&l.Scope.LEVEL|E:this.scope=l.Scope.ATTRIBUTE,S.whitelist!=null&&(this.whitelist=S.whitelist)}return i.keys=function(g){return[].map.call(g.attributes,function(_){return _.name})},i.prototype.add=function(g,_){return this.canAdd(g,_)?(g.setAttribute(this.keyName,_),!0):!1},i.prototype.canAdd=function(g,_){var S=l.query(g,l.Scope.BLOT&(this.scope|l.Scope.TYPE));return S==null?!1:this.whitelist==null?!0:typeof _=="string"?this.whitelist.indexOf(_.replace(/["']/g,""))>-1:this.whitelist.indexOf(_)>-1},i.prototype.remove=function(g){g.removeAttribute(this.keyName)},i.prototype.value=function(g){var _=g.getAttribute(this.keyName);return this.canAdd(g,_)&&_?_:""},i}();n.default=d},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.Code=void 0;var l=function(){function te(ae,ne){var ie=[],ee=!0,oe=!1,de=void 0;try{for(var xe=ae[Symbol.iterator](),we;!(ee=(we=xe.next()).done)&&(ie.push(we.value),!(ne&&ie.length===ne));ee=!0);}catch(Ae){oe=!0,de=Ae}finally{try{!ee&&xe.return&&xe.return()}finally{if(oe)throw de}}return ie}return function(ae,ne){if(Array.isArray(ae))return ae;if(Symbol.iterator in Object(ae))return te(ae,ne);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(){function te(ae,ne){for(var ie=0;ie<ne.length;ie++){var ee=ne[ie];ee.enumerable=ee.enumerable||!1,ee.configurable=!0,"value"in ee&&(ee.writable=!0),Object.defineProperty(ae,ee.key,ee)}}return function(ae,ne,ie){return ne&&te(ae.prototype,ne),ie&&te(ae,ie),ae}}(),i=function te(ae,ne,ie){ae===null&&(ae=Function.prototype);var ee=Object.getOwnPropertyDescriptor(ae,ne);if(ee===void 0){var oe=Object.getPrototypeOf(ae);return oe===null?void 0:te(oe,ne,ie)}else{if("value"in ee)return ee.value;var de=ee.get;return de===void 0?void 0:de.call(ie)}},g=o(2),_=R(g),S=o(0),E=R(S),T=o(4),C=R(T),N=o(6),I=R(N),j=o(7),D=R(j);function R(te){return te&&te.__esModule?te:{default:te}}function F(te,ae){if(!(te instanceof ae))throw new TypeError("Cannot call a class as a function")}function B(te,ae){if(!te)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ae&&(typeof ae=="object"||typeof ae=="function")?ae:te}function U(te,ae){if(typeof ae!="function"&&ae!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof ae);te.prototype=Object.create(ae&&ae.prototype,{constructor:{value:te,enumerable:!1,writable:!0,configurable:!0}}),ae&&(Object.setPrototypeOf?Object.setPrototypeOf(te,ae):te.__proto__=ae)}var Z=function(te){U(ae,te);function ae(){return F(this,ae),B(this,(ae.__proto__||Object.getPrototypeOf(ae)).apply(this,arguments))}return ae}(I.default);Z.blotName="code",Z.tagName="CODE";var J=function(te){U(ae,te);function ae(){return F(this,ae),B(this,(ae.__proto__||Object.getPrototypeOf(ae)).apply(this,arguments))}return d(ae,[{key:"delta",value:function(){var ie=this,ee=this.domNode.textContent;return ee.endsWith(`
`)&&(ee=ee.slice(0,-1)),ee.split(`
`).reduce(function(oe,de){return oe.insert(de).insert(`
`,ie.formats())},new _.default)}},{key:"format",value:function(ie,ee){if(!(ie===this.statics.blotName&&ee)){var oe=this.descendant(D.default,this.length()-1),de=l(oe,1),xe=de[0];xe!=null&&xe.deleteAt(xe.length()-1,1),i(ae.prototype.__proto__||Object.getPrototypeOf(ae.prototype),"format",this).call(this,ie,ee)}}},{key:"formatAt",value:function(ie,ee,oe,de){if(ee!==0&&!(E.default.query(oe,E.default.Scope.BLOCK)==null||oe===this.statics.blotName&&de===this.statics.formats(this.domNode))){var xe=this.newlineIndex(ie);if(!(xe<0||xe>=ie+ee)){var we=this.newlineIndex(ie,!0)+1,Ae=xe-we+1,Ce=this.isolate(we,Ae),me=Ce.next;Ce.format(oe,de),me instanceof ae&&me.formatAt(0,ie-we+ee-Ae,oe,de)}}}},{key:"insertAt",value:function(ie,ee,oe){if(oe==null){var de=this.descendant(D.default,ie),xe=l(de,2),we=xe[0],Ae=xe[1];we.insertAt(Ae,ee)}}},{key:"length",value:function(){var ie=this.domNode.textContent.length;return this.domNode.textContent.endsWith(`
`)?ie:ie+1}},{key:"newlineIndex",value:function(ie){var ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(ee)return this.domNode.textContent.slice(0,ie).lastIndexOf(`
`);var oe=this.domNode.textContent.slice(ie).indexOf(`
`);return oe>-1?ie+oe:-1}},{key:"optimize",value:function(ie){this.domNode.textContent.endsWith(`
`)||this.appendChild(E.default.create("text",`
`)),i(ae.prototype.__proto__||Object.getPrototypeOf(ae.prototype),"optimize",this).call(this,ie);var ee=this.next;ee!=null&&ee.prev===this&&ee.statics.blotName===this.statics.blotName&&this.statics.formats(this.domNode)===ee.statics.formats(ee.domNode)&&(ee.optimize(ie),ee.moveChildren(this),ee.remove())}},{key:"replace",value:function(ie){i(ae.prototype.__proto__||Object.getPrototypeOf(ae.prototype),"replace",this).call(this,ie),[].slice.call(this.domNode.querySelectorAll("*")).forEach(function(ee){var oe=E.default.find(ee);oe==null?ee.parentNode.removeChild(ee):oe instanceof E.default.Embed?oe.remove():oe.unwrap()})}}],[{key:"create",value:function(ie){var ee=i(ae.__proto__||Object.getPrototypeOf(ae),"create",this).call(this,ie);return ee.setAttribute("spellcheck",!1),ee}},{key:"formats",value:function(){return!0}}]),ae}(C.default);J.blotName="code-block",J.tagName="PRE",J.TAB="  ",n.Code=Z,n.default=J},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(me){return typeof me}:function(me){return me&&typeof Symbol=="function"&&me.constructor===Symbol&&me!==Symbol.prototype?"symbol":typeof me},d=function(){function me(Pe,ye){var pe=[],Ie=!0,tt=!1,Ze=void 0;try{for(var Le=Pe[Symbol.iterator](),qe;!(Ie=(qe=Le.next()).done)&&(pe.push(qe.value),!(ye&&pe.length===ye));Ie=!0);}catch(Ge){tt=!0,Ze=Ge}finally{try{!Ie&&Le.return&&Le.return()}finally{if(tt)throw Ze}}return pe}return function(Pe,ye){if(Array.isArray(Pe))return Pe;if(Symbol.iterator in Object(Pe))return me(Pe,ye);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function me(Pe,ye){for(var pe=0;pe<ye.length;pe++){var Ie=ye[pe];Ie.enumerable=Ie.enumerable||!1,Ie.configurable=!0,"value"in Ie&&(Ie.writable=!0),Object.defineProperty(Pe,Ie.key,Ie)}}return function(Pe,ye,pe){return ye&&me(Pe.prototype,ye),pe&&me(Pe,pe),Pe}}(),g=o(2),_=ee(g),S=o(20),E=ee(S),T=o(0),C=ee(T),N=o(13),I=ee(N),j=o(24),D=ee(j),R=o(4),F=ee(R),B=o(16),U=ee(B),Z=o(21),J=ee(Z),te=o(11),ae=ee(te),ne=o(3),ie=ee(ne);function ee(me){return me&&me.__esModule?me:{default:me}}function oe(me,Pe,ye){return Pe in me?Object.defineProperty(me,Pe,{value:ye,enumerable:!0,configurable:!0,writable:!0}):me[Pe]=ye,me}function de(me,Pe){if(!(me instanceof Pe))throw new TypeError("Cannot call a class as a function")}var xe=/^[ -~]*$/,we=function(){function me(Pe){de(this,me),this.scroll=Pe,this.delta=this.getDelta()}return i(me,[{key:"applyDelta",value:function(ye){var pe=this,Ie=!1;this.scroll.update();var tt=this.scroll.length();return this.scroll.batchStart(),ye=Ce(ye),ye.reduce(function(Ze,Le){var qe=Le.retain||Le.delete||Le.insert.length||1,Ge=Le.attributes||{};if(Le.insert!=null){if(typeof Le.insert=="string"){var je=Le.insert;je.endsWith(`
`)&&Ie&&(Ie=!1,je=je.slice(0,-1)),Ze>=tt&&!je.endsWith(`
`)&&(Ie=!0),pe.scroll.insertAt(Ze,je);var ot=pe.scroll.line(Ze),St=d(ot,2),rt=St[0],Ut=St[1],Ft=(0,ie.default)({},(0,R.bubbleFormats)(rt));if(rt instanceof F.default){var dr=rt.descendant(C.default.Leaf,Ut),Lr=d(dr,1),Jr=Lr[0];Ft=(0,ie.default)(Ft,(0,R.bubbleFormats)(Jr))}Ge=E.default.attributes.diff(Ft,Ge)||{}}else if(l(Le.insert)==="object"){var Rt=Object.keys(Le.insert)[0];if(Rt==null)return Ze;pe.scroll.insertAt(Ze,Rt,Le.insert[Rt])}tt+=qe}return Object.keys(Ge).forEach(function(At){pe.scroll.formatAt(Ze,qe,At,Ge[At])}),Ze+qe},0),ye.reduce(function(Ze,Le){return typeof Le.delete=="number"?(pe.scroll.deleteAt(Ze,Le.delete),Ze):Ze+(Le.retain||Le.insert.length||1)},0),this.scroll.batchEnd(),this.update(ye)}},{key:"deleteText",value:function(ye,pe){return this.scroll.deleteAt(ye,pe),this.update(new _.default().retain(ye).delete(pe))}},{key:"formatLine",value:function(ye,pe){var Ie=this,tt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.scroll.update(),Object.keys(tt).forEach(function(Ze){if(!(Ie.scroll.whitelist!=null&&!Ie.scroll.whitelist[Ze])){var Le=Ie.scroll.lines(ye,Math.max(pe,1)),qe=pe;Le.forEach(function(Ge){var je=Ge.length();if(!(Ge instanceof I.default))Ge.format(Ze,tt[Ze]);else{var ot=ye-Ge.offset(Ie.scroll),St=Ge.newlineIndex(ot+qe)-ot+1;Ge.formatAt(ot,St,Ze,tt[Ze])}qe-=je})}}),this.scroll.optimize(),this.update(new _.default().retain(ye).retain(pe,(0,J.default)(tt)))}},{key:"formatText",value:function(ye,pe){var Ie=this,tt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Object.keys(tt).forEach(function(Ze){Ie.scroll.formatAt(ye,pe,Ze,tt[Ze])}),this.update(new _.default().retain(ye).retain(pe,(0,J.default)(tt)))}},{key:"getContents",value:function(ye,pe){return this.delta.slice(ye,ye+pe)}},{key:"getDelta",value:function(){return this.scroll.lines().reduce(function(ye,pe){return ye.concat(pe.delta())},new _.default)}},{key:"getFormat",value:function(ye){var pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,Ie=[],tt=[];pe===0?this.scroll.path(ye).forEach(function(Le){var qe=d(Le,1),Ge=qe[0];Ge instanceof F.default?Ie.push(Ge):Ge instanceof C.default.Leaf&&tt.push(Ge)}):(Ie=this.scroll.lines(ye,pe),tt=this.scroll.descendants(C.default.Leaf,ye,pe));var Ze=[Ie,tt].map(function(Le){if(Le.length===0)return{};for(var qe=(0,R.bubbleFormats)(Le.shift());Object.keys(qe).length>0;){var Ge=Le.shift();if(Ge==null)return qe;qe=Ae((0,R.bubbleFormats)(Ge),qe)}return qe});return ie.default.apply(ie.default,Ze)}},{key:"getText",value:function(ye,pe){return this.getContents(ye,pe).filter(function(Ie){return typeof Ie.insert=="string"}).map(function(Ie){return Ie.insert}).join("")}},{key:"insertEmbed",value:function(ye,pe,Ie){return this.scroll.insertAt(ye,pe,Ie),this.update(new _.default().retain(ye).insert(oe({},pe,Ie)))}},{key:"insertText",value:function(ye,pe){var Ie=this,tt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return pe=pe.replace(/\r\n/g,`
`).replace(/\r/g,`
`),this.scroll.insertAt(ye,pe),Object.keys(tt).forEach(function(Ze){Ie.scroll.formatAt(ye,pe.length,Ze,tt[Ze])}),this.update(new _.default().retain(ye).insert(pe,(0,J.default)(tt)))}},{key:"isBlank",value:function(){if(this.scroll.children.length==0)return!0;if(this.scroll.children.length>1)return!1;var ye=this.scroll.children.head;return ye.statics.blotName!==F.default.blotName||ye.children.length>1?!1:ye.children.head instanceof U.default}},{key:"removeFormat",value:function(ye,pe){var Ie=this.getText(ye,pe),tt=this.scroll.line(ye+pe),Ze=d(tt,2),Le=Ze[0],qe=Ze[1],Ge=0,je=new _.default;Le!=null&&(Le instanceof I.default?Ge=Le.newlineIndex(qe)-qe+1:Ge=Le.length()-qe,je=Le.delta().slice(qe,qe+Ge-1).insert(`
`));var ot=this.getContents(ye,pe+Ge),St=ot.diff(new _.default().insert(Ie).concat(je)),rt=new _.default().retain(ye).concat(St);return this.applyDelta(rt)}},{key:"update",value:function(ye){var pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],Ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,tt=this.delta;if(pe.length===1&&pe[0].type==="characterData"&&pe[0].target.data.match(xe)&&C.default.find(pe[0].target)){var Ze=C.default.find(pe[0].target),Le=(0,R.bubbleFormats)(Ze),qe=Ze.offset(this.scroll),Ge=pe[0].oldValue.replace(D.default.CONTENTS,""),je=new _.default().insert(Ge),ot=new _.default().insert(Ze.value()),St=new _.default().retain(qe).concat(je.diff(ot,Ie));ye=St.reduce(function(rt,Ut){return Ut.insert?rt.insert(Ut.insert,Le):rt.push(Ut)},new _.default),this.delta=tt.compose(ye)}else this.delta=this.getDelta(),(!ye||!(0,ae.default)(tt.compose(ye),this.delta))&&(ye=tt.diff(this.delta,Ie));return ye}}]),me}();function Ae(me,Pe){return Object.keys(Pe).reduce(function(ye,pe){return me[pe]==null||(Pe[pe]===me[pe]?ye[pe]=Pe[pe]:Array.isArray(Pe[pe])?Pe[pe].indexOf(me[pe])<0&&(ye[pe]=Pe[pe].concat([me[pe]])):ye[pe]=[Pe[pe],me[pe]]),ye},{})}function Ce(me){return me.reduce(function(Pe,ye){if(ye.insert===1){var pe=(0,J.default)(ye.attributes);return delete pe.image,Pe.insert({image:ye.attributes.image},pe)}if(ye.attributes!=null&&(ye.attributes.list===!0||ye.attributes.bullet===!0)&&(ye=(0,J.default)(ye),ye.attributes.list?ye.attributes.list="ordered":(ye.attributes.list="bullet",delete ye.attributes.bullet)),typeof ye.insert=="string"){var Ie=ye.insert.replace(/\r\n/g,`
`).replace(/\r/g,`
`);return Pe.insert(Ie,ye.attributes)}return Pe.push(ye)},new _.default)}n.default=we},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.Range=void 0;var l=function(){function te(ae,ne){var ie=[],ee=!0,oe=!1,de=void 0;try{for(var xe=ae[Symbol.iterator](),we;!(ee=(we=xe.next()).done)&&(ie.push(we.value),!(ne&&ie.length===ne));ee=!0);}catch(Ae){oe=!0,de=Ae}finally{try{!ee&&xe.return&&xe.return()}finally{if(oe)throw de}}return ie}return function(ae,ne){if(Array.isArray(ae))return ae;if(Symbol.iterator in Object(ae))return te(ae,ne);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(){function te(ae,ne){for(var ie=0;ie<ne.length;ie++){var ee=ne[ie];ee.enumerable=ee.enumerable||!1,ee.configurable=!0,"value"in ee&&(ee.writable=!0),Object.defineProperty(ae,ee.key,ee)}}return function(ae,ne,ie){return ne&&te(ae.prototype,ne),ie&&te(ae,ie),ae}}(),i=o(0),g=D(i),_=o(21),S=D(_),E=o(11),T=D(E),C=o(8),N=D(C),I=o(10),j=D(I);function D(te){return te&&te.__esModule?te:{default:te}}function R(te){if(Array.isArray(te)){for(var ae=0,ne=Array(te.length);ae<te.length;ae++)ne[ae]=te[ae];return ne}else return Array.from(te)}function F(te,ae){if(!(te instanceof ae))throw new TypeError("Cannot call a class as a function")}var B=(0,j.default)("quill:selection"),U=function te(ae){var ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;F(this,te),this.index=ae,this.length=ne},Z=function(){function te(ae,ne){var ie=this;F(this,te),this.emitter=ne,this.scroll=ae,this.composing=!1,this.mouseDown=!1,this.root=this.scroll.domNode,this.cursor=g.default.create("cursor",this),this.lastRange=this.savedRange=new U(0,0),this.handleComposition(),this.handleDragging(),this.emitter.listenDOM("selectionchange",document,function(){ie.mouseDown||setTimeout(ie.update.bind(ie,N.default.sources.USER),1)}),this.emitter.on(N.default.events.EDITOR_CHANGE,function(ee,oe){ee===N.default.events.TEXT_CHANGE&&oe.length()>0&&ie.update(N.default.sources.SILENT)}),this.emitter.on(N.default.events.SCROLL_BEFORE_UPDATE,function(){if(ie.hasFocus()){var ee=ie.getNativeRange();ee!=null&&ee.start.node!==ie.cursor.textNode&&ie.emitter.once(N.default.events.SCROLL_UPDATE,function(){try{ie.setNativeRange(ee.start.node,ee.start.offset,ee.end.node,ee.end.offset)}catch{}})}}),this.emitter.on(N.default.events.SCROLL_OPTIMIZE,function(ee,oe){if(oe.range){var de=oe.range,xe=de.startNode,we=de.startOffset,Ae=de.endNode,Ce=de.endOffset;ie.setNativeRange(xe,we,Ae,Ce)}}),this.update(N.default.sources.SILENT)}return d(te,[{key:"handleComposition",value:function(){var ne=this;this.root.addEventListener("compositionstart",function(){ne.composing=!0}),this.root.addEventListener("compositionend",function(){if(ne.composing=!1,ne.cursor.parent){var ie=ne.cursor.restore();if(!ie)return;setTimeout(function(){ne.setNativeRange(ie.startNode,ie.startOffset,ie.endNode,ie.endOffset)},1)}})}},{key:"handleDragging",value:function(){var ne=this;this.emitter.listenDOM("mousedown",document.body,function(){ne.mouseDown=!0}),this.emitter.listenDOM("mouseup",document.body,function(){ne.mouseDown=!1,ne.update(N.default.sources.USER)})}},{key:"focus",value:function(){this.hasFocus()||(this.root.focus(),this.setRange(this.savedRange))}},{key:"format",value:function(ne,ie){if(!(this.scroll.whitelist!=null&&!this.scroll.whitelist[ne])){this.scroll.update();var ee=this.getNativeRange();if(!(ee==null||!ee.native.collapsed||g.default.query(ne,g.default.Scope.BLOCK))){if(ee.start.node!==this.cursor.textNode){var oe=g.default.find(ee.start.node,!1);if(oe==null)return;if(oe instanceof g.default.Leaf){var de=oe.split(ee.start.offset);oe.parent.insertBefore(this.cursor,de)}else oe.insertBefore(this.cursor,ee.start.node);this.cursor.attach()}this.cursor.format(ne,ie),this.scroll.optimize(),this.setNativeRange(this.cursor.textNode,this.cursor.textNode.data.length),this.update()}}}},{key:"getBounds",value:function(ne){var ie=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,ee=this.scroll.length();ne=Math.min(ne,ee-1),ie=Math.min(ne+ie,ee-1)-ne;var oe=void 0,de=this.scroll.leaf(ne),xe=l(de,2),we=xe[0],Ae=xe[1];if(we==null)return null;var Ce=we.position(Ae,!0),me=l(Ce,2);oe=me[0],Ae=me[1];var Pe=document.createRange();if(ie>0){Pe.setStart(oe,Ae);var ye=this.scroll.leaf(ne+ie),pe=l(ye,2);if(we=pe[0],Ae=pe[1],we==null)return null;var Ie=we.position(Ae,!0),tt=l(Ie,2);return oe=tt[0],Ae=tt[1],Pe.setEnd(oe,Ae),Pe.getBoundingClientRect()}else{var Ze="left",Le=void 0;return oe instanceof Text?(Ae<oe.data.length?(Pe.setStart(oe,Ae),Pe.setEnd(oe,Ae+1)):(Pe.setStart(oe,Ae-1),Pe.setEnd(oe,Ae),Ze="right"),Le=Pe.getBoundingClientRect()):(Le=we.domNode.getBoundingClientRect(),Ae>0&&(Ze="right")),{bottom:Le.top+Le.height,height:Le.height,left:Le[Ze],right:Le[Ze],top:Le.top,width:0}}}},{key:"getNativeRange",value:function(){var ne=document.getSelection();if(ne==null||ne.rangeCount<=0)return null;var ie=ne.getRangeAt(0);if(ie==null)return null;var ee=this.normalizeNative(ie);return B.info("getNativeRange",ee),ee}},{key:"getRange",value:function(){var ne=this.getNativeRange();if(ne==null)return[null,null];var ie=this.normalizedToRange(ne);return[ie,ne]}},{key:"hasFocus",value:function(){return document.activeElement===this.root}},{key:"normalizedToRange",value:function(ne){var ie=this,ee=[[ne.start.node,ne.start.offset]];ne.native.collapsed||ee.push([ne.end.node,ne.end.offset]);var oe=ee.map(function(we){var Ae=l(we,2),Ce=Ae[0],me=Ae[1],Pe=g.default.find(Ce,!0),ye=Pe.offset(ie.scroll);return me===0?ye:Pe instanceof g.default.Container?ye+Pe.length():ye+Pe.index(Ce,me)}),de=Math.min(Math.max.apply(Math,R(oe)),this.scroll.length()-1),xe=Math.min.apply(Math,[de].concat(R(oe)));return new U(xe,de-xe)}},{key:"normalizeNative",value:function(ne){if(!J(this.root,ne.startContainer)||!ne.collapsed&&!J(this.root,ne.endContainer))return null;var ie={start:{node:ne.startContainer,offset:ne.startOffset},end:{node:ne.endContainer,offset:ne.endOffset},native:ne};return[ie.start,ie.end].forEach(function(ee){for(var oe=ee.node,de=ee.offset;!(oe instanceof Text)&&oe.childNodes.length>0;)if(oe.childNodes.length>de)oe=oe.childNodes[de],de=0;else if(oe.childNodes.length===de)oe=oe.lastChild,de=oe instanceof Text?oe.data.length:oe.childNodes.length+1;else break;ee.node=oe,ee.offset=de}),ie}},{key:"rangeToNative",value:function(ne){var ie=this,ee=ne.collapsed?[ne.index]:[ne.index,ne.index+ne.length],oe=[],de=this.scroll.length();return ee.forEach(function(xe,we){xe=Math.min(de-1,xe);var Ae=void 0,Ce=ie.scroll.leaf(xe),me=l(Ce,2),Pe=me[0],ye=me[1],pe=Pe.position(ye,we!==0),Ie=l(pe,2);Ae=Ie[0],ye=Ie[1],oe.push(Ae,ye)}),oe.length<2&&(oe=oe.concat(oe)),oe}},{key:"scrollIntoView",value:function(ne){var ie=this.lastRange;if(ie!=null){var ee=this.getBounds(ie.index,ie.length);if(ee!=null){var oe=this.scroll.length()-1,de=this.scroll.line(Math.min(ie.index,oe)),xe=l(de,1),we=xe[0],Ae=we;if(ie.length>0){var Ce=this.scroll.line(Math.min(ie.index+ie.length,oe)),me=l(Ce,1);Ae=me[0]}if(!(we==null||Ae==null)){var Pe=ne.getBoundingClientRect();ee.top<Pe.top?ne.scrollTop-=Pe.top-ee.top:ee.bottom>Pe.bottom&&(ne.scrollTop+=ee.bottom-Pe.bottom)}}}}},{key:"setNativeRange",value:function(ne,ie){var ee=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ne,oe=arguments.length>3&&arguments[3]!==void 0?arguments[3]:ie,de=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(B.info("setNativeRange",ne,ie,ee,oe),!(ne!=null&&(this.root.parentNode==null||ne.parentNode==null||ee.parentNode==null))){var xe=document.getSelection();if(xe!=null)if(ne!=null){this.hasFocus()||this.root.focus();var we=(this.getNativeRange()||{}).native;if(we==null||de||ne!==we.startContainer||ie!==we.startOffset||ee!==we.endContainer||oe!==we.endOffset){ne.tagName=="BR"&&(ie=[].indexOf.call(ne.parentNode.childNodes,ne),ne=ne.parentNode),ee.tagName=="BR"&&(oe=[].indexOf.call(ee.parentNode.childNodes,ee),ee=ee.parentNode);var Ae=document.createRange();Ae.setStart(ne,ie),Ae.setEnd(ee,oe),xe.removeAllRanges(),xe.addRange(Ae)}}else xe.removeAllRanges(),this.root.blur(),document.body.focus()}}},{key:"setRange",value:function(ne){var ie=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,ee=arguments.length>2&&arguments[2]!==void 0?arguments[2]:N.default.sources.API;if(typeof ie=="string"&&(ee=ie,ie=!1),B.info("setRange",ne),ne!=null){var oe=this.rangeToNative(ne);this.setNativeRange.apply(this,R(oe).concat([ie]))}else this.setNativeRange(null);this.update(ee)}},{key:"update",value:function(){var ne=arguments.length>0&&arguments[0]!==void 0?arguments[0]:N.default.sources.USER,ie=this.lastRange,ee=this.getRange(),oe=l(ee,2),de=oe[0],xe=oe[1];if(this.lastRange=de,this.lastRange!=null&&(this.savedRange=this.lastRange),!(0,T.default)(ie,this.lastRange)){var we;!this.composing&&xe!=null&&xe.native.collapsed&&xe.start.node!==this.cursor.textNode&&this.cursor.restore();var Ae=[N.default.events.SELECTION_CHANGE,(0,S.default)(this.lastRange),(0,S.default)(ie),ne];if((we=this.emitter).emit.apply(we,[N.default.events.EDITOR_CHANGE].concat(Ae)),ne!==N.default.sources.SILENT){var Ce;(Ce=this.emitter).emit.apply(Ce,Ae)}}}}]),te}();function J(te,ae){try{ae.parentNode}catch{return!1}return ae instanceof Text&&(ae=ae.parentNode),te.contains(ae)}n.Range=U,n.default=Z},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function N(I,j){for(var D=0;D<j.length;D++){var R=j[D];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(I,R.key,R)}}return function(I,j,D){return j&&N(I.prototype,j),D&&N(I,D),I}}(),d=function N(I,j,D){I===null&&(I=Function.prototype);var R=Object.getOwnPropertyDescriptor(I,j);if(R===void 0){var F=Object.getPrototypeOf(I);return F===null?void 0:N(F,j,D)}else{if("value"in R)return R.value;var B=R.get;return B===void 0?void 0:B.call(D)}},i=o(0),g=_(i);function _(N){return N&&N.__esModule?N:{default:N}}function S(N,I){if(!(N instanceof I))throw new TypeError("Cannot call a class as a function")}function E(N,I){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I&&(typeof I=="object"||typeof I=="function")?I:N}function T(N,I){if(typeof I!="function"&&I!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof I);N.prototype=Object.create(I&&I.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),I&&(Object.setPrototypeOf?Object.setPrototypeOf(N,I):N.__proto__=I)}var C=function(N){T(I,N);function I(){return S(this,I),E(this,(I.__proto__||Object.getPrototypeOf(I)).apply(this,arguments))}return l(I,[{key:"insertInto",value:function(D,R){D.children.length===0?d(I.prototype.__proto__||Object.getPrototypeOf(I.prototype),"insertInto",this).call(this,D,R):this.remove()}},{key:"length",value:function(){return 0}},{key:"value",value:function(){return""}}],[{key:"value",value:function(){}}]),I}(g.default.Embed);C.blotName="break",C.tagName="BR",n.default=C},function(r,n,o){var l=this&&this.__extends||function(){var E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,C){T.__proto__=C}||function(T,C){for(var N in C)C.hasOwnProperty(N)&&(T[N]=C[N])};return function(T,C){E(T,C);function N(){this.constructor=T}T.prototype=C===null?Object.create(C):(N.prototype=C.prototype,new N)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=o(44),i=o(30),g=o(1),_=function(E){l(T,E);function T(C){var N=E.call(this,C)||this;return N.build(),N}return T.prototype.appendChild=function(C){this.insertBefore(C)},T.prototype.attach=function(){E.prototype.attach.call(this),this.children.forEach(function(C){C.attach()})},T.prototype.build=function(){var C=this;this.children=new d.default,[].slice.call(this.domNode.childNodes).reverse().forEach(function(N){try{var I=S(N);C.insertBefore(I,C.children.head||void 0)}catch(j){if(j instanceof g.ParchmentError)return;throw j}})},T.prototype.deleteAt=function(C,N){if(C===0&&N===this.length())return this.remove();this.children.forEachAt(C,N,function(I,j,D){I.deleteAt(j,D)})},T.prototype.descendant=function(C,N){var I=this.children.find(N),j=I[0],D=I[1];return C.blotName==null&&C(j)||C.blotName!=null&&j instanceof C?[j,D]:j instanceof T?j.descendant(C,D):[null,-1]},T.prototype.descendants=function(C,N,I){N===void 0&&(N=0),I===void 0&&(I=Number.MAX_VALUE);var j=[],D=I;return this.children.forEachAt(N,I,function(R,F,B){(C.blotName==null&&C(R)||C.blotName!=null&&R instanceof C)&&j.push(R),R instanceof T&&(j=j.concat(R.descendants(C,F,D))),D-=B}),j},T.prototype.detach=function(){this.children.forEach(function(C){C.detach()}),E.prototype.detach.call(this)},T.prototype.formatAt=function(C,N,I,j){this.children.forEachAt(C,N,function(D,R,F){D.formatAt(R,F,I,j)})},T.prototype.insertAt=function(C,N,I){var j=this.children.find(C),D=j[0],R=j[1];if(D)D.insertAt(R,N,I);else{var F=I==null?g.create("text",N):g.create(N,I);this.appendChild(F)}},T.prototype.insertBefore=function(C,N){if(this.statics.allowedChildren!=null&&!this.statics.allowedChildren.some(function(I){return C instanceof I}))throw new g.ParchmentError("Cannot insert "+C.statics.blotName+" into "+this.statics.blotName);C.insertInto(this,N)},T.prototype.length=function(){return this.children.reduce(function(C,N){return C+N.length()},0)},T.prototype.moveChildren=function(C,N){this.children.forEach(function(I){C.insertBefore(I,N)})},T.prototype.optimize=function(C){if(E.prototype.optimize.call(this,C),this.children.length===0)if(this.statics.defaultChild!=null){var N=g.create(this.statics.defaultChild);this.appendChild(N),N.optimize(C)}else this.remove()},T.prototype.path=function(C,N){N===void 0&&(N=!1);var I=this.children.find(C,N),j=I[0],D=I[1],R=[[this,C]];return j instanceof T?R.concat(j.path(D,N)):(j!=null&&R.push([j,D]),R)},T.prototype.removeChild=function(C){this.children.remove(C)},T.prototype.replace=function(C){C instanceof T&&C.moveChildren(this),E.prototype.replace.call(this,C)},T.prototype.split=function(C,N){if(N===void 0&&(N=!1),!N){if(C===0)return this;if(C===this.length())return this.next}var I=this.clone();return this.parent.insertBefore(I,this.next),this.children.forEachAt(C,this.length(),function(j,D,R){j=j.split(D,N),I.appendChild(j)}),I},T.prototype.unwrap=function(){this.moveChildren(this.parent,this.next),this.remove()},T.prototype.update=function(C,N){var I=this,j=[],D=[];C.forEach(function(R){R.target===I.domNode&&R.type==="childList"&&(j.push.apply(j,R.addedNodes),D.push.apply(D,R.removedNodes))}),D.forEach(function(R){if(!(R.parentNode!=null&&R.tagName!=="IFRAME"&&document.body.compareDocumentPosition(R)&Node.DOCUMENT_POSITION_CONTAINED_BY)){var F=g.find(R);F!=null&&(F.domNode.parentNode==null||F.domNode.parentNode===I.domNode)&&F.detach()}}),j.filter(function(R){return R.parentNode==I.domNode}).sort(function(R,F){return R===F?0:R.compareDocumentPosition(F)&Node.DOCUMENT_POSITION_FOLLOWING?1:-1}).forEach(function(R){var F=null;R.nextSibling!=null&&(F=g.find(R.nextSibling));var B=S(R);(B.next!=F||B.next==null)&&(B.parent!=null&&B.parent.removeChild(I),I.insertBefore(B,F||void 0))})},T}(i.default);function S(E){var T=g.find(E);if(T==null)try{T=g.create(E)}catch{T=g.create(g.Scope.INLINE),[].slice.call(E.childNodes).forEach(function(N){T.domNode.appendChild(N)}),E.parentNode&&E.parentNode.replaceChild(T.domNode,E),T.attach()}return T}n.default=_},function(r,n,o){var l=this&&this.__extends||function(){var E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,C){T.__proto__=C}||function(T,C){for(var N in C)C.hasOwnProperty(N)&&(T[N]=C[N])};return function(T,C){E(T,C);function N(){this.constructor=T}T.prototype=C===null?Object.create(C):(N.prototype=C.prototype,new N)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=o(12),i=o(31),g=o(17),_=o(1),S=function(E){l(T,E);function T(C){var N=E.call(this,C)||this;return N.attributes=new i.default(N.domNode),N}return T.formats=function(C){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return C.tagName.toLowerCase()},T.prototype.format=function(C,N){var I=_.query(C);I instanceof d.default?this.attributes.attribute(I,N):N&&I!=null&&(C!==this.statics.blotName||this.formats()[C]!==N)&&this.replaceWith(C,N)},T.prototype.formats=function(){var C=this.attributes.values(),N=this.statics.formats(this.domNode);return N!=null&&(C[this.statics.blotName]=N),C},T.prototype.replaceWith=function(C,N){var I=E.prototype.replaceWith.call(this,C,N);return this.attributes.copy(I),I},T.prototype.update=function(C,N){var I=this;E.prototype.update.call(this,C,N),C.some(function(j){return j.target===I.domNode&&j.type==="attributes"})&&this.attributes.build()},T.prototype.wrap=function(C,N){var I=E.prototype.wrap.call(this,C,N);return I instanceof T&&I.statics.scope===this.statics.scope&&this.attributes.move(I),I},T}(g.default);n.default=S},function(r,n,o){var l=this&&this.__extends||function(){var _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,E){S.__proto__=E}||function(S,E){for(var T in E)E.hasOwnProperty(T)&&(S[T]=E[T])};return function(S,E){_(S,E);function T(){this.constructor=S}S.prototype=E===null?Object.create(E):(T.prototype=E.prototype,new T)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=o(30),i=o(1),g=function(_){l(S,_);function S(){return _!==null&&_.apply(this,arguments)||this}return S.value=function(E){return!0},S.prototype.index=function(E,T){return this.domNode===E||this.domNode.compareDocumentPosition(E)&Node.DOCUMENT_POSITION_CONTAINED_BY?Math.min(T,1):-1},S.prototype.position=function(E,T){var C=[].indexOf.call(this.parent.domNode.childNodes,this.domNode);return E>0&&(C+=1),[this.parent.domNode,C]},S.prototype.value=function(){var E;return E={},E[this.statics.blotName]=this.statics.value(this.domNode)||!0,E},S.scope=i.Scope.INLINE_BLOT,S}(d.default);n.default=g},function(r,n,o){var l=o(11),d=o(3),i={attributes:{compose:function(_,S,E){typeof _!="object"&&(_={}),typeof S!="object"&&(S={});var T=d(!0,{},S);E||(T=Object.keys(T).reduce(function(N,I){return T[I]!=null&&(N[I]=T[I]),N},{}));for(var C in _)_[C]!==void 0&&S[C]===void 0&&(T[C]=_[C]);return Object.keys(T).length>0?T:void 0},diff:function(_,S){typeof _!="object"&&(_={}),typeof S!="object"&&(S={});var E=Object.keys(_).concat(Object.keys(S)).reduce(function(T,C){return l(_[C],S[C])||(T[C]=S[C]===void 0?null:S[C]),T},{});return Object.keys(E).length>0?E:void 0},transform:function(_,S,E){if(typeof _!="object")return S;if(typeof S=="object"){if(!E)return S;var T=Object.keys(S).reduce(function(C,N){return _[N]===void 0&&(C[N]=S[N]),C},{});return Object.keys(T).length>0?T:void 0}}},iterator:function(_){return new g(_)},length:function(_){return typeof _.delete=="number"?_.delete:typeof _.retain=="number"?_.retain:typeof _.insert=="string"?_.insert.length:1}};function g(_){this.ops=_,this.index=0,this.offset=0}g.prototype.hasNext=function(){return this.peekLength()<1/0},g.prototype.next=function(_){_||(_=1/0);var S=this.ops[this.index];if(S){var E=this.offset,T=i.length(S);if(_>=T-E?(_=T-E,this.index+=1,this.offset=0):this.offset+=_,typeof S.delete=="number")return{delete:_};var C={};return S.attributes&&(C.attributes=S.attributes),typeof S.retain=="number"?C.retain=_:typeof S.insert=="string"?C.insert=S.insert.substr(E,_):C.insert=S.insert,C}else return{retain:1/0}},g.prototype.peek=function(){return this.ops[this.index]},g.prototype.peekLength=function(){return this.ops[this.index]?i.length(this.ops[this.index])-this.offset:1/0},g.prototype.peekType=function(){return this.ops[this.index]?typeof this.ops[this.index].delete=="number"?"delete":typeof this.ops[this.index].retain=="number"?"retain":"insert":"retain"},g.prototype.rest=function(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);var _=this.offset,S=this.index,E=this.next(),T=this.ops.slice(this.index);return this.offset=_,this.index=S,[E].concat(T)}else return[]},r.exports=i},function(r,n){var o=function(){function l(I,j){return j!=null&&I instanceof j}var d;try{d=Map}catch{d=function(){}}var i;try{i=Set}catch{i=function(){}}var g;try{g=Promise}catch{g=function(){}}function _(I,j,D,R,F){typeof j=="object"&&(D=j.depth,R=j.prototype,F=j.includeNonEnumerable,j=j.circular);var B=[],U=[],Z=typeof Buffer<"u";typeof j>"u"&&(j=!0),typeof D>"u"&&(D=1/0);function J(te,ae){if(te===null)return null;if(ae===0)return te;var ne,ie;if(typeof te!="object")return te;if(l(te,d))ne=new d;else if(l(te,i))ne=new i;else if(l(te,g))ne=new g(function(Pe,ye){te.then(function(pe){Pe(J(pe,ae-1))},function(pe){ye(J(pe,ae-1))})});else if(_.__isArray(te))ne=[];else if(_.__isRegExp(te))ne=new RegExp(te.source,N(te)),te.lastIndex&&(ne.lastIndex=te.lastIndex);else if(_.__isDate(te))ne=new Date(te.getTime());else{if(Z&&Buffer.isBuffer(te))return Buffer.allocUnsafe?ne=Buffer.allocUnsafe(te.length):ne=new Buffer(te.length),te.copy(ne),ne;l(te,Error)?ne=Object.create(te):typeof R>"u"?(ie=Object.getPrototypeOf(te),ne=Object.create(ie)):(ne=Object.create(R),ie=R)}if(j){var ee=B.indexOf(te);if(ee!=-1)return U[ee];B.push(te),U.push(ne)}l(te,d)&&te.forEach(function(Pe,ye){var pe=J(ye,ae-1),Ie=J(Pe,ae-1);ne.set(pe,Ie)}),l(te,i)&&te.forEach(function(Pe){var ye=J(Pe,ae-1);ne.add(ye)});for(var oe in te){var de;ie&&(de=Object.getOwnPropertyDescriptor(ie,oe)),!(de&&de.set==null)&&(ne[oe]=J(te[oe],ae-1))}if(Object.getOwnPropertySymbols)for(var xe=Object.getOwnPropertySymbols(te),oe=0;oe<xe.length;oe++){var we=xe[oe],Ae=Object.getOwnPropertyDescriptor(te,we);Ae&&!Ae.enumerable&&!F||(ne[we]=J(te[we],ae-1),Ae.enumerable||Object.defineProperty(ne,we,{enumerable:!1}))}if(F)for(var Ce=Object.getOwnPropertyNames(te),oe=0;oe<Ce.length;oe++){var me=Ce[oe],Ae=Object.getOwnPropertyDescriptor(te,me);Ae&&Ae.enumerable||(ne[me]=J(te[me],ae-1),Object.defineProperty(ne,me,{enumerable:!1}))}return ne}return J(I,D)}_.clonePrototype=function(j){if(j===null)return null;var D=function(){};return D.prototype=j,new D};function S(I){return Object.prototype.toString.call(I)}_.__objToStr=S;function E(I){return typeof I=="object"&&S(I)==="[object Date]"}_.__isDate=E;function T(I){return typeof I=="object"&&S(I)==="[object Array]"}_.__isArray=T;function C(I){return typeof I=="object"&&S(I)==="[object RegExp]"}_.__isRegExp=C;function N(I){var j="";return I.global&&(j+="g"),I.ignoreCase&&(j+="i"),I.multiline&&(j+="m"),j}return _.__getRegExpFlags=N,_}();typeof r=="object"&&r.exports&&(r.exports=o)},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function ne(ie,ee){var oe=[],de=!0,xe=!1,we=void 0;try{for(var Ae=ie[Symbol.iterator](),Ce;!(de=(Ce=Ae.next()).done)&&(oe.push(Ce.value),!(ee&&oe.length===ee));de=!0);}catch(me){xe=!0,we=me}finally{try{!de&&Ae.return&&Ae.return()}finally{if(xe)throw we}}return oe}return function(ie,ee){if(Array.isArray(ie))return ie;if(Symbol.iterator in Object(ie))return ne(ie,ee);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(){function ne(ie,ee){for(var oe=0;oe<ee.length;oe++){var de=ee[oe];de.enumerable=de.enumerable||!1,de.configurable=!0,"value"in de&&(de.writable=!0),Object.defineProperty(ie,de.key,de)}}return function(ie,ee,oe){return ee&&ne(ie.prototype,ee),oe&&ne(ie,oe),ie}}(),i=function ne(ie,ee,oe){ie===null&&(ie=Function.prototype);var de=Object.getOwnPropertyDescriptor(ie,ee);if(de===void 0){var xe=Object.getPrototypeOf(ie);return xe===null?void 0:ne(xe,ee,oe)}else{if("value"in de)return de.value;var we=de.get;return we===void 0?void 0:we.call(oe)}},g=o(0),_=B(g),S=o(8),E=B(S),T=o(4),C=B(T),N=o(16),I=B(N),j=o(13),D=B(j),R=o(25),F=B(R);function B(ne){return ne&&ne.__esModule?ne:{default:ne}}function U(ne,ie){if(!(ne instanceof ie))throw new TypeError("Cannot call a class as a function")}function Z(ne,ie){if(!ne)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ie&&(typeof ie=="object"||typeof ie=="function")?ie:ne}function J(ne,ie){if(typeof ie!="function"&&ie!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof ie);ne.prototype=Object.create(ie&&ie.prototype,{constructor:{value:ne,enumerable:!1,writable:!0,configurable:!0}}),ie&&(Object.setPrototypeOf?Object.setPrototypeOf(ne,ie):ne.__proto__=ie)}function te(ne){return ne instanceof C.default||ne instanceof T.BlockEmbed}var ae=function(ne){J(ie,ne);function ie(ee,oe){U(this,ie);var de=Z(this,(ie.__proto__||Object.getPrototypeOf(ie)).call(this,ee));return de.emitter=oe.emitter,Array.isArray(oe.whitelist)&&(de.whitelist=oe.whitelist.reduce(function(xe,we){return xe[we]=!0,xe},{})),de.domNode.addEventListener("DOMNodeInserted",function(){}),de.optimize(),de.enable(),de}return d(ie,[{key:"batchStart",value:function(){this.batch=!0}},{key:"batchEnd",value:function(){this.batch=!1,this.optimize()}},{key:"deleteAt",value:function(oe,de){var xe=this.line(oe),we=l(xe,2),Ae=we[0],Ce=we[1],me=this.line(oe+de),Pe=l(me,1),ye=Pe[0];if(i(ie.prototype.__proto__||Object.getPrototypeOf(ie.prototype),"deleteAt",this).call(this,oe,de),ye!=null&&Ae!==ye&&Ce>0){if(Ae instanceof T.BlockEmbed||ye instanceof T.BlockEmbed){this.optimize();return}if(Ae instanceof D.default){var pe=Ae.newlineIndex(Ae.length(),!0);if(pe>-1&&(Ae=Ae.split(pe+1),Ae===ye)){this.optimize();return}}else if(ye instanceof D.default){var Ie=ye.newlineIndex(0);Ie>-1&&ye.split(Ie+1)}var tt=ye.children.head instanceof I.default?null:ye.children.head;Ae.moveChildren(ye,tt),Ae.remove()}this.optimize()}},{key:"enable",value:function(){var oe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.domNode.setAttribute("contenteditable",oe)}},{key:"formatAt",value:function(oe,de,xe,we){this.whitelist!=null&&!this.whitelist[xe]||(i(ie.prototype.__proto__||Object.getPrototypeOf(ie.prototype),"formatAt",this).call(this,oe,de,xe,we),this.optimize())}},{key:"insertAt",value:function(oe,de,xe){if(!(xe!=null&&this.whitelist!=null&&!this.whitelist[de])){if(oe>=this.length())if(xe==null||_.default.query(de,_.default.Scope.BLOCK)==null){var we=_.default.create(this.statics.defaultChild);this.appendChild(we),xe==null&&de.endsWith(`
`)&&(de=de.slice(0,-1)),we.insertAt(0,de,xe)}else{var Ae=_.default.create(de,xe);this.appendChild(Ae)}else i(ie.prototype.__proto__||Object.getPrototypeOf(ie.prototype),"insertAt",this).call(this,oe,de,xe);this.optimize()}}},{key:"insertBefore",value:function(oe,de){if(oe.statics.scope===_.default.Scope.INLINE_BLOT){var xe=_.default.create(this.statics.defaultChild);xe.appendChild(oe),oe=xe}i(ie.prototype.__proto__||Object.getPrototypeOf(ie.prototype),"insertBefore",this).call(this,oe,de)}},{key:"leaf",value:function(oe){return this.path(oe).pop()||[null,-1]}},{key:"line",value:function(oe){return oe===this.length()?this.line(oe-1):this.descendant(te,oe)}},{key:"lines",value:function(){var oe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,de=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE,xe=function we(Ae,Ce,me){var Pe=[],ye=me;return Ae.children.forEachAt(Ce,me,function(pe,Ie,tt){te(pe)?Pe.push(pe):pe instanceof _.default.Container&&(Pe=Pe.concat(we(pe,Ie,ye))),ye-=tt}),Pe};return xe(this,oe,de)}},{key:"optimize",value:function(){var oe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],de=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.batch!==!0&&(i(ie.prototype.__proto__||Object.getPrototypeOf(ie.prototype),"optimize",this).call(this,oe,de),oe.length>0&&this.emitter.emit(E.default.events.SCROLL_OPTIMIZE,oe,de))}},{key:"path",value:function(oe){return i(ie.prototype.__proto__||Object.getPrototypeOf(ie.prototype),"path",this).call(this,oe).slice(1)}},{key:"update",value:function(oe){if(this.batch!==!0){var de=E.default.sources.USER;typeof oe=="string"&&(de=oe),Array.isArray(oe)||(oe=this.observer.takeRecords()),oe.length>0&&this.emitter.emit(E.default.events.SCROLL_BEFORE_UPDATE,de,oe),i(ie.prototype.__proto__||Object.getPrototypeOf(ie.prototype),"update",this).call(this,oe.concat([])),oe.length>0&&this.emitter.emit(E.default.events.SCROLL_UPDATE,de,oe)}}}]),ie}(_.default.Scroll);ae.blotName="scroll",ae.className="ql-editor",ae.tagName="DIV",ae.defaultChild="block",ae.allowedChildren=[C.default,T.BlockEmbed,F.default],n.default=ae},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.SHORTKEY=n.default=void 0;var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Le){return typeof Le}:function(Le){return Le&&typeof Symbol=="function"&&Le.constructor===Symbol&&Le!==Symbol.prototype?"symbol":typeof Le},d=function(){function Le(qe,Ge){var je=[],ot=!0,St=!1,rt=void 0;try{for(var Ut=qe[Symbol.iterator](),Ft;!(ot=(Ft=Ut.next()).done)&&(je.push(Ft.value),!(Ge&&je.length===Ge));ot=!0);}catch(dr){St=!0,rt=dr}finally{try{!ot&&Ut.return&&Ut.return()}finally{if(St)throw rt}}return je}return function(qe,Ge){if(Array.isArray(qe))return qe;if(Symbol.iterator in Object(qe))return Le(qe,Ge);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function Le(qe,Ge){for(var je=0;je<Ge.length;je++){var ot=Ge[je];ot.enumerable=ot.enumerable||!1,ot.configurable=!0,"value"in ot&&(ot.writable=!0),Object.defineProperty(qe,ot.key,ot)}}return function(qe,Ge,je){return Ge&&Le(qe.prototype,Ge),je&&Le(qe,je),qe}}(),g=o(21),_=ne(g),S=o(11),E=ne(S),T=o(3),C=ne(T),N=o(2),I=ne(N),j=o(20),D=ne(j),R=o(0),F=ne(R),B=o(5),U=ne(B),Z=o(10),J=ne(Z),te=o(9),ae=ne(te);function ne(Le){return Le&&Le.__esModule?Le:{default:Le}}function ie(Le,qe,Ge){return qe in Le?Object.defineProperty(Le,qe,{value:Ge,enumerable:!0,configurable:!0,writable:!0}):Le[qe]=Ge,Le}function ee(Le,qe){if(!(Le instanceof qe))throw new TypeError("Cannot call a class as a function")}function oe(Le,qe){if(!Le)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return qe&&(typeof qe=="object"||typeof qe=="function")?qe:Le}function de(Le,qe){if(typeof qe!="function"&&qe!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof qe);Le.prototype=Object.create(qe&&qe.prototype,{constructor:{value:Le,enumerable:!1,writable:!0,configurable:!0}}),qe&&(Object.setPrototypeOf?Object.setPrototypeOf(Le,qe):Le.__proto__=qe)}var xe=(0,J.default)("quill:keyboard"),we=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey",Ae=function(Le){de(qe,Le),i(qe,null,[{key:"match",value:function(je,ot){return ot=Ze(ot),["altKey","ctrlKey","metaKey","shiftKey"].some(function(St){return!!ot[St]!==je[St]&&ot[St]!==null})?!1:ot.key===(je.which||je.keyCode)}}]);function qe(Ge,je){ee(this,qe);var ot=oe(this,(qe.__proto__||Object.getPrototypeOf(qe)).call(this,Ge,je));return ot.bindings={},Object.keys(ot.options.bindings).forEach(function(St){St==="list autofill"&&Ge.scroll.whitelist!=null&&!Ge.scroll.whitelist.list||ot.options.bindings[St]&&ot.addBinding(ot.options.bindings[St])}),ot.addBinding({key:qe.keys.ENTER,shiftKey:null},pe),ot.addBinding({key:qe.keys.ENTER,metaKey:null,ctrlKey:null,altKey:null},function(){}),/Firefox/i.test(navigator.userAgent)?(ot.addBinding({key:qe.keys.BACKSPACE},{collapsed:!0},me),ot.addBinding({key:qe.keys.DELETE},{collapsed:!0},Pe)):(ot.addBinding({key:qe.keys.BACKSPACE},{collapsed:!0,prefix:/^.?$/},me),ot.addBinding({key:qe.keys.DELETE},{collapsed:!0,suffix:/^.?$/},Pe)),ot.addBinding({key:qe.keys.BACKSPACE},{collapsed:!1},ye),ot.addBinding({key:qe.keys.DELETE},{collapsed:!1},ye),ot.addBinding({key:qe.keys.BACKSPACE,altKey:null,ctrlKey:null,metaKey:null,shiftKey:null},{collapsed:!0,offset:0},me),ot.listen(),ot}return i(qe,[{key:"addBinding",value:function(je){var ot=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},St=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},rt=Ze(je);if(rt==null||rt.key==null)return xe.warn("Attempted to add invalid keyboard binding",rt);typeof ot=="function"&&(ot={handler:ot}),typeof St=="function"&&(St={handler:St}),rt=(0,C.default)(rt,ot,St),this.bindings[rt.key]=this.bindings[rt.key]||[],this.bindings[rt.key].push(rt)}},{key:"listen",value:function(){var je=this;this.quill.root.addEventListener("keydown",function(ot){if(!ot.defaultPrevented){var St=ot.which||ot.keyCode,rt=(je.bindings[St]||[]).filter(function(gi){return qe.match(ot,gi)});if(rt.length!==0){var Ut=je.quill.getSelection();if(!(Ut==null||!je.quill.hasFocus())){var Ft=je.quill.getLine(Ut.index),dr=d(Ft,2),Lr=dr[0],Jr=dr[1],Rt=je.quill.getLeaf(Ut.index),At=d(Rt,2),Xe=At[0],ut=At[1],dt=Ut.length===0?[Xe,ut]:je.quill.getLeaf(Ut.index+Ut.length),rr=d(dt,2),er=rr[0],tr=rr[1],Pr=Xe instanceof F.default.Text?Xe.value().slice(0,ut):"",un=er instanceof F.default.Text?er.value().slice(tr):"",pn={collapsed:Ut.length===0,empty:Ut.length===0&&Lr.length()<=1,format:je.quill.getFormat(Ut),offset:Jr,prefix:Pr,suffix:un},Pi=rt.some(function(gi){if(gi.collapsed!=null&&gi.collapsed!==pn.collapsed||gi.empty!=null&&gi.empty!==pn.empty||gi.offset!=null&&gi.offset!==pn.offset)return!1;if(Array.isArray(gi.format)){if(gi.format.every(function(Zi){return pn.format[Zi]==null}))return!1}else if(l(gi.format)==="object"&&!Object.keys(gi.format).every(function(Zi){return gi.format[Zi]===!0?pn.format[Zi]!=null:gi.format[Zi]===!1?pn.format[Zi]==null:(0,E.default)(gi.format[Zi],pn.format[Zi])}))return!1;return gi.prefix!=null&&!gi.prefix.test(pn.prefix)||gi.suffix!=null&&!gi.suffix.test(pn.suffix)?!1:gi.handler.call(je,Ut,pn)!==!0});Pi&&ot.preventDefault()}}}})}}]),qe}(ae.default);Ae.keys={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46},Ae.DEFAULTS={bindings:{bold:tt("bold"),italic:tt("italic"),underline:tt("underline"),indent:{key:Ae.keys.TAB,format:["blockquote","indent","list"],handler:function(qe,Ge){if(Ge.collapsed&&Ge.offset!==0)return!0;this.quill.format("indent","+1",U.default.sources.USER)}},outdent:{key:Ae.keys.TAB,shiftKey:!0,format:["blockquote","indent","list"],handler:function(qe,Ge){if(Ge.collapsed&&Ge.offset!==0)return!0;this.quill.format("indent","-1",U.default.sources.USER)}},"outdent backspace":{key:Ae.keys.BACKSPACE,collapsed:!0,shiftKey:null,metaKey:null,ctrlKey:null,altKey:null,format:["indent","list"],offset:0,handler:function(qe,Ge){Ge.format.indent!=null?this.quill.format("indent","-1",U.default.sources.USER):Ge.format.list!=null&&this.quill.format("list",!1,U.default.sources.USER)}},"indent code-block":Ie(!0),"outdent code-block":Ie(!1),"remove tab":{key:Ae.keys.TAB,shiftKey:!0,collapsed:!0,prefix:/\t$/,handler:function(qe){this.quill.deleteText(qe.index-1,1,U.default.sources.USER)}},tab:{key:Ae.keys.TAB,handler:function(qe){this.quill.history.cutoff();var Ge=new I.default().retain(qe.index).delete(qe.length).insert("	");this.quill.updateContents(Ge,U.default.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(qe.index+1,U.default.sources.SILENT)}},"list empty enter":{key:Ae.keys.ENTER,collapsed:!0,format:["list"],empty:!0,handler:function(qe,Ge){this.quill.format("list",!1,U.default.sources.USER),Ge.format.indent&&this.quill.format("indent",!1,U.default.sources.USER)}},"checklist enter":{key:Ae.keys.ENTER,collapsed:!0,format:{list:"checked"},handler:function(qe){var Ge=this.quill.getLine(qe.index),je=d(Ge,2),ot=je[0],St=je[1],rt=(0,C.default)({},ot.formats(),{list:"checked"}),Ut=new I.default().retain(qe.index).insert(`
`,rt).retain(ot.length()-St-1).retain(1,{list:"unchecked"});this.quill.updateContents(Ut,U.default.sources.USER),this.quill.setSelection(qe.index+1,U.default.sources.SILENT),this.quill.scrollIntoView()}},"header enter":{key:Ae.keys.ENTER,collapsed:!0,format:["header"],suffix:/^$/,handler:function(qe,Ge){var je=this.quill.getLine(qe.index),ot=d(je,2),St=ot[0],rt=ot[1],Ut=new I.default().retain(qe.index).insert(`
`,Ge.format).retain(St.length()-rt-1).retain(1,{header:null});this.quill.updateContents(Ut,U.default.sources.USER),this.quill.setSelection(qe.index+1,U.default.sources.SILENT),this.quill.scrollIntoView()}},"list autofill":{key:" ",collapsed:!0,format:{list:!1},prefix:/^\s*?(\d+\.|-|\*|\[ ?\]|\[x\])$/,handler:function(qe,Ge){var je=Ge.prefix.length,ot=this.quill.getLine(qe.index),St=d(ot,2),rt=St[0],Ut=St[1];if(Ut>je)return!0;var Ft=void 0;switch(Ge.prefix.trim()){case"[]":case"[ ]":Ft="unchecked";break;case"[x]":Ft="checked";break;case"-":case"*":Ft="bullet";break;default:Ft="ordered"}this.quill.insertText(qe.index," ",U.default.sources.USER),this.quill.history.cutoff();var dr=new I.default().retain(qe.index-Ut).delete(je+1).retain(rt.length()-2-Ut).retain(1,{list:Ft});this.quill.updateContents(dr,U.default.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(qe.index-je,U.default.sources.SILENT)}},"code exit":{key:Ae.keys.ENTER,collapsed:!0,format:["code-block"],prefix:/\n\n$/,suffix:/^\s+$/,handler:function(qe){var Ge=this.quill.getLine(qe.index),je=d(Ge,2),ot=je[0],St=je[1],rt=new I.default().retain(qe.index+ot.length()-St-2).retain(1,{"code-block":null}).delete(1);this.quill.updateContents(rt,U.default.sources.USER)}},"embed left":Ce(Ae.keys.LEFT,!1),"embed left shift":Ce(Ae.keys.LEFT,!0),"embed right":Ce(Ae.keys.RIGHT,!1),"embed right shift":Ce(Ae.keys.RIGHT,!0)}};function Ce(Le,qe){var Ge,je=Le===Ae.keys.LEFT?"prefix":"suffix";return Ge={key:Le,shiftKey:qe,altKey:null},ie(Ge,je,/^$/),ie(Ge,"handler",function(St){var rt=St.index;Le===Ae.keys.RIGHT&&(rt+=St.length+1);var Ut=this.quill.getLeaf(rt),Ft=d(Ut,1),dr=Ft[0];return dr instanceof F.default.Embed?(Le===Ae.keys.LEFT?qe?this.quill.setSelection(St.index-1,St.length+1,U.default.sources.USER):this.quill.setSelection(St.index-1,U.default.sources.USER):qe?this.quill.setSelection(St.index,St.length+1,U.default.sources.USER):this.quill.setSelection(St.index+St.length+1,U.default.sources.USER),!1):!0}),Ge}function me(Le,qe){if(!(Le.index===0||this.quill.getLength()<=1)){var Ge=this.quill.getLine(Le.index),je=d(Ge,1),ot=je[0],St={};if(qe.offset===0){var rt=this.quill.getLine(Le.index-1),Ut=d(rt,1),Ft=Ut[0];if(Ft!=null&&Ft.length()>1){var dr=ot.formats(),Lr=this.quill.getFormat(Le.index-1,1);St=D.default.attributes.diff(dr,Lr)||{}}}var Jr=/[\uD800-\uDBFF][\uDC00-\uDFFF]$/.test(qe.prefix)?2:1;this.quill.deleteText(Le.index-Jr,Jr,U.default.sources.USER),Object.keys(St).length>0&&this.quill.formatLine(Le.index-Jr,Jr,St,U.default.sources.USER),this.quill.focus()}}function Pe(Le,qe){var Ge=/^[\uD800-\uDBFF][\uDC00-\uDFFF]/.test(qe.suffix)?2:1;if(!(Le.index>=this.quill.getLength()-Ge)){var je={},ot=0,St=this.quill.getLine(Le.index),rt=d(St,1),Ut=rt[0];if(qe.offset>=Ut.length()-1){var Ft=this.quill.getLine(Le.index+1),dr=d(Ft,1),Lr=dr[0];if(Lr){var Jr=Ut.formats(),Rt=this.quill.getFormat(Le.index,1);je=D.default.attributes.diff(Jr,Rt)||{},ot=Lr.length()}}this.quill.deleteText(Le.index,Ge,U.default.sources.USER),Object.keys(je).length>0&&this.quill.formatLine(Le.index+ot-1,Ge,je,U.default.sources.USER)}}function ye(Le){var qe=this.quill.getLines(Le),Ge={};if(qe.length>1){var je=qe[0].formats(),ot=qe[qe.length-1].formats();Ge=D.default.attributes.diff(ot,je)||{}}this.quill.deleteText(Le,U.default.sources.USER),Object.keys(Ge).length>0&&this.quill.formatLine(Le.index,1,Ge,U.default.sources.USER),this.quill.setSelection(Le.index,U.default.sources.SILENT),this.quill.focus()}function pe(Le,qe){var Ge=this;Le.length>0&&this.quill.scroll.deleteAt(Le.index,Le.length);var je=Object.keys(qe.format).reduce(function(ot,St){return F.default.query(St,F.default.Scope.BLOCK)&&!Array.isArray(qe.format[St])&&(ot[St]=qe.format[St]),ot},{});this.quill.insertText(Le.index,`
`,je,U.default.sources.USER),this.quill.setSelection(Le.index+1,U.default.sources.SILENT),this.quill.focus(),Object.keys(qe.format).forEach(function(ot){je[ot]==null&&(Array.isArray(qe.format[ot])||ot!=="link"&&Ge.quill.format(ot,qe.format[ot],U.default.sources.USER))})}function Ie(Le){return{key:Ae.keys.TAB,shiftKey:!Le,format:{"code-block":!0},handler:function(Ge){var je=F.default.query("code-block"),ot=Ge.index,St=Ge.length,rt=this.quill.scroll.descendant(je,ot),Ut=d(rt,2),Ft=Ut[0],dr=Ut[1];if(Ft!=null){var Lr=this.quill.getIndex(Ft),Jr=Ft.newlineIndex(dr,!0)+1,Rt=Ft.newlineIndex(Lr+dr+St),At=Ft.domNode.textContent.slice(Jr,Rt).split(`
`);dr=0,At.forEach(function(Xe,ut){Le?(Ft.insertAt(Jr+dr,je.TAB),dr+=je.TAB.length,ut===0?ot+=je.TAB.length:St+=je.TAB.length):Xe.startsWith(je.TAB)&&(Ft.deleteAt(Jr+dr,je.TAB.length),dr-=je.TAB.length,ut===0?ot-=je.TAB.length:St-=je.TAB.length),dr+=Xe.length+1}),this.quill.update(U.default.sources.USER),this.quill.setSelection(ot,St,U.default.sources.SILENT)}}}}function tt(Le){return{key:Le[0].toUpperCase(),shortKey:!0,handler:function(Ge,je){this.quill.format(Le,!je.format[Le],U.default.sources.USER)}}}function Ze(Le){if(typeof Le=="string"||typeof Le=="number")return Ze({key:Le});if((typeof Le>"u"?"undefined":l(Le))==="object"&&(Le=(0,_.default)(Le,!1)),typeof Le.key=="string")if(Ae.keys[Le.key.toUpperCase()]!=null)Le.key=Ae.keys[Le.key.toUpperCase()];else if(Le.key.length===1)Le.key=Le.key.toUpperCase().charCodeAt(0);else return null;return Le.shortKey&&(Le[we]=Le.shortKey,delete Le.shortKey),Le}n.default=Ae,n.SHORTKEY=we},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function D(R,F){var B=[],U=!0,Z=!1,J=void 0;try{for(var te=R[Symbol.iterator](),ae;!(U=(ae=te.next()).done)&&(B.push(ae.value),!(F&&B.length===F));U=!0);}catch(ne){Z=!0,J=ne}finally{try{!U&&te.return&&te.return()}finally{if(Z)throw J}}return B}return function(R,F){if(Array.isArray(R))return R;if(Symbol.iterator in Object(R))return D(R,F);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function D(R,F,B){R===null&&(R=Function.prototype);var U=Object.getOwnPropertyDescriptor(R,F);if(U===void 0){var Z=Object.getPrototypeOf(R);return Z===null?void 0:D(Z,F,B)}else{if("value"in U)return U.value;var J=U.get;return J===void 0?void 0:J.call(B)}},i=function(){function D(R,F){for(var B=0;B<F.length;B++){var U=F[B];U.enumerable=U.enumerable||!1,U.configurable=!0,"value"in U&&(U.writable=!0),Object.defineProperty(R,U.key,U)}}return function(R,F,B){return F&&D(R.prototype,F),B&&D(R,B),R}}(),g=o(0),_=T(g),S=o(7),E=T(S);function T(D){return D&&D.__esModule?D:{default:D}}function C(D,R){if(!(D instanceof R))throw new TypeError("Cannot call a class as a function")}function N(D,R){if(!D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R&&(typeof R=="object"||typeof R=="function")?R:D}function I(D,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof R);D.prototype=Object.create(R&&R.prototype,{constructor:{value:D,enumerable:!1,writable:!0,configurable:!0}}),R&&(Object.setPrototypeOf?Object.setPrototypeOf(D,R):D.__proto__=R)}var j=function(D){I(R,D),i(R,null,[{key:"value",value:function(){}}]);function R(F,B){C(this,R);var U=N(this,(R.__proto__||Object.getPrototypeOf(R)).call(this,F));return U.selection=B,U.textNode=document.createTextNode(R.CONTENTS),U.domNode.appendChild(U.textNode),U._length=0,U}return i(R,[{key:"detach",value:function(){this.parent!=null&&this.parent.removeChild(this)}},{key:"format",value:function(B,U){if(this._length!==0)return d(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"format",this).call(this,B,U);for(var Z=this,J=0;Z!=null&&Z.statics.scope!==_.default.Scope.BLOCK_BLOT;)J+=Z.offset(Z.parent),Z=Z.parent;Z!=null&&(this._length=R.CONTENTS.length,Z.optimize(),Z.formatAt(J,R.CONTENTS.length,B,U),this._length=0)}},{key:"index",value:function(B,U){return B===this.textNode?0:d(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"index",this).call(this,B,U)}},{key:"length",value:function(){return this._length}},{key:"position",value:function(){return[this.textNode,this.textNode.data.length]}},{key:"remove",value:function(){d(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"remove",this).call(this),this.parent=null}},{key:"restore",value:function(){if(!(this.selection.composing||this.parent==null)){var B=this.textNode,U=this.selection.getNativeRange(),Z=void 0,J=void 0,te=void 0;if(U!=null&&U.start.node===B&&U.end.node===B){var ae=[B,U.start.offset,U.end.offset];Z=ae[0],J=ae[1],te=ae[2]}for(;this.domNode.lastChild!=null&&this.domNode.lastChild!==this.textNode;)this.domNode.parentNode.insertBefore(this.domNode.lastChild,this.domNode);if(this.textNode.data!==R.CONTENTS){var ne=this.textNode.data.split(R.CONTENTS).join("");this.next instanceof E.default?(Z=this.next.domNode,this.next.insertAt(0,ne),this.textNode.data=R.CONTENTS):(this.textNode.data=ne,this.parent.insertBefore(_.default.create(this.textNode),this),this.textNode=document.createTextNode(R.CONTENTS),this.domNode.appendChild(this.textNode))}if(this.remove(),J!=null){var ie=[J,te].map(function(oe){return Math.max(0,Math.min(Z.data.length,oe-1))}),ee=l(ie,2);return J=ee[0],te=ee[1],{startNode:Z,startOffset:J,endNode:Z,endOffset:te}}}}},{key:"update",value:function(B,U){var Z=this;if(B.some(function(te){return te.type==="characterData"&&te.target===Z.textNode})){var J=this.restore();J&&(U.range=J)}}},{key:"value",value:function(){return""}}]),R}(_.default.Embed);j.blotName="cursor",j.className="ql-cursor",j.tagName="span",j.CONTENTS="\uFEFF",n.default=j},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(0),d=_(l),i=o(4),g=_(i);function _(N){return N&&N.__esModule?N:{default:N}}function S(N,I){if(!(N instanceof I))throw new TypeError("Cannot call a class as a function")}function E(N,I){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I&&(typeof I=="object"||typeof I=="function")?I:N}function T(N,I){if(typeof I!="function"&&I!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof I);N.prototype=Object.create(I&&I.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),I&&(Object.setPrototypeOf?Object.setPrototypeOf(N,I):N.__proto__=I)}var C=function(N){T(I,N);function I(){return S(this,I),E(this,(I.__proto__||Object.getPrototypeOf(I)).apply(this,arguments))}return I}(d.default.Container);C.allowedChildren=[g.default,i.BlockEmbed,C],n.default=C},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.ColorStyle=n.ColorClass=n.ColorAttributor=void 0;var l=function(){function j(D,R){for(var F=0;F<R.length;F++){var B=R[F];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(D,B.key,B)}}return function(D,R,F){return R&&j(D.prototype,R),F&&j(D,F),D}}(),d=function j(D,R,F){D===null&&(D=Function.prototype);var B=Object.getOwnPropertyDescriptor(D,R);if(B===void 0){var U=Object.getPrototypeOf(D);return U===null?void 0:j(U,R,F)}else{if("value"in B)return B.value;var Z=B.get;return Z===void 0?void 0:Z.call(F)}},i=o(0),g=_(i);function _(j){return j&&j.__esModule?j:{default:j}}function S(j,D){if(!(j instanceof D))throw new TypeError("Cannot call a class as a function")}function E(j,D){if(!j)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D&&(typeof D=="object"||typeof D=="function")?D:j}function T(j,D){if(typeof D!="function"&&D!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof D);j.prototype=Object.create(D&&D.prototype,{constructor:{value:j,enumerable:!1,writable:!0,configurable:!0}}),D&&(Object.setPrototypeOf?Object.setPrototypeOf(j,D):j.__proto__=D)}var C=function(j){T(D,j);function D(){return S(this,D),E(this,(D.__proto__||Object.getPrototypeOf(D)).apply(this,arguments))}return l(D,[{key:"value",value:function(F){var B=d(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"value",this).call(this,F);return B.startsWith("rgb(")?(B=B.replace(/^[^\d]+/,"").replace(/[^\d]+$/,""),"#"+B.split(",").map(function(U){return("00"+parseInt(U).toString(16)).slice(-2)}).join("")):B}}]),D}(g.default.Attributor.Style),N=new g.default.Attributor.Class("color","ql-color",{scope:g.default.Scope.INLINE}),I=new C("color","color",{scope:g.default.Scope.INLINE});n.ColorAttributor=C,n.ColorClass=N,n.ColorStyle=I},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.sanitize=n.default=void 0;var l=function(){function I(j,D){for(var R=0;R<D.length;R++){var F=D[R];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(j,F.key,F)}}return function(j,D,R){return D&&I(j.prototype,D),R&&I(j,R),j}}(),d=function I(j,D,R){j===null&&(j=Function.prototype);var F=Object.getOwnPropertyDescriptor(j,D);if(F===void 0){var B=Object.getPrototypeOf(j);return B===null?void 0:I(B,D,R)}else{if("value"in F)return F.value;var U=F.get;return U===void 0?void 0:U.call(R)}},i=o(6),g=_(i);function _(I){return I&&I.__esModule?I:{default:I}}function S(I,j){if(!(I instanceof j))throw new TypeError("Cannot call a class as a function")}function E(I,j){if(!I)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return j&&(typeof j=="object"||typeof j=="function")?j:I}function T(I,j){if(typeof j!="function"&&j!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof j);I.prototype=Object.create(j&&j.prototype,{constructor:{value:I,enumerable:!1,writable:!0,configurable:!0}}),j&&(Object.setPrototypeOf?Object.setPrototypeOf(I,j):I.__proto__=j)}var C=function(I){T(j,I);function j(){return S(this,j),E(this,(j.__proto__||Object.getPrototypeOf(j)).apply(this,arguments))}return l(j,[{key:"format",value:function(R,F){if(R!==this.statics.blotName||!F)return d(j.prototype.__proto__||Object.getPrototypeOf(j.prototype),"format",this).call(this,R,F);F=this.constructor.sanitize(F),this.domNode.setAttribute("href",F)}}],[{key:"create",value:function(R){var F=d(j.__proto__||Object.getPrototypeOf(j),"create",this).call(this,R);return R=this.sanitize(R),F.setAttribute("href",R),F.setAttribute("rel","noopener noreferrer"),F.setAttribute("target","_blank"),F}},{key:"formats",value:function(R){return R.getAttribute("href")}},{key:"sanitize",value:function(R){return N(R,this.PROTOCOL_WHITELIST)?R:this.SANITIZED_URL}}]),j}(g.default);C.blotName="link",C.tagName="A",C.SANITIZED_URL="about:blank",C.PROTOCOL_WHITELIST=["http","https","mailto","tel"];function N(I,j){var D=document.createElement("a");D.href=I;var R=D.href.slice(0,D.href.indexOf(":"));return j.indexOf(R)>-1}n.default=C,n.sanitize=N},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(j){return typeof j}:function(j){return j&&typeof Symbol=="function"&&j.constructor===Symbol&&j!==Symbol.prototype?"symbol":typeof j},d=function(){function j(D,R){for(var F=0;F<R.length;F++){var B=R[F];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(D,B.key,B)}}return function(D,R,F){return R&&j(D.prototype,R),F&&j(D,F),D}}(),i=o(23),g=E(i),_=o(107),S=E(_);function E(j){return j&&j.__esModule?j:{default:j}}function T(j,D){if(!(j instanceof D))throw new TypeError("Cannot call a class as a function")}var C=0;function N(j,D){j.setAttribute(D,j.getAttribute(D)!=="true")}var I=function(){function j(D){var R=this;T(this,j),this.select=D,this.container=document.createElement("span"),this.buildPicker(),this.select.style.display="none",this.select.parentNode.insertBefore(this.container,this.select),this.label.addEventListener("mousedown",function(){R.togglePicker()}),this.label.addEventListener("keydown",function(F){switch(F.keyCode){case g.default.keys.ENTER:R.togglePicker();break;case g.default.keys.ESCAPE:R.escape(),F.preventDefault();break}}),this.select.addEventListener("change",this.update.bind(this))}return d(j,[{key:"togglePicker",value:function(){this.container.classList.toggle("ql-expanded"),N(this.label,"aria-expanded"),N(this.options,"aria-hidden")}},{key:"buildItem",value:function(R){var F=this,B=document.createElement("span");return B.tabIndex="0",B.setAttribute("role","button"),B.classList.add("ql-picker-item"),R.hasAttribute("value")&&B.setAttribute("data-value",R.getAttribute("value")),R.textContent&&B.setAttribute("data-label",R.textContent),B.addEventListener("click",function(){F.selectItem(B,!0)}),B.addEventListener("keydown",function(U){switch(U.keyCode){case g.default.keys.ENTER:F.selectItem(B,!0),U.preventDefault();break;case g.default.keys.ESCAPE:F.escape(),U.preventDefault();break}}),B}},{key:"buildLabel",value:function(){var R=document.createElement("span");return R.classList.add("ql-picker-label"),R.innerHTML=S.default,R.tabIndex="0",R.setAttribute("role","button"),R.setAttribute("aria-expanded","false"),this.container.appendChild(R),R}},{key:"buildOptions",value:function(){var R=this,F=document.createElement("span");F.classList.add("ql-picker-options"),F.setAttribute("aria-hidden","true"),F.tabIndex="-1",F.id="ql-picker-options-"+C,C+=1,this.label.setAttribute("aria-controls",F.id),this.options=F,[].slice.call(this.select.options).forEach(function(B){var U=R.buildItem(B);F.appendChild(U),B.selected===!0&&R.selectItem(U)}),this.container.appendChild(F)}},{key:"buildPicker",value:function(){var R=this;[].slice.call(this.select.attributes).forEach(function(F){R.container.setAttribute(F.name,F.value)}),this.container.classList.add("ql-picker"),this.label=this.buildLabel(),this.buildOptions()}},{key:"escape",value:function(){var R=this;this.close(),setTimeout(function(){return R.label.focus()},1)}},{key:"close",value:function(){this.container.classList.remove("ql-expanded"),this.label.setAttribute("aria-expanded","false"),this.options.setAttribute("aria-hidden","true")}},{key:"selectItem",value:function(R){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,B=this.container.querySelector(".ql-selected");if(R!==B&&(B!=null&&B.classList.remove("ql-selected"),R!=null&&(R.classList.add("ql-selected"),this.select.selectedIndex=[].indexOf.call(R.parentNode.children,R),R.hasAttribute("data-value")?this.label.setAttribute("data-value",R.getAttribute("data-value")):this.label.removeAttribute("data-value"),R.hasAttribute("data-label")?this.label.setAttribute("data-label",R.getAttribute("data-label")):this.label.removeAttribute("data-label"),F))){if(typeof Event=="function")this.select.dispatchEvent(new Event("change"));else if((typeof Event>"u"?"undefined":l(Event))==="object"){var U=document.createEvent("Event");U.initEvent("change",!0,!0),this.select.dispatchEvent(U)}this.close()}}},{key:"update",value:function(){var R=void 0;if(this.select.selectedIndex>-1){var F=this.container.querySelector(".ql-picker-options").children[this.select.selectedIndex];R=this.select.options[this.select.selectedIndex],this.selectItem(F)}else this.selectItem(null);var B=R!=null&&R!==this.select.querySelector("option[selected]");this.label.classList.toggle("ql-active",B)}}]),j}();n.default=I},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(0),d=xe(l),i=o(5),g=xe(i),_=o(4),S=xe(_),E=o(16),T=xe(E),C=o(25),N=xe(C),I=o(24),j=xe(I),D=o(35),R=xe(D),F=o(6),B=xe(F),U=o(22),Z=xe(U),J=o(7),te=xe(J),ae=o(55),ne=xe(ae),ie=o(42),ee=xe(ie),oe=o(23),de=xe(oe);function xe(we){return we&&we.__esModule?we:{default:we}}g.default.register({"blots/block":S.default,"blots/block/embed":_.BlockEmbed,"blots/break":T.default,"blots/container":N.default,"blots/cursor":j.default,"blots/embed":R.default,"blots/inline":B.default,"blots/scroll":Z.default,"blots/text":te.default,"modules/clipboard":ne.default,"modules/history":ee.default,"modules/keyboard":de.default}),d.default.register(S.default,T.default,j.default,B.default,Z.default,te.default),n.default=g.default},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(1),d=function(){function i(g){this.domNode=g,this.domNode[l.DATA_KEY]={blot:this}}return Object.defineProperty(i.prototype,"statics",{get:function(){return this.constructor},enumerable:!0,configurable:!0}),i.create=function(g){if(this.tagName==null)throw new l.ParchmentError("Blot definition missing tagName");var _;return Array.isArray(this.tagName)?(typeof g=="string"&&(g=g.toUpperCase(),parseInt(g).toString()===g&&(g=parseInt(g))),typeof g=="number"?_=document.createElement(this.tagName[g-1]):this.tagName.indexOf(g)>-1?_=document.createElement(g):_=document.createElement(this.tagName[0])):_=document.createElement(this.tagName),this.className&&_.classList.add(this.className),_},i.prototype.attach=function(){this.parent!=null&&(this.scroll=this.parent.scroll)},i.prototype.clone=function(){var g=this.domNode.cloneNode(!1);return l.create(g)},i.prototype.detach=function(){this.parent!=null&&this.parent.removeChild(this),delete this.domNode[l.DATA_KEY]},i.prototype.deleteAt=function(g,_){var S=this.isolate(g,_);S.remove()},i.prototype.formatAt=function(g,_,S,E){var T=this.isolate(g,_);if(l.query(S,l.Scope.BLOT)!=null&&E)T.wrap(S,E);else if(l.query(S,l.Scope.ATTRIBUTE)!=null){var C=l.create(this.statics.scope);T.wrap(C),C.format(S,E)}},i.prototype.insertAt=function(g,_,S){var E=S==null?l.create("text",_):l.create(_,S),T=this.split(g);this.parent.insertBefore(E,T)},i.prototype.insertInto=function(g,_){_===void 0&&(_=null),this.parent!=null&&this.parent.children.remove(this);var S=null;g.children.insertBefore(this,_),_!=null&&(S=_.domNode),(this.domNode.parentNode!=g.domNode||this.domNode.nextSibling!=S)&&g.domNode.insertBefore(this.domNode,S),this.parent=g,this.attach()},i.prototype.isolate=function(g,_){var S=this.split(g);return S.split(_),S},i.prototype.length=function(){return 1},i.prototype.offset=function(g){return g===void 0&&(g=this.parent),this.parent==null||this==g?0:this.parent.children.offset(this)+this.parent.offset(g)},i.prototype.optimize=function(g){this.domNode[l.DATA_KEY]!=null&&delete this.domNode[l.DATA_KEY].mutations},i.prototype.remove=function(){this.domNode.parentNode!=null&&this.domNode.parentNode.removeChild(this.domNode),this.detach()},i.prototype.replace=function(g){g.parent!=null&&(g.parent.insertBefore(this,g.next),g.remove())},i.prototype.replaceWith=function(g,_){var S=typeof g=="string"?l.create(g,_):g;return S.replace(this),S},i.prototype.split=function(g,_){return g===0?this:this.next},i.prototype.update=function(g,_){},i.prototype.wrap=function(g,_){var S=typeof g=="string"?l.create(g,_):g;return this.parent!=null&&this.parent.insertBefore(S,this.next),S.appendChild(this),S},i.blotName="abstract",i}();n.default=d},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(12),d=o(32),i=o(33),g=o(1),_=function(){function S(E){this.attributes={},this.domNode=E,this.build()}return S.prototype.attribute=function(E,T){T?E.add(this.domNode,T)&&(E.value(this.domNode)!=null?this.attributes[E.attrName]=E:delete this.attributes[E.attrName]):(E.remove(this.domNode),delete this.attributes[E.attrName])},S.prototype.build=function(){var E=this;this.attributes={};var T=l.default.keys(this.domNode),C=d.default.keys(this.domNode),N=i.default.keys(this.domNode);T.concat(C).concat(N).forEach(function(I){var j=g.query(I,g.Scope.ATTRIBUTE);j instanceof l.default&&(E.attributes[j.attrName]=j)})},S.prototype.copy=function(E){var T=this;Object.keys(this.attributes).forEach(function(C){var N=T.attributes[C].value(T.domNode);E.format(C,N)})},S.prototype.move=function(E){var T=this;this.copy(E),Object.keys(this.attributes).forEach(function(C){T.attributes[C].remove(T.domNode)}),this.attributes={}},S.prototype.values=function(){var E=this;return Object.keys(this.attributes).reduce(function(T,C){return T[C]=E.attributes[C].value(E.domNode),T},{})},S}();n.default=_},function(r,n,o){var l=this&&this.__extends||function(){var _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,E){S.__proto__=E}||function(S,E){for(var T in E)E.hasOwnProperty(T)&&(S[T]=E[T])};return function(S,E){_(S,E);function T(){this.constructor=S}S.prototype=E===null?Object.create(E):(T.prototype=E.prototype,new T)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=o(12);function i(_,S){var E=_.getAttribute("class")||"";return E.split(/\s+/).filter(function(T){return T.indexOf(S+"-")===0})}var g=function(_){l(S,_);function S(){return _!==null&&_.apply(this,arguments)||this}return S.keys=function(E){return(E.getAttribute("class")||"").split(/\s+/).map(function(T){return T.split("-").slice(0,-1).join("-")})},S.prototype.add=function(E,T){return this.canAdd(E,T)?(this.remove(E),E.classList.add(this.keyName+"-"+T),!0):!1},S.prototype.remove=function(E){var T=i(E,this.keyName);T.forEach(function(C){E.classList.remove(C)}),E.classList.length===0&&E.removeAttribute("class")},S.prototype.value=function(E){var T=i(E,this.keyName)[0]||"",C=T.slice(this.keyName.length+1);return this.canAdd(E,C)?C:""},S}(d.default);n.default=g},function(r,n,o){var l=this&&this.__extends||function(){var _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,E){S.__proto__=E}||function(S,E){for(var T in E)E.hasOwnProperty(T)&&(S[T]=E[T])};return function(S,E){_(S,E);function T(){this.constructor=S}S.prototype=E===null?Object.create(E):(T.prototype=E.prototype,new T)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=o(12);function i(_){var S=_.split("-"),E=S.slice(1).map(function(T){return T[0].toUpperCase()+T.slice(1)}).join("");return S[0]+E}var g=function(_){l(S,_);function S(){return _!==null&&_.apply(this,arguments)||this}return S.keys=function(E){return(E.getAttribute("style")||"").split(";").map(function(T){var C=T.split(":");return C[0].trim()})},S.prototype.add=function(E,T){return this.canAdd(E,T)?(E.style[i(this.keyName)]=T,!0):!1},S.prototype.remove=function(E){E.style[i(this.keyName)]="",E.getAttribute("style")||E.removeAttribute("style")},S.prototype.value=function(E){var T=E.style[i(this.keyName)];return this.canAdd(E,T)?T:""},S}(d.default);n.default=g},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function g(_,S){for(var E=0;E<S.length;E++){var T=S[E];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(_,T.key,T)}}return function(_,S,E){return S&&g(_.prototype,S),E&&g(_,E),_}}();function d(g,_){if(!(g instanceof _))throw new TypeError("Cannot call a class as a function")}var i=function(){function g(_,S){d(this,g),this.quill=_,this.options=S,this.modules={}}return l(g,[{key:"init",value:function(){var S=this;Object.keys(this.options.modules).forEach(function(E){S.modules[E]==null&&S.addModule(E)})}},{key:"addModule",value:function(S){var E=this.quill.constructor.import("modules/"+S);return this.modules[S]=new E(this.quill,this.options.modules[S]||{}),this.modules[S]}}]),g}();i.DEFAULTS={modules:{}},i.themes={default:i},n.default=i},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function D(R,F){for(var B=0;B<F.length;B++){var U=F[B];U.enumerable=U.enumerable||!1,U.configurable=!0,"value"in U&&(U.writable=!0),Object.defineProperty(R,U.key,U)}}return function(R,F,B){return F&&D(R.prototype,F),B&&D(R,B),R}}(),d=function D(R,F,B){R===null&&(R=Function.prototype);var U=Object.getOwnPropertyDescriptor(R,F);if(U===void 0){var Z=Object.getPrototypeOf(R);return Z===null?void 0:D(Z,F,B)}else{if("value"in U)return U.value;var J=U.get;return J===void 0?void 0:J.call(B)}},i=o(0),g=E(i),_=o(7),S=E(_);function E(D){return D&&D.__esModule?D:{default:D}}function T(D,R){if(!(D instanceof R))throw new TypeError("Cannot call a class as a function")}function C(D,R){if(!D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R&&(typeof R=="object"||typeof R=="function")?R:D}function N(D,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof R);D.prototype=Object.create(R&&R.prototype,{constructor:{value:D,enumerable:!1,writable:!0,configurable:!0}}),R&&(Object.setPrototypeOf?Object.setPrototypeOf(D,R):D.__proto__=R)}var I="\uFEFF",j=function(D){N(R,D);function R(F){T(this,R);var B=C(this,(R.__proto__||Object.getPrototypeOf(R)).call(this,F));return B.contentNode=document.createElement("span"),B.contentNode.setAttribute("contenteditable",!1),[].slice.call(B.domNode.childNodes).forEach(function(U){B.contentNode.appendChild(U)}),B.leftGuard=document.createTextNode(I),B.rightGuard=document.createTextNode(I),B.domNode.appendChild(B.leftGuard),B.domNode.appendChild(B.contentNode),B.domNode.appendChild(B.rightGuard),B}return l(R,[{key:"index",value:function(B,U){return B===this.leftGuard?0:B===this.rightGuard?1:d(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"index",this).call(this,B,U)}},{key:"restore",value:function(B){var U=void 0,Z=void 0,J=B.data.split(I).join("");if(B===this.leftGuard)if(this.prev instanceof S.default){var te=this.prev.length();this.prev.insertAt(te,J),U={startNode:this.prev.domNode,startOffset:te+J.length}}else Z=document.createTextNode(J),this.parent.insertBefore(g.default.create(Z),this),U={startNode:Z,startOffset:J.length};else B===this.rightGuard&&(this.next instanceof S.default?(this.next.insertAt(0,J),U={startNode:this.next.domNode,startOffset:J.length}):(Z=document.createTextNode(J),this.parent.insertBefore(g.default.create(Z),this.next),U={startNode:Z,startOffset:J.length}));return B.data=I,U}},{key:"update",value:function(B,U){var Z=this;B.forEach(function(J){if(J.type==="characterData"&&(J.target===Z.leftGuard||J.target===Z.rightGuard)){var te=Z.restore(J.target);te&&(U.range=te)}})}}]),R}(g.default.Embed);n.default=j},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.AlignStyle=n.AlignClass=n.AlignAttribute=void 0;var l=o(0),d=i(l);function i(T){return T&&T.__esModule?T:{default:T}}var g={scope:d.default.Scope.BLOCK,whitelist:["right","center","justify"]},_=new d.default.Attributor.Attribute("align","align",g),S=new d.default.Attributor.Class("align","ql-align",g),E=new d.default.Attributor.Style("align","text-align",g);n.AlignAttribute=_,n.AlignClass=S,n.AlignStyle=E},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.BackgroundStyle=n.BackgroundClass=void 0;var l=o(0),d=g(l),i=o(26);function g(E){return E&&E.__esModule?E:{default:E}}var _=new d.default.Attributor.Class("background","ql-bg",{scope:d.default.Scope.INLINE}),S=new i.ColorAttributor("background","background-color",{scope:d.default.Scope.INLINE});n.BackgroundClass=_,n.BackgroundStyle=S},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.DirectionStyle=n.DirectionClass=n.DirectionAttribute=void 0;var l=o(0),d=i(l);function i(T){return T&&T.__esModule?T:{default:T}}var g={scope:d.default.Scope.BLOCK,whitelist:["rtl"]},_=new d.default.Attributor.Attribute("direction","dir",g),S=new d.default.Attributor.Class("direction","ql-direction",g),E=new d.default.Attributor.Style("direction","direction",g);n.DirectionAttribute=_,n.DirectionClass=S,n.DirectionStyle=E},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.FontClass=n.FontStyle=void 0;var l=function(){function D(R,F){for(var B=0;B<F.length;B++){var U=F[B];U.enumerable=U.enumerable||!1,U.configurable=!0,"value"in U&&(U.writable=!0),Object.defineProperty(R,U.key,U)}}return function(R,F,B){return F&&D(R.prototype,F),B&&D(R,B),R}}(),d=function D(R,F,B){R===null&&(R=Function.prototype);var U=Object.getOwnPropertyDescriptor(R,F);if(U===void 0){var Z=Object.getPrototypeOf(R);return Z===null?void 0:D(Z,F,B)}else{if("value"in U)return U.value;var J=U.get;return J===void 0?void 0:J.call(B)}},i=o(0),g=_(i);function _(D){return D&&D.__esModule?D:{default:D}}function S(D,R){if(!(D instanceof R))throw new TypeError("Cannot call a class as a function")}function E(D,R){if(!D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R&&(typeof R=="object"||typeof R=="function")?R:D}function T(D,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof R);D.prototype=Object.create(R&&R.prototype,{constructor:{value:D,enumerable:!1,writable:!0,configurable:!0}}),R&&(Object.setPrototypeOf?Object.setPrototypeOf(D,R):D.__proto__=R)}var C={scope:g.default.Scope.INLINE,whitelist:["serif","monospace"]},N=new g.default.Attributor.Class("font","ql-font",C),I=function(D){T(R,D);function R(){return S(this,R),E(this,(R.__proto__||Object.getPrototypeOf(R)).apply(this,arguments))}return l(R,[{key:"value",value:function(B){return d(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"value",this).call(this,B).replace(/["']/g,"")}}]),R}(g.default.Attributor.Style),j=new I("font","font-family",C);n.FontStyle=j,n.FontClass=N},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.SizeStyle=n.SizeClass=void 0;var l=o(0),d=i(l);function i(S){return S&&S.__esModule?S:{default:S}}var g=new d.default.Attributor.Class("size","ql-size",{scope:d.default.Scope.INLINE,whitelist:["small","large","huge"]}),_=new d.default.Attributor.Style("size","font-size",{scope:d.default.Scope.INLINE,whitelist:["10px","18px","32px"]});n.SizeClass=g,n.SizeStyle=_},function(r,n,o){r.exports={align:{"":o(76),center:o(77),right:o(78),justify:o(79)},background:o(80),blockquote:o(81),bold:o(82),clean:o(83),code:o(58),"code-block":o(58),color:o(84),direction:{"":o(85),rtl:o(86)},float:{center:o(87),full:o(88),left:o(89),right:o(90)},formula:o(91),header:{1:o(92),2:o(93)},italic:o(94),image:o(95),indent:{"+1":o(96),"-1":o(97)},link:o(98),list:{ordered:o(99),bullet:o(100),check:o(101)},script:{sub:o(102),super:o(103)},strike:o(104),underline:o(105),video:o(106)}},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.getLastChangeIndex=n.default=void 0;var l=function(){function F(B,U){for(var Z=0;Z<U.length;Z++){var J=U[Z];J.enumerable=J.enumerable||!1,J.configurable=!0,"value"in J&&(J.writable=!0),Object.defineProperty(B,J.key,J)}}return function(B,U,Z){return U&&F(B.prototype,U),Z&&F(B,Z),B}}(),d=o(0),i=T(d),g=o(5),_=T(g),S=o(9),E=T(S);function T(F){return F&&F.__esModule?F:{default:F}}function C(F,B){if(!(F instanceof B))throw new TypeError("Cannot call a class as a function")}function N(F,B){if(!F)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return B&&(typeof B=="object"||typeof B=="function")?B:F}function I(F,B){if(typeof B!="function"&&B!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof B);F.prototype=Object.create(B&&B.prototype,{constructor:{value:F,enumerable:!1,writable:!0,configurable:!0}}),B&&(Object.setPrototypeOf?Object.setPrototypeOf(F,B):F.__proto__=B)}var j=function(F){I(B,F);function B(U,Z){C(this,B);var J=N(this,(B.__proto__||Object.getPrototypeOf(B)).call(this,U,Z));return J.lastRecorded=0,J.ignoreChange=!1,J.clear(),J.quill.on(_.default.events.EDITOR_CHANGE,function(te,ae,ne,ie){te!==_.default.events.TEXT_CHANGE||J.ignoreChange||(!J.options.userOnly||ie===_.default.sources.USER?J.record(ae,ne):J.transform(ae))}),J.quill.keyboard.addBinding({key:"Z",shortKey:!0},J.undo.bind(J)),J.quill.keyboard.addBinding({key:"Z",shortKey:!0,shiftKey:!0},J.redo.bind(J)),/Win/i.test(navigator.platform)&&J.quill.keyboard.addBinding({key:"Y",shortKey:!0},J.redo.bind(J)),J}return l(B,[{key:"change",value:function(Z,J){if(this.stack[Z].length!==0){var te=this.stack[Z].pop();this.stack[J].push(te),this.lastRecorded=0,this.ignoreChange=!0,this.quill.updateContents(te[Z],_.default.sources.USER),this.ignoreChange=!1;var ae=R(te[Z]);this.quill.setSelection(ae)}}},{key:"clear",value:function(){this.stack={undo:[],redo:[]}}},{key:"cutoff",value:function(){this.lastRecorded=0}},{key:"record",value:function(Z,J){if(Z.ops.length!==0){this.stack.redo=[];var te=this.quill.getContents().diff(J),ae=Date.now();if(this.lastRecorded+this.options.delay>ae&&this.stack.undo.length>0){var ne=this.stack.undo.pop();te=te.compose(ne.undo),Z=ne.redo.compose(Z)}else this.lastRecorded=ae;this.stack.undo.push({redo:Z,undo:te}),this.stack.undo.length>this.options.maxStack&&this.stack.undo.shift()}}},{key:"redo",value:function(){this.change("redo","undo")}},{key:"transform",value:function(Z){this.stack.undo.forEach(function(J){J.undo=Z.transform(J.undo,!0),J.redo=Z.transform(J.redo,!0)}),this.stack.redo.forEach(function(J){J.undo=Z.transform(J.undo,!0),J.redo=Z.transform(J.redo,!0)})}},{key:"undo",value:function(){this.change("undo","redo")}}]),B}(E.default);j.DEFAULTS={delay:1e3,maxStack:100,userOnly:!1};function D(F){var B=F.ops[F.ops.length-1];return B==null?!1:B.insert!=null?typeof B.insert=="string"&&B.insert.endsWith(`
`):B.attributes!=null?Object.keys(B.attributes).some(function(U){return i.default.query(U,i.default.Scope.BLOCK)!=null}):!1}function R(F){var B=F.reduce(function(Z,J){return Z+=J.delete||0,Z},0),U=F.length()-B;return D(F)&&(U-=1),U}n.default=j,n.getLastChangeIndex=R},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.BaseTooltip=void 0;var l=function(){function pe(Ie,tt){for(var Ze=0;Ze<tt.length;Ze++){var Le=tt[Ze];Le.enumerable=Le.enumerable||!1,Le.configurable=!0,"value"in Le&&(Le.writable=!0),Object.defineProperty(Ie,Le.key,Le)}}return function(Ie,tt,Ze){return tt&&pe(Ie.prototype,tt),Ze&&pe(Ie,Ze),Ie}}(),d=function pe(Ie,tt,Ze){Ie===null&&(Ie=Function.prototype);var Le=Object.getOwnPropertyDescriptor(Ie,tt);if(Le===void 0){var qe=Object.getPrototypeOf(Ie);return qe===null?void 0:pe(qe,tt,Ze)}else{if("value"in Le)return Le.value;var Ge=Le.get;return Ge===void 0?void 0:Ge.call(Ze)}},i=o(3),g=ae(i),_=o(2),S=ae(_),E=o(8),T=ae(E),C=o(23),N=ae(C),I=o(34),j=ae(I),D=o(59),R=ae(D),F=o(60),B=ae(F),U=o(28),Z=ae(U),J=o(61),te=ae(J);function ae(pe){return pe&&pe.__esModule?pe:{default:pe}}function ne(pe,Ie){if(!(pe instanceof Ie))throw new TypeError("Cannot call a class as a function")}function ie(pe,Ie){if(!pe)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Ie&&(typeof Ie=="object"||typeof Ie=="function")?Ie:pe}function ee(pe,Ie){if(typeof Ie!="function"&&Ie!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof Ie);pe.prototype=Object.create(Ie&&Ie.prototype,{constructor:{value:pe,enumerable:!1,writable:!0,configurable:!0}}),Ie&&(Object.setPrototypeOf?Object.setPrototypeOf(pe,Ie):pe.__proto__=Ie)}var oe=[!1,"center","right","justify"],de=["#000000","#e60000","#ff9900","#ffff00","#008a00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466"],xe=[!1,"serif","monospace"],we=["1","2","3",!1],Ae=["small",!1,"large","huge"],Ce=function(pe){ee(Ie,pe);function Ie(tt,Ze){ne(this,Ie);var Le=ie(this,(Ie.__proto__||Object.getPrototypeOf(Ie)).call(this,tt,Ze)),qe=function Ge(je){if(!document.body.contains(tt.root))return document.body.removeEventListener("click",Ge);Le.tooltip!=null&&!Le.tooltip.root.contains(je.target)&&document.activeElement!==Le.tooltip.textbox&&!Le.quill.hasFocus()&&Le.tooltip.hide(),Le.pickers!=null&&Le.pickers.forEach(function(ot){ot.container.contains(je.target)||ot.close()})};return tt.emitter.listenDOM("click",document.body,qe),Le}return l(Ie,[{key:"addModule",value:function(Ze){var Le=d(Ie.prototype.__proto__||Object.getPrototypeOf(Ie.prototype),"addModule",this).call(this,Ze);return Ze==="toolbar"&&this.extendToolbar(Le),Le}},{key:"buildButtons",value:function(Ze,Le){Ze.forEach(function(qe){var Ge=qe.getAttribute("class")||"";Ge.split(/\s+/).forEach(function(je){if(je.startsWith("ql-")&&(je=je.slice(3),Le[je]!=null))if(je==="direction")qe.innerHTML=Le[je][""]+Le[je].rtl;else if(typeof Le[je]=="string")qe.innerHTML=Le[je];else{var ot=qe.value||"";ot!=null&&Le[je][ot]&&(qe.innerHTML=Le[je][ot])}})})}},{key:"buildPickers",value:function(Ze,Le){var qe=this;this.pickers=Ze.map(function(je){if(je.classList.contains("ql-align"))return je.querySelector("option")==null&&ye(je,oe),new B.default(je,Le.align);if(je.classList.contains("ql-background")||je.classList.contains("ql-color")){var ot=je.classList.contains("ql-background")?"background":"color";return je.querySelector("option")==null&&ye(je,de,ot==="background"?"#ffffff":"#000000"),new R.default(je,Le[ot])}else return je.querySelector("option")==null&&(je.classList.contains("ql-font")?ye(je,xe):je.classList.contains("ql-header")?ye(je,we):je.classList.contains("ql-size")&&ye(je,Ae)),new Z.default(je)});var Ge=function(){qe.pickers.forEach(function(ot){ot.update()})};this.quill.on(T.default.events.EDITOR_CHANGE,Ge)}}]),Ie}(j.default);Ce.DEFAULTS=(0,g.default)(!0,{},j.default.DEFAULTS,{modules:{toolbar:{handlers:{formula:function(){this.quill.theme.tooltip.edit("formula")},image:function(){var Ie=this,tt=this.container.querySelector("input.ql-image[type=file]");tt==null&&(tt=document.createElement("input"),tt.setAttribute("type","file"),tt.setAttribute("accept","image/png, image/gif, image/jpeg, image/bmp, image/x-icon"),tt.classList.add("ql-image"),tt.addEventListener("change",function(){if(tt.files!=null&&tt.files[0]!=null){var Ze=new FileReader;Ze.onload=function(Le){var qe=Ie.quill.getSelection(!0);Ie.quill.updateContents(new S.default().retain(qe.index).delete(qe.length).insert({image:Le.target.result}),T.default.sources.USER),Ie.quill.setSelection(qe.index+1,T.default.sources.SILENT),tt.value=""},Ze.readAsDataURL(tt.files[0])}}),this.container.appendChild(tt)),tt.click()},video:function(){this.quill.theme.tooltip.edit("video")}}}}});var me=function(pe){ee(Ie,pe);function Ie(tt,Ze){ne(this,Ie);var Le=ie(this,(Ie.__proto__||Object.getPrototypeOf(Ie)).call(this,tt,Ze));return Le.textbox=Le.root.querySelector('input[type="text"]'),Le.listen(),Le}return l(Ie,[{key:"listen",value:function(){var Ze=this;this.textbox.addEventListener("keydown",function(Le){N.default.match(Le,"enter")?(Ze.save(),Le.preventDefault()):N.default.match(Le,"escape")&&(Ze.cancel(),Le.preventDefault())})}},{key:"cancel",value:function(){this.hide()}},{key:"edit",value:function(){var Ze=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"link",Le=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;this.root.classList.remove("ql-hidden"),this.root.classList.add("ql-editing"),Le!=null?this.textbox.value=Le:Ze!==this.root.getAttribute("data-mode")&&(this.textbox.value=""),this.position(this.quill.getBounds(this.quill.selection.savedRange)),this.textbox.select(),this.textbox.setAttribute("placeholder",this.textbox.getAttribute("data-"+Ze)||""),this.root.setAttribute("data-mode",Ze)}},{key:"restoreFocus",value:function(){var Ze=this.quill.scrollingContainer.scrollTop;this.quill.focus(),this.quill.scrollingContainer.scrollTop=Ze}},{key:"save",value:function(){var Ze=this.textbox.value;switch(this.root.getAttribute("data-mode")){case"link":{var Le=this.quill.root.scrollTop;this.linkRange?(this.quill.formatText(this.linkRange,"link",Ze,T.default.sources.USER),delete this.linkRange):(this.restoreFocus(),this.quill.format("link",Ze,T.default.sources.USER)),this.quill.root.scrollTop=Le;break}case"video":Ze=Pe(Ze);case"formula":{if(!Ze)break;var qe=this.quill.getSelection(!0);if(qe!=null){var Ge=qe.index+qe.length;this.quill.insertEmbed(Ge,this.root.getAttribute("data-mode"),Ze,T.default.sources.USER),this.root.getAttribute("data-mode")==="formula"&&this.quill.insertText(Ge+1," ",T.default.sources.USER),this.quill.setSelection(Ge+2,T.default.sources.USER)}break}}this.textbox.value="",this.hide()}}]),Ie}(te.default);function Pe(pe){var Ie=pe.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/)||pe.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtu\.be\/([a-zA-Z0-9_-]+)/);return Ie?(Ie[1]||"https")+"://www.youtube.com/embed/"+Ie[2]+"?showinfo=0":(Ie=pe.match(/^(?:(https?):\/\/)?(?:www\.)?vimeo\.com\/(\d+)/))?(Ie[1]||"https")+"://player.vimeo.com/video/"+Ie[2]+"/":pe}function ye(pe,Ie){var tt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;Ie.forEach(function(Ze){var Le=document.createElement("option");Ze===tt?Le.setAttribute("selected","selected"):Le.setAttribute("value",Ze),pe.appendChild(Le)})}n.BaseTooltip=me,n.default=Ce},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function d(){this.head=this.tail=null,this.length=0}return d.prototype.append=function(){for(var i=[],g=0;g<arguments.length;g++)i[g]=arguments[g];this.insertBefore(i[0],null),i.length>1&&this.append.apply(this,i.slice(1))},d.prototype.contains=function(i){for(var g,_=this.iterator();g=_();)if(g===i)return!0;return!1},d.prototype.insertBefore=function(i,g){i&&(i.next=g,g!=null?(i.prev=g.prev,g.prev!=null&&(g.prev.next=i),g.prev=i,g===this.head&&(this.head=i)):this.tail!=null?(this.tail.next=i,i.prev=this.tail,this.tail=i):(i.prev=null,this.head=this.tail=i),this.length+=1)},d.prototype.offset=function(i){for(var g=0,_=this.head;_!=null;){if(_===i)return g;g+=_.length(),_=_.next}return-1},d.prototype.remove=function(i){this.contains(i)&&(i.prev!=null&&(i.prev.next=i.next),i.next!=null&&(i.next.prev=i.prev),i===this.head&&(this.head=i.next),i===this.tail&&(this.tail=i.prev),this.length-=1)},d.prototype.iterator=function(i){return i===void 0&&(i=this.head),function(){var g=i;return i!=null&&(i=i.next),g}},d.prototype.find=function(i,g){g===void 0&&(g=!1);for(var _,S=this.iterator();_=S();){var E=_.length();if(i<E||g&&i===E&&(_.next==null||_.next.length()!==0))return[_,i];i-=E}return[null,0]},d.prototype.forEach=function(i){for(var g,_=this.iterator();g=_();)i(g)},d.prototype.forEachAt=function(i,g,_){if(!(g<=0))for(var S=this.find(i),E=S[0],T=S[1],C,N=i-T,I=this.iterator(E);(C=I())&&N<i+g;){var j=C.length();i>N?_(C,i-N,Math.min(g,N+j-i)):_(C,0,Math.min(j,i+g-N)),N+=j}},d.prototype.map=function(i){return this.reduce(function(g,_){return g.push(i(_)),g},[])},d.prototype.reduce=function(i,g){for(var _,S=this.iterator();_=S();)g=i(g,_);return g},d}();n.default=l},function(r,n,o){var l=this&&this.__extends||function(){var E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,C){T.__proto__=C}||function(T,C){for(var N in C)C.hasOwnProperty(N)&&(T[N]=C[N])};return function(T,C){E(T,C);function N(){this.constructor=T}T.prototype=C===null?Object.create(C):(N.prototype=C.prototype,new N)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=o(17),i=o(1),g={attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0},_=100,S=function(E){l(T,E);function T(C){var N=E.call(this,C)||this;return N.scroll=N,N.observer=new MutationObserver(function(I){N.update(I)}),N.observer.observe(N.domNode,g),N.attach(),N}return T.prototype.detach=function(){E.prototype.detach.call(this),this.observer.disconnect()},T.prototype.deleteAt=function(C,N){this.update(),C===0&&N===this.length()?this.children.forEach(function(I){I.remove()}):E.prototype.deleteAt.call(this,C,N)},T.prototype.formatAt=function(C,N,I,j){this.update(),E.prototype.formatAt.call(this,C,N,I,j)},T.prototype.insertAt=function(C,N,I){this.update(),E.prototype.insertAt.call(this,C,N,I)},T.prototype.optimize=function(C,N){var I=this;C===void 0&&(C=[]),N===void 0&&(N={}),E.prototype.optimize.call(this,N);for(var j=[].slice.call(this.observer.takeRecords());j.length>0;)C.push(j.pop());for(var D=function(U,Z){Z===void 0&&(Z=!0),!(U==null||U===I)&&U.domNode.parentNode!=null&&(U.domNode[i.DATA_KEY].mutations==null&&(U.domNode[i.DATA_KEY].mutations=[]),Z&&D(U.parent))},R=function(U){U.domNode[i.DATA_KEY]==null||U.domNode[i.DATA_KEY].mutations==null||(U instanceof d.default&&U.children.forEach(R),U.optimize(N))},F=C,B=0;F.length>0;B+=1){if(B>=_)throw new Error("[Parchment] Maximum optimize iterations reached");for(F.forEach(function(U){var Z=i.find(U.target,!0);Z!=null&&(Z.domNode===U.target&&(U.type==="childList"?(D(i.find(U.previousSibling,!1)),[].forEach.call(U.addedNodes,function(J){var te=i.find(J,!1);D(te,!1),te instanceof d.default&&te.children.forEach(function(ae){D(ae,!1)})})):U.type==="attributes"&&D(Z.prev)),D(Z))}),this.children.forEach(R),F=[].slice.call(this.observer.takeRecords()),j=F.slice();j.length>0;)C.push(j.pop())}},T.prototype.update=function(C,N){var I=this;N===void 0&&(N={}),C=C||this.observer.takeRecords(),C.map(function(j){var D=i.find(j.target,!0);return D==null?null:D.domNode[i.DATA_KEY].mutations==null?(D.domNode[i.DATA_KEY].mutations=[j],D):(D.domNode[i.DATA_KEY].mutations.push(j),null)}).forEach(function(j){j==null||j===I||j.domNode[i.DATA_KEY]==null||j.update(j.domNode[i.DATA_KEY].mutations||[],N)}),this.domNode[i.DATA_KEY].mutations!=null&&E.prototype.update.call(this,this.domNode[i.DATA_KEY].mutations,N),this.optimize(C,N)},T.blotName="scroll",T.defaultChild="block",T.scope=i.Scope.BLOCK_BLOT,T.tagName="DIV",T}(d.default);n.default=S},function(r,n,o){var l=this&&this.__extends||function(){var S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,T){E.__proto__=T}||function(E,T){for(var C in T)T.hasOwnProperty(C)&&(E[C]=T[C])};return function(E,T){S(E,T);function C(){this.constructor=E}E.prototype=T===null?Object.create(T):(C.prototype=T.prototype,new C)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=o(18),i=o(1);function g(S,E){if(Object.keys(S).length!==Object.keys(E).length)return!1;for(var T in S)if(S[T]!==E[T])return!1;return!0}var _=function(S){l(E,S);function E(){return S!==null&&S.apply(this,arguments)||this}return E.formats=function(T){if(T.tagName!==E.tagName)return S.formats.call(this,T)},E.prototype.format=function(T,C){var N=this;T===this.statics.blotName&&!C?(this.children.forEach(function(I){I instanceof d.default||(I=I.wrap(E.blotName,!0)),N.attributes.copy(I)}),this.unwrap()):S.prototype.format.call(this,T,C)},E.prototype.formatAt=function(T,C,N,I){if(this.formats()[N]!=null||i.query(N,i.Scope.ATTRIBUTE)){var j=this.isolate(T,C);j.format(N,I)}else S.prototype.formatAt.call(this,T,C,N,I)},E.prototype.optimize=function(T){S.prototype.optimize.call(this,T);var C=this.formats();if(Object.keys(C).length===0)return this.unwrap();var N=this.next;N instanceof E&&N.prev===this&&g(C,N.formats())&&(N.moveChildren(this),N.remove())},E.blotName="inline",E.scope=i.Scope.INLINE_BLOT,E.tagName="SPAN",E}(d.default);n.default=_},function(r,n,o){var l=this&&this.__extends||function(){var _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,E){S.__proto__=E}||function(S,E){for(var T in E)E.hasOwnProperty(T)&&(S[T]=E[T])};return function(S,E){_(S,E);function T(){this.constructor=S}S.prototype=E===null?Object.create(E):(T.prototype=E.prototype,new T)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=o(18),i=o(1),g=function(_){l(S,_);function S(){return _!==null&&_.apply(this,arguments)||this}return S.formats=function(E){var T=i.query(S.blotName).tagName;if(E.tagName!==T)return _.formats.call(this,E)},S.prototype.format=function(E,T){i.query(E,i.Scope.BLOCK)!=null&&(E===this.statics.blotName&&!T?this.replaceWith(S.blotName):_.prototype.format.call(this,E,T))},S.prototype.formatAt=function(E,T,C,N){i.query(C,i.Scope.BLOCK)!=null?this.format(C,N):_.prototype.formatAt.call(this,E,T,C,N)},S.prototype.insertAt=function(E,T,C){if(C==null||i.query(T,i.Scope.INLINE)!=null)_.prototype.insertAt.call(this,E,T,C);else{var N=this.split(E),I=i.create(T,C);N.parent.insertBefore(I,N)}},S.prototype.update=function(E,T){navigator.userAgent.match(/Trident/)?this.build():_.prototype.update.call(this,E,T)},S.blotName="block",S.scope=i.Scope.BLOCK_BLOT,S.tagName="P",S}(d.default);n.default=g},function(r,n,o){var l=this&&this.__extends||function(){var g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,S){_.__proto__=S}||function(_,S){for(var E in S)S.hasOwnProperty(E)&&(_[E]=S[E])};return function(_,S){g(_,S);function E(){this.constructor=_}_.prototype=S===null?Object.create(S):(E.prototype=S.prototype,new E)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=o(19),i=function(g){l(_,g);function _(){return g!==null&&g.apply(this,arguments)||this}return _.formats=function(S){},_.prototype.format=function(S,E){g.prototype.formatAt.call(this,0,this.length(),S,E)},_.prototype.formatAt=function(S,E,T,C){S===0&&E===this.length()?this.format(T,C):g.prototype.formatAt.call(this,S,E,T,C)},_.prototype.formats=function(){return this.statics.formats(this.domNode)},_}(d.default);n.default=i},function(r,n,o){var l=this&&this.__extends||function(){var _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,E){S.__proto__=E}||function(S,E){for(var T in E)E.hasOwnProperty(T)&&(S[T]=E[T])};return function(S,E){_(S,E);function T(){this.constructor=S}S.prototype=E===null?Object.create(E):(T.prototype=E.prototype,new T)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=o(19),i=o(1),g=function(_){l(S,_);function S(E){var T=_.call(this,E)||this;return T.text=T.statics.value(T.domNode),T}return S.create=function(E){return document.createTextNode(E)},S.value=function(E){var T=E.data;return T.normalize&&(T=T.normalize()),T},S.prototype.deleteAt=function(E,T){this.domNode.data=this.text=this.text.slice(0,E)+this.text.slice(E+T)},S.prototype.index=function(E,T){return this.domNode===E?T:-1},S.prototype.insertAt=function(E,T,C){C==null?(this.text=this.text.slice(0,E)+T+this.text.slice(E),this.domNode.data=this.text):_.prototype.insertAt.call(this,E,T,C)},S.prototype.length=function(){return this.text.length},S.prototype.optimize=function(E){_.prototype.optimize.call(this,E),this.text=this.statics.value(this.domNode),this.text.length===0?this.remove():this.next instanceof S&&this.next.prev===this&&(this.insertAt(this.length(),this.next.value()),this.next.remove())},S.prototype.position=function(E,T){return[this.domNode,E]},S.prototype.split=function(E,T){if(T===void 0&&(T=!1),!T){if(E===0)return this;if(E===this.length())return this.next}var C=i.create(this.domNode.splitText(E));return this.parent.insertBefore(C,this.next),this.text=this.statics.value(this.domNode),C},S.prototype.update=function(E,T){var C=this;E.some(function(N){return N.type==="characterData"&&N.target===C.domNode})&&(this.text=this.statics.value(this.domNode))},S.prototype.value=function(){return this.text},S.blotName="text",S.scope=i.Scope.INLINE_BLOT,S}(d.default);n.default=g},function(r,n,o){var l=document.createElement("div");if(l.classList.toggle("test-class",!1),l.classList.contains("test-class")){var d=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(i,g){return arguments.length>1&&!this.contains(i)==!g?g:d.call(this,i)}}String.prototype.startsWith||(String.prototype.startsWith=function(i,g){return g=g||0,this.substr(g,i.length)===i}),String.prototype.endsWith||(String.prototype.endsWith=function(i,g){var _=this.toString();(typeof g!="number"||!isFinite(g)||Math.floor(g)!==g||g>_.length)&&(g=_.length),g-=i.length;var S=_.indexOf(i,g);return S!==-1&&S===g}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(g){if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof g!="function")throw new TypeError("predicate must be a function");for(var _=Object(this),S=_.length>>>0,E=arguments[1],T,C=0;C<S;C++)if(T=_[C],g.call(E,T,C,_))return T}}),document.addEventListener("DOMContentLoaded",function(){document.execCommand("enableObjectResizing",!1,!1),document.execCommand("autoUrlDetect",!1,!1)})},function(r,n){var o=-1,l=1,d=0;function i(B,U,Z){if(B==U)return B?[[d,B]]:[];(Z<0||B.length<Z)&&(Z=null);var J=E(B,U),te=B.substring(0,J);B=B.substring(J),U=U.substring(J),J=T(B,U);var ae=B.substring(B.length-J);B=B.substring(0,B.length-J),U=U.substring(0,U.length-J);var ne=g(B,U);return te&&ne.unshift([d,te]),ae&&ne.push([d,ae]),N(ne),Z!=null&&(ne=D(ne,Z)),ne=R(ne),ne}function g(B,U){var Z;if(!B)return[[l,U]];if(!U)return[[o,B]];var J=B.length>U.length?B:U,te=B.length>U.length?U:B,ae=J.indexOf(te);if(ae!=-1)return Z=[[l,J.substring(0,ae)],[d,te],[l,J.substring(ae+te.length)]],B.length>U.length&&(Z[0][0]=Z[2][0]=o),Z;if(te.length==1)return[[o,B],[l,U]];var ne=C(B,U);if(ne){var ie=ne[0],ee=ne[1],oe=ne[2],de=ne[3],xe=ne[4],we=i(ie,oe),Ae=i(ee,de);return we.concat([[d,xe]],Ae)}return _(B,U)}function _(B,U){for(var Z=B.length,J=U.length,te=Math.ceil((Z+J)/2),ae=te,ne=2*te,ie=new Array(ne),ee=new Array(ne),oe=0;oe<ne;oe++)ie[oe]=-1,ee[oe]=-1;ie[ae+1]=0,ee[ae+1]=0;for(var de=Z-J,xe=de%2!=0,we=0,Ae=0,Ce=0,me=0,Pe=0;Pe<te;Pe++){for(var ye=-Pe+we;ye<=Pe-Ae;ye+=2){var pe=ae+ye,Ie;ye==-Pe||ye!=Pe&&ie[pe-1]<ie[pe+1]?Ie=ie[pe+1]:Ie=ie[pe-1]+1;for(var tt=Ie-ye;Ie<Z&&tt<J&&B.charAt(Ie)==U.charAt(tt);)Ie++,tt++;if(ie[pe]=Ie,Ie>Z)Ae+=2;else if(tt>J)we+=2;else if(xe){var Ze=ae+de-ye;if(Ze>=0&&Ze<ne&&ee[Ze]!=-1){var Le=Z-ee[Ze];if(Ie>=Le)return S(B,U,Ie,tt)}}}for(var qe=-Pe+Ce;qe<=Pe-me;qe+=2){var Ze=ae+qe,Le;qe==-Pe||qe!=Pe&&ee[Ze-1]<ee[Ze+1]?Le=ee[Ze+1]:Le=ee[Ze-1]+1;for(var Ge=Le-qe;Le<Z&&Ge<J&&B.charAt(Z-Le-1)==U.charAt(J-Ge-1);)Le++,Ge++;if(ee[Ze]=Le,Le>Z)me+=2;else if(Ge>J)Ce+=2;else if(!xe){var pe=ae+de-qe;if(pe>=0&&pe<ne&&ie[pe]!=-1){var Ie=ie[pe],tt=ae+Ie-pe;if(Le=Z-Le,Ie>=Le)return S(B,U,Ie,tt)}}}}return[[o,B],[l,U]]}function S(B,U,Z,J){var te=B.substring(0,Z),ae=U.substring(0,J),ne=B.substring(Z),ie=U.substring(J),ee=i(te,ae),oe=i(ne,ie);return ee.concat(oe)}function E(B,U){if(!B||!U||B.charAt(0)!=U.charAt(0))return 0;for(var Z=0,J=Math.min(B.length,U.length),te=J,ae=0;Z<te;)B.substring(ae,te)==U.substring(ae,te)?(Z=te,ae=Z):J=te,te=Math.floor((J-Z)/2+Z);return te}function T(B,U){if(!B||!U||B.charAt(B.length-1)!=U.charAt(U.length-1))return 0;for(var Z=0,J=Math.min(B.length,U.length),te=J,ae=0;Z<te;)B.substring(B.length-te,B.length-ae)==U.substring(U.length-te,U.length-ae)?(Z=te,ae=Z):J=te,te=Math.floor((J-Z)/2+Z);return te}function C(B,U){var Z=B.length>U.length?B:U,J=B.length>U.length?U:B;if(Z.length<4||J.length*2<Z.length)return null;function te(Ae,Ce,me){for(var Pe=Ae.substring(me,me+Math.floor(Ae.length/4)),ye=-1,pe="",Ie,tt,Ze,Le;(ye=Ce.indexOf(Pe,ye+1))!=-1;){var qe=E(Ae.substring(me),Ce.substring(ye)),Ge=T(Ae.substring(0,me),Ce.substring(0,ye));pe.length<Ge+qe&&(pe=Ce.substring(ye-Ge,ye)+Ce.substring(ye,ye+qe),Ie=Ae.substring(0,me-Ge),tt=Ae.substring(me+qe),Ze=Ce.substring(0,ye-Ge),Le=Ce.substring(ye+qe))}return pe.length*2>=Ae.length?[Ie,tt,Ze,Le,pe]:null}var ae=te(Z,J,Math.ceil(Z.length/4)),ne=te(Z,J,Math.ceil(Z.length/2)),ie;if(!ae&&!ne)return null;ne?ae?ie=ae[4].length>ne[4].length?ae:ne:ie=ne:ie=ae;var ee,oe,de,xe;B.length>U.length?(ee=ie[0],oe=ie[1],de=ie[2],xe=ie[3]):(de=ie[0],xe=ie[1],ee=ie[2],oe=ie[3]);var we=ie[4];return[ee,oe,de,xe,we]}function N(B){B.push([d,""]);for(var U=0,Z=0,J=0,te="",ae="",ne;U<B.length;)switch(B[U][0]){case l:J++,ae+=B[U][1],U++;break;case o:Z++,te+=B[U][1],U++;break;case d:Z+J>1?(Z!==0&&J!==0&&(ne=E(ae,te),ne!==0&&(U-Z-J>0&&B[U-Z-J-1][0]==d?B[U-Z-J-1][1]+=ae.substring(0,ne):(B.splice(0,0,[d,ae.substring(0,ne)]),U++),ae=ae.substring(ne),te=te.substring(ne)),ne=T(ae,te),ne!==0&&(B[U][1]=ae.substring(ae.length-ne)+B[U][1],ae=ae.substring(0,ae.length-ne),te=te.substring(0,te.length-ne))),Z===0?B.splice(U-J,Z+J,[l,ae]):J===0?B.splice(U-Z,Z+J,[o,te]):B.splice(U-Z-J,Z+J,[o,te],[l,ae]),U=U-Z-J+(Z?1:0)+(J?1:0)+1):U!==0&&B[U-1][0]==d?(B[U-1][1]+=B[U][1],B.splice(U,1)):U++,J=0,Z=0,te="",ae="";break}B[B.length-1][1]===""&&B.pop();var ie=!1;for(U=1;U<B.length-1;)B[U-1][0]==d&&B[U+1][0]==d&&(B[U][1].substring(B[U][1].length-B[U-1][1].length)==B[U-1][1]?(B[U][1]=B[U-1][1]+B[U][1].substring(0,B[U][1].length-B[U-1][1].length),B[U+1][1]=B[U-1][1]+B[U+1][1],B.splice(U-1,1),ie=!0):B[U][1].substring(0,B[U+1][1].length)==B[U+1][1]&&(B[U-1][1]+=B[U+1][1],B[U][1]=B[U][1].substring(B[U+1][1].length)+B[U+1][1],B.splice(U+1,1),ie=!0)),U++;ie&&N(B)}var I=i;I.INSERT=l,I.DELETE=o,I.EQUAL=d,r.exports=I;function j(B,U){if(U===0)return[d,B];for(var Z=0,J=0;J<B.length;J++){var te=B[J];if(te[0]===o||te[0]===d){var ae=Z+te[1].length;if(U===ae)return[J+1,B];if(U<ae){B=B.slice();var ne=U-Z,ie=[te[0],te[1].slice(0,ne)],ee=[te[0],te[1].slice(ne)];return B.splice(J,1,ie,ee),[J+1,B]}else Z=ae}}throw new Error("cursor_pos is out of bounds!")}function D(B,U){var Z=j(B,U),J=Z[1],te=Z[0],ae=J[te],ne=J[te+1];if(ae==null)return B;if(ae[0]!==d)return B;if(ne!=null&&ae[1]+ne[1]===ne[1]+ae[1])return J.splice(te,2,ne,ae),F(J,te,2);if(ne!=null&&ne[1].indexOf(ae[1])===0){J.splice(te,2,[ne[0],ae[1]],[0,ae[1]]);var ie=ne[1].slice(ae[1].length);return ie.length>0&&J.splice(te+2,0,[ne[0],ie]),F(J,te,3)}else return B}function R(B){for(var U=!1,Z=function(ne){return ne.charCodeAt(0)>=56320&&ne.charCodeAt(0)<=57343},J=function(ne){return ne.charCodeAt(ne.length-1)>=55296&&ne.charCodeAt(ne.length-1)<=56319},te=2;te<B.length;te+=1)B[te-2][0]===d&&J(B[te-2][1])&&B[te-1][0]===o&&Z(B[te-1][1])&&B[te][0]===l&&Z(B[te][1])&&(U=!0,B[te-1][1]=B[te-2][1].slice(-1)+B[te-1][1],B[te][1]=B[te-2][1].slice(-1)+B[te][1],B[te-2][1]=B[te-2][1].slice(0,-1));if(!U)return B;for(var ae=[],te=0;te<B.length;te+=1)B[te][1].length>0&&ae.push(B[te]);return ae}function F(B,U,Z){for(var J=U+Z-1;J>=0&&J>=U-1;J--)if(J+1<B.length){var te=B[J],ae=B[J+1];te[0]===ae[1]&&B.splice(J,2,[te[0],te[1]+ae[1]])}return B}},function(r,n){n=r.exports=typeof Object.keys=="function"?Object.keys:o,n.shim=o;function o(l){var d=[];for(var i in l)d.push(i);return d}},function(r,n){var o=function(){return Object.prototype.toString.call(arguments)}()=="[object Arguments]";n=r.exports=o?l:d,n.supported=l;function l(i){return Object.prototype.toString.call(i)=="[object Arguments]"}n.unsupported=d;function d(i){return i&&typeof i=="object"&&typeof i.length=="number"&&Object.prototype.hasOwnProperty.call(i,"callee")&&!Object.prototype.propertyIsEnumerable.call(i,"callee")||!1}},function(r,n){var o=Object.prototype.hasOwnProperty,l="~";function d(){}Object.create&&(d.prototype=Object.create(null),new d().__proto__||(l=!1));function i(_,S,E){this.fn=_,this.context=S,this.once=E||!1}function g(){this._events=new d,this._eventsCount=0}g.prototype.eventNames=function(){var S=[],E,T;if(this._eventsCount===0)return S;for(T in E=this._events)o.call(E,T)&&S.push(l?T.slice(1):T);return Object.getOwnPropertySymbols?S.concat(Object.getOwnPropertySymbols(E)):S},g.prototype.listeners=function(S,E){var T=l?l+S:S,C=this._events[T];if(E)return!!C;if(!C)return[];if(C.fn)return[C.fn];for(var N=0,I=C.length,j=new Array(I);N<I;N++)j[N]=C[N].fn;return j},g.prototype.emit=function(S,E,T,C,N,I){var j=l?l+S:S;if(!this._events[j])return!1;var D=this._events[j],R=arguments.length,F,B;if(D.fn){switch(D.once&&this.removeListener(S,D.fn,void 0,!0),R){case 1:return D.fn.call(D.context),!0;case 2:return D.fn.call(D.context,E),!0;case 3:return D.fn.call(D.context,E,T),!0;case 4:return D.fn.call(D.context,E,T,C),!0;case 5:return D.fn.call(D.context,E,T,C,N),!0;case 6:return D.fn.call(D.context,E,T,C,N,I),!0}for(B=1,F=new Array(R-1);B<R;B++)F[B-1]=arguments[B];D.fn.apply(D.context,F)}else{var U=D.length,Z;for(B=0;B<U;B++)switch(D[B].once&&this.removeListener(S,D[B].fn,void 0,!0),R){case 1:D[B].fn.call(D[B].context);break;case 2:D[B].fn.call(D[B].context,E);break;case 3:D[B].fn.call(D[B].context,E,T);break;case 4:D[B].fn.call(D[B].context,E,T,C);break;default:if(!F)for(Z=1,F=new Array(R-1);Z<R;Z++)F[Z-1]=arguments[Z];D[B].fn.apply(D[B].context,F)}}return!0},g.prototype.on=function(S,E,T){var C=new i(E,T||this),N=l?l+S:S;return this._events[N]?this._events[N].fn?this._events[N]=[this._events[N],C]:this._events[N].push(C):(this._events[N]=C,this._eventsCount++),this},g.prototype.once=function(S,E,T){var C=new i(E,T||this,!0),N=l?l+S:S;return this._events[N]?this._events[N].fn?this._events[N]=[this._events[N],C]:this._events[N].push(C):(this._events[N]=C,this._eventsCount++),this},g.prototype.removeListener=function(S,E,T,C){var N=l?l+S:S;if(!this._events[N])return this;if(!E)return--this._eventsCount===0?this._events=new d:delete this._events[N],this;var I=this._events[N];if(I.fn)I.fn===E&&(!C||I.once)&&(!T||I.context===T)&&(--this._eventsCount===0?this._events=new d:delete this._events[N]);else{for(var j=0,D=[],R=I.length;j<R;j++)(I[j].fn!==E||C&&!I[j].once||T&&I[j].context!==T)&&D.push(I[j]);D.length?this._events[N]=D.length===1?D[0]:D:--this._eventsCount===0?this._events=new d:delete this._events[N]}return this},g.prototype.removeAllListeners=function(S){var E;return S?(E=l?l+S:S,this._events[E]&&(--this._eventsCount===0?this._events=new d:delete this._events[E])):(this._events=new d,this._eventsCount=0),this},g.prototype.off=g.prototype.removeListener,g.prototype.addListener=g.prototype.on,g.prototype.setMaxListeners=function(){return this},g.prefixed=l,g.EventEmitter=g,typeof r<"u"&&(r.exports=g)},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.matchText=n.matchSpacing=n.matchNewline=n.matchBlot=n.matchAttributor=n.default=void 0;var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Rt){return typeof Rt}:function(Rt){return Rt&&typeof Symbol=="function"&&Rt.constructor===Symbol&&Rt!==Symbol.prototype?"symbol":typeof Rt},d=function(){function Rt(At,Xe){var ut=[],dt=!0,rr=!1,er=void 0;try{for(var tr=At[Symbol.iterator](),Pr;!(dt=(Pr=tr.next()).done)&&(ut.push(Pr.value),!(Xe&&ut.length===Xe));dt=!0);}catch(un){rr=!0,er=un}finally{try{!dt&&tr.return&&tr.return()}finally{if(rr)throw er}}return ut}return function(At,Xe){if(Array.isArray(At))return At;if(Symbol.iterator in Object(At))return Rt(At,Xe);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function Rt(At,Xe){for(var ut=0;ut<Xe.length;ut++){var dt=Xe[ut];dt.enumerable=dt.enumerable||!1,dt.configurable=!0,"value"in dt&&(dt.writable=!0),Object.defineProperty(At,dt.key,dt)}}return function(At,Xe,ut){return Xe&&Rt(At.prototype,Xe),ut&&Rt(At,ut),At}}(),g=o(3),_=ee(g),S=o(2),E=ee(S),T=o(0),C=ee(T),N=o(5),I=ee(N),j=o(10),D=ee(j),R=o(9),F=ee(R),B=o(36),U=o(37),Z=o(13),J=ee(Z),te=o(26),ae=o(38),ne=o(39),ie=o(40);function ee(Rt){return Rt&&Rt.__esModule?Rt:{default:Rt}}function oe(Rt,At,Xe){return At in Rt?Object.defineProperty(Rt,At,{value:Xe,enumerable:!0,configurable:!0,writable:!0}):Rt[At]=Xe,Rt}function de(Rt,At){if(!(Rt instanceof At))throw new TypeError("Cannot call a class as a function")}function xe(Rt,At){if(!Rt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return At&&(typeof At=="object"||typeof At=="function")?At:Rt}function we(Rt,At){if(typeof At!="function"&&At!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof At);Rt.prototype=Object.create(At&&At.prototype,{constructor:{value:Rt,enumerable:!1,writable:!0,configurable:!0}}),At&&(Object.setPrototypeOf?Object.setPrototypeOf(Rt,At):Rt.__proto__=At)}var Ae=(0,D.default)("quill:clipboard"),Ce="__ql-matcher",me=[[Node.TEXT_NODE,Jr],[Node.TEXT_NODE,Ft],["br",St],[Node.ELEMENT_NODE,Ft],[Node.ELEMENT_NODE,ot],[Node.ELEMENT_NODE,dr],[Node.ELEMENT_NODE,je],[Node.ELEMENT_NODE,Lr],["li",Ut],["b",Ge.bind(Ge,"bold")],["i",Ge.bind(Ge,"italic")],["style",rt]],Pe=[B.AlignAttribute,ae.DirectionAttribute].reduce(function(Rt,At){return Rt[At.keyName]=At,Rt},{}),ye=[B.AlignStyle,U.BackgroundStyle,te.ColorStyle,ae.DirectionStyle,ne.FontStyle,ie.SizeStyle].reduce(function(Rt,At){return Rt[At.keyName]=At,Rt},{}),pe=function(Rt){we(At,Rt);function At(Xe,ut){de(this,At);var dt=xe(this,(At.__proto__||Object.getPrototypeOf(At)).call(this,Xe,ut));return dt.quill.root.addEventListener("paste",dt.onPaste.bind(dt)),dt.container=dt.quill.addContainer("ql-clipboard"),dt.container.setAttribute("contenteditable",!0),dt.container.setAttribute("tabindex",-1),dt.matchers=[],me.concat(dt.options.matchers).forEach(function(rr){var er=d(rr,2),tr=er[0],Pr=er[1];!ut.matchVisual&&Pr===dr||dt.addMatcher(tr,Pr)}),dt}return i(At,[{key:"addMatcher",value:function(ut,dt){this.matchers.push([ut,dt])}},{key:"convert",value:function(ut){if(typeof ut=="string")return this.container.innerHTML=ut.replace(/\>\r?\n +\</g,"><"),this.convert();var dt=this.quill.getFormat(this.quill.selection.savedRange.index);if(dt[J.default.blotName]){var rr=this.container.innerText;return this.container.innerHTML="",new E.default().insert(rr,oe({},J.default.blotName,dt[J.default.blotName]))}var er=this.prepareMatching(),tr=d(er,2),Pr=tr[0],un=tr[1],pn=qe(this.container,Pr,un);return Ze(pn,`
`)&&pn.ops[pn.ops.length-1].attributes==null&&(pn=pn.compose(new E.default().retain(pn.length()-1).delete(1))),Ae.log("convert",this.container.innerHTML,pn),this.container.innerHTML="",pn}},{key:"dangerouslyPasteHTML",value:function(ut,dt){var rr=arguments.length>2&&arguments[2]!==void 0?arguments[2]:I.default.sources.API;if(typeof ut=="string")this.quill.setContents(this.convert(ut),dt),this.quill.setSelection(0,I.default.sources.SILENT);else{var er=this.convert(dt);this.quill.updateContents(new E.default().retain(ut).concat(er),rr),this.quill.setSelection(ut+er.length(),I.default.sources.SILENT)}}},{key:"onPaste",value:function(ut){var dt=this;if(!(ut.defaultPrevented||!this.quill.isEnabled())){var rr=this.quill.getSelection(),er=new E.default().retain(rr.index),tr=this.quill.scrollingContainer.scrollTop;this.container.focus(),this.quill.selection.update(I.default.sources.SILENT),setTimeout(function(){er=er.concat(dt.convert()).delete(rr.length),dt.quill.updateContents(er,I.default.sources.USER),dt.quill.setSelection(er.length()-rr.length,I.default.sources.SILENT),dt.quill.scrollingContainer.scrollTop=tr,dt.quill.focus()},1)}}},{key:"prepareMatching",value:function(){var ut=this,dt=[],rr=[];return this.matchers.forEach(function(er){var tr=d(er,2),Pr=tr[0],un=tr[1];switch(Pr){case Node.TEXT_NODE:rr.push(un);break;case Node.ELEMENT_NODE:dt.push(un);break;default:[].forEach.call(ut.container.querySelectorAll(Pr),function(pn){pn[Ce]=pn[Ce]||[],pn[Ce].push(un)});break}}),[dt,rr]}}]),At}(F.default);pe.DEFAULTS={matchers:[],matchVisual:!0};function Ie(Rt,At,Xe){return(typeof At>"u"?"undefined":l(At))==="object"?Object.keys(At).reduce(function(ut,dt){return Ie(ut,dt,At[dt])},Rt):Rt.reduce(function(ut,dt){return dt.attributes&&dt.attributes[At]?ut.push(dt):ut.insert(dt.insert,(0,_.default)({},oe({},At,Xe),dt.attributes))},new E.default)}function tt(Rt){if(Rt.nodeType!==Node.ELEMENT_NODE)return{};var At="__ql-computed-style";return Rt[At]||(Rt[At]=window.getComputedStyle(Rt))}function Ze(Rt,At){for(var Xe="",ut=Rt.ops.length-1;ut>=0&&Xe.length<At.length;--ut){var dt=Rt.ops[ut];if(typeof dt.insert!="string")break;Xe=dt.insert+Xe}return Xe.slice(-1*At.length)===At}function Le(Rt){if(Rt.childNodes.length===0)return!1;var At=tt(Rt);return["block","list-item"].indexOf(At.display)>-1}function qe(Rt,At,Xe){return Rt.nodeType===Rt.TEXT_NODE?Xe.reduce(function(ut,dt){return dt(Rt,ut)},new E.default):Rt.nodeType===Rt.ELEMENT_NODE?[].reduce.call(Rt.childNodes||[],function(ut,dt){var rr=qe(dt,At,Xe);return dt.nodeType===Rt.ELEMENT_NODE&&(rr=At.reduce(function(er,tr){return tr(dt,er)},rr),rr=(dt[Ce]||[]).reduce(function(er,tr){return tr(dt,er)},rr)),ut.concat(rr)},new E.default):new E.default}function Ge(Rt,At,Xe){return Ie(Xe,Rt,!0)}function je(Rt,At){var Xe=C.default.Attributor.Attribute.keys(Rt),ut=C.default.Attributor.Class.keys(Rt),dt=C.default.Attributor.Style.keys(Rt),rr={};return Xe.concat(ut).concat(dt).forEach(function(er){var tr=C.default.query(er,C.default.Scope.ATTRIBUTE);tr!=null&&(rr[tr.attrName]=tr.value(Rt),rr[tr.attrName])||(tr=Pe[er],tr!=null&&(tr.attrName===er||tr.keyName===er)&&(rr[tr.attrName]=tr.value(Rt)||void 0),tr=ye[er],tr!=null&&(tr.attrName===er||tr.keyName===er)&&(tr=ye[er],rr[tr.attrName]=tr.value(Rt)||void 0))}),Object.keys(rr).length>0&&(At=Ie(At,rr)),At}function ot(Rt,At){var Xe=C.default.query(Rt);if(Xe==null)return At;if(Xe.prototype instanceof C.default.Embed){var ut={},dt=Xe.value(Rt);dt!=null&&(ut[Xe.blotName]=dt,At=new E.default().insert(ut,Xe.formats(Rt)))}else typeof Xe.formats=="function"&&(At=Ie(At,Xe.blotName,Xe.formats(Rt)));return At}function St(Rt,At){return Ze(At,`
`)||At.insert(`
`),At}function rt(){return new E.default}function Ut(Rt,At){var Xe=C.default.query(Rt);if(Xe==null||Xe.blotName!=="list-item"||!Ze(At,`
`))return At;for(var ut=-1,dt=Rt.parentNode;!dt.classList.contains("ql-clipboard");)(C.default.query(dt)||{}).blotName==="list"&&(ut+=1),dt=dt.parentNode;return ut<=0?At:At.compose(new E.default().retain(At.length()-1).retain(1,{indent:ut}))}function Ft(Rt,At){return Ze(At,`
`)||(Le(Rt)||At.length()>0&&Rt.nextSibling&&Le(Rt.nextSibling))&&At.insert(`
`),At}function dr(Rt,At){if(Le(Rt)&&Rt.nextElementSibling!=null&&!Ze(At,`

`)){var Xe=Rt.offsetHeight+parseFloat(tt(Rt).marginTop)+parseFloat(tt(Rt).marginBottom);Rt.nextElementSibling.offsetTop>Rt.offsetTop+Xe*1.5&&At.insert(`
`)}return At}function Lr(Rt,At){var Xe={},ut=Rt.style||{};return ut.fontStyle&&tt(Rt).fontStyle==="italic"&&(Xe.italic=!0),ut.fontWeight&&(tt(Rt).fontWeight.startsWith("bold")||parseInt(tt(Rt).fontWeight)>=700)&&(Xe.bold=!0),Object.keys(Xe).length>0&&(At=Ie(At,Xe)),parseFloat(ut.textIndent||0)>0&&(At=new E.default().insert("	").concat(At)),At}function Jr(Rt,At){var Xe=Rt.data;if(Rt.parentNode.tagName==="O:P")return At.insert(Xe.trim());if(Xe.trim().length===0&&Rt.parentNode.classList.contains("ql-clipboard"))return At;if(!tt(Rt.parentNode).whiteSpace.startsWith("pre")){var ut=function(rr,er){return er=er.replace(/[^\u00a0]/g,""),er.length<1&&rr?" ":er};Xe=Xe.replace(/\r\n/g," ").replace(/\n/g," "),Xe=Xe.replace(/\s\s+/g,ut.bind(ut,!0)),(Rt.previousSibling==null&&Le(Rt.parentNode)||Rt.previousSibling!=null&&Le(Rt.previousSibling))&&(Xe=Xe.replace(/^\s+/,ut.bind(ut,!1))),(Rt.nextSibling==null&&Le(Rt.parentNode)||Rt.nextSibling!=null&&Le(Rt.nextSibling))&&(Xe=Xe.replace(/\s+$/,ut.bind(ut,!1)))}return At.insert(Xe)}n.default=pe,n.matchAttributor=je,n.matchBlot=ot,n.matchNewline=Ft,n.matchSpacing=dr,n.matchText=Jr},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function N(I,j){for(var D=0;D<j.length;D++){var R=j[D];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(I,R.key,R)}}return function(I,j,D){return j&&N(I.prototype,j),D&&N(I,D),I}}(),d=function N(I,j,D){I===null&&(I=Function.prototype);var R=Object.getOwnPropertyDescriptor(I,j);if(R===void 0){var F=Object.getPrototypeOf(I);return F===null?void 0:N(F,j,D)}else{if("value"in R)return R.value;var B=R.get;return B===void 0?void 0:B.call(D)}},i=o(6),g=_(i);function _(N){return N&&N.__esModule?N:{default:N}}function S(N,I){if(!(N instanceof I))throw new TypeError("Cannot call a class as a function")}function E(N,I){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I&&(typeof I=="object"||typeof I=="function")?I:N}function T(N,I){if(typeof I!="function"&&I!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof I);N.prototype=Object.create(I&&I.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),I&&(Object.setPrototypeOf?Object.setPrototypeOf(N,I):N.__proto__=I)}var C=function(N){T(I,N);function I(){return S(this,I),E(this,(I.__proto__||Object.getPrototypeOf(I)).apply(this,arguments))}return l(I,[{key:"optimize",value:function(D){d(I.prototype.__proto__||Object.getPrototypeOf(I.prototype),"optimize",this).call(this,D),this.domNode.tagName!==this.statics.tagName[0]&&this.replaceWith(this.statics.blotName)}}],[{key:"create",value:function(){return d(I.__proto__||Object.getPrototypeOf(I),"create",this).call(this)}},{key:"formats",value:function(){return!0}}]),I}(g.default);C.blotName="bold",C.tagName=["STRONG","B"],n.default=C},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.addControls=n.default=void 0;var l=function(){function ie(ee,oe){var de=[],xe=!0,we=!1,Ae=void 0;try{for(var Ce=ee[Symbol.iterator](),me;!(xe=(me=Ce.next()).done)&&(de.push(me.value),!(oe&&de.length===oe));xe=!0);}catch(Pe){we=!0,Ae=Pe}finally{try{!xe&&Ce.return&&Ce.return()}finally{if(we)throw Ae}}return de}return function(ee,oe){if(Array.isArray(ee))return ee;if(Symbol.iterator in Object(ee))return ie(ee,oe);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(){function ie(ee,oe){for(var de=0;de<oe.length;de++){var xe=oe[de];xe.enumerable=xe.enumerable||!1,xe.configurable=!0,"value"in xe&&(xe.writable=!0),Object.defineProperty(ee,xe.key,xe)}}return function(ee,oe,de){return oe&&ie(ee.prototype,oe),de&&ie(ee,de),ee}}(),i=o(2),g=D(i),_=o(0),S=D(_),E=o(5),T=D(E),C=o(10),N=D(C),I=o(9),j=D(I);function D(ie){return ie&&ie.__esModule?ie:{default:ie}}function R(ie,ee,oe){return ee in ie?Object.defineProperty(ie,ee,{value:oe,enumerable:!0,configurable:!0,writable:!0}):ie[ee]=oe,ie}function F(ie,ee){if(!(ie instanceof ee))throw new TypeError("Cannot call a class as a function")}function B(ie,ee){if(!ie)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ee&&(typeof ee=="object"||typeof ee=="function")?ee:ie}function U(ie,ee){if(typeof ee!="function"&&ee!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof ee);ie.prototype=Object.create(ee&&ee.prototype,{constructor:{value:ie,enumerable:!1,writable:!0,configurable:!0}}),ee&&(Object.setPrototypeOf?Object.setPrototypeOf(ie,ee):ie.__proto__=ee)}var Z=(0,N.default)("quill:toolbar"),J=function(ie){U(ee,ie);function ee(oe,de){F(this,ee);var xe=B(this,(ee.__proto__||Object.getPrototypeOf(ee)).call(this,oe,de));if(Array.isArray(xe.options.container)){var we=document.createElement("div");ae(we,xe.options.container),oe.container.parentNode.insertBefore(we,oe.container),xe.container=we}else typeof xe.options.container=="string"?xe.container=document.querySelector(xe.options.container):xe.container=xe.options.container;if(!(xe.container instanceof HTMLElement)){var Ae;return Ae=Z.error("Container required for toolbar",xe.options),B(xe,Ae)}return xe.container.classList.add("ql-toolbar"),xe.controls=[],xe.handlers={},Object.keys(xe.options.handlers).forEach(function(Ce){xe.addHandler(Ce,xe.options.handlers[Ce])}),[].forEach.call(xe.container.querySelectorAll("button, select"),function(Ce){xe.attach(Ce)}),xe.quill.on(T.default.events.EDITOR_CHANGE,function(Ce,me){Ce===T.default.events.SELECTION_CHANGE&&xe.update(me)}),xe.quill.on(T.default.events.SCROLL_OPTIMIZE,function(){var Ce=xe.quill.selection.getRange(),me=l(Ce,1),Pe=me[0];xe.update(Pe)}),xe}return d(ee,[{key:"addHandler",value:function(de,xe){this.handlers[de]=xe}},{key:"attach",value:function(de){var xe=this,we=[].find.call(de.classList,function(Ce){return Ce.indexOf("ql-")===0});if(we){if(we=we.slice(3),de.tagName==="BUTTON"&&de.setAttribute("type","button"),this.handlers[we]==null){if(this.quill.scroll.whitelist!=null&&this.quill.scroll.whitelist[we]==null){Z.warn("ignoring attaching to disabled format",we,de);return}if(S.default.query(we)==null){Z.warn("ignoring attaching to nonexistent format",we,de);return}}var Ae=de.tagName==="SELECT"?"change":"click";de.addEventListener(Ae,function(Ce){var me=void 0;if(de.tagName==="SELECT"){if(de.selectedIndex<0)return;var Pe=de.options[de.selectedIndex];Pe.hasAttribute("selected")?me=!1:me=Pe.value||!1}else de.classList.contains("ql-active")?me=!1:me=de.value||!de.hasAttribute("value"),Ce.preventDefault();xe.quill.focus();var ye=xe.quill.selection.getRange(),pe=l(ye,1),Ie=pe[0];if(xe.handlers[we]!=null)xe.handlers[we].call(xe,me);else if(S.default.query(we).prototype instanceof S.default.Embed){if(me=prompt("Enter "+we),!me)return;xe.quill.updateContents(new g.default().retain(Ie.index).delete(Ie.length).insert(R({},we,me)),T.default.sources.USER)}else xe.quill.format(we,me,T.default.sources.USER);xe.update(Ie)}),this.controls.push([we,de])}}},{key:"update",value:function(de){var xe=de==null?{}:this.quill.getFormat(de);this.controls.forEach(function(we){var Ae=l(we,2),Ce=Ae[0],me=Ae[1];if(me.tagName==="SELECT"){var Pe=void 0;if(de==null)Pe=null;else if(xe[Ce]==null)Pe=me.querySelector("option[selected]");else if(!Array.isArray(xe[Ce])){var ye=xe[Ce];typeof ye=="string"&&(ye=ye.replace(/\"/g,'\\"')),Pe=me.querySelector('option[value="'+ye+'"]')}Pe==null?(me.value="",me.selectedIndex=-1):Pe.selected=!0}else if(de==null)me.classList.remove("ql-active");else if(me.hasAttribute("value")){var pe=xe[Ce]===me.getAttribute("value")||xe[Ce]!=null&&xe[Ce].toString()===me.getAttribute("value")||xe[Ce]==null&&!me.getAttribute("value");me.classList.toggle("ql-active",pe)}else me.classList.toggle("ql-active",xe[Ce]!=null)})}}]),ee}(j.default);J.DEFAULTS={};function te(ie,ee,oe){var de=document.createElement("button");de.setAttribute("type","button"),de.classList.add("ql-"+ee),oe!=null&&(de.value=oe),ie.appendChild(de)}function ae(ie,ee){Array.isArray(ee[0])||(ee=[ee]),ee.forEach(function(oe){var de=document.createElement("span");de.classList.add("ql-formats"),oe.forEach(function(xe){if(typeof xe=="string")te(de,xe);else{var we=Object.keys(xe)[0],Ae=xe[we];Array.isArray(Ae)?ne(de,we,Ae):te(de,we,Ae)}}),ie.appendChild(de)})}function ne(ie,ee,oe){var de=document.createElement("select");de.classList.add("ql-"+ee),oe.forEach(function(xe){var we=document.createElement("option");xe!==!1?we.setAttribute("value",xe):we.setAttribute("selected","selected"),de.appendChild(we)}),ie.appendChild(de)}J.DEFAULTS={container:null,handlers:{clean:function(){var ee=this,oe=this.quill.getSelection();if(oe!=null)if(oe.length==0){var de=this.quill.getFormat();Object.keys(de).forEach(function(xe){S.default.query(xe,S.default.Scope.INLINE)!=null&&ee.quill.format(xe,!1)})}else this.quill.removeFormat(oe,T.default.sources.USER)},direction:function(ee){var oe=this.quill.getFormat().align;ee==="rtl"&&oe==null?this.quill.format("align","right",T.default.sources.USER):!ee&&oe==="right"&&this.quill.format("align",!1,T.default.sources.USER),this.quill.format("direction",ee,T.default.sources.USER)},indent:function(ee){var oe=this.quill.getSelection(),de=this.quill.getFormat(oe),xe=parseInt(de.indent||0);if(ee==="+1"||ee==="-1"){var we=ee==="+1"?1:-1;de.direction==="rtl"&&(we*=-1),this.quill.format("indent",xe+we,T.default.sources.USER)}},link:function(ee){ee===!0&&(ee=prompt("Enter link URL:")),this.quill.format("link",ee,T.default.sources.USER)},list:function(ee){var oe=this.quill.getSelection(),de=this.quill.getFormat(oe);ee==="check"?de.list==="checked"||de.list==="unchecked"?this.quill.format("list",!1,T.default.sources.USER):this.quill.format("list","unchecked",T.default.sources.USER):this.quill.format("list",ee,T.default.sources.USER)}}},n.default=J,n.addControls=ae},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <polyline class="ql-even ql-stroke" points="5 7 3 9 5 11"></polyline> <polyline class="ql-even ql-stroke" points="13 7 15 9 13 11"></polyline> <line class=ql-stroke x1=10 x2=8 y1=5 y2=13></line> </svg>'},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function N(I,j){for(var D=0;D<j.length;D++){var R=j[D];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(I,R.key,R)}}return function(I,j,D){return j&&N(I.prototype,j),D&&N(I,D),I}}(),d=function N(I,j,D){I===null&&(I=Function.prototype);var R=Object.getOwnPropertyDescriptor(I,j);if(R===void 0){var F=Object.getPrototypeOf(I);return F===null?void 0:N(F,j,D)}else{if("value"in R)return R.value;var B=R.get;return B===void 0?void 0:B.call(D)}},i=o(28),g=_(i);function _(N){return N&&N.__esModule?N:{default:N}}function S(N,I){if(!(N instanceof I))throw new TypeError("Cannot call a class as a function")}function E(N,I){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I&&(typeof I=="object"||typeof I=="function")?I:N}function T(N,I){if(typeof I!="function"&&I!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof I);N.prototype=Object.create(I&&I.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),I&&(Object.setPrototypeOf?Object.setPrototypeOf(N,I):N.__proto__=I)}var C=function(N){T(I,N);function I(j,D){S(this,I);var R=E(this,(I.__proto__||Object.getPrototypeOf(I)).call(this,j));return R.label.innerHTML=D,R.container.classList.add("ql-color-picker"),[].slice.call(R.container.querySelectorAll(".ql-picker-item"),0,7).forEach(function(F){F.classList.add("ql-primary")}),R}return l(I,[{key:"buildItem",value:function(D){var R=d(I.prototype.__proto__||Object.getPrototypeOf(I.prototype),"buildItem",this).call(this,D);return R.style.backgroundColor=D.getAttribute("value")||"",R}},{key:"selectItem",value:function(D,R){d(I.prototype.__proto__||Object.getPrototypeOf(I.prototype),"selectItem",this).call(this,D,R);var F=this.label.querySelector(".ql-color-label"),B=D&&D.getAttribute("data-value")||"";F&&(F.tagName==="line"?F.style.stroke=B:F.style.fill=B)}}]),I}(g.default);n.default=C},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function N(I,j){for(var D=0;D<j.length;D++){var R=j[D];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(I,R.key,R)}}return function(I,j,D){return j&&N(I.prototype,j),D&&N(I,D),I}}(),d=function N(I,j,D){I===null&&(I=Function.prototype);var R=Object.getOwnPropertyDescriptor(I,j);if(R===void 0){var F=Object.getPrototypeOf(I);return F===null?void 0:N(F,j,D)}else{if("value"in R)return R.value;var B=R.get;return B===void 0?void 0:B.call(D)}},i=o(28),g=_(i);function _(N){return N&&N.__esModule?N:{default:N}}function S(N,I){if(!(N instanceof I))throw new TypeError("Cannot call a class as a function")}function E(N,I){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I&&(typeof I=="object"||typeof I=="function")?I:N}function T(N,I){if(typeof I!="function"&&I!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof I);N.prototype=Object.create(I&&I.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),I&&(Object.setPrototypeOf?Object.setPrototypeOf(N,I):N.__proto__=I)}var C=function(N){T(I,N);function I(j,D){S(this,I);var R=E(this,(I.__proto__||Object.getPrototypeOf(I)).call(this,j));return R.container.classList.add("ql-icon-picker"),[].forEach.call(R.container.querySelectorAll(".ql-picker-item"),function(F){F.innerHTML=D[F.getAttribute("data-value")||""]}),R.defaultItem=R.container.querySelector(".ql-selected"),R.selectItem(R.defaultItem),R}return l(I,[{key:"selectItem",value:function(D,R){d(I.prototype.__proto__||Object.getPrototypeOf(I.prototype),"selectItem",this).call(this,D,R),D=D||this.defaultItem,this.label.innerHTML=D.innerHTML}}]),I}(g.default);n.default=C},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function g(_,S){for(var E=0;E<S.length;E++){var T=S[E];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(_,T.key,T)}}return function(_,S,E){return S&&g(_.prototype,S),E&&g(_,E),_}}();function d(g,_){if(!(g instanceof _))throw new TypeError("Cannot call a class as a function")}var i=function(){function g(_,S){var E=this;d(this,g),this.quill=_,this.boundsContainer=S||document.body,this.root=_.addContainer("ql-tooltip"),this.root.innerHTML=this.constructor.TEMPLATE,this.quill.root===this.quill.scrollingContainer&&this.quill.root.addEventListener("scroll",function(){E.root.style.marginTop=-1*E.quill.root.scrollTop+"px"}),this.hide()}return l(g,[{key:"hide",value:function(){this.root.classList.add("ql-hidden")}},{key:"position",value:function(S){var E=S.left+S.width/2-this.root.offsetWidth/2,T=S.bottom+this.quill.root.scrollTop;this.root.style.left=E+"px",this.root.style.top=T+"px",this.root.classList.remove("ql-flip");var C=this.boundsContainer.getBoundingClientRect(),N=this.root.getBoundingClientRect(),I=0;if(N.right>C.right&&(I=C.right-N.right,this.root.style.left=E+I+"px"),N.left<C.left&&(I=C.left-N.left,this.root.style.left=E+I+"px"),N.bottom>C.bottom){var j=N.bottom-N.top,D=S.bottom-S.top+j;this.root.style.top=T-D+"px",this.root.classList.add("ql-flip")}return I}},{key:"show",value:function(){this.root.classList.remove("ql-editing"),this.root.classList.remove("ql-hidden")}}]),g}();n.default=i},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function ne(ie,ee){var oe=[],de=!0,xe=!1,we=void 0;try{for(var Ae=ie[Symbol.iterator](),Ce;!(de=(Ce=Ae.next()).done)&&(oe.push(Ce.value),!(ee&&oe.length===ee));de=!0);}catch(me){xe=!0,we=me}finally{try{!de&&Ae.return&&Ae.return()}finally{if(xe)throw we}}return oe}return function(ie,ee){if(Array.isArray(ie))return ie;if(Symbol.iterator in Object(ie))return ne(ie,ee);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function ne(ie,ee,oe){ie===null&&(ie=Function.prototype);var de=Object.getOwnPropertyDescriptor(ie,ee);if(de===void 0){var xe=Object.getPrototypeOf(ie);return xe===null?void 0:ne(xe,ee,oe)}else{if("value"in de)return de.value;var we=de.get;return we===void 0?void 0:we.call(oe)}},i=function(){function ne(ie,ee){for(var oe=0;oe<ee.length;oe++){var de=ee[oe];de.enumerable=de.enumerable||!1,de.configurable=!0,"value"in de&&(de.writable=!0),Object.defineProperty(ie,de.key,de)}}return function(ie,ee,oe){return ee&&ne(ie.prototype,ee),oe&&ne(ie,oe),ie}}(),g=o(3),_=F(g),S=o(8),E=F(S),T=o(43),C=F(T),N=o(27),I=F(N),j=o(15),D=o(41),R=F(D);function F(ne){return ne&&ne.__esModule?ne:{default:ne}}function B(ne,ie){if(!(ne instanceof ie))throw new TypeError("Cannot call a class as a function")}function U(ne,ie){if(!ne)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ie&&(typeof ie=="object"||typeof ie=="function")?ie:ne}function Z(ne,ie){if(typeof ie!="function"&&ie!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof ie);ne.prototype=Object.create(ie&&ie.prototype,{constructor:{value:ne,enumerable:!1,writable:!0,configurable:!0}}),ie&&(Object.setPrototypeOf?Object.setPrototypeOf(ne,ie):ne.__proto__=ie)}var J=[[{header:["1","2","3",!1]}],["bold","italic","underline","link"],[{list:"ordered"},{list:"bullet"}],["clean"]],te=function(ne){Z(ie,ne);function ie(ee,oe){B(this,ie),oe.modules.toolbar!=null&&oe.modules.toolbar.container==null&&(oe.modules.toolbar.container=J);var de=U(this,(ie.__proto__||Object.getPrototypeOf(ie)).call(this,ee,oe));return de.quill.container.classList.add("ql-snow"),de}return i(ie,[{key:"extendToolbar",value:function(oe){oe.container.classList.add("ql-snow"),this.buildButtons([].slice.call(oe.container.querySelectorAll("button")),R.default),this.buildPickers([].slice.call(oe.container.querySelectorAll("select")),R.default),this.tooltip=new ae(this.quill,this.options.bounds),oe.container.querySelector(".ql-link")&&this.quill.keyboard.addBinding({key:"K",shortKey:!0},function(de,xe){oe.handlers.link.call(oe,!xe.format.link)})}}]),ie}(C.default);te.DEFAULTS=(0,_.default)(!0,{},C.default.DEFAULTS,{modules:{toolbar:{handlers:{link:function(ie){if(ie){var ee=this.quill.getSelection();if(ee==null||ee.length==0)return;var oe=this.quill.getText(ee);/^\S+@\S+\.\S+$/.test(oe)&&oe.indexOf("mailto:")!==0&&(oe="mailto:"+oe);var de=this.quill.theme.tooltip;de.edit("link",oe)}else this.quill.format("link",!1)}}}}});var ae=function(ne){Z(ie,ne);function ie(ee,oe){B(this,ie);var de=U(this,(ie.__proto__||Object.getPrototypeOf(ie)).call(this,ee,oe));return de.preview=de.root.querySelector("a.ql-preview"),de}return i(ie,[{key:"listen",value:function(){var oe=this;d(ie.prototype.__proto__||Object.getPrototypeOf(ie.prototype),"listen",this).call(this),this.root.querySelector("a.ql-action").addEventListener("click",function(de){oe.root.classList.contains("ql-editing")?oe.save():oe.edit("link",oe.preview.textContent),de.preventDefault()}),this.root.querySelector("a.ql-remove").addEventListener("click",function(de){if(oe.linkRange!=null){var xe=oe.linkRange;oe.restoreFocus(),oe.quill.formatText(xe,"link",!1,E.default.sources.USER),delete oe.linkRange}de.preventDefault(),oe.hide()}),this.quill.on(E.default.events.SELECTION_CHANGE,function(de,xe,we){if(de!=null){if(de.length===0&&we===E.default.sources.USER){var Ae=oe.quill.scroll.descendant(I.default,de.index),Ce=l(Ae,2),me=Ce[0],Pe=Ce[1];if(me!=null){oe.linkRange=new j.Range(de.index-Pe,me.length());var ye=I.default.formats(me.domNode);oe.preview.textContent=ye,oe.preview.setAttribute("href",ye),oe.show(),oe.position(oe.quill.getBounds(oe.linkRange));return}}else delete oe.linkRange;oe.hide()}})}},{key:"show",value:function(){d(ie.prototype.__proto__||Object.getPrototypeOf(ie.prototype),"show",this).call(this),this.root.removeAttribute("data-mode")}}]),ie}(T.BaseTooltip);ae.TEMPLATE=['<a class="ql-preview" rel="noopener noreferrer" target="_blank" href="about:blank"></a>','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-action"></a>','<a class="ql-remove"></a>'].join(""),n.default=te},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(29),d=dt(l),i=o(36),g=o(38),_=o(64),S=o(65),E=dt(S),T=o(66),C=dt(T),N=o(67),I=dt(N),j=o(37),D=o(26),R=o(39),F=o(40),B=o(56),U=dt(B),Z=o(68),J=dt(Z),te=o(27),ae=dt(te),ne=o(69),ie=dt(ne),ee=o(70),oe=dt(ee),de=o(71),xe=dt(de),we=o(72),Ae=dt(we),Ce=o(73),me=dt(Ce),Pe=o(13),ye=dt(Pe),pe=o(74),Ie=dt(pe),tt=o(75),Ze=dt(tt),Le=o(57),qe=dt(Le),Ge=o(41),je=dt(Ge),ot=o(28),St=dt(ot),rt=o(59),Ut=dt(rt),Ft=o(60),dr=dt(Ft),Lr=o(61),Jr=dt(Lr),Rt=o(108),At=dt(Rt),Xe=o(62),ut=dt(Xe);function dt(rr){return rr&&rr.__esModule?rr:{default:rr}}d.default.register({"attributors/attribute/direction":g.DirectionAttribute,"attributors/class/align":i.AlignClass,"attributors/class/background":j.BackgroundClass,"attributors/class/color":D.ColorClass,"attributors/class/direction":g.DirectionClass,"attributors/class/font":R.FontClass,"attributors/class/size":F.SizeClass,"attributors/style/align":i.AlignStyle,"attributors/style/background":j.BackgroundStyle,"attributors/style/color":D.ColorStyle,"attributors/style/direction":g.DirectionStyle,"attributors/style/font":R.FontStyle,"attributors/style/size":F.SizeStyle},!0),d.default.register({"formats/align":i.AlignClass,"formats/direction":g.DirectionClass,"formats/indent":_.IndentClass,"formats/background":j.BackgroundStyle,"formats/color":D.ColorStyle,"formats/font":R.FontClass,"formats/size":F.SizeClass,"formats/blockquote":E.default,"formats/code-block":ye.default,"formats/header":C.default,"formats/list":I.default,"formats/bold":U.default,"formats/code":Pe.Code,"formats/italic":J.default,"formats/link":ae.default,"formats/script":ie.default,"formats/strike":oe.default,"formats/underline":xe.default,"formats/image":Ae.default,"formats/video":me.default,"formats/list/item":N.ListItem,"modules/formula":Ie.default,"modules/syntax":Ze.default,"modules/toolbar":qe.default,"themes/bubble":At.default,"themes/snow":ut.default,"ui/icons":je.default,"ui/picker":St.default,"ui/icon-picker":dr.default,"ui/color-picker":Ut.default,"ui/tooltip":Jr.default},!0),n.default=d.default},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.IndentClass=void 0;var l=function(){function I(j,D){for(var R=0;R<D.length;R++){var F=D[R];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(j,F.key,F)}}return function(j,D,R){return D&&I(j.prototype,D),R&&I(j,R),j}}(),d=function I(j,D,R){j===null&&(j=Function.prototype);var F=Object.getOwnPropertyDescriptor(j,D);if(F===void 0){var B=Object.getPrototypeOf(j);return B===null?void 0:I(B,D,R)}else{if("value"in F)return F.value;var U=F.get;return U===void 0?void 0:U.call(R)}},i=o(0),g=_(i);function _(I){return I&&I.__esModule?I:{default:I}}function S(I,j){if(!(I instanceof j))throw new TypeError("Cannot call a class as a function")}function E(I,j){if(!I)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return j&&(typeof j=="object"||typeof j=="function")?j:I}function T(I,j){if(typeof j!="function"&&j!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof j);I.prototype=Object.create(j&&j.prototype,{constructor:{value:I,enumerable:!1,writable:!0,configurable:!0}}),j&&(Object.setPrototypeOf?Object.setPrototypeOf(I,j):I.__proto__=j)}var C=function(I){T(j,I);function j(){return S(this,j),E(this,(j.__proto__||Object.getPrototypeOf(j)).apply(this,arguments))}return l(j,[{key:"add",value:function(R,F){if(F==="+1"||F==="-1"){var B=this.value(R)||0;F=F==="+1"?B+1:B-1}return F===0?(this.remove(R),!0):d(j.prototype.__proto__||Object.getPrototypeOf(j.prototype),"add",this).call(this,R,F)}},{key:"canAdd",value:function(R,F){return d(j.prototype.__proto__||Object.getPrototypeOf(j.prototype),"canAdd",this).call(this,R,F)||d(j.prototype.__proto__||Object.getPrototypeOf(j.prototype),"canAdd",this).call(this,R,parseInt(F))}},{key:"value",value:function(R){return parseInt(d(j.prototype.__proto__||Object.getPrototypeOf(j.prototype),"value",this).call(this,R))||void 0}}]),j}(g.default.Attributor.Class),N=new C("indent","ql-indent",{scope:g.default.Scope.BLOCK,whitelist:[1,2,3,4,5,6,7,8]});n.IndentClass=N},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(4),d=i(l);function i(T){return T&&T.__esModule?T:{default:T}}function g(T,C){if(!(T instanceof C))throw new TypeError("Cannot call a class as a function")}function _(T,C){if(!T)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return C&&(typeof C=="object"||typeof C=="function")?C:T}function S(T,C){if(typeof C!="function"&&C!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof C);T.prototype=Object.create(C&&C.prototype,{constructor:{value:T,enumerable:!1,writable:!0,configurable:!0}}),C&&(Object.setPrototypeOf?Object.setPrototypeOf(T,C):T.__proto__=C)}var E=function(T){S(C,T);function C(){return g(this,C),_(this,(C.__proto__||Object.getPrototypeOf(C)).apply(this,arguments))}return C}(d.default);E.blotName="blockquote",E.tagName="blockquote",n.default=E},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function C(N,I){for(var j=0;j<I.length;j++){var D=I[j];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(N,D.key,D)}}return function(N,I,j){return I&&C(N.prototype,I),j&&C(N,j),N}}(),d=o(4),i=g(d);function g(C){return C&&C.__esModule?C:{default:C}}function _(C,N){if(!(C instanceof N))throw new TypeError("Cannot call a class as a function")}function S(C,N){if(!C)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return N&&(typeof N=="object"||typeof N=="function")?N:C}function E(C,N){if(typeof N!="function"&&N!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof N);C.prototype=Object.create(N&&N.prototype,{constructor:{value:C,enumerable:!1,writable:!0,configurable:!0}}),N&&(Object.setPrototypeOf?Object.setPrototypeOf(C,N):C.__proto__=N)}var T=function(C){E(N,C);function N(){return _(this,N),S(this,(N.__proto__||Object.getPrototypeOf(N)).apply(this,arguments))}return l(N,null,[{key:"formats",value:function(j){return this.tagName.indexOf(j.tagName)+1}}]),N}(i.default);T.blotName="header",T.tagName=["H1","H2","H3","H4","H5","H6"],n.default=T},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.ListItem=void 0;var l=function(){function B(U,Z){for(var J=0;J<Z.length;J++){var te=Z[J];te.enumerable=te.enumerable||!1,te.configurable=!0,"value"in te&&(te.writable=!0),Object.defineProperty(U,te.key,te)}}return function(U,Z,J){return Z&&B(U.prototype,Z),J&&B(U,J),U}}(),d=function B(U,Z,J){U===null&&(U=Function.prototype);var te=Object.getOwnPropertyDescriptor(U,Z);if(te===void 0){var ae=Object.getPrototypeOf(U);return ae===null?void 0:B(ae,Z,J)}else{if("value"in te)return te.value;var ne=te.get;return ne===void 0?void 0:ne.call(J)}},i=o(0),g=C(i),_=o(4),S=C(_),E=o(25),T=C(E);function C(B){return B&&B.__esModule?B:{default:B}}function N(B,U,Z){return U in B?Object.defineProperty(B,U,{value:Z,enumerable:!0,configurable:!0,writable:!0}):B[U]=Z,B}function I(B,U){if(!(B instanceof U))throw new TypeError("Cannot call a class as a function")}function j(B,U){if(!B)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return U&&(typeof U=="object"||typeof U=="function")?U:B}function D(B,U){if(typeof U!="function"&&U!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof U);B.prototype=Object.create(U&&U.prototype,{constructor:{value:B,enumerable:!1,writable:!0,configurable:!0}}),U&&(Object.setPrototypeOf?Object.setPrototypeOf(B,U):B.__proto__=U)}var R=function(B){D(U,B);function U(){return I(this,U),j(this,(U.__proto__||Object.getPrototypeOf(U)).apply(this,arguments))}return l(U,[{key:"format",value:function(J,te){J===F.blotName&&!te?this.replaceWith(g.default.create(this.statics.scope)):d(U.prototype.__proto__||Object.getPrototypeOf(U.prototype),"format",this).call(this,J,te)}},{key:"remove",value:function(){this.prev==null&&this.next==null?this.parent.remove():d(U.prototype.__proto__||Object.getPrototypeOf(U.prototype),"remove",this).call(this)}},{key:"replaceWith",value:function(J,te){return this.parent.isolate(this.offset(this.parent),this.length()),J===this.parent.statics.blotName?(this.parent.replaceWith(J,te),this):(this.parent.unwrap(),d(U.prototype.__proto__||Object.getPrototypeOf(U.prototype),"replaceWith",this).call(this,J,te))}}],[{key:"formats",value:function(J){return J.tagName===this.tagName?void 0:d(U.__proto__||Object.getPrototypeOf(U),"formats",this).call(this,J)}}]),U}(S.default);R.blotName="list-item",R.tagName="LI";var F=function(B){D(U,B),l(U,null,[{key:"create",value:function(J){var te=J==="ordered"?"OL":"UL",ae=d(U.__proto__||Object.getPrototypeOf(U),"create",this).call(this,te);return(J==="checked"||J==="unchecked")&&ae.setAttribute("data-checked",J==="checked"),ae}},{key:"formats",value:function(J){if(J.tagName==="OL")return"ordered";if(J.tagName==="UL")return J.hasAttribute("data-checked")?J.getAttribute("data-checked")==="true"?"checked":"unchecked":"bullet"}}]);function U(Z){I(this,U);var J=j(this,(U.__proto__||Object.getPrototypeOf(U)).call(this,Z)),te=function(ne){if(ne.target.parentNode===Z){var ie=J.statics.formats(Z),ee=g.default.find(ne.target);ie==="checked"?ee.format("list","unchecked"):ie==="unchecked"&&ee.format("list","checked")}};return Z.addEventListener("touchstart",te),Z.addEventListener("mousedown",te),J}return l(U,[{key:"format",value:function(J,te){this.children.length>0&&this.children.tail.format(J,te)}},{key:"formats",value:function(){return N({},this.statics.blotName,this.statics.formats(this.domNode))}},{key:"insertBefore",value:function(J,te){if(J instanceof R)d(U.prototype.__proto__||Object.getPrototypeOf(U.prototype),"insertBefore",this).call(this,J,te);else{var ae=te==null?this.length():te.offset(this),ne=this.split(ae);ne.parent.insertBefore(J,ne)}}},{key:"optimize",value:function(J){d(U.prototype.__proto__||Object.getPrototypeOf(U.prototype),"optimize",this).call(this,J);var te=this.next;te!=null&&te.prev===this&&te.statics.blotName===this.statics.blotName&&te.domNode.tagName===this.domNode.tagName&&te.domNode.getAttribute("data-checked")===this.domNode.getAttribute("data-checked")&&(te.moveChildren(this),te.remove())}},{key:"replace",value:function(J){if(J.statics.blotName!==this.statics.blotName){var te=g.default.create(this.statics.defaultChild);J.moveChildren(te),this.appendChild(te)}d(U.prototype.__proto__||Object.getPrototypeOf(U.prototype),"replace",this).call(this,J)}}]),U}(T.default);F.blotName="list",F.scope=g.default.Scope.BLOCK_BLOT,F.tagName=["OL","UL"],F.defaultChild="list-item",F.allowedChildren=[R],n.ListItem=R,n.default=F},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(56),d=i(l);function i(T){return T&&T.__esModule?T:{default:T}}function g(T,C){if(!(T instanceof C))throw new TypeError("Cannot call a class as a function")}function _(T,C){if(!T)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return C&&(typeof C=="object"||typeof C=="function")?C:T}function S(T,C){if(typeof C!="function"&&C!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof C);T.prototype=Object.create(C&&C.prototype,{constructor:{value:T,enumerable:!1,writable:!0,configurable:!0}}),C&&(Object.setPrototypeOf?Object.setPrototypeOf(T,C):T.__proto__=C)}var E=function(T){S(C,T);function C(){return g(this,C),_(this,(C.__proto__||Object.getPrototypeOf(C)).apply(this,arguments))}return C}(d.default);E.blotName="italic",E.tagName=["EM","I"],n.default=E},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function N(I,j){for(var D=0;D<j.length;D++){var R=j[D];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(I,R.key,R)}}return function(I,j,D){return j&&N(I.prototype,j),D&&N(I,D),I}}(),d=function N(I,j,D){I===null&&(I=Function.prototype);var R=Object.getOwnPropertyDescriptor(I,j);if(R===void 0){var F=Object.getPrototypeOf(I);return F===null?void 0:N(F,j,D)}else{if("value"in R)return R.value;var B=R.get;return B===void 0?void 0:B.call(D)}},i=o(6),g=_(i);function _(N){return N&&N.__esModule?N:{default:N}}function S(N,I){if(!(N instanceof I))throw new TypeError("Cannot call a class as a function")}function E(N,I){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I&&(typeof I=="object"||typeof I=="function")?I:N}function T(N,I){if(typeof I!="function"&&I!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof I);N.prototype=Object.create(I&&I.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),I&&(Object.setPrototypeOf?Object.setPrototypeOf(N,I):N.__proto__=I)}var C=function(N){T(I,N);function I(){return S(this,I),E(this,(I.__proto__||Object.getPrototypeOf(I)).apply(this,arguments))}return l(I,null,[{key:"create",value:function(D){return D==="super"?document.createElement("sup"):D==="sub"?document.createElement("sub"):d(I.__proto__||Object.getPrototypeOf(I),"create",this).call(this,D)}},{key:"formats",value:function(D){if(D.tagName==="SUB")return"sub";if(D.tagName==="SUP")return"super"}}]),I}(g.default);C.blotName="script",C.tagName=["SUB","SUP"],n.default=C},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(6),d=i(l);function i(T){return T&&T.__esModule?T:{default:T}}function g(T,C){if(!(T instanceof C))throw new TypeError("Cannot call a class as a function")}function _(T,C){if(!T)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return C&&(typeof C=="object"||typeof C=="function")?C:T}function S(T,C){if(typeof C!="function"&&C!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof C);T.prototype=Object.create(C&&C.prototype,{constructor:{value:T,enumerable:!1,writable:!0,configurable:!0}}),C&&(Object.setPrototypeOf?Object.setPrototypeOf(T,C):T.__proto__=C)}var E=function(T){S(C,T);function C(){return g(this,C),_(this,(C.__proto__||Object.getPrototypeOf(C)).apply(this,arguments))}return C}(d.default);E.blotName="strike",E.tagName="S",n.default=E},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(6),d=i(l);function i(T){return T&&T.__esModule?T:{default:T}}function g(T,C){if(!(T instanceof C))throw new TypeError("Cannot call a class as a function")}function _(T,C){if(!T)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return C&&(typeof C=="object"||typeof C=="function")?C:T}function S(T,C){if(typeof C!="function"&&C!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof C);T.prototype=Object.create(C&&C.prototype,{constructor:{value:T,enumerable:!1,writable:!0,configurable:!0}}),C&&(Object.setPrototypeOf?Object.setPrototypeOf(T,C):T.__proto__=C)}var E=function(T){S(C,T);function C(){return g(this,C),_(this,(C.__proto__||Object.getPrototypeOf(C)).apply(this,arguments))}return C}(d.default);E.blotName="underline",E.tagName="U",n.default=E},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function j(D,R){for(var F=0;F<R.length;F++){var B=R[F];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(D,B.key,B)}}return function(D,R,F){return R&&j(D.prototype,R),F&&j(D,F),D}}(),d=function j(D,R,F){D===null&&(D=Function.prototype);var B=Object.getOwnPropertyDescriptor(D,R);if(B===void 0){var U=Object.getPrototypeOf(D);return U===null?void 0:j(U,R,F)}else{if("value"in B)return B.value;var Z=B.get;return Z===void 0?void 0:Z.call(F)}},i=o(0),g=S(i),_=o(27);function S(j){return j&&j.__esModule?j:{default:j}}function E(j,D){if(!(j instanceof D))throw new TypeError("Cannot call a class as a function")}function T(j,D){if(!j)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D&&(typeof D=="object"||typeof D=="function")?D:j}function C(j,D){if(typeof D!="function"&&D!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof D);j.prototype=Object.create(D&&D.prototype,{constructor:{value:j,enumerable:!1,writable:!0,configurable:!0}}),D&&(Object.setPrototypeOf?Object.setPrototypeOf(j,D):j.__proto__=D)}var N=["alt","height","width"],I=function(j){C(D,j);function D(){return E(this,D),T(this,(D.__proto__||Object.getPrototypeOf(D)).apply(this,arguments))}return l(D,[{key:"format",value:function(F,B){N.indexOf(F)>-1?B?this.domNode.setAttribute(F,B):this.domNode.removeAttribute(F):d(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"format",this).call(this,F,B)}}],[{key:"create",value:function(F){var B=d(D.__proto__||Object.getPrototypeOf(D),"create",this).call(this,F);return typeof F=="string"&&B.setAttribute("src",this.sanitize(F)),B}},{key:"formats",value:function(F){return N.reduce(function(B,U){return F.hasAttribute(U)&&(B[U]=F.getAttribute(U)),B},{})}},{key:"match",value:function(F){return/\.(jpe?g|gif|png)$/.test(F)||/^data:image\/.+;base64/.test(F)}},{key:"sanitize",value:function(F){return(0,_.sanitize)(F,["http","https","data"])?F:"//:0"}},{key:"value",value:function(F){return F.getAttribute("src")}}]),D}(g.default.Embed);I.blotName="image",I.tagName="IMG",n.default=I},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function j(D,R){for(var F=0;F<R.length;F++){var B=R[F];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(D,B.key,B)}}return function(D,R,F){return R&&j(D.prototype,R),F&&j(D,F),D}}(),d=function j(D,R,F){D===null&&(D=Function.prototype);var B=Object.getOwnPropertyDescriptor(D,R);if(B===void 0){var U=Object.getPrototypeOf(D);return U===null?void 0:j(U,R,F)}else{if("value"in B)return B.value;var Z=B.get;return Z===void 0?void 0:Z.call(F)}},i=o(4),g=o(27),_=S(g);function S(j){return j&&j.__esModule?j:{default:j}}function E(j,D){if(!(j instanceof D))throw new TypeError("Cannot call a class as a function")}function T(j,D){if(!j)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D&&(typeof D=="object"||typeof D=="function")?D:j}function C(j,D){if(typeof D!="function"&&D!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof D);j.prototype=Object.create(D&&D.prototype,{constructor:{value:j,enumerable:!1,writable:!0,configurable:!0}}),D&&(Object.setPrototypeOf?Object.setPrototypeOf(j,D):j.__proto__=D)}var N=["height","width"],I=function(j){C(D,j);function D(){return E(this,D),T(this,(D.__proto__||Object.getPrototypeOf(D)).apply(this,arguments))}return l(D,[{key:"format",value:function(F,B){N.indexOf(F)>-1?B?this.domNode.setAttribute(F,B):this.domNode.removeAttribute(F):d(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"format",this).call(this,F,B)}}],[{key:"create",value:function(F){var B=d(D.__proto__||Object.getPrototypeOf(D),"create",this).call(this,F);return B.setAttribute("frameborder","0"),B.setAttribute("allowfullscreen",!0),B.setAttribute("src",this.sanitize(F)),B}},{key:"formats",value:function(F){return N.reduce(function(B,U){return F.hasAttribute(U)&&(B[U]=F.getAttribute(U)),B},{})}},{key:"sanitize",value:function(F){return _.default.sanitize(F)}},{key:"value",value:function(F){return F.getAttribute("src")}}]),D}(i.BlockEmbed);I.blotName="video",I.className="ql-video",I.tagName="IFRAME",n.default=I},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.FormulaBlot=void 0;var l=function(){function F(B,U){for(var Z=0;Z<U.length;Z++){var J=U[Z];J.enumerable=J.enumerable||!1,J.configurable=!0,"value"in J&&(J.writable=!0),Object.defineProperty(B,J.key,J)}}return function(B,U,Z){return U&&F(B.prototype,U),Z&&F(B,Z),B}}(),d=function F(B,U,Z){B===null&&(B=Function.prototype);var J=Object.getOwnPropertyDescriptor(B,U);if(J===void 0){var te=Object.getPrototypeOf(B);return te===null?void 0:F(te,U,Z)}else{if("value"in J)return J.value;var ae=J.get;return ae===void 0?void 0:ae.call(Z)}},i=o(35),g=C(i),_=o(5),S=C(_),E=o(9),T=C(E);function C(F){return F&&F.__esModule?F:{default:F}}function N(F,B){if(!(F instanceof B))throw new TypeError("Cannot call a class as a function")}function I(F,B){if(!F)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return B&&(typeof B=="object"||typeof B=="function")?B:F}function j(F,B){if(typeof B!="function"&&B!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof B);F.prototype=Object.create(B&&B.prototype,{constructor:{value:F,enumerable:!1,writable:!0,configurable:!0}}),B&&(Object.setPrototypeOf?Object.setPrototypeOf(F,B):F.__proto__=B)}var D=function(F){j(B,F);function B(){return N(this,B),I(this,(B.__proto__||Object.getPrototypeOf(B)).apply(this,arguments))}return l(B,null,[{key:"create",value:function(Z){var J=d(B.__proto__||Object.getPrototypeOf(B),"create",this).call(this,Z);return typeof Z=="string"&&(window.katex.render(Z,J,{throwOnError:!1,errorColor:"#f00"}),J.setAttribute("data-value",Z)),J}},{key:"value",value:function(Z){return Z.getAttribute("data-value")}}]),B}(g.default);D.blotName="formula",D.className="ql-formula",D.tagName="SPAN";var R=function(F){j(B,F),l(B,null,[{key:"register",value:function(){S.default.register(D,!0)}}]);function B(){N(this,B);var U=I(this,(B.__proto__||Object.getPrototypeOf(B)).call(this));if(window.katex==null)throw new Error("Formula module requires KaTeX.");return U}return B}(T.default);n.FormulaBlot=D,n.default=R},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.CodeToken=n.CodeBlock=void 0;var l=function(){function Z(J,te){for(var ae=0;ae<te.length;ae++){var ne=te[ae];ne.enumerable=ne.enumerable||!1,ne.configurable=!0,"value"in ne&&(ne.writable=!0),Object.defineProperty(J,ne.key,ne)}}return function(J,te,ae){return te&&Z(J.prototype,te),ae&&Z(J,ae),J}}(),d=function Z(J,te,ae){J===null&&(J=Function.prototype);var ne=Object.getOwnPropertyDescriptor(J,te);if(ne===void 0){var ie=Object.getPrototypeOf(J);return ie===null?void 0:Z(ie,te,ae)}else{if("value"in ne)return ne.value;var ee=ne.get;return ee===void 0?void 0:ee.call(ae)}},i=o(0),g=I(i),_=o(5),S=I(_),E=o(9),T=I(E),C=o(13),N=I(C);function I(Z){return Z&&Z.__esModule?Z:{default:Z}}function j(Z,J){if(!(Z instanceof J))throw new TypeError("Cannot call a class as a function")}function D(Z,J){if(!Z)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return J&&(typeof J=="object"||typeof J=="function")?J:Z}function R(Z,J){if(typeof J!="function"&&J!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof J);Z.prototype=Object.create(J&&J.prototype,{constructor:{value:Z,enumerable:!1,writable:!0,configurable:!0}}),J&&(Object.setPrototypeOf?Object.setPrototypeOf(Z,J):Z.__proto__=J)}var F=function(Z){R(J,Z);function J(){return j(this,J),D(this,(J.__proto__||Object.getPrototypeOf(J)).apply(this,arguments))}return l(J,[{key:"replaceWith",value:function(ae){this.domNode.textContent=this.domNode.textContent,this.attach(),d(J.prototype.__proto__||Object.getPrototypeOf(J.prototype),"replaceWith",this).call(this,ae)}},{key:"highlight",value:function(ae){var ne=this.domNode.textContent;this.cachedText!==ne&&((ne.trim().length>0||this.cachedText==null)&&(this.domNode.innerHTML=ae(ne),this.domNode.normalize(),this.attach()),this.cachedText=ne)}}]),J}(N.default);F.className="ql-syntax";var B=new g.default.Attributor.Class("token","hljs",{scope:g.default.Scope.INLINE}),U=function(Z){R(J,Z),l(J,null,[{key:"register",value:function(){S.default.register(B,!0),S.default.register(F,!0)}}]);function J(te,ae){j(this,J);var ne=D(this,(J.__proto__||Object.getPrototypeOf(J)).call(this,te,ae));if(typeof ne.options.highlight!="function")throw new Error("Syntax module requires highlight.js. Please include the library on the page before Quill.");var ie=null;return ne.quill.on(S.default.events.SCROLL_OPTIMIZE,function(){clearTimeout(ie),ie=setTimeout(function(){ne.highlight(),ie=null},ne.options.interval)}),ne.highlight(),ne}return l(J,[{key:"highlight",value:function(){var ae=this;if(!this.quill.selection.composing){this.quill.update(S.default.sources.USER);var ne=this.quill.getSelection();this.quill.scroll.descendants(F).forEach(function(ie){ie.highlight(ae.options.highlight)}),this.quill.update(S.default.sources.SILENT),ne!=null&&this.quill.setSelection(ne,S.default.sources.SILENT)}}}]),J}(T.default);U.DEFAULTS={highlight:function(){return window.hljs==null?null:function(Z){var J=window.hljs.highlightAuto(Z);return J.value}}(),interval:1e3},n.CodeBlock=F,n.CodeToken=B,n.default=U},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=3 x2=13 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=9 y1=4 y2=4></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=14 x2=4 y1=14 y2=14></line> <line class=ql-stroke x1=12 x2=6 y1=4 y2=4></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=15 x2=5 y1=14 y2=14></line> <line class=ql-stroke x1=15 x2=9 y1=4 y2=4></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=15 x2=3 y1=14 y2=14></line> <line class=ql-stroke x1=15 x2=3 y1=4 y2=4></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <g class="ql-fill ql-color-label"> <polygon points="6 6.868 6 6 5 6 5 7 5.942 7 6 6.868"></polygon> <rect height=1 width=1 x=4 y=4></rect> <polygon points="6.817 5 6 5 6 6 6.38 6 6.817 5"></polygon> <rect height=1 width=1 x=2 y=6></rect> <rect height=1 width=1 x=3 y=5></rect> <rect height=1 width=1 x=4 y=7></rect> <polygon points="4 11.439 4 11 3 11 3 12 3.755 12 4 11.439"></polygon> <rect height=1 width=1 x=2 y=12></rect> <rect height=1 width=1 x=2 y=9></rect> <rect height=1 width=1 x=2 y=15></rect> <polygon points="4.63 10 4 10 4 11 4.192 11 4.63 10"></polygon> <rect height=1 width=1 x=3 y=8></rect> <path d=M10.832,4.2L11,4.582V4H10.708A1.948,1.948,0,0,1,10.832,4.2Z></path> <path d=M7,4.582L7.168,4.2A1.929,1.929,0,0,1,7.292,4H7V4.582Z></path> <path d=M8,13H7.683l-0.351.8a1.933,1.933,0,0,1-.124.2H8V13Z></path> <rect height=1 width=1 x=12 y=2></rect> <rect height=1 width=1 x=11 y=3></rect> <path d=M9,3H8V3.282A1.985,1.985,0,0,1,9,3Z></path> <rect height=1 width=1 x=2 y=3></rect> <rect height=1 width=1 x=6 y=2></rect> <rect height=1 width=1 x=3 y=2></rect> <rect height=1 width=1 x=5 y=3></rect> <rect height=1 width=1 x=9 y=2></rect> <rect height=1 width=1 x=15 y=14></rect> <polygon points="13.447 10.174 13.469 10.225 13.472 10.232 13.808 11 14 11 14 10 13.37 10 13.447 10.174"></polygon> <rect height=1 width=1 x=13 y=7></rect> <rect height=1 width=1 x=15 y=5></rect> <rect height=1 width=1 x=14 y=6></rect> <rect height=1 width=1 x=15 y=8></rect> <rect height=1 width=1 x=14 y=9></rect> <path d=M3.775,14H3v1H4V14.314A1.97,1.97,0,0,1,3.775,14Z></path> <rect height=1 width=1 x=14 y=3></rect> <polygon points="12 6.868 12 6 11.62 6 12 6.868"></polygon> <rect height=1 width=1 x=15 y=2></rect> <rect height=1 width=1 x=12 y=5></rect> <rect height=1 width=1 x=13 y=4></rect> <polygon points="12.933 9 13 9 13 8 12.495 8 12.933 9"></polygon> <rect height=1 width=1 x=9 y=14></rect> <rect height=1 width=1 x=8 y=15></rect> <path d=M6,14.926V15H7V14.316A1.993,1.993,0,0,1,6,14.926Z></path> <rect height=1 width=1 x=5 y=15></rect> <path d=M10.668,13.8L10.317,13H10v1h0.792A1.947,1.947,0,0,1,10.668,13.8Z></path> <rect height=1 width=1 x=11 y=15></rect> <path d=M14.332,12.2a1.99,1.99,0,0,1,.166.8H15V12H14.245Z></path> <rect height=1 width=1 x=14 y=15></rect> <rect height=1 width=1 x=15 y=11></rect> </g> <polyline class=ql-stroke points="5.5 13 9 5 12.5 13"></polyline> <line class=ql-stroke x1=11.63 x2=6.38 y1=11 y2=11></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <rect class="ql-fill ql-stroke" height=3 width=3 x=4 y=5></rect> <rect class="ql-fill ql-stroke" height=3 width=3 x=11 y=5></rect> <path class="ql-even ql-fill ql-stroke" d=M7,8c0,4.031-3,5-3,5></path> <path class="ql-even ql-fill ql-stroke" d=M14,8c0,4.031-3,5-3,5></path> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-stroke d=M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z></path> <path class=ql-stroke d=M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z></path> </svg>'},function(r,n){r.exports='<svg class="" viewbox="0 0 18 18"> <line class=ql-stroke x1=5 x2=13 y1=3 y2=3></line> <line class=ql-stroke x1=6 x2=9.35 y1=12 y2=3></line> <line class=ql-stroke x1=11 x2=15 y1=11 y2=15></line> <line class=ql-stroke x1=15 x2=11 y1=11 y2=15></line> <rect class=ql-fill height=1 rx=0.5 ry=0.5 width=7 x=2 y=14></rect> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class="ql-color-label ql-stroke ql-transparent" x1=3 x2=15 y1=15 y2=15></line> <polyline class=ql-stroke points="5.5 11 9 3 12.5 11"></polyline> <line class=ql-stroke x1=11.63 x2=6.38 y1=9 y2=9></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <polygon class="ql-stroke ql-fill" points="3 11 5 9 3 7 3 11"></polygon> <line class="ql-stroke ql-fill" x1=15 x2=11 y1=4 y2=4></line> <path class=ql-fill d=M11,3a3,3,0,0,0,0,6h1V3H11Z></path> <rect class=ql-fill height=11 width=1 x=11 y=4></rect> <rect class=ql-fill height=11 width=1 x=13 y=4></rect> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <polygon class="ql-stroke ql-fill" points="15 12 13 10 15 8 15 12"></polygon> <line class="ql-stroke ql-fill" x1=9 x2=5 y1=4 y2=4></line> <path class=ql-fill d=M5,3A3,3,0,0,0,5,9H6V3H5Z></path> <rect class=ql-fill height=11 width=1 x=5 y=4></rect> <rect class=ql-fill height=11 width=1 x=7 y=4></rect> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M14,16H4a1,1,0,0,1,0-2H14A1,1,0,0,1,14,16Z /> <path class=ql-fill d=M14,4H4A1,1,0,0,1,4,2H14A1,1,0,0,1,14,4Z /> <rect class=ql-fill x=3 y=6 width=12 height=6 rx=1 ry=1 /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M13,16H5a1,1,0,0,1,0-2h8A1,1,0,0,1,13,16Z /> <path class=ql-fill d=M13,4H5A1,1,0,0,1,5,2h8A1,1,0,0,1,13,4Z /> <rect class=ql-fill x=2 y=6 width=14 height=6 rx=1 ry=1 /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15,8H13a1,1,0,0,1,0-2h2A1,1,0,0,1,15,8Z /> <path class=ql-fill d=M15,12H13a1,1,0,0,1,0-2h2A1,1,0,0,1,15,12Z /> <path class=ql-fill d=M15,16H5a1,1,0,0,1,0-2H15A1,1,0,0,1,15,16Z /> <path class=ql-fill d=M15,4H5A1,1,0,0,1,5,2H15A1,1,0,0,1,15,4Z /> <rect class=ql-fill x=2 y=6 width=8 height=6 rx=1 ry=1 /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M5,8H3A1,1,0,0,1,3,6H5A1,1,0,0,1,5,8Z /> <path class=ql-fill d=M5,12H3a1,1,0,0,1,0-2H5A1,1,0,0,1,5,12Z /> <path class=ql-fill d=M13,16H3a1,1,0,0,1,0-2H13A1,1,0,0,1,13,16Z /> <path class=ql-fill d=M13,4H3A1,1,0,0,1,3,2H13A1,1,0,0,1,13,4Z /> <rect class=ql-fill x=8 y=6 width=8 height=6 rx=1 ry=1 transform="translate(24 18) rotate(-180)"/> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M11.759,2.482a2.561,2.561,0,0,0-3.53.607A7.656,7.656,0,0,0,6.8,6.2C6.109,9.188,5.275,14.677,4.15,14.927a1.545,1.545,0,0,0-1.3-.933A0.922,0.922,0,0,0,2,15.036S1.954,16,4.119,16s3.091-2.691,3.7-5.553c0.177-.826.36-1.726,0.554-2.6L8.775,6.2c0.381-1.421.807-2.521,1.306-2.676a1.014,1.014,0,0,0,1.02.56A0.966,0.966,0,0,0,11.759,2.482Z></path> <rect class=ql-fill height=1.6 rx=0.8 ry=0.8 width=5 x=5.15 y=6.2></rect> <path class=ql-fill d=M13.663,12.027a1.662,1.662,0,0,1,.266-0.276q0.193,0.069.456,0.138a2.1,2.1,0,0,0,.535.069,1.075,1.075,0,0,0,.767-0.3,1.044,1.044,0,0,0,.314-0.8,0.84,0.84,0,0,0-.238-0.619,0.8,0.8,0,0,0-.594-0.239,1.154,1.154,0,0,0-.781.3,4.607,4.607,0,0,0-.781,1q-0.091.15-.218,0.346l-0.246.38c-0.068-.288-0.137-0.582-0.212-0.885-0.459-1.847-2.494-.984-2.941-0.8-0.482.2-.353,0.647-0.094,0.529a0.869,0.869,0,0,1,1.281.585c0.217,0.751.377,1.436,0.527,2.038a5.688,5.688,0,0,1-.362.467,2.69,2.69,0,0,1-.264.271q-0.221-.08-0.471-0.147a2.029,2.029,0,0,0-.522-0.066,1.079,1.079,0,0,0-.768.3A1.058,1.058,0,0,0,9,15.131a0.82,0.82,0,0,0,.832.852,1.134,1.134,0,0,0,.787-0.3,5.11,5.11,0,0,0,.776-0.993q0.141-.219.215-0.34c0.046-.076.122-0.194,0.223-0.346a2.786,2.786,0,0,0,.918,1.726,2.582,2.582,0,0,0,2.376-.185c0.317-.181.212-0.565,0-0.494A0.807,0.807,0,0,1,14.176,15a5.159,5.159,0,0,1-.913-2.446l0,0Q13.487,12.24,13.663,12.027Z></path> </svg>'},function(r,n){r.exports='<svg viewBox="0 0 18 18"> <path class=ql-fill d=M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm6.06787,9.209H14.98975V7.59863a.54085.54085,0,0,0-.605-.60547h-.62744a1.01119,1.01119,0,0,0-.748.29688L11.645,8.56641a.5435.5435,0,0,0-.022.8584l.28613.30762a.53861.53861,0,0,0,.84717.0332l.09912-.08789a1.2137,1.2137,0,0,0,.2417-.35254h.02246s-.01123.30859-.01123.60547V13.209H12.041a.54085.54085,0,0,0-.605.60547v.43945a.54085.54085,0,0,0,.605.60547h4.02686a.54085.54085,0,0,0,.605-.60547v-.43945A.54085.54085,0,0,0,16.06787,13.209Z /> </svg>'},function(r,n){r.exports='<svg viewBox="0 0 18 18"> <path class=ql-fill d=M16.73975,13.81445v.43945a.54085.54085,0,0,1-.605.60547H11.855a.58392.58392,0,0,1-.64893-.60547V14.0127c0-2.90527,3.39941-3.42187,3.39941-4.55469a.77675.77675,0,0,0-.84717-.78125,1.17684,1.17684,0,0,0-.83594.38477c-.2749.26367-.561.374-.85791.13184l-.4292-.34082c-.30811-.24219-.38525-.51758-.1543-.81445a2.97155,2.97155,0,0,1,2.45361-1.17676,2.45393,2.45393,0,0,1,2.68408,2.40918c0,2.45312-3.1792,2.92676-3.27832,3.93848h2.79443A.54085.54085,0,0,1,16.73975,13.81445ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=13 y1=4 y2=4></line> <line class=ql-stroke x1=5 x2=11 y1=14 y2=14></line> <line class=ql-stroke x1=8 x2=10 y1=14 y2=4></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <rect class=ql-stroke height=10 width=12 x=3 y=4></rect> <circle class=ql-fill cx=6 cy=7 r=1></circle> <polyline class="ql-even ql-fill" points="5 12 5 11 7 9 8 10 11 7 13 9 13 12 5 12"></polyline> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class="ql-fill ql-stroke" points="3 7 3 11 5 9 3 7"></polyline> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class=ql-stroke points="5 7 5 11 3 9 5 7"></polyline> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=11 y1=7 y2=11></line> <path class="ql-even ql-stroke" d=M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z></path> <path class="ql-even ql-stroke" d=M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z></path> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=7 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=7 x2=15 y1=14 y2=14></line> <line class="ql-stroke ql-thin" x1=2.5 x2=4.5 y1=5.5 y2=5.5></line> <path class=ql-fill d=M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z></path> <path class="ql-stroke ql-thin" d=M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156></path> <path class="ql-stroke ql-thin" d=M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109></path> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=6 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=6 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=6 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=3 y1=4 y2=4></line> <line class=ql-stroke x1=3 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=3 x2=3 y1=14 y2=14></line> </svg>'},function(r,n){r.exports='<svg class="" viewbox="0 0 18 18"> <line class=ql-stroke x1=9 x2=15 y1=4 y2=4></line> <polyline class=ql-stroke points="3 4 4 5 6 3"></polyline> <line class=ql-stroke x1=9 x2=15 y1=14 y2=14></line> <polyline class=ql-stroke points="3 14 4 15 6 13"></polyline> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class=ql-stroke points="3 9 4 10 6 8"></polyline> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15.5,15H13.861a3.858,3.858,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.921,1.921,0,0,0,12.021,11.7a0.50013,0.50013,0,1,0,.957.291h0a0.914,0.914,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.076-1.16971,1.86982-1.93971,2.43082A1.45639,1.45639,0,0,0,12,15.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,15Z /> <path class=ql-fill d=M9.65,5.241a1,1,0,0,0-1.409.108L6,7.964,3.759,5.349A1,1,0,0,0,2.192,6.59178Q2.21541,6.6213,2.241,6.649L4.684,9.5,2.241,12.35A1,1,0,0,0,3.71,13.70722q0.02557-.02768.049-0.05722L6,11.036,8.241,13.65a1,1,0,1,0,1.567-1.24277Q9.78459,12.3777,9.759,12.35L7.316,9.5,9.759,6.651A1,1,0,0,0,9.65,5.241Z /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15.5,7H13.861a4.015,4.015,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.922,1.922,0,0,0,12.021,3.7a0.5,0.5,0,1,0,.957.291,0.917,0.917,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.077-1.164,1.925-1.934,2.486A1.423,1.423,0,0,0,12,7.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,7Z /> <path class=ql-fill d=M9.651,5.241a1,1,0,0,0-1.41.108L6,7.964,3.759,5.349a1,1,0,1,0-1.519,1.3L4.683,9.5,2.241,12.35a1,1,0,1,0,1.519,1.3L6,11.036,8.241,13.65a1,1,0,0,0,1.519-1.3L7.317,9.5,9.759,6.651A1,1,0,0,0,9.651,5.241Z /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class="ql-stroke ql-thin" x1=15.5 x2=2.5 y1=8.5 y2=9.5></line> <path class=ql-fill d=M9.007,8C6.542,7.791,6,7.519,6,6.5,6,5.792,7.283,5,9,5c1.571,0,2.765.679,2.969,1.309a1,1,0,0,0,1.9-.617C13.356,4.106,11.354,3,9,3,6.2,3,4,4.538,4,6.5a3.2,3.2,0,0,0,.5,1.843Z></path> <path class=ql-fill d=M8.984,10C11.457,10.208,12,10.479,12,11.5c0,0.708-1.283,1.5-3,1.5-1.571,0-2.765-.679-2.969-1.309a1,1,0,1,0-1.9.617C4.644,13.894,6.646,15,9,15c2.8,0,5-1.538,5-3.5a3.2,3.2,0,0,0-.5-1.843Z></path> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-stroke d=M5,3V9a4.012,4.012,0,0,0,4,4H9a4.012,4.012,0,0,0,4-4V3></path> <rect class=ql-fill height=1 rx=0.5 ry=0.5 width=12 x=3 y=15></rect> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <rect class=ql-stroke height=12 width=12 x=3 y=3></rect> <rect class=ql-fill height=12 width=1 x=5 y=3></rect> <rect class=ql-fill height=12 width=1 x=12 y=3></rect> <rect class=ql-fill height=2 width=8 x=5 y=8></rect> <rect class=ql-fill height=1 width=3 x=3 y=5></rect> <rect class=ql-fill height=1 width=3 x=3 y=7></rect> <rect class=ql-fill height=1 width=3 x=3 y=10></rect> <rect class=ql-fill height=1 width=3 x=3 y=12></rect> <rect class=ql-fill height=1 width=3 x=12 y=5></rect> <rect class=ql-fill height=1 width=3 x=12 y=7></rect> <rect class=ql-fill height=1 width=3 x=12 y=10></rect> <rect class=ql-fill height=1 width=3 x=12 y=12></rect> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <polygon class=ql-stroke points="7 11 9 13 11 11 7 11"></polygon> <polygon class=ql-stroke points="7 7 9 5 11 7 7 7"></polygon> </svg>'},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.BubbleTooltip=void 0;var l=function J(te,ae,ne){te===null&&(te=Function.prototype);var ie=Object.getOwnPropertyDescriptor(te,ae);if(ie===void 0){var ee=Object.getPrototypeOf(te);return ee===null?void 0:J(ee,ae,ne)}else{if("value"in ie)return ie.value;var oe=ie.get;return oe===void 0?void 0:oe.call(ne)}},d=function(){function J(te,ae){for(var ne=0;ne<ae.length;ne++){var ie=ae[ne];ie.enumerable=ie.enumerable||!1,ie.configurable=!0,"value"in ie&&(ie.writable=!0),Object.defineProperty(te,ie.key,ie)}}return function(te,ae,ne){return ae&&J(te.prototype,ae),ne&&J(te,ne),te}}(),i=o(3),g=j(i),_=o(8),S=j(_),E=o(43),T=j(E),C=o(15),N=o(41),I=j(N);function j(J){return J&&J.__esModule?J:{default:J}}function D(J,te){if(!(J instanceof te))throw new TypeError("Cannot call a class as a function")}function R(J,te){if(!J)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return te&&(typeof te=="object"||typeof te=="function")?te:J}function F(J,te){if(typeof te!="function"&&te!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof te);J.prototype=Object.create(te&&te.prototype,{constructor:{value:J,enumerable:!1,writable:!0,configurable:!0}}),te&&(Object.setPrototypeOf?Object.setPrototypeOf(J,te):J.__proto__=te)}var B=[["bold","italic","link"],[{header:1},{header:2},"blockquote"]],U=function(J){F(te,J);function te(ae,ne){D(this,te),ne.modules.toolbar!=null&&ne.modules.toolbar.container==null&&(ne.modules.toolbar.container=B);var ie=R(this,(te.__proto__||Object.getPrototypeOf(te)).call(this,ae,ne));return ie.quill.container.classList.add("ql-bubble"),ie}return d(te,[{key:"extendToolbar",value:function(ne){this.tooltip=new Z(this.quill,this.options.bounds),this.tooltip.root.appendChild(ne.container),this.buildButtons([].slice.call(ne.container.querySelectorAll("button")),I.default),this.buildPickers([].slice.call(ne.container.querySelectorAll("select")),I.default)}}]),te}(T.default);U.DEFAULTS=(0,g.default)(!0,{},T.default.DEFAULTS,{modules:{toolbar:{handlers:{link:function(te){te?this.quill.theme.tooltip.edit():this.quill.format("link",!1)}}}}});var Z=function(J){F(te,J);function te(ae,ne){D(this,te);var ie=R(this,(te.__proto__||Object.getPrototypeOf(te)).call(this,ae,ne));return ie.quill.on(S.default.events.EDITOR_CHANGE,function(ee,oe,de,xe){if(ee===S.default.events.SELECTION_CHANGE)if(oe!=null&&oe.length>0&&xe===S.default.sources.USER){ie.show(),ie.root.style.left="0px",ie.root.style.width="",ie.root.style.width=ie.root.offsetWidth+"px";var we=ie.quill.getLines(oe.index,oe.length);if(we.length===1)ie.position(ie.quill.getBounds(oe));else{var Ae=we[we.length-1],Ce=ie.quill.getIndex(Ae),me=Math.min(Ae.length()-1,oe.index+oe.length-Ce),Pe=ie.quill.getBounds(new C.Range(Ce,me));ie.position(Pe)}}else document.activeElement!==ie.textbox&&ie.quill.hasFocus()&&ie.hide()}),ie}return d(te,[{key:"listen",value:function(){var ne=this;l(te.prototype.__proto__||Object.getPrototypeOf(te.prototype),"listen",this).call(this),this.root.querySelector(".ql-close").addEventListener("click",function(){ne.root.classList.remove("ql-editing")}),this.quill.on(S.default.events.SCROLL_OPTIMIZE,function(){setTimeout(function(){if(!ne.root.classList.contains("ql-hidden")){var ie=ne.quill.getSelection();ie!=null&&ne.position(ne.quill.getBounds(ie))}},1)})}},{key:"cancel",value:function(){this.show()}},{key:"position",value:function(ne){var ie=l(te.prototype.__proto__||Object.getPrototypeOf(te.prototype),"position",this).call(this,ne),ee=this.root.querySelector(".ql-tooltip-arrow");if(ee.style.marginLeft="",ie===0)return ie;ee.style.marginLeft=-1*ie-ee.offsetWidth/2+"px"}}]),te}(E.BaseTooltip);Z.TEMPLATE=['<span class="ql-tooltip-arrow"></span>','<div class="ql-tooltip-editor">','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-close"></a>',"</div>"].join(""),n.BubbleTooltip=Z,n.default=U},function(r,n,o){r.exports=o(63)}]).default})})(Xce);var vet=Xce.exports,_et=gc&&gc.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var l in o)o.hasOwnProperty(l)&&(n[l]=o[l])},e(t,r)};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),zk=gc&&gc.__assign||function(){return zk=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},zk.apply(this,arguments)},xet=gc&&gc.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),o=0,t=0;t<r;t++)for(var l=arguments[t],d=0,i=l.length;d<i;d++,o++)n[o]=l[d];return n},qR=gc&&gc.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},rh=qR(W),bet=qR(tg),SS=qR(Bse),JK=qR(vet),wet=function(e){_et(t,e);function t(r){var n=e.call(this,r)||this;n.dirtyProps=["modules","formats","bounds","theme","children"],n.cleanProps=["id","className","style","placeholder","tabIndex","onChange","onChangeSelection","onFocus","onBlur","onKeyPress","onKeyDown","onKeyUp"],n.state={generation:0},n.selection=null,n.onEditorChange=function(l,d,i,g){var _,S,E,T;l==="text-change"?(S=(_=n).onEditorChangeText)===null||S===void 0||S.call(_,n.editor.root.innerHTML,d,g,n.unprivilegedEditor):l==="selection-change"&&((T=(E=n).onEditorChangeSelection)===null||T===void 0||T.call(E,d,g,n.unprivilegedEditor))};var o=n.isControlled()?r.value:r.defaultValue;return n.value=o??"",n}return t.prototype.validateProps=function(r){var n;if(rh.default.Children.count(r.children)>1)throw new Error("The Quill editing area can only be composed of a single React element.");if(rh.default.Children.count(r.children)){var o=rh.default.Children.only(r.children);if(((n=o)===null||n===void 0?void 0:n.type)==="textarea")throw new Error("Quill does not support editing on a <textarea>. Use a <div> instead.")}if(this.lastDeltaChangeSet&&r.value===this.lastDeltaChangeSet)throw new Error("You are passing the `delta` object from the `onChange` event back as `value`. You most probably want `editor.getContents()` instead. See: https://github.com/zenoamaro/react-quill#using-deltas")},t.prototype.shouldComponentUpdate=function(r,n){var o=this,l;if(this.validateProps(r),!this.editor||this.state.generation!==n.generation)return!0;if("value"in r){var d=this.getEditorContents(),i=(l=r.value,l??"");this.isEqualValue(i,d)||this.setEditorContents(this.editor,i)}return r.readOnly!==this.props.readOnly&&this.setEditorReadOnly(this.editor,r.readOnly),xet(this.cleanProps,this.dirtyProps).some(function(g){return!SS.default(r[g],o.props[g])})},t.prototype.shouldComponentRegenerate=function(r){var n=this;return this.dirtyProps.some(function(o){return!SS.default(r[o],n.props[o])})},t.prototype.componentDidMount=function(){this.instantiateEditor(),this.setEditorContents(this.editor,this.getEditorContents())},t.prototype.componentWillUnmount=function(){this.destroyEditor()},t.prototype.componentDidUpdate=function(r,n){var o=this;if(this.editor&&this.shouldComponentRegenerate(r)){var l=this.editor.getContents(),d=this.editor.getSelection();this.regenerationSnapshot={delta:l,selection:d},this.setState({generation:this.state.generation+1}),this.destroyEditor()}if(this.state.generation!==n.generation){var i=this.regenerationSnapshot,l=i.delta,g=i.selection;delete this.regenerationSnapshot,this.instantiateEditor();var _=this.editor;_.setContents(l),QK(function(){return o.setEditorSelection(_,g)})}},t.prototype.instantiateEditor=function(){this.editor?this.hookEditor(this.editor):this.editor=this.createEditor(this.getEditingArea(),this.getEditorConfig())},t.prototype.destroyEditor=function(){this.editor&&this.unhookEditor(this.editor)},t.prototype.isControlled=function(){return"value"in this.props},t.prototype.getEditorConfig=function(){return{bounds:this.props.bounds,formats:this.props.formats,modules:this.props.modules,placeholder:this.props.placeholder,readOnly:this.props.readOnly,scrollingContainer:this.props.scrollingContainer,tabIndex:this.props.tabIndex,theme:this.props.theme}},t.prototype.getEditor=function(){if(!this.editor)throw new Error("Accessing non-instantiated editor");return this.editor},t.prototype.createEditor=function(r,n){var o=new JK.default(r,n);return n.tabIndex!=null&&this.setEditorTabIndex(o,n.tabIndex),this.hookEditor(o),o},t.prototype.hookEditor=function(r){this.unprivilegedEditor=this.makeUnprivilegedEditor(r),r.on("editor-change",this.onEditorChange)},t.prototype.unhookEditor=function(r){r.off("editor-change",this.onEditorChange)},t.prototype.getEditorContents=function(){return this.value},t.prototype.getEditorSelection=function(){return this.selection},t.prototype.isDelta=function(r){return r&&r.ops},t.prototype.isEqualValue=function(r,n){return this.isDelta(r)&&this.isDelta(n)?SS.default(r.ops,n.ops):SS.default(r,n)},t.prototype.setEditorContents=function(r,n){var o=this;this.value=n;var l=this.getEditorSelection();typeof n=="string"?r.setContents(r.clipboard.convert(n)):r.setContents(n),QK(function(){return o.setEditorSelection(r,l)})},t.prototype.setEditorSelection=function(r,n){if(this.selection=n,n){var o=r.getLength();n.index=Math.max(0,Math.min(n.index,o-1)),n.length=Math.max(0,Math.min(n.length,o-1-n.index)),r.setSelection(n)}},t.prototype.setEditorTabIndex=function(r,n){var o,l;!((l=(o=r)===null||o===void 0?void 0:o.scroll)===null||l===void 0)&&l.domNode&&(r.scroll.domNode.tabIndex=n)},t.prototype.setEditorReadOnly=function(r,n){n?r.disable():r.enable()},t.prototype.makeUnprivilegedEditor=function(r){var n=r;return{getHTML:function(){return n.root.innerHTML},getLength:n.getLength.bind(n),getText:n.getText.bind(n),getContents:n.getContents.bind(n),getSelection:n.getSelection.bind(n),getBounds:n.getBounds.bind(n)}},t.prototype.getEditingArea=function(){if(!this.editingArea)throw new Error("Instantiating on missing editing area");var r=bet.default.findDOMNode(this.editingArea);if(!r)throw new Error("Cannot find element for editing area");if(r.nodeType===3)throw new Error("Editing area cannot be a text node");return r},t.prototype.renderEditingArea=function(){var r=this,n=this.props,o=n.children,l=n.preserveWhitespace,d=this.state.generation,i={key:d,ref:function(g){r.editingArea=g}};return rh.default.Children.count(o)?rh.default.cloneElement(rh.default.Children.only(o),i):l?rh.default.createElement("pre",zk({},i)):rh.default.createElement("div",zk({},i))},t.prototype.render=function(){var r;return rh.default.createElement("div",{id:this.props.id,style:this.props.style,key:this.state.generation,className:"quill "+(r=this.props.className,r??""),onKeyPress:this.props.onKeyPress,onKeyDown:this.props.onKeyDown,onKeyUp:this.props.onKeyUp},this.renderEditingArea())},t.prototype.onEditorChangeText=function(r,n,o,l){var d,i;if(this.editor){var g=this.isDelta(this.value)?l.getContents():l.getHTML();g!==this.getEditorContents()&&(this.lastDeltaChangeSet=n,this.value=g,(i=(d=this.props).onChange)===null||i===void 0||i.call(d,r,n,o,l))}},t.prototype.onEditorChangeSelection=function(r,n,o){var l,d,i,g,_,S;if(this.editor){var E=this.getEditorSelection(),T=!E&&r,C=E&&!r;SS.default(r,E)||(this.selection=r,(d=(l=this.props).onChangeSelection)===null||d===void 0||d.call(l,r,n,o),T?(g=(i=this.props).onFocus)===null||g===void 0||g.call(i,r,n,o):C&&((S=(_=this.props).onBlur)===null||S===void 0||S.call(_,E,n,o)))}},t.prototype.focus=function(){this.editor&&this.editor.focus()},t.prototype.blur=function(){this.editor&&(this.selection=null,this.editor.blur())},t.displayName="React Quill",t.Quill=JK.default,t.defaultProps={theme:"snow",modules:{},readOnly:!1},t}(rh.default.Component);function QK(e){Promise.resolve().then(e)}var Eet=wet;const Tet=_a(Eet);function RD({value:e,onChange:t,placeholder:r,className:n}){const o=W.useMemo(()=>({toolbar:[[{header:[1,2,3,!1]}],[{size:["small",!1,"large","huge"]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["link"],["clean"]]}),[]),l=["header","size","bold","italic","underline","strike","color","background","list","bullet","align","link"];return m.jsxs("div",{className:yr("rich-text-editor",n),children:[m.jsx("style",{dangerouslySetInnerHTML:{__html:`
          .rich-text-editor .ql-container {
            min-height: 200px;
            font-family: inherit;
            border-bottom-left-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
          }
          
          .rich-text-editor .ql-toolbar {
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
            background: hsl(var(--muted));
            border-color: hsl(var(--border));
          }
          
          .rich-text-editor .ql-container {
            border-color: hsl(var(--border));
          }
          
          .rich-text-editor .ql-editor {
            min-height: 200px;
            color: hsl(var(--foreground));
          }
          
          .rich-text-editor .ql-editor.ql-blank::before {
            color: hsl(var(--muted-foreground));
            font-style: normal;
          }
          
          .rich-text-editor .ql-stroke {
            stroke: hsl(var(--foreground));
          }
          
          .rich-text-editor .ql-fill {
            fill: hsl(var(--foreground));
          }
          
          .rich-text-editor .ql-picker-label {
            color: hsl(var(--foreground));
          }
          
          .rich-text-editor .ql-toolbar button:hover,
          .rich-text-editor .ql-toolbar button:focus,
          .rich-text-editor .ql-toolbar button.ql-active {
            color: hsl(var(--primary));
          }
          
          .rich-text-editor .ql-toolbar button:hover .ql-stroke,
          .rich-text-editor .ql-toolbar button:focus .ql-stroke,
          .rich-text-editor .ql-toolbar button.ql-active .ql-stroke {
            stroke: hsl(var(--primary));
          }
          
          .rich-text-editor .ql-toolbar button:hover .ql-fill,
          .rich-text-editor .ql-toolbar button:focus .ql-fill,
          .rich-text-editor .ql-toolbar button.ql-active .ql-fill {
            fill: hsl(var(--primary));
          }
          
          .rich-text-editor .ql-picker-options {
            background: hsl(var(--background));
            border-color: hsl(var(--border));
          }
          
          .rich-text-editor .ql-picker-item:hover {
            color: hsl(var(--primary));
          }
        `}}),m.jsx(Tet,{theme:"snow",value:e,onChange:t,modules:o,formats:l,placeholder:r,className:"bg-background"})]})}const Aet=cm({title_en:Ji().min(1,jr.t("validation.titleRequired")),title_zh:Ji().min(1,jr.t("validation.titleRequired")),title_pt:Ji().min(1,jr.t("validation.titleRequired")),content_en:Ji().min(1,jr.t("validation.contentRequired")),content_zh:Ji().min(1,jr.t("validation.contentRequired")),content_pt:Ji().min(1,jr.t("validation.contentRequired")),start_date:BW(),end_date:BW().optional(),repeat_mode:tae(["none","daily","weekly","monthly","yearly"]),pinned:eae().default(!1),sort_order:L3().default(0),badge_text_zh:Ji().optional(),badge_text_en:Ji().optional(),badge_text_pt:Ji().optional(),badge_color:Ji().optional()});function eZ({activity:e,trigger:t}){const{t:r}=Ki(),{toast:n}=Sa(),o=Ma(),[l,d]=W.useState(!1),[i,g]=W.useState(null),[_,S]=W.useState((e==null?void 0:e.image_url)||null),[E,T]=W.useState([]),[C,N]=W.useState(!1),{data:I}=w4(),{register:j,handleSubmit:D,formState:{errors:R},setValue:F,watch:B,control:U}=sm({resolver:lm(Aet),defaultValues:e?{title_en:e.title_en,title_zh:e.title_zh,title_pt:e.title_pt,content_en:e.content_en,content_zh:e.content_zh,content_pt:e.content_pt,start_date:new Date(e.start_date),end_date:e.end_date?new Date(e.end_date):void 0,repeat_mode:e.repeat_mode||"none",pinned:e.pinned||!1,sort_order:e.sort_order||0,badge_text_zh:e.badge_text_zh||"",badge_text_en:e.badge_text_en||"",badge_text_pt:e.badge_text_pt||"",badge_color:e.badge_color||"#9b87f5"}:{repeat_mode:"none",pinned:!1,sort_order:0,badge_color:"#9b87f5"}}),Z=B("start_date"),J=B("end_date"),te=B("pinned");W.useEffect(()=>{(async()=>{if(e!=null&&e.id){const{data:oe}=await qt.from("activity_restaurants").select("restaurant_id").eq("activity_id",e.id);oe&&T(oe.map(de=>de.restaurant_id))}})()},[e==null?void 0:e.id]);const ae=ee=>{var de;const oe=(de=ee.target.files)==null?void 0:de[0];if(oe){g(oe);const xe=new FileReader;xe.onloadend=()=>{S(xe.result)},xe.readAsDataURL(oe)}},ne=async()=>{if(!i)return(e==null?void 0:e.image_url)||null;const ee=i.name.split(".").pop(),de=`${`${Math.random()}.${ee}`}`,{error:xe}=await qt.storage.from("activity-images").upload(de,i);if(xe)throw xe;const{data:{publicUrl:we}}=qt.storage.from("activity-images").getPublicUrl(de);return we},ie=async ee=>{var oe;N(!0);try{const{data:{user:de}}=await qt.auth.getUser();if(!de)throw new Error("Not authenticated");const xe=await ne(),we={title_en:ee.title_en,title_zh:ee.title_zh,title_pt:ee.title_pt,content_en:ee.content_en,content_zh:ee.content_zh,content_pt:ee.content_pt,repeat_mode:ee.repeat_mode,pinned:ee.pinned,sort_order:ee.sort_order,image_url:xe,creator_id:de.id,start_date:ee.start_date.toISOString(),end_date:((oe=ee.end_date)==null?void 0:oe.toISOString())||null,badge_text_zh:ee.badge_text_zh||null,badge_text_en:ee.badge_text_en||null,badge_text_pt:ee.badge_text_pt||null,badge_color:ee.badge_color||"#9b87f5"};if(e){const{error:Ae}=await qt.from("activities").update(we).eq("id",e.id);if(Ae)throw Ae;if(await qt.from("activity_restaurants").delete().eq("activity_id",e.id),E.length>0){const Ce=E.map(Pe=>({activity_id:e.id,restaurant_id:Pe})),{error:me}=await qt.from("activity_restaurants").insert(Ce);if(me)throw me}n({title:r("common.success"),description:r("admin.activityUpdated")})}else{const{data:Ae,error:Ce}=await qt.from("activities").insert([we]).select().single();if(Ce)throw Ce;if(E.length>0){const me=E.map(ye=>({activity_id:Ae.id,restaurant_id:ye})),{error:Pe}=await qt.from("activity_restaurants").insert(me);if(Pe)throw Pe}n({title:r("common.success"),description:r("admin.activityCreated")})}o.invalidateQueries({queryKey:["activities"]}),d(!1)}catch(de){n({title:r("common.error"),description:de.message,variant:"destructive"})}finally{N(!1)}};return m.jsxs(Nh,{open:l,onOpenChange:d,children:[m.jsx(jv,{asChild:!0,children:t}),m.jsxs(Rd,{className:"max-w-[95vw] sm:max-w-6xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[m.jsxs(jd,{className:"px-6 pt-6 pb-4 border-b bg-muted/30",children:[m.jsxs(Nd,{className:"text-2xl flex items-center gap-2",children:[m.jsx(C0,{className:"w-6 h-6 text-primary"}),r(e?"admin.editActivity":"admin.addActivity")]}),m.jsx(Md,{className:"text-base",children:r(e?"admin.editActivityDetails":"admin.createActivityWithContent")})]}),m.jsx(fv,{className:"px-6 h-[calc(95vh-220px)]",children:m.jsxs("form",{onSubmit:D(ie),className:"space-y-6 py-6",children:[m.jsx(rn,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:m.jsxs(ln,{className:"p-6",children:[m.jsxs(Vr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[m.jsx(O0,{className:"w-5 h-5 text-primary"}),r("admin.activityImage")]}),m.jsxs("div",{className:"flex items-center gap-6",children:[_&&m.jsxs("div",{className:"relative group",children:[m.jsx("img",{src:_,alt:"Preview",className:"w-40 h-40 object-cover rounded-lg shadow-lg ring-2 ring-primary/20 transition-transform duration-200 group-hover:scale-105"}),m.jsx(ir,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-8 w-8 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{g(null),S(null)},children:m.jsx(ju,{className:"h-4 w-4"})})]}),m.jsxs(Vr,{htmlFor:"image-upload",className:"cursor-pointer",children:[m.jsxs("div",{className:"flex flex-col items-center gap-3 px-8 py-6 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[m.jsx(O0,{className:"h-8 w-8 text-primary"}),m.jsxs("div",{className:"text-center",children:[m.jsx("p",{className:"font-medium text-sm",children:r("admin.uploadImage")}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r("admin.imageMaxSize")})]})]}),m.jsx(en,{id:"image-upload",type:"file",accept:"image/*",className:"hidden",onChange:ae})]})]})]})}),m.jsx(rn,{className:"border-primary/20",children:m.jsxs(ln,{className:"p-6",children:[m.jsxs(Vr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[m.jsx(C0,{className:"w-5 h-5 text-primary"}),r("admin.multilingualContent")]}),m.jsxs(FE,{defaultValue:"zh",className:"w-full",children:[m.jsxs(G0,{className:"grid w-full grid-cols-3 mb-6",children:[m.jsxs(Ul,{value:"zh",className:"gap-2",children:[" ",r("admin.chinese")]}),m.jsxs(Ul,{value:"en",className:"gap-2",children:[" ",r("admin.english")]}),m.jsxs(Ul,{value:"pt",className:"gap-2",children:[" ",r("admin.portuguese")]})]}),m.jsxs(Vl,{value:"zh",className:"space-y-4 mt-0",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"title_zh",className:"text-sm font-medium",children:r("admin.title")}),m.jsx(en,{id:"title_zh",...j("title_zh"),placeholder:r("admin.enterTitle"),className:"text-base"}),R.title_zh&&m.jsx("p",{className:"text-sm text-destructive",children:R.title_zh.message})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"content_zh",className:"text-sm font-medium",children:r("admin.content")}),m.jsx(NS,{name:"content_zh",control:U,render:({field:ee})=>m.jsx(RD,{value:ee.value,onChange:ee.onChange,placeholder:r("admin.enterContent")})}),R.content_zh&&m.jsx("p",{className:"text-sm text-destructive",children:R.content_zh.message})]})]}),m.jsxs(Vl,{value:"en",className:"space-y-4 mt-0",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"title_en",className:"text-sm font-medium",children:r("admin.title")}),m.jsx(en,{id:"title_en",...j("title_en"),placeholder:r("admin.enterTitle"),className:"text-base"}),R.title_en&&m.jsx("p",{className:"text-sm text-destructive",children:R.title_en.message})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"content_en",className:"text-sm font-medium",children:r("admin.content")}),m.jsx(NS,{name:"content_en",control:U,render:({field:ee})=>m.jsx(RD,{value:ee.value,onChange:ee.onChange,placeholder:r("admin.enterContent")})}),R.content_en&&m.jsx("p",{className:"text-sm text-destructive",children:R.content_en.message})]})]}),m.jsxs(Vl,{value:"pt",className:"space-y-4 mt-0",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"title_pt",className:"text-sm font-medium",children:r("admin.title")}),m.jsx(en,{id:"title_pt",...j("title_pt"),placeholder:r("admin.enterTitle"),className:"text-base"}),R.title_pt&&m.jsx("p",{className:"text-sm text-destructive",children:R.title_pt.message})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"content_pt",className:"text-sm font-medium",children:r("admin.content")}),m.jsx(NS,{name:"content_pt",control:U,render:({field:ee})=>m.jsx(RD,{value:ee.value,onChange:ee.onChange,placeholder:r("admin.enterContent")})}),R.content_pt&&m.jsx("p",{className:"text-sm text-destructive",children:R.content_pt.message})]})]})]})]})}),m.jsx(rn,{className:"border-primary/20",children:m.jsxs(ln,{className:"p-6 space-y-6",children:[m.jsxs("div",{children:[m.jsxs(Vr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[m.jsx(Sc,{className:"w-5 h-5 text-primary"}),r("admin.dateSettings")]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{className:"text-sm font-medium",children:r("admin.startDate")}),m.jsxs(EO,{children:[m.jsx(TO,{asChild:!0,children:m.jsxs(ir,{variant:"outline",className:yr("w-full justify-start text-left font-normal h-11",!Z&&"text-muted-foreground"),children:[m.jsx(Sc,{className:"mr-2 h-4 w-4"}),Z?Is(Z,"PPP"):m.jsx("span",{children:r("admin.selectDate")})]})}),m.jsx(jE,{className:"w-auto p-0 z-[100]",align:"start",children:m.jsx(fz,{mode:"single",selected:Z,onSelect:ee=>F("start_date",ee),initialFocus:!0,className:"pointer-events-auto"})})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{className:"text-sm font-medium",children:r("admin.endDate")}),m.jsxs(EO,{children:[m.jsx(TO,{asChild:!0,children:m.jsxs(ir,{variant:"outline",className:yr("w-full justify-start text-left font-normal h-11",!J&&"text-muted-foreground"),children:[m.jsx(Sc,{className:"mr-2 h-4 w-4"}),J?Is(J,"PPP"):m.jsxs("span",{children:[r("admin.selectDate")," (",r("admin.optional"),")"]})]})}),m.jsx(jE,{className:"w-auto p-0 z-[100]",align:"start",children:m.jsx(fz,{mode:"single",selected:J,onSelect:ee=>F("end_date",ee),initialFocus:!0,className:"pointer-events-auto"})})]})]})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"repeat_mode",className:"text-sm font-medium",children:r("admin.repeatMode")}),m.jsxs(wd,{onValueChange:ee=>F("repeat_mode",ee),defaultValue:B("repeat_mode"),children:[m.jsx(Cu,{className:"h-11",children:m.jsx(Sd,{placeholder:r("admin.selectRepeatMode")})}),m.jsxs(Ou,{children:[m.jsx(Fa,{value:"none",children:r("admin.repeatNone")}),m.jsx(Fa,{value:"daily",children:r("admin.repeatDaily")}),m.jsx(Fa,{value:"weekly",children:r("admin.repeatWeekly")}),m.jsx(Fa,{value:"monthly",children:r("admin.repeatMonthly")}),m.jsx(Fa,{value:"yearly",children:r("admin.repeatYearly")})]})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.jsxs("div",{className:"flex items-center space-x-3 p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[m.jsx(Hs,{id:"pinned",checked:te,onCheckedChange:ee=>F("pinned",ee),className:"data-[state=checked]:bg-primary"}),m.jsxs(Vr,{htmlFor:"pinned",className:"cursor-pointer flex items-center gap-2 text-sm font-medium",children:[m.jsx(Aye,{className:"w-4 h-4 text-primary"}),r("admin.pinToTop")]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs(Vr,{htmlFor:"sort_order",className:"text-sm font-medium flex items-center gap-2",children:[m.jsx(sye,{className:"w-4 h-4 text-primary"}),r("admin.sortOrder")]}),m.jsx(en,{id:"sort_order",type:"number",...j("sort_order",{valueAsNumber:!0}),className:"h-11",placeholder:"0"})]})]})]})}),m.jsx(rn,{className:"border-primary/20",children:m.jsxs(ln,{className:"p-6",children:[m.jsxs(Vr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[m.jsx(jn,{className:"w-5 h-5 text-primary"}),""]}),m.jsxs(FE,{defaultValue:"zh",className:"w-full",children:[m.jsxs(G0,{className:"grid w-full grid-cols-3 mb-4",children:[m.jsx(Ul,{value:"zh",children:" "}),m.jsx(Ul,{value:"en",children:" English"}),m.jsx(Ul,{value:"pt",children:" Portugus"})]}),m.jsx(Vl,{value:"zh",className:"space-y-3",children:m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"badge_text_zh",className:"text-sm",children:" ()"}),m.jsx(en,{id:"badge_text_zh",...j("badge_text_zh"),placeholder:": "}),m.jsx("p",{className:"text-xs text-muted-foreground",children:""})]})}),m.jsx(Vl,{value:"en",className:"space-y-3",children:m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"badge_text_en",className:"text-sm",children:"Badge Text (English)"}),m.jsx(en,{id:"badge_text_en",...j("badge_text_en"),placeholder:"e.g. Fan Festival"}),m.jsx("p",{className:"text-xs text-muted-foreground",children:"Leave empty to display activity title"})]})}),m.jsx(Vl,{value:"pt",className:"space-y-3",children:m.jsxs("div",{className:"space-y-2",children:[m.jsx(Vr,{htmlFor:"badge_text_pt",className:"text-sm",children:"Texto do Distintivo (Portugus)"}),m.jsx(en,{id:"badge_text_pt",...j("badge_text_pt"),placeholder:"ex: Festival dos Fs"}),m.jsx("p",{className:"text-xs text-muted-foreground",children:"Deixe vazio para exibir o ttulo da atividade"})]})})]}),m.jsxs("div",{className:"space-y-2 mt-4",children:[m.jsx(Vr,{htmlFor:"badge_color",className:"text-sm",children:" / Badge Color"}),m.jsx(NS,{name:"badge_color",control:U,render:({field:ee})=>m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx(en,{id:"badge_color",type:"color",value:ee.value||"#9b87f5",onChange:oe=>ee.onChange(oe.target.value),className:"w-20 h-11 cursor-pointer"}),m.jsx(en,{value:ee.value||"#9b87f5",onChange:oe=>ee.onChange(oe.target.value),placeholder:"#9b87f5",className:"flex-1"})]})}),m.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[m.jsx("span",{className:"text-xs text-muted-foreground",children:" / Preview:"}),m.jsx(jn,{style:{backgroundColor:B("badge_color")||"#9b87f5"},className:"text-white",children:B("badge_text_zh")||B("title_zh")||""})]})]})]})}),m.jsx(rn,{className:"border-primary/20",children:m.jsxs(ln,{className:"p-6",children:[m.jsxs(Vr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[m.jsx(es,{className:"w-5 h-5 text-primary"}),r("admin.associatedRestaurants")]}),m.jsx(fv,{className:"h-64 border rounded-lg p-4 bg-muted/20",children:m.jsx("div",{className:"space-y-2",children:I==null?void 0:I.map(ee=>m.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-md hover:bg-background transition-colors border border-transparent hover:border-primary/30",children:[m.jsx(Hs,{id:ee.id,checked:E.includes(ee.id),onCheckedChange:oe=>{T(oe?[...E,ee.id]:E.filter(de=>de!==ee.id))},className:"data-[state=checked]:bg-primary"}),m.jsx(Vr,{htmlFor:ee.id,className:"cursor-pointer flex-1 font-normal",children:ee.name}),E.includes(ee.id)&&m.jsx(jn,{variant:"secondary",className:"text-xs",children:""})]},ee.id))})}),m.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[" ",E.length," "]})]})}),m.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t sticky bottom-0 bg-background pb-[16px]",children:[m.jsx(ir,{type:"button",variant:"outline",onClick:()=>d(!1),className:"min-w-[100px]",children:r("common.cancel")}),m.jsx(ir,{type:"submit",disabled:C,className:"min-w-[100px] bg-primary hover:bg-primary/90",children:C?m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"..."]}):r("common.save")})]})]})})]})]})}const Pet=()=>{const{t:e}=Ki(),{toast:t}=Sa(),{data:r,isLoading:n}=zI(),{getLocalizedField:o}=Id(),l=vke(),d=wke(),[i,g]=W.useState([]),[_,S]=W.useState(""),[E,T]=W.useState("all"),C=W.useMemo(()=>r?r.filter(R=>{const F=String(o(R,"title")||""),B=String(o(R,"content")||""),U=_===""||F.toLowerCase().includes(_.toLowerCase())||B.toLowerCase().includes(_.toLowerCase()),Z=new Date,J=new Date(R.start_date),te=R.end_date?new Date(R.end_date):null,ae=te?te<Z:!1,ne=!ae&&J<=Z,ie=E==="all"||E==="active"&&ne||E==="ended"&&ae||E==="pinned"&&R.pinned;return U&&ie}):[],[r,_,E,o]),N=()=>{if(!r||r.length===0){t({title:e("common.error"),description:e("admin.noDataToExport"),variant:"destructive"});return}kJe(r),t({title:e("common.success"),description:e("admin.exportSuccess")})},I=R=>{g(F=>F.includes(R)?F.filter(B=>B!==R):[...F,R])},j=()=>{i.length===(C==null?void 0:C.length)?g([]):g((C==null?void 0:C.map(R=>R.id))||[])},D=()=>{i.length!==0&&(d.mutate(i),g([]))};return n?m.jsx(eu,{children:m.jsx("div",{className:"text-center",children:e("common.loading")})}):m.jsx(eu,{children:m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:e("admin.activityManagement")}),m.jsx("p",{className:"text-muted-foreground",children:e("admin.manageActivities")})]}),m.jsxs("div",{className:"flex gap-2 flex-wrap",children:[m.jsxs(ir,{variant:"outline",onClick:N,className:"flex-1 sm:flex-initial",children:[m.jsx(sI,{className:"mr-2 h-4 w-4"}),m.jsx("span",{className:"hidden sm:inline",children:e("admin.exportCSV")})]}),m.jsx(eZ,{trigger:m.jsxs(ir,{className:"flex-1 sm:flex-initial",children:[m.jsx(_B,{className:"mr-2 h-4 w-4"}),e("admin.addActivity")]})})]})]}),m.jsx(rn,{children:m.jsx(ln,{className:"pt-6",children:m.jsxs("div",{className:"flex gap-4 flex-wrap",children:[m.jsx("div",{className:"flex-1 min-w-[200px]",children:m.jsxs("div",{className:"relative",children:[m.jsx(Cv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),m.jsx(en,{placeholder:e("admin.searchActivities"),value:_,onChange:R=>S(R.target.value),className:"pl-9"})]})}),m.jsxs(wd,{value:E,onValueChange:T,children:[m.jsx(Cu,{className:"w-[180px]",children:m.jsx(Sd,{placeholder:e("admin.filterByStatus")})}),m.jsxs(Ou,{children:[m.jsx(Fa,{value:"all",children:e("admin.allStatus")}),m.jsx(Fa,{value:"active",children:e("admin.statusActive")}),m.jsx(Fa,{value:"ended",children:e("admin.statusEnded")}),m.jsx(Fa,{value:"pinned",children:e("admin.statusPinned")})]})]})]})})}),i.length>0&&m.jsx(rn,{className:"bg-muted/50",children:m.jsx(ln,{className:"pt-6",children:m.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[m.jsx("span",{className:"font-medium",children:e("admin.selectedCount",{count:i.length})}),m.jsxs("div",{className:"flex gap-2 flex-wrap w-full sm:w-auto",children:[m.jsxs(Bl,{children:[m.jsx(NE,{asChild:!0,children:m.jsxs(ir,{variant:"destructive",size:"sm",className:"flex-1 sm:flex-initial",children:[m.jsx(Sb,{className:"mr-2 h-4 w-4"}),e("admin.batchDelete")]})}),m.jsxs(sl,{className:"max-w-[90vw] sm:max-w-[425px]",children:[m.jsxs(ll,{children:[m.jsx(ul,{children:e("admin.confirmBatchDelete")}),m.jsx(dl,{children:e("admin.batchDeleteWarning",{count:i.length})})]}),m.jsxs(cl,{children:[m.jsx(hl,{children:e("common.cancel")}),m.jsx(Vs,{onClick:D,children:e("common.delete")})]})]})]}),m.jsx(ir,{variant:"outline",size:"sm",onClick:()=>g([]),className:"flex-1 sm:flex-initial",children:e("admin.clearSelection")})]})]})})}),m.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[m.jsx(Hs,{checked:i.length===(C==null?void 0:C.length)&&C.length>0,onCheckedChange:j}),m.jsx("span",{className:"font-medium",children:e("admin.selectAll")}),m.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:["(",C==null?void 0:C.length," ",e("admin.results"),")"]})]}),m.jsx("div",{className:"grid gap-4",children:C==null?void 0:C.map(R=>m.jsx(rn,{children:m.jsxs("div",{className:"flex flex-col md:flex-row",children:[m.jsx("div",{className:"p-4 flex items-start",children:m.jsx(Hs,{checked:i.includes(R.id),onCheckedChange:()=>I(R.id),className:"mt-1"})}),R.image_url&&m.jsx("div",{className:"w-full md:w-48 h-48",children:m.jsx("img",{src:R.image_url,alt:String(o(R,"title")),className:"object-cover w-full h-full"})}),m.jsxs("div",{className:"flex-1",children:[m.jsxs(Di,{children:[m.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[m.jsx(Qi,{className:"text-lg md:text-xl",children:o(R,"title")}),m.jsxs("div",{className:"flex gap-2 flex-wrap",children:[R.pinned&&m.jsx(jn,{children:e("activities.pinned")}),(()=>{const F=new Date,B=new Date(R.start_date),U=R.end_date?new Date(R.end_date):null,Z=U?U<F:!1,J=!Z&&B<=F;return Z?m.jsx(jn,{variant:"secondary",children:e("activities.ended")}):J?m.jsx(jn,{children:e("activities.ongoing")}):null})()]})]}),m.jsx(Lo,{className:"line-clamp-2",children:m.jsx("div",{className:`prose prose-sm max-w-none\r
                          [&_p]:inline [&_p]:m-0\r
                          [&_strong]:font-semibold [&_strong]:text-foreground\r
                          [&_em]:italic\r
                          [&_h1]:text-base [&_h2]:text-base [&_h3]:text-base\r
                          [&_*]:text-muted-foreground`,dangerouslySetInnerHTML:{__html:o(R,"content")}})})]}),m.jsxs(ln,{children:[m.jsx("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-4 overflow-x-auto",children:m.jsxs("div",{className:"flex items-center gap-1 whitespace-nowrap",children:[m.jsx(Sc,{className:"h-4 w-4 flex-shrink-0"}),m.jsxs("span",{className:"text-xs sm:text-sm",children:[Is(new Date(R.start_date),"PPP"),R.end_date&&` - ${Is(new Date(R.end_date),"PPP")}`]})]})}),m.jsxs("div",{className:"flex gap-2 flex-wrap",children:[m.jsx(ir,{variant:"outline",size:"sm",asChild:!0,className:"flex-1 sm:flex-initial",children:m.jsx(ia,{to:`/activity/${R.id}`,state:{from:"admin"},children:e("admin.view")})}),m.jsx(eZ,{activity:R,trigger:m.jsx(ir,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:e("common.edit")})}),m.jsxs(Bl,{children:[m.jsx(NE,{asChild:!0,children:m.jsx(ir,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:e("common.delete")})}),m.jsxs(sl,{className:"max-w-[90vw] sm:max-w-[425px]",children:[m.jsxs(ll,{children:[m.jsx(ul,{children:e("admin.confirmDelete")}),m.jsx(dl,{children:e("admin.deleteActivityWarning")})]}),m.jsxs(cl,{children:[m.jsx(hl,{children:e("common.cancel")}),m.jsx(Vs,{onClick:()=>l.mutate(R.id),children:e("common.delete")})]})]})]})]})]})]})]})},R.id))})]})})},Cet=()=>{const{t:e}=Ki(),{data:t,isLoading:r}=uke();if(r)return m.jsx(eu,{children:m.jsx("div",{className:"text-center",children:e("common.loading")})});const n=o=>({INSERT:"default",UPDATE:"secondary",DELETE:"destructive"})[o]||"secondary";return m.jsx(eu,{children:m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-3xl font-bold mb-2",children:e("admin.operationLogs")}),m.jsx("p",{className:"text-muted-foreground",children:e("admin.viewSystemLogs")})]}),t&&t.length>0?m.jsx("div",{className:"space-y-4",children:t.map(o=>m.jsxs(rn,{children:[m.jsx(Di,{children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs(Qi,{className:"text-base",children:[o.user_name," - ",o.table_name]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(jn,{variant:n(o.action),children:o.action}),m.jsx("span",{className:"text-xs text-muted-foreground",children:og(new Date(o.created_at),{addSuffix:!0})})]})]})}),(o.old_data||o.new_data)&&m.jsx(ln,{children:m.jsxs("div",{className:"grid gap-2 text-sm",children:[o.old_data&&m.jsxs("div",{children:[m.jsxs("span",{className:"font-semibold",children:[e("admin.oldData"),":"]}),m.jsx("pre",{className:"mt-1 p-2 bg-secondary rounded text-xs overflow-auto",children:JSON.stringify(o.old_data,null,2)})]}),o.new_data&&m.jsxs("div",{children:[m.jsxs("span",{className:"font-semibold",children:[e("admin.newData"),":"]}),m.jsx("pre",{className:"mt-1 p-2 bg-secondary rounded text-xs overflow-auto",children:JSON.stringify(o.new_data,null,2)})]})]})})]},o.id))}):m.jsx(rn,{children:m.jsx(ln,{className:"py-12 text-center text-muted-foreground",children:e("admin.noLogs")})})]})})},Yce=W.forwardRef(({className:e,...t},r)=>m.jsx("div",{className:"relative w-full overflow-auto",children:m.jsx("table",{ref:r,className:yr("w-full caption-bottom text-sm",e),...t})}));Yce.displayName="Table";const Jce=W.forwardRef(({className:e,...t},r)=>m.jsx("thead",{ref:r,className:yr("[&_tr]:border-b",e),...t}));Jce.displayName="TableHeader";const Qce=W.forwardRef(({className:e,...t},r)=>m.jsx("tbody",{ref:r,className:yr("[&_tr:last-child]:border-0",e),...t}));Qce.displayName="TableBody";const Oet=W.forwardRef(({className:e,...t},r)=>m.jsx("tfoot",{ref:r,className:yr("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}));Oet.displayName="TableFooter";const pz=W.forwardRef(({className:e,...t},r)=>m.jsx("tr",{ref:r,className:yr("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",e),...t}));pz.displayName="TableRow";const Xp=W.forwardRef(({className:e,...t},r)=>m.jsx("th",{ref:r,className:yr("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));Xp.displayName="TableHead";const Yp=W.forwardRef(({className:e,...t},r)=>m.jsx("td",{ref:r,className:yr("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));Yp.displayName="TableCell";const ket=W.forwardRef(({className:e,...t},r)=>m.jsx("caption",{ref:r,className:yr("mt-4 text-sm text-muted-foreground",e),...t}));ket.displayName="TableCaption";const Iet=()=>{const{t:e}=Ki(),[t,r]=W.useState(""),[n,o]=W.useState("all"),[l,d]=W.useState(null),i=Ma(),{data:g,isLoading:_}=Li({queryKey:["joinRequests"],queryFn:async()=>{const{data:D,error:R}=await qt.from("join_requests").select("*").order("created_at",{ascending:!1});if(R)throw R;return D}}),{data:S}=Li({queryKey:["emailConfig","join_request"],queryFn:async()=>{const{data:D,error:R}=await qt.from("email_config").select("*").eq("type","join_request").single();if(R)throw R;return D}}),E=g==null?void 0:g.filter(D=>{const R=t.toLowerCase(),F=D.name.toLowerCase().includes(R)||D.email.toLowerCase().includes(R)||D.restaurant_name.toLowerCase().includes(R)||D.phone.toLowerCase().includes(R),B=n==="all"||D.status===n;return F&&B}),T=async()=>{const D=prompt(e("joinUs.enterNewEmail"),S==null?void 0:S.recipient_email);if(D)try{const{error:R}=await qt.from("email_config").update({recipient_email:D}).eq("id",S==null?void 0:S.id);if(R)throw R;Fc({title:e("common.success"),description:e("joinUs.emailUpdated")})}catch(R){console.error("Error updating email:",R),Fc({title:e("common.error"),description:e("joinUs.emailUpdateError"),variant:"destructive"})}},C=Ya({mutationFn:async({id:D,status:R})=>{const{error:F}=await qt.from("join_requests").update({status:R}).eq("id",D);if(F)throw F},onSuccess:()=>{i.invalidateQueries({queryKey:["joinRequests"]}),Fc({title:e("common.success"),description:e("joinUs.statusUpdated")})},onError:D=>{console.error("Error updating status:",D),Fc({title:e("common.error"),description:e("joinUs.statusUpdateError"),variant:"destructive"})}}),N=Ya({mutationFn:async D=>{const{error:R}=await qt.from("join_requests").delete().eq("id",D);if(R)throw R},onSuccess:()=>{i.invalidateQueries({queryKey:["joinRequests"]}),Fc({title:e("common.success"),description:e("joinUs.requestDeleted")}),d(null)},onError:D=>{console.error("Error deleting request:",D),Fc({title:e("common.error"),description:e("joinUs.deleteError"),variant:"destructive"})}}),I=()=>{if(!E||E.length===0){Fc({title:e("admin.noDataToExport"),variant:"destructive"});return}const D=[["Name","Email","Phone","Restaurant Name","Restaurant Address","Features","Status","Submitted Date"],...E.map(U=>[U.name,U.email,U.phone,U.restaurant_name,U.restaurant_address||"",Array.isArray(U.features_selected)?U.features_selected.join(", "):"",U.status||"pending",new Date(U.created_at).toLocaleString()])].map(U=>U.map(Z=>`"${Z}"`).join(",")).join(`
`),R=new Blob([D],{type:"text/csv;charset=utf-8;"}),F=document.createElement("a"),B=URL.createObjectURL(R);F.setAttribute("href",B),F.setAttribute("download",`join_requests_${new Date().toISOString()}.csv`),F.click(),URL.revokeObjectURL(B),Fc({title:e("admin.exportSuccess")})},j=D=>{switch(D){case"completed":return"default";case"rejected":return"destructive";default:return"secondary"}};return m.jsxs(eu,{children:[m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsx("h2",{className:"text-3xl font-bold",children:e("joinUs.adminTitle")}),m.jsx("p",{className:"text-muted-foreground mt-2",children:e("joinUs.adminDescription")})]}),m.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[m.jsxs(rn,{children:[m.jsxs(Di,{children:[m.jsx(Qi,{children:e("joinUs.recipientEmail")}),m.jsx(Lo,{children:e("joinUs.recipientEmailDesc")})]}),m.jsx(ln,{children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx(en,{value:(S==null?void 0:S.recipient_email)||"",readOnly:!0}),m.jsx(ir,{onClick:T,children:e("common.edit")})]})})]}),m.jsxs(rn,{children:[m.jsxs(Di,{children:[m.jsx(Qi,{children:e("joinUs.totalRequests")}),m.jsx(Lo,{children:e("joinUs.totalRequestsDesc")})]}),m.jsx(ln,{children:m.jsx("div",{className:"text-3xl font-bold",children:(g==null?void 0:g.length)||0})})]})]}),m.jsxs(rn,{children:[m.jsxs(Di,{children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx(Qi,{children:e("joinUs.allRequests")}),m.jsx(Lo,{children:e("joinUs.allRequestsDesc")})]}),m.jsxs(ir,{onClick:I,variant:"outline",children:[m.jsx(sI,{className:"w-4 h-4 mr-2"}),e("admin.exportCSV")]})]}),m.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[m.jsxs("div",{className:"relative flex-1",children:[m.jsx(Cv,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),m.jsx(en,{placeholder:e("joinUs.searchPlaceholder"),value:t,onChange:D=>r(D.target.value),className:"pl-10"})]}),m.jsxs(Iv,{children:[m.jsx(Rv,{asChild:!0,children:m.jsxs(ir,{variant:"outline",className:"gap-2",children:[m.jsx(gB,{className:"w-4 h-4"}),e(n==="all"?"admin.allStatus":`joinUs.status.${n}`)]})}),m.jsxs(ag,{align:"end",className:"bg-background",children:[m.jsx(Oa,{onClick:()=>o("all"),children:e("admin.allStatus")}),m.jsx(Oa,{onClick:()=>o("pending"),children:e("joinUs.status.pending")}),m.jsx(Oa,{onClick:()=>o("completed"),children:e("joinUs.status.completed")}),m.jsx(Oa,{onClick:()=>o("rejected"),children:e("joinUs.status.rejected")})]})]})]})]}),m.jsx(ln,{children:_?m.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e("common.loading")}):E&&E.length>0?m.jsx("div",{className:"overflow-x-auto",children:m.jsxs(Yce,{children:[m.jsx(Jce,{children:m.jsxs(pz,{children:[m.jsx(Xp,{children:e("joinUs.name")}),m.jsx(Xp,{children:e("joinUs.contact")}),m.jsx(Xp,{children:e("joinUs.restaurant")}),m.jsx(Xp,{children:e("joinUs.featuresNeeded")}),m.jsx(Xp,{children:e("joinUs.status")}),m.jsx(Xp,{children:e("joinUs.submittedAt")}),m.jsx(Xp,{className:"text-right",children:e("common.actions")})]})}),m.jsx(Qce,{children:E.map(D=>m.jsxs(pz,{children:[m.jsx(Yp,{className:"font-medium",children:D.name}),m.jsx(Yp,{children:m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[m.jsx(rJ,{className:"w-3 h-3 text-muted-foreground"}),m.jsx("a",{href:`mailto:${D.email}`,className:"hover:underline",children:D.email})]}),m.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[m.jsx(RT,{className:"w-3 h-3 text-muted-foreground"}),m.jsx("a",{href:`tel:${D.phone}`,className:"hover:underline",children:D.phone})]})]})}),m.jsx(Yp,{children:m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[m.jsx(es,{className:"w-3 h-3 text-muted-foreground"}),D.restaurant_name]}),D.restaurant_address&&m.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[m.jsx(ys,{className:"w-3 h-3"}),D.restaurant_address]})]})}),m.jsx(Yp,{children:m.jsx("div",{className:"flex flex-wrap gap-1",children:Array.isArray(D.features_selected)&&D.features_selected.map((R,F)=>m.jsx(jn,{variant:"secondary",children:e(`joinUs.feature.${R}`)},F))})}),m.jsx(Yp,{children:m.jsx(jn,{variant:j(D.status||"pending"),children:e(`joinUs.status.${D.status||"pending"}`)})}),m.jsx(Yp,{className:"text-sm text-muted-foreground",children:og(new Date(D.created_at),{addSuffix:!0})}),m.jsx(Yp,{children:m.jsxs("div",{className:"flex items-center justify-end gap-2",children:[D.status!=="completed"&&m.jsx(ir,{size:"sm",variant:"outline",onClick:()=>C.mutate({id:D.id,status:"completed"}),disabled:C.isPending,children:m.jsx(Af,{className:"w-4 h-4"})}),m.jsx(ir,{size:"sm",variant:"destructive",onClick:()=>d(D.id),disabled:N.isPending,children:m.jsx(Sb,{className:"w-4 h-4"})})]})})]},D.id))})]})}):m.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e("joinUs.noRequests")})})]})]}),m.jsx(Bl,{open:l!==null,onOpenChange:D=>!D&&d(null),children:m.jsxs(sl,{children:[m.jsxs(ll,{children:[m.jsx(ul,{children:e("joinUs.confirmDelete")}),m.jsx(dl,{children:e("joinUs.confirmDeleteDescription")})]}),m.jsxs(cl,{children:[m.jsx(hl,{children:e("common.cancel")}),m.jsx(Vs,{onClick:()=>l&&N.mutate(l),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:e("common.delete")})]})]})})]})},Ret=()=>{var ie;const{t:e}=Ki(),t=Ma(),[r,n]=W.useState(null),[o,l]=W.useState(""),[d,i]=W.useState(""),[g,_]=W.useState(""),[S,E]=W.useState("all"),{data:T,isLoading:C}=Li({queryKey:["admin-reports"],queryFn:async()=>{const{data:ee,error:oe}=await qt.from("reports").select(`
          *,
          reporter:profiles(display_name, avatar_url)
        `).order("created_at",{ascending:!1});if(oe)throw oe;return ee}}),{data:N}=Li({queryKey:["emailConfig","report"],queryFn:async()=>{const{data:ee,error:oe}=await qt.from("email_config").select("*").eq("type","report").single();if(oe)throw oe;return ee}}),I=T==null?void 0:T.filter(ee=>{var we,Ae;const oe=g.toLowerCase(),de=ee.description.toLowerCase().includes(oe)||((Ae=(we=ee.reporter)==null?void 0:we.display_name)==null?void 0:Ae.toLowerCase().includes(oe))||ee.reason.toLowerCase().includes(oe),xe=S==="all"||ee.status===S;return de&&xe}),j={total:(T==null?void 0:T.length)||0,pending:(T==null?void 0:T.filter(ee=>ee.status==="pending").length)||0,reviewing:(T==null?void 0:T.filter(ee=>ee.status==="reviewing").length)||0,resolved:(T==null?void 0:T.filter(ee=>ee.status==="resolved").length)||0,dismissed:(T==null?void 0:T.filter(ee=>ee.status==="dismissed").length)||0},D=Array.from({length:7},(ee,oe)=>{const de=Zm(bC(new Date,6-oe)),xe=Is(de,"yyyy-MM-dd"),we=(T==null?void 0:T.filter(Ae=>Is(Zm(new Date(Ae.created_at)),"yyyy-MM-dd")===xe).length)||0;return{date:Is(de,"MM/dd"),count:we}}),R=["spam","harassment","inappropriate_content","misinformation","copyright","fraud","hate_speech","violence","other"].map(ee=>({name:e(`report.reasons.${ee}`),value:(T==null?void 0:T.filter(oe=>oe.reason===ee).length)||0})).filter(ee=>ee.value>0),F=["comment","restaurant","activity","user"].map(ee=>({name:e(`admin.reportType.${ee}`),value:(T==null?void 0:T.filter(oe=>oe.target_type===ee).length)||0})).filter(ee=>ee.value>0),B=["#016450","#018a6f","#4CAF50","#81C784","#FFA726","#FF7043","#EF5350","#EC407A","#AB47BC"],U=async()=>{const ee=prompt(e("joinUs.enterNewEmail"),N==null?void 0:N.recipient_email);if(ee)try{const{error:oe}=await qt.from("email_config").update({recipient_email:ee}).eq("id",N==null?void 0:N.id);if(oe)throw oe;t.invalidateQueries({queryKey:["emailConfig"]}),Br.success(e("joinUs.emailUpdated"))}catch(oe){console.error("Error updating email:",oe),Br.error(e("joinUs.emailUpdateError"))}},Z=Ya({mutationFn:async({id:ee,status:oe,notes:de})=>{const xe={updated_at:new Date().toISOString()};oe&&(xe.status=oe),de!==void 0&&(xe.admin_notes=de);const{error:we}=await qt.from("reports").update(xe).eq("id",ee);if(we)throw we},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-reports"]}),Br.success(e("toast.reportUpdatedSuccess")),n(null)},onError:ee=>{Br.error(ee.message||e("toast.reportUpdateFailed"))}}),J=ee=>{const oe={pending:"default",reviewing:"secondary",resolved:"default",dismissed:"destructive"};return m.jsx(jn,{variant:oe[ee]||"default",children:e(`admin.reportStatus.${ee}`)})},te=(ee,oe)=>{switch(ee){case"restaurant":return`/restaurant/${oe}`;case"activity":return`/activity/${oe}`;case"comment":return"#";case"user":return"/profile";default:return"#"}},ae=ee=>{n(ee),l(ee.admin_notes||""),i(ee.status)},ne=()=>{r&&Z.mutate({id:r.id,status:d,notes:o})};return C?m.jsx(eu,{children:m.jsx("div",{className:"flex items-center justify-center h-64",children:m.jsx(Gs,{className:"w-8 h-8 animate-spin"})})}):m.jsxs(eu,{children:[m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsx("h2",{className:"text-3xl font-bold",children:e("admin.reports")}),m.jsx("p",{className:"text-muted-foreground mt-2",children:e("admin.reportsDescription")})]}),m.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[m.jsxs(rn,{children:[m.jsxs(Di,{children:[m.jsx(Qi,{children:e("joinUs.recipientEmail")}),m.jsx(Lo,{children:e("joinUs.recipientEmailDesc")})]}),m.jsx(ln,{children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx(en,{value:(N==null?void 0:N.recipient_email)||"",readOnly:!0}),m.jsx(ir,{onClick:U,children:e("common.edit")})]})})]}),m.jsxs(rn,{children:[m.jsxs(Di,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[m.jsx(Qi,{className:"text-sm font-medium",children:e("admin.totalReports")}),m.jsx(fC,{className:"h-4 w-4 text-muted-foreground"})]}),m.jsxs(ln,{children:[m.jsx("div",{className:"text-2xl font-bold",children:j.total}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e("admin.allReportsCount")})]})]}),m.jsxs(rn,{children:[m.jsxs(Di,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[m.jsx(Qi,{className:"text-sm font-medium",children:e("admin.reportStatus.pending")}),m.jsx(IT,{className:"h-4 w-4 text-yellow-500"})]}),m.jsxs(ln,{children:[m.jsx("div",{className:"text-2xl font-bold",children:j.pending}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e("admin.awaitingReview")})]})]}),m.jsxs(rn,{children:[m.jsxs(Di,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[m.jsx(Qi,{className:"text-sm font-medium",children:e("admin.reportStatus.reviewing")}),m.jsx(pye,{className:"h-4 w-4 text-blue-500"})]}),m.jsxs(ln,{children:[m.jsx("div",{className:"text-2xl font-bold",children:j.reviewing}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e("admin.underReview")})]})]}),m.jsxs(rn,{children:[m.jsxs(Di,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[m.jsx(Qi,{className:"text-sm font-medium",children:e("admin.reportStatus.resolved")}),m.jsx(mye,{className:"h-4 w-4 text-green-500"})]}),m.jsxs(ln,{children:[m.jsx("div",{className:"text-2xl font-bold",children:j.resolved}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e("admin.resolvedReports")})]})]}),m.jsxs(rn,{children:[m.jsxs(Di,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[m.jsx(Qi,{className:"text-sm font-medium",children:e("admin.reportStatus.dismissed")}),m.jsx(yye,{className:"h-4 w-4 text-red-500"})]}),m.jsxs(ln,{children:[m.jsx("div",{className:"text-2xl font-bold",children:j.dismissed}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e("admin.dismissedReports")})]})]})]}),m.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[m.jsxs(rn,{children:[m.jsxs(Di,{children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(aJ,{className:"w-5 h-5 text-primary"}),m.jsx(Qi,{children:e("admin.reportsTrend")})]}),m.jsx(Lo,{children:e("admin.reportsTrendDesc")})]}),m.jsx(ln,{children:m.jsx(Tm,{width:"100%",height:300,children:m.jsxs(Pce,{data:D,children:[m.jsx(Uy,{strokeDasharray:"3 3"}),m.jsx(yh,{dataKey:"date"}),m.jsx(vh,{}),m.jsx(qs,{}),m.jsx(Hb,{type:"monotone",dataKey:"count",stroke:"hsl(var(--primary))",strokeWidth:2,name:e("admin.reportsCount")})]})})})]}),m.jsxs(rn,{children:[m.jsxs(Di,{children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(dye,{className:"w-5 h-5 text-primary"}),m.jsx(Qi,{children:e("admin.reportsReasonDist")})]}),m.jsx(Lo,{children:e("admin.reportsReasonDistDesc")})]}),m.jsx(ln,{children:m.jsx(Tm,{width:"100%",height:300,children:m.jsxs(HK,{children:[m.jsx(kh,{data:R,cx:"50%",cy:"50%",labelLine:!1,label:({name:ee,percent:oe})=>`${ee}: ${(oe*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:R.map((ee,oe)=>m.jsx(qE,{fill:B[oe%B.length]},`cell-${oe}`))}),m.jsx(qs,{})]})})})]}),m.jsxs(rn,{children:[m.jsxs(Di,{children:[m.jsx(Qi,{children:e("admin.reportsTypeDist")}),m.jsx(Lo,{children:e("admin.reportsTypeDistDesc")})]}),m.jsx(ln,{children:m.jsx(Tm,{width:"100%",height:300,children:m.jsxs(OC,{data:F,children:[m.jsx(Uy,{strokeDasharray:"3 3"}),m.jsx(yh,{dataKey:"name"}),m.jsx(vh,{}),m.jsx(qs,{}),m.jsx(Su,{dataKey:"value",fill:"hsl(var(--primary))",name:e("admin.reportsCount")})]})})})]}),m.jsxs(rn,{children:[m.jsxs(Di,{children:[m.jsx(Qi,{children:e("admin.reportsStatusDist")}),m.jsx(Lo,{children:e("admin.reportsStatusDistDesc")})]}),m.jsx(ln,{children:m.jsx(Tm,{width:"100%",height:300,children:m.jsxs(HK,{children:[m.jsx(kh,{data:[{name:e("admin.reportStatus.pending"),value:j.pending},{name:e("admin.reportStatus.reviewing"),value:j.reviewing},{name:e("admin.reportStatus.resolved"),value:j.resolved},{name:e("admin.reportStatus.dismissed"),value:j.dismissed}].filter(ee=>ee.value>0),cx:"50%",cy:"50%",labelLine:!1,label:({name:ee,percent:oe})=>`${ee}: ${(oe*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:[{color:"#FFA726"},{color:"#42A5F5"},{color:"#66BB6A"},{color:"#EF5350"}].map((ee,oe)=>m.jsx(qE,{fill:ee.color},`cell-${oe}`))}),m.jsx(qs,{})]})})})]})]}),m.jsxs(rn,{children:[m.jsxs(Di,{children:[m.jsx("div",{className:"flex items-center justify-between",children:m.jsxs("div",{children:[m.jsx(Qi,{children:e("admin.allReports")}),m.jsx(Lo,{children:e("admin.manageReportsDesc")})]})}),m.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[m.jsxs("div",{className:"relative flex-1",children:[m.jsx(Cv,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),m.jsx(en,{placeholder:e("admin.searchReports"),value:g,onChange:ee=>_(ee.target.value),className:"pl-10"})]}),m.jsxs(Iv,{children:[m.jsx(Rv,{asChild:!0,children:m.jsxs(ir,{variant:"outline",className:"gap-2",children:[m.jsx(gB,{className:"w-4 h-4"}),e(S==="all"?"admin.allStatus":`admin.reportStatus.${S}`)]})}),m.jsxs(ag,{align:"end",className:"bg-background",children:[m.jsx(Oa,{onClick:()=>E("all"),children:e("admin.allStatus")}),m.jsx(Oa,{onClick:()=>E("pending"),children:e("admin.reportStatus.pending")}),m.jsx(Oa,{onClick:()=>E("reviewing"),children:e("admin.reportStatus.reviewing")}),m.jsx(Oa,{onClick:()=>E("resolved"),children:e("admin.reportStatus.resolved")}),m.jsx(Oa,{onClick:()=>E("dismissed"),children:e("admin.reportStatus.dismissed")})]})]})]})]}),m.jsx(ln,{children:m.jsxs("div",{className:"grid gap-4",children:[I==null?void 0:I.map(ee=>{var oe;return m.jsx(rn,{className:"p-4",children:m.jsxs("div",{className:"flex items-start justify-between gap-4",children:[m.jsxs("div",{className:"flex-1 space-y-2",children:[m.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[m.jsx(fC,{className:"w-4 h-4"}),m.jsx("span",{className:"font-medium",children:e(`admin.reportType.${ee.target_type}`)}),J(ee.status),m.jsx(jn,{variant:"outline",children:e(`report.reasons.${ee.reason}`)})]}),m.jsxs("p",{className:"text-sm text-muted-foreground",children:[ee.description.substring(0,150),ee.description.length>150&&"..."]}),m.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[m.jsxs("span",{children:[e("admin.reportedBy"),": ",(oe=ee.reporter)==null?void 0:oe.display_name]}),m.jsxs("span",{children:[e("admin.reportedAt"),":"," ",og(new Date(ee.created_at),{addSuffix:!0})]})]})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(ir,{variant:"outline",size:"sm",onClick:()=>ae(ee),children:e("admin.viewReport")}),m.jsx(ir,{variant:"ghost",size:"sm",onClick:()=>window.open(te(ee.target_type,ee.target_id),"_blank"),children:m.jsx(Eq,{className:"w-4 h-4"})})]})]})},ee.id)}),(I==null?void 0:I.length)===0&&m.jsxs("div",{className:"text-center py-12",children:[m.jsx(fC,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),m.jsx("p",{className:"text-muted-foreground",children:e("admin.noReports")})]})]})})]})]}),m.jsx(Nh,{open:!!r,onOpenChange:()=>n(null),children:m.jsxs(Rd,{className:"max-w-[90vw] sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[m.jsxs(jd,{children:[m.jsxs(Nd,{children:[e("admin.viewReport")," - ",r==null?void 0:r.id]}),m.jsx(Md,{children:e(`admin.reportType.${r==null?void 0:r.target_type}`)})]}),r&&m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[m.jsxs("div",{children:[m.jsxs("span",{className:"font-medium",children:[e("admin.reportedBy"),":"]})," ",(ie=r.reporter)==null?void 0:ie.display_name]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-medium",children:[e("admin.reportedAt"),":"]})," ",new Date(r.created_at).toLocaleString()]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-medium",children:[e("report.reason"),":"]})," ",e(`report.reasons.${r.reason}`)]}),m.jsxs("div",{children:[m.jsx("span",{className:"font-medium",children:"Status:"})," ",J(r.status)]})]}),m.jsxs("div",{children:[m.jsx("h4",{className:"font-medium mb-2",children:e("report.detailsLabel")}),m.jsx("p",{className:"text-sm whitespace-pre-wrap",children:r.description})]}),r.reporter_contact&&m.jsxs("div",{children:[m.jsx("h4",{className:"font-medium mb-2",children:e("report.contactLabel")}),m.jsx("p",{className:"text-sm",children:r.reporter_contact})]}),r.evidence_urls&&r.evidence_urls.length>0&&m.jsxs("div",{children:[m.jsx("h4",{className:"font-medium mb-2",children:e("report.evidenceLabel")}),m.jsx("ul",{className:"space-y-1",children:r.evidence_urls.map((ee,oe)=>m.jsx("li",{children:m.jsxs("a",{href:ee,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline flex items-center gap-1",children:[m.jsx(Eq,{className:"w-3 h-3"}),ee]})},oe))})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-sm font-medium",children:e("admin.updateStatus")}),m.jsxs(wd,{value:d,onValueChange:i,children:[m.jsx(Cu,{children:m.jsx(Sd,{})}),m.jsxs(Ou,{children:[m.jsx(Fa,{value:"pending",children:e("admin.reportStatus.pending")}),m.jsx(Fa,{value:"reviewing",children:e("admin.reportStatus.reviewing")}),m.jsx(Fa,{value:"resolved",children:e("admin.reportStatus.resolved")}),m.jsx(Fa,{value:"dismissed",children:e("admin.reportStatus.dismissed")})]})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-sm font-medium",children:e("admin.adminNotes")}),m.jsx(Lm,{value:o,onChange:ee=>l(ee.target.value),placeholder:"Add internal notes...",rows:4})]}),m.jsxs("div",{className:"flex justify-end gap-2",children:[m.jsx(ir,{variant:"outline",onClick:()=>n(null),children:e("common.cancel")}),m.jsx(ir,{onClick:ne,disabled:Z.isPending,children:Z.isPending?m.jsxs(m.Fragment,{children:[m.jsx(Gs,{className:"w-4 h-4 mr-2 animate-spin"}),e("common.loading")]}):e("admin.saveNotes")})]})]})]})})]})},jet=()=>{Fi();const e=qf(),{t}=Ki(),{isMerchant:r,isSupervisor:n,isLoading:o}=nu(),{data:l=[],isLoading:d}=KT(),{localizeRestaurant:i}=Id();return!o&&!r&&!n?(e("/"),null):d||o?m.jsx("div",{className:"container mx-auto px-4 py-8 flex justify-center items-center min-h-[50vh]",children:m.jsx(Gs,{className:"w-8 h-8 animate-spin text-primary"})}):m.jsxs("div",{className:"container mx-auto px-4 py-8",children:[m.jsxs("div",{className:"mb-8",children:[m.jsx("h1",{className:"text-3xl font-bold mb-2",children:t("merchant.myRestaurants")}),m.jsx("p",{className:"text-muted-foreground",children:t(n?"merchant.supervisorDescription":"merchant.merchantDescription")})]}),l.length===0?m.jsx(rn,{children:m.jsx(ln,{className:"py-12 text-center",children:m.jsx("p",{className:"text-muted-foreground mb-4",children:t("merchant.noRestaurants")})})}):m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(g=>{const _=i(g);return m.jsxs(rn,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[m.jsx("div",{className:"relative h-48 overflow-hidden",children:m.jsx("img",{src:g.image_url||"/placeholder.svg",alt:_.name,className:"w-full h-full object-cover"})}),m.jsx(Di,{children:m.jsxs(Qi,{className:"flex items-start justify-between gap-2",children:[m.jsx("span",{className:"line-clamp-1",children:_.name}),g.rating&&m.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[m.jsx(Ec,{className:"w-4 h-4 fill-primary text-primary"}),m.jsx("span",{children:g.rating})]})]})}),m.jsxs(ln,{className:"space-y-3",children:[g.type&&g.type.length>0&&m.jsx("div",{className:"flex flex-wrap gap-1",children:_.type.slice(0,3).map((S,E)=>m.jsx("span",{className:"text-xs px-2 py-1 bg-secondary text-secondary-foreground rounded",children:S},E))}),g.address&&m.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[m.jsx(ys,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),m.jsx("span",{className:"line-clamp-2",children:g.address})]}),g.phone&&m.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[m.jsx(RT,{className:"w-4 h-4 flex-shrink-0"}),m.jsx("span",{children:g.phone})]}),g.website_url&&m.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[m.jsx(C0,{className:"w-4 h-4 flex-shrink-0"}),m.jsx("a",{href:g.website_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline line-clamp-1",children:t("restaurant.visitWebsite")})]}),m.jsxs("div",{className:"flex gap-2 pt-2",children:[m.jsx(ir,{asChild:!0,variant:"outline",size:"sm",className:"flex-1",children:m.jsx(ia,{to:`/restaurant/${g.id}`,children:t("restaurants.viewDetails")})}),m.jsx(DO,{restaurant:g,trigger:m.jsxs(ir,{variant:"default",size:"sm",className:"flex-1",children:[m.jsx(xB,{className:"w-4 h-4 mr-1"}),t("common.edit")]})})]})]})]},g.id)})})]})},Net=new Hxe,Met=()=>m.jsx(Jxe,{client:Net,children:m.jsxs(HJ,{children:[m.jsx(hve,{}),m.jsx(qve,{}),m.jsx(obe,{children:m.jsxs(x1e,{children:[m.jsx(YAe,{}),m.jsx(XAe,{}),m.jsx("div",{className:"pt-14 sm:pt-16",children:m.jsxs(Q0e,{children:[m.jsx(cs,{path:"/",element:m.jsx(ePe,{})}),m.jsx(cs,{path:"/restaurants",element:m.jsx(bPe,{})}),m.jsx(cs,{path:"/restaurant/:id",element:m.jsx(VOe,{})}),m.jsx(cs,{path:"/map",element:m.jsx(qOe,{})}),m.jsx(cs,{path:"/activities",element:m.jsx(WOe,{})}),m.jsx(cs,{path:"/activity/:id",element:m.jsx(HOe,{})}),m.jsx(cs,{path:"/auth",element:m.jsx(ZOe,{})}),m.jsx(cs,{path:"/profile",element:m.jsx(nke,{})}),m.jsx(cs,{path:"/join-us",element:m.jsx(ake,{})}),m.jsx(cs,{path:"/merchant-restaurants",element:m.jsx(jet,{})}),m.jsx(cs,{path:"/admin",element:m.jsx(SJe,{})}),m.jsx(cs,{path:"/admin/users",element:m.jsx(IJe,{})}),m.jsx(cs,{path:"/admin/restaurants",element:m.jsx(FJe,{})}),m.jsx(cs,{path:"/admin/activities",element:m.jsx(Pet,{})}),m.jsx(cs,{path:"/admin/logs",element:m.jsx(Cet,{})}),m.jsx(cs,{path:"/admin/join-requests",element:m.jsx(Iet,{})}),m.jsx(cs,{path:"/admin/reports",element:m.jsx(Ret,{})}),m.jsx(cs,{path:"*",element:m.jsx(oke,{})})]})})]})})]})});TY(document.getElementById("root")).render(m.jsx(Met,{}));
