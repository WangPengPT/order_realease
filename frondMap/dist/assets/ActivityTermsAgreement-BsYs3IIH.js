import{r as i,j as e}from"./vendor-react-core-BErlw7p5.js";import{a as _}from"./vendor-query-BS0wY7WL.js";import{a6 as G,r as J,s as D,D as V,U as W,B as g,o as k,a as X,b as Y,c as Z,Q as $,A as ee,E as se,F as te,G as ae,J as re,I as ie,K as ne,L as oe,M as le}from"./index-CEqKPgls.js";import{u as ce}from"./useActivityRules-BqnCt-Ah.js";import{u as me}from"./useActivityParticipation-BhSi6qgs.js";import{ah as S}from"./vendor-misc-DH4LiFnZ.js";import{u as de}from"./vendor-i18n-CqcxoxDo.js";import{ab as R,a as I,ar as x,o as c}from"./vendor-icons-C2Bicc1E.js";import{F as ue}from"./vendor-date-fYlqblcl.js";const Ne=({isAgreed:m,agreedAt:h,open:v,onOpenChange:P})=>{const{t,i18n:d}=de(),{data:n,isLoading:O}=ce(),a=G(),{data:q=[]}=me(),{isSupervisor:r}=J(),[y,j]=i.useState(null),[F,L]=i.useState(!1),[M,u]=i.useState(!1),[T,N]=i.useState(""),A=v!==void 0,z=A?v:F,B=A?P||(()=>{}):L,b=i.useMemo(()=>{const s=d.language;return s==="zh"?"退出活动":s==="pt"?"sair das atividades":"quit activities"},[d.language]),{data:Q=[]}=_({queryKey:["supervisorManagedRestaurants"],queryFn:async()=>{const{data:s,error:l}=await D.from("merchant_restaurants").select("restaurant_id");return l||!s?[]:s.map(C=>C.restaurant_id)},enabled:r}),o=r?Q:q.map(s=>s.id),{data:p=0}=_({queryKey:["merchantParticipatingActivitiesCount",o,r],queryFn:async()=>{if(o.length===0)return 0;const{data:s,error:l}=await D.from("activity_restaurants").select("activity_id").in("restaurant_id",o);return l?0:[...new Set(s?.map(K=>K.activity_id)||[])].length},enabled:o.length>0}),w=p>0,f=async s=>{j(s);try{await a.mutateAsync({agreed:s,isSupervisor:r}),S.success(t(s?"profile.activityTermsAgreed":"profile.activityTermsRevoked")),u(!1)}catch{S.error(t("profile.activityTermsUpdateFailed"))}finally{j(null)}},U=()=>{w?u(!0):f(!1)},E=()=>{if(!n)return"";const s=d.language;return s==="zh"?n.content_zh:s==="pt"?n.content_pt:n.content_en},H=y!==null?y:m;return e.jsxs(V,{open:z,onOpenChange:B,children:[e.jsx(W,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:"w-full justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-primary"}),e.jsx("span",{children:t("profile.activityTermsTitle")})]}),m?e.jsxs(k,{className:"bg-green-500/10 text-green-600 hover:bg-green-500/20 ml-2",children:[e.jsx(I,{className:"w-3 h-3 mr-1"}),t("profile.activityTermsAgreedStatus")]}):e.jsxs(k,{variant:"secondary",className:"bg-amber-500/10 text-amber-600 ml-2",children:[e.jsx(x,{className:"w-3 h-3 mr-1"}),t("profile.activityTermsNotAgreed")]})]})}),e.jsxs(X,{className:"max-w-md max-h-[85vh] overflow-hidden flex flex-col",children:[e.jsxs(Y,{children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-primary"}),t("profile.activityTermsTitle")]}),e.jsx($,{children:t("profile.activityTermsDescription")})]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-4 py-4",children:O?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(c,{className:"w-6 h-6 animate-spin text-primary"})}):e.jsx("div",{className:"rounded-lg border bg-muted/30 p-4",children:e.jsx("div",{className:`prose prose-sm dark:prose-invert max-w-none text-sm\r
                  [&_h1]:text-base [&_h1]:font-bold [&_h1]:mb-2\r
                  [&_h2]:text-sm [&_h2]:font-semibold [&_h2]:mb-2\r
                  [&_p]:mb-2 [&_p]:text-muted-foreground\r
                  [&_ul]:list-disc [&_ul]:ml-4 [&_ul]:mb-2\r
                  [&_li]:mb-0.5\r
                  [&_span[style*='color']]:!text-inherit`,dangerouslySetInnerHTML:{__html:E()}})})}),e.jsxs("div",{className:"pt-4 border-t space-y-3",children:[h&&m&&e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:[t("profile.agreedOn"),": ",ue(new Date(h),{addSuffix:!0})]}),H?e.jsxs(g,{variant:"destructive",className:"w-full",onClick:U,disabled:a.isPending,children:[a.isPending?e.jsx(c,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(x,{className:"w-4 h-4 mr-2"}),t(w?r?"profile.revokeTermsAndQuitActivitiesSupervisor":"profile.revokeTermsAndQuitActivities":"profile.revokeTermsOnly")]}):e.jsxs(g,{variant:"default",className:"w-full",onClick:()=>f(!0),disabled:a.isPending,children:[a.isPending?e.jsx(c,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(I,{className:"w-4 h-4 mr-2"}),t("profile.agreeToTermsButton")]})]})]}),e.jsx(ee,{open:M,onOpenChange:s=>{u(s),s||N("")},children:e.jsxs(se,{children:[e.jsxs(te,{children:[e.jsxs(ae,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(x,{className:"w-5 h-5"}),t("profile.revokeTermsConfirmTitle")]}),e.jsx(re,{children:r?t("profile.revokeTermsConfirmDescriptionSupervisor",{count:p}):t("profile.revokeTermsConfirmDescription",{count:p})})]}),e.jsxs("div",{className:"py-4 space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("profile.revokeTermsTypeToConfirm",{phrase:b})}),e.jsx(ie,{value:T,onChange:s=>N(s.target.value),className:"font-mono"})]}),e.jsxs(ne,{children:[e.jsx(oe,{children:t("common.cancel")}),e.jsxs(le,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:()=>f(!1),disabled:a.isPending||T!==b,children:[a.isPending?e.jsx(c,{className:"w-4 h-4 mr-2 animate-spin"}):null,t("profile.confirmRevokeTerms")]})]})]})})]})};export{Ne as A};
//# sourceMappingURL=ActivityTermsAgreement-BsYs3IIH.js.map
