import{p as X,u as Xe,r,j as e,bc as de,bd as Qe,cZ as Je,L as se,a_ as Ke,bb as Ze,aw as te,ay as ne,ei as _e,b9 as ae,aY as re,bs as le,cg as es,X as De,bi as ze,W as Ae,w as ss,s as ts,bB as ns,cz as Le,bE as Me,dM as Pe,dN as $e,ek as ie,a4 as as,b6 as Se}from"./vendor-react-uzPisSBl.js";import{C as ke,a as Te,b as Ee}from"./carousel-BgNhvh63.js";import{u as rs,C as B,m as me,V as ue,W as xe,X as he,B as A,O as ls,P as is,h as C,Q as cs,R as Ie,n as J,p as os,A as ds,q as ms,r as us,t as xs,v as hs,w as gs,x as fs,y as ps,a as js,s as Ns}from"./index-DMJMYAbQ.js";import{a as bs,f as ws,b as vs}from"./useCommunityPosts-ByYZQ9S7.js";import{u as ge}from"./useLocalizedContent-BCXwZ8Rh.js";import{T as K}from"./TranslateButton-BxIGQqeD.js";import{u as ys}from"./ShareDrawer-C5wvlPzY.js";import{E as Cs,a as _s}from"./EditRecipeDialog-Qe6tA6HJ.js";import{u as Ss}from"./useLoginRequired-dq5y9iE8.js";import{H as fe,p as pe,I as je,J as Ne}from"./vendor-utils-vwQGbBim.js";import{S as ce}from"./separator-iH-RFpyW.js";import{I as be}from"./ImagePreviewModal-BJ7U4vyA.js";import{E as ks}from"./ExternalLinkConfirmDialog-BdIXYI92.js";import{P as Ts}from"./progress-y4EccLw5.js";const Vs=({post:s,showActions:L=!0,isDetailPage:t=!1})=>{const{t:l,i18n:b}=X(),{user:w}=rs(),f=Xe(),{requireLogin:I}=Ss(),{getLocalizedField:j}=ge(),T=bs(),i=ws(),h=vs(),[E,_]=r.useState(!1),[M,S]=r.useState(!1),[P,D]=r.useState({}),[d,x]=r.useState(!1),[v,$]=r.useState(0),[k,G]=r.useState(),[U,H]=r.useState(),[O,W]=r.useState(0),[Y,m]=r.useState(null);r.useState(null),r.useState(!1),r.useState(0),r.useState(!1);const[n,o]=r.useState({}),[c,p]=r.useState(null),[y,R]=r.useState(!1),{share:q,DrawerComponent:Re}=ys();r.useEffect(()=>{if(d){const a=window.scrollY;return document.body.style.position="fixed",document.body.style.top=`-${a}px`,document.body.style.left="0",document.body.style.right="0",document.body.style.overflow="hidden",()=>{document.body.style.position="",document.body.style.top="",document.body.style.left="",document.body.style.right="",document.body.style.overflow="",window.scrollTo(0,a)}}},[d]),r.useEffect(()=>{k&&(W(k.selectedScrollSnap()),k.on("select",()=>{W(k.selectedScrollSnap())}))},[k]);const Fe=()=>{switch(b.language){case"zh":return Ne;case"pt":return je;default:return pe}},Ue=()=>{I()&&T.mutate({postId:s.id,liked:s.user_liked||!1})},Oe=async()=>{const a=`${window.location.origin}/community/${s.id}`;q({title:l("community.shareTitle","分享帖子"),text:s.content.replace(/<[^>]*>/g,"").substring(0,100),url:a},()=>{w&&i.mutate(s.id),ss.success(l("community.shareSuccess","分享成功"))})},We=()=>{h.mutate(s.id),_(!1)},we=a=>{t?($(a),x(!0)):f(`/community/${s.id}`)},Q=(a,u)=>{const N=a.currentTarget;o(z=>({...z,[u]:{width:N.naturalWidth,height:N.naturalHeight}}))},ve=a=>{const u=n[a];return u?u.height/u.width>1.5:!1},ye=w?.id===s.author_id,Ge=s.activity?j(s.activity,"title"):null,V=[...s.restaurants||[],...s.restaurant&&!s.restaurants?.find(a=>a.id===s.restaurant?.id)?[s.restaurant]:[]],Z=t?3:2,He=y?V:V.slice(0,Z),Ce=V.length>Z,Ye=j(s,"content"),qe=b.language==="zh"&&s.content_zh||b.language==="en"&&s.content_en||b.language==="pt"&&s.content_pt,Ve=(Y||Ye||s.content)?.replace(/\n/g,"<br>")||"";return e.jsxs(e.Fragment,{children:[e.jsxs(B,{className:"overflow-hidden",children:[e.jsx(me,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ue,{className:"h-10 w-10",children:[e.jsx(xe,{src:s.author?.avatar_url||void 0}),e.jsx(he,{children:s.author?.display_name?.charAt(0)||"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.author?.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:fe(new Date(s.created_at),{addSuffix:!0,locale:Fe()})}),ye&&s.status==="pending"&&e.jsxs(A,{variant:"outline",className:"text-amber-600 border-amber-500 bg-amber-50 dark:bg-amber-950/30 text-xs mt-0.5",children:[e.jsx(de,{className:"w-3 h-3 mr-1"}),l("community.pendingReview","审核中")]})]})]}),L&&ye&&e.jsxs(ls,{children:[e.jsx(is,{asChild:!0,children:e.jsx(C,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(Qe,{className:"h-4 w-4"})})}),e.jsxs(cs,{align:"end",children:[e.jsxs(Ie,{onClick:()=>S(!0),children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),l("common.edit","编辑")]}),e.jsx(Ie,{onClick:()=>_(!0),className:"text-destructive",children:l("common.delete","删除")})]})]})]})}),e.jsxs(J,{className:"pt-0 pb-3",children:[(s.activity||V.length>0)&&e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3 items-center",children:[s.activity&&e.jsx(se,{to:`/activity/${s.activity.id}`,children:e.jsxs(A,{variant:"secondary",className:"gap-1",children:[e.jsx(Ke,{className:"h-3 w-3"}),Ge]})}),He.map(a=>e.jsx(se,{to:`/restaurant/${a.id}`,children:e.jsxs(A,{variant:"secondary",className:"gap-1",children:[e.jsx(Ze,{className:"h-3 w-3"}),j(a,"name")]})},a.id)),Ce&&!y&&e.jsxs("button",{onClick:()=>R(!0),className:"text-xs text-muted-foreground hover:text-foreground flex items-center gap-0.5",children:["+",V.length-Z," ",l("community.more","更多"),e.jsx(te,{className:"h-3 w-3"})]}),y&&Ce&&e.jsxs("button",{onClick:()=>R(!1),className:"text-xs text-muted-foreground hover:text-foreground flex items-center gap-0.5",children:[l("community.collapse","收起"),e.jsx(ne,{className:"h-3 w-3"})]})]}),e.jsx(se,{to:`/community/${s.id}`,children:e.jsx("div",{className:`prose prose-sm max-w-none dark:prose-invert ${t?"":"line-clamp-6"}`,dangerouslySetInnerHTML:{__html:Ve}})}),!qe&&e.jsx(K,{text:s.content,onTranslation:m,className:"mt-1"}),(()=>{const a=t&&s.video_url?(s.image_urls||[]).filter(u=>!u.includes("-cover")):s.image_urls;return!a||a.length===0?null:e.jsx("div",{className:"relative mt-3",children:a.length===1?(()=>{const u=a[0],N=ve(u);return e.jsx("div",{className:"relative overflow-hidden rounded-lg cursor-pointer max-h-[300px] sm:max-h-[400px]",onClick:()=>we(0),children:P[u]?e.jsx("div",{className:"w-full h-full min-h-[200px] bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-muted-foreground",children:l("common.imageLoadError","图片加载失败")})}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:u,alt:"",className:"w-full max-h-[300px] sm:max-h-[400px] object-cover object-top",onLoad:z=>Q(z,u),onError:()=>D(z=>({...z,[u]:!0}))}),N&&e.jsxs("div",{className:"absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full flex items-center gap-1",children:[e.jsx(_e,{className:"h-3 w-3"}),e.jsx("span",{children:l("community.longImage","长图")})]})]})})})():e.jsxs(e.Fragment,{children:[e.jsx(ke,{setApi:G,className:"w-full",opts:{loop:!0},children:e.jsx(Te,{className:"-ml-0",children:a.map((u,N)=>{const z=ve(u);return e.jsx(Ee,{className:"pl-0",children:e.jsx("div",{className:"relative overflow-hidden rounded-lg cursor-pointer aspect-[4/3] bg-muted",onClick:()=>we(N),children:P[u]?e.jsx("div",{className:"w-full h-full min-h-[200px] bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-muted-foreground",children:l("common.imageLoadError","图片加载失败")})}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:u,alt:"",className:"w-full h-full object-contain",onLoad:g=>Q(g,u),onError:()=>D(g=>({...g,[u]:!0}))}),z&&e.jsxs("div",{className:"absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full flex items-center gap-1",children:[e.jsx(_e,{className:"h-3 w-3"}),e.jsx("span",{children:l("community.longImage","长图")})]})]})})},N)})})}),e.jsxs("div",{className:"absolute top-3 right-3 bg-black/60 text-white text-xs px-2 py-1 rounded-full z-10",children:[O+1,"/",a.length]}),e.jsx("div",{className:"flex justify-center gap-1.5 mt-2",children:a.map((u,N)=>e.jsx("button",{className:`w-1.5 h-1.5 rounded-full transition-colors ${N===O?"bg-primary":"bg-muted-foreground/30"}`,onClick:z=>{z.stopPropagation(),k?.scrollTo(N)}},N))})]})})})(),s.video_url&&e.jsx("div",{className:"mt-3 rounded-lg overflow-hidden bg-gray-900",children:e.jsx("video",{src:s.video_url,...s.image_urls?.length?{poster:s.image_urls[0]}:{},controls:!0,className:"w-full max-h-96",preload:"metadata",playsInline:!0})})]}),e.jsx(os,{className:"pt-0 border-t",children:e.jsxs("div",{className:"flex items-center gap-4 pt-3 w-full",children:[e.jsxs(C,{variant:"ghost",size:"sm",className:`gap-2 ${s.user_liked?"text-red-500":""}`,onClick:Ue,disabled:!w,children:[e.jsx(ae,{className:`h-4 w-4 ${s.user_liked?"fill-current":""}`}),e.jsx("span",{children:s.likes_count})]}),e.jsxs(C,{variant:"ghost",size:"sm",className:"gap-2",onClick:()=>{I()&&f(`/community/${s.id}`)},children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{children:s.comments_count})]}),e.jsxs(C,{variant:"ghost",size:"sm",className:"gap-2",onClick:Oe,children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{children:s.shares_count})]})]})})]}),e.jsx(ds,{open:E,onOpenChange:_,children:e.jsxs(ms,{children:[e.jsxs(us,{children:[e.jsx(xs,{children:l("common.confirmDelete","确认删除")}),e.jsx(hs,{children:l("community.deleteWarning","删除后无法恢复，确定要删除这篇帖子吗？")})]}),e.jsxs(gs,{children:[e.jsx(fs,{children:l("common.cancel","取消")}),e.jsx(ps,{onClick:We,children:l("common.delete","删除")})]})]})}),s.post_type==="recipe"?e.jsx(Cs,{post:s,open:M,onOpenChange:S}):e.jsx(_s,{post:s,open:M,onOpenChange:S}),d&&es.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] bg-black overflow-hidden",onClick:a=>{a.target===a.currentTarget&&x(!1)},onWheel:a=>a.stopPropagation(),onTouchMove:a=>a.stopPropagation(),children:[s.image_urls&&s.image_urls.length>1&&e.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-10 text-white text-sm bg-black/50 px-4 py-1.5 rounded-full",children:[v+1," / ",s.image_urls.length]}),e.jsx(C,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-10 text-white hover:bg-white/20",onClick:()=>x(!1),children:e.jsx(De,{className:"h-6 w-6"})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(ke,{className:"w-full",opts:{loop:!0,startIndex:v},setApi:a=>{H(a),a&&a.on("select",()=>{$(a.selectedScrollSnap())})},children:e.jsx(Te,{className:"-ml-0",children:s.image_urls?.map((a,u)=>{const N=n[a],z=N?N.height/N.width>1.5:!1;return e.jsx(Ee,{className:"pl-0 flex items-center justify-center",children:z?e.jsx("div",{className:"w-full h-screen overflow-x-hidden overflow-y-scroll overscroll-contain",onMouseDown:g=>{const F=g.currentTarget;p({y:g.clientY,scrollTop:F.scrollTop})},onMouseUp:g=>{if(c){const F=Math.abs(g.clientY-c.y),ee=Math.abs(g.currentTarget.scrollTop-c.scrollTop);F<10&&ee<10&&x(!1),p(null)}},onTouchStart:g=>{const F=g.currentTarget;p({y:g.touches[0].clientY,scrollTop:F.scrollTop})},onTouchEnd:g=>{if(c){const F=g.changedTouches[0],ee=Math.abs(F.clientY-c.y),Be=Math.abs(g.currentTarget.scrollTop-c.scrollTop);ee<15&&Be<15&&(g.preventDefault(),x(!1)),p(null)}},children:e.jsx("img",{src:a,alt:"",className:"block select-none",style:{width:"100vw",minHeight:"100dvh",height:"auto",margin:0},draggable:!1,onLoad:g=>Q(g,a)})}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("img",{src:a,alt:"",className:"object-contain w-screen h-screen select-none cursor-pointer",draggable:!1,onClick:()=>x(!1),onLoad:g=>Q(g,a)})})},u)})})})}),s.image_urls&&s.image_urls.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"ghost",size:"icon",className:"absolute left-4 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 hidden sm:flex",onClick:()=>U?.scrollPrev(),children:e.jsx(ze,{className:"h-8 w-8"})}),e.jsx(C,{variant:"ghost",size:"icon",className:"absolute right-4 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 hidden sm:flex",onClick:()=>U?.scrollNext(),children:e.jsx(Ae,{className:"h-8 w-8"})})]})]}),document.body),Re]})},Es=()=>Ns.from("ads"),oe=()=>{const{t:s}=X(),L=js(),[t,l]=r.useState(null),[b,w]=r.useState(null),{data:f}=ts({queryKey:["active-ads"],queryFn:async()=>{const i=new Date().toISOString(),{data:h,error:E}=await Es().select("*").eq("is_active",!0).or(`start_date.is.null,start_date.lte.${i}`).or(`end_date.is.null,end_date.gte.${i}`).order("sort_order",{ascending:!0});if(E)throw E;return h},staleTime:5*60*1e3});if(!f||f.length===0)return null;const I=i=>{i.link_url&&(l(i.link_url),w(i.name))},j=()=>{t&&(window.open(t,"_blank","noopener,noreferrer"),l(null),w(null))},T=i=>L?i.mobile_image_url||i.desktop_image_url||i.image_url:i.desktop_image_url||i.mobile_image_url||i.image_url;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2 mt-3",children:f.map(i=>{const h=T(i);return e.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-border/50 hover:border-primary/30 transition-colors cursor-pointer",style:{aspectRatio:L?"375/112":"672/112"},onClick:()=>I(i),children:[e.jsx(A,{className:"absolute top-1.5 left-1.5 z-10 bg-black/60 text-white text-[10px] px-1.5 py-0.5 rounded hover:bg-black/60",children:s("common.ad","广告")}),h?e.jsx("img",{src:h,alt:i.name,className:"w-full h-full object-cover"}):e.jsxs("div",{className:"flex items-center gap-2 px-3 bg-muted/50 text-sm text-muted-foreground w-full h-full justify-center",children:[e.jsx(ns,{className:"h-3.5 w-3.5 shrink-0"}),e.jsx("span",{className:"truncate",children:i.name})]})]},i.id)})}),e.jsx(ks,{open:!!t,onOpenChange:i=>{i||(l(null),w(null))},onConfirm:j,url:t||void 0,title:s("common.adLinkTitle","外部链接"),description:s("common.adLinkDescription","您即将离开本站，前往广告链接「{{name}}」的外部页面",{name:b||""}),confirmLabel:s("common.adLinkContinue","继续前往")})]})},Is=({post:s,onStartCooking:L})=>{const{t,i18n:l}=X(),{getLocalizedField:b}=ge(),[w,f]=r.useState(null),[I,j]=r.useState(null),[T,i]=r.useState({}),[h,E]=r.useState(null),[_,M]=r.useState(!1),[S,P]=r.useState(!1),D=200,d=5,v=I||(()=>{const n={zh:"content_zh",en:"content_en",pt:"content_pt"}[l.language]||"content",o=s[n];return o&&typeof o=="string"&&o.trim()?o:s.content})(),$=w||b(s,"recipe_name")||s.recipe_name,k=()=>{const m=[];if(s.recipe_name&&m.push(`[NAME]${s.recipe_name}`),s.content&&s.content.trim()&&!s.content.includes("主要配料：")&&m.push(`[CONTENT]${s.content}`),s.ingredients&&s.ingredients.length>0){const n=s.ingredients.map(o=>o.name).join("|");m.push(`[INGREDIENTS]${n}`)}return m.join(`
---
`)},G=m=>{if(!m){f(null),j(null),i({});return}m.split(`
---
`).forEach(o=>{if(o.startsWith("[NAME]"))f(o.replace("[NAME]",""));else if(o.startsWith("[CONTENT]"))j(o.replace("[CONTENT]",""));else if(o.startsWith("[INGREDIENTS]")){const c=o.replace("[INGREDIENTS]","").split("|"),p={};c.forEach((y,R)=>{p[R]=y.trim()}),i(p)}})},U=()=>{switch(l.language){case"zh":return Ne;case"pt":return je;default:return pe}},H=m=>{switch(m){case"easy":return"bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30";case"medium":return"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30";case"hard":return"bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30";default:return"bg-muted text-muted-foreground"}},O=m=>{switch(m){case"easy":return t("recipe.difficulty.easy","简单");case"medium":return t("recipe.difficulty.medium","中等");case"hard":return t("recipe.difficulty.hard","困难");default:return m}},W=s.image_urls&&s.image_urls.length>0,Y=s.steps&&s.steps.length>0;return e.jsxs(B,{className:"overflow-hidden",children:[W&&e.jsxs("div",{className:"relative aspect-video overflow-hidden",children:[e.jsx("img",{src:s.image_urls[0],alt:$||"",className:"w-full h-full object-cover cursor-pointer",onClick:()=>E(s.image_urls[0])}),e.jsxs(A,{className:"absolute top-3 left-3 bg-primary text-primary-foreground gap-1",children:[e.jsx(Le,{className:"h-3 w-3"}),t("recipe.badge","食谱")]})]}),e.jsxs(me,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsxs(ue,{className:"h-10 w-10",children:[e.jsx(xe,{src:s.author?.avatar_url||void 0}),e.jsx(he,{children:s.author?.display_name?.charAt(0)||"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.author?.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:fe(new Date(s.created_at),{addSuffix:!0,locale:U()})})]})]}),e.jsx("div",{className:"mb-2",children:e.jsx(K,{text:k(),onTranslation:G,label:t("recipe.translateAll")})}),e.jsx("h2",{className:"text-xl font-bold",children:$}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[s.cook_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.cook_time," ",t("recipe.minutes","分钟")]})]}),s.servings&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.servings," ",t("recipe.servings","人份")]})]}),s.difficulty&&e.jsxs(A,{variant:"outline",className:H(s.difficulty),children:[e.jsx(Pe,{className:"h-3 w-3 mr-1"}),O(s.difficulty)]})]})]}),e.jsxs(J,{className:"space-y-6",children:[s.content&&s.content.trim()&&!s.content.includes("主要配料：")&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:_||(v||"").length<=D?v:(v||"").slice(0,D)+"..."}),(v||"").length>D&&e.jsxs(C,{variant:"ghost",size:"sm",className:"px-0 h-auto py-1 text-xs text-primary",onClick:()=>M(!_),children:[_?t("common.collapse","收起"):t("common.viewAll","查看全部"),_?e.jsx(ne,{className:"h-3 w-3 ml-1"}):e.jsx(te,{className:"h-3 w-3 ml-1"})]})]}),s.nutrition&&(s.nutrition.calories||s.nutrition.protein||s.nutrition.carbs||s.nutrition.fat)&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3 flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4 text-orange-500"}),t("recipe.nutrition","营养信息")]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[s.nutrition.calories&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-lg font-bold text-primary",children:s.nutrition.calories}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.kcal","千卡")})]}),s.nutrition.protein&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.protein,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.protein","蛋白质")})]}),s.nutrition.carbs&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.carbs,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.carbs","碳水")})]}),s.nutrition.fat&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.fat,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.fat","脂肪")})]})]})]}),e.jsx(ce,{}),s.ingredients&&s.ingredients.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[t("recipe.ingredients","食材")," (",s.ingredients.length,")"]}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground font-medium px-2 py-1.5 bg-muted/50 rounded-t-md border border-border/50",children:[e.jsx("span",{className:"flex-1",children:t("recipe.ingredientName","名称")}),e.jsx("span",{className:"w-24 text-right",children:t("recipe.amount","用量")})]}),e.jsx("ul",{className:"border border-t-0 border-border/50 rounded-b-md divide-y divide-border/50",children:(S?s.ingredients:s.ingredients.slice(0,d)).map((m,n)=>e.jsxs("li",{className:"flex items-center text-sm px-2 py-2",children:[e.jsx("span",{className:"flex-1 min-w-0 truncate",children:T[n]||m.name}),e.jsxs("span",{className:"w-24 text-right text-muted-foreground shrink-0",children:[m.amount," ",m.unit]})]},n))}),s.ingredients.length>d&&e.jsxs(e.Fragment,{children:[S&&e.jsx(oe,{}),e.jsxs(C,{variant:"ghost",size:"sm",className:"w-full mt-2 text-xs text-primary",onClick:()=>P(!S),children:[S?t("common.collapse","收起"):t("recipe.showAllIngredients",{count:s.ingredients.length}),S?e.jsx(ne,{className:"h-3 w-3 ml-1"}):e.jsx(te,{className:"h-3 w-3 ml-1"})]})]}),s.ingredients.length<=d&&e.jsx(oe,{})]}),s.recipe_tags&&s.recipe_tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 pt-2",children:s.recipe_tags.map((m,n)=>e.jsxs(A,{variant:"secondary",className:"text-xs",children:["#",m]},n))}),Y&&e.jsxs(C,{size:"lg",className:"w-full gap-2 h-14 text-lg",onClick:L,children:[e.jsx(ie,{className:"h-6 w-6"}),t("recipe.startCooking","开始烹饪"),e.jsxs(A,{variant:"secondary",className:"ml-2",children:[s.steps.length," ",t("recipe.stepsCount","步")]})]})]}),e.jsx(be,{imageUrl:h||"",isOpen:!!h,onClose:()=>E(null)})]})},Ds=({steps:s,onExit:L})=>{const{t}=X(),[l,b]=r.useState(0),[w,f]=r.useState({}),[I,j]=r.useState(null),T=[...s].sort((d,x)=>d.order-x.order),i=T.length,h=T[l],E=(l+1)/i*100,_=l===i-1,M=l===0,S=()=>{_||b(d=>d+1)},P=()=>{M||b(d=>d-1)},D=()=>{L()};return e.jsxs("div",{className:"flex flex-col h-full min-h-[60vh]",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b bg-background sticky top-0 z-10",children:[e.jsx(C,{variant:"ghost",size:"icon",onClick:L,children:e.jsx(De,{className:"h-5 w-5"})}),e.jsx("span",{className:"font-medium",children:t("recipe.stepProgress","步骤 {{current}} / {{total}}",{current:l+1,total:i})}),e.jsx(K,{text:T.map(d=>d.description).join(`
---
`),onTranslation:d=>{if(d){const x=d.split(`
---
`),v={};x.forEach(($,k)=>{v[k]=$}),f(v)}else f({})}})]}),e.jsx(Ts,{value:E,className:"h-1 rounded-none"}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-2xl font-bold shadow-lg",children:h.order})}),(()=>{const d=h.image_urls&&h.image_urls.length>0?h.image_urls:h.image_url?[h.image_url]:[];return d.length>0&&e.jsx("div",{className:"mb-6 flex flex-wrap justify-center gap-2",children:d.map((x,v)=>e.jsx("img",{src:x,alt:`Step ${h.order} - ${v+1}`,className:`h-auto max-h-64 object-cover cursor-pointer rounded-xl ${d.length===1?"max-w-[75%]":"w-[calc(50%-0.25rem)]"}`,onClick:()=>j(x)},v))})})(),e.jsx("p",{className:"text-lg leading-relaxed text-center",children:w[l]||h.description})]}),e.jsx("div",{className:"flex justify-center gap-1.5 py-3",children:T.map((d,x)=>e.jsx("button",{className:`w-2 h-2 rounded-full transition-all ${x===l?"bg-primary w-6":x<l?"bg-primary/50":"bg-muted-foreground/30"}`,onClick:()=>b(x)},x))}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t bg-background",children:[e.jsxs(C,{variant:"outline",size:"lg",onClick:P,disabled:M,className:"gap-2",children:[e.jsx(ze,{className:"h-5 w-5"}),t("recipe.prevStep","上一步")]}),_?e.jsxs(C,{size:"lg",onClick:D,className:"gap-2",variant:"default",children:[e.jsx(as,{className:"h-5 w-5"}),t("recipe.complete","完成")]}):e.jsxs(C,{size:"lg",onClick:S,className:"gap-2",children:[t("recipe.nextStep","下一步"),e.jsx(Ae,{className:"h-5 w-5"})]})]}),e.jsx(be,{imageUrl:I||"",isOpen:!!I,onClose:()=>j(null)})]})},Bs=({post:s,showActions:L=!1})=>{const{t,i18n:l}=X(),{getLocalizedField:b}=ge(),[w,f]=r.useState("guided"),[I,j]=r.useState("overview"),[T,i]=r.useState(null),[h,E]=r.useState(null),[_,M]=r.useState({}),[S,P]=r.useState({}),[D,d]=r.useState(null);r.useRef(null);const x=r.useCallback(()=>{j("cooking"),requestAnimationFrame(()=>{window.scrollTo({top:0,behavior:"smooth"})})},[]),$=h||(()=>{const o={zh:"content_zh",en:"content_en",pt:"content_pt"}[l.language]||"content",c=s[o];return c&&typeof c=="string"&&c.trim()?c:s.content})(),k=T||b(s,"recipe_name")||s.recipe_name,G=()=>{const n=[];if(s.recipe_name&&n.push(`[NAME]${s.recipe_name}`),s.content&&s.content.trim()&&!s.content.includes("主要配料：")&&n.push(`[CONTENT]${s.content}`),s.ingredients&&s.ingredients.length>0){const o=s.ingredients.map(c=>c.name).join("|");n.push(`[INGREDIENTS]${o}`)}if(s.steps&&s.steps.length>0){const o=s.steps.sort((c,p)=>c.order-p.order).map(c=>c.description).join("|");n.push(`[STEPS]${o}`)}return n.join(`
---
`)},U=n=>{if(!n){i(null),E(null),M({}),P({});return}n.split(`
---
`).forEach(c=>{if(c.startsWith("[NAME]"))i(c.replace("[NAME]",""));else if(c.startsWith("[CONTENT]"))E(c.replace("[CONTENT]",""));else if(c.startsWith("[INGREDIENTS]")){const p=c.replace("[INGREDIENTS]","").split("|"),y={};p.forEach((R,q)=>{y[q]=R.trim()}),M(y)}else if(c.startsWith("[STEPS]")){const p=c.replace("[STEPS]","").split("|"),y={};p.forEach((R,q)=>{y[q]=R.trim()}),P(y)}})},H=()=>{switch(l.language){case"zh":return Ne;case"pt":return je;default:return pe}},O=n=>{switch(n){case"easy":return"bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30";case"medium":return"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30";case"hard":return"bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30";default:return"bg-muted text-muted-foreground"}},W=n=>{switch(n){case"easy":return t("recipe.difficulty.easy","简单");case"medium":return t("recipe.difficulty.medium","中等");case"hard":return t("recipe.difficulty.hard","困难");default:return n}},Y=s.image_urls&&s.image_urls.length>0,m=s.steps&&s.steps.length>0;return w==="guided"&&I==="cooking"&&m?e.jsx(B,{className:"overflow-hidden",children:e.jsx(Ds,{steps:s.steps,onExit:()=>j("overview")})}):w==="guided"?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"inline-flex h-9 items-center rounded-md bg-muted p-1 text-muted-foreground",children:[e.jsxs("button",{onClick:()=>f("guided"),className:"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 bg-background text-foreground shadow-sm",children:[e.jsx(ie,{className:"h-4 w-4"}),t("recipe.guidedMode","流程模式")]}),e.jsxs("button",{onClick:()=>f("full"),className:"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5",children:[e.jsx(Se,{className:"h-4 w-4"}),t("recipe.fullMode","完整模式")]})]})}),e.jsx(Is,{post:s,onStartCooking:x}),e.jsx(B,{children:e.jsx(J,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-6 text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(ae,{className:"h-4 w-4"}),s.likes_count||0]}),e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(re,{className:"h-4 w-4"}),s.comments_count||0]}),e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(le,{className:"h-4 w-4"}),s.shares_count||0]})]})})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"inline-flex h-9 items-center rounded-md bg-muted p-1 text-muted-foreground",children:[e.jsxs("button",{onClick:()=>{f("guided"),j("overview")},className:"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5",children:[e.jsx(ie,{className:"h-4 w-4"}),t("recipe.guidedMode","流程模式")]}),e.jsxs("button",{onClick:()=>f("full"),className:"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 bg-background text-foreground shadow-sm",children:[e.jsx(Se,{className:"h-4 w-4"}),t("recipe.fullMode","完整模式")]})]})}),e.jsxs(B,{className:"overflow-hidden",children:[Y&&e.jsxs("div",{className:"relative aspect-video overflow-hidden",children:[e.jsx("img",{src:s.image_urls[0],alt:k||"",className:"w-full h-full object-cover cursor-pointer",onClick:()=>d(s.image_urls[0])}),e.jsxs(A,{className:"absolute top-3 left-3 bg-primary text-primary-foreground gap-1",children:[e.jsx(Le,{className:"h-3 w-3"}),t("recipe.badge","食谱")]})]}),e.jsxs(me,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsxs(ue,{className:"h-10 w-10",children:[e.jsx(xe,{src:s.author?.avatar_url||void 0}),e.jsx(he,{children:s.author?.display_name?.charAt(0)||"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.author?.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:fe(new Date(s.created_at),{addSuffix:!0,locale:H()})})]})]}),e.jsx("div",{className:"mb-2",children:e.jsx(K,{text:G(),onTranslation:U,label:t("recipe.translateAllFull")})}),e.jsx("h2",{className:"text-xl font-bold",children:k}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[s.cook_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.cook_time," ",t("recipe.minutes","分钟")]})]}),s.servings&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.servings," ",t("recipe.servings","人份")]})]}),s.difficulty&&e.jsxs(A,{variant:"outline",className:O(s.difficulty),children:[e.jsx(Pe,{className:"h-3 w-3 mr-1"}),W(s.difficulty)]})]})]}),e.jsxs(J,{className:"space-y-6",children:[s.content&&s.content.trim()&&!s.content.includes("主要配料：")&&e.jsx("div",{children:e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:$})}),s.nutrition&&(s.nutrition.calories||s.nutrition.protein||s.nutrition.carbs||s.nutrition.fat)&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3 flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4 text-primary"}),t("recipe.nutrition","营养信息")]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[s.nutrition.calories&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-lg font-bold text-primary",children:s.nutrition.calories}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.kcal","千卡")})]}),s.nutrition.protein&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.protein,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.protein","蛋白质")})]}),s.nutrition.carbs&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.carbs,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.carbs","碳水")})]}),s.nutrition.fat&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.fat,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.fat","脂肪")})]})]})]}),e.jsx(ce,{}),s.ingredients&&s.ingredients.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[t("recipe.ingredients","食材")," (",s.ingredients.length,")"]}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground font-medium px-2 py-1.5 bg-muted/50 rounded-t-md border border-border/50",children:[e.jsx("span",{className:"flex-1",children:t("recipe.ingredientName","名称")}),e.jsx("span",{className:"w-24 text-right",children:t("recipe.amount","用量")})]}),e.jsx("ul",{className:"border border-t-0 border-border/50 rounded-b-md divide-y divide-border/50",children:s.ingredients.map((n,o)=>e.jsxs("li",{className:"flex items-center text-sm px-2 py-2",children:[e.jsx("span",{className:"flex-1 min-w-0 truncate",children:_[o]||n.name}),e.jsxs("span",{className:"w-24 text-right text-muted-foreground shrink-0",children:[n.amount," ",n.unit]})]},o))}),e.jsx(oe,{})]}),e.jsx(ce,{}),m&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[t("recipe.steps","步骤")," (",s.steps.length,")"]}),e.jsx("ol",{className:"space-y-4",children:s.steps.sort((n,o)=>n.order-o.order).map((n,o)=>e.jsxs("li",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold",children:n.order}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("p",{className:"text-sm",children:S[o]||n.description}),(()=>{const c=n.image_urls&&n.image_urls.length>0?n.image_urls:n.image_url?[n.image_url]:[];return c.length>0&&e.jsx("div",{className:`flex gap-2 ${c.length===1?"":"flex-wrap"}`,children:c.map((p,y)=>e.jsx("img",{src:p,alt:`Step ${n.order} - ${y+1}`,className:`rounded-lg max-h-48 object-cover cursor-pointer ${c.length===1?"w-full":"w-[calc(50%-0.25rem)]"}`,onClick:()=>d(p)},y))})})()]})]},o))})]}),s.recipe_tags&&s.recipe_tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 pt-2",children:s.recipe_tags.map((n,o)=>e.jsxs(A,{variant:"secondary",className:"text-xs",children:["#",n]},o))}),e.jsxs("div",{className:"flex items-center gap-6 pt-4 border-t text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(ae,{className:"h-4 w-4"}),s.likes_count||0]}),e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(re,{className:"h-4 w-4"}),s.comments_count||0]}),e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(le,{className:"h-4 w-4"}),s.shares_count||0]})]})]})]}),e.jsx(be,{imageUrl:D||"",isOpen:!!D,onClose:()=>d(null)})]})};export{Vs as P,Bs as R};
//# sourceMappingURL=RecipeDetailContent-CGLSx79o.js.map
