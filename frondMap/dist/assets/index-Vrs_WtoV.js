var _q=e=>{throw TypeError(e)};var KM=(e,t,r)=>t.has(e)||_q("Cannot "+r);var Tt=(e,t,r)=>(KM(e,t,"read from private field"),r?r.call(e):t.get(e)),Wn=(e,t,r)=>t.has(e)?_q("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),mn=(e,t,r,n)=>(KM(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),qi=(e,t,r)=>(KM(e,t,"access private method"),r);var GC=(e,t,r,n)=>({set _(s){mn(e,t,s,r)},get _(){return Tt(e,t,n)}});function DX(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in e)){const o=Object.getOwnPropertyDescriptor(n,s);o&&Object.defineProperty(e,s,o.get?o:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();var $c=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Os(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Gme(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})}),r}var LX={exports:{}},Ik={},FX={exports:{}},os={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var p2=Symbol.for("react.element"),Wme=Symbol.for("react.portal"),Kme=Symbol.for("react.fragment"),Zme=Symbol.for("react.strict_mode"),Xme=Symbol.for("react.profiler"),Yme=Symbol.for("react.provider"),Jme=Symbol.for("react.context"),Qme=Symbol.for("react.forward_ref"),ege=Symbol.for("react.suspense"),tge=Symbol.for("react.memo"),rge=Symbol.for("react.lazy"),xq=Symbol.iterator;function nge(e){return e===null||typeof e!="object"?null:(e=xq&&e[xq]||e["@@iterator"],typeof e=="function"?e:null)}var zX={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},BX=Object.assign,$X={};function Kb(e,t,r){this.props=e,this.context=t,this.refs=$X,this.updater=r||zX}Kb.prototype.isReactComponent={};Kb.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Kb.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function UX(){}UX.prototype=Kb.prototype;function T4(e,t,r){this.props=e,this.context=t,this.refs=$X,this.updater=r||zX}var A4=T4.prototype=new UX;A4.constructor=T4;BX(A4,Kb.prototype);A4.isPureReactComponent=!0;var bq=Array.isArray,VX=Object.prototype.hasOwnProperty,C4={current:null},qX={key:!0,ref:!0,__self:!0,__source:!0};function HX(e,t,r){var n,s={},o=null,h=null;if(t!=null)for(n in t.ref!==void 0&&(h=t.ref),t.key!==void 0&&(o=""+t.key),t)VX.call(t,n)&&!qX.hasOwnProperty(n)&&(s[n]=t[n]);var i=arguments.length-2;if(i===1)s.children=r;else if(1<i){for(var m=Array(i),y=0;y<i;y++)m[y]=arguments[y+2];s.children=m}if(e&&e.defaultProps)for(n in i=e.defaultProps,i)s[n]===void 0&&(s[n]=i[n]);return{$$typeof:p2,type:e,key:o,ref:h,props:s,_owner:C4.current}}function ige(e,t){return{$$typeof:p2,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function j4(e){return typeof e=="object"&&e!==null&&e.$$typeof===p2}function sge(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var wq=/\/+/g;function ZM(e,t){return typeof e=="object"&&e!==null&&e.key!=null?sge(""+e.key):t.toString(36)}function Vj(e,t,r,n,s){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var h=!1;if(e===null)h=!0;else switch(o){case"string":case"number":h=!0;break;case"object":switch(e.$$typeof){case p2:case Wme:h=!0}}if(h)return h=e,s=s(h),e=n===""?"."+ZM(h,0):n,bq(s)?(r="",e!=null&&(r=e.replace(wq,"$&/")+"/"),Vj(s,t,r,"",function(y){return y})):s!=null&&(j4(s)&&(s=ige(s,r+(!s.key||h&&h.key===s.key?"":(""+s.key).replace(wq,"$&/")+"/")+e)),t.push(s)),1;if(h=0,n=n===""?".":n+":",bq(e))for(var i=0;i<e.length;i++){o=e[i];var m=n+ZM(o,i);h+=Vj(o,t,r,m,s)}else if(m=nge(e),typeof m=="function")for(e=m.call(e),i=0;!(o=e.next()).done;)o=o.value,m=n+ZM(o,i++),h+=Vj(o,t,r,m,s);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return h}function WC(e,t,r){if(e==null)return e;var n=[],s=0;return Vj(e,n,"","",function(o){return t.call(r,o,s++)}),n}function age(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var gc={current:null},qj={transition:null},oge={ReactCurrentDispatcher:gc,ReactCurrentBatchConfig:qj,ReactCurrentOwner:C4};function GX(){throw Error("act(...) is not supported in production builds of React.")}os.Children={map:WC,forEach:function(e,t,r){WC(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return WC(e,function(){t++}),t},toArray:function(e){return WC(e,function(t){return t})||[]},only:function(e){if(!j4(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};os.Component=Kb;os.Fragment=Kme;os.Profiler=Xme;os.PureComponent=T4;os.StrictMode=Zme;os.Suspense=ege;os.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=oge;os.act=GX;os.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=BX({},e.props),s=e.key,o=e.ref,h=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,h=C4.current),t.key!==void 0&&(s=""+t.key),e.type&&e.type.defaultProps)var i=e.type.defaultProps;for(m in t)VX.call(t,m)&&!qX.hasOwnProperty(m)&&(n[m]=t[m]===void 0&&i!==void 0?i[m]:t[m])}var m=arguments.length-2;if(m===1)n.children=r;else if(1<m){i=Array(m);for(var y=0;y<m;y++)i[y]=arguments[y+2];n.children=i}return{$$typeof:p2,type:e.type,key:s,ref:o,props:n,_owner:h}};os.createContext=function(e){return e={$$typeof:Jme,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Yme,_context:e},e.Consumer=e};os.createElement=HX;os.createFactory=function(e){var t=HX.bind(null,e);return t.type=e,t};os.createRef=function(){return{current:null}};os.forwardRef=function(e){return{$$typeof:Qme,render:e}};os.isValidElement=j4;os.lazy=function(e){return{$$typeof:rge,_payload:{_status:-1,_result:e},_init:age}};os.memo=function(e,t){return{$$typeof:tge,type:e,compare:t===void 0?null:t}};os.startTransition=function(e){var t=qj.transition;qj.transition={};try{e()}finally{qj.transition=t}};os.unstable_act=GX;os.useCallback=function(e,t){return gc.current.useCallback(e,t)};os.useContext=function(e){return gc.current.useContext(e)};os.useDebugValue=function(){};os.useDeferredValue=function(e){return gc.current.useDeferredValue(e)};os.useEffect=function(e,t){return gc.current.useEffect(e,t)};os.useId=function(){return gc.current.useId()};os.useImperativeHandle=function(e,t,r){return gc.current.useImperativeHandle(e,t,r)};os.useInsertionEffect=function(e,t){return gc.current.useInsertionEffect(e,t)};os.useLayoutEffect=function(e,t){return gc.current.useLayoutEffect(e,t)};os.useMemo=function(e,t){return gc.current.useMemo(e,t)};os.useReducer=function(e,t,r){return gc.current.useReducer(e,t,r)};os.useRef=function(e){return gc.current.useRef(e)};os.useState=function(e){return gc.current.useState(e)};os.useSyncExternalStore=function(e,t,r){return gc.current.useSyncExternalStore(e,t,r)};os.useTransition=function(){return gc.current.useTransition()};os.version="18.3.1";FX.exports=os;var V=FX.exports;const Ue=Os(V),P4=DX({__proto__:null,default:Ue},[V]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lge=V,cge=Symbol.for("react.element"),uge=Symbol.for("react.fragment"),dge=Object.prototype.hasOwnProperty,hge=lge.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,fge={key:!0,ref:!0,__self:!0,__source:!0};function WX(e,t,r){var n,s={},o=null,h=null;r!==void 0&&(o=""+r),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(h=t.ref);for(n in t)dge.call(t,n)&&!fge.hasOwnProperty(n)&&(s[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)s[n]===void 0&&(s[n]=t[n]);return{$$typeof:cge,type:e,key:o,ref:h,props:s,_owner:hge.current}}Ik.Fragment=uge;Ik.jsx=WX;Ik.jsxs=WX;LX.exports=Ik;var d=LX.exports,KX={exports:{}},Tu={},ZX={exports:{}},XX={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(_e,me){var Ae=_e.length;_e.push(me);e:for(;0<Ae;){var ge=Ae-1>>>1,pe=_e[ge];if(0<s(pe,me))_e[ge]=me,_e[Ae]=pe,Ae=ge;else break e}}function r(_e){return _e.length===0?null:_e[0]}function n(_e){if(_e.length===0)return null;var me=_e[0],Ae=_e.pop();if(Ae!==me){_e[0]=Ae;e:for(var ge=0,pe=_e.length,Oe=pe>>>1;ge<Oe;){var Je=2*(ge+1)-1,Ze=_e[Je],Pe=Je+1,Be=_e[Pe];if(0>s(Ze,Ae))Pe<pe&&0>s(Be,Ze)?(_e[ge]=Be,_e[Pe]=Ae,ge=Pe):(_e[ge]=Ze,_e[Je]=Ae,ge=Je);else if(Pe<pe&&0>s(Be,Ae))_e[ge]=Be,_e[Pe]=Ae,ge=Pe;else break e}}return me}function s(_e,me){var Ae=_e.sortIndex-me.sortIndex;return Ae!==0?Ae:_e.id-me.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var h=Date,i=h.now();e.unstable_now=function(){return h.now()-i}}var m=[],y=[],S=1,b=null,T=3,A=!1,O=!1,P=!1,I=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function F(_e){for(var me=r(y);me!==null;){if(me.callback===null)n(y);else if(me.startTime<=_e)n(y),me.sortIndex=me.expirationTime,t(m,me);else break;me=r(y)}}function z(_e){if(P=!1,F(_e),!O)if(r(m)!==null)O=!0,we($);else{var me=r(y);me!==null&&Ce(z,me.startTime-_e)}}function $(_e,me){O=!1,P&&(P=!1,R(ee),ee=-1),A=!0;var Ae=T;try{for(F(me),b=r(m);b!==null&&(!(b.expirationTime>me)||_e&&!re());){var ge=b.callback;if(typeof ge=="function"){b.callback=null,T=b.priorityLevel;var pe=ge(b.expirationTime<=me);me=e.unstable_now(),typeof pe=="function"?b.callback=pe:b===r(m)&&n(m),F(me)}else n(m);b=r(m)}if(b!==null)var Oe=!0;else{var Je=r(y);Je!==null&&Ce(z,Je.startTime-me),Oe=!1}return Oe}finally{b=null,T=Ae,A=!1}}var W=!1,K=null,ee=-1,ne=5,ie=-1;function re(){return!(e.unstable_now()-ie<ne)}function te(){if(K!==null){var _e=e.unstable_now();ie=_e;var me=!0;try{me=K(!0,_e)}finally{me?ae():(W=!1,K=null)}}else W=!1}var ae;if(typeof M=="function")ae=function(){M(te)};else if(typeof MessageChannel<"u"){var ue=new MessageChannel,be=ue.port2;ue.port1.onmessage=te,ae=function(){be.postMessage(null)}}else ae=function(){I(te,0)};function we(_e){K=_e,W||(W=!0,ae())}function Ce(_e,me){ee=I(function(){_e(e.unstable_now())},me)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(_e){_e.callback=null},e.unstable_continueExecution=function(){O||A||(O=!0,we($))},e.unstable_forceFrameRate=function(_e){0>_e||125<_e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ne=0<_e?Math.floor(1e3/_e):5},e.unstable_getCurrentPriorityLevel=function(){return T},e.unstable_getFirstCallbackNode=function(){return r(m)},e.unstable_next=function(_e){switch(T){case 1:case 2:case 3:var me=3;break;default:me=T}var Ae=T;T=me;try{return _e()}finally{T=Ae}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(_e,me){switch(_e){case 1:case 2:case 3:case 4:case 5:break;default:_e=3}var Ae=T;T=_e;try{return me()}finally{T=Ae}},e.unstable_scheduleCallback=function(_e,me,Ae){var ge=e.unstable_now();switch(typeof Ae=="object"&&Ae!==null?(Ae=Ae.delay,Ae=typeof Ae=="number"&&0<Ae?ge+Ae:ge):Ae=ge,_e){case 1:var pe=-1;break;case 2:pe=250;break;case 5:pe=1073741823;break;case 4:pe=1e4;break;default:pe=5e3}return pe=Ae+pe,_e={id:S++,callback:me,priorityLevel:_e,startTime:Ae,expirationTime:pe,sortIndex:-1},Ae>ge?(_e.sortIndex=Ae,t(y,_e),r(m)===null&&_e===r(y)&&(P?(R(ee),ee=-1):P=!0,Ce(z,Ae-ge))):(_e.sortIndex=pe,t(m,_e),O||A||(O=!0,we($))),_e},e.unstable_shouldYield=re,e.unstable_wrapCallback=function(_e){var me=T;return function(){var Ae=T;T=me;try{return _e.apply(this,arguments)}finally{T=Ae}}}})(XX);ZX.exports=XX;var pge=ZX.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mge=V,Su=pge;function Fr(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var YX=new Set,qE={};function Vv(e,t){Z0(e,t),Z0(e+"Capture",t)}function Z0(e,t){for(qE[e]=t,e=0;e<t.length;e++)YX.add(t[e])}var ep=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),NL=Object.prototype.hasOwnProperty,gge=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Sq={},Eq={};function yge(e){return NL.call(Eq,e)?!0:NL.call(Sq,e)?!1:gge.test(e)?Eq[e]=!0:(Sq[e]=!0,!1)}function vge(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function _ge(e,t,r,n){if(t===null||typeof t>"u"||vge(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function yc(e,t,r,n,s,o,h){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=s,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=h}var Cl={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Cl[e]=new yc(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Cl[t]=new yc(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Cl[e]=new yc(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Cl[e]=new yc(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Cl[e]=new yc(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Cl[e]=new yc(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Cl[e]=new yc(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Cl[e]=new yc(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Cl[e]=new yc(e,5,!1,e.toLowerCase(),null,!1,!1)});var O4=/[\-:]([a-z])/g;function k4(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(O4,k4);Cl[t]=new yc(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(O4,k4);Cl[t]=new yc(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(O4,k4);Cl[t]=new yc(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Cl[e]=new yc(e,1,!1,e.toLowerCase(),null,!1,!1)});Cl.xlinkHref=new yc("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Cl[e]=new yc(e,1,!1,e.toLowerCase(),null,!0,!0)});function N4(e,t,r,n){var s=Cl.hasOwnProperty(t)?Cl[t]:null;(s!==null?s.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(_ge(t,r,s,n)&&(r=null),n||s===null?yge(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):s.mustUseProperty?e[s.propertyName]=r===null?s.type===3?!1:"":r:(t=s.attributeName,n=s.attributeNamespace,r===null?e.removeAttribute(t):(s=s.type,r=s===3||s===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var hp=mge.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,KC=Symbol.for("react.element"),Qx=Symbol.for("react.portal"),e0=Symbol.for("react.fragment"),I4=Symbol.for("react.strict_mode"),IL=Symbol.for("react.profiler"),JX=Symbol.for("react.provider"),QX=Symbol.for("react.context"),R4=Symbol.for("react.forward_ref"),RL=Symbol.for("react.suspense"),ML=Symbol.for("react.suspense_list"),M4=Symbol.for("react.memo"),bm=Symbol.for("react.lazy"),eY=Symbol.for("react.offscreen"),Tq=Symbol.iterator;function OS(e){return e===null||typeof e!="object"?null:(e=Tq&&e[Tq]||e["@@iterator"],typeof e=="function"?e:null)}var $a=Object.assign,XM;function iE(e){if(XM===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);XM=t&&t[1]||""}return`
`+XM+e}var YM=!1;function JM(e,t){if(!e||YM)return"";YM=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(y){var n=y}Reflect.construct(e,[],t)}else{try{t.call()}catch(y){n=y}e.call(t.prototype)}else{try{throw Error()}catch(y){n=y}e()}}catch(y){if(y&&n&&typeof y.stack=="string"){for(var s=y.stack.split(`
`),o=n.stack.split(`
`),h=s.length-1,i=o.length-1;1<=h&&0<=i&&s[h]!==o[i];)i--;for(;1<=h&&0<=i;h--,i--)if(s[h]!==o[i]){if(h!==1||i!==1)do if(h--,i--,0>i||s[h]!==o[i]){var m=`
`+s[h].replace(" at new "," at ");return e.displayName&&m.includes("<anonymous>")&&(m=m.replace("<anonymous>",e.displayName)),m}while(1<=h&&0<=i);break}}}finally{YM=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?iE(e):""}function xge(e){switch(e.tag){case 5:return iE(e.type);case 16:return iE("Lazy");case 13:return iE("Suspense");case 19:return iE("SuspenseList");case 0:case 2:case 15:return e=JM(e.type,!1),e;case 11:return e=JM(e.type.render,!1),e;case 1:return e=JM(e.type,!0),e;default:return""}}function DL(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case e0:return"Fragment";case Qx:return"Portal";case IL:return"Profiler";case I4:return"StrictMode";case RL:return"Suspense";case ML:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case QX:return(e.displayName||"Context")+".Consumer";case JX:return(e._context.displayName||"Context")+".Provider";case R4:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case M4:return t=e.displayName||null,t!==null?t:DL(e.type)||"Memo";case bm:t=e._payload,e=e._init;try{return DL(e(t))}catch{}}return null}function bge(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return DL(t);case 8:return t===I4?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function ag(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function tY(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function wge(e){var t=tY(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var s=r.get,o=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(h){n=""+h,o.call(this,h)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(h){n=""+h},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function ZC(e){e._valueTracker||(e._valueTracker=wge(e))}function rY(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=tY(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function vP(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function LL(e,t){var r=t.checked;return $a({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function Aq(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=ag(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function nY(e,t){t=t.checked,t!=null&&N4(e,"checked",t,!1)}function FL(e,t){nY(e,t);var r=ag(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?zL(e,t.type,r):t.hasOwnProperty("defaultValue")&&zL(e,t.type,ag(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Cq(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function zL(e,t,r){(t!=="number"||vP(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var sE=Array.isArray;function _0(e,t,r,n){if(e=e.options,t){t={};for(var s=0;s<r.length;s++)t["$"+r[s]]=!0;for(r=0;r<e.length;r++)s=t.hasOwnProperty("$"+e[r].value),e[r].selected!==s&&(e[r].selected=s),s&&n&&(e[r].defaultSelected=!0)}else{for(r=""+ag(r),t=null,s=0;s<e.length;s++){if(e[s].value===r){e[s].selected=!0,n&&(e[s].defaultSelected=!0);return}t!==null||e[s].disabled||(t=e[s])}t!==null&&(t.selected=!0)}}function BL(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Fr(91));return $a({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function jq(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Fr(92));if(sE(r)){if(1<r.length)throw Error(Fr(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:ag(r)}}function iY(e,t){var r=ag(t.value),n=ag(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function Pq(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function sY(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function $L(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?sY(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var XC,aY=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,s){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,s)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(XC=XC||document.createElement("div"),XC.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=XC.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function HE(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var bE={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Sge=["Webkit","ms","Moz","O"];Object.keys(bE).forEach(function(e){Sge.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),bE[t]=bE[e]})});function oY(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||bE.hasOwnProperty(e)&&bE[e]?(""+t).trim():t+"px"}function lY(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,s=oY(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,s):e[r]=s}}var Ege=$a({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function UL(e,t){if(t){if(Ege[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Fr(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Fr(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Fr(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Fr(62))}}function VL(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var qL=null;function D4(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var HL=null,x0=null,b0=null;function Oq(e){if(e=y2(e)){if(typeof HL!="function")throw Error(Fr(280));var t=e.stateNode;t&&(t=Fk(t),HL(e.stateNode,e.type,t))}}function cY(e){x0?b0?b0.push(e):b0=[e]:x0=e}function uY(){if(x0){var e=x0,t=b0;if(b0=x0=null,Oq(e),t)for(e=0;e<t.length;e++)Oq(t[e])}}function dY(e,t){return e(t)}function hY(){}var QM=!1;function fY(e,t,r){if(QM)return e(t,r);QM=!0;try{return dY(e,t,r)}finally{QM=!1,(x0!==null||b0!==null)&&(hY(),uY())}}function GE(e,t){var r=e.stateNode;if(r===null)return null;var n=Fk(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Fr(231,t,typeof r));return r}var GL=!1;if(ep)try{var kS={};Object.defineProperty(kS,"passive",{get:function(){GL=!0}}),window.addEventListener("test",kS,kS),window.removeEventListener("test",kS,kS)}catch{GL=!1}function Tge(e,t,r,n,s,o,h,i,m){var y=Array.prototype.slice.call(arguments,3);try{t.apply(r,y)}catch(S){this.onError(S)}}var wE=!1,_P=null,xP=!1,WL=null,Age={onError:function(e){wE=!0,_P=e}};function Cge(e,t,r,n,s,o,h,i,m){wE=!1,_P=null,Tge.apply(Age,arguments)}function jge(e,t,r,n,s,o,h,i,m){if(Cge.apply(this,arguments),wE){if(wE){var y=_P;wE=!1,_P=null}else throw Error(Fr(198));xP||(xP=!0,WL=y)}}function qv(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function pY(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function kq(e){if(qv(e)!==e)throw Error(Fr(188))}function Pge(e){var t=e.alternate;if(!t){if(t=qv(e),t===null)throw Error(Fr(188));return t!==e?null:e}for(var r=e,n=t;;){var s=r.return;if(s===null)break;var o=s.alternate;if(o===null){if(n=s.return,n!==null){r=n;continue}break}if(s.child===o.child){for(o=s.child;o;){if(o===r)return kq(s),e;if(o===n)return kq(s),t;o=o.sibling}throw Error(Fr(188))}if(r.return!==n.return)r=s,n=o;else{for(var h=!1,i=s.child;i;){if(i===r){h=!0,r=s,n=o;break}if(i===n){h=!0,n=s,r=o;break}i=i.sibling}if(!h){for(i=o.child;i;){if(i===r){h=!0,r=o,n=s;break}if(i===n){h=!0,n=o,r=s;break}i=i.sibling}if(!h)throw Error(Fr(189))}}if(r.alternate!==n)throw Error(Fr(190))}if(r.tag!==3)throw Error(Fr(188));return r.stateNode.current===r?e:t}function mY(e){return e=Pge(e),e!==null?gY(e):null}function gY(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=gY(e);if(t!==null)return t;e=e.sibling}return null}var yY=Su.unstable_scheduleCallback,Nq=Su.unstable_cancelCallback,Oge=Su.unstable_shouldYield,kge=Su.unstable_requestPaint,go=Su.unstable_now,Nge=Su.unstable_getCurrentPriorityLevel,L4=Su.unstable_ImmediatePriority,vY=Su.unstable_UserBlockingPriority,bP=Su.unstable_NormalPriority,Ige=Su.unstable_LowPriority,_Y=Su.unstable_IdlePriority,Rk=null,Lh=null;function Rge(e){if(Lh&&typeof Lh.onCommitFiberRoot=="function")try{Lh.onCommitFiberRoot(Rk,e,void 0,(e.current.flags&128)===128)}catch{}}var Ud=Math.clz32?Math.clz32:Lge,Mge=Math.log,Dge=Math.LN2;function Lge(e){return e>>>=0,e===0?32:31-(Mge(e)/Dge|0)|0}var YC=64,JC=4194304;function aE(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function wP(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,s=e.suspendedLanes,o=e.pingedLanes,h=r&268435455;if(h!==0){var i=h&~s;i!==0?n=aE(i):(o&=h,o!==0&&(n=aE(o)))}else h=r&~s,h!==0?n=aE(h):o!==0&&(n=aE(o));if(n===0)return 0;if(t!==0&&t!==n&&!(t&s)&&(s=n&-n,o=t&-t,s>=o||s===16&&(o&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-Ud(t),s=1<<r,n|=e[r],t&=~s;return n}function Fge(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function zge(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,s=e.expirationTimes,o=e.pendingLanes;0<o;){var h=31-Ud(o),i=1<<h,m=s[h];m===-1?(!(i&r)||i&n)&&(s[h]=Fge(i,t)):m<=t&&(e.expiredLanes|=i),o&=~i}}function KL(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function xY(){var e=YC;return YC<<=1,!(YC&4194240)&&(YC=64),e}function eD(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function m2(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Ud(t),e[t]=r}function Bge(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var s=31-Ud(r),o=1<<s;t[s]=0,n[s]=-1,e[s]=-1,r&=~o}}function F4(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-Ud(r),s=1<<n;s&t|e[n]&t&&(e[n]|=t),r&=~s}}var Vs=0;function bY(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var wY,z4,SY,EY,TY,ZL=!1,QC=[],Wm=null,Km=null,Zm=null,WE=new Map,KE=new Map,Am=[],$ge="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Iq(e,t){switch(e){case"focusin":case"focusout":Wm=null;break;case"dragenter":case"dragleave":Km=null;break;case"mouseover":case"mouseout":Zm=null;break;case"pointerover":case"pointerout":WE.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":KE.delete(t.pointerId)}}function NS(e,t,r,n,s,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:o,targetContainers:[s]},t!==null&&(t=y2(t),t!==null&&z4(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,s!==null&&t.indexOf(s)===-1&&t.push(s),e)}function Uge(e,t,r,n,s){switch(t){case"focusin":return Wm=NS(Wm,e,t,r,n,s),!0;case"dragenter":return Km=NS(Km,e,t,r,n,s),!0;case"mouseover":return Zm=NS(Zm,e,t,r,n,s),!0;case"pointerover":var o=s.pointerId;return WE.set(o,NS(WE.get(o)||null,e,t,r,n,s)),!0;case"gotpointercapture":return o=s.pointerId,KE.set(o,NS(KE.get(o)||null,e,t,r,n,s)),!0}return!1}function AY(e){var t=Gy(e.target);if(t!==null){var r=qv(t);if(r!==null){if(t=r.tag,t===13){if(t=pY(r),t!==null){e.blockedOn=t,TY(e.priority,function(){SY(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Hj(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=XL(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);qL=n,r.target.dispatchEvent(n),qL=null}else return t=y2(r),t!==null&&z4(t),e.blockedOn=r,!1;t.shift()}return!0}function Rq(e,t,r){Hj(e)&&r.delete(t)}function Vge(){ZL=!1,Wm!==null&&Hj(Wm)&&(Wm=null),Km!==null&&Hj(Km)&&(Km=null),Zm!==null&&Hj(Zm)&&(Zm=null),WE.forEach(Rq),KE.forEach(Rq)}function IS(e,t){e.blockedOn===t&&(e.blockedOn=null,ZL||(ZL=!0,Su.unstable_scheduleCallback(Su.unstable_NormalPriority,Vge)))}function ZE(e){function t(s){return IS(s,e)}if(0<QC.length){IS(QC[0],e);for(var r=1;r<QC.length;r++){var n=QC[r];n.blockedOn===e&&(n.blockedOn=null)}}for(Wm!==null&&IS(Wm,e),Km!==null&&IS(Km,e),Zm!==null&&IS(Zm,e),WE.forEach(t),KE.forEach(t),r=0;r<Am.length;r++)n=Am[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<Am.length&&(r=Am[0],r.blockedOn===null);)AY(r),r.blockedOn===null&&Am.shift()}var w0=hp.ReactCurrentBatchConfig,SP=!0;function qge(e,t,r,n){var s=Vs,o=w0.transition;w0.transition=null;try{Vs=1,B4(e,t,r,n)}finally{Vs=s,w0.transition=o}}function Hge(e,t,r,n){var s=Vs,o=w0.transition;w0.transition=null;try{Vs=4,B4(e,t,r,n)}finally{Vs=s,w0.transition=o}}function B4(e,t,r,n){if(SP){var s=XL(e,t,r,n);if(s===null)uD(e,t,n,EP,r),Iq(e,n);else if(Uge(s,e,t,r,n))n.stopPropagation();else if(Iq(e,n),t&4&&-1<$ge.indexOf(e)){for(;s!==null;){var o=y2(s);if(o!==null&&wY(o),o=XL(e,t,r,n),o===null&&uD(e,t,n,EP,r),o===s)break;s=o}s!==null&&n.stopPropagation()}else uD(e,t,n,null,r)}}var EP=null;function XL(e,t,r,n){if(EP=null,e=D4(n),e=Gy(e),e!==null)if(t=qv(e),t===null)e=null;else if(r=t.tag,r===13){if(e=pY(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return EP=e,null}function CY(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Nge()){case L4:return 1;case vY:return 4;case bP:case Ige:return 16;case _Y:return 536870912;default:return 16}default:return 16}}var Um=null,$4=null,Gj=null;function jY(){if(Gj)return Gj;var e,t=$4,r=t.length,n,s="value"in Um?Um.value:Um.textContent,o=s.length;for(e=0;e<r&&t[e]===s[e];e++);var h=r-e;for(n=1;n<=h&&t[r-n]===s[o-n];n++);return Gj=s.slice(e,1<n?1-n:void 0)}function Wj(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function ej(){return!0}function Mq(){return!1}function Au(e){function t(r,n,s,o,h){this._reactName=r,this._targetInst=s,this.type=n,this.nativeEvent=o,this.target=h,this.currentTarget=null;for(var i in e)e.hasOwnProperty(i)&&(r=e[i],this[i]=r?r(o):o[i]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?ej:Mq,this.isPropagationStopped=Mq,this}return $a(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=ej)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=ej)},persist:function(){},isPersistent:ej}),t}var Zb={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},U4=Au(Zb),g2=$a({},Zb,{view:0,detail:0}),Gge=Au(g2),tD,rD,RS,Mk=$a({},g2,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:V4,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==RS&&(RS&&e.type==="mousemove"?(tD=e.screenX-RS.screenX,rD=e.screenY-RS.screenY):rD=tD=0,RS=e),tD)},movementY:function(e){return"movementY"in e?e.movementY:rD}}),Dq=Au(Mk),Wge=$a({},Mk,{dataTransfer:0}),Kge=Au(Wge),Zge=$a({},g2,{relatedTarget:0}),nD=Au(Zge),Xge=$a({},Zb,{animationName:0,elapsedTime:0,pseudoElement:0}),Yge=Au(Xge),Jge=$a({},Zb,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Qge=Au(Jge),eye=$a({},Zb,{data:0}),Lq=Au(eye),tye={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},rye={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},nye={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function iye(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=nye[e])?!!t[e]:!1}function V4(){return iye}var sye=$a({},g2,{key:function(e){if(e.key){var t=tye[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Wj(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?rye[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:V4,charCode:function(e){return e.type==="keypress"?Wj(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Wj(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),aye=Au(sye),oye=$a({},Mk,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Fq=Au(oye),lye=$a({},g2,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:V4}),cye=Au(lye),uye=$a({},Zb,{propertyName:0,elapsedTime:0,pseudoElement:0}),dye=Au(uye),hye=$a({},Mk,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),fye=Au(hye),pye=[9,13,27,32],q4=ep&&"CompositionEvent"in window,SE=null;ep&&"documentMode"in document&&(SE=document.documentMode);var mye=ep&&"TextEvent"in window&&!SE,PY=ep&&(!q4||SE&&8<SE&&11>=SE),zq=" ",Bq=!1;function OY(e,t){switch(e){case"keyup":return pye.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function kY(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var t0=!1;function gye(e,t){switch(e){case"compositionend":return kY(t);case"keypress":return t.which!==32?null:(Bq=!0,zq);case"textInput":return e=t.data,e===zq&&Bq?null:e;default:return null}}function yye(e,t){if(t0)return e==="compositionend"||!q4&&OY(e,t)?(e=jY(),Gj=$4=Um=null,t0=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return PY&&t.locale!=="ko"?null:t.data;default:return null}}var vye={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $q(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!vye[e.type]:t==="textarea"}function NY(e,t,r,n){cY(n),t=TP(t,"onChange"),0<t.length&&(r=new U4("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var EE=null,XE=null;function _ye(e){VY(e,0)}function Dk(e){var t=i0(e);if(rY(t))return e}function xye(e,t){if(e==="change")return t}var IY=!1;if(ep){var iD;if(ep){var sD="oninput"in document;if(!sD){var Uq=document.createElement("div");Uq.setAttribute("oninput","return;"),sD=typeof Uq.oninput=="function"}iD=sD}else iD=!1;IY=iD&&(!document.documentMode||9<document.documentMode)}function Vq(){EE&&(EE.detachEvent("onpropertychange",RY),XE=EE=null)}function RY(e){if(e.propertyName==="value"&&Dk(XE)){var t=[];NY(t,XE,e,D4(e)),fY(_ye,t)}}function bye(e,t,r){e==="focusin"?(Vq(),EE=t,XE=r,EE.attachEvent("onpropertychange",RY)):e==="focusout"&&Vq()}function wye(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Dk(XE)}function Sye(e,t){if(e==="click")return Dk(t)}function Eye(e,t){if(e==="input"||e==="change")return Dk(t)}function Tye(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Gd=typeof Object.is=="function"?Object.is:Tye;function YE(e,t){if(Gd(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var s=r[n];if(!NL.call(t,s)||!Gd(e[s],t[s]))return!1}return!0}function qq(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Hq(e,t){var r=qq(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=qq(r)}}function MY(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?MY(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function DY(){for(var e=window,t=vP();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=vP(e.document)}return t}function H4(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Aye(e){var t=DY(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&MY(r.ownerDocument.documentElement,r)){if(n!==null&&H4(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var s=r.textContent.length,o=Math.min(n.start,s);n=n.end===void 0?o:Math.min(n.end,s),!e.extend&&o>n&&(s=n,n=o,o=s),s=Hq(r,o);var h=Hq(r,n);s&&h&&(e.rangeCount!==1||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==h.node||e.focusOffset!==h.offset)&&(t=t.createRange(),t.setStart(s.node,s.offset),e.removeAllRanges(),o>n?(e.addRange(t),e.extend(h.node,h.offset)):(t.setEnd(h.node,h.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Cye=ep&&"documentMode"in document&&11>=document.documentMode,r0=null,YL=null,TE=null,JL=!1;function Gq(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;JL||r0==null||r0!==vP(n)||(n=r0,"selectionStart"in n&&H4(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),TE&&YE(TE,n)||(TE=n,n=TP(YL,"onSelect"),0<n.length&&(t=new U4("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=r0)))}function tj(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var n0={animationend:tj("Animation","AnimationEnd"),animationiteration:tj("Animation","AnimationIteration"),animationstart:tj("Animation","AnimationStart"),transitionend:tj("Transition","TransitionEnd")},aD={},LY={};ep&&(LY=document.createElement("div").style,"AnimationEvent"in window||(delete n0.animationend.animation,delete n0.animationiteration.animation,delete n0.animationstart.animation),"TransitionEvent"in window||delete n0.transitionend.transition);function Lk(e){if(aD[e])return aD[e];if(!n0[e])return e;var t=n0[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in LY)return aD[e]=t[r];return e}var FY=Lk("animationend"),zY=Lk("animationiteration"),BY=Lk("animationstart"),$Y=Lk("transitionend"),UY=new Map,Wq="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function mg(e,t){UY.set(e,t),Vv(t,[e])}for(var oD=0;oD<Wq.length;oD++){var lD=Wq[oD],jye=lD.toLowerCase(),Pye=lD[0].toUpperCase()+lD.slice(1);mg(jye,"on"+Pye)}mg(FY,"onAnimationEnd");mg(zY,"onAnimationIteration");mg(BY,"onAnimationStart");mg("dblclick","onDoubleClick");mg("focusin","onFocus");mg("focusout","onBlur");mg($Y,"onTransitionEnd");Z0("onMouseEnter",["mouseout","mouseover"]);Z0("onMouseLeave",["mouseout","mouseover"]);Z0("onPointerEnter",["pointerout","pointerover"]);Z0("onPointerLeave",["pointerout","pointerover"]);Vv("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Vv("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Vv("onBeforeInput",["compositionend","keypress","textInput","paste"]);Vv("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Vv("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Vv("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var oE="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Oye=new Set("cancel close invalid load scroll toggle".split(" ").concat(oE));function Kq(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,jge(n,t,void 0,e),e.currentTarget=null}function VY(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],s=n.event;n=n.listeners;e:{var o=void 0;if(t)for(var h=n.length-1;0<=h;h--){var i=n[h],m=i.instance,y=i.currentTarget;if(i=i.listener,m!==o&&s.isPropagationStopped())break e;Kq(s,i,y),o=m}else for(h=0;h<n.length;h++){if(i=n[h],m=i.instance,y=i.currentTarget,i=i.listener,m!==o&&s.isPropagationStopped())break e;Kq(s,i,y),o=m}}}if(xP)throw e=WL,xP=!1,WL=null,e}function pa(e,t){var r=t[n3];r===void 0&&(r=t[n3]=new Set);var n=e+"__bubble";r.has(n)||(qY(t,e,2,!1),r.add(n))}function cD(e,t,r){var n=0;t&&(n|=4),qY(r,e,n,t)}var rj="_reactListening"+Math.random().toString(36).slice(2);function JE(e){if(!e[rj]){e[rj]=!0,YX.forEach(function(r){r!=="selectionchange"&&(Oye.has(r)||cD(r,!1,e),cD(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[rj]||(t[rj]=!0,cD("selectionchange",!1,t))}}function qY(e,t,r,n){switch(CY(t)){case 1:var s=qge;break;case 4:s=Hge;break;default:s=B4}r=s.bind(null,t,r,e),s=void 0,!GL||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(s=!0),n?s!==void 0?e.addEventListener(t,r,{capture:!0,passive:s}):e.addEventListener(t,r,!0):s!==void 0?e.addEventListener(t,r,{passive:s}):e.addEventListener(t,r,!1)}function uD(e,t,r,n,s){var o=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var h=n.tag;if(h===3||h===4){var i=n.stateNode.containerInfo;if(i===s||i.nodeType===8&&i.parentNode===s)break;if(h===4)for(h=n.return;h!==null;){var m=h.tag;if((m===3||m===4)&&(m=h.stateNode.containerInfo,m===s||m.nodeType===8&&m.parentNode===s))return;h=h.return}for(;i!==null;){if(h=Gy(i),h===null)return;if(m=h.tag,m===5||m===6){n=o=h;continue e}i=i.parentNode}}n=n.return}fY(function(){var y=o,S=D4(r),b=[];e:{var T=UY.get(e);if(T!==void 0){var A=U4,O=e;switch(e){case"keypress":if(Wj(r)===0)break e;case"keydown":case"keyup":A=aye;break;case"focusin":O="focus",A=nD;break;case"focusout":O="blur",A=nD;break;case"beforeblur":case"afterblur":A=nD;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":A=Dq;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":A=Kge;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":A=cye;break;case FY:case zY:case BY:A=Yge;break;case $Y:A=dye;break;case"scroll":A=Gge;break;case"wheel":A=fye;break;case"copy":case"cut":case"paste":A=Qge;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":A=Fq}var P=(t&4)!==0,I=!P&&e==="scroll",R=P?T!==null?T+"Capture":null:T;P=[];for(var M=y,F;M!==null;){F=M;var z=F.stateNode;if(F.tag===5&&z!==null&&(F=z,R!==null&&(z=GE(M,R),z!=null&&P.push(QE(M,z,F)))),I)break;M=M.return}0<P.length&&(T=new A(T,O,null,r,S),b.push({event:T,listeners:P}))}}if(!(t&7)){e:{if(T=e==="mouseover"||e==="pointerover",A=e==="mouseout"||e==="pointerout",T&&r!==qL&&(O=r.relatedTarget||r.fromElement)&&(Gy(O)||O[tp]))break e;if((A||T)&&(T=S.window===S?S:(T=S.ownerDocument)?T.defaultView||T.parentWindow:window,A?(O=r.relatedTarget||r.toElement,A=y,O=O?Gy(O):null,O!==null&&(I=qv(O),O!==I||O.tag!==5&&O.tag!==6)&&(O=null)):(A=null,O=y),A!==O)){if(P=Dq,z="onMouseLeave",R="onMouseEnter",M="mouse",(e==="pointerout"||e==="pointerover")&&(P=Fq,z="onPointerLeave",R="onPointerEnter",M="pointer"),I=A==null?T:i0(A),F=O==null?T:i0(O),T=new P(z,M+"leave",A,r,S),T.target=I,T.relatedTarget=F,z=null,Gy(S)===y&&(P=new P(R,M+"enter",O,r,S),P.target=F,P.relatedTarget=I,z=P),I=z,A&&O)t:{for(P=A,R=O,M=0,F=P;F;F=kx(F))M++;for(F=0,z=R;z;z=kx(z))F++;for(;0<M-F;)P=kx(P),M--;for(;0<F-M;)R=kx(R),F--;for(;M--;){if(P===R||R!==null&&P===R.alternate)break t;P=kx(P),R=kx(R)}P=null}else P=null;A!==null&&Zq(b,T,A,P,!1),O!==null&&I!==null&&Zq(b,I,O,P,!0)}}e:{if(T=y?i0(y):window,A=T.nodeName&&T.nodeName.toLowerCase(),A==="select"||A==="input"&&T.type==="file")var $=xye;else if($q(T))if(IY)$=Eye;else{$=wye;var W=bye}else(A=T.nodeName)&&A.toLowerCase()==="input"&&(T.type==="checkbox"||T.type==="radio")&&($=Sye);if($&&($=$(e,y))){NY(b,$,r,S);break e}W&&W(e,T,y),e==="focusout"&&(W=T._wrapperState)&&W.controlled&&T.type==="number"&&zL(T,"number",T.value)}switch(W=y?i0(y):window,e){case"focusin":($q(W)||W.contentEditable==="true")&&(r0=W,YL=y,TE=null);break;case"focusout":TE=YL=r0=null;break;case"mousedown":JL=!0;break;case"contextmenu":case"mouseup":case"dragend":JL=!1,Gq(b,r,S);break;case"selectionchange":if(Cye)break;case"keydown":case"keyup":Gq(b,r,S)}var K;if(q4)e:{switch(e){case"compositionstart":var ee="onCompositionStart";break e;case"compositionend":ee="onCompositionEnd";break e;case"compositionupdate":ee="onCompositionUpdate";break e}ee=void 0}else t0?OY(e,r)&&(ee="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(ee="onCompositionStart");ee&&(PY&&r.locale!=="ko"&&(t0||ee!=="onCompositionStart"?ee==="onCompositionEnd"&&t0&&(K=jY()):(Um=S,$4="value"in Um?Um.value:Um.textContent,t0=!0)),W=TP(y,ee),0<W.length&&(ee=new Lq(ee,e,null,r,S),b.push({event:ee,listeners:W}),K?ee.data=K:(K=kY(r),K!==null&&(ee.data=K)))),(K=mye?gye(e,r):yye(e,r))&&(y=TP(y,"onBeforeInput"),0<y.length&&(S=new Lq("onBeforeInput","beforeinput",null,r,S),b.push({event:S,listeners:y}),S.data=K))}VY(b,t)})}function QE(e,t,r){return{instance:e,listener:t,currentTarget:r}}function TP(e,t){for(var r=t+"Capture",n=[];e!==null;){var s=e,o=s.stateNode;s.tag===5&&o!==null&&(s=o,o=GE(e,r),o!=null&&n.unshift(QE(e,o,s)),o=GE(e,t),o!=null&&n.push(QE(e,o,s))),e=e.return}return n}function kx(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Zq(e,t,r,n,s){for(var o=t._reactName,h=[];r!==null&&r!==n;){var i=r,m=i.alternate,y=i.stateNode;if(m!==null&&m===n)break;i.tag===5&&y!==null&&(i=y,s?(m=GE(r,o),m!=null&&h.unshift(QE(r,m,i))):s||(m=GE(r,o),m!=null&&h.push(QE(r,m,i)))),r=r.return}h.length!==0&&e.push({event:t,listeners:h})}var kye=/\r\n?/g,Nye=/\u0000|\uFFFD/g;function Xq(e){return(typeof e=="string"?e:""+e).replace(kye,`
`).replace(Nye,"")}function nj(e,t,r){if(t=Xq(t),Xq(e)!==t&&r)throw Error(Fr(425))}function AP(){}var QL=null,e3=null;function t3(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var r3=typeof setTimeout=="function"?setTimeout:void 0,Iye=typeof clearTimeout=="function"?clearTimeout:void 0,Yq=typeof Promise=="function"?Promise:void 0,Rye=typeof queueMicrotask=="function"?queueMicrotask:typeof Yq<"u"?function(e){return Yq.resolve(null).then(e).catch(Mye)}:r3;function Mye(e){setTimeout(function(){throw e})}function dD(e,t){var r=t,n=0;do{var s=r.nextSibling;if(e.removeChild(r),s&&s.nodeType===8)if(r=s.data,r==="/$"){if(n===0){e.removeChild(s),ZE(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=s}while(r);ZE(t)}function Xm(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Jq(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var Xb=Math.random().toString(36).slice(2),Th="__reactFiber$"+Xb,eT="__reactProps$"+Xb,tp="__reactContainer$"+Xb,n3="__reactEvents$"+Xb,Dye="__reactListeners$"+Xb,Lye="__reactHandles$"+Xb;function Gy(e){var t=e[Th];if(t)return t;for(var r=e.parentNode;r;){if(t=r[tp]||r[Th]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=Jq(e);e!==null;){if(r=e[Th])return r;e=Jq(e)}return t}e=r,r=e.parentNode}return null}function y2(e){return e=e[Th]||e[tp],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function i0(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Fr(33))}function Fk(e){return e[eT]||null}var i3=[],s0=-1;function gg(e){return{current:e}}function va(e){0>s0||(e.current=i3[s0],i3[s0]=null,s0--)}function oa(e,t){s0++,i3[s0]=e.current,e.current=t}var og={},$l=gg(og),Hc=gg(!1),yv=og;function X0(e,t){var r=e.type.contextTypes;if(!r)return og;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var s={},o;for(o in r)s[o]=t[o];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Gc(e){return e=e.childContextTypes,e!=null}function CP(){va(Hc),va($l)}function Qq(e,t,r){if($l.current!==og)throw Error(Fr(168));oa($l,t),oa(Hc,r)}function HY(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var s in n)if(!(s in t))throw Error(Fr(108,bge(e)||"Unknown",s));return $a({},r,n)}function jP(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||og,yv=$l.current,oa($l,e),oa(Hc,Hc.current),!0}function e9(e,t,r){var n=e.stateNode;if(!n)throw Error(Fr(169));r?(e=HY(e,t,yv),n.__reactInternalMemoizedMergedChildContext=e,va(Hc),va($l),oa($l,e)):va(Hc),oa(Hc,r)}var Df=null,zk=!1,hD=!1;function GY(e){Df===null?Df=[e]:Df.push(e)}function Fye(e){zk=!0,GY(e)}function yg(){if(!hD&&Df!==null){hD=!0;var e=0,t=Vs;try{var r=Df;for(Vs=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}Df=null,zk=!1}catch(s){throw Df!==null&&(Df=Df.slice(e+1)),yY(L4,yg),s}finally{Vs=t,hD=!1}}return null}var a0=[],o0=0,PP=null,OP=0,Bu=[],$u=0,vv=null,$f=1,Uf="";function Ry(e,t){a0[o0++]=OP,a0[o0++]=PP,PP=e,OP=t}function WY(e,t,r){Bu[$u++]=$f,Bu[$u++]=Uf,Bu[$u++]=vv,vv=e;var n=$f;e=Uf;var s=32-Ud(n)-1;n&=~(1<<s),r+=1;var o=32-Ud(t)+s;if(30<o){var h=s-s%5;o=(n&(1<<h)-1).toString(32),n>>=h,s-=h,$f=1<<32-Ud(t)+s|r<<s|n,Uf=o+e}else $f=1<<o|r<<s|n,Uf=e}function G4(e){e.return!==null&&(Ry(e,1),WY(e,1,0))}function W4(e){for(;e===PP;)PP=a0[--o0],a0[o0]=null,OP=a0[--o0],a0[o0]=null;for(;e===vv;)vv=Bu[--$u],Bu[$u]=null,Uf=Bu[--$u],Bu[$u]=null,$f=Bu[--$u],Bu[$u]=null}var vu=null,yu=null,Aa=!1,Fd=null;function KY(e,t){var r=Hu(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function t9(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,vu=e,yu=Xm(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,vu=e,yu=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=vv!==null?{id:$f,overflow:Uf}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Hu(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,vu=e,yu=null,!0):!1;default:return!1}}function s3(e){return(e.mode&1)!==0&&(e.flags&128)===0}function a3(e){if(Aa){var t=yu;if(t){var r=t;if(!t9(e,t)){if(s3(e))throw Error(Fr(418));t=Xm(r.nextSibling);var n=vu;t&&t9(e,t)?KY(n,r):(e.flags=e.flags&-4097|2,Aa=!1,vu=e)}}else{if(s3(e))throw Error(Fr(418));e.flags=e.flags&-4097|2,Aa=!1,vu=e}}}function r9(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;vu=e}function ij(e){if(e!==vu)return!1;if(!Aa)return r9(e),Aa=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!t3(e.type,e.memoizedProps)),t&&(t=yu)){if(s3(e))throw ZY(),Error(Fr(418));for(;t;)KY(e,t),t=Xm(t.nextSibling)}if(r9(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Fr(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){yu=Xm(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}yu=null}}else yu=vu?Xm(e.stateNode.nextSibling):null;return!0}function ZY(){for(var e=yu;e;)e=Xm(e.nextSibling)}function Y0(){yu=vu=null,Aa=!1}function K4(e){Fd===null?Fd=[e]:Fd.push(e)}var zye=hp.ReactCurrentBatchConfig;function MS(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Fr(309));var n=r.stateNode}if(!n)throw Error(Fr(147,e));var s=n,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(h){var i=s.refs;h===null?delete i[o]:i[o]=h},t._stringRef=o,t)}if(typeof e!="string")throw Error(Fr(284));if(!r._owner)throw Error(Fr(290,e))}return e}function sj(e,t){throw e=Object.prototype.toString.call(t),Error(Fr(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function n9(e){var t=e._init;return t(e._payload)}function XY(e){function t(R,M){if(e){var F=R.deletions;F===null?(R.deletions=[M],R.flags|=16):F.push(M)}}function r(R,M){if(!e)return null;for(;M!==null;)t(R,M),M=M.sibling;return null}function n(R,M){for(R=new Map;M!==null;)M.key!==null?R.set(M.key,M):R.set(M.index,M),M=M.sibling;return R}function s(R,M){return R=eg(R,M),R.index=0,R.sibling=null,R}function o(R,M,F){return R.index=F,e?(F=R.alternate,F!==null?(F=F.index,F<M?(R.flags|=2,M):F):(R.flags|=2,M)):(R.flags|=1048576,M)}function h(R){return e&&R.alternate===null&&(R.flags|=2),R}function i(R,M,F,z){return M===null||M.tag!==6?(M=_D(F,R.mode,z),M.return=R,M):(M=s(M,F),M.return=R,M)}function m(R,M,F,z){var $=F.type;return $===e0?S(R,M,F.props.children,z,F.key):M!==null&&(M.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===bm&&n9($)===M.type)?(z=s(M,F.props),z.ref=MS(R,M,F),z.return=R,z):(z=eP(F.type,F.key,F.props,null,R.mode,z),z.ref=MS(R,M,F),z.return=R,z)}function y(R,M,F,z){return M===null||M.tag!==4||M.stateNode.containerInfo!==F.containerInfo||M.stateNode.implementation!==F.implementation?(M=xD(F,R.mode,z),M.return=R,M):(M=s(M,F.children||[]),M.return=R,M)}function S(R,M,F,z,$){return M===null||M.tag!==7?(M=hv(F,R.mode,z,$),M.return=R,M):(M=s(M,F),M.return=R,M)}function b(R,M,F){if(typeof M=="string"&&M!==""||typeof M=="number")return M=_D(""+M,R.mode,F),M.return=R,M;if(typeof M=="object"&&M!==null){switch(M.$$typeof){case KC:return F=eP(M.type,M.key,M.props,null,R.mode,F),F.ref=MS(R,null,M),F.return=R,F;case Qx:return M=xD(M,R.mode,F),M.return=R,M;case bm:var z=M._init;return b(R,z(M._payload),F)}if(sE(M)||OS(M))return M=hv(M,R.mode,F,null),M.return=R,M;sj(R,M)}return null}function T(R,M,F,z){var $=M!==null?M.key:null;if(typeof F=="string"&&F!==""||typeof F=="number")return $!==null?null:i(R,M,""+F,z);if(typeof F=="object"&&F!==null){switch(F.$$typeof){case KC:return F.key===$?m(R,M,F,z):null;case Qx:return F.key===$?y(R,M,F,z):null;case bm:return $=F._init,T(R,M,$(F._payload),z)}if(sE(F)||OS(F))return $!==null?null:S(R,M,F,z,null);sj(R,F)}return null}function A(R,M,F,z,$){if(typeof z=="string"&&z!==""||typeof z=="number")return R=R.get(F)||null,i(M,R,""+z,$);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case KC:return R=R.get(z.key===null?F:z.key)||null,m(M,R,z,$);case Qx:return R=R.get(z.key===null?F:z.key)||null,y(M,R,z,$);case bm:var W=z._init;return A(R,M,F,W(z._payload),$)}if(sE(z)||OS(z))return R=R.get(F)||null,S(M,R,z,$,null);sj(M,z)}return null}function O(R,M,F,z){for(var $=null,W=null,K=M,ee=M=0,ne=null;K!==null&&ee<F.length;ee++){K.index>ee?(ne=K,K=null):ne=K.sibling;var ie=T(R,K,F[ee],z);if(ie===null){K===null&&(K=ne);break}e&&K&&ie.alternate===null&&t(R,K),M=o(ie,M,ee),W===null?$=ie:W.sibling=ie,W=ie,K=ne}if(ee===F.length)return r(R,K),Aa&&Ry(R,ee),$;if(K===null){for(;ee<F.length;ee++)K=b(R,F[ee],z),K!==null&&(M=o(K,M,ee),W===null?$=K:W.sibling=K,W=K);return Aa&&Ry(R,ee),$}for(K=n(R,K);ee<F.length;ee++)ne=A(K,R,ee,F[ee],z),ne!==null&&(e&&ne.alternate!==null&&K.delete(ne.key===null?ee:ne.key),M=o(ne,M,ee),W===null?$=ne:W.sibling=ne,W=ne);return e&&K.forEach(function(re){return t(R,re)}),Aa&&Ry(R,ee),$}function P(R,M,F,z){var $=OS(F);if(typeof $!="function")throw Error(Fr(150));if(F=$.call(F),F==null)throw Error(Fr(151));for(var W=$=null,K=M,ee=M=0,ne=null,ie=F.next();K!==null&&!ie.done;ee++,ie=F.next()){K.index>ee?(ne=K,K=null):ne=K.sibling;var re=T(R,K,ie.value,z);if(re===null){K===null&&(K=ne);break}e&&K&&re.alternate===null&&t(R,K),M=o(re,M,ee),W===null?$=re:W.sibling=re,W=re,K=ne}if(ie.done)return r(R,K),Aa&&Ry(R,ee),$;if(K===null){for(;!ie.done;ee++,ie=F.next())ie=b(R,ie.value,z),ie!==null&&(M=o(ie,M,ee),W===null?$=ie:W.sibling=ie,W=ie);return Aa&&Ry(R,ee),$}for(K=n(R,K);!ie.done;ee++,ie=F.next())ie=A(K,R,ee,ie.value,z),ie!==null&&(e&&ie.alternate!==null&&K.delete(ie.key===null?ee:ie.key),M=o(ie,M,ee),W===null?$=ie:W.sibling=ie,W=ie);return e&&K.forEach(function(te){return t(R,te)}),Aa&&Ry(R,ee),$}function I(R,M,F,z){if(typeof F=="object"&&F!==null&&F.type===e0&&F.key===null&&(F=F.props.children),typeof F=="object"&&F!==null){switch(F.$$typeof){case KC:e:{for(var $=F.key,W=M;W!==null;){if(W.key===$){if($=F.type,$===e0){if(W.tag===7){r(R,W.sibling),M=s(W,F.props.children),M.return=R,R=M;break e}}else if(W.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===bm&&n9($)===W.type){r(R,W.sibling),M=s(W,F.props),M.ref=MS(R,W,F),M.return=R,R=M;break e}r(R,W);break}else t(R,W);W=W.sibling}F.type===e0?(M=hv(F.props.children,R.mode,z,F.key),M.return=R,R=M):(z=eP(F.type,F.key,F.props,null,R.mode,z),z.ref=MS(R,M,F),z.return=R,R=z)}return h(R);case Qx:e:{for(W=F.key;M!==null;){if(M.key===W)if(M.tag===4&&M.stateNode.containerInfo===F.containerInfo&&M.stateNode.implementation===F.implementation){r(R,M.sibling),M=s(M,F.children||[]),M.return=R,R=M;break e}else{r(R,M);break}else t(R,M);M=M.sibling}M=xD(F,R.mode,z),M.return=R,R=M}return h(R);case bm:return W=F._init,I(R,M,W(F._payload),z)}if(sE(F))return O(R,M,F,z);if(OS(F))return P(R,M,F,z);sj(R,F)}return typeof F=="string"&&F!==""||typeof F=="number"?(F=""+F,M!==null&&M.tag===6?(r(R,M.sibling),M=s(M,F),M.return=R,R=M):(r(R,M),M=_D(F,R.mode,z),M.return=R,R=M),h(R)):r(R,M)}return I}var J0=XY(!0),YY=XY(!1),kP=gg(null),NP=null,l0=null,Z4=null;function X4(){Z4=l0=NP=null}function Y4(e){var t=kP.current;va(kP),e._currentValue=t}function o3(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function S0(e,t){NP=e,Z4=l0=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Uc=!0),e.firstContext=null)}function Xu(e){var t=e._currentValue;if(Z4!==e)if(e={context:e,memoizedValue:t,next:null},l0===null){if(NP===null)throw Error(Fr(308));l0=e,NP.dependencies={lanes:0,firstContext:e}}else l0=l0.next=e;return t}var Wy=null;function J4(e){Wy===null?Wy=[e]:Wy.push(e)}function JY(e,t,r,n){var s=t.interleaved;return s===null?(r.next=r,J4(t)):(r.next=s.next,s.next=r),t.interleaved=r,rp(e,n)}function rp(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var wm=!1;function Q4(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function QY(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Zf(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ym(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,Es&2){var s=n.pending;return s===null?t.next=t:(t.next=s.next,s.next=t),n.pending=t,rp(e,r)}return s=n.interleaved,s===null?(t.next=t,J4(n)):(t.next=s.next,s.next=t),n.interleaved=t,rp(e,r)}function Kj(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,F4(e,r)}}function i9(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var s=null,o=null;if(r=r.firstBaseUpdate,r!==null){do{var h={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};o===null?s=o=h:o=o.next=h,r=r.next}while(r!==null);o===null?s=o=t:o=o.next=t}else s=o=t;r={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:o,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function IP(e,t,r,n){var s=e.updateQueue;wm=!1;var o=s.firstBaseUpdate,h=s.lastBaseUpdate,i=s.shared.pending;if(i!==null){s.shared.pending=null;var m=i,y=m.next;m.next=null,h===null?o=y:h.next=y,h=m;var S=e.alternate;S!==null&&(S=S.updateQueue,i=S.lastBaseUpdate,i!==h&&(i===null?S.firstBaseUpdate=y:i.next=y,S.lastBaseUpdate=m))}if(o!==null){var b=s.baseState;h=0,S=y=m=null,i=o;do{var T=i.lane,A=i.eventTime;if((n&T)===T){S!==null&&(S=S.next={eventTime:A,lane:0,tag:i.tag,payload:i.payload,callback:i.callback,next:null});e:{var O=e,P=i;switch(T=t,A=r,P.tag){case 1:if(O=P.payload,typeof O=="function"){b=O.call(A,b,T);break e}b=O;break e;case 3:O.flags=O.flags&-65537|128;case 0:if(O=P.payload,T=typeof O=="function"?O.call(A,b,T):O,T==null)break e;b=$a({},b,T);break e;case 2:wm=!0}}i.callback!==null&&i.lane!==0&&(e.flags|=64,T=s.effects,T===null?s.effects=[i]:T.push(i))}else A={eventTime:A,lane:T,tag:i.tag,payload:i.payload,callback:i.callback,next:null},S===null?(y=S=A,m=b):S=S.next=A,h|=T;if(i=i.next,i===null){if(i=s.shared.pending,i===null)break;T=i,i=T.next,T.next=null,s.lastBaseUpdate=T,s.shared.pending=null}}while(!0);if(S===null&&(m=b),s.baseState=m,s.firstBaseUpdate=y,s.lastBaseUpdate=S,t=s.shared.interleaved,t!==null){s=t;do h|=s.lane,s=s.next;while(s!==t)}else o===null&&(s.shared.lanes=0);xv|=h,e.lanes=h,e.memoizedState=b}}function s9(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],s=n.callback;if(s!==null){if(n.callback=null,n=r,typeof s!="function")throw Error(Fr(191,s));s.call(n)}}}var v2={},Fh=gg(v2),tT=gg(v2),rT=gg(v2);function Ky(e){if(e===v2)throw Error(Fr(174));return e}function eB(e,t){switch(oa(rT,t),oa(tT,e),oa(Fh,v2),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:$L(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=$L(t,e)}va(Fh),oa(Fh,t)}function Q0(){va(Fh),va(tT),va(rT)}function eJ(e){Ky(rT.current);var t=Ky(Fh.current),r=$L(t,e.type);t!==r&&(oa(tT,e),oa(Fh,r))}function tB(e){tT.current===e&&(va(Fh),va(tT))}var Fa=gg(0);function RP(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var fD=[];function rB(){for(var e=0;e<fD.length;e++)fD[e]._workInProgressVersionPrimary=null;fD.length=0}var Zj=hp.ReactCurrentDispatcher,pD=hp.ReactCurrentBatchConfig,_v=0,Ba=null,Go=null,cl=null,MP=!1,AE=!1,nT=0,Bye=0;function Ml(){throw Error(Fr(321))}function nB(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Gd(e[r],t[r]))return!1;return!0}function iB(e,t,r,n,s,o){if(_v=o,Ba=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Zj.current=e===null||e.memoizedState===null?qye:Hye,e=r(n,s),AE){o=0;do{if(AE=!1,nT=0,25<=o)throw Error(Fr(301));o+=1,cl=Go=null,t.updateQueue=null,Zj.current=Gye,e=r(n,s)}while(AE)}if(Zj.current=DP,t=Go!==null&&Go.next!==null,_v=0,cl=Go=Ba=null,MP=!1,t)throw Error(Fr(300));return e}function sB(){var e=nT!==0;return nT=0,e}function _h(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return cl===null?Ba.memoizedState=cl=e:cl=cl.next=e,cl}function Yu(){if(Go===null){var e=Ba.alternate;e=e!==null?e.memoizedState:null}else e=Go.next;var t=cl===null?Ba.memoizedState:cl.next;if(t!==null)cl=t,Go=e;else{if(e===null)throw Error(Fr(310));Go=e,e={memoizedState:Go.memoizedState,baseState:Go.baseState,baseQueue:Go.baseQueue,queue:Go.queue,next:null},cl===null?Ba.memoizedState=cl=e:cl=cl.next=e}return cl}function iT(e,t){return typeof t=="function"?t(e):t}function mD(e){var t=Yu(),r=t.queue;if(r===null)throw Error(Fr(311));r.lastRenderedReducer=e;var n=Go,s=n.baseQueue,o=r.pending;if(o!==null){if(s!==null){var h=s.next;s.next=o.next,o.next=h}n.baseQueue=s=o,r.pending=null}if(s!==null){o=s.next,n=n.baseState;var i=h=null,m=null,y=o;do{var S=y.lane;if((_v&S)===S)m!==null&&(m=m.next={lane:0,action:y.action,hasEagerState:y.hasEagerState,eagerState:y.eagerState,next:null}),n=y.hasEagerState?y.eagerState:e(n,y.action);else{var b={lane:S,action:y.action,hasEagerState:y.hasEagerState,eagerState:y.eagerState,next:null};m===null?(i=m=b,h=n):m=m.next=b,Ba.lanes|=S,xv|=S}y=y.next}while(y!==null&&y!==o);m===null?h=n:m.next=i,Gd(n,t.memoizedState)||(Uc=!0),t.memoizedState=n,t.baseState=h,t.baseQueue=m,r.lastRenderedState=n}if(e=r.interleaved,e!==null){s=e;do o=s.lane,Ba.lanes|=o,xv|=o,s=s.next;while(s!==e)}else s===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function gD(e){var t=Yu(),r=t.queue;if(r===null)throw Error(Fr(311));r.lastRenderedReducer=e;var n=r.dispatch,s=r.pending,o=t.memoizedState;if(s!==null){r.pending=null;var h=s=s.next;do o=e(o,h.action),h=h.next;while(h!==s);Gd(o,t.memoizedState)||(Uc=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),r.lastRenderedState=o}return[o,n]}function tJ(){}function rJ(e,t){var r=Ba,n=Yu(),s=t(),o=!Gd(n.memoizedState,s);if(o&&(n.memoizedState=s,Uc=!0),n=n.queue,aB(sJ.bind(null,r,n,e),[e]),n.getSnapshot!==t||o||cl!==null&&cl.memoizedState.tag&1){if(r.flags|=2048,sT(9,iJ.bind(null,r,n,s,t),void 0,null),dl===null)throw Error(Fr(349));_v&30||nJ(r,t,s)}return s}function nJ(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Ba.updateQueue,t===null?(t={lastEffect:null,stores:null},Ba.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function iJ(e,t,r,n){t.value=r,t.getSnapshot=n,aJ(t)&&oJ(e)}function sJ(e,t,r){return r(function(){aJ(t)&&oJ(e)})}function aJ(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Gd(e,r)}catch{return!0}}function oJ(e){var t=rp(e,1);t!==null&&Vd(t,e,1,-1)}function a9(e){var t=_h();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:iT,lastRenderedState:e},t.queue=e,e=e.dispatch=Vye.bind(null,Ba,e),[t.memoizedState,e]}function sT(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=Ba.updateQueue,t===null?(t={lastEffect:null,stores:null},Ba.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function lJ(){return Yu().memoizedState}function Xj(e,t,r,n){var s=_h();Ba.flags|=e,s.memoizedState=sT(1|t,r,void 0,n===void 0?null:n)}function Bk(e,t,r,n){var s=Yu();n=n===void 0?null:n;var o=void 0;if(Go!==null){var h=Go.memoizedState;if(o=h.destroy,n!==null&&nB(n,h.deps)){s.memoizedState=sT(t,r,o,n);return}}Ba.flags|=e,s.memoizedState=sT(1|t,r,o,n)}function o9(e,t){return Xj(8390656,8,e,t)}function aB(e,t){return Bk(2048,8,e,t)}function cJ(e,t){return Bk(4,2,e,t)}function uJ(e,t){return Bk(4,4,e,t)}function dJ(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function hJ(e,t,r){return r=r!=null?r.concat([e]):null,Bk(4,4,dJ.bind(null,t,e),r)}function oB(){}function fJ(e,t){var r=Yu();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&nB(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function pJ(e,t){var r=Yu();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&nB(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function mJ(e,t,r){return _v&21?(Gd(r,t)||(r=xY(),Ba.lanes|=r,xv|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Uc=!0),e.memoizedState=r)}function $ye(e,t){var r=Vs;Vs=r!==0&&4>r?r:4,e(!0);var n=pD.transition;pD.transition={};try{e(!1),t()}finally{Vs=r,pD.transition=n}}function gJ(){return Yu().memoizedState}function Uye(e,t,r){var n=Qm(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},yJ(e))vJ(t,r);else if(r=JY(e,t,r,n),r!==null){var s=mc();Vd(r,e,n,s),_J(r,t,n)}}function Vye(e,t,r){var n=Qm(e),s={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(yJ(e))vJ(t,s);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var h=t.lastRenderedState,i=o(h,r);if(s.hasEagerState=!0,s.eagerState=i,Gd(i,h)){var m=t.interleaved;m===null?(s.next=s,J4(t)):(s.next=m.next,m.next=s),t.interleaved=s;return}}catch{}finally{}r=JY(e,t,s,n),r!==null&&(s=mc(),Vd(r,e,n,s),_J(r,t,n))}}function yJ(e){var t=e.alternate;return e===Ba||t!==null&&t===Ba}function vJ(e,t){AE=MP=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function _J(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,F4(e,r)}}var DP={readContext:Xu,useCallback:Ml,useContext:Ml,useEffect:Ml,useImperativeHandle:Ml,useInsertionEffect:Ml,useLayoutEffect:Ml,useMemo:Ml,useReducer:Ml,useRef:Ml,useState:Ml,useDebugValue:Ml,useDeferredValue:Ml,useTransition:Ml,useMutableSource:Ml,useSyncExternalStore:Ml,useId:Ml,unstable_isNewReconciler:!1},qye={readContext:Xu,useCallback:function(e,t){return _h().memoizedState=[e,t===void 0?null:t],e},useContext:Xu,useEffect:o9,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,Xj(4194308,4,dJ.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Xj(4194308,4,e,t)},useInsertionEffect:function(e,t){return Xj(4,2,e,t)},useMemo:function(e,t){var r=_h();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=_h();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=Uye.bind(null,Ba,e),[n.memoizedState,e]},useRef:function(e){var t=_h();return e={current:e},t.memoizedState=e},useState:a9,useDebugValue:oB,useDeferredValue:function(e){return _h().memoizedState=e},useTransition:function(){var e=a9(!1),t=e[0];return e=$ye.bind(null,e[1]),_h().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=Ba,s=_h();if(Aa){if(r===void 0)throw Error(Fr(407));r=r()}else{if(r=t(),dl===null)throw Error(Fr(349));_v&30||nJ(n,t,r)}s.memoizedState=r;var o={value:r,getSnapshot:t};return s.queue=o,o9(sJ.bind(null,n,o,e),[e]),n.flags|=2048,sT(9,iJ.bind(null,n,o,r,t),void 0,null),r},useId:function(){var e=_h(),t=dl.identifierPrefix;if(Aa){var r=Uf,n=$f;r=(n&~(1<<32-Ud(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=nT++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=Bye++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Hye={readContext:Xu,useCallback:fJ,useContext:Xu,useEffect:aB,useImperativeHandle:hJ,useInsertionEffect:cJ,useLayoutEffect:uJ,useMemo:pJ,useReducer:mD,useRef:lJ,useState:function(){return mD(iT)},useDebugValue:oB,useDeferredValue:function(e){var t=Yu();return mJ(t,Go.memoizedState,e)},useTransition:function(){var e=mD(iT)[0],t=Yu().memoizedState;return[e,t]},useMutableSource:tJ,useSyncExternalStore:rJ,useId:gJ,unstable_isNewReconciler:!1},Gye={readContext:Xu,useCallback:fJ,useContext:Xu,useEffect:aB,useImperativeHandle:hJ,useInsertionEffect:cJ,useLayoutEffect:uJ,useMemo:pJ,useReducer:gD,useRef:lJ,useState:function(){return gD(iT)},useDebugValue:oB,useDeferredValue:function(e){var t=Yu();return Go===null?t.memoizedState=e:mJ(t,Go.memoizedState,e)},useTransition:function(){var e=gD(iT)[0],t=Yu().memoizedState;return[e,t]},useMutableSource:tJ,useSyncExternalStore:rJ,useId:gJ,unstable_isNewReconciler:!1};function Od(e,t){if(e&&e.defaultProps){t=$a({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function l3(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:$a({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var $k={isMounted:function(e){return(e=e._reactInternals)?qv(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=mc(),s=Qm(e),o=Zf(n,s);o.payload=t,r!=null&&(o.callback=r),t=Ym(e,o,s),t!==null&&(Vd(t,e,s,n),Kj(t,e,s))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=mc(),s=Qm(e),o=Zf(n,s);o.tag=1,o.payload=t,r!=null&&(o.callback=r),t=Ym(e,o,s),t!==null&&(Vd(t,e,s,n),Kj(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=mc(),n=Qm(e),s=Zf(r,n);s.tag=2,t!=null&&(s.callback=t),t=Ym(e,s,n),t!==null&&(Vd(t,e,n,r),Kj(t,e,n))}};function l9(e,t,r,n,s,o,h){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,o,h):t.prototype&&t.prototype.isPureReactComponent?!YE(r,n)||!YE(s,o):!0}function xJ(e,t,r){var n=!1,s=og,o=t.contextType;return typeof o=="object"&&o!==null?o=Xu(o):(s=Gc(t)?yv:$l.current,n=t.contextTypes,o=(n=n!=null)?X0(e,s):og),t=new t(r,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=$k,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=o),t}function c9(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&$k.enqueueReplaceState(t,t.state,null)}function c3(e,t,r,n){var s=e.stateNode;s.props=r,s.state=e.memoizedState,s.refs={},Q4(e);var o=t.contextType;typeof o=="object"&&o!==null?s.context=Xu(o):(o=Gc(t)?yv:$l.current,s.context=X0(e,o)),s.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(l3(e,t,o,r),s.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(t=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),t!==s.state&&$k.enqueueReplaceState(s,s.state,null),IP(e,r,s,n),s.state=e.memoizedState),typeof s.componentDidMount=="function"&&(e.flags|=4194308)}function eb(e,t){try{var r="",n=t;do r+=xge(n),n=n.return;while(n);var s=r}catch(o){s=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:s,digest:null}}function yD(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function u3(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var Wye=typeof WeakMap=="function"?WeakMap:Map;function bJ(e,t,r){r=Zf(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){FP||(FP=!0,x3=n),u3(e,t)},r}function wJ(e,t,r){r=Zf(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var s=t.value;r.payload=function(){return n(s)},r.callback=function(){u3(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(r.callback=function(){u3(e,t),typeof n!="function"&&(Jm===null?Jm=new Set([this]):Jm.add(this));var h=t.stack;this.componentDidCatch(t.value,{componentStack:h!==null?h:""})}),r}function u9(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new Wye;var s=new Set;n.set(t,s)}else s=n.get(t),s===void 0&&(s=new Set,n.set(t,s));s.has(r)||(s.add(r),e=ove.bind(null,e,t,r),t.then(e,e))}function d9(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function h9(e,t,r,n,s){return e.mode&1?(e.flags|=65536,e.lanes=s,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Zf(-1,1),t.tag=2,Ym(r,t,1))),r.lanes|=1),e)}var Kye=hp.ReactCurrentOwner,Uc=!1;function oc(e,t,r,n){t.child=e===null?YY(t,null,r,n):J0(t,e.child,r,n)}function f9(e,t,r,n,s){r=r.render;var o=t.ref;return S0(t,s),n=iB(e,t,r,n,o,s),r=sB(),e!==null&&!Uc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,np(e,t,s)):(Aa&&r&&G4(t),t.flags|=1,oc(e,t,n,s),t.child)}function p9(e,t,r,n,s){if(e===null){var o=r.type;return typeof o=="function"&&!mB(o)&&o.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=o,SJ(e,t,o,n,s)):(e=eP(r.type,null,n,t,t.mode,s),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&s)){var h=o.memoizedProps;if(r=r.compare,r=r!==null?r:YE,r(h,n)&&e.ref===t.ref)return np(e,t,s)}return t.flags|=1,e=eg(o,n),e.ref=t.ref,e.return=t,t.child=e}function SJ(e,t,r,n,s){if(e!==null){var o=e.memoizedProps;if(YE(o,n)&&e.ref===t.ref)if(Uc=!1,t.pendingProps=n=o,(e.lanes&s)!==0)e.flags&131072&&(Uc=!0);else return t.lanes=e.lanes,np(e,t,s)}return d3(e,t,r,n,s)}function EJ(e,t,r){var n=t.pendingProps,s=n.children,o=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},oa(u0,cu),cu|=r;else{if(!(r&1073741824))return e=o!==null?o.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,oa(u0,cu),cu|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=o!==null?o.baseLanes:r,oa(u0,cu),cu|=n}else o!==null?(n=o.baseLanes|r,t.memoizedState=null):n=r,oa(u0,cu),cu|=n;return oc(e,t,s,r),t.child}function TJ(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function d3(e,t,r,n,s){var o=Gc(r)?yv:$l.current;return o=X0(t,o),S0(t,s),r=iB(e,t,r,n,o,s),n=sB(),e!==null&&!Uc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,np(e,t,s)):(Aa&&n&&G4(t),t.flags|=1,oc(e,t,r,s),t.child)}function m9(e,t,r,n,s){if(Gc(r)){var o=!0;jP(t)}else o=!1;if(S0(t,s),t.stateNode===null)Yj(e,t),xJ(t,r,n),c3(t,r,n,s),n=!0;else if(e===null){var h=t.stateNode,i=t.memoizedProps;h.props=i;var m=h.context,y=r.contextType;typeof y=="object"&&y!==null?y=Xu(y):(y=Gc(r)?yv:$l.current,y=X0(t,y));var S=r.getDerivedStateFromProps,b=typeof S=="function"||typeof h.getSnapshotBeforeUpdate=="function";b||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(i!==n||m!==y)&&c9(t,h,n,y),wm=!1;var T=t.memoizedState;h.state=T,IP(t,n,h,s),m=t.memoizedState,i!==n||T!==m||Hc.current||wm?(typeof S=="function"&&(l3(t,r,S,n),m=t.memoizedState),(i=wm||l9(t,r,i,n,T,m,y))?(b||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount()),typeof h.componentDidMount=="function"&&(t.flags|=4194308)):(typeof h.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=m),h.props=n,h.state=m,h.context=y,n=i):(typeof h.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{h=t.stateNode,QY(e,t),i=t.memoizedProps,y=t.type===t.elementType?i:Od(t.type,i),h.props=y,b=t.pendingProps,T=h.context,m=r.contextType,typeof m=="object"&&m!==null?m=Xu(m):(m=Gc(r)?yv:$l.current,m=X0(t,m));var A=r.getDerivedStateFromProps;(S=typeof A=="function"||typeof h.getSnapshotBeforeUpdate=="function")||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(i!==b||T!==m)&&c9(t,h,n,m),wm=!1,T=t.memoizedState,h.state=T,IP(t,n,h,s);var O=t.memoizedState;i!==b||T!==O||Hc.current||wm?(typeof A=="function"&&(l3(t,r,A,n),O=t.memoizedState),(y=wm||l9(t,r,y,n,T,O,m)||!1)?(S||typeof h.UNSAFE_componentWillUpdate!="function"&&typeof h.componentWillUpdate!="function"||(typeof h.componentWillUpdate=="function"&&h.componentWillUpdate(n,O,m),typeof h.UNSAFE_componentWillUpdate=="function"&&h.UNSAFE_componentWillUpdate(n,O,m)),typeof h.componentDidUpdate=="function"&&(t.flags|=4),typeof h.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof h.componentDidUpdate!="function"||i===e.memoizedProps&&T===e.memoizedState||(t.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&T===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=O),h.props=n,h.state=O,h.context=m,n=y):(typeof h.componentDidUpdate!="function"||i===e.memoizedProps&&T===e.memoizedState||(t.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&T===e.memoizedState||(t.flags|=1024),n=!1)}return h3(e,t,r,n,o,s)}function h3(e,t,r,n,s,o){TJ(e,t);var h=(t.flags&128)!==0;if(!n&&!h)return s&&e9(t,r,!1),np(e,t,o);n=t.stateNode,Kye.current=t;var i=h&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&h?(t.child=J0(t,e.child,null,o),t.child=J0(t,null,i,o)):oc(e,t,i,o),t.memoizedState=n.state,s&&e9(t,r,!0),t.child}function AJ(e){var t=e.stateNode;t.pendingContext?Qq(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Qq(e,t.context,!1),eB(e,t.containerInfo)}function g9(e,t,r,n,s){return Y0(),K4(s),t.flags|=256,oc(e,t,r,n),t.child}var f3={dehydrated:null,treeContext:null,retryLane:0};function p3(e){return{baseLanes:e,cachePool:null,transitions:null}}function CJ(e,t,r){var n=t.pendingProps,s=Fa.current,o=!1,h=(t.flags&128)!==0,i;if((i=h)||(i=e!==null&&e.memoizedState===null?!1:(s&2)!==0),i?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(s|=1),oa(Fa,s&1),e===null)return a3(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(h=n.children,e=n.fallback,o?(n=t.mode,o=t.child,h={mode:"hidden",children:h},!(n&1)&&o!==null?(o.childLanes=0,o.pendingProps=h):o=qk(h,n,0,null),e=hv(e,n,r,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=p3(r),t.memoizedState=f3,e):lB(t,h));if(s=e.memoizedState,s!==null&&(i=s.dehydrated,i!==null))return Zye(e,t,h,n,i,s,r);if(o){o=n.fallback,h=t.mode,s=e.child,i=s.sibling;var m={mode:"hidden",children:n.children};return!(h&1)&&t.child!==s?(n=t.child,n.childLanes=0,n.pendingProps=m,t.deletions=null):(n=eg(s,m),n.subtreeFlags=s.subtreeFlags&14680064),i!==null?o=eg(i,o):(o=hv(o,h,r,null),o.flags|=2),o.return=t,n.return=t,n.sibling=o,t.child=n,n=o,o=t.child,h=e.child.memoizedState,h=h===null?p3(r):{baseLanes:h.baseLanes|r,cachePool:null,transitions:h.transitions},o.memoizedState=h,o.childLanes=e.childLanes&~r,t.memoizedState=f3,n}return o=e.child,e=o.sibling,n=eg(o,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function lB(e,t){return t=qk({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function aj(e,t,r,n){return n!==null&&K4(n),J0(t,e.child,null,r),e=lB(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Zye(e,t,r,n,s,o,h){if(r)return t.flags&256?(t.flags&=-257,n=yD(Error(Fr(422))),aj(e,t,h,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=n.fallback,s=t.mode,n=qk({mode:"visible",children:n.children},s,0,null),o=hv(o,s,h,null),o.flags|=2,n.return=t,o.return=t,n.sibling=o,t.child=n,t.mode&1&&J0(t,e.child,null,h),t.child.memoizedState=p3(h),t.memoizedState=f3,o);if(!(t.mode&1))return aj(e,t,h,null);if(s.data==="$!"){if(n=s.nextSibling&&s.nextSibling.dataset,n)var i=n.dgst;return n=i,o=Error(Fr(419)),n=yD(o,n,void 0),aj(e,t,h,n)}if(i=(h&e.childLanes)!==0,Uc||i){if(n=dl,n!==null){switch(h&-h){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(n.suspendedLanes|h)?0:s,s!==0&&s!==o.retryLane&&(o.retryLane=s,rp(e,s),Vd(n,e,s,-1))}return pB(),n=yD(Error(Fr(421))),aj(e,t,h,n)}return s.data==="$?"?(t.flags|=128,t.child=e.child,t=lve.bind(null,e),s._reactRetry=t,null):(e=o.treeContext,yu=Xm(s.nextSibling),vu=t,Aa=!0,Fd=null,e!==null&&(Bu[$u++]=$f,Bu[$u++]=Uf,Bu[$u++]=vv,$f=e.id,Uf=e.overflow,vv=t),t=lB(t,n.children),t.flags|=4096,t)}function y9(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),o3(e.return,t,r)}function vD(e,t,r,n,s){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:s}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=r,o.tailMode=s)}function jJ(e,t,r){var n=t.pendingProps,s=n.revealOrder,o=n.tail;if(oc(e,t,n.children,r),n=Fa.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&y9(e,r,t);else if(e.tag===19)y9(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(oa(Fa,n),!(t.mode&1))t.memoizedState=null;else switch(s){case"forwards":for(r=t.child,s=null;r!==null;)e=r.alternate,e!==null&&RP(e)===null&&(s=r),r=r.sibling;r=s,r===null?(s=t.child,t.child=null):(s=r.sibling,r.sibling=null),vD(t,!1,s,r,o);break;case"backwards":for(r=null,s=t.child,t.child=null;s!==null;){if(e=s.alternate,e!==null&&RP(e)===null){t.child=s;break}e=s.sibling,s.sibling=r,r=s,s=e}vD(t,!0,r,null,o);break;case"together":vD(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Yj(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function np(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),xv|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Fr(153));if(t.child!==null){for(e=t.child,r=eg(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=eg(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function Xye(e,t,r){switch(t.tag){case 3:AJ(t),Y0();break;case 5:eJ(t);break;case 1:Gc(t.type)&&jP(t);break;case 4:eB(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,s=t.memoizedProps.value;oa(kP,n._currentValue),n._currentValue=s;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(oa(Fa,Fa.current&1),t.flags|=128,null):r&t.child.childLanes?CJ(e,t,r):(oa(Fa,Fa.current&1),e=np(e,t,r),e!==null?e.sibling:null);oa(Fa,Fa.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return jJ(e,t,r);t.flags|=128}if(s=t.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),oa(Fa,Fa.current),n)break;return null;case 22:case 23:return t.lanes=0,EJ(e,t,r)}return np(e,t,r)}var PJ,m3,OJ,kJ;PJ=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};m3=function(){};OJ=function(e,t,r,n){var s=e.memoizedProps;if(s!==n){e=t.stateNode,Ky(Fh.current);var o=null;switch(r){case"input":s=LL(e,s),n=LL(e,n),o=[];break;case"select":s=$a({},s,{value:void 0}),n=$a({},n,{value:void 0}),o=[];break;case"textarea":s=BL(e,s),n=BL(e,n),o=[];break;default:typeof s.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=AP)}UL(r,n);var h;r=null;for(y in s)if(!n.hasOwnProperty(y)&&s.hasOwnProperty(y)&&s[y]!=null)if(y==="style"){var i=s[y];for(h in i)i.hasOwnProperty(h)&&(r||(r={}),r[h]="")}else y!=="dangerouslySetInnerHTML"&&y!=="children"&&y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(qE.hasOwnProperty(y)?o||(o=[]):(o=o||[]).push(y,null));for(y in n){var m=n[y];if(i=s!=null?s[y]:void 0,n.hasOwnProperty(y)&&m!==i&&(m!=null||i!=null))if(y==="style")if(i){for(h in i)!i.hasOwnProperty(h)||m&&m.hasOwnProperty(h)||(r||(r={}),r[h]="");for(h in m)m.hasOwnProperty(h)&&i[h]!==m[h]&&(r||(r={}),r[h]=m[h])}else r||(o||(o=[]),o.push(y,r)),r=m;else y==="dangerouslySetInnerHTML"?(m=m?m.__html:void 0,i=i?i.__html:void 0,m!=null&&i!==m&&(o=o||[]).push(y,m)):y==="children"?typeof m!="string"&&typeof m!="number"||(o=o||[]).push(y,""+m):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&(qE.hasOwnProperty(y)?(m!=null&&y==="onScroll"&&pa("scroll",e),o||i===m||(o=[])):(o=o||[]).push(y,m))}r&&(o=o||[]).push("style",r);var y=o;(t.updateQueue=y)&&(t.flags|=4)}};kJ=function(e,t,r,n){r!==n&&(t.flags|=4)};function DS(e,t){if(!Aa)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Dl(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var s=e.child;s!==null;)r|=s.lanes|s.childLanes,n|=s.subtreeFlags&14680064,n|=s.flags&14680064,s.return=e,s=s.sibling;else for(s=e.child;s!==null;)r|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function Yye(e,t,r){var n=t.pendingProps;switch(W4(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Dl(t),null;case 1:return Gc(t.type)&&CP(),Dl(t),null;case 3:return n=t.stateNode,Q0(),va(Hc),va($l),rB(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(ij(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Fd!==null&&(S3(Fd),Fd=null))),m3(e,t),Dl(t),null;case 5:tB(t);var s=Ky(rT.current);if(r=t.type,e!==null&&t.stateNode!=null)OJ(e,t,r,n,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(Fr(166));return Dl(t),null}if(e=Ky(Fh.current),ij(t)){n=t.stateNode,r=t.type;var o=t.memoizedProps;switch(n[Th]=t,n[eT]=o,e=(t.mode&1)!==0,r){case"dialog":pa("cancel",n),pa("close",n);break;case"iframe":case"object":case"embed":pa("load",n);break;case"video":case"audio":for(s=0;s<oE.length;s++)pa(oE[s],n);break;case"source":pa("error",n);break;case"img":case"image":case"link":pa("error",n),pa("load",n);break;case"details":pa("toggle",n);break;case"input":Aq(n,o),pa("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!o.multiple},pa("invalid",n);break;case"textarea":jq(n,o),pa("invalid",n)}UL(r,o),s=null;for(var h in o)if(o.hasOwnProperty(h)){var i=o[h];h==="children"?typeof i=="string"?n.textContent!==i&&(o.suppressHydrationWarning!==!0&&nj(n.textContent,i,e),s=["children",i]):typeof i=="number"&&n.textContent!==""+i&&(o.suppressHydrationWarning!==!0&&nj(n.textContent,i,e),s=["children",""+i]):qE.hasOwnProperty(h)&&i!=null&&h==="onScroll"&&pa("scroll",n)}switch(r){case"input":ZC(n),Cq(n,o,!0);break;case"textarea":ZC(n),Pq(n);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(n.onclick=AP)}n=s,t.updateQueue=n,n!==null&&(t.flags|=4)}else{h=s.nodeType===9?s:s.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=sY(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=h.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=h.createElement(r,{is:n.is}):(e=h.createElement(r),r==="select"&&(h=e,n.multiple?h.multiple=!0:n.size&&(h.size=n.size))):e=h.createElementNS(e,r),e[Th]=t,e[eT]=n,PJ(e,t,!1,!1),t.stateNode=e;e:{switch(h=VL(r,n),r){case"dialog":pa("cancel",e),pa("close",e),s=n;break;case"iframe":case"object":case"embed":pa("load",e),s=n;break;case"video":case"audio":for(s=0;s<oE.length;s++)pa(oE[s],e);s=n;break;case"source":pa("error",e),s=n;break;case"img":case"image":case"link":pa("error",e),pa("load",e),s=n;break;case"details":pa("toggle",e),s=n;break;case"input":Aq(e,n),s=LL(e,n),pa("invalid",e);break;case"option":s=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},s=$a({},n,{value:void 0}),pa("invalid",e);break;case"textarea":jq(e,n),s=BL(e,n),pa("invalid",e);break;default:s=n}UL(r,s),i=s;for(o in i)if(i.hasOwnProperty(o)){var m=i[o];o==="style"?lY(e,m):o==="dangerouslySetInnerHTML"?(m=m?m.__html:void 0,m!=null&&aY(e,m)):o==="children"?typeof m=="string"?(r!=="textarea"||m!=="")&&HE(e,m):typeof m=="number"&&HE(e,""+m):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(qE.hasOwnProperty(o)?m!=null&&o==="onScroll"&&pa("scroll",e):m!=null&&N4(e,o,m,h))}switch(r){case"input":ZC(e),Cq(e,n,!1);break;case"textarea":ZC(e),Pq(e);break;case"option":n.value!=null&&e.setAttribute("value",""+ag(n.value));break;case"select":e.multiple=!!n.multiple,o=n.value,o!=null?_0(e,!!n.multiple,o,!1):n.defaultValue!=null&&_0(e,!!n.multiple,n.defaultValue,!0);break;default:typeof s.onClick=="function"&&(e.onclick=AP)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Dl(t),null;case 6:if(e&&t.stateNode!=null)kJ(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(Fr(166));if(r=Ky(rT.current),Ky(Fh.current),ij(t)){if(n=t.stateNode,r=t.memoizedProps,n[Th]=t,(o=n.nodeValue!==r)&&(e=vu,e!==null))switch(e.tag){case 3:nj(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&nj(n.nodeValue,r,(e.mode&1)!==0)}o&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[Th]=t,t.stateNode=n}return Dl(t),null;case 13:if(va(Fa),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Aa&&yu!==null&&t.mode&1&&!(t.flags&128))ZY(),Y0(),t.flags|=98560,o=!1;else if(o=ij(t),n!==null&&n.dehydrated!==null){if(e===null){if(!o)throw Error(Fr(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Fr(317));o[Th]=t}else Y0(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Dl(t),o=!1}else Fd!==null&&(S3(Fd),Fd=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||Fa.current&1?Zo===0&&(Zo=3):pB())),t.updateQueue!==null&&(t.flags|=4),Dl(t),null);case 4:return Q0(),m3(e,t),e===null&&JE(t.stateNode.containerInfo),Dl(t),null;case 10:return Y4(t.type._context),Dl(t),null;case 17:return Gc(t.type)&&CP(),Dl(t),null;case 19:if(va(Fa),o=t.memoizedState,o===null)return Dl(t),null;if(n=(t.flags&128)!==0,h=o.rendering,h===null)if(n)DS(o,!1);else{if(Zo!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(h=RP(e),h!==null){for(t.flags|=128,DS(o,!1),n=h.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)o=r,e=n,o.flags&=14680066,h=o.alternate,h===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=h.childLanes,o.lanes=h.lanes,o.child=h.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=h.memoizedProps,o.memoizedState=h.memoizedState,o.updateQueue=h.updateQueue,o.type=h.type,e=h.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return oa(Fa,Fa.current&1|2),t.child}e=e.sibling}o.tail!==null&&go()>tb&&(t.flags|=128,n=!0,DS(o,!1),t.lanes=4194304)}else{if(!n)if(e=RP(h),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),DS(o,!0),o.tail===null&&o.tailMode==="hidden"&&!h.alternate&&!Aa)return Dl(t),null}else 2*go()-o.renderingStartTime>tb&&r!==1073741824&&(t.flags|=128,n=!0,DS(o,!1),t.lanes=4194304);o.isBackwards?(h.sibling=t.child,t.child=h):(r=o.last,r!==null?r.sibling=h:t.child=h,o.last=h)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=go(),t.sibling=null,r=Fa.current,oa(Fa,n?r&1|2:r&1),t):(Dl(t),null);case 22:case 23:return fB(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?cu&1073741824&&(Dl(t),t.subtreeFlags&6&&(t.flags|=8192)):Dl(t),null;case 24:return null;case 25:return null}throw Error(Fr(156,t.tag))}function Jye(e,t){switch(W4(t),t.tag){case 1:return Gc(t.type)&&CP(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Q0(),va(Hc),va($l),rB(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return tB(t),null;case 13:if(va(Fa),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Fr(340));Y0()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return va(Fa),null;case 4:return Q0(),null;case 10:return Y4(t.type._context),null;case 22:case 23:return fB(),null;case 24:return null;default:return null}}var oj=!1,zl=!1,Qye=typeof WeakSet=="function"?WeakSet:Set,En=null;function c0(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){eo(e,t,n)}else r.current=null}function g3(e,t,r){try{r()}catch(n){eo(e,t,n)}}var v9=!1;function eve(e,t){if(QL=SP,e=DY(),H4(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var s=n.anchorOffset,o=n.focusNode;n=n.focusOffset;try{r.nodeType,o.nodeType}catch{r=null;break e}var h=0,i=-1,m=-1,y=0,S=0,b=e,T=null;t:for(;;){for(var A;b!==r||s!==0&&b.nodeType!==3||(i=h+s),b!==o||n!==0&&b.nodeType!==3||(m=h+n),b.nodeType===3&&(h+=b.nodeValue.length),(A=b.firstChild)!==null;)T=b,b=A;for(;;){if(b===e)break t;if(T===r&&++y===s&&(i=h),T===o&&++S===n&&(m=h),(A=b.nextSibling)!==null)break;b=T,T=b.parentNode}b=A}r=i===-1||m===-1?null:{start:i,end:m}}else r=null}r=r||{start:0,end:0}}else r=null;for(e3={focusedElem:e,selectionRange:r},SP=!1,En=t;En!==null;)if(t=En,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,En=e;else for(;En!==null;){t=En;try{var O=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(O!==null){var P=O.memoizedProps,I=O.memoizedState,R=t.stateNode,M=R.getSnapshotBeforeUpdate(t.elementType===t.type?P:Od(t.type,P),I);R.__reactInternalSnapshotBeforeUpdate=M}break;case 3:var F=t.stateNode.containerInfo;F.nodeType===1?F.textContent="":F.nodeType===9&&F.documentElement&&F.removeChild(F.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Fr(163))}}catch(z){eo(t,t.return,z)}if(e=t.sibling,e!==null){e.return=t.return,En=e;break}En=t.return}return O=v9,v9=!1,O}function CE(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var s=n=n.next;do{if((s.tag&e)===e){var o=s.destroy;s.destroy=void 0,o!==void 0&&g3(t,r,o)}s=s.next}while(s!==n)}}function Uk(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function y3(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function NJ(e){var t=e.alternate;t!==null&&(e.alternate=null,NJ(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Th],delete t[eT],delete t[n3],delete t[Dye],delete t[Lye])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function IJ(e){return e.tag===5||e.tag===3||e.tag===4}function _9(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||IJ(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function v3(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=AP));else if(n!==4&&(e=e.child,e!==null))for(v3(e,t,r),e=e.sibling;e!==null;)v3(e,t,r),e=e.sibling}function _3(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(_3(e,t,r),e=e.sibling;e!==null;)_3(e,t,r),e=e.sibling}var wl=null,Rd=!1;function um(e,t,r){for(r=r.child;r!==null;)RJ(e,t,r),r=r.sibling}function RJ(e,t,r){if(Lh&&typeof Lh.onCommitFiberUnmount=="function")try{Lh.onCommitFiberUnmount(Rk,r)}catch{}switch(r.tag){case 5:zl||c0(r,t);case 6:var n=wl,s=Rd;wl=null,um(e,t,r),wl=n,Rd=s,wl!==null&&(Rd?(e=wl,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):wl.removeChild(r.stateNode));break;case 18:wl!==null&&(Rd?(e=wl,r=r.stateNode,e.nodeType===8?dD(e.parentNode,r):e.nodeType===1&&dD(e,r),ZE(e)):dD(wl,r.stateNode));break;case 4:n=wl,s=Rd,wl=r.stateNode.containerInfo,Rd=!0,um(e,t,r),wl=n,Rd=s;break;case 0:case 11:case 14:case 15:if(!zl&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){s=n=n.next;do{var o=s,h=o.destroy;o=o.tag,h!==void 0&&(o&2||o&4)&&g3(r,t,h),s=s.next}while(s!==n)}um(e,t,r);break;case 1:if(!zl&&(c0(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(i){eo(r,t,i)}um(e,t,r);break;case 21:um(e,t,r);break;case 22:r.mode&1?(zl=(n=zl)||r.memoizedState!==null,um(e,t,r),zl=n):um(e,t,r);break;default:um(e,t,r)}}function x9(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new Qye),t.forEach(function(n){var s=cve.bind(null,e,n);r.has(n)||(r.add(n),n.then(s,s))})}}function Ed(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var s=r[n];try{var o=e,h=t,i=h;e:for(;i!==null;){switch(i.tag){case 5:wl=i.stateNode,Rd=!1;break e;case 3:wl=i.stateNode.containerInfo,Rd=!0;break e;case 4:wl=i.stateNode.containerInfo,Rd=!0;break e}i=i.return}if(wl===null)throw Error(Fr(160));RJ(o,h,s),wl=null,Rd=!1;var m=s.alternate;m!==null&&(m.return=null),s.return=null}catch(y){eo(s,t,y)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)MJ(t,e),t=t.sibling}function MJ(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Ed(t,e),yh(e),n&4){try{CE(3,e,e.return),Uk(3,e)}catch(P){eo(e,e.return,P)}try{CE(5,e,e.return)}catch(P){eo(e,e.return,P)}}break;case 1:Ed(t,e),yh(e),n&512&&r!==null&&c0(r,r.return);break;case 5:if(Ed(t,e),yh(e),n&512&&r!==null&&c0(r,r.return),e.flags&32){var s=e.stateNode;try{HE(s,"")}catch(P){eo(e,e.return,P)}}if(n&4&&(s=e.stateNode,s!=null)){var o=e.memoizedProps,h=r!==null?r.memoizedProps:o,i=e.type,m=e.updateQueue;if(e.updateQueue=null,m!==null)try{i==="input"&&o.type==="radio"&&o.name!=null&&nY(s,o),VL(i,h);var y=VL(i,o);for(h=0;h<m.length;h+=2){var S=m[h],b=m[h+1];S==="style"?lY(s,b):S==="dangerouslySetInnerHTML"?aY(s,b):S==="children"?HE(s,b):N4(s,S,b,y)}switch(i){case"input":FL(s,o);break;case"textarea":iY(s,o);break;case"select":var T=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!o.multiple;var A=o.value;A!=null?_0(s,!!o.multiple,A,!1):T!==!!o.multiple&&(o.defaultValue!=null?_0(s,!!o.multiple,o.defaultValue,!0):_0(s,!!o.multiple,o.multiple?[]:"",!1))}s[eT]=o}catch(P){eo(e,e.return,P)}}break;case 6:if(Ed(t,e),yh(e),n&4){if(e.stateNode===null)throw Error(Fr(162));s=e.stateNode,o=e.memoizedProps;try{s.nodeValue=o}catch(P){eo(e,e.return,P)}}break;case 3:if(Ed(t,e),yh(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{ZE(t.containerInfo)}catch(P){eo(e,e.return,P)}break;case 4:Ed(t,e),yh(e);break;case 13:Ed(t,e),yh(e),s=e.child,s.flags&8192&&(o=s.memoizedState!==null,s.stateNode.isHidden=o,!o||s.alternate!==null&&s.alternate.memoizedState!==null||(dB=go())),n&4&&x9(e);break;case 22:if(S=r!==null&&r.memoizedState!==null,e.mode&1?(zl=(y=zl)||S,Ed(t,e),zl=y):Ed(t,e),yh(e),n&8192){if(y=e.memoizedState!==null,(e.stateNode.isHidden=y)&&!S&&e.mode&1)for(En=e,S=e.child;S!==null;){for(b=En=S;En!==null;){switch(T=En,A=T.child,T.tag){case 0:case 11:case 14:case 15:CE(4,T,T.return);break;case 1:c0(T,T.return);var O=T.stateNode;if(typeof O.componentWillUnmount=="function"){n=T,r=T.return;try{t=n,O.props=t.memoizedProps,O.state=t.memoizedState,O.componentWillUnmount()}catch(P){eo(n,r,P)}}break;case 5:c0(T,T.return);break;case 22:if(T.memoizedState!==null){w9(b);continue}}A!==null?(A.return=T,En=A):w9(b)}S=S.sibling}e:for(S=null,b=e;;){if(b.tag===5){if(S===null){S=b;try{s=b.stateNode,y?(o=s.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(i=b.stateNode,m=b.memoizedProps.style,h=m!=null&&m.hasOwnProperty("display")?m.display:null,i.style.display=oY("display",h))}catch(P){eo(e,e.return,P)}}}else if(b.tag===6){if(S===null)try{b.stateNode.nodeValue=y?"":b.memoizedProps}catch(P){eo(e,e.return,P)}}else if((b.tag!==22&&b.tag!==23||b.memoizedState===null||b===e)&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===e)break e;for(;b.sibling===null;){if(b.return===null||b.return===e)break e;S===b&&(S=null),b=b.return}S===b&&(S=null),b.sibling.return=b.return,b=b.sibling}}break;case 19:Ed(t,e),yh(e),n&4&&x9(e);break;case 21:break;default:Ed(t,e),yh(e)}}function yh(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(IJ(r)){var n=r;break e}r=r.return}throw Error(Fr(160))}switch(n.tag){case 5:var s=n.stateNode;n.flags&32&&(HE(s,""),n.flags&=-33);var o=_9(e);_3(e,o,s);break;case 3:case 4:var h=n.stateNode.containerInfo,i=_9(e);v3(e,i,h);break;default:throw Error(Fr(161))}}catch(m){eo(e,e.return,m)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function tve(e,t,r){En=e,DJ(e)}function DJ(e,t,r){for(var n=(e.mode&1)!==0;En!==null;){var s=En,o=s.child;if(s.tag===22&&n){var h=s.memoizedState!==null||oj;if(!h){var i=s.alternate,m=i!==null&&i.memoizedState!==null||zl;i=oj;var y=zl;if(oj=h,(zl=m)&&!y)for(En=s;En!==null;)h=En,m=h.child,h.tag===22&&h.memoizedState!==null?S9(s):m!==null?(m.return=h,En=m):S9(s);for(;o!==null;)En=o,DJ(o),o=o.sibling;En=s,oj=i,zl=y}b9(e)}else s.subtreeFlags&8772&&o!==null?(o.return=s,En=o):b9(e)}}function b9(e){for(;En!==null;){var t=En;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:zl||Uk(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!zl)if(r===null)n.componentDidMount();else{var s=t.elementType===t.type?r.memoizedProps:Od(t.type,r.memoizedProps);n.componentDidUpdate(s,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&s9(t,o,n);break;case 3:var h=t.updateQueue;if(h!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}s9(t,h,r)}break;case 5:var i=t.stateNode;if(r===null&&t.flags&4){r=i;var m=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":m.autoFocus&&r.focus();break;case"img":m.src&&(r.src=m.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var y=t.alternate;if(y!==null){var S=y.memoizedState;if(S!==null){var b=S.dehydrated;b!==null&&ZE(b)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Fr(163))}zl||t.flags&512&&y3(t)}catch(T){eo(t,t.return,T)}}if(t===e){En=null;break}if(r=t.sibling,r!==null){r.return=t.return,En=r;break}En=t.return}}function w9(e){for(;En!==null;){var t=En;if(t===e){En=null;break}var r=t.sibling;if(r!==null){r.return=t.return,En=r;break}En=t.return}}function S9(e){for(;En!==null;){var t=En;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{Uk(4,t)}catch(m){eo(t,r,m)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var s=t.return;try{n.componentDidMount()}catch(m){eo(t,s,m)}}var o=t.return;try{y3(t)}catch(m){eo(t,o,m)}break;case 5:var h=t.return;try{y3(t)}catch(m){eo(t,h,m)}}}catch(m){eo(t,t.return,m)}if(t===e){En=null;break}var i=t.sibling;if(i!==null){i.return=t.return,En=i;break}En=t.return}}var rve=Math.ceil,LP=hp.ReactCurrentDispatcher,cB=hp.ReactCurrentOwner,Ku=hp.ReactCurrentBatchConfig,Es=0,dl=null,No=null,Tl=0,cu=0,u0=gg(0),Zo=0,aT=null,xv=0,Vk=0,uB=0,jE=null,zc=null,dB=0,tb=1/0,Rf=null,FP=!1,x3=null,Jm=null,lj=!1,Vm=null,zP=0,PE=0,b3=null,Jj=-1,Qj=0;function mc(){return Es&6?go():Jj!==-1?Jj:Jj=go()}function Qm(e){return e.mode&1?Es&2&&Tl!==0?Tl&-Tl:zye.transition!==null?(Qj===0&&(Qj=xY()),Qj):(e=Vs,e!==0||(e=window.event,e=e===void 0?16:CY(e.type)),e):1}function Vd(e,t,r,n){if(50<PE)throw PE=0,b3=null,Error(Fr(185));m2(e,r,n),(!(Es&2)||e!==dl)&&(e===dl&&(!(Es&2)&&(Vk|=r),Zo===4&&Cm(e,Tl)),Wc(e,n),r===1&&Es===0&&!(t.mode&1)&&(tb=go()+500,zk&&yg()))}function Wc(e,t){var r=e.callbackNode;zge(e,t);var n=wP(e,e===dl?Tl:0);if(n===0)r!==null&&Nq(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&Nq(r),t===1)e.tag===0?Fye(E9.bind(null,e)):GY(E9.bind(null,e)),Rye(function(){!(Es&6)&&yg()}),r=null;else{switch(bY(n)){case 1:r=L4;break;case 4:r=vY;break;case 16:r=bP;break;case 536870912:r=_Y;break;default:r=bP}r=qJ(r,LJ.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function LJ(e,t){if(Jj=-1,Qj=0,Es&6)throw Error(Fr(327));var r=e.callbackNode;if(E0()&&e.callbackNode!==r)return null;var n=wP(e,e===dl?Tl:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=BP(e,n);else{t=n;var s=Es;Es|=2;var o=zJ();(dl!==e||Tl!==t)&&(Rf=null,tb=go()+500,dv(e,t));do try{sve();break}catch(i){FJ(e,i)}while(!0);X4(),LP.current=o,Es=s,No!==null?t=0:(dl=null,Tl=0,t=Zo)}if(t!==0){if(t===2&&(s=KL(e),s!==0&&(n=s,t=w3(e,s))),t===1)throw r=aT,dv(e,0),Cm(e,n),Wc(e,go()),r;if(t===6)Cm(e,n);else{if(s=e.current.alternate,!(n&30)&&!nve(s)&&(t=BP(e,n),t===2&&(o=KL(e),o!==0&&(n=o,t=w3(e,o))),t===1))throw r=aT,dv(e,0),Cm(e,n),Wc(e,go()),r;switch(e.finishedWork=s,e.finishedLanes=n,t){case 0:case 1:throw Error(Fr(345));case 2:My(e,zc,Rf);break;case 3:if(Cm(e,n),(n&130023424)===n&&(t=dB+500-go(),10<t)){if(wP(e,0)!==0)break;if(s=e.suspendedLanes,(s&n)!==n){mc(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=r3(My.bind(null,e,zc,Rf),t);break}My(e,zc,Rf);break;case 4:if(Cm(e,n),(n&4194240)===n)break;for(t=e.eventTimes,s=-1;0<n;){var h=31-Ud(n);o=1<<h,h=t[h],h>s&&(s=h),n&=~o}if(n=s,n=go()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*rve(n/1960))-n,10<n){e.timeoutHandle=r3(My.bind(null,e,zc,Rf),n);break}My(e,zc,Rf);break;case 5:My(e,zc,Rf);break;default:throw Error(Fr(329))}}}return Wc(e,go()),e.callbackNode===r?LJ.bind(null,e):null}function w3(e,t){var r=jE;return e.current.memoizedState.isDehydrated&&(dv(e,t).flags|=256),e=BP(e,t),e!==2&&(t=zc,zc=r,t!==null&&S3(t)),e}function S3(e){zc===null?zc=e:zc.push.apply(zc,e)}function nve(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var s=r[n],o=s.getSnapshot;s=s.value;try{if(!Gd(o(),s))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Cm(e,t){for(t&=~uB,t&=~Vk,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Ud(t),n=1<<r;e[r]=-1,t&=~n}}function E9(e){if(Es&6)throw Error(Fr(327));E0();var t=wP(e,0);if(!(t&1))return Wc(e,go()),null;var r=BP(e,t);if(e.tag!==0&&r===2){var n=KL(e);n!==0&&(t=n,r=w3(e,n))}if(r===1)throw r=aT,dv(e,0),Cm(e,t),Wc(e,go()),r;if(r===6)throw Error(Fr(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,My(e,zc,Rf),Wc(e,go()),null}function hB(e,t){var r=Es;Es|=1;try{return e(t)}finally{Es=r,Es===0&&(tb=go()+500,zk&&yg())}}function bv(e){Vm!==null&&Vm.tag===0&&!(Es&6)&&E0();var t=Es;Es|=1;var r=Ku.transition,n=Vs;try{if(Ku.transition=null,Vs=1,e)return e()}finally{Vs=n,Ku.transition=r,Es=t,!(Es&6)&&yg()}}function fB(){cu=u0.current,va(u0)}function dv(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,Iye(r)),No!==null)for(r=No.return;r!==null;){var n=r;switch(W4(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&CP();break;case 3:Q0(),va(Hc),va($l),rB();break;case 5:tB(n);break;case 4:Q0();break;case 13:va(Fa);break;case 19:va(Fa);break;case 10:Y4(n.type._context);break;case 22:case 23:fB()}r=r.return}if(dl=e,No=e=eg(e.current,null),Tl=cu=t,Zo=0,aT=null,uB=Vk=xv=0,zc=jE=null,Wy!==null){for(t=0;t<Wy.length;t++)if(r=Wy[t],n=r.interleaved,n!==null){r.interleaved=null;var s=n.next,o=r.pending;if(o!==null){var h=o.next;o.next=s,n.next=h}r.pending=n}Wy=null}return e}function FJ(e,t){do{var r=No;try{if(X4(),Zj.current=DP,MP){for(var n=Ba.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}MP=!1}if(_v=0,cl=Go=Ba=null,AE=!1,nT=0,cB.current=null,r===null||r.return===null){Zo=1,aT=t,No=null;break}e:{var o=e,h=r.return,i=r,m=t;if(t=Tl,i.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){var y=m,S=i,b=S.tag;if(!(S.mode&1)&&(b===0||b===11||b===15)){var T=S.alternate;T?(S.updateQueue=T.updateQueue,S.memoizedState=T.memoizedState,S.lanes=T.lanes):(S.updateQueue=null,S.memoizedState=null)}var A=d9(h);if(A!==null){A.flags&=-257,h9(A,h,i,o,t),A.mode&1&&u9(o,y,t),t=A,m=y;var O=t.updateQueue;if(O===null){var P=new Set;P.add(m),t.updateQueue=P}else O.add(m);break e}else{if(!(t&1)){u9(o,y,t),pB();break e}m=Error(Fr(426))}}else if(Aa&&i.mode&1){var I=d9(h);if(I!==null){!(I.flags&65536)&&(I.flags|=256),h9(I,h,i,o,t),K4(eb(m,i));break e}}o=m=eb(m,i),Zo!==4&&(Zo=2),jE===null?jE=[o]:jE.push(o),o=h;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var R=bJ(o,m,t);i9(o,R);break e;case 1:i=m;var M=o.type,F=o.stateNode;if(!(o.flags&128)&&(typeof M.getDerivedStateFromError=="function"||F!==null&&typeof F.componentDidCatch=="function"&&(Jm===null||!Jm.has(F)))){o.flags|=65536,t&=-t,o.lanes|=t;var z=wJ(o,i,t);i9(o,z);break e}}o=o.return}while(o!==null)}$J(r)}catch($){t=$,No===r&&r!==null&&(No=r=r.return);continue}break}while(!0)}function zJ(){var e=LP.current;return LP.current=DP,e===null?DP:e}function pB(){(Zo===0||Zo===3||Zo===2)&&(Zo=4),dl===null||!(xv&268435455)&&!(Vk&268435455)||Cm(dl,Tl)}function BP(e,t){var r=Es;Es|=2;var n=zJ();(dl!==e||Tl!==t)&&(Rf=null,dv(e,t));do try{ive();break}catch(s){FJ(e,s)}while(!0);if(X4(),Es=r,LP.current=n,No!==null)throw Error(Fr(261));return dl=null,Tl=0,Zo}function ive(){for(;No!==null;)BJ(No)}function sve(){for(;No!==null&&!Oge();)BJ(No)}function BJ(e){var t=VJ(e.alternate,e,cu);e.memoizedProps=e.pendingProps,t===null?$J(e):No=t,cB.current=null}function $J(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=Jye(r,t),r!==null){r.flags&=32767,No=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Zo=6,No=null;return}}else if(r=Yye(r,t,cu),r!==null){No=r;return}if(t=t.sibling,t!==null){No=t;return}No=t=e}while(t!==null);Zo===0&&(Zo=5)}function My(e,t,r){var n=Vs,s=Ku.transition;try{Ku.transition=null,Vs=1,ave(e,t,r,n)}finally{Ku.transition=s,Vs=n}return null}function ave(e,t,r,n){do E0();while(Vm!==null);if(Es&6)throw Error(Fr(327));r=e.finishedWork;var s=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Fr(177));e.callbackNode=null,e.callbackPriority=0;var o=r.lanes|r.childLanes;if(Bge(e,o),e===dl&&(No=dl=null,Tl=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||lj||(lj=!0,qJ(bP,function(){return E0(),null})),o=(r.flags&15990)!==0,r.subtreeFlags&15990||o){o=Ku.transition,Ku.transition=null;var h=Vs;Vs=1;var i=Es;Es|=4,cB.current=null,eve(e,r),MJ(r,e),Aye(e3),SP=!!QL,e3=QL=null,e.current=r,tve(r),kge(),Es=i,Vs=h,Ku.transition=o}else e.current=r;if(lj&&(lj=!1,Vm=e,zP=s),o=e.pendingLanes,o===0&&(Jm=null),Rge(r.stateNode),Wc(e,go()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)s=t[r],n(s.value,{componentStack:s.stack,digest:s.digest});if(FP)throw FP=!1,e=x3,x3=null,e;return zP&1&&e.tag!==0&&E0(),o=e.pendingLanes,o&1?e===b3?PE++:(PE=0,b3=e):PE=0,yg(),null}function E0(){if(Vm!==null){var e=bY(zP),t=Ku.transition,r=Vs;try{if(Ku.transition=null,Vs=16>e?16:e,Vm===null)var n=!1;else{if(e=Vm,Vm=null,zP=0,Es&6)throw Error(Fr(331));var s=Es;for(Es|=4,En=e.current;En!==null;){var o=En,h=o.child;if(En.flags&16){var i=o.deletions;if(i!==null){for(var m=0;m<i.length;m++){var y=i[m];for(En=y;En!==null;){var S=En;switch(S.tag){case 0:case 11:case 15:CE(8,S,o)}var b=S.child;if(b!==null)b.return=S,En=b;else for(;En!==null;){S=En;var T=S.sibling,A=S.return;if(NJ(S),S===y){En=null;break}if(T!==null){T.return=A,En=T;break}En=A}}}var O=o.alternate;if(O!==null){var P=O.child;if(P!==null){O.child=null;do{var I=P.sibling;P.sibling=null,P=I}while(P!==null)}}En=o}}if(o.subtreeFlags&2064&&h!==null)h.return=o,En=h;else e:for(;En!==null;){if(o=En,o.flags&2048)switch(o.tag){case 0:case 11:case 15:CE(9,o,o.return)}var R=o.sibling;if(R!==null){R.return=o.return,En=R;break e}En=o.return}}var M=e.current;for(En=M;En!==null;){h=En;var F=h.child;if(h.subtreeFlags&2064&&F!==null)F.return=h,En=F;else e:for(h=M;En!==null;){if(i=En,i.flags&2048)try{switch(i.tag){case 0:case 11:case 15:Uk(9,i)}}catch($){eo(i,i.return,$)}if(i===h){En=null;break e}var z=i.sibling;if(z!==null){z.return=i.return,En=z;break e}En=i.return}}if(Es=s,yg(),Lh&&typeof Lh.onPostCommitFiberRoot=="function")try{Lh.onPostCommitFiberRoot(Rk,e)}catch{}n=!0}return n}finally{Vs=r,Ku.transition=t}}return!1}function T9(e,t,r){t=eb(r,t),t=bJ(e,t,1),e=Ym(e,t,1),t=mc(),e!==null&&(m2(e,1,t),Wc(e,t))}function eo(e,t,r){if(e.tag===3)T9(e,e,r);else for(;t!==null;){if(t.tag===3){T9(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Jm===null||!Jm.has(n))){e=eb(r,e),e=wJ(t,e,1),t=Ym(t,e,1),e=mc(),t!==null&&(m2(t,1,e),Wc(t,e));break}}t=t.return}}function ove(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=mc(),e.pingedLanes|=e.suspendedLanes&r,dl===e&&(Tl&r)===r&&(Zo===4||Zo===3&&(Tl&130023424)===Tl&&500>go()-dB?dv(e,0):uB|=r),Wc(e,t)}function UJ(e,t){t===0&&(e.mode&1?(t=JC,JC<<=1,!(JC&130023424)&&(JC=4194304)):t=1);var r=mc();e=rp(e,t),e!==null&&(m2(e,t,r),Wc(e,r))}function lve(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),UJ(e,r)}function cve(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,s=e.memoizedState;s!==null&&(r=s.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(Fr(314))}n!==null&&n.delete(t),UJ(e,r)}var VJ;VJ=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Hc.current)Uc=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return Uc=!1,Xye(e,t,r);Uc=!!(e.flags&131072)}else Uc=!1,Aa&&t.flags&1048576&&WY(t,OP,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;Yj(e,t),e=t.pendingProps;var s=X0(t,$l.current);S0(t,r),s=iB(null,t,n,e,s,r);var o=sB();return t.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Gc(n)?(o=!0,jP(t)):o=!1,t.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Q4(t),s.updater=$k,t.stateNode=s,s._reactInternals=t,c3(t,n,e,r),t=h3(null,t,n,!0,o,r)):(t.tag=0,Aa&&o&&G4(t),oc(null,t,s,r),t=t.child),t;case 16:n=t.elementType;e:{switch(Yj(e,t),e=t.pendingProps,s=n._init,n=s(n._payload),t.type=n,s=t.tag=dve(n),e=Od(n,e),s){case 0:t=d3(null,t,n,e,r);break e;case 1:t=m9(null,t,n,e,r);break e;case 11:t=f9(null,t,n,e,r);break e;case 14:t=p9(null,t,n,Od(n.type,e),r);break e}throw Error(Fr(306,n,""))}return t;case 0:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:Od(n,s),d3(e,t,n,s,r);case 1:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:Od(n,s),m9(e,t,n,s,r);case 3:e:{if(AJ(t),e===null)throw Error(Fr(387));n=t.pendingProps,o=t.memoizedState,s=o.element,QY(e,t),IP(t,n,null,r);var h=t.memoizedState;if(n=h.element,o.isDehydrated)if(o={element:n,isDehydrated:!1,cache:h.cache,pendingSuspenseBoundaries:h.pendingSuspenseBoundaries,transitions:h.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){s=eb(Error(Fr(423)),t),t=g9(e,t,n,r,s);break e}else if(n!==s){s=eb(Error(Fr(424)),t),t=g9(e,t,n,r,s);break e}else for(yu=Xm(t.stateNode.containerInfo.firstChild),vu=t,Aa=!0,Fd=null,r=YY(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(Y0(),n===s){t=np(e,t,r);break e}oc(e,t,n,r)}t=t.child}return t;case 5:return eJ(t),e===null&&a3(t),n=t.type,s=t.pendingProps,o=e!==null?e.memoizedProps:null,h=s.children,t3(n,s)?h=null:o!==null&&t3(n,o)&&(t.flags|=32),TJ(e,t),oc(e,t,h,r),t.child;case 6:return e===null&&a3(t),null;case 13:return CJ(e,t,r);case 4:return eB(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=J0(t,null,n,r):oc(e,t,n,r),t.child;case 11:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:Od(n,s),f9(e,t,n,s,r);case 7:return oc(e,t,t.pendingProps,r),t.child;case 8:return oc(e,t,t.pendingProps.children,r),t.child;case 12:return oc(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,s=t.pendingProps,o=t.memoizedProps,h=s.value,oa(kP,n._currentValue),n._currentValue=h,o!==null)if(Gd(o.value,h)){if(o.children===s.children&&!Hc.current){t=np(e,t,r);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var i=o.dependencies;if(i!==null){h=o.child;for(var m=i.firstContext;m!==null;){if(m.context===n){if(o.tag===1){m=Zf(-1,r&-r),m.tag=2;var y=o.updateQueue;if(y!==null){y=y.shared;var S=y.pending;S===null?m.next=m:(m.next=S.next,S.next=m),y.pending=m}}o.lanes|=r,m=o.alternate,m!==null&&(m.lanes|=r),o3(o.return,r,t),i.lanes|=r;break}m=m.next}}else if(o.tag===10)h=o.type===t.type?null:o.child;else if(o.tag===18){if(h=o.return,h===null)throw Error(Fr(341));h.lanes|=r,i=h.alternate,i!==null&&(i.lanes|=r),o3(h,r,t),h=o.sibling}else h=o.child;if(h!==null)h.return=o;else for(h=o;h!==null;){if(h===t){h=null;break}if(o=h.sibling,o!==null){o.return=h.return,h=o;break}h=h.return}o=h}oc(e,t,s.children,r),t=t.child}return t;case 9:return s=t.type,n=t.pendingProps.children,S0(t,r),s=Xu(s),n=n(s),t.flags|=1,oc(e,t,n,r),t.child;case 14:return n=t.type,s=Od(n,t.pendingProps),s=Od(n.type,s),p9(e,t,n,s,r);case 15:return SJ(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:Od(n,s),Yj(e,t),t.tag=1,Gc(n)?(e=!0,jP(t)):e=!1,S0(t,r),xJ(t,n,s),c3(t,n,s,r),h3(null,t,n,!0,e,r);case 19:return jJ(e,t,r);case 22:return EJ(e,t,r)}throw Error(Fr(156,t.tag))};function qJ(e,t){return yY(e,t)}function uve(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Hu(e,t,r,n){return new uve(e,t,r,n)}function mB(e){return e=e.prototype,!(!e||!e.isReactComponent)}function dve(e){if(typeof e=="function")return mB(e)?1:0;if(e!=null){if(e=e.$$typeof,e===R4)return 11;if(e===M4)return 14}return 2}function eg(e,t){var r=e.alternate;return r===null?(r=Hu(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function eP(e,t,r,n,s,o){var h=2;if(n=e,typeof e=="function")mB(e)&&(h=1);else if(typeof e=="string")h=5;else e:switch(e){case e0:return hv(r.children,s,o,t);case I4:h=8,s|=8;break;case IL:return e=Hu(12,r,t,s|2),e.elementType=IL,e.lanes=o,e;case RL:return e=Hu(13,r,t,s),e.elementType=RL,e.lanes=o,e;case ML:return e=Hu(19,r,t,s),e.elementType=ML,e.lanes=o,e;case eY:return qk(r,s,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case JX:h=10;break e;case QX:h=9;break e;case R4:h=11;break e;case M4:h=14;break e;case bm:h=16,n=null;break e}throw Error(Fr(130,e==null?e:typeof e,""))}return t=Hu(h,r,t,s),t.elementType=e,t.type=n,t.lanes=o,t}function hv(e,t,r,n){return e=Hu(7,e,n,t),e.lanes=r,e}function qk(e,t,r,n){return e=Hu(22,e,n,t),e.elementType=eY,e.lanes=r,e.stateNode={isHidden:!1},e}function _D(e,t,r){return e=Hu(6,e,null,t),e.lanes=r,e}function xD(e,t,r){return t=Hu(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function hve(e,t,r,n,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=eD(0),this.expirationTimes=eD(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=eD(0),this.identifierPrefix=n,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function gB(e,t,r,n,s,o,h,i,m){return e=new hve(e,t,r,i,m),t===1?(t=1,o===!0&&(t|=8)):t=0,o=Hu(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},Q4(o),e}function fve(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Qx,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function HJ(e){if(!e)return og;e=e._reactInternals;e:{if(qv(e)!==e||e.tag!==1)throw Error(Fr(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Gc(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Fr(171))}if(e.tag===1){var r=e.type;if(Gc(r))return HY(e,r,t)}return t}function GJ(e,t,r,n,s,o,h,i,m){return e=gB(r,n,!0,e,s,o,h,i,m),e.context=HJ(null),r=e.current,n=mc(),s=Qm(r),o=Zf(n,s),o.callback=t??null,Ym(r,o,s),e.current.lanes=s,m2(e,s,n),Wc(e,n),e}function Hk(e,t,r,n){var s=t.current,o=mc(),h=Qm(s);return r=HJ(r),t.context===null?t.context=r:t.pendingContext=r,t=Zf(o,h),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=Ym(s,t,h),e!==null&&(Vd(e,s,h,o),Kj(e,s,h)),h}function $P(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function A9(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function yB(e,t){A9(e,t),(e=e.alternate)&&A9(e,t)}function pve(){return null}var WJ=typeof reportError=="function"?reportError:function(e){console.error(e)};function vB(e){this._internalRoot=e}Gk.prototype.render=vB.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Fr(409));Hk(e,t,null,null)};Gk.prototype.unmount=vB.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;bv(function(){Hk(null,e,null,null)}),t[tp]=null}};function Gk(e){this._internalRoot=e}Gk.prototype.unstable_scheduleHydration=function(e){if(e){var t=EY();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Am.length&&t!==0&&t<Am[r].priority;r++);Am.splice(r,0,e),r===0&&AY(e)}};function _B(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Wk(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function C9(){}function mve(e,t,r,n,s){if(s){if(typeof n=="function"){var o=n;n=function(){var y=$P(h);o.call(y)}}var h=GJ(t,n,e,0,null,!1,!1,"",C9);return e._reactRootContainer=h,e[tp]=h.current,JE(e.nodeType===8?e.parentNode:e),bv(),h}for(;s=e.lastChild;)e.removeChild(s);if(typeof n=="function"){var i=n;n=function(){var y=$P(m);i.call(y)}}var m=gB(e,0,!1,null,null,!1,!1,"",C9);return e._reactRootContainer=m,e[tp]=m.current,JE(e.nodeType===8?e.parentNode:e),bv(function(){Hk(t,m,r,n)}),m}function Kk(e,t,r,n,s){var o=r._reactRootContainer;if(o){var h=o;if(typeof s=="function"){var i=s;s=function(){var m=$P(h);i.call(m)}}Hk(t,h,e,s)}else h=mve(r,t,e,s,n);return $P(h)}wY=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=aE(t.pendingLanes);r!==0&&(F4(t,r|1),Wc(t,go()),!(Es&6)&&(tb=go()+500,yg()))}break;case 13:bv(function(){var n=rp(e,1);if(n!==null){var s=mc();Vd(n,e,1,s)}}),yB(e,1)}};z4=function(e){if(e.tag===13){var t=rp(e,134217728);if(t!==null){var r=mc();Vd(t,e,134217728,r)}yB(e,134217728)}};SY=function(e){if(e.tag===13){var t=Qm(e),r=rp(e,t);if(r!==null){var n=mc();Vd(r,e,t,n)}yB(e,t)}};EY=function(){return Vs};TY=function(e,t){var r=Vs;try{return Vs=e,t()}finally{Vs=r}};HL=function(e,t,r){switch(t){case"input":if(FL(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var s=Fk(n);if(!s)throw Error(Fr(90));rY(n),FL(n,s)}}}break;case"textarea":iY(e,r);break;case"select":t=r.value,t!=null&&_0(e,!!r.multiple,t,!1)}};dY=hB;hY=bv;var gve={usingClientEntryPoint:!1,Events:[y2,i0,Fk,cY,uY,hB]},LS={findFiberByHostInstance:Gy,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},yve={bundleType:LS.bundleType,version:LS.version,rendererPackageName:LS.rendererPackageName,rendererConfig:LS.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:hp.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=mY(e),e===null?null:e.stateNode},findFiberByHostInstance:LS.findFiberByHostInstance||pve,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cj=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cj.isDisabled&&cj.supportsFiber)try{Rk=cj.inject(yve),Lh=cj}catch{}}Tu.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=gve;Tu.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!_B(t))throw Error(Fr(200));return fve(e,t,null,r)};Tu.createRoot=function(e,t){if(!_B(e))throw Error(Fr(299));var r=!1,n="",s=WJ;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),t=gB(e,1,!1,null,null,r,!1,n,s),e[tp]=t.current,JE(e.nodeType===8?e.parentNode:e),new vB(t)};Tu.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Fr(188)):(e=Object.keys(e).join(","),Error(Fr(268,e)));return e=mY(t),e=e===null?null:e.stateNode,e};Tu.flushSync=function(e){return bv(e)};Tu.hydrate=function(e,t,r){if(!Wk(t))throw Error(Fr(200));return Kk(null,e,t,!0,r)};Tu.hydrateRoot=function(e,t,r){if(!_B(e))throw Error(Fr(405));var n=r!=null&&r.hydratedSources||null,s=!1,o="",h=WJ;if(r!=null&&(r.unstable_strictMode===!0&&(s=!0),r.identifierPrefix!==void 0&&(o=r.identifierPrefix),r.onRecoverableError!==void 0&&(h=r.onRecoverableError)),t=GJ(t,null,e,1,r??null,s,!1,o,h),e[tp]=t.current,JE(e),n)for(e=0;e<n.length;e++)r=n[e],s=r._getVersion,s=s(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,s]:t.mutableSourceEagerHydrationData.push(r,s);return new Gk(t)};Tu.render=function(e,t,r){if(!Wk(t))throw Error(Fr(200));return Kk(null,e,t,!1,r)};Tu.unmountComponentAtNode=function(e){if(!Wk(e))throw Error(Fr(40));return e._reactRootContainer?(bv(function(){Kk(null,null,e,!1,function(){e._reactRootContainer=null,e[tp]=null})}),!0):!1};Tu.unstable_batchedUpdates=hB;Tu.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!Wk(r))throw Error(Fr(200));if(e==null||e._reactInternals===void 0)throw Error(Fr(38));return Kk(e,t,r,!1,n)};Tu.version="18.3.1-next-f1338f8080-20240426";function KJ(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(KJ)}catch(e){console.error(e)}}KJ(),KX.exports=Tu;var vg=KX.exports;const ZJ=Os(vg);var XJ,j9=vg;XJ=j9.createRoot,j9.hydrateRoot;const vve=1,_ve=2500;let bD=0;function xve(){return bD=(bD+1)%Number.MAX_SAFE_INTEGER,bD.toString()}const wD=new Map,P9=e=>{if(wD.has(e))return;const t=setTimeout(()=>{wD.delete(e),OE({type:"REMOVE_TOAST",toastId:e})},_ve);wD.set(e,t)},bve=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,vve)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(r=>r.id===t.toast.id?{...r,...t.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=t;return r?P9(r):e.toasts.forEach(n=>{P9(n.id)}),{...e,toasts:e.toasts.map(n=>n.id===r||r===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(r=>r.id!==t.toastId)}}},tP=[];let rP={toasts:[]};function OE(e){rP=bve(rP,e),tP.forEach(t=>{t(rP)})}function Po({...e}){const t=xve(),r=s=>OE({type:"UPDATE_TOAST",toast:{...s,id:t}}),n=()=>OE({type:"DISMISS_TOAST",toastId:t});return OE({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:s=>{s||n()}}}),{id:t,dismiss:n,update:r}}function Ri(){const[e,t]=V.useState(rP);return V.useEffect(()=>(tP.push(t),()=>{const r=tP.indexOf(t);r>-1&&tP.splice(r,1)}),[e]),{...e,toast:Po,dismiss:r=>OE({type:"DISMISS_TOAST",toastId:r})}}function Ir(e,t,{checkForDefaultPrevented:r=!0}={}){return function(s){if(e==null||e(s),r===!1||!s.defaultPrevented)return t==null?void 0:t(s)}}function O9(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function Zk(...e){return t=>{let r=!1;const n=e.map(s=>{const o=O9(s,t);return!r&&typeof o=="function"&&(r=!0),o});if(r)return()=>{for(let s=0;s<n.length;s++){const o=n[s];typeof o=="function"?o():O9(e[s],null)}}}}function Un(...e){return V.useCallback(Zk(...e),e)}function wve(e,t){const r=V.createContext(t),n=o=>{const{children:h,...i}=o,m=V.useMemo(()=>i,Object.values(i));return d.jsx(r.Provider,{value:m,children:h})};n.displayName=e+"Provider";function s(o){const h=V.useContext(r);if(h)return h;if(t!==void 0)return t;throw new Error(`\`${o}\` must be used within \`${e}\``)}return[n,s]}function Mo(e,t=[]){let r=[];function n(o,h){const i=V.createContext(h),m=r.length;r=[...r,h];const y=b=>{var R;const{scope:T,children:A,...O}=b,P=((R=T==null?void 0:T[e])==null?void 0:R[m])||i,I=V.useMemo(()=>O,Object.values(O));return d.jsx(P.Provider,{value:I,children:A})};y.displayName=o+"Provider";function S(b,T){var P;const A=((P=T==null?void 0:T[e])==null?void 0:P[m])||i,O=V.useContext(A);if(O)return O;if(h!==void 0)return h;throw new Error(`\`${b}\` must be used within \`${o}\``)}return[y,S]}const s=()=>{const o=r.map(h=>V.createContext(h));return function(i){const m=(i==null?void 0:i[e])||o;return V.useMemo(()=>({[`__scope${e}`]:{...i,[e]:m}}),[i,m])}};return s.scopeName=e,[n,Sve(s,...t)]}function Sve(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const n=e.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(o){const h=n.reduce((i,{useScope:m,scopeName:y})=>{const b=m(o)[`__scope${y}`];return{...i,...b}},{});return V.useMemo(()=>({[`__scope${t.scopeName}`]:h}),[h])}};return r.scopeName=t.scopeName,r}function lg(e){const t=Eve(e),r=V.forwardRef((n,s)=>{const{children:o,...h}=n,i=V.Children.toArray(o),m=i.find(Tve);if(m){const y=m.props.children,S=i.map(b=>b===m?V.Children.count(y)>1?V.Children.only(null):V.isValidElement(y)?y.props.children:null:b);return d.jsx(t,{...h,ref:s,children:V.isValidElement(y)?V.cloneElement(y,void 0,S):null})}return d.jsx(t,{...h,ref:s,children:o})});return r.displayName=`${e}.Slot`,r}var Hv=lg("Slot");function Eve(e){const t=V.forwardRef((r,n)=>{const{children:s,...o}=r;if(V.isValidElement(s)){const h=Cve(s),i=Ave(o,s.props);return s.type!==V.Fragment&&(i.ref=n?Zk(n,h):h),V.cloneElement(s,i)}return V.Children.count(s)>1?V.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var YJ=Symbol("radix.slottable");function JJ(e){const t=({children:r})=>d.jsx(d.Fragment,{children:r});return t.displayName=`${e}.Slottable`,t.__radixId=YJ,t}function Tve(e){return V.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===YJ}function Ave(e,t){const r={...t};for(const n in t){const s=e[n],o=t[n];/^on[A-Z]/.test(n)?s&&o?r[n]=(...i)=>{const m=o(...i);return s(...i),m}:s&&(r[n]=s):n==="style"?r[n]={...s,...o}:n==="className"&&(r[n]=[s,o].filter(Boolean).join(" "))}return{...e,...r}}function Cve(e){var n,s;let t=(n=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:n.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(s=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:s.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}function _2(e){const t=e+"CollectionProvider",[r,n]=Mo(t),[s,o]=r(t,{collectionRef:{current:null},itemMap:new Map}),h=P=>{const{scope:I,children:R}=P,M=Ue.useRef(null),F=Ue.useRef(new Map).current;return d.jsx(s,{scope:I,itemMap:F,collectionRef:M,children:R})};h.displayName=t;const i=e+"CollectionSlot",m=lg(i),y=Ue.forwardRef((P,I)=>{const{scope:R,children:M}=P,F=o(i,R),z=Un(I,F.collectionRef);return d.jsx(m,{ref:z,children:M})});y.displayName=i;const S=e+"CollectionItemSlot",b="data-radix-collection-item",T=lg(S),A=Ue.forwardRef((P,I)=>{const{scope:R,children:M,...F}=P,z=Ue.useRef(null),$=Un(I,z),W=o(S,R);return Ue.useEffect(()=>(W.itemMap.set(z,{ref:z,...F}),()=>void W.itemMap.delete(z))),d.jsx(T,{[b]:"",ref:$,children:M})});A.displayName=S;function O(P){const I=o(e+"CollectionConsumer",P);return Ue.useCallback(()=>{const M=I.collectionRef.current;if(!M)return[];const F=Array.from(M.querySelectorAll(`[${b}]`));return Array.from(I.itemMap.values()).sort((W,K)=>F.indexOf(W.ref.current)-F.indexOf(K.ref.current))},[I.collectionRef,I.itemMap])}return[{Provider:h,Slot:y,ItemSlot:A},O,n]}var jve=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ln=jve.reduce((e,t)=>{const r=lg(`Primitive.${t}`),n=V.forwardRef((s,o)=>{const{asChild:h,...i}=s,m=h?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),d.jsx(m,{...i,ref:o})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function xB(e,t){e&&vg.flushSync(()=>e.dispatchEvent(t))}function no(e){const t=V.useRef(e);return V.useEffect(()=>{t.current=e}),V.useMemo(()=>(...r)=>{var n;return(n=t.current)==null?void 0:n.call(t,...r)},[])}function Pve(e,t=globalThis==null?void 0:globalThis.document){const r=no(e);V.useEffect(()=>{const n=s=>{s.key==="Escape"&&r(s)};return t.addEventListener("keydown",n,{capture:!0}),()=>t.removeEventListener("keydown",n,{capture:!0})},[r,t])}var Ove="DismissableLayer",E3="dismissableLayer.update",kve="dismissableLayer.pointerDownOutside",Nve="dismissableLayer.focusOutside",k9,QJ=V.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Gv=V.forwardRef((e,t)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:s,onFocusOutside:o,onInteractOutside:h,onDismiss:i,...m}=e,y=V.useContext(QJ),[S,b]=V.useState(null),T=(S==null?void 0:S.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,A]=V.useState({}),O=Un(t,K=>b(K)),P=Array.from(y.layers),[I]=[...y.layersWithOutsidePointerEventsDisabled].slice(-1),R=P.indexOf(I),M=S?P.indexOf(S):-1,F=y.layersWithOutsidePointerEventsDisabled.size>0,z=M>=R,$=Rve(K=>{const ee=K.target,ne=[...y.branches].some(ie=>ie.contains(ee));!z||ne||(s==null||s(K),h==null||h(K),K.defaultPrevented||i==null||i())},T),W=Mve(K=>{const ee=K.target;[...y.branches].some(ie=>ie.contains(ee))||(o==null||o(K),h==null||h(K),K.defaultPrevented||i==null||i())},T);return Pve(K=>{M===y.layers.size-1&&(n==null||n(K),!K.defaultPrevented&&i&&(K.preventDefault(),i()))},T),V.useEffect(()=>{if(S)return r&&(y.layersWithOutsidePointerEventsDisabled.size===0&&(k9=T.body.style.pointerEvents,T.body.style.pointerEvents="none"),y.layersWithOutsidePointerEventsDisabled.add(S)),y.layers.add(S),N9(),()=>{r&&y.layersWithOutsidePointerEventsDisabled.size===1&&(T.body.style.pointerEvents=k9)}},[S,T,r,y]),V.useEffect(()=>()=>{S&&(y.layers.delete(S),y.layersWithOutsidePointerEventsDisabled.delete(S),N9())},[S,y]),V.useEffect(()=>{const K=()=>A({});return document.addEventListener(E3,K),()=>document.removeEventListener(E3,K)},[]),d.jsx(ln.div,{...m,ref:O,style:{pointerEvents:F?z?"auto":"none":void 0,...e.style},onFocusCapture:Ir(e.onFocusCapture,W.onFocusCapture),onBlurCapture:Ir(e.onBlurCapture,W.onBlurCapture),onPointerDownCapture:Ir(e.onPointerDownCapture,$.onPointerDownCapture)})});Gv.displayName=Ove;var Ive="DismissableLayerBranch",eQ=V.forwardRef((e,t)=>{const r=V.useContext(QJ),n=V.useRef(null),s=Un(t,n);return V.useEffect(()=>{const o=n.current;if(o)return r.branches.add(o),()=>{r.branches.delete(o)}},[r.branches]),d.jsx(ln.div,{...e,ref:s})});eQ.displayName=Ive;function Rve(e,t=globalThis==null?void 0:globalThis.document){const r=no(e),n=V.useRef(!1),s=V.useRef(()=>{});return V.useEffect(()=>{const o=i=>{if(i.target&&!n.current){let m=function(){tQ(kve,r,y,{discrete:!0})};const y={originalEvent:i};i.pointerType==="touch"?(t.removeEventListener("click",s.current),s.current=m,t.addEventListener("click",s.current,{once:!0})):m()}else t.removeEventListener("click",s.current);n.current=!1},h=window.setTimeout(()=>{t.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(h),t.removeEventListener("pointerdown",o),t.removeEventListener("click",s.current)}},[t,r]),{onPointerDownCapture:()=>n.current=!0}}function Mve(e,t=globalThis==null?void 0:globalThis.document){const r=no(e),n=V.useRef(!1);return V.useEffect(()=>{const s=o=>{o.target&&!n.current&&tQ(Nve,r,{originalEvent:o},{discrete:!1})};return t.addEventListener("focusin",s),()=>t.removeEventListener("focusin",s)},[t,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function N9(){const e=new CustomEvent(E3);document.dispatchEvent(e)}function tQ(e,t,r,{discrete:n}){const s=r.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&s.addEventListener(e,t,{once:!0}),n?xB(s,o):s.dispatchEvent(o)}var Dve=Gv,Lve=eQ,io=globalThis!=null&&globalThis.document?V.useLayoutEffect:()=>{},Fve="Portal",Yb=V.forwardRef((e,t)=>{var i;const{container:r,...n}=e,[s,o]=V.useState(!1);io(()=>o(!0),[]);const h=r||s&&((i=globalThis==null?void 0:globalThis.document)==null?void 0:i.body);return h?ZJ.createPortal(d.jsx(ln.div,{...n,ref:t}),h):null});Yb.displayName=Fve;function zve(e,t){return V.useReducer((r,n)=>t[r][n]??r,e)}var Do=e=>{const{present:t,children:r}=e,n=Bve(t),s=typeof r=="function"?r({present:n.isPresent}):V.Children.only(r),o=Un(n.ref,$ve(s));return typeof r=="function"||n.isPresent?V.cloneElement(s,{ref:o}):null};Do.displayName="Presence";function Bve(e){const[t,r]=V.useState(),n=V.useRef(null),s=V.useRef(e),o=V.useRef("none"),h=e?"mounted":"unmounted",[i,m]=zve(h,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return V.useEffect(()=>{const y=uj(n.current);o.current=i==="mounted"?y:"none"},[i]),io(()=>{const y=n.current,S=s.current;if(S!==e){const T=o.current,A=uj(y);e?m("MOUNT"):A==="none"||(y==null?void 0:y.display)==="none"?m("UNMOUNT"):m(S&&T!==A?"ANIMATION_OUT":"UNMOUNT"),s.current=e}},[e,m]),io(()=>{if(t){let y;const S=t.ownerDocument.defaultView??window,b=A=>{const P=uj(n.current).includes(A.animationName);if(A.target===t&&P&&(m("ANIMATION_END"),!s.current)){const I=t.style.animationFillMode;t.style.animationFillMode="forwards",y=S.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=I)})}},T=A=>{A.target===t&&(o.current=uj(n.current))};return t.addEventListener("animationstart",T),t.addEventListener("animationcancel",b),t.addEventListener("animationend",b),()=>{S.clearTimeout(y),t.removeEventListener("animationstart",T),t.removeEventListener("animationcancel",b),t.removeEventListener("animationend",b)}}else m("ANIMATION_END")},[t,m]),{isPresent:["mounted","unmountSuspended"].includes(i),ref:V.useCallback(y=>{n.current=y?getComputedStyle(y):null,r(y)},[])}}function uj(e){return(e==null?void 0:e.animationName)||"none"}function $ve(e){var n,s;let t=(n=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:n.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(s=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:s.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var Uve=P4[" useInsertionEffect ".trim().toString()]||io;function Zc({prop:e,defaultProp:t,onChange:r=()=>{},caller:n}){const[s,o,h]=Vve({defaultProp:t,onChange:r}),i=e!==void 0,m=i?e:s;{const S=V.useRef(e!==void 0);V.useEffect(()=>{const b=S.current;b!==i&&console.warn(`${n} is changing from ${b?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),S.current=i},[i,n])}const y=V.useCallback(S=>{var b;if(i){const T=qve(S)?S(e):S;T!==e&&((b=h.current)==null||b.call(h,T))}else o(S)},[i,e,o,h]);return[m,y]}function Vve({defaultProp:e,onChange:t}){const[r,n]=V.useState(e),s=V.useRef(r),o=V.useRef(t);return Uve(()=>{o.current=t},[t]),V.useEffect(()=>{var h;s.current!==r&&((h=o.current)==null||h.call(o,r),s.current=r)},[r,s]),[r,n,o]}function qve(e){return typeof e=="function"}var rQ=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Hve="VisuallyHidden",Xk=V.forwardRef((e,t)=>d.jsx(ln.span,{...e,ref:t,style:{...rQ,...e.style}}));Xk.displayName=Hve;var Gve=Xk,bB="ToastProvider",[wB,Wve,Kve]=_2("Toast"),[nQ,Xit]=Mo("Toast",[Kve]),[Zve,Yk]=nQ(bB),iQ=e=>{const{__scopeToast:t,label:r="Notification",duration:n=5e3,swipeDirection:s="right",swipeThreshold:o=50,children:h}=e,[i,m]=V.useState(null),[y,S]=V.useState(0),b=V.useRef(!1),T=V.useRef(!1);return r.trim()||console.error(`Invalid prop \`label\` supplied to \`${bB}\`. Expected non-empty \`string\`.`),d.jsx(wB.Provider,{scope:t,children:d.jsx(Zve,{scope:t,label:r,duration:n,swipeDirection:s,swipeThreshold:o,toastCount:y,viewport:i,onViewportChange:m,onToastAdd:V.useCallback(()=>S(A=>A+1),[]),onToastRemove:V.useCallback(()=>S(A=>A-1),[]),isFocusedToastEscapeKeyDownRef:b,isClosePausedRef:T,children:h})})};iQ.displayName=bB;var sQ="ToastViewport",Xve=["F8"],T3="toast.viewportPause",A3="toast.viewportResume",aQ=V.forwardRef((e,t)=>{const{__scopeToast:r,hotkey:n=Xve,label:s="Notifications ({hotkey})",...o}=e,h=Yk(sQ,r),i=Wve(r),m=V.useRef(null),y=V.useRef(null),S=V.useRef(null),b=V.useRef(null),T=Un(t,b,h.onViewportChange),A=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),O=h.toastCount>0;V.useEffect(()=>{const I=R=>{var F;n.length!==0&&n.every(z=>R[z]||R.code===z)&&((F=b.current)==null||F.focus())};return document.addEventListener("keydown",I),()=>document.removeEventListener("keydown",I)},[n]),V.useEffect(()=>{const I=m.current,R=b.current;if(O&&I&&R){const M=()=>{if(!h.isClosePausedRef.current){const W=new CustomEvent(T3);R.dispatchEvent(W),h.isClosePausedRef.current=!0}},F=()=>{if(h.isClosePausedRef.current){const W=new CustomEvent(A3);R.dispatchEvent(W),h.isClosePausedRef.current=!1}},z=W=>{!I.contains(W.relatedTarget)&&F()},$=()=>{I.contains(document.activeElement)||F()};return I.addEventListener("focusin",M),I.addEventListener("focusout",z),I.addEventListener("pointermove",M),I.addEventListener("pointerleave",$),window.addEventListener("blur",M),window.addEventListener("focus",F),()=>{I.removeEventListener("focusin",M),I.removeEventListener("focusout",z),I.removeEventListener("pointermove",M),I.removeEventListener("pointerleave",$),window.removeEventListener("blur",M),window.removeEventListener("focus",F)}}},[O,h.isClosePausedRef]);const P=V.useCallback(({tabbingDirection:I})=>{const M=i().map(F=>{const z=F.ref.current,$=[z,...c_e(z)];return I==="forwards"?$:$.reverse()});return(I==="forwards"?M.reverse():M).flat()},[i]);return V.useEffect(()=>{const I=b.current;if(I){const R=M=>{var $,W,K;const F=M.altKey||M.ctrlKey||M.metaKey;if(M.key==="Tab"&&!F){const ee=document.activeElement,ne=M.shiftKey;if(M.target===I&&ne){($=y.current)==null||$.focus();return}const te=P({tabbingDirection:ne?"backwards":"forwards"}),ae=te.findIndex(ue=>ue===ee);SD(te.slice(ae+1))?M.preventDefault():ne?(W=y.current)==null||W.focus():(K=S.current)==null||K.focus()}};return I.addEventListener("keydown",R),()=>I.removeEventListener("keydown",R)}},[i,P]),d.jsxs(Lve,{ref:m,role:"region","aria-label":s.replace("{hotkey}",A),tabIndex:-1,style:{pointerEvents:O?void 0:"none"},children:[O&&d.jsx(C3,{ref:y,onFocusFromOutsideViewport:()=>{const I=P({tabbingDirection:"forwards"});SD(I)}}),d.jsx(wB.Slot,{scope:r,children:d.jsx(ln.ol,{tabIndex:-1,...o,ref:T})}),O&&d.jsx(C3,{ref:S,onFocusFromOutsideViewport:()=>{const I=P({tabbingDirection:"backwards"});SD(I)}})]})});aQ.displayName=sQ;var oQ="ToastFocusProxy",C3=V.forwardRef((e,t)=>{const{__scopeToast:r,onFocusFromOutsideViewport:n,...s}=e,o=Yk(oQ,r);return d.jsx(Xk,{"aria-hidden":!0,tabIndex:0,...s,ref:t,style:{position:"fixed"},onFocus:h=>{var y;const i=h.relatedTarget;!((y=o.viewport)!=null&&y.contains(i))&&n()}})});C3.displayName=oQ;var x2="Toast",Yve="toast.swipeStart",Jve="toast.swipeMove",Qve="toast.swipeCancel",e_e="toast.swipeEnd",lQ=V.forwardRef((e,t)=>{const{forceMount:r,open:n,defaultOpen:s,onOpenChange:o,...h}=e,[i,m]=Zc({prop:n,defaultProp:s??!0,onChange:o,caller:x2});return d.jsx(Do,{present:r||i,children:d.jsx(n_e,{open:i,...h,ref:t,onClose:()=>m(!1),onPause:no(e.onPause),onResume:no(e.onResume),onSwipeStart:Ir(e.onSwipeStart,y=>{y.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Ir(e.onSwipeMove,y=>{const{x:S,y:b}=y.detail.delta;y.currentTarget.setAttribute("data-swipe","move"),y.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${S}px`),y.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${b}px`)}),onSwipeCancel:Ir(e.onSwipeCancel,y=>{y.currentTarget.setAttribute("data-swipe","cancel"),y.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),y.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),y.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),y.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Ir(e.onSwipeEnd,y=>{const{x:S,y:b}=y.detail.delta;y.currentTarget.setAttribute("data-swipe","end"),y.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),y.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),y.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${S}px`),y.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${b}px`),m(!1)})})})});lQ.displayName=x2;var[t_e,r_e]=nQ(x2,{onClose(){}}),n_e=V.forwardRef((e,t)=>{const{__scopeToast:r,type:n="foreground",duration:s,open:o,onClose:h,onEscapeKeyDown:i,onPause:m,onResume:y,onSwipeStart:S,onSwipeMove:b,onSwipeCancel:T,onSwipeEnd:A,...O}=e,P=Yk(x2,r),[I,R]=V.useState(null),M=Un(t,ue=>R(ue)),F=V.useRef(null),z=V.useRef(null),$=s||P.duration,W=V.useRef(0),K=V.useRef($),ee=V.useRef(0),{onToastAdd:ne,onToastRemove:ie}=P,re=no(()=>{var be;(I==null?void 0:I.contains(document.activeElement))&&((be=P.viewport)==null||be.focus()),h()}),te=V.useCallback(ue=>{!ue||ue===1/0||(window.clearTimeout(ee.current),W.current=new Date().getTime(),ee.current=window.setTimeout(re,ue))},[re]);V.useEffect(()=>{const ue=P.viewport;if(ue){const be=()=>{te(K.current),y==null||y()},we=()=>{const Ce=new Date().getTime()-W.current;K.current=K.current-Ce,window.clearTimeout(ee.current),m==null||m()};return ue.addEventListener(T3,we),ue.addEventListener(A3,be),()=>{ue.removeEventListener(T3,we),ue.removeEventListener(A3,be)}}},[P.viewport,$,m,y,te]),V.useEffect(()=>{o&&!P.isClosePausedRef.current&&te($)},[o,$,P.isClosePausedRef,te]),V.useEffect(()=>(ne(),()=>ie()),[ne,ie]);const ae=V.useMemo(()=>I?mQ(I):null,[I]);return P.viewport?d.jsxs(d.Fragment,{children:[ae&&d.jsx(i_e,{__scopeToast:r,role:"status","aria-live":n==="foreground"?"assertive":"polite","aria-atomic":!0,children:ae}),d.jsx(t_e,{scope:r,onClose:re,children:vg.createPortal(d.jsx(wB.ItemSlot,{scope:r,children:d.jsx(Dve,{asChild:!0,onEscapeKeyDown:Ir(i,()=>{P.isFocusedToastEscapeKeyDownRef.current||re(),P.isFocusedToastEscapeKeyDownRef.current=!1}),children:d.jsx(ln.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":P.swipeDirection,...O,ref:M,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Ir(e.onKeyDown,ue=>{ue.key==="Escape"&&(i==null||i(ue.nativeEvent),ue.nativeEvent.defaultPrevented||(P.isFocusedToastEscapeKeyDownRef.current=!0,re()))}),onPointerDown:Ir(e.onPointerDown,ue=>{ue.button===0&&(F.current={x:ue.clientX,y:ue.clientY})}),onPointerMove:Ir(e.onPointerMove,ue=>{if(!F.current)return;const be=ue.clientX-F.current.x,we=ue.clientY-F.current.y,Ce=!!z.current,_e=["left","right"].includes(P.swipeDirection),me=["left","up"].includes(P.swipeDirection)?Math.min:Math.max,Ae=_e?me(0,be):0,ge=_e?0:me(0,we),pe=ue.pointerType==="touch"?10:2,Oe={x:Ae,y:ge},Je={originalEvent:ue,delta:Oe};Ce?(z.current=Oe,dj(Jve,b,Je,{discrete:!1})):I9(Oe,P.swipeDirection,pe)?(z.current=Oe,dj(Yve,S,Je,{discrete:!1}),ue.target.setPointerCapture(ue.pointerId)):(Math.abs(be)>pe||Math.abs(we)>pe)&&(F.current=null)}),onPointerUp:Ir(e.onPointerUp,ue=>{const be=z.current,we=ue.target;if(we.hasPointerCapture(ue.pointerId)&&we.releasePointerCapture(ue.pointerId),z.current=null,F.current=null,be){const Ce=ue.currentTarget,_e={originalEvent:ue,delta:be};I9(be,P.swipeDirection,P.swipeThreshold)?dj(e_e,A,_e,{discrete:!0}):dj(Qve,T,_e,{discrete:!0}),Ce.addEventListener("click",me=>me.preventDefault(),{once:!0})}})})})}),P.viewport)})]}):null}),i_e=e=>{const{__scopeToast:t,children:r,...n}=e,s=Yk(x2,t),[o,h]=V.useState(!1),[i,m]=V.useState(!1);return o_e(()=>h(!0)),V.useEffect(()=>{const y=window.setTimeout(()=>m(!0),1e3);return()=>window.clearTimeout(y)},[]),i?null:d.jsx(Yb,{asChild:!0,children:d.jsx(Xk,{...n,children:o&&d.jsxs(d.Fragment,{children:[s.label," ",r]})})})},s_e="ToastTitle",cQ=V.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return d.jsx(ln.div,{...n,ref:t})});cQ.displayName=s_e;var a_e="ToastDescription",uQ=V.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return d.jsx(ln.div,{...n,ref:t})});uQ.displayName=a_e;var dQ="ToastAction",hQ=V.forwardRef((e,t)=>{const{altText:r,...n}=e;return r.trim()?d.jsx(pQ,{altText:r,asChild:!0,children:d.jsx(SB,{...n,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${dQ}\`. Expected non-empty \`string\`.`),null)});hQ.displayName=dQ;var fQ="ToastClose",SB=V.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e,s=r_e(fQ,r);return d.jsx(pQ,{asChild:!0,children:d.jsx(ln.button,{type:"button",...n,ref:t,onClick:Ir(e.onClick,s.onClose)})})});SB.displayName=fQ;var pQ=V.forwardRef((e,t)=>{const{__scopeToast:r,altText:n,...s}=e;return d.jsx(ln.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...s,ref:t})});function mQ(e){const t=[];return Array.from(e.childNodes).forEach(n=>{if(n.nodeType===n.TEXT_NODE&&n.textContent&&t.push(n.textContent),l_e(n)){const s=n.ariaHidden||n.hidden||n.style.display==="none",o=n.dataset.radixToastAnnounceExclude==="";if(!s)if(o){const h=n.dataset.radixToastAnnounceAlt;h&&t.push(h)}else t.push(...mQ(n))}}),t}function dj(e,t,r,{discrete:n}){const s=r.originalEvent.currentTarget,o=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r});t&&s.addEventListener(e,t,{once:!0}),n?xB(s,o):s.dispatchEvent(o)}var I9=(e,t,r=0)=>{const n=Math.abs(e.x),s=Math.abs(e.y),o=n>s;return t==="left"||t==="right"?o&&n>r:!o&&s>r};function o_e(e=()=>{}){const t=no(e);io(()=>{let r=0,n=0;return r=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(r),window.cancelAnimationFrame(n)}},[t])}function l_e(e){return e.nodeType===e.ELEMENT_NODE}function c_e(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function SD(e){const t=document.activeElement;return e.some(r=>r===t?!0:(r.focus(),document.activeElement!==t))}var u_e=iQ,gQ=aQ,yQ=lQ,vQ=cQ,_Q=uQ,xQ=hQ,bQ=SB;function wQ(e){var t,r,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(r=wQ(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}function Ii(){for(var e,t,r=0,n="",s=arguments.length;r<s;r++)(e=arguments[r])&&(t=wQ(e))&&(n&&(n+=" "),n+=t);return n}const R9=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,M9=Ii,Wv=(e,t)=>r=>{var n;if((t==null?void 0:t.variants)==null)return M9(e,r==null?void 0:r.class,r==null?void 0:r.className);const{variants:s,defaultVariants:o}=t,h=Object.keys(s).map(y=>{const S=r==null?void 0:r[y],b=o==null?void 0:o[y];if(S===null)return null;const T=R9(S)||R9(b);return s[y][T]}),i=r&&Object.entries(r).reduce((y,S)=>{let[b,T]=S;return T===void 0||(y[b]=T),y},{}),m=t==null||(n=t.compoundVariants)===null||n===void 0?void 0:n.reduce((y,S)=>{let{class:b,className:T,...A}=S;return Object.entries(A).every(O=>{let[P,I]=O;return Array.isArray(I)?I.includes({...o,...i}[P]):{...o,...i}[P]===I})?[...y,b,T]:y},[]);return M9(e,h,m,r==null?void 0:r.class,r==null?void 0:r.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d_e=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),SQ=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var h_e={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f_e=V.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:s="",children:o,iconNode:h,...i},m)=>V.createElement("svg",{ref:m,...h_e,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:SQ("lucide",s),...i},[...h.map(([y,S])=>V.createElement(y,S)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vr=(e,t)=>{const r=V.forwardRef(({className:n,...s},o)=>V.createElement(f_e,{ref:o,iconNode:t,className:SQ(`lucide-${d_e(e)}`,n),...s}));return r.displayName=`${e}`,r};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EB=Vr("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EQ=Vr("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p_e=Vr("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m_e=Vr("BellRing",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TQ=Vr("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g_e=Vr("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lE=Vr("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y_e=Vr("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v_e=Vr("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yo=Vr("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __e=Vr("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x_e=Vr("ChartPie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b_e=Vr("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ip=Vr("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vf=Vr("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jk=Vr("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qk=Vr("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w_e=Vr("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eN=Vr("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S_e=Vr("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UP=Vr("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AQ=Vr("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VP=Vr("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CQ=Vr("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j3=Vr("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kv=Vr("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E_e=Vr("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T_e=Vr("Crop",[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qP=Vr("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A_e=Vr("Dot",[["circle",{cx:"12.1",cy:"12.1",r:"1",key:"18d7e5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tN=Vr("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TB=Vr("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D9=Vr("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AB=Vr("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rb=Vr("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rN=Vr("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nP=Vr("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C_e=Vr("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fv=Vr("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HP=Vr("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jQ=Vr("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L9=Vr("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j_e=Vr("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P_e=Vr("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O_e=Vr("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k_e=Vr("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PQ=Vr("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=Vr("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N_e=Vr("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F9=Vr("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OQ=Vr("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pa=Vr("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kQ=Vr("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I_e=Vr("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R_e=Vr("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NQ=Vr("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FS=Vr("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GP=Vr("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M_e=Vr("Minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gu=Vr("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D_e=Vr("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L_e=Vr("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jb=Vr("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F_e=Vr("Pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sp=Vr("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z_e=Vr("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B_e=Vr("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P3=Vr("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xh=Vr("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $_e=Vr("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zx=Vr("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nN=Vr("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lc=Vr("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oT=Vr("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b2=Vr("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Al=Vr("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Io=Vr("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wv=Vr("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yh=Vr("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IQ=Vr("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zh=Vr("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RQ=Vr("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kE=Vr("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T0=Vr("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bc=Vr("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nb=Vr("UtensilsCrossed",[["path",{d:"m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8",key:"n7qcjb"}],["path",{d:"M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7",key:"d0u48b"}],["path",{d:"m2.1 21.8 6.4-6.3",key:"yn04lh"}],["path",{d:"m19 5-7 7",key:"194lzd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U_e=Vr("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xc=Vr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),CB="-",V_e=e=>{const t=H_e(e),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=e;return{getClassGroupId:h=>{const i=h.split(CB);return i[0]===""&&i.length!==1&&i.shift(),MQ(i,t)||q_e(h)},getConflictingClassGroupIds:(h,i)=>{const m=r[h]||[];return i&&n[h]?[...m,...n[h]]:m}}},MQ=(e,t)=>{var h;if(e.length===0)return t.classGroupId;const r=e[0],n=t.nextPart.get(r),s=n?MQ(e.slice(1),n):void 0;if(s)return s;if(t.validators.length===0)return;const o=e.join(CB);return(h=t.validators.find(({validator:i})=>i(o)))==null?void 0:h.classGroupId},z9=/^\[(.+)\]$/,q_e=e=>{if(z9.test(e)){const t=z9.exec(e)[1],r=t==null?void 0:t.substring(0,t.indexOf(":"));if(r)return"arbitrary.."+r}},H_e=e=>{const{theme:t,prefix:r}=e,n={nextPart:new Map,validators:[]};return W_e(Object.entries(e.classGroups),r).forEach(([o,h])=>{O3(h,n,o,t)}),n},O3=(e,t,r,n)=>{e.forEach(s=>{if(typeof s=="string"){const o=s===""?t:B9(t,s);o.classGroupId=r;return}if(typeof s=="function"){if(G_e(s)){O3(s(n),t,r,n);return}t.validators.push({validator:s,classGroupId:r});return}Object.entries(s).forEach(([o,h])=>{O3(h,B9(t,o),r,n)})})},B9=(e,t)=>{let r=e;return t.split(CB).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},G_e=e=>e.isThemeGetter,W_e=(e,t)=>t?e.map(([r,n])=>{const s=n.map(o=>typeof o=="string"?t+o:typeof o=="object"?Object.fromEntries(Object.entries(o).map(([h,i])=>[t+h,i])):o);return[r,s]}):e,K_e=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,r=new Map,n=new Map;const s=(o,h)=>{r.set(o,h),t++,t>e&&(t=0,n=r,r=new Map)};return{get(o){let h=r.get(o);if(h!==void 0)return h;if((h=n.get(o))!==void 0)return s(o,h),h},set(o,h){r.has(o)?r.set(o,h):s(o,h)}}},DQ="!",Z_e=e=>{const{separator:t,experimentalParseClassName:r}=e,n=t.length===1,s=t[0],o=t.length,h=i=>{const m=[];let y=0,S=0,b;for(let I=0;I<i.length;I++){let R=i[I];if(y===0){if(R===s&&(n||i.slice(I,I+o)===t)){m.push(i.slice(S,I)),S=I+o;continue}if(R==="/"){b=I;continue}}R==="["?y++:R==="]"&&y--}const T=m.length===0?i:i.substring(S),A=T.startsWith(DQ),O=A?T.substring(1):T,P=b&&b>S?b-S:void 0;return{modifiers:m,hasImportantModifier:A,baseClassName:O,maybePostfixModifierPosition:P}};return r?i=>r({className:i,parseClassName:h}):h},X_e=e=>{if(e.length<=1)return e;const t=[];let r=[];return e.forEach(n=>{n[0]==="["?(t.push(...r.sort(),n),r=[]):r.push(n)}),t.push(...r.sort()),t},Y_e=e=>({cache:K_e(e.cacheSize),parseClassName:Z_e(e),...V_e(e)}),J_e=/\s+/,Q_e=(e,t)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:s}=t,o=[],h=e.trim().split(J_e);let i="";for(let m=h.length-1;m>=0;m-=1){const y=h[m],{modifiers:S,hasImportantModifier:b,baseClassName:T,maybePostfixModifierPosition:A}=r(y);let O=!!A,P=n(O?T.substring(0,A):T);if(!P){if(!O){i=y+(i.length>0?" "+i:i);continue}if(P=n(T),!P){i=y+(i.length>0?" "+i:i);continue}O=!1}const I=X_e(S).join(":"),R=b?I+DQ:I,M=R+P;if(o.includes(M))continue;o.push(M);const F=s(P,O);for(let z=0;z<F.length;++z){const $=F[z];o.push(R+$)}i=y+(i.length>0?" "+i:i)}return i};function exe(){let e=0,t,r,n="";for(;e<arguments.length;)(t=arguments[e++])&&(r=LQ(t))&&(n&&(n+=" "),n+=r);return n}const LQ=e=>{if(typeof e=="string")return e;let t,r="";for(let n=0;n<e.length;n++)e[n]&&(t=LQ(e[n]))&&(r&&(r+=" "),r+=t);return r};function txe(e,...t){let r,n,s,o=h;function h(m){const y=t.reduce((S,b)=>b(S),e());return r=Y_e(y),n=r.cache.get,s=r.cache.set,o=i,i(m)}function i(m){const y=n(m);if(y)return y;const S=Q_e(m,r);return s(m,S),S}return function(){return o(exe.apply(null,arguments))}}const fa=e=>{const t=r=>r[e]||[];return t.isThemeGetter=!0,t},FQ=/^\[(?:([a-z-]+):)?(.+)\]$/i,rxe=/^\d+\/\d+$/,nxe=new Set(["px","full","screen"]),ixe=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,sxe=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,axe=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,oxe=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,lxe=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Pf=e=>A0(e)||nxe.has(e)||rxe.test(e),dm=e=>Qb(e,"length",gxe),A0=e=>!!e&&!Number.isNaN(Number(e)),ED=e=>Qb(e,"number",A0),zS=e=>!!e&&Number.isInteger(Number(e)),cxe=e=>e.endsWith("%")&&A0(e.slice(0,-1)),Ui=e=>FQ.test(e),hm=e=>ixe.test(e),uxe=new Set(["length","size","percentage"]),dxe=e=>Qb(e,uxe,zQ),hxe=e=>Qb(e,"position",zQ),fxe=new Set(["image","url"]),pxe=e=>Qb(e,fxe,vxe),mxe=e=>Qb(e,"",yxe),BS=()=>!0,Qb=(e,t,r)=>{const n=FQ.exec(e);return n?n[1]?typeof t=="string"?n[1]===t:t.has(n[1]):r(n[2]):!1},gxe=e=>sxe.test(e)&&!axe.test(e),zQ=()=>!1,yxe=e=>oxe.test(e),vxe=e=>lxe.test(e),_xe=()=>{const e=fa("colors"),t=fa("spacing"),r=fa("blur"),n=fa("brightness"),s=fa("borderColor"),o=fa("borderRadius"),h=fa("borderSpacing"),i=fa("borderWidth"),m=fa("contrast"),y=fa("grayscale"),S=fa("hueRotate"),b=fa("invert"),T=fa("gap"),A=fa("gradientColorStops"),O=fa("gradientColorStopPositions"),P=fa("inset"),I=fa("margin"),R=fa("opacity"),M=fa("padding"),F=fa("saturate"),z=fa("scale"),$=fa("sepia"),W=fa("skew"),K=fa("space"),ee=fa("translate"),ne=()=>["auto","contain","none"],ie=()=>["auto","hidden","clip","visible","scroll"],re=()=>["auto",Ui,t],te=()=>[Ui,t],ae=()=>["",Pf,dm],ue=()=>["auto",A0,Ui],be=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],we=()=>["solid","dashed","dotted","double","none"],Ce=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],_e=()=>["start","end","center","between","around","evenly","stretch"],me=()=>["","0",Ui],Ae=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ge=()=>[A0,Ui];return{cacheSize:500,separator:":",theme:{colors:[BS],spacing:[Pf,dm],blur:["none","",hm,Ui],brightness:ge(),borderColor:[e],borderRadius:["none","","full",hm,Ui],borderSpacing:te(),borderWidth:ae(),contrast:ge(),grayscale:me(),hueRotate:ge(),invert:me(),gap:te(),gradientColorStops:[e],gradientColorStopPositions:[cxe,dm],inset:re(),margin:re(),opacity:ge(),padding:te(),saturate:ge(),scale:ge(),sepia:me(),skew:ge(),space:te(),translate:te()},classGroups:{aspect:[{aspect:["auto","square","video",Ui]}],container:["container"],columns:[{columns:[hm]}],"break-after":[{"break-after":Ae()}],"break-before":[{"break-before":Ae()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...be(),Ui]}],overflow:[{overflow:ie()}],"overflow-x":[{"overflow-x":ie()}],"overflow-y":[{"overflow-y":ie()}],overscroll:[{overscroll:ne()}],"overscroll-x":[{"overscroll-x":ne()}],"overscroll-y":[{"overscroll-y":ne()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[P]}],"inset-x":[{"inset-x":[P]}],"inset-y":[{"inset-y":[P]}],start:[{start:[P]}],end:[{end:[P]}],top:[{top:[P]}],right:[{right:[P]}],bottom:[{bottom:[P]}],left:[{left:[P]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",zS,Ui]}],basis:[{basis:re()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Ui]}],grow:[{grow:me()}],shrink:[{shrink:me()}],order:[{order:["first","last","none",zS,Ui]}],"grid-cols":[{"grid-cols":[BS]}],"col-start-end":[{col:["auto",{span:["full",zS,Ui]},Ui]}],"col-start":[{"col-start":ue()}],"col-end":[{"col-end":ue()}],"grid-rows":[{"grid-rows":[BS]}],"row-start-end":[{row:["auto",{span:[zS,Ui]},Ui]}],"row-start":[{"row-start":ue()}],"row-end":[{"row-end":ue()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Ui]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Ui]}],gap:[{gap:[T]}],"gap-x":[{"gap-x":[T]}],"gap-y":[{"gap-y":[T]}],"justify-content":[{justify:["normal",..._e()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",..._e(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[..._e(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[M]}],px:[{px:[M]}],py:[{py:[M]}],ps:[{ps:[M]}],pe:[{pe:[M]}],pt:[{pt:[M]}],pr:[{pr:[M]}],pb:[{pb:[M]}],pl:[{pl:[M]}],m:[{m:[I]}],mx:[{mx:[I]}],my:[{my:[I]}],ms:[{ms:[I]}],me:[{me:[I]}],mt:[{mt:[I]}],mr:[{mr:[I]}],mb:[{mb:[I]}],ml:[{ml:[I]}],"space-x":[{"space-x":[K]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[K]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Ui,t]}],"min-w":[{"min-w":[Ui,t,"min","max","fit"]}],"max-w":[{"max-w":[Ui,t,"none","full","min","max","fit","prose",{screen:[hm]},hm]}],h:[{h:[Ui,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Ui,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Ui,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Ui,t,"auto","min","max","fit"]}],"font-size":[{text:["base",hm,dm]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",ED]}],"font-family":[{font:[BS]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Ui]}],"line-clamp":[{"line-clamp":["none",A0,ED]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Pf,Ui]}],"list-image":[{"list-image":["none",Ui]}],"list-style-type":[{list:["none","disc","decimal",Ui]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[R]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[R]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...we(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Pf,dm]}],"underline-offset":[{"underline-offset":["auto",Pf,Ui]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:te()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ui]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ui]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[R]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...be(),hxe]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",dxe]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},pxe]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[O]}],"gradient-via-pos":[{via:[O]}],"gradient-to-pos":[{to:[O]}],"gradient-from":[{from:[A]}],"gradient-via":[{via:[A]}],"gradient-to":[{to:[A]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[i]}],"border-w-x":[{"border-x":[i]}],"border-w-y":[{"border-y":[i]}],"border-w-s":[{"border-s":[i]}],"border-w-e":[{"border-e":[i]}],"border-w-t":[{"border-t":[i]}],"border-w-r":[{"border-r":[i]}],"border-w-b":[{"border-b":[i]}],"border-w-l":[{"border-l":[i]}],"border-opacity":[{"border-opacity":[R]}],"border-style":[{border:[...we(),"hidden"]}],"divide-x":[{"divide-x":[i]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[i]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[R]}],"divide-style":[{divide:we()}],"border-color":[{border:[s]}],"border-color-x":[{"border-x":[s]}],"border-color-y":[{"border-y":[s]}],"border-color-s":[{"border-s":[s]}],"border-color-e":[{"border-e":[s]}],"border-color-t":[{"border-t":[s]}],"border-color-r":[{"border-r":[s]}],"border-color-b":[{"border-b":[s]}],"border-color-l":[{"border-l":[s]}],"divide-color":[{divide:[s]}],"outline-style":[{outline:["",...we()]}],"outline-offset":[{"outline-offset":[Pf,Ui]}],"outline-w":[{outline:[Pf,dm]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:ae()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[R]}],"ring-offset-w":[{"ring-offset":[Pf,dm]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",hm,mxe]}],"shadow-color":[{shadow:[BS]}],opacity:[{opacity:[R]}],"mix-blend":[{"mix-blend":[...Ce(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Ce()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[m]}],"drop-shadow":[{"drop-shadow":["","none",hm,Ui]}],grayscale:[{grayscale:[y]}],"hue-rotate":[{"hue-rotate":[S]}],invert:[{invert:[b]}],saturate:[{saturate:[F]}],sepia:[{sepia:[$]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[m]}],"backdrop-grayscale":[{"backdrop-grayscale":[y]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[S]}],"backdrop-invert":[{"backdrop-invert":[b]}],"backdrop-opacity":[{"backdrop-opacity":[R]}],"backdrop-saturate":[{"backdrop-saturate":[F]}],"backdrop-sepia":[{"backdrop-sepia":[$]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[h]}],"border-spacing-x":[{"border-spacing-x":[h]}],"border-spacing-y":[{"border-spacing-y":[h]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Ui]}],duration:[{duration:ge()}],ease:[{ease:["linear","in","out","in-out",Ui]}],delay:[{delay:ge()}],animate:[{animate:["none","spin","ping","pulse","bounce",Ui]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[z]}],"scale-x":[{"scale-x":[z]}],"scale-y":[{"scale-y":[z]}],rotate:[{rotate:[zS,Ui]}],"translate-x":[{"translate-x":[ee]}],"translate-y":[{"translate-y":[ee]}],"skew-x":[{"skew-x":[W]}],"skew-y":[{"skew-y":[W]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Ui]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ui]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":te()}],"scroll-mx":[{"scroll-mx":te()}],"scroll-my":[{"scroll-my":te()}],"scroll-ms":[{"scroll-ms":te()}],"scroll-me":[{"scroll-me":te()}],"scroll-mt":[{"scroll-mt":te()}],"scroll-mr":[{"scroll-mr":te()}],"scroll-mb":[{"scroll-mb":te()}],"scroll-ml":[{"scroll-ml":te()}],"scroll-p":[{"scroll-p":te()}],"scroll-px":[{"scroll-px":te()}],"scroll-py":[{"scroll-py":te()}],"scroll-ps":[{"scroll-ps":te()}],"scroll-pe":[{"scroll-pe":te()}],"scroll-pt":[{"scroll-pt":te()}],"scroll-pr":[{"scroll-pr":te()}],"scroll-pb":[{"scroll-pb":te()}],"scroll-pl":[{"scroll-pl":te()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ui]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Pf,dm,ED]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},xxe=txe(_xe);function fr(...e){return xxe(Ii(e))}const bxe=u_e,BQ=V.forwardRef(({className:e,...t},r)=>d.jsx(gQ,{ref:r,className:fr("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));BQ.displayName=gQ.displayName;const wxe=Wv("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),$Q=V.forwardRef(({className:e,variant:t,...r},n)=>d.jsx(yQ,{ref:n,className:fr(wxe({variant:t}),e),...r}));$Q.displayName=yQ.displayName;const Sxe=V.forwardRef(({className:e,...t},r)=>d.jsx(xQ,{ref:r,className:fr("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...t}));Sxe.displayName=xQ.displayName;const UQ=V.forwardRef(({className:e,...t},r)=>d.jsx(bQ,{ref:r,className:fr("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:d.jsx(Xc,{className:"h-4 w-4"})}));UQ.displayName=bQ.displayName;const VQ=V.forwardRef(({className:e,...t},r)=>d.jsx(vQ,{ref:r,className:fr("text-sm font-semibold",e),...t}));VQ.displayName=vQ.displayName;const qQ=V.forwardRef(({className:e,...t},r)=>d.jsx(_Q,{ref:r,className:fr("text-sm opacity-90",e),...t}));qQ.displayName=_Q.displayName;function Exe(){const{toasts:e}=Ri();return d.jsxs(bxe,{children:[e.map(function({id:t,title:r,description:n,action:s,...o}){return d.jsxs($Q,{...o,children:[d.jsxs("div",{className:"grid gap-1",children:[r&&d.jsx(VQ,{children:r}),n&&d.jsx(qQ,{children:n})]}),s,d.jsx(UQ,{})]},t)}),d.jsx(BQ,{})]})}var $9=["light","dark"],Txe="(prefers-color-scheme: dark)",Axe=V.createContext(void 0),Cxe={setTheme:e=>{},themes:[]},jxe=()=>{var e;return(e=V.useContext(Axe))!=null?e:Cxe};V.memo(({forcedTheme:e,storageKey:t,attribute:r,enableSystem:n,enableColorScheme:s,defaultTheme:o,value:h,attrs:i,nonce:m})=>{let y=o==="system",S=r==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${i.map(O=>`'${O}'`).join(",")})`};`:`var d=document.documentElement,n='${r}',s='setAttribute';`,b=s?$9.includes(o)&&o?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${o}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",T=(O,P=!1,I=!0)=>{let R=h?h[O]:O,M=P?O+"|| ''":`'${R}'`,F="";return s&&I&&!P&&$9.includes(O)&&(F+=`d.style.colorScheme = '${O}';`),r==="class"?P||R?F+=`c.add(${M})`:F+="null":R&&(F+=`d[s](n,${M})`),F},A=e?`!function(){${S}${T(e)}}()`:n?`!function(){try{${S}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${y})){var t='${Txe}',m=window.matchMedia(t);if(m.media!==t||m.matches){${T("dark")}}else{${T("light")}}}else if(e){${h?`var x=${JSON.stringify(h)};`:""}${T(h?"x[e]":"e",!0)}}${y?"":"else{"+T(o,!1,!1)+"}"}${b}}catch(e){}}()`:`!function(){try{${S}var e=localStorage.getItem('${t}');if(e){${h?`var x=${JSON.stringify(h)};`:""}${T(h?"x[e]":"e",!0)}}else{${T(o,!1,!1)};}${b}}catch(t){}}();`;return V.createElement("script",{nonce:m,dangerouslySetInnerHTML:{__html:A}})});var Pxe=e=>{switch(e){case"success":return Nxe;case"info":return Rxe;case"warning":return Ixe;case"error":return Mxe;default:return null}},Oxe=Array(12).fill(0),kxe=({visible:e,className:t})=>Ue.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},Ue.createElement("div",{className:"sonner-spinner"},Oxe.map((r,n)=>Ue.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${n}`})))),Nxe=Ue.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ue.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Ixe=Ue.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Ue.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),Rxe=Ue.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ue.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Mxe=Ue.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ue.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Dxe=Ue.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},Ue.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Ue.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Lxe=()=>{let[e,t]=Ue.useState(document.hidden);return Ue.useEffect(()=>{let r=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",r),()=>window.removeEventListener("visibilitychange",r)},[]),e},k3=1,Fxe=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:r,...n}=e,s=typeof(e==null?void 0:e.id)=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:k3++,o=this.toasts.find(i=>i.id===s),h=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(s)&&this.dismissedToasts.delete(s),o?this.toasts=this.toasts.map(i=>i.id===s?(this.publish({...i,...e,id:s,title:r}),{...i,...e,id:s,dismissible:h,title:r}):i):this.addToast({title:r,...n,dismissible:h,id:s}),s},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(t=>{this.subscribers.forEach(r=>r({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let r;t.loading!==void 0&&(r=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let n=e instanceof Promise?e:e(),s=r!==void 0,o,h=n.then(async m=>{if(o=["resolve",m],Ue.isValidElement(m))s=!1,this.create({id:r,type:"default",message:m});else if(Bxe(m)&&!m.ok){s=!1;let y=typeof t.error=="function"?await t.error(`HTTP error! status: ${m.status}`):t.error,S=typeof t.description=="function"?await t.description(`HTTP error! status: ${m.status}`):t.description;this.create({id:r,type:"error",message:y,description:S})}else if(t.success!==void 0){s=!1;let y=typeof t.success=="function"?await t.success(m):t.success,S=typeof t.description=="function"?await t.description(m):t.description;this.create({id:r,type:"success",message:y,description:S})}}).catch(async m=>{if(o=["reject",m],t.error!==void 0){s=!1;let y=typeof t.error=="function"?await t.error(m):t.error,S=typeof t.description=="function"?await t.description(m):t.description;this.create({id:r,type:"error",message:y,description:S})}}).finally(()=>{var m;s&&(this.dismiss(r),r=void 0),(m=t.finally)==null||m.call(t)}),i=()=>new Promise((m,y)=>h.then(()=>o[0]==="reject"?y(o[1]):m(o[1])).catch(y));return typeof r!="string"&&typeof r!="number"?{unwrap:i}:Object.assign(r,{unwrap:i})},this.custom=(e,t)=>{let r=(t==null?void 0:t.id)||k3++;return this.create({jsx:e(r),id:r,...t}),r},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Fc=new Fxe,zxe=(e,t)=>{let r=(t==null?void 0:t.id)||k3++;return Fc.addToast({title:e,...t,id:r}),r},Bxe=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",$xe=zxe,Uxe=()=>Fc.toasts,Vxe=()=>Fc.getActiveToasts(),kr=Object.assign($xe,{success:Fc.success,info:Fc.info,warning:Fc.warning,error:Fc.error,custom:Fc.custom,message:Fc.message,promise:Fc.promise,dismiss:Fc.dismiss,loading:Fc.loading},{getHistory:Uxe,getToasts:Vxe});function qxe(e,{insertAt:t}={}){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t==="top"&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}qxe(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function hj(e){return e.label!==void 0}var Hxe=3,Gxe="32px",Wxe="16px",U9=4e3,Kxe=356,Zxe=14,Xxe=20,Yxe=200;function Td(...e){return e.filter(Boolean).join(" ")}function Jxe(e){let[t,r]=e.split("-"),n=[];return t&&n.push(t),r&&n.push(r),n}var Qxe=e=>{var t,r,n,s,o,h,i,m,y,S,b;let{invert:T,toast:A,unstyled:O,interacting:P,setHeights:I,visibleToasts:R,heights:M,index:F,toasts:z,expanded:$,removeToast:W,defaultRichColors:K,closeButton:ee,style:ne,cancelButtonStyle:ie,actionButtonStyle:re,className:te="",descriptionClassName:ae="",duration:ue,position:be,gap:we,loadingIcon:Ce,expandByDefault:_e,classNames:me,icons:Ae,closeButtonAriaLabel:ge="Close toast",pauseWhenPageIsHidden:pe}=e,[Oe,Je]=Ue.useState(null),[Ze,Pe]=Ue.useState(null),[Be,nt]=Ue.useState(!1),[Me,We]=Ue.useState(!1),[gt,rt]=Ue.useState(!1),[Ht,Lt]=Ue.useState(!1),[nr,Rr]=Ue.useState(!1),[Dr,Pt]=Ue.useState(0),[wt,He]=Ue.useState(0),lt=Ue.useRef(A.duration||ue||U9),ut=Ue.useRef(null),sr=Ue.useRef(null),Qt=F===0,er=F+1<=R,Cr=A.type,dn=A.dismissible!==!1,fn=A.className||"",Zn=A.descriptionClassName||"",Gn=Ue.useMemo(()=>M.findIndex(Ln=>Ln.toastId===A.id)||0,[M,A.id]),Di=Ue.useMemo(()=>{var Ln;return(Ln=A.closeButton)!=null?Ln:ee},[A.closeButton,ee]),ka=Ue.useMemo(()=>A.duration||ue||U9,[A.duration,ue]),xs=Ue.useRef(0),mi=Ue.useRef(0),Ua=Ue.useRef(0),Va=Ue.useRef(null),[Lo,qa]=be.split("-"),Ha=Ue.useMemo(()=>M.reduce((Ln,zi,ms)=>ms>=Gn?Ln:Ln+zi.height,0),[M,Gn]),Fi=Lxe(),Ks=A.invert||T,rl=Cr==="loading";mi.current=Ue.useMemo(()=>Gn*we+Ha,[Gn,Ha]),Ue.useEffect(()=>{lt.current=ka},[ka]),Ue.useEffect(()=>{nt(!0)},[]),Ue.useEffect(()=>{let Ln=sr.current;if(Ln){let zi=Ln.getBoundingClientRect().height;return He(zi),I(ms=>[{toastId:A.id,height:zi,position:A.position},...ms]),()=>I(ms=>ms.filter(Ga=>Ga.toastId!==A.id))}},[I,A.id]),Ue.useLayoutEffect(()=>{if(!Be)return;let Ln=sr.current,zi=Ln.style.height;Ln.style.height="auto";let ms=Ln.getBoundingClientRect().height;Ln.style.height=zi,He(ms),I(Ga=>Ga.find(st=>st.toastId===A.id)?Ga.map(st=>st.toastId===A.id?{...st,height:ms}:st):[{toastId:A.id,height:ms,position:A.position},...Ga])},[Be,A.title,A.description,I,A.id]);let xa=Ue.useCallback(()=>{We(!0),Pt(mi.current),I(Ln=>Ln.filter(zi=>zi.toastId!==A.id)),setTimeout(()=>{W(A)},Yxe)},[A,W,I,mi]);Ue.useEffect(()=>{if(A.promise&&Cr==="loading"||A.duration===1/0||A.type==="loading")return;let Ln;return $||P||pe&&Fi?(()=>{if(Ua.current<xs.current){let zi=new Date().getTime()-xs.current;lt.current=lt.current-zi}Ua.current=new Date().getTime()})():lt.current!==1/0&&(xs.current=new Date().getTime(),Ln=setTimeout(()=>{var zi;(zi=A.onAutoClose)==null||zi.call(A,A),xa()},lt.current)),()=>clearTimeout(Ln)},[$,P,A,Cr,pe,Fi,xa]),Ue.useEffect(()=>{A.delete&&xa()},[xa,A.delete]);function so(){var Ln,zi,ms;return Ae!=null&&Ae.loading?Ue.createElement("div",{className:Td(me==null?void 0:me.loader,(Ln=A==null?void 0:A.classNames)==null?void 0:Ln.loader,"sonner-loader"),"data-visible":Cr==="loading"},Ae.loading):Ce?Ue.createElement("div",{className:Td(me==null?void 0:me.loader,(zi=A==null?void 0:A.classNames)==null?void 0:zi.loader,"sonner-loader"),"data-visible":Cr==="loading"},Ce):Ue.createElement(kxe,{className:Td(me==null?void 0:me.loader,(ms=A==null?void 0:A.classNames)==null?void 0:ms.loader),visible:Cr==="loading"})}return Ue.createElement("li",{tabIndex:0,ref:sr,className:Td(te,fn,me==null?void 0:me.toast,(t=A==null?void 0:A.classNames)==null?void 0:t.toast,me==null?void 0:me.default,me==null?void 0:me[Cr],(r=A==null?void 0:A.classNames)==null?void 0:r[Cr]),"data-sonner-toast":"","data-rich-colors":(n=A.richColors)!=null?n:K,"data-styled":!(A.jsx||A.unstyled||O),"data-mounted":Be,"data-promise":!!A.promise,"data-swiped":nr,"data-removed":Me,"data-visible":er,"data-y-position":Lo,"data-x-position":qa,"data-index":F,"data-front":Qt,"data-swiping":gt,"data-dismissible":dn,"data-type":Cr,"data-invert":Ks,"data-swipe-out":Ht,"data-swipe-direction":Ze,"data-expanded":!!($||_e&&Be),style:{"--index":F,"--toasts-before":F,"--z-index":z.length-F,"--offset":`${Me?Dr:mi.current}px`,"--initial-height":_e?"auto":`${wt}px`,...ne,...A.style},onDragEnd:()=>{rt(!1),Je(null),Va.current=null},onPointerDown:Ln=>{rl||!dn||(ut.current=new Date,Pt(mi.current),Ln.target.setPointerCapture(Ln.pointerId),Ln.target.tagName!=="BUTTON"&&(rt(!0),Va.current={x:Ln.clientX,y:Ln.clientY}))},onPointerUp:()=>{var Ln,zi,ms,Ga;if(Ht||!dn)return;Va.current=null;let st=Number(((Ln=sr.current)==null?void 0:Ln.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),yn=Number(((zi=sr.current)==null?void 0:zi.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Zs=new Date().getTime()-((ms=ut.current)==null?void 0:ms.getTime()),Na=Oe==="x"?st:yn,_n=Math.abs(Na)/Zs;if(Math.abs(Na)>=Xxe||_n>.11){Pt(mi.current),(Ga=A.onDismiss)==null||Ga.call(A,A),Pe(Oe==="x"?st>0?"right":"left":yn>0?"down":"up"),xa(),Lt(!0),Rr(!1);return}rt(!1),Je(null)},onPointerMove:Ln=>{var zi,ms,Ga,st;if(!Va.current||!dn||((zi=window.getSelection())==null?void 0:zi.toString().length)>0)return;let yn=Ln.clientY-Va.current.y,Zs=Ln.clientX-Va.current.x,Na=(ms=e.swipeDirections)!=null?ms:Jxe(be);!Oe&&(Math.abs(Zs)>1||Math.abs(yn)>1)&&Je(Math.abs(Zs)>Math.abs(yn)?"x":"y");let _n={x:0,y:0};Oe==="y"?(Na.includes("top")||Na.includes("bottom"))&&(Na.includes("top")&&yn<0||Na.includes("bottom")&&yn>0)&&(_n.y=yn):Oe==="x"&&(Na.includes("left")||Na.includes("right"))&&(Na.includes("left")&&Zs<0||Na.includes("right")&&Zs>0)&&(_n.x=Zs),(Math.abs(_n.x)>0||Math.abs(_n.y)>0)&&Rr(!0),(Ga=sr.current)==null||Ga.style.setProperty("--swipe-amount-x",`${_n.x}px`),(st=sr.current)==null||st.style.setProperty("--swipe-amount-y",`${_n.y}px`)}},Di&&!A.jsx?Ue.createElement("button",{"aria-label":ge,"data-disabled":rl,"data-close-button":!0,onClick:rl||!dn?()=>{}:()=>{var Ln;xa(),(Ln=A.onDismiss)==null||Ln.call(A,A)},className:Td(me==null?void 0:me.closeButton,(s=A==null?void 0:A.classNames)==null?void 0:s.closeButton)},(o=Ae==null?void 0:Ae.close)!=null?o:Dxe):null,A.jsx||V.isValidElement(A.title)?A.jsx?A.jsx:typeof A.title=="function"?A.title():A.title:Ue.createElement(Ue.Fragment,null,Cr||A.icon||A.promise?Ue.createElement("div",{"data-icon":"",className:Td(me==null?void 0:me.icon,(h=A==null?void 0:A.classNames)==null?void 0:h.icon)},A.promise||A.type==="loading"&&!A.icon?A.icon||so():null,A.type!=="loading"?A.icon||(Ae==null?void 0:Ae[Cr])||Pxe(Cr):null):null,Ue.createElement("div",{"data-content":"",className:Td(me==null?void 0:me.content,(i=A==null?void 0:A.classNames)==null?void 0:i.content)},Ue.createElement("div",{"data-title":"",className:Td(me==null?void 0:me.title,(m=A==null?void 0:A.classNames)==null?void 0:m.title)},typeof A.title=="function"?A.title():A.title),A.description?Ue.createElement("div",{"data-description":"",className:Td(ae,Zn,me==null?void 0:me.description,(y=A==null?void 0:A.classNames)==null?void 0:y.description)},typeof A.description=="function"?A.description():A.description):null),V.isValidElement(A.cancel)?A.cancel:A.cancel&&hj(A.cancel)?Ue.createElement("button",{"data-button":!0,"data-cancel":!0,style:A.cancelButtonStyle||ie,onClick:Ln=>{var zi,ms;hj(A.cancel)&&dn&&((ms=(zi=A.cancel).onClick)==null||ms.call(zi,Ln),xa())},className:Td(me==null?void 0:me.cancelButton,(S=A==null?void 0:A.classNames)==null?void 0:S.cancelButton)},A.cancel.label):null,V.isValidElement(A.action)?A.action:A.action&&hj(A.action)?Ue.createElement("button",{"data-button":!0,"data-action":!0,style:A.actionButtonStyle||re,onClick:Ln=>{var zi,ms;hj(A.action)&&((ms=(zi=A.action).onClick)==null||ms.call(zi,Ln),!Ln.defaultPrevented&&xa())},className:Td(me==null?void 0:me.actionButton,(b=A==null?void 0:A.classNames)==null?void 0:b.actionButton)},A.action.label):null))};function V9(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function e0e(e,t){let r={};return[e,t].forEach((n,s)=>{let o=s===1,h=o?"--mobile-offset":"--offset",i=o?Wxe:Gxe;function m(y){["top","right","bottom","left"].forEach(S=>{r[`${h}-${S}`]=typeof y=="number"?`${y}px`:y})}typeof n=="number"||typeof n=="string"?m(n):typeof n=="object"?["top","right","bottom","left"].forEach(y=>{n[y]===void 0?r[`${h}-${y}`]=i:r[`${h}-${y}`]=typeof n[y]=="number"?`${n[y]}px`:n[y]}):m(i)}),r}var t0e=V.forwardRef(function(e,t){let{invert:r,position:n="bottom-right",hotkey:s=["altKey","KeyT"],expand:o,closeButton:h,className:i,offset:m,mobileOffset:y,theme:S="light",richColors:b,duration:T,style:A,visibleToasts:O=Hxe,toastOptions:P,dir:I=V9(),gap:R=Zxe,loadingIcon:M,icons:F,containerAriaLabel:z="Notifications",pauseWhenPageIsHidden:$}=e,[W,K]=Ue.useState([]),ee=Ue.useMemo(()=>Array.from(new Set([n].concat(W.filter(pe=>pe.position).map(pe=>pe.position)))),[W,n]),[ne,ie]=Ue.useState([]),[re,te]=Ue.useState(!1),[ae,ue]=Ue.useState(!1),[be,we]=Ue.useState(S!=="system"?S:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Ce=Ue.useRef(null),_e=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),me=Ue.useRef(null),Ae=Ue.useRef(!1),ge=Ue.useCallback(pe=>{K(Oe=>{var Je;return(Je=Oe.find(Ze=>Ze.id===pe.id))!=null&&Je.delete||Fc.dismiss(pe.id),Oe.filter(({id:Ze})=>Ze!==pe.id)})},[]);return Ue.useEffect(()=>Fc.subscribe(pe=>{if(pe.dismiss){K(Oe=>Oe.map(Je=>Je.id===pe.id?{...Je,delete:!0}:Je));return}setTimeout(()=>{ZJ.flushSync(()=>{K(Oe=>{let Je=Oe.findIndex(Ze=>Ze.id===pe.id);return Je!==-1?[...Oe.slice(0,Je),{...Oe[Je],...pe},...Oe.slice(Je+1)]:[pe,...Oe]})})})}),[]),Ue.useEffect(()=>{if(S!=="system"){we(S);return}if(S==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?we("dark"):we("light")),typeof window>"u")return;let pe=window.matchMedia("(prefers-color-scheme: dark)");try{pe.addEventListener("change",({matches:Oe})=>{we(Oe?"dark":"light")})}catch{pe.addListener(({matches:Je})=>{try{we(Je?"dark":"light")}catch(Ze){console.error(Ze)}})}},[S]),Ue.useEffect(()=>{W.length<=1&&te(!1)},[W]),Ue.useEffect(()=>{let pe=Oe=>{var Je,Ze;s.every(Pe=>Oe[Pe]||Oe.code===Pe)&&(te(!0),(Je=Ce.current)==null||Je.focus()),Oe.code==="Escape"&&(document.activeElement===Ce.current||(Ze=Ce.current)!=null&&Ze.contains(document.activeElement))&&te(!1)};return document.addEventListener("keydown",pe),()=>document.removeEventListener("keydown",pe)},[s]),Ue.useEffect(()=>{if(Ce.current)return()=>{me.current&&(me.current.focus({preventScroll:!0}),me.current=null,Ae.current=!1)}},[Ce.current]),Ue.createElement("section",{ref:t,"aria-label":`${z} ${_e}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},ee.map((pe,Oe)=>{var Je;let[Ze,Pe]=pe.split("-");return W.length?Ue.createElement("ol",{key:pe,dir:I==="auto"?V9():I,tabIndex:-1,ref:Ce,className:i,"data-sonner-toaster":!0,"data-theme":be,"data-y-position":Ze,"data-lifted":re&&W.length>1&&!o,"data-x-position":Pe,style:{"--front-toast-height":`${((Je=ne[0])==null?void 0:Je.height)||0}px`,"--width":`${Kxe}px`,"--gap":`${R}px`,...A,...e0e(m,y)},onBlur:Be=>{Ae.current&&!Be.currentTarget.contains(Be.relatedTarget)&&(Ae.current=!1,me.current&&(me.current.focus({preventScroll:!0}),me.current=null))},onFocus:Be=>{Be.target instanceof HTMLElement&&Be.target.dataset.dismissible==="false"||Ae.current||(Ae.current=!0,me.current=Be.relatedTarget)},onMouseEnter:()=>te(!0),onMouseMove:()=>te(!0),onMouseLeave:()=>{ae||te(!1)},onDragEnd:()=>te(!1),onPointerDown:Be=>{Be.target instanceof HTMLElement&&Be.target.dataset.dismissible==="false"||ue(!0)},onPointerUp:()=>ue(!1)},W.filter(Be=>!Be.position&&Oe===0||Be.position===pe).map((Be,nt)=>{var Me,We;return Ue.createElement(Qxe,{key:Be.id,icons:F,index:nt,toast:Be,defaultRichColors:b,duration:(Me=P==null?void 0:P.duration)!=null?Me:T,className:P==null?void 0:P.className,descriptionClassName:P==null?void 0:P.descriptionClassName,invert:r,visibleToasts:O,closeButton:(We=P==null?void 0:P.closeButton)!=null?We:h,interacting:ae,position:pe,style:P==null?void 0:P.style,unstyled:P==null?void 0:P.unstyled,classNames:P==null?void 0:P.classNames,cancelButtonStyle:P==null?void 0:P.cancelButtonStyle,actionButtonStyle:P==null?void 0:P.actionButtonStyle,removeToast:ge,toasts:W.filter(gt=>gt.position==Be.position),heights:ne.filter(gt=>gt.position==Be.position),setHeights:ie,expandByDefault:o,gap:R,loadingIcon:M,expanded:re,pauseWhenPageIsHidden:$,swipeDirections:e.swipeDirections})})):null}))});const r0e=({...e})=>{const{theme:t="system"}=jxe();return d.jsx(t0e,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})};var n0e=P4[" useId ".trim().toString()]||(()=>{}),i0e=0;function _u(e){const[t,r]=V.useState(n0e());return io(()=>{r(n=>n??String(i0e++))},[e]),t?`radix-${t}`:""}const s0e=["top","right","bottom","left"],cg=Math.min,hu=Math.max,WP=Math.round,fj=Math.floor,Bh=e=>({x:e,y:e}),a0e={left:"right",right:"left",bottom:"top",top:"bottom"},o0e={start:"end",end:"start"};function N3(e,t,r){return hu(e,cg(t,r))}function ap(e,t){return typeof e=="function"?e(t):e}function op(e){return e.split("-")[0]}function ew(e){return e.split("-")[1]}function jB(e){return e==="x"?"y":"x"}function PB(e){return e==="y"?"height":"width"}const l0e=new Set(["top","bottom"]);function Ph(e){return l0e.has(op(e))?"y":"x"}function OB(e){return jB(Ph(e))}function c0e(e,t,r){r===void 0&&(r=!1);const n=ew(e),s=OB(e),o=PB(s);let h=s==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[o]>t.floating[o]&&(h=KP(h)),[h,KP(h)]}function u0e(e){const t=KP(e);return[I3(e),t,I3(t)]}function I3(e){return e.replace(/start|end/g,t=>o0e[t])}const q9=["left","right"],H9=["right","left"],d0e=["top","bottom"],h0e=["bottom","top"];function f0e(e,t,r){switch(e){case"top":case"bottom":return r?t?H9:q9:t?q9:H9;case"left":case"right":return t?d0e:h0e;default:return[]}}function p0e(e,t,r,n){const s=ew(e);let o=f0e(op(e),r==="start",n);return s&&(o=o.map(h=>h+"-"+s),t&&(o=o.concat(o.map(I3)))),o}function KP(e){return e.replace(/left|right|bottom|top/g,t=>a0e[t])}function m0e(e){return{top:0,right:0,bottom:0,left:0,...e}}function HQ(e){return typeof e!="number"?m0e(e):{top:e,right:e,bottom:e,left:e}}function ZP(e){const{x:t,y:r,width:n,height:s}=e;return{width:n,height:s,top:r,left:t,right:t+n,bottom:r+s,x:t,y:r}}function G9(e,t,r){let{reference:n,floating:s}=e;const o=Ph(t),h=OB(t),i=PB(h),m=op(t),y=o==="y",S=n.x+n.width/2-s.width/2,b=n.y+n.height/2-s.height/2,T=n[i]/2-s[i]/2;let A;switch(m){case"top":A={x:S,y:n.y-s.height};break;case"bottom":A={x:S,y:n.y+n.height};break;case"right":A={x:n.x+n.width,y:b};break;case"left":A={x:n.x-s.width,y:b};break;default:A={x:n.x,y:n.y}}switch(ew(t)){case"start":A[h]-=T*(r&&y?-1:1);break;case"end":A[h]+=T*(r&&y?-1:1);break}return A}const g0e=async(e,t,r)=>{const{placement:n="bottom",strategy:s="absolute",middleware:o=[],platform:h}=r,i=o.filter(Boolean),m=await(h.isRTL==null?void 0:h.isRTL(t));let y=await h.getElementRects({reference:e,floating:t,strategy:s}),{x:S,y:b}=G9(y,n,m),T=n,A={},O=0;for(let P=0;P<i.length;P++){const{name:I,fn:R}=i[P],{x:M,y:F,data:z,reset:$}=await R({x:S,y:b,initialPlacement:n,placement:T,strategy:s,middlewareData:A,rects:y,platform:h,elements:{reference:e,floating:t}});S=M??S,b=F??b,A={...A,[I]:{...A[I],...z}},$&&O<=50&&(O++,typeof $=="object"&&($.placement&&(T=$.placement),$.rects&&(y=$.rects===!0?await h.getElementRects({reference:e,floating:t,strategy:s}):$.rects),{x:S,y:b}=G9(y,T,m)),P=-1)}return{x:S,y:b,placement:T,strategy:s,middlewareData:A}};async function lT(e,t){var r;t===void 0&&(t={});const{x:n,y:s,platform:o,rects:h,elements:i,strategy:m}=e,{boundary:y="clippingAncestors",rootBoundary:S="viewport",elementContext:b="floating",altBoundary:T=!1,padding:A=0}=ap(t,e),O=HQ(A),I=i[T?b==="floating"?"reference":"floating":b],R=ZP(await o.getClippingRect({element:(r=await(o.isElement==null?void 0:o.isElement(I)))==null||r?I:I.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(i.floating)),boundary:y,rootBoundary:S,strategy:m})),M=b==="floating"?{x:n,y:s,width:h.floating.width,height:h.floating.height}:h.reference,F=await(o.getOffsetParent==null?void 0:o.getOffsetParent(i.floating)),z=await(o.isElement==null?void 0:o.isElement(F))?await(o.getScale==null?void 0:o.getScale(F))||{x:1,y:1}:{x:1,y:1},$=ZP(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:i,rect:M,offsetParent:F,strategy:m}):M);return{top:(R.top-$.top+O.top)/z.y,bottom:($.bottom-R.bottom+O.bottom)/z.y,left:(R.left-$.left+O.left)/z.x,right:($.right-R.right+O.right)/z.x}}const y0e=e=>({name:"arrow",options:e,async fn(t){const{x:r,y:n,placement:s,rects:o,platform:h,elements:i,middlewareData:m}=t,{element:y,padding:S=0}=ap(e,t)||{};if(y==null)return{};const b=HQ(S),T={x:r,y:n},A=OB(s),O=PB(A),P=await h.getDimensions(y),I=A==="y",R=I?"top":"left",M=I?"bottom":"right",F=I?"clientHeight":"clientWidth",z=o.reference[O]+o.reference[A]-T[A]-o.floating[O],$=T[A]-o.reference[A],W=await(h.getOffsetParent==null?void 0:h.getOffsetParent(y));let K=W?W[F]:0;(!K||!await(h.isElement==null?void 0:h.isElement(W)))&&(K=i.floating[F]||o.floating[O]);const ee=z/2-$/2,ne=K/2-P[O]/2-1,ie=cg(b[R],ne),re=cg(b[M],ne),te=ie,ae=K-P[O]-re,ue=K/2-P[O]/2+ee,be=N3(te,ue,ae),we=!m.arrow&&ew(s)!=null&&ue!==be&&o.reference[O]/2-(ue<te?ie:re)-P[O]/2<0,Ce=we?ue<te?ue-te:ue-ae:0;return{[A]:T[A]+Ce,data:{[A]:be,centerOffset:ue-be-Ce,...we&&{alignmentOffset:Ce}},reset:we}}}),v0e=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var r,n;const{placement:s,middlewareData:o,rects:h,initialPlacement:i,platform:m,elements:y}=t,{mainAxis:S=!0,crossAxis:b=!0,fallbackPlacements:T,fallbackStrategy:A="bestFit",fallbackAxisSideDirection:O="none",flipAlignment:P=!0,...I}=ap(e,t);if((r=o.arrow)!=null&&r.alignmentOffset)return{};const R=op(s),M=Ph(i),F=op(i)===i,z=await(m.isRTL==null?void 0:m.isRTL(y.floating)),$=T||(F||!P?[KP(i)]:u0e(i)),W=O!=="none";!T&&W&&$.push(...p0e(i,P,O,z));const K=[i,...$],ee=await lT(t,I),ne=[];let ie=((n=o.flip)==null?void 0:n.overflows)||[];if(S&&ne.push(ee[R]),b){const ue=c0e(s,h,z);ne.push(ee[ue[0]],ee[ue[1]])}if(ie=[...ie,{placement:s,overflows:ne}],!ne.every(ue=>ue<=0)){var re,te;const ue=(((re=o.flip)==null?void 0:re.index)||0)+1,be=K[ue];if(be&&(!(b==="alignment"?M!==Ph(be):!1)||ie.every(_e=>_e.overflows[0]>0&&Ph(_e.placement)===M)))return{data:{index:ue,overflows:ie},reset:{placement:be}};let we=(te=ie.filter(Ce=>Ce.overflows[0]<=0).sort((Ce,_e)=>Ce.overflows[1]-_e.overflows[1])[0])==null?void 0:te.placement;if(!we)switch(A){case"bestFit":{var ae;const Ce=(ae=ie.filter(_e=>{if(W){const me=Ph(_e.placement);return me===M||me==="y"}return!0}).map(_e=>[_e.placement,_e.overflows.filter(me=>me>0).reduce((me,Ae)=>me+Ae,0)]).sort((_e,me)=>_e[1]-me[1])[0])==null?void 0:ae[0];Ce&&(we=Ce);break}case"initialPlacement":we=i;break}if(s!==we)return{reset:{placement:we}}}return{}}}};function W9(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function K9(e){return s0e.some(t=>e[t]>=0)}const _0e=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:r}=t,{strategy:n="referenceHidden",...s}=ap(e,t);switch(n){case"referenceHidden":{const o=await lT(t,{...s,elementContext:"reference"}),h=W9(o,r.reference);return{data:{referenceHiddenOffsets:h,referenceHidden:K9(h)}}}case"escaped":{const o=await lT(t,{...s,altBoundary:!0}),h=W9(o,r.floating);return{data:{escapedOffsets:h,escaped:K9(h)}}}default:return{}}}}},GQ=new Set(["left","top"]);async function x0e(e,t){const{placement:r,platform:n,elements:s}=e,o=await(n.isRTL==null?void 0:n.isRTL(s.floating)),h=op(r),i=ew(r),m=Ph(r)==="y",y=GQ.has(h)?-1:1,S=o&&m?-1:1,b=ap(t,e);let{mainAxis:T,crossAxis:A,alignmentAxis:O}=typeof b=="number"?{mainAxis:b,crossAxis:0,alignmentAxis:null}:{mainAxis:b.mainAxis||0,crossAxis:b.crossAxis||0,alignmentAxis:b.alignmentAxis};return i&&typeof O=="number"&&(A=i==="end"?O*-1:O),m?{x:A*S,y:T*y}:{x:T*y,y:A*S}}const b0e=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var r,n;const{x:s,y:o,placement:h,middlewareData:i}=t,m=await x0e(t,e);return h===((r=i.offset)==null?void 0:r.placement)&&(n=i.arrow)!=null&&n.alignmentOffset?{}:{x:s+m.x,y:o+m.y,data:{...m,placement:h}}}}},w0e=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:n,placement:s}=t,{mainAxis:o=!0,crossAxis:h=!1,limiter:i={fn:I=>{let{x:R,y:M}=I;return{x:R,y:M}}},...m}=ap(e,t),y={x:r,y:n},S=await lT(t,m),b=Ph(op(s)),T=jB(b);let A=y[T],O=y[b];if(o){const I=T==="y"?"top":"left",R=T==="y"?"bottom":"right",M=A+S[I],F=A-S[R];A=N3(M,A,F)}if(h){const I=b==="y"?"top":"left",R=b==="y"?"bottom":"right",M=O+S[I],F=O-S[R];O=N3(M,O,F)}const P=i.fn({...t,[T]:A,[b]:O});return{...P,data:{x:P.x-r,y:P.y-n,enabled:{[T]:o,[b]:h}}}}}},S0e=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:r,y:n,placement:s,rects:o,middlewareData:h}=t,{offset:i=0,mainAxis:m=!0,crossAxis:y=!0}=ap(e,t),S={x:r,y:n},b=Ph(s),T=jB(b);let A=S[T],O=S[b];const P=ap(i,t),I=typeof P=="number"?{mainAxis:P,crossAxis:0}:{mainAxis:0,crossAxis:0,...P};if(m){const F=T==="y"?"height":"width",z=o.reference[T]-o.floating[F]+I.mainAxis,$=o.reference[T]+o.reference[F]-I.mainAxis;A<z?A=z:A>$&&(A=$)}if(y){var R,M;const F=T==="y"?"width":"height",z=GQ.has(op(s)),$=o.reference[b]-o.floating[F]+(z&&((R=h.offset)==null?void 0:R[b])||0)+(z?0:I.crossAxis),W=o.reference[b]+o.reference[F]+(z?0:((M=h.offset)==null?void 0:M[b])||0)-(z?I.crossAxis:0);O<$?O=$:O>W&&(O=W)}return{[T]:A,[b]:O}}}},E0e=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var r,n;const{placement:s,rects:o,platform:h,elements:i}=t,{apply:m=()=>{},...y}=ap(e,t),S=await lT(t,y),b=op(s),T=ew(s),A=Ph(s)==="y",{width:O,height:P}=o.floating;let I,R;b==="top"||b==="bottom"?(I=b,R=T===(await(h.isRTL==null?void 0:h.isRTL(i.floating))?"start":"end")?"left":"right"):(R=b,I=T==="end"?"top":"bottom");const M=P-S.top-S.bottom,F=O-S.left-S.right,z=cg(P-S[I],M),$=cg(O-S[R],F),W=!t.middlewareData.shift;let K=z,ee=$;if((r=t.middlewareData.shift)!=null&&r.enabled.x&&(ee=F),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(K=M),W&&!T){const ie=hu(S.left,0),re=hu(S.right,0),te=hu(S.top,0),ae=hu(S.bottom,0);A?ee=O-2*(ie!==0||re!==0?ie+re:hu(S.left,S.right)):K=P-2*(te!==0||ae!==0?te+ae:hu(S.top,S.bottom))}await m({...t,availableWidth:ee,availableHeight:K});const ne=await h.getDimensions(i.floating);return O!==ne.width||P!==ne.height?{reset:{rects:!0}}:{}}}};function iN(){return typeof window<"u"}function tw(e){return WQ(e)?(e.nodeName||"").toLowerCase():"#document"}function xu(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Jh(e){var t;return(t=(WQ(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function WQ(e){return iN()?e instanceof Node||e instanceof xu(e).Node:!1}function Wd(e){return iN()?e instanceof Element||e instanceof xu(e).Element:!1}function Hh(e){return iN()?e instanceof HTMLElement||e instanceof xu(e).HTMLElement:!1}function Z9(e){return!iN()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof xu(e).ShadowRoot}const T0e=new Set(["inline","contents"]);function w2(e){const{overflow:t,overflowX:r,overflowY:n,display:s}=Kd(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!T0e.has(s)}const A0e=new Set(["table","td","th"]);function C0e(e){return A0e.has(tw(e))}const j0e=[":popover-open",":modal"];function sN(e){return j0e.some(t=>{try{return e.matches(t)}catch{return!1}})}const P0e=["transform","translate","scale","rotate","perspective"],O0e=["transform","translate","scale","rotate","perspective","filter"],k0e=["paint","layout","strict","content"];function kB(e){const t=NB(),r=Wd(e)?Kd(e):e;return P0e.some(n=>r[n]?r[n]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!t&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!t&&(r.filter?r.filter!=="none":!1)||O0e.some(n=>(r.willChange||"").includes(n))||k0e.some(n=>(r.contain||"").includes(n))}function N0e(e){let t=ug(e);for(;Hh(t)&&!ib(t);){if(kB(t))return t;if(sN(t))return null;t=ug(t)}return null}function NB(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const I0e=new Set(["html","body","#document"]);function ib(e){return I0e.has(tw(e))}function Kd(e){return xu(e).getComputedStyle(e)}function aN(e){return Wd(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function ug(e){if(tw(e)==="html")return e;const t=e.assignedSlot||e.parentNode||Z9(e)&&e.host||Jh(e);return Z9(t)?t.host:t}function KQ(e){const t=ug(e);return ib(t)?e.ownerDocument?e.ownerDocument.body:e.body:Hh(t)&&w2(t)?t:KQ(t)}function cT(e,t,r){var n;t===void 0&&(t=[]),r===void 0&&(r=!0);const s=KQ(e),o=s===((n=e.ownerDocument)==null?void 0:n.body),h=xu(s);if(o){const i=R3(h);return t.concat(h,h.visualViewport||[],w2(s)?s:[],i&&r?cT(i):[])}return t.concat(s,cT(s,[],r))}function R3(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function ZQ(e){const t=Kd(e);let r=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const s=Hh(e),o=s?e.offsetWidth:r,h=s?e.offsetHeight:n,i=WP(r)!==o||WP(n)!==h;return i&&(r=o,n=h),{width:r,height:n,$:i}}function IB(e){return Wd(e)?e:e.contextElement}function C0(e){const t=IB(e);if(!Hh(t))return Bh(1);const r=t.getBoundingClientRect(),{width:n,height:s,$:o}=ZQ(t);let h=(o?WP(r.width):r.width)/n,i=(o?WP(r.height):r.height)/s;return(!h||!Number.isFinite(h))&&(h=1),(!i||!Number.isFinite(i))&&(i=1),{x:h,y:i}}const R0e=Bh(0);function XQ(e){const t=xu(e);return!NB()||!t.visualViewport?R0e:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function M0e(e,t,r){return t===void 0&&(t=!1),!r||t&&r!==xu(e)?!1:t}function Sv(e,t,r,n){t===void 0&&(t=!1),r===void 0&&(r=!1);const s=e.getBoundingClientRect(),o=IB(e);let h=Bh(1);t&&(n?Wd(n)&&(h=C0(n)):h=C0(e));const i=M0e(o,r,n)?XQ(o):Bh(0);let m=(s.left+i.x)/h.x,y=(s.top+i.y)/h.y,S=s.width/h.x,b=s.height/h.y;if(o){const T=xu(o),A=n&&Wd(n)?xu(n):n;let O=T,P=R3(O);for(;P&&n&&A!==O;){const I=C0(P),R=P.getBoundingClientRect(),M=Kd(P),F=R.left+(P.clientLeft+parseFloat(M.paddingLeft))*I.x,z=R.top+(P.clientTop+parseFloat(M.paddingTop))*I.y;m*=I.x,y*=I.y,S*=I.x,b*=I.y,m+=F,y+=z,O=xu(P),P=R3(O)}}return ZP({width:S,height:b,x:m,y})}function RB(e,t){const r=aN(e).scrollLeft;return t?t.left+r:Sv(Jh(e)).left+r}function YQ(e,t,r){r===void 0&&(r=!1);const n=e.getBoundingClientRect(),s=n.left+t.scrollLeft-(r?0:RB(e,n)),o=n.top+t.scrollTop;return{x:s,y:o}}function D0e(e){let{elements:t,rect:r,offsetParent:n,strategy:s}=e;const o=s==="fixed",h=Jh(n),i=t?sN(t.floating):!1;if(n===h||i&&o)return r;let m={scrollLeft:0,scrollTop:0},y=Bh(1);const S=Bh(0),b=Hh(n);if((b||!b&&!o)&&((tw(n)!=="body"||w2(h))&&(m=aN(n)),Hh(n))){const A=Sv(n);y=C0(n),S.x=A.x+n.clientLeft,S.y=A.y+n.clientTop}const T=h&&!b&&!o?YQ(h,m,!0):Bh(0);return{width:r.width*y.x,height:r.height*y.y,x:r.x*y.x-m.scrollLeft*y.x+S.x+T.x,y:r.y*y.y-m.scrollTop*y.y+S.y+T.y}}function L0e(e){return Array.from(e.getClientRects())}function F0e(e){const t=Jh(e),r=aN(e),n=e.ownerDocument.body,s=hu(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),o=hu(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let h=-r.scrollLeft+RB(e);const i=-r.scrollTop;return Kd(n).direction==="rtl"&&(h+=hu(t.clientWidth,n.clientWidth)-s),{width:s,height:o,x:h,y:i}}function z0e(e,t){const r=xu(e),n=Jh(e),s=r.visualViewport;let o=n.clientWidth,h=n.clientHeight,i=0,m=0;if(s){o=s.width,h=s.height;const y=NB();(!y||y&&t==="fixed")&&(i=s.offsetLeft,m=s.offsetTop)}return{width:o,height:h,x:i,y:m}}const B0e=new Set(["absolute","fixed"]);function $0e(e,t){const r=Sv(e,!0,t==="fixed"),n=r.top+e.clientTop,s=r.left+e.clientLeft,o=Hh(e)?C0(e):Bh(1),h=e.clientWidth*o.x,i=e.clientHeight*o.y,m=s*o.x,y=n*o.y;return{width:h,height:i,x:m,y}}function X9(e,t,r){let n;if(t==="viewport")n=z0e(e,r);else if(t==="document")n=F0e(Jh(e));else if(Wd(t))n=$0e(t,r);else{const s=XQ(e);n={x:t.x-s.x,y:t.y-s.y,width:t.width,height:t.height}}return ZP(n)}function JQ(e,t){const r=ug(e);return r===t||!Wd(r)||ib(r)?!1:Kd(r).position==="fixed"||JQ(r,t)}function U0e(e,t){const r=t.get(e);if(r)return r;let n=cT(e,[],!1).filter(i=>Wd(i)&&tw(i)!=="body"),s=null;const o=Kd(e).position==="fixed";let h=o?ug(e):e;for(;Wd(h)&&!ib(h);){const i=Kd(h),m=kB(h);!m&&i.position==="fixed"&&(s=null),(o?!m&&!s:!m&&i.position==="static"&&!!s&&B0e.has(s.position)||w2(h)&&!m&&JQ(e,h))?n=n.filter(S=>S!==h):s=i,h=ug(h)}return t.set(e,n),n}function V0e(e){let{element:t,boundary:r,rootBoundary:n,strategy:s}=e;const h=[...r==="clippingAncestors"?sN(t)?[]:U0e(t,this._c):[].concat(r),n],i=h[0],m=h.reduce((y,S)=>{const b=X9(t,S,s);return y.top=hu(b.top,y.top),y.right=cg(b.right,y.right),y.bottom=cg(b.bottom,y.bottom),y.left=hu(b.left,y.left),y},X9(t,i,s));return{width:m.right-m.left,height:m.bottom-m.top,x:m.left,y:m.top}}function q0e(e){const{width:t,height:r}=ZQ(e);return{width:t,height:r}}function H0e(e,t,r){const n=Hh(t),s=Jh(t),o=r==="fixed",h=Sv(e,!0,o,t);let i={scrollLeft:0,scrollTop:0};const m=Bh(0);function y(){m.x=RB(s)}if(n||!n&&!o)if((tw(t)!=="body"||w2(s))&&(i=aN(t)),n){const A=Sv(t,!0,o,t);m.x=A.x+t.clientLeft,m.y=A.y+t.clientTop}else s&&y();o&&!n&&s&&y();const S=s&&!n&&!o?YQ(s,i):Bh(0),b=h.left+i.scrollLeft-m.x-S.x,T=h.top+i.scrollTop-m.y-S.y;return{x:b,y:T,width:h.width,height:h.height}}function TD(e){return Kd(e).position==="static"}function Y9(e,t){if(!Hh(e)||Kd(e).position==="fixed")return null;if(t)return t(e);let r=e.offsetParent;return Jh(e)===r&&(r=r.ownerDocument.body),r}function QQ(e,t){const r=xu(e);if(sN(e))return r;if(!Hh(e)){let s=ug(e);for(;s&&!ib(s);){if(Wd(s)&&!TD(s))return s;s=ug(s)}return r}let n=Y9(e,t);for(;n&&C0e(n)&&TD(n);)n=Y9(n,t);return n&&ib(n)&&TD(n)&&!kB(n)?r:n||N0e(e)||r}const G0e=async function(e){const t=this.getOffsetParent||QQ,r=this.getDimensions,n=await r(e.floating);return{reference:H0e(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function W0e(e){return Kd(e).direction==="rtl"}const K0e={convertOffsetParentRelativeRectToViewportRelativeRect:D0e,getDocumentElement:Jh,getClippingRect:V0e,getOffsetParent:QQ,getElementRects:G0e,getClientRects:L0e,getDimensions:q0e,getScale:C0,isElement:Wd,isRTL:W0e};function eee(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function Z0e(e,t){let r=null,n;const s=Jh(e);function o(){var i;clearTimeout(n),(i=r)==null||i.disconnect(),r=null}function h(i,m){i===void 0&&(i=!1),m===void 0&&(m=1),o();const y=e.getBoundingClientRect(),{left:S,top:b,width:T,height:A}=y;if(i||t(),!T||!A)return;const O=fj(b),P=fj(s.clientWidth-(S+T)),I=fj(s.clientHeight-(b+A)),R=fj(S),F={rootMargin:-O+"px "+-P+"px "+-I+"px "+-R+"px",threshold:hu(0,cg(1,m))||1};let z=!0;function $(W){const K=W[0].intersectionRatio;if(K!==m){if(!z)return h();K?h(!1,K):n=setTimeout(()=>{h(!1,1e-7)},1e3)}K===1&&!eee(y,e.getBoundingClientRect())&&h(),z=!1}try{r=new IntersectionObserver($,{...F,root:s.ownerDocument})}catch{r=new IntersectionObserver($,F)}r.observe(e)}return h(!0),o}function X0e(e,t,r,n){n===void 0&&(n={});const{ancestorScroll:s=!0,ancestorResize:o=!0,elementResize:h=typeof ResizeObserver=="function",layoutShift:i=typeof IntersectionObserver=="function",animationFrame:m=!1}=n,y=IB(e),S=s||o?[...y?cT(y):[],...cT(t)]:[];S.forEach(R=>{s&&R.addEventListener("scroll",r,{passive:!0}),o&&R.addEventListener("resize",r)});const b=y&&i?Z0e(y,r):null;let T=-1,A=null;h&&(A=new ResizeObserver(R=>{let[M]=R;M&&M.target===y&&A&&(A.unobserve(t),cancelAnimationFrame(T),T=requestAnimationFrame(()=>{var F;(F=A)==null||F.observe(t)})),r()}),y&&!m&&A.observe(y),A.observe(t));let O,P=m?Sv(e):null;m&&I();function I(){const R=Sv(e);P&&!eee(P,R)&&r(),P=R,O=requestAnimationFrame(I)}return r(),()=>{var R;S.forEach(M=>{s&&M.removeEventListener("scroll",r),o&&M.removeEventListener("resize",r)}),b==null||b(),(R=A)==null||R.disconnect(),A=null,m&&cancelAnimationFrame(O)}}const Y0e=b0e,J0e=w0e,Q0e=v0e,ebe=E0e,tbe=_0e,J9=y0e,rbe=S0e,nbe=(e,t,r)=>{const n=new Map,s={platform:K0e,...r},o={...s.platform,_c:n};return g0e(e,t,{...s,platform:o})};var ibe=typeof document<"u",sbe=function(){},iP=ibe?V.useLayoutEffect:sbe;function XP(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let r,n,s;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(n=r;n--!==0;)if(!XP(e[n],t[n]))return!1;return!0}if(s=Object.keys(e),r=s.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(t,s[n]))return!1;for(n=r;n--!==0;){const o=s[n];if(!(o==="_owner"&&e.$$typeof)&&!XP(e[o],t[o]))return!1}return!0}return e!==e&&t!==t}function tee(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function Q9(e,t){const r=tee(e);return Math.round(t*r)/r}function AD(e){const t=V.useRef(e);return iP(()=>{t.current=e}),t}function abe(e){e===void 0&&(e={});const{placement:t="bottom",strategy:r="absolute",middleware:n=[],platform:s,elements:{reference:o,floating:h}={},transform:i=!0,whileElementsMounted:m,open:y}=e,[S,b]=V.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[T,A]=V.useState(n);XP(T,n)||A(n);const[O,P]=V.useState(null),[I,R]=V.useState(null),M=V.useCallback(_e=>{_e!==W.current&&(W.current=_e,P(_e))},[]),F=V.useCallback(_e=>{_e!==K.current&&(K.current=_e,R(_e))},[]),z=o||O,$=h||I,W=V.useRef(null),K=V.useRef(null),ee=V.useRef(S),ne=m!=null,ie=AD(m),re=AD(s),te=AD(y),ae=V.useCallback(()=>{if(!W.current||!K.current)return;const _e={placement:t,strategy:r,middleware:T};re.current&&(_e.platform=re.current),nbe(W.current,K.current,_e).then(me=>{const Ae={...me,isPositioned:te.current!==!1};ue.current&&!XP(ee.current,Ae)&&(ee.current=Ae,vg.flushSync(()=>{b(Ae)}))})},[T,t,r,re,te]);iP(()=>{y===!1&&ee.current.isPositioned&&(ee.current.isPositioned=!1,b(_e=>({..._e,isPositioned:!1})))},[y]);const ue=V.useRef(!1);iP(()=>(ue.current=!0,()=>{ue.current=!1}),[]),iP(()=>{if(z&&(W.current=z),$&&(K.current=$),z&&$){if(ie.current)return ie.current(z,$,ae);ae()}},[z,$,ae,ie,ne]);const be=V.useMemo(()=>({reference:W,floating:K,setReference:M,setFloating:F}),[M,F]),we=V.useMemo(()=>({reference:z,floating:$}),[z,$]),Ce=V.useMemo(()=>{const _e={position:r,left:0,top:0};if(!we.floating)return _e;const me=Q9(we.floating,S.x),Ae=Q9(we.floating,S.y);return i?{..._e,transform:"translate("+me+"px, "+Ae+"px)",...tee(we.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:me,top:Ae}},[r,i,we.floating,S.x,S.y]);return V.useMemo(()=>({...S,update:ae,refs:be,elements:we,floatingStyles:Ce}),[S,ae,be,we,Ce])}const obe=e=>{function t(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:e,fn(r){const{element:n,padding:s}=typeof e=="function"?e(r):e;return n&&t(n)?n.current!=null?J9({element:n.current,padding:s}).fn(r):{}:n?J9({element:n,padding:s}).fn(r):{}}}},lbe=(e,t)=>({...Y0e(e),options:[e,t]}),cbe=(e,t)=>({...J0e(e),options:[e,t]}),ube=(e,t)=>({...rbe(e),options:[e,t]}),dbe=(e,t)=>({...Q0e(e),options:[e,t]}),hbe=(e,t)=>({...ebe(e),options:[e,t]}),fbe=(e,t)=>({...tbe(e),options:[e,t]}),pbe=(e,t)=>({...obe(e),options:[e,t]});var mbe="Arrow",ree=V.forwardRef((e,t)=>{const{children:r,width:n=10,height:s=5,...o}=e;return d.jsx(ln.svg,{...o,ref:t,width:n,height:s,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:d.jsx("polygon",{points:"0,0 30,0 15,10"})})});ree.displayName=mbe;var gbe=ree;function S2(e){const[t,r]=V.useState(void 0);return io(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});const n=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const o=s[0];let h,i;if("borderBoxSize"in o){const m=o.borderBoxSize,y=Array.isArray(m)?m[0]:m;h=y.inlineSize,i=y.blockSize}else h=e.offsetWidth,i=e.offsetHeight;r({width:h,height:i})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)}else r(void 0)},[e]),t}var MB="Popper",[nee,_g]=Mo(MB),[ybe,iee]=nee(MB),see=e=>{const{__scopePopper:t,children:r}=e,[n,s]=V.useState(null);return d.jsx(ybe,{scope:t,anchor:n,onAnchorChange:s,children:r})};see.displayName=MB;var aee="PopperAnchor",oee=V.forwardRef((e,t)=>{const{__scopePopper:r,virtualRef:n,...s}=e,o=iee(aee,r),h=V.useRef(null),i=Un(t,h);return V.useEffect(()=>{o.onAnchorChange((n==null?void 0:n.current)||h.current)}),n?null:d.jsx(ln.div,{...s,ref:i})});oee.displayName=aee;var DB="PopperContent",[vbe,_be]=nee(DB),lee=V.forwardRef((e,t)=>{var Be,nt,Me,We,gt,rt;const{__scopePopper:r,side:n="bottom",sideOffset:s=0,align:o="center",alignOffset:h=0,arrowPadding:i=0,avoidCollisions:m=!0,collisionBoundary:y=[],collisionPadding:S=0,sticky:b="partial",hideWhenDetached:T=!1,updatePositionStrategy:A="optimized",onPlaced:O,...P}=e,I=iee(DB,r),[R,M]=V.useState(null),F=Un(t,Ht=>M(Ht)),[z,$]=V.useState(null),W=S2(z),K=(W==null?void 0:W.width)??0,ee=(W==null?void 0:W.height)??0,ne=n+(o!=="center"?"-"+o:""),ie=typeof S=="number"?S:{top:0,right:0,bottom:0,left:0,...S},re=Array.isArray(y)?y:[y],te=re.length>0,ae={padding:ie,boundary:re.filter(bbe),altBoundary:te},{refs:ue,floatingStyles:be,placement:we,isPositioned:Ce,middlewareData:_e}=abe({strategy:"fixed",placement:ne,whileElementsMounted:(...Ht)=>X0e(...Ht,{animationFrame:A==="always"}),elements:{reference:I.anchor},middleware:[lbe({mainAxis:s+ee,alignmentAxis:h}),m&&cbe({mainAxis:!0,crossAxis:!1,limiter:b==="partial"?ube():void 0,...ae}),m&&dbe({...ae}),hbe({...ae,apply:({elements:Ht,rects:Lt,availableWidth:nr,availableHeight:Rr})=>{const{width:Dr,height:Pt}=Lt.reference,wt=Ht.floating.style;wt.setProperty("--radix-popper-available-width",`${nr}px`),wt.setProperty("--radix-popper-available-height",`${Rr}px`),wt.setProperty("--radix-popper-anchor-width",`${Dr}px`),wt.setProperty("--radix-popper-anchor-height",`${Pt}px`)}}),z&&pbe({element:z,padding:i}),wbe({arrowWidth:K,arrowHeight:ee}),T&&fbe({strategy:"referenceHidden",...ae})]}),[me,Ae]=dee(we),ge=no(O);io(()=>{Ce&&(ge==null||ge())},[Ce,ge]);const pe=(Be=_e.arrow)==null?void 0:Be.x,Oe=(nt=_e.arrow)==null?void 0:nt.y,Je=((Me=_e.arrow)==null?void 0:Me.centerOffset)!==0,[Ze,Pe]=V.useState();return io(()=>{R&&Pe(window.getComputedStyle(R).zIndex)},[R]),d.jsx("div",{ref:ue.setFloating,"data-radix-popper-content-wrapper":"",style:{...be,transform:Ce?be.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Ze,"--radix-popper-transform-origin":[(We=_e.transformOrigin)==null?void 0:We.x,(gt=_e.transformOrigin)==null?void 0:gt.y].join(" "),...((rt=_e.hide)==null?void 0:rt.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:d.jsx(vbe,{scope:r,placedSide:me,onArrowChange:$,arrowX:pe,arrowY:Oe,shouldHideArrow:Je,children:d.jsx(ln.div,{"data-side":me,"data-align":Ae,...P,ref:F,style:{...P.style,animation:Ce?void 0:"none"}})})})});lee.displayName=DB;var cee="PopperArrow",xbe={top:"bottom",right:"left",bottom:"top",left:"right"},uee=V.forwardRef(function(t,r){const{__scopePopper:n,...s}=t,o=_be(cee,n),h=xbe[o.placedSide];return d.jsx("span",{ref:o.onArrowChange,style:{position:"absolute",left:o.arrowX,top:o.arrowY,[h]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[o.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[o.placedSide],visibility:o.shouldHideArrow?"hidden":void 0},children:d.jsx(gbe,{...s,ref:r,style:{...s.style,display:"block"}})})});uee.displayName=cee;function bbe(e){return e!==null}var wbe=e=>({name:"transformOrigin",options:e,fn(t){var I,R,M;const{placement:r,rects:n,middlewareData:s}=t,h=((I=s.arrow)==null?void 0:I.centerOffset)!==0,i=h?0:e.arrowWidth,m=h?0:e.arrowHeight,[y,S]=dee(r),b={start:"0%",center:"50%",end:"100%"}[S],T=(((R=s.arrow)==null?void 0:R.x)??0)+i/2,A=(((M=s.arrow)==null?void 0:M.y)??0)+m/2;let O="",P="";return y==="bottom"?(O=h?b:`${T}px`,P=`${-m}px`):y==="top"?(O=h?b:`${T}px`,P=`${n.floating.height+m}px`):y==="right"?(O=`${-m}px`,P=h?b:`${A}px`):y==="left"&&(O=`${n.floating.width+m}px`,P=h?b:`${A}px`),{data:{x:O,y:P}}}});function dee(e){const[t,r="center"]=e.split("-");return[t,r]}var oN=see,E2=oee,lN=lee,cN=uee,[uN,Yit]=Mo("Tooltip",[_g]),dN=_g(),hee="TooltipProvider",Sbe=700,M3="tooltip.open",[Ebe,LB]=uN(hee),fee=e=>{const{__scopeTooltip:t,delayDuration:r=Sbe,skipDelayDuration:n=300,disableHoverableContent:s=!1,children:o}=e,h=V.useRef(!0),i=V.useRef(!1),m=V.useRef(0);return V.useEffect(()=>{const y=m.current;return()=>window.clearTimeout(y)},[]),d.jsx(Ebe,{scope:t,isOpenDelayedRef:h,delayDuration:r,onOpen:V.useCallback(()=>{window.clearTimeout(m.current),h.current=!1},[]),onClose:V.useCallback(()=>{window.clearTimeout(m.current),m.current=window.setTimeout(()=>h.current=!0,n)},[n]),isPointerInTransitRef:i,onPointerInTransitChange:V.useCallback(y=>{i.current=y},[]),disableHoverableContent:s,children:o})};fee.displayName=hee;var uT="Tooltip",[Tbe,hN]=uN(uT),pee=e=>{const{__scopeTooltip:t,children:r,open:n,defaultOpen:s,onOpenChange:o,disableHoverableContent:h,delayDuration:i}=e,m=LB(uT,e.__scopeTooltip),y=dN(t),[S,b]=V.useState(null),T=_u(),A=V.useRef(0),O=h??m.disableHoverableContent,P=i??m.delayDuration,I=V.useRef(!1),[R,M]=Zc({prop:n,defaultProp:s??!1,onChange:K=>{K?(m.onOpen(),document.dispatchEvent(new CustomEvent(M3))):m.onClose(),o==null||o(K)},caller:uT}),F=V.useMemo(()=>R?I.current?"delayed-open":"instant-open":"closed",[R]),z=V.useCallback(()=>{window.clearTimeout(A.current),A.current=0,I.current=!1,M(!0)},[M]),$=V.useCallback(()=>{window.clearTimeout(A.current),A.current=0,M(!1)},[M]),W=V.useCallback(()=>{window.clearTimeout(A.current),A.current=window.setTimeout(()=>{I.current=!0,M(!0),A.current=0},P)},[P,M]);return V.useEffect(()=>()=>{A.current&&(window.clearTimeout(A.current),A.current=0)},[]),d.jsx(oN,{...y,children:d.jsx(Tbe,{scope:t,contentId:T,open:R,stateAttribute:F,trigger:S,onTriggerChange:b,onTriggerEnter:V.useCallback(()=>{m.isOpenDelayedRef.current?W():z()},[m.isOpenDelayedRef,W,z]),onTriggerLeave:V.useCallback(()=>{O?$():(window.clearTimeout(A.current),A.current=0)},[$,O]),onOpen:z,onClose:$,disableHoverableContent:O,children:r})})};pee.displayName=uT;var D3="TooltipTrigger",mee=V.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,s=hN(D3,r),o=LB(D3,r),h=dN(r),i=V.useRef(null),m=Un(t,i,s.onTriggerChange),y=V.useRef(!1),S=V.useRef(!1),b=V.useCallback(()=>y.current=!1,[]);return V.useEffect(()=>()=>document.removeEventListener("pointerup",b),[b]),d.jsx(E2,{asChild:!0,...h,children:d.jsx(ln.button,{"aria-describedby":s.open?s.contentId:void 0,"data-state":s.stateAttribute,...n,ref:m,onPointerMove:Ir(e.onPointerMove,T=>{T.pointerType!=="touch"&&!S.current&&!o.isPointerInTransitRef.current&&(s.onTriggerEnter(),S.current=!0)}),onPointerLeave:Ir(e.onPointerLeave,()=>{s.onTriggerLeave(),S.current=!1}),onPointerDown:Ir(e.onPointerDown,()=>{s.open&&s.onClose(),y.current=!0,document.addEventListener("pointerup",b,{once:!0})}),onFocus:Ir(e.onFocus,()=>{y.current||s.onOpen()}),onBlur:Ir(e.onBlur,s.onClose),onClick:Ir(e.onClick,s.onClose)})})});mee.displayName=D3;var Abe="TooltipPortal",[Jit,Cbe]=uN(Abe,{forceMount:void 0}),sb="TooltipContent",gee=V.forwardRef((e,t)=>{const r=Cbe(sb,e.__scopeTooltip),{forceMount:n=r.forceMount,side:s="top",...o}=e,h=hN(sb,e.__scopeTooltip);return d.jsx(Do,{present:n||h.open,children:h.disableHoverableContent?d.jsx(yee,{side:s,...o,ref:t}):d.jsx(jbe,{side:s,...o,ref:t})})}),jbe=V.forwardRef((e,t)=>{const r=hN(sb,e.__scopeTooltip),n=LB(sb,e.__scopeTooltip),s=V.useRef(null),o=Un(t,s),[h,i]=V.useState(null),{trigger:m,onClose:y}=r,S=s.current,{onPointerInTransitChange:b}=n,T=V.useCallback(()=>{i(null),b(!1)},[b]),A=V.useCallback((O,P)=>{const I=O.currentTarget,R={x:O.clientX,y:O.clientY},M=Ibe(R,I.getBoundingClientRect()),F=Rbe(R,M),z=Mbe(P.getBoundingClientRect()),$=Lbe([...F,...z]);i($),b(!0)},[b]);return V.useEffect(()=>()=>T(),[T]),V.useEffect(()=>{if(m&&S){const O=I=>A(I,S),P=I=>A(I,m);return m.addEventListener("pointerleave",O),S.addEventListener("pointerleave",P),()=>{m.removeEventListener("pointerleave",O),S.removeEventListener("pointerleave",P)}}},[m,S,A,T]),V.useEffect(()=>{if(h){const O=P=>{const I=P.target,R={x:P.clientX,y:P.clientY},M=(m==null?void 0:m.contains(I))||(S==null?void 0:S.contains(I)),F=!Dbe(R,h);M?T():F&&(T(),y())};return document.addEventListener("pointermove",O),()=>document.removeEventListener("pointermove",O)}},[m,S,h,y,T]),d.jsx(yee,{...e,ref:o})}),[Pbe,Obe]=uN(uT,{isInside:!1}),kbe=JJ("TooltipContent"),yee=V.forwardRef((e,t)=>{const{__scopeTooltip:r,children:n,"aria-label":s,onEscapeKeyDown:o,onPointerDownOutside:h,...i}=e,m=hN(sb,r),y=dN(r),{onClose:S}=m;return V.useEffect(()=>(document.addEventListener(M3,S),()=>document.removeEventListener(M3,S)),[S]),V.useEffect(()=>{if(m.trigger){const b=T=>{const A=T.target;A!=null&&A.contains(m.trigger)&&S()};return window.addEventListener("scroll",b,{capture:!0}),()=>window.removeEventListener("scroll",b,{capture:!0})}},[m.trigger,S]),d.jsx(Gv,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:o,onPointerDownOutside:h,onFocusOutside:b=>b.preventDefault(),onDismiss:S,children:d.jsxs(lN,{"data-state":m.stateAttribute,...y,...i,ref:t,style:{...i.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[d.jsx(kbe,{children:n}),d.jsx(Pbe,{scope:r,isInside:!0,children:d.jsx(Gve,{id:m.contentId,role:"tooltip",children:s||n})})]})})});gee.displayName=sb;var vee="TooltipArrow",Nbe=V.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,s=dN(r);return Obe(vee,r).isInside?null:d.jsx(cN,{...s,...n,ref:t})});Nbe.displayName=vee;function Ibe(e,t){const r=Math.abs(t.top-e.y),n=Math.abs(t.bottom-e.y),s=Math.abs(t.right-e.x),o=Math.abs(t.left-e.x);switch(Math.min(r,n,s,o)){case o:return"left";case s:return"right";case r:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function Rbe(e,t,r=5){const n=[];switch(t){case"top":n.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":n.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":n.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":n.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r});break}return n}function Mbe(e){const{top:t,right:r,bottom:n,left:s}=e;return[{x:s,y:t},{x:r,y:t},{x:r,y:n},{x:s,y:n}]}function Dbe(e,t){const{x:r,y:n}=e;let s=!1;for(let o=0,h=t.length-1;o<t.length;h=o++){const i=t[o],m=t[h],y=i.x,S=i.y,b=m.x,T=m.y;S>n!=T>n&&r<(b-y)*(n-S)/(T-S)+y&&(s=!s)}return s}function Lbe(e){const t=e.slice();return t.sort((r,n)=>r.x<n.x?-1:r.x>n.x?1:r.y<n.y?-1:r.y>n.y?1:0),Fbe(t)}function Fbe(e){if(e.length<=1)return e.slice();const t=[];for(let n=0;n<e.length;n++){const s=e[n];for(;t.length>=2;){const o=t[t.length-1],h=t[t.length-2];if((o.x-h.x)*(s.y-h.y)>=(o.y-h.y)*(s.x-h.x))t.pop();else break}t.push(s)}t.pop();const r=[];for(let n=e.length-1;n>=0;n--){const s=e[n];for(;r.length>=2;){const o=r[r.length-1],h=r[r.length-2];if((o.x-h.x)*(s.y-h.y)>=(o.y-h.y)*(s.x-h.x))r.pop();else break}r.push(s)}return r.pop(),t.length===1&&r.length===1&&t[0].x===r[0].x&&t[0].y===r[0].y?t:t.concat(r)}var zbe=fee,Bbe=pee,$be=mee,_ee=gee;const xee=zbe,Ube=Bbe,Vbe=$be,bee=V.forwardRef(({className:e,sideOffset:t=4,...r},n)=>d.jsx(_ee,{ref:n,sideOffset:t,className:fr("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r}));bee.displayName=_ee.displayName;var rw=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Ev=typeof window>"u"||"Deno"in globalThis;function lc(){}function qbe(e,t){return typeof e=="function"?e(t):e}function L3(e){return typeof e=="number"&&e>=0&&e!==1/0}function wee(e,t){return Math.max(e+(t||0)-Date.now(),0)}function tg(e,t){return typeof e=="function"?e(t):e}function zu(e,t){return typeof e=="function"?e(t):e}function eH(e,t){const{type:r="all",exact:n,fetchStatus:s,predicate:o,queryKey:h,stale:i}=e;if(h){if(n){if(t.queryHash!==FB(h,t.options))return!1}else if(!dT(t.queryKey,h))return!1}if(r!=="all"){const m=t.isActive();if(r==="active"&&!m||r==="inactive"&&m)return!1}return!(typeof i=="boolean"&&t.isStale()!==i||s&&s!==t.state.fetchStatus||o&&!o(t))}function tH(e,t){const{exact:r,status:n,predicate:s,mutationKey:o}=e;if(o){if(!t.options.mutationKey)return!1;if(r){if(Tv(t.options.mutationKey)!==Tv(o))return!1}else if(!dT(t.options.mutationKey,o))return!1}return!(n&&t.state.status!==n||s&&!s(t))}function FB(e,t){return((t==null?void 0:t.queryKeyHashFn)||Tv)(e)}function Tv(e){return JSON.stringify(e,(t,r)=>F3(r)?Object.keys(r).sort().reduce((n,s)=>(n[s]=r[s],n),{}):r)}function dT(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(r=>dT(e[r],t[r])):!1}function See(e,t){if(e===t)return e;const r=rH(e)&&rH(t);if(r||F3(e)&&F3(t)){const n=r?e:Object.keys(e),s=n.length,o=r?t:Object.keys(t),h=o.length,i=r?[]:{},m=new Set(n);let y=0;for(let S=0;S<h;S++){const b=r?S:o[S];(!r&&m.has(b)||r)&&e[b]===void 0&&t[b]===void 0?(i[b]=void 0,y++):(i[b]=See(e[b],t[b]),i[b]===e[b]&&e[b]!==void 0&&y++)}return s===h&&y===s?e:i}return t}function YP(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}function rH(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function F3(e){if(!nH(e))return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(!nH(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function nH(e){return Object.prototype.toString.call(e)==="[object Object]"}function Hbe(e){return new Promise(t=>{setTimeout(t,e)})}function z3(e,t,r){return typeof r.structuralSharing=="function"?r.structuralSharing(e,t):r.structuralSharing!==!1?See(e,t):t}function Gbe(e,t,r=0){const n=[...e,t];return r&&n.length>r?n.slice(1):n}function Wbe(e,t,r=0){const n=[t,...e];return r&&n.length>r?n.slice(0,-1):n}var zB=Symbol();function Eee(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===zB?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function Tee(e,t){return typeof e=="function"?e(...t):!!e}var rv,Nm,L0,AX,Kbe=(AX=class extends rw{constructor(){super();Wn(this,rv);Wn(this,Nm);Wn(this,L0);mn(this,L0,t=>{if(!Ev&&window.addEventListener){const r=()=>t();return window.addEventListener("visibilitychange",r,!1),()=>{window.removeEventListener("visibilitychange",r)}}})}onSubscribe(){Tt(this,Nm)||this.setEventListener(Tt(this,L0))}onUnsubscribe(){var t;this.hasListeners()||((t=Tt(this,Nm))==null||t.call(this),mn(this,Nm,void 0))}setEventListener(t){var r;mn(this,L0,t),(r=Tt(this,Nm))==null||r.call(this),mn(this,Nm,t(n=>{typeof n=="boolean"?this.setFocused(n):this.onFocus()}))}setFocused(t){Tt(this,rv)!==t&&(mn(this,rv,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(r=>{r(t)})}isFocused(){var t;return typeof Tt(this,rv)=="boolean"?Tt(this,rv):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},rv=new WeakMap,Nm=new WeakMap,L0=new WeakMap,AX),BB=new Kbe,F0,Im,z0,CX,Zbe=(CX=class extends rw{constructor(){super();Wn(this,F0,!0);Wn(this,Im);Wn(this,z0);mn(this,z0,t=>{if(!Ev&&window.addEventListener){const r=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",r,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",n)}}})}onSubscribe(){Tt(this,Im)||this.setEventListener(Tt(this,z0))}onUnsubscribe(){var t;this.hasListeners()||((t=Tt(this,Im))==null||t.call(this),mn(this,Im,void 0))}setEventListener(t){var r;mn(this,z0,t),(r=Tt(this,Im))==null||r.call(this),mn(this,Im,t(this.setOnline.bind(this)))}setOnline(t){Tt(this,F0)!==t&&(mn(this,F0,t),this.listeners.forEach(n=>{n(t)}))}isOnline(){return Tt(this,F0)}},F0=new WeakMap,Im=new WeakMap,z0=new WeakMap,CX),JP=new Zbe;function B3(){let e,t;const r=new Promise((s,o)=>{e=s,t=o});r.status="pending",r.catch(()=>{});function n(s){Object.assign(r,s),delete r.resolve,delete r.reject}return r.resolve=s=>{n({status:"fulfilled",value:s}),e(s)},r.reject=s=>{n({status:"rejected",reason:s}),t(s)},r}function Xbe(e){return Math.min(1e3*2**e,3e4)}function Aee(e){return(e??"online")==="online"?JP.isOnline():!0}var Cee=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function CD(e){return e instanceof Cee}function jee(e){let t=!1,r=0,n=!1,s;const o=B3(),h=P=>{var I;n||(T(new Cee(P)),(I=e.abort)==null||I.call(e))},i=()=>{t=!0},m=()=>{t=!1},y=()=>BB.isFocused()&&(e.networkMode==="always"||JP.isOnline())&&e.canRun(),S=()=>Aee(e.networkMode)&&e.canRun(),b=P=>{var I;n||(n=!0,(I=e.onSuccess)==null||I.call(e,P),s==null||s(),o.resolve(P))},T=P=>{var I;n||(n=!0,(I=e.onError)==null||I.call(e,P),s==null||s(),o.reject(P))},A=()=>new Promise(P=>{var I;s=R=>{(n||y())&&P(R)},(I=e.onPause)==null||I.call(e)}).then(()=>{var P;s=void 0,n||(P=e.onContinue)==null||P.call(e)}),O=()=>{if(n)return;let P;const I=r===0?e.initialPromise:void 0;try{P=I??e.fn()}catch(R){P=Promise.reject(R)}Promise.resolve(P).then(b).catch(R=>{var W;if(n)return;const M=e.retry??(Ev?0:3),F=e.retryDelay??Xbe,z=typeof F=="function"?F(r,R):F,$=M===!0||typeof M=="number"&&r<M||typeof M=="function"&&M(r,R);if(t||!$){T(R);return}r++,(W=e.onFail)==null||W.call(e,r,R),Hbe(z).then(()=>y()?void 0:A()).then(()=>{t?T(R):O()})})};return{promise:o,cancel:h,continue:()=>(s==null||s(),o),cancelRetry:i,continueRetry:m,canStart:S,start:()=>(S()?O():A().then(O),o)}}var Ybe=e=>setTimeout(e,0);function Jbe(){let e=[],t=0,r=i=>{i()},n=i=>{i()},s=Ybe;const o=i=>{t?e.push(i):s(()=>{r(i)})},h=()=>{const i=e;e=[],i.length&&s(()=>{n(()=>{i.forEach(m=>{r(m)})})})};return{batch:i=>{let m;t++;try{m=i()}finally{t--,t||h()}return m},batchCalls:i=>(...m)=>{o(()=>{i(...m)})},schedule:o,setNotifyFunction:i=>{r=i},setBatchNotifyFunction:i=>{n=i},setScheduler:i=>{s=i}}}var Wo=Jbe(),nv,jX,Pee=(jX=class{constructor(){Wn(this,nv)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),L3(this.gcTime)&&mn(this,nv,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(Ev?1/0:5*60*1e3))}clearGcTimeout(){Tt(this,nv)&&(clearTimeout(Tt(this,nv)),mn(this,nv,void 0))}},nv=new WeakMap,jX),B0,iv,Fu,sv,Ll,u2,av,Nd,If,PX,Qbe=(PX=class extends Pee{constructor(t){super();Wn(this,Nd);Wn(this,B0);Wn(this,iv);Wn(this,Fu);Wn(this,sv);Wn(this,Ll);Wn(this,u2);Wn(this,av);mn(this,av,!1),mn(this,u2,t.defaultOptions),this.setOptions(t.options),this.observers=[],mn(this,sv,t.client),mn(this,Fu,Tt(this,sv).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,mn(this,B0,ewe(this.options)),this.state=t.state??Tt(this,B0),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=Tt(this,Ll))==null?void 0:t.promise}setOptions(t){this.options={...Tt(this,u2),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Tt(this,Fu).remove(this)}setData(t,r){const n=z3(this.state.data,t,this.options);return qi(this,Nd,If).call(this,{data:n,type:"success",dataUpdatedAt:r==null?void 0:r.updatedAt,manual:r==null?void 0:r.manual}),n}setState(t,r){qi(this,Nd,If).call(this,{type:"setState",state:t,setStateOptions:r})}cancel(t){var n,s;const r=(n=Tt(this,Ll))==null?void 0:n.promise;return(s=Tt(this,Ll))==null||s.cancel(t),r?r.then(lc).catch(lc):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Tt(this,B0))}isActive(){return this.observers.some(t=>zu(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===zB||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>tg(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!wee(this.state.dataUpdatedAt,t)}onFocus(){var r;const t=this.observers.find(n=>n.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(r=Tt(this,Ll))==null||r.continue()}onOnline(){var r;const t=this.observers.find(n=>n.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(r=Tt(this,Ll))==null||r.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),Tt(this,Fu).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(r=>r!==t),this.observers.length||(Tt(this,Ll)&&(Tt(this,av)?Tt(this,Ll).cancel({revert:!0}):Tt(this,Ll).cancelRetry()),this.scheduleGc()),Tt(this,Fu).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||qi(this,Nd,If).call(this,{type:"invalidate"})}fetch(t,r){var y,S,b;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(r!=null&&r.cancelRefetch))this.cancel({silent:!0});else if(Tt(this,Ll))return Tt(this,Ll).continueRetry(),Tt(this,Ll).promise}if(t&&this.setOptions(t),!this.options.queryFn){const T=this.observers.find(A=>A.options.queryFn);T&&this.setOptions(T.options)}const n=new AbortController,s=T=>{Object.defineProperty(T,"signal",{enumerable:!0,get:()=>(mn(this,av,!0),n.signal)})},o=()=>{const T=Eee(this.options,r),O=(()=>{const P={client:Tt(this,sv),queryKey:this.queryKey,meta:this.meta};return s(P),P})();return mn(this,av,!1),this.options.persister?this.options.persister(T,O,this):T(O)},i=(()=>{const T={fetchOptions:r,options:this.options,queryKey:this.queryKey,client:Tt(this,sv),state:this.state,fetchFn:o};return s(T),T})();(y=this.options.behavior)==null||y.onFetch(i,this),mn(this,iv,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((S=i.fetchOptions)==null?void 0:S.meta))&&qi(this,Nd,If).call(this,{type:"fetch",meta:(b=i.fetchOptions)==null?void 0:b.meta});const m=T=>{var A,O,P,I;CD(T)&&T.silent||qi(this,Nd,If).call(this,{type:"error",error:T}),CD(T)||((O=(A=Tt(this,Fu).config).onError)==null||O.call(A,T,this),(I=(P=Tt(this,Fu).config).onSettled)==null||I.call(P,this.state.data,T,this)),this.scheduleGc()};return mn(this,Ll,jee({initialPromise:r==null?void 0:r.initialPromise,fn:i.fetchFn,abort:n.abort.bind(n),onSuccess:T=>{var A,O,P,I;if(T===void 0){m(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(T)}catch(R){m(R);return}(O=(A=Tt(this,Fu).config).onSuccess)==null||O.call(A,T,this),(I=(P=Tt(this,Fu).config).onSettled)==null||I.call(P,T,this.state.error,this),this.scheduleGc()},onError:m,onFail:(T,A)=>{qi(this,Nd,If).call(this,{type:"failed",failureCount:T,error:A})},onPause:()=>{qi(this,Nd,If).call(this,{type:"pause"})},onContinue:()=>{qi(this,Nd,If).call(this,{type:"continue"})},retry:i.options.retry,retryDelay:i.options.retryDelay,networkMode:i.options.networkMode,canRun:()=>!0})),Tt(this,Ll).start()}},B0=new WeakMap,iv=new WeakMap,Fu=new WeakMap,sv=new WeakMap,Ll=new WeakMap,u2=new WeakMap,av=new WeakMap,Nd=new WeakSet,If=function(t){const r=n=>{switch(t.type){case"failed":return{...n,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...Oee(n.data,this.options),fetchMeta:t.meta??null};case"success":return mn(this,iv,void 0),{...n,data:t.data,dataUpdateCount:n.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const s=t.error;return CD(s)&&s.revert&&Tt(this,iv)?{...Tt(this,iv),fetchStatus:"idle"}:{...n,error:s,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:s,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...t.state}}};this.state=r(this.state),Wo.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),Tt(this,Fu).notify({query:this,type:"updated",action:t})})},PX);function Oee(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Aee(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function ewe(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,r=t!==void 0,n=r?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var wh,OX,twe=(OX=class extends rw{constructor(t={}){super();Wn(this,wh);this.config=t,mn(this,wh,new Map)}build(t,r,n){const s=r.queryKey,o=r.queryHash??FB(s,r);let h=this.get(o);return h||(h=new Qbe({client:t,queryKey:s,queryHash:o,options:t.defaultQueryOptions(r),state:n,defaultOptions:t.getQueryDefaults(s)}),this.add(h)),h}add(t){Tt(this,wh).has(t.queryHash)||(Tt(this,wh).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const r=Tt(this,wh).get(t.queryHash);r&&(t.destroy(),r===t&&Tt(this,wh).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Wo.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return Tt(this,wh).get(t)}getAll(){return[...Tt(this,wh).values()]}find(t){const r={exact:!0,...t};return this.getAll().find(n=>eH(r,n))}findAll(t={}){const r=this.getAll();return Object.keys(t).length>0?r.filter(n=>eH(t,n)):r}notify(t){Wo.batch(()=>{this.listeners.forEach(r=>{r(t)})})}onFocus(){Wo.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Wo.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},wh=new WeakMap,OX),Sh,sc,ov,Eh,mm,kX,rwe=(kX=class extends Pee{constructor(t){super();Wn(this,Eh);Wn(this,Sh);Wn(this,sc);Wn(this,ov);this.mutationId=t.mutationId,mn(this,sc,t.mutationCache),mn(this,Sh,[]),this.state=t.state||kee(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){Tt(this,Sh).includes(t)||(Tt(this,Sh).push(t),this.clearGcTimeout(),Tt(this,sc).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){mn(this,Sh,Tt(this,Sh).filter(r=>r!==t)),this.scheduleGc(),Tt(this,sc).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){Tt(this,Sh).length||(this.state.status==="pending"?this.scheduleGc():Tt(this,sc).remove(this))}continue(){var t;return((t=Tt(this,ov))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var o,h,i,m,y,S,b,T,A,O,P,I,R,M,F,z,$,W,K,ee;const r=()=>{qi(this,Eh,mm).call(this,{type:"continue"})};mn(this,ov,jee({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(ne,ie)=>{qi(this,Eh,mm).call(this,{type:"failed",failureCount:ne,error:ie})},onPause:()=>{qi(this,Eh,mm).call(this,{type:"pause"})},onContinue:r,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Tt(this,sc).canRun(this)}));const n=this.state.status==="pending",s=!Tt(this,ov).canStart();try{if(n)r();else{qi(this,Eh,mm).call(this,{type:"pending",variables:t,isPaused:s}),await((h=(o=Tt(this,sc).config).onMutate)==null?void 0:h.call(o,t,this));const ie=await((m=(i=this.options).onMutate)==null?void 0:m.call(i,t));ie!==this.state.context&&qi(this,Eh,mm).call(this,{type:"pending",context:ie,variables:t,isPaused:s})}const ne=await Tt(this,ov).start();return await((S=(y=Tt(this,sc).config).onSuccess)==null?void 0:S.call(y,ne,t,this.state.context,this)),await((T=(b=this.options).onSuccess)==null?void 0:T.call(b,ne,t,this.state.context)),await((O=(A=Tt(this,sc).config).onSettled)==null?void 0:O.call(A,ne,null,this.state.variables,this.state.context,this)),await((I=(P=this.options).onSettled)==null?void 0:I.call(P,ne,null,t,this.state.context)),qi(this,Eh,mm).call(this,{type:"success",data:ne}),ne}catch(ne){try{throw await((M=(R=Tt(this,sc).config).onError)==null?void 0:M.call(R,ne,t,this.state.context,this)),await((z=(F=this.options).onError)==null?void 0:z.call(F,ne,t,this.state.context)),await((W=($=Tt(this,sc).config).onSettled)==null?void 0:W.call($,void 0,ne,this.state.variables,this.state.context,this)),await((ee=(K=this.options).onSettled)==null?void 0:ee.call(K,void 0,ne,t,this.state.context)),ne}finally{qi(this,Eh,mm).call(this,{type:"error",error:ne})}}finally{Tt(this,sc).runNext(this)}}},Sh=new WeakMap,sc=new WeakMap,ov=new WeakMap,Eh=new WeakSet,mm=function(t){const r=n=>{switch(t.type){case"failed":return{...n,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...n,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:t.error,failureCount:n.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=r(this.state),Wo.batch(()=>{Tt(this,Sh).forEach(n=>{n.onMutationUpdate(t)}),Tt(this,sc).notify({mutation:this,type:"updated",action:t})})},kX);function kee(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Ff,Id,d2,NX,nwe=(NX=class extends rw{constructor(t={}){super();Wn(this,Ff);Wn(this,Id);Wn(this,d2);this.config=t,mn(this,Ff,new Set),mn(this,Id,new Map),mn(this,d2,0)}build(t,r,n){const s=new rwe({mutationCache:this,mutationId:++GC(this,d2)._,options:t.defaultMutationOptions(r),state:n});return this.add(s),s}add(t){Tt(this,Ff).add(t);const r=pj(t);if(typeof r=="string"){const n=Tt(this,Id).get(r);n?n.push(t):Tt(this,Id).set(r,[t])}this.notify({type:"added",mutation:t})}remove(t){if(Tt(this,Ff).delete(t)){const r=pj(t);if(typeof r=="string"){const n=Tt(this,Id).get(r);if(n)if(n.length>1){const s=n.indexOf(t);s!==-1&&n.splice(s,1)}else n[0]===t&&Tt(this,Id).delete(r)}}this.notify({type:"removed",mutation:t})}canRun(t){const r=pj(t);if(typeof r=="string"){const n=Tt(this,Id).get(r),s=n==null?void 0:n.find(o=>o.state.status==="pending");return!s||s===t}else return!0}runNext(t){var n;const r=pj(t);if(typeof r=="string"){const s=(n=Tt(this,Id).get(r))==null?void 0:n.find(o=>o!==t&&o.state.isPaused);return(s==null?void 0:s.continue())??Promise.resolve()}else return Promise.resolve()}clear(){Wo.batch(()=>{Tt(this,Ff).forEach(t=>{this.notify({type:"removed",mutation:t})}),Tt(this,Ff).clear(),Tt(this,Id).clear()})}getAll(){return Array.from(Tt(this,Ff))}find(t){const r={exact:!0,...t};return this.getAll().find(n=>tH(r,n))}findAll(t={}){return this.getAll().filter(r=>tH(t,r))}notify(t){Wo.batch(()=>{this.listeners.forEach(r=>{r(t)})})}resumePausedMutations(){const t=this.getAll().filter(r=>r.state.isPaused);return Wo.batch(()=>Promise.all(t.map(r=>r.continue().catch(lc))))}},Ff=new WeakMap,Id=new WeakMap,d2=new WeakMap,NX);function pj(e){var t;return(t=e.options.scope)==null?void 0:t.id}function iH(e){return{onFetch:(t,r)=>{var S,b,T,A,O;const n=t.options,s=(T=(b=(S=t.fetchOptions)==null?void 0:S.meta)==null?void 0:b.fetchMore)==null?void 0:T.direction,o=((A=t.state.data)==null?void 0:A.pages)||[],h=((O=t.state.data)==null?void 0:O.pageParams)||[];let i={pages:[],pageParams:[]},m=0;const y=async()=>{let P=!1;const I=F=>{Object.defineProperty(F,"signal",{enumerable:!0,get:()=>(t.signal.aborted?P=!0:t.signal.addEventListener("abort",()=>{P=!0}),t.signal)})},R=Eee(t.options,t.fetchOptions),M=async(F,z,$)=>{if(P)return Promise.reject();if(z==null&&F.pages.length)return Promise.resolve(F);const K=(()=>{const re={client:t.client,queryKey:t.queryKey,pageParam:z,direction:$?"backward":"forward",meta:t.options.meta};return I(re),re})(),ee=await R(K),{maxPages:ne}=t.options,ie=$?Wbe:Gbe;return{pages:ie(F.pages,ee,ne),pageParams:ie(F.pageParams,z,ne)}};if(s&&o.length){const F=s==="backward",z=F?iwe:sH,$={pages:o,pageParams:h},W=z(n,$);i=await M($,W,F)}else{const F=e??o.length;do{const z=m===0?h[0]??n.initialPageParam:sH(n,i);if(m>0&&z==null)break;i=await M(i,z),m++}while(m<F)}return i};t.options.persister?t.fetchFn=()=>{var P,I;return(I=(P=t.options).persister)==null?void 0:I.call(P,y,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},r)}:t.fetchFn=y}}}function sH(e,{pages:t,pageParams:r}){const n=t.length-1;return t.length>0?e.getNextPageParam(t[n],t,r[n],r):void 0}function iwe(e,{pages:t,pageParams:r}){var n;return t.length>0?(n=e.getPreviousPageParam)==null?void 0:n.call(e,t[0],t,r[0],r):void 0}var Ja,Rm,Mm,$0,U0,Dm,V0,q0,IX,swe=(IX=class{constructor(e={}){Wn(this,Ja);Wn(this,Rm);Wn(this,Mm);Wn(this,$0);Wn(this,U0);Wn(this,Dm);Wn(this,V0);Wn(this,q0);mn(this,Ja,e.queryCache||new twe),mn(this,Rm,e.mutationCache||new nwe),mn(this,Mm,e.defaultOptions||{}),mn(this,$0,new Map),mn(this,U0,new Map),mn(this,Dm,0)}mount(){GC(this,Dm)._++,Tt(this,Dm)===1&&(mn(this,V0,BB.subscribe(async e=>{e&&(await this.resumePausedMutations(),Tt(this,Ja).onFocus())})),mn(this,q0,JP.subscribe(async e=>{e&&(await this.resumePausedMutations(),Tt(this,Ja).onOnline())})))}unmount(){var e,t;GC(this,Dm)._--,Tt(this,Dm)===0&&((e=Tt(this,V0))==null||e.call(this),mn(this,V0,void 0),(t=Tt(this,q0))==null||t.call(this),mn(this,q0,void 0))}isFetching(e){return Tt(this,Ja).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return Tt(this,Rm).findAll({...e,status:"pending"}).length}getQueryData(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=Tt(this,Ja).get(t.queryHash))==null?void 0:r.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),r=Tt(this,Ja).build(this,t),n=r.state.data;return n===void 0?this.fetchQuery(e):(e.revalidateIfStale&&r.isStaleByTime(tg(t.staleTime,r))&&this.prefetchQuery(t),Promise.resolve(n))}getQueriesData(e){return Tt(this,Ja).findAll(e).map(({queryKey:t,state:r})=>{const n=r.data;return[t,n]})}setQueryData(e,t,r){const n=this.defaultQueryOptions({queryKey:e}),s=Tt(this,Ja).get(n.queryHash),o=s==null?void 0:s.state.data,h=qbe(t,o);if(h!==void 0)return Tt(this,Ja).build(this,n).setData(h,{...r,manual:!0})}setQueriesData(e,t,r){return Wo.batch(()=>Tt(this,Ja).findAll(e).map(({queryKey:n})=>[n,this.setQueryData(n,t,r)]))}getQueryState(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=Tt(this,Ja).get(t.queryHash))==null?void 0:r.state}removeQueries(e){const t=Tt(this,Ja);Wo.batch(()=>{t.findAll(e).forEach(r=>{t.remove(r)})})}resetQueries(e,t){const r=Tt(this,Ja);return Wo.batch(()=>(r.findAll(e).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const r={revert:!0,...t},n=Wo.batch(()=>Tt(this,Ja).findAll(e).map(s=>s.cancel(r)));return Promise.all(n).then(lc).catch(lc)}invalidateQueries(e,t={}){return Wo.batch(()=>(Tt(this,Ja).findAll(e).forEach(r=>{r.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const r={...t,cancelRefetch:t.cancelRefetch??!0},n=Wo.batch(()=>Tt(this,Ja).findAll(e).filter(s=>!s.isDisabled()&&!s.isStatic()).map(s=>{let o=s.fetch(void 0,r);return r.throwOnError||(o=o.catch(lc)),s.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(n).then(lc)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const r=Tt(this,Ja).build(this,t);return r.isStaleByTime(tg(t.staleTime,r))?r.fetch(t):Promise.resolve(r.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(lc).catch(lc)}fetchInfiniteQuery(e){return e.behavior=iH(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(lc).catch(lc)}ensureInfiniteQueryData(e){return e.behavior=iH(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return JP.isOnline()?Tt(this,Rm).resumePausedMutations():Promise.resolve()}getQueryCache(){return Tt(this,Ja)}getMutationCache(){return Tt(this,Rm)}getDefaultOptions(){return Tt(this,Mm)}setDefaultOptions(e){mn(this,Mm,e)}setQueryDefaults(e,t){Tt(this,$0).set(Tv(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...Tt(this,$0).values()],r={};return t.forEach(n=>{dT(e,n.queryKey)&&Object.assign(r,n.defaultOptions)}),r}setMutationDefaults(e,t){Tt(this,U0).set(Tv(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...Tt(this,U0).values()],r={};return t.forEach(n=>{dT(e,n.mutationKey)&&Object.assign(r,n.defaultOptions)}),r}defaultQueryOptions(e){if(e._defaulted)return e;const t={...Tt(this,Mm).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=FB(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===zB&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...Tt(this,Mm).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){Tt(this,Ja).clear(),Tt(this,Rm).clear()}},Ja=new WeakMap,Rm=new WeakMap,Mm=new WeakMap,$0=new WeakMap,U0=new WeakMap,Dm=new WeakMap,V0=new WeakMap,q0=new WeakMap,IX),Rc,fs,h2,ac,lv,H0,Lm,Fm,f2,G0,W0,cv,uv,zm,K0,zs,cE,$3,U3,V3,q3,H3,G3,W3,Nee,RX,awe=(RX=class extends rw{constructor(t,r){super();Wn(this,zs);Wn(this,Rc);Wn(this,fs);Wn(this,h2);Wn(this,ac);Wn(this,lv);Wn(this,H0);Wn(this,Lm);Wn(this,Fm);Wn(this,f2);Wn(this,G0);Wn(this,W0);Wn(this,cv);Wn(this,uv);Wn(this,zm);Wn(this,K0,new Set);this.options=r,mn(this,Rc,t),mn(this,Fm,null),mn(this,Lm,B3()),this.options.experimental_prefetchInRender||Tt(this,Lm).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(r)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(Tt(this,fs).addObserver(this),aH(Tt(this,fs),this.options)?qi(this,zs,cE).call(this):this.updateResult(),qi(this,zs,q3).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return K3(Tt(this,fs),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return K3(Tt(this,fs),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,qi(this,zs,H3).call(this),qi(this,zs,G3).call(this),Tt(this,fs).removeObserver(this)}setOptions(t){const r=this.options,n=Tt(this,fs);if(this.options=Tt(this,Rc).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof zu(this.options.enabled,Tt(this,fs))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");qi(this,zs,W3).call(this),Tt(this,fs).setOptions(this.options),r._defaulted&&!YP(this.options,r)&&Tt(this,Rc).getQueryCache().notify({type:"observerOptionsUpdated",query:Tt(this,fs),observer:this});const s=this.hasListeners();s&&oH(Tt(this,fs),n,this.options,r)&&qi(this,zs,cE).call(this),this.updateResult(),s&&(Tt(this,fs)!==n||zu(this.options.enabled,Tt(this,fs))!==zu(r.enabled,Tt(this,fs))||tg(this.options.staleTime,Tt(this,fs))!==tg(r.staleTime,Tt(this,fs)))&&qi(this,zs,$3).call(this);const o=qi(this,zs,U3).call(this);s&&(Tt(this,fs)!==n||zu(this.options.enabled,Tt(this,fs))!==zu(r.enabled,Tt(this,fs))||o!==Tt(this,zm))&&qi(this,zs,V3).call(this,o)}getOptimisticResult(t){const r=Tt(this,Rc).getQueryCache().build(Tt(this,Rc),t),n=this.createResult(r,t);return lwe(this,n)&&(mn(this,ac,n),mn(this,H0,this.options),mn(this,lv,Tt(this,fs).state)),n}getCurrentResult(){return Tt(this,ac)}trackResult(t,r){return new Proxy(t,{get:(n,s)=>(this.trackProp(s),r==null||r(s),Reflect.get(n,s))})}trackProp(t){Tt(this,K0).add(t)}getCurrentQuery(){return Tt(this,fs)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const r=Tt(this,Rc).defaultQueryOptions(t),n=Tt(this,Rc).getQueryCache().build(Tt(this,Rc),r);return n.fetch().then(()=>this.createResult(n,r))}fetch(t){return qi(this,zs,cE).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),Tt(this,ac)))}createResult(t,r){var ne;const n=Tt(this,fs),s=this.options,o=Tt(this,ac),h=Tt(this,lv),i=Tt(this,H0),y=t!==n?t.state:Tt(this,h2),{state:S}=t;let b={...S},T=!1,A;if(r._optimisticResults){const ie=this.hasListeners(),re=!ie&&aH(t,r),te=ie&&oH(t,n,r,s);(re||te)&&(b={...b,...Oee(S.data,t.options)}),r._optimisticResults==="isRestoring"&&(b.fetchStatus="idle")}let{error:O,errorUpdatedAt:P,status:I}=b;A=b.data;let R=!1;if(r.placeholderData!==void 0&&A===void 0&&I==="pending"){let ie;o!=null&&o.isPlaceholderData&&r.placeholderData===(i==null?void 0:i.placeholderData)?(ie=o.data,R=!0):ie=typeof r.placeholderData=="function"?r.placeholderData((ne=Tt(this,W0))==null?void 0:ne.state.data,Tt(this,W0)):r.placeholderData,ie!==void 0&&(I="success",A=z3(o==null?void 0:o.data,ie,r),T=!0)}if(r.select&&A!==void 0&&!R)if(o&&A===(h==null?void 0:h.data)&&r.select===Tt(this,f2))A=Tt(this,G0);else try{mn(this,f2,r.select),A=r.select(A),A=z3(o==null?void 0:o.data,A,r),mn(this,G0,A),mn(this,Fm,null)}catch(ie){mn(this,Fm,ie)}Tt(this,Fm)&&(O=Tt(this,Fm),A=Tt(this,G0),P=Date.now(),I="error");const M=b.fetchStatus==="fetching",F=I==="pending",z=I==="error",$=F&&M,W=A!==void 0,ee={status:I,fetchStatus:b.fetchStatus,isPending:F,isSuccess:I==="success",isError:z,isInitialLoading:$,isLoading:$,data:A,dataUpdatedAt:b.dataUpdatedAt,error:O,errorUpdatedAt:P,failureCount:b.fetchFailureCount,failureReason:b.fetchFailureReason,errorUpdateCount:b.errorUpdateCount,isFetched:b.dataUpdateCount>0||b.errorUpdateCount>0,isFetchedAfterMount:b.dataUpdateCount>y.dataUpdateCount||b.errorUpdateCount>y.errorUpdateCount,isFetching:M,isRefetching:M&&!F,isLoadingError:z&&!W,isPaused:b.fetchStatus==="paused",isPlaceholderData:T,isRefetchError:z&&W,isStale:$B(t,r),refetch:this.refetch,promise:Tt(this,Lm),isEnabled:zu(r.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const ie=ae=>{ee.status==="error"?ae.reject(ee.error):ee.data!==void 0&&ae.resolve(ee.data)},re=()=>{const ae=mn(this,Lm,ee.promise=B3());ie(ae)},te=Tt(this,Lm);switch(te.status){case"pending":t.queryHash===n.queryHash&&ie(te);break;case"fulfilled":(ee.status==="error"||ee.data!==te.value)&&re();break;case"rejected":(ee.status!=="error"||ee.error!==te.reason)&&re();break}}return ee}updateResult(){const t=Tt(this,ac),r=this.createResult(Tt(this,fs),this.options);if(mn(this,lv,Tt(this,fs).state),mn(this,H0,this.options),Tt(this,lv).data!==void 0&&mn(this,W0,Tt(this,fs)),YP(r,t))return;mn(this,ac,r);const n=()=>{if(!t)return!0;const{notifyOnChangeProps:s}=this.options,o=typeof s=="function"?s():s;if(o==="all"||!o&&!Tt(this,K0).size)return!0;const h=new Set(o??Tt(this,K0));return this.options.throwOnError&&h.add("error"),Object.keys(Tt(this,ac)).some(i=>{const m=i;return Tt(this,ac)[m]!==t[m]&&h.has(m)})};qi(this,zs,Nee).call(this,{listeners:n()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&qi(this,zs,q3).call(this)}},Rc=new WeakMap,fs=new WeakMap,h2=new WeakMap,ac=new WeakMap,lv=new WeakMap,H0=new WeakMap,Lm=new WeakMap,Fm=new WeakMap,f2=new WeakMap,G0=new WeakMap,W0=new WeakMap,cv=new WeakMap,uv=new WeakMap,zm=new WeakMap,K0=new WeakMap,zs=new WeakSet,cE=function(t){qi(this,zs,W3).call(this);let r=Tt(this,fs).fetch(this.options,t);return t!=null&&t.throwOnError||(r=r.catch(lc)),r},$3=function(){qi(this,zs,H3).call(this);const t=tg(this.options.staleTime,Tt(this,fs));if(Ev||Tt(this,ac).isStale||!L3(t))return;const n=wee(Tt(this,ac).dataUpdatedAt,t)+1;mn(this,cv,setTimeout(()=>{Tt(this,ac).isStale||this.updateResult()},n))},U3=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(Tt(this,fs)):this.options.refetchInterval)??!1},V3=function(t){qi(this,zs,G3).call(this),mn(this,zm,t),!(Ev||zu(this.options.enabled,Tt(this,fs))===!1||!L3(Tt(this,zm))||Tt(this,zm)===0)&&mn(this,uv,setInterval(()=>{(this.options.refetchIntervalInBackground||BB.isFocused())&&qi(this,zs,cE).call(this)},Tt(this,zm)))},q3=function(){qi(this,zs,$3).call(this),qi(this,zs,V3).call(this,qi(this,zs,U3).call(this))},H3=function(){Tt(this,cv)&&(clearTimeout(Tt(this,cv)),mn(this,cv,void 0))},G3=function(){Tt(this,uv)&&(clearInterval(Tt(this,uv)),mn(this,uv,void 0))},W3=function(){const t=Tt(this,Rc).getQueryCache().build(Tt(this,Rc),this.options);if(t===Tt(this,fs))return;const r=Tt(this,fs);mn(this,fs,t),mn(this,h2,t.state),this.hasListeners()&&(r==null||r.removeObserver(this),t.addObserver(this))},Nee=function(t){Wo.batch(()=>{t.listeners&&this.listeners.forEach(r=>{r(Tt(this,ac))}),Tt(this,Rc).getQueryCache().notify({query:Tt(this,fs),type:"observerResultsUpdated"})})},RX);function owe(e,t){return zu(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function aH(e,t){return owe(e,t)||e.state.data!==void 0&&K3(e,t,t.refetchOnMount)}function K3(e,t,r){if(zu(t.enabled,e)!==!1&&tg(t.staleTime,e)!=="static"){const n=typeof r=="function"?r(e):r;return n==="always"||n!==!1&&$B(e,t)}return!1}function oH(e,t,r,n){return(e!==t||zu(n.enabled,e)===!1)&&(!r.suspense||e.state.status!=="error")&&$B(e,r)}function $B(e,t){return zu(t.enabled,e)!==!1&&e.isStaleByTime(tg(t.staleTime,e))}function lwe(e,t){return!YP(e.getCurrentResult(),t)}var Bm,$m,Mc,zf,Qf,sP,Z3,MX,cwe=(MX=class extends rw{constructor(r,n){super();Wn(this,Qf);Wn(this,Bm);Wn(this,$m);Wn(this,Mc);Wn(this,zf);mn(this,Bm,r),this.setOptions(n),this.bindMethods(),qi(this,Qf,sP).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(r){var s;const n=this.options;this.options=Tt(this,Bm).defaultMutationOptions(r),YP(this.options,n)||Tt(this,Bm).getMutationCache().notify({type:"observerOptionsUpdated",mutation:Tt(this,Mc),observer:this}),n!=null&&n.mutationKey&&this.options.mutationKey&&Tv(n.mutationKey)!==Tv(this.options.mutationKey)?this.reset():((s=Tt(this,Mc))==null?void 0:s.state.status)==="pending"&&Tt(this,Mc).setOptions(this.options)}onUnsubscribe(){var r;this.hasListeners()||(r=Tt(this,Mc))==null||r.removeObserver(this)}onMutationUpdate(r){qi(this,Qf,sP).call(this),qi(this,Qf,Z3).call(this,r)}getCurrentResult(){return Tt(this,$m)}reset(){var r;(r=Tt(this,Mc))==null||r.removeObserver(this),mn(this,Mc,void 0),qi(this,Qf,sP).call(this),qi(this,Qf,Z3).call(this)}mutate(r,n){var s;return mn(this,zf,n),(s=Tt(this,Mc))==null||s.removeObserver(this),mn(this,Mc,Tt(this,Bm).getMutationCache().build(Tt(this,Bm),this.options)),Tt(this,Mc).addObserver(this),Tt(this,Mc).execute(r)}},Bm=new WeakMap,$m=new WeakMap,Mc=new WeakMap,zf=new WeakMap,Qf=new WeakSet,sP=function(){var n;const r=((n=Tt(this,Mc))==null?void 0:n.state)??kee();mn(this,$m,{...r,isPending:r.status==="pending",isSuccess:r.status==="success",isError:r.status==="error",isIdle:r.status==="idle",mutate:this.mutate,reset:this.reset})},Z3=function(r){Wo.batch(()=>{var n,s,o,h,i,m,y,S;if(Tt(this,zf)&&this.hasListeners()){const b=Tt(this,$m).variables,T=Tt(this,$m).context;(r==null?void 0:r.type)==="success"?((s=(n=Tt(this,zf)).onSuccess)==null||s.call(n,r.data,b,T),(h=(o=Tt(this,zf)).onSettled)==null||h.call(o,r.data,null,b,T)):(r==null?void 0:r.type)==="error"&&((m=(i=Tt(this,zf)).onError)==null||m.call(i,r.error,b,T),(S=(y=Tt(this,zf)).onSettled)==null||S.call(y,void 0,r.error,b,T))}this.listeners.forEach(b=>{b(Tt(this,$m))})})},MX),Iee=V.createContext(void 0),Mi=e=>{const t=V.useContext(Iee);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},uwe=({client:e,children:t})=>(V.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),d.jsx(Iee.Provider,{value:e,children:t})),Ree=V.createContext(!1),dwe=()=>V.useContext(Ree);Ree.Provider;function hwe(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var fwe=V.createContext(hwe()),pwe=()=>V.useContext(fwe),mwe=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},gwe=e=>{V.useEffect(()=>{e.clearReset()},[e])},ywe=({result:e,errorResetBoundary:t,throwOnError:r,query:n,suspense:s})=>e.isError&&!t.isReset()&&!e.isFetching&&n&&(s&&e.data===void 0||Tee(r,[e.error,n])),vwe=e=>{if(e.suspense){const t=n=>n==="static"?n:Math.max(n??1e3,1e3),r=e.staleTime;e.staleTime=typeof r=="function"?(...n)=>t(r(...n)):t(r),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},_we=(e,t)=>e.isLoading&&e.isFetching&&!t,xwe=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,lH=(e,t,r)=>t.fetchOptimistic(e).catch(()=>{r.clearReset()});function bwe(e,t,r){var b,T,A,O,P;const n=dwe(),s=pwe(),o=Mi(),h=o.defaultQueryOptions(e);(T=(b=o.getDefaultOptions().queries)==null?void 0:b._experimental_beforeQuery)==null||T.call(b,h),h._optimisticResults=n?"isRestoring":"optimistic",vwe(h),mwe(h,s),gwe(s);const i=!o.getQueryCache().get(h.queryHash),[m]=V.useState(()=>new t(o,h)),y=m.getOptimisticResult(h),S=!n&&e.subscribed!==!1;if(V.useSyncExternalStore(V.useCallback(I=>{const R=S?m.subscribe(Wo.batchCalls(I)):lc;return m.updateResult(),R},[m,S]),()=>m.getCurrentResult(),()=>m.getCurrentResult()),V.useEffect(()=>{m.setOptions(h)},[h,m]),xwe(h,y))throw lH(h,m,s);if(ywe({result:y,errorResetBoundary:s,throwOnError:h.throwOnError,query:o.getQueryCache().get(h.queryHash),suspense:h.suspense}))throw y.error;if((O=(A=o.getDefaultOptions().queries)==null?void 0:A._experimental_afterQuery)==null||O.call(A,h,y),h.experimental_prefetchInRender&&!Ev&&_we(y,n)){const I=i?lH(h,m,s):(P=o.getQueryCache().get(h.queryHash))==null?void 0:P.promise;I==null||I.catch(lc).finally(()=>{m.updateResult()})}return h.notifyOnChangeProps?y:m.trackResult(y)}function ei(e,t){return bwe(e,awe)}function Gi(e,t){const r=Mi(),[n]=V.useState(()=>new cwe(r,e));V.useEffect(()=>{n.setOptions(e)},[n,e]);const s=V.useSyncExternalStore(V.useCallback(h=>n.subscribe(Wo.batchCalls(h)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),o=V.useCallback((h,i)=>{n.mutate(h,i).catch(lc)},[n]);if(s.error&&Tee(n.options.throwOnError,[s.error]))throw s.error;return{...s,mutate:o,mutateAsync:s.mutate}}/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function hT(){return hT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},hT.apply(this,arguments)}var qm;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(qm||(qm={}));const cH="popstate";function wwe(e){e===void 0&&(e={});function t(n,s){let{pathname:o,search:h,hash:i}=n.location;return X3("",{pathname:o,search:h,hash:i},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function r(n,s){return typeof s=="string"?s:QP(s)}return Ewe(t,r,null,e)}function vo(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Mee(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Swe(){return Math.random().toString(36).substr(2,8)}function uH(e,t){return{usr:e.state,key:e.key,idx:t}}function X3(e,t,r,n){return r===void 0&&(r=null),hT({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?nw(t):t,{state:r,key:t&&t.key||n||Swe()})}function QP(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function nw(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function Ewe(e,t,r,n){n===void 0&&(n={});let{window:s=document.defaultView,v5Compat:o=!1}=n,h=s.history,i=qm.Pop,m=null,y=S();y==null&&(y=0,h.replaceState(hT({},h.state,{idx:y}),""));function S(){return(h.state||{idx:null}).idx}function b(){i=qm.Pop;let I=S(),R=I==null?null:I-y;y=I,m&&m({action:i,location:P.location,delta:R})}function T(I,R){i=qm.Push;let M=X3(P.location,I,R);y=S()+1;let F=uH(M,y),z=P.createHref(M);try{h.pushState(F,"",z)}catch($){if($ instanceof DOMException&&$.name==="DataCloneError")throw $;s.location.assign(z)}o&&m&&m({action:i,location:P.location,delta:1})}function A(I,R){i=qm.Replace;let M=X3(P.location,I,R);y=S();let F=uH(M,y),z=P.createHref(M);h.replaceState(F,"",z),o&&m&&m({action:i,location:P.location,delta:0})}function O(I){let R=s.location.origin!=="null"?s.location.origin:s.location.href,M=typeof I=="string"?I:QP(I);return M=M.replace(/ $/,"%20"),vo(R,"No window.location.(origin|href) available to create URL for href: "+M),new URL(M,R)}let P={get action(){return i},get location(){return e(s,h)},listen(I){if(m)throw new Error("A history only accepts one active listener");return s.addEventListener(cH,b),m=I,()=>{s.removeEventListener(cH,b),m=null}},createHref(I){return t(s,I)},createURL:O,encodeLocation(I){let R=O(I);return{pathname:R.pathname,search:R.search,hash:R.hash}},push:T,replace:A,go(I){return h.go(I)}};return P}var dH;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(dH||(dH={}));function Twe(e,t,r){return r===void 0&&(r="/"),Awe(e,t,r,!1)}function Awe(e,t,r,n){let s=typeof t=="string"?nw(t):t,o=UB(s.pathname||"/",r);if(o==null)return null;let h=Dee(e);Cwe(h);let i=null;for(let m=0;i==null&&m<h.length;++m){let y=Fwe(o);i=Dwe(h[m],y,n)}return i}function Dee(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let s=(o,h,i)=>{let m={relativePath:i===void 0?o.path||"":i,caseSensitive:o.caseSensitive===!0,childrenIndex:h,route:o};m.relativePath.startsWith("/")&&(vo(m.relativePath.startsWith(n),'Absolute route path "'+m.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),m.relativePath=m.relativePath.slice(n.length));let y=rg([n,m.relativePath]),S=r.concat(m);o.children&&o.children.length>0&&(vo(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+y+'".')),Dee(o.children,t,S,y)),!(o.path==null&&!o.index)&&t.push({path:y,score:Rwe(y,o.index),routesMeta:S})};return e.forEach((o,h)=>{var i;if(o.path===""||!((i=o.path)!=null&&i.includes("?")))s(o,h);else for(let m of Lee(o.path))s(o,h,m)}),t}function Lee(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,s=r.endsWith("?"),o=r.replace(/\?$/,"");if(n.length===0)return s?[o,""]:[o];let h=Lee(n.join("/")),i=[];return i.push(...h.map(m=>m===""?o:[o,m].join("/"))),s&&i.push(...h),i.map(m=>e.startsWith("/")&&m===""?"/":m)}function Cwe(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:Mwe(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const jwe=/^:[\w-]+$/,Pwe=3,Owe=2,kwe=1,Nwe=10,Iwe=-2,hH=e=>e==="*";function Rwe(e,t){let r=e.split("/"),n=r.length;return r.some(hH)&&(n+=Iwe),t&&(n+=Owe),r.filter(s=>!hH(s)).reduce((s,o)=>s+(jwe.test(o)?Pwe:o===""?kwe:Nwe),n)}function Mwe(e,t){return e.length===t.length&&e.slice(0,-1).every((n,s)=>n===t[s])?e[e.length-1]-t[t.length-1]:0}function Dwe(e,t,r){let{routesMeta:n}=e,s={},o="/",h=[];for(let i=0;i<n.length;++i){let m=n[i],y=i===n.length-1,S=o==="/"?t:t.slice(o.length)||"/",b=fH({path:m.relativePath,caseSensitive:m.caseSensitive,end:y},S),T=m.route;if(!b&&y&&r&&!n[n.length-1].route.index&&(b=fH({path:m.relativePath,caseSensitive:m.caseSensitive,end:!1},S)),!b)return null;Object.assign(s,b.params),h.push({params:s,pathname:rg([o,b.pathname]),pathnameBase:Uwe(rg([o,b.pathnameBase])),route:T}),b.pathnameBase!=="/"&&(o=rg([o,b.pathnameBase]))}return h}function fH(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=Lwe(e.path,e.caseSensitive,e.end),s=t.match(r);if(!s)return null;let o=s[0],h=o.replace(/(.)\/+$/,"$1"),i=s.slice(1);return{params:n.reduce((y,S,b)=>{let{paramName:T,isOptional:A}=S;if(T==="*"){let P=i[b]||"";h=o.slice(0,o.length-P.length).replace(/(.)\/+$/,"$1")}const O=i[b];return A&&!O?y[T]=void 0:y[T]=(O||"").replace(/%2F/g,"/"),y},{}),pathname:o,pathnameBase:h,pattern:e}}function Lwe(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),Mee(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],s="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(h,i,m)=>(n.push({paramName:i,isOptional:m!=null}),m?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),s+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?s+="\\/*$":e!==""&&e!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,t?void 0:"i"),n]}function Fwe(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Mee(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function UB(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function zwe(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:s=""}=typeof e=="string"?nw(e):e;return{pathname:r?r.startsWith("/")?r:Bwe(r,t):t,search:Vwe(n),hash:qwe(s)}}function Bwe(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(s=>{s===".."?r.length>1&&r.pop():s!=="."&&r.push(s)}),r.length>1?r.join("/"):"/"}function jD(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function $we(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function VB(e,t){let r=$we(e);return t?r.map((n,s)=>s===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function qB(e,t,r,n){n===void 0&&(n=!1);let s;typeof e=="string"?s=nw(e):(s=hT({},e),vo(!s.pathname||!s.pathname.includes("?"),jD("?","pathname","search",s)),vo(!s.pathname||!s.pathname.includes("#"),jD("#","pathname","hash",s)),vo(!s.search||!s.search.includes("#"),jD("#","search","hash",s)));let o=e===""||s.pathname==="",h=o?"/":s.pathname,i;if(h==null)i=r;else{let b=t.length-1;if(!n&&h.startsWith("..")){let T=h.split("/");for(;T[0]==="..";)T.shift(),b-=1;s.pathname=T.join("/")}i=b>=0?t[b]:"/"}let m=zwe(s,i),y=h&&h!=="/"&&h.endsWith("/"),S=(o||h===".")&&r.endsWith("/");return!m.pathname.endsWith("/")&&(y||S)&&(m.pathname+="/"),m}const rg=e=>e.join("/").replace(/\/\/+/g,"/"),Uwe=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),Vwe=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,qwe=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function Hwe(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const Fee=["post","put","patch","delete"];new Set(Fee);const Gwe=["get",...Fee];new Set(Gwe);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function fT(){return fT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},fT.apply(this,arguments)}const HB=V.createContext(null),Wwe=V.createContext(null),xg=V.createContext(null),fN=V.createContext(null),fp=V.createContext({outlet:null,matches:[],isDataRoute:!1}),zee=V.createContext(null);function Kwe(e,t){let{relative:r}=t===void 0?{}:t;iw()||vo(!1);let{basename:n,navigator:s}=V.useContext(xg),{hash:o,pathname:h,search:i}=$ee(e,{relative:r}),m=h;return n!=="/"&&(m=h==="/"?n:rg([n,h])),s.createHref({pathname:m,search:i,hash:o})}function iw(){return V.useContext(fN)!=null}function Qh(){return iw()||vo(!1),V.useContext(fN).location}function Bee(e){V.useContext(xg).static||V.useLayoutEffect(e)}function Jc(){let{isDataRoute:e}=V.useContext(fp);return e?o1e():Zwe()}function Zwe(){iw()||vo(!1);let e=V.useContext(HB),{basename:t,future:r,navigator:n}=V.useContext(xg),{matches:s}=V.useContext(fp),{pathname:o}=Qh(),h=JSON.stringify(VB(s,r.v7_relativeSplatPath)),i=V.useRef(!1);return Bee(()=>{i.current=!0}),V.useCallback(function(y,S){if(S===void 0&&(S={}),!i.current)return;if(typeof y=="number"){n.go(y);return}let b=qB(y,JSON.parse(h),o,S.relative==="path");e==null&&t!=="/"&&(b.pathname=b.pathname==="/"?t:rg([t,b.pathname])),(S.replace?n.replace:n.push)(b,S.state,S)},[t,n,h,o,e])}function GB(){let{matches:e}=V.useContext(fp),t=e[e.length-1];return t?t.params:{}}function $ee(e,t){let{relative:r}=t===void 0?{}:t,{future:n}=V.useContext(xg),{matches:s}=V.useContext(fp),{pathname:o}=Qh(),h=JSON.stringify(VB(s,n.v7_relativeSplatPath));return V.useMemo(()=>qB(e,JSON.parse(h),o,r==="path"),[e,h,o,r])}function Xwe(e,t){return Ywe(e,t)}function Ywe(e,t,r,n){iw()||vo(!1);let{navigator:s}=V.useContext(xg),{matches:o}=V.useContext(fp),h=o[o.length-1],i=h?h.params:{};h&&h.pathname;let m=h?h.pathnameBase:"/";h&&h.route;let y=Qh(),S;if(t){var b;let I=typeof t=="string"?nw(t):t;m==="/"||(b=I.pathname)!=null&&b.startsWith(m)||vo(!1),S=I}else S=y;let T=S.pathname||"/",A=T;if(m!=="/"){let I=m.replace(/^\//,"").split("/");A="/"+T.replace(/^\//,"").split("/").slice(I.length).join("/")}let O=Twe(e,{pathname:A}),P=r1e(O&&O.map(I=>Object.assign({},I,{params:Object.assign({},i,I.params),pathname:rg([m,s.encodeLocation?s.encodeLocation(I.pathname).pathname:I.pathname]),pathnameBase:I.pathnameBase==="/"?m:rg([m,s.encodeLocation?s.encodeLocation(I.pathnameBase).pathname:I.pathnameBase])})),o,r,n);return t&&P?V.createElement(fN.Provider,{value:{location:fT({pathname:"/",search:"",hash:"",state:null,key:"default"},S),navigationType:qm.Pop}},P):P}function Jwe(){let e=a1e(),t=Hwe(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return V.createElement(V.Fragment,null,V.createElement("h2",null,"Unexpected Application Error!"),V.createElement("h3",{style:{fontStyle:"italic"}},t),r?V.createElement("pre",{style:s},r):null,null)}const Qwe=V.createElement(Jwe,null);class e1e extends V.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?V.createElement(fp.Provider,{value:this.props.routeContext},V.createElement(zee.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function t1e(e){let{routeContext:t,match:r,children:n}=e,s=V.useContext(HB);return s&&s.static&&s.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=r.route.id),V.createElement(fp.Provider,{value:t},n)}function r1e(e,t,r,n){var s;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var o;if(!r)return null;if(r.errors)e=r.matches;else if((o=n)!=null&&o.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let h=e,i=(s=r)==null?void 0:s.errors;if(i!=null){let S=h.findIndex(b=>b.route.id&&(i==null?void 0:i[b.route.id])!==void 0);S>=0||vo(!1),h=h.slice(0,Math.min(h.length,S+1))}let m=!1,y=-1;if(r&&n&&n.v7_partialHydration)for(let S=0;S<h.length;S++){let b=h[S];if((b.route.HydrateFallback||b.route.hydrateFallbackElement)&&(y=S),b.route.id){let{loaderData:T,errors:A}=r,O=b.route.loader&&T[b.route.id]===void 0&&(!A||A[b.route.id]===void 0);if(b.route.lazy||O){m=!0,y>=0?h=h.slice(0,y+1):h=[h[0]];break}}}return h.reduceRight((S,b,T)=>{let A,O=!1,P=null,I=null;r&&(A=i&&b.route.id?i[b.route.id]:void 0,P=b.route.errorElement||Qwe,m&&(y<0&&T===0?(O=!0,I=null):y===T&&(O=!0,I=b.route.hydrateFallbackElement||null)));let R=t.concat(h.slice(0,T+1)),M=()=>{let F;return A?F=P:O?F=I:b.route.Component?F=V.createElement(b.route.Component,null):b.route.element?F=b.route.element:F=S,V.createElement(t1e,{match:b,routeContext:{outlet:S,matches:R,isDataRoute:r!=null},children:F})};return r&&(b.route.ErrorBoundary||b.route.errorElement||T===0)?V.createElement(e1e,{location:r.location,revalidation:r.revalidation,component:P,error:A,children:M(),routeContext:{outlet:null,matches:R,isDataRoute:!0}}):M()},null)}var Uee=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(Uee||{}),eO=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(eO||{});function n1e(e){let t=V.useContext(HB);return t||vo(!1),t}function i1e(e){let t=V.useContext(Wwe);return t||vo(!1),t}function s1e(e){let t=V.useContext(fp);return t||vo(!1),t}function Vee(e){let t=s1e(),r=t.matches[t.matches.length-1];return r.route.id||vo(!1),r.route.id}function a1e(){var e;let t=V.useContext(zee),r=i1e(eO.UseRouteError),n=Vee(eO.UseRouteError);return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}function o1e(){let{router:e}=n1e(Uee.UseNavigateStable),t=Vee(eO.UseNavigateStable),r=V.useRef(!1);return Bee(()=>{r.current=!0}),V.useCallback(function(s,o){o===void 0&&(o={}),r.current&&(typeof s=="number"?e.navigate(s):e.navigate(s,fT({fromRouteId:t},o)))},[e,t])}function l1e(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function c1e(e){let{to:t,replace:r,state:n,relative:s}=e;iw()||vo(!1);let{future:o,static:h}=V.useContext(xg),{matches:i}=V.useContext(fp),{pathname:m}=Qh(),y=Jc(),S=qB(t,VB(i,o.v7_relativeSplatPath),m,s==="path"),b=JSON.stringify(S);return V.useEffect(()=>y(JSON.parse(b),{replace:r,state:n,relative:s}),[y,b,s,r,n]),null}function ma(e){vo(!1)}function u1e(e){let{basename:t="/",children:r=null,location:n,navigationType:s=qm.Pop,navigator:o,static:h=!1,future:i}=e;iw()&&vo(!1);let m=t.replace(/^\/*/,"/"),y=V.useMemo(()=>({basename:m,navigator:o,static:h,future:fT({v7_relativeSplatPath:!1},i)}),[m,i,o,h]);typeof n=="string"&&(n=nw(n));let{pathname:S="/",search:b="",hash:T="",state:A=null,key:O="default"}=n,P=V.useMemo(()=>{let I=UB(S,m);return I==null?null:{location:{pathname:I,search:b,hash:T,state:A,key:O},navigationType:s}},[m,S,b,T,A,O,s]);return P==null?null:V.createElement(xg.Provider,{value:y},V.createElement(fN.Provider,{children:r,value:P}))}function d1e(e){let{children:t,location:r}=e;return Xwe(Y3(t),r)}new Promise(()=>{});function Y3(e,t){t===void 0&&(t=[]);let r=[];return V.Children.forEach(e,(n,s)=>{if(!V.isValidElement(n))return;let o=[...t,s];if(n.type===V.Fragment){r.push.apply(r,Y3(n.props.children,o));return}n.type!==ma&&vo(!1),!n.props.index||!n.props.children||vo(!1);let h={id:n.props.id||o.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(h.children=Y3(n.props.children,o)),r.push(h)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function J3(){return J3=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},J3.apply(this,arguments)}function h1e(e,t){if(e==null)return{};var r={},n=Object.keys(e),s,o;for(o=0;o<n.length;o++)s=n[o],!(t.indexOf(s)>=0)&&(r[s]=e[s]);return r}function f1e(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function p1e(e,t){return e.button===0&&(!t||t==="_self")&&!f1e(e)}const m1e=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],g1e="6";try{window.__reactRouterVersion=g1e}catch{}const y1e="startTransition",pH=P4[y1e];function v1e(e){let{basename:t,children:r,future:n,window:s}=e,o=V.useRef();o.current==null&&(o.current=wwe({window:s,v5Compat:!0}));let h=o.current,[i,m]=V.useState({action:h.action,location:h.location}),{v7_startTransition:y}=n||{},S=V.useCallback(b=>{y&&pH?pH(()=>m(b)):m(b)},[m,y]);return V.useLayoutEffect(()=>h.listen(S),[h,S]),V.useEffect(()=>l1e(n),[n]),V.createElement(u1e,{basename:t,children:r,location:i.location,navigationType:i.action,navigator:h,future:n})}const _1e=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",x1e=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ji=V.forwardRef(function(t,r){let{onClick:n,relative:s,reloadDocument:o,replace:h,state:i,target:m,to:y,preventScrollReset:S,viewTransition:b}=t,T=h1e(t,m1e),{basename:A}=V.useContext(xg),O,P=!1;if(typeof y=="string"&&x1e.test(y)&&(O=y,_1e))try{let F=new URL(window.location.href),z=y.startsWith("//")?new URL(F.protocol+y):new URL(y),$=UB(z.pathname,A);z.origin===F.origin&&$!=null?y=$+z.search+z.hash:P=!0}catch{}let I=Kwe(y,{relative:s}),R=b1e(y,{replace:h,state:i,target:m,preventScrollReset:S,relative:s,viewTransition:b});function M(F){n&&n(F),F.defaultPrevented||R(F)}return V.createElement("a",J3({},T,{href:O||I,onClick:P||o?n:M,ref:r,target:m}))});var mH;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(mH||(mH={}));var gH;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(gH||(gH={}));function b1e(e,t){let{target:r,replace:n,state:s,preventScrollReset:o,relative:h,viewTransition:i}=t===void 0?{}:t,m=Jc(),y=Qh(),S=$ee(e,{relative:h});return V.useCallback(b=>{if(p1e(b,r)){b.preventDefault();let T=n!==void 0?n:QP(y)===QP(S);m(e,{replace:T,state:s,preventScrollReset:o,relative:h,viewTransition:i})}},[y,m,S,n,s,r,e,o,h,i])}var Q3=function(e,t){return Q3=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=n[s])},Q3(e,t)};function qee(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Q3(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Uu=function(){return Uu=Object.assign||function(t){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},Uu.apply(this,arguments)};function bg(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r}function Hee(e,t,r,n){var s=arguments.length,o=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(h=e[i])&&(o=(s<3?h(o):s>3?h(t,r,o):h(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}function Gee(e,t){return function(r,n){t(r,n,e)}}function Wee(e,t,r,n,s,o){function h(R){if(R!==void 0&&typeof R!="function")throw new TypeError("Function expected");return R}for(var i=n.kind,m=i==="getter"?"get":i==="setter"?"set":"value",y=!t&&e?n.static?e:e.prototype:null,S=t||(y?Object.getOwnPropertyDescriptor(y,n.name):{}),b,T=!1,A=r.length-1;A>=0;A--){var O={};for(var P in n)O[P]=P==="access"?{}:n[P];for(var P in n.access)O.access[P]=n.access[P];O.addInitializer=function(R){if(T)throw new TypeError("Cannot add initializers after decoration has completed");o.push(h(R||null))};var I=(0,r[A])(i==="accessor"?{get:S.get,set:S.set}:S[m],O);if(i==="accessor"){if(I===void 0)continue;if(I===null||typeof I!="object")throw new TypeError("Object expected");(b=h(I.get))&&(S.get=b),(b=h(I.set))&&(S.set=b),(b=h(I.init))&&s.unshift(b)}else(b=h(I))&&(i==="field"?s.unshift(b):S[m]=b)}y&&Object.defineProperty(y,n.name,S),T=!0}function Kee(e,t,r){for(var n=arguments.length>2,s=0;s<t.length;s++)r=n?t[s].call(e,r):t[s].call(e);return n?r:void 0}function Zee(e){return typeof e=="symbol"?e:"".concat(e)}function Xee(e,t,r){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function Yee(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function kn(e,t,r,n){function s(o){return o instanceof r?o:new r(function(h){h(o)})}return new(r||(r=Promise))(function(o,h){function i(S){try{y(n.next(S))}catch(b){h(b)}}function m(S){try{y(n.throw(S))}catch(b){h(b)}}function y(S){S.done?o(S.value):s(S.value).then(i,m)}y((n=n.apply(e,t||[])).next())})}function Jee(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,s,o,h=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return h.next=i(0),h.throw=i(1),h.return=i(2),typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function i(y){return function(S){return m([y,S])}}function m(y){if(n)throw new TypeError("Generator is already executing.");for(;h&&(h=0,y[0]&&(r=0)),r;)try{if(n=1,s&&(o=y[0]&2?s.return:y[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,y[1])).done)return o;switch(s=0,o&&(y=[y[0]&2,o.value]),y[0]){case 0:case 1:o=y;break;case 4:return r.label++,{value:y[1],done:!1};case 5:r.label++,s=y[1],y=[0];continue;case 7:y=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(y[0]===6||y[0]===2)){r=0;continue}if(y[0]===3&&(!o||y[1]>o[0]&&y[1]<o[3])){r.label=y[1];break}if(y[0]===6&&r.label<o[1]){r.label=o[1],o=y;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(y);break}o[2]&&r.ops.pop(),r.trys.pop();continue}y=t.call(e,r)}catch(S){y=[6,S],s=0}finally{n=o=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}var pN=Object.create?function(e,t,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]};function Qee(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&pN(t,e,r)}function tO(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function WB(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),s,o=[],h;try{for(;(t===void 0||t-- >0)&&!(s=n.next()).done;)o.push(s.value)}catch(i){h={error:i}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(h)throw h.error}}return o}function ete(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(WB(arguments[t]));return e}function tte(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),s=0,t=0;t<r;t++)for(var o=arguments[t],h=0,i=o.length;h<i;h++,s++)n[s]=o[h];return n}function KB(e,t,r){if(r||arguments.length===2)for(var n=0,s=t.length,o;n<s;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}function ab(e){return this instanceof ab?(this.v=e,this):new ab(e)}function rte(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),s,o=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),i("next"),i("throw"),i("return",h),s[Symbol.asyncIterator]=function(){return this},s;function h(A){return function(O){return Promise.resolve(O).then(A,b)}}function i(A,O){n[A]&&(s[A]=function(P){return new Promise(function(I,R){o.push([A,P,I,R])>1||m(A,P)})},O&&(s[A]=O(s[A])))}function m(A,O){try{y(n[A](O))}catch(P){T(o[0][3],P)}}function y(A){A.value instanceof ab?Promise.resolve(A.value.v).then(S,b):T(o[0][2],A)}function S(A){m("next",A)}function b(A){m("throw",A)}function T(A,O){A(O),o.shift(),o.length&&m(o[0][0],o[0][1])}}function nte(e){var t,r;return t={},n("next"),n("throw",function(s){throw s}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(s,o){t[s]=e[s]?function(h){return(r=!r)?{value:ab(e[s](h)),done:!1}:o?o(h):h}:o}}function ite(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof tO=="function"?tO(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(o){r[o]=e[o]&&function(h){return new Promise(function(i,m){h=e[o](h),s(i,m,h.done,h.value)})}}function s(o,h,i,m){Promise.resolve(m).then(function(y){o({value:y,done:i})},h)}}function ste(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var w1e=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},eF=function(e){return eF=Object.getOwnPropertyNames||function(t){var r=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[r.length]=n);return r},eF(e)};function ate(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=eF(e),n=0;n<r.length;n++)r[n]!=="default"&&pN(t,e,r[n]);return w1e(t,e),t}function ote(e){return e&&e.__esModule?e:{default:e}}function lte(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)}function cte(e,t,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(e,r):s?s.value=r:t.set(e,r),r}function ute(e,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof e=="function"?t===e:e.has(t)}function dte(e,t,r){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var n,s;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=t[Symbol.asyncDispose]}if(n===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=t[Symbol.dispose],r&&(s=n)}if(typeof n!="function")throw new TypeError("Object not disposable.");s&&(n=function(){try{s.call(this)}catch(o){return Promise.reject(o)}}),e.stack.push({value:t,dispose:n,async:r})}else r&&e.stack.push({async:!0});return t}var S1e=typeof SuppressedError=="function"?SuppressedError:function(e,t,r){var n=new Error(r);return n.name="SuppressedError",n.error=e,n.suppressed=t,n};function hte(e){function t(o){e.error=e.hasError?new S1e(o,e.error,"An error was suppressed during disposal."):o,e.hasError=!0}var r,n=0;function s(){for(;r=e.stack.pop();)try{if(!r.async&&n===1)return n=0,e.stack.push(r),Promise.resolve().then(s);if(r.dispose){var o=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(o).then(s,function(h){return t(h),s()})}else n|=1}catch(h){t(h)}if(n===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return s()}function fte(e,t){return typeof e=="string"&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(r,n,s,o,h){return n?t?".jsx":".js":s&&(!o||!h)?r:s+o+"."+h.toLowerCase()+"js"}):e}const E1e={__extends:qee,__assign:Uu,__rest:bg,__decorate:Hee,__param:Gee,__esDecorate:Wee,__runInitializers:Kee,__propKey:Zee,__setFunctionName:Xee,__metadata:Yee,__awaiter:kn,__generator:Jee,__createBinding:pN,__exportStar:Qee,__values:tO,__read:WB,__spread:ete,__spreadArrays:tte,__spreadArray:KB,__await:ab,__asyncGenerator:rte,__asyncDelegator:nte,__asyncValues:ite,__makeTemplateObject:ste,__importStar:ate,__importDefault:ote,__classPrivateFieldGet:lte,__classPrivateFieldSet:cte,__classPrivateFieldIn:ute,__addDisposableResource:dte,__disposeResources:hte,__rewriteRelativeImportExtension:fte},T1e=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:dte,get __assign(){return Uu},__asyncDelegator:nte,__asyncGenerator:rte,__asyncValues:ite,__await:ab,__awaiter:kn,__classPrivateFieldGet:lte,__classPrivateFieldIn:ute,__classPrivateFieldSet:cte,__createBinding:pN,__decorate:Hee,__disposeResources:hte,__esDecorate:Wee,__exportStar:Qee,__extends:qee,__generator:Jee,__importDefault:ote,__importStar:ate,__makeTemplateObject:ste,__metadata:Yee,__param:Gee,__propKey:Zee,__read:WB,__rest:bg,__rewriteRelativeImportExtension:fte,__runInitializers:Kee,__setFunctionName:Xee,__spread:ete,__spreadArray:KB,__spreadArrays:tte,__values:tO,default:E1e},Symbol.toStringTag,{value:"Module"})),A1e=e=>e?(...t)=>e(...t):(...t)=>fetch(...t);class mN extends Error{constructor(t,r="FunctionsError",n){super(t),this.name=r,this.context=n}}class pte extends mN{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class tF extends mN{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class rF extends mN{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var rO;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(rO||(rO={}));class C1e{constructor(t,{headers:r={},customFetch:n,region:s=rO.Any}={}){this.url=t,this.headers=r,this.region=s,this.fetch=A1e(n)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return kn(this,arguments,void 0,function*(r,n={}){var s;let o,h;try{const{headers:i,method:m,body:y,signal:S,timeout:b}=n;let T={},{region:A}=n;A||(A=this.region);const O=new URL(`${this.url}/${r}`);A&&A!=="any"&&(T["x-region"]=A,O.searchParams.set("forceFunctionRegion",A));let P;y&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)?typeof Blob<"u"&&y instanceof Blob||y instanceof ArrayBuffer?(T["Content-Type"]="application/octet-stream",P=y):typeof y=="string"?(T["Content-Type"]="text/plain",P=y):typeof FormData<"u"&&y instanceof FormData?P=y:(T["Content-Type"]="application/json",P=JSON.stringify(y)):P=y;let I=S;b&&(h=new AbortController,o=setTimeout(()=>h.abort(),b),S?(I=h.signal,S.addEventListener("abort",()=>h.abort())):I=h.signal);const R=yield this.fetch(O.toString(),{method:m||"POST",headers:Object.assign(Object.assign(Object.assign({},T),this.headers),i),body:P,signal:I}).catch($=>{throw new pte($)}),M=R.headers.get("x-relay-error");if(M&&M==="true")throw new tF(R);if(!R.ok)throw new rF(R);let F=((s=R.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),z;return F==="application/json"?z=yield R.json():F==="application/octet-stream"||F==="application/pdf"?z=yield R.blob():F==="text/event-stream"?z=R:F==="multipart/form-data"?z=yield R.formData():z=yield R.text(),{data:z,error:null,response:R}}catch(i){return{data:null,error:i,response:i instanceof rF||i instanceof tF?i.context:void 0}}finally{o&&clearTimeout(o)}})}}var dc={};const sw=Gme(T1e);var mj={},gj={},yj={},vj={},_j={},xj={},yH;function mte(){if(yH)return xj;yH=1,Object.defineProperty(xj,"__esModule",{value:!0});class e extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}}return xj.default=e,xj}var vH;function gte(){if(vH)return _j;vH=1,Object.defineProperty(_j,"__esModule",{value:!0});const t=sw.__importDefault(mte());class r{constructor(s){var o,h;this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=new Headers(s.headers),this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=(o=s.shouldThrowOnError)!==null&&o!==void 0?o:!1,this.signal=s.signal,this.isMaybeSingle=(h=s.isMaybeSingle)!==null&&h!==void 0?h:!1,s.fetch?this.fetch=s.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,o){return this.headers=new Headers(this.headers),this.headers.set(s,o),this}then(s,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const h=this.fetch;let i=h(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async m=>{var y,S,b,T;let A=null,O=null,P=null,I=m.status,R=m.statusText;if(m.ok){if(this.method!=="HEAD"){const $=await m.text();$===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((y=this.headers.get("Accept"))===null||y===void 0)&&y.includes("application/vnd.pgrst.plan+text"))?O=$:O=JSON.parse($))}const F=(S=this.headers.get("Prefer"))===null||S===void 0?void 0:S.match(/count=(exact|planned|estimated)/),z=(b=m.headers.get("content-range"))===null||b===void 0?void 0:b.split("/");F&&z&&z.length>1&&(P=parseInt(z[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(O)&&(O.length>1?(A={code:"PGRST116",details:`Results contain ${O.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},O=null,P=null,I=406,R="Not Acceptable"):O.length===1?O=O[0]:O=null)}else{const F=await m.text();try{A=JSON.parse(F),Array.isArray(A)&&m.status===404&&(O=[],A=null,I=200,R="OK")}catch{m.status===404&&F===""?(I=204,R="No Content"):A={message:F}}if(A&&this.isMaybeSingle&&(!((T=A==null?void 0:A.details)===null||T===void 0)&&T.includes("0 rows"))&&(A=null,I=200,R="OK"),A&&this.shouldThrowOnError)throw new t.default(A)}return{error:A,data:O,count:P,status:I,statusText:R}});return this.shouldThrowOnError||(i=i.catch(m=>{var y,S,b,T,A,O;let P="";const I=m==null?void 0:m.cause;if(I){const R=(y=I==null?void 0:I.message)!==null&&y!==void 0?y:"",M=(S=I==null?void 0:I.code)!==null&&S!==void 0?S:"";P=`${(b=m==null?void 0:m.name)!==null&&b!==void 0?b:"FetchError"}: ${m==null?void 0:m.message}`,P+=`

Caused by: ${(T=I==null?void 0:I.name)!==null&&T!==void 0?T:"Error"}: ${R}`,M&&(P+=` (${M})`),I!=null&&I.stack&&(P+=`
${I.stack}`)}else P=(A=m==null?void 0:m.stack)!==null&&A!==void 0?A:"";return{error:{message:`${(O=m==null?void 0:m.name)!==null&&O!==void 0?O:"FetchError"}: ${m==null?void 0:m.message}`,details:P,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),i.then(s,o)}returns(){return this}overrideTypes(){return this}}return _j.default=r,_j}var _H;function yte(){if(_H)return vj;_H=1,Object.defineProperty(vj,"__esModule",{value:!0});const t=sw.__importDefault(gte());class r extends t.default{select(s){let o=!1;const h=(s??"*").split("").map(i=>/\s/.test(i)&&!o?"":(i==='"'&&(o=!o),i)).join("");return this.url.searchParams.set("select",h),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:o=!0,nullsFirst:h,foreignTable:i,referencedTable:m=i}={}){const y=m?`${m}.order`:"order",S=this.url.searchParams.get(y);return this.url.searchParams.set(y,`${S?`${S},`:""}${s}.${o?"asc":"desc"}${h===void 0?"":h?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:o,referencedTable:h=o}={}){const i=typeof h>"u"?"limit":`${h}.limit`;return this.url.searchParams.set(i,`${s}`),this}range(s,o,{foreignTable:h,referencedTable:i=h}={}){const m=typeof i>"u"?"offset":`${i}.offset`,y=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(m,`${s}`),this.url.searchParams.set(y,`${o-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:o=!1,settings:h=!1,buffers:i=!1,wal:m=!1,format:y="text"}={}){var S;const b=[s?"analyze":null,o?"verbose":null,h?"settings":null,i?"buffers":null,m?"wal":null].filter(Boolean).join("|"),T=(S=this.headers.get("Accept"))!==null&&S!==void 0?S:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${y}; for="${T}"; options=${b};`),y==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}}return vj.default=r,vj}var xH;function ZB(){if(xH)return yj;xH=1,Object.defineProperty(yj,"__esModule",{value:!0});const t=sw.__importDefault(yte()),r=new RegExp("[,()]");class n extends t.default{eq(o,h){return this.url.searchParams.append(o,`eq.${h}`),this}neq(o,h){return this.url.searchParams.append(o,`neq.${h}`),this}gt(o,h){return this.url.searchParams.append(o,`gt.${h}`),this}gte(o,h){return this.url.searchParams.append(o,`gte.${h}`),this}lt(o,h){return this.url.searchParams.append(o,`lt.${h}`),this}lte(o,h){return this.url.searchParams.append(o,`lte.${h}`),this}like(o,h){return this.url.searchParams.append(o,`like.${h}`),this}likeAllOf(o,h){return this.url.searchParams.append(o,`like(all).{${h.join(",")}}`),this}likeAnyOf(o,h){return this.url.searchParams.append(o,`like(any).{${h.join(",")}}`),this}ilike(o,h){return this.url.searchParams.append(o,`ilike.${h}`),this}ilikeAllOf(o,h){return this.url.searchParams.append(o,`ilike(all).{${h.join(",")}}`),this}ilikeAnyOf(o,h){return this.url.searchParams.append(o,`ilike(any).{${h.join(",")}}`),this}regexMatch(o,h){return this.url.searchParams.append(o,`match.${h}`),this}regexIMatch(o,h){return this.url.searchParams.append(o,`imatch.${h}`),this}is(o,h){return this.url.searchParams.append(o,`is.${h}`),this}isDistinct(o,h){return this.url.searchParams.append(o,`isdistinct.${h}`),this}in(o,h){const i=Array.from(new Set(h)).map(m=>typeof m=="string"&&r.test(m)?`"${m}"`:`${m}`).join(",");return this.url.searchParams.append(o,`in.(${i})`),this}contains(o,h){return typeof h=="string"?this.url.searchParams.append(o,`cs.${h}`):Array.isArray(h)?this.url.searchParams.append(o,`cs.{${h.join(",")}}`):this.url.searchParams.append(o,`cs.${JSON.stringify(h)}`),this}containedBy(o,h){return typeof h=="string"?this.url.searchParams.append(o,`cd.${h}`):Array.isArray(h)?this.url.searchParams.append(o,`cd.{${h.join(",")}}`):this.url.searchParams.append(o,`cd.${JSON.stringify(h)}`),this}rangeGt(o,h){return this.url.searchParams.append(o,`sr.${h}`),this}rangeGte(o,h){return this.url.searchParams.append(o,`nxl.${h}`),this}rangeLt(o,h){return this.url.searchParams.append(o,`sl.${h}`),this}rangeLte(o,h){return this.url.searchParams.append(o,`nxr.${h}`),this}rangeAdjacent(o,h){return this.url.searchParams.append(o,`adj.${h}`),this}overlaps(o,h){return typeof h=="string"?this.url.searchParams.append(o,`ov.${h}`):this.url.searchParams.append(o,`ov.{${h.join(",")}}`),this}textSearch(o,h,{config:i,type:m}={}){let y="";m==="plain"?y="pl":m==="phrase"?y="ph":m==="websearch"&&(y="w");const S=i===void 0?"":`(${i})`;return this.url.searchParams.append(o,`${y}fts${S}.${h}`),this}match(o){return Object.entries(o).forEach(([h,i])=>{this.url.searchParams.append(h,`eq.${i}`)}),this}not(o,h,i){return this.url.searchParams.append(o,`not.${h}.${i}`),this}or(o,{foreignTable:h,referencedTable:i=h}={}){const m=i?`${i}.or`:"or";return this.url.searchParams.append(m,`(${o})`),this}filter(o,h,i){return this.url.searchParams.append(o,`${h}.${i}`),this}}return yj.default=n,yj}var bH;function vte(){if(bH)return gj;bH=1,Object.defineProperty(gj,"__esModule",{value:!0});const t=sw.__importDefault(ZB());class r{constructor(s,{headers:o={},schema:h,fetch:i}){this.url=s,this.headers=new Headers(o),this.schema=h,this.fetch=i}select(s,o){const{head:h=!1,count:i}=o??{},m=h?"HEAD":"GET";let y=!1;const S=(s??"*").split("").map(b=>/\s/.test(b)&&!y?"":(b==='"'&&(y=!y),b)).join("");return this.url.searchParams.set("select",S),i&&this.headers.append("Prefer",`count=${i}`),new t.default({method:m,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(s,{count:o,defaultToNull:h=!0}={}){var i;const m="POST";if(o&&this.headers.append("Prefer",`count=${o}`),h||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const y=s.reduce((S,b)=>S.concat(Object.keys(b)),[]);if(y.length>0){const S=[...new Set(y)].map(b=>`"${b}"`);this.url.searchParams.set("columns",S.join(","))}}return new t.default({method:m,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}upsert(s,{onConflict:o,ignoreDuplicates:h=!1,count:i,defaultToNull:m=!0}={}){var y;const S="POST";if(this.headers.append("Prefer",`resolution=${h?"ignore":"merge"}-duplicates`),o!==void 0&&this.url.searchParams.set("on_conflict",o),i&&this.headers.append("Prefer",`count=${i}`),m||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const b=s.reduce((T,A)=>T.concat(Object.keys(A)),[]);if(b.length>0){const T=[...new Set(b)].map(A=>`"${A}"`);this.url.searchParams.set("columns",T.join(","))}}return new t.default({method:S,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(y=this.fetch)!==null&&y!==void 0?y:fetch})}update(s,{count:o}={}){var h;const i="PATCH";return o&&this.headers.append("Prefer",`count=${o}`),new t.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}delete({count:s}={}){var o;const h="DELETE";return s&&this.headers.append("Prefer",`count=${s}`),new t.default({method:h,url:this.url,headers:this.headers,schema:this.schema,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}}return gj.default=r,gj}var wH;function j1e(){if(wH)return mj;wH=1,Object.defineProperty(mj,"__esModule",{value:!0});const e=sw,t=e.__importDefault(vte()),r=e.__importDefault(ZB());class n{constructor(o,{headers:h={},schema:i,fetch:m}={}){this.url=o,this.headers=new Headers(h),this.schemaName=i,this.fetch=m}from(o){if(!o||typeof o!="string"||o.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");const h=new URL(`${this.url}/${o}`);return new t.default(h,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new n(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,h={},{head:i=!1,get:m=!1,count:y}={}){var S;let b;const T=new URL(`${this.url}/rpc/${o}`);let A;i||m?(b=i?"HEAD":"GET",Object.entries(h).filter(([P,I])=>I!==void 0).map(([P,I])=>[P,Array.isArray(I)?`{${I.join(",")}}`:`${I}`]).forEach(([P,I])=>{T.searchParams.append(P,I)})):(b="POST",A=h);const O=new Headers(this.headers);return y&&O.set("Prefer",`count=${y}`),new r.default({method:b,url:T,headers:O,schema:this.schemaName,body:A,fetch:(S=this.fetch)!==null&&S!==void 0?S:fetch})}}return mj.default=n,mj}Object.defineProperty(dc,"__esModule",{value:!0});var _te=dc.PostgrestError=Pte=dc.PostgrestBuilder=Cte=dc.PostgrestTransformBuilder=Tte=dc.PostgrestFilterBuilder=Ste=dc.PostgrestQueryBuilder=bte=dc.PostgrestClient=void 0;const aw=sw,xte=aw.__importDefault(j1e());var bte=dc.PostgrestClient=xte.default;const wte=aw.__importDefault(vte());var Ste=dc.PostgrestQueryBuilder=wte.default;const Ete=aw.__importDefault(ZB());var Tte=dc.PostgrestFilterBuilder=Ete.default;const Ate=aw.__importDefault(yte());var Cte=dc.PostgrestTransformBuilder=Ate.default;const jte=aw.__importDefault(gte());var Pte=dc.PostgrestBuilder=jte.default;const Ote=aw.__importDefault(mte());_te=dc.PostgrestError=Ote.default;var kte=dc.default={PostgrestClient:xte.default,PostgrestQueryBuilder:wte.default,PostgrestFilterBuilder:Ete.default,PostgrestTransformBuilder:Ate.default,PostgrestBuilder:jte.default,PostgrestError:Ote.default};const P1e=DX({__proto__:null,get PostgrestBuilder(){return Pte},get PostgrestClient(){return bte},get PostgrestError(){return _te},get PostgrestFilterBuilder(){return Tte},get PostgrestQueryBuilder(){return Ste},get PostgrestTransformBuilder(){return Cte},default:kte},[dc]),{PostgrestClient:O1e,PostgrestQueryBuilder:est,PostgrestFilterBuilder:tst,PostgrestTransformBuilder:rst,PostgrestBuilder:nst,PostgrestError:k1e}=kte||P1e;class Nte{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const r=process.versions;if(r&&r.node){const n=r.node,s=parseInt(n.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let r=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(r+=`

Suggested solution: ${t.workaround}`),new Error(r)}static createWebSocket(t,r){const n=this.getWebSocketConstructor();return new n(t,r)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const N1e="2.84.0",I1e=`realtime-js/${N1e}`,Ite="1.0.0",R1e="2.0.0",SH=Ite,nF=1e4,M1e=1e3,D1e=100;var Vy;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(Vy||(Vy={}));var qo;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(qo||(qo={}));var Md;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(Md||(Md={}));var iF;(function(e){e.websocket="websocket"})(iF||(iF={}));var qy;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(qy||(qy={}));class L1e{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast"}encode(t,r){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return r(this._binaryEncodeUserBroadcastPush(t));let n=[t.join_ref,t.ref,t.topic,t.event,t.payload];return r(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(t){var r;return this._isArrayBuffer((r=t.payload)===null||r===void 0?void 0:r.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var r,n,s,o;const h=t.topic,i=(r=t.ref)!==null&&r!==void 0?r:"",m=(n=t.join_ref)!==null&&n!==void 0?n:"",y=t.payload.event,S=(o=(s=t.payload)===null||s===void 0?void 0:s.payload)!==null&&o!==void 0?o:new ArrayBuffer(0),b=this.USER_BROADCAST_PUSH_META_LENGTH+m.length+i.length+h.length+y.length,T=new ArrayBuffer(this.HEADER_LENGTH+b);let A=new DataView(T),O=0;A.setUint8(O++,this.KINDS.userBroadcastPush),A.setUint8(O++,m.length),A.setUint8(O++,i.length),A.setUint8(O++,h.length),A.setUint8(O++,y.length),A.setUint8(O++,this.BINARY_ENCODING),Array.from(m,I=>A.setUint8(O++,I.charCodeAt(0))),Array.from(i,I=>A.setUint8(O++,I.charCodeAt(0))),Array.from(h,I=>A.setUint8(O++,I.charCodeAt(0))),Array.from(y,I=>A.setUint8(O++,I.charCodeAt(0)));var P=new Uint8Array(T.byteLength+S.byteLength);return P.set(new Uint8Array(T),0),P.set(new Uint8Array(S),T.byteLength),P.buffer}_encodeJsonUserBroadcastPush(t){var r,n,s,o;const h=t.topic,i=(r=t.ref)!==null&&r!==void 0?r:"",m=(n=t.join_ref)!==null&&n!==void 0?n:"",y=t.payload.event,S=(o=(s=t.payload)===null||s===void 0?void 0:s.payload)!==null&&o!==void 0?o:{},T=new TextEncoder().encode(JSON.stringify(S)).buffer,A=this.USER_BROADCAST_PUSH_META_LENGTH+m.length+i.length+h.length+y.length,O=new ArrayBuffer(this.HEADER_LENGTH+A);let P=new DataView(O),I=0;P.setUint8(I++,this.KINDS.userBroadcastPush),P.setUint8(I++,m.length),P.setUint8(I++,i.length),P.setUint8(I++,h.length),P.setUint8(I++,y.length),P.setUint8(I++,this.JSON_ENCODING),Array.from(m,M=>P.setUint8(I++,M.charCodeAt(0))),Array.from(i,M=>P.setUint8(I++,M.charCodeAt(0))),Array.from(h,M=>P.setUint8(I++,M.charCodeAt(0))),Array.from(y,M=>P.setUint8(I++,M.charCodeAt(0)));var R=new Uint8Array(O.byteLength+T.byteLength);return R.set(new Uint8Array(O),0),R.set(new Uint8Array(T),O.byteLength),R.buffer}decode(t,r){if(this._isArrayBuffer(t)){let n=this._binaryDecode(t);return r(n)}if(typeof t=="string"){const n=JSON.parse(t),[s,o,h,i,m]=n;return r({join_ref:s,ref:o,topic:h,event:i,payload:m})}return r({})}_binaryDecode(t){const r=new DataView(t),n=r.getUint8(0),s=new TextDecoder;switch(n){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(t,r,s)}}_decodeUserBroadcast(t,r,n){const s=r.getUint8(1),o=r.getUint8(2),h=r.getUint8(3),i=r.getUint8(4);let m=this.HEADER_LENGTH+4;const y=n.decode(t.slice(m,m+s));m=m+s;const S=n.decode(t.slice(m,m+o));m=m+o;const b=n.decode(t.slice(m,m+h));m=m+h;const T=t.slice(m,t.byteLength),A=i===this.JSON_ENCODING?JSON.parse(n.decode(T)):T,O={type:this.BROADCAST_EVENT,event:S,payload:A};return h>0&&(O.meta=JSON.parse(b)),{join_ref:null,ref:null,topic:y,event:this.BROADCAST_EVENT,payload:O}}_isArrayBuffer(t){var r;return t instanceof ArrayBuffer||((r=t==null?void 0:t.constructor)===null||r===void 0?void 0:r.name)==="ArrayBuffer"}}class Rte{constructor(t,r){this.callback=t,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ia;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(ia||(ia={}));const EH=(e,t,r={})=>{var n;const s=(n=r.skipTypes)!==null&&n!==void 0?n:[];return t?Object.keys(t).reduce((o,h)=>(o[h]=F1e(h,e,t,s),o),{}):{}},F1e=(e,t,r,n)=>{const s=t.find(i=>i.name===e),o=s==null?void 0:s.type,h=r[e];return o&&!n.includes(o)?Mte(o,h):sF(h)},Mte=(e,t)=>{if(e.charAt(0)==="_"){const r=e.slice(1,e.length);return U1e(t,r)}switch(e){case ia.bool:return z1e(t);case ia.float4:case ia.float8:case ia.int2:case ia.int4:case ia.int8:case ia.numeric:case ia.oid:return B1e(t);case ia.json:case ia.jsonb:return $1e(t);case ia.timestamp:return V1e(t);case ia.abstime:case ia.date:case ia.daterange:case ia.int4range:case ia.int8range:case ia.money:case ia.reltime:case ia.text:case ia.time:case ia.timestamptz:case ia.timetz:case ia.tsrange:case ia.tstzrange:return sF(t);default:return sF(t)}},sF=e=>e,z1e=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},B1e=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},$1e=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},U1e=(e,t)=>{if(typeof e!="string")return e;const r=e.length-1,n=e[r];if(e[0]==="{"&&n==="}"){let o;const h=e.slice(1,r);try{o=JSON.parse("["+h+"]")}catch{o=h?h.split(","):[]}return o.map(i=>Mte(t,i))}return e},V1e=e=>typeof e=="string"?e.replace(" ","T"):e,Dte=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class PD{constructor(t,r,n={},s=nF){this.channel=t,this.event=r,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,r){var n;return this._hasReceived(t)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:t,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:r}){this.recHooks.filter(n=>n.status===t).forEach(n=>n.callback(r))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var aF;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(aF||(aF={}));class j0{constructor(t,r){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:o,onLeave:h,onSync:i}=this.caller;this.joinRef=this.channel._joinRef(),this.state=j0.syncState(this.state,s,o,h),this.pendingDiffs.forEach(m=>{this.state=j0.syncDiff(this.state,m,o,h)}),this.pendingDiffs=[],i()}),this.channel._on(n.diff,{},s=>{const{onJoin:o,onLeave:h,onSync:i}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=j0.syncDiff(this.state,s,o,h),i())}),this.onJoin((s,o,h)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:o,newPresences:h})}),this.onLeave((s,o,h)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:o,leftPresences:h})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,r,n,s){const o=this.cloneDeep(t),h=this.transformState(r),i={},m={};return this.map(o,(y,S)=>{h[y]||(m[y]=S)}),this.map(h,(y,S)=>{const b=o[y];if(b){const T=S.map(I=>I.presence_ref),A=b.map(I=>I.presence_ref),O=S.filter(I=>A.indexOf(I.presence_ref)<0),P=b.filter(I=>T.indexOf(I.presence_ref)<0);O.length>0&&(i[y]=O),P.length>0&&(m[y]=P)}else i[y]=S}),this.syncDiff(o,{joins:i,leaves:m},n,s)}static syncDiff(t,r,n,s){const{joins:o,leaves:h}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(o,(i,m)=>{var y;const S=(y=t[i])!==null&&y!==void 0?y:[];if(t[i]=this.cloneDeep(m),S.length>0){const b=t[i].map(A=>A.presence_ref),T=S.filter(A=>b.indexOf(A.presence_ref)<0);t[i].unshift(...T)}n(i,S,m)}),this.map(h,(i,m)=>{let y=t[i];if(!y)return;const S=m.map(b=>b.presence_ref);y=y.filter(b=>S.indexOf(b.presence_ref)<0),t[i]=y,s(i,y,m),y.length===0&&delete t[i]}),t}static map(t,r){return Object.getOwnPropertyNames(t).map(n=>r(n,t[n]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((r,n)=>{const s=t[n];return"metas"in s?r[n]=s.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):r[n]=s,r},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var oF;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(oF||(oF={}));var P0;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(P0||(P0={}));var bh;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(bh||(bh={}));class gN{constructor(t,r={config:{}},n){var s,o;if(this.topic=t,this.params=r,this.socket=n,this.bindings={},this.state=qo.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new PD(this,Md.join,this.params,this.timeout),this.rejoinTimer=new Rte(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=qo.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(h=>h.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=qo.closed,this.socket._remove(this)}),this._onError(h=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,h),this.state=qo.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=qo.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",h=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,h),this.state=qo.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Md.reply,{},(h,i)=>{this._trigger(this._replyEventName(i),h)}),this.presence=new j0(this),this.broadcastEndpointURL=Dte(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((o=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||o===void 0)&&o.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,r=this.timeout){var n,s,o;if(this.socket.isConnected()||this.socket.connect(),this.state==qo.closed){const{config:{broadcast:h,presence:i,private:m}}=this.params,y=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(A=>A.filter))!==null&&s!==void 0?s:[],S=!!this.bindings[P0.PRESENCE]&&this.bindings[P0.PRESENCE].length>0||((o=this.params.config.presence)===null||o===void 0?void 0:o.enabled)===!0,b={},T={broadcast:h,presence:Object.assign(Object.assign({},i),{enabled:S}),postgres_changes:y,private:m};this.socket.accessTokenValue&&(b.access_token=this.socket.accessTokenValue),this._onError(A=>t==null?void 0:t(bh.CHANNEL_ERROR,A)),this._onClose(()=>t==null?void 0:t(bh.CLOSED)),this.updateJoinPayload(Object.assign({config:T},b)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:A})=>{var O;if(this.socket.setAuth(),A===void 0){t==null||t(bh.SUBSCRIBED);return}else{const P=this.bindings.postgres_changes,I=(O=P==null?void 0:P.length)!==null&&O!==void 0?O:0,R=[];for(let M=0;M<I;M++){const F=P[M],{filter:{event:z,schema:$,table:W,filter:K}}=F,ee=A&&A[M];if(ee&&ee.event===z&&ee.schema===$&&ee.table===W&&ee.filter===K)R.push(Object.assign(Object.assign({},F),{id:ee.id}));else{this.unsubscribe(),this.state=qo.errored,t==null||t(bh.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=R,t&&t(bh.SUBSCRIBED);return}}).receive("error",A=>{this.state=qo.errored,t==null||t(bh.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(A).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(bh.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,r={}){return await this.send({type:"presence",event:"track",payload:t},r.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,r,n){return this.state===qo.joined&&t===P0.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,r,n)}async httpSend(t,r,n={}){var s;const o=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(r==null)return Promise.reject("Payload is required for httpSend()");const h={method:"POST",headers:{Authorization:o,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:r,private:this.private}]})},i=await this._fetchWithTimeout(this.broadcastEndpointURL,h,(s=n.timeout)!==null&&s!==void 0?s:this.timeout);if(i.status===202)return{success:!0};let m=i.statusText;try{const y=await i.json();m=y.error||y.message||m}catch{}return Promise.reject(new Error(m))}async send(t,r={}){var n,s;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:o,payload:h}=t,m={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:h,private:this.private}]})};try{const y=await this._fetchWithTimeout(this.broadcastEndpointURL,m,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=y.body)===null||s===void 0?void 0:s.cancel()),y.ok?"ok":"error"}catch(y){return y.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var h,i,m;const y=this._push(t.type,t,r.timeout||this.timeout);t.type==="broadcast"&&!(!((m=(i=(h=this.params)===null||h===void 0?void 0:h.config)===null||i===void 0?void 0:i.broadcast)===null||m===void 0)&&m.ack)&&o("ok"),y.receive("ok",()=>o("ok")),y.receive("error",()=>o("error")),y.receive("timeout",()=>o("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=qo.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Md.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new PD(this,Md.leave,{},t),n.receive("ok",()=>{r(),s("ok")}).receive("timeout",()=>{r(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=qo.closed,this.bindings={}}async _fetchWithTimeout(t,r,n){const s=new AbortController,o=setTimeout(()=>s.abort(),n),h=await this.socket.fetch(t,Object.assign(Object.assign({},r),{signal:s.signal}));return clearTimeout(o),h}_push(t,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new PD(this,t,r,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>D1e){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(t,r,n){return r}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,r,n){var s,o;const h=t.toLocaleLowerCase(),{close:i,error:m,leave:y,join:S}=Md;if(n&&[i,m,y,S].indexOf(h)>=0&&n!==this._joinRef())return;let T=this._onMessage(h,r,n);if(r&&!T)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(h)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(A=>{var O,P,I;return((O=A.filter)===null||O===void 0?void 0:O.event)==="*"||((I=(P=A.filter)===null||P===void 0?void 0:P.event)===null||I===void 0?void 0:I.toLocaleLowerCase())===h}).map(A=>A.callback(T,n)):(o=this.bindings[h])===null||o===void 0||o.filter(A=>{var O,P,I,R,M,F;if(["broadcast","presence","postgres_changes"].includes(h))if("id"in A){const z=A.id,$=(O=A.filter)===null||O===void 0?void 0:O.event;return z&&((P=r.ids)===null||P===void 0?void 0:P.includes(z))&&($==="*"||($==null?void 0:$.toLocaleLowerCase())===((I=r.data)===null||I===void 0?void 0:I.type.toLocaleLowerCase()))}else{const z=(M=(R=A==null?void 0:A.filter)===null||R===void 0?void 0:R.event)===null||M===void 0?void 0:M.toLocaleLowerCase();return z==="*"||z===((F=r==null?void 0:r.event)===null||F===void 0?void 0:F.toLocaleLowerCase())}else return A.type.toLocaleLowerCase()===h}).map(A=>{if(typeof T=="object"&&"ids"in T){const O=T.data,{schema:P,table:I,commit_timestamp:R,type:M,errors:F}=O;T=Object.assign(Object.assign({},{schema:P,table:I,commit_timestamp:R,eventType:M,new:{},old:{},errors:F}),this._getPayloadRecords(O))}A.callback(T,n)})}_isClosed(){return this.state===qo.closed}_isJoined(){return this.state===qo.joined}_isJoining(){return this.state===qo.joining}_isLeaving(){return this.state===qo.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,r,n){const s=t.toLocaleLowerCase(),o={type:s,filter:r,callback:n};return this.bindings[s]?this.bindings[s].push(o):this.bindings[s]=[o],this}_off(t,r){const n=t.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var o;return!(((o=s.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===n&&gN.isEqual(s.filter,r))})),this}static isEqual(t,r){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const n in t)if(t[n]!==r[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Md.close,{},t)}_onError(t){this._on(Md.error,{},r=>t(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=qo.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const r={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(r.new=EH(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(r.old=EH(t.columns,t.old_record)),r}}const OD=()=>{},bj={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},q1e=[1e3,2e3,5e3,1e4],H1e=1e4,G1e=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Lte{constructor(t,r){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=nF,this.transport=null,this.heartbeatIntervalMs=bj.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=OD,this.ref=0,this.reconnectTimer=null,this.vsn=SH,this.logger=OD,this.conn=null,this.sendBuffer=[],this.serializer=new L1e,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>s?(...o)=>s(...o):(...o)=>fetch(...o),!(!((n=r==null?void 0:r.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${t}/${iF.websocket}`,this.httpEndpoint=Dte(t),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r==null?void 0:r.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Nte.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const r=t.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,r??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const r=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const t=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,r,n){this.logger(t,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Vy.connecting:return qy.Connecting;case Vy.open:return qy.Open;case Vy.closing:return qy.Closing;default:return qy.Closed}}isConnected(){return this.connectionState()===qy.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,r={config:{}}){const n=`realtime:${t}`,s=this.getChannels().find(o=>o.topic===n);if(s)return s;{const o=new gN(`realtime:${t}`,r,this);return this.channels.push(o),o}}push(t){const{topic:r,event:n,payload:s,ref:o}=t,h=()=>{this.encode(t,i=>{var m;(m=this.conn)===null||m===void 0||m.send(i)})};this.log("push",`${r} ${n} (${o})`,s),this.isConnected()?h():this.sendBuffer.push(h)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(M1e,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},bj.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let r=this.channels.find(n=>n.topic===t&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${t}"`),r.unsubscribe())}_remove(t){this.channels=this.channels.filter(r=>r.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply")try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error")}catch(y){this.log("error","error in heartbeat callback",y)}r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:s,payload:o,ref:h}=r,i=h?`(${h})`:"",m=o.status||"";this.log("receive",`${m} ${n} ${s} ${i}`.trim(),o),this.channels.filter(y=>y._isMember(n)).forEach(y=>y._trigger(s,o,h)),this._triggerStateCallbacks("message",r)})}_clearTimer(t){var r;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){if(this.conn){if(this.conn.readyState===Vy.open||this.conn.readyState===Vy.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(r=>{this.log("error","error waiting for auth on connect",r),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var r;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(Md.error))}_appendParams(t,r){if(Object.keys(r).length===0)return t;const n=t.match(/\?/)?"&":"?",s=new URLSearchParams(r);return`${t}${n}${s}`}_workerObjectUrl(t){let r;if(t)r=t;else{const n=new Blob([G1e],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}_setConnectionState(t,r=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(t=null){let r;t?r=t:this.accessToken?r=await this.accessToken():r=this.accessTokenValue,this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const s={access_token:r,version:I1e};r&&n.updateJoinPayload(s),n.joinedOnce&&n._isJoined()&&n._push(Md.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(r=>{this.log("error",`error setting auth in ${t}`,r)})}_triggerStateCallbacks(t,r){try{this.stateChangeCallbacks[t].forEach(n=>{try{n(r)}catch(s){this.log("error",`error in ${t} callback`,s)}})}catch(n){this.log("error",`error triggering ${t} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new Rte(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},bj.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var r,n,s,o,h,i,m,y,S,b,T,A;switch(this.transport=(r=t==null?void 0:t.transport)!==null&&r!==void 0?r:null,this.timeout=(n=t==null?void 0:t.timeout)!==null&&n!==void 0?n:nF,this.heartbeatIntervalMs=(s=t==null?void 0:t.heartbeatIntervalMs)!==null&&s!==void 0?s:bj.HEARTBEAT_INTERVAL,this.worker=(o=t==null?void 0:t.worker)!==null&&o!==void 0?o:!1,this.accessToken=(h=t==null?void 0:t.accessToken)!==null&&h!==void 0?h:null,this.heartbeatCallback=(i=t==null?void 0:t.heartbeatCallback)!==null&&i!==void 0?i:OD,this.vsn=(m=t==null?void 0:t.vsn)!==null&&m!==void 0?m:SH,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(y=t==null?void 0:t.reconnectAfterMs)!==null&&y!==void 0?y:O=>q1e[O-1]||H1e,this.vsn){case Ite:this.encode=(S=t==null?void 0:t.encode)!==null&&S!==void 0?S:(O,P)=>P(JSON.stringify(O)),this.decode=(b=t==null?void 0:t.decode)!==null&&b!==void 0?b:(O,P)=>P(JSON.parse(O));break;case R1e:this.encode=(T=t==null?void 0:t.encode)!==null&&T!==void 0?T:this.serializer.encode.bind(this.serializer),this.decode=(A=t==null?void 0:t.decode)!==null&&A!==void 0?A:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}class XB extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function La(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class W1e extends XB{constructor(t,r,n){super(t),this.name="StorageApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class lF extends XB{constructor(t,r){super(t),this.name="StorageUnknownError",this.originalError=r}}const YB=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),K1e=()=>Response,cF=e=>{if(Array.isArray(e))return e.map(r=>cF(r));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([r,n])=>{const s=r.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));t[s]=cF(n)}),t},Z1e=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},kD=e=>{var t;return e.msg||e.message||e.error_description||(typeof e.error=="string"?e.error:(t=e.error)===null||t===void 0?void 0:t.message)||JSON.stringify(e)},X1e=(e,t,r)=>kn(void 0,void 0,void 0,function*(){const n=yield K1e();e instanceof n&&!(r!=null&&r.noResolveJson)?e.json().then(s=>{const o=e.status||500,h=(s==null?void 0:s.statusCode)||o+"";t(new W1e(kD(s),o,h))}).catch(s=>{t(new lF(kD(s),s))}):t(new lF(kD(e),e))}),Y1e=(e,t,r,n)=>{const s={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"||!n?s:(Z1e(n)?(s.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),s.body=JSON.stringify(n)):s.body=n,t!=null&&t.duplex&&(s.duplex=t.duplex),Object.assign(Object.assign({},s),r))};function T2(e,t,r,n,s,o){return kn(this,void 0,void 0,function*(){return new Promise((h,i)=>{e(r,Y1e(t,n,s,o)).then(m=>{if(!m.ok)throw m;return n!=null&&n.noResolveJson?m:m.json()}).then(m=>h(m)).catch(m=>X1e(m,i,n))})})}function pT(e,t,r,n){return kn(this,void 0,void 0,function*(){return T2(e,"GET",t,r,n)})}function kd(e,t,r,n,s){return kn(this,void 0,void 0,function*(){return T2(e,"POST",t,n,s,r)})}function uF(e,t,r,n,s){return kn(this,void 0,void 0,function*(){return T2(e,"PUT",t,n,s,r)})}function J1e(e,t,r,n){return kn(this,void 0,void 0,function*(){return T2(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function JB(e,t,r,n,s){return kn(this,void 0,void 0,function*(){return T2(e,"DELETE",t,n,s,r)})}class Q1e{constructor(t,r){this.downloadFn=t,this.shouldThrowOnError=r}then(t,r){return this.execute().then(t,r)}execute(){return kn(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(La(t))return{data:null,error:t};throw t}})}}var Fte;class eSe{constructor(t,r){this.downloadFn=t,this.shouldThrowOnError=r,this[Fte]="BlobDownloadBuilder",this.promise=null}asStream(){return new Q1e(this.downloadFn,this.shouldThrowOnError)}then(t,r){return this.getPromise().then(t,r)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return kn(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(La(t))return{data:null,error:t};throw t}})}}Fte=Symbol.toStringTag;const tSe={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},TH={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class rSe{constructor(t,r={},n,s){this.shouldThrowOnError=!1,this.url=t,this.headers=r,this.bucketId=n,this.fetch=YB(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,r,n,s){return kn(this,void 0,void 0,function*(){try{let o;const h=Object.assign(Object.assign({},TH),s);let i=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(h.upsert)});const m=h.metadata;typeof Blob<"u"&&n instanceof Blob?(o=new FormData,o.append("cacheControl",h.cacheControl),m&&o.append("metadata",this.encodeMetadata(m)),o.append("",n)):typeof FormData<"u"&&n instanceof FormData?(o=n,o.has("cacheControl")||o.append("cacheControl",h.cacheControl),m&&!o.has("metadata")&&o.append("metadata",this.encodeMetadata(m))):(o=n,i["cache-control"]=`max-age=${h.cacheControl}`,i["content-type"]=h.contentType,m&&(i["x-metadata"]=this.toBase64(this.encodeMetadata(m))),(typeof ReadableStream<"u"&&o instanceof ReadableStream||o&&typeof o=="object"&&"pipe"in o&&typeof o.pipe=="function")&&!h.duplex&&(h.duplex="half")),s!=null&&s.headers&&(i=Object.assign(Object.assign({},i),s.headers));const y=this._removeEmptyFolders(r),S=this._getFinalPath(y),b=yield(t=="PUT"?uF:kd)(this.fetch,`${this.url}/object/${S}`,o,Object.assign({headers:i},h!=null&&h.duplex?{duplex:h.duplex}:{}));return{data:{path:y,id:b.Id,fullPath:b.Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(La(o))return{data:null,error:o};throw o}})}upload(t,r,n){return kn(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,r,n)})}uploadToSignedUrl(t,r,n,s){return kn(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(t),h=this._getFinalPath(o),i=new URL(this.url+`/object/upload/sign/${h}`);i.searchParams.set("token",r);try{let m;const y=Object.assign({upsert:TH.upsert},s),S=Object.assign(Object.assign({},this.headers),{"x-upsert":String(y.upsert)});typeof Blob<"u"&&n instanceof Blob?(m=new FormData,m.append("cacheControl",y.cacheControl),m.append("",n)):typeof FormData<"u"&&n instanceof FormData?(m=n,m.append("cacheControl",y.cacheControl)):(m=n,S["cache-control"]=`max-age=${y.cacheControl}`,S["content-type"]=y.contentType);const b=yield uF(this.fetch,i.toString(),m,{headers:S});return{data:{path:o,fullPath:b.Key},error:null}}catch(m){if(this.shouldThrowOnError)throw m;if(La(m))return{data:null,error:m};throw m}})}createSignedUploadUrl(t,r){return kn(this,void 0,void 0,function*(){try{let n=this._getFinalPath(t);const s=Object.assign({},this.headers);r!=null&&r.upsert&&(s["x-upsert"]="true");const o=yield kd(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),h=new URL(this.url+o.url),i=h.searchParams.get("token");if(!i)throw new XB("No token returned by API");return{data:{signedUrl:h.toString(),path:t,token:i},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(La(n))return{data:null,error:n};throw n}})}update(t,r,n){return kn(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,r,n)})}move(t,r,n){return kn(this,void 0,void 0,function*(){try{return{data:yield kd(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(La(s))return{data:null,error:s};throw s}})}copy(t,r,n){return kn(this,void 0,void 0,function*(){try{return{data:{path:(yield kd(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(La(s))return{data:null,error:s};throw s}})}createSignedUrl(t,r,n){return kn(this,void 0,void 0,function*(){try{let s=this._getFinalPath(t),o=yield kd(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:r},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const h=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${h}`)},{data:o,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(La(s))return{data:null,error:s};throw s}})}createSignedUrls(t,r,n){return kn(this,void 0,void 0,function*(){try{const s=yield kd(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:t},{headers:this.headers}),o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(h=>Object.assign(Object.assign({},h),{signedUrl:h.signedURL?encodeURI(`${this.url}${h.signedURL}${o}`):null})),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(La(s))return{data:null,error:s};throw s}})}download(t,r){const s=typeof(r==null?void 0:r.transform)<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString((r==null?void 0:r.transform)||{}),h=o?`?${o}`:"",i=this._getFinalPath(t),m=()=>pT(this.fetch,`${this.url}/${s}/${i}${h}`,{headers:this.headers,noResolveJson:!0});return new eSe(m,this.shouldThrowOnError)}info(t){return kn(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{const n=yield pT(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:cF(n),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(La(n))return{data:null,error:n};throw n}})}exists(t){return kn(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{return yield J1e(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(La(n)&&n instanceof lF){const s=n.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:n}}throw n}})}getPublicUrl(t,r){const n=this._getFinalPath(t),s=[],o=r!=null&&r.download?`download=${r.download===!0?"":r.download}`:"";o!==""&&s.push(o);const i=typeof(r==null?void 0:r.transform)<"u"?"render/image":"object",m=this.transformOptsToQueryString((r==null?void 0:r.transform)||{});m!==""&&s.push(m);let y=s.join("&");return y!==""&&(y=`?${y}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${n}${y}`)}}}remove(t){return kn(this,void 0,void 0,function*(){try{return{data:yield JB(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(La(r))return{data:null,error:r};throw r}})}list(t,r,n){return kn(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},tSe),r),{prefix:t||""});return{data:yield kd(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(La(s))return{data:null,error:s};throw s}})}listV2(t,r){return kn(this,void 0,void 0,function*(){try{const n=Object.assign({},t);return{data:yield kd(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(La(n))return{data:null,error:n};throw n}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const r=[];return t.width&&r.push(`width=${t.width}`),t.height&&r.push(`height=${t.height}`),t.resize&&r.push(`resize=${t.resize}`),t.format&&r.push(`format=${t.format}`),t.quality&&r.push(`quality=${t.quality}`),r.join("&")}}const zte="2.84.0",Bte={"X-Client-Info":`storage-js/${zte}`};class nSe{constructor(t,r={},n,s){this.shouldThrowOnError=!1;const o=new URL(t);s!=null&&s.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Bte),r),this.fetch=YB(n)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(t){return kn(this,void 0,void 0,function*(){try{const r=this.listBucketOptionsToQueryString(t);return{data:yield pT(this.fetch,`${this.url}/bucket${r}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(La(r))return{data:null,error:r};throw r}})}getBucket(t){return kn(this,void 0,void 0,function*(){try{return{data:yield pT(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(La(r))return{data:null,error:r};throw r}})}createBucket(t){return kn(this,arguments,void 0,function*(r,n={public:!1}){try{return{data:yield kd(this.fetch,`${this.url}/bucket`,{id:r,name:r,type:n.type,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(La(s))return{data:null,error:s};throw s}})}updateBucket(t,r){return kn(this,void 0,void 0,function*(){try{return{data:yield uF(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(La(n))return{data:null,error:n};throw n}})}emptyBucket(t){return kn(this,void 0,void 0,function*(){try{return{data:yield kd(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(La(r))return{data:null,error:r};throw r}})}deleteBucket(t){return kn(this,void 0,void 0,function*(){try{return{data:yield JB(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(La(r))return{data:null,error:r};throw r}})}listBucketOptionsToQueryString(t){const r={};return t&&("limit"in t&&(r.limit=String(t.limit)),"offset"in t&&(r.offset=String(t.offset)),t.search&&(r.search=t.search),t.sortColumn&&(r.sortColumn=t.sortColumn),t.sortOrder&&(r.sortOrder=t.sortOrder)),Object.keys(r).length>0?"?"+new URLSearchParams(r).toString():""}}class iSe{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Bte),r),this.fetch=YB(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return kn(this,void 0,void 0,function*(){try{return{data:yield kd(this.fetch,`${this.url}/bucket`,{name:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(La(r))return{data:null,error:r};throw r}})}listBuckets(t){return kn(this,void 0,void 0,function*(){try{const r=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&r.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&r.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&r.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&r.set("sortOrder",t.sortOrder),t!=null&&t.search&&r.set("search",t.search);const n=r.toString(),s=n?`${this.url}/bucket?${n}`:`${this.url}/bucket`;return{data:yield pT(this.fetch,s,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(La(r))return{data:null,error:r};throw r}})}deleteBucket(t){return kn(this,void 0,void 0,function*(){try{return{data:yield JB(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(La(r))return{data:null,error:r};throw r}})}}const QB={"X-Client-Info":`storage-js/${zte}`,"Content-Type":"application/json"};class $te extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function pu(e){return typeof e=="object"&&e!==null&&"__isStorageVectorsError"in e}class ND extends $te{constructor(t,r,n){super(t),this.name="StorageVectorsApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class sSe extends $te{constructor(t,r){super(t),this.name="StorageVectorsUnknownError",this.originalError=r}}var AH;(function(e){e.InternalError="InternalError",e.S3VectorConflictException="S3VectorConflictException",e.S3VectorNotFoundException="S3VectorNotFoundException",e.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",e.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",e.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(AH||(AH={}));const e5=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),aSe=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},CH=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),oSe=(e,t,r)=>kn(void 0,void 0,void 0,function*(){if(e&&typeof e=="object"&&"status"in e&&"ok"in e&&typeof e.status=="number"&&!(r!=null&&r.noResolveJson)){const s=e.status||500,o=e;if(typeof o.json=="function")o.json().then(h=>{const i=(h==null?void 0:h.statusCode)||(h==null?void 0:h.code)||s+"";t(new ND(CH(h),s,i))}).catch(()=>{const h=s+"",i=o.statusText||`HTTP ${s} error`;t(new ND(i,s,h))});else{const h=s+"",i=o.statusText||`HTTP ${s} error`;t(new ND(i,s,h))}}else t(new sSe(CH(e),e))}),lSe=(e,t,r,n)=>{const s={method:e,headers:(t==null?void 0:t.headers)||{}};return n?(aSe(n)?(s.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),s.body=JSON.stringify(n)):s.body=n,Object.assign(Object.assign({},s),r)):s};function cSe(e,t,r,n,s,o){return kn(this,void 0,void 0,function*(){return new Promise((h,i)=>{e(r,lSe(t,n,s,o)).then(m=>{if(!m.ok)throw m;if(n!=null&&n.noResolveJson)return m;const y=m.headers.get("content-type");return!y||!y.includes("application/json")?{}:m.json()}).then(m=>h(m)).catch(m=>oSe(m,i,n))})})}function mu(e,t,r,n,s){return kn(this,void 0,void 0,function*(){return cSe(e,"POST",t,n,s,r)})}class uSe{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},QB),r),this.fetch=e5(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(t){return kn(this,void 0,void 0,function*(){try{return{data:(yield mu(this.fetch,`${this.url}/CreateIndex`,t,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(pu(r))return{data:null,error:r};throw r}})}getIndex(t,r){return kn(this,void 0,void 0,function*(){try{return{data:yield mu(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:t,indexName:r},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(pu(n))return{data:null,error:n};throw n}})}listIndexes(t){return kn(this,void 0,void 0,function*(){try{return{data:yield mu(this.fetch,`${this.url}/ListIndexes`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(pu(r))return{data:null,error:r};throw r}})}deleteIndex(t,r){return kn(this,void 0,void 0,function*(){try{return{data:(yield mu(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:t,indexName:r},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(pu(n))return{data:null,error:n};throw n}})}}class dSe{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},QB),r),this.fetch=e5(n)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(t){return kn(this,void 0,void 0,function*(){try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield mu(this.fetch,`${this.url}/PutVectors`,t,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(pu(r))return{data:null,error:r};throw r}})}getVectors(t){return kn(this,void 0,void 0,function*(){try{return{data:yield mu(this.fetch,`${this.url}/GetVectors`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(pu(r))return{data:null,error:r};throw r}})}listVectors(t){return kn(this,void 0,void 0,function*(){try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:yield mu(this.fetch,`${this.url}/ListVectors`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(pu(r))return{data:null,error:r};throw r}})}queryVectors(t){return kn(this,void 0,void 0,function*(){try{return{data:yield mu(this.fetch,`${this.url}/QueryVectors`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(pu(r))return{data:null,error:r};throw r}})}deleteVectors(t){return kn(this,void 0,void 0,function*(){try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield mu(this.fetch,`${this.url}/DeleteVectors`,t,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(pu(r))return{data:null,error:r};throw r}})}}class hSe{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},QB),r),this.fetch=e5(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return kn(this,void 0,void 0,function*(){try{return{data:(yield mu(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(pu(r))return{data:null,error:r};throw r}})}getBucket(t){return kn(this,void 0,void 0,function*(){try{return{data:yield mu(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(pu(r))return{data:null,error:r};throw r}})}listBuckets(){return kn(this,arguments,void 0,function*(t={}){try{return{data:yield mu(this.fetch,`${this.url}/ListVectorBuckets`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(pu(r))return{data:null,error:r};throw r}})}deleteBucket(t){return kn(this,void 0,void 0,function*(){try{return{data:(yield mu(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(pu(r))return{data:null,error:r};throw r}})}}class fSe extends hSe{constructor(t,r={}){super(t,r.headers||{},r.fetch)}from(t){return new pSe(this.url,this.headers,t,this.fetch)}}class pSe extends uSe{constructor(t,r,n,s){super(t,r,s),this.vectorBucketName=n}createIndex(t){const r=Object.create(null,{createIndex:{get:()=>super.createIndex}});return kn(this,void 0,void 0,function*(){return r.createIndex.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const t=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return kn(this,arguments,void 0,function*(r={}){return t.listIndexes.call(this,Object.assign(Object.assign({},r),{vectorBucketName:this.vectorBucketName}))})}getIndex(t){const r=Object.create(null,{getIndex:{get:()=>super.getIndex}});return kn(this,void 0,void 0,function*(){return r.getIndex.call(this,this.vectorBucketName,t)})}deleteIndex(t){const r=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return kn(this,void 0,void 0,function*(){return r.deleteIndex.call(this,this.vectorBucketName,t)})}index(t){return new mSe(this.url,this.headers,this.vectorBucketName,t,this.fetch)}}class mSe extends dSe{constructor(t,r,n,s,o){super(t,r,o),this.vectorBucketName=n,this.indexName=s}putVectors(t){const r=Object.create(null,{putVectors:{get:()=>super.putVectors}});return kn(this,void 0,void 0,function*(){return r.putVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(t){const r=Object.create(null,{getVectors:{get:()=>super.getVectors}});return kn(this,void 0,void 0,function*(){return r.getVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const t=Object.create(null,{listVectors:{get:()=>super.listVectors}});return kn(this,arguments,void 0,function*(r={}){return t.listVectors.call(this,Object.assign(Object.assign({},r),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(t){const r=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return kn(this,void 0,void 0,function*(){return r.queryVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(t){const r=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return kn(this,void 0,void 0,function*(){return r.deleteVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class gSe extends nSe{constructor(t,r={},n,s){super(t,r,n,s)}from(t){return new rSe(this.url,this.headers,t,this.fetch)}get vectors(){return new fSe(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new iSe(this.url+"/iceberg",this.headers,this.fetch)}}const ySe="2.84.0";let uE="";typeof Deno<"u"?uE="deno":typeof document<"u"?uE="web":typeof navigator<"u"&&navigator.product==="ReactNative"?uE="react-native":uE="node";const vSe={"X-Client-Info":`supabase-js-${uE}/${ySe}`},_Se={headers:vSe},xSe={schema:"public"},bSe={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},wSe={},SSe=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),ESe=()=>Headers,TSe=(e,t,r)=>{const n=SSe(r),s=ESe();return async(o,h)=>{var i;const m=(i=await t())!==null&&i!==void 0?i:e;let y=new s(h==null?void 0:h.headers);return y.has("apikey")||y.set("apikey",e),y.has("Authorization")||y.set("Authorization",`Bearer ${m}`),n(o,Object.assign(Object.assign({},h),{headers:y}))}};function ASe(e){return e.endsWith("/")?e:e+"/"}function CSe(e,t){var r,n;const{db:s,auth:o,realtime:h,global:i}=e,{db:m,auth:y,realtime:S,global:b}=t,T={db:Object.assign(Object.assign({},m),s),auth:Object.assign(Object.assign({},y),o),realtime:Object.assign(Object.assign({},S),h),storage:{},global:Object.assign(Object.assign(Object.assign({},b),i),{headers:Object.assign(Object.assign({},(r=b==null?void 0:b.headers)!==null&&r!==void 0?r:{}),(n=i==null?void 0:i.headers)!==null&&n!==void 0?n:{})}),accessToken:async()=>""};return e.accessToken?T.accessToken=e.accessToken:delete T.accessToken,T}function jSe(e){const t=e==null?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(ASe(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const Ute="2.84.0",Xx=30*1e3,dF=3,ID=dF*Xx,PSe="http://localhost:9999",OSe="supabase.auth.token",kSe={"X-Client-Info":`gotrue-js/${Ute}`},hF="X-Supabase-Api-Version",Vte={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},NSe=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,ISe=10*60*1e3;class ob extends Error{constructor(t,r,n){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function In(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class qte extends ob{constructor(t,r,n){super(t,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function Hte(e){return In(e)&&e.name==="AuthApiError"}class jm extends ob{constructor(t,r){super(t),this.name="AuthUnknownError",this.originalError=r}}class pp extends ob{constructor(t,r,n,s){super(t,n,s),this.name=r,this.status=n}}class Ic extends pp{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Gte(e){return In(e)&&e.name==="AuthSessionMissingError"}class Dy extends pp{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class dE extends pp{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class hE extends pp{constructor(t,r=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Wte(e){return In(e)&&e.name==="AuthImplicitGrantRedirectError"}class fF extends pp{constructor(t,r=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class nO extends pp{constructor(t,r){super(t,"AuthRetryableFetchError",r,void 0)}}function aP(e){return In(e)&&e.name==="AuthRetryableFetchError"}class pF extends pp{constructor(t,r,n){super(t,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class iO extends pp{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const sO="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),jH=` 	
\r=`.split(""),RSe=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<jH.length;t+=1)e[jH[t].charCodeAt(0)]=-2;for(let t=0;t<sO.length;t+=1)e[sO[t].charCodeAt(0)]=t;return e})();function PH(e,t,r){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(sO[n]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(sO[n]),t.queuedBits-=6}}function Kte(e,t,r){const n=RSe[e];if(n>-1)for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function OH(e){const t=[],r=h=>{t.push(String.fromCodePoint(h))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},o=h=>{LSe(h,n,r)};for(let h=0;h<e.length;h+=1)Kte(e.charCodeAt(h),s,o);return t.join("")}function MSe(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function DSe(e,t){for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(e.charCodeAt(r+1)-56320&65535|s)+65536,r+=1}MSe(n,t)}}function LSe(e,t,r){if(t.utf8seq===0){if(e<=127){r(e);return}for(let n=1;n<6;n+=1)if(!(e>>7-n&1)){t.utf8seq=n;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&r(t.codepoint)}}function O0(e){const t=[],r={queue:0,queuedBits:0},n=s=>{t.push(s)};for(let s=0;s<e.length;s+=1)Kte(e.charCodeAt(s),r,n);return new Uint8Array(t)}function FSe(e){const t=[];return DSe(e,r=>t.push(r)),new Uint8Array(t)}function Zy(e){const t=[],r={queue:0,queuedBits:0},n=s=>{t.push(s)};return e.forEach(s=>PH(s,r,n)),PH(null,r,n),t.join("")}function zSe(e){return Math.round(Date.now()/1e3)+e}function BSe(){return Symbol("auth-callback")}const xl=()=>typeof window<"u"&&typeof document<"u",Py={tested:!1,writable:!1},Zte=()=>{if(!xl())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Py.tested)return Py.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Py.tested=!0,Py.writable=!0}catch{Py.tested=!0,Py.writable=!1}return Py.writable};function $Se(e){const t={},r=new URL(e);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((s,o)=>{t[o]=s})}catch{}return r.searchParams.forEach((n,s)=>{t[s]=n}),t}const Xte=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),USe=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",Yx=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},Oy=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch{return r}},fm=async(e,t)=>{await e.removeItem(t)};class yN{constructor(){this.promise=new yN.promiseConstructor((t,r)=>{this.resolve=t,this.reject=r})}}yN.promiseConstructor=Promise;function RD(e){const t=e.split(".");if(t.length!==3)throw new iO("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!NSe.test(t[n]))throw new iO("JWT not in base64url format");return{header:JSON.parse(OH(t[0])),payload:JSON.parse(OH(t[1])),signature:O0(t[2]),raw:{header:t[0],payload:t[1]}}}async function VSe(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function qSe(e,t){return new Promise((n,s)=>{(async()=>{for(let o=0;o<1/0;o++)try{const h=await e(o);if(!t(o,null,h)){n(h);return}}catch(h){if(!t(o,h)){s(h);return}}})()})}function HSe(e){return("0"+e.toString(16)).substr(-2)}function GSe(){const t=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let s="";for(let o=0;o<56;o++)s+=r.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(t),Array.from(t,HSe).join("")}async function WSe(e){const r=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",r),s=new Uint8Array(n);return Array.from(s).map(o=>String.fromCharCode(o)).join("")}async function KSe(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const r=await WSe(e);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Nx(e,t,r=!1){const n=GSe();let s=n;r&&(s+="/PASSWORD_RECOVERY"),await Yx(e,`${t}-code-verifier`,s);const o=await KSe(n);return[o,n===o?"plain":"s256"]}const ZSe=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function XSe(e){const t=e.headers.get(hF);if(!t||!t.match(ZSe))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function YSe(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function JSe(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const QSe=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ix(e){if(!QSe.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function MD(){const e={};return new Proxy(e,{get:(t,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function eEe(e,t){return new Proxy(e,{get:(r,n,s)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const o=n.toString();if(o==="Symbol(Symbol.toPrimitive)"||o==="Symbol(Symbol.toStringTag)"||o==="Symbol(util.inspect.custom)"||o==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,n,s)}return!t.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(r,n,s)}})}function kH(e){return JSON.parse(JSON.stringify(e))}const Ly=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),tEe=[502,503,504];async function NH(e){var t;if(!USe(e))throw new nO(Ly(e),0);if(tEe.includes(e.status))throw new nO(Ly(e),e.status);let r;try{r=await e.json()}catch(o){throw new jm(Ly(o),o)}let n;const s=XSe(e);if(s&&s.getTime()>=Vte["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new pF(Ly(r),e.status,((t=r.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(n==="session_not_found")throw new Ic}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((o,h)=>o&&typeof h=="string",!0))throw new pF(Ly(r),e.status,r.weak_password.reasons);throw new qte(Ly(r),e.status||500,n)}const rEe=(e,t,r,n)=>{const s={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),r))};async function li(e,t,r,n){var s;const o=Object.assign({},n==null?void 0:n.headers);o[hF]||(o[hF]=Vte["2024-01-01"].name),n!=null&&n.jwt&&(o.Authorization=`Bearer ${n.jwt}`);const h=(s=n==null?void 0:n.query)!==null&&s!==void 0?s:{};n!=null&&n.redirectTo&&(h.redirect_to=n.redirectTo);const i=Object.keys(h).length?"?"+new URLSearchParams(h).toString():"",m=await nEe(e,t,r+i,{headers:o,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(m):{data:Object.assign({},m),error:null}}async function nEe(e,t,r,n,s,o){const h=rEe(t,n,s,o);let i;try{i=await e(r,Object.assign({},h))}catch(m){throw console.error(m),new nO(Ly(m),0)}if(i.ok||await NH(i),n!=null&&n.noResolveJson)return i;try{return await i.json()}catch(m){await NH(m)}}function Cd(e){var t;let r=null;aEe(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=zSe(e.expires_in)));const n=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:r,user:n},error:null}}function IH(e){const t=Cd(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(t.data.weak_password=e.weak_password),t}function Pm(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function iEe(e){return{data:e,error:null}}function sEe(e){const{action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:o}=e,h=bg(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),i={action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:o},m=Object.assign({},h);return{data:{properties:i,user:m},error:null}}function RH(e){return e}function aEe(e){return e.access_token&&e.refresh_token&&e.expires_in}const oP=["global","local","others"];class Yte{constructor({url:t="",headers:r={},fetch:n}){this.url=t,this.headers=r,this.fetch=Xte(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,r=oP[0]){if(oP.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${oP.join(", ")}`);try{return await li(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(n){if(In(n))return{data:null,error:n};throw n}}async inviteUserByEmail(t,r={}){try{return await li(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Pm})}catch(n){if(In(n))return{data:{user:null},error:n};throw n}}async generateLink(t){try{const{options:r}=t,n=bg(t,["options"]),s=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(s.new_email=n==null?void 0:n.newEmail,delete s.newEmail),await li(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:sEe,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if(In(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(t){try{return await li(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Pm})}catch(r){if(In(r))return{data:{user:null},error:r};throw r}}async listUsers(t){var r,n,s,o,h,i,m;try{const y={nextPage:null,lastPage:0,total:0},S=await li(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(o=(s=t==null?void 0:t.perPage)===null||s===void 0?void 0:s.toString())!==null&&o!==void 0?o:""},xform:RH});if(S.error)throw S.error;const b=await S.json(),T=(h=S.headers.get("x-total-count"))!==null&&h!==void 0?h:0,A=(m=(i=S.headers.get("link"))===null||i===void 0?void 0:i.split(","))!==null&&m!==void 0?m:[];return A.length>0&&(A.forEach(O=>{const P=parseInt(O.split(";")[0].split("=")[1].substring(0,1)),I=JSON.parse(O.split(";")[1].split("=")[1]);y[`${I}Page`]=P}),y.total=parseInt(T)),{data:Object.assign(Object.assign({},b),y),error:null}}catch(y){if(In(y))return{data:{users:[]},error:y};throw y}}async getUserById(t){Ix(t);try{return await li(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Pm})}catch(r){if(In(r))return{data:{user:null},error:r};throw r}}async updateUserById(t,r){Ix(t);try{return await li(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:r,headers:this.headers,xform:Pm})}catch(n){if(In(n))return{data:{user:null},error:n};throw n}}async deleteUser(t,r=!1){Ix(t);try{return await li(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:r},xform:Pm})}catch(n){if(In(n))return{data:{user:null},error:n};throw n}}async _listFactors(t){Ix(t.userId);try{const{data:r,error:n}=await li(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:r,error:n}}catch(r){if(In(r))return{data:null,error:r};throw r}}async _deleteFactor(t){Ix(t.userId),Ix(t.id);try{return{data:await li(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(r){if(In(r))return{data:null,error:r};throw r}}async _listOAuthClients(t){var r,n,s,o,h,i,m;try{const y={nextPage:null,lastPage:0,total:0},S=await li(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(o=(s=t==null?void 0:t.perPage)===null||s===void 0?void 0:s.toString())!==null&&o!==void 0?o:""},xform:RH});if(S.error)throw S.error;const b=await S.json(),T=(h=S.headers.get("x-total-count"))!==null&&h!==void 0?h:0,A=(m=(i=S.headers.get("link"))===null||i===void 0?void 0:i.split(","))!==null&&m!==void 0?m:[];return A.length>0&&(A.forEach(O=>{const P=parseInt(O.split(";")[0].split("=")[1].substring(0,1)),I=JSON.parse(O.split(";")[1].split("=")[1]);y[`${I}Page`]=P}),y.total=parseInt(T)),{data:Object.assign(Object.assign({},b),y),error:null}}catch(y){if(In(y))return{data:{clients:[]},error:y};throw y}}async _createOAuthClient(t){try{return await li(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(In(r))return{data:null,error:r};throw r}}async _getOAuthClient(t){try{return await li(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(In(r))return{data:null,error:r};throw r}}async _updateOAuthClient(t,r){try{return await li(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:r,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(In(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(t){try{return await li(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if(In(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(t){try{return await li(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(In(r))return{data:null,error:r};throw r}}}function MH(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const Fy={debug:!!(globalThis&&Zte()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Jte extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class Qte extends Jte{}async function ere(e,t,r){Fy.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),Fy.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){Fy.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,s.name);try{return await r()}finally{Fy.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,s.name)}}else{if(t===0)throw Fy.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Qte(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Fy.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function oEe(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function tre(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function lEe(e){return parseInt(e,16)}function cEe(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,n=>n.toString(16).padStart(2,"0")).join("")}function uEe(e){var t;const{chainId:r,domain:n,expirationTime:s,issuedAt:o=new Date,nonce:h,notBefore:i,requestId:m,resources:y,scheme:S,uri:b,version:T}=e;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(h&&h.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${h}`);if(!b)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(T!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${T}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const A=tre(e.address),O=S?`${S}://${n}`:n,P=e.statement?`${e.statement}
`:"",I=`${O} wants you to sign in with your Ethereum account:
${A}

${P}`;let R=`URI: ${b}
Version: ${T}
Chain ID: ${r}${h?`
Nonce: ${h}`:""}
Issued At: ${o.toISOString()}`;if(s&&(R+=`
Expiration Time: ${s.toISOString()}`),i&&(R+=`
Not Before: ${i.toISOString()}`),m&&(R+=`
Request ID: ${m}`),y){let M=`
Resources:`;for(const F of y){if(!F||typeof F!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${F}`);M+=`
- ${F}`}R+=M}return`${I}
${R}`}class jo extends Error{constructor({message:t,code:r,cause:n,name:s}){var o;super(t,{cause:n}),this.__isWebAuthnError=!0,this.name=(o=s??(n instanceof Error?n.name:void 0))!==null&&o!==void 0?o:"Unknown Error",this.code=r}}class aO extends jo{constructor(t,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:t}),this.name="WebAuthnUnknownError",this.originalError=r}}function dEe({error:e,options:t}){var r,n,s;const{publicKey:o}=t;if(!o)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new jo({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((r=o.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new jo({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((n=o.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new jo({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((s=o.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new jo({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new jo({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new jo({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return o.pubKeyCredParams.filter(i=>i.type==="public-key").length===0?new jo({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new jo({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const h=window.location.hostname;if(rre(h)){if(o.rp.id!==h)return new jo({message:`The RP ID "${o.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new jo({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(o.user.id.byteLength<1||o.user.id.byteLength>64)return new jo({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new jo({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new jo({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function hEe({error:e,options:t}){const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new jo({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new jo({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const n=window.location.hostname;if(rre(n)){if(r.rpId!==n)return new jo({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new jo({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new jo({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new jo({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}class fEe{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const pEe=new fEe;function mEe(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:r,excludeCredentials:n}=e,s=bg(e,["challenge","user","excludeCredentials"]),o=O0(t).buffer,h=Object.assign(Object.assign({},r),{id:O0(r.id).buffer}),i=Object.assign(Object.assign({},s),{challenge:o,user:h});if(n&&n.length>0){i.excludeCredentials=new Array(n.length);for(let m=0;m<n.length;m++){const y=n[m];i.excludeCredentials[m]=Object.assign(Object.assign({},y),{id:O0(y.id).buffer,type:y.type||"public-key",transports:y.transports})}}return i}function gEe(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:r}=e,n=bg(e,["challenge","allowCredentials"]),s=O0(t).buffer,o=Object.assign(Object.assign({},n),{challenge:s});if(r&&r.length>0){o.allowCredentials=new Array(r.length);for(let h=0;h<r.length;h++){const i=r[h];o.allowCredentials[h]=Object.assign(Object.assign({},i),{id:O0(i.id).buffer,type:i.type||"public-key",transports:i.transports})}}return o}function yEe(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e;return{id:e.id,rawId:e.id,response:{attestationObject:Zy(new Uint8Array(e.response.attestationObject)),clientDataJSON:Zy(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function vEe(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e,n=e.getClientExtensionResults(),s=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:Zy(new Uint8Array(s.authenticatorData)),clientDataJSON:Zy(new Uint8Array(s.clientDataJSON)),signature:Zy(new Uint8Array(s.signature)),userHandle:s.userHandle?Zy(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function rre(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function DH(){var e,t;return!!(xl()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function _Ee(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new aO("Browser returned unexpected credential type",t)}:{data:null,error:new aO("Empty credential response",t)}}catch(t){return{data:null,error:dEe({error:t,options:e})}}}async function xEe(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new aO("Browser returned unexpected credential type",t)}:{data:null,error:new aO("Empty credential response",t)}}catch(t){return{data:null,error:hEe({error:t,options:e})}}}const bEe={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},wEe={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function oO(...e){const t=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),r=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),n={};for(const s of e)if(s)for(const o in s){const h=s[o];if(h!==void 0)if(Array.isArray(h))n[o]=h;else if(r(h))n[o]=h;else if(t(h)){const i=n[o];t(i)?n[o]=oO(i,h):n[o]=oO(h)}else n[o]=h}return n}function SEe(e,t){return oO(bEe,e,t||{})}function EEe(e,t){return oO(wEe,e,t||{})}class TEe{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:r,friendlyName:n,signal:s},o){try{const{data:h,error:i}=await this.client.mfa.challenge({factorId:t,webauthn:r});if(!h)return{data:null,error:i};const m=s??pEe.createNewAbortSignal();if(h.webauthn.type==="create"){const{user:y}=h.webauthn.credential_options.publicKey;y.name||(y.name=`${y.id}:${n}`),y.displayName||(y.displayName=y.name)}switch(h.webauthn.type){case"create":{const y=SEe(h.webauthn.credential_options.publicKey,o==null?void 0:o.create),{data:S,error:b}=await _Ee({publicKey:y,signal:m});return S?{data:{factorId:t,challengeId:h.id,webauthn:{type:h.webauthn.type,credential_response:S}},error:null}:{data:null,error:b}}case"request":{const y=EEe(h.webauthn.credential_options.publicKey,o==null?void 0:o.request),{data:S,error:b}=await xEe(Object.assign(Object.assign({},h.webauthn.credential_options),{publicKey:y,signal:m}));return S?{data:{factorId:t,challengeId:h.id,webauthn:{type:h.webauthn.type,credential_response:S}},error:null}:{data:null,error:b}}}}catch(h){return In(h)?{data:null,error:h}:{data:null,error:new jm("Unexpected error in challenge",h)}}}async _verify({challengeId:t,factorId:r,webauthn:n}){return this.client.mfa.verify({factorId:r,challengeId:t,webauthn:n})}async _authenticate({factorId:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},o){if(!r)return{data:null,error:new ob("rpId is required for WebAuthn authentication")};try{if(!DH())return{data:null,error:new jm("Browser does not support WebAuthn",null)};const{data:h,error:i}=await this.challenge({factorId:t,webauthn:{rpId:r,rpOrigins:n},signal:s},{request:o});if(!h)return{data:null,error:i};const{webauthn:m}=h;return this._verify({factorId:t,challengeId:h.challengeId,webauthn:{type:m.type,rpId:r,rpOrigins:n,credential_response:m.credential_response}})}catch(h){return In(h)?{data:null,error:h}:{data:null,error:new jm("Unexpected error in authenticate",h)}}}async _register({friendlyName:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},o){if(!r)return{data:null,error:new ob("rpId is required for WebAuthn registration")};try{if(!DH())return{data:null,error:new jm("Browser does not support WebAuthn",null)};const{data:h,error:i}=await this._enroll({friendlyName:t});if(!h)return await this.client.mfa.listFactors().then(S=>{var b;return(b=S.data)===null||b===void 0?void 0:b.all.find(T=>T.factor_type==="webauthn"&&T.friendly_name===t&&T.status!=="unverified")}).then(S=>S?this.client.mfa.unenroll({factorId:S==null?void 0:S.id}):void 0),{data:null,error:i};const{data:m,error:y}=await this._challenge({factorId:h.id,friendlyName:h.friendly_name,webauthn:{rpId:r,rpOrigins:n},signal:s},{create:o});return m?this._verify({factorId:h.id,challengeId:m.challengeId,webauthn:{rpId:r,rpOrigins:n,type:m.webauthn.type,credential_response:m.webauthn.credential_response}}):{data:null,error:y}}catch(h){return In(h)?{data:null,error:h}:{data:null,error:new jm("Unexpected error in register",h)}}}}oEe();const AEe={url:PSe,storageKey:OSe,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:kSe,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function LH(e,t,r){return await r()}const Rx={};class lb{get jwks(){var t,r;return(r=(t=Rx[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(t){Rx[this.storageKey]=Object.assign(Object.assign({},Rx[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,r;return(r=(t=Rx[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){Rx[this.storageKey]=Object.assign(Object.assign({},Rx[this.storageKey]),{cachedAt:t})}constructor(t){var r,n,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const o=Object.assign(Object.assign({},AEe),t);if(this.storageKey=o.storageKey,this.instanceID=(r=lb.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,lb.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.instanceID>0&&xl()){const h=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(h),this.logDebugMessages&&console.trace(h)}if(this.persistSession=o.persistSession,this.autoRefreshToken=o.autoRefreshToken,this.admin=new Yte({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=Xte(o.fetch),this.lock=o.lock||LH,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,this.throwOnError=o.throwOnError,o.lock?this.lock=o.lock:xl()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=ere:this.lock=LH,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new TEe(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:Zte()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=MH(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=MH(this.memoryStorage)),xl()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(h){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",h)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async h=>{this._debug("received broadcast notification from other tab or client",h),await this._notifyAllSubscribers(h.data.event,h.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Ute}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let r={},n="none";if(xl()&&(r=$Se(window.location.href),this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce")),xl()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:o}=await this._getSessionFromURL(r,n);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),Wte(o)){const m=(t=o.details)===null||t===void 0?void 0:t.code;if(m==="identity_already_exists"||m==="identity_not_found"||m==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:h,redirectType:i}=s;return this._debug("#_initialize()","detected session in URL",h,"redirect type",i),await this._saveSession(h),setTimeout(async()=>{i==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",h):await this._notifyAllSubscribers("SIGNED_IN",h)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return In(r)?this._returnResult({error:r}):this._returnResult({error:new jm("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var r,n,s;try{const o=await li(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=t==null?void 0:t.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=t==null?void 0:t.options)===null||s===void 0?void 0:s.captchaToken}},xform:Cd}),{data:h,error:i}=o;if(i||!h)return this._returnResult({data:{user:null,session:null},error:i});const m=h.session,y=h.user;return h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",m)),this._returnResult({data:{user:y,session:m},error:null})}catch(o){if(In(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signUp(t){var r,n,s;try{let o;if("email"in t){const{email:S,password:b,options:T}=t;let A=null,O=null;this.flowType==="pkce"&&([A,O]=await Nx(this.storage,this.storageKey)),o=await li(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:T==null?void 0:T.emailRedirectTo,body:{email:S,password:b,data:(r=T==null?void 0:T.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:T==null?void 0:T.captchaToken},code_challenge:A,code_challenge_method:O},xform:Cd})}else if("phone"in t){const{phone:S,password:b,options:T}=t;o=await li(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:S,password:b,data:(n=T==null?void 0:T.data)!==null&&n!==void 0?n:{},channel:(s=T==null?void 0:T.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:T==null?void 0:T.captchaToken}},xform:Cd})}else throw new dE("You must provide either an email or phone number and a password");const{data:h,error:i}=o;if(i||!h)return this._returnResult({data:{user:null,session:null},error:i});const m=h.session,y=h.user;return h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",m)),this._returnResult({data:{user:y,session:m},error:null})}catch(o){if(In(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithPassword(t){try{let r;if("email"in t){const{email:o,password:h,options:i}=t;r=await li(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:h,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:IH})}else if("phone"in t){const{phone:o,password:h,options:i}=t;r=await li(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:h,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:IH})}else throw new dE("You must provide either an email or phone number and a password");const{data:n,error:s}=r;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!n||!n.session||!n.user){const o=new Dy;return this._returnResult({data:{user:null,session:null},error:o})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(r){if(In(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(t){var r,n,s,o;return await this._handleProviderSignIn(t.provider,{redirectTo:(r=t.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=t.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=t.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(o=t.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:r}=t;switch(r){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(t){var r,n,s,o,h,i,m,y,S,b,T;let A,O;if("message"in t)A=t.message,O=t.signature;else{const{chain:P,wallet:I,statement:R,options:M}=t;let F;if(xl())if(typeof I=="object")F=I;else{const ne=window;if("ethereum"in ne&&typeof ne.ethereum=="object"&&"request"in ne.ethereum&&typeof ne.ethereum.request=="function")F=ne.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof I!="object"||!(M!=null&&M.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");F=I}const z=new URL((r=M==null?void 0:M.url)!==null&&r!==void 0?r:window.location.href),$=await F.request({method:"eth_requestAccounts"}).then(ne=>ne).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!$||$.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const W=tre($[0]);let K=(n=M==null?void 0:M.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!K){const ne=await F.request({method:"eth_chainId"});K=lEe(ne)}const ee={domain:z.host,address:W,statement:R,uri:z.href,version:"1",chainId:K,nonce:(s=M==null?void 0:M.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(h=(o=M==null?void 0:M.signInWithEthereum)===null||o===void 0?void 0:o.issuedAt)!==null&&h!==void 0?h:new Date,expirationTime:(i=M==null?void 0:M.signInWithEthereum)===null||i===void 0?void 0:i.expirationTime,notBefore:(m=M==null?void 0:M.signInWithEthereum)===null||m===void 0?void 0:m.notBefore,requestId:(y=M==null?void 0:M.signInWithEthereum)===null||y===void 0?void 0:y.requestId,resources:(S=M==null?void 0:M.signInWithEthereum)===null||S===void 0?void 0:S.resources};A=uEe(ee),O=await F.request({method:"personal_sign",params:[cEe(A),W]})}try{const{data:P,error:I}=await li(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:A,signature:O},!((b=t.options)===null||b===void 0)&&b.captchaToken?{gotrue_meta_security:{captcha_token:(T=t.options)===null||T===void 0?void 0:T.captchaToken}}:null),xform:Cd});if(I)throw I;if(!P||!P.session||!P.user){const R=new Dy;return this._returnResult({data:{user:null,session:null},error:R})}return P.session&&(await this._saveSession(P.session),await this._notifyAllSubscribers("SIGNED_IN",P.session)),this._returnResult({data:Object.assign({},P),error:I})}catch(P){if(In(P))return this._returnResult({data:{user:null,session:null},error:P});throw P}}async signInWithSolana(t){var r,n,s,o,h,i,m,y,S,b,T,A;let O,P;if("message"in t)O=t.message,P=t.signature;else{const{chain:I,wallet:R,statement:M,options:F}=t;let z;if(xl())if(typeof R=="object")z=R;else{const W=window;if("solana"in W&&typeof W.solana=="object"&&("signIn"in W.solana&&typeof W.solana.signIn=="function"||"signMessage"in W.solana&&typeof W.solana.signMessage=="function"))z=W.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof R!="object"||!(F!=null&&F.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");z=R}const $=new URL((r=F==null?void 0:F.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in z&&z.signIn){const W=await z.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},F==null?void 0:F.signInWithSolana),{version:"1",domain:$.host,uri:$.href}),M?{statement:M}:null));let K;if(Array.isArray(W)&&W[0]&&typeof W[0]=="object")K=W[0];else if(W&&typeof W=="object"&&"signedMessage"in W&&"signature"in W)K=W;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in K&&"signature"in K&&(typeof K.signedMessage=="string"||K.signedMessage instanceof Uint8Array)&&K.signature instanceof Uint8Array)O=typeof K.signedMessage=="string"?K.signedMessage:new TextDecoder().decode(K.signedMessage),P=K.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in z)||typeof z.signMessage!="function"||!("publicKey"in z)||typeof z!="object"||!z.publicKey||!("toBase58"in z.publicKey)||typeof z.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");O=[`${$.host} wants you to sign in with your Solana account:`,z.publicKey.toBase58(),...M?["",M,""]:[""],"Version: 1",`URI: ${$.href}`,`Issued At: ${(s=(n=F==null?void 0:F.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((o=F==null?void 0:F.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${F.signInWithSolana.notBefore}`]:[],...!((h=F==null?void 0:F.signInWithSolana)===null||h===void 0)&&h.expirationTime?[`Expiration Time: ${F.signInWithSolana.expirationTime}`]:[],...!((i=F==null?void 0:F.signInWithSolana)===null||i===void 0)&&i.chainId?[`Chain ID: ${F.signInWithSolana.chainId}`]:[],...!((m=F==null?void 0:F.signInWithSolana)===null||m===void 0)&&m.nonce?[`Nonce: ${F.signInWithSolana.nonce}`]:[],...!((y=F==null?void 0:F.signInWithSolana)===null||y===void 0)&&y.requestId?[`Request ID: ${F.signInWithSolana.requestId}`]:[],...!((b=(S=F==null?void 0:F.signInWithSolana)===null||S===void 0?void 0:S.resources)===null||b===void 0)&&b.length?["Resources",...F.signInWithSolana.resources.map(K=>`- ${K}`)]:[]].join(`
`);const W=await z.signMessage(new TextEncoder().encode(O),"utf8");if(!W||!(W instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");P=W}}try{const{data:I,error:R}=await li(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:O,signature:Zy(P)},!((T=t.options)===null||T===void 0)&&T.captchaToken?{gotrue_meta_security:{captcha_token:(A=t.options)===null||A===void 0?void 0:A.captchaToken}}:null),xform:Cd});if(R)throw R;if(!I||!I.session||!I.user){const M=new Dy;return this._returnResult({data:{user:null,session:null},error:M})}return I.session&&(await this._saveSession(I.session),await this._notifyAllSubscribers("SIGNED_IN",I.session)),this._returnResult({data:Object.assign({},I),error:R})}catch(I){if(In(I))return this._returnResult({data:{user:null,session:null},error:I});throw I}}async _exchangeCodeForSession(t){const r=await Oy(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(r??"").split("/");try{const{data:o,error:h}=await li(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:Cd});if(await fm(this.storage,`${this.storageKey}-code-verifier`),h)throw h;if(!o||!o.session||!o.user){const i=new Dy;return this._returnResult({data:{user:null,session:null,redirectType:null},error:i})}return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),this._returnResult({data:Object.assign(Object.assign({},o),{redirectType:s??null}),error:h})}catch(o){if(In(o))return this._returnResult({data:{user:null,session:null,redirectType:null},error:o});throw o}}async signInWithIdToken(t){try{const{options:r,provider:n,token:s,access_token:o,nonce:h}=t,i=await li(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:o,nonce:h,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:Cd}),{data:m,error:y}=i;if(y)return this._returnResult({data:{user:null,session:null},error:y});if(!m||!m.session||!m.user){const S=new Dy;return this._returnResult({data:{user:null,session:null},error:S})}return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),this._returnResult({data:m,error:y})}catch(r){if(In(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(t){var r,n,s,o,h;try{if("email"in t){const{email:i,options:m}=t;let y=null,S=null;this.flowType==="pkce"&&([y,S]=await Nx(this.storage,this.storageKey));const{error:b}=await li(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:i,data:(r=m==null?void 0:m.data)!==null&&r!==void 0?r:{},create_user:(n=m==null?void 0:m.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken},code_challenge:y,code_challenge_method:S},redirectTo:m==null?void 0:m.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:b})}if("phone"in t){const{phone:i,options:m}=t,{data:y,error:S}=await li(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:i,data:(s=m==null?void 0:m.data)!==null&&s!==void 0?s:{},create_user:(o=m==null?void 0:m.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken},channel:(h=m==null?void 0:m.channel)!==null&&h!==void 0?h:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:y==null?void 0:y.message_id},error:S})}throw new dE("You must provide either an email or phone number.")}catch(i){if(In(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async verifyOtp(t){var r,n;try{let s,o;"options"in t&&(s=(r=t.options)===null||r===void 0?void 0:r.redirectTo,o=(n=t.options)===null||n===void 0?void 0:n.captchaToken);const{data:h,error:i}=await li(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:o}}),redirectTo:s,xform:Cd});if(i)throw i;if(!h)throw new Error("An error occurred on token verification.");const m=h.session,y=h.user;return m!=null&&m.access_token&&(await this._saveSession(m),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",m)),this._returnResult({data:{user:y,session:m},error:null})}catch(s){if(In(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithSSO(t){var r,n,s,o,h;try{let i=null,m=null;this.flowType==="pkce"&&([i,m]=await Nx(this.storage,this.storageKey));const y=await li(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(n=(r=t.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=t==null?void 0:t.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:m}),headers:this.headers,xform:iEe});return!((o=y.data)===null||o===void 0)&&o.url&&xl()&&!(!((h=t.options)===null||h===void 0)&&h.skipBrowserRedirect)&&window.location.assign(y.data.url),this._returnResult(y)}catch(i){if(In(i))return this._returnResult({data:null,error:i});throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;if(n)throw n;if(!r)throw new Ic;const{error:s}=await li(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(t){if(In(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const r=`${this.url}/resend`;if("email"in t){const{email:n,type:s,options:o}=t,{error:h}=await li(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},redirectTo:o==null?void 0:o.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:h})}else if("phone"in t){const{phone:n,type:s,options:o}=t,{data:h,error:i}=await li(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:h==null?void 0:h.message_id},error:i})}throw new dE("You must provide either an email or phone number and a type")}catch(r){if(In(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(t,r){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await t(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const r=await Oy(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=t.expires_at?t.expires_at*1e3-Date.now()<ID:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n){if(this.userStorage){const h=await Oy(this.userStorage,this.storageKey+"-user");h!=null&&h.user?t.user=h.user:t.user=MD()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const h={value:this.suppressGetSessionWarning};t.user=eEe(t.user,h),h.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:s,error:o}=await this._callRefreshToken(t.refresh_token);return o?this._returnResult({data:{session:null},error:o}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await li(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Pm}):await this._useSession(async r=>{var n,s,o;const{data:h,error:i}=r;if(i)throw i;return!(!((n=h.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ic}:await li(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(s=h.session)===null||s===void 0?void 0:s.access_token)!==null&&o!==void 0?o:void 0,xform:Pm})})}catch(r){if(In(r))return Gte(r)&&(await this._removeSession(),await fm(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(t,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,r))}async _updateUser(t,r={}){try{return await this._useSession(async n=>{const{data:s,error:o}=n;if(o)throw o;if(!s.session)throw new Ic;const h=s.session;let i=null,m=null;this.flowType==="pkce"&&t.email!=null&&([i,m]=await Nx(this.storage,this.storageKey));const{data:y,error:S}=await li(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:i,code_challenge_method:m}),jwt:h.access_token,xform:Pm});if(S)throw S;return h.user=y.user,await this._saveSession(h),await this._notifyAllSubscribers("USER_UPDATED",h),this._returnResult({data:{user:h.user},error:null})})}catch(n){if(In(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Ic;const r=Date.now()/1e3;let n=r,s=!0,o=null;const{payload:h}=RD(t.access_token);if(h.exp&&(n=h.exp,s=n<=r),s){const{data:i,error:m}=await this._callRefreshToken(t.refresh_token);if(m)return this._returnResult({data:{user:null,session:null},error:m});if(!i)return{data:{user:null,session:null},error:null};o=i}else{const{data:i,error:m}=await this._getUser(t.access_token);if(m)throw m;o={access_token:t.access_token,refresh_token:t.refresh_token,user:i.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return this._returnResult({data:{user:o.user,session:o},error:null})}catch(r){if(In(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async r=>{var n;if(!t){const{data:h,error:i}=r;if(i)throw i;t=(n=h.session)!==null&&n!==void 0?n:void 0}if(!(t!=null&&t.refresh_token))throw new Ic;const{data:s,error:o}=await this._callRefreshToken(t.refresh_token);return o?this._returnResult({data:{user:null,session:null},error:o}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if(In(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(t,r){try{if(!xl())throw new hE("No browser detected.");if(t.error||t.error_description||t.error_code)throw new hE(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new fF("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new hE("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new fF("No code detected.");const{data:M,error:F}=await this._exchangeCodeForSession(t.code);if(F)throw F;const z=new URL(window.location.href);return z.searchParams.delete("code"),window.history.replaceState(window.history.state,"",z.toString()),{data:{session:M.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:o,refresh_token:h,expires_in:i,expires_at:m,token_type:y}=t;if(!o||!i||!h||!y)throw new hE("No session defined in URL");const S=Math.round(Date.now()/1e3),b=parseInt(i);let T=S+b;m&&(T=parseInt(m));const A=T-S;A*1e3<=Xx&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${A}s, should have been closer to ${b}s`);const O=T-b;S-O>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",O,T,S):S-O<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",O,T,S);const{data:P,error:I}=await this._getUser(o);if(I)throw I;const R={provider_token:n,provider_refresh_token:s,access_token:o,expires_in:b,expires_at:T,refresh_token:h,token_type:y,user:P.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:R,redirectType:t.type},error:null})}catch(n){if(In(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const r=await Oy(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&r)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:s,error:o}=r;if(o)return this._returnResult({error:o});const h=(n=s.session)===null||n===void 0?void 0:n.access_token;if(h){const{error:i}=await this.admin.signOut(h,t);if(i&&!(Hte(i)&&(i.status===404||i.status===401||i.status===403)))return this._returnResult({error:i})}return t!=="others"&&(await this._removeSession(),await fm(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const r=BSe(),n={id:r,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession(async r=>{var n,s;try{const{data:{session:o},error:h}=r;if(h)throw h;await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",t,"session",o)}catch(o){await((s=this.stateChangeEmitters.get(t))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",o),console.error(o)}})}async resetPasswordForEmail(t,r={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await Nx(this.storage,this.storageKey,!0));try{return await li(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(o){if(In(o))return this._returnResult({data:null,error:o});throw o}}async getUserIdentities(){var t;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(t=r.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(r){if(In(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var r;try{const{data:n,error:s}=await this._useSession(async o=>{var h,i,m,y,S;const{data:b,error:T}=o;if(T)throw T;const A=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(h=t.options)===null||h===void 0?void 0:h.redirectTo,scopes:(i=t.options)===null||i===void 0?void 0:i.scopes,queryParams:(m=t.options)===null||m===void 0?void 0:m.queryParams,skipBrowserRedirect:!0});return await li(this.fetch,"GET",A,{headers:this.headers,jwt:(S=(y=b.session)===null||y===void 0?void 0:y.access_token)!==null&&S!==void 0?S:void 0})});if(s)throw s;return xl()&&!(!((r=t.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),this._returnResult({data:{provider:t.provider,url:n==null?void 0:n.url},error:null})}catch(n){if(In(n))return this._returnResult({data:{provider:t.provider,url:null},error:n});throw n}}async linkIdentityIdToken(t){return await this._useSession(async r=>{var n;try{const{error:s,data:{session:o}}=r;if(s)throw s;const{options:h,provider:i,token:m,access_token:y,nonce:S}=t,b=await li(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=o==null?void 0:o.access_token)!==null&&n!==void 0?n:void 0,body:{provider:i,id_token:m,access_token:y,nonce:S,link_identity:!0,gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:Cd}),{data:T,error:A}=b;return A?this._returnResult({data:{user:null,session:null},error:A}):!T||!T.session||!T.user?this._returnResult({data:{user:null,session:null},error:new Dy}):(T.session&&(await this._saveSession(T.session),await this._notifyAllSubscribers("USER_UPDATED",T.session)),this._returnResult({data:T,error:A}))}catch(s){if(In(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}})}async unlinkIdentity(t){try{return await this._useSession(async r=>{var n,s;const{data:o,error:h}=r;if(h)throw h;return await li(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(s=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(r){if(In(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(t){const r=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await qSe(async s=>(s>0&&await VSe(200*Math.pow(2,s-1)),this._debug(r,"refreshing attempt",s),await li(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Cd})),(s,o)=>{const h=200*Math.pow(2,s);return o&&aP(o)&&Date.now()+h-n<Xx})}catch(n){if(this._debug(r,"error",n),In(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(r,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",r,"url",n),xl()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await Oy(this.storage,this.storageKey);if(s&&this.userStorage){let h=await Oy(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!h&&(h={user:s.user},await Yx(this.userStorage,this.storageKey+"-user",h)),s.user=(t=h==null?void 0:h.user)!==null&&t!==void 0?t:MD()}else if(s&&!s.user&&!s.user){const h=await Oy(this.storage,this.storageKey+"-user");h&&(h!=null&&h.user)?(s.user=h.user,await fm(this.storage,this.storageKey+"-user"),await Yx(this.storage,this.storageKey,s)):s.user=MD()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const o=((r=s.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<ID;if(this._debug(n,`session has${o?"":" not"} expired with margin of ${ID}s`),o){if(this.autoRefreshToken&&s.refresh_token){const{error:h}=await this._callRefreshToken(s.refresh_token);h&&(console.error(h),aP(h)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",h),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:h,error:i}=await this._getUser(s.access_token);!i&&(h!=null&&h.user)?(s.user=h.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(h){console.error("Error getting user data:",h),this._debug(n,"error getting user data, skipping SIGNED_IN notification",h)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(t){var r,n;if(!t)throw new Ic;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new yN;const{data:o,error:h}=await this._refreshAccessToken(t);if(h)throw h;if(!o.session)throw new Ic;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const i={data:o.session,error:null};return this.refreshingDeferred.resolve(i),i}catch(o){if(this._debug(s,"error",o),In(o)){const h={data:null,error:o};return aP(o)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(h),h}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(o),o}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(t,r,n=!0){const s=`#_notifyAllSubscribers(${t})`;this._debug(s,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:r});const o=[],h=Array.from(this.stateChangeEmitters.values()).map(async i=>{try{await i.callback(t,r)}catch(m){o.push(m)}});if(await Promise.all(h),o.length>0){for(let i=0;i<o.length;i+=1)console.error(o[i]);throw o[0]}}finally{this._debug(s,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const r=Object.assign({},t),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await Yx(this.userStorage,this.storageKey+"-user",{user:r.user});const s=Object.assign({},r);delete s.user;const o=kH(s);await Yx(this.storage,this.storageKey,o)}else{const s=kH(r);await Yx(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await fm(this.storage,this.storageKey),await fm(this.storage,this.storageKey+"-code-verifier"),await fm(this.storage,this.storageKey+"-user"),this.userStorage&&await fm(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&xl()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Xx);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-t)/Xx);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Xx}ms, refresh threshold is ${dF} ticks`),s<=dF&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof Jte)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!xl()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const r=`#_onVisibilityChanged(${t})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,r,n){const s=[`provider=${encodeURIComponent(r)}`];if(n!=null&&n.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[o,h]=await Nx(this.storage,this.storageKey),i=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(h)}`});s.push(i.toString())}if(n!=null&&n.queryParams){const o=new URLSearchParams(n.queryParams);s.push(o.toString())}return n!=null&&n.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${s.join("&")}`}async _unenroll(t){try{return await this._useSession(async r=>{var n;const{data:s,error:o}=r;return o?this._returnResult({data:null,error:o}):await li(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(In(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(t){try{return await this._useSession(async r=>{var n,s;const{data:o,error:h}=r;if(h)return this._returnResult({data:null,error:h});const i=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:m,error:y}=await li(this.fetch,"POST",`${this.url}/factors`,{body:i,headers:this.headers,jwt:(n=o==null?void 0:o.session)===null||n===void 0?void 0:n.access_token});return y?this._returnResult({data:null,error:y}):(t.factorType==="totp"&&m.type==="totp"&&(!((s=m==null?void 0:m.totp)===null||s===void 0)&&s.qr_code)&&(m.totp.qr_code=`data:image/svg+xml;utf-8,${m.totp.qr_code}`),this._returnResult({data:m,error:null}))})}catch(r){if(In(r))return this._returnResult({data:null,error:r});throw r}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:o}=r;if(o)return this._returnResult({data:null,error:o});const h=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?yEe(t.webauthn.credential_response):vEe(t.webauthn.credential_response)})}:{code:t.code}),{data:i,error:m}=await li(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:h,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return m?this._returnResult({data:null,error:m}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),this._returnResult({data:i,error:m}))})}catch(r){if(In(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:o}=r;if(o)return this._returnResult({data:null,error:o});const h=await li(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});if(h.error)return h;const{data:i}=h;if(i.type!=="webauthn")return{data:i,error:null};switch(i.webauthn.type){case"create":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:mEe(i.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:gEe(i.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(In(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(t){const{data:r,error:n}=await this._challenge({factorId:t.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:t.factorId,challengeId:r.id,code:t.code})}async _listFactors(){var t;const{data:{user:r},error:n}=await this.getUser();if(n)return{data:null,error:n};const s={all:[],phone:[],totp:[],webauthn:[]};for(const o of(t=r==null?void 0:r.factors)!==null&&t!==void 0?t:[])s.all.push(o),o.status==="verified"&&s[o.factor_type].push(o);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var t,r;const{data:{session:n},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=RD(n.access_token);let h=null;o.aal&&(h=o.aal);let i=h;((r=(t=n.user.factors)===null||t===void 0?void 0:t.filter(S=>S.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(i="aal2");const y=o.amr||[];return{data:{currentLevel:h,nextLevel:i,currentAuthenticationMethods:y},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async r=>{const{data:{session:n},error:s}=r;return s?this._returnResult({data:null,error:s}):n?await li(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:n.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new Ic})})}catch(r){if(In(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(t,r){try{return await this._useSession(async n=>{const{data:{session:s},error:o}=n;if(o)return this._returnResult({data:null,error:o});if(!s)return this._returnResult({data:null,error:new Ic});const h=await li(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:i=>({data:i,error:null})});return h.data&&h.data.redirect_url&&xl()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(h.data.redirect_url),h})}catch(n){if(In(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(t,r){try{return await this._useSession(async n=>{const{data:{session:s},error:o}=n;if(o)return this._returnResult({data:null,error:o});if(!s)return this._returnResult({data:null,error:new Ic});const h=await li(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:i=>({data:i,error:null})});return h.data&&h.data.redirect_url&&xl()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(h.data.redirect_url),h})}catch(n){if(In(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;return n?this._returnResult({data:null,error:n}):r?await li(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new Ic})})}catch(t){if(In(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async r=>{const{data:{session:n},error:s}=r;return s?this._returnResult({data:null,error:s}):n?await li(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:t.clientId},xform:()=>({data:{},error:null})}):this._returnResult({data:null,error:new Ic})})}catch(r){if(In(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(t,r={keys:[]}){let n=r.keys.find(i=>i.kid===t);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(i=>i.kid===t),n&&this.jwks_cached_at+ISe>s)return n;const{data:o,error:h}=await li(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(h)throw h;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=s,n=o.keys.find(i=>i.kid===t),!n)?null:n}async getClaims(t,r={}){try{let n=t;if(!n){const{data:A,error:O}=await this.getSession();if(O||!A.session)return this._returnResult({data:null,error:O});n=A.session.access_token}const{header:s,payload:o,signature:h,raw:{header:i,payload:m}}=RD(n);r!=null&&r.allowExpired||YSe(o.exp);const y=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,r!=null&&r.keys?{keys:r.keys}:r==null?void 0:r.jwks);if(!y){const{error:A}=await this.getUser(n);if(A)throw A;return{data:{claims:o,header:s,signature:h},error:null}}const S=JSe(s.alg),b=await crypto.subtle.importKey("jwk",y,S,!0,["verify"]);if(!await crypto.subtle.verify(S,b,h,FSe(`${i}.${m}`)))throw new iO("Invalid JWT signature");return{data:{claims:o,header:s,signature:h},error:null}}catch(n){if(In(n))return this._returnResult({data:null,error:n});throw n}}}lb.nextInstanceID={};const nre=lb;class CEe extends nre{constructor(t){super(t)}}class ire{constructor(t,r,n){var s,o,h;this.supabaseUrl=t,this.supabaseKey=r;const i=jSe(t);if(!r)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const m=`sb-${i.hostname.split(".")[0]}-auth-token`,y={db:xSe,realtime:wSe,auth:Object.assign(Object.assign({},bSe),{storageKey:m}),global:_Se},S=CSe(n??{},y);this.storageKey=(s=S.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(o=S.global.headers)!==null&&o!==void 0?o:{},S.accessToken?(this.accessToken=S.accessToken,this.auth=new Proxy({},{get:(b,T)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(T)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((h=S.auth)!==null&&h!==void 0?h:{},this.headers,S.global.fetch),this.fetch=TSe(r,this._getAccessToken.bind(this),S.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},S.realtime)),this.accessToken&&this.accessToken().then(b=>this.realtime.setAuth(b)).catch(b=>console.warn("Failed to set initial Realtime auth token:",b)),this.rest=new O1e(new URL("rest/v1",i).href,{headers:this.headers,schema:S.db.schema,fetch:this.fetch}),this.storage=new gSe(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),S.accessToken||this._listenForAuthEvents()}get functions(){return new C1e(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,r={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,r,n)}channel(t,r={config:{}}){return this.realtime.channel(t,r)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t,r;if(this.accessToken)return await this.accessToken();const{data:n}=await this.auth.getSession();return(r=(t=n.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:s,userStorage:o,storageKey:h,flowType:i,lock:m,debug:y,throwOnError:S},b,T){const A={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new CEe({url:this.authUrl.href,headers:Object.assign(Object.assign({},A),b),storageKey:h,autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:s,userStorage:o,flowType:i,lock:m,debug:y,throwOnError:S,fetch:T,hasCustomAuthorizationHeader:Object.keys(this.headers).some(O=>O.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new Lte(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,n)=>{this._handleTokenChanged(r,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(t,r,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const sre=(e,t,r)=>new ire(e,t,r);function jEe(){if(typeof window<"u"||typeof process>"u")return!1;const e=process.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}jEe()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const PEe=Object.freeze(Object.defineProperty({__proto__:null,AuthApiError:qte,AuthClient:nre,AuthError:ob,AuthImplicitGrantRedirectError:hE,AuthInvalidCredentialsError:dE,AuthInvalidJwtError:iO,AuthInvalidTokenResponseError:Dy,AuthPKCEGrantCodeExchangeError:fF,AuthRetryableFetchError:nO,AuthSessionMissingError:Ic,AuthUnknownError:jm,AuthWeakPasswordError:pF,CustomAuthError:pp,get FunctionRegion(){return rO},FunctionsError:mN,FunctionsFetchError:pte,FunctionsHttpError:rF,FunctionsRelayError:tF,GoTrueAdminApi:Yte,GoTrueClient:lb,NavigatorLockAcquireTimeoutError:Qte,PostgrestError:k1e,get REALTIME_LISTEN_TYPES(){return P0},get REALTIME_POSTGRES_CHANGES_LISTEN_EVENT(){return oF},get REALTIME_PRESENCE_LISTEN_EVENTS(){return aF},get REALTIME_SUBSCRIBE_STATES(){return bh},RealtimeChannel:gN,RealtimeClient:Lte,RealtimePresence:j0,SIGN_OUT_SCOPES:oP,SupabaseClient:ire,WebSocketFactory:Nte,createClient:sre,isAuthApiError:Hte,isAuthError:In,isAuthImplicitGrantRedirectError:Wte,isAuthRetryableFetchError:aP,isAuthSessionMissingError:Gte,lockInternals:Fy,navigatorLock:ere},Symbol.toStringTag,{value:"Module"})),OEe="https://tzdgqhwyzsxkxnncgzap.supabase.co",kEe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",Ct=sre(OEe,kEe,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),are=V.createContext(void 0),NEe=({children:e})=>{const[t,r]=V.useState(null),[n,s]=V.useState(null),[o,h]=V.useState(!0),i=Jc();V.useEffect(()=>{const{data:{subscription:O}}=Ct.auth.onAuthStateChange((P,I)=>{s(I),r((I==null?void 0:I.user)??null),P==="SIGNED_IN"&&I&&i("/")});return Ct.auth.getSession().then(({data:{session:P}})=>{s(P),r((P==null?void 0:P.user)??null),h(!1)}),()=>O.unsubscribe()},[i]);const m=async(O,P,I,R)=>{const M=`${window.location.origin}/`,{error:F}=await Ct.auth.signUp({email:O,password:P,options:{emailRedirectTo:M,data:{display_name:I,phone:R||null}}});return{error:F}},y=async(O,P)=>{const{error:I}=await Ct.auth.signInWithPassword({email:O,password:P});return{error:I}},S=async()=>{const{error:O}=await Ct.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/`}});return{error:O}},b=async O=>{const{error:P}=await Ct.auth.signInWithOtp({phone:O,options:{channel:"sms"}});return{error:P}},T=async(O,P)=>{const{error:I}=await Ct.auth.verifyOtp({phone:O,token:P,type:"sms"});return{error:I}},A=async()=>{try{r(null),s(null),await Ct.auth.signOut()}catch{console.log("Sign out completed (session may have already expired)")}i("/auth")};return d.jsx(are.Provider,{value:{user:t,session:n,signUp:m,signIn:y,signInWithGoogle:S,signInWithPhone:b,verifyOTP:T,signOut:A,loading:o},children:e})},Kn=()=>{const e=V.useContext(are);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e},cb=Wv("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 cursor-pointer",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Mt=V.forwardRef(({className:e,variant:t,size:r,asChild:n=!1,...s},o)=>{const h=n?Hv:"button";return d.jsx(h,{className:fr(cb({variant:t,size:r,className:e})),ref:o,...s})});Mt.displayName="Button";const IEe="/assets/xiaoxiong-logo-v3-D4uDr23w.png";var DD="focusScope.autoFocusOnMount",LD="focusScope.autoFocusOnUnmount",FH={bubbles:!1,cancelable:!0},REe="FocusScope",A2=V.forwardRef((e,t)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:s,onUnmountAutoFocus:o,...h}=e,[i,m]=V.useState(null),y=no(s),S=no(o),b=V.useRef(null),T=Un(t,P=>m(P)),A=V.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;V.useEffect(()=>{if(n){let P=function(F){if(A.paused||!i)return;const z=F.target;i.contains(z)?b.current=z:gm(b.current,{select:!0})},I=function(F){if(A.paused||!i)return;const z=F.relatedTarget;z!==null&&(i.contains(z)||gm(b.current,{select:!0}))},R=function(F){if(document.activeElement===document.body)for(const $ of F)$.removedNodes.length>0&&gm(i)};document.addEventListener("focusin",P),document.addEventListener("focusout",I);const M=new MutationObserver(R);return i&&M.observe(i,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",P),document.removeEventListener("focusout",I),M.disconnect()}}},[n,i,A.paused]),V.useEffect(()=>{if(i){BH.add(A);const P=document.activeElement;if(!i.contains(P)){const R=new CustomEvent(DD,FH);i.addEventListener(DD,y),i.dispatchEvent(R),R.defaultPrevented||(MEe(BEe(ore(i)),{select:!0}),document.activeElement===P&&gm(i))}return()=>{i.removeEventListener(DD,y),setTimeout(()=>{const R=new CustomEvent(LD,FH);i.addEventListener(LD,S),i.dispatchEvent(R),R.defaultPrevented||gm(P??document.body,{select:!0}),i.removeEventListener(LD,S),BH.remove(A)},0)}}},[i,y,S,A]);const O=V.useCallback(P=>{if(!r&&!n||A.paused)return;const I=P.key==="Tab"&&!P.altKey&&!P.ctrlKey&&!P.metaKey,R=document.activeElement;if(I&&R){const M=P.currentTarget,[F,z]=DEe(M);F&&z?!P.shiftKey&&R===z?(P.preventDefault(),r&&gm(F,{select:!0})):P.shiftKey&&R===F&&(P.preventDefault(),r&&gm(z,{select:!0})):R===M&&P.preventDefault()}},[r,n,A.paused]);return d.jsx(ln.div,{tabIndex:-1,...h,ref:T,onKeyDown:O})});A2.displayName=REe;function MEe(e,{select:t=!1}={}){const r=document.activeElement;for(const n of e)if(gm(n,{select:t}),document.activeElement!==r)return}function DEe(e){const t=ore(e),r=zH(t,e),n=zH(t.reverse(),e);return[r,n]}function ore(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function zH(e,t){for(const r of e)if(!LEe(r,{upTo:t}))return r}function LEe(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function FEe(e){return e instanceof HTMLInputElement&&"select"in e}function gm(e,{select:t=!1}={}){if(e&&e.focus){const r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&FEe(e)&&t&&e.select()}}var BH=zEe();function zEe(){let e=[];return{add(t){const r=e[0];t!==r&&(r==null||r.pause()),e=$H(e,t),e.unshift(t)},remove(t){var r;e=$H(e,t),(r=e[0])==null||r.resume()}}}function $H(e,t){const r=[...e],n=r.indexOf(t);return n!==-1&&r.splice(n,1),r}function BEe(e){return e.filter(t=>t.tagName!=="A")}var FD=0;function vN(){V.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??UH()),document.body.insertAdjacentElement("beforeend",e[1]??UH()),FD++,()=>{FD===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),FD--}},[])}function UH(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var lP="right-scroll-bar-position",cP="width-before-scroll-bar",$Ee="with-scroll-bars-hidden",UEe="--removed-body-scroll-bar-size";function zD(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function VEe(e,t){var r=V.useState(function(){return{value:e,callback:t,facade:{get current(){return r.value},set current(n){var s=r.value;s!==n&&(r.value=n,r.callback(n,s))}}}})[0];return r.callback=t,r.facade}var qEe=typeof window<"u"?V.useLayoutEffect:V.useEffect,VH=new WeakMap;function HEe(e,t){var r=VEe(null,function(n){return e.forEach(function(s){return zD(s,n)})});return qEe(function(){var n=VH.get(r);if(n){var s=new Set(n),o=new Set(e),h=r.current;s.forEach(function(i){o.has(i)||zD(i,null)}),o.forEach(function(i){s.has(i)||zD(i,h)})}VH.set(r,e)},[e]),r}function GEe(e){return e}function WEe(e,t){t===void 0&&(t=GEe);var r=[],n=!1,s={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(o){var h=t(o,n);return r.push(h),function(){r=r.filter(function(i){return i!==h})}},assignSyncMedium:function(o){for(n=!0;r.length;){var h=r;r=[],h.forEach(o)}r={push:function(i){return o(i)},filter:function(){return r}}},assignMedium:function(o){n=!0;var h=[];if(r.length){var i=r;r=[],i.forEach(o),h=r}var m=function(){var S=h;h=[],S.forEach(o)},y=function(){return Promise.resolve().then(m)};y(),r={push:function(S){h.push(S),y()},filter:function(S){return h=h.filter(S),r}}}};return s}function KEe(e){e===void 0&&(e={});var t=WEe(null);return t.options=Uu({async:!0,ssr:!1},e),t}var lre=function(e){var t=e.sideCar,r=bg(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=t.read();if(!n)throw new Error("Sidecar medium not found");return V.createElement(n,Uu({},r))};lre.isSideCarExport=!0;function ZEe(e,t){return e.useMedium(t),lre}var cre=KEe(),BD=function(){},_N=V.forwardRef(function(e,t){var r=V.useRef(null),n=V.useState({onScrollCapture:BD,onWheelCapture:BD,onTouchMoveCapture:BD}),s=n[0],o=n[1],h=e.forwardProps,i=e.children,m=e.className,y=e.removeScrollBar,S=e.enabled,b=e.shards,T=e.sideCar,A=e.noRelative,O=e.noIsolation,P=e.inert,I=e.allowPinchZoom,R=e.as,M=R===void 0?"div":R,F=e.gapMode,z=bg(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),$=T,W=HEe([r,t]),K=Uu(Uu({},z),s);return V.createElement(V.Fragment,null,S&&V.createElement($,{sideCar:cre,removeScrollBar:y,shards:b,noRelative:A,noIsolation:O,inert:P,setCallbacks:o,allowPinchZoom:!!I,lockRef:r,gapMode:F}),h?V.cloneElement(V.Children.only(i),Uu(Uu({},K),{ref:W})):V.createElement(M,Uu({},K,{className:m,ref:W}),i))});_N.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};_N.classNames={fullWidth:cP,zeroRight:lP};var XEe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function YEe(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=XEe();return t&&e.setAttribute("nonce",t),e}function JEe(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function QEe(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var eTe=function(){var e=0,t=null;return{add:function(r){e==0&&(t=YEe())&&(JEe(t,r),QEe(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},tTe=function(){var e=eTe();return function(t,r){V.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},ure=function(){var e=tTe(),t=function(r){var n=r.styles,s=r.dynamic;return e(n,s),null};return t},rTe={left:0,top:0,right:0,gap:0},$D=function(e){return parseInt(e||"",10)||0},nTe=function(e){var t=window.getComputedStyle(document.body),r=t[e==="padding"?"paddingLeft":"marginLeft"],n=t[e==="padding"?"paddingTop":"marginTop"],s=t[e==="padding"?"paddingRight":"marginRight"];return[$D(r),$D(n),$D(s)]},iTe=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return rTe;var t=nTe(e),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,n-r+t[2]-t[0])}},sTe=ure(),k0="data-scroll-locked",aTe=function(e,t,r,n){var s=e.left,o=e.top,h=e.right,i=e.gap;return r===void 0&&(r="margin"),`
  .`.concat($Ee,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(i,"px ").concat(n,`;
  }
  body[`).concat(k0,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(h,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(i,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(i,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(lP,` {
    right: `).concat(i,"px ").concat(n,`;
  }
  
  .`).concat(cP,` {
    margin-right: `).concat(i,"px ").concat(n,`;
  }
  
  .`).concat(lP," .").concat(lP,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(cP," .").concat(cP,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(k0,`] {
    `).concat(UEe,": ").concat(i,`px;
  }
`)},qH=function(){var e=parseInt(document.body.getAttribute(k0)||"0",10);return isFinite(e)?e:0},oTe=function(){V.useEffect(function(){return document.body.setAttribute(k0,(qH()+1).toString()),function(){var e=qH()-1;e<=0?document.body.removeAttribute(k0):document.body.setAttribute(k0,e.toString())}},[])},lTe=function(e){var t=e.noRelative,r=e.noImportant,n=e.gapMode,s=n===void 0?"margin":n;oTe();var o=V.useMemo(function(){return iTe(s)},[s]);return V.createElement(sTe,{styles:aTe(o,!t,s,r?"":"!important")})},mF=!1;if(typeof window<"u")try{var wj=Object.defineProperty({},"passive",{get:function(){return mF=!0,!0}});window.addEventListener("test",wj,wj),window.removeEventListener("test",wj,wj)}catch{mF=!1}var Mx=mF?{passive:!1}:!1,cTe=function(e){return e.tagName==="TEXTAREA"},dre=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return r[t]!=="hidden"&&!(r.overflowY===r.overflowX&&!cTe(e)&&r[t]==="visible")},uTe=function(e){return dre(e,"overflowY")},dTe=function(e){return dre(e,"overflowX")},HH=function(e,t){var r=t.ownerDocument,n=t;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var s=hre(e,n);if(s){var o=fre(e,n),h=o[1],i=o[2];if(h>i)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},hTe=function(e){var t=e.scrollTop,r=e.scrollHeight,n=e.clientHeight;return[t,r,n]},fTe=function(e){var t=e.scrollLeft,r=e.scrollWidth,n=e.clientWidth;return[t,r,n]},hre=function(e,t){return e==="v"?uTe(t):dTe(t)},fre=function(e,t){return e==="v"?hTe(t):fTe(t)},pTe=function(e,t){return e==="h"&&t==="rtl"?-1:1},mTe=function(e,t,r,n,s){var o=pTe(e,window.getComputedStyle(t).direction),h=o*n,i=r.target,m=t.contains(i),y=!1,S=h>0,b=0,T=0;do{if(!i)break;var A=fre(e,i),O=A[0],P=A[1],I=A[2],R=P-I-o*O;(O||R)&&hre(e,i)&&(b+=R,T+=O);var M=i.parentNode;i=M&&M.nodeType===Node.DOCUMENT_FRAGMENT_NODE?M.host:M}while(!m&&i!==document.body||m&&(t.contains(i)||t===i));return(S&&(Math.abs(b)<1||!s)||!S&&(Math.abs(T)<1||!s))&&(y=!0),y},Sj=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},GH=function(e){return[e.deltaX,e.deltaY]},WH=function(e){return e&&"current"in e?e.current:e},gTe=function(e,t){return e[0]===t[0]&&e[1]===t[1]},yTe=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},vTe=0,Dx=[];function _Te(e){var t=V.useRef([]),r=V.useRef([0,0]),n=V.useRef(),s=V.useState(vTe++)[0],o=V.useState(ure)[0],h=V.useRef(e);V.useEffect(function(){h.current=e},[e]),V.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(s));var P=KB([e.lockRef.current],(e.shards||[]).map(WH),!0).filter(Boolean);return P.forEach(function(I){return I.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),P.forEach(function(I){return I.classList.remove("allow-interactivity-".concat(s))})}}},[e.inert,e.lockRef.current,e.shards]);var i=V.useCallback(function(P,I){if("touches"in P&&P.touches.length===2||P.type==="wheel"&&P.ctrlKey)return!h.current.allowPinchZoom;var R=Sj(P),M=r.current,F="deltaX"in P?P.deltaX:M[0]-R[0],z="deltaY"in P?P.deltaY:M[1]-R[1],$,W=P.target,K=Math.abs(F)>Math.abs(z)?"h":"v";if("touches"in P&&K==="h"&&W.type==="range")return!1;var ee=HH(K,W);if(!ee)return!0;if(ee?$=K:($=K==="v"?"h":"v",ee=HH(K,W)),!ee)return!1;if(!n.current&&"changedTouches"in P&&(F||z)&&(n.current=$),!$)return!0;var ne=n.current||$;return mTe(ne,I,P,ne==="h"?F:z,!0)},[]),m=V.useCallback(function(P){var I=P;if(!(!Dx.length||Dx[Dx.length-1]!==o)){var R="deltaY"in I?GH(I):Sj(I),M=t.current.filter(function($){return $.name===I.type&&($.target===I.target||I.target===$.shadowParent)&&gTe($.delta,R)})[0];if(M&&M.should){I.cancelable&&I.preventDefault();return}if(!M){var F=(h.current.shards||[]).map(WH).filter(Boolean).filter(function($){return $.contains(I.target)}),z=F.length>0?i(I,F[0]):!h.current.noIsolation;z&&I.cancelable&&I.preventDefault()}}},[]),y=V.useCallback(function(P,I,R,M){var F={name:P,delta:I,target:R,should:M,shadowParent:xTe(R)};t.current.push(F),setTimeout(function(){t.current=t.current.filter(function(z){return z!==F})},1)},[]),S=V.useCallback(function(P){r.current=Sj(P),n.current=void 0},[]),b=V.useCallback(function(P){y(P.type,GH(P),P.target,i(P,e.lockRef.current))},[]),T=V.useCallback(function(P){y(P.type,Sj(P),P.target,i(P,e.lockRef.current))},[]);V.useEffect(function(){return Dx.push(o),e.setCallbacks({onScrollCapture:b,onWheelCapture:b,onTouchMoveCapture:T}),document.addEventListener("wheel",m,Mx),document.addEventListener("touchmove",m,Mx),document.addEventListener("touchstart",S,Mx),function(){Dx=Dx.filter(function(P){return P!==o}),document.removeEventListener("wheel",m,Mx),document.removeEventListener("touchmove",m,Mx),document.removeEventListener("touchstart",S,Mx)}},[]);var A=e.removeScrollBar,O=e.inert;return V.createElement(V.Fragment,null,O?V.createElement(o,{styles:yTe(s)}):null,A?V.createElement(lTe,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function xTe(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const bTe=ZEe(cre,_Te);var C2=V.forwardRef(function(e,t){return V.createElement(_N,Uu({},e,{ref:t,sideCar:bTe}))});C2.classNames=_N.classNames;var wTe=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},Lx=new WeakMap,Ej=new WeakMap,Tj={},UD=0,pre=function(e){return e&&(e.host||pre(e.parentNode))},STe=function(e,t){return t.map(function(r){if(e.contains(r))return r;var n=pre(r);return n&&e.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",e,". Doing nothing"),null)}).filter(function(r){return!!r})},ETe=function(e,t,r,n){var s=STe(t,Array.isArray(e)?e:[e]);Tj[r]||(Tj[r]=new WeakMap);var o=Tj[r],h=[],i=new Set,m=new Set(s),y=function(b){!b||i.has(b)||(i.add(b),y(b.parentNode))};s.forEach(y);var S=function(b){!b||m.has(b)||Array.prototype.forEach.call(b.children,function(T){if(i.has(T))S(T);else try{var A=T.getAttribute(n),O=A!==null&&A!=="false",P=(Lx.get(T)||0)+1,I=(o.get(T)||0)+1;Lx.set(T,P),o.set(T,I),h.push(T),P===1&&O&&Ej.set(T,!0),I===1&&T.setAttribute(r,"true"),O||T.setAttribute(n,"true")}catch(R){console.error("aria-hidden: cannot operate on ",T,R)}})};return S(t),i.clear(),UD++,function(){h.forEach(function(b){var T=Lx.get(b)-1,A=o.get(b)-1;Lx.set(b,T),o.set(b,A),T||(Ej.has(b)||b.removeAttribute(n),Ej.delete(b)),A||b.removeAttribute(r)}),UD--,UD||(Lx=new WeakMap,Lx=new WeakMap,Ej=new WeakMap,Tj={})}},xN=function(e,t,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(e)?e:[e]),s=wTe(e);return s?(n.push.apply(n,Array.from(s.querySelectorAll("[aria-live]"))),ETe(n,s,r,"aria-hidden")):function(){return null}},bN="Dialog",[mre,gre]=Mo(bN),[TTe,Yd]=mre(bN),yre=e=>{const{__scopeDialog:t,children:r,open:n,defaultOpen:s,onOpenChange:o,modal:h=!0}=e,i=V.useRef(null),m=V.useRef(null),[y,S]=Zc({prop:n,defaultProp:s??!1,onChange:o,caller:bN});return d.jsx(TTe,{scope:t,triggerRef:i,contentRef:m,contentId:_u(),titleId:_u(),descriptionId:_u(),open:y,onOpenChange:S,onOpenToggle:V.useCallback(()=>S(b=>!b),[S]),modal:h,children:r})};yre.displayName=bN;var vre="DialogTrigger",_re=V.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=Yd(vre,r),o=Un(t,s.triggerRef);return d.jsx(ln.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":n5(s.open),...n,ref:o,onClick:Ir(e.onClick,s.onOpenToggle)})});_re.displayName=vre;var t5="DialogPortal",[ATe,xre]=mre(t5,{forceMount:void 0}),bre=e=>{const{__scopeDialog:t,forceMount:r,children:n,container:s}=e,o=Yd(t5,t);return d.jsx(ATe,{scope:t,forceMount:r,children:V.Children.map(n,h=>d.jsx(Do,{present:r||o.open,children:d.jsx(Yb,{asChild:!0,container:s,children:h})}))})};bre.displayName=t5;var lO="DialogOverlay",wre=V.forwardRef((e,t)=>{const r=xre(lO,e.__scopeDialog),{forceMount:n=r.forceMount,...s}=e,o=Yd(lO,e.__scopeDialog);return o.modal?d.jsx(Do,{present:n||o.open,children:d.jsx(jTe,{...s,ref:t})}):null});wre.displayName=lO;var CTe=lg("DialogOverlay.RemoveScroll"),jTe=V.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=Yd(lO,r);return d.jsx(C2,{as:CTe,allowPinchZoom:!0,shards:[s.contentRef],children:d.jsx(ln.div,{"data-state":n5(s.open),...n,ref:t,style:{pointerEvents:"auto",...n.style}})})}),Av="DialogContent",Sre=V.forwardRef((e,t)=>{const r=xre(Av,e.__scopeDialog),{forceMount:n=r.forceMount,...s}=e,o=Yd(Av,e.__scopeDialog);return d.jsx(Do,{present:n||o.open,children:o.modal?d.jsx(PTe,{...s,ref:t}):d.jsx(OTe,{...s,ref:t})})});Sre.displayName=Av;var PTe=V.forwardRef((e,t)=>{const r=Yd(Av,e.__scopeDialog),n=V.useRef(null),s=Un(t,r.contentRef,n);return V.useEffect(()=>{const o=n.current;if(o)return xN(o)},[]),d.jsx(Ere,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ir(e.onCloseAutoFocus,o=>{var h;o.preventDefault(),(h=r.triggerRef.current)==null||h.focus()}),onPointerDownOutside:Ir(e.onPointerDownOutside,o=>{const h=o.detail.originalEvent,i=h.button===0&&h.ctrlKey===!0;(h.button===2||i)&&o.preventDefault()}),onFocusOutside:Ir(e.onFocusOutside,o=>o.preventDefault())})}),OTe=V.forwardRef((e,t)=>{const r=Yd(Av,e.__scopeDialog),n=V.useRef(!1),s=V.useRef(!1);return d.jsx(Ere,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var h,i;(h=e.onCloseAutoFocus)==null||h.call(e,o),o.defaultPrevented||(n.current||(i=r.triggerRef.current)==null||i.focus(),o.preventDefault()),n.current=!1,s.current=!1},onInteractOutside:o=>{var m,y;(m=e.onInteractOutside)==null||m.call(e,o),o.defaultPrevented||(n.current=!0,o.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const h=o.target;((y=r.triggerRef.current)==null?void 0:y.contains(h))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&s.current&&o.preventDefault()}})}),Ere=V.forwardRef((e,t)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:s,onCloseAutoFocus:o,...h}=e,i=Yd(Av,r),m=V.useRef(null),y=Un(t,m);return vN(),d.jsxs(d.Fragment,{children:[d.jsx(A2,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:s,onUnmountAutoFocus:o,children:d.jsx(Gv,{role:"dialog",id:i.contentId,"aria-describedby":i.descriptionId,"aria-labelledby":i.titleId,"data-state":n5(i.open),...h,ref:y,onDismiss:()=>i.onOpenChange(!1)})}),d.jsxs(d.Fragment,{children:[d.jsx(NTe,{titleId:i.titleId}),d.jsx(RTe,{contentRef:m,descriptionId:i.descriptionId})]})]})}),r5="DialogTitle",Tre=V.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=Yd(r5,r);return d.jsx(ln.h2,{id:s.titleId,...n,ref:t})});Tre.displayName=r5;var Are="DialogDescription",Cre=V.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=Yd(Are,r);return d.jsx(ln.p,{id:s.descriptionId,...n,ref:t})});Cre.displayName=Are;var jre="DialogClose",Pre=V.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,s=Yd(jre,r);return d.jsx(ln.button,{type:"button",...n,ref:t,onClick:Ir(e.onClick,()=>s.onOpenChange(!1))})});Pre.displayName=jre;function n5(e){return e?"open":"closed"}var Ore="DialogTitleWarning",[kTe,kre]=wve(Ore,{contentName:Av,titleName:r5,docsSlug:"dialog"}),NTe=({titleId:e})=>{const t=kre(Ore),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return V.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},ITe="DialogDescriptionWarning",RTe=({contentRef:e,descriptionId:t})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${kre(ITe).contentName}}.`;return V.useEffect(()=>{var o;const s=(o=e.current)==null?void 0:o.getAttribute("aria-describedby");t&&s&&(document.getElementById(t)||console.warn(n))},[n,e,t]),null},i5=yre,s5=_re,a5=bre,j2=wre,P2=Sre,O2=Tre,k2=Cre,wN=Pre;const Nre=i5,MTe=s5,DTe=a5,Ire=V.forwardRef(({className:e,...t},r)=>d.jsx(j2,{className:fr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));Ire.displayName=j2.displayName;const LTe=Wv("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),o5=V.forwardRef(({side:e="right",className:t,children:r,...n},s)=>d.jsxs(DTe,{children:[d.jsx(Ire,{}),d.jsxs(P2,{ref:s,className:fr(LTe({side:e}),t),...n,children:[r,d.jsxs(wN,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[d.jsx(Xc,{className:"h-4 w-4"}),d.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));o5.displayName=P2.displayName;const FTe=V.forwardRef(({className:e,...t},r)=>d.jsx(O2,{ref:r,className:fr("text-lg font-semibold text-foreground",e),...t}));FTe.displayName=O2.displayName;const zTe=V.forwardRef(({className:e,...t},r)=>d.jsx(k2,{ref:r,className:fr("text-sm text-muted-foreground",e),...t}));zTe.displayName=k2.displayName;var Rre={exports:{}},Mre={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ub=V;function BTe(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var $Te=typeof Object.is=="function"?Object.is:BTe,UTe=ub.useState,VTe=ub.useEffect,qTe=ub.useLayoutEffect,HTe=ub.useDebugValue;function GTe(e,t){var r=t(),n=UTe({inst:{value:r,getSnapshot:t}}),s=n[0].inst,o=n[1];return qTe(function(){s.value=r,s.getSnapshot=t,VD(s)&&o({inst:s})},[e,r,t]),VTe(function(){return VD(s)&&o({inst:s}),e(function(){VD(s)&&o({inst:s})})},[e]),HTe(r),r}function VD(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!$Te(e,r)}catch{return!0}}function WTe(e,t){return t()}var KTe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?WTe:GTe;Mre.useSyncExternalStore=ub.useSyncExternalStore!==void 0?ub.useSyncExternalStore:KTe;Rre.exports=Mre;var Dre=Rre.exports;function ZTe(){return Dre.useSyncExternalStore(XTe,()=>!0,()=>!1)}function XTe(){return()=>{}}var l5="Avatar",[YTe,ist]=Mo(l5),[JTe,Lre]=YTe(l5),Fre=V.forwardRef((e,t)=>{const{__scopeAvatar:r,...n}=e,[s,o]=V.useState("idle");return d.jsx(JTe,{scope:r,imageLoadingStatus:s,onImageLoadingStatusChange:o,children:d.jsx(ln.span,{...n,ref:t})})});Fre.displayName=l5;var zre="AvatarImage",Bre=V.forwardRef((e,t)=>{const{__scopeAvatar:r,src:n,onLoadingStatusChange:s=()=>{},...o}=e,h=Lre(zre,r),i=QTe(n,o),m=no(y=>{s(y),h.onImageLoadingStatusChange(y)});return io(()=>{i!=="idle"&&m(i)},[i,m]),i==="loaded"?d.jsx(ln.img,{...o,ref:t,src:n}):null});Bre.displayName=zre;var $re="AvatarFallback",Ure=V.forwardRef((e,t)=>{const{__scopeAvatar:r,delayMs:n,...s}=e,o=Lre($re,r),[h,i]=V.useState(n===void 0);return V.useEffect(()=>{if(n!==void 0){const m=window.setTimeout(()=>i(!0),n);return()=>window.clearTimeout(m)}},[n]),h&&o.imageLoadingStatus!=="loaded"?d.jsx(ln.span,{...s,ref:t}):null});Ure.displayName=$re;function KH(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}function QTe(e,{referrerPolicy:t,crossOrigin:r}){const n=ZTe(),s=V.useRef(null),o=n?(s.current||(s.current=new window.Image),s.current):null,[h,i]=V.useState(()=>KH(o,e));return io(()=>{i(KH(o,e))},[o,e]),io(()=>{const m=b=>()=>{i(b)};if(!o)return;const y=m("loaded"),S=m("error");return o.addEventListener("load",y),o.addEventListener("error",S),t&&(o.referrerPolicy=t),typeof r=="string"&&(o.crossOrigin=r),()=>{o.removeEventListener("load",y),o.removeEventListener("error",S)}},[o,r,t]),h}var Vre=Fre,qre=Bre,Hre=Ure;const Ju=V.forwardRef(({className:e,...t},r)=>d.jsx(Vre,{ref:r,className:fr("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...t}));Ju.displayName=Vre.displayName;const Qu=V.forwardRef(({className:e,...t},r)=>d.jsx(qre,{ref:r,className:fr("aspect-square h-full w-full",e),...t}));Qu.displayName=qre.displayName;const ed=V.forwardRef(({className:e,...t},r)=>d.jsx(Hre,{ref:r,className:fr("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...t}));ed.displayName=Hre.displayName;const bi=e=>typeof e=="string",$S=()=>{let e,t;const r=new Promise((n,s)=>{e=n,t=s});return r.resolve=e,r.reject=t,r},ZH=e=>e==null?"":""+e,e2e=(e,t,r)=>{e.forEach(n=>{t[n]&&(r[n]=t[n])})},t2e=/###/g,XH=e=>e&&e.indexOf("###")>-1?e.replace(t2e,"."):e,YH=e=>!e||bi(e),NE=(e,t,r)=>{const n=bi(t)?t.split("."):t;let s=0;for(;s<n.length-1;){if(YH(e))return{};const o=XH(n[s]);!e[o]&&r&&(e[o]=new r),Object.prototype.hasOwnProperty.call(e,o)?e=e[o]:e={},++s}return YH(e)?{}:{obj:e,k:XH(n[s])}},JH=(e,t,r)=>{const{obj:n,k:s}=NE(e,t,Object);if(n!==void 0||t.length===1){n[s]=r;return}let o=t[t.length-1],h=t.slice(0,t.length-1),i=NE(e,h,Object);for(;i.obj===void 0&&h.length;)o=`${h[h.length-1]}.${o}`,h=h.slice(0,h.length-1),i=NE(e,h,Object),i!=null&&i.obj&&typeof i.obj[`${i.k}.${o}`]<"u"&&(i.obj=void 0);i.obj[`${i.k}.${o}`]=r},r2e=(e,t,r,n)=>{const{obj:s,k:o}=NE(e,t,Object);s[o]=s[o]||[],s[o].push(r)},cO=(e,t)=>{const{obj:r,k:n}=NE(e,t);if(r&&Object.prototype.hasOwnProperty.call(r,n))return r[n]},n2e=(e,t,r)=>{const n=cO(e,r);return n!==void 0?n:cO(t,r)},Gre=(e,t,r)=>{for(const n in t)n!=="__proto__"&&n!=="constructor"&&(n in e?bi(e[n])||e[n]instanceof String||bi(t[n])||t[n]instanceof String?r&&(e[n]=t[n]):Gre(e[n],t[n],r):e[n]=t[n]);return e},Fx=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var i2e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const s2e=e=>bi(e)?e.replace(/[&<>"'\/]/g,t=>i2e[t]):e;class a2e{constructor(t){this.capacity=t,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(t){const r=this.regExpMap.get(t);if(r!==void 0)return r;const n=new RegExp(t);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(t,n),this.regExpQueue.push(t),n}}const o2e=[" ",",","?","!",";"],l2e=new a2e(20),c2e=(e,t,r)=>{t=t||"",r=r||"";const n=o2e.filter(h=>t.indexOf(h)<0&&r.indexOf(h)<0);if(n.length===0)return!0;const s=l2e.getRegExp(`(${n.map(h=>h==="?"?"\\?":h).join("|")})`);let o=!s.test(e);if(!o){const h=e.indexOf(r);h>0&&!s.test(e.substring(0,h))&&(o=!0)}return o},gF=(e,t,r=".")=>{if(!e)return;if(e[t])return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0;const n=t.split(r);let s=e;for(let o=0;o<n.length;){if(!s||typeof s!="object")return;let h,i="";for(let m=o;m<n.length;++m)if(m!==o&&(i+=r),i+=n[m],h=s[i],h!==void 0){if(["string","number","boolean"].indexOf(typeof h)>-1&&m<n.length-1)continue;o+=m-o+1;break}s=h}return s},mT=e=>e==null?void 0:e.replace("_","-"),u2e={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){var r,n;(n=(r=console==null?void 0:console[e])==null?void 0:r.apply)==null||n.call(r,console,t)}};class uO{constructor(t,r={}){this.init(t,r)}init(t,r={}){this.prefix=r.prefix||"i18next:",this.logger=t||u2e,this.options=r,this.debug=r.debug}log(...t){return this.forward(t,"log","",!0)}warn(...t){return this.forward(t,"warn","",!0)}error(...t){return this.forward(t,"error","")}deprecate(...t){return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(t,r,n,s){return s&&!this.debug?null:(bi(t[0])&&(t[0]=`${n}${this.prefix} ${t[0]}`),this.logger[r](t))}create(t){return new uO(this.logger,{prefix:`${this.prefix}:${t}:`,...this.options})}clone(t){return t=t||this.options,t.prefix=t.prefix||this.prefix,new uO(this.logger,t)}}var Oh=new uO;let SN=class{constructor(){this.observers={}}on(t,r){return t.split(" ").forEach(n=>{this.observers[n]||(this.observers[n]=new Map);const s=this.observers[n].get(r)||0;this.observers[n].set(r,s+1)}),this}off(t,r){if(this.observers[t]){if(!r){delete this.observers[t];return}this.observers[t].delete(r)}}emit(t,...r){this.observers[t]&&Array.from(this.observers[t].entries()).forEach(([s,o])=>{for(let h=0;h<o;h++)s(...r)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([s,o])=>{for(let h=0;h<o;h++)s.apply(s,[t,...r])})}};class QH extends SN{constructor(t,r={ns:["translation"],defaultNS:"translation"}){super(),this.data=t||{},this.options=r,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(t){this.options.ns.indexOf(t)<0&&this.options.ns.push(t)}removeNamespaces(t){const r=this.options.ns.indexOf(t);r>-1&&this.options.ns.splice(r,1)}getResource(t,r,n,s={}){var y,S;const o=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator,h=s.ignoreJSONStructure!==void 0?s.ignoreJSONStructure:this.options.ignoreJSONStructure;let i;t.indexOf(".")>-1?i=t.split("."):(i=[t,r],n&&(Array.isArray(n)?i.push(...n):bi(n)&&o?i.push(...n.split(o)):i.push(n)));const m=cO(this.data,i);return!m&&!r&&!n&&t.indexOf(".")>-1&&(t=i[0],r=i[1],n=i.slice(2).join(".")),m||!h||!bi(n)?m:gF((S=(y=this.data)==null?void 0:y[t])==null?void 0:S[r],n,o)}addResource(t,r,n,s,o={silent:!1}){const h=o.keySeparator!==void 0?o.keySeparator:this.options.keySeparator;let i=[t,r];n&&(i=i.concat(h?n.split(h):n)),t.indexOf(".")>-1&&(i=t.split("."),s=r,r=i[1]),this.addNamespaces(r),JH(this.data,i,s),o.silent||this.emit("added",t,r,n,s)}addResources(t,r,n,s={silent:!1}){for(const o in n)(bi(n[o])||Array.isArray(n[o]))&&this.addResource(t,r,o,n[o],{silent:!0});s.silent||this.emit("added",t,r,n)}addResourceBundle(t,r,n,s,o,h={silent:!1,skipCopy:!1}){let i=[t,r];t.indexOf(".")>-1&&(i=t.split("."),s=n,n=r,r=i[1]),this.addNamespaces(r);let m=cO(this.data,i)||{};h.skipCopy||(n=JSON.parse(JSON.stringify(n))),s?Gre(m,n,o):m={...m,...n},JH(this.data,i,m),h.silent||this.emit("added",t,r,n)}removeResourceBundle(t,r){this.hasResourceBundle(t,r)&&delete this.data[t][r],this.removeNamespaces(r),this.emit("removed",t,r)}hasResourceBundle(t,r){return this.getResource(t,r)!==void 0}getResourceBundle(t,r){return r||(r=this.options.defaultNS),this.getResource(t,r)}getDataByLanguage(t){return this.data[t]}hasLanguageSomeTranslations(t){const r=this.getDataByLanguage(t);return!!(r&&Object.keys(r)||[]).find(s=>r[s]&&Object.keys(r[s]).length>0)}toJSON(){return this.data}}var Wre={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,r,n,s){return e.forEach(o=>{var h;t=((h=this.processors[o])==null?void 0:h.process(t,r,n,s))??t}),t}};const Kre=Symbol("i18next/PATH_KEY");function d2e(){const e=[],t=Object.create(null);let r;return t.get=(n,s)=>{var o;return(o=r==null?void 0:r.revoke)==null||o.call(r),s===Kre?e:(e.push(s),r=Proxy.revocable(n,t),r.proxy)},Proxy.revocable(Object.create(null),t).proxy}function yF(e,t){const{[Kre]:r}=e(d2e());return r.join((t==null?void 0:t.keySeparator)??".")}const eG={},qD=e=>!bi(e)&&typeof e!="boolean"&&typeof e!="number";class dO extends SN{constructor(t,r={}){super(),e2e(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],t,this),this.options=r,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=Oh.create("translator")}changeLanguage(t){t&&(this.language=t)}exists(t,r={interpolation:{}}){const n={...r};if(t==null)return!1;const s=this.resolve(t,n);if((s==null?void 0:s.res)===void 0)return!1;const o=qD(s.res);return!(n.returnObjects===!1&&o)}extractFromKey(t,r){let n=r.nsSeparator!==void 0?r.nsSeparator:this.options.nsSeparator;n===void 0&&(n=":");const s=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator;let o=r.ns||this.options.defaultNS||[];const h=n&&t.indexOf(n)>-1,i=!this.options.userDefinedKeySeparator&&!r.keySeparator&&!this.options.userDefinedNsSeparator&&!r.nsSeparator&&!c2e(t,n,s);if(h&&!i){const m=t.match(this.interpolator.nestingRegexp);if(m&&m.length>0)return{key:t,namespaces:bi(o)?[o]:o};const y=t.split(n);(n!==s||n===s&&this.options.ns.indexOf(y[0])>-1)&&(o=y.shift()),t=y.join(s)}return{key:t,namespaces:bi(o)?[o]:o}}translate(t,r,n){let s=typeof r=="object"?{...r}:r;if(typeof s!="object"&&this.options.overloadTranslationOptionHandler&&(s=this.options.overloadTranslationOptionHandler(arguments)),typeof s=="object"&&(s={...s}),s||(s={}),t==null)return"";typeof t=="function"&&(t=yF(t,{...this.options,...s})),Array.isArray(t)||(t=[String(t)]);const o=s.returnDetails!==void 0?s.returnDetails:this.options.returnDetails,h=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator,{key:i,namespaces:m}=this.extractFromKey(t[t.length-1],s),y=m[m.length-1];let S=s.nsSeparator!==void 0?s.nsSeparator:this.options.nsSeparator;S===void 0&&(S=":");const b=s.lng||this.language,T=s.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if((b==null?void 0:b.toLowerCase())==="cimode")return T?o?{res:`${y}${S}${i}`,usedKey:i,exactUsedKey:i,usedLng:b,usedNS:y,usedParams:this.getUsedParamsDetails(s)}:`${y}${S}${i}`:o?{res:i,usedKey:i,exactUsedKey:i,usedLng:b,usedNS:y,usedParams:this.getUsedParamsDetails(s)}:i;const A=this.resolve(t,s);let O=A==null?void 0:A.res;const P=(A==null?void 0:A.usedKey)||i,I=(A==null?void 0:A.exactUsedKey)||i,R=["[object Number]","[object Function]","[object RegExp]"],M=s.joinArrays!==void 0?s.joinArrays:this.options.joinArrays,F=!this.i18nFormat||this.i18nFormat.handleAsObject,z=s.count!==void 0&&!bi(s.count),$=dO.hasDefaultValue(s),W=z?this.pluralResolver.getSuffix(b,s.count,s):"",K=s.ordinal&&z?this.pluralResolver.getSuffix(b,s.count,{ordinal:!1}):"",ee=z&&!s.ordinal&&s.count===0,ne=ee&&s[`defaultValue${this.options.pluralSeparator}zero`]||s[`defaultValue${W}`]||s[`defaultValue${K}`]||s.defaultValue;let ie=O;F&&!O&&$&&(ie=ne);const re=qD(ie),te=Object.prototype.toString.apply(ie);if(F&&ie&&re&&R.indexOf(te)<0&&!(bi(M)&&Array.isArray(ie))){if(!s.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const ae=this.options.returnedObjectHandler?this.options.returnedObjectHandler(P,ie,{...s,ns:m}):`key '${i} (${this.language})' returned an object instead of string.`;return o?(A.res=ae,A.usedParams=this.getUsedParamsDetails(s),A):ae}if(h){const ae=Array.isArray(ie),ue=ae?[]:{},be=ae?I:P;for(const we in ie)if(Object.prototype.hasOwnProperty.call(ie,we)){const Ce=`${be}${h}${we}`;$&&!O?ue[we]=this.translate(Ce,{...s,defaultValue:qD(ne)?ne[we]:void 0,joinArrays:!1,ns:m}):ue[we]=this.translate(Ce,{...s,joinArrays:!1,ns:m}),ue[we]===Ce&&(ue[we]=ie[we])}O=ue}}else if(F&&bi(M)&&Array.isArray(O))O=O.join(M),O&&(O=this.extendTranslation(O,t,s,n));else{let ae=!1,ue=!1;!this.isValidLookup(O)&&$&&(ae=!0,O=ne),this.isValidLookup(O)||(ue=!0,O=i);const we=(s.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&ue?void 0:O,Ce=$&&ne!==O&&this.options.updateMissing;if(ue||ae||Ce){if(this.logger.log(Ce?"updateKey":"missingKey",b,y,i,Ce?ne:O),h){const ge=this.resolve(i,{...s,keySeparator:!1});ge&&ge.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let _e=[];const me=this.languageUtils.getFallbackCodes(this.options.fallbackLng,s.lng||this.language);if(this.options.saveMissingTo==="fallback"&&me&&me[0])for(let ge=0;ge<me.length;ge++)_e.push(me[ge]);else this.options.saveMissingTo==="all"?_e=this.languageUtils.toResolveHierarchy(s.lng||this.language):_e.push(s.lng||this.language);const Ae=(ge,pe,Oe)=>{var Ze;const Je=$&&Oe!==O?Oe:we;this.options.missingKeyHandler?this.options.missingKeyHandler(ge,y,pe,Je,Ce,s):(Ze=this.backendConnector)!=null&&Ze.saveMissing&&this.backendConnector.saveMissing(ge,y,pe,Je,Ce,s),this.emit("missingKey",ge,y,pe,O)};this.options.saveMissing&&(this.options.saveMissingPlurals&&z?_e.forEach(ge=>{const pe=this.pluralResolver.getSuffixes(ge,s);ee&&s[`defaultValue${this.options.pluralSeparator}zero`]&&pe.indexOf(`${this.options.pluralSeparator}zero`)<0&&pe.push(`${this.options.pluralSeparator}zero`),pe.forEach(Oe=>{Ae([ge],i+Oe,s[`defaultValue${Oe}`]||ne)})}):Ae(_e,i,ne))}O=this.extendTranslation(O,t,s,A,n),ue&&O===i&&this.options.appendNamespaceToMissingKey&&(O=`${y}${S}${i}`),(ue||ae)&&this.options.parseMissingKeyHandler&&(O=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${y}${S}${i}`:i,ae?O:void 0,s))}return o?(A.res=O,A.usedParams=this.getUsedParamsDetails(s),A):O}extendTranslation(t,r,n,s,o){var m,y;if((m=this.i18nFormat)!=null&&m.parse)t=this.i18nFormat.parse(t,{...this.options.interpolation.defaultVariables,...n},n.lng||this.language||s.usedLng,s.usedNS,s.usedKey,{resolved:s});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init({...n,interpolation:{...this.options.interpolation,...n.interpolation}});const S=bi(t)&&(((y=n==null?void 0:n.interpolation)==null?void 0:y.skipOnVariables)!==void 0?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let b;if(S){const A=t.match(this.interpolator.nestingRegexp);b=A&&A.length}let T=n.replace&&!bi(n.replace)?n.replace:n;if(this.options.interpolation.defaultVariables&&(T={...this.options.interpolation.defaultVariables,...T}),t=this.interpolator.interpolate(t,T,n.lng||this.language||s.usedLng,n),S){const A=t.match(this.interpolator.nestingRegexp),O=A&&A.length;b<O&&(n.nest=!1)}!n.lng&&s&&s.res&&(n.lng=this.language||s.usedLng),n.nest!==!1&&(t=this.interpolator.nest(t,(...A)=>(o==null?void 0:o[0])===A[0]&&!n.context?(this.logger.warn(`It seems you are nesting recursively key: ${A[0]} in key: ${r[0]}`),null):this.translate(...A,r),n)),n.interpolation&&this.interpolator.reset()}const h=n.postProcess||this.options.postProcess,i=bi(h)?[h]:h;return t!=null&&(i!=null&&i.length)&&n.applyPostProcessor!==!1&&(t=Wre.handle(i,t,r,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...s,usedParams:this.getUsedParamsDetails(n)},...n}:n,this)),t}resolve(t,r={}){let n,s,o,h,i;return bi(t)&&(t=[t]),t.forEach(m=>{if(this.isValidLookup(n))return;const y=this.extractFromKey(m,r),S=y.key;s=S;let b=y.namespaces;this.options.fallbackNS&&(b=b.concat(this.options.fallbackNS));const T=r.count!==void 0&&!bi(r.count),A=T&&!r.ordinal&&r.count===0,O=r.context!==void 0&&(bi(r.context)||typeof r.context=="number")&&r.context!=="",P=r.lngs?r.lngs:this.languageUtils.toResolveHierarchy(r.lng||this.language,r.fallbackLng);b.forEach(I=>{var R,M;this.isValidLookup(n)||(i=I,!eG[`${P[0]}-${I}`]&&((R=this.utils)!=null&&R.hasLoadedNamespace)&&!((M=this.utils)!=null&&M.hasLoadedNamespace(i))&&(eG[`${P[0]}-${I}`]=!0,this.logger.warn(`key "${s}" for languages "${P.join(", ")}" won't get resolved as namespace "${i}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),P.forEach(F=>{var W;if(this.isValidLookup(n))return;h=F;const z=[S];if((W=this.i18nFormat)!=null&&W.addLookupKeys)this.i18nFormat.addLookupKeys(z,S,F,I,r);else{let K;T&&(K=this.pluralResolver.getSuffix(F,r.count,r));const ee=`${this.options.pluralSeparator}zero`,ne=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(T&&(r.ordinal&&K.indexOf(ne)===0&&z.push(S+K.replace(ne,this.options.pluralSeparator)),z.push(S+K),A&&z.push(S+ee)),O){const ie=`${S}${this.options.contextSeparator||"_"}${r.context}`;z.push(ie),T&&(r.ordinal&&K.indexOf(ne)===0&&z.push(ie+K.replace(ne,this.options.pluralSeparator)),z.push(ie+K),A&&z.push(ie+ee))}}let $;for(;$=z.pop();)this.isValidLookup(n)||(o=$,n=this.getResource(F,I,$,r))}))})}),{res:n,usedKey:s,exactUsedKey:o,usedLng:h,usedNS:i}}isValidLookup(t){return t!==void 0&&!(!this.options.returnNull&&t===null)&&!(!this.options.returnEmptyString&&t==="")}getResource(t,r,n,s={}){var o;return(o=this.i18nFormat)!=null&&o.getResource?this.i18nFormat.getResource(t,r,n,s):this.resourceStore.getResource(t,r,n,s)}getUsedParamsDetails(t={}){const r=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],n=t.replace&&!bi(t.replace);let s=n?t.replace:t;if(n&&typeof t.count<"u"&&(s.count=t.count),this.options.interpolation.defaultVariables&&(s={...this.options.interpolation.defaultVariables,...s}),!n){s={...s};for(const o of r)delete s[o]}return s}static hasDefaultValue(t){const r="defaultValue";for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&r===n.substring(0,r.length)&&t[n]!==void 0)return!0;return!1}}class tG{constructor(t){this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Oh.create("languageUtils")}getScriptPartFromCode(t){if(t=mT(t),!t||t.indexOf("-")<0)return null;const r=t.split("-");return r.length===2||(r.pop(),r[r.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(r.join("-"))}getLanguagePartFromCode(t){if(t=mT(t),!t||t.indexOf("-")<0)return t;const r=t.split("-");return this.formatLanguageCode(r[0])}formatLanguageCode(t){if(bi(t)&&t.indexOf("-")>-1){let r;try{r=Intl.getCanonicalLocales(t)[0]}catch{}return r&&this.options.lowerCaseLng&&(r=r.toLowerCase()),r||(this.options.lowerCaseLng?t.toLowerCase():t)}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t}isSupportedCode(t){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(t=this.getLanguagePartFromCode(t)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(t)>-1}getBestMatchFromCodes(t){if(!t)return null;let r;return t.forEach(n=>{if(r)return;const s=this.formatLanguageCode(n);(!this.options.supportedLngs||this.isSupportedCode(s))&&(r=s)}),!r&&this.options.supportedLngs&&t.forEach(n=>{if(r)return;const s=this.getScriptPartFromCode(n);if(this.isSupportedCode(s))return r=s;const o=this.getLanguagePartFromCode(n);if(this.isSupportedCode(o))return r=o;r=this.options.supportedLngs.find(h=>{if(h===o)return h;if(!(h.indexOf("-")<0&&o.indexOf("-")<0)&&(h.indexOf("-")>0&&o.indexOf("-")<0&&h.substring(0,h.indexOf("-"))===o||h.indexOf(o)===0&&o.length>1))return h})}),r||(r=this.getFallbackCodes(this.options.fallbackLng)[0]),r}getFallbackCodes(t,r){if(!t)return[];if(typeof t=="function"&&(t=t(r)),bi(t)&&(t=[t]),Array.isArray(t))return t;if(!r)return t.default||[];let n=t[r];return n||(n=t[this.getScriptPartFromCode(r)]),n||(n=t[this.formatLanguageCode(r)]),n||(n=t[this.getLanguagePartFromCode(r)]),n||(n=t.default),n||[]}toResolveHierarchy(t,r){const n=this.getFallbackCodes((r===!1?[]:r)||this.options.fallbackLng||[],t),s=[],o=h=>{h&&(this.isSupportedCode(h)?s.push(h):this.logger.warn(`rejecting language code not found in supportedLngs: ${h}`))};return bi(t)&&(t.indexOf("-")>-1||t.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&o(this.formatLanguageCode(t)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&o(this.getScriptPartFromCode(t)),this.options.load!=="currentOnly"&&o(this.getLanguagePartFromCode(t))):bi(t)&&o(this.formatLanguageCode(t)),n.forEach(h=>{s.indexOf(h)<0&&o(this.formatLanguageCode(h))}),s}}const rG={zero:0,one:1,two:2,few:3,many:4,other:5},nG={select:e=>e===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class h2e{constructor(t,r={}){this.languageUtils=t,this.options=r,this.logger=Oh.create("pluralResolver"),this.pluralRulesCache={}}addRule(t,r){this.rules[t]=r}clearCache(){this.pluralRulesCache={}}getRule(t,r={}){const n=mT(t==="dev"?"en":t),s=r.ordinal?"ordinal":"cardinal",o=JSON.stringify({cleanedCode:n,type:s});if(o in this.pluralRulesCache)return this.pluralRulesCache[o];let h;try{h=new Intl.PluralRules(n,{type:s})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),nG;if(!t.match(/-|_/))return nG;const m=this.languageUtils.getLanguagePartFromCode(t);h=this.getRule(m,r)}return this.pluralRulesCache[o]=h,h}needsPlural(t,r={}){let n=this.getRule(t,r);return n||(n=this.getRule("dev",r)),(n==null?void 0:n.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(t,r,n={}){return this.getSuffixes(t,n).map(s=>`${r}${s}`)}getSuffixes(t,r={}){let n=this.getRule(t,r);return n||(n=this.getRule("dev",r)),n?n.resolvedOptions().pluralCategories.sort((s,o)=>rG[s]-rG[o]).map(s=>`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${s}`):[]}getSuffix(t,r,n={}){const s=this.getRule(t,n);return s?`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${s.select(r)}`:(this.logger.warn(`no plural rule found for: ${t}`),this.getSuffix("dev",r,n))}}const iG=(e,t,r,n=".",s=!0)=>{let o=n2e(e,t,r);return!o&&s&&bi(r)&&(o=gF(e,r,n),o===void 0&&(o=gF(t,r,n))),o},HD=e=>e.replace(/\$/g,"$$$$");class f2e{constructor(t={}){var r;this.logger=Oh.create("interpolator"),this.options=t,this.format=((r=t==null?void 0:t.interpolation)==null?void 0:r.format)||(n=>n),this.init(t)}init(t={}){t.interpolation||(t.interpolation={escapeValue:!0});const{escape:r,escapeValue:n,useRawValueToEscape:s,prefix:o,prefixEscaped:h,suffix:i,suffixEscaped:m,formatSeparator:y,unescapeSuffix:S,unescapePrefix:b,nestingPrefix:T,nestingPrefixEscaped:A,nestingSuffix:O,nestingSuffixEscaped:P,nestingOptionsSeparator:I,maxReplaces:R,alwaysFormat:M}=t.interpolation;this.escape=r!==void 0?r:s2e,this.escapeValue=n!==void 0?n:!0,this.useRawValueToEscape=s!==void 0?s:!1,this.prefix=o?Fx(o):h||"{{",this.suffix=i?Fx(i):m||"}}",this.formatSeparator=y||",",this.unescapePrefix=S?"":b||"-",this.unescapeSuffix=this.unescapePrefix?"":S||"",this.nestingPrefix=T?Fx(T):A||Fx("$t("),this.nestingSuffix=O?Fx(O):P||Fx(")"),this.nestingOptionsSeparator=I||",",this.maxReplaces=R||1e3,this.alwaysFormat=M!==void 0?M:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const t=(r,n)=>(r==null?void 0:r.source)===n?(r.lastIndex=0,r):new RegExp(n,"g");this.regexp=t(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=t(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=t(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(t,r,n,s){var A;let o,h,i;const m=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},y=O=>{if(O.indexOf(this.formatSeparator)<0){const M=iG(r,m,O,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(M,void 0,n,{...s,...r,interpolationkey:O}):M}const P=O.split(this.formatSeparator),I=P.shift().trim(),R=P.join(this.formatSeparator).trim();return this.format(iG(r,m,I,this.options.keySeparator,this.options.ignoreJSONStructure),R,n,{...s,...r,interpolationkey:I})};this.resetRegExp();const S=(s==null?void 0:s.missingInterpolationHandler)||this.options.missingInterpolationHandler,b=((A=s==null?void 0:s.interpolation)==null?void 0:A.skipOnVariables)!==void 0?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:O=>HD(O)},{regex:this.regexp,safeValue:O=>this.escapeValue?HD(this.escape(O)):HD(O)}].forEach(O=>{for(i=0;o=O.regex.exec(t);){const P=o[1].trim();if(h=y(P),h===void 0)if(typeof S=="function"){const R=S(t,o,s);h=bi(R)?R:""}else if(s&&Object.prototype.hasOwnProperty.call(s,P))h="";else if(b){h=o[0];continue}else this.logger.warn(`missed to pass in variable ${P} for interpolating ${t}`),h="";else!bi(h)&&!this.useRawValueToEscape&&(h=ZH(h));const I=O.safeValue(h);if(t=t.replace(o[0],I),b?(O.regex.lastIndex+=h.length,O.regex.lastIndex-=o[0].length):O.regex.lastIndex=0,i++,i>=this.maxReplaces)break}}),t}nest(t,r,n={}){let s,o,h;const i=(m,y)=>{const S=this.nestingOptionsSeparator;if(m.indexOf(S)<0)return m;const b=m.split(new RegExp(`${S}[ ]*{`));let T=`{${b[1]}`;m=b[0],T=this.interpolate(T,h);const A=T.match(/'/g),O=T.match(/"/g);(((A==null?void 0:A.length)??0)%2===0&&!O||O.length%2!==0)&&(T=T.replace(/'/g,'"'));try{h=JSON.parse(T),y&&(h={...y,...h})}catch(P){return this.logger.warn(`failed parsing options string in nesting for key ${m}`,P),`${m}${S}${T}`}return h.defaultValue&&h.defaultValue.indexOf(this.prefix)>-1&&delete h.defaultValue,m};for(;s=this.nestingRegexp.exec(t);){let m=[];h={...n},h=h.replace&&!bi(h.replace)?h.replace:h,h.applyPostProcessor=!1,delete h.defaultValue;const y=/{.*}/.test(s[1])?s[1].lastIndexOf("}")+1:s[1].indexOf(this.formatSeparator);if(y!==-1&&(m=s[1].slice(y).split(this.formatSeparator).map(S=>S.trim()).filter(Boolean),s[1]=s[1].slice(0,y)),o=r(i.call(this,s[1].trim(),h),h),o&&s[0]===t&&!bi(o))return o;bi(o)||(o=ZH(o)),o||(this.logger.warn(`missed to resolve ${s[1]} for nesting ${t}`),o=""),m.length&&(o=m.reduce((S,b)=>this.format(S,b,n.lng,{...n,interpolationkey:s[1].trim()}),o.trim())),t=t.replace(s[0],o),this.regexp.lastIndex=0}return t}}const p2e=e=>{let t=e.toLowerCase().trim();const r={};if(e.indexOf("(")>-1){const n=e.split("(");t=n[0].toLowerCase().trim();const s=n[1].substring(0,n[1].length-1);t==="currency"&&s.indexOf(":")<0?r.currency||(r.currency=s.trim()):t==="relativetime"&&s.indexOf(":")<0?r.range||(r.range=s.trim()):s.split(";").forEach(h=>{if(h){const[i,...m]=h.split(":"),y=m.join(":").trim().replace(/^'+|'+$/g,""),S=i.trim();r[S]||(r[S]=y),y==="false"&&(r[S]=!1),y==="true"&&(r[S]=!0),isNaN(y)||(r[S]=parseInt(y,10))}})}return{formatName:t,formatOptions:r}},sG=e=>{const t={};return(r,n,s)=>{let o=s;s&&s.interpolationkey&&s.formatParams&&s.formatParams[s.interpolationkey]&&s[s.interpolationkey]&&(o={...o,[s.interpolationkey]:void 0});const h=n+JSON.stringify(o);let i=t[h];return i||(i=e(mT(n),s),t[h]=i),i(r)}},m2e=e=>(t,r,n)=>e(mT(r),n)(t);class g2e{constructor(t={}){this.logger=Oh.create("formatter"),this.options=t,this.init(t)}init(t,r={interpolation:{}}){this.formatSeparator=r.interpolation.formatSeparator||",";const n=r.cacheInBuiltFormats?sG:m2e;this.formats={number:n((s,o)=>{const h=new Intl.NumberFormat(s,{...o});return i=>h.format(i)}),currency:n((s,o)=>{const h=new Intl.NumberFormat(s,{...o,style:"currency"});return i=>h.format(i)}),datetime:n((s,o)=>{const h=new Intl.DateTimeFormat(s,{...o});return i=>h.format(i)}),relativetime:n((s,o)=>{const h=new Intl.RelativeTimeFormat(s,{...o});return i=>h.format(i,o.range||"day")}),list:n((s,o)=>{const h=new Intl.ListFormat(s,{...o});return i=>h.format(i)})}}add(t,r){this.formats[t.toLowerCase().trim()]=r}addCached(t,r){this.formats[t.toLowerCase().trim()]=sG(r)}format(t,r,n,s={}){const o=r.split(this.formatSeparator);if(o.length>1&&o[0].indexOf("(")>1&&o[0].indexOf(")")<0&&o.find(i=>i.indexOf(")")>-1)){const i=o.findIndex(m=>m.indexOf(")")>-1);o[0]=[o[0],...o.splice(1,i)].join(this.formatSeparator)}return o.reduce((i,m)=>{var b;const{formatName:y,formatOptions:S}=p2e(m);if(this.formats[y]){let T=i;try{const A=((b=s==null?void 0:s.formatParams)==null?void 0:b[s.interpolationkey])||{},O=A.locale||A.lng||s.locale||s.lng||n;T=this.formats[y](i,O,{...S,...s,...A})}catch(A){this.logger.warn(A)}return T}else this.logger.warn(`there was no format function for ${y}`);return i},t)}}const y2e=(e,t)=>{e.pending[t]!==void 0&&(delete e.pending[t],e.pendingCount--)};class v2e extends SN{constructor(t,r,n,s={}){var o,h;super(),this.backend=t,this.store=r,this.services=n,this.languageUtils=n.languageUtils,this.options=s,this.logger=Oh.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=s.maxParallelReads||10,this.readingCalls=0,this.maxRetries=s.maxRetries>=0?s.maxRetries:5,this.retryTimeout=s.retryTimeout>=1?s.retryTimeout:350,this.state={},this.queue=[],(h=(o=this.backend)==null?void 0:o.init)==null||h.call(o,n,s.backend,s)}queueLoad(t,r,n,s){const o={},h={},i={},m={};return t.forEach(y=>{let S=!0;r.forEach(b=>{const T=`${y}|${b}`;!n.reload&&this.store.hasResourceBundle(y,b)?this.state[T]=2:this.state[T]<0||(this.state[T]===1?h[T]===void 0&&(h[T]=!0):(this.state[T]=1,S=!1,h[T]===void 0&&(h[T]=!0),o[T]===void 0&&(o[T]=!0),m[b]===void 0&&(m[b]=!0)))}),S||(i[y]=!0)}),(Object.keys(o).length||Object.keys(h).length)&&this.queue.push({pending:h,pendingCount:Object.keys(h).length,loaded:{},errors:[],callback:s}),{toLoad:Object.keys(o),pending:Object.keys(h),toLoadLanguages:Object.keys(i),toLoadNamespaces:Object.keys(m)}}loaded(t,r,n){const s=t.split("|"),o=s[0],h=s[1];r&&this.emit("failedLoading",o,h,r),!r&&n&&this.store.addResourceBundle(o,h,n,void 0,void 0,{skipCopy:!0}),this.state[t]=r?-1:2,r&&n&&(this.state[t]=0);const i={};this.queue.forEach(m=>{r2e(m.loaded,[o],h),y2e(m,t),r&&m.errors.push(r),m.pendingCount===0&&!m.done&&(Object.keys(m.loaded).forEach(y=>{i[y]||(i[y]={});const S=m.loaded[y];S.length&&S.forEach(b=>{i[y][b]===void 0&&(i[y][b]=!0)})}),m.done=!0,m.errors.length?m.callback(m.errors):m.callback())}),this.emit("loaded",i),this.queue=this.queue.filter(m=>!m.done)}read(t,r,n,s=0,o=this.retryTimeout,h){if(!t.length)return h(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:t,ns:r,fcName:n,tried:s,wait:o,callback:h});return}this.readingCalls++;const i=(y,S)=>{if(this.readingCalls--,this.waitingReads.length>0){const b=this.waitingReads.shift();this.read(b.lng,b.ns,b.fcName,b.tried,b.wait,b.callback)}if(y&&S&&s<this.maxRetries){setTimeout(()=>{this.read.call(this,t,r,n,s+1,o*2,h)},o);return}h(y,S)},m=this.backend[n].bind(this.backend);if(m.length===2){try{const y=m(t,r);y&&typeof y.then=="function"?y.then(S=>i(null,S)).catch(i):i(null,y)}catch(y){i(y)}return}return m(t,r,i)}prepareLoading(t,r,n={},s){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),s&&s();bi(t)&&(t=this.languageUtils.toResolveHierarchy(t)),bi(r)&&(r=[r]);const o=this.queueLoad(t,r,n,s);if(!o.toLoad.length)return o.pending.length||s(),null;o.toLoad.forEach(h=>{this.loadOne(h)})}load(t,r,n){this.prepareLoading(t,r,{},n)}reload(t,r,n){this.prepareLoading(t,r,{reload:!0},n)}loadOne(t,r=""){const n=t.split("|"),s=n[0],o=n[1];this.read(s,o,"read",void 0,void 0,(h,i)=>{h&&this.logger.warn(`${r}loading namespace ${o} for language ${s} failed`,h),!h&&i&&this.logger.log(`${r}loaded namespace ${o} for language ${s}`,i),this.loaded(t,h,i)})}saveMissing(t,r,n,s,o,h={},i=()=>{}){var m,y,S,b,T;if((y=(m=this.services)==null?void 0:m.utils)!=null&&y.hasLoadedNamespace&&!((b=(S=this.services)==null?void 0:S.utils)!=null&&b.hasLoadedNamespace(r))){this.logger.warn(`did not save key "${n}" as the namespace "${r}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(n==null||n==="")){if((T=this.backend)!=null&&T.create){const A={...h,isUpdate:o},O=this.backend.create.bind(this.backend);if(O.length<6)try{let P;O.length===5?P=O(t,r,n,s,A):P=O(t,r,n,s),P&&typeof P.then=="function"?P.then(I=>i(null,I)).catch(i):i(null,P)}catch(P){i(P)}else O(t,r,n,s,i,A)}!t||!t[0]||this.store.addResource(t[0],r,n,s)}}}const aG=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if(typeof e[1]=="object"&&(t=e[1]),bi(e[1])&&(t.defaultValue=e[1]),bi(e[2])&&(t.tDescription=e[2]),typeof e[2]=="object"||typeof e[3]=="object"){const r=e[3]||e[2];Object.keys(r).forEach(n=>{t[n]=r[n]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),oG=e=>{var t,r;return bi(e.ns)&&(e.ns=[e.ns]),bi(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),bi(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),((r=(t=e.supportedLngs)==null?void 0:t.indexOf)==null?void 0:r.call(t,"cimode"))<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),typeof e.initImmediate=="boolean"&&(e.initAsync=e.initImmediate),e},Aj=()=>{},_2e=e=>{Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach(r=>{typeof e[r]=="function"&&(e[r]=e[r].bind(e))})};class IE extends SN{constructor(t={},r){if(super(),this.options=oG(t),this.services={},this.logger=Oh,this.modules={external:[]},_2e(this),r&&!this.isInitialized&&!t.isClone){if(!this.options.initAsync)return this.init(t,r),this;setTimeout(()=>{this.init(t,r)},0)}}init(t={},r){this.isInitializing=!0,typeof t=="function"&&(r=t,t={}),t.defaultNS==null&&t.ns&&(bi(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const n=aG();this.options={...n,...this.options,...oG(t)},this.options.interpolation={...n.interpolation,...this.options.interpolation},t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator);const s=y=>y?typeof y=="function"?new y:y:null;if(!this.options.isClone){this.modules.logger?Oh.init(s(this.modules.logger),this.options):Oh.init(null,this.options);let y;this.modules.formatter?y=this.modules.formatter:y=g2e;const S=new tG(this.options);this.store=new QH(this.options.resources,this.options);const b=this.services;b.logger=Oh,b.resourceStore=this.store,b.languageUtils=S,b.pluralResolver=new h2e(S,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==n.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),y&&(!this.options.interpolation.format||this.options.interpolation.format===n.interpolation.format)&&(b.formatter=s(y),b.formatter.init&&b.formatter.init(b,this.options),this.options.interpolation.format=b.formatter.format.bind(b.formatter)),b.interpolator=new f2e(this.options),b.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},b.backendConnector=new v2e(s(this.modules.backend),b.resourceStore,b,this.options),b.backendConnector.on("*",(A,...O)=>{this.emit(A,...O)}),this.modules.languageDetector&&(b.languageDetector=s(this.modules.languageDetector),b.languageDetector.init&&b.languageDetector.init(b,this.options.detection,this.options)),this.modules.i18nFormat&&(b.i18nFormat=s(this.modules.i18nFormat),b.i18nFormat.init&&b.i18nFormat.init(this)),this.translator=new dO(this.services,this.options),this.translator.on("*",(A,...O)=>{this.emit(A,...O)}),this.modules.external.forEach(A=>{A.init&&A.init(this)})}if(this.format=this.options.interpolation.format,r||(r=Aj),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const y=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);y.length>0&&y[0]!=="dev"&&(this.options.lng=y[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(y=>{this[y]=(...S)=>this.store[y](...S)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(y=>{this[y]=(...S)=>(this.store[y](...S),this)});const i=$S(),m=()=>{const y=(S,b)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),i.resolve(b),r(S,b)};if(this.languages&&!this.isInitialized)return y(null,this.t.bind(this));this.changeLanguage(this.options.lng,y)};return this.options.resources||!this.options.initAsync?m():setTimeout(m,0),i}loadResources(t,r=Aj){var o,h;let n=r;const s=bi(t)?t:this.language;if(typeof t=="function"&&(n=t),!this.options.resources||this.options.partialBundledLanguages){if((s==null?void 0:s.toLowerCase())==="cimode"&&(!this.options.preload||this.options.preload.length===0))return n();const i=[],m=y=>{if(!y||y==="cimode")return;this.services.languageUtils.toResolveHierarchy(y).forEach(b=>{b!=="cimode"&&i.indexOf(b)<0&&i.push(b)})};s?m(s):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(S=>m(S)),(h=(o=this.options.preload)==null?void 0:o.forEach)==null||h.call(o,y=>m(y)),this.services.backendConnector.load(i,this.options.ns,y=>{!y&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),n(y)})}else n(null)}reloadResources(t,r,n){const s=$S();return typeof t=="function"&&(n=t,t=void 0),typeof r=="function"&&(n=r,r=void 0),t||(t=this.languages),r||(r=this.options.ns),n||(n=Aj),this.services.backendConnector.reload(t,r,o=>{s.resolve(),n(o)}),s}use(t){if(!t)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!t.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return t.type==="backend"&&(this.modules.backend=t),(t.type==="logger"||t.log&&t.warn&&t.error)&&(this.modules.logger=t),t.type==="languageDetector"&&(this.modules.languageDetector=t),t.type==="i18nFormat"&&(this.modules.i18nFormat=t),t.type==="postProcessor"&&Wre.addPostProcessor(t),t.type==="formatter"&&(this.modules.formatter=t),t.type==="3rdParty"&&this.modules.external.push(t),this}setResolvedLanguage(t){if(!(!t||!this.languages)&&!(["cimode","dev"].indexOf(t)>-1)){for(let r=0;r<this.languages.length;r++){const n=this.languages[r];if(!(["cimode","dev"].indexOf(n)>-1)&&this.store.hasLanguageSomeTranslations(n)){this.resolvedLanguage=n;break}}!this.resolvedLanguage&&this.languages.indexOf(t)<0&&this.store.hasLanguageSomeTranslations(t)&&(this.resolvedLanguage=t,this.languages.unshift(t))}}changeLanguage(t,r){this.isLanguageChangingTo=t;const n=$S();this.emit("languageChanging",t);const s=i=>{this.language=i,this.languages=this.services.languageUtils.toResolveHierarchy(i),this.resolvedLanguage=void 0,this.setResolvedLanguage(i)},o=(i,m)=>{m?this.isLanguageChangingTo===t&&(s(m),this.translator.changeLanguage(m),this.isLanguageChangingTo=void 0,this.emit("languageChanged",m),this.logger.log("languageChanged",m)):this.isLanguageChangingTo=void 0,n.resolve((...y)=>this.t(...y)),r&&r(i,(...y)=>this.t(...y))},h=i=>{var S,b;!t&&!i&&this.services.languageDetector&&(i=[]);const m=bi(i)?i:i&&i[0],y=this.store.hasLanguageSomeTranslations(m)?m:this.services.languageUtils.getBestMatchFromCodes(bi(i)?[i]:i);y&&(this.language||s(y),this.translator.language||this.translator.changeLanguage(y),(b=(S=this.services.languageDetector)==null?void 0:S.cacheUserLanguage)==null||b.call(S,y)),this.loadResources(y,T=>{o(T,y)})};return!t&&this.services.languageDetector&&!this.services.languageDetector.async?h(this.services.languageDetector.detect()):!t&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(h):this.services.languageDetector.detect(h):h(t),n}getFixedT(t,r,n){const s=(o,h,...i)=>{let m;typeof h!="object"?m=this.options.overloadTranslationOptionHandler([o,h].concat(i)):m={...h},m.lng=m.lng||s.lng,m.lngs=m.lngs||s.lngs,m.ns=m.ns||s.ns,m.keyPrefix!==""&&(m.keyPrefix=m.keyPrefix||n||s.keyPrefix);const y=this.options.keySeparator||".";let S;return m.keyPrefix&&Array.isArray(o)?S=o.map(b=>(typeof b=="function"&&(b=yF(b,{...this.options,...h})),`${m.keyPrefix}${y}${b}`)):(typeof o=="function"&&(o=yF(o,{...this.options,...h})),S=m.keyPrefix?`${m.keyPrefix}${y}${o}`:o),this.t(S,m)};return bi(t)?s.lng=t:s.lngs=t,s.ns=r,s.keyPrefix=n,s}t(...t){var r;return(r=this.translator)==null?void 0:r.translate(...t)}exists(...t){var r;return(r=this.translator)==null?void 0:r.exists(...t)}setDefaultNamespace(t){this.options.defaultNS=t}hasLoadedNamespace(t,r={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const n=r.lng||this.resolvedLanguage||this.languages[0],s=this.options?this.options.fallbackLng:!1,o=this.languages[this.languages.length-1];if(n.toLowerCase()==="cimode")return!0;const h=(i,m)=>{const y=this.services.backendConnector.state[`${i}|${m}`];return y===-1||y===0||y===2};if(r.precheck){const i=r.precheck(this,h);if(i!==void 0)return i}return!!(this.hasResourceBundle(n,t)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||h(n,t)&&(!s||h(o,t)))}loadNamespaces(t,r){const n=$S();return this.options.ns?(bi(t)&&(t=[t]),t.forEach(s=>{this.options.ns.indexOf(s)<0&&this.options.ns.push(s)}),this.loadResources(s=>{n.resolve(),r&&r(s)}),n):(r&&r(),Promise.resolve())}loadLanguages(t,r){const n=$S();bi(t)&&(t=[t]);const s=this.options.preload||[],o=t.filter(h=>s.indexOf(h)<0&&this.services.languageUtils.isSupportedCode(h));return o.length?(this.options.preload=s.concat(o),this.loadResources(h=>{n.resolve(),r&&r(h)}),n):(r&&r(),Promise.resolve())}dir(t){var s,o;if(t||(t=this.resolvedLanguage||(((s=this.languages)==null?void 0:s.length)>0?this.languages[0]:this.language)),!t)return"rtl";try{const h=new Intl.Locale(t);if(h&&h.getTextInfo){const i=h.getTextInfo();if(i&&i.direction)return i.direction}}catch{}const r=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],n=((o=this.services)==null?void 0:o.languageUtils)||new tG(aG());return t.toLowerCase().indexOf("-latn")>1?"ltr":r.indexOf(n.getLanguagePartFromCode(t))>-1||t.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(t={},r){const n=new IE(t,r);return n.createInstance=IE.createInstance,n}cloneInstance(t={},r=Aj){const n=t.forkResourceStore;n&&delete t.forkResourceStore;const s={...this.options,...t,isClone:!0},o=new IE(s);if((t.debug!==void 0||t.prefix!==void 0)&&(o.logger=o.logger.clone(t)),["store","services","language"].forEach(i=>{o[i]=this[i]}),o.services={...this.services},o.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},n){const i=Object.keys(this.store.data).reduce((m,y)=>(m[y]={...this.store.data[y]},m[y]=Object.keys(m[y]).reduce((S,b)=>(S[b]={...m[y][b]},S),m[y]),m),{});o.store=new QH(i,s),o.services.resourceStore=o.store}return o.translator=new dO(o.services,s),o.translator.on("*",(i,...m)=>{o.emit(i,...m)}),o.init(s,r),o.translator.options=s,o.translator.backendConnector.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},o}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Pr=IE.createInstance();Pr.createInstance;Pr.dir;Pr.init;Pr.loadResources;Pr.reloadResources;Pr.use;Pr.changeLanguage;Pr.getFixedT;Pr.t;Pr.exists;Pr.setDefaultNamespace;Pr.hasLoadedNamespace;Pr.loadNamespaces;Pr.loadLanguages;const x2e=(e,t,r,n)=>{var o,h,i,m;const s=[r,{code:t,...n||{}}];if((h=(o=e==null?void 0:e.services)==null?void 0:o.logger)!=null&&h.forward)return e.services.logger.forward(s,"warn","react-i18next::",!0);Cv(s[0])&&(s[0]=`react-i18next:: ${s[0]}`),(m=(i=e==null?void 0:e.services)==null?void 0:i.logger)!=null&&m.warn?e.services.logger.warn(...s):console!=null&&console.warn&&console.warn(...s)},lG={},Zre=(e,t,r,n)=>{Cv(r)&&lG[r]||(Cv(r)&&(lG[r]=new Date),x2e(e,t,r,n))},Xre=(e,t)=>()=>{if(e.isInitialized)t();else{const r=()=>{setTimeout(()=>{e.off("initialized",r)},0),t()};e.on("initialized",r)}},vF=(e,t,r)=>{e.loadNamespaces(t,Xre(e,r))},cG=(e,t,r,n)=>{if(Cv(r)&&(r=[r]),e.options.preload&&e.options.preload.indexOf(t)>-1)return vF(e,r,n);r.forEach(s=>{e.options.ns.indexOf(s)<0&&e.options.ns.push(s)}),e.loadLanguages(t,Xre(e,n))},b2e=(e,t,r={})=>!t.languages||!t.languages.length?(Zre(t,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:t.languages}),!0):t.hasLoadedNamespace(e,{lng:r.lng,precheck:(n,s)=>{if(r.bindI18n&&r.bindI18n.indexOf("languageChanging")>-1&&n.services.backendConnector.backend&&n.isLanguageChangingTo&&!s(n.isLanguageChangingTo,e))return!1}}),Cv=e=>typeof e=="string",w2e=e=>typeof e=="object"&&e!==null,S2e=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,E2e={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"","&#169;":"","&reg;":"","&#174;":"","&hellip;":"","&#8230;":"","&#x2F;":"/","&#47;":"/"},T2e=e=>E2e[e],A2e=e=>e.replace(S2e,T2e);let _F={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:A2e};const C2e=(e={})=>{_F={..._F,...e}},j2e=()=>_F;let Yre;const P2e=e=>{Yre=e},O2e=()=>Yre,k2e={type:"3rdParty",init(e){C2e(e.options.react),P2e(e)}},N2e=V.createContext();class I2e{constructor(){this.usedNamespaces={}}addUsedNamespaces(t){t.forEach(r=>{this.usedNamespaces[r]||(this.usedNamespaces[r]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const R2e=(e,t)=>Cv(t)?t:w2e(t)&&Cv(t.defaultValue)?t.defaultValue:Array.isArray(e)?e[e.length-1]:e,M2e={t:R2e,ready:!1},D2e=()=>()=>{},ci=(e,t={})=>{var ne,ie,re;const{i18n:r}=t,{i18n:n,defaultNS:s}=V.useContext(N2e)||{},o=r||n||O2e();o&&!o.reportNamespaces&&(o.reportNamespaces=new I2e),o||Zre(o,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const h=V.useMemo(()=>{var te;return{...j2e(),...(te=o==null?void 0:o.options)==null?void 0:te.react,...t}},[o,t]),{useSuspense:i,keyPrefix:m}=h,y=s||((ne=o==null?void 0:o.options)==null?void 0:ne.defaultNS),S=Cv(y)?[y]:y||["translation"],b=V.useMemo(()=>S,S);(re=(ie=o==null?void 0:o.reportNamespaces)==null?void 0:ie.addUsedNamespaces)==null||re.call(ie,b);const T=V.useRef(0),A=V.useCallback(te=>{if(!o)return D2e;const{bindI18n:ae,bindI18nStore:ue}=h,be=()=>{T.current+=1,te()};return ae&&o.on(ae,be),ue&&o.store.on(ue,be),()=>{ae&&ae.split(" ").forEach(we=>o.off(we,be)),ue&&ue.split(" ").forEach(we=>o.store.off(we,be))}},[o,h]),O=V.useRef(),P=V.useCallback(()=>{if(!o)return M2e;const te=!!(o.isInitialized||o.initializedStoreOnce)&&b.every(_e=>b2e(_e,o,h)),ae=t.lng||o.language,ue=T.current,be=O.current;if(be&&be.ready===te&&be.lng===ae&&be.keyPrefix===m&&be.revision===ue)return be;const Ce={t:o.getFixedT(ae,h.nsMode==="fallback"?b:b[0],m),ready:te,lng:ae,keyPrefix:m,revision:ue};return O.current=Ce,Ce},[o,b,m,h,t.lng]),[I,R]=V.useState(0),{t:M,ready:F}=Dre.useSyncExternalStore(A,P,P);V.useEffect(()=>{if(o&&!F&&!i){const te=()=>R(ae=>ae+1);t.lng?cG(o,t.lng,b,te):vF(o,b,te)}},[o,t.lng,b,F,i,I]);const z=o||{},$=V.useRef(null),W=V.useRef(),K=te=>{const ae=Object.getOwnPropertyDescriptors(te);ae.__original&&delete ae.__original;const ue=Object.create(Object.getPrototypeOf(te),ae);if(!Object.prototype.hasOwnProperty.call(ue,"__original"))try{Object.defineProperty(ue,"__original",{value:te,writable:!1,enumerable:!1,configurable:!1})}catch{}return ue},ee=V.useMemo(()=>{const te=z,ae=te==null?void 0:te.language;let ue=te;te&&($.current&&$.current.__original===te?W.current!==ae?(ue=K(te),$.current=ue,W.current=ae):ue=$.current:(ue=K(te),$.current=ue,W.current=ae));const be=[M,ue,F];return be.t=M,be.i18n=ue,be.ready=F,be},[M,z,F,z.resolvedLanguage,z.language,z.languages]);if(o&&i&&!F)throw new Promise(te=>{const ae=()=>te();t.lng?cG(o,t.lng,b,ae):vF(o,b,ae)});return ee};var L2e=V.createContext(void 0);function Zv(e){const t=V.useContext(L2e);return e||t||"ltr"}var GD="rovingFocusGroup.onEntryFocus",F2e={bubbles:!1,cancelable:!0},N2="RovingFocusGroup",[xF,Jre,z2e]=_2(N2),[B2e,ow]=Mo(N2,[z2e]),[$2e,U2e]=B2e(N2),Qre=V.forwardRef((e,t)=>d.jsx(xF.Provider,{scope:e.__scopeRovingFocusGroup,children:d.jsx(xF.Slot,{scope:e.__scopeRovingFocusGroup,children:d.jsx(V2e,{...e,ref:t})})}));Qre.displayName=N2;var V2e=V.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,orientation:n,loop:s=!1,dir:o,currentTabStopId:h,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:m,onEntryFocus:y,preventScrollOnEntryFocus:S=!1,...b}=e,T=V.useRef(null),A=Un(t,T),O=Zv(o),[P,I]=Zc({prop:h,defaultProp:i??null,onChange:m,caller:N2}),[R,M]=V.useState(!1),F=no(y),z=Jre(r),$=V.useRef(!1),[W,K]=V.useState(0);return V.useEffect(()=>{const ee=T.current;if(ee)return ee.addEventListener(GD,F),()=>ee.removeEventListener(GD,F)},[F]),d.jsx($2e,{scope:r,orientation:n,dir:O,loop:s,currentTabStopId:P,onItemFocus:V.useCallback(ee=>I(ee),[I]),onItemShiftTab:V.useCallback(()=>M(!0),[]),onFocusableItemAdd:V.useCallback(()=>K(ee=>ee+1),[]),onFocusableItemRemove:V.useCallback(()=>K(ee=>ee-1),[]),children:d.jsx(ln.div,{tabIndex:R||W===0?-1:0,"data-orientation":n,...b,ref:A,style:{outline:"none",...e.style},onMouseDown:Ir(e.onMouseDown,()=>{$.current=!0}),onFocus:Ir(e.onFocus,ee=>{const ne=!$.current;if(ee.target===ee.currentTarget&&ne&&!R){const ie=new CustomEvent(GD,F2e);if(ee.currentTarget.dispatchEvent(ie),!ie.defaultPrevented){const re=z().filter(we=>we.focusable),te=re.find(we=>we.active),ae=re.find(we=>we.id===P),be=[te,ae,...re].filter(Boolean).map(we=>we.ref.current);rne(be,S)}}$.current=!1}),onBlur:Ir(e.onBlur,()=>M(!1))})})}),ene="RovingFocusGroupItem",tne=V.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,focusable:n=!0,active:s=!1,tabStopId:o,children:h,...i}=e,m=_u(),y=o||m,S=U2e(ene,r),b=S.currentTabStopId===y,T=Jre(r),{onFocusableItemAdd:A,onFocusableItemRemove:O,currentTabStopId:P}=S;return V.useEffect(()=>{if(n)return A(),()=>O()},[n,A,O]),d.jsx(xF.ItemSlot,{scope:r,id:y,focusable:n,active:s,children:d.jsx(ln.span,{tabIndex:b?0:-1,"data-orientation":S.orientation,...i,ref:t,onMouseDown:Ir(e.onMouseDown,I=>{n?S.onItemFocus(y):I.preventDefault()}),onFocus:Ir(e.onFocus,()=>S.onItemFocus(y)),onKeyDown:Ir(e.onKeyDown,I=>{if(I.key==="Tab"&&I.shiftKey){S.onItemShiftTab();return}if(I.target!==I.currentTarget)return;const R=G2e(I,S.orientation,S.dir);if(R!==void 0){if(I.metaKey||I.ctrlKey||I.altKey||I.shiftKey)return;I.preventDefault();let F=T().filter(z=>z.focusable).map(z=>z.ref.current);if(R==="last")F.reverse();else if(R==="prev"||R==="next"){R==="prev"&&F.reverse();const z=F.indexOf(I.currentTarget);F=S.loop?W2e(F,z+1):F.slice(z+1)}setTimeout(()=>rne(F))}}),children:typeof h=="function"?h({isCurrentTabStop:b,hasTabStop:P!=null}):h})})});tne.displayName=ene;var q2e={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function H2e(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function G2e(e,t,r){const n=H2e(e.key,r);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return q2e[n]}function rne(e,t=!1){const r=document.activeElement;for(const n of e)if(n===r||(n.focus({preventScroll:t}),document.activeElement!==r))return}function W2e(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var c5=Qre,u5=tne,bF=["Enter"," "],K2e=["ArrowDown","PageUp","Home"],nne=["ArrowUp","PageDown","End"],Z2e=[...K2e,...nne],X2e={ltr:[...bF,"ArrowRight"],rtl:[...bF,"ArrowLeft"]},Y2e={ltr:["ArrowLeft"],rtl:["ArrowRight"]},I2="Menu",[gT,J2e,Q2e]=_2(I2),[Xv,ine]=Mo(I2,[Q2e,_g,ow]),EN=_g(),sne=ow(),[eAe,Yv]=Xv(I2),[tAe,R2]=Xv(I2),ane=e=>{const{__scopeMenu:t,open:r=!1,children:n,dir:s,onOpenChange:o,modal:h=!0}=e,i=EN(t),[m,y]=V.useState(null),S=V.useRef(!1),b=no(o),T=Zv(s);return V.useEffect(()=>{const A=()=>{S.current=!0,document.addEventListener("pointerdown",O,{capture:!0,once:!0}),document.addEventListener("pointermove",O,{capture:!0,once:!0})},O=()=>S.current=!1;return document.addEventListener("keydown",A,{capture:!0}),()=>{document.removeEventListener("keydown",A,{capture:!0}),document.removeEventListener("pointerdown",O,{capture:!0}),document.removeEventListener("pointermove",O,{capture:!0})}},[]),d.jsx(oN,{...i,children:d.jsx(eAe,{scope:t,open:r,onOpenChange:b,content:m,onContentChange:y,children:d.jsx(tAe,{scope:t,onClose:V.useCallback(()=>b(!1),[b]),isUsingKeyboardRef:S,dir:T,modal:h,children:n})})})};ane.displayName=I2;var rAe="MenuAnchor",d5=V.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,s=EN(r);return d.jsx(E2,{...s,...n,ref:t})});d5.displayName=rAe;var h5="MenuPortal",[nAe,one]=Xv(h5,{forceMount:void 0}),lne=e=>{const{__scopeMenu:t,forceMount:r,children:n,container:s}=e,o=Yv(h5,t);return d.jsx(nAe,{scope:t,forceMount:r,children:d.jsx(Do,{present:r||o.open,children:d.jsx(Yb,{asChild:!0,container:s,children:n})})})};lne.displayName=h5;var Zu="MenuContent",[iAe,f5]=Xv(Zu),cne=V.forwardRef((e,t)=>{const r=one(Zu,e.__scopeMenu),{forceMount:n=r.forceMount,...s}=e,o=Yv(Zu,e.__scopeMenu),h=R2(Zu,e.__scopeMenu);return d.jsx(gT.Provider,{scope:e.__scopeMenu,children:d.jsx(Do,{present:n||o.open,children:d.jsx(gT.Slot,{scope:e.__scopeMenu,children:h.modal?d.jsx(sAe,{...s,ref:t}):d.jsx(aAe,{...s,ref:t})})})})}),sAe=V.forwardRef((e,t)=>{const r=Yv(Zu,e.__scopeMenu),n=V.useRef(null),s=Un(t,n);return V.useEffect(()=>{const o=n.current;if(o)return xN(o)},[]),d.jsx(p5,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:Ir(e.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),aAe=V.forwardRef((e,t)=>{const r=Yv(Zu,e.__scopeMenu);return d.jsx(p5,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),oAe=lg("MenuContent.ScrollLock"),p5=V.forwardRef((e,t)=>{const{__scopeMenu:r,loop:n=!1,trapFocus:s,onOpenAutoFocus:o,onCloseAutoFocus:h,disableOutsidePointerEvents:i,onEntryFocus:m,onEscapeKeyDown:y,onPointerDownOutside:S,onFocusOutside:b,onInteractOutside:T,onDismiss:A,disableOutsideScroll:O,...P}=e,I=Yv(Zu,r),R=R2(Zu,r),M=EN(r),F=sne(r),z=J2e(r),[$,W]=V.useState(null),K=V.useRef(null),ee=Un(t,K,I.onContentChange),ne=V.useRef(0),ie=V.useRef(""),re=V.useRef(0),te=V.useRef(null),ae=V.useRef("right"),ue=V.useRef(0),be=O?C2:V.Fragment,we=O?{as:oAe,allowPinchZoom:!0}:void 0,Ce=me=>{var Be,nt;const Ae=ie.current+me,ge=z().filter(Me=>!Me.disabled),pe=document.activeElement,Oe=(Be=ge.find(Me=>Me.ref.current===pe))==null?void 0:Be.textValue,Je=ge.map(Me=>Me.textValue),Ze=_Ae(Je,Ae,Oe),Pe=(nt=ge.find(Me=>Me.textValue===Ze))==null?void 0:nt.ref.current;(function Me(We){ie.current=We,window.clearTimeout(ne.current),We!==""&&(ne.current=window.setTimeout(()=>Me(""),1e3))})(Ae),Pe&&setTimeout(()=>Pe.focus())};V.useEffect(()=>()=>window.clearTimeout(ne.current),[]),vN();const _e=V.useCallback(me=>{var ge,pe;return ae.current===((ge=te.current)==null?void 0:ge.side)&&bAe(me,(pe=te.current)==null?void 0:pe.area)},[]);return d.jsx(iAe,{scope:r,searchRef:ie,onItemEnter:V.useCallback(me=>{_e(me)&&me.preventDefault()},[_e]),onItemLeave:V.useCallback(me=>{var Ae;_e(me)||((Ae=K.current)==null||Ae.focus(),W(null))},[_e]),onTriggerLeave:V.useCallback(me=>{_e(me)&&me.preventDefault()},[_e]),pointerGraceTimerRef:re,onPointerGraceIntentChange:V.useCallback(me=>{te.current=me},[]),children:d.jsx(be,{...we,children:d.jsx(A2,{asChild:!0,trapped:s,onMountAutoFocus:Ir(o,me=>{var Ae;me.preventDefault(),(Ae=K.current)==null||Ae.focus({preventScroll:!0})}),onUnmountAutoFocus:h,children:d.jsx(Gv,{asChild:!0,disableOutsidePointerEvents:i,onEscapeKeyDown:y,onPointerDownOutside:S,onFocusOutside:b,onInteractOutside:T,onDismiss:A,children:d.jsx(c5,{asChild:!0,...F,dir:R.dir,orientation:"vertical",loop:n,currentTabStopId:$,onCurrentTabStopIdChange:W,onEntryFocus:Ir(m,me=>{R.isUsingKeyboardRef.current||me.preventDefault()}),preventScrollOnEntryFocus:!0,children:d.jsx(lN,{role:"menu","aria-orientation":"vertical","data-state":Tne(I.open),"data-radix-menu-content":"",dir:R.dir,...M,...P,ref:ee,style:{outline:"none",...P.style},onKeyDown:Ir(P.onKeyDown,me=>{const ge=me.target.closest("[data-radix-menu-content]")===me.currentTarget,pe=me.ctrlKey||me.altKey||me.metaKey,Oe=me.key.length===1;ge&&(me.key==="Tab"&&me.preventDefault(),!pe&&Oe&&Ce(me.key));const Je=K.current;if(me.target!==Je||!Z2e.includes(me.key))return;me.preventDefault();const Pe=z().filter(Be=>!Be.disabled).map(Be=>Be.ref.current);nne.includes(me.key)&&Pe.reverse(),yAe(Pe)}),onBlur:Ir(e.onBlur,me=>{me.currentTarget.contains(me.target)||(window.clearTimeout(ne.current),ie.current="")}),onPointerMove:Ir(e.onPointerMove,yT(me=>{const Ae=me.target,ge=ue.current!==me.clientX;if(me.currentTarget.contains(Ae)&&ge){const pe=me.clientX>ue.current?"right":"left";ae.current=pe,ue.current=me.clientX}}))})})})})})})});cne.displayName=Zu;var lAe="MenuGroup",m5=V.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return d.jsx(ln.div,{role:"group",...n,ref:t})});m5.displayName=lAe;var cAe="MenuLabel",une=V.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return d.jsx(ln.div,{...n,ref:t})});une.displayName=cAe;var hO="MenuItem",uG="menu.itemSelect",TN=V.forwardRef((e,t)=>{const{disabled:r=!1,onSelect:n,...s}=e,o=V.useRef(null),h=R2(hO,e.__scopeMenu),i=f5(hO,e.__scopeMenu),m=Un(t,o),y=V.useRef(!1),S=()=>{const b=o.current;if(!r&&b){const T=new CustomEvent(uG,{bubbles:!0,cancelable:!0});b.addEventListener(uG,A=>n==null?void 0:n(A),{once:!0}),xB(b,T),T.defaultPrevented?y.current=!1:h.onClose()}};return d.jsx(dne,{...s,ref:m,disabled:r,onClick:Ir(e.onClick,S),onPointerDown:b=>{var T;(T=e.onPointerDown)==null||T.call(e,b),y.current=!0},onPointerUp:Ir(e.onPointerUp,b=>{var T;y.current||(T=b.currentTarget)==null||T.click()}),onKeyDown:Ir(e.onKeyDown,b=>{const T=i.searchRef.current!=="";r||T&&b.key===" "||bF.includes(b.key)&&(b.currentTarget.click(),b.preventDefault())})})});TN.displayName=hO;var dne=V.forwardRef((e,t)=>{const{__scopeMenu:r,disabled:n=!1,textValue:s,...o}=e,h=f5(hO,r),i=sne(r),m=V.useRef(null),y=Un(t,m),[S,b]=V.useState(!1),[T,A]=V.useState("");return V.useEffect(()=>{const O=m.current;O&&A((O.textContent??"").trim())},[o.children]),d.jsx(gT.ItemSlot,{scope:r,disabled:n,textValue:s??T,children:d.jsx(u5,{asChild:!0,...i,focusable:!n,children:d.jsx(ln.div,{role:"menuitem","data-highlighted":S?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...o,ref:y,onPointerMove:Ir(e.onPointerMove,yT(O=>{n?h.onItemLeave(O):(h.onItemEnter(O),O.defaultPrevented||O.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Ir(e.onPointerLeave,yT(O=>h.onItemLeave(O))),onFocus:Ir(e.onFocus,()=>b(!0)),onBlur:Ir(e.onBlur,()=>b(!1))})})})}),uAe="MenuCheckboxItem",hne=V.forwardRef((e,t)=>{const{checked:r=!1,onCheckedChange:n,...s}=e;return d.jsx(yne,{scope:e.__scopeMenu,checked:r,children:d.jsx(TN,{role:"menuitemcheckbox","aria-checked":fO(r)?"mixed":r,...s,ref:t,"data-state":y5(r),onSelect:Ir(s.onSelect,()=>n==null?void 0:n(fO(r)?!0:!r),{checkForDefaultPrevented:!1})})})});hne.displayName=uAe;var fne="MenuRadioGroup",[dAe,hAe]=Xv(fne,{value:void 0,onValueChange:()=>{}}),pne=V.forwardRef((e,t)=>{const{value:r,onValueChange:n,...s}=e,o=no(n);return d.jsx(dAe,{scope:e.__scopeMenu,value:r,onValueChange:o,children:d.jsx(m5,{...s,ref:t})})});pne.displayName=fne;var mne="MenuRadioItem",gne=V.forwardRef((e,t)=>{const{value:r,...n}=e,s=hAe(mne,e.__scopeMenu),o=r===s.value;return d.jsx(yne,{scope:e.__scopeMenu,checked:o,children:d.jsx(TN,{role:"menuitemradio","aria-checked":o,...n,ref:t,"data-state":y5(o),onSelect:Ir(n.onSelect,()=>{var h;return(h=s.onValueChange)==null?void 0:h.call(s,r)},{checkForDefaultPrevented:!1})})})});gne.displayName=mne;var g5="MenuItemIndicator",[yne,fAe]=Xv(g5,{checked:!1}),vne=V.forwardRef((e,t)=>{const{__scopeMenu:r,forceMount:n,...s}=e,o=fAe(g5,r);return d.jsx(Do,{present:n||fO(o.checked)||o.checked===!0,children:d.jsx(ln.span,{...s,ref:t,"data-state":y5(o.checked)})})});vne.displayName=g5;var pAe="MenuSeparator",_ne=V.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return d.jsx(ln.div,{role:"separator","aria-orientation":"horizontal",...n,ref:t})});_ne.displayName=pAe;var mAe="MenuArrow",xne=V.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,s=EN(r);return d.jsx(cN,{...s,...n,ref:t})});xne.displayName=mAe;var gAe="MenuSub",[ast,bne]=Xv(gAe),fE="MenuSubTrigger",wne=V.forwardRef((e,t)=>{const r=Yv(fE,e.__scopeMenu),n=R2(fE,e.__scopeMenu),s=bne(fE,e.__scopeMenu),o=f5(fE,e.__scopeMenu),h=V.useRef(null),{pointerGraceTimerRef:i,onPointerGraceIntentChange:m}=o,y={__scopeMenu:e.__scopeMenu},S=V.useCallback(()=>{h.current&&window.clearTimeout(h.current),h.current=null},[]);return V.useEffect(()=>S,[S]),V.useEffect(()=>{const b=i.current;return()=>{window.clearTimeout(b),m(null)}},[i,m]),d.jsx(d5,{asChild:!0,...y,children:d.jsx(dne,{id:s.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":s.contentId,"data-state":Tne(r.open),...e,ref:Zk(t,s.onTriggerChange),onClick:b=>{var T;(T=e.onClick)==null||T.call(e,b),!(e.disabled||b.defaultPrevented)&&(b.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:Ir(e.onPointerMove,yT(b=>{o.onItemEnter(b),!b.defaultPrevented&&!e.disabled&&!r.open&&!h.current&&(o.onPointerGraceIntentChange(null),h.current=window.setTimeout(()=>{r.onOpenChange(!0),S()},100))})),onPointerLeave:Ir(e.onPointerLeave,yT(b=>{var A,O;S();const T=(A=r.content)==null?void 0:A.getBoundingClientRect();if(T){const P=(O=r.content)==null?void 0:O.dataset.side,I=P==="right",R=I?-5:5,M=T[I?"left":"right"],F=T[I?"right":"left"];o.onPointerGraceIntentChange({area:[{x:b.clientX+R,y:b.clientY},{x:M,y:T.top},{x:F,y:T.top},{x:F,y:T.bottom},{x:M,y:T.bottom}],side:P}),window.clearTimeout(i.current),i.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(b),b.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:Ir(e.onKeyDown,b=>{var A;const T=o.searchRef.current!=="";e.disabled||T&&b.key===" "||X2e[n.dir].includes(b.key)&&(r.onOpenChange(!0),(A=r.content)==null||A.focus(),b.preventDefault())})})})});wne.displayName=fE;var Sne="MenuSubContent",Ene=V.forwardRef((e,t)=>{const r=one(Zu,e.__scopeMenu),{forceMount:n=r.forceMount,...s}=e,o=Yv(Zu,e.__scopeMenu),h=R2(Zu,e.__scopeMenu),i=bne(Sne,e.__scopeMenu),m=V.useRef(null),y=Un(t,m);return d.jsx(gT.Provider,{scope:e.__scopeMenu,children:d.jsx(Do,{present:n||o.open,children:d.jsx(gT.Slot,{scope:e.__scopeMenu,children:d.jsx(p5,{id:i.contentId,"aria-labelledby":i.triggerId,...s,ref:y,align:"start",side:h.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:S=>{var b;h.isUsingKeyboardRef.current&&((b=m.current)==null||b.focus()),S.preventDefault()},onCloseAutoFocus:S=>S.preventDefault(),onFocusOutside:Ir(e.onFocusOutside,S=>{S.target!==i.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:Ir(e.onEscapeKeyDown,S=>{h.onClose(),S.preventDefault()}),onKeyDown:Ir(e.onKeyDown,S=>{var A;const b=S.currentTarget.contains(S.target),T=Y2e[h.dir].includes(S.key);b&&T&&(o.onOpenChange(!1),(A=i.trigger)==null||A.focus(),S.preventDefault())})})})})})});Ene.displayName=Sne;function Tne(e){return e?"open":"closed"}function fO(e){return e==="indeterminate"}function y5(e){return fO(e)?"indeterminate":e?"checked":"unchecked"}function yAe(e){const t=document.activeElement;for(const r of e)if(r===t||(r.focus(),document.activeElement!==t))return}function vAe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}function _Ae(e,t,r){const s=t.length>1&&Array.from(t).every(y=>y===t[0])?t[0]:t,o=r?e.indexOf(r):-1;let h=vAe(e,Math.max(o,0));s.length===1&&(h=h.filter(y=>y!==r));const m=h.find(y=>y.toLowerCase().startsWith(s.toLowerCase()));return m!==r?m:void 0}function xAe(e,t){const{x:r,y:n}=e;let s=!1;for(let o=0,h=t.length-1;o<t.length;h=o++){const i=t[o],m=t[h],y=i.x,S=i.y,b=m.x,T=m.y;S>n!=T>n&&r<(b-y)*(n-S)/(T-S)+y&&(s=!s)}return s}function bAe(e,t){if(!t)return!1;const r={x:e.clientX,y:e.clientY};return xAe(r,t)}function yT(e){return t=>t.pointerType==="mouse"?e(t):void 0}var wAe=ane,SAe=d5,EAe=lne,TAe=cne,AAe=m5,CAe=une,jAe=TN,PAe=hne,OAe=pne,kAe=gne,NAe=vne,IAe=_ne,RAe=xne,MAe=wne,DAe=Ene,AN="DropdownMenu",[LAe,ost]=Mo(AN,[ine]),vc=ine(),[FAe,Ane]=LAe(AN),Cne=e=>{const{__scopeDropdownMenu:t,children:r,dir:n,open:s,defaultOpen:o,onOpenChange:h,modal:i=!0}=e,m=vc(t),y=V.useRef(null),[S,b]=Zc({prop:s,defaultProp:o??!1,onChange:h,caller:AN});return d.jsx(FAe,{scope:t,triggerId:_u(),triggerRef:y,contentId:_u(),open:S,onOpenChange:b,onOpenToggle:V.useCallback(()=>b(T=>!T),[b]),modal:i,children:d.jsx(wAe,{...m,open:S,onOpenChange:b,dir:n,modal:i,children:r})})};Cne.displayName=AN;var jne="DropdownMenuTrigger",Pne=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,disabled:n=!1,...s}=e,o=Ane(jne,r),h=vc(r);return d.jsx(SAe,{asChild:!0,...h,children:d.jsx(ln.button,{type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...s,ref:Zk(t,o.triggerRef),onPointerDown:Ir(e.onPointerDown,i=>{!n&&i.button===0&&i.ctrlKey===!1&&(o.onOpenToggle(),o.open||i.preventDefault())}),onKeyDown:Ir(e.onKeyDown,i=>{n||(["Enter"," "].includes(i.key)&&o.onOpenToggle(),i.key==="ArrowDown"&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(i.key)&&i.preventDefault())})})})});Pne.displayName=jne;var zAe="DropdownMenuPortal",One=e=>{const{__scopeDropdownMenu:t,...r}=e,n=vc(t);return d.jsx(EAe,{...n,...r})};One.displayName=zAe;var kne="DropdownMenuContent",Nne=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=Ane(kne,r),o=vc(r),h=V.useRef(!1);return d.jsx(TAe,{id:s.contentId,"aria-labelledby":s.triggerId,...o,...n,ref:t,onCloseAutoFocus:Ir(e.onCloseAutoFocus,i=>{var m;h.current||(m=s.triggerRef.current)==null||m.focus(),h.current=!1,i.preventDefault()}),onInteractOutside:Ir(e.onInteractOutside,i=>{const m=i.detail.originalEvent,y=m.button===0&&m.ctrlKey===!0,S=m.button===2||y;(!s.modal||S)&&(h.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Nne.displayName=kne;var BAe="DropdownMenuGroup",$Ae=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return d.jsx(AAe,{...s,...n,ref:t})});$Ae.displayName=BAe;var UAe="DropdownMenuLabel",Ine=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return d.jsx(CAe,{...s,...n,ref:t})});Ine.displayName=UAe;var VAe="DropdownMenuItem",Rne=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return d.jsx(jAe,{...s,...n,ref:t})});Rne.displayName=VAe;var qAe="DropdownMenuCheckboxItem",Mne=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return d.jsx(PAe,{...s,...n,ref:t})});Mne.displayName=qAe;var HAe="DropdownMenuRadioGroup",GAe=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return d.jsx(OAe,{...s,...n,ref:t})});GAe.displayName=HAe;var WAe="DropdownMenuRadioItem",Dne=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return d.jsx(kAe,{...s,...n,ref:t})});Dne.displayName=WAe;var KAe="DropdownMenuItemIndicator",Lne=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return d.jsx(NAe,{...s,...n,ref:t})});Lne.displayName=KAe;var ZAe="DropdownMenuSeparator",Fne=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return d.jsx(IAe,{...s,...n,ref:t})});Fne.displayName=ZAe;var XAe="DropdownMenuArrow",YAe=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return d.jsx(RAe,{...s,...n,ref:t})});YAe.displayName=XAe;var JAe="DropdownMenuSubTrigger",zne=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return d.jsx(MAe,{...s,...n,ref:t})});zne.displayName=JAe;var QAe="DropdownMenuSubContent",Bne=V.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,s=vc(r);return d.jsx(DAe,{...s,...n,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Bne.displayName=QAe;var eCe=Cne,tCe=Pne,rCe=One,$ne=Nne,Une=Ine,Vne=Rne,qne=Mne,Hne=Dne,Gne=Lne,Wne=Fne,Kne=zne,Zne=Bne;const lw=eCe,cw=tCe,nCe=V.forwardRef(({className:e,inset:t,children:r,...n},s)=>d.jsxs(Kne,{ref:s,className:fr("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",t&&"pl-8",e),...n,children:[r,d.jsx(Qk,{className:"ml-auto h-4 w-4"})]}));nCe.displayName=Kne.displayName;const iCe=V.forwardRef(({className:e,...t},r)=>d.jsx(Zne,{ref:r,className:fr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));iCe.displayName=Zne.displayName;const Jv=V.forwardRef(({className:e,sideOffset:t=4,...r},n)=>d.jsx(rCe,{children:d.jsx($ne,{ref:n,sideOffset:t,className:fr("z-[100] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));Jv.displayName=$ne.displayName;const Ta=V.forwardRef(({className:e,inset:t,...r},n)=>d.jsx(Vne,{ref:n,className:fr("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t&&"pl-8",e),...r}));Ta.displayName=Vne.displayName;const sCe=V.forwardRef(({className:e,children:t,checked:r,...n},s)=>d.jsxs(qne,{ref:s,className:fr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),checked:r,...n,children:[d.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:d.jsx(Gne,{children:d.jsx(ip,{className:"h-4 w-4"})})}),t]}));sCe.displayName=qne.displayName;const aCe=V.forwardRef(({className:e,children:t,...r},n)=>d.jsxs(Hne,{ref:n,className:fr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...r,children:[d.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:d.jsx(Gne,{children:d.jsx(CQ,{className:"h-2 w-2 fill-current"})})}),t]}));aCe.displayName=Hne.displayName;const v5=V.forwardRef(({className:e,inset:t,...r},n)=>d.jsx(Une,{ref:n,className:fr("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...r}));v5.displayName=Une.displayName;const pv=V.forwardRef(({className:e,...t},r)=>d.jsx(Wne,{ref:r,className:fr("-mx-1 my-1 h-px bg-muted",e),...t}));pv.displayName=Wne.displayName;const CN=()=>{const{user:e}=Kn();return Ri(),ei({queryKey:["profile",e==null?void 0:e.id],queryFn:async()=>{if(!e)return null;const{data:t,error:r}=await Ct.from("profiles").select("*").eq("id",e.id).single();if(r)throw r;return t},enabled:!!e})},Xne=()=>{const{user:e}=Kn(),{toast:t}=Ri(),r=Mi();return Gi({mutationFn:async({display_name:n,phone:s,avatar_url:o,language_preference:h})=>{if(!e)throw new Error("User not authenticated");const i={};n!==void 0&&(i.display_name=n),s!==void 0&&(i.phone=s),o!==void 0&&(i.avatar_url=o),h!==void 0&&(i.language_preference=h);const{data:m,error:y}=await Ct.from("profiles").update(i).eq("id",e.id).select().single();if(y)throw y;return m},onSuccess:()=>{r.invalidateQueries({queryKey:["profile"]}),t({title:"Success",description:"Profile updated successfully"})},onError:()=>{t({title:"Error",description:"Failed to update profile",variant:"destructive"})}})},oCe=()=>{const{user:e}=Kn(),t=Mi();return Gi({mutationFn:async r=>{if(!e)return;const{error:n}=await Ct.from("profiles").update({language_preference:r}).eq("id",e.id);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["profile"]})}})},lCe=()=>{const{user:e}=Kn(),{toast:t}=Ri();return Gi({mutationFn:async r=>{if(!e)throw new Error("User not authenticated");const n=r.name.split(".").pop(),s=`${Date.now()}.${n}`,o=`${e.id}/${s}`,{error:h}=await Ct.storage.from("avatars").upload(o,r,{upsert:!0});if(h)throw h;const{data:{publicUrl:i}}=Ct.storage.from("avatars").getPublicUrl(o);return i},onError:()=>{t({title:"Error",description:"Failed to upload avatar",variant:"destructive"})}})},cCe=()=>{const{user:e}=Kn(),t=Mi();return Gi({mutationFn:async r=>{if(!e)throw new Error("User not authenticated");const n={activity_terms_agreed:r,activity_terms_agreed_at:r?new Date().toISOString():null},{error:s}=await Ct.from("profiles").update(n).eq("id",e.id);if(s)throw s;return r},onSuccess:()=>{t.invalidateQueries({queryKey:["profile"]})}})},WD=[{code:"en",name:"English",flag:""},{code:"zh",name:"",flag:""},{code:"pt",name:"Portugus",flag:""}],uCe=()=>{const{i18n:e}=ci(),{user:t}=Kn(),r=oCe(),n=WD.find(o=>o.code===e.language)||WD[0],s=o=>{e.changeLanguage(o),t&&r.mutate(o)};return d.jsxs(lw,{children:[d.jsx(cw,{asChild:!0,children:d.jsx(Mt,{variant:"ghost",size:"icon",title:"Change Language",children:d.jsx(fv,{className:"w-5 h-5"})})}),d.jsx(Jv,{align:"end",children:WD.map(o=>d.jsxs(Ta,{onClick:()=>s(o.code),className:`cursor-pointer ${n.code===o.code?"bg-accent":""}`,children:[d.jsx("span",{className:"mr-2",children:o.flag}),d.jsx("span",{children:o.name})]},o.code))})]})},_c=()=>{const{user:e}=Kn(),{data:t,isLoading:r}=ei({queryKey:["user-roles",e==null?void 0:e.id],queryFn:async()=>{if(!e)return"user";const{data:i,error:m}=await Ct.from("user_roles").select("role").eq("user_id",e.id).single();if(m)throw m;return i.role},enabled:!!e});return{role:t??"user",hasRole:i=>t===i,isAdmin:t==="admin",isSupervisor:t==="supervisor",isMerchant:t==="merchant",isLoading:r}},dCe=Wv("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function sn({className:e,variant:t,...r}){return d.jsx("div",{className:fr(dCe({variant:t}),e),...r})}function vT(e,[t,r]){return Math.min(r,Math.max(t,e))}function hCe(e,t){return V.useReducer((r,n)=>t[r][n]??r,e)}var _5="ScrollArea",[Yne,lst]=Mo(_5),[fCe,rd]=Yne(_5),Jne=V.forwardRef((e,t)=>{const{__scopeScrollArea:r,type:n="hover",dir:s,scrollHideDelay:o=600,...h}=e,[i,m]=V.useState(null),[y,S]=V.useState(null),[b,T]=V.useState(null),[A,O]=V.useState(null),[P,I]=V.useState(null),[R,M]=V.useState(0),[F,z]=V.useState(0),[$,W]=V.useState(!1),[K,ee]=V.useState(!1),ne=Un(t,re=>m(re)),ie=Zv(s);return d.jsx(fCe,{scope:r,type:n,dir:ie,scrollHideDelay:o,scrollArea:i,viewport:y,onViewportChange:S,content:b,onContentChange:T,scrollbarX:A,onScrollbarXChange:O,scrollbarXEnabled:$,onScrollbarXEnabledChange:W,scrollbarY:P,onScrollbarYChange:I,scrollbarYEnabled:K,onScrollbarYEnabledChange:ee,onCornerWidthChange:M,onCornerHeightChange:z,children:d.jsx(ln.div,{dir:ie,...h,ref:ne,style:{position:"relative","--radix-scroll-area-corner-width":R+"px","--radix-scroll-area-corner-height":F+"px",...e.style}})})});Jne.displayName=_5;var Qne="ScrollAreaViewport",eie=V.forwardRef((e,t)=>{const{__scopeScrollArea:r,children:n,nonce:s,...o}=e,h=rd(Qne,r),i=V.useRef(null),m=Un(t,i,h.onViewportChange);return d.jsxs(d.Fragment,{children:[d.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),d.jsx(ln.div,{"data-radix-scroll-area-viewport":"",...o,ref:m,style:{overflowX:h.scrollbarXEnabled?"scroll":"hidden",overflowY:h.scrollbarYEnabled?"scroll":"hidden",...e.style},children:d.jsx("div",{ref:h.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});eie.displayName=Qne;var ef="ScrollAreaScrollbar",x5=V.forwardRef((e,t)=>{const{forceMount:r,...n}=e,s=rd(ef,e.__scopeScrollArea),{onScrollbarXEnabledChange:o,onScrollbarYEnabledChange:h}=s,i=e.orientation==="horizontal";return V.useEffect(()=>(i?o(!0):h(!0),()=>{i?o(!1):h(!1)}),[i,o,h]),s.type==="hover"?d.jsx(pCe,{...n,ref:t,forceMount:r}):s.type==="scroll"?d.jsx(mCe,{...n,ref:t,forceMount:r}):s.type==="auto"?d.jsx(tie,{...n,ref:t,forceMount:r}):s.type==="always"?d.jsx(b5,{...n,ref:t}):null});x5.displayName=ef;var pCe=V.forwardRef((e,t)=>{const{forceMount:r,...n}=e,s=rd(ef,e.__scopeScrollArea),[o,h]=V.useState(!1);return V.useEffect(()=>{const i=s.scrollArea;let m=0;if(i){const y=()=>{window.clearTimeout(m),h(!0)},S=()=>{m=window.setTimeout(()=>h(!1),s.scrollHideDelay)};return i.addEventListener("pointerenter",y),i.addEventListener("pointerleave",S),()=>{window.clearTimeout(m),i.removeEventListener("pointerenter",y),i.removeEventListener("pointerleave",S)}}},[s.scrollArea,s.scrollHideDelay]),d.jsx(Do,{present:r||o,children:d.jsx(tie,{"data-state":o?"visible":"hidden",...n,ref:t})})}),mCe=V.forwardRef((e,t)=>{const{forceMount:r,...n}=e,s=rd(ef,e.__scopeScrollArea),o=e.orientation==="horizontal",h=PN(()=>m("SCROLL_END"),100),[i,m]=hCe("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return V.useEffect(()=>{if(i==="idle"){const y=window.setTimeout(()=>m("HIDE"),s.scrollHideDelay);return()=>window.clearTimeout(y)}},[i,s.scrollHideDelay,m]),V.useEffect(()=>{const y=s.viewport,S=o?"scrollLeft":"scrollTop";if(y){let b=y[S];const T=()=>{const A=y[S];b!==A&&(m("SCROLL"),h()),b=A};return y.addEventListener("scroll",T),()=>y.removeEventListener("scroll",T)}},[s.viewport,o,m,h]),d.jsx(Do,{present:r||i!=="hidden",children:d.jsx(b5,{"data-state":i==="hidden"?"hidden":"visible",...n,ref:t,onPointerEnter:Ir(e.onPointerEnter,()=>m("POINTER_ENTER")),onPointerLeave:Ir(e.onPointerLeave,()=>m("POINTER_LEAVE"))})})}),tie=V.forwardRef((e,t)=>{const r=rd(ef,e.__scopeScrollArea),{forceMount:n,...s}=e,[o,h]=V.useState(!1),i=e.orientation==="horizontal",m=PN(()=>{if(r.viewport){const y=r.viewport.offsetWidth<r.viewport.scrollWidth,S=r.viewport.offsetHeight<r.viewport.scrollHeight;h(i?y:S)}},10);return db(r.viewport,m),db(r.content,m),d.jsx(Do,{present:n||o,children:d.jsx(b5,{"data-state":o?"visible":"hidden",...s,ref:t})})}),b5=V.forwardRef((e,t)=>{const{orientation:r="vertical",...n}=e,s=rd(ef,e.__scopeScrollArea),o=V.useRef(null),h=V.useRef(0),[i,m]=V.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),y=aie(i.viewport,i.content),S={...n,sizes:i,onSizesChange:m,hasThumb:y>0&&y<1,onThumbChange:T=>o.current=T,onThumbPointerUp:()=>h.current=0,onThumbPointerDown:T=>h.current=T};function b(T,A){return bCe(T,h.current,i,A)}return r==="horizontal"?d.jsx(gCe,{...S,ref:t,onThumbPositionChange:()=>{if(s.viewport&&o.current){const T=s.viewport.scrollLeft,A=dG(T,i,s.dir);o.current.style.transform=`translate3d(${A}px, 0, 0)`}},onWheelScroll:T=>{s.viewport&&(s.viewport.scrollLeft=T)},onDragScroll:T=>{s.viewport&&(s.viewport.scrollLeft=b(T,s.dir))}}):r==="vertical"?d.jsx(yCe,{...S,ref:t,onThumbPositionChange:()=>{if(s.viewport&&o.current){const T=s.viewport.scrollTop,A=dG(T,i);o.current.style.transform=`translate3d(0, ${A}px, 0)`}},onWheelScroll:T=>{s.viewport&&(s.viewport.scrollTop=T)},onDragScroll:T=>{s.viewport&&(s.viewport.scrollTop=b(T))}}):null}),gCe=V.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...s}=e,o=rd(ef,e.__scopeScrollArea),[h,i]=V.useState(),m=V.useRef(null),y=Un(t,m,o.onScrollbarXChange);return V.useEffect(()=>{m.current&&i(getComputedStyle(m.current))},[m]),d.jsx(nie,{"data-orientation":"horizontal",...s,ref:y,sizes:r,style:{bottom:0,left:o.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:o.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":jN(r)+"px",...e.style},onThumbPointerDown:S=>e.onThumbPointerDown(S.x),onDragScroll:S=>e.onDragScroll(S.x),onWheelScroll:(S,b)=>{if(o.viewport){const T=o.viewport.scrollLeft+S.deltaX;e.onWheelScroll(T),lie(T,b)&&S.preventDefault()}},onResize:()=>{m.current&&o.viewport&&h&&n({content:o.viewport.scrollWidth,viewport:o.viewport.offsetWidth,scrollbar:{size:m.current.clientWidth,paddingStart:mO(h.paddingLeft),paddingEnd:mO(h.paddingRight)}})}})}),yCe=V.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...s}=e,o=rd(ef,e.__scopeScrollArea),[h,i]=V.useState(),m=V.useRef(null),y=Un(t,m,o.onScrollbarYChange);return V.useEffect(()=>{m.current&&i(getComputedStyle(m.current))},[m]),d.jsx(nie,{"data-orientation":"vertical",...s,ref:y,sizes:r,style:{top:0,right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":jN(r)+"px",...e.style},onThumbPointerDown:S=>e.onThumbPointerDown(S.y),onDragScroll:S=>e.onDragScroll(S.y),onWheelScroll:(S,b)=>{if(o.viewport){const T=o.viewport.scrollTop+S.deltaY;e.onWheelScroll(T),lie(T,b)&&S.preventDefault()}},onResize:()=>{m.current&&o.viewport&&h&&n({content:o.viewport.scrollHeight,viewport:o.viewport.offsetHeight,scrollbar:{size:m.current.clientHeight,paddingStart:mO(h.paddingTop),paddingEnd:mO(h.paddingBottom)}})}})}),[vCe,rie]=Yne(ef),nie=V.forwardRef((e,t)=>{const{__scopeScrollArea:r,sizes:n,hasThumb:s,onThumbChange:o,onThumbPointerUp:h,onThumbPointerDown:i,onThumbPositionChange:m,onDragScroll:y,onWheelScroll:S,onResize:b,...T}=e,A=rd(ef,r),[O,P]=V.useState(null),I=Un(t,ne=>P(ne)),R=V.useRef(null),M=V.useRef(""),F=A.viewport,z=n.content-n.viewport,$=no(S),W=no(m),K=PN(b,10);function ee(ne){if(R.current){const ie=ne.clientX-R.current.left,re=ne.clientY-R.current.top;y({x:ie,y:re})}}return V.useEffect(()=>{const ne=ie=>{const re=ie.target;(O==null?void 0:O.contains(re))&&$(ie,z)};return document.addEventListener("wheel",ne,{passive:!1}),()=>document.removeEventListener("wheel",ne,{passive:!1})},[F,O,z,$]),V.useEffect(W,[n,W]),db(O,K),db(A.content,K),d.jsx(vCe,{scope:r,scrollbar:O,hasThumb:s,onThumbChange:no(o),onThumbPointerUp:no(h),onThumbPositionChange:W,onThumbPointerDown:no(i),children:d.jsx(ln.div,{...T,ref:I,style:{position:"absolute",...T.style},onPointerDown:Ir(e.onPointerDown,ne=>{ne.button===0&&(ne.target.setPointerCapture(ne.pointerId),R.current=O.getBoundingClientRect(),M.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",A.viewport&&(A.viewport.style.scrollBehavior="auto"),ee(ne))}),onPointerMove:Ir(e.onPointerMove,ee),onPointerUp:Ir(e.onPointerUp,ne=>{const ie=ne.target;ie.hasPointerCapture(ne.pointerId)&&ie.releasePointerCapture(ne.pointerId),document.body.style.webkitUserSelect=M.current,A.viewport&&(A.viewport.style.scrollBehavior=""),R.current=null})})})}),pO="ScrollAreaThumb",iie=V.forwardRef((e,t)=>{const{forceMount:r,...n}=e,s=rie(pO,e.__scopeScrollArea);return d.jsx(Do,{present:r||s.hasThumb,children:d.jsx(_Ce,{ref:t,...n})})}),_Ce=V.forwardRef((e,t)=>{const{__scopeScrollArea:r,style:n,...s}=e,o=rd(pO,r),h=rie(pO,r),{onThumbPositionChange:i}=h,m=Un(t,b=>h.onThumbChange(b)),y=V.useRef(void 0),S=PN(()=>{y.current&&(y.current(),y.current=void 0)},100);return V.useEffect(()=>{const b=o.viewport;if(b){const T=()=>{if(S(),!y.current){const A=wCe(b,i);y.current=A,i()}};return i(),b.addEventListener("scroll",T),()=>b.removeEventListener("scroll",T)}},[o.viewport,S,i]),d.jsx(ln.div,{"data-state":h.hasThumb?"visible":"hidden",...s,ref:m,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:Ir(e.onPointerDownCapture,b=>{const A=b.target.getBoundingClientRect(),O=b.clientX-A.left,P=b.clientY-A.top;h.onThumbPointerDown({x:O,y:P})}),onPointerUp:Ir(e.onPointerUp,h.onThumbPointerUp)})});iie.displayName=pO;var w5="ScrollAreaCorner",sie=V.forwardRef((e,t)=>{const r=rd(w5,e.__scopeScrollArea),n=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&n?d.jsx(xCe,{...e,ref:t}):null});sie.displayName=w5;var xCe=V.forwardRef((e,t)=>{const{__scopeScrollArea:r,...n}=e,s=rd(w5,r),[o,h]=V.useState(0),[i,m]=V.useState(0),y=!!(o&&i);return db(s.scrollbarX,()=>{var b;const S=((b=s.scrollbarX)==null?void 0:b.offsetHeight)||0;s.onCornerHeightChange(S),m(S)}),db(s.scrollbarY,()=>{var b;const S=((b=s.scrollbarY)==null?void 0:b.offsetWidth)||0;s.onCornerWidthChange(S),h(S)}),y?d.jsx(ln.div,{...n,ref:t,style:{width:o,height:i,position:"absolute",right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function mO(e){return e?parseInt(e,10):0}function aie(e,t){const r=e/t;return isNaN(r)?0:r}function jN(e){const t=aie(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,n=(e.scrollbar.size-r)*t;return Math.max(n,18)}function bCe(e,t,r,n="ltr"){const s=jN(r),o=s/2,h=t||o,i=s-h,m=r.scrollbar.paddingStart+h,y=r.scrollbar.size-r.scrollbar.paddingEnd-i,S=r.content-r.viewport,b=n==="ltr"?[0,S]:[S*-1,0];return oie([m,y],b)(e)}function dG(e,t,r="ltr"){const n=jN(t),s=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,o=t.scrollbar.size-s,h=t.content-t.viewport,i=o-n,m=r==="ltr"?[0,h]:[h*-1,0],y=vT(e,m);return oie([0,h],[0,i])(y)}function oie(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const n=(t[1]-t[0])/(e[1]-e[0]);return t[0]+n*(r-e[0])}}function lie(e,t){return e>0&&e<t}var wCe=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},n=0;return function s(){const o={left:e.scrollLeft,top:e.scrollTop},h=r.left!==o.left,i=r.top!==o.top;(h||i)&&t(),r=o,n=window.requestAnimationFrame(s)}(),()=>window.cancelAnimationFrame(n)};function PN(e,t){const r=no(e),n=V.useRef(0);return V.useEffect(()=>()=>window.clearTimeout(n.current),[]),V.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(r,t)},[r,t])}function db(e,t){const r=no(t);io(()=>{let n=0;if(e){const s=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(r)});return s.observe(e),()=>{window.cancelAnimationFrame(n),s.unobserve(e)}}},[e,r])}var cie=Jne,SCe=eie,ECe=sie;const jv=V.forwardRef(({className:e,children:t,...r},n)=>d.jsxs(cie,{ref:n,className:fr("relative overflow-hidden",e),...r,children:[d.jsx(SCe,{className:"h-full w-full rounded-[inherit]",children:t}),d.jsx(uie,{}),d.jsx(ECe,{})]}));jv.displayName=cie.displayName;const uie=V.forwardRef(({className:e,orientation:t="vertical",...r},n)=>d.jsx(x5,{ref:n,orientation:t,className:fr("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...r,children:d.jsx(iie,{className:"relative flex-1 rounded-full bg-border"})}));uie.displayName=x5.displayName;const{slice:TCe,forEach:ACe}=[];function CCe(e){return ACe.call(TCe.call(arguments,1),t=>{if(t)for(const r in t)e[r]===void 0&&(e[r]=t[r])}),e}function jCe(e){return typeof e!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(r=>r.test(e))}const hG=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,PCe=function(e,t){const n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},s=encodeURIComponent(t);let o=`${e}=${s}`;if(n.maxAge>0){const h=n.maxAge-0;if(Number.isNaN(h))throw new Error("maxAge should be a Number");o+=`; Max-Age=${Math.floor(h)}`}if(n.domain){if(!hG.test(n.domain))throw new TypeError("option domain is invalid");o+=`; Domain=${n.domain}`}if(n.path){if(!hG.test(n.path))throw new TypeError("option path is invalid");o+=`; Path=${n.path}`}if(n.expires){if(typeof n.expires.toUTCString!="function")throw new TypeError("option expires is invalid");o+=`; Expires=${n.expires.toUTCString()}`}if(n.httpOnly&&(o+="; HttpOnly"),n.secure&&(o+="; Secure"),n.sameSite)switch(typeof n.sameSite=="string"?n.sameSite.toLowerCase():n.sameSite){case!0:o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"strict":o+="; SameSite=Strict";break;case"none":o+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return n.partitioned&&(o+="; Partitioned"),o},fG={create(e,t,r,n){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};r&&(s.expires=new Date,s.expires.setTime(s.expires.getTime()+r*60*1e3)),n&&(s.domain=n),document.cookie=PCe(e,t,s)},read(e){const t=`${e}=`,r=document.cookie.split(";");for(let n=0;n<r.length;n++){let s=r[n];for(;s.charAt(0)===" ";)s=s.substring(1,s.length);if(s.indexOf(t)===0)return s.substring(t.length,s.length)}return null},remove(e,t){this.create(e,"",-1,t)}};var OCe={name:"cookie",lookup(e){let{lookupCookie:t}=e;if(t&&typeof document<"u")return fG.read(t)||void 0},cacheUserLanguage(e,t){let{lookupCookie:r,cookieMinutes:n,cookieDomain:s,cookieOptions:o}=t;r&&typeof document<"u"&&fG.create(r,e,n,s,o)}},kCe={name:"querystring",lookup(e){var n;let{lookupQuerystring:t}=e,r;if(typeof window<"u"){let{search:s}=window.location;!window.location.search&&((n=window.location.hash)==null?void 0:n.indexOf("?"))>-1&&(s=window.location.hash.substring(window.location.hash.indexOf("?")));const h=s.substring(1).split("&");for(let i=0;i<h.length;i++){const m=h[i].indexOf("=");m>0&&h[i].substring(0,m)===t&&(r=h[i].substring(m+1))}}return r}},NCe={name:"hash",lookup(e){var s;let{lookupHash:t,lookupFromHashIndex:r}=e,n;if(typeof window<"u"){const{hash:o}=window.location;if(o&&o.length>2){const h=o.substring(1);if(t){const i=h.split("&");for(let m=0;m<i.length;m++){const y=i[m].indexOf("=");y>0&&i[m].substring(0,y)===t&&(n=i[m].substring(y+1))}}if(n)return n;if(!n&&r>-1){const i=o.match(/\/([a-zA-Z-]*)/g);return Array.isArray(i)?(s=i[typeof r=="number"?r:0])==null?void 0:s.replace("/",""):void 0}}}return n}};let zx=null;const pG=()=>{if(zx!==null)return zx;try{if(zx=typeof window<"u"&&window.localStorage!==null,!zx)return!1;const e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch{zx=!1}return zx};var ICe={name:"localStorage",lookup(e){let{lookupLocalStorage:t}=e;if(t&&pG())return window.localStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupLocalStorage:r}=t;r&&pG()&&window.localStorage.setItem(r,e)}};let Bx=null;const mG=()=>{if(Bx!==null)return Bx;try{if(Bx=typeof window<"u"&&window.sessionStorage!==null,!Bx)return!1;const e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch{Bx=!1}return Bx};var RCe={name:"sessionStorage",lookup(e){let{lookupSessionStorage:t}=e;if(t&&mG())return window.sessionStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupSessionStorage:r}=t;r&&mG()&&window.sessionStorage.setItem(r,e)}},MCe={name:"navigator",lookup(e){const t=[];if(typeof navigator<"u"){const{languages:r,userLanguage:n,language:s}=navigator;if(r)for(let o=0;o<r.length;o++)t.push(r[o]);n&&t.push(n),s&&t.push(s)}return t.length>0?t:void 0}},DCe={name:"htmlTag",lookup(e){let{htmlTag:t}=e,r;const n=t||(typeof document<"u"?document.documentElement:null);return n&&typeof n.getAttribute=="function"&&(r=n.getAttribute("lang")),r}},LCe={name:"path",lookup(e){var s;let{lookupFromPathIndex:t}=e;if(typeof window>"u")return;const r=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(r)?(s=r[typeof t=="number"?t:0])==null?void 0:s.replace("/",""):void 0}},FCe={name:"subdomain",lookup(e){var s,o;let{lookupFromSubdomainIndex:t}=e;const r=typeof t=="number"?t+1:1,n=typeof window<"u"&&((o=(s=window.location)==null?void 0:s.hostname)==null?void 0:o.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(n)return n[r]}};let die=!1;try{document.cookie,die=!0}catch{}const hie=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];die||hie.splice(1,1);const zCe=()=>({order:hie,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:e=>e});class fie{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(t,r)}init(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=t,this.options=CCe(r,this.options||{},zCe()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=s=>s.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=n,this.addDetector(OCe),this.addDetector(kCe),this.addDetector(ICe),this.addDetector(RCe),this.addDetector(MCe),this.addDetector(DCe),this.addDetector(LCe),this.addDetector(FCe),this.addDetector(NCe)}addDetector(t){return this.detectors[t.name]=t,this}detect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,r=[];return t.forEach(n=>{if(this.detectors[n]){let s=this.detectors[n].lookup(this.options);s&&typeof s=="string"&&(s=[s]),s&&(r=r.concat(s))}}),r=r.filter(n=>n!=null&&!jCe(n)).map(n=>this.options.convertDetectedLanguage(n)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?r:r.length>0?r[0]:null}cacheUserLanguage(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;r&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(t)>-1||r.forEach(n=>{this.detectors[n]&&this.detectors[n].cacheUserLanguage(t,this.options)}))}}fie.type="languageDetector";const BCe={en:{translation:{"nav.brandName":"Xiaoxiong Market","nav.map":"Home","nav.mapView":"Private Map","nav.restaurants":"Restaurants","nav.activities":"Activities","nav.profile":"Profile","nav.signIn":"Sign In","nav.signOut":"Sign Out","nav.myAccount":"My Account","nav.admin":"Admin Panel","nav.manageRestaurants":"Manage Restaurants","nav.joinUs":"Restaurant Join","map.subtitle":"Explore nearby featured restaurants","home.hero.brandName":"Xiaoxiong Market","home.hero.title":"Discover Nearby Cuisine","home.hero.subtitle":"Your Culinary Journey Starts Here","home.hero.description":"Explore curated restaurants across cities, join exciting food events, and connect with fellow food lovers;","home.hero.exploreBtn":"Explore Restaurants","home.hero.activitiesBtn":"View Activities","home.features.title":"Why Choose Us?","home.features.description":"Discover Cuisine; Share Experiences; Join Activities;","home.features.map.title":"Smart Map","home.features.map.desc":"Find nearby restaurants with our intelligent location-based search and interactive map view;","home.features.reviews.title":"Trusted Reviews","home.features.reviews.desc":"Read authentic reviews and ratings from verified diners to make informed decisions;","home.features.events.title":"Exclusive Events","home.features.events.desc":"Join special dining events, food festivals, and connect with the culinary community;","home.cta.title":"Ready to Start?","home.cta.description":"Join Xiaoxiong Market and reach thousands of food lovers. Grow your business with us;","home.cta.button":"Restaurant Join","home.stats.delivery":"Take Away","home.stats.reservation":"Reservation","restaurants.title":"Restaurants","restaurants.search":"Search name, address, postal code...","restaurants.noResults":"No restaurants found","restaurants.noResultsDesc":"Try adjusting your search or filters","restaurants.viewDetails":"View Details","restaurants.addToFavorite":"Add to favorites","restaurants.removeFromFavorite":"Remove from favorites","restaurants.mustSignIn":"Please sign in to favorite restaurants","restaurants.listView":"List View","restaurants.mapView":"Map View","restaurants.sortByDistance":"Sort by Distance","restaurants.sortedByDistance":"Sorted by distance","restaurants.radius":"Radius","restaurants.radius1km":"1 km","restaurants.radius3km":"3 km","restaurants.radius5km":"5 km","restaurants.radius10km":"10 km","restaurants.radius20km":"20 km","restaurants.allRestaurants":"All Restaurants","restaurants.getLocation":"Get My Location","restaurants.locationEnabled":"Location Enabled","restaurants.directions":"Get Directions","restaurants.distanceAway":"{{distance}} km away","restaurants.restaurantTypes":"Restaurant Types","restaurants.filter":"Filter","restaurant.address":"Address","restaurant.phone":"Phone","restaurant.hours":"Hours","restaurant.today":"Today","restaurant.closed":"Closed","restaurant.dayMon":"Mon","restaurant.dayTue":"Tue","restaurant.dayWed":"Wed","restaurant.dayThu":"Thu","restaurant.dayFri":"Fri","restaurant.daySat":"Sat","restaurant.daySun":"Sun","restaurant.website":"Website","restaurant.visitWebsite":"Visit Website","restaurant.getDirections":"Get Directions","restaurant.callNow":"Call Now","restaurant.joinPrivate":"Join Private Domain","restaurant.reviews":"Reviews","restaurant.addReview":"Add Review","restaurant.rating":"Rating","restaurant.edited":"Edited","restaurant.reply":"Reply","restaurant.writeComment":"Write a comment...","restaurant.writeReply":"Write a reply...","restaurant.postComment":"Post Comment","restaurant.signInToComment":"Please sign in to comment","restaurant.signInToRate":"Please sign in to rate this restaurant","restaurant.noComments":"No comments yet. Be the first to share your experience!","restaurant.confirmDelete":"Are you sure you want to delete this comment?","restaurant.ratingsCount":"ratings","restaurant.yourRating":"Your rating","restaurant.rateThisRestaurant":"Rate this restaurant","restaurant.photoGallery":"Photo Gallery","restaurant.addImage":"Add Image","restaurant.imageUploadFailed":"Failed to upload image","restaurant.imageTooLarge":"Image size must be less than 5MB","restaurant.priceRange":"Price Range (Optional)","restaurant.selectPriceRange":"Select price range...","activities.title":"Activities","activities.description":"Join exclusive dining experiences and culinary events","activities.viewDetails":"View Details","activities.joinEvent":"Join Event","activities.joined":"Joined","activities.subscribe":"Subscribe","activities.subscribed":"Subscribed","activities.subscribers":"subscribers","activities.subscribersCount":"subscribers","activities.participants":"participants","activities.restaurantsParticipating":"restaurants participating","activities.until":"Until","activities.shareSuccess":"Activity shared successfully","activities.linkCopied":"Link copied to clipboard","activities.shareError":"Failed to share activity","activities.pinned":"Pinned","activities.ended":"Ended","activities.ongoing":"Ongoing","activities.signInToJoin":"Please sign in to join this activity","activities.signInToJoinHint":"Stay updated with the latest activity notifications","activities.signInToSubscribe":"Please sign in","activities.signInToSubscribeDesc":"You need to sign in to subscribe to activities","activities.about":"About This Activity","activities.participatingRestaurants":"Participating Restaurants","activities.repeat.none":"One-time","activities.repeat.daily":"Daily","activities.repeat.weekly":"Weekly","activities.repeat.monthly":"Monthly","activities.repeat.yearly":"Yearly","activities.serviceType.dine_in":"Dine-in","activities.serviceType.takeaway":"Takeaway","activities.serviceType.both":"Dine-in & Takeaway","activities.creatorLabel":"Creator:","activities.createdByPlatform":"Platform","activities.rules":"Activity Rules","activities.rulesTitle":"Activity Rules","activities.usageInstructions":"How to Use","activities.noActivities":"No activities available","profile.title":"My Profile","profile.settings":"Settings","profile.profile":"Profile","profile.favorites":"Favorites","profile.reviews":"Reviews","profile.comments":"Comments","profile.activities":"Activities","profile.favoriteRestaurants":"My Favorite Restaurants","profile.favoritesDesc":"Restaurants you've bookmarked for future visits","profile.myReviews":"My Reviews","profile.myComments":"My Comments","profile.reviewsDesc":"Your ratings and reviews for restaurants","profile.commentsDesc":"Comments you've posted on restaurants and activities","profile.joinedActivities":"Joined Activities","profile.activitiesDesc":"Events and activities you're participating in","profile.noActivities":"No activities joined yet. Check out our","profile.noFavorites":"No favorite restaurants yet","profile.noComments":"No comments yet","profile.upcomingEvents":"upcoming events","profile.participatedActivities":"Participated Activities","profile.participatedActivitiesDesc":"View all activities your restaurants participated in","profile.personalActivities":"Personal Activities","profile.restaurantActivities":"Restaurant Activities","profile.participatingRestaurants":"Participating Restaurants","profile.coupons.title":"My Coupons","profile.coupons.description":"View and manage your coupons","profile.coupons.available":"Available","profile.coupons.used":"Used","profile.coupons.usedOn":"Used on","profile.coupons.validUntil":"Valid until","profile.coupons.noExpiry":"No expiry date","profile.coupons.noCoupons":"No coupons yet","profile.coupons.browseActivities":"Browse activities to get coupons","profile.noParticipatedActivities":"You haven't participated in any activities yet.","profile.browseActivities":"Browse activities","profile.editProfile":"Edit Profile","profile.editProfileDescription":"Update your profile information","profile.displayName":"Display Name","profile.phone":"Phone","profile.phonePlaceholder":"Enter phone number","profile.addPhoneNumber":"Add phone number","profile.modifyPhoneNumber":"Modify","profile.uploadAvatar":"Upload Avatar","profile.joinedOn":"Joined on","profile.deleteAccount":"Delete Account","profile.deleteAccountWarning":"Warning: This action is permanent","profile.deleteAccountDescription":"Deleting your account will permanently remove all your data, including your profile, favorites, comments, and activity subscriptions. This action cannot be undone.","profile.confirmDeleteAccount":"Final Confirmation Required","profile.confirmDeleteDescription":"This is your last chance. All your data will be permanently deleted and cannot be recovered.","profile.typeDeleteToConfirm":"Type DELETE to confirm","profile.deleteAccountSuccess":"Account deleted successfully","profile.deleteAccountFailed":"Failed to delete account","profile.activityTermsTitle":"Activity Terms Agreement","profile.activityTermsDescription":"Merchants and supervisors must agree to activity terms before participating","profile.activityTermsAgreedStatus":"Agreed","profile.activityTermsNotAgreed":"Not Agreed","profile.viewFullRules":"View Full Rules","profile.agreeToTerms":"I agree to the activity terms","profile.agreedOn":"Agreed","profile.activityTermsAgreed":"Activity terms accepted","profile.activityTermsRevoked":"Activity terms revoked","profile.activityTermsUpdateFailed":"Failed to update activity terms agreement","profile.changeEmail":"Change Email","profile.verifyOldEmail":"Verify Current Email","profile.verifyNewEmail":"Enter New Email","profile.confirmEmailUpdate":"Confirm Email Update","profile.oldEmailStep":"Step 1/3: We need to verify your current email","profile.newEmailStep":"Step 2/3: Enter your new email address","profile.confirmEmailStep":"Step 3/3: Confirm your email update","profile.currentEmail":"Current Email","profile.newEmail":"New Email","profile.verificationCode":"Verification Code","profile.sendCode":"Send Code","profile.codeSent":"Sent","profile.enterCode":"Enter 4-digit code","profile.verify":"Verify","profile.updateEmail":"Update Email","profile.codeSentToOldEmail":"Verification code sent to your old email","profile.codeSentToNewEmail":"Verification code sent to your new email","profile.sendCodeFailed":"Failed to send verification code","profile.enterCodePlaceholder":"Please enter verification code","profile.codeIncorrect":"Verification code is incorrect or expired","profile.verificationFailed":"Verification failed","profile.oldEmailVerified":"Old email verified successfully","profile.newEmailVerified":"New email verified successfully","profile.enterValidEmail":"Please enter a valid email address","profile.pleaseSignIn":"Please sign in first","profile.emailUpdated":"Email updated successfully, please sign in with your new email","profile.emailUpdateFailed":"Failed to update email","profile.enterNewEmail":"Enter your new email address","profile.role.user":"User","profile.role.merchant":"Merchant","profile.role.supervisor":"Supervisor","profile.role.admin":"Admin","profile.changePassword":"Change Password","profile.changePasswordDescription":"Update your account password","profile.verifyOldPassword":"Verify Current Password","profile.oldPasswordStep":"Step 1/2: Verify your identity","profile.currentPassword":"Current Password","profile.enterCurrentPassword":"Enter current password","profile.forgotPassword":"Forgot password?","profile.useEmailVerification":"Use email verification instead","profile.oldPasswordVerified":"Password verified successfully","profile.oldPasswordIncorrect":"Current password is incorrect","profile.setNewPassword":"Set New Password","profile.newPasswordStep":"Step 2/2: Enter your new password","profile.newPassword":"New Password","profile.confirmNewPassword":"Confirm New Password","profile.enterNewPassword":"Enter new password (min 6 characters)","profile.confirmNewPasswordPlaceholder":"Enter new password again","profile.passwordsDontMatch":"Passwords don't match","profile.passwordTooShort":"Password must be at least 6 characters","profile.passwordUpdated":"Password updated successfully","profile.passwordUpdateFailed":"Failed to update password","profile.updatePassword":"Update Password","report.title":"Report","report.reportComment":"Report Comment","report.reportRestaurant":"Report Restaurant","report.reportActivity":"Report Activity","report.reportUser":"Report User","report.description":"Help us maintain a safe community","report.reason":"Reason for Report","report.reasonPlaceholder":"Select a reason","report.reasons":{spam:"Spam or Advertising",harassment:"Harassment or Bullying",inappropriate_content:"Inappropriate Content",misinformation:"Misinformation",copyright:"Copyright Violation",fraud:"Fraud or Scam",hate_speech:"Hate Speech",violence:"Violence or Threats",other:"Other"},"report.detailsLabel":"Details","report.detailsPlaceholder":"Please provide detailed information about this report (required, minimum 20 characters)","report.detailsMin":"Details must be at least 20 characters","report.contactLabel":"Contact Email","report.contactPlaceholder":"Your email for follow-up","report.contactRequired":"Contact email is required","report.invalidEmail":"Please enter a valid email address","report.evidenceLabel":"Evidence URLs","report.evidenceRequired":"At least one evidence (image or URL) is required","report.evidenceRequiredNote":"Please upload at least one image or provide a link","report.uploadImages":"Upload Images","report.evidenceUrls":"Or Provide URLs","report.imageUploadHint":"Supported formats: JPG, PNG, WEBP, GIF. Max 5MB per image","report.imageTooLarge":"Image size must be less than 5MB","report.invalidImageType":"Only JPG, PNG, WEBP, and GIF formats are supported","report.imageUploadFailed":"Failed to upload images. Please try again","report.evidencePlaceholder":"Add screenshot or evidence URL","report.addEvidence":"Add Evidence","report.removeEvidence":"Remove","report.submit":"Submit Report","report.submitting":"Submitting...","report.success":"Report submitted successfully. We will review it soon.","report.successDetailed":"Report submitted successfully! Reference: {{reference}}","report.successDescription":"We will review your report within 24-48 hours. You will receive an email notification at the contact address you provided once the review is complete. Thank you for helping us maintain a safe community!","report.failed":"Failed to submit report","report.cancel":"Cancel","report.confirmTitle":"Confirm Report Submission","report.confirmMessage":"Are you sure you want to submit this report? False reports may result in account restrictions.","admin.reports":"Reports","admin.reportsDescription":"Manage user reports","admin.totalReports":"Total Reports","admin.allReportsCount":"All submitted reports","admin.awaitingReview":"Awaiting review","admin.underReview":"Under review","admin.resolvedReports":"Resolved reports","admin.dismissedReports":"Dismissed reports","admin.allReports":"All Reports","admin.manageReportsDesc":"View and manage all user reports","admin.searchReports":"Search reports by description, reporter, or reason...","admin.noReports":"No reports yet","admin.reportStatus":{pending:"Pending",reviewing:"Reviewing",resolved:"Resolved",dismissed:"Dismissed"},"admin.reportType":{comment:"Comment",restaurant:"Restaurant",activity:"Activity",user:"User"},"admin.reportedBy":"Reported By","admin.reportedAt":"Reported At","admin.viewReport":"View Report","admin.updateStatus":"Update Status","admin.adminNotes":"Admin Notes","admin.saveNotes":"Save Notes","auth.welcome":"Welcome to Xiaoxiong Market","auth.subtitle":"Discover amazing restaurants and join exciting dining events","auth.login":"Login","auth.register":"Email Register","auth.phone":"Phone","auth.email":"Email","auth.password":"Password","auth.displayName":"Display Name","auth.phoneOptional":"Phone (Optional)","auth.phoneNumber":"Phone Number","auth.phoneMin":"Please enter a valid phone number","auth.phoneHint":"Enter your phone number with country code (e.g., +351 912 345 678)","auth.confirmPassword":"Confirm Password","auth.signIn":"Sign In","auth.signingIn":"Signing in...","auth.sendCode":"Send Code","auth.sendingCode":"Sending...","auth.verificationCode":"Verification Code","auth.verify":"Verify","auth.verifying":"Verifying...","auth.otpLength":"Code must be 6 digits","auth.otpSent":"Verification code sent to your phone","auth.otpHint":"Enter the 6-digit code sent to {{phone}}","auth.createAccount":"Create Account","auth.creatingAccount":"Creating account...","auth.orContinueWith":"Or continue with","auth.google":"Google","auth.backToHome":"Back to home","auth.invalidEmail":"Invalid email address","auth.passwordMin":"Password must be at least 6 characters","auth.passwordPlaceholder":"Minimum 6 characters","auth.passwordStrength":{weak:"Weak password - Add uppercase, numbers, or symbols",medium:"Medium password - Consider adding more variety",strong:"Strong password"},"auth.displayNameMin":"Display name must be at least 2 characters","auth.passwordsDontMatch":"Passwords don't match","auth.invalidCredentials":"Invalid email or password","auth.emailExists":"This email is already registered","auth.signInSuccess":"Successfully signed in!","auth.signUpSuccess":"Account created successfully! You can now sign in.","auth.verificationCodeSent":"Verification code sent to your email","auth.verificationCodeFailed":"Failed to send verification code","auth.invalidVerificationCode":"Invalid verification code","auth.verificationCodeUsed":"This verification code has already been used. Please request a new one.","auth.verificationCodeHint":"Please enter the 4-digit verification code sent to {{email}}","auth.resendCode":"Resend Code","auth.resendIn":"Resend in {{seconds}}s","common.loading":"Loading...","common.error":"Error","common.success":"Success","common.cancel":"Cancel","common.confirm":"Confirm","common.continue":"Continue","common.save":"Save","common.delete":"Delete","common.edit":"Edit","common.submit":"Submit","common.back":"Back","common.next":"Next","common.previous":"Previous","common.search":"Search","common.filter":"Filter","common.sort":"Sort","common.actions":"Actions","common.km":"km","common.uploading":"Uploading...","common.deleting":"Deleting...","common.enterPlaceholder":"Enter...","common.selectPlaceholder":"Select...","common.share":"Share","common.copyLink":"Copy Link","common.linkCopied":"Link copied to clipboard","common.shareError":"Error sharing","common.moreOptions":"More Options","common.shareVia":"Share via","sharing.selectPlatform":"Select Platform","sharing.systemShare":"System Share","sharing.shareToApps":"Share to Apps","sharing.copiedForWeChat":"Link copied! Open WeChat and paste to share","sharing.copiedForInstagram":"Link copied! Open Instagram and paste in your story or bio","common.shareSuccess":"Shared successfully","common.actions.clearFilter":"Clear Filter","common.showMore":"Show More","common.showLess":"Show Less","common.showDetails":"Show Details","common.hideDetails":"Hide Details","common.processing":"Processing...","common.loadMore":"Load More","notifications.title":"Notifications","notifications.markAllRead":"Mark all read","notifications.noNotifications":"No notifications yet","notifications.markAsReadError":"Failed to mark notification as read","notifications.markAllAsReadSuccess":"All notifications marked as read","notifications.markAllAsReadError":"Failed to mark all notifications as read","notifications.userNotAuthenticated":"User not authenticated","admin.management":"Management","admin.dashboard":"Dashboard","admin.users":"Users","admin.restaurants":"Restaurants","admin.activities":"Activities","admin.logs":"Operation Logs","admin.userManagement":"User Management","admin.restaurantManagement":"Restaurant Management","admin.activityManagement":"Activity Management","admin.operationLogs":"Operation Logs","admin.manageUserRoles":"Manage user roles and permissions","admin.manageRestaurants":"View and manage all restaurants","admin.manageActivities":"View and manage all activities","admin.viewSystemLogs":"View all system operation logs","admin.dashboardDescription":"Overview of system statistics","admin.totalUsers":"Total Users","admin.totalRestaurants":"Total Restaurants","admin.totalActivities":"Total Activities","admin.totalComments":"Total Comments","admin.registeredUsers":"Registered users","admin.listedRestaurants":"Listed restaurants","admin.activeEvents":"Active events","admin.userReviews":"User reviews and comments","admin.recentActivity":"Recent Activity","admin.recentActivityDescription":"Latest system activities","admin.viewLogsForDetails":"View operation logs for detailed activity","admin.selectRole":"Select a role","admin.assignRole":"Assign Role","admin.confirmRemoveRole":"Are you sure you want to remove this role?","admin.noPhone":"No phone number","admin.addRestaurant":"Add Restaurant","admin.addActivity":"Add Activity","admin.editActivity":"Edit Activity","admin.activityCreated":"Activity created successfully","admin.activityUpdated":"Activity updated successfully","admin.confirmDelete":"Confirm Deletion","admin.deleteActivityWarning":"This will permanently delete the activity and all associated data. This action cannot be undone.","admin.activityImage":"Activity Image","admin.uploadImage":"Upload Image","admin.titleEnglish":"Title (English)","admin.titleChinese":"Title (Chinese)","admin.titlePortuguese":"Title (Portuguese)","admin.contentEnglish":"Content (English)","admin.contentChinese":"Content (Chinese)","admin.contentPortuguese":"Content (Portuguese)","admin.startDate":"Start Date","admin.endDate":"End Date","admin.pickDate":"Pick a date","admin.repeatMode":"Repeat Mode","admin.selectRepeatMode":"Select repeat mode","admin.serviceType":"Service Type","admin.selectServiceType":"Select service type","admin.repeatNone":"No Repeat","admin.repeatDaily":"Daily","admin.repeatWeekly":"Weekly","admin.repeatMonthly":"Monthly","admin.repeatYearly":"Yearly","admin.associatedRestaurants":"Associated Restaurants","admin.pinned":"Pinned","admin.sortOrder":"Sort Order","admin.editRestaurant":"Edit Restaurant","admin.restaurantCreated":"Restaurant created successfully","admin.restaurantUpdated":"Restaurant updated successfully","admin.deleteRestaurantWarning":"This will permanently delete the restaurant and all associated data. This action cannot be undone.","admin.restaurantImage":"Restaurant Image","admin.nameChinese":"Name (Chinese)","admin.nameEnglish":"Name (English)","admin.namePortuguese":"Name (Portuguese)","admin.typeChinese":"Type (Chinese)","admin.typeEnglish":"Type (English)","admin.typePortuguese":"Type (Portuguese)","admin.restaurantTypes":"Restaurant Types","admin.tags":"tags","admin.addType":"Add Type","admin.descriptionChinese":"Description (Chinese)","admin.descriptionEnglish":"Description (English)","admin.descriptionPortuguese":"Description (Portuguese)","admin.address":"Address","admin.phone":"Phone","admin.website":"Website","admin.showWebsiteButton":"Show Website Button","admin.location":"Location","admin.locationOnMap":"Location on Map","admin.latitude":"Latitude","admin.longitude":"Longitude","admin.clickOrDragToSetLocation":"Click on the map or drag the marker to set the location","admin.mapInstructions":"Click on the map or drag the marker to set the location","admin.openingHours":"Opening Hours","admin.closed":"Closed","admin.day.monday":"Monday","admin.day.tuesday":"Tuesday","admin.day.wednesday":"Wednesday","admin.day.thursday":"Thursday","admin.day.friday":"Friday","admin.day.saturday":"Saturday","admin.day.sunday":"Sunday","admin.userGrowth":"User Growth Trend","admin.userGrowthDescription":"Cumulative user registration over time","admin.activityEngagement":"Activity Engagement","admin.activityEngagementDescription":"Subscribers and comments per activity","admin.topRestaurants":"Top Restaurants","admin.topRestaurantsDescription":"Restaurants ranked by rating and engagement","admin.subscribers":"Subscribers","admin.comments":"Comments","admin.rating":"Rating","admin.noData":"No data available","admin.exportCSV":"Export CSV","admin.exportSuccess":"Data exported successfully","admin.noDataToExport":"No data available to export","admin.batchDelete":"Batch Delete","admin.batchAssignRole":"Batch Assign Role","admin.selectedCount":"{{count}} selected","admin.confirmBatchDelete":"Confirm Batch Delete","admin.batchDeleteWarning":"This will permanently delete {{count}} items. This action cannot be undone.","admin.clearSelection":"Clear Selection","admin.selectAll":"Select All","admin.searchUsers":"Search by name or phone...","admin.searchRestaurants":"Search by name or address...","admin.searchActivities":"Search by title or content...","admin.filterByRole":"Filter by role","admin.filterByType":"Filter by type","admin.filterByStatus":"Filter by status","admin.allRoles":"All Roles","admin.allTypes":"All Types","admin.allStatus":"All Status","admin.statusActive":"Active","admin.statusEnded":"Ended","admin.statusPinned":"Pinned","admin.view":"View","admin.createMerchant":"Create Merchant","admin.createSupervisor":"Create Supervisor","admin.createUser":"Create User","admin.createNewUser":"Create New User","admin.createUserDescription":"Create a new merchant or supervisor account","admin.userCreated":"User created successfully","admin.createUserError":"Failed to create user","admin.role":"Role","admin.create":"Create","admin.oldData":"Old Data","admin.newData":"New Data","admin.noLogs":"No operation logs yet","admin.merchant":"Merchant","admin.supervisor":"Supervisor","admin.editActivityDetails":"Edit activity details, dates and settings","admin.createActivityWithContent":"Create new activity with multilingual content and rich formatting","admin.imageMaxSize":"PNG, JPG Max 5MB","admin.imageTooBig":"Image size must be less than 10MB","admin.cropImage":"Crop Image","admin.cropImageDescription":"Adjust the crop area to fit the recommended size","admin.recommendedSize":"Recommended Size","admin.imageSizeHint":"The image will be displayed at this aspect ratio across all devices (desktop, tablet, mobile)","admin.confirmCrop":"Confirm Crop","admin.multilingualContent":"Multilingual Content","admin.chinese":"Chinese","admin.english":"English","admin.portuguese":"Portuguese","admin.title":"Title","admin.content":"Content","admin.enterTitle":"Enter activity title...","admin.enterContent":"Enter detailed activity content with rich text formatting...","admin.dateSettings":"Date Settings","admin.selectDate":"Select date","admin.displaySettings":"Display Settings","admin.pinToTop":"Pin to Top","admin.showAtTop":"Show this activity at the top of the list","admin.lowerFirst":"Lower numbers appear first","admin.selectParticipatingRestaurants":"Select participating restaurants","admin.editRestaurantDetails":"Edit restaurant details, location, hours and settings","admin.createRestaurantWithInfo":"Create new restaurant with multilingual content and complete information","admin.restaurantName":"Restaurant Name","admin.enterRestaurantName":"Enter restaurant name...","admin.restaurantType":"Restaurant Type (1-3 tags)","admin.typeExample":"e.g. Cantonese","admin.typeExamplePt":"e.g. Cantons","admin.enterDescription":"Enter restaurant description...","admin.contactAndWebsite":"Contact & Website","admin.enterAddress":"Enter address...","admin.enterPhone":"+351 XXX XXX XXX","admin.enterWebsite":"https://...","admin.clickOrDragMarker":"Click on the map or drag the marker to set the location","admin.weekdays":"Weekdays","admin.weekend":"Weekend","admin.copyToAll":"Copy to All Days","admin.splitShift":"Split Shift","admin.open":"Open","admin.close":"Close","admin.afternoon":"Afternoon","admin.evening":"Evening","admin.visible":"Visible","admin.showInFrontend":"Show this restaurant in the frontend","common.saving":"Saving...","merchant.myRestaurants":"My Restaurants","merchant.merchantDescription":"Manage your restaurant information and settings","merchant.supervisorDescription":"Manage all restaurants under your supervision","merchant.noRestaurants":"No restaurants assigned yet","joinUs.title":"Join Xiaoxiong Market","joinUs.description":"Partner with us to grow your restaurant business. Fill out the form below and our team will contact you soon.","joinUs.name":"Name","joinUs.namePlaceholder":"Your full name","joinUs.email":"Email","joinUs.emailPlaceholder":"your@email.com","joinUs.phone":"Phone","joinUs.phonePlaceholder":"+351 123 456 789","joinUs.restaurantName":"Restaurant Name","joinUs.restaurantNamePlaceholder":"Your restaurant name","joinUs.restaurantAddress":"Restaurant Address (Optional)","joinUs.restaurantAddressPlaceholder":"Street address, city","joinUs.optional":"Optional","joinUs.featuresNeeded":"Features Needed","joinUs.featuresDescription":"Select at least one feature you're interested in","joinUs.feature.booking":"Table Booking","joinUs.feature.delivery":"Delivery Service","joinUs.feature.qrcode":"QR Code Menu","joinUs.submit":"Submit Request","joinUs.nameMin":"Name must be at least 2 characters","joinUs.emailInvalid":"Invalid email address","joinUs.phoneMin":"Phone must be at least 6 characters","joinUs.restaurantNameMin":"Restaurant name must be at least 2 characters","joinUs.addressMin":"Restaurant address must be at least 2 characters","joinUs.featuresMin":"Please select at least one feature","joinUs.consentText":"By registering, you agree to receive marketing emails and promotional offers. For details, please review our Privacy Policy and Terms of Service.","joinUs.successTitle":"Request Submitted!","joinUs.successDescription":"Thank you for your trust!","joinUs.successMessage":"Your information has been successfully submitted! Thank you for your trust! Our dedicated consultant will contact you by phone within 24 business hours.","joinUs.submitAnother":"Submit Another Request","joinUs.submitError":"Failed to submit request. Please try again.","joinUs.rateLimitError":"Too Many Requests","joinUs.rateLimitErrorDesc":"You have already submitted a request in the last 24 hours. Please try again later.","joinUs.adminTitle":"Join Requests Management","joinUs.adminDescription":"View and manage all merchant join requests","joinUs.recipientEmail":"Recipient Email","joinUs.recipientEmailDesc":"Email address where join requests will be sent","joinUs.totalRequests":"Total Requests","joinUs.totalRequestsDesc":"All time join requests received","joinUs.allRequests":"All Join Requests","joinUs.allRequestsDesc":"View and manage all submitted join requests","joinUs.searchPlaceholder":"Search by name, email, restaurant...","joinUs.contact":"Contact","joinUs.restaurant":"Restaurant","joinUs.submittedAt":"Submitted","joinUs.noRequests":"No join requests yet","joinUs.enterNewEmail":"Enter new recipient email:","joinUs.emailUpdated":"Recipient email updated successfully","joinUs.emailUpdateError":"Failed to update recipient email","joinUs.status":"Status","joinUs.status.pending":"Pending","joinUs.status.completed":"Completed","joinUs.status.rejected":"Rejected","joinUs.statusUpdated":"Status updated successfully","joinUs.statusUpdateError":"Failed to update status","joinUs.requestDeleted":"Request deleted successfully","joinUs.deleteError":"Failed to delete request","joinUs.confirmDelete":"Delete Request","joinUs.confirmDeleteDescription":"Are you sure you want to delete this request? This action cannot be undone.","toast.subscribed":"Subscribed!","toast.unsubscribed":"Unsubscribed","toast.subscribedDesc":"You've joined this activity","toast.unsubscribedDesc":"You've left this activity","toast.subscriptionFailed":"Failed to update subscription","toast.roleChanged":"Role changed successfully","toast.roleChangeFailed":"Failed to change role","toast.profileUpdated":"Profile updated successfully","toast.profileUpdateFailed":"Failed to update profile","toast.avatarUploadFailed":"Failed to upload avatar","toast.activityDeleted":"Activity deleted successfully","toast.activityDeleteFailed":"Failed to delete activity","toast.restaurantDeleted":"Restaurant deleted successfully","toast.restaurantDeleteFailed":"Failed to delete restaurant","toast.usersDeleted":"Users deleted successfully","toast.usersDeleteFailed":"Failed to delete users","toast.restaurantsDeleted":"Restaurants deleted successfully","toast.restaurantsDeleteFailed":"Failed to delete restaurants","toast.activitiesDeleted":"Activities deleted successfully","toast.activitiesDeleteFailed":"Failed to delete activities","toast.rolesChanged":"Roles changed successfully","toast.rolesChangeFailed":"Failed to change roles","toast.commentDeleted":"Comment deleted successfully","toast.commentDeleteFailed":"Failed to delete comment","toast.pleaseSelectRating":"Please select a rating","toast.participationJoined":"Successfully joined the activity","toast.participationLeft":"Successfully left the activity","toast.participationFailed":"Failed to update participation","toast.visibilityUpdated":"Restaurant visibility updated","toast.visibilityUpdateFailed":"Failed to update restaurant visibility","toast.restaurantJoined":"Restaurant joined activity","toast.restaurantJoinedDesc":"Your restaurant is now participating in this activity","toast.restaurantLeft":"Restaurant left activity","toast.restaurantLeftDesc":"Your restaurant is no longer participating in this activity","toast.participationUpdateFailed":"Failed to update participation","toast.participationUpdateFailedDesc":"Please try again later","toast.termsNotAgreed":"Activity Terms Required","toast.termsNotAgreedDesc":"Please agree to the activity terms in your profile before joining activities","error.general":"An error occurred","error.networkError":"Network error. Please try again.","error.notFound":"Not found","error.unauthorized":"Unauthorized access","validation.titleRequired":"Title is required","validation.contentRequired":"Content is required","validation.nameRequired":"Name is required","validation.typeRequired":"At least 1 type is required","validation.typeMaximum":"Maximum 3 types allowed","validation.addressRequired":"Address is required","admin.showing":"Showing","admin.of":"of","admin.results":"results","address.myAddresses":"My Addresses","address.manageDescription":"Manage your delivery and billing addresses","address.addNew":"Add Address","address.addDescription":"Add a new address to your account","address.editAddress":"Edit Address","address.editDescription":"Update your address information","address.label":"Label","address.selectLabel":"Select a label","address.labelHome":"Home","address.labelWork":"Work","address.labelOffice":"Office","address.labelOther":"Other","address.street":"Street Address","address.streetPlaceholder":"Enter street address","address.district":"District/Parish","address.districtPlaceholder":"Enter district","address.city":"City","address.cityPlaceholder":"Enter city","address.postalCode":"Postal Code","address.postalCodePlaceholder":"Enter postal code","address.country":"Country","address.selectCountry":"Select country","address.setAsDefault":"Set as default address","address.default":"Default","address.add":"Add Address","address.noAddresses":"You haven't added any addresses yet","address.addFirst":"Add Your First Address","address.deleteTitle":"Delete Address","address.deleteDescription":"Are you sure you want to delete this address? This action cannot be undone.","address.phone":"Phone Number","address.phonePlaceholder":"Enter phone number","address.phoneConfirmTitle":"Add Phone to Profile","address.phoneConfirmDescription":"Your profile doesn't have a phone number yet. Would you like to save this phone number to your profile as well?"}},zh:{translation:{"nav.brandName":"","nav.map":"","nav.mapView":"","nav.restaurants":"","nav.activities":"","nav.profile":"","nav.signIn":"","nav.signOut":"","nav.myAccount":"","nav.admin":"","nav.manageRestaurants":"","nav.joinUs":"","map.subtitle":"","home.hero.brandName":"","home.hero.title":"","home.hero.subtitle":"","home.hero.description":"","home.hero.exploreBtn":"","home.hero.activitiesBtn":"","home.features.title":"","home.features.description":"","home.features.map.title":"","home.features.map.desc":"","home.features.reviews.title":"","home.features.reviews.desc":"","home.features.events.title":"","home.features.events.desc":"","home.cta.title":"","home.cta.description":"","home.cta.button":"","home.stats.delivery":"","home.stats.reservation":"","restaurants.title":"","restaurants.search":"...","restaurants.noResults":"","restaurants.noResultsDesc":"","restaurants.viewDetails":"","restaurants.addToFavorite":"","restaurants.removeFromFavorite":"","restaurants.mustSignIn":"","restaurants.listView":"","restaurants.mapView":"","restaurants.sortByDistance":"","restaurants.sortedByDistance":"","restaurants.radius":"","restaurants.radius1km":"1 km","restaurants.radius3km":"3 km","restaurants.radius5km":"5 km","restaurants.radius10km":"10 km","restaurants.radius20km":"20 km","restaurants.allRestaurants":"","restaurants.getLocation":"","restaurants.locationEnabled":"","restaurants.directions":"","restaurants.distanceAway":"{{distance}} km","restaurants.restaurantTypes":"","restaurants.filter":"","restaurant.address":"","restaurant.phone":"","restaurant.hours":"","restaurant.today":"","restaurant.closed":"","restaurant.dayMon":"","restaurant.dayTue":"","restaurant.dayWed":"","restaurant.dayThu":"","restaurant.dayFri":"","restaurant.daySat":"","restaurant.daySun":"","restaurant.website":"","restaurant.visitWebsite":"","restaurant.getDirections":"","restaurant.callNow":"","restaurant.joinPrivate":"","restaurant.reviews":"","restaurant.addReview":"","restaurant.rating":"","restaurant.edited":"","restaurant.reply":"","restaurant.writeComment":"...","restaurant.writeReply":"...","restaurant.postComment":"","restaurant.signInToComment":"","restaurant.signInToRate":"","restaurant.noComments":"","restaurant.confirmDelete":"","restaurant.ratingsCount":"","restaurant.yourRating":"","restaurant.rateThisRestaurant":"","restaurant.photoGallery":"","restaurant.addImage":"","restaurant.imageUploadFailed":"","restaurant.imageTooLarge":"5MB","restaurant.priceRange":"","restaurant.selectPriceRange":"...","activities.title":"","activities.description":"","activities.viewDetails":"","activities.joinEvent":"","activities.joined":"","activities.subscribe":"","activities.subscribed":"","activities.subscribers":"","activities.subscribersCount":"","activities.participants":"","activities.restaurantsParticipating":"","activities.until":"","activities.shareSuccess":"","activities.linkCopied":"","activities.shareError":"","activities.pinned":"","activities.ended":"","activities.ongoing":"","activities.signInToJoin":"","activities.signInToJoinHint":"","activities.signInToSubscribe":"","activities.signInToSubscribeDesc":"","activities.about":"","activities.participatingRestaurants":"","activities.repeat.none":"","activities.repeat.daily":"","activities.repeat.weekly":"","activities.repeat.monthly":"","activities.repeat.yearly":"","activities.serviceType.dine_in":"","activities.serviceType.takeaway":"","activities.serviceType.both":"&","activities.creatorLabel":"","activities.createdByPlatform":"","activities.rules":"","activities.rulesTitle":"","activities.usageInstructions":"","activities.noActivities":"","profile.title":"","profile.settings":"","profile.profile":"","profile.favorites":"","profile.reviews":"","profile.comments":"","profile.activities":"","profile.favoriteRestaurants":"","profile.favoritesDesc":"","profile.myReviews":"","profile.myComments":"","profile.reviewsDesc":"","profile.commentsDesc":"","profile.joinedActivities":"","profile.activitiesDesc":"","profile.noActivities":"","profile.noFavorites":"","profile.noComments":"","profile.upcomingEvents":"","profile.participatedActivities":"","profile.participatedActivitiesDesc":"","profile.personalActivities":"","profile.restaurantActivities":"","profile.participatingRestaurants":"","profile.coupons.title":"","profile.coupons.description":"","profile.coupons.available":"","profile.coupons.used":"","profile.coupons.usedOn":"","profile.coupons.validUntil":"","profile.coupons.noExpiry":"","profile.coupons.noCoupons":"","profile.coupons.browseActivities":"","profile.noParticipatedActivities":"","profile.browseActivities":"","profile.editProfile":"","profile.editProfileDescription":"","profile.displayName":"","profile.phone":"","profile.phonePlaceholder":"","profile.addPhoneNumber":"","profile.modifyPhoneNumber":"","profile.uploadAvatar":"","profile.joinedOn":"","profile.deleteAccount":"","profile.deleteAccountWarning":"","profile.deleteAccountDescription":"","profile.confirmDeleteAccount":"","profile.confirmDeleteDescription":"","profile.typeDeleteToConfirm":" DELETE ","profile.deleteAccountSuccess":"","profile.deleteAccountFailed":"","profile.activityTermsTitle":"","profile.activityTermsDescription":"","profile.activityTermsAgreedStatus":"","profile.activityTermsNotAgreed":"","profile.viewFullRules":"","profile.agreeToTerms":"","profile.agreedOn":"","profile.activityTermsAgreed":"","profile.activityTermsRevoked":"","profile.activityTermsUpdateFailed":"","profile.changeEmail":"","profile.verifyOldEmail":"","profile.verifyNewEmail":"","profile.confirmEmailUpdate":"","profile.oldEmailStep":" 1/3: ","profile.newEmailStep":" 2/3: ","profile.confirmEmailStep":" 3/3: ","profile.currentEmail":"","profile.newEmail":"","profile.verificationCode":"","profile.sendCode":"","profile.codeSent":"","profile.enterCode":"4","profile.verify":"","profile.updateEmail":"","profile.codeSentToOldEmail":"","profile.codeSentToNewEmail":"","profile.sendCodeFailed":"","profile.enterCodePlaceholder":"","profile.codeIncorrect":"","profile.verificationFailed":"","profile.oldEmailVerified":"","profile.newEmailVerified":"","profile.enterValidEmail":"","profile.pleaseSignIn":"","profile.emailUpdated":"","profile.emailUpdateFailed":"","profile.enterNewEmail":"","profile.role.user":"","profile.role.merchant":"","profile.role.supervisor":"","profile.role.admin":"","profile.changePassword":"","profile.changePasswordDescription":"","profile.verifyOldPassword":"","profile.oldPasswordStep":" 1/2: ","profile.currentPassword":"","profile.enterCurrentPassword":"","profile.forgotPassword":"","profile.useEmailVerification":"","profile.oldPasswordVerified":"","profile.oldPasswordIncorrect":"","profile.setNewPassword":"","profile.newPasswordStep":" 2/2: ","profile.newPassword":"","profile.confirmNewPassword":"","profile.enterNewPassword":"6","profile.confirmNewPasswordPlaceholder":"","profile.passwordsDontMatch":"","profile.passwordTooShort":"6","profile.passwordUpdated":"","profile.passwordUpdateFailed":"","profile.updatePassword":"","report.title":"","report.reportComment":"","report.reportRestaurant":"","report.reportActivity":"","report.reportUser":"","report.description":"","report.reason":"","report.reasonPlaceholder":"","report.reasons":{spam:"",harassment:"",inappropriate_content:"",misinformation:"",copyright:"",fraud:"",hate_speech:"",violence:"",other:""},"report.detailsLabel":"","report.detailsPlaceholder":"20","report.detailsMin":"20","report.contactLabel":"","report.contactPlaceholder":"","report.contactRequired":"","report.invalidEmail":"","report.evidenceLabel":"","report.evidenceRequired":"","report.evidenceRequiredNote":"","report.uploadImages":"","report.evidenceUrls":"","report.imageUploadHint":"JPG, PNG, WEBP, GIF 5MB","report.imageTooLarge":" 5MB","report.invalidImageType":" JPGPNGWEBP  GIF ","report.imageUploadFailed":"","report.evidencePlaceholder":"","report.addEvidence":"","report.removeEvidence":"","report.submit":"","report.submitting":"...","report.success":"","report.successDetailed":"{{reference}}","report.successDescription":" 24-48 ","report.failed":"","report.cancel":"","report.confirmTitle":"","report.confirmMessage":"","admin.reports":"","admin.reportsDescription":"","admin.totalReports":"","admin.allReportsCount":"","admin.awaitingReview":"","admin.underReview":"","admin.resolvedReports":"","admin.dismissedReports":"","admin.allReports":"","admin.manageReportsDesc":"","admin.searchReports":"...","admin.noReports":"","admin.reportStatus":{pending:"",reviewing:"",resolved:"",dismissed:""},"admin.reportType":{comment:"",restaurant:"",activity:"",user:""},"admin.reportedBy":"","admin.reportedAt":"","admin.viewReport":"","admin.updateStatus":"","admin.adminNotes":"","admin.saveNotes":"","auth.welcome":"","auth.subtitle":"","auth.login":"","auth.register":"","auth.phone":"","auth.email":"","auth.password":"","auth.displayName":"","auth.phoneOptional":"","auth.phoneNumber":"","auth.phoneMin":"","auth.phoneHint":"+351 912 345 678","auth.confirmPassword":"","auth.signIn":"","auth.signingIn":"...","auth.sendCode":"","auth.sendingCode":"...","auth.verificationCode":"","auth.verify":"","auth.verifying":"...","auth.otpLength":"6","auth.otpSent":"","auth.otpHint":" {{phone}} 6","auth.createAccount":"","auth.creatingAccount":"...","auth.orContinueWith":"","auth.google":"Google","auth.backToHome":"","auth.invalidEmail":"","auth.passwordMin":"6","auth.passwordPlaceholder":"6","auth.passwordStrength":{weak:" - ",medium:" - ",strong:""},"auth.displayNameMin":"2","auth.passwordsDontMatch":"","auth.invalidCredentials":"","auth.emailExists":"","auth.signInSuccess":"","auth.signUpSuccess":"","auth.verificationCodeSent":"","auth.verificationCodeFailed":"","auth.invalidVerificationCode":"","auth.verificationCodeUsed":"","auth.verificationCodeHint":" {{email}} 4","auth.resendCode":"","auth.resendIn":"{{seconds}}","common.loading":"...","common.error":"","common.success":"","common.cancel":"","common.confirm":"","common.continue":"","common.save":"","common.delete":"","common.edit":"","common.submit":"","common.back":"","common.next":"","common.previous":"","common.search":"","common.filter":"","common.sort":"","common.actions":"","common.km":"","common.uploading":"...","common.deleting":"...","common.share":"","common.copyLink":"","common.linkCopied":"","common.shareError":"","common.moreOptions":"","common.shareVia":"","sharing.selectPlatform":"","sharing.systemShare":"","sharing.shareToApps":"","sharing.copiedForWeChat":"","sharing.copiedForInstagram":"Instagram","common.shareSuccess":"","common.actions.clearFilter":"","common.showMore":"","common.showLess":"","common.showDetails":"","common.hideDetails":"","common.processing":"...","common.loadMore":"","notifications.title":"","notifications.markAllRead":"","notifications.noNotifications":"","notifications.markAsReadError":"","notifications.markAllAsReadSuccess":"","notifications.markAllAsReadError":"","notifications.userNotAuthenticated":"","admin.management":"","admin.dashboard":"","admin.users":"","admin.restaurants":"","admin.activities":"","admin.logs":"","admin.userManagement":"","admin.restaurantManagement":"","admin.activityManagement":"","admin.operationLogs":"","admin.manageUserRoles":"","admin.manageRestaurants":"","admin.manageActivities":"","admin.viewSystemLogs":"","admin.dashboardDescription":"","admin.totalUsers":"","admin.totalRestaurants":"","admin.totalActivities":"","admin.totalComments":"","admin.registeredUsers":"","admin.listedRestaurants":"","admin.activeEvents":"","admin.userReviews":"","admin.recentActivity":"","admin.recentActivityDescription":"","admin.viewLogsForDetails":"","admin.selectRole":"","admin.assignRole":"","admin.confirmRemoveRole":"","admin.noPhone":"","admin.addRestaurant":"","admin.addActivity":"","admin.editActivity":"","admin.activityCreated":"","admin.activityUpdated":"","admin.confirmDelete":"","admin.deleteActivityWarning":"","admin.activityImage":"","admin.uploadImage":"","admin.titleEnglish":"","admin.titleChinese":"","admin.titlePortuguese":"","admin.contentEnglish":"","admin.contentChinese":"","admin.contentPortuguese":"","admin.startDate":"","admin.endDate":"","admin.pickDate":"","admin.repeatMode":"","admin.selectRepeatMode":"","admin.serviceType":"","admin.selectServiceType":"","admin.repeatNone":"","admin.repeatDaily":"","admin.repeatWeekly":"","admin.repeatMonthly":"","admin.repeatYearly":"","admin.associatedRestaurants":"","admin.pinned":"","admin.sortOrder":"","admin.editRestaurant":"","admin.restaurantCreated":"","admin.restaurantUpdated":"","admin.deleteRestaurantWarning":"","admin.restaurantImage":"","admin.nameChinese":"","admin.nameEnglish":"","admin.namePortuguese":"","admin.typeChinese":"","admin.typeEnglish":"","admin.typePortuguese":"","admin.restaurantTypes":"","admin.tags":"","admin.addType":"","admin.descriptionChinese":"","admin.descriptionEnglish":"","admin.descriptionPortuguese":"","admin.address":"","admin.phone":"","admin.website":"","admin.showWebsiteButton":"","admin.location":"","admin.locationOnMap":"","admin.latitude":"","admin.longitude":"","admin.clickOrDragToSetLocation":"","admin.mapInstructions":"","admin.openingHours":"","admin.closed":"","admin.day.monday":"","admin.day.tuesday":"","admin.day.wednesday":"","admin.day.thursday":"","admin.day.friday":"","admin.day.saturday":"","admin.day.sunday":"","admin.userGrowth":"","admin.userGrowthDescription":"","admin.activityEngagement":"","admin.activityEngagementDescription":"","admin.topRestaurants":"","admin.topRestaurantsDescription":"","admin.subscribers":"","admin.comments":"","admin.rating":"","admin.noData":"","admin.exportCSV":"CSV","admin.exportSuccess":"","admin.noDataToExport":"","admin.batchDelete":"","admin.batchAssignRole":"","admin.selectedCount":" {{count}} ","admin.confirmBatchDelete":"","admin.batchDeleteWarning":" {{count}} ","admin.clearSelection":"","admin.selectAll":"","admin.searchUsers":"...","admin.searchRestaurants":"...","admin.searchActivities":"...","admin.filterByRole":"","admin.filterByType":"","admin.filterByStatus":"","admin.allRoles":"","admin.allTypes":"","admin.allStatus":"","admin.statusActive":"","admin.statusEnded":"","admin.statusPinned":"","admin.view":"","admin.createMerchant":"","admin.createSupervisor":"Supervisor","admin.createUser":"","admin.createNewUser":"","admin.createUserDescription":"supervisor","admin.userCreated":"","admin.createUserError":"","admin.role":"","admin.create":"","admin.oldData":"","admin.newData":"","admin.noLogs":"","admin.merchant":"","admin.supervisor":"","admin.editActivityDetails":"","admin.createActivityWithContent":"","admin.imageMaxSize":"PNG, JPG  5MB","admin.imageTooBig":" 10MB","admin.cropImage":"","admin.cropImageDescription":"","admin.recommendedSize":"","admin.imageSizeHint":"","admin.confirmCrop":"","admin.multilingualContent":"","admin.chinese":"","admin.english":"","admin.portuguese":"","admin.title":"","admin.content":"","admin.enterTitle":"...","admin.enterContent":"...","admin.dateSettings":"","admin.selectDate":"","admin.displaySettings":"","admin.pinToTop":"","admin.showAtTop":"","admin.lowerFirst":"","admin.selectParticipatingRestaurants":"","admin.editRestaurantDetails":"","admin.createRestaurantWithInfo":"","admin.restaurantName":"","admin.enterRestaurantName":"...","admin.restaurantType":" (1-3 )","admin.typeExample":"","admin.typeExamplePt":"Cantons","admin.enterDescription":"...","admin.contactAndWebsite":"","admin.enterAddress":"...","admin.enterPhone":"+351 XXX XXX XXX","admin.enterWebsite":"https://...","admin.clickOrDragMarker":"","admin.weekdays":"","admin.weekend":"","admin.copyToAll":"","admin.splitShift":"","admin.open":"","admin.close":"","admin.afternoon":"","admin.evening":"","admin.visible":"","admin.showInFrontend":"","common.saving":"...","merchant.myRestaurants":"","merchant.merchantDescription":"","merchant.supervisorDescription":"","merchant.noRestaurants":"","joinUs.title":"","joinUs.description":"","joinUs.name":"","joinUs.namePlaceholder":"","joinUs.email":"","joinUs.emailPlaceholder":"your@email.com","joinUs.phone":"","joinUs.phonePlaceholder":"+351 123 456 789","joinUs.restaurantName":"","joinUs.restaurantNamePlaceholder":"","joinUs.restaurantAddress":"","joinUs.restaurantAddressPlaceholder":"","joinUs.optional":"","joinUs.featuresNeeded":"","joinUs.featuresDescription":"","joinUs.feature.booking":"","joinUs.feature.delivery":"","joinUs.feature.qrcode":"","joinUs.submit":"","joinUs.nameMin":"2","joinUs.emailInvalid":"","joinUs.phoneMin":"6","joinUs.restaurantNameMin":"2","joinUs.addressMin":"2","joinUs.featuresMin":"","joinUs.consentText":"","joinUs.successTitle":"","joinUs.successDescription":"","joinUs.successMessage":"24","joinUs.submitAnother":"","joinUs.submitError":"","joinUs.rateLimitError":"","joinUs.rateLimitErrorDesc":"24","joinUs.adminTitle":"","joinUs.adminDescription":"","joinUs.recipientEmail":"","joinUs.recipientEmailDesc":"","joinUs.totalRequests":"","joinUs.totalRequestsDesc":"","joinUs.allRequests":"","joinUs.allRequestsDesc":"","joinUs.searchPlaceholder":"...","joinUs.contact":"","joinUs.restaurant":"","joinUs.submittedAt":"","joinUs.noRequests":"","joinUs.enterNewEmail":"","joinUs.emailUpdated":"","joinUs.emailUpdateError":"","joinUs.status":"","joinUs.status.pending":"","joinUs.status.completed":"","joinUs.status.rejected":"","joinUs.statusUpdated":"","joinUs.statusUpdateError":"","joinUs.requestDeleted":"","joinUs.deleteError":"","joinUs.confirmDelete":"","joinUs.confirmDeleteDescription":"","toast.subscribed":"","toast.unsubscribed":"","toast.subscribedDesc":"","toast.unsubscribedDesc":"","toast.subscriptionFailed":"","toast.roleChanged":"","toast.roleChangeFailed":"","toast.profileUpdated":"","toast.profileUpdateFailed":"","toast.avatarUploadFailed":"","toast.activityDeleted":"","toast.activityDeleteFailed":"","toast.restaurantDeleted":"","toast.restaurantDeleteFailed":"","toast.usersDeleted":"","toast.usersDeleteFailed":"","toast.restaurantsDeleted":"","toast.restaurantsDeleteFailed":"","toast.activitiesDeleted":"","toast.activitiesDeleteFailed":"","toast.rolesChanged":"","toast.rolesChangeFailed":"","toast.commentDeleted":"","toast.commentDeleteFailed":"","toast.pleaseSelectRating":"","toast.participationJoined":"","toast.participationJoinFailed":"","toast.participationLeft":"","toast.participationLeaveFailed":"","toast.visibilityUpdated":"","toast.visibilityUpdateFailed":"","toast.verificationFailed":"","toast.restaurantJoined":"","toast.restaurantJoinedDesc":"","toast.restaurantLeft":"","toast.restaurantLeftDesc":"","toast.participationUpdateFailed":"","toast.participationUpdateFailedDesc":"","toast.termsNotAgreed":"","toast.termsNotAgreedDesc":"","toast.pleaseSignIn":"","toast.emailUpdatedSuccess":"","toast.emailUpdateError":"","toast.signInToFavorite":"","toast.favoritesUpdateFailed":"","toast.favoriteAdded":"","toast.favoriteRemoved":"","toast.resendCodeFailed":"","toast.verificationCodeResent":"","toast.reportUpdatedSuccess":"","toast.reportUpdateFailed":"","toast.merchantRestaurantsSaved":"","toast.merchantRestaurantsDescription":"","toast.merchantRestaurantsSaveFailed":"","toast.merchantRestaurantsDescriptionFailed":"","admin.reportsTrend":"","admin.reportsTrendDesc":"7","admin.reportsReasonDist":"","admin.reportsReasonDistDesc":"","admin.reportsTypeDist":"","admin.reportsTypeDistDesc":"","admin.reportsStatusDist":"","admin.reportsStatusDistDesc":"","admin.reportsCount":"","merchant.manageRestaurants":"","merchant.manageSupervisorRestaurants":"","merchant.assignRestaurantsTo":" {name} ","merchant.merchantOnlyOne":" ","merchant.saveReminder":' ""',"merchant.searchRestaurants":"...","merchant.selected":"","merchant.selectedCountOne":" {count}/1 ","merchant.selectedCountMulti":" {count} ","error.general":"","error.networkError":"","error.notFound":"","error.unauthorized":"","validation.titleRequired":"","validation.contentRequired":"","validation.nameRequired":"","validation.typeRequired":"1","validation.typeMaximum":"3","validation.addressRequired":"","admin.showing":"","admin.of":"","admin.results":"","address.myAddresses":"","address.manageDescription":"","address.addNew":"","address.addDescription":"","address.editAddress":"","address.editDescription":"","address.label":"","address.selectLabel":"","address.labelHome":"","address.labelWork":"","address.labelOffice":"","address.labelOther":"","address.street":"","address.streetPlaceholder":"","address.district":"/","address.districtPlaceholder":"","address.city":"","address.cityPlaceholder":"","address.postalCode":"","address.postalCodePlaceholder":"","address.country":"","address.selectCountry":"","address.setAsDefault":"","address.default":"","address.add":"","address.noAddresses":"","address.addFirst":"","address.deleteTitle":"","address.deleteDescription":"","address.phone":"","address.phonePlaceholder":"","address.phoneConfirmTitle":"","address.phoneConfirmDescription":""}},pt:{translation:{"nav.brandName":"Xiaoxiong Market","nav.map":"Incio","nav.mapView":"Mapa Privado","nav.restaurants":"Restaurantes","nav.activities":"Atividades","nav.profile":"Perfil","nav.signIn":"Entrar","nav.signOut":"Sair","nav.myAccount":"Minha Conta","nav.admin":"Painel Admin","nav.manageRestaurants":"Gerir Restaurantes","nav.joinUs":"Juntar Restaurante","map.subtitle":"Explore restaurantes selecionados nas proximidades","home.hero.brandName":"Xiaoxiong Market","home.hero.title":"Descubra Gastronomia Prxima","home.hero.subtitle":"Sua Jornada Culinria Comea Aqui","home.hero.description":"Explore restaurantes selecionados em vrias cidades, participe de eventos gastronmicos e conecte-se com amantes da gastronomia;","home.hero.exploreBtn":"Explorar Restaurantes","home.hero.activitiesBtn":"Ver Atividades","home.features.title":"Por Que Nos Escolher?","home.features.description":"Descubra Gastronomia; Compartilhe Experincias; Participe de Atividades;","home.features.map.title":"Mapa Inteligente","home.features.map.desc":"Encontre restaurantes prximos com nossa busca inteligente baseada em localizao e visualizao interativa do mapa;","home.features.reviews.title":"Avaliaes Confiveis","home.features.reviews.desc":"Leia avaliaes e classificaes autnticas de clientes verificados para tomar decises informadas;","home.features.events.title":"Eventos Exclusivos","home.features.events.desc":"Participe de eventos gastronmicos especiais, festivais de comida e conecte-se com a comunidade culinria;","home.cta.title":"Pronto para Comear?","home.cta.description":"Junte-se ao Xiaoxiong Market e alcance milhares de amantes da gastronomia. Cresa seu negcio conosco;","home.cta.button":"Adeso de Restaurante","home.stats.delivery":"Take Away","home.stats.reservation":"Reserva","restaurants.title":"Restaurantes","restaurants.search":"Pesquisar nome, morada, cdigo postal...","restaurants.noResults":"Nenhum restaurante encontrado","restaurants.noResultsDesc":"Tente ajustar sua pesquisa ou filtros","restaurants.viewDetails":"Ver Detalhes","restaurants.addToFavorite":"Adicionar aos favoritos","restaurants.removeFromFavorite":"Remover dos favoritos","restaurants.mustSignIn":"Por favor, faa login para favoritar restaurantes","restaurants.listView":"Vista de Lista","restaurants.mapView":"Vista de Mapa","restaurants.sortByDistance":"Ordenar por Distncia","restaurants.sortedByDistance":"Ordenado por distncia","restaurants.radius":"Raio","restaurants.radius1km":"1 km","restaurants.radius3km":"3 km","restaurants.radius5km":"5 km","restaurants.radius10km":"10 km","restaurants.radius20km":"20 km","restaurants.allRestaurants":"Todos os Restaurantes","restaurants.getLocation":"Obter Minha Localizao","restaurants.locationEnabled":"Localizao Ativada","restaurants.directions":"Obter Direes","restaurants.distanceAway":"{{distance}} km","restaurants.restaurantTypes":"Tipos de Restaurantes","restaurants.filter":"Filtrar","restaurant.address":"Endereo","restaurant.phone":"Telefone","restaurant.hours":"Horrio","restaurant.today":"Hoje","restaurant.closed":"Fechado","restaurant.dayMon":"Seg","restaurant.dayTue":"Ter","restaurant.dayWed":"Qua","restaurant.dayThu":"Qui","restaurant.dayFri":"Sex","restaurant.daySat":"Sb","restaurant.daySun":"Dom","restaurant.website":"Site","restaurant.visitWebsite":"Visitar Site","restaurant.getDirections":"Obter Direes","restaurant.callNow":"Ligar Agora","restaurant.joinPrivate":"Entrar no Domnio Privado","restaurant.reviews":"Avaliaes","restaurant.addReview":"Adicionar Avaliao","restaurant.rating":"Classificao","restaurant.edited":"Editado","restaurant.reply":"Responder","restaurant.writeComment":"Escreva um comentrio...","restaurant.writeReply":"Escreva uma resposta...","restaurant.postComment":"Publicar Comentrio","restaurant.signInToComment":"Por favor, faa login para comentar","restaurant.signInToRate":"Por favor, faa login para avaliar este restaurante","restaurant.noComments":"Ainda no h comentrios. Seja o primeiro a compartilhar sua experincia!","restaurant.confirmDelete":"Tem certeza de que deseja excluir este comentrio?","restaurant.ratingsCount":"avaliaes","restaurant.yourRating":"Sua avaliao","restaurant.rateThisRestaurant":"Avalie este restaurante","restaurant.photoGallery":"Galeria de Fotos","restaurant.addImage":"Adicionar Imagem","restaurant.imageUploadFailed":"Falha ao enviar imagem","restaurant.imageTooLarge":"O tamanho da imagem deve ser menor que 5MB","restaurant.priceRange":"Faixa de Preo (Opcional)","restaurant.selectPriceRange":"Selecione a faixa de preo...","activities.title":"Atividades","activities.description":"Participe de experincias gastronmicas exclusivas e eventos culinrios","activities.viewDetails":"Ver Detalhes","activities.joinEvent":"Participar do Evento","activities.joined":"Participando","activities.subscribe":"Subscrever","activities.subscribed":"Subscrito","activities.subscribers":"inscritos","activities.subscribersCount":"assinantes","activities.participants":"participantes","activities.restaurantsParticipating":"restaurantes participando","activities.until":"At","activities.shareSuccess":"Atividade partilhada com sucesso","activities.linkCopied":"Link copiado para a rea de transferncia","activities.shareError":"Falha ao partilhar atividade","activities.pinned":"Fixado","activities.ended":"Encerrado","activities.ongoing":"Em Andamento","activities.signInToJoin":"Por favor, faa login para participar desta atividade","activities.signInToJoinHint":"Receba notificaes sobre as ltimas atividades","activities.signInToSubscribe":"Por favor, faa login","activities.signInToSubscribeDesc":"Voc precisa fazer login para subscrever atividades","activities.about":"Sobre Esta Atividade","activities.participatingRestaurants":"Restaurantes Participantes","activities.repeat.none":"nica vez","activities.repeat.daily":"Dirio","activities.repeat.weekly":"Semanal","activities.repeat.monthly":"Mensal","activities.repeat.yearly":"Anual","activities.serviceType.dine_in":"Refeio no local","activities.serviceType.takeaway":"Take Away","activities.serviceType.both":"Refeio & Take Away","activities.creatorLabel":"Criador:","activities.createdByPlatform":"Plataforma","activities.rules":"Regras da Atividade","activities.rulesTitle":"Regras da Atividade","activities.usageInstructions":"Como Usar","activities.noActivities":"Nenhuma atividade disponvel","profile.title":"Meu Perfil","profile.settings":"Configuraes","profile.profile":"Perfil","profile.favorites":"Favoritos","profile.reviews":"Avaliaes","profile.comments":"Comentrios","profile.activities":"Atividades","profile.favoriteRestaurants":"Meus Restaurantes Favoritos","profile.favoritesDesc":"Restaurantes que voc marcou para visitas futuras","profile.myReviews":"Minhas Avaliaes","profile.myComments":"Meus Comentrios","profile.reviewsDesc":"Suas classificaes e avaliaes para restaurantes","profile.commentsDesc":"Comentrios que voc postou em restaurantes e atividades","profile.joinedActivities":"Atividades Participadas","profile.activitiesDesc":"Eventos e atividades em que voc est participando","profile.noActivities":"Nenhuma atividade participada ainda. Confira nossos","profile.noFavorites":"Nenhum restaurante favorito ainda","profile.noComments":"Nenhum comentrio ainda","profile.upcomingEvents":"prximos eventos","profile.participatedActivities":"Atividades Participadas","profile.participatedActivitiesDesc":"Veja todas as atividades em que seus restaurantes participaram","profile.personalActivities":"Atividades Pessoais","profile.restaurantActivities":"Atividades do Restaurante","profile.participatingRestaurants":"Restaurantes Participantes","profile.coupons.title":"Meus Cupons","profile.coupons.description":"Ver e gerenciar seus cupons","profile.coupons.available":"Disponvel","profile.coupons.used":"Usado","profile.coupons.usedOn":"Usado em","profile.coupons.validUntil":"Vlido at","profile.coupons.noExpiry":"Sem data de validade","profile.coupons.noCoupons":"Nenhum cupom ainda","profile.coupons.browseActivities":"Navegue pelas atividades para obter cupons","profile.noParticipatedActivities":"Voc ainda no participou de nenhuma atividade.","profile.browseActivities":"Ver atividades","profile.editProfile":"Editar Perfil","profile.editProfileDescription":"Atualize suas informaes de perfil","profile.displayName":"Nome de Exibio","profile.phone":"Telefone","profile.phonePlaceholder":"Introduza o nmero de telefone","profile.addPhoneNumber":"Adicionar nmero de telefone","profile.modifyPhoneNumber":"Modificar","profile.uploadAvatar":"Enviar Avatar","profile.joinedOn":"Participou em","profile.deleteAccount":"Excluir Conta","profile.deleteAccountWarning":"Aviso: Esta ao  permanente","profile.deleteAccountDescription":"Excluir sua conta remover permanentemente todos os seus dados, incluindo seu perfil, favoritos, comentrios e inscries em atividades. Esta ao no pode ser desfeita.","profile.confirmDeleteAccount":"Confirmao Final Necessria","profile.confirmDeleteDescription":"Esta  sua ltima chance. Todos os seus dados sero permanentemente excludos e no podero ser recuperados.","profile.typeDeleteToConfirm":"Digite DELETE para confirmar","profile.deleteAccountSuccess":"Conta excluda com sucesso","profile.deleteAccountFailed":"Falha ao excluir conta","profile.activityTermsTitle":"Acordo de Termos de Atividade","profile.activityTermsDescription":"Comerciantes e supervisores devem concordar com os termos antes de participar","profile.activityTermsAgreedStatus":"Concordou","profile.activityTermsNotAgreed":"No Concordou","profile.viewFullRules":"Ver Regras Completas","profile.agreeToTerms":"Concordo com os termos da atividade","profile.agreedOn":"Concordou em","profile.activityTermsAgreed":"Termos da atividade aceitos","profile.activityTermsRevoked":"Termos da atividade revogados","profile.activityTermsUpdateFailed":"Falha ao atualizar acordo de termos","profile.changeEmail":"Alterar Email","profile.verifyOldEmail":"Verificar Email Atual","profile.verifyNewEmail":"Inserir Novo Email","profile.confirmEmailUpdate":"Confirmar Atualizao de Email","profile.oldEmailStep":"Passo 1/3: Precisamos verificar seu email atual","profile.newEmailStep":"Passo 2/3: Insira seu novo endereo de email","profile.confirmEmailStep":"Passo 3/3: Confirme sua atualizao de email","profile.currentEmail":"Email Atual","profile.newEmail":"Novo Email","profile.verificationCode":"Cdigo de Verificao","profile.sendCode":"Enviar Cdigo","profile.codeSent":"Enviado","profile.enterCode":"Digite o cdigo de 4 dgitos","profile.verify":"Verificar","profile.updateEmail":"Atualizar Email","profile.codeSentToOldEmail":"Cdigo de verificao enviado para seu email antigo","profile.codeSentToNewEmail":"Cdigo de verificao enviado para seu novo email","profile.sendCodeFailed":"Falha ao enviar cdigo de verificao","profile.enterCodePlaceholder":"Por favor, insira o cdigo de verificao","profile.codeIncorrect":"Cdigo de verificao incorreto ou expirado","profile.verificationFailed":"Falha na verificao","profile.oldEmailVerified":"Email antigo verificado com sucesso","profile.newEmailVerified":"Novo email verificado com sucesso","profile.enterValidEmail":"Por favor, insira um endereo de email vlido","profile.pleaseSignIn":"Por favor, faa login primeiro","profile.emailUpdated":"Email atualizado com sucesso, por favor faa login com seu novo email","profile.emailUpdateFailed":"Falha ao atualizar email","profile.enterNewEmail":"Insira seu novo endereo de email","profile.role.user":"Usurio","profile.role.merchant":"Comerciante","profile.role.supervisor":"Supervisor","profile.role.admin":"Administrador","profile.changePassword":"Alterar Senha","profile.changePasswordDescription":"Atualize a senha da sua conta","profile.verifyOldPassword":"Verificar Senha Atual","profile.oldPasswordStep":"Passo 1/2: Verifique sua identidade","profile.currentPassword":"Senha Atual","profile.enterCurrentPassword":"Digite a senha atual","profile.forgotPassword":"Esqueceu a senha?","profile.useEmailVerification":"Use verificao por e-mail","profile.oldPasswordVerified":"Senha verificada com sucesso","profile.oldPasswordIncorrect":"Senha atual incorreta","profile.setNewPassword":"Definir Nova Senha","profile.newPasswordStep":"Passo 2/2: Digite sua nova senha","profile.newPassword":"Nova Senha","profile.confirmNewPassword":"Confirmar Nova Senha","profile.enterNewPassword":"Digite nova senha (mn. 6 caracteres)","profile.confirmNewPasswordPlaceholder":"Digite a nova senha novamente","profile.passwordsDontMatch":"As senhas no coincidem","profile.passwordTooShort":"A senha deve ter pelo menos 6 caracteres","profile.passwordUpdated":"Senha atualizada com sucesso","profile.passwordUpdateFailed":"Falha ao atualizar senha","profile.updatePassword":"Atualizar Senha","report.title":"Denunciar","report.reportComment":"Denunciar Comentrio","report.reportRestaurant":"Denunciar Restaurante","report.reportActivity":"Denunciar Atividade","report.reportUser":"Denunciar Usurio","report.description":"Ajude-nos a manter uma comunidade segura","report.reason":"Motivo da Denncia","report.reasonPlaceholder":"Selecione um motivo","report.reasons":{spam:"Spam ou Publicidade",harassment:"Assdio ou Bullying",inappropriate_content:"Contedo Inadequado",misinformation:"Desinformao",copyright:"Violao de Direitos Autorais",fraud:"Fraude ou Golpe",hate_speech:"Discurso de dio",violence:"Violncia ou Ameaas",other:"Outro"},"report.detailsLabel":"Detalhes","report.detailsPlaceholder":"Fornea informaes detalhadas sobre esta denncia (obrigatrio, mnimo 20 caracteres)","report.detailsMin":"Detalhes devem ter pelo menos 20 caracteres","report.contactLabel":"Email de Contato","report.contactPlaceholder":"Seu email para acompanhamento","report.contactRequired":"Email de contato  obrigatrio","report.invalidEmail":"Por favor, insira um endereo de email vlido","report.evidenceLabel":"URLs de Evidncia","report.evidenceRequired":" necessrio fornecer pelo menos uma evidncia (imagem ou URL)","report.evidenceRequiredNote":"Por favor, carregue pelo menos uma imagem ou fornea um link","report.uploadImages":"Carregar Imagens","report.evidenceUrls":"Ou Fornecer URLs","report.imageUploadHint":"Formatos suportados: JPG, PNG, WEBP, GIF. Mx 5MB por imagem","report.imageTooLarge":"O tamanho da imagem deve ser inferior a 5MB","report.invalidImageType":"Apenas os formatos JPG, PNG, WEBP e GIF so suportados","report.imageUploadFailed":"Falha ao carregar imagens. Por favor, tente novamente","report.evidencePlaceholder":"Adicionar captura de tela ou URL de evidncia","report.addEvidence":"Adicionar Evidncia","report.removeEvidence":"Remover","report.submit":"Enviar Denncia","report.submitting":"Enviando...","report.success":"Denncia enviada com sucesso. Vamos analis-la em breve.","report.successDetailed":"Denncia enviada com sucesso! Referncia: {{reference}}","report.successDescription":"Vamos analisar sua denncia em 24-48 horas. Voc receber uma notificao por e-mail no endereo de contato fornecido assim que a anlise for concluda. Obrigado por nos ajudar a manter uma comunidade segura!","report.failed":"Falha ao enviar denncia","report.cancel":"Cancelar","report.confirmTitle":"Confirmar Envio de Denncia","report.confirmMessage":"Tem certeza que deseja enviar esta denncia? Denncias falsas podem resultar em restries de conta.","admin.reports":"Denncias","admin.reportsDescription":"Gerenciar denncias de usurios","admin.totalReports":"Total de Denncias","admin.allReportsCount":"Todas as denncias enviadas","admin.awaitingReview":"Aguardando reviso","admin.underReview":"Em reviso","admin.resolvedReports":"Denncias resolvidas","admin.dismissedReports":"Denncias rejeitadas","admin.allReports":"Todas as Denncias","admin.manageReportsDesc":"Ver e gerenciar todas as denncias de usurios","admin.searchReports":"Pesquisar denncias por descrio, denunciante ou motivo...","admin.noReports":"Nenhuma denncia ainda","admin.reportStatus":{pending:"Pendente",reviewing:"Em Anlise",resolved:"Resolvido",dismissed:"Rejeitado"},"admin.reportType":{comment:"Comentrio",restaurant:"Restaurante",activity:"Atividade",user:"Usurio"},"admin.reportedBy":"Denunciado Por","admin.reportedAt":"Denunciado Em","admin.viewReport":"Ver Denncia","admin.updateStatus":"Atualizar Status","admin.adminNotes":"Notas do Administrador","admin.saveNotes":"Salvar Notas","auth.welcome":"Bem-vindo ao Xiaoxiong Market","auth.subtitle":"Descubra restaurantes incrveis e participe de eventos gastronmicos emocionantes","auth.login":"Entrar","auth.register":"Registo por Email","auth.phone":"Telefone","auth.email":"Email","auth.password":"Senha","auth.displayName":"Nome de Exibio","auth.phoneOptional":"Telefone (Opcional)","auth.phoneNumber":"Nmero de Telefone","auth.phoneMin":"Por favor, insira um nmero de telefone vlido","auth.phoneHint":"Insira seu nmero de telefone com cdigo do pas (ex: +351 912 345 678)","auth.confirmPassword":"Confirmar Senha","auth.signIn":"Entrar","auth.signingIn":"Entrando...","auth.sendCode":"Enviar Cdigo","auth.sendingCode":"Enviando...","auth.verificationCode":"Cdigo de Verificao","auth.verify":"Verificar","auth.verifying":"Verificando...","auth.otpLength":"O cdigo deve ter 6 dgitos","auth.otpSent":"Cdigo de verificao enviado para seu telefone","auth.otpHint":"Insira o cdigo de 6 dgitos enviado para {{phone}}","auth.createAccount":"Criar Conta","auth.creatingAccount":"Criando conta...","auth.orContinueWith":"Ou continue com","auth.google":"Google","auth.backToHome":"Voltar ao incio","auth.invalidEmail":"Endereo de email invlido","auth.passwordMin":"A senha deve ter pelo menos 6 caracteres","auth.passwordPlaceholder":"Mnimo 6 caracteres","auth.passwordStrength":{weak:"Senha fraca - Adicione maisculas, nmeros ou smbolos",medium:"Senha mdia - Considere adicionar mais variedade",strong:"Senha forte"},"auth.displayNameMin":"O nome de exibio deve ter pelo menos 2 caracteres","auth.passwordsDontMatch":"As senhas no coincidem","auth.invalidCredentials":"Email ou senha invlidos","auth.emailExists":"Este email j est registrado","auth.signInSuccess":"Login bem-sucedido!","auth.signUpSuccess":"Conta criada com sucesso! Agora voc pode fazer login.","auth.verificationCodeSent":"Cdigo de verificao enviado para seu email","auth.verificationCodeFailed":"Falha ao enviar cdigo de verificao","auth.invalidVerificationCode":"Cdigo de verificao invlido","auth.verificationCodeUsed":"Este cdigo de verificao j foi usado. Por favor, solicite um novo.","auth.verificationCodeHint":"Por favor, insira o cdigo de verificao de 4 dgitos enviado para {{email}}","auth.resendCode":"Reenviar Cdigo","auth.resendIn":"Reenviar em {{seconds}}s","common.loading":"Carregando...","common.error":"Erro","common.success":"Sucesso","common.cancel":"Cancelar","common.confirm":"Confirmar","common.continue":"Continuar","common.save":"Salvar","common.delete":"Excluir","common.edit":"Editar","common.submit":"Enviar","common.back":"Voltar","common.next":"Prximo","common.previous":"Anterior","common.search":"Pesquisar","common.filter":"Filtrar","common.sort":"Ordenar","common.actions":"Aes","common.km":"km","common.uploading":"Carregando...","common.deleting":"Eliminando...","common.enterPlaceholder":"Digite...","common.selectPlaceholder":"Selecione...","common.share":"Compartilhar","common.copyLink":"Copiar Link","common.linkCopied":"Link copiado","common.shareError":"Erro ao compartilhar","common.moreOptions":"Mais Opes","common.shareVia":"Compartilhar via","sharing.selectPlatform":"Selecionar Plataforma","sharing.systemShare":"Compartilhamento do Sistema","sharing.shareToApps":"Compartilhar para Apps","sharing.copiedForWeChat":"Link copiado! Abra o WeChat e cole para compartilhar","sharing.copiedForInstagram":"Link copiado! Abra o Instagram e cole na sua histria ou bio","common.shareSuccess":"Compartilhado com sucesso","common.actions.clearFilter":"Limpar Filtro","common.showMore":"Mostrar Mais","common.showLess":"Mostrar Menos","common.showDetails":"Mostrar Detalhes","common.hideDetails":"Ocultar Detalhes","common.processing":"Processando...","common.loadMore":"Carregar Mais","notifications.title":"Notificaes","notifications.markAllRead":"Marcar todas como lidas","notifications.noNotifications":"Nenhuma notificao ainda","notifications.markAsReadError":"Falha ao marcar notificao como lida","notifications.markAllAsReadSuccess":"Todas as notificaes marcadas como lidas","notifications.markAllAsReadError":"Falha ao marcar todas as notificaes como lidas","notifications.userNotAuthenticated":"Usurio no autenticado","admin.management":"Gerenciamento","admin.dashboard":"Painel","admin.users":"Usurios","admin.restaurants":"Restaurantes","admin.activities":"Atividades","admin.logs":"Logs de Operao","admin.userManagement":"Gerenciamento de Usurios","admin.restaurantManagement":"Gerenciamento de Restaurantes","admin.activityManagement":"Gerenciamento de Atividades","admin.operationLogs":"Logs de Operao","admin.manageUserRoles":"Gerenciar funes e permisses de usurios","admin.manageRestaurants":"Visualizar e gerenciar todos os restaurantes","admin.manageActivities":"Visualizar e gerenciar todas as atividades","admin.viewSystemLogs":"Visualizar todos os logs de operao do sistema","admin.dashboardDescription":"Viso geral das estatsticas do sistema","admin.totalUsers":"Total de Usurios","admin.totalRestaurants":"Total de Restaurantes","admin.totalActivities":"Total de Atividades","admin.totalComments":"Total de Comentrios","admin.registeredUsers":"Usurios registrados","admin.listedRestaurants":"Restaurantes listados","admin.activeEvents":"Eventos ativos","admin.userReviews":"Avaliaes e comentrios de usurios","admin.recentActivity":"Atividade Recente","admin.recentActivityDescription":"ltimas atividades do sistema","admin.viewLogsForDetails":"Visualize os logs de operao para atividades detalhadas","admin.selectRole":"Selecione uma funo","admin.assignRole":"Atribuir Funo","admin.confirmRemoveRole":"Tem certeza de que deseja remover esta funo?","admin.noPhone":"Sem nmero de telefone","admin.addRestaurant":"Adicionar Restaurante","admin.addActivity":"Adicionar Atividade","admin.editActivity":"Editar Atividade","admin.activityCreated":"Atividade criada com sucesso","admin.activityUpdated":"Atividade atualizada com sucesso","admin.confirmDelete":"Confirmar Excluso","admin.deleteActivityWarning":"Isso excluir permanentemente a atividade e todos os dados associados. Esta ao no pode ser desfeita.","admin.activityImage":"Imagem da Atividade","admin.uploadImage":"Carregar Imagem","admin.titleEnglish":"Ttulo (Ingls)","admin.titleChinese":"Ttulo (Chins)","admin.titlePortuguese":"Ttulo (Portugus)","admin.contentEnglish":"Contedo (Ingls)","admin.contentChinese":"Contedo (Chins)","admin.contentPortuguese":"Contedo (Portugus)","admin.startDate":"Data de Incio","admin.endDate":"Data de Trmino","admin.pickDate":"Escolher data","admin.repeatMode":"Modo de Repetio","admin.selectRepeatMode":"Selecione o modo de repetio","admin.serviceType":"Tipo de Servio","admin.selectServiceType":"Selecione o tipo de servio","admin.repeatNone":"Sem Repetio","admin.repeatDaily":"Diariamente","admin.repeatWeekly":"Semanalmente","admin.repeatMonthly":"Mensalmente","admin.repeatYearly":"Anualmente","admin.associatedRestaurants":"Restaurantes Associados","admin.pinned":"Fixado","admin.sortOrder":"Ordem de Classificao","admin.editRestaurant":"Editar Restaurante","admin.restaurantCreated":"Restaurante criado com sucesso","admin.restaurantUpdated":"Restaurante atualizado com sucesso","admin.deleteRestaurantWarning":"Isso excluir permanentemente o restaurante e todos os dados associados. Esta ao no pode ser desfeita.","admin.restaurantImage":"Imagem do Restaurante","admin.nameChinese":"Nome (Chins)","admin.nameEnglish":"Nome (Ingls)","admin.namePortuguese":"Nome (Portugus)","admin.typeChinese":"Tipo (Chins)","admin.typeEnglish":"Tipo (Ingls)","admin.typePortuguese":"Tipo (Portugus)","admin.restaurantTypes":"Tipos de Restaurantes","admin.tags":"etiquetas","admin.addType":"Adicionar Tipo","admin.descriptionChinese":"Descrio (Chins)","admin.descriptionEnglish":"Descrio (Ingls)","admin.descriptionPortuguese":"Descrio (Portugus)","admin.address":"Endereo","admin.phone":"Telefone","admin.website":"Site","admin.showWebsiteButton":"Mostrar Boto do Site","admin.location":"Localizao","admin.locationOnMap":"Localizao no Mapa","admin.latitude":"Latitude","admin.longitude":"Longitude","admin.clickOrDragToSetLocation":"Clique no mapa ou arraste o marcador para definir a localizao","admin.mapInstructions":"Clique no mapa ou arraste o marcador para definir a localizao","admin.openingHours":"Horrio de Funcionamento","admin.closed":"Fechado","admin.day.monday":"Segunda-feira","admin.day.tuesday":"Tera-feira","admin.day.wednesday":"Quarta-feira","admin.day.thursday":"Quinta-feira","admin.day.friday":"Sexta-feira","admin.day.saturday":"Sbado","admin.day.sunday":"Domingo","admin.userGrowth":"Tendncia de Crescimento de Usurios","admin.userGrowthDescription":"Crescimento acumulado de registro de usurios","admin.activityEngagement":"Engajamento em Atividades","admin.activityEngagementDescription":"Inscritos e comentrios por atividade","admin.topRestaurants":"Restaurantes Mais Populares","admin.topRestaurantsDescription":"Restaurantes classificados por classificao e engajamento","admin.subscribers":"Inscritos","admin.comments":"Comentrios","admin.rating":"Classificao","admin.noData":"Nenhum dado disponvel","admin.exportCSV":"Exportar CSV","admin.exportSuccess":"Dados exportados com sucesso","admin.noDataToExport":"Nenhum dado disponvel para exportar","admin.batchDelete":"Excluso em Lote","admin.batchAssignRole":"Atribuir Funo em Lote","admin.selectedCount":"{{count}} selecionado(s)","admin.confirmBatchDelete":"Confirmar Excluso em Lote","admin.batchDeleteWarning":"Isso excluir permanentemente {{count}} itens. Esta ao no pode ser desfeita.","admin.clearSelection":"Limpar Seleo","admin.selectAll":"Selecionar Tudo","admin.searchUsers":"Pesquisar por nome ou telefone...","admin.searchRestaurants":"Pesquisar por nome ou endereo...","admin.searchActivities":"Pesquisar por ttulo ou contedo...","admin.filterByRole":"Filtrar por funo","admin.filterByType":"Filtrar por tipo","admin.filterByStatus":"Filtrar por status","admin.allRoles":"Todas as Funes","admin.allTypes":"Todos os Tipos","admin.allStatus":"Todos os Status","admin.statusActive":"Ativo","admin.statusEnded":"Encerrado","admin.statusPinned":"Fixado","admin.view":"Visualizar","admin.createMerchant":"Criar Comerciante","admin.createSupervisor":"Criar Supervisor","admin.createUser":"Criar Usurio","admin.createNewUser":"Criar Novo Usurio","admin.createUserDescription":"Criar uma nova conta de comerciante ou supervisor","admin.userCreated":"Usurio criado com sucesso","admin.createUserError":"Falha ao criar usurio","admin.role":"Funo","admin.create":"Criar","admin.oldData":"Dados Antigos","admin.newData":"Novos Dados","admin.noLogs":"Nenhum log de operao ainda","admin.merchant":"Comerciante","admin.supervisor":"Supervisor","admin.editActivityDetails":"Editar detalhes da atividade, datas e configuraes","admin.createActivityWithContent":"Criar nova atividade com contedo multilngue e formatao rica","admin.imageMaxSize":"PNG, JPG Mx 5MB","admin.imageTooBig":"O tamanho da imagem deve ser inferior a 10MB","admin.cropImage":"Cortar Imagem","admin.cropImageDescription":"Ajuste a rea de corte para se adequar ao tamanho recomendado","admin.recommendedSize":"Tamanho Recomendado","admin.imageSizeHint":"A imagem ser exibida nesta proporo em todos os dispositivos (desktop, tablet, mobile)","admin.confirmCrop":"Confirmar Corte","admin.multilingualContent":"Contedo Multilngue","admin.chinese":"Chins","admin.english":"Ingls","admin.portuguese":"Portugus","admin.title":"Ttulo","admin.content":"Contedo","admin.enterTitle":"Digite o ttulo da atividade...","admin.enterContent":"Digite o contedo detalhado da atividade com formatao rica...","admin.dateSettings":"Configuraes de Data","admin.selectDate":"Selecionar data","admin.displaySettings":"Configuraes de Exibio","admin.pinToTop":"Fixar no Topo","admin.showAtTop":"Mostrar esta atividade no topo da lista","admin.lowerFirst":"Nmeros menores aparecem primeiro","admin.selectParticipatingRestaurants":"Selecionar restaurantes participantes","admin.editRestaurantDetails":"Editar detalhes do restaurante, localizao, horrios e configuraes","admin.createRestaurantWithInfo":"Criar novo restaurante com contedo multilngue e informaes completas","admin.restaurantName":"Nome do Restaurante","admin.enterRestaurantName":"Digite o nome do restaurante...","admin.restaurantType":"Tipo de Restaurante (1-3 etiquetas)","admin.typeExample":"e.g. Cantons","admin.typeExamplePt":"e.g. Cantons","admin.enterDescription":"Digite a descrio do restaurante...","admin.contactAndWebsite":"Contato e Website","admin.enterAddress":"Digite o endereo...","admin.enterPhone":"+351 XXX XXX XXX","admin.enterWebsite":"https://...","admin.clickOrDragMarker":"Clique no mapa ou arraste o marcador para definir a localizao","admin.weekdays":"Dias de Semana","admin.weekend":"Fim de Semana","admin.copyToAll":"Copiar para Todos os Dias","admin.splitShift":"Turno Dividido","admin.open":"Abrir","admin.close":"Fechar","admin.afternoon":"Tarde","admin.evening":"Noite","admin.visible":"Visvel","admin.showInFrontend":"Mostrar este restaurante no frontend","common.saving":"Salvando...","merchant.myRestaurants":"Meus Restaurantes","merchant.merchantDescription":"Gerir informaes e configuraes do seu restaurante","merchant.supervisorDescription":"Gerir todos os restaurantes sob sua superviso","merchant.noRestaurants":"Nenhum restaurante atribudo ainda","joinUs.title":"Junte-se ao Xiaoxiong Market","joinUs.description":"Faa parceria connosco para desenvolver o seu negcio de restaurante. Preencha o formulrio abaixo e a nossa equipa entrar em contacto em breve.","joinUs.name":"Nome","joinUs.namePlaceholder":"Seu nome completo","joinUs.email":"Email","joinUs.emailPlaceholder":"seu@email.com","joinUs.phone":"Telefone","joinUs.phonePlaceholder":"+351 123 456 789","joinUs.restaurantName":"Nome do Restaurante","joinUs.restaurantNamePlaceholder":"Nome do seu restaurante","joinUs.restaurantAddress":"Morada do Restaurante (Opcional)","joinUs.restaurantAddressPlaceholder":"Morada completa, cidade","joinUs.optional":"Opcional","joinUs.featuresNeeded":"Funcionalidades Necessrias","joinUs.featuresDescription":"Selecione pelo menos uma funcionalidade do seu interesse","joinUs.feature.booking":"Reserva de Mesas","joinUs.feature.delivery":"Servio de Entrega","joinUs.feature.qrcode":"Menu QR Code","joinUs.submit":"Enviar Pedido","joinUs.nameMin":"O nome deve ter pelo menos 2 caracteres","joinUs.emailInvalid":"Endereo de email invlido","joinUs.phoneMin":"O telefone deve ter pelo menos 6 caracteres","joinUs.restaurantNameMin":"O nome do restaurante deve ter pelo menos 2 caracteres","joinUs.addressMin":"A morada do restaurante deve ter pelo menos 2 caracteres","joinUs.featuresMin":"Por favor, selecione pelo menos uma funcionalidade","joinUs.consentText":"Ao se registrar, voc concorda em receber e-mails de marketing e ofertas promocionais. Para detalhes, consulte nossa Poltica de Privacidade e Termos de Servio.","joinUs.successTitle":"Informao Enviada com Sucesso!","joinUs.successDescription":"Obrigado pela sua confiana!","joinUs.successMessage":"Suas informaes foram enviadas com sucesso! Obrigado pela sua confiana! Nosso consultor dedicado entrar em contato por telefone dentro de 24 horas teis.","joinUs.submitAnother":"Enviar Outro Pedido","joinUs.submitError":"Falha ao enviar pedido. Por favor, tente novamente.","joinUs.rateLimitError":"Muitos Pedidos","joinUs.rateLimitErrorDesc":"J enviou um pedido nas ltimas 24 horas. Por favor, tente mais tarde.","joinUs.adminTitle":"Gesto de Pedidos de Adeso","joinUs.adminDescription":"Ver e gerir todos os pedidos de adeso de comerciantes","joinUs.recipientEmail":"Email de Receo","joinUs.recipientEmailDesc":"Endereo de email onde os pedidos de adeso sero enviados","joinUs.totalRequests":"Total de Pedidos","joinUs.totalRequestsDesc":"Todos os pedidos de adeso recebidos","joinUs.allRequests":"Todos os Pedidos de Adeso","joinUs.allRequestsDesc":"Ver e gerir todos os pedidos de adeso submetidos","joinUs.searchPlaceholder":"Pesquisar por nome, email, restaurante...","joinUs.contact":"Contacto","joinUs.restaurant":"Restaurante","joinUs.submittedAt":"Submetido","joinUs.noRequests":"Nenhum pedido de adeso ainda","joinUs.enterNewEmail":"Introduza novo email de receo:","joinUs.emailUpdated":"Email de receo atualizado com sucesso","joinUs.emailUpdateError":"Falha ao atualizar email de receo","joinUs.status":"Estado","joinUs.status.pending":"Pendente","joinUs.status.completed":"Concludo","joinUs.status.rejected":"Rejeitado","joinUs.statusUpdated":"Estado atualizado com sucesso","joinUs.statusUpdateError":"Falha ao atualizar o estado","joinUs.requestDeleted":"Pedido eliminado com sucesso","joinUs.deleteError":"Falha ao eliminar o pedido","joinUs.confirmDelete":"Eliminar Pedido","joinUs.confirmDeleteDescription":"Tem certeza de que deseja eliminar este pedido? Esta ao no pode ser desfeita.","toast.subscribed":"Subscrito!","toast.unsubscribed":"Cancelado","toast.subscribedDesc":"Juntou-se a esta atividade","toast.unsubscribedDesc":"Saiu desta atividade","toast.subscriptionFailed":"Falha ao atualizar subscrio","toast.roleChanged":"Funo alterada com sucesso","toast.roleChangeFailed":"Falha ao alterar funo","toast.profileUpdated":"Perfil atualizado com sucesso","toast.profileUpdateFailed":"Falha ao atualizar perfil","toast.avatarUploadFailed":"Falha ao carregar avatar","toast.activityDeleted":"Atividade eliminada com sucesso","toast.activityDeleteFailed":"Falha ao eliminar atividade","toast.restaurantDeleted":"Restaurante eliminado com sucesso","toast.restaurantDeleteFailed":"Falha ao eliminar restaurante","toast.usersDeleted":"Utilizadores eliminados com sucesso","toast.usersDeleteFailed":"Falha ao eliminar utilizadores","toast.restaurantsDeleted":"Restaurantes eliminados com sucesso","toast.restaurantsDeleteFailed":"Falha ao eliminar restaurantes","toast.activitiesDeleted":"Atividades eliminadas com sucesso","toast.activitiesDeleteFailed":"Falha ao eliminar atividades","toast.rolesChanged":"Funes alteradas com sucesso","toast.rolesChangeFailed":"Falha ao alterar funes","toast.commentDeleted":"Comentrio eliminado com sucesso","toast.commentDeleteFailed":"Falha ao eliminar comentrio","toast.pleaseSelectRating":"Por favor selecione uma avaliao","toast.participationJoined":"Participao confirmada com sucesso","toast.participationLeft":"Saiu da atividade com sucesso","toast.participationFailed":"Falha ao atualizar participao","toast.visibilityUpdated":"Visibilidade do restaurante atualizada","toast.visibilityUpdateFailed":"Falha ao atualizar visibilidade do restaurante","toast.restaurantJoined":"Restaurante participou da atividade","toast.restaurantJoinedDesc":"Seu restaurante agora est participando desta atividade","toast.restaurantLeft":"Restaurante saiu da atividade","toast.restaurantLeftDesc":"Seu restaurante no est mais participando desta atividade","toast.participationUpdateFailed":"Falha ao atualizar participao","toast.participationUpdateFailedDesc":"Por favor, tente novamente mais tarde","toast.termsNotAgreed":"Termos da Atividade Necessrios","toast.termsNotAgreedDesc":"Por favor, concorde com os termos da atividade no seu perfil antes de participar","error.general":"Ocorreu um erro","error.networkError":"Erro de rede. Por favor, tente novamente.","error.notFound":"No encontrado","error.unauthorized":"Acesso no autorizado","validation.titleRequired":"Ttulo  obrigatrio","validation.contentRequired":"Contedo  obrigatrio","validation.nameRequired":"Nome  obrigatrio","validation.typeRequired":"Pelo menos 1 tipo  necessrio","validation.typeMaximum":"Mximo de 3 tipos permitidos","validation.addressRequired":"Endereo  obrigatrio","admin.showing":"Mostrando","admin.of":"de","admin.results":"resultados","address.myAddresses":"Meus Endereos","address.manageDescription":"Gerir os seus endereos de entrega e faturao","address.addNew":"Adicionar Endereo","address.addDescription":"Adicionar um novo endereo  sua conta","address.editAddress":"Editar Endereo","address.editDescription":"Atualizar as informaes do seu endereo","address.label":"Rtulo","address.selectLabel":"Selecionar um rtulo","address.labelHome":"Casa","address.labelWork":"Trabalho","address.labelOffice":"Escritrio","address.labelOther":"Outro","address.street":"Morada","address.streetPlaceholder":"Introduza a morada","address.district":"Freguesia/Distrito","address.districtPlaceholder":"Introduza a freguesia","address.city":"Cidade","address.cityPlaceholder":"Introduza a cidade","address.postalCode":"Cdigo Postal","address.postalCodePlaceholder":"Introduza o cdigo postal","address.country":"Pas","address.selectCountry":"Selecionar pas","address.setAsDefault":"Definir como endereo padro","address.default":"Padro","address.add":"Adicionar Endereo","address.noAddresses":"Ainda no adicionou nenhum endereo","address.addFirst":"Adicionar o Primeiro Endereo","address.deleteTitle":"Eliminar Endereo","address.deleteDescription":"Tem a certeza de que deseja eliminar este endereo? Esta ao no pode ser desfeita.","address.phone":"Nmero de Telefone","address.phonePlaceholder":"Introduza o nmero de telefone","address.phoneConfirmTitle":"Adicionar Telefone ao Perfil","address.phoneConfirmDescription":"O seu perfil ainda no tem um nmero de telefone. Gostaria de guardar este nmero de telefone tambm no seu perfil?"}}};Pr.use(fie).use(k2e).init({resources:BCe,fallbackLng:"en",supportedLngs:["en","zh","pt"],interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator"],caches:["localStorage"]}});const $Ce=()=>{const{user:e}=Kn(),t=Mi();return V.useEffect(()=>{if(!e)return;const r=Ct.channel("notifications-changes").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${e.id}`},()=>{t.invalidateQueries({queryKey:["notifications",e.id]}),t.invalidateQueries({queryKey:["notifications-unread-count",e.id]})}).subscribe();return()=>{Ct.removeChannel(r)}},[e,t]),ei({queryKey:["notifications",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:r,error:n}=await Ct.from("notifications").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}).limit(50);if(n)throw n;return r},enabled:!!e})},UCe=()=>{const{user:e}=Kn(),t=Mi();return V.useEffect(()=>{if(!e)return;const r=Ct.channel("notifications-unread-changes").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${e.id}`},()=>{t.invalidateQueries({queryKey:["notifications-unread-count",e.id]})}).subscribe();return()=>{Ct.removeChannel(r)}},[e,t]),ei({queryKey:["notifications-unread-count",e==null?void 0:e.id],queryFn:async()=>{if(!e)return 0;const{count:r,error:n}=await Ct.from("notifications").select("*",{count:"exact",head:!0}).eq("user_id",e.id).eq("read",!1);if(n)throw n;return r||0},enabled:!!e})},VCe=()=>{const{toast:e}=Ri(),t=Mi();return Gi({mutationFn:async r=>{const{error:n}=await Ct.from("notifications").update({read:!0}).eq("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["notifications"]}),t.invalidateQueries({queryKey:["notifications-unread-count"]})},onError:()=>{e({title:Pr.t("common.error"),description:Pr.t("notifications.markAsReadError"),variant:"destructive"})}})},qCe=()=>{const{user:e}=Kn(),{toast:t}=Ri(),r=Mi();return Gi({mutationFn:async()=>{if(!e)throw new Error(Pr.t("notifications.userNotAuthenticated"));const{error:n}=await Ct.from("notifications").update({read:!0}).eq("user_id",e.id).eq("read",!1);if(n)throw n},onSuccess:()=>{r.invalidateQueries({queryKey:["notifications"]}),r.invalidateQueries({queryKey:["notifications-unread-count"]}),t({title:Pr.t("common.success"),description:Pr.t("notifications.markAllAsReadSuccess")})},onError:()=>{t({title:Pr.t("common.error"),description:Pr.t("notifications.markAllAsReadError"),variant:"destructive"})}})};function wi(e){const t=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&t==="[object Date]"?new e.constructor(+e):typeof e=="number"||t==="[object Number]"||typeof e=="string"||t==="[object String]"?new Date(e):new Date(NaN)}function Yc(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}function cc(e,t){const r=wi(e);return isNaN(t)?Yc(e,NaN):(t&&r.setDate(r.getDate()+t),r)}function Zd(e,t){const r=wi(e);if(isNaN(t))return Yc(e,NaN);if(!t)return r;const n=r.getDate(),s=Yc(e,r.getTime());s.setMonth(r.getMonth()+t+1,0);const o=s.getDate();return n>=o?s:(r.setFullYear(s.getFullYear(),s.getMonth(),n),r)}const S5=6048e5,HCe=864e5,Cj=43200,gG=1440;let GCe={};function uw(){return GCe}function Gh(e,t){var i,m,y,S;const r=uw(),n=(t==null?void 0:t.weekStartsOn)??((m=(i=t==null?void 0:t.locale)==null?void 0:i.options)==null?void 0:m.weekStartsOn)??r.weekStartsOn??((S=(y=r.locale)==null?void 0:y.options)==null?void 0:S.weekStartsOn)??0,s=wi(e),o=s.getDay(),h=(o<n?7:0)+o-n;return s.setDate(s.getDate()-h),s.setHours(0,0,0,0),s}function Pv(e){return Gh(e,{weekStartsOn:1})}function pie(e){const t=wi(e),r=t.getFullYear(),n=Yc(e,0);n.setFullYear(r+1,0,4),n.setHours(0,0,0,0);const s=Pv(n),o=Yc(e,0);o.setFullYear(r,0,4),o.setHours(0,0,0,0);const h=Pv(o);return t.getTime()>=s.getTime()?r+1:t.getTime()>=h.getTime()?r:r-1}function dg(e){const t=wi(e);return t.setHours(0,0,0,0),t}function hb(e){const t=wi(e),r=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return r.setUTCFullYear(t.getFullYear()),+e-+r}function kh(e,t){const r=dg(e),n=dg(t),s=+r-hb(r),o=+n-hb(n);return Math.round((s-o)/HCe)}function WCe(e){const t=pie(e),r=Yc(e,0);return r.setFullYear(t,0,4),r.setHours(0,0,0,0),Pv(r)}function wF(e,t){const r=t*7;return cc(e,r)}function KCe(e,t){return Zd(e,t*12)}function ZCe(e){let t;return e.forEach(function(r){const n=wi(r);(t===void 0||t<n||isNaN(Number(n)))&&(t=n)}),t||new Date(NaN)}function XCe(e){let t;return e.forEach(r=>{const n=wi(r);(!t||t>n||isNaN(+n))&&(t=n)}),t||new Date(NaN)}function uP(e,t){const r=wi(e),n=wi(t),s=r.getTime()-n.getTime();return s<0?-1:s>0?1:s}function YCe(e){return Yc(e,Date.now())}function Vc(e,t){const r=dg(e),n=dg(t);return+r==+n}function E5(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function JCe(e){if(!E5(e)&&typeof e!="number")return!1;const t=wi(e);return!isNaN(Number(t))}function fb(e,t){const r=wi(e),n=wi(t),s=r.getFullYear()-n.getFullYear(),o=r.getMonth()-n.getMonth();return s*12+o}function QCe(e,t,r){const n=Gh(e,r),s=Gh(t,r),o=+n-hb(n),h=+s-hb(s);return Math.round((o-h)/S5)}function eje(e){return t=>{const n=(e?Math[e]:Math.trunc)(t);return n===0?0:n}}function tje(e,t){return+wi(e)-+wi(t)}function rje(e){const t=wi(e);return t.setHours(23,59,59,999),t}function ON(e){const t=wi(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}function nje(e){const t=wi(e);return+rje(t)==+ON(t)}function ije(e,t){const r=wi(e),n=wi(t),s=uP(r,n),o=Math.abs(fb(r,n));let h;if(o<1)h=0;else{r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-s*o);let i=uP(r,n)===-s;nje(wi(e))&&o===1&&uP(e,n)===1&&(i=!1),h=s*(o-Number(i))}return h===0?0:h}function sje(e,t,r){const n=tje(e,t)/1e3;return eje(r==null?void 0:r.roundingMethod)(n)}function Kc(e){const t=wi(e);return t.setDate(1),t.setHours(0,0,0,0),t}function mie(e){const t=wi(e),r=Yc(e,0);return r.setFullYear(t.getFullYear(),0,1),r.setHours(0,0,0,0),r}function T5(e,t){var i,m,y,S;const r=uw(),n=(t==null?void 0:t.weekStartsOn)??((m=(i=t==null?void 0:t.locale)==null?void 0:i.options)==null?void 0:m.weekStartsOn)??r.weekStartsOn??((S=(y=r.locale)==null?void 0:y.options)==null?void 0:S.weekStartsOn)??0,s=wi(e),o=s.getDay(),h=(o<n?-7:0)+6-(o-n);return s.setDate(s.getDate()+h),s.setHours(23,59,59,999),s}function gie(e){return T5(e,{weekStartsOn:1})}const aje={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},oje=(e,t,r)=>{let n;const s=aje[e];return typeof s=="string"?n=s:t===1?n=s.one:n=s.other.replace("{{count}}",t.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+n:n+" ago":n};function KD(e){return(t={})=>{const r=t.width?String(t.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}const lje={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},cje={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},uje={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},dje={date:KD({formats:lje,defaultWidth:"full"}),time:KD({formats:cje,defaultWidth:"full"}),dateTime:KD({formats:uje,defaultWidth:"full"})},hje={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},fje=(e,t,r,n)=>hje[e];function US(e){return(t,r)=>{const n=r!=null&&r.context?String(r.context):"standalone";let s;if(n==="formatting"&&e.formattingValues){const h=e.defaultFormattingWidth||e.defaultWidth,i=r!=null&&r.width?String(r.width):h;s=e.formattingValues[i]||e.formattingValues[h]}else{const h=e.defaultWidth,i=r!=null&&r.width?String(r.width):e.defaultWidth;s=e.values[i]||e.values[h]}const o=e.argumentCallback?e.argumentCallback(t):t;return s[o]}}const pje={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},mje={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},gje={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},yje={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},vje={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},_je={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},xje=(e,t)=>{const r=Number(e),n=r%100;if(n>20||n<10)switch(n%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},bje={ordinalNumber:xje,era:US({values:pje,defaultWidth:"wide"}),quarter:US({values:mje,defaultWidth:"wide",argumentCallback:e=>e-1}),month:US({values:gje,defaultWidth:"wide"}),day:US({values:yje,defaultWidth:"wide"}),dayPeriod:US({values:vje,defaultWidth:"wide",formattingValues:_je,defaultFormattingWidth:"wide"})};function VS(e){return(t,r={})=>{const n=r.width,s=n&&e.matchPatterns[n]||e.matchPatterns[e.defaultMatchWidth],o=t.match(s);if(!o)return null;const h=o[0],i=n&&e.parsePatterns[n]||e.parsePatterns[e.defaultParseWidth],m=Array.isArray(i)?Sje(i,b=>b.test(h)):wje(i,b=>b.test(h));let y;y=e.valueCallback?e.valueCallback(m):m,y=r.valueCallback?r.valueCallback(y):y;const S=t.slice(h.length);return{value:y,rest:S}}}function wje(e,t){for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t(e[r]))return r}function Sje(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return r}function Eje(e){return(t,r={})=>{const n=t.match(e.matchPattern);if(!n)return null;const s=n[0],o=t.match(e.parsePattern);if(!o)return null;let h=e.valueCallback?e.valueCallback(o[0]):o[0];h=r.valueCallback?r.valueCallback(h):h;const i=t.slice(s.length);return{value:h,rest:i}}}const Tje=/^(\d+)(th|st|nd|rd)?/i,Aje=/\d+/i,Cje={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},jje={any:[/^b/i,/^(a|c)/i]},Pje={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Oje={any:[/1/i,/2/i,/3/i,/4/i]},kje={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Nje={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Ije={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Rje={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Mje={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Dje={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Lje={ordinalNumber:Eje({matchPattern:Tje,parsePattern:Aje,valueCallback:e=>parseInt(e,10)}),era:VS({matchPatterns:Cje,defaultMatchWidth:"wide",parsePatterns:jje,defaultParseWidth:"any"}),quarter:VS({matchPatterns:Pje,defaultMatchWidth:"wide",parsePatterns:Oje,defaultParseWidth:"any",valueCallback:e=>e+1}),month:VS({matchPatterns:kje,defaultMatchWidth:"wide",parsePatterns:Nje,defaultParseWidth:"any"}),day:VS({matchPatterns:Ije,defaultMatchWidth:"wide",parsePatterns:Rje,defaultParseWidth:"any"}),dayPeriod:VS({matchPatterns:Mje,defaultMatchWidth:"any",parsePatterns:Dje,defaultParseWidth:"any"})},A5={code:"en-US",formatDistance:oje,formatLong:dje,formatRelative:fje,localize:bje,match:Lje,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Fje(e){const t=wi(e);return kh(t,mie(t))+1}function yie(e){const t=wi(e),r=+Pv(t)-+WCe(t);return Math.round(r/S5)+1}function vie(e,t){var S,b,T,A;const r=wi(e),n=r.getFullYear(),s=uw(),o=(t==null?void 0:t.firstWeekContainsDate)??((b=(S=t==null?void 0:t.locale)==null?void 0:S.options)==null?void 0:b.firstWeekContainsDate)??s.firstWeekContainsDate??((A=(T=s.locale)==null?void 0:T.options)==null?void 0:A.firstWeekContainsDate)??1,h=Yc(e,0);h.setFullYear(n+1,0,o),h.setHours(0,0,0,0);const i=Gh(h,t),m=Yc(e,0);m.setFullYear(n,0,o),m.setHours(0,0,0,0);const y=Gh(m,t);return r.getTime()>=i.getTime()?n+1:r.getTime()>=y.getTime()?n:n-1}function zje(e,t){var i,m,y,S;const r=uw(),n=(t==null?void 0:t.firstWeekContainsDate)??((m=(i=t==null?void 0:t.locale)==null?void 0:i.options)==null?void 0:m.firstWeekContainsDate)??r.firstWeekContainsDate??((S=(y=r.locale)==null?void 0:y.options)==null?void 0:S.firstWeekContainsDate)??1,s=vie(e,t),o=Yc(e,0);return o.setFullYear(s,0,n),o.setHours(0,0,0,0),Gh(o,t)}function _ie(e,t){const r=wi(e),n=+Gh(r,t)-+zje(r,t);return Math.round(n/S5)+1}function Us(e,t){const r=e<0?"-":"",n=Math.abs(e).toString().padStart(t,"0");return r+n}const pm={y(e,t){const r=e.getFullYear(),n=r>0?r:1-r;return Us(t==="yy"?n%100:n,t.length)},M(e,t){const r=e.getMonth();return t==="M"?String(r+1):Us(r+1,2)},d(e,t){return Us(e.getDate(),t.length)},a(e,t){const r=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(e,t){return Us(e.getHours()%12||12,t.length)},H(e,t){return Us(e.getHours(),t.length)},m(e,t){return Us(e.getMinutes(),t.length)},s(e,t){return Us(e.getSeconds(),t.length)},S(e,t){const r=t.length,n=e.getMilliseconds(),s=Math.trunc(n*Math.pow(10,r-3));return Us(s,t.length)}},$x={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},yG={G:function(e,t,r){const n=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return r.era(n,{width:"abbreviated"});case"GGGGG":return r.era(n,{width:"narrow"});case"GGGG":default:return r.era(n,{width:"wide"})}},y:function(e,t,r){if(t==="yo"){const n=e.getFullYear(),s=n>0?n:1-n;return r.ordinalNumber(s,{unit:"year"})}return pm.y(e,t)},Y:function(e,t,r,n){const s=vie(e,n),o=s>0?s:1-s;if(t==="YY"){const h=o%100;return Us(h,2)}return t==="Yo"?r.ordinalNumber(o,{unit:"year"}):Us(o,t.length)},R:function(e,t){const r=pie(e);return Us(r,t.length)},u:function(e,t){const r=e.getFullYear();return Us(r,t.length)},Q:function(e,t,r){const n=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(n);case"QQ":return Us(n,2);case"Qo":return r.ordinalNumber(n,{unit:"quarter"});case"QQQ":return r.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(n,{width:"wide",context:"formatting"})}},q:function(e,t,r){const n=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(n);case"qq":return Us(n,2);case"qo":return r.ordinalNumber(n,{unit:"quarter"});case"qqq":return r.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(n,{width:"wide",context:"standalone"})}},M:function(e,t,r){const n=e.getMonth();switch(t){case"M":case"MM":return pm.M(e,t);case"Mo":return r.ordinalNumber(n+1,{unit:"month"});case"MMM":return r.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(n,{width:"wide",context:"formatting"})}},L:function(e,t,r){const n=e.getMonth();switch(t){case"L":return String(n+1);case"LL":return Us(n+1,2);case"Lo":return r.ordinalNumber(n+1,{unit:"month"});case"LLL":return r.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(n,{width:"wide",context:"standalone"})}},w:function(e,t,r,n){const s=_ie(e,n);return t==="wo"?r.ordinalNumber(s,{unit:"week"}):Us(s,t.length)},I:function(e,t,r){const n=yie(e);return t==="Io"?r.ordinalNumber(n,{unit:"week"}):Us(n,t.length)},d:function(e,t,r){return t==="do"?r.ordinalNumber(e.getDate(),{unit:"date"}):pm.d(e,t)},D:function(e,t,r){const n=Fje(e);return t==="Do"?r.ordinalNumber(n,{unit:"dayOfYear"}):Us(n,t.length)},E:function(e,t,r){const n=e.getDay();switch(t){case"E":case"EE":case"EEE":return r.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(n,{width:"short",context:"formatting"});case"EEEE":default:return r.day(n,{width:"wide",context:"formatting"})}},e:function(e,t,r,n){const s=e.getDay(),o=(s-n.weekStartsOn+8)%7||7;switch(t){case"e":return String(o);case"ee":return Us(o,2);case"eo":return r.ordinalNumber(o,{unit:"day"});case"eee":return r.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(s,{width:"short",context:"formatting"});case"eeee":default:return r.day(s,{width:"wide",context:"formatting"})}},c:function(e,t,r,n){const s=e.getDay(),o=(s-n.weekStartsOn+8)%7||7;switch(t){case"c":return String(o);case"cc":return Us(o,t.length);case"co":return r.ordinalNumber(o,{unit:"day"});case"ccc":return r.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(s,{width:"narrow",context:"standalone"});case"cccccc":return r.day(s,{width:"short",context:"standalone"});case"cccc":default:return r.day(s,{width:"wide",context:"standalone"})}},i:function(e,t,r){const n=e.getDay(),s=n===0?7:n;switch(t){case"i":return String(s);case"ii":return Us(s,t.length);case"io":return r.ordinalNumber(s,{unit:"day"});case"iii":return r.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(n,{width:"short",context:"formatting"});case"iiii":default:return r.day(n,{width:"wide",context:"formatting"})}},a:function(e,t,r){const s=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(e,t,r){const n=e.getHours();let s;switch(n===12?s=$x.noon:n===0?s=$x.midnight:s=n/12>=1?"pm":"am",t){case"b":case"bb":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(e,t,r){const n=e.getHours();let s;switch(n>=17?s=$x.evening:n>=12?s=$x.afternoon:n>=4?s=$x.morning:s=$x.night,t){case"B":case"BB":case"BBB":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(e,t,r){if(t==="ho"){let n=e.getHours()%12;return n===0&&(n=12),r.ordinalNumber(n,{unit:"hour"})}return pm.h(e,t)},H:function(e,t,r){return t==="Ho"?r.ordinalNumber(e.getHours(),{unit:"hour"}):pm.H(e,t)},K:function(e,t,r){const n=e.getHours()%12;return t==="Ko"?r.ordinalNumber(n,{unit:"hour"}):Us(n,t.length)},k:function(e,t,r){let n=e.getHours();return n===0&&(n=24),t==="ko"?r.ordinalNumber(n,{unit:"hour"}):Us(n,t.length)},m:function(e,t,r){return t==="mo"?r.ordinalNumber(e.getMinutes(),{unit:"minute"}):pm.m(e,t)},s:function(e,t,r){return t==="so"?r.ordinalNumber(e.getSeconds(),{unit:"second"}):pm.s(e,t)},S:function(e,t){return pm.S(e,t)},X:function(e,t,r){const n=e.getTimezoneOffset();if(n===0)return"Z";switch(t){case"X":return _G(n);case"XXXX":case"XX":return zy(n);case"XXXXX":case"XXX":default:return zy(n,":")}},x:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"x":return _G(n);case"xxxx":case"xx":return zy(n);case"xxxxx":case"xxx":default:return zy(n,":")}},O:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+vG(n,":");case"OOOO":default:return"GMT"+zy(n,":")}},z:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+vG(n,":");case"zzzz":default:return"GMT"+zy(n,":")}},t:function(e,t,r){const n=Math.trunc(e.getTime()/1e3);return Us(n,t.length)},T:function(e,t,r){const n=e.getTime();return Us(n,t.length)}};function vG(e,t=""){const r=e>0?"-":"+",n=Math.abs(e),s=Math.trunc(n/60),o=n%60;return o===0?r+String(s):r+String(s)+t+Us(o,2)}function _G(e,t){return e%60===0?(e>0?"-":"+")+Us(Math.abs(e)/60,2):zy(e,t)}function zy(e,t=""){const r=e>0?"-":"+",n=Math.abs(e),s=Us(Math.trunc(n/60),2),o=Us(n%60,2);return r+s+t+o}const xG=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},xie=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},Bje=(e,t)=>{const r=e.match(/(P+)(p+)?/)||[],n=r[1],s=r[2];if(!s)return xG(e,t);let o;switch(n){case"P":o=t.dateTime({width:"short"});break;case"PP":o=t.dateTime({width:"medium"});break;case"PPP":o=t.dateTime({width:"long"});break;case"PPPP":default:o=t.dateTime({width:"full"});break}return o.replace("{{date}}",xG(n,t)).replace("{{time}}",xie(s,t))},$je={p:xie,P:Bje},Uje=/^D+$/,Vje=/^Y+$/,qje=["D","DD","YY","YYYY"];function Hje(e){return Uje.test(e)}function Gje(e){return Vje.test(e)}function Wje(e,t,r){const n=Kje(e,t,r);if(console.warn(n),qje.includes(e))throw new RangeError(n)}function Kje(e,t,r){const n=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${n} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Zje=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Xje=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Yje=/^'([^]*?)'?$/,Jje=/''/g,Qje=/[a-zA-Z]/;function ps(e,t,r){var S,b,T,A,O,P,I,R;const n=uw(),s=(r==null?void 0:r.locale)??n.locale??A5,o=(r==null?void 0:r.firstWeekContainsDate)??((b=(S=r==null?void 0:r.locale)==null?void 0:S.options)==null?void 0:b.firstWeekContainsDate)??n.firstWeekContainsDate??((A=(T=n.locale)==null?void 0:T.options)==null?void 0:A.firstWeekContainsDate)??1,h=(r==null?void 0:r.weekStartsOn)??((P=(O=r==null?void 0:r.locale)==null?void 0:O.options)==null?void 0:P.weekStartsOn)??n.weekStartsOn??((R=(I=n.locale)==null?void 0:I.options)==null?void 0:R.weekStartsOn)??0,i=wi(e);if(!JCe(i))throw new RangeError("Invalid time value");let m=t.match(Xje).map(M=>{const F=M[0];if(F==="p"||F==="P"){const z=$je[F];return z(M,s.formatLong)}return M}).join("").match(Zje).map(M=>{if(M==="''")return{isToken:!1,value:"'"};const F=M[0];if(F==="'")return{isToken:!1,value:ePe(M)};if(yG[F])return{isToken:!0,value:M};if(F.match(Qje))throw new RangeError("Format string contains an unescaped latin alphabet character `"+F+"`");return{isToken:!1,value:M}});s.localize.preprocessor&&(m=s.localize.preprocessor(i,m));const y={firstWeekContainsDate:o,weekStartsOn:h,locale:s};return m.map(M=>{if(!M.isToken)return M.value;const F=M.value;(!(r!=null&&r.useAdditionalWeekYearTokens)&&Gje(F)||!(r!=null&&r.useAdditionalDayOfYearTokens)&&Hje(F))&&Wje(F,t,String(e));const z=yG[F[0]];return z(i,F,s.localize,y)}).join("")}function ePe(e){const t=e.match(Yje);return t?t[1].replace(Jje,"'"):e}function tPe(e,t,r){const n=uw(),s=(r==null?void 0:r.locale)??n.locale??A5,o=2520,h=uP(e,t);if(isNaN(h))throw new RangeError("Invalid time value");const i=Object.assign({},r,{addSuffix:r==null?void 0:r.addSuffix,comparison:h});let m,y;h>0?(m=wi(t),y=wi(e)):(m=wi(e),y=wi(t));const S=sje(y,m),b=(hb(y)-hb(m))/1e3,T=Math.round((S-b)/60);let A;if(T<2)return r!=null&&r.includeSeconds?S<5?s.formatDistance("lessThanXSeconds",5,i):S<10?s.formatDistance("lessThanXSeconds",10,i):S<20?s.formatDistance("lessThanXSeconds",20,i):S<40?s.formatDistance("halfAMinute",0,i):S<60?s.formatDistance("lessThanXMinutes",1,i):s.formatDistance("xMinutes",1,i):T===0?s.formatDistance("lessThanXMinutes",1,i):s.formatDistance("xMinutes",T,i);if(T<45)return s.formatDistance("xMinutes",T,i);if(T<90)return s.formatDistance("aboutXHours",1,i);if(T<gG){const O=Math.round(T/60);return s.formatDistance("aboutXHours",O,i)}else{if(T<o)return s.formatDistance("xDays",1,i);if(T<Cj){const O=Math.round(T/gG);return s.formatDistance("xDays",O,i)}else if(T<Cj*2)return A=Math.round(T/Cj),s.formatDistance("aboutXMonths",A,i)}if(A=ije(y,m),A<12){const O=Math.round(T/Cj);return s.formatDistance("xMonths",O,i)}else{const O=A%12,P=Math.trunc(A/12);return O<3?s.formatDistance("aboutXYears",P,i):O<9?s.formatDistance("overXYears",P,i):s.formatDistance("almostXYears",P+1,i)}}function wg(e,t){return tPe(e,YCe(e),t)}function rPe(e){const t=wi(e),r=t.getFullYear(),n=t.getMonth(),s=Yc(e,0);return s.setFullYear(r,n+1,0),s.setHours(0,0,0,0),s.getDate()}function nPe(e){return Math.trunc(+wi(e)/1e3)}function iPe(e){const t=wi(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(0,0,0,0),t}function sPe(e,t){return QCe(iPe(e),Kc(e),t)+1}function SF(e,t){const r=wi(e),n=wi(t);return r.getTime()>n.getTime()}function bie(e,t){const r=wi(e),n=wi(t);return+r<+n}function C5(e,t){const r=wi(e),n=wi(t);return r.getFullYear()===n.getFullYear()&&r.getMonth()===n.getMonth()}function aPe(e,t){const r=wi(e),n=wi(t);return r.getFullYear()===n.getFullYear()}function dP(e,t){return cc(e,-t)}function ZD(e,t){const r=wi(e),n=r.getFullYear(),s=r.getDate(),o=Yc(e,0);o.setFullYear(n,t,15),o.setHours(0,0,0,0);const h=rPe(o);return r.setMonth(t,Math.min(s,h)),r}function bG(e,t){const r=wi(e);return isNaN(+r)?Yc(e,NaN):(r.setFullYear(t),r)}const oPe=()=>{const{t:e}=ci(),{data:t=[]}=$Ce(),{data:r=0}=UCe(),n=VCe(),s=qCe(),o=(i,m)=>{m||n.mutate(i)},h=i=>{switch(i){case"comment_reply":return"";case"new_activity":return"";case"activity_update":return"";case"new_user":return"";case"merchant_joined":return"";default:return""}};return d.jsxs(lw,{children:[d.jsx(cw,{asChild:!0,children:d.jsxs(Mt,{variant:"ghost",size:"icon",className:"relative",children:[d.jsx(TQ,{className:"h-5 w-5"}),r>0&&d.jsx(sn,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-xs",children:r>9?"9+":r})]})}),d.jsxs(Jv,{align:"end",className:"w-80 max-h-[500px]",children:[d.jsxs(v5,{className:"flex items-center justify-between",children:[d.jsx("span",{children:e("notifications.title")}),r>0&&d.jsxs(Mt,{variant:"ghost",size:"sm",onClick:()=>s.mutate(),disabled:s.isPending,children:[d.jsx(b_e,{className:"h-4 w-4 mr-1"}),e("notifications.markAllRead")]})]}),d.jsx(pv,{}),d.jsx(jv,{className:"h-[400px]",children:t.length===0?d.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e("notifications.noNotifications")}):t.map(i=>d.jsx(Ta,{className:`flex flex-col items-start p-3 cursor-pointer ${i.read?"":"bg-secondary/50"}`,asChild:!0,children:d.jsx(ji,{to:i.link||"#",onClick:()=>o(i.id,i.read),children:d.jsxs("div",{className:"flex items-start gap-2 w-full",children:[d.jsx("span",{className:"text-2xl",children:h(i.type)}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsxs("div",{className:"flex items-center justify-between gap-2",children:[d.jsx("p",{className:"font-semibold text-sm truncate",children:i.title}),!i.read&&d.jsx(sn,{variant:"default",className:"h-2 w-2 p-0 rounded-full"})]}),d.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 mt-1",children:i.content}),d.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:wg(new Date(i.created_at),{addSuffix:!0})})]})]})})},i.id))})]})]})},N0=()=>{var A,O,P,I,R,M,F,z;const[e,t]=V.useState(!1),{user:r,signOut:n}=Kn(),{t:s,i18n:o}=ci(),{isAdmin:h,isSupervisor:i,isMerchant:m}=_c(),{data:y}=CN();V.useEffect(()=>{y!=null&&y.language_preference&&y.language_preference!==o.language&&o.changeLanguage(y.language_preference)},[y,o]);const S=V.useMemo(()=>[{to:"/",icon:Pa,label:s("nav.map")},{to:"/restaurants",icon:PQ,label:s("nav.restaurants")},{to:"/activities",icon:yo,label:s("nav.activities")},{to:"/map",icon:kQ,label:s("nav.mapView")},{to:"/join-us",icon:Io,label:s("nav.joinUs")}],[s]),b=V.useCallback(()=>{n(),t(!1)},[n]),T=V.useCallback(()=>{t(!1)},[]);return d.jsx("nav",{className:"fixed top-0 left-0 right-0 z-50 bg-background/95 backdrop-blur-sm border-b border-border shadow-soft",children:d.jsxs("div",{className:"w-full px-3 sm:px-4 lg:px-6 h-14 sm:h-16 flex items-center justify-between",children:[d.jsx(ji,{to:"/",className:"flex items-center gap-2",children:d.jsx("img",{src:IEe,alt:"Logo",className:"w-[35px] h-[35px] md:w-[45px] md:h-[45px] object-contain drop-shadow-md"})}),d.jsx("div",{className:"hidden lg:flex items-center gap-6",children:S.map($=>d.jsxs(ji,{to:$.to,className:"flex items-center gap-2 text-muted-foreground hover:text-primary transition-colors",children:[d.jsx($.icon,{className:"w-4 h-4"}),d.jsx("span",{children:$.label})]},$.to))}),d.jsxs("div",{className:"flex items-center gap-1 sm:gap-3",children:[d.jsx(uCe,{}),r&&d.jsx(oPe,{}),r?d.jsxs(lw,{children:[d.jsx(cw,{asChild:!0,children:d.jsx(Mt,{variant:"ghost",size:"icon",className:"rounded-full h-8 w-8 sm:h-10 sm:w-10",children:d.jsxs(Ju,{className:"w-7 h-7 sm:w-8 sm:h-8",children:[d.jsx(Qu,{src:(y==null?void 0:y.avatar_url)||((A=r.user_metadata)==null?void 0:A.avatar_url)}),d.jsx(ed,{className:"text-xs sm:text-sm",children:((P=(O=y==null?void 0:y.display_name)==null?void 0:O[0])==null?void 0:P.toUpperCase())||((M=(R=(I=r.user_metadata)==null?void 0:I.display_name)==null?void 0:R[0])==null?void 0:M.toUpperCase())||((z=(F=r.email)==null?void 0:F[0])==null?void 0:z.toUpperCase())})]})})}),d.jsxs(Jv,{align:"end",children:[d.jsx(v5,{children:s("nav.myAccount")}),d.jsx(pv,{}),d.jsx(Ta,{asChild:!0,children:d.jsxs(ji,{to:"/profile",className:"cursor-pointer",children:[d.jsx(T0,{className:"w-4 h-4 mr-2"}),s("nav.profile")]})}),(m||i)&&d.jsxs(d.Fragment,{children:[d.jsx(Ta,{asChild:!0,children:d.jsxs(ji,{to:"/merchant-restaurants",className:"cursor-pointer",children:[d.jsx(Io,{className:"w-4 h-4 mr-2"}),s("nav.manageRestaurants")]})}),d.jsx(Ta,{asChild:!0,children:d.jsxs(ji,{to:"/merchant/activity-requests",className:"cursor-pointer",children:[d.jsx(j3,{className:"w-4 h-4 mr-2"}),""]})})]}),(h||i)&&d.jsxs(d.Fragment,{children:[d.jsx(pv,{}),d.jsx(Ta,{asChild:!0,children:d.jsxs(ji,{to:"/admin",className:"cursor-pointer",children:[d.jsx(Lc,{className:"w-4 h-4 mr-2"}),s("nav.admin")]})})]}),d.jsx(pv,{}),d.jsxs(Ta,{onClick:()=>n(),className:"cursor-pointer",children:[d.jsx(F9,{className:"w-4 h-4 mr-2"}),s("nav.signOut")]})]})]}):d.jsx(Mt,{asChild:!0,className:"hidden lg:flex",children:d.jsx(ji,{to:"/auth",children:s("nav.signIn")})}),d.jsxs(Nre,{open:e,onOpenChange:t,children:[d.jsx(MTe,{asChild:!0,className:"lg:hidden",children:d.jsx(Mt,{size:"icon",className:"h-8 w-8 sm:h-10 sm:w-10 bg-primary text-primary-foreground hover:bg-primary/90 rounded-lg",children:d.jsx(NQ,{className:"w-4 sm:w-5 h-4 sm:h-5"})})}),d.jsx(o5,{side:"right",className:"w-64 sm:w-80",children:d.jsxs("div",{className:"flex flex-col gap-4 mt-8",children:[S.map($=>d.jsxs(ji,{to:$.to,onClick:T,className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[d.jsx($.icon,{className:"w-5 h-5"}),d.jsx("span",{children:$.label})]},$.to)),d.jsx("div",{className:"border-t border-border my-4"}),r?d.jsxs(d.Fragment,{children:[d.jsxs(ji,{to:"/profile",onClick:T,className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[d.jsx(T0,{className:"w-5 h-5"}),d.jsx("span",{children:s("nav.profile")})]}),(m||i)&&d.jsxs(d.Fragment,{children:[d.jsxs(ji,{to:"/merchant-restaurants",onClick:T,className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[d.jsx(Io,{className:"w-5 h-5"}),d.jsx("span",{children:s("nav.manageRestaurants")})]}),d.jsxs(ji,{to:"/merchant/activity-requests",onClick:T,className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[d.jsx(j3,{className:"w-5 h-5"}),d.jsx("span",{children:""})]})]}),(h||i)&&d.jsxs(ji,{to:"/admin",onClick:T,className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[d.jsx(Lc,{className:"w-5 h-5"}),d.jsx("span",{children:s("nav.admin")})]}),d.jsxs("button",{onClick:b,className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[d.jsx(F9,{className:"w-5 h-5"}),d.jsx("span",{children:s("nav.signOut")})]})]}):d.jsxs(ji,{to:"/auth",onClick:T,className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[d.jsx(T0,{className:"w-5 h-5"}),d.jsx("span",{children:s("nav.signIn")})]})]})})]})]})]})})};function lPe(){const{pathname:e}=Qh();return V.useEffect(()=>{window.scrollTo(0,0)},[e]),null}const Nr=V.forwardRef(({className:e,...t},r)=>d.jsx("div",{ref:r,className:fr("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));Nr.displayName="Card";const Rn=V.forwardRef(({className:e,...t},r)=>d.jsx("div",{ref:r,className:fr("flex flex-col space-y-1.5 p-6",e),...t}));Rn.displayName="CardHeader";const $n=V.forwardRef(({className:e,...t},r)=>d.jsx("h3",{ref:r,className:fr("text-2xl font-semibold leading-none tracking-tight",e),...t}));$n.displayName="CardTitle";const as=V.forwardRef(({className:e,...t},r)=>d.jsx("p",{ref:r,className:fr("text-sm text-muted-foreground",e),...t}));as.displayName="CardDescription";const Mr=V.forwardRef(({className:e,...t},r)=>d.jsx("div",{ref:r,className:fr("p-6 pt-0",e),...t}));Mr.displayName="CardContent";const kN=V.forwardRef(({className:e,...t},r)=>d.jsx("div",{ref:r,className:fr("flex items-center p-6 pt-0",e),...t}));kN.displayName="CardFooter";const wG="/assets/sushi-ramen-hero-kMMmiTPz.jpg",cPe="/assets/sushi-ramen-mobile-BHV96LaL.jpg",uPe="/assets/map-icon-CwlHKRle.png",wie="00000000-0000-0000-0000-000000000001",Sie=()=>ei({queryKey:["homepage-config"],queryFn:async()=>{const{data:e,error:t}=await Ct.from("homepage_config").select("*").eq("id",wie).single();if(t)throw t;return e}}),dPe=()=>{const e=Mi();return Gi({mutationFn:async t=>{const{data:r,error:n}=await Ct.from("homepage_config").update(t).eq("id",wie).select().single();if(n)throw n;return r},onSuccess:()=>{e.invalidateQueries({queryKey:["homepage-config"]}),kr.success("")},onError:t=>{console.error("Failed to update homepage config:",t),kr.error("")}})},hPe=()=>{const e=Mi();return Gi({mutationFn:async({file:t,type:r})=>{const n=t.name.split(".").pop(),o=`${r}-${Date.now()}.${n}`,{error:h}=await Ct.storage.from("homepage-images").upload(o,t,{upsert:!0});if(h)throw h;const{data:{publicUrl:i}}=Ct.storage.from("homepage-images").getPublicUrl(o);return{type:r,url:i}},onSuccess:({type:t,url:r})=>{e.invalidateQueries({queryKey:["homepage-config"]}),kr.success(`${t}`)},onError:t=>{console.error("Failed to upload image:",t),kr.error("")}})},Eie=V.memo(({stats:e,t})=>d.jsx("div",{className:"absolute top-3 sm:top-4 left-3 z-20",children:d.jsxs("div",{className:"gap-4 w-fit flex-col flex items-start justify-start",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(oT,{className:"w-4 h-4 text-primary"}),d.jsx("span",{className:"text-sm text-white/90 drop-shadow-md",children:t("home.stats.delivery")}),d.jsx("span",{className:"font-bold text-white text-sm drop-shadow-md",children:e.order_count})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(v_e,{className:"w-4 h-4 text-accent"}),d.jsx("span",{className:"text-sm text-white/90 drop-shadow-md",children:t("home.stats.reservation")}),d.jsx("span",{className:"font-bold text-white text-sm drop-shadow-md",children:e.reserve_count})]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-xl sm:text-2xl font-bold text-white drop-shadow-md",children:t("home.hero.brandName")}),d.jsx("img",{src:uPe,alt:"map icon",className:"w-5 sm:w-8 h-5 sm:h-8 object-contain flex-shrink-0"})]})]})}));Eie.displayName="StatsDisplay";const hP=V.memo(({to:e,Icon:t,title:r,desc:n,iconBg:s,iconColor:o,hoverBorderColor:h})=>d.jsx(ji,{to:e,children:d.jsxs(Nr,{className:`group p-6 sm:p-8 border-border/50 ${h} transition-all hover:shadow-large cursor-pointer h-full`,children:[d.jsx("div",{className:`w-14 sm:w-16 h-14 sm:h-16 rounded-2xl ${s} flex items-center justify-center mb-4 sm:mb-6 group-hover:scale-110 transition-transform`,children:d.jsx(t,{className:`w-7 sm:w-8 h-7 sm:h-8 ${o}`})}),d.jsx("h3",{className:"text-xl sm:text-2xl font-semibold mb-2 sm:mb-3 text-card-foreground",children:r}),d.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground leading-relaxed flex items-center gap-2",children:[n,d.jsx(EQ,{className:"w-4 h-4 flex-shrink-0 group-hover:translate-x-1 transition-transform"})]})]})}));hP.displayName="FeatureCard";const fPe=()=>{const{t:e,i18n:t}=ci(),{data:r}=Sie(),[n,s]=V.useState(null);V.useEffect(()=>{(async()=>{try{const I=await(await fetch("https://v.xiaoxiong.pt/api/get_info")).json();I&&s({order_count:I.order_count||0,reserve_count:I.reserve_count||0})}catch(P){console.error("Failed to fetch stats:",P)}})()},[]);const o=t.language,h=O=>r&&r[`${O}${o==="zh"?"_zh":o==="pt"?"_pt":"_en"}`]||"",i=()=>window.innerWidth<640?"mobile":window.innerWidth<1024?"tablet":"desktop",m=()=>{if(!r)return .3;const O=i();return O==="mobile"&&r.mobile_overlay_opacity!==null&&r.mobile_overlay_opacity!==void 0?r.mobile_overlay_opacity:O==="tablet"&&r.tablet_overlay_opacity!==null&&r.tablet_overlay_opacity!==void 0?r.tablet_overlay_opacity:O==="desktop"&&r.desktop_overlay_opacity!==null&&r.desktop_overlay_opacity!==void 0?r.desktop_overlay_opacity:r.overlay_opacity!==null&&r.overlay_opacity!==void 0?r.overlay_opacity:.3},y=()=>{if(!r)return{background:"linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.25), rgba(0,0,0,0.4))"};const O=m(),P=r.overlay_gradient_direction||"to-b",I=(re,te)=>re==null?te/100:re>1?re/100:re,R=O>1?O/100:O,M=I(r.overlay_gradient_from_opacity,30)*R,F=I(r.overlay_gradient_via_opacity,25)*R,z=I(r.overlay_gradient_to_opacity,40)*R,W={"to-t":"to top","to-b":"to bottom","to-l":"to left","to-r":"to right","to-tl":"to top left","to-tr":"to top right","to-bl":"to bottom left","to-br":"to bottom right"}[P]||"to bottom",K={black:"0, 0, 0",white:"255, 255, 255",background:"0, 0, 0",foreground:"255, 255, 255",primary:"1, 100, 80",secondary:"240, 240, 240"},ee=K[r.overlay_gradient_from||"black"]||"0, 0, 0",ne=K[r.overlay_gradient_via||"black"]||"0, 0, 0",ie=K[r.overlay_gradient_to||"black"]||"0, 0, 0";return{background:`linear-gradient(${W}, rgba(${ee}, ${M}), rgba(${ne}, ${F}), rgba(${ie}, ${z}))`}},S=(r==null?void 0:r.mobile_image_url)||cPe,b=(r==null?void 0:r.tablet_image_url)||(r==null?void 0:r.desktop_image_url)||wG,T=(r==null?void 0:r.desktop_image_url)||wG,A=(r==null?void 0:r.background_blur)||0;return d.jsxs("div",{className:"min-h-screen",children:[d.jsxs("section",{className:"relative min-h-screen flex items-start overflow-hidden bg-background",children:[d.jsxs("div",{className:"absolute inset-0 w-full h-full",children:[d.jsx("img",{src:S,alt:"Background",className:"absolute inset-0 w-full h-full object-cover object-center sm:hidden",style:{filter:A>0?`blur(${A}px)`:void 0}}),d.jsx("img",{src:b,alt:"Background",className:"absolute inset-0 w-full h-full object-cover object-center hidden sm:block lg:hidden",style:{filter:A>0?`blur(${A}px)`:void 0}}),d.jsx("img",{src:T,alt:"Background",className:"absolute inset-0 w-full h-full object-cover object-center hidden lg:block",style:{filter:A>0?`blur(${A}px)`:void 0}}),d.jsx("div",{className:"absolute inset-0 w-full h-full",style:y()})]}),(r==null?void 0:r.show_stats)!==!1&&n&&d.jsx(Eie,{stats:n,t:e}),d.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 flex items-center min-h-screen",children:d.jsxs("div",{className:"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full",children:[d.jsx(Mt,{size:"lg",asChild:!0,className:"text-base sm:text-lg shadow-lg hover:shadow-xl transition-shadow",children:d.jsxs(ji,{to:(r==null?void 0:r.subtitle_button_link)||"/map",children:[d.jsx(Pa,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),h("subtitle_button_text")||e("home.hero.subtitle")]})}),d.jsx("h1",{className:"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]",children:h("title")||e("home.hero.title")}),d.jsx("p",{className:"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]",children:h("description")||e("home.hero.description")}),d.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center pt-2 sm:pt-4 px-4",children:[d.jsx(Mt,{size:"lg",asChild:!0,className:"text-base sm:text-lg shadow-lg hover:shadow-xl transition-shadow w-full sm:w-auto",children:d.jsxs(ji,{to:(r==null?void 0:r.primary_button_link)||"/restaurants",children:[d.jsx(Xh,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),h("primary_button_text")||e("home.hero.exploreBtn")]})}),d.jsx(Mt,{size:"lg",variant:"outline",asChild:!0,className:"text-base sm:text-lg w-full sm:w-auto backdrop-blur-sm",children:d.jsxs(ji,{to:(r==null?void 0:r.secondary_button_link)||"/activities",children:[d.jsx(yo,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),h("secondary_button_text")||e("home.hero.activitiesBtn")]})})]})]})})]}),d.jsx("section",{className:"py-16 sm:py-24 px-4 bg-secondary/20",children:d.jsxs("div",{className:"container mx-auto max-w-6xl",children:[d.jsxs("div",{className:"text-center mb-12 sm:mb-16",children:[d.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-foreground mb-3 sm:mb-4",children:e("home.features.title")}),d.jsx("p",{className:"text-base sm:text-lg text-muted-foreground max-w-2xl mx-auto px-4",children:e("home.features.description")})]}),d.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 sm:gap-8",children:[d.jsx(hP,{to:"/map",Icon:Pa,title:e("home.features.map.title"),desc:e("home.features.map.desc"),iconBg:"bg-gradient-to-br from-primary to-primary-light",iconColor:"text-primary-foreground",hoverBorderColor:"hover:border-primary/50"}),d.jsx(hP,{to:"/restaurants",Icon:Al,title:e("home.features.reviews.title"),desc:e("home.features.reviews.desc"),iconBg:"bg-gradient-to-br from-accent to-warning",iconColor:"text-accent-foreground",hoverBorderColor:"hover:border-accent/50"}),d.jsx("div",{className:"sm:col-span-2 md:col-span-1",children:d.jsx(hP,{to:"/activities",Icon:yo,title:e("home.features.events.title"),desc:e("home.features.events.desc"),iconBg:"bg-gradient-to-br from-success to-accent",iconColor:"text-white",hoverBorderColor:"hover:border-success/50"})})]})]})}),d.jsxs("section",{className:"py-16 sm:py-20 px-4 bg-gradient-to-br from-primary via-primary-glow to-primary-light relative overflow-hidden",children:[d.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),d.jsx("div",{className:"absolute top-0 right-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl"}),d.jsx("div",{className:"absolute bottom-0 left-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl"}),d.jsxs("div",{className:"container mx-auto max-w-4xl text-center relative z-10",children:[d.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-primary-foreground mb-4 sm:mb-6 px-4",children:e("home.cta.title")}),d.jsx("p",{className:"text-base sm:text-xl text-primary-foreground/90 mb-6 sm:mb-8 max-w-2xl mx-auto px-4",children:e("home.cta.description")}),d.jsx(Mt,{size:"lg",variant:"secondary",asChild:!0,className:"text-base sm:text-lg shadow-xl hover:shadow-2xl w-full sm:w-auto mx-4",children:d.jsxs(ji,{to:"/join-us",children:[d.jsx(nb,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),e("home.cta.button")]})})]})]})]})},cr=V.forwardRef(({className:e,type:t,...r},n)=>d.jsx("input",{type:t,className:fr("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:n,...r}));cr.displayName="Input";var NN="Popover",[Tie,cst]=Mo(NN,[_g]),M2=_g(),[pPe,Sg]=Tie(NN),Aie=e=>{const{__scopePopover:t,children:r,open:n,defaultOpen:s,onOpenChange:o,modal:h=!1}=e,i=M2(t),m=V.useRef(null),[y,S]=V.useState(!1),[b,T]=Zc({prop:n,defaultProp:s??!1,onChange:o,caller:NN});return d.jsx(oN,{...i,children:d.jsx(pPe,{scope:t,contentId:_u(),triggerRef:m,open:b,onOpenChange:T,onOpenToggle:V.useCallback(()=>T(A=>!A),[T]),hasCustomAnchor:y,onCustomAnchorAdd:V.useCallback(()=>S(!0),[]),onCustomAnchorRemove:V.useCallback(()=>S(!1),[]),modal:h,children:r})})};Aie.displayName=NN;var Cie="PopoverAnchor",mPe=V.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,s=Sg(Cie,r),o=M2(r),{onCustomAnchorAdd:h,onCustomAnchorRemove:i}=s;return V.useEffect(()=>(h(),()=>i()),[h,i]),d.jsx(E2,{...o,...n,ref:t})});mPe.displayName=Cie;var jie="PopoverTrigger",Pie=V.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,s=Sg(jie,r),o=M2(r),h=Un(t,s.triggerRef),i=d.jsx(ln.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":Rie(s.open),...n,ref:h,onClick:Ir(e.onClick,s.onOpenToggle)});return s.hasCustomAnchor?i:d.jsx(E2,{asChild:!0,...o,children:i})});Pie.displayName=jie;var j5="PopoverPortal",[gPe,yPe]=Tie(j5,{forceMount:void 0}),Oie=e=>{const{__scopePopover:t,forceMount:r,children:n,container:s}=e,o=Sg(j5,t);return d.jsx(gPe,{scope:t,forceMount:r,children:d.jsx(Do,{present:r||o.open,children:d.jsx(Yb,{asChild:!0,container:s,children:n})})})};Oie.displayName=j5;var pb="PopoverContent",kie=V.forwardRef((e,t)=>{const r=yPe(pb,e.__scopePopover),{forceMount:n=r.forceMount,...s}=e,o=Sg(pb,e.__scopePopover);return d.jsx(Do,{present:n||o.open,children:o.modal?d.jsx(_Pe,{...s,ref:t}):d.jsx(xPe,{...s,ref:t})})});kie.displayName=pb;var vPe=lg("PopoverContent.RemoveScroll"),_Pe=V.forwardRef((e,t)=>{const r=Sg(pb,e.__scopePopover),n=V.useRef(null),s=Un(t,n),o=V.useRef(!1);return V.useEffect(()=>{const h=n.current;if(h)return xN(h)},[]),d.jsx(C2,{as:vPe,allowPinchZoom:!0,children:d.jsx(Nie,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ir(e.onCloseAutoFocus,h=>{var i;h.preventDefault(),o.current||(i=r.triggerRef.current)==null||i.focus()}),onPointerDownOutside:Ir(e.onPointerDownOutside,h=>{const i=h.detail.originalEvent,m=i.button===0&&i.ctrlKey===!0,y=i.button===2||m;o.current=y},{checkForDefaultPrevented:!1}),onFocusOutside:Ir(e.onFocusOutside,h=>h.preventDefault(),{checkForDefaultPrevented:!1})})})}),xPe=V.forwardRef((e,t)=>{const r=Sg(pb,e.__scopePopover),n=V.useRef(!1),s=V.useRef(!1);return d.jsx(Nie,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var h,i;(h=e.onCloseAutoFocus)==null||h.call(e,o),o.defaultPrevented||(n.current||(i=r.triggerRef.current)==null||i.focus(),o.preventDefault()),n.current=!1,s.current=!1},onInteractOutside:o=>{var m,y;(m=e.onInteractOutside)==null||m.call(e,o),o.defaultPrevented||(n.current=!0,o.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const h=o.target;((y=r.triggerRef.current)==null?void 0:y.contains(h))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&s.current&&o.preventDefault()}})}),Nie=V.forwardRef((e,t)=>{const{__scopePopover:r,trapFocus:n,onOpenAutoFocus:s,onCloseAutoFocus:o,disableOutsidePointerEvents:h,onEscapeKeyDown:i,onPointerDownOutside:m,onFocusOutside:y,onInteractOutside:S,...b}=e,T=Sg(pb,r),A=M2(r);return vN(),d.jsx(A2,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:s,onUnmountAutoFocus:o,children:d.jsx(Gv,{asChild:!0,disableOutsidePointerEvents:h,onInteractOutside:S,onEscapeKeyDown:i,onPointerDownOutside:m,onFocusOutside:y,onDismiss:()=>T.onOpenChange(!1),children:d.jsx(lN,{"data-state":Rie(T.open),role:"dialog",id:T.contentId,...A,...b,ref:t,style:{...b.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Iie="PopoverClose",bPe=V.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,s=Sg(Iie,r);return d.jsx(ln.button,{type:"button",...n,ref:t,onClick:Ir(e.onClick,()=>s.onOpenChange(!1))})});bPe.displayName=Iie;var wPe="PopoverArrow",SPe=V.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,s=M2(r);return d.jsx(cN,{...s,...n,ref:t})});SPe.displayName=wPe;function Rie(e){return e?"open":"closed"}var EPe=Aie,TPe=Pie,APe=Oie,Mie=kie;const _T=EPe,xT=TPe,mb=V.forwardRef(({className:e,align:t="center",sideOffset:r=4,...n},s)=>d.jsx(APe,{children:d.jsx(Mie,{ref:s,align:t,sideOffset:r,className:fr("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));mb.displayName=Mie.displayName;const P5=(e,t)=>ei({queryKey:["restaurants",e,t],queryFn:async()=>{let r=Ct.from("restaurants").select("*").eq("visible",!0).order("rating",{ascending:!1});if(e&&(r=r.or(`name.ilike.%${e}%,address.ilike.%${e}%`)),t){const h=t.split(",").flatMap(i=>[`type.cs.{${i}}`,`type_en.cs.{${i}}`,`type_pt.cs.{${i}}`]);r=r.or(h.join(","))}const{data:n,error:s}=await r;if(s)throw s;return n}}),CPe=e=>ei({queryKey:["restaurant",e],queryFn:async()=>{const{data:t,error:r}=await Ct.from("restaurants").select("*").eq("id",e).single();if(r)throw r;return t},enabled:!!e}),Die=()=>{const{user:e}=Kn();return ei({queryKey:["favorites",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ct.from("favorites").select("restaurant_id").eq("user_id",e.id);if(r)throw r;return t.map(n=>n.restaurant_id)},enabled:!!e})},Lie=()=>{const{user:e}=Kn(),t=Mi();return Gi({mutationFn:async r=>{if(!e)throw new Error("Must be logged in");const{data:n}=await Ct.from("favorites").select("id").eq("user_id",e.id).eq("restaurant_id",r).maybeSingle();if(n){const{error:s}=await Ct.from("favorites").delete().eq("id",n.id);if(s)throw s;return{action:"removed"}}else{const{error:s}=await Ct.from("favorites").insert({user_id:e.id,restaurant_id:r});if(s)throw s;return{action:"added"}}},onSuccess:r=>{t.invalidateQueries({queryKey:["favorites"]}),kr.success(Pr.t(r.action==="added"?"toast.favoriteAdded":"toast.favoriteRemoved"))},onError:r=>{r.message==="Must be logged in"?kr.error(Pr.t("toast.signInToFavorite")):kr.error(Pr.t("toast.favoritesUpdateFailed"))}})},Fie=()=>ei({queryKey:["restaurant-types",Pr.language],queryFn:async()=>{const e=Pr.language,t=e==="zh"?"type":e==="pt"?"type_pt":"type_en",{data:r,error:n}=await Ct.from("restaurants").select("type, type_en, type_pt").order("type");if(n)throw n;const s=r.flatMap(h=>h[t]||h.type_en||h.type||[]);return Array.from(new Set(s)).sort()}}),D2=(e,t,r,n)=>{const o=jj(r-e),h=jj(n-t),i=Math.sin(o/2)*Math.sin(o/2)+Math.cos(jj(e))*Math.cos(jj(r))*Math.sin(h/2)*Math.sin(h/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))},jj=e=>e*Math.PI/180,IN=()=>new Promise((e,t)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e,t,{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):t(new Error("Geolocation is not supported by this browser."))}),zie=(e,t,r)=>{const n=/iPad|iPhone|iPod/.test(navigator.userAgent),s=/Android/.test(navigator.userAgent);n?window.open(`maps://maps.apple.com/?daddr=${e},${t}&q=${encodeURIComponent(r)}`,"_blank"):s?window.open(`geo:${e},${t}?q=${e},${t}(${encodeURIComponent(r)})`,"_blank"):window.open(`https://www.google.com/maps/dir/?api=1&destination=${e},${t}`,"_blank")};var Bie={exports:{}};(function(e,t){(function(r,n){e.exports=n()})($c,function(){var r,n,s;function o(i,m){if(!r)r=m;else if(!n)n=m;else{var y="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",S={};r(S),s=m(S),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(s.workerUrl=window.URL.createObjectURL(new Blob([y],{type:"text/javascript"})))}}o(["exports"],function(i){var m=1e-6,y=typeof Float32Array<"u"?Float32Array:Array;function S(u,a){var c=a[0],p=a[1],g=a[2],x=a[3],w=c*x-g*p;return w?(u[0]=x*(w=1/w),u[1]=-p*w,u[2]=-g*w,u[3]=c*w,u):null}function b(){var u=new y(9);return y!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}function T(u,a){var c=a[0],p=a[1],g=a[2],x=a[3],w=a[4],C=a[5],N=a[6],D=a[7],U=a[8];return u[0]=w*U-C*D,u[1]=g*D-p*U,u[2]=p*C-g*w,u[3]=C*N-x*U,u[4]=c*U-g*N,u[5]=g*x-c*C,u[6]=x*D-w*N,u[7]=p*N-c*D,u[8]=c*w-p*x,u}function A(u,a,c){var p=a[0],g=a[1],x=a[2],w=a[3],C=a[4],N=a[5],D=a[6],U=a[7],q=a[8],H=c[0],Y=c[1],J=c[2],oe=c[3],ce=c[4],he=c[5],Se=c[6],Te=c[7],ke=c[8];return u[0]=H*p+Y*w+J*D,u[1]=H*g+Y*C+J*U,u[2]=H*x+Y*N+J*q,u[3]=oe*p+ce*w+he*D,u[4]=oe*g+ce*C+he*U,u[5]=oe*x+ce*N+he*q,u[6]=Se*p+Te*w+ke*D,u[7]=Se*g+Te*C+ke*U,u[8]=Se*x+Te*N+ke*q,u}function O(){var u=new y(16);return y!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u}function P(u){var a=new y(16);return a[0]=u[0],a[1]=u[1],a[2]=u[2],a[3]=u[3],a[4]=u[4],a[5]=u[5],a[6]=u[6],a[7]=u[7],a[8]=u[8],a[9]=u[9],a[10]=u[10],a[11]=u[11],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15],a}function I(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function R(u,a){var c=a[0],p=a[1],g=a[2],x=a[3],w=a[4],C=a[5],N=a[6],D=a[7],U=a[8],q=a[9],H=a[10],Y=a[11],J=a[12],oe=a[13],ce=a[14],he=a[15],Se=c*C-p*w,Te=c*N-g*w,ke=c*D-x*w,qe=p*N-g*C,Fe=p*D-x*C,Xe=g*D-x*N,et=U*oe-q*J,it=U*ce-H*J,At=U*he-Y*J,pt=q*ce-H*oe,jt=q*he-Y*oe,Rt=H*he-Y*ce,zt=Se*Rt-Te*jt+ke*pt+qe*At-Fe*it+Xe*et;return zt?(u[0]=(C*Rt-N*jt+D*pt)*(zt=1/zt),u[1]=(g*jt-p*Rt-x*pt)*zt,u[2]=(oe*Xe-ce*Fe+he*qe)*zt,u[3]=(H*Fe-q*Xe-Y*qe)*zt,u[4]=(N*At-w*Rt-D*it)*zt,u[5]=(c*Rt-g*At+x*it)*zt,u[6]=(ce*ke-J*Xe-he*Te)*zt,u[7]=(U*Xe-H*ke+Y*Te)*zt,u[8]=(w*jt-C*At+D*et)*zt,u[9]=(p*At-c*jt-x*et)*zt,u[10]=(J*Fe-oe*ke+he*Se)*zt,u[11]=(q*ke-U*Fe-Y*Se)*zt,u[12]=(C*it-w*pt-N*et)*zt,u[13]=(c*pt-p*it+g*et)*zt,u[14]=(oe*Te-J*qe-ce*Se)*zt,u[15]=(U*qe-q*Te+H*Se)*zt,u):null}function M(u,a,c){var p=a[0],g=a[1],x=a[2],w=a[3],C=a[4],N=a[5],D=a[6],U=a[7],q=a[8],H=a[9],Y=a[10],J=a[11],oe=a[12],ce=a[13],he=a[14],Se=a[15],Te=c[0],ke=c[1],qe=c[2],Fe=c[3];return u[0]=Te*p+ke*C+qe*q+Fe*oe,u[1]=Te*g+ke*N+qe*H+Fe*ce,u[2]=Te*x+ke*D+qe*Y+Fe*he,u[3]=Te*w+ke*U+qe*J+Fe*Se,u[4]=(Te=c[4])*p+(ke=c[5])*C+(qe=c[6])*q+(Fe=c[7])*oe,u[5]=Te*g+ke*N+qe*H+Fe*ce,u[6]=Te*x+ke*D+qe*Y+Fe*he,u[7]=Te*w+ke*U+qe*J+Fe*Se,u[8]=(Te=c[8])*p+(ke=c[9])*C+(qe=c[10])*q+(Fe=c[11])*oe,u[9]=Te*g+ke*N+qe*H+Fe*ce,u[10]=Te*x+ke*D+qe*Y+Fe*he,u[11]=Te*w+ke*U+qe*J+Fe*Se,u[12]=(Te=c[12])*p+(ke=c[13])*C+(qe=c[14])*q+(Fe=c[15])*oe,u[13]=Te*g+ke*N+qe*H+Fe*ce,u[14]=Te*x+ke*D+qe*Y+Fe*he,u[15]=Te*w+ke*U+qe*J+Fe*Se,u}function F(u,a,c){var p,g,x,w,C,N,D,U,q,H,Y,J,oe=c[0],ce=c[1],he=c[2];return a===u?(u[12]=a[0]*oe+a[4]*ce+a[8]*he+a[12],u[13]=a[1]*oe+a[5]*ce+a[9]*he+a[13],u[14]=a[2]*oe+a[6]*ce+a[10]*he+a[14],u[15]=a[3]*oe+a[7]*ce+a[11]*he+a[15]):(g=a[1],x=a[2],w=a[3],C=a[4],N=a[5],D=a[6],U=a[7],q=a[8],H=a[9],Y=a[10],J=a[11],u[0]=p=a[0],u[1]=g,u[2]=x,u[3]=w,u[4]=C,u[5]=N,u[6]=D,u[7]=U,u[8]=q,u[9]=H,u[10]=Y,u[11]=J,u[12]=p*oe+C*ce+q*he+a[12],u[13]=g*oe+N*ce+H*he+a[13],u[14]=x*oe+D*ce+Y*he+a[14],u[15]=w*oe+U*ce+J*he+a[15]),u}function z(u,a,c){var p=c[0],g=c[1],x=c[2];return u[0]=a[0]*p,u[1]=a[1]*p,u[2]=a[2]*p,u[3]=a[3]*p,u[4]=a[4]*g,u[5]=a[5]*g,u[6]=a[6]*g,u[7]=a[7]*g,u[8]=a[8]*x,u[9]=a[9]*x,u[10]=a[10]*x,u[11]=a[11]*x,u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15],u}function $(u,a,c){var p=Math.sin(c),g=Math.cos(c),x=a[4],w=a[5],C=a[6],N=a[7],D=a[8],U=a[9],q=a[10],H=a[11];return a!==u&&(u[0]=a[0],u[1]=a[1],u[2]=a[2],u[3]=a[3],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15]),u[4]=x*g+D*p,u[5]=w*g+U*p,u[6]=C*g+q*p,u[7]=N*g+H*p,u[8]=D*g-x*p,u[9]=U*g-w*p,u[10]=q*g-C*p,u[11]=H*g-N*p,u}function W(u,a,c){var p=Math.sin(c),g=Math.cos(c),x=a[0],w=a[1],C=a[2],N=a[3],D=a[8],U=a[9],q=a[10],H=a[11];return a!==u&&(u[4]=a[4],u[5]=a[5],u[6]=a[6],u[7]=a[7],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15]),u[0]=x*g-D*p,u[1]=w*g-U*p,u[2]=C*g-q*p,u[3]=N*g-H*p,u[8]=x*p+D*g,u[9]=w*p+U*g,u[10]=C*p+q*g,u[11]=N*p+H*g,u}function K(u,a,c){var p=Math.sin(c),g=Math.cos(c),x=a[0],w=a[1],C=a[2],N=a[3],D=a[4],U=a[5],q=a[6],H=a[7];return a!==u&&(u[8]=a[8],u[9]=a[9],u[10]=a[10],u[11]=a[11],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15]),u[0]=x*g+D*p,u[1]=w*g+U*p,u[2]=C*g+q*p,u[3]=N*g+H*p,u[4]=D*g-x*p,u[5]=U*g-w*p,u[6]=q*g-C*p,u[7]=H*g-N*p,u}function ee(u,a){return u[0]=a[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=a[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=a[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function ne(u,a,c){var p,g,x,w=c[0],C=c[1],N=c[2],D=Math.sqrt(w*w+C*C+N*N);return D<m?null:(w*=D=1/D,C*=D,N*=D,p=Math.sin(a),g=Math.cos(a),u[0]=w*w*(x=1-g)+g,u[1]=C*w*x+N*p,u[2]=N*w*x-C*p,u[3]=0,u[4]=w*C*x-N*p,u[5]=C*C*x+g,u[6]=N*C*x+w*p,u[7]=0,u[8]=w*N*x+C*p,u[9]=C*N*x-w*p,u[10]=N*N*x+g,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u)}function ie(u,a){var c=a[0],p=a[1],g=a[2],x=a[4],w=a[5],C=a[6],N=a[8],D=a[9],U=a[10];return u[0]=Math.sqrt(c*c+p*p+g*g),u[1]=Math.sqrt(x*x+w*w+C*C),u[2]=Math.sqrt(N*N+D*D+U*U),u}function re(u,a){var c=a[0],p=a[1],g=a[2],x=a[3],w=c+c,C=p+p,N=g+g,D=c*w,U=p*w,q=p*C,H=g*w,Y=g*C,J=g*N,oe=x*w,ce=x*C,he=x*N;return u[0]=1-q-J,u[1]=U+he,u[2]=H-ce,u[3]=0,u[4]=U-he,u[5]=1-D-J,u[6]=Y+oe,u[7]=0,u[8]=H+ce,u[9]=Y-oe,u[10]=1-D-q,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}var te=M;function ae(){var u=new y(3);return y!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u}function ue(u){var a=new y(3);return a[0]=u[0],a[1]=u[1],a[2]=u[2],a}function be(u){var a=u[0],c=u[1],p=u[2];return Math.sqrt(a*a+c*c+p*p)}function we(u,a,c){var p=new y(3);return p[0]=u,p[1]=a,p[2]=c,p}function Ce(u,a,c,p){return u[0]=a,u[1]=c,u[2]=p,u}function _e(u,a,c){return u[0]=a[0]+c[0],u[1]=a[1]+c[1],u[2]=a[2]+c[2],u}function me(u,a,c){return u[0]=a[0]-c[0],u[1]=a[1]-c[1],u[2]=a[2]-c[2],u}function Ae(u,a,c){return u[0]=a[0]*c[0],u[1]=a[1]*c[1],u[2]=a[2]*c[2],u}function ge(u,a,c){return u[0]=Math.min(a[0],c[0]),u[1]=Math.min(a[1],c[1]),u[2]=Math.min(a[2],c[2]),u}function pe(u,a,c){return u[0]=Math.max(a[0],c[0]),u[1]=Math.max(a[1],c[1]),u[2]=Math.max(a[2],c[2]),u}function Oe(u,a,c){return u[0]=a[0]*c,u[1]=a[1]*c,u[2]=a[2]*c,u}function Je(u,a,c,p){return u[0]=a[0]+c[0]*p,u[1]=a[1]+c[1]*p,u[2]=a[2]+c[2]*p,u}function Ze(u,a){var c=a[0]-u[0],p=a[1]-u[1],g=a[2]-u[2];return Math.sqrt(c*c+p*p+g*g)}function Pe(u,a){var c=a[0]-u[0],p=a[1]-u[1],g=a[2]-u[2];return c*c+p*p+g*g}function Be(u){var a=u[0],c=u[1],p=u[2];return a*a+c*c+p*p}function nt(u,a){return u[0]=-a[0],u[1]=-a[1],u[2]=-a[2],u}function Me(u,a){var c=a[0],p=a[1],g=a[2],x=c*c+p*p+g*g;return x>0&&(x=1/Math.sqrt(x)),u[0]=a[0]*x,u[1]=a[1]*x,u[2]=a[2]*x,u}function We(u,a){return u[0]*a[0]+u[1]*a[1]+u[2]*a[2]}function gt(u,a,c){var p=a[0],g=a[1],x=a[2],w=c[0],C=c[1],N=c[2];return u[0]=g*N-x*C,u[1]=x*w-p*N,u[2]=p*C-g*w,u}function rt(u,a,c,p){var g=a[0],x=a[1],w=a[2];return u[0]=g+p*(c[0]-g),u[1]=x+p*(c[1]-x),u[2]=w+p*(c[2]-w),u}function Ht(u,a,c){var p=a[0],g=a[1],x=a[2],w=c[3]*p+c[7]*g+c[11]*x+c[15];return u[0]=(c[0]*p+c[4]*g+c[8]*x+c[12])/(w=w||1),u[1]=(c[1]*p+c[5]*g+c[9]*x+c[13])/w,u[2]=(c[2]*p+c[6]*g+c[10]*x+c[14])/w,u}function Lt(u,a,c){var p=a[0],g=a[1],x=a[2];return u[0]=p*c[0]+g*c[3]+x*c[6],u[1]=p*c[1]+g*c[4]+x*c[7],u[2]=p*c[2]+g*c[5]+x*c[8],u}function nr(u,a,c){var p=c[0],g=c[1],x=c[2],w=c[3],C=a[0],N=a[1],D=a[2],U=g*D-x*N,q=x*C-p*D,H=p*N-g*C;return u[0]=C+w*(U+=U)+g*(H+=H)-x*(q+=q),u[1]=N+w*q+x*U-p*H,u[2]=D+w*H+p*q-g*U,u}function Rr(u){return u[0]=0,u[1]=0,u[2]=0,u}function Dr(u,a){return u[0]===a[0]&&u[1]===a[1]&&u[2]===a[2]}var Pt=me,wt=Ae,He=be;function lt(){var u=new y(4);return y!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0,u[3]=0),u}function ut(u,a,c){return u[0]=a[0]*c,u[1]=a[1]*c,u[2]=a[2]*c,u[3]=a[3]*c,u}function sr(u,a){var c=a[0],p=a[1],g=a[2],x=a[3],w=c*c+p*p+g*g+x*x;return w>0&&(w=1/Math.sqrt(w)),u[0]=c*w,u[1]=p*w,u[2]=g*w,u[3]=x*w,u}function Qt(u,a,c){var p=a[0],g=a[1],x=a[2],w=a[3];return u[0]=c[0]*p+c[4]*g+c[8]*x+c[12]*w,u[1]=c[1]*p+c[5]*g+c[9]*x+c[13]*w,u[2]=c[2]*p+c[6]*g+c[10]*x+c[14]*w,u[3]=c[3]*p+c[7]*g+c[11]*x+c[15]*w,u}function er(){var u=new y(4);return y!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u[3]=1,u}function Cr(u){return u[0]=0,u[1]=0,u[2]=0,u[3]=1,u}function dn(u,a,c){c*=.5;var p=a[0],g=a[1],x=a[2],w=a[3],C=Math.sin(c),N=Math.cos(c);return u[0]=p*N+w*C,u[1]=g*N+x*C,u[2]=x*N-g*C,u[3]=w*N-p*C,u}function fn(u,a,c){c*=.5;var p=a[0],g=a[1],x=a[2],w=a[3],C=Math.sin(c),N=Math.cos(c);return u[0]=p*N-x*C,u[1]=g*N+w*C,u[2]=x*N+p*C,u[3]=w*N-g*C,u}ae(),lt();var Zn,Gn,Di,ka=sr,xs=(Zn=ae(),Gn=we(1,0,0),Di=we(0,1,0),function(u,a,c){var p=We(a,c);return p<-.999999?(gt(Zn,Gn,a),He(Zn)<1e-6&&gt(Zn,Di,a),Me(Zn,Zn),function(g,x,w){w*=.5;var C=Math.sin(w);g[0]=C*x[0],g[1]=C*x[1],g[2]=C*x[2],g[3]=Math.cos(w)}(u,Zn,Math.PI),u):p>.999999?(u[0]=0,u[1]=0,u[2]=0,u[3]=1,u):(gt(Zn,a,c),u[0]=Zn[0],u[1]=Zn[1],u[2]=Zn[2],u[3]=1+p,ka(u,u))});function mi(){var u=new y(2);return y!=Float32Array&&(u[0]=0,u[1]=0),u}function Ua(u,a){var c=new y(2);return c[0]=u,c[1]=a,c}function Va(u,a,c){return u[0]=a,u[1]=c,u}function Lo(u,a,c){return u[0]=a[0]+c[0],u[1]=a[1]+c[1],u}function qa(u,a,c){return u[0]=a[0]-c[0],u[1]=a[1]-c[1],u}function Ha(u,a,c){return u[0]=a[0]*c,u[1]=a[1]*c,u}function Fi(u){var a=u[0],c=u[1];return Math.sqrt(a*a+c*c)}function Ks(u,a){var c=a[0],p=a[1],g=c*c+p*p;return g>0&&(g=1/Math.sqrt(g)),u[0]=a[0]*g,u[1]=a[1]*g,u}function rl(u,a){return u[0]*a[0]+u[1]*a[1]}er(),er(),b();var xa,so,Ln=qa;function zi(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}mi();var ms=function(){if(so)return xa;function u(a,c,p,g){this.cx=3*a,this.bx=3*(p-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(g-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=c,this.p2x=p,this.p2y=g}return so=1,xa=u,u.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,c){if(c===void 0&&(c=1e-6),a<0)return 0;if(a>1)return 1;for(var p=a,g=0;g<8;g++){var x=this.sampleCurveX(p)-a;if(Math.abs(x)<c)return p;var w=this.sampleCurveDerivativeX(p);if(Math.abs(w)<1e-6)break;p-=x/w}var C=0,N=1;for(p=a,g=0;g<20&&(x=this.sampleCurveX(p),!(Math.abs(x-a)<c));g++)a>x?C=p:N=p,p=.5*(N-C)+C;return p},solve:function(a,c){return this.sampleCurveY(this.solveCurveX(a,c))}},xa}(),Ga=zi(ms);function st(u,a){this.x=u,this.y=a}function yn(u,a){if(Array.isArray(u)){if(!Array.isArray(a)||u.length!==a.length)return!1;for(let c=0;c<u.length;c++)if(!yn(u[c],a[c]))return!1;return!0}if(typeof u=="object"&&u!==null&&a!==null){if(typeof a!="object"||Object.keys(u).length!==Object.keys(a).length)return!1;for(const c in u)if(!yn(u[c],a[c]))return!1;return!0}return u===a}st.prototype={clone(){return new st(this.x,this.y)},add(u){return this.clone()._add(u)},sub(u){return this.clone()._sub(u)},multByPoint(u){return this.clone()._multByPoint(u)},divByPoint(u){return this.clone()._divByPoint(u)},mult(u){return this.clone()._mult(u)},div(u){return this.clone()._div(u)},rotate(u){return this.clone()._rotate(u)},rotateAround(u,a){return this.clone()._rotateAround(u,a)},matMult(u){return this.clone()._matMult(u)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(u){return this.x===u.x&&this.y===u.y},dist(u){return Math.sqrt(this.distSqr(u))},distSqr(u){const a=u.x-this.x,c=u.y-this.y;return a*a+c*c},angle(){return Math.atan2(this.y,this.x)},angleTo(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith(u){return this.angleWithSep(u.x,u.y)},angleWithSep(u,a){return Math.atan2(this.x*a-this.y*u,this.x*u+this.y*a)},_matMult(u){const a=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=a,this},_add(u){return this.x+=u.x,this.y+=u.y,this},_sub(u){return this.x-=u.x,this.y-=u.y,this},_mult(u){return this.x*=u,this.y*=u,this},_div(u){return this.x/=u,this.y/=u,this},_multByPoint(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint(u){return this.x/=u.x,this.y/=u.y,this},_unit(){return this._div(this.mag()),this},_perp(){const u=this.y;return this.y=this.x,this.x=-u,this},_rotate(u){const a=Math.cos(u),c=Math.sin(u),p=c*this.x+a*this.y;return this.x=a*this.x-c*this.y,this.y=p,this},_rotateAround(u,a){const c=Math.cos(u),p=Math.sin(u),g=a.y+p*(this.x-a.x)+c*(this.y-a.y);return this.x=a.x+c*(this.x-a.x)-p*(this.y-a.y),this.y=g,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:st},st.convert=function(u){if(u instanceof st)return u;if(Array.isArray(u))return new st(+u[0],+u[1]);if(u.x!==void 0&&u.y!==void 0)return new st(+u.x,+u.y);throw new Error("Expected [x, y] or {x, y} point format")};const Zs=Math.PI/180,Na=180/Math.PI;function _n(u){return u*Zs}function Fo(u){return u*Na}const Cw=[[0,0],[1,0],[1,1],[0,1]];function Og(u){if(u<=0)return 0;if(u>=1)return 1;const a=u*u,c=a*u;return 4*(u<.5?c:3*(u-a)+c-.75)}function ht(u,a,c,p){const g=new Ga(u,a,c,p);return function(x){return g.solve(x)}}const fe=ht(.25,.1,.25,1);function ve(u,a,c){return Math.min(c,Math.max(a,u))}function De(u,a,c){return(c=ve((c-u)/(a-u),0,1))*c*(3-2*c)}function Qe(u,a,c){const p=c-a,g=((u-a)%p+p)%p+a;return g===a?c:g}function Ye(u,a,c){if(!u.length)return c(null,[]);let p=u.length;const g=new Array(u.length);let x=null;u.forEach((w,C)=>{a(w,(N,D)=>{N&&(x=N),g[C]=D,--p==0&&c(x,g)})})}let ot=1;function bt(){return ot++}function ct(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log2(u)))}function _t(u,a){u.forEach(c=>{a[c]&&(a[c]=a[c].bind(a))})}function Zt(u,a,c){const p={};for(const g in u)p[g]=a.call(this,u[g],g,u);return p}function Ut(u,a,c){const p={};for(const g in u)a.call(this,u[g],g,u)&&(p[g]=u[g]);return p}function Ar(u){return Array.isArray(u)?u.map(Ar):typeof u=="object"&&u?Zt(u,Ar):u}function Jr(u,a){for(let c=0;c<u.length;c++)if(a.indexOf(u[c])>=0)return!0;return!1}const Zr={};function zr(u){Zr[u]||(typeof console<"u"&&console.warn(u),Zr[u]=!0)}function wn(u,a,c){return(c.y-u.y)*(a.x-u.x)>(a.y-u.y)*(c.x-u.x)}function An(u){let a=0;for(let c,p,g=0,x=u.length,w=x-1;g<x;w=g++)c=u[g],p=u[w],a+=(p.x-c.x)*(c.y+p.y);return a}function Si([u,a,c]){const p=_n(a+90),g=_n(c);return{x:u*Math.cos(p)*Math.sin(g),y:u*Math.sin(p)*Math.sin(g),z:u*Math.cos(g),azimuthal:a,polar:c}}function bs(u){return(typeof self<"u"||u!==void 0)&&typeof WorkerGlobalScope<"u"&&(u!==void 0?u:self)instanceof WorkerGlobalScope}function Xs(u){const a={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,p,g,x)=>{const w=g||x;return a[p]=!w||w.toLowerCase(),""}),a["max-age"]){const c=parseInt(a["max-age"],10);isNaN(c)?delete a["max-age"]:a["max-age"]=c}return a}let Rs=null;function ks(u,a){return[u[4*a],u[4*a+1],u[4*a+2],u[4*a+3]]}function _i(u,a,c,p){for(;a<c;){const g=a+c>>1;u[g]<p?a=g+1:c=g}return a}function Mn(u,a,c,p){for(;a<c;){const g=a+c>>1;u[g]<=p?a=g+1:c=g}return a}function Yi(u){return u>0?1/(1.001-u):1+u}function gs(u){return u>0?1-1/(1.001-u):-u}function Ti(u,a,c){return(u-a.min)*(c.max-c.min)/(a.max-a.min)+c.min}const Ji={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Ji.API_URL)return null;try{const u=new URL(Ji.API_URL);return u.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":u.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function ua(u){return Ji.API_URL_REGEX.test(u)}function zo(u){return Ji.API_SPRITE_REGEX.test(u)}let bc,sf,ba,wc,nl,eu;function jl(){return bc==null&&(bc=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),bc}const Pl={now:()=>wc!==void 0?wc:performance.now(),setNow(u){wc=u},restoreNow(){wc=void 0},frame(u){const a=requestAnimationFrame(u);return{cancel:()=>cancelAnimationFrame(a)}},getImageData(u,a=0){const{width:c,height:p}=u;nl||(nl=document.createElement("canvas"));const g=nl.getContext("2d",{willReadFrequently:!0});if(!g)throw new Error("failed to create canvas 2d context");return(c>nl.width||p>nl.height)&&(nl.width=c,nl.height=p),g.clearRect(-a,-a,c+2*a,p+2*a),g.drawImage(u,0,0,c,p),g.getImageData(-a,-a,c+2*a,p+2*a)},resolveURL:u=>(sf||(sf=document.createElement("a")),sf.href=u,sf.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(ba==null&&(ba=window.matchMedia("(prefers-reduced-motion: reduce)")),ba.matches)},hasCanvasFingerprintNoise(){if(eu!==void 0)return eu;if(!jl())return eu=!1,!1;const u=new OffscreenCanvas(85,1),a=u.getContext("2d",{willReadFrequently:!0});let c=0;for(let g=0;g<u.width;++g)a.fillStyle=`rgba(${c++},${c++},${c++}, 255)`,a.fillRect(g,0,1,1);const p=a.getImageData(0,0,u.width,u.height);c=0;for(let g=0;g<p.data.length;++g)if(g%4!=3&&c++!==p.data[g])return eu=!0,!0;return eu=!1,!1}};function i_(u,a){const c=u.indexOf("?");if(c<0)return`${u}?${new URLSearchParams(a).toString()}`;const p=new URLSearchParams(u.slice(c));for(const g in a)p.set(g,a[g]);return`${u.slice(0,c)}?${p.toString()}`}function kg(u,a={persistentParams:[]}){const c=u.indexOf("?");if(c<0)return u;const p=new URLSearchParams,g=new URLSearchParams(u.slice(c));for(const w of a.persistentParams){const C=g.get(w);C&&p.set(w,C)}const x=p.toString();return`${u.slice(0,c)}${x.length>0?`?${x}`:""}`}const Ng="mapbox-tiles";let Ig=500,ml=50;const tu=["language","worldview","jobid"];let il,Vl;function ad(){try{return caches}catch{}}function af(){const u=ad();u&&il==null&&(il=u.open(Ng))}let s_=1/0;const a_={supported:!1,testSupport:function(u){!jw&&Qd&&(tA?Pw(u):Cu=u)}};let Cu,Qd,jw=!1,tA=!1;const Sc=typeof self<"u"?self:{};function Pw(u){const a=u.createTexture();u.bindTexture(u.TEXTURE_2D,a);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,Qd),u.isContextLost())return;a_.supported=!0}catch{}u.deleteTexture(a),jw=!0}Sc.document&&(Qd=Sc.document.createElement("img"),Qd.onload=function(){Cu&&Pw(Cu),Cu=null,tA=!0},Qd.onerror=function(){jw=!0,Cu=null},Qd.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const of={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(of);class lf extends Error{constructor(a,c,p){c===401&&ua(p)&&(a+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(a),this.status=c,this.url=p}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ow=bs()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Rg=function(u,a){if(!(/^file:/.test(c=u.url)||/^file:/.test(Ow())&&!/^\w+:/.test(c))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(p,g){const x=new AbortController,w=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,referrer:Ow(),referrerPolicy:p.referrerPolicy,signal:x.signal});let C=!1,N=!1;const D=(U=w.url).indexOf("sku=")>0&&ua(U);var U;p.type==="json"&&w.headers.set("Accept","application/json");const q=(Y,J,oe)=>{if(N)return;if(Y&&Y.message!=="SecurityError"&&zr(Y.toString()),J&&oe)return H(J);const ce=Date.now();fetch(w).then(he=>{if(he.ok){const Se=D?he.clone():null;return H(he,Se,ce)}return g(new lf(he.statusText,he.status,p.url))}).catch(he=>{he.name!=="AbortError"&&g(new Error(`${he.message} ${p.url}`))})},H=(Y,J,oe)=>{(p.type==="arrayBuffer"?Y.arrayBuffer():p.type==="json"?Y.json():Y.text()).then(ce=>{N||(J&&oe&&function(he,Se,Te){if(af(),il==null)return;const ke=Xs(Se.headers.get("Cache-Control")||"");if(ke["no-store"])return;const qe={status:Se.status,statusText:Se.statusText,headers:new Headers};Se.headers.forEach((et,it)=>qe.headers.set(it,et)),ke["max-age"]&&qe.headers.set("Expires",new Date(Te+1e3*ke["max-age"]).toUTCString());const Fe=qe.headers.get("Expires");if(!Fe||new Date(Fe).getTime()-Te<42e4)return;let Xe=kg(he.url,{persistentParams:tu});if(Se.status===206){const et=he.headers.get("Range");if(!et)return;qe.status=200,Xe=i_(Xe,{range:et})}(function(et,it){if(Vl===void 0)try{new Response(new ReadableStream),Vl=!0}catch{Vl=!1}Vl?it(et.body):et.blob().then(it).catch(At=>zr(At.message))})(Se,et=>{const it=new Response((At=Se.status)!==200&&At!==404&&[101,103,204,205,304].includes(At)?null:et,qe);var At;af(),il!=null&&il.then(pt=>pt.put(Xe,it)).catch(pt=>zr(pt.message))})}(w,J,oe),C=!0,g(null,ce,Y.headers))}).catch(ce=>{N||g(new Error(ce.message))})};return D?function(Y,J){if(af(),il==null)return J(null);il.then(oe=>{let ce=kg(Y.url,{persistentParams:tu});const he=Y.headers.get("Range");he&&(ce=i_(ce,{range:he})),oe.match(ce).then(Se=>{const Te=function(ke){if(!ke)return!1;const qe=new Date(ke.headers.get("Expires")||0),Fe=Xs(ke.headers.get("Cache-Control")||"");return Number(qe)>Date.now()&&!Fe["no-cache"]}(Se);oe.delete(ce).catch(J),Te&&oe.put(ce,Se.clone()).catch(J),J(null,Se,Te)}).catch(J)}).catch(J)}(w,q):q(null,null),{cancel:()=>{N=!0,C||x.abort()}}}(u,a);if(bs(self)&&self.worker.actor)return self.worker.actor.send("getResource",u,a,void 0,!0)}var c;return function(p,g){const x=new XMLHttpRequest;x.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(x.responseType="arraybuffer");for(const w in p.headers)x.setRequestHeader(w,p.headers[w]);return p.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=p.credentials==="include",x.onerror=()=>{g(new Error(x.statusText))},x.onload=()=>{if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let w=x.response;if(p.type==="json")try{w=JSON.parse(x.response)}catch(N){return g(N)}const C=new Headers;x.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(N=>{const D=N.split(": "),U=D.shift(),q=D.join(": ");C.append(U,q)}),g(null,w,C)}else g(new lf(x.statusText,x.status,p.url))},x.send(p.body),{cancel:()=>x.abort()}}(u,a)},_p=function(u,a){return Rg(Object.assign(u,{type:"arrayBuffer"}),a)};function si(u){const a=document.createElement("a");return a.href=u,a.protocol===location.protocol&&a.host===location.host}const kw="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Mg,Dg;Mg=[],Dg=0;const Nw=function(u,a){if(a_.supported&&(u.headers||(u.headers={}),u.headers.accept="image/webp,*/*"),Dg>=Ji.MAX_PARALLEL_IMAGE_REQUESTS){const x={requestParameters:u,callback:a,cancelled:!1,cancel(){this.cancelled=!0}};return Mg.push(x),x}Dg++;let c=!1;const p=()=>{if(!c)for(c=!0,Dg--;Mg.length&&Dg<Ji.MAX_PARALLEL_IMAGE_REQUESTS;){const x=Mg.shift(),{requestParameters:w,callback:C,cancelled:N}=x;N||(x.cancel=Nw(w,C).cancel)}},g=_p(u,(x,w,C)=>{p(),x?a(x):w&&(self.createImageBitmap?function(N,D){const U=new Blob([new Uint8Array(N)],{type:"image/png"});createImageBitmap(U).then(q=>{D(null,q)}).catch(q=>{D(new Error(`Could not load image because of ${q.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(w,(N,D)=>a(N,D,C)):function(N,D){const U=new Image;U.onload=()=>{D(null,U),URL.revokeObjectURL(U.src),U.onload=null,requestAnimationFrame(()=>{U.src=kw})},U.onerror=()=>D(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const q=new Blob([new Uint8Array(N)],{type:"image/png"});U.src=N.byteLength?URL.createObjectURL(q):kw}(w,(N,D)=>a(N,D,C)))});return{cancel:()=>{g.cancel(),p()}}};var Lg,Fg,zg,cf={exports:{}},rA={exports:{}},o_={exports:{}},HI=function(){if(zg)return cf.exports;zg=1;var u=(Lg||(Lg=1,rA.exports=function(c,p){var g,x,w,C,N,D,U,q;for(x=c.length-(g=3&c.length),w=p,N=3432918353,D=461845907,q=0;q<x;)U=255&c.charCodeAt(q)|(255&c.charCodeAt(++q))<<8|(255&c.charCodeAt(++q))<<16|(255&c.charCodeAt(++q))<<24,++q,w=27492+(65535&(C=5*(65535&(w=(w^=U=(65535&(U=(U=(65535&U)*N+(((U>>>16)*N&65535)<<16)&4294967295)<<15|U>>>17))*D+(((U>>>16)*D&65535)<<16)&4294967295)<<13|w>>>19))+((5*(w>>>16)&65535)<<16)&4294967295))+((58964+(C>>>16)&65535)<<16);switch(U=0,g){case 3:U^=(255&c.charCodeAt(q+2))<<16;case 2:U^=(255&c.charCodeAt(q+1))<<8;case 1:w^=U=(65535&(U=(U=(65535&(U^=255&c.charCodeAt(q)))*N+(((U>>>16)*N&65535)<<16)&4294967295)<<15|U>>>17))*D+(((U>>>16)*D&65535)<<16)&4294967295}return w^=c.length,w=2246822507*(65535&(w^=w>>>16))+((2246822507*(w>>>16)&65535)<<16)&4294967295,w=3266489909*(65535&(w^=w>>>13))+((3266489909*(w>>>16)&65535)<<16)&4294967295,(w^=w>>>16)>>>0}),rA.exports),a=(Fg||(Fg=1,o_.exports=function(c,p){for(var g,x=c.length,w=p^x,C=0;x>=4;)g=1540483477*(65535&(g=255&c.charCodeAt(C)|(255&c.charCodeAt(++C))<<8|(255&c.charCodeAt(++C))<<16|(255&c.charCodeAt(++C))<<24))+((1540483477*(g>>>16)&65535)<<16),w=1540483477*(65535&w)+((1540483477*(w>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),x-=4,++C;switch(x){case 3:w^=(255&c.charCodeAt(C+2))<<16;case 2:w^=(255&c.charCodeAt(C+1))<<8;case 1:w=1540483477*(65535&(w^=255&c.charCodeAt(C)))+((1540483477*(w>>>16)&65535)<<16)}return w=1540483477*(65535&(w^=w>>>13))+((1540483477*(w>>>16)&65535)<<16),(w^=w>>>15)>>>0}),o_.exports);return cf.exports=u,cf.exports.murmur3=u,cf.exports.murmur2=a,cf.exports}(),Bg=zi(HI);class ql{constructor(a,...c){Object.assign(this,c[0]||{}),this.type=a}}class $g extends ql{constructor(a,c={}){super("error",Object.assign({error:a},c))}}function xp(u,a,c){c[u]&&c[u].indexOf(a)!==-1||(c[u]=c[u]||[],c[u].push(a))}function Ug(u,a,c){if(c&&c[u]){const p=c[u].indexOf(a);p!==-1&&c[u].splice(p,1)}}class od{on(a,c){return this._listeners=this._listeners||{},xp(a,c,this._listeners),this}off(a,c){return Ug(a,c,this._listeners),Ug(a,c,this._oneTimeListeners),this}once(a,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},xp(a,c,this._oneTimeListeners),this):new Promise(p=>{this.once(a,p)})}fire(a,c){const p=typeof a=="string"?new ql(a,c):a,g=p.type;if(this.listens(g)){p.target=this;const x=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(const N of x)N.call(this,p);const w=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(const N of w)Ug(g,N,this._oneTimeListeners),N.call(this,p);const C=this._eventedParent;if(C){const N=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(p,N),C.fire(p)}}else p instanceof $g&&console.error(p.error);return this}listens(a){return!!(this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a))}setEventedParent(a,c){return this._eventedParent=a,this._eventedParentData=c,this}}class da{constructor(a){typeof a=="string"?this.name=a:(this.name=a.name,this.iconsetId=a.iconsetId)}static from(a){return new da(a)}static toString(a){return a.iconsetId?`${a.name}${a.iconsetId}`:a.name}static parse(a){const[c,p]=a.split("");return new da({name:c,iconsetId:p})}static isEqual(a,c){return a.name===c.name&&a.iconsetId===c.iconsetId}toString(){return da.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Iw,Rw={},Mw=function(){if(Iw)return Rw;Iw=1;var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function a(x){return(x=Math.round(x))<0?0:x>255?255:x}function c(x){return a(x[x.length-1]==="%"?parseFloat(x)/100*255:parseInt(x))}function p(x){return(w=x[x.length-1]==="%"?parseFloat(x)/100:parseFloat(x))<0?0:w>1?1:w;var w}function g(x,w,C){return C<0?C+=1:C>1&&(C-=1),6*C<1?x+(w-x)*C*6:2*C<1?w:3*C<2?x+(w-x)*(2/3-C)*6:x}try{Rw.parseCSSColor=function(x){var w,C=x.replace(/ /g,"").toLowerCase();if(C in u)return u[C].slice();if(C[0]==="#")return C.length===4?(w=parseInt(C.substr(1),16))>=0&&w<=4095?[(3840&w)>>4|(3840&w)>>8,240&w|(240&w)>>4,15&w|(15&w)<<4,1]:null:C.length===7&&(w=parseInt(C.substr(1),16))>=0&&w<=16777215?[(16711680&w)>>16,(65280&w)>>8,255&w,1]:null;var N=C.indexOf("("),D=C.indexOf(")");if(N!==-1&&D+1===C.length){var U=C.substr(0,N),q=C.substr(N+1,D-(N+1)).split(","),H=1;switch(U){case"rgba":if(q.length!==4)return null;H=p(q.pop());case"rgb":return q.length!==3?null:[c(q[0]),c(q[1]),c(q[2]),H];case"hsla":if(q.length!==4)return null;H=p(q.pop());case"hsl":if(q.length!==3)return null;var Y=(parseFloat(q[0])%360+360)%360/360,J=p(q[1]),oe=p(q[2]),ce=oe<=.5?oe*(J+1):oe+J-oe*J,he=2*oe-ce;return[a(255*g(he,ce,Y+1/3)),a(255*g(he,ce,Y)),a(255*g(he,ce,Y-1/3)),H];default:return null}}return null}}catch{}return Rw}();class hi{constructor(a,c,p,g=1){this.r=a,this.g=c,this.b=p,this.a=g}static parse(a){if(!a)return;if(a instanceof hi)return a;if(typeof a!="string")return;const c=Mw.parseCSSColor(a);return c?new hi(c[0]/255,c[1]/255,c[2]/255,c[3]):void 0}toString(){const[a,c,p,g]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*a)},${Math.round(255*c)},${Math.round(255*p)},${g})`}toNonPremultipliedRenderColor(a){const{r:c,g:p,b:g,a:x}=this;return new nA(a,c,p,g,x)}toPremultipliedRenderColor(a){const{r:c,g:p,b:g,a:x}=this;return new iA(a,c*x,p*x,g*x,x)}clone(){return new hi(this.r,this.g,this.b,this.a)}}class Dw{constructor(a,c,p,g,x,w=!1){if(this.premultiplied=!1,this.premultiplied=w,a){const C=a.image.height,N=C*C;this.premultiplied?(c=x===0?0:c/x*(C-1),p=x===0?0:p/x*(C-1),g=x===0?0:g/x*(C-1)):(c*=C-1,p*=C-1,g*=C-1);const D=Math.floor(c),U=Math.floor(p),q=Math.floor(g),H=Math.ceil(c),Y=Math.ceil(p),J=Math.ceil(g),oe=c-D,ce=p-U,he=g-q,Se=a.image.data,Te=4*(D+U*N+q*C),ke=4*(D+U*N+J*C),qe=4*(D+Y*N+q*C),Fe=4*(D+Y*N+J*C),Xe=4*(H+U*N+q*C),et=4*(H+U*N+J*C),it=4*(H+Y*N+q*C),At=4*(H+Y*N+J*C);if(Te<0||At>=Se.length)throw new Error("out of range");this.r=Kr(Kr(Kr(Se[Te],Se[ke],he),Kr(Se[qe],Se[Fe],he),ce),Kr(Kr(Se[Xe],Se[et],he),Kr(Se[it],Se[At],he),ce),oe)/255*(this.premultiplied?x:1),this.g=Kr(Kr(Kr(Se[Te+1],Se[ke+1],he),Kr(Se[qe+1],Se[Fe+1],he),ce),Kr(Kr(Se[Xe+1],Se[et+1],he),Kr(Se[it+1],Se[At+1],he),ce),oe)/255*(this.premultiplied?x:1),this.b=Kr(Kr(Kr(Se[Te+2],Se[ke+2],he),Kr(Se[qe+2],Se[Fe+2],he),ce),Kr(Kr(Se[Xe+2],Se[et+2],he),Kr(Se[it+2],Se[At+2],he),ce),oe)/255*(this.premultiplied?x:1),this.a=x}else this.r=c,this.g=p,this.b=g,this.a=x}toArray(){const{r:a,g:c,b:p,a:g}=this;return[255*a,255*c,255*p,g]}toHslaArray(){let{r:a,g:c,b:p,a:g}=this;if(this.premultiplied){if(g===0)return[0,0,0,0];const J=1/g;a*=J,c*=J,p*=J}const x=Math.min(Math.max(a,0),1),w=Math.min(Math.max(c,0),1),C=Math.min(Math.max(p,0),1),N=Math.min(x,w,C),D=Math.max(x,w,C),U=D-N,q=.5*(N+D);if(U===0)return[0,0,100*q,g];const H=q>.5?U/(2-D-N):U/(D+N);let Y;switch(D){case x:Y=60*((w-C)/U+(w<C?6:0));break;case w:Y=60*((C-x)/U+2);break;default:Y=60*((x-w)/U+4)}return[Y,100*H,100*q,g]}toArray01(){const{r:a,g:c,b:p,a:g}=this;return[a,c,p,g]}toArray01Scaled(a){const{r:c,g:p,b:g}=this;return[c*a,p*a,g*a]}toArray01Linear(){const{r:a,g:c,b:p,a:g}=this;return[Math.pow(a,2.2),Math.pow(c,2.2),Math.pow(p,2.2),g]}}class nA extends Dw{constructor(a,c,p,g,x){super(a,c,p,g,x,!1)}}class iA extends Dw{constructor(a,c,p,g,x){super(a,c,p,g,x,!0)}}function Kr(u,a,c){return u*(1-c)+a*c}function Vg(u,a,c){return u.map((p,g)=>Kr(p,a[g],c))}hi.black=new hi(0,0,0,1),hi.white=new hi(1,1,1,1),hi.transparent=new hi(0,0,0,0),hi.red=new hi(1,0,0,1),hi.blue=new hi(0,0,1,1);var ld=Object.freeze({__proto__:null,array:Vg,color:function(u,a,c){return new hi(Kr(u.r,a.r,c),Kr(u.g,a.g,c),Kr(u.b,a.b,c),Kr(u.a,a.a,c))},number:Kr});class Ec extends Error{constructor(a,c){super(c),this.message=c,this.key=a}}class Tc{constructor(a,c=[]){this.parent=a,this.bindings={};for(const[p,g]of c)this.bindings[p]=g}concat(a){return new Tc(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const bp={kind:"null"},Or={kind:"number"},Xn={kind:"string"},ui={kind:"boolean"},Ol={kind:"color"},wp={kind:"object"},gi={kind:"value"},qg={kind:"collator"},uf={kind:"formatted"},Hg={kind:"resolvedImage"};function Wa(u,a){return{kind:"array",itemType:u,N:a}}function ra(u){if(u.kind==="array"){const a=ra(u.itemType);return typeof u.N=="number"?`array<${a}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${a}>`}return u.kind}const GI=[bp,Or,Xn,ui,Ol,uf,wp,Wa(gi),Hg];function Gg(u,a){if(a.kind==="error")return null;if(u.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!Gg(u.itemType,a.itemType))&&(typeof u.N!="number"||u.N===a.N))return null}else{if(u.kind===a.kind)return null;if(u.kind==="value"){for(const c of GI)if(!Gg(c,a))return null}}return`Expected ${ra(u)} but found ${ra(a)} instead.`}function Lw(u,a){return a.some(c=>c.kind===u.kind)}function Wg(u,a){return a.some(c=>c==="null"?u===null:c==="array"?Array.isArray(u):c==="object"?u&&!Array.isArray(u)&&typeof u=="object":c===typeof u)}function l_(u,a){return u.kind==="array"&&a.kind==="array"?u.N===a.N&&l_(u.itemType,a.itemType):u.kind===a.kind}class Fw{constructor(a,c,p){this.sensitivity=a?c?"variant":"case":c?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,c){return this.collator.compare(a,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Kg{constructor(a,c,p,g,x){this.text=a.normalize?a.normalize():a,this.image=c,this.scale=p,this.fontStack=g,this.textColor=x}}class Ia{constructor(a){this.sections=a}static fromString(a){return new Ia([new Kg(a,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(a=>a.text.length!==0||!!a.image&&a.image.hasPrimary())}static factory(a){return a instanceof Ia?a:Ia.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map(a=>a.text).join("")}serialize(){const a=["format"];for(const c of this.sections){if(c.image){const g=c.image.getPrimary().id.toString();a.push(["image",g]);continue}a.push(c.text);const p={};c.fontStack&&(p["text-font"]=["literal",c.fontStack.split(",")]),c.scale&&(p["font-scale"]=c.scale),c.textColor&&(p["text-color"]=["rgba"].concat(c.textColor.toNonPremultipliedRenderColor(null).toArray())),a.push(p)}return a}}class cd{constructor(a,c={}){if(this.id=da.from(a),this.options=Object.assign({},c),c.transform){const{a:p,b:g,c:x,d:w,e:C,f:N}=c.transform;this.options.transform=new DOMMatrix([p,g,x,w,C,N])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a,b:c,c:p,d:g,e:x,f:w}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a,b:c,c:p,d:g,e:x,f:w}})}static parse(a){let c,p,g,x;try{({name:c,iconsetId:p,params:g,transform:x}=JSON.parse(a)||{})}catch{return null}if(!c)return null;const{a:w,b:C,c:N,d:D,e:U,f:q}=x||{};return new cd({name:c,iconsetId:p},{params:g,transform:new DOMMatrix([w,C,N,D,U,q])})}scaleSelf(a,c){return this.options.transform.scaleSelf(a,c),this}}class gl{constructor(a,c,p,g,x=!1){this.primaryId=da.from(a),this.primaryOptions=c,p&&(this.secondaryId=da.from(p)),this.secondaryOptions=g,this.available=x}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new cd(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new cd(this.secondaryId,this.secondaryOptions):null}static from(a){return typeof a=="string"?gl.build({name:a}):a}static build(a,c,p,g){return!a||typeof a=="object"&&!("name"in a)?null:new gl(a,p,c,g)}}function c_(u,a,c,p){return typeof u=="number"&&u>=0&&u<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof c=="number"&&c>=0&&c<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[u,a,c,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[u,a,c,p]:[u,a,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Sp(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof hi||u instanceof Fw||u instanceof Ia||u instanceof gl)return!0;if(Array.isArray(u)){for(const a of u)if(!Sp(a))return!1;return!0}if(typeof u=="object"){for(const a in u)if(!Sp(u[a]))return!1;return!0}return!1}function wa(u){if(u===null)return bp;if(typeof u=="string")return Xn;if(typeof u=="boolean")return ui;if(typeof u=="number")return Or;if(u instanceof hi)return Ol;if(u instanceof Fw)return qg;if(u instanceof Ia)return uf;if(u instanceof gl)return Hg;if(Array.isArray(u)){const a=u.length;let c;for(const p of u){const g=wa(p);if(c){if(c===g)continue;c=gi;break}c=g}return Wa(c||gi,a)}return wp}function ju(u){const a=typeof u;return u===null?"":a==="string"||a==="number"||a==="boolean"?String(u):u instanceof Ia||u instanceof gl||u instanceof hi?u.toString():JSON.stringify(u)}class ud{constructor(a,c){this.type=a,this.value=c}static parse(a,c){if(a.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!Sp(a[1]))return c.error("invalid value");const p=a[1];let g=wa(p);const x=c.expectedType;return g.kind!=="array"||g.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(g=x),new ud(g,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof hi?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Ia?this.value.serialize():this.value}}class Ms{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}}const vn={string:Xn,number:Or,boolean:ui,object:wp};class Er{constructor(a,c){this.type=a,this.args=c}static parse(a,c){if(a.length<2)return c.error("Expected at least one argument.");let p,g=1;const x=a[0];if(x==="array"){let C,N;if(a.length>2){const D=a[1];if(typeof D!="string"||!(D in vn)||D==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);C=vn[D],g++}else C=gi;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return c.error('The length argument to "array" must be a positive integer literal',2);N=a[2],g++}p=Wa(C,N)}else p=vn[x];const w=[];for(;g<a.length;g++){const C=c.parse(a[g],g,gi);if(!C)return null;w.push(C)}return new Er(p,w)}evaluate(a){for(let c=0;c<this.args.length;c++){const p=this.args[c].evaluate(a);if(!Gg(this.type,wa(p)))return p;if(c===this.args.length-1)throw new Ms(`The expression ${JSON.stringify(this.args[c].serialize())} evaluated to ${ra(wa(p))} but was expected to be of type ${ra(this.type)}.`)}return null}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){const a=this.type,c=[a.kind];if(a.kind==="array"){const p=a.itemType;if(p.kind==="string"||p.kind==="number"||p.kind==="boolean"){c.push(p.kind);const g=a.N;(typeof g=="number"||this.args.length>1)&&c.push(g)}}return c.concat(this.args.map(p=>p.serialize()))}}class df{constructor(a){this.type=uf,this.sections=a}static parse(a,c){if(a.length<2)return c.error("Expected at least one argument.");const p=a[1];if(!Array.isArray(p)&&typeof p=="object")return c.error("First argument must be an image or text section.");const g=[];let x=!1;for(let w=1;w<=a.length-1;++w){const C=a[w];if(x&&typeof C=="object"&&!Array.isArray(C)){x=!1;let N=null;if(C["font-scale"]&&(N=c.parseObjectValue(C["font-scale"],w,"font-scale",Or),!N))return null;let D=null;if(C["text-font"]&&(D=c.parseObjectValue(C["text-font"],w,"text-font",Wa(Xn)),!D))return null;let U=null;if(C["text-color"]&&(U=c.parseObjectValue(C["text-color"],w,"text-color",Ol),!U))return null;const q=g[g.length-1];q.scale=N,q.font=D,q.textColor=U}else{const N=c.parse(a[w],w,gi);if(!N)return null;const D=N.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,g.push({content:N,scale:null,font:null,textColor:null})}}return new df(g)}evaluate(a){return new Ia(this.sections.map(c=>{const p=c.content.evaluate(a);return l_(wa(p),Hg)?new Kg("",p,null,null,null):new Kg(ju(p),null,c.scale?c.scale.evaluate(a):null,c.font?c.font.evaluate(a).join(","):null,c.textColor?c.textColor.evaluate(a):null)}))}eachChild(a){for(const c of this.sections)a(c.content),c.scale&&a(c.scale),c.font&&a(c.font),c.textColor&&a(c.textColor)}outputDefined(){return!1}serialize(){const a=["format"];for(const c of this.sections){a.push(c.content.serialize());const p={};c.scale&&(p["font-scale"]=c.scale.serialize()),c.font&&(p["text-font"]=c.font.serialize()),c.textColor&&(p["text-color"]=c.textColor.serialize()),a.push(p)}return a}}class tn{constructor(a,c,p,g){this._imageWarnHistory={},this.type=Hg,this.namePrimary=a,this.nameSecondary=c,p&&(this.paramsPrimary=p.params,this.iconsetIdPrimary=p.iconset?p.iconset.id:void 0),g&&(this.paramsSecondary=g.params,this.iconsetIdSecondary=g.iconset?g.iconset.id:void 0)}static parse(a,c){if(a.length<2)return c.error("Expected two or more arguments.");let p=1;const g=[];function x(){if(p<a.length){const C=c.parse(a[p],p++,Xn);return C?(g.push({image:C,options:{}}),!0):(c.error(g.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function w(){if(p<a.length){const N=a[p];if((C=N)===null||typeof C!="object"||Array.isArray(C))return!0;const D=N.params,U=N.iconset,q=c.concat(p);if(!D&&!U)return p++,!0;if(D){if(typeof D!="object"||D.constructor!==Object)return q.error('Image options "params" should be an object'),!1;const H={},Y=q.concat(void 0,"params");for(const J in D){if(!J)return Y.error("Image parameter name should be non-empty"),!1;const oe=Y.concat(void 0,J).parse(D[J],void 0,Ol,void 0,{typeAnnotation:"coerce"});if(!oe)return!1;H[J]=oe}g[g.length-1].options.params=H}if(U){if(typeof U!="object"||U.constructor!==Object)return q.error('Image options "iconset" should be an object'),!1;if(!U.id)return q.error('Image options "iconset" should have an "id" property'),!1;g[g.length-1].options.iconset=U}return p++,!0}var C;return!0}for(let C=0;C<2;C++)if(!x()||!w())return;return new tn(g[0].image,g[1]?g[1].image:void 0,g[0].options,g[1]?g[1].options:void 0)}evaluateParams(a,c){const p={};if(c){for(const g in c)if(c[g])try{p[g]=c[g].evaluate(a)}catch{continue}if(Object.keys(p).length!==0)return{params:p}}}evaluate(a){const c={name:this.namePrimary.evaluate(a),iconsetId:this.iconsetIdPrimary},p=this.nameSecondary?{name:this.nameSecondary.evaluate(a),iconsetId:this.iconsetIdSecondary}:void 0,g=gl.build(c,p,this.paramsPrimary?this.evaluateParams(a,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(a,this.paramsSecondary):void 0);if(g&&a.availableImages){const x=g.getPrimary().id;if(g.available=a.availableImages.some(w=>da.isEqual(w,x)),g.available){const w=g.getSecondary()?g.getSecondary().id:null;w&&(g.available=a.availableImages.some(C=>da.isEqual(C,w)))}}return g}eachChild(a){if(a(this.namePrimary),this.paramsPrimary)for(const c in this.paramsPrimary)this.paramsPrimary[c]&&a(this.paramsPrimary[c]);if(this.nameSecondary&&(a(this.nameSecondary),this.paramsSecondary))for(const c in this.paramsSecondary)this.paramsSecondary[c]&&a(this.paramsSecondary[c])}outputDefined(){return!1}serializeOptions(a,c){const p={};if(c&&(p.iconset={id:c}),a){p.params={};for(const g in a)a[g]&&(p.params[g]=a[g].serialize())}return Object.keys(p).length>0?p:void 0}serialize(){const a=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const c=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);c&&a.push(c)}if(this.nameSecondary&&(a.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const c=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);c&&a.push(c)}return a}}function Ep(u){return Xr(u)?"string":Zg(u)?"number":d_(u)?"boolean":Array.isArray(u)?"array":u===null?"null":u_(u)?"object":typeof u}function u_(u){return u!=null&&!Array.isArray(u)&&typeof u!="function"&&!(u instanceof String||u instanceof Number||u instanceof Boolean)&&typeof u=="object"}function Xr(u){return typeof u=="string"||u instanceof String}function Zg(u){return typeof u=="number"||u instanceof Number}function d_(u){return typeof u=="boolean"||u instanceof Boolean}const sA={"to-boolean":ui,"to-color":Ol,"to-number":Or,"to-string":Xn};class Pu{constructor(a,c){this.type=a,this.args=c}static parse(a,c){if(a.length<2)return c.error("Expected at least one argument.");const p=a[0],g=[];let x=bp;if(p==="to-array"){if(!Array.isArray(a[1]))return null;const w=a[1].length;if(c.expectedType){if(c.expectedType.kind!=="array")return c.error(`Expected ${c.expectedType.kind} but found array.`);x=Wa(c.expectedType.itemType,w)}else{if(!(w>0&&Sp(a[1][0])))return null;x=Wa(wa(a[1][0]),w)}for(let C=0;C<w;C++){const N=a[1][C];let D;if(Array.isArray(N))D=c.parse(N,void 0,x.itemType);else{const U=Ep(N);if(U!==x.itemType.kind)return c.error(`Expected ${x.itemType.kind} but found ${U}.`);D=c.registry.literal.parse(["literal",N===void 0?null:N],c)}if(!D)return null;g.push(D)}}else{if((p==="to-boolean"||p==="to-string")&&a.length!==2)return c.error("Expected one argument.");x=sA[p];for(let w=1;w<a.length;w++){const C=c.parse(a[w],w,gi);if(!C)return null;g.push(C)}}return new Pu(x,g)}evaluate(a){if(this.type.kind==="boolean")return!!this.args[0].evaluate(a);if(this.type.kind==="color"){let c,p;for(const g of this.args){if(c=g.evaluate(a),p=null,c instanceof hi)return c;if(typeof c=="string"){const x=a.parseColor(c);if(x)return x}else if(Array.isArray(c)&&(p=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:c_(c[0],c[1],c[2],c[3]),!p))return new hi(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new Ms(p||`Could not parse color from value '${typeof c=="string"?c:String(JSON.stringify(c))}'`)}if(this.type.kind==="number"){let c=null;for(const p of this.args){if(c=p.evaluate(a),c===null)return 0;const g=Number(c);if(!isNaN(g))return g}throw new Ms(`Could not convert ${JSON.stringify(c)} to number.`)}return this.type.kind==="formatted"?Ia.fromString(ju(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?gl.build(ju(this.args[0].evaluate(a))):this.type.kind==="array"?this.args.map(c=>c.evaluate(a)):ju(this.args[0].evaluate(a))}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){if(this.type.kind==="formatted")return new df([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new tn(this.args[0]).serialize();const a=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(c=>{a.push(c.serialize())}),a}}const h_=["Unknown","Point","LineString","Polygon"];class Ka{constructor(a,c,p){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=a,this.options=c,this.iconImageUseTheme=p}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?h_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(a){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const a=this.featureDistanceData.center,c=this.featureDistanceData.scale,{x:p,y:g}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(p*c-a[0])+this.featureDistanceData.bearing[1]*(g*c-a[1])}return 0}parseColor(a){let c=this._parseColorCache[a];return c||(c=this._parseColorCache[a]=hi.parse(a)),c}getConfig(a){return this.options?this.options.get(a):null}}class Bo{constructor(a,c,p,g,x){this.name=a,this.type=c,this._evaluate=p,this.args=g,this._overloadIndex=x}evaluate(a){if(!this._evaluate){const c=Bo.definitions[this.name];this._evaluate=Array.isArray(c)?c[2]:c.overloads[this._overloadIndex][1]}return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(a=>a.serialize()))}static parse(a,c){const p=a[0],g=Bo.definitions[p];if(!g)return c.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(g)?g[0]:g.type,w=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,C=[];let N=null,D=-1;for(const[U,q]of w){if(Array.isArray(U)&&U.length!==a.length-1)continue;C.push(U),D++,N=new w_(c.registry,c.path,null,c.scope,void 0,c._scope,c.options,c.iconImageUseTheme);const H=[];let Y=!1;for(let J=1;J<a.length;J++){const oe=a[J],ce=Array.isArray(U)?U[J-1]:U.type,he=N.parse(oe,1+H.length,ce);if(!he){Y=!0;break}H.push(he)}if(!Y)if(Array.isArray(U)&&U.length!==H.length)N.error(`Expected ${U.length} arguments, but found ${H.length} instead.`);else{for(let J=0;J<H.length;J++){const oe=Array.isArray(U)?U[J]:U.type,ce=H[J];N.concat(J+1).checkSubtype(oe,ce.type)}if(N.errors.length===0)return new Bo(p,x,q,H,D)}}if(C.length===1)c.errors.push(...N.errors);else{const U=(C.length?C:w.map(([H])=>H)).map(hf).join(" | "),q=[];for(let H=1;H<a.length;H++){const Y=c.parse(a[H],1+q.length);if(!Y)return null;q.push(ra(Y.type))}c.error(`Expected arguments of type ${U}, but found (${q.join(", ")}) instead.`)}return null}static register(a,c){Bo.definitions=c;for(const p in c)a[p]=Bo}}function hf(u){return Array.isArray(u)?`(${u.map(ra).join(", ")})`:`(${ra(u.type)}...)`}class Tp{constructor(a,c,p){this.type=qg,this.locale=p,this.caseSensitive=a,this.diacriticSensitive=c}static parse(a,c){if(a.length!==2)return c.error("Expected one argument.");const p=a[1];if(typeof p!="object"||Array.isArray(p))return c.error("Collator options argument must be an object.");const g=p["case-sensitive"]===void 0?c.parse(!1,1,ui):c.parseObjectValue(p["case-sensitive"],1,"case-sensitive",ui);if(!g)return null;const x=p["diacritic-sensitive"]===void 0?c.parse(!1,1,ui):c.parseObjectValue(p["diacritic-sensitive"],1,"diacritic-sensitive",ui);if(!x)return null;let w=null;return p.locale&&(w=c.parseObjectValue(p.locale,1,"locale",Xn),!w)?null:new Tp(g,x,w)}evaluate(a){return new Fw(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}serialize(){const a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]}}function dd(u,a,c=0,p=u.length-1,g=WI){for(;p>c;){if(p-c>600){const N=p-c+1,D=a-c+1,U=Math.log(N),q=.5*Math.exp(2*U/3),H=.5*Math.sqrt(U*q*(N-q)/N)*(D-N/2<0?-1:1);dd(u,a,Math.max(c,Math.floor(a-D*q/N+H)),Math.min(p,Math.floor(a+(N-D)*q/N+H)),g)}const x=u[a];let w=c,C=p;for(Za(u,c,a),g(u[p],x)>0&&Za(u,c,p);w<C;){for(Za(u,w,C),w++,C--;g(u[w],x)<0;)w++;for(;g(u[C],x)>0;)C--}g(u[c],x)===0?Za(u,c,C):(C++,Za(u,C,p)),C<=a&&(c=C+1),a<=C&&(p=C-1)}}function Za(u,a,c){const p=u[a];u[a]=u[c],u[c]=p}function WI(u,a){return u<a?-1:u>a?1:0}function KI(u){let a=0;for(let c,p,g=0,x=u.length,w=x-1;g<x;w=g++)c=u[g],p=u[w],a+=(p.x-c.x)*(c.y+p.y);return a}function Xg(u,a){u[0]=Math.min(u[0],a[0]),u[1]=Math.min(u[1],a[1]),u[2]=Math.max(u[2],a[0]),u[3]=Math.max(u[3],a[1])}function eh(u,a){return!(u[0]<=a[0]||u[2]>=a[2]||u[1]<=a[1]||u[3]>=a[3])}function aA(u,a,c){const p=u[0]-a[0],g=u[1]-a[1],x=u[0]-c[0],w=u[1]-c[1];return p*w-x*g==0&&p*x<=0&&g*w<=0}function Ac(u,a,c=!1){let p=!1;for(let C=0,N=a.length;C<N;C++){const D=a[C];for(let U=0,q=D.length,H=q-1;U<q;H=U++){const Y=D[H],J=D[U];if(aA(u,Y,J))return c;(x=Y)[1]>(g=u)[1]!=(w=J)[1]>g[1]&&g[0]<(w[0]-x[0])*(g[1]-x[1])/(w[1]-x[1])+x[0]&&(p=!p)}}var g,x,w;return p}function oA(u,a,c,p){const g=p[0]-c[0],x=p[1]-c[1],w=(u[0]-c[0])*x-g*(u[1]-c[1]),C=(a[0]-c[0])*x-g*(a[1]-c[1]);return w>0&&C<0||w<0&&C>0}function f_(u,a,c,p){return(g=[p[0]-c[0],p[1]-c[1]])[0]*(x=[a[0]-u[0],a[1]-u[1]])[1]-g[1]*x[0]!=0&&!(!oA(u,a,c,p)||!oA(c,p,u,a));var g,x}function Yg(u){const a=new st(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),c=new st(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const p of u[0])a.x>p.x&&(a.x=p.x),a.y>p.y&&(a.y=p.y),c.x<p.x&&(c.x=p.x),c.y<p.y&&(c.y=p.y);return{min:a,max:c}}const th=8192;function ZI(u,a){const c=(180+u[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,g=Math.pow(2,a.z);return[Math.round(c*g*th),Math.round(p*g*th)]}function lA(u,a){for(let c=0;c<a.length;c++)if(Ac(u,a[c]))return!0;return!1}function XI(u,a,c){for(const p of c)for(let g=0,x=p.length,w=x-1;g<x;w=g++)if(f_(u,a,p[w],p[g]))return!0;return!1}function rh(u,a){for(let c=0;c<u.length;++c)if(!Ac(u[c],a))return!1;for(let c=0;c<u.length-1;++c)if(XI(u[c],u[c+1],a))return!1;return!0}function YI(u,a){for(let c=0;c<a.length;c++)if(rh(u,a[c]))return!0;return!1}function zw(u,a,c){const p=[];for(let g=0;g<u.length;g++){const x=[];for(let w=0;w<u[g].length;w++){const C=ZI(u[g][w],c);Xg(a,C),x.push(C)}p.push(x)}return p}function p_(u,a,c){const p=[];for(let g=0;g<u.length;g++){const x=zw(u[g],a,c);p.push(x)}return p}function Bw(u,a,c,p){if(u[0]<c[0]||u[0]>c[2]){const g=.5*p;let x=u[0]-c[0]>g?-p:c[0]-u[0]>g?p:0;x===0&&(x=u[0]-c[2]>g?-p:c[2]-u[0]>g?p:0),u[0]+=x}Xg(a,u)}function $w(u,a,c,p){const g=Math.pow(2,p.z)*th,x=[p.x*th,p.y*th],w=[];if(!u)return w;for(const C of u)for(const N of C){const D=[N.x+x[0],N.y+x[1]];Bw(D,a,c,g),w.push(D)}return w}function Cc(u,a,c,p){const g=Math.pow(2,p.z)*th,x=[p.x*th,p.y*th],w=[];if(!u)return w;for(const N of u){const D=[];for(const U of N){const q=[U.x+x[0],U.y+x[1]];Xg(a,q),D.push(q)}w.push(D)}if(a[2]-a[0]<=g/2){(C=a)[0]=C[1]=1/0,C[2]=C[3]=-1/0;for(const N of w)for(const D of N)Bw(D,a,c,g)}var C;return w}class ff{constructor(a,c){this.type=ui,this.geojson=a,this.geometries=c}static parse(a,c){if(a.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(Sp(a[1])){const p=a[1];if(p.type==="FeatureCollection")for(let g=0;g<p.features.length;++g){const x=p.features[g].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new ff(p,p.features[g].geometry)}else if(p.type==="Feature"){const g=p.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new ff(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new ff(p,p)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(c,p){const g=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],w=c.canonicalID();if(!w)return!1;if(p.type==="Polygon"){const C=zw(p.coordinates,x,w),N=$w(c.geometry(),g,x,w);if(!eh(g,x))return!1;for(const D of N)if(!Ac(D,C))return!1}if(p.type==="MultiPolygon"){const C=p_(p.coordinates,x,w),N=$w(c.geometry(),g,x,w);if(!eh(g,x))return!1;for(const D of N)if(!lA(D,C))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(c,p){const g=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],w=c.canonicalID();if(!w)return!1;if(p.type==="Polygon"){const C=zw(p.coordinates,x,w),N=Cc(c.geometry(),g,x,w);if(!eh(g,x))return!1;for(const D of N)if(!rh(D,C))return!1}if(p.type==="MultiPolygon"){const C=p_(p.coordinates,x,w),N=Cc(c.geometry(),g,x,w);if(!eh(g,x))return!1;for(const D of N)if(!YI(D,C))return!1}return!0}(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Jg={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Uw=1/298.257223563,Vw=Uw*(2-Uw),Ap=Math.PI/180;class Cp{static fromTile(a,c,p){const g=Math.PI*(1-2*(a+.5)/Math.pow(2,c)),x=Math.atan(.5*(Math.exp(g)-Math.exp(-g)))/Ap;return new Cp(x,p)}static get units(){return Jg}constructor(a,c){if(a===void 0)throw new Error("No latitude given.");if(c&&!Jg[c])throw new Error(`Unknown unit ${c}. Use one of: ${Object.keys(Jg).join(", ")}`);const p=6378.137*Ap*(c?Jg[c]:1),g=Math.cos(a*Ap),x=1/(1-Vw*(1-g*g)),w=Math.sqrt(x);this.kx=p*w*g,this.ky=p*w*x*(1-Vw)}distance(a,c){const p=Hl(a[0]-c[0])*this.kx,g=(a[1]-c[1])*this.ky;return Math.sqrt(p*p+g*g)}bearing(a,c){const p=Hl(c[0]-a[0])*this.kx;return Math.atan2(p,(c[1]-a[1])*this.ky)/Ap}destination(a,c,p){const g=p*Ap;return this.offset(a,Math.sin(g)*c,Math.cos(g)*c)}offset(a,c,p){return[a[0]+c/this.kx,a[1]+p/this.ky]}lineDistance(a){let c=0;for(let p=0;p<a.length-1;p++)c+=this.distance(a[p],a[p+1]);return c}area(a){let c=0;for(let p=0;p<a.length;p++){const g=a[p];for(let x=0,w=g.length,C=w-1;x<w;C=x++)c+=Hl(g[x][0]-g[C][0])*(g[x][1]+g[C][1])*(p?-1:1)}return Math.abs(c)/2*this.kx*this.ky}along(a,c){let p=0;if(c<=0)return a[0];for(let g=0;g<a.length-1;g++){const x=a[g],w=a[g+1],C=this.distance(x,w);if(p+=C,p>c)return m_(x,w,(c-(p-C))/C)}return a[a.length-1]}pointToSegmentDistance(a,c,p){let[g,x]=c,w=Hl(p[0]-g)*this.kx,C=(p[1]-x)*this.ky;if(w!==0||C!==0){const N=(Hl(a[0]-g)*this.kx*w+(a[1]-x)*this.ky*C)/(w*w+C*C);N>1?(g=p[0],x=p[1]):N>0&&(g+=w/this.kx*N,x+=C/this.ky*N)}return w=Hl(a[0]-g)*this.kx,C=(a[1]-x)*this.ky,Math.sqrt(w*w+C*C)}pointOnLine(a,c){let p=1/0,g=a[0][0],x=a[0][1],w=0,C=0;for(let N=0;N<a.length-1;N++){let D=a[N][0],U=a[N][1],q=Hl(a[N+1][0]-D)*this.kx,H=(a[N+1][1]-U)*this.ky,Y=0;q===0&&H===0||(Y=(Hl(c[0]-D)*this.kx*q+(c[1]-U)*this.ky*H)/(q*q+H*H),Y>1?(D=a[N+1][0],U=a[N+1][1]):Y>0&&(D+=q/this.kx*Y,U+=H/this.ky*Y)),q=Hl(c[0]-D)*this.kx,H=(c[1]-U)*this.ky;const J=q*q+H*H;J<p&&(p=J,g=D,x=U,w=N,C=Y)}return{point:[g,x],index:w,t:Math.max(0,Math.min(1,C))}}lineSlice(a,c,p){let g=this.pointOnLine(p,a),x=this.pointOnLine(p,c);if(g.index>x.index||g.index===x.index&&g.t>x.t){const D=g;g=x,x=D}const w=[g.point],C=g.index+1,N=x.index;!qw(p[C],w[0])&&C<=N&&w.push(p[C]);for(let D=C+1;D<=N;D++)w.push(p[D]);return qw(p[N],x.point)||w.push(x.point),w}lineSliceAlong(a,c,p){let g=0;const x=[];for(let w=0;w<p.length-1;w++){const C=p[w],N=p[w+1],D=this.distance(C,N);if(g+=D,g>a&&x.length===0&&x.push(m_(C,N,(a-(g-D))/D)),g>=c)return x.push(m_(C,N,(c-(g-D))/D)),x;g>a&&x.push(N)}return x}bufferPoint(a,c){const p=c/this.ky,g=c/this.kx;return[a[0]-g,a[1]-p,a[0]+g,a[1]+p]}bufferBBox(a,c){const p=c/this.ky,g=c/this.kx;return[a[0]-g,a[1]-p,a[2]+g,a[3]+p]}insideBBox(a,c){return Hl(a[0]-c[0])>=0&&Hl(a[0]-c[2])<=0&&a[1]>=c[1]&&a[1]<=c[3]}}function qw(u,a){return u[0]===a[0]&&u[1]===a[1]}function m_(u,a,c){const p=Hl(a[0]-u[0]);return[u[0]+p*c,u[1]+(a[1]-u[1])*c]}function Hl(u){for(;u<-180;)u+=360;for(;u>180;)u-=360;return u}class g_{constructor(a=[],c=(p,g)=>p<g?-1:p>g?1:0){if(this.data=a,this.length=this.data.length,this.compare=c,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],c=this.data.pop();return--this.length>0&&(this.data[0]=c,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:c,compare:p}=this,g=c[a];for(;a>0;){const x=a-1>>1,w=c[x];if(p(g,w)>=0)break;c[a]=w,a=x}c[a]=g}_down(a){const{data:c,compare:p}=this,g=this.length>>1,x=c[a];for(;a<g;){let w=1+(a<<1);const C=w+1;if(C<this.length&&p(c[C],c[w])<0&&(w=C),p(c[w],x)>=0)break;c[a]=c[w],a=w}c[a]=x}}var tr=8192;function Hw(u,a){return a.dist-u.dist}const jp=100,Pp=50;function Qg(u){const a=[1/0,1/0,-1/0,-1/0];if(a.length!==u.length)return!1;for(let c=0;c<a.length;c++)if(a[c]!==u[c])return!1;return!0}function ey(u){return u[1]-u[0]+1}function Ou(u,a){const c=u[1]>=u[0]&&u[1]<a;return c||console.warn("Distance Expression: Index is out of range"),c}function y_(u,a){if(u[0]>u[1])return[null,null];const c=ey(u);if(a){if(c===2)return[u,null];const p=Math.floor(c/2);return[[u[0],u[0]+p],[u[0]+p,u[1]]]}{if(c===1)return[u,null];const p=Math.floor(c/2)-1;return[[u[0],u[0]+p],[u[0]+p+1,u[1]]]}}function jc(u,a){const c=[1/0,1/0,-1/0,-1/0];if(!Ou(a,u.length))return c;for(let p=a[0];p<=a[1];++p)Xg(c,u[p]);return c}function Nn(u){const a=[1/0,1/0,-1/0,-1/0];for(let c=0;c<u.length;++c)for(let p=0;p<u[c].length;++p)Xg(a,u[c][p]);return a}function Op(u,a,c){if(Qg(u)||Qg(a))return NaN;let p=0,g=0;return u[2]<a[0]&&(p=a[0]-u[2]),u[0]>a[2]&&(p=u[0]-a[2]),u[1]>a[3]&&(g=u[1]-a[3]),u[3]<a[1]&&(g=a[1]-u[3]),c.distance([0,0],[p,g])}function JI(u){return 360*u-180}function QI(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function v_(u,a){const c=Math.pow(2,a.z),p=(u.y/tr+a.y)/c;return[JI((u.x/tr+a.x)/c),QI(p)]}function eR(u,a){const c=[];for(let p=0;p<u.length;++p)c.push(v_(u[p],a));return c}function us(u,a,c){const p=c.pointOnLine(a,u).point;return c.distance(u,p)}function cA(u,a,c,p,g){const x=c.slice(p[0],p[1]+1);let w=1/0;for(let C=a[0];C<=a[1];++C)if((w=Math.min(w,us(u[C],x,g)))===0)return 0;return w}function Gw(u,a,c,p,g){const x=Math.min(g.pointToSegmentDistance(u,c,p),g.pointToSegmentDistance(a,c,p)),w=Math.min(g.pointToSegmentDistance(c,u,a),g.pointToSegmentDistance(p,u,a));return Math.min(x,w)}function tR(u,a,c,p,g){if(!Ou(a,u.length)||!Ou(p,c.length))return NaN;let x=1/0;for(let w=a[0];w<a[1];++w)for(let C=p[0];C<p[1];++C){if(f_(u[w],u[w+1],c[C],c[C+1]))return 0;x=Math.min(x,Gw(u[w],u[w+1],c[C],c[C+1],g))}return x}function rR(u,a,c,p,g){if(!Ou(a,u.length)||!Ou(p,c.length))return NaN;let x=1/0;for(let w=a[0];w<=a[1];++w)for(let C=p[0];C<=p[1];++C)if((x=Math.min(x,g.distance(u[w],c[C])))===0)return x;return x}function nR(u,a,c){if(Ac(u,a,!0))return 0;let p=1/0;for(const g of a){const x=g.length;if(x<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(g[0]!==g[x-1]&&(p=Math.min(p,c.pointToSegmentDistance(u,g[x-1],g[0])))===0||(p=Math.min(p,us(u,g,c)))===0)return p}return p}function iR(u,a,c,p){if(!Ou(a,u.length))return NaN;for(let x=a[0];x<=a[1];++x)if(Ac(u[x],c,!0))return 0;let g=1/0;for(let x=a[0];x<a[1];++x)for(const w of c)for(let C=0,N=w.length,D=N-1;C<N;D=C++){if(f_(u[x],u[x+1],w[D],w[C]))return 0;g=Math.min(g,Gw(u[x],u[x+1],w[D],w[C],p))}return g}function uA(u,a){for(const c of u)for(let p=0;p<=c.length-1;++p)if(Ac(c[p],a,!0))return!0;return!1}function sR(u,a,c,p=1/0){const g=Nn(u),x=Nn(a);if(p!==1/0&&Op(g,x,c)>=p)return p;if(eh(g,x)){if(uA(u,a))return 0}else if(uA(a,u))return 0;let w=p;for(const C of u)for(let N=0,D=C.length,U=D-1;N<D;U=N++)for(const q of a)for(let H=0,Y=q.length,J=Y-1;H<Y;J=H++){if(f_(C[U],C[N],q[J],q[H]))return 0;w=Math.min(w,Gw(C[U],C[N],q[J],q[H],c))}return w}function __(u,a,c,p,g,x,w){if(x===null||w===null)return;const C=Op(jc(p,x),jc(g,w),c);C<a&&u.push({dist:C,range1:x,range2:w})}function aR(u,a,c,p,g=1/0){let x=Math.min(p.distance(u[0],c[0][0]),g);if(x===0)return x;const w=new g_([{dist:0,range1:[0,u.length-1],range2:[0,0]}],Hw),C=a?Pp:jp,N=Nn(c);for(;w.length;){const D=w.pop();if(D.dist>=x)continue;const U=D.range1;if(ey(U)<=C){if(!Ou(U,u.length))return NaN;if(a){const q=iR(u,U,c,p);if((x=Math.min(x,q))===0)return x}else for(let q=U[0];q<=U[1];++q){const H=nR(u[q],c,p);if((x=Math.min(x,H))===0)return x}}else{const q=y_(U,a);if(q[0]!==null){const H=Op(jc(u,q[0]),N,p);H<x&&w.push({dist:H,range1:q[0],range2:[0,0]})}if(q[1]!==null){const H=Op(jc(u,q[1]),N,p);H<x&&w.push({dist:H,range1:q[1],range2:[0,0]})}}}return x}function dA(u,a,c,p,g,x=1/0){let w=Math.min(x,g.distance(u[0],c[0]));if(w===0)return w;const C=new g_([{dist:0,range1:[0,u.length-1],range2:[0,c.length-1]}],Hw),N=a?Pp:jp,D=p?Pp:jp;for(;C.length;){const U=C.pop();if(U.dist>=w)continue;const q=U.range1,H=U.range2;if(ey(q)<=N&&ey(H)<=D){if(!Ou(q,u.length)||!Ou(H,c.length))return NaN;if(a&&p?w=Math.min(w,tR(u,q,c,H,g)):a||p?a&&!p?w=Math.min(w,cA(c,H,u,q,g)):!a&&p&&(w=Math.min(w,cA(u,q,c,H,g))):w=Math.min(w,rR(u,q,c,H,g)),w===0)return w}else{const Y=y_(q,a),J=y_(H,p);__(C,w,g,u,c,Y[0],J[0]),__(C,w,g,u,c,Y[0],J[1]),__(C,w,g,u,c,Y[1],J[0]),__(C,w,g,u,c,Y[1],J[1])}}return w}function Ww(u,a,c,p,g=1/0){let x=g;const w=jc(u,[0,u.length-1]);for(const C of c)if(!(x!==1/0&&Op(w,jc(C,[0,C.length-1]),p)>=x)&&(x=Math.min(x,dA(u,a,C,!0,p,x)),x===0))return x;return x}function x_(u,a,c,p,g=1/0){let x=g;const w=jc(u,[0,u.length-1]);for(const C of c){if(x!==1/0&&Op(w,Nn(C),p)>=x)continue;const N=aR(u,a,C,p,x);if(isNaN(N))return N;if((x=Math.min(x,N))===0)return x}return x}function Kw(u){return u==="Point"||u==="MultiPoint"||u==="LineString"||u==="MultiLineString"||u==="Polygon"||u==="MultiPolygon"}class pf{constructor(a,c){this.type=Or,this.geojson=a,this.geometries=c}static parse(a,c){if(a.length!==2)return c.error(`'distance' expression requires either one argument, but found ' ${a.length-1} instead.`);if(Sp(a[1])){const p=a[1];if(p.type==="FeatureCollection"){for(let g=0;g<p.features.length;++g)if(Kw(p.features[g].geometry.type))return new pf(p,p.features[g].geometry)}else if(p.type==="Feature"){if(Kw(p.geometry.type))return new pf(p,p.geometry)}else if(Kw(p.type))return new pf(p,p)}return c.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(a){const c=a.geometry(),p=a.canonicalID();if(c!=null&&p!=null){if(a.geometryType()==="Point")return function(g,x,w){const C=[];for(const D of g)for(const U of D)C.push(v_(U,x));const N=new Cp(C[0][1],"meters");return w.type==="Point"||w.type==="MultiPoint"||w.type==="LineString"?dA(C,!1,w.type==="Point"?[w.coordinates]:w.coordinates,w.type==="LineString",N):w.type==="MultiLineString"?Ww(C,!1,w.coordinates,N):w.type==="Polygon"||w.type==="MultiPolygon"?x_(C,!1,w.type==="Polygon"?[w.coordinates]:w.coordinates,N):null}(c,p,this.geometries);if(a.geometryType()==="LineString")return function(g,x,w){const C=[];for(const D of g){const U=[];for(const q of D)U.push(v_(q,x));C.push(U)}const N=new Cp(C[0][0][1],"meters");if(w.type==="Point"||w.type==="MultiPoint"||w.type==="LineString")return Ww(w.type==="Point"?[w.coordinates]:w.coordinates,w.type==="LineString",C,N);if(w.type==="MultiLineString"){let D=1/0;for(let U=0;U<w.coordinates.length;U++){const q=Ww(w.coordinates[U],!0,C,N,D);if(isNaN(q))return q;if((D=Math.min(D,q))===0)return D}return D}if(w.type==="Polygon"||w.type==="MultiPolygon"){let D=1/0;for(let U=0;U<C.length;U++){const q=x_(C[U],!0,w.type==="Polygon"?[w.coordinates]:w.coordinates,N,D);if(isNaN(q))return q;if((D=Math.min(D,q))===0)return D}return D}return null}(c,p,this.geometries);if(a.geometryType()==="Polygon")return function(g,x,w){const C=[];for(const D of function(U,q){const H=U.length;if(H<=1)return[U];const Y=[];let J,oe;for(let ce=0;ce<H;ce++){const he=KI(U[ce]);he!==0&&(U[ce].area=Math.abs(he),oe===void 0&&(oe=he<0),oe===he<0?(J&&Y.push(J),J=[U[ce]]):J.push(U[ce]))}return J&&Y.push(J),Y}(g)){const U=[];for(let q=0;q<D.length;++q)U.push(eR(D[q],x));C.push(U)}const N=new Cp(C[0][0][0][1],"meters");if(w.type==="Point"||w.type==="MultiPoint"||w.type==="LineString")return x_(w.type==="Point"?[w.coordinates]:w.coordinates,w.type==="LineString",C,N);if(w.type==="MultiLineString"){let D=1/0;for(let U=0;U<w.coordinates.length;U++){const q=x_(w.coordinates[U],!0,C,N,D);if(isNaN(q))return q;if((D=Math.min(D,q))===0)return D}return D}return w.type==="Polygon"||w.type==="MultiPolygon"?function(D,U,q){let H=1/0;for(const Y of D)for(const J of U){const oe=sR(Y,J,q,H);if(isNaN(oe))return oe;if((H=Math.min(H,oe))===0)return H}return H}(w.type==="Polygon"?[w.coordinates]:w.coordinates,C,N):null}(c,p,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function kp(u){if(u instanceof Bo&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof ff||u instanceof pf)return!1;if(u instanceof Ip)return u.featureConstant;let a=!0;return u.eachChild(c=>{a&&!kp(c)&&(a=!1)}),a}function ty(u){if(u instanceof Bo&&u.name==="feature-state")return!1;let a=!0;return u.eachChild(c=>{a&&!ty(c)&&(a=!1)}),a}function Np(u,a){if(u instanceof Bo&&a.indexOf(u.name)>=0)return!1;let c=!0;return u.eachChild(p=>{c&&!Np(p,a)&&(c=!1)}),c}function hA(u,a,c){return[u,a,c].filter(Boolean).join("")}function Zw(u,a){switch(u){case"string":return ju(a);case"number":return+a;case"boolean":return!!a;case"color":return hi.parse(a);case"formatted":return Ia.fromString(ju(a));case"resolvedImage":return gl.build(ju(a))}return a}function fA(u,a,c,p){return p!==void 0&&(u=p*Math.round(u/p)),a!==void 0&&u<a&&(u=a),c!==void 0&&u>c&&(u=c),u}class Ip{constructor(a,c,p,g=!1){this.type=a,this.key=c,this.scope=p,this.featureConstant=g}static parse(a,c){let p=c.expectedType;if(p==null&&(p=gi),a.length<2||a.length>3)return c.error("Invalid number of arguments for 'config' expression.");const g=c.parse(a[1],1);if(!(g instanceof ud))return c.error("Key name of 'config' expression must be a string literal.");let x,w=!0;const C=ju(g.value);if(a.length>=3){const N=c.parse(a[2],2);if(!(N instanceof ud))return c.error("Scope of 'config' expression must be a string literal.");x=ju(N.value)}if(c.options){const N=hA(C,x,c._scope),D=c.options.get(N);D&&(w=kp(D.value||D.default))}return new Ip(p,C,x,w)}evaluate(a){const c=hA(this.key,this.scope,a.scope),p=a.getConfig(c);if(!p)return null;const{type:g,value:x,values:w,minValue:C,maxValue:N,stepValue:D}=p,U=p.default.evaluate(a);let q=U;if(x){const H=a.scope;a.scope=(H||"").split("").slice(1).join(""),q=x.evaluate(a),a.scope=H}return g&&(q=Zw(g,q)),q===void 0||C===void 0&&N===void 0&&D===void 0||(typeof q=="number"?q=fA(q,C,N,D):Array.isArray(q)&&(q=q.map(H=>typeof H=="number"?fA(H,C,N,D):H))),x!==void 0&&q!==void 0&&w&&!w.includes(q)&&(q=U,g&&(q=Zw(g,q))),(g&&g!==this.type||q!==void 0&&!l_(wa(q),this.type))&&(q=Zw(this.type.kind,q)),q}eachChild(){}outputDefined(){return!1}serialize(){const a=["config",this.key];return this.scope&&a.concat(this.scope),a}}class b_{constructor(a,c){this.type=c.type,this.name=a,this.boundExpression=c}static parse(a,c){if(a.length!==2||typeof a[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const p=a[1];return c.scope.has(p)?new b_(p,c.scope.get(p)):c.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class w_{constructor(a,c=[],p,g=new Tc,x=[],w,C,N){this.registry=a,this.path=c,this.key=c.map(D=>typeof D=="string"?`['${D}']`:`[${D}]`).join(""),this.scope=g,this.errors=x,this.expectedType=p,this._scope=w,this.options=C,this.iconImageUseTheme=N}parse(a,c,p,g,x={}){return c||p?this.concat(c,null,p,g)._parse(a,x):this._parse(a,x)}parseObjectValue(a,c,p,g,x,w={}){return this.concat(c,p,g,x)._parse(a,w)}_parse(a,c){function p(g,x,w){return w==="assert"?new Er(x,[g]):w==="coerce"?new Pu(x,[g]):g}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=typeof a[0]=="string"?this.registry[a[0]]:void 0;if(g){let x=g.parse(a,this);if(!x)return null;if(this.expectedType){const w=this.expectedType,C=x.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||C.kind!=="value")if(w.kind!=="color"&&w.kind!=="formatted"&&w.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string"){if(this.checkSubtype(w,C))return null}else x=p(x,w,c.typeAnnotation||"coerce");else x=p(x,w,c.typeAnnotation||"assert")}if(!(x instanceof ud)&&x.type.kind!=="resolvedImage"&&Xw(x)){const w=new Ka(this._scope,this.options,this.iconImageUseTheme);try{x=new ud(x.type,x.evaluate(w))}catch(C){return this.error(C.message),null}}return x}return Pu.parse(["to-array",a],this)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,c,p,g){let x=typeof a=="number"?this.path.concat(a):this.path;x=typeof c=="string"?x.concat(c):x;const w=g?this.scope.concat(g):this.scope;return new w_(this.registry,x,p||null,w,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(a,...c){const p=`${this.key}${c.map(g=>`[${g}]`).join("")}`;this.errors.push(new Ec(p,a))}checkSubtype(a,c){const p=Gg(a,c);return p&&this.error(p),p}}function Xw(u){if(u instanceof b_)return Xw(u.boundExpression);if(u instanceof Bo&&u.name==="error"||u instanceof Tp||u instanceof ff||u instanceof pf||u instanceof Ip)return!1;const a=u instanceof Pu||u instanceof Er;let c=!0;return u.eachChild(p=>{c=a?c&&Xw(p):c&&p instanceof ud}),!!c&&kp(u)&&Np(u,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function S_(u,a){const c=u.length-1;let p,g,x=0,w=c,C=0;for(;x<=w;)if(C=Math.floor((x+w)/2),p=u[C],g=u[C+1],p<=a){if(C===c||a<g)return C;x=C+1}else{if(!(p>a))throw new Ms("Input is not a number.");w=C-1}return 0}class ry{constructor(a,c,p){this.type=a,this.input=c,this.labels=[],this.outputs=[];for(const[g,x]of p)this.labels.push(g),this.outputs.push(x)}static parse(a,c){if(a.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return c.error("Expected an even number of arguments.");const p=c.parse(a[1],1,Or);if(!p)return null;const g=[];let x=null;c.expectedType&&c.expectedType.kind!=="value"&&(x=c.expectedType);for(let w=1;w<a.length;w+=2){const C=w===1?-1/0:a[w],N=a[w+1],D=w,U=w+1;if(typeof C!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(g.length&&g[g.length-1][0]>=C)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const q=c.parse(N,U,x);if(!q)return null;x=x||q.type,g.push([C,q])}return new ry(x,p,g)}evaluate(a){const c=this.labels,p=this.outputs;if(c.length===1)return p[0].evaluate(a);const g=this.input.evaluate(a);if(g<=c[0])return p[0].evaluate(a);const x=c.length;return g>=c[x-1]?p[x-1].evaluate(a):p[S_(c,g)].evaluate(a)}eachChild(a){a(this.input);for(const c of this.outputs)a(c)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}serialize(){const a=["step",this.input.serialize()];for(let c=0;c<this.labels.length;c++)c>0&&a.push(this.labels[c]),a.push(this.outputs[c].serialize());return a}}const pA=.95047,mA=1.08883,gA=4/29,Rp=6/29,E_=3*Rp*Rp,oR=Rp*Rp*Rp,yA=Math.PI/180,lR=180/Math.PI;function Yw(u){return u>oR?Math.pow(u,1/3):u/E_+gA}function Jw(u){return u>Rp?u*u*u:E_*(u-gA)}function T_(u){return 255*(u<=.0031308?12.92*u:1.055*Math.pow(u,1/2.4)-.055)}function A_(u){return(u/=255)<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function mf(u){const a=A_(u.r),c=A_(u.g),p=A_(u.b),g=Yw((.4124564*a+.3575761*c+.1804375*p)/pA),x=Yw((.2126729*a+.7151522*c+.072175*p)/1);return{l:116*x-16,a:500*(g-x),b:200*(x-Yw((.0193339*a+.119192*c+.9503041*p)/mA)),alpha:u.a}}function Qw(u){let a=(u.l+16)/116,c=isNaN(u.a)?a:a+u.a/500,p=isNaN(u.b)?a:a-u.b/200;return a=1*Jw(a),c=pA*Jw(c),p=mA*Jw(p),new hi(T_(3.2404542*c-1.5371385*a-.4985314*p),T_(-.969266*c+1.8760108*a+.041556*p),T_(.0556434*c-.2040259*a+1.0572252*p),u.alpha)}function vA(u,a,c){const p=a-u;return u+c*(p>180||p<-180?p-360*Math.round(p/360):p)}const ny={forward:mf,reverse:Qw,interpolate:function(u,a,c){return{l:Kr(u.l,a.l,c),a:Kr(u.a,a.a,c),b:Kr(u.b,a.b,c),alpha:Kr(u.alpha,a.alpha,c)}}},gf={forward:function(u){const{l:a,a:c,b:p}=mf(u),g=Math.atan2(p,c)*lR;return{h:g<0?g+360:g,c:Math.sqrt(c*c+p*p),l:a,alpha:u.a}},reverse:function(u){const a=u.h*yA,c=u.c;return Qw({l:u.l,a:Math.cos(a)*c,b:Math.sin(a)*c,alpha:u.alpha})},interpolate:function(u,a,c){return{h:vA(u.h,a.h,c),c:Kr(u.c,a.c,c),l:Kr(u.l,a.l,c),alpha:Kr(u.alpha,a.alpha,c)}}};var C_=Object.freeze({__proto__:null,hcl:gf,lab:ny});class Gl{constructor(a,c,p,g,x){this.type=a,this.operator=c,this.interpolation=p,this.input=g,this.labels=[],this.outputs=[];for(const[w,C]of x)this.labels.push(w),this.outputs.push(C)}static interpolationFactor(a,c,p,g){let x=0;if(a.name==="exponential")x=e1(c,a.base,p,g);else if(a.name==="linear")x=e1(c,1,p,g);else if(a.name==="cubic-bezier"){const w=a.controlPoints;x=new Ga(w[0],w[1],w[2],w[3]).solve(e1(c,1,p,g))}return x}static parse(a,c){let[p,g,x,...w]=a;if(!Array.isArray(g)||g.length===0)return c.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const D=g[1];if(typeof D!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:D}}else{if(g[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const D=g.slice(1);if(D.length!==4||D.some(U=>typeof U!="number"||U<0||U>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:D}}}if(a.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length-1>3&&(a.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(x=c.parse(x,2,Or),!x)return null;const C=[];let N=null;p==="interpolate-hcl"||p==="interpolate-lab"?N=Ol:c.expectedType&&c.expectedType.kind!=="value"&&(N=c.expectedType);for(let D=0;D<w.length;D+=2){const U=w[D],q=w[D+1],H=D+3,Y=D+4;if(typeof U!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(C.length&&C[C.length-1][0]>=U)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',H);const J=c.parse(q,Y,N);if(!J)return null;N=N||J.type,C.push([U,J])}return N.kind==="number"||N.kind==="color"||N.kind==="array"&&N.itemType.kind==="number"&&typeof N.N=="number"?new Gl(N,p,g,x,C):c.error(`Type ${ra(N)} is not interpolatable.`)}evaluate(a){const c=this.labels,p=this.outputs;if(c.length===1)return p[0].evaluate(a);const g=this.input.evaluate(a);if(g<=c[0])return p[0].evaluate(a);const x=c.length;if(g>=c[x-1])return p[x-1].evaluate(a);const w=S_(c,g),C=Gl.interpolationFactor(this.interpolation,g,c[w],c[w+1]),N=p[w].evaluate(a),D=p[w+1].evaluate(a);return this.operator==="interpolate"?ld[this.type.kind.toLowerCase()](N,D,C):this.operator==="interpolate-hcl"?gf.reverse(gf.interpolate(gf.forward(N),gf.forward(D),C)):ny.reverse(ny.interpolate(ny.forward(N),ny.forward(D),C))}eachChild(a){a(this.input);for(const c of this.outputs)a(c)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}serialize(){let a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const c=[this.operator,a,this.input.serialize()];for(let p=0;p<this.labels.length;p++)c.push(this.labels[p],this.outputs[p].serialize());return c}}function e1(u,a,c,p){const g=p-c,x=u-c;return g===0?0:a===1?x/g:(Math.pow(a,x)-1)/(Math.pow(a,g)-1)}class iy{constructor(a,c){this.type=a,this.args=c}static parse(a,c){if(a.length<2)return c.error("Expectected at least one argument.");let p=null;const g=c.expectedType;g&&g.kind!=="value"&&(p=g);const x=[];for(const C of a.slice(1)){const N=c.parse(C,1+x.length,p,void 0,{typeAnnotation:"omit"});if(!N)return null;p=p||N.type,x.push(N)}const w=g&&x.some(C=>Gg(g,C.type));return new iy(w?gi:p,x)}evaluate(a){let c,p=null,g=0;for(const x of this.args){if(g++,p=x.evaluate(a),p&&p instanceof gl&&!p.available&&(c||(c=p),p=null,g===this.args.length))return c;if(p!==null)break}return p}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){const a=["coalesce"];return this.eachChild(c=>{a.push(c.serialize())}),a}}class sy{constructor(a,c){this.type=c.type,this.bindings=[].concat(a),this.result=c}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const c of this.bindings)a(c[1]);a(this.result)}static parse(a,c){if(a.length<4)return c.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const p=[];for(let x=1;x<a.length-1;x+=2){const w=a[x];if(typeof w!="string")return c.error(`Expected string, but found ${typeof w} instead.`,x);if(/[^a-zA-Z0-9_]/.test(w))return c.error("Variable names must contain only alphanumeric characters or '_'.",x);const C=c.parse(a[x+1],x+1);if(!C)return null;p.push([w,C])}const g=c.parse(a[a.length-1],a.length-1,c.expectedType,p);return g?new sy(p,g):null}outputDefined(){return this.result.outputDefined()}serialize(){const a=["let"];for(const[c,p]of this.bindings)a.push(c,p.serialize());return a.push(this.result.serialize()),a}}class t1{constructor(a,c,p){this.type=a,this.index=c,this.input=p}static parse(a,c){if(a.length!==3)return c.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const p=c.parse(a[1],1,Or),g=c.parse(a[2],2,Wa(c.expectedType||gi));return p&&g?new t1(g.type.itemType,p,g):null}evaluate(a){const c=this.index.evaluate(a),p=this.input.evaluate(a);if(c<0)throw new Ms("Array index out of bounds: negative index");if(c>=p.length)throw new Ms("Array index out of bounds: index exceeds array size");if(c!==Math.floor(c))throw new Ms("Array index must be an integer. Use at-interpolated for fractional indices");return p[c]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class r1{constructor(a,c,p){this.type=a,this.index=c,this.input=p}static parse(a,c){if(a.length!==3)return c.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const p=c.parse(a[1],1,Or),g=c.parse(a[2],2,Wa(c.expectedType||gi));return p&&g?new r1(g.type.itemType,p,g):null}evaluate(a){const c=this.index.evaluate(a),p=this.input.evaluate(a);if(c<0)throw new Ms(`Array index out of bounds: ${c} < 0.`);if(c>p.length-1)throw new Ms(`Array index out of bounds: ${c} > ${p.length-1}.`);if(c===Math.floor(c))return p[c];const g=Math.floor(c),x=Math.ceil(c),w=p[g],C=p[x];if(typeof w!="number"||typeof C!="number")throw new Ms(`Cannot interpolate between non-number values at index ${c}.`);const N=c-g;return w*(1-N)+C*N}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class n1{constructor(a,c){this.type=ui,this.needle=a,this.haystack=c}static parse(a,c){if(a.length!==3)return c.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const p=c.parse(a[1],1,gi),g=c.parse(a[2],2,gi);return p&&g?Lw(p.type,[ui,Xn,Or,bp,gi])?new n1(p,g):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${ra(p.type)} instead`):null}evaluate(a){const c=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(p==null)return!1;if(!Wg(c,["boolean","string","number","null"]))throw new Ms(`Expected first argument to be of type boolean, string, number or null, but found ${ra(wa(c))} instead.`);if(!Wg(p,["string","array"]))throw new Ms(`Expected second argument to be of type array or string, but found ${ra(wa(p))} instead.`);return p.indexOf(c)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ay{constructor(a,c,p){this.type=Or,this.needle=a,this.haystack=c,this.fromIndex=p}static parse(a,c){if(a.length<=2||a.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const p=c.parse(a[1],1,gi),g=c.parse(a[2],2,gi);if(!p||!g)return null;if(!Lw(p.type,[ui,Xn,Or,bp,gi]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${ra(p.type)} instead`);if(a.length===4){const x=c.parse(a[3],3,Or);return x?new ay(p,g,x):null}return new ay(p,g)}evaluate(a){const c=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(!Wg(c,["boolean","string","number","null"]))throw new Ms(`Expected first argument to be of type boolean, string, number or null, but found ${ra(wa(c))} instead.`);if(!Wg(p,["string","array"]))throw new Ms(`Expected second argument to be of type array or string, but found ${ra(wa(p))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(a);return p.indexOf(c,g)}return p.indexOf(c)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class j_{constructor(a,c,p,g,x,w){this.inputType=a,this.type=c,this.input=p,this.cases=g,this.outputs=x,this.otherwise=w}static parse(a,c){if(a.length<5)return c.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return c.error("Expected an even number of arguments.");let p,g;c.expectedType&&c.expectedType.kind!=="value"&&(g=c.expectedType);const x={},w=[];for(let D=2;D<a.length-1;D+=2){let U=a[D];const q=a[D+1];Array.isArray(U)||(U=[U]);const H=c.concat(D);if(U.length===0)return H.error("Expected at least one branch label.");for(const J of U){if(typeof J!="number"&&typeof J!="string")return H.error("Branch labels must be numbers or strings.");if(typeof J=="number"&&Math.abs(J)>Number.MAX_SAFE_INTEGER)return H.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof J=="number"&&Math.floor(J)!==J)return H.error("Numeric branch labels must be integer values.");if(p){if(H.checkSubtype(p,wa(J)))return null}else p=wa(J);if(x[String(J)]!==void 0)return H.error("Branch labels must be unique.");x[String(J)]=w.length}const Y=c.parse(q,D,g);if(!Y)return null;g=g||Y.type,w.push(Y)}const C=c.parse(a[1],1,gi);if(!C)return null;const N=c.parse(a[a.length-1],a.length-1,g);return N?C.type.kind!=="value"&&c.concat(1).checkSubtype(p,C.type)?null:new j_(p,g,C,x,w,N):null}evaluate(a){const c=this.input.evaluate(a);return(l_(wa(c),this.inputType)&&this.outputs[this.cases[c]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every(a=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const a=["match",this.input.serialize()],c=Object.keys(this.cases).sort(),p=[],g={};for(const w of c){const C=g[this.cases[w]];C===void 0?(g[this.cases[w]]=p.length,p.push([this.cases[w],[w]])):p[C][1].push(w)}const x=w=>this.inputType.kind==="number"?Number(w):w;for(const[w,C]of p)a.push(C.length===1?x(C[0]):C.map(x)),a.push(this.outputs[w].serialize());return a.push(this.otherwise.serialize()),a}}class Mp{constructor(a,c,p){this.type=a,this.branches=c,this.otherwise=p}static parse(a,c){if(a.length<4)return c.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return c.error("Expected an odd number of arguments.");let p;c.expectedType&&c.expectedType.kind!=="value"&&(p=c.expectedType);const g=[];for(let w=1;w<a.length-1;w+=2){const C=c.parse(a[w],w,ui);if(!C)return null;const N=c.parse(a[w+1],w+1,p);if(!N)return null;g.push([C,N]),p=p||N.type}const x=c.parse(a[a.length-1],a.length-1,p);return x?new Mp(p,g,x):null}evaluate(a){for(const[c,p]of this.branches)if(c.evaluate(a))return p.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[c,p]of this.branches)a(c),a(p);a(this.otherwise)}outputDefined(){return this.branches.every(([a,c])=>c.outputDefined())&&this.otherwise.outputDefined()}serialize(){const a=["case"];return this.eachChild(c=>{a.push(c.serialize())}),a}}class P_{constructor(a,c,p,g){this.type=a,this.input=c,this.beginIndex=p,this.endIndex=g}static parse(a,c){if(a.length<=2||a.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const p=c.parse(a[1],1,gi),g=c.parse(a[2],2,Or);if(!p||!g)return null;if(!Lw(p.type,[Wa(gi),Xn,gi]))return c.error(`Expected first argument to be of type array or string, but found ${ra(p.type)} instead`);if(a.length===4){const x=c.parse(a[3],3,Or);return x?new P_(p.type,p,g,x):null}return new P_(p.type,p,g)}evaluate(a){const c=this.input.evaluate(a),p=this.beginIndex.evaluate(a);if(!Wg(c,["string","array"]))throw new Ms(`Expected first argument to be of type array or string, but found ${ra(wa(c))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(a);return c.slice(p,g)}return c.slice(p)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class O_{constructor(a,c){this.type=Wa(Xn),this.str=a,this.delimiter=c}static parse(a,c){if(a.length!==3)return c.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const p=c.parse(a[1],1,Xn),g=c.parse(a[2],2,Xn);return p&&g?new O_(p,g):void 0}evaluate(a){const c=this.str.evaluate(a),p=this.delimiter.evaluate(a);return c.split(p)}eachChild(a){a(this.str),a(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function _A(u,a){return u==="=="||u==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function xA(u,a,c,p){return p.compare(a,c)===0}function Dp(u,a,c){const p=u!=="=="&&u!=="!=";return class $ie{constructor(x,w,C){this.type=ui,this.lhs=x,this.rhs=w,this.collator=C,this.hasUntypedArgument=x.type.kind==="value"||w.type.kind==="value"}static parse(x,w){if(x.length!==3&&x.length!==4)return w.error("Expected two or three arguments.");const C=x[0];let N=w.parse(x[1],1,gi);if(!N)return null;if(!_A(C,N.type))return w.concat(1).error(`"${C}" comparisons are not supported for type '${ra(N.type)}'.`);let D=w.parse(x[2],2,gi);if(!D)return null;if(!_A(C,D.type))return w.concat(2).error(`"${C}" comparisons are not supported for type '${ra(D.type)}'.`);if(N.type.kind!==D.type.kind&&N.type.kind!=="value"&&D.type.kind!=="value")return w.error(`Cannot compare types '${ra(N.type)}' and '${ra(D.type)}'.`);p&&(N.type.kind==="value"&&D.type.kind!=="value"?N=new Er(D.type,[N]):N.type.kind!=="value"&&D.type.kind==="value"&&(D=new Er(N.type,[D])));let U=null;if(x.length===4){if(N.type.kind!=="string"&&D.type.kind!=="string"&&N.type.kind!=="value"&&D.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(U=w.parse(x[3],3,qg),!U)return null}return new $ie(N,D,U)}evaluate(x){const w=this.lhs.evaluate(x),C=this.rhs.evaluate(x);if(p&&this.hasUntypedArgument){const N=wa(w),D=wa(C);if(N.kind!==D.kind||N.kind!=="string"&&N.kind!=="number")throw new Ms(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${N.kind}, ${D.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const N=wa(w),D=wa(C);if(N.kind!=="string"||D.kind!=="string")return a(x,w,C)}return this.collator?c(x,w,C,this.collator.evaluate(x)):a(x,w,C)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}serialize(){const x=[u];return this.eachChild(w=>{x.push(w.serialize())}),x}}}const bA=Dp("==",function(u,a,c){return a===c},xA),wA=Dp("!=",function(u,a,c){return a!==c},function(u,a,c,p){return!xA(0,a,c,p)}),cR=Dp("<",function(u,a,c){return a<c},function(u,a,c,p){return p.compare(a,c)<0}),uR=Dp(">",function(u,a,c){return a>c},function(u,a,c,p){return p.compare(a,c)>0}),dR=Dp("<=",function(u,a,c){return a<=c},function(u,a,c,p){return p.compare(a,c)<=0}),k_=Dp(">=",function(u,a,c){return a>=c},function(u,a,c,p){return p.compare(a,c)>=0});class i1{constructor(a,c,p,g,x,w){this.type=Xn,this.number=a,this.locale=c,this.currency=p,this.unit=g,this.minFractionDigits=x,this.maxFractionDigits=w}static parse(a,c){if(a.length!==3)return c.error("Expected two arguments.");const p=c.parse(a[1],1,Or);if(!p)return null;const g=a[2];if(typeof g!="object"||Array.isArray(g))return c.error("NumberFormat options argument must be an object.");let x=null;if(g.locale&&(x=c.parseObjectValue(g.locale,2,"locale",Xn),!x))return null;let w=null;if(g.currency&&(w=c.parseObjectValue(g.currency,2,"currency",Xn),!w))return null;let C=null;if(g.unit&&(C=c.parseObjectValue(g.unit,2,"unit",Xn),!C))return null;let N=null;if(g["min-fraction-digits"]&&(N=c.parseObjectValue(g["min-fraction-digits"],2,"min-fraction-digits",Or),!N))return null;let D=null;return g["max-fraction-digits"]&&(D=c.parseObjectValue(g["max-fraction-digits"],2,"max-fraction-digits",Or),!D)?null:new i1(p,x,w,C,N,D)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(a):void 0,unit:this.unit?this.unit.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.unit&&a(this.unit),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.unit&&(a.unit=this.unit.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]}}class s1{constructor(a){this.type=Or,this.input=a}static parse(a,c){if(a.length!==2)return c.error(`Expected 1 argument, but found ${a.length-1} instead.`);const p=c.parse(a[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${ra(p.type)} instead.`):new s1(p):null}evaluate(a){const c=this.input.evaluate(a);if(typeof c=="string"||Array.isArray(c))return c.length;throw new Ms(`Expected value to be of type string or array, but found ${ra(wa(c))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}serialize(){const a=["length"];return this.eachChild(c=>{a.push(c.serialize())}),a}}function SA(u){return function(){u=1831565813+(u|=0)|0;let a=Math.imul(u^u>>>15,1|u);return a=a+Math.imul(a^a>>>7,61|a)^a,((a^a>>>14)>>>0)/4294967296}}const Lp={"==":bA,"!=":wA,">":uR,"<":cR,">=":k_,"<=":dR,array:Er,at:t1,"at-interpolated":r1,boolean:Er,case:Mp,coalesce:iy,collator:Tp,format:df,image:tn,in:n1,"index-of":ay,interpolate:Gl,"interpolate-hcl":Gl,"interpolate-lab":Gl,length:s1,let:sy,literal:ud,match:j_,number:Er,"number-format":i1,object:Er,slice:P_,step:ry,string:Er,"to-boolean":Pu,"to-color":Pu,"to-number":Pu,"to-string":Pu,var:b_,within:ff,distance:pf,config:Ip,split:O_};function a1(u,[a,c,p,g]){a=a.evaluate(u),c=c.evaluate(u),p=p.evaluate(u);const x=g?g.evaluate(u):1,w=c_(a,c,p,x);if(w)throw new Ms(w);return new hi(a/255,c/255,p/255,x)}function EA(u,[a,c,p,g]){a=a.evaluate(u),c=c.evaluate(u),p=p.evaluate(u);const x=g?g.evaluate(u):1,w=function(D,U,q,H){return typeof D=="number"&&D>=0&&D<=360?typeof U=="number"&&U>=0&&U<=100&&typeof q=="number"&&q>=0&&q<=100?H===void 0||typeof H=="number"&&H>=0&&H<=1?null:`Invalid hsla value [${[D,U,q,H].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof H=="number"?[D,U,q,H]:[D,U,q]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof H=="number"?[D,U,q,H]:[D,U,q]).join(", ")}]: 'h' must be between 0 and 360.`}(a,c,p,x);if(w)throw new Ms(w);const C=`hsla(${a}, ${c}%, ${p}%, ${x})`,N=hi.parse(C);if(!N)throw new Ms(`Failed to parse HSLA color: ${C}`);return N}function TA(u,a){return u in a}function N_(u,a){const c=a[u];return c===void 0?null:c}function hd(u){return{type:u}}function oy(u){if(u instanceof Ip)return new Set([u.key]);let a=new Set;return u.eachChild(c=>{a=new Set([...a,...oy(c)])}),a}function I_(u){if(u instanceof Bo&&u.name==="is-active-floor")return!0;let a=!1;return u.eachChild(c=>{!a&&I_(c)&&(a=!0)}),a}function yf(u){return{result:"success",value:u}}function nh(u){return{result:"error",value:u}}function o1(u,a){return!!u&&!!u.parameters&&u.parameters.indexOf(a)>-1}function R_(u){return u["property-type"]==="data-driven"}function l1(u){return o1(u.expression,"measure-light")}function c1(u){return o1(u.expression,"zoom")}function M_(u){return!!u.expression&&u.expression.interpolated}function D_(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function u1(u){return u}function L_(u,a){const c=a.type==="color",p=u.stops&&typeof u.stops[0][0]=="object",g=p||!(p||u.property!==void 0),x=u.type||(M_(a)?"exponential":"interval");if(c&&((u=Object.assign({},u)).stops&&(u.stops=u.stops.map(D=>[D[0],hi.parse(D[1])])),u.default=hi.parse(u.default?u.default:a.default)),u.colorSpace&&u.colorSpace!=="rgb"&&!C_[u.colorSpace])throw new Error(`Unknown color space: ${u.colorSpace}`);let w,C,N;if(x==="exponential")w=AA;else if(x==="interval")w=ih;else if(x==="categorical"){w=hR,C=Object.create(null);for(const D of u.stops)C[D[0]]=D[1];N=typeof u.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);w=fR}if(p){const D={},U=[];for(let Y=0;Y<u.stops.length;Y++){const J=u.stops[Y],oe=J[0].zoom;D[oe]===void 0&&(D[oe]={zoom:oe,type:u.type,property:u.property,default:u.default,stops:[]},U.push(oe)),D[oe].stops.push([J[0].value,J[1]])}const q=[];for(const Y of U)q.push([D[Y].zoom,L_(D[Y],a)]);const H={name:"linear"};return{kind:"composite",interpolationType:H,interpolationFactor:Gl.interpolationFactor.bind(void 0,H),zoomStops:q.map(Y=>Y[0]),evaluate:({zoom:Y},J)=>AA({stops:q,base:u.base},a,Y).evaluate(Y,J)}}if(g){const D=x==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:Gl.interpolationFactor.bind(void 0,D),zoomStops:u.stops.map(U=>U[0]),evaluate:({zoom:U})=>w(u,a,U,C,N)}}return{kind:"source",evaluate(D,U){const q=U&&U.properties?U.properties[u.property]:void 0;return q===void 0?Fp(u.default,a.default):w(u,a,q,C,N)}}}function Fp(u,a,c){return u!==void 0?u:a!==void 0?a:c!==void 0?c:void 0}function hR(u,a,c,p,g){return Fp(typeof c===g?p[c]:void 0,u.default,a.default)}function ih(u,a,c){if(!Zg(c))return Fp(u.default,a.default);const p=u.stops.length;if(p===1||c<=u.stops[0][0])return u.stops[0][1];if(c>=u.stops[p-1][0])return u.stops[p-1][1];const g=S_(u.stops.map(x=>x[0]),c);return u.stops[g][1]}function AA(u,a,c){const p=u.base!==void 0?u.base:1;if(!Zg(c))return Fp(u.default,a.default);const g=u.stops.length;if(g===1||c<=u.stops[0][0])return u.stops[0][1];if(c>=u.stops[g-1][0])return u.stops[g-1][1];const x=S_(u.stops.map(U=>U[0]),c),w=function(U,q,H,Y){const J=Y-H,oe=U-H;return J===0?0:q===1?oe/J:(Math.pow(q,oe)-1)/(Math.pow(q,J)-1)}(c,p,u.stops[x][0],u.stops[x+1][0]),C=u.stops[x][1],N=u.stops[x+1][1];let D=ld[a.type]||u1;if(u.colorSpace&&u.colorSpace!=="rgb"){const U=C_[u.colorSpace];D=(q,H)=>U.reverse(U.interpolate(U.forward(q),U.forward(H),w))}return typeof C.evaluate=="function"?{evaluate(...U){const q=C.evaluate.apply(void 0,U),H=N.evaluate.apply(void 0,U);if(q!==void 0&&H!==void 0)return D(q,H,w)}}:D(C,N,w)}function fR(u,a,c){return a.type==="color"?c=hi.parse(c):a.type==="formatted"?c=Ia.fromString(c.toString()):a.type==="resolvedImage"?c=gl.build(c.toString()):Ep(c)===a.type||a.type==="enum"&&a.values[c]||(c=void 0),Fp(c,u.default,a.default)}Bo.register(Lp,{error:[{kind:"error"},[Xn],(u,[a])=>{throw new Ms(a.evaluate(u))}],typeof:[Xn,[gi],(u,[a])=>ra(wa(a.evaluate(u)))],"to-rgba":[Wa(Or,4),[Ol],(u,[a])=>a.evaluate(u).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Wa(Or,4),[Ol],(u,[a])=>a.evaluate(u).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Ol,[Or,Or,Or],a1],rgba:[Ol,[Or,Or,Or,Or],a1],hsl:[Ol,[Or,Or,Or],EA],hsla:[Ol,[Or,Or,Or,Or],EA],has:{type:ui,overloads:[[[Xn],(u,[a])=>TA(a.evaluate(u),u.properties())],[[Xn,wp],(u,[a,c])=>TA(a.evaluate(u),c.evaluate(u))]]},get:{type:gi,overloads:[[[Xn],(u,[a])=>N_(a.evaluate(u),u.properties())],[[Xn,wp],(u,[a,c])=>N_(a.evaluate(u),c.evaluate(u))]]},"feature-state":[gi,[Xn],(u,[a])=>N_(a.evaluate(u),u.featureState||{})],properties:[wp,[],u=>u.properties()],"geometry-type":[Xn,[],u=>u.geometryType()],worldview:[Xn,[],u=>u.globals.worldview||""],"is-active-floor":[ui,hd(Xn),(u,a)=>{if(!(u.globals.activeFloors&&u.globals.activeFloors.size>0))return!1;const c=u.globals.activeFloors;return a.some(p=>{const g=p.evaluate(u);return c.has(g)})}],id:[gi,[],u=>u.id()],zoom:[Or,[],u=>u.globals.zoom],pitch:[Or,[],u=>u.globals.pitch||0],"distance-from-center":[Or,[],u=>u.distanceFromCenter()],"measure-light":[Or,[Xn],(u,[a])=>u.measureLight(a.evaluate(u))],"heatmap-density":[Or,[],u=>u.globals.heatmapDensity||0],"line-progress":[Or,[],u=>u.globals.lineProgress||0],"raster-value":[Or,[],u=>u.globals.rasterValue||0],"raster-particle-speed":[Or,[],u=>u.globals.rasterParticleSpeed||0],"sky-radial-progress":[Or,[],u=>u.globals.skyRadialProgress||0],accumulated:[gi,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[Or,hd(Or),(u,a)=>{let c=0;for(const p of a)c+=p.evaluate(u);return c}],"*":[Or,hd(Or),(u,a)=>{let c=1;for(const p of a)c*=p.evaluate(u);return c}],"-":{type:Or,overloads:[[[Or,Or],(u,[a,c])=>a.evaluate(u)-c.evaluate(u)],[[Or],(u,[a])=>-a.evaluate(u)]]},"/":[Or,[Or,Or],(u,[a,c])=>a.evaluate(u)/c.evaluate(u)],"%":[Or,[Or,Or],(u,[a,c])=>a.evaluate(u)%c.evaluate(u)],ln2:[Or,[],()=>Math.LN2],pi:[Or,[],()=>Math.PI],e:[Or,[],()=>Math.E],"^":[Or,[Or,Or],(u,[a,c])=>Math.pow(a.evaluate(u),c.evaluate(u))],sqrt:[Or,[Or],(u,[a])=>Math.sqrt(a.evaluate(u))],log10:[Or,[Or],(u,[a])=>Math.log(a.evaluate(u))/Math.LN10],ln:[Or,[Or],(u,[a])=>Math.log(a.evaluate(u))],log2:[Or,[Or],(u,[a])=>Math.log2(a.evaluate(u))],sin:[Or,[Or],(u,[a])=>Math.sin(a.evaluate(u))],cos:[Or,[Or],(u,[a])=>Math.cos(a.evaluate(u))],tan:[Or,[Or],(u,[a])=>Math.tan(a.evaluate(u))],asin:[Or,[Or],(u,[a])=>Math.asin(a.evaluate(u))],acos:[Or,[Or],(u,[a])=>Math.acos(a.evaluate(u))],atan:[Or,[Or],(u,[a])=>Math.atan(a.evaluate(u))],min:[Or,hd(Or),(u,a)=>Math.min(...a.map(c=>c.evaluate(u)))],max:[Or,hd(Or),(u,a)=>Math.max(...a.map(c=>c.evaluate(u)))],abs:[Or,[Or],(u,[a])=>Math.abs(a.evaluate(u))],round:[Or,[Or],(u,[a])=>{const c=a.evaluate(u);return c<0?-Math.round(-c):Math.round(c)}],floor:[Or,[Or],(u,[a])=>Math.floor(a.evaluate(u))],ceil:[Or,[Or],(u,[a])=>Math.ceil(a.evaluate(u))],"filter-==":[ui,[Xn,gi],(u,[a,c])=>u.properties()[a.value]===c.value],"filter-id-==":[ui,[gi],(u,[a])=>u.id()===a.value],"filter-type-==":[ui,[Xn],(u,[a])=>u.geometryType()===a.value],"filter-<":[ui,[Xn,gi],(u,[a,c])=>{const p=u.properties()[a.value],g=c.value;return typeof p==typeof g&&p<g}],"filter-id-<":[ui,[gi],(u,[a])=>{const c=u.id(),p=a.value;return typeof c==typeof p&&c<p}],"filter->":[ui,[Xn,gi],(u,[a,c])=>{const p=u.properties()[a.value],g=c.value;return typeof p==typeof g&&p>g}],"filter-id->":[ui,[gi],(u,[a])=>{const c=u.id(),p=a.value;return typeof c==typeof p&&c>p}],"filter-<=":[ui,[Xn,gi],(u,[a,c])=>{const p=u.properties()[a.value],g=c.value;return typeof p==typeof g&&p<=g}],"filter-id-<=":[ui,[gi],(u,[a])=>{const c=u.id(),p=a.value;return typeof c==typeof p&&c<=p}],"filter->=":[ui,[Xn,gi],(u,[a,c])=>{const p=u.properties()[a.value],g=c.value;return typeof p==typeof g&&p>=g}],"filter-id->=":[ui,[gi],(u,[a])=>{const c=u.id(),p=a.value;return typeof c==typeof p&&c>=p}],"filter-has":[ui,[gi],(u,[a])=>a.value in u.properties()],"filter-has-id":[ui,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[ui,[Wa(Xn)],(u,[a])=>a.value.indexOf(u.geometryType())>=0],"filter-id-in":[ui,[Wa(gi)],(u,[a])=>a.value.indexOf(u.id())>=0],"filter-in-small":[ui,[Xn,Wa(gi)],(u,[a,c])=>c.value.indexOf(u.properties()[a.value])>=0],"filter-in-large":[ui,[Xn,Wa(gi)],(u,[a,c])=>function(p,g,x,w){for(;x<=w;){const C=x+w>>1;if(g[C]===p)return!0;g[C]>p?w=C-1:x=C+1}return!1}(u.properties()[a.value],c.value,0,c.value.length-1)],all:{type:ui,overloads:[[[ui,ui],(u,[a,c])=>a.evaluate(u)&&c.evaluate(u)],[hd(ui),(u,a)=>{for(const c of a)if(!c.evaluate(u))return!1;return!0}]]},any:{type:ui,overloads:[[[ui,ui],(u,[a,c])=>a.evaluate(u)||c.evaluate(u)],[hd(ui),(u,a)=>{for(const c of a)if(c.evaluate(u))return!0;return!1}]]},"!":[ui,[ui],(u,[a])=>!a.evaluate(u)],"is-supported-script":[ui,[Xn],(u,[a])=>{const c=u.globals&&u.globals.isSupportedScript;return!c||c(a.evaluate(u))}],upcase:[Xn,[Xn],(u,[a])=>a.evaluate(u).toUpperCase()],downcase:[Xn,[Xn],(u,[a])=>a.evaluate(u).toLowerCase()],concat:[Xn,hd(gi),(u,a)=>a.map(c=>ju(c.evaluate(u))).join("")],"resolved-locale":[Xn,[qg],(u,[a])=>a.evaluate(u).resolvedLocale()],random:[Or,[Or,Or,gi],(u,a)=>{const[c,p,g]=a.map(w=>w.evaluate(u));if(c>p||c===p)return c;let x;if(typeof g=="string")x=function(w){let C=0;if(w.length===0)return C;for(let N=0;N<w.length;N++)C=(C<<5)-C+w.charCodeAt(N),C|=0;return C}(g);else{if(typeof g!="number")throw new Ms(`Invalid seed input: ${g}`);x=g}return c+SA(x)()*(p-c)}]});class F_{constructor(a,c,p,g,x){this.expression=a,this._warningHistory={},this._scope=p,this._options=g,this._iconImageUseTheme=x,this._evaluator=new Ka(p,g,x),this._defaultValue=c?function(w){return w.type==="color"&&(D_(w.default)||Array.isArray(w.default))?new hi(0,0,0,0):w.type==="color"?hi.parse(w.default)||null:w.default===void 0?null:w.default}(c):null,this._enumValues=c&&c.type==="enum"?c.values:null,this.configDependencies=oy(a),this.isIndoorDependent=I_(a)}evaluateWithoutErrorHandling(a,c,p,g,x,w,C,N){return this._evaluator.globals=a,this._evaluator.feature=c,this._evaluator.featureState=p,this._evaluator.canonical=g||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=w,this._evaluator.featureTileCoord=C||null,this._evaluator.featureDistanceData=N||null,this.expression.evaluate(this._evaluator)}evaluate(a,c,p,g,x,w,C,N,D){this._evaluator||(this._evaluator=new Ka(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=a,this._evaluator.feature=c||null,this._evaluator.featureState=p||null,this._evaluator.canonical=g||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=w||null,this._evaluator.featureTileCoord=C||null,this._evaluator.featureDistanceData=N||null,this._evaluator.iconImageUseTheme=D||null;try{const U=this.expression.evaluate(this._evaluator);if(U==null||typeof U=="number"&&U!=U)return this._defaultValue;if(this._enumValues&&!(U in this._enumValues))throw new Ms(`Expected value to be one of ${Object.keys(this._enumValues).map(q=>JSON.stringify(q)).join(", ")}, but found ${JSON.stringify(U)} instead.`);return U}catch(U){return this._warningHistory[U.message]||(this._warningHistory[U.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${U.message}`)),this._defaultValue}}}function z_(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in Lp}function ku(u,a,c,p,g){const x=new w_(Lp,[],a?function(C){const N={color:Ol,string:Xn,number:Or,enum:Xn,boolean:ui,formatted:uf,resolvedImage:Hg};return C.type==="array"?Wa(N[C.value]||gi,C.length):N[C.type]}(a):void 0,void 0,void 0,c,p,g),w=x.parse(u,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return w?yf(new F_(w,a,c,p,g)):nh(x.errors)}class ly{constructor(a,c,p,g){this.kind=a,this._styleExpression=c,this.isLightConstant=p,this.isLineProgressConstant=g,this.isStateDependent=a!=="constant"&&!ty(c.expression),this.configDependencies=oy(c.expression),this.isIndoorDependent=I_(c.expression)}evaluateWithoutErrorHandling(a,c,p,g,x,w){return this._styleExpression.evaluateWithoutErrorHandling(a,c,p,g,x,w)}evaluate(a,c,p,g,x,w,C){return this._styleExpression.evaluate(a,c,p,g,x,w,void 0,void 0,C)}}class sh{constructor(a,c,p,g,x,w){this.kind=a,this.zoomStops=p,this._styleExpression=c,this.isStateDependent=a!=="camera"&&!ty(c.expression),this.isIndoorDependent=I_(c.expression),this.isLightConstant=x,this.isLineProgressConstant=w,this.configDependencies=oy(c.expression),this.interpolationType=g}evaluateWithoutErrorHandling(a,c,p,g,x,w){return this._styleExpression.evaluateWithoutErrorHandling(a,c,p,g,x,w)}evaluate(a,c,p,g,x,w){return this._styleExpression.evaluate(a,c,p,g,x,w)}interpolationFactor(a,c,p){return this.interpolationType?Gl.interpolationFactor(this.interpolationType,a,c,p):0}}function d1(u,a,c,p,g){if((u=ku(u,a,c,p,g)).result==="error")return u;const x=u.value.expression,w=kp(x);if(!w&&!R_(a))return nh([new Ec("","data expressions not supported")]);const C=Np(x,["zoom","pitch","distance-from-center"]);if(!C&&!c1(a))return nh([new Ec("","zoom expressions not supported")]);const N=Np(x,["measure-light"]);if(!N&&!l1(a))return nh([new Ec("","measure-light expression not supported")]);const D=Np(x,["line-progress"]);if(!D&&!function(H){return o1(H.expression,"line-progress")}(a))return nh([new Ec("","line-progress expression not supported")]);const U=a.expression&&a.expression.relaxZoomRestriction,q=$_(x);return q||C||U?q instanceof Ec?nh([q]):q instanceof Gl&&!M_(a)?nh([new Ec("",'"interpolate" expressions cannot be used with this property')]):yf(q?new sh(w&&D?"camera":"composite",u.value,q.labels,q instanceof Gl?q.interpolation:void 0,N,D):new ly(w&&D?"constant":"source",u.value,N,D)):nh([new Ec("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class B_{constructor(a,c){this._parameters=a,this._specification=c,Object.assign(this,L_(this._parameters,this._specification))}static deserialize(a){return new B_(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function $_(u){let a=null;if(u instanceof sy)a=$_(u.result);else if(u instanceof iy){for(const c of u.args)if(a=$_(c),a)break}else(u instanceof ry||u instanceof Gl)&&u.input instanceof Bo&&u.input.name==="zoom"&&(a=u);return a instanceof Ec||u.eachChild(c=>{const p=$_(c);p instanceof Ec?a=p:a&&p&&a!==p&&(a=new Ec("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),a}var cy,U_,CA=function(){if(U_)return cy;U_=1,cy=a;var u=3;function a(c,p,g){var x=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;var w=new Int32Array(this.arrayBuffer);c=w[0],this.d=(p=w[1])+2*(g=w[2]);for(var C=0;C<this.d*this.d;C++){var N=w[u+C],D=w[u+C+1];x.push(N===D?null:w.subarray(N,D))}var U=w[u+x.length+1];this.keys=w.subarray(w[u+x.length],U),this.bboxes=w.subarray(U),this.insert=this._insertReadonly}else{this.d=p+2*g;for(var q=0;q<this.d*this.d;q++)x.push([]);this.keys=[],this.bboxes=[]}this.n=p,this.extent=c,this.padding=g,this.scale=p/c,this.uid=0;var H=g/p*c;this.min=-H,this.max=c+H}return a.prototype.insert=function(c,p,g,x,w){this._forEachCell(p,g,x,w,this._insertCell,this.uid++),this.keys.push(c),this.bboxes.push(p),this.bboxes.push(g),this.bboxes.push(x),this.bboxes.push(w)},a.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},a.prototype._insertCell=function(c,p,g,x,w,C){this.cells[w].push(C)},a.prototype.query=function(c,p,g,x,w){var C=this.min,N=this.max;if(c<=C&&p<=C&&N<=g&&N<=x&&!w)return Array.prototype.slice.call(this.keys);var D=[];return this._forEachCell(c,p,g,x,this._queryCell,D,{},w),D},a.prototype._queryCell=function(c,p,g,x,w,C,N,D){var U=this.cells[w];if(U!==null)for(var q=this.keys,H=this.bboxes,Y=0;Y<U.length;Y++){var J=U[Y];if(N[J]===void 0){var oe=4*J;(D?D(H[oe+0],H[oe+1],H[oe+2],H[oe+3]):c<=H[oe+2]&&p<=H[oe+3]&&g>=H[oe+0]&&x>=H[oe+1])?(N[J]=!0,C.push(q[J])):N[J]=!1}}},a.prototype._forEachCell=function(c,p,g,x,w,C,N,D){for(var U=this._convertToCellCoord(c),q=this._convertToCellCoord(p),H=this._convertToCellCoord(g),Y=this._convertToCellCoord(x),J=U;J<=H;J++)for(var oe=q;oe<=Y;oe++){var ce=this.d*oe+J;if((!D||D(this._convertFromCellCoord(J),this._convertFromCellCoord(oe),this._convertFromCellCoord(J+1),this._convertFromCellCoord(oe+1)))&&w.call(this,c,p,g,x,ce,C,N,D))return}},a.prototype._convertFromCellCoord=function(c){return(c-this.padding)/this.scale},a.prototype._convertToCellCoord=function(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))},a.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var c=this.cells,p=u+this.cells.length+1+1,g=0,x=0;x<this.cells.length;x++)g+=this.cells[x].length;var w=new Int32Array(p+g+this.keys.length+this.bboxes.length);w[0]=this.extent,w[1]=this.n,w[2]=this.padding;for(var C=p,N=0;N<c.length;N++){var D=c[N];w[u+N]=C,w.set(D,C),C+=D.length}return w[u+c.length]=C,w.set(this.keys,C),w[u+c.length+1]=C+=this.keys.length,w.set(this.bboxes,C),C+=this.bboxes.length,w.buffer},cy}(),vf=zi(CA);const zp={};function _r(u,a,c={}){Object.defineProperty(u,"_classRegistryKey",{value:a,writable:!1}),zp[a]={klass:u,omit:c.omit||[]}}_r(Object,"Object"),vf.serialize=function(u,a){const c=u.toArrayBuffer();return a&&a.add(c),{buffer:c}},vf.deserialize=function(u){return new vf(u.buffer)},Object.defineProperty(vf,"name",{value:"Grid"}),_r(vf,"Grid"),delete st.prototype.constructor,typeof DOMMatrix<"u"&&_r(DOMMatrix,"DOMMatrix"),_r(hi,"Color"),_r(Error,"Error"),_r(Ia,"Formatted"),_r(Kg,"FormattedSection"),_r(lf,"AJAXError"),_r(gl,"ResolvedImage"),_r(B_,"StylePropertyFunction"),_r(F_,"StyleExpression",{omit:["_evaluator"]}),_r(da,"ImageId"),_r(cd,"ImageVariant"),_r(sh,"ZoomDependentExpression"),_r(ly,"ZoomConstantExpression"),_r(Bo,"CompoundExpression",{omit:["_evaluate"]});for(const u in Lp)zp[Lp[u]._classRegistryKey]||_r(Lp[u],`Expression${u}`);function h1(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function fd(u){return self.ImageBitmap&&u instanceof ImageBitmap}function ah(u,a){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp)return u;if(h1(u)||fd(u))return a&&a.add(u),u;if(ArrayBuffer.isView(u))return a&&a.add(u.buffer),u;if(u instanceof ImageData)return a&&a.add(u.data.buffer),u;if(Array.isArray(u)){const c=[];for(const p of u)c.push(ah(p,a));return c}if(u instanceof Map){const c={$name:"Map",entries:[]};for(const[p,g]of u.entries())c.entries.push(ah(p),ah(g,a));return c}if(u instanceof Set){const c={$name:"Set"};let p=0;for(const g of u.values())c[++p]=ah(g);return c}if(u instanceof DOMMatrix){const c={$name:"DOMMatrix"},p=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const g of p)c[g]=u[g];return c}if(typeof u=="bigint")return{$name:"BigInt",value:u.toString()};if(typeof u=="object"){const c=u.constructor,p=c._classRegistryKey;if(!p)throw new Error(`Can't serialize object of unregistered class "${c.name}".`);const g=c.serialize?c.serialize(u,a):{};if(!c.serialize){for(const x in u)u.hasOwnProperty(x)&&(zp[p].omit.indexOf(x)>=0||(g[x]=ah(u[x],a)));u instanceof Error&&(g.message=u.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return p!=="Object"&&(g.$name=p),g}throw new Error("can't serialize object of type "+typeof u)}function oh(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||h1(u)||fd(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(oh);if(typeof u=="object"){const a=u.$name||"Object";if(a==="Map"){const g=u.entries||[],x=new Map;for(let w=0;w<g.length;w+=2)x.set(oh(g[w]),oh(g[w+1]));return x}if(a==="Set"){const g=new Set;for(const x of Object.keys(u))x!=="$name"&&g.add(oh(u[x]));return g}if(a==="DOMMatrix"){let g;return g=u.is2D?[u.a,u.b,u.c,u.d,u.e,u.f]:[u.m11,u.m12,u.m13,u.m14,u.m21,u.m22,u.m23,u.m24,u.m31,u.m32,u.m33,u.m34,u.m41,u.m42,u.m43,u.m44],new DOMMatrix(g)}if(a==="BigInt")return BigInt(u.value);const{klass:c}=zp[a];if(!c)throw new Error(`Can't deserialize unregistered class "${a}".`);if(c.deserialize)return c.deserialize(u);const p=Object.create(c.prototype);for(const g of Object.keys(u))g!=="$name"&&(p[g]=oh(u[g]));return p}throw new Error("can't deserialize object of type "+typeof u)}const Br={"Latin-1 Supplement":u=>u>=128&&u<=255,Arabic:u=>u>=1536&&u<=1791,"Arabic Supplement":u=>u>=1872&&u<=1919,"Arabic Extended-A":u=>u>=2208&&u<=2303,"Hangul Jamo":u=>u>=4352&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>u>=5120&&u<=5759,Khmer:u=>u>=6016&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>u>=6320&&u<=6399,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"CJK Radicals Supplement":u=>u>=11904&&u<=12031,"Kangxi Radicals":u=>u>=12032&&u<=12255,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Bopomofo:u=>u>=12544&&u<=12591,"Hangul Compatibility Jamo":u=>u>=12592&&u<=12687,Kanbun:u=>u>=12688&&u<=12703,"Bopomofo Extended":u=>u>=12704&&u<=12735,"CJK Strokes":u=>u>=12736&&u<=12783,"Katakana Phonetic Extensions":u=>u>=12784&&u<=12799,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"CJK Unified Ideographs Extension A":u=>u>=13312&&u<=19903,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Yi Syllables":u=>u>=40960&&u<=42127,"Yi Radicals":u=>u>=42128&&u<=42191,"Hangul Jamo Extended-A":u=>u>=43360&&u<=43391,"Hangul Syllables":u=>u>=44032&&u<=55215,"Hangul Jamo Extended-B":u=>u>=55216&&u<=55295,"Private Use Area":u=>u>=57344&&u<=63743,"CJK Compatibility Ideographs":u=>u>=63744&&u<=64255,"Arabic Presentation Forms-A":u=>u>=64336&&u<=65023,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Arabic Presentation Forms-B":u=>u>=65136&&u<=65279,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519,Osage:u=>u>=66736&&u<=66815,"CJK Unified Ideographs Extension B":u=>u>=131072&&u<=173791};function f1(u){for(const a of u)if(q_(a.charCodeAt(0)))return!0;return!1}function jA(u){for(const a of u)if(!V_(a.charCodeAt(0)))return!1;return!0}function V_(u){return!(Br.Arabic(u)||Br["Arabic Supplement"](u)||Br["Arabic Extended-A"](u)||Br["Arabic Presentation Forms-A"](u)||Br["Arabic Presentation Forms-B"](u))}function q_(u){return!(u!==746&&u!==747&&(u<4352||!(Br["Bopomofo Extended"](u)||Br.Bopomofo(u)||Br["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||Br["CJK Compatibility Ideographs"](u)||Br["CJK Compatibility"](u)||Br["CJK Radicals Supplement"](u)||Br["CJK Strokes"](u)||!(!Br["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||Br["CJK Unified Ideographs Extension A"](u)||Br["CJK Unified Ideographs"](u)||Br["Enclosed CJK Letters and Months"](u)||Br["Hangul Compatibility Jamo"](u)||Br["Hangul Jamo Extended-A"](u)||Br["Hangul Jamo Extended-B"](u)||Br["Hangul Jamo"](u)||Br["Hangul Syllables"](u)||Br.Hiragana(u)||Br["Ideographic Description Characters"](u)||Br.Kanbun(u)||Br["Kangxi Radicals"](u)||Br["Katakana Phonetic Extensions"](u)||Br.Katakana(u)&&u!==12540||!(!Br["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!Br["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||Br["Unified Canadian Aboriginal Syllabics"](u)||Br["Unified Canadian Aboriginal Syllabics Extended"](u)||Br["Vertical Forms"](u)||Br["Yijing Hexagram Symbols"](u)||Br["Yi Syllables"](u)||Br["Yi Radicals"](u))))}function p1(u){return!(q_(u)||function(a){return!!(Br["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||Br["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||Br["Letterlike Symbols"](a)||Br["Number Forms"](a)||Br["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||Br["Control Pictures"](a)&&a!==9251||Br["Optical Character Recognition"](a)||Br["Enclosed Alphanumerics"](a)||Br["Geometric Shapes"](a)||Br["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||Br["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||Br["CJK Symbols and Punctuation"](a)||Br.Katakana(a)||Br["Private Use Area"](a)||Br["CJK Compatibility Forms"](a)||Br["Small Form Variants"](a)||Br["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(u))}function m1(u){return Br.Arabic(u)||Br["Arabic Supplement"](u)||Br["Arabic Extended-A"](u)||Br["Arabic Presentation Forms-A"](u)||Br["Arabic Presentation Forms-B"](u)}function PA(u){return u>=1424&&u<=2303||Br["Arabic Presentation Forms-A"](u)||Br["Arabic Presentation Forms-B"](u)}function pR(u,a){return!(!a&&PA(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||Br.Khmer(u))}function mR(u){for(const a of u)if(PA(a.charCodeAt(0)))return!0;return!1}const kl={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let g1=null,sl=kl.unavailable,lh=null;const OA=function(u){u&&typeof u=="string"&&u.indexOf("NetworkError")>-1&&(sl=kl.error),g1&&g1(u)};function y1(){v1.fire(new ql("pluginStateChange",{pluginStatus:sl,pluginURL:lh}))}const v1=new od,_1=function(){return sl},x1=function(){if(sl!==kl.deferred||!lh)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");sl=kl.loading,y1(),lh&&_p({url:lh},u=>{u?OA(u):(sl=kl.loaded,y1())})},Nl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>sl===kl.loaded||Nl.applyArabicShaping!=null,isLoading:()=>sl===kl.loading,setState(u){sl=u.pluginStatus,lh=u.pluginURL},isParsing:()=>sl===kl.parsing,isParsed:()=>sl===kl.parsed,getPluginURL:()=>lh};class Vi{constructor(a,c){this.zoom=a,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.transition=c.transition,this.pitch=c.pitch,this.brightness=c.brightness,this.worldview=c.worldview,this.activeFloors=c.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(a){return function(c,p){for(const g of c)if(!pR(g.charCodeAt(0),p))return!1;return!0}(a,Nl.isLoaded())}}class uy{constructor(a,c,p,g,x){this.property=a,this.value=c,this.expression=function(w,C,N,D,U){if(D_(w))return new B_(w,C);if(z_(w)||Array.isArray(w)&&w.length>0){const q=d1(w,C,N,D,U);if(q.result==="error")throw new Error(q.value.map(H=>`${H.key}: ${H.message}`).join(", "));return q.value}{let q=w;return typeof w=="string"&&C.type==="color"&&(q=hi.parse(w)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>q}}}(c===void 0?a.specification.default:c,a.specification,p,g,x)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(a,c,p,g){return this.property.possiblyEvaluate(this,a,c,p,g)}}class Bp{constructor(a,c,p,g){this.property=a,this.value=new uy(a,void 0,c,p,g)}transitioned(a,c){return new NA(this.property,this.value,c,Object.assign({},a.transition,this.transition),a.now)}untransitioned(){return new NA(this.property,this.value,null,{},0)}}class kA{constructor(a,c,p,g){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues),this._scope=c,this._options=p,this._iconImageUseTheme=g,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(a){return Ar(this._values[a].value.value)}setValue(a,c){this._values.hasOwnProperty(a)||(this._values[a]=new Bp(this._values[a].property,this._scope,this._options,this._iconImageUseTheme)),this._values[a].value=new uy(this._values[a].property,c===null?void 0:Ar(c),this._scope,this._options,this._iconImageUseTheme),this._values[a].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[a].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[a].value.isIndoorDependent())}setTransitionOrValue(a,c){c&&(this._options=c);const p=this._properties.properties;if(a)for(const g in a){const x=a[g];if(g.endsWith("-transition")){const w=g.slice(0,-11);p[w]&&this.setTransition(w,x)}else p.hasOwnProperty(g)&&this.setValue(g,x)}}getTransition(a){return Ar(this._values[a].transition)}setTransition(a,c){this._values.hasOwnProperty(a)||(this._values[a]=new Bp(this._values[a].property)),this._values[a].transition=Ar(c)||void 0}serialize(){const a={};for(const c of Object.keys(this._values)){const p=this.getValue(c);p!==void 0&&(a[c]=p);const g=this.getTransition(c);g!==void 0&&(a[`${c}-transition`]=g)}return a}transitioned(a,c){const p=new pd(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].transitioned(a,c._values[g]);return p}untransitioned(){const a=new pd(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].untransitioned();return a}isIndoorDependent(){return this._isIndoorDependent}}class NA{constructor(a,c,p,g,x){const w=g.delay||0,C=g.duration||0;x=x||0,this.property=a,this.value=c,this.begin=x+w,this.end=this.begin+C,a.specification.transition&&(g.delay||g.duration)&&(this.prior=p)}possiblyEvaluate(a,c,p){const g=a.now||0,x=this.value.possiblyEvaluate(a,c,p),w=this.prior;if(w){if(g>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(g<this.begin)return w.possiblyEvaluate(a,c,p);{const C=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(a,c,p),x,Og(C))}}return x}}class pd{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,c,p){const g=new _f(this._properties);for(const x of Object.keys(this._values))g._values[x]=this._values[x].possiblyEvaluate(a,c,p);return g}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class b1{constructor(a,c,p,g){this._properties=a,this._values=Object.create(a.defaultPropertyValues),this._scope=c,this._options=p,this._iconImageUseTheme=g,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(a){return Ar(this._values[a].value)}setValue(a,c){this._values[a]=new uy(this._values[a].property,c===null?void 0:Ar(c),this._scope,this._options,this._iconImageUseTheme),this._values[a].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[a].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[a].isIndoorDependent())}serialize(){const a={};for(const c of Object.keys(this._values)){const p=this.getValue(c);p!==void 0&&(a[c]=p)}return a}possiblyEvaluate(a,c,p,g){const x=new _f(this._properties);for(const w of Object.keys(this._values))x._values[w]=this._values[w].possiblyEvaluate(a,c,p,g);return x}isIndoorDependent(){return this._isIndoorDependent}}class Pc{constructor(a,c,p,g){this.property=a,this.value=c,this.parameters=p,this.iconImageUseTheme=g}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,c,p,g){return this.property.evaluate(this.value,this.parameters,a,c,p,g,this.iconImageUseTheme)}}class _f{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class Gt{constructor(a){this.specification=a}possiblyEvaluate(a,c){return a.expression.evaluate(c)}interpolate(a,c,p){const g=ld[this.specification.type];return g?g(a,c,p):a}}class ur{constructor(a,c){this.specification=a,this.overrides=c}possiblyEvaluate(a,c,p,g,x){return a.expression.kind==="constant"||a.expression.kind==="camera"?new Pc(this,{kind:"constant",value:a.expression.evaluate(c,null,{},p,g,void 0,x)},c):new Pc(this,a.expression,c,x)}interpolate(a,c,p){if(a.value.kind!=="constant"||c.value.kind!=="constant")return a;if(a.value.value===void 0||c.value.value===void 0)return new Pc(this,{kind:"constant",value:void 0},a.parameters);const g=ld[this.specification.type];return g?new Pc(this,{kind:"constant",value:g(a.value.value,c.value.value,p)},a.parameters):a}evaluate(a,c,p,g,x,w,C){return a.kind==="constant"?a.value:a.evaluate(c,p,g,x,w,void 0,C)}}class $p{constructor(a){this.specification=a}possiblyEvaluate(a,c,p,g){return!!a.expression.evaluate(c,null,{},p,g)}interpolate(){return!1}}class ws{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const c=new Vi(0,{});for(const p in a){const g=a[p];g.specification.overridable&&this.overridableProperties.push(p);const x=this.defaultPropertyValues[p]=new uy(g,void 0),w=this.defaultTransitionablePropertyValues[p]=new Bp(g);this.defaultTransitioningPropertyValues[p]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[p]=x.possiblyEvaluate(c)}}}_r(ur,"DataDrivenProperty"),_r(Gt,"DataConstantProperty"),_r($p,"ColorRampProperty");var ft=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function w1(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function Up(u){if(Array.isArray(u))return u.map(Up);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const a={};for(const c in u)a[c]=Up(u[c]);return a}return w1(u)}function Vp(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const a of u.slice(1))if(!Vp(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}function H_(u,a="",c=null,p="fill"){if(u==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Vp(u)||(u=Wl(u));const g=u;let x=!0;try{x=function(U){if(!Hp(U))return U;let q=Up(U);return qp(q),q=G_(q),q}(g)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(g,null,2)}
        `)}let w=null,C=null;if(p!=="background"&&p!=="sky"&&p!=="slot"){C=ft[`filter_${p}`];const U=ku(x,C,a,c);if(U.result==="error")throw new Error(U.value.map(q=>`${q.key}: ${q.message}`).join(", "));w=(q,H,Y)=>U.value.evaluate(q,H,{},Y)}let N=null,D=null;if(x!==g){const U=ku(g,C,a,c);if(U.result==="error")throw new Error(U.value.map(q=>`${q.key}: ${q.message}`).join(", "));N=(q,H,Y,J,oe)=>U.value.evaluate(q,H,{},Y,void 0,void 0,J,oe),D=!kp(U.value.expression)}return{filter:w,dynamicFilter:N||void 0,needGeometry:RA(x),needFeature:!!D}}function G_(u){if(!Array.isArray(u))return u;const a=function(c){if(gR.has(c[0])){for(let p=1;p<c.length;p++)if(Hp(c[p]))return!0}return c}(u);return a===!0?a:a.map(c=>G_(c))}function qp(u){let a=!1;const c=[];if(u[0]==="case"){for(let p=1;p<u.length-1;p+=2)a=a||Hp(u[p]),c.push(u[p+1]);c.push(u[u.length-1])}else if(u[0]==="match"){a=a||Hp(u[1]);for(let p=2;p<u.length-1;p+=2)c.push(u[p+1]);c.push(u[u.length-1])}else if(u[0]==="step"){a=a||Hp(u[1]);for(let p=1;p<u.length-1;p+=2)c.push(u[p+1])}a&&(u.length=0,u.push("any",...c));for(let p=1;p<u.length;p++)qp(u[p])}function Hp(u){if(!Array.isArray(u))return!1;if((a=u[0])==="pitch"||a==="distance-from-center")return!0;var a;for(let c=1;c<u.length;c++)if(Hp(u[c]))return!0;return!1}const gR=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function IA(u,a){return u<a?-1:u>a?1:0}function RA(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let a=1;a<u.length;a++)if(RA(u[a]))return!0;return!1}function Wl(u){if(!u)return!0;const a=u[0];return u.length<=1?a!=="any":a==="=="?S1(u[1],u[2],"=="):a==="!="?W_(S1(u[1],u[2],"==")):a==="<"||a===">"||a==="<="||a===">="?S1(u[1],u[2],a):a==="any"?(c=u.slice(1),["any"].concat(c.map(Wl))):a==="all"?["all"].concat(u.slice(1).map(Wl)):a==="none"?["all"].concat(u.slice(1).map(Wl).map(W_)):a==="in"?E1(u[1],u.slice(2)):a==="!in"?W_(E1(u[1],u.slice(2))):a==="has"?MA(u[1]):a!=="!has"||W_(MA(u[1]));var c}function S1(u,a,c){switch(u){case"$type":return[`filter-type-${c}`,a];case"$id":return[`filter-id-${c}`,a];default:return[`filter-${c}`,u,a]}}function E1(u,a){if(a.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(c=>typeof c!=typeof a[0])?["filter-in-large",u,["literal",a.sort(IA)]]:["filter-in-small",u,["literal",a]]}}function MA(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function W_(u){return["!",u]}const dy="";function xf(u,a){return a?`${u}${dy}${a}`:u}let DA;const LA=()=>DA||(DA=new ws({"icon-size":new ur(ft.layout_symbol["icon-size"]),"icon-image":new ur(ft.layout_symbol["icon-image"]),"icon-rotate":new ur(ft.layout_symbol["icon-rotate"]),"icon-offset":new ur(ft.layout_symbol["icon-offset"])}));class yR{constructor(a,c,p,g,x,w){this.cachedIconPrimary=null;const C=ku(a,ft.appearance.condition);if(C.result==="success"&&(this.condition=C.value),this.name=c,p){this.properties=new _f(LA()),this.unevaluatedLayout=new b1(LA(),g,x,w);for(const N in p)this.unevaluatedLayout.setValue(N,p[N])}}hasCachedIconPrimary(){return this.cachedIconPrimary!==null}setCachedIconPrimary(a){this.cachedIconPrimary=a}getCachedIconPrimary(){return this.cachedIconPrimary}isActive(a){return!(this.condition||!a.isHidden||this.name!=="hidden")||this.condition.evaluate(a.globals,a.feature,a.featureState,a.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(a){return this.properties.get(a)}getUnevaluatedProperties(){return this.unevaluatedLayout}recalculate(a,c,p){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(a,void 0,c,p))}serialize(){const a={};return a.condition=this.condition.expression.serialize(),this.name&&(a.name=this.name),this.unevaluatedLayout&&(a.properties=this.unevaluatedLayout.serialize()),a}}const FA="-transition",vR=new Set(["fill","line","background","hillshade","raster"]);class $o extends od{constructor(a,c,p,g,x,w){if(super(),this.id=a.id,this.fqid=xf(this.id,p),this.type=a.type,this.scope=p,this.lut=g,this.options=x,this.iconImageUseTheme=w,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},a.type!=="custom"){if(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type&&a.type!=="background"&&a.type!=="sky"&&a.type!=="slot"){this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter;const C=ku(this.filter,ft[`filter_${a.type}`]);C.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...C.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||C.value.isIndoorDependent)}if(a.slot&&(this.slot=a.slot),a.appearances&&this.setAppearances(a.appearances),c.layout&&(this._unevaluatedLayout=new b1(c.layout,this.scope,x,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),c.paint){this._transitionablePaint=new kA(c.paint,this.scope,x);for(const C in a.paint)this.setPaintProperty(C,a.paint[C]);for(const C in a.layout)this.setLayoutProperty(C,a.layout[C]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new _f(c.paint)}}}onAdd(a){}onRemove(a){}isDraped(a){return!this.is3D(!0)&&vR.has(this.type)}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}setLayoutProperty(a,c){if(this.type==="custom"&&a==="visibility")return void(this.visibility=c);const p=this._unevaluatedLayout;p._properties.properties[a]&&(p.setValue(a,c),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...p.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||p.isIndoorDependent(),a==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(a){this.appearances=[],a.forEach(c=>{this.appearances.push(new yR(c.condition,c.name,c.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(a){return a.endsWith(FA)?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)}isPaintProperty(a){return!!this._transitionablePaint._properties.properties[a]}setPaintProperty(a,c){const p=this._transitionablePaint,g=p._properties.properties;if(a.endsWith(FA)){const q=a.slice(0,-11);return g[q]&&p.setTransition(q,c||void 0),!1}if(!g[a])return!1;const x=p._values[a],w=x.value.isDataDriven(),C=x.value;p.setValue(a,c),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...p.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||p.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(a);const N=p._values[a].value,D=N.isDataDriven(),U=a.endsWith("pattern")||a==="line-dasharray";return D||w||U||this._handleOverridablePaintPropertyUpdate(a,C,N)}_handleSpecialPaintPropertyUpdate(a){}getProgramIds(){return null}getDefaultProgramParams(a,c,p){return null}_handleOverridablePaintPropertyUpdate(a,c,p){return!1}isHidden(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||this.visibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(a,c){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,c,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,c)}serialize(){const a={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(a.appearances=this.appearances.map(c=>c.serialize())),Ut(a,(c,p)=>!(c===void 0||p==="layout"&&!Object.keys(c).length||p==="paint"&&!Object.keys(c).length))}is3D(a){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const a in this.paint._values){const c=this.paint.get(a);if(c instanceof Pc&&R_(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}for(const a of this.appearances)if(!ty(a.condition.expression))return!0;return!1}compileFilter(a){this._filterCompiled||(this._featureFilter=H_(this.filter,this.scope,a),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(a){this._stats&&(a.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(a,c,p){return{}}queryRadius(a){}queryIntersectsFeature(a,c,p,g,x,w,C,N,D){}}const _R={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class hy{constructor(a,c){this._structArray=a,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Qi{constructor(){this.capacity=-1,this.resize(0)}static serialize(a,c){return a._trim(),c&&c.add(a.arrayBuffer),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const c=Object.create(this.prototype);return c.arrayBuffer=a.arrayBuffer,c.length=a.length,c.capacity=a.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...a){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...a){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Cn(u,a=1){let c=0,p=0;return{members:u.map(g=>{const x=_R[g.type].BYTES_PER_ELEMENT,w=c=T1(c,Math.max(a,x)),C=g.components||1;return p=Math.max(p,x),c+=x*C,{name:g.name,type:g.type,components:C,offset:w}}),size:T1(c,Math.max(p,a)),alignment:a}}function T1(u,a){return Math.ceil(u/a)*a}class yl extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c){const p=this.length;return this.resize(p+1),this.emplace(p,a,c)}emplace(a,c,p){const g=2*a;return this.int16[g+0]=c,this.int16[g+1]=p,a}}yl.prototype.bytesPerElement=4,_r(yl,"StructArrayLayout2i4");class bf extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,a,c,p)}emplace(a,c,p,g){const x=3*a;return this.int16[x+0]=c,this.int16[x+1]=p,this.int16[x+2]=g,a}}bf.prototype.bytesPerElement=6,_r(bf,"StructArrayLayout3i6");class Gp extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,a,c,p,g)}emplace(a,c,p,g,x){const w=4*a;return this.int16[w+0]=c,this.int16[w+1]=p,this.int16[w+2]=g,this.int16[w+3]=x,a}}Gp.prototype.bytesPerElement=8,_r(Gp,"StructArrayLayout4i8");class md extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.float32[1*a+0]=c,a}}md.prototype.bytesPerElement=4,_r(md,"StructArrayLayout1f4");class A1 extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,a,c,p)}emplace(a,c,p,g){const x=4*a,w=2*a;return this.int16[x+0]=c,this.int16[x+1]=p,this.float32[w+1]=g,a}}A1.prototype.bytesPerElement=8,_r(A1,"StructArrayLayout2i1f8");class C1 extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,a,c,p)}emplace(a,c,p,g){const x=4*a;return this.int16[x+0]=c,this.int16[x+1]=p,this.int16[x+2]=g,a}}C1.prototype.bytesPerElement=8,_r(C1,"StructArrayLayout3i8");class K_ extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x){const w=this.length;return this.resize(w+1),this.emplace(w,a,c,p,g,x)}emplace(a,c,p,g,x,w){const C=5*a;return this.int16[C+0]=c,this.int16[C+1]=p,this.int16[C+2]=g,this.int16[C+3]=x,this.int16[C+4]=w,a}}K_.prototype.bytesPerElement=10,_r(K_,"StructArrayLayout5i10");class Z_ extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,w,C){const N=this.length;return this.resize(N+1),this.emplace(N,a,c,p,g,x,w,C)}emplace(a,c,p,g,x,w,C,N){const D=6*a,U=12*a,q=3*a;return this.int16[D+0]=c,this.int16[D+1]=p,this.uint8[U+4]=g,this.uint8[U+5]=x,this.uint8[U+6]=w,this.uint8[U+7]=C,this.float32[q+2]=N,a}}Z_.prototype.bytesPerElement=12,_r(Z_,"StructArrayLayout2i4ub1f12");class Kl extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,a,c,p)}emplace(a,c,p,g){const x=3*a;return this.float32[x+0]=c,this.float32[x+1]=p,this.float32[x+2]=g,a}}Kl.prototype.bytesPerElement=12,_r(Kl,"StructArrayLayout3f12");class ch extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x){const w=this.length;return this.resize(w+1),this.emplace(w,a,c,p,g,x)}emplace(a,c,p,g,x,w){const C=6*a,N=3*a;return this.uint16[C+0]=c,this.uint16[C+1]=p,this.uint16[C+2]=g,this.uint16[C+3]=x,this.float32[N+2]=w,a}}ch.prototype.bytesPerElement=12,_r(ch,"StructArrayLayout4ui1f12");class wf extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,a,c,p,g)}emplace(a,c,p,g,x){const w=4*a;return this.uint16[w+0]=c,this.uint16[w+1]=p,this.uint16[w+2]=g,this.uint16[w+3]=x,a}}wf.prototype.bytesPerElement=8,_r(wf,"StructArrayLayout4ui8");class X_ extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,w){const C=this.length;return this.resize(C+1),this.emplace(C,a,c,p,g,x,w)}emplace(a,c,p,g,x,w,C){const N=6*a;return this.int16[N+0]=c,this.int16[N+1]=p,this.int16[N+2]=g,this.int16[N+3]=x,this.int16[N+4]=w,this.int16[N+5]=C,a}}X_.prototype.bytesPerElement=12,_r(X_,"StructArrayLayout6i12");class Y_ extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,w,C,N,D,U,q,H){const Y=this.length;return this.resize(Y+1),this.emplace(Y,a,c,p,g,x,w,C,N,D,U,q,H)}emplace(a,c,p,g,x,w,C,N,D,U,q,H,Y){const J=12*a;return this.int16[J+0]=c,this.int16[J+1]=p,this.int16[J+2]=g,this.int16[J+3]=x,this.uint16[J+4]=w,this.uint16[J+5]=C,this.uint16[J+6]=N,this.uint16[J+7]=D,this.int16[J+8]=U,this.int16[J+9]=q,this.int16[J+10]=H,this.int16[J+11]=Y,a}}Y_.prototype.bytesPerElement=24,_r(Y_,"StructArrayLayout4i4ui4i24");class Wp extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,w){const C=this.length;return this.resize(C+1),this.emplace(C,a,c,p,g,x,w)}emplace(a,c,p,g,x,w,C){const N=10*a,D=5*a;return this.int16[N+0]=c,this.int16[N+1]=p,this.int16[N+2]=g,this.float32[D+2]=x,this.float32[D+3]=w,this.float32[D+4]=C,a}}Wp.prototype.bytesPerElement=20,_r(Wp,"StructArrayLayout3i3f20");class uh extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,a,c,p,g)}emplace(a,c,p,g,x){const w=4*a;return this.float32[w+0]=c,this.float32[w+1]=p,this.float32[w+2]=g,this.float32[w+3]=x,a}}uh.prototype.bytesPerElement=16,_r(uh,"StructArrayLayout4f16");class j1 extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.uint32[1*a+0]=c,a}}j1.prototype.bytesPerElement=4,_r(j1,"StructArrayLayout1ul4");class Oc extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c){const p=this.length;return this.resize(p+1),this.emplace(p,a,c)}emplace(a,c,p){const g=2*a;return this.uint16[g+0]=c,this.uint16[g+1]=p,a}}Oc.prototype.bytesPerElement=4,_r(Oc,"StructArrayLayout2ui4");class P1 extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,w,C,N,D,U,q,H,Y){const J=this.length;return this.resize(J+1),this.emplace(J,a,c,p,g,x,w,C,N,D,U,q,H,Y)}emplace(a,c,p,g,x,w,C,N,D,U,q,H,Y,J){const oe=20*a,ce=10*a;return this.int16[oe+0]=c,this.int16[oe+1]=p,this.int16[oe+2]=g,this.int16[oe+3]=x,this.int16[oe+4]=w,this.float32[ce+3]=C,this.float32[ce+4]=N,this.float32[ce+5]=D,this.float32[ce+6]=U,this.int16[oe+14]=q,this.uint32[ce+8]=H,this.uint16[oe+18]=Y,this.uint16[oe+19]=J,a}}P1.prototype.bytesPerElement=40,_r(P1,"StructArrayLayout5i4f1i1ul2ui40");class J_ extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,w,C){const N=this.length;return this.resize(N+1),this.emplace(N,a,c,p,g,x,w,C)}emplace(a,c,p,g,x,w,C,N){const D=8*a;return this.int16[D+0]=c,this.int16[D+1]=p,this.int16[D+2]=g,this.int16[D+4]=x,this.int16[D+5]=w,this.int16[D+6]=C,this.int16[D+7]=N,a}}J_.prototype.bytesPerElement=16,_r(J_,"StructArrayLayout3i2i2i16");class Kp extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x){const w=this.length;return this.resize(w+1),this.emplace(w,a,c,p,g,x)}emplace(a,c,p,g,x,w){const C=4*a,N=8*a;return this.float32[C+0]=c,this.float32[C+1]=p,this.float32[C+2]=g,this.int16[N+6]=x,this.int16[N+7]=w,a}}Kp.prototype.bytesPerElement=16,_r(Kp,"StructArrayLayout2f1f2i16");class Zp extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,w){const C=this.length;return this.resize(C+1),this.emplace(C,a,c,p,g,x,w)}emplace(a,c,p,g,x,w,C){const N=20*a,D=5*a;return this.uint8[N+0]=c,this.uint8[N+1]=p,this.float32[D+1]=g,this.float32[D+2]=x,this.float32[D+3]=w,this.float32[D+4]=C,a}}Zp.prototype.bytesPerElement=20,_r(Zp,"StructArrayLayout2ub4f20");class is extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,a,c,p)}emplace(a,c,p,g){const x=3*a;return this.uint16[x+0]=c,this.uint16[x+1]=p,this.uint16[x+2]=g,a}}is.prototype.bytesPerElement=6,_r(is,"StructArrayLayout3ui6");class Xp extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,w,C,N,D,U,q,H,Y,J,oe,ce,he,Se,Te,ke,qe){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,a,c,p,g,x,w,C,N,D,U,q,H,Y,J,oe,ce,he,Se,Te,ke,qe)}emplace(a,c,p,g,x,w,C,N,D,U,q,H,Y,J,oe,ce,he,Se,Te,ke,qe,Fe){const Xe=30*a,et=15*a,it=60*a;return this.int16[Xe+0]=c,this.int16[Xe+1]=p,this.int16[Xe+2]=g,this.float32[et+2]=x,this.float32[et+3]=w,this.uint16[Xe+8]=C,this.uint16[Xe+9]=N,this.uint32[et+5]=D,this.uint32[et+6]=U,this.uint32[et+7]=q,this.uint16[Xe+16]=H,this.uint16[Xe+17]=Y,this.uint16[Xe+18]=J,this.float32[et+10]=oe,this.float32[et+11]=ce,this.uint8[it+48]=he,this.uint8[it+49]=Se,this.uint8[it+50]=Te,this.uint32[et+13]=ke,this.int16[Xe+28]=qe,this.uint8[it+58]=Fe,a}}Xp.prototype.bytesPerElement=60,_r(Xp,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class O1 extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,w,C,N,D,U,q,H,Y,J,oe,ce,he,Se,Te,ke,qe,Fe,Xe,et,it,At,pt,jt,Rt,zt,Yt,qt,Dt){const Vt=this.length;return this.resize(Vt+1),this.emplace(Vt,a,c,p,g,x,w,C,N,D,U,q,H,Y,J,oe,ce,he,Se,Te,ke,qe,Fe,Xe,et,it,At,pt,jt,Rt,zt,Yt,qt,Dt)}emplace(a,c,p,g,x,w,C,N,D,U,q,H,Y,J,oe,ce,he,Se,Te,ke,qe,Fe,Xe,et,it,At,pt,jt,Rt,zt,Yt,qt,Dt,Vt){const St=20*a,xt=40*a,$t=80*a;return this.float32[St+0]=c,this.float32[St+1]=p,this.int16[xt+4]=g,this.int16[xt+5]=x,this.int16[xt+6]=w,this.int16[xt+7]=C,this.int16[xt+8]=N,this.int16[xt+9]=D,this.int16[xt+10]=U,this.int16[xt+11]=q,this.int16[xt+12]=H,this.uint16[xt+13]=Y,this.uint16[xt+14]=J,this.uint16[xt+15]=oe,this.uint16[xt+16]=ce,this.uint16[xt+17]=he,this.uint16[xt+18]=Se,this.uint16[xt+19]=Te,this.uint16[xt+20]=ke,this.uint16[xt+21]=qe,this.uint16[xt+22]=Fe,this.uint16[xt+23]=Xe,this.uint16[xt+24]=et,this.uint16[xt+25]=it,this.uint16[xt+26]=At,this.uint16[xt+27]=pt,this.uint32[St+14]=jt,this.float32[St+15]=Rt,this.float32[St+16]=zt,this.float32[St+17]=Yt,this.float32[St+18]=qt,this.uint8[$t+76]=Dt,this.uint16[xt+39]=Vt,a}}O1.prototype.bytesPerElement=80,_r(O1,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class k1 extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,w){const C=this.length;return this.resize(C+1),this.emplace(C,a,c,p,g,x,w)}emplace(a,c,p,g,x,w,C){const N=6*a;return this.float32[N+0]=c,this.float32[N+1]=p,this.float32[N+2]=g,this.float32[N+3]=x,this.float32[N+4]=w,this.float32[N+5]=C,a}}k1.prototype.bytesPerElement=24,_r(k1,"StructArrayLayout6f24");class Sf extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x){const w=this.length;return this.resize(w+1),this.emplace(w,a,c,p,g,x)}emplace(a,c,p,g,x,w){const C=5*a;return this.float32[C+0]=c,this.float32[C+1]=p,this.float32[C+2]=g,this.float32[C+3]=x,this.float32[C+4]=w,a}}Sf.prototype.bytesPerElement=20,_r(Sf,"StructArrayLayout5f20");class N1 extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,w,C){const N=this.length;return this.resize(N+1),this.emplace(N,a,c,p,g,x,w,C)}emplace(a,c,p,g,x,w,C,N){const D=7*a;return this.float32[D+0]=c,this.float32[D+1]=p,this.float32[D+2]=g,this.float32[D+3]=x,this.float32[D+4]=w,this.float32[D+5]=C,this.float32[D+6]=N,a}}N1.prototype.bytesPerElement=28,_r(N1,"StructArrayLayout7f28");class fy extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,w,C,N,D,U,q){const H=this.length;return this.resize(H+1),this.emplace(H,a,c,p,g,x,w,C,N,D,U,q)}emplace(a,c,p,g,x,w,C,N,D,U,q,H){const Y=11*a;return this.float32[Y+0]=c,this.float32[Y+1]=p,this.float32[Y+2]=g,this.float32[Y+3]=x,this.float32[Y+4]=w,this.float32[Y+5]=C,this.float32[Y+6]=N,this.float32[Y+7]=D,this.float32[Y+8]=U,this.float32[Y+9]=q,this.float32[Y+10]=H,a}}fy.prototype.bytesPerElement=44,_r(fy,"StructArrayLayout11f44");class I1 extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,w,C,N,D){const U=this.length;return this.resize(U+1),this.emplace(U,a,c,p,g,x,w,C,N,D)}emplace(a,c,p,g,x,w,C,N,D,U){const q=9*a;return this.float32[q+0]=c,this.float32[q+1]=p,this.float32[q+2]=g,this.float32[q+3]=x,this.float32[q+4]=w,this.float32[q+5]=C,this.float32[q+6]=N,this.float32[q+7]=D,this.float32[q+8]=U,a}}I1.prototype.bytesPerElement=36,_r(I1,"StructArrayLayout9f36");class dh extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c){const p=this.length;return this.resize(p+1),this.emplace(p,a,c)}emplace(a,c,p){const g=2*a;return this.float32[g+0]=c,this.float32[g+1]=p,a}}dh.prototype.bytesPerElement=8,_r(dh,"StructArrayLayout2f8");class R1 extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,a,c,p,g)}emplace(a,c,p,g,x){const w=6*a;return this.uint32[3*a+0]=c,this.uint16[w+2]=p,this.uint16[w+3]=g,this.uint16[w+4]=x,a}}R1.prototype.bytesPerElement=12,_r(R1,"StructArrayLayout1ul3ui12");class Q_ extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.uint16[1*a+0]=c,a}}Q_.prototype.bytesPerElement=2,_r(Q_,"StructArrayLayout1ui2");class ex extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,w,C,N,D,U,q,H,Y,J,oe,ce){const he=this.length;return this.resize(he+1),this.emplace(he,a,c,p,g,x,w,C,N,D,U,q,H,Y,J,oe,ce)}emplace(a,c,p,g,x,w,C,N,D,U,q,H,Y,J,oe,ce,he){const Se=16*a;return this.float32[Se+0]=c,this.float32[Se+1]=p,this.float32[Se+2]=g,this.float32[Se+3]=x,this.float32[Se+4]=w,this.float32[Se+5]=C,this.float32[Se+6]=N,this.float32[Se+7]=D,this.float32[Se+8]=U,this.float32[Se+9]=q,this.float32[Se+10]=H,this.float32[Se+11]=Y,this.float32[Se+12]=J,this.float32[Se+13]=oe,this.float32[Se+14]=ce,this.float32[Se+15]=he,a}}ex.prototype.bytesPerElement=64,_r(ex,"StructArrayLayout16f64");class Yp extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,p,g,x,w,C){const N=this.length;return this.resize(N+1),this.emplace(N,a,c,p,g,x,w,C)}emplace(a,c,p,g,x,w,C,N){const D=10*a,U=5*a;return this.uint16[D+0]=c,this.uint16[D+1]=p,this.uint16[D+2]=g,this.uint16[D+3]=x,this.float32[U+2]=w,this.float32[U+3]=C,this.float32[U+4]=N,a}}Yp.prototype.bytesPerElement=20,_r(Yp,"StructArrayLayout4ui3f20");class M1 extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.int16[1*a+0]=c,a}}M1.prototype.bytesPerElement=2,_r(M1,"StructArrayLayout1i2");class tx extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.uint8[1*a+0]=c,a}}tx.prototype.bytesPerElement=1,_r(tx,"StructArrayLayout1ub1");class D1 extends hy{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}D1.prototype.size=40;class zA extends P1{get(a){return new D1(this,a)}}_r(zA,"CollisionBoxArray");class rx extends hy{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(a){this._structArray.uint8[this._pos1+49]=a}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(a){this._structArray.uint8[this._pos1+50]=a}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(a){this._structArray.uint32[this._pos4+13]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(a){this._structArray.uint8[this._pos1+58]=a}}rx.prototype.size=60;class py extends Xp{get(a){return new rx(this,a)}}_r(py,"PlacedSymbolArray");class L1 extends hy{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(a){this._structArray.uint32[this._pos4+14]=a}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(a){this._structArray.float32[this._pos4+18]=a}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}L1.prototype.size=80;class BA extends O1{get(a){return new L1(this,a)}}_r(BA,"SymbolInstanceArray");class F1 extends md{getoffsetX(a){return this.float32[1*a+0]}}_r(F1,"GlyphOffsetArray");class $A extends yl{getx(a){return this.int16[2*a+0]}gety(a){return this.int16[2*a+1]}}_r($A,"SymbolLineVertexArray");class nx extends hy{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}nx.prototype.size=12;class UA extends R1{get(a){return new nx(this,a)}}_r(UA,"FeatureIndexArray");class VA extends Oc{geta_centroid_pos0(a){return this.uint16[2*a+0]}geta_centroid_pos1(a){return this.uint16[2*a+1]}}_r(VA,"FillExtrusionCentroidArray");class qA extends hy{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}qA.prototype.size=6;class HA extends bf{get(a){return new qA(this,a)}}_r(HA,"FillExtrusionWallArray");const GA=Cn([{name:"a_pos",components:2,type:"Int16"}],4),xR=Cn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),bR=Cn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ds{constructor(a=[]){this.segments=a}_prepareSegment(a,c,p,g){let x=this.segments[this.segments.length-1];return a>ds.MAX_VERTEX_ARRAY_LENGTH&&zr(`Max vertices per segment is ${ds.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}`),(!x||x.vertexLength+a>ds.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==g)&&(x={vertexOffset:c,primitiveOffset:p,vertexLength:0,primitiveLength:0},g!==void 0&&(x.sortKey=g),this.segments.push(x)),x}prepareSegment(a,c,p,g){return this._prepareSegment(a,c.length,p.length,g)}get(){return this.segments}destroy(){for(const a of this.segments)for(const c in a.vaos)a.vaos[c].destroy()}static simpleSegment(a,c,p,g){return new ds([{vertexOffset:a,primitiveOffset:c,vertexLength:p,primitiveLength:g,vaos:{},sortKey:0}])}}function WA(u,a){return 256*(u=ve(Math.floor(u),0,255))+ve(Math.floor(a),0,255)}ds.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,_r(ds,"SegmentVector");const wR=Cn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),SR=Cn([{name:"a_pattern_b",components:4,type:"Uint16"}]),ER=Cn([{name:"a_dash",components:4,type:"Uint16"}]);class my{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(a,c,p,g){this.ids.push(gy(a)),this.positions.push(c,p,g)}eachPosition(a,c){const p=gy(a);let g=0,x=this.ids.length-1;for(;g<x;){const w=g+x>>1;this.ids[w]>=p?x=w:g=w+1}for(;this.ids[g]===p;)c(this.positions[3*g],this.positions[3*g+1],this.positions[3*g+2]),g++}static serialize(a,c){const p=new Float64Array(a.ids),g=new Uint32Array(a.positions);return z1(p,g,0,p.length-1),c&&(c.add(p.buffer),c.add(g.buffer)),{ids:p,positions:g}}static deserialize(a){const c=new my;let p;c.ids=a.ids,c.positions=a.positions;for(const g of c.ids)g!==p&&c.uniqueIds.push(g),p=g;return c.indexed=!0,c}}function gy(u){const a=+u;return Number.isSafeInteger(a)?a:Bg(String(u))}function z1(u,a,c,p){for(;c<p;){const g=u[c+p>>1];let x=c-1,w=p+1;for(;;){do x++;while(u[x]<g);do w--;while(u[w]>g);if(x>=w)break;ix(u,x,w),ix(a,3*x,3*w),ix(a,3*x+1,3*w+1),ix(a,3*x+2,3*w+2)}w-c<p-w?(z1(u,a,c,w),c=w+1):(z1(u,a,w+1,p),p=w)}}function ix(u,a,c){const p=u[a];u[a]=u[c],u[c]=p}_r(my,"FeaturePositionMap");class kc{constructor(a){this.gl=a.gl,this.initialized=!1}fetchUniformLocation(a,c){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(a,c),this.initialized=!0),!!this.location}set(a,c,p){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class sx extends kc{constructor(a){super(a),this.current=0}set(a,c,p){this.fetchUniformLocation(a,c)&&this.current!==p&&(this.current=p,this.gl.uniform1i(this.location,p))}}class Bs extends kc{constructor(a){super(a),this.current=0}set(a,c,p){this.fetchUniformLocation(a,c)&&this.current!==p&&(this.current=p,this.gl.uniform1f(this.location,p))}}class Nu extends kc{constructor(a){super(a),this.current=[0,0]}set(a,c,p){this.fetchUniformLocation(a,c)&&(p[0]===this.current[0]&&p[1]===this.current[1]||(this.current=p,this.gl.uniform2f(this.location,p[0],p[1])))}}class Jp extends kc{constructor(a){super(a),this.current=[0,0,0]}set(a,c,p){this.fetchUniformLocation(a,c)&&(p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]||(this.current=p,this.gl.uniform3f(this.location,p[0],p[1],p[2])))}}class yy extends kc{constructor(a){super(a),this.current=[0,0,0,0]}set(a,c,p){this.fetchUniformLocation(a,c)&&(p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]&&p[3]===this.current[3]||(this.current=p,this.gl.uniform4f(this.location,p[0],p[1],p[2],p[3])))}}class B1 extends kc{constructor(a){super(a),this.current=hi.transparent.toPremultipliedRenderColor(null)}set(a,c,p){this.fetchUniformLocation(a,c)&&(p.r===this.current.r&&p.g===this.current.g&&p.b===this.current.b&&p.a===this.current.a||(this.current=p,this.gl.uniform4f(this.location,p.r,p.g,p.b,p.a)))}}const KA=new Float32Array(16);class vy extends kc{constructor(a){super(a),this.current=KA}set(a,c,p){if(this.fetchUniformLocation(a,c)){if(p[12]!==this.current[12]||p[0]!==this.current[0])return this.current=p,void this.gl.uniformMatrix4fv(this.location,!1,p);for(let g=1;g<16;g++)if(p[g]!==this.current[g]){this.current=p,this.gl.uniformMatrix4fv(this.location,!1,p);break}}}}const TR=new Float32Array(9),ZA=new Float32Array(4);class $1 extends kc{constructor(a){super(a),this.current=ZA}set(a,c,p){if(this.fetchUniformLocation(a,c)){for(let g=0;g<4;g++)if(p[g]!==this.current[g]){this.current=p,this.gl.uniformMatrix2fv(this.location,!1,p);break}}}}function U1(u){return[WA(255*u.r,255*u.g),WA(255*u.b,255*u.a)]}function ax(u,a,c,p,g,x,w,C){return!!u&&(u.kind==="composite"||u.kind==="source"?u.evaluate(new Vi(0,{brightness:x,worldview:C}),a,c,g,p,w)==="none":u.value==="none")}class ox{constructor(a,c,p,g){this.value=a,this.uniformNames=c.map(x=>`u_${x}`),this.type=p,this.context=g}setUniform(a,c,p,g,x){const w=g.constantOr(this.value);c.set(a,x,w instanceof hi?w.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):w)}getBinding(a,c){return this.type==="color"?new B1(a):new Bs(a)}}class _y{constructor(a,c){this.uniformNames=c.map(p=>`u_${p}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(a,c){this.pixelRatio=a.pixelRatio||1,this.pattern=a.tl.concat(a.br),this.patternTransition=c?c.tl.concat(c.br):this.pattern}setUniform(a,c,p,g,x){let w=null;x!=="u_pattern"&&x!=="u_dash"||(w=this.pattern),x==="u_pattern_b"&&(w=this.patternTransition),x==="u_pixel_ratio"&&(w=this.pixelRatio),w&&c.set(a,x,w)}getBinding(a,c){return c==="u_pattern"||c==="u_pattern_b"||c==="u_dash"?new yy(a):new Bs(a)}}class gd{constructor(a,c,p,g){this.expression=a,this.type=p,this.maxValue=0,this.paintVertexAttributes=c.map(x=>({name:`a_${x}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(a,c,p,g,x,w,C,N){const D=this.paintVertexArray.length,U=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Vi(0,{brightness:w,worldview:N}),c,{},x,g,C):this.expression.kind==="constant"&&this.expression.value,q=ax(this.lutExpression,c,{},g,x,w,C,N);this.paintVertexArray.resize(a),this._setPaintValue(D,a,U,q?null:this.context.lut)}updatePaintArray(a,c,p,g,x,w,C,N){const D=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:C,worldview:N},p,g,void 0,x):this.expression.kind==="constant"&&this.expression.value,U=ax(this.lutExpression,p,g,x,void 0,C,void 0,N);this._setPaintValue(a,c,D,U?null:this.context.lut)}_setPaintValue(a,c,p,g){if(this.type==="color"){const x=U1(p.toPremultipliedRenderColor(g));for(let w=a;w<c;w++)this.paintVertexArray.emplace(w,x[0],x[1])}else{for(let x=a;x<c;x++)this.paintVertexArray.emplace(x,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ru{constructor(a,c,p,g,x,w){this.expression=a,this.uniformNames=c.map(C=>`u_${C}_t`),this.type=p,this.useIntegerZoom=g,this.context=x,this.maxValue=0,this.paintVertexAttributes=c.map(C=>({name:`a_${C}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(a,c,p,g,x,w,C,N){const D=this.expression.evaluate(new Vi(this.context.zoom,{brightness:w,worldview:N}),c,{},x,g,C),U=this.expression.evaluate(new Vi(this.context.zoom+1,{brightness:w,worldview:N}),c,{},x,g,C),q=ax(this.lutExpression,c,{},g,x,w,C,N),H=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(H,a,D,U,q?null:this.context.lut)}updatePaintArray(a,c,p,g,x,w,C,N){const D=this.expression.evaluate({zoom:this.context.zoom,brightness:C,worldview:N},p,g,void 0,x),U=this.expression.evaluate({zoom:this.context.zoom+1,brightness:C,worldview:N},p,g,void 0,x),q=ax(this.lutExpression,p,g,x,void 0,C,void 0,N);this._setPaintValue(a,c,D,U,q?null:this.context.lut)}_setPaintValue(a,c,p,g,x){if(this.type==="color"){const w=U1(p.toPremultipliedRenderColor(x)),C=U1(p.toPremultipliedRenderColor(x));for(let N=a;N<c;N++)this.paintVertexArray.emplace(N,w[0],w[1],C[0],C[1])}else{for(let w=a;w<c;w++)this.paintVertexArray.emplace(w,p,g);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(g))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,c,p,g,x){const w=this.useIntegerZoom?Math.floor(p.zoom):p.zoom,C=ve(this.expression.interpolationFactor(w,this.context.zoom,this.context.zoom+1),0,1);c.set(a,x,C)}getBinding(a,c){return new Bs(a)}}class bo{constructor(a,c,p,g,x){this.expression=a,this.layerId=x,this.paintVertexAttributes=(p==="array"?ER:wR).members;for(let w=0;w<c.length;++w);this.paintVertexArray=new g,this.paintTransitionVertexArray=new wf}populatePaintArray(a,c,p,g){const x=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValues(x,a,c.patterns&&c.patterns[this.layerId],p)}updatePaintArray(a,c,p,g,x,w,C){this._setPaintValues(a,c,p.patterns&&p.patterns[this.layerId],w)}_setPaintValues(a,c,p,g){if(!g||!p)return;const x=g[p[0]],w=g[p[1]];if(x){if(x){const{tl:C,br:N,pixelRatio:D}=x;for(let U=a;U<c;U++)this.paintVertexArray.emplace(U,C[0],C[1],N[0],N[1],D)}if(w){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:C,br:N}=w;for(let D=a;D<c;D++)this.paintTransitionVertexArray.emplace(D,C[0],C[1],N[0],N[1])}}}upload(a){const c=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,c)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=a.createVertexBuffer(this.paintTransitionVertexArray,SR.members,c))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class yd{constructor(a,c,p=()=>!0){this.binders={},this._buffers=[],this.context=c;const g=[];for(const x in a.paint._values){const w=a.paint.get(x);if(x.endsWith("-use-theme")||!p(x)||!(w instanceof Pc&&R_(w.property.specification)))continue;const C=CR(x,a.type),N=w.value,D=w.property.specification.type,U=!!w.property.useIntegerZoom,q=x==="line-dasharray"||x.endsWith("pattern"),H=a.paint.get(`${x}-use-theme`),Y=x==="line-dasharray"&&a.layout.get("line-cap").value.kind!=="constant"||H&&H.value.kind!=="constant";if(N.kind!=="constant"||Y)if(N.kind==="source"||Y||q){const J=V1(x,D,"source");this.binders[x]=q?new bo(N,C,D,J,a.id):new gd(N,C,D,J),g.push(`/a_${x}`)}else{const J=V1(x,D,"composite");this.binders[x]=new ru(N,C,D,U,c,J),g.push(`/z_${x}`)}else this.binders[x]=q?new _y(N.value,C):new ox(N.value,C,D,c),g.push(`/u_${x}`);H&&(this.binders[x].lutExpression=H.value)}this.cacheKey=g.sort().join("")}getMaxValue(a){const c=this.binders[a];return c instanceof gd||c instanceof ru?c.maxValue:0}populatePaintArrays(a,c,p,g,x,w,C,N){for(const D in this.binders){const U=this.binders[D];U.context=this.context,(U instanceof gd||U instanceof ru||U instanceof bo)&&U.populatePaintArray(a,c,p,g,x,w,C,N)}}setConstantPatternPositions(a,c){for(const p in this.binders){const g=this.binders[p];g instanceof _y&&g.setConstantPatternPositions(a,c)}}getPatternTransitionVertexBuffer(a){const c=this.binders[a];return c instanceof bo?c.paintTransitionVertexBuffer:null}updatePaintArrays(a,c,p,g,x,w,C,N,D,U){let q=!1;const H=Object.keys(a),Y=H.length!==0&&!N,J=Y?H:c.uniqueIds;this.context.lut=x.lut;for(const oe in this.binders){const ce=this.binders[oe];if(ce.context=this.context,(ce instanceof gd||ce instanceof ru||ce instanceof bo)&&ce.expression&&ce.expression.kind&&ce.expression.kind!=="constant"&&(ce.expression.isStateDependent===!0||ce.expression.isLightConstant===!1)){const he=x.paint.get(oe);ce.expression=he.value;for(const Se of J){const Te=a[Se.toString()];c.eachPosition(Se,(ke,qe,Fe)=>{const Xe=g.feature(ke);ce.updatePaintArray(qe,Fe,Xe,Te,w,C,D,U)})}if(!Y)for(const Se of p.uniqueIds){const Te=a[Se.toString()];p.eachPosition(Se,(ke,qe,Fe)=>{const Xe=g.feature(ke);ce.updatePaintArray(qe,Fe,Xe,Te,w,C,D,U)})}q=!0}}return q}defines(){const a=[];for(const c in this.binders){const p=this.binders[c];(p instanceof ox||p instanceof _y)&&a.push(...p.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a){const c=[];for(const p in this.binders){const g=this.binders[p];if(g instanceof ox||g instanceof _y||g instanceof ru)for(const x of g.uniformNames)c.push({name:x,property:p,binding:g.getBinding(a,x)})}return c}setUniforms(a,c,p,g,x){for(const{name:w,property:C,binding:N}of p)this.binders[C].setUniform(a,N,x,g.get(C),w)}updatePaintBuffers(){this._buffers=[];for(const a in this.binders){const c=this.binders[a];(c instanceof gd||c instanceof ru||c instanceof bo)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer),c instanceof bo&&c.paintTransitionVertexBuffer&&this._buffers.push(c.paintTransitionVertexBuffer)}}upload(a){for(const c in this.binders){const p=this.binders[c];(p instanceof gd||p instanceof ru||p instanceof bo)&&p.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const c=this.binders[a];(c instanceof gd||c instanceof ru||c instanceof bo)&&c.destroy()}}}class nu{constructor(a,c,p=()=>!0){this.programConfigurations={};for(const g of a)this.programConfigurations[g.id]=new yd(g,c,p);this.needsUpload=!1,this._featureMap=new my,this._featureMapWithoutIds=new my,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(a,c,p,g,x,w,C,N,D){for(const U in this.programConfigurations)this.programConfigurations[U].populatePaintArrays(a,c,g,x,w,C,N,D);c.id!==void 0?this._featureMap.add(c.id,p,this._bufferOffset,a):(this._featureMapWithoutIds.add(this._idlessCounter,p,this._bufferOffset,a),this._idlessCounter+=1),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,c,p,g,x,w,C,N){for(const D of p)this.needsUpload=this.programConfigurations[D.id].updatePaintArrays(a,this._featureMap,this._featureMapWithoutIds,c,D,g,x,w,C||0,N)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}const AR={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function CR(u,a){return AR[u]||[u.replace(`${a}-`,"").replace(/-/g,"_")]}const jR={"line-pattern":{source:ch,composite:ch},"fill-pattern":{source:ch,composite:ch},"fill-extrusion-pattern":{source:ch,composite:ch},"line-dasharray":{source:wf,composite:wf}},PR={color:{source:dh,composite:uh},number:{source:md,composite:dh}};function V1(u,a,c){const p=jR[u];return p&&p[c]||PR[a][c]}_r(ox,"ConstantBinder"),_r(_y,"PatternConstantBinder"),_r(gd,"SourceExpressionBinder"),_r(bo,"PatternCompositeBinder"),_r(ru,"CompositeExpressionBinder"),_r(yd,"ProgramConfiguration",{omit:["_buffers"]}),_r(nu,"ProgramConfigurationSet");const vl=tr/Math.PI/2,v=5,l=6,f=16383,_=64,E=[_,32,16],j=-vl,k=vl;function L(u,a,c,p=vl){return c=_n(c),[u*Math.sin(c)*p,-a*p,u*Math.cos(c)*p]}function B(u,a,c){return L(Math.cos(_n(u)),Math.sin(_n(u)),a,c)}const G=63710088e-1,Z=2*Math.PI*G;class Q{constructor(a,c){if(isNaN(a)||isNaN(c))throw new Error(`Invalid LngLat object: (${a}, ${c})`);if(this.lng=+a,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Q(Qe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const c=Math.PI/180,p=this.lat*c,g=a.lat*c,x=Math.sin(p)*Math.sin(g)+Math.cos(p)*Math.cos(g)*Math.cos((a.lng-this.lng)*c);return G*Math.acos(Math.min(x,1))}toBounds(a=0){const c=360*a/40075017,p=c/Math.cos(Math.PI/180*this.lat);return new X({lng:this.lng-p,lat:this.lat-c},{lng:this.lng+p,lat:this.lat+c})}toEcef(a){return B(this.lat,this.lng,vl+a*vl/G)}static convert(a){if(a instanceof Q)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Q(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Q(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class X{constructor(a,c){a&&(c?this.setSouthWest(a).setNorthEast(c):Array.isArray(a)&&a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))}setNorthEast(a){return this._ne=a instanceof Q?new Q(a.lng,a.lat):Q.convert(a),this}setSouthWest(a){return this._sw=a instanceof Q?new Q(a.lng,a.lat):Q.convert(a),this}extend(a){const c=this._sw,p=this._ne;let g,x;if(a instanceof Q)g=a,x=a;else{if(!(a instanceof X))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(X.convert(a)):this.extend(Q.convert(a)):typeof a=="object"&&a!==null&&a.hasOwnProperty("lat")&&(a.hasOwnProperty("lon")||a.hasOwnProperty("lng"))?this.extend(Q.convert(a)):this;if(g=a._sw,x=a._ne,!g||!x)return this}return c||p?(c.lng=Math.min(g.lng,c.lng),c.lat=Math.min(g.lat,c.lat),p.lng=Math.max(x.lng,p.lng),p.lat=Math.max(x.lat,p.lat)):(this._sw=new Q(g.lng,g.lat),this._ne=new Q(x.lng,x.lat)),this}getCenter(){return new Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Q(this.getWest(),this.getNorth())}getSouthEast(){return new Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(a){const{lng:c,lat:p}=Q.convert(a);let g=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&g}static convert(a){if(a)return a instanceof X?a:new X(a)}}const se=0,le=25.5;function de(u){return Z*Math.cos(u*Math.PI/180)}function xe(u){return(180+u)/360}function ye(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function Ee(u,a){return u/de(a)}function Ne(u){return 360*u-180}function je(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function Ve(u,a){return u*de(je(a))}const Ie=85.051129;function Ge(u){return Math.cos(_n(ve(u,-Ie,Ie)))}function $e(u,a){const c=ve(a,se,le),p=Math.pow(2,c);return Ge(u)*Z/(512*p)}function Le(u){return 1/Math.cos(u*Math.PI/180)}function Ke(u,a=0){const c=Math.exp(Math.PI*(1-(u.y+a/tr)/(1<<u.z)*2));return 80150034*c/(c*c+1)/tr/(1<<u.z)}class dt{constructor(a,c,p=0){this.x=+a,this.y=+c,this.z=+p}static fromLngLat(a,c=0){const p=Q.convert(a);return new dt(xe(p.lng),ye(p.lat),Ee(c,p.lat))}toLngLat(){return new Q(Ne(this.x),je(this.y))}toAltitude(){return Ve(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Z*Le(je(this.y))}}function at(u,a,c,p,g,x,w,C,N){const D=(a+p)/2,U=(c+g)/2,q=new st(D,U);C(q),function(H,Y,J,oe,ce,he){const Se=J-ce,Te=oe-he;return Math.abs((oe-Y)*Se-(J-H)*Te)/Math.hypot(Se,Te)}(q.x,q.y,x.x,x.y,w.x,w.y)>=N?(at(u,a,c,D,U,x,q,C,N),at(u,D,U,p,g,q,w,C,N)):u.push(w)}function Et(u,a,c){let p=u[0],g=p.x,x=p.y;a(p);const w=[p];for(let C=1;C<u.length;C++){const N=u[C],{x:D,y:U}=N;a(N),at(w,g,x,D,U,p,N,a,c),g=D,x=U,p=N}return w}function yt(u,a,c,p){if(p(a,c)){const g=a.add(c)._mult(.5);yt(u,a,g,p),yt(u,g,c,p)}else u.push(c)}function Nt(u,a){let c=u[0];const p=[c];for(let g=1;g<u.length;g++){const x=u[g];yt(p,c,x,a),c=x}return p}const Xt=Math.pow(2,14)-1,mt=-Xt-1;function tt(u,a){const c=Math.round(u.x*a),p=Math.round(u.y*a);return u.x=ve(c,mt,Xt),u.y=ve(p,mt,Xt),(c<u.x||c>u.x+1||p<u.y||p>u.y+1)&&zr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),u}function It(u,a,c){const p=u.loadGeometry(),g=u.extent,x=tr/g;if(a&&c&&c.projection.isReprojectedInTileSpace){const w=1<<a.z,{scale:C,x:N,y:D,projection:U}=c,q=H=>{const Y=Ne((a.x+H.x/g)/w),J=je((a.y+H.y/g)/w),oe=U.project(Y,J);H.x=(oe.x*C-N)*g,H.y=(oe.y*C-D)*g};for(let H=0;H<p.length;H++)if(u.type!==1)p[H]=Et(p[H],q,1);else{const Y=[];for(const J of p[H])J.x<0||J.x>=g||J.y<0||J.y>=g||(q(J),Y.push(J));p[H]=Y}}for(const w of p)for(const C of w)tt(C,x);return p}function vt(u,a){return{type:u.type,id:u.id,properties:u.properties,geometry:a?It(u):[]}}class Bt{constructor(a,c,p,g,x){this.properties={},this.extent=p,this.type=0,this.id=void 0,this._pbf=a,this._geometry=-1,this._keys=g,this._values=x,a.readFields(rr,this,c)}loadGeometry(){const a=this._pbf;a.pos=this._geometry;const c=a.readVarint()+a.pos,p=[];let g,x=1,w=0,C=0,N=0;for(;a.pos<c;){if(w<=0){const D=a.readVarint();x=7&D,w=D>>3}if(w--,x===1||x===2)C+=a.readSVarint(),N+=a.readSVarint(),x===1&&(g&&p.push(g),g=[]),g&&g.push(new st(C,N));else{if(x!==7)throw new Error(`unknown command ${x}`);g&&g.push(g[0].clone())}}return g&&p.push(g),p}bbox(){const a=this._pbf;a.pos=this._geometry;const c=a.readVarint()+a.pos;let p=1,g=0,x=0,w=0,C=1/0,N=-1/0,D=1/0,U=-1/0;for(;a.pos<c;){if(g<=0){const q=a.readVarint();p=7&q,g=q>>3}if(g--,p===1||p===2)x+=a.readSVarint(),w+=a.readSVarint(),x<C&&(C=x),x>N&&(N=x),w<D&&(D=w),w>U&&(U=w);else if(p!==7)throw new Error(`unknown command ${p}`)}return[C,D,N,U]}toGeoJSON(a,c,p){const g=this.extent*Math.pow(2,p),x=this.extent*a,w=this.extent*c,C=this.loadGeometry();function N(H){return[360*(H.x+x)/g-180,360/Math.PI*Math.atan(Math.exp((1-2*(H.y+w)/g)*Math.PI))-90]}function D(H){return H.map(N)}let U;if(this.type===1){const H=[];for(const J of C)H.push(J[0]);const Y=D(H);U=H.length===1?{type:"Point",coordinates:Y[0]}:{type:"MultiPoint",coordinates:Y}}else if(this.type===2){const H=C.map(D);U=H.length===1?{type:"LineString",coordinates:H[0]}:{type:"MultiLineString",coordinates:H}}else{if(this.type!==3)throw new Error("unknown feature type");{const H=function(J){const oe=J.length;if(oe<=1)return[J];const ce=[];let he,Se;for(let Te=0;Te<oe;Te++){const ke=xr(J[Te]);ke!==0&&(Se===void 0&&(Se=ke<0),Se===ke<0?(he&&ce.push(he),he=[J[Te]]):he&&he.push(J[Te]))}return he&&ce.push(he),ce}(C),Y=[];for(const J of H)Y.push(J.map(D));U=Y.length===1?{type:"Polygon",coordinates:Y[0]}:{type:"MultiPolygon",coordinates:Y}}}const q={type:"Feature",geometry:U,properties:this.properties};return this.id!=null&&(q.id=this.id),q}}function rr(u,a,c){u===1?a.id=c.readVarint():u===2?function(p,g){const x=p.readVarint()+p.pos;for(;p.pos<x;){const w=g._keys[p.readVarint()],C=g._values[p.readVarint()];g.properties[w]=C}}(c,a):u===3?a.type=c.readVarint():u===4&&(a._geometry=c.pos)}function xr(u){let a=0;for(let c,p,g=0,x=u.length,w=x-1;g<x;w=g++)c=u[g],p=u[w],a+=(p.x-c.x)*(c.y+p.y);return a}Bt.types=["Unknown","Point","LineString","Polygon"];class Wt{constructor(a,c){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(Jt,this,c),this.length=this._features.length}feature(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];const c=this._pbf.readVarint()+this._pbf.pos;return new Bt(this._pbf,c,this.extent,this._keys,this._values)}}function Jt(u,a,c){u===15?a.version=c.readVarint():u===1?a.name=c.readString():u===5?a.extent=c.readVarint():u===2?a._features.push(c.pos):u===3?a._keys.push(c.readString()):u===4&&a._values.push(function(p){let g=null;const x=p.readVarint()+p.pos;for(;p.pos<x;){const w=p.readVarint()>>3;g=w===1?p.readString():w===2?p.readFloat():w===3?p.readDouble():w===4?p.readVarint64():w===5?p.readVarint():w===6?p.readSVarint():w===7?p.readBoolean():null}if(g==null)throw new Error("unknown feature value");return g}(c))}class wr{constructor(a,c){this.layers=a.readFields(pr,{},c)}}function pr(u,a,c){if(u===3){const p=new Wt(c,c.readVarint()+c.pos);p.length&&(a[p.name]=p)}}const dr="3d_elevation_id",mr="level";class $r{constructor(){this._valid=!1}reset(a){return this.feature=a,this._valid=!0,this._geometry=a.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(a,c){return this._valid&&a(c(this._geometry)),this}require(a,c,p){return this.get(a,!0,c,p)}optional(a,c,p){return this.get(a,!1,c,p)}success(){return this._valid}get(a,c,p,g){const x=this.feature.properties.hasOwnProperty(a)?+this.feature.properties[a]:void 0;return this._valid&&x!==void 0&&!Number.isNaN(x)?p(g?g(x):x):c&&(this._valid=!1),this}}class jn{constructor(a,c){this.featureFunc=a,this.vertexFunc=c}parseFeature(a,c,p){return this.featureFunc(a,c,p)}parseVertex(a,c,p){return this.vertexFunc(a,c,p)}}const Fn=new jn((u,a,c)=>u.reset(a).require(dr,p=>{c.id=p}).optional("fixed_height_relative",p=>{c.constantHeight=p},Yr.decodeRelativeHeight).geometry(p=>{c.bounds=p},Yg).success(),(u,a,c)=>u.reset(a).require(dr,p=>{c.id=p}).require("elevation_idx",p=>{c.idx=p}).require("extent",p=>{c.extent=p}).require("height_relative",p=>{c.height=p},Yr.decodeRelativeHeight).geometry(p=>{c.position=p},Yr.getPoint).success()),Ei=new jn((u,a,c)=>u.reset(a).require(dr,p=>{c.id=p}).optional("fixed_height",p=>{c.constantHeight=p},Yr.decodeMetricHeight).geometry(p=>{c.bounds=p},Yg).success(),(u,a,c)=>u.reset(a).require(dr,p=>{c.id=p}).require("elevation_idx",p=>{c.idx=p}).require("extent",p=>{c.extent=p}).require("height",p=>{c.height=p},Yr.decodeMetricHeight).geometry(p=>{c.position=p},Yr.getPoint).success());class Yr{static getPoint(a){return Ua(a[0][0].x,a[0][0].y)}static decodeRelativeHeight(a){return 1e-4*a*5}static decodeMetricHeight(a){return 1e-4*a}static getVersionSchema(a){return a?a==="1.0.1"?Ei:void 0:Fn}static parse(a){const c=[],p=[],g=a.length,x=new $r;for(let w=0;w<g;w++){const C=a.feature(w),N=C.properties.version,D=Yr.getVersionSchema(N);if(D===void 0){zr(`Unknown elevation feature version number ${N||"(unknown)"}`);continue}const U=C.properties.type;if(!U)continue;const q=Bt.types[C.type];if(q==="Point"&&U==="curve_point"){const H={};D.parseVertex(x,C,H)&&c.push(H)}else if(q==="Polygon"&&U==="curve_meta"){const H={};D.parseFeature(x,C,H)&&p.push(H)}}return{vertices:c,features:p}}}class Dn{constructor(a,c){this.pos=a,this.dir=c}intersectsPlane(a,c,p){const g=rl(c,this.dir);if(Math.abs(g)<1e-6)return!1;const x=((a[0]-this.pos[0])*c[0]+(a[1]-this.pos[1])*c[1])/g;return p[0]=this.pos[0]+this.dir[0]*x,p[1]=this.pos[1]+this.dir[1]*x,!0}}class hn{constructor(a,c){this.pos=a,this.dir=c}intersectsPlane(a,c,p){const g=We(c,this.dir);if(Math.abs(g)<1e-6)return!1;const x=((a[0]-this.pos[0])*c[0]+(a[1]-this.pos[1])*c[1]+(a[2]-this.pos[2])*c[2])/g;return p[0]=this.pos[0]+this.dir[0]*x,p[1]=this.pos[1]+this.dir[1]*x,p[2]=this.pos[2]+this.dir[2]*x,!0}closestPointOnSphere(a,c,p){if(function(Y,J){var oe=Y[0],ce=Y[1],he=Y[2],Se=J[0],Te=J[1],ke=J[2];return Math.abs(oe-Se)<=m*Math.max(1,Math.abs(oe),Math.abs(Se))&&Math.abs(ce-Te)<=m*Math.max(1,Math.abs(ce),Math.abs(Te))&&Math.abs(he-ke)<=m*Math.max(1,Math.abs(he),Math.abs(ke))}(this.pos,a)||c===0)return p[0]=p[1]=p[2]=0,!1;const[g,x,w]=this.dir,C=this.pos[0]-a[0],N=this.pos[1]-a[1],D=this.pos[2]-a[2],U=g*g+x*x+w*w,q=2*(C*g+N*x+D*w),H=q*q-4*U*(C*C+N*N+D*D-c*c);if(H<0){const Y=Math.max(-q/2,0),J=C+g*Y,oe=N+x*Y,ce=D+w*Y,he=Math.hypot(J,oe,ce);return p[0]=J*c/he,p[1]=oe*c/he,p[2]=ce*c/he,!1}{const Y=(-q-Math.sqrt(H))/(2*U);if(Y<0){const J=Math.hypot(C,N,D);return p[0]=C*c/J,p[1]=N*c/J,p[2]=D*c/J,!1}return p[0]=C+g*Y,p[1]=N+x*Y,p[2]=D+w*Y,!0}}}class yi{constructor(a,c,p,g,x){this.TL=a,this.TR=c,this.BR=p,this.BL=g,this.horizon=x}static fromInvProjectionMatrix(a,c,p){const g=[-1,1,1],x=[1,1,1],w=[1,-1,1],C=[-1,-1,1],N=Ht(g,g,a),D=Ht(x,x,a),U=Ht(w,w,a),q=Ht(C,C,a);return new yi(N,D,U,q,c/p)}}function zn(u,a,c){let p=1/0,g=-1/0;const x=[];for(const w of u){Pt(x,w,a);const C=We(x,c);p=Math.min(p,C),g=Math.max(g,C)}return[p,g]}function Li(u,a){let c=!0;for(let p=0;p<u.planes.length;p++){const g=u.planes[p];let x=0;for(let w=0;w<a.length;w++)x+=+(We(g,a[w])+g[3]>=0);if(x===0)return 0;x!==a.length&&(c=!1)}return c?2:1}function Yn(u,a){for(const c of u.projections){const p=zn(a,u.points[0],c.axis);if(c.projection[1]<p[0]||c.projection[0]>p[1])return 0}return 1}function pn(u,a){let c=0;const p=[0,0,0,0];for(let w=0;w<u.length;w++)p[0]=u[w][0],p[1]=u[w][1],p[2]=u[w][2],p[3]=1,(g=p)[0]*(x=a)[0]+g[1]*x[1]+g[2]*x[2]+g[3]*x[3]>=0&&c++;var g,x;return c}class ai{constructor(a,c){this.points=a||new Array(8).fill([0,0,0]),this.planes=c||new Array(6).fill([0,0,0,0]),this.bounds=xn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Pt([],this.points[2],this.points[3]),Pt([],this.points[0],this.points[3]),Pt([],this.points[4],this.points[0]),Pt([],this.points[5],this.points[1]),Pt([],this.points[6],this.points[2]),Pt([],this.points[7],this.points[3])];for(const p of this.frustumEdges){const g=[0,-p[2],p[1]],x=[p[2],0,-p[0]];this.projections.push({axis:g,projection:zn(this.points,this.points[0],g)}),this.projections.push({axis:x,projection:zn(this.points,this.points[0],x)})}}static fromInvProjectionMatrix(a,c,p,g){const x=Math.pow(2,p),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const U=Qt([],D,a),q=1/U[3]/c*x;return(H=U)[0]=(Y=U)[0]*(J=[q,q,g?1/U[3]:q,q])[0],H[1]=Y[1]*J[1],H[2]=Y[2]*J[2],H[3]=Y[3]*J[3],H;var H,Y,J}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const U=Me([],gt([],Pt([],w[D[0]],w[D[1]]),Pt([],w[D[2]],w[D[1]]))),q=-We(U,w[D[1]]);return U.concat(q)}),N=[];for(let D=0;D<w.length;D++)N.push([w[D][0],w[D][1],w[D][2]]);return new ai(N,C)}intersectsPrecise(a,c,p){for(let g=0;g<c.length;g++)if(!pn(a,c[g]))return 0;for(let g=0;g<this.planes.length;g++)if(!pn(a,this.planes[g]))return 0;for(const g of p)for(const x of this.frustumEdges){const w=gt([],g,x),C=be(w);if(C===0)continue;Oe(w,w,1/C);const N=zn(this.points,this.points[0],w),D=zn(a,this.points[0],w);if(N[0]>D[1]||D[0]>N[1])return 0}return 1}containsPoint(a){for(const c of this.planes){const p=c[3];if(We([c[0],c[1],c[2]],a)+p<0)return!1}return!0}}class xn{static fromPoints(a){const c=[1/0,1/0,1/0],p=[-1/0,-1/0,-1/0];for(const g of a)ge(c,c,g),pe(p,p,g);return new xn(c,p)}static fromTileIdAndHeight(a,c,p){const g=1<<a.canonical.z,x=a.canonical.x,w=a.canonical.y;return new xn([x/g,w/g,c],[(x+1)/g,(w+1)/g,p])}static applyTransform(a,c){const p=a.getCorners();for(let g=0;g<p.length;++g)Ht(p[g],p[g],c);return xn.fromPoints(p)}static applyTransformFast(a,c){const p=[c[12],c[13],c[14]],g=[...p];for(let x=0;x<3;x++)for(let w=0;w<3;w++){const C=c[4*w+x],N=C*a.min[w],D=C*a.max[w];p[x]+=Math.min(N,D),g[x]+=Math.max(N,D)}return new xn(p,g)}static projectAabbCorners(a,c){const p=a.getCorners();for(let g=0;g<p.length;++g)Ht(p[g],p[g],c);return p}constructor(a,c){this.min=a,this.max=c,this.center=Oe([],_e([],this.min,this.max),.5)}quadrant(a){const c=[a%2==0,a<2],p=ue(this.min),g=ue(this.max);for(let x=0;x<c.length;x++)p[x]=c[x]?this.min[x]:this.center[x],g[x]=c[x]?this.center[x]:this.max[x];return g[2]=this.max[2],new xn(p,g)}distanceX(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]}distanceY(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]}distanceZ(a){return Math.max(Math.min(this.max[2],a[2]),this.min[2])-a[2]}getCorners(){const a=this.min,c=this.max;return[[a[0],a[1],a[2]],[c[0],a[1],a[2]],[c[0],c[1],a[2]],[a[0],c[1],a[2]],[a[0],a[1],c[2]],[c[0],a[1],c[2]],[c[0],c[1],c[2]],[a[0],c[1],c[2]]]}intersects(a){return this.intersectsAabb(a.bounds)?Li(a,this.getCorners()):0}intersectsFlat(a){return this.intersectsAabb(a.bounds)?Li(a,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(a,c){return c||this.intersects(a)?Yn(a,this.getCorners()):0}intersectsPreciseFlat(a,c){return c||this.intersectsFlat(a)?Yn(a,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(a){for(let c=0;c<3;++c)if(this.min[c]>a.max[c]||a.min[c]>this.max[c])return!1;return!0}intersectsAabbXY(a){return!(this.min[0]>a.max[0]||a.min[0]>this.max[0]||this.min[1]>a.max[1]||a.min[1]>this.max[1])}encapsulate(a){for(let c=0;c<3;c++)this.min[c]=Math.min(this.min[c],a.min[c]),this.max[c]=Math.max(this.max[c],a.max[c])}encapsulatePoint(a){for(let c=0;c<3;c++)this.min[c]=Math.min(this.min[c],a[c]),this.max[c]=Math.max(this.max[c],a[c])}closestPoint(a){return[Math.max(Math.min(this.max[0],a[0]),this.min[0]),Math.max(Math.min(this.max[1],a[1]),this.min[1]),Math.max(Math.min(this.max[2],a[2]),this.min[2])]}}_r(xn,"Aabb");class Wi{constructor(a,c){this.feature=a,this.metersToTile=c,this.index=0}get(){const a=this.feature.vertices[this.index],c=this.feature.vertexProps[this.index].dir,p=c[1],g=-c[0],x=(a.extent+1)*this.metersToTile;return[new st(Math.trunc(a.position[0]+p*x),Math.trunc(a.position[1]+g*x)),new st(Math.trunc(a.position[0]-p*x),Math.trunc(a.position[1]-g*x))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class di{constructor(a,c,p,g,x,w){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[mi(),mi(),mi(),mi(),mi(),mi(),mi()],this.id=a,this.heightRange={min:p,max:p},this.safeArea=c,this.constantHeight=p,this.constantHeight==null&&(this.constantHeight!=null||g.length!==0)){this.vertices=g,this.edges=x,this.edges=this.edges.filter(C=>{return C.a<this.vertices.length&&C.b<this.vertices.length&&!((N=this.vertices[C.a].position)[0]===(D=this.vertices[C.b].position)[0]&&N[1]===D[1]);var N,D}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const C of this.vertices)this.vertexProps.push({dir:Ua(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,C.height),this.heightRange.max=Math.max(this.heightRange.max,C.height);for(const C of this.edges){const N=this.vertices[C.a].position,D=this.vertices[C.b].position,U=qa(mi(),D,N),q=Fi(U),H=Ha(mi(),U,1/q);this.edgeProps.push({vec:U,dir:H,len:q});const Y=this.vertexProps[C.a].dir,J=this.vertexProps[C.b].dir;Lo(Y,Y,H),Lo(J,J,H)}for(const C of this.vertexProps)C.dir[0]===0&&C.dir[1]===0||Ks(C.dir,C.dir);this.tessellate(w)}}pointElevation(a){if(this.constantHeight!=null)return this.constantHeight;const c=this.getClosestEdge(a);if(c==null)return 0;const[p,g]=c;return Kr(this.vertices[this.edges[p].a].height,this.vertices[this.edges[p].b].height,g)}computeSlopeNormal(a,c){const p=this.getClosestEdge(a);if(!p)return we(0,0,1);const g=p[0],x=this.edges[g],w=this.edgeProps[g].vec,C=we(w[0],w[1],(this.vertices[x.b].height-this.vertices[x.a].height)*c),N=we(C[1],-C[0],0);gt(N,N,C);const D=be(N);return D>0?Oe(N,N,1/D):Ce(N,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(a){if(this.edges.length===0)return;let c=0,p=Number.POSITIVE_INFINITY,g=0;const[x,w,C,N,D,U,q]=this._tmpVec2;Va(q,a.x,a.y);const H=new Dn(q,null);for(let Y=0;Y<this.edges.length;Y++){const J=this.edges[Y],oe=this.edgeProps[Y].dir;H.dir=oe;const ce=this.vertices[J.a].position,he=this.vertices[J.b].position,Se=H.intersectsPlane(ce,this.vertexProps[J.a].dir,x),Te=H.intersectsPlane(he,this.vertexProps[J.b].dir,w);if(!Se||!Te)continue;qa(C,w,x),qa(N,q,x);const ke=rl(C,C),qe=ke>0?rl(N,C)/ke:0,Fe=ve(qe,0,1),Xe=Math.abs((qe-Fe)*this.edgeProps[Y].len);qa(D,q,ce),Va(U,oe[1],-oe[0]);const et=Xe+Math.abs(rl(D,U));et<p&&(c=Y,p=et,g=Fe)}return[c,g]}tessellate(a){const c=ae(),p=ae(),g=ae(),x=ae();for(let w=this.edges.length-1;w>=0;--w){const C=this.edges[w].a,N=this.edges[w].b,{position:D,height:U,extent:q}=this.vertices[C],{position:H,height:Y,extent:J}=this.vertices[N],oe=this.vertexProps[C].dir,ce=this.vertexProps[N].dir;if(Ce(c,D[0]/a,D[1]/a,U),Ce(p,H[0]/a,H[1]/a,Y),Ce(g,oe[1],-oe[0],0),Oe(g,g,q),Ce(x,ce[1],-ce[0],0),Oe(x,x,J),this.distSqLines(we(c[0]+.5*g[0],c[1]+.5*g[1],c[2]+.5*g[2]),we(p[0]-.5*x[0],p[1]-.5*x[1],p[2]-.5*x[2]),we(c[0]-.5*g[0],c[1]-.5*g[1],c[2]-.5*g[2]),we(p[0]+.5*x[0],p[1]+.5*x[1],p[2]+.5*x[2]))<=.0025000000000000005)continue;const he=this.vertices.length,Se=Lo(mi(),D,H);this.vertices.push({position:Ha(Se,Se,.5),height:.5*(U+Y),extent:.5*(q+J)});const Te=Lo(mi(),oe,ce);this.vertexProps.push({dir:Ks(Te,Te)}),this.edges.splice(w,1),this.edgeProps.splice(w,1),this.edges.push({a:C,b:he}),this.edges.push({a:he,b:N});const ke=qa(mi(),this.vertices[he].position,D),qe=Fi(ke),Fe={vec:ke,dir:Ha(mi(),ke,1/qe),len:qe};this.edgeProps.push(Fe),this.edgeProps.push(Fe)}}distSqLines(a,c,p,g){const x=me(ae(),c,a),w=me(ae(),g,p),C=me(ae(),a,p),N=We(x,x),D=We(x,w),U=We(x,C),q=We(w,w),H=We(w,C),Y=N*q-D*D;if(Y===0)return Pe(rt(x,p,g,We(C,w)/We(w,w)),a);const J=(N*H-D*U)/Y;return Pe(rt(x,a,c,(D*H-U*q)/Y),rt(w,p,g,J))}}class Qr{static parseFrom(a,c){const p=Yr.parse(a);if(!p)return[];let{vertices:g,features:x}=p;const w=1/Ke(c);x.sort((U,q)=>U.id-q.id),g.sort((U,q)=>U.id-q.id||U.idx-q.idx),g=g.filter((U,q,H)=>q===H.findIndex(Y=>Y.id===U.id&&Y.idx===U.idx));const C=new Array;let N=0;const D=g.length;for(const U of x){if(U.constantHeight){C.push(new di(U.id,U.bounds,U.constantHeight));continue}for(;N!==D&&g[N].id<U.id;)N++;if(N===D||g[N].id!==U.id)continue;const q=new Array,H=new Array,Y=N;for(;N!==D&&g[N].id===U.id;){const J=g[N];if(q.push({position:J.position,height:J.height,extent:J.extent}),N!==Y&&g[N-1].idx===J.idx-1){const oe=N-Y;H.push({a:oe-1,b:oe})}N++}C.push(new di(U.id,U.bounds,void 0,q,H,w))}return C}static getElevationFeature(a,c){if(!c)return;const p=+a.properties[dr];return Number.isNaN(p)?void 0:c.find(g=>g.id===p)}}class Vn{constructor(a,c){this.zScale=1,this.xOffset=0,this.yOffset=0,a.equals(c)||(this.zScale=Math.pow(2,c.z-a.z),this.xOffset=(a.x*this.zScale-c.x)*tr,this.yOffset=(a.y*this.zScale-c.y)*tr)}constantElevation(a,c){if(a.constantHeight!=null)return this.computeBiasedHeight(a.constantHeight,c)}pointElevation(a,c,p){const g=this.constantElevation(c,p);return g??(a.x=a.x*this.zScale+this.xOffset,a.y=a.y*this.zScale+this.yOffset,this.computeBiasedHeight(c.pointElevation(a),p))}computeBiasedHeight(a,c){return c<=0?a:a+c*De(0,c,a>=0?a:Math.abs(.5*a))}}_r(di,"ElevationFeature");class ls{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.projection=a.projection,this.layoutVertexArray=new yl,this.indexArray=new is,this.segments=new ds,this.programConfigurations=new nu(a.layers,{zoom:a.zoom,lut:a.lut}),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new md),this.worldview=a.worldview,this.hasAppearances=null}updateFootprints(a,c){}updateAppearances(a,c,p,g){}populate(a,c,p,g){const x=this.layers[0],w=[];let C=null;x.type==="circle"&&(C=x.layout.get("circle-sort-key"));for(const{feature:D,id:U,index:q,sourceLayerIndex:H}of a){const Y=this.layers[0]._featureFilter.needGeometry,J=vt(D,Y);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),J,p))continue;const oe=C?C.evaluate(J,{},p):void 0,ce={id:U,properties:D.properties,type:D.type,sourceLayerIndex:H,index:q,geometry:Y?J.geometry:It(D,p,g),patterns:{},sortKey:oe};w.push(ce)}C&&w.sort((D,U)=>D.sortKey-U.sortKey);let N=null;g.projection.name==="globe"&&(this.globeExtVertexArray=new X_,N=g.projection);for(const D of w){const{geometry:U,index:q,sourceLayerIndex:H}=D,Y=a[q].feature;this.addFeature(D,U,q,c.availableImages,p,N,c.brightness,c.elevationFeatures),c.featureIndex.insert(Y,U,q,H,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(a,c,p,g,x,w,C){this.programConfigurations.updatePaintArrays(a,c,x,p,g,w,C,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,GA.members),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=a.createVertexBuffer(this.globeExtVertexArray,bR.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=a.createVertexBuffer(this.elevatedLayoutVertexArray,xR.members))),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(a,c,p,g,x,w,C,N){let D;this.elevationMode!=="none"&&(D=Qr.getElevationFeature(a,N));for(const U of c)for(const q of U){const H=q.x,Y=q.y;if(H<0||H>=tr||Y<0||Y>=tr)continue;if(w){const ce=w.projectTilePoint(H,Y,x),he=w.upVector(x,H,Y);this.addGlobeExtVertex(ce,he),this.addGlobeExtVertex(ce,he),this.addGlobeExtVertex(ce,he),this.addGlobeExtVertex(ce,he)}const J=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),oe=J.vertexLength;if(this.addCircleVertex(H,Y,-1,-1),this.addCircleVertex(H,Y,1,-1),this.addCircleVertex(H,Y,1,1),this.addCircleVertex(H,Y,-1,1),this.elevationMode!=="none"){const ce=D?D.pointElevation(new st(H,Y)):0;this.hasElevation=this.hasElevation||ce!==0;for(let he=0;he<4;he++)this.elevatedLayoutVertexArray.emplaceBack(ce)}this.indexArray.emplaceBack(oe,oe+1,oe+2),this.indexArray.emplaceBack(oe,oe+2,oe+3),J.vertexLength+=4,J.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,{},g,x,C,void 0,this.worldview)}addCircleVertex(a,c,p,g){this.layoutVertexArray.emplaceBack(2*a+(p+1)/2,2*c+(g+1)/2)}addGlobeExtVertex(a,c){this.globeExtVertexArray.emplaceBack(a.x,a.y,a.z,c[0]*16384,c[1]*16384,c[2]*16384)}}function Ns(u,a){for(let c=0;c<u.length;c++)if(Ra(a,u[c]))return!0;for(let c=0;c<a.length;c++)if(Ra(u,a[c]))return!0;return!!al(u,a)}function hs(u,a,c){return!!Ra(u,a)||!!oo(a,u,c)}function Ss(u,a){if(u.length===1)return Nc(a,u[0]);for(let c=0;c<a.length;c++){const p=a[c];for(let g=0;g<p.length;g++)if(Ra(u,p[g]))return!0}for(let c=0;c<u.length;c++)if(Nc(a,u[c]))return!0;for(let c=0;c<a.length;c++)if(al(u,a[c]))return!0;return!1}function _l(u,a,c){if(u.length>1){if(al(u,a))return!0;for(let p=0;p<a.length;p++)if(oo(a[p],u,c))return!0}for(let p=0;p<u.length;p++)if(oo(u[p],a,c))return!0;return!1}function al(u,a){if(u.length===0||a.length===0)return!1;for(let c=0;c<u.length-1;c++){const p=u[c],g=u[c+1];for(let x=0;x<a.length-1;x++)if(ao(p,g,a[x],a[x+1]))return!0}return!1}function ao(u,a,c,p){return wn(u,c,p)!==wn(a,c,p)&&wn(u,a,c)!==wn(u,a,p)}function wo(u,a,c){return(u.x-c.x)*(a.y-c.y)-(u.y-c.y)*(a.x-c.x)}function Zl(u,a,c,p){const g=wo(u,a,p),x=wo(u,a,c);if(Math.sign(g)===Math.sign(x))return;const w=wo(c,p,u),C=w+x-g;return Math.sign(w)!==Math.sign(C)?[w/(w-C),x/(x-g)]:void 0}function oo(u,a,c){const p=c*c;if(a.length===1)return u.distSqr(a[0])<p;for(let g=1;g<a.length;g++)if(Xl(u,a[g-1],a[g])<p)return!0;return!1}function Xl(u,a,c){const p=a.distSqr(c);if(p===0)return u.distSqr(a);const g=((u.x-a.x)*(c.x-a.x)+(u.y-a.y)*(c.y-a.y))/p;return u.distSqr(g<0?a:g>1?c:c.sub(a)._mult(g)._add(a))}function Nc(u,a){let c,p,g,x=!1;for(let w=0;w<u.length;w++){c=u[w];for(let C=0,N=c.length-1;C<c.length;N=C++)p=c[C],g=c[N],p.y>a.y!=g.y>a.y&&a.x<(g.x-p.x)*(a.y-p.y)/(g.y-p.y)+p.x&&(x=!x)}return x}function Ra(u,a){let c=!1;for(let p=0,g=u.length-1;p<u.length;g=p++){const x=u[p],w=u[g];x.y>a.y!=w.y>a.y&&a.x<(w.x-x.x)*(a.y-x.y)/(w.y-x.y)+x.x&&(c=!c)}return c}function ys(u,a,c,p,g){for(const w of u)if(a<=w.x&&c<=w.y&&p>=w.x&&g>=w.y)return!0;const x=[new st(a,c),new st(a,g),new st(p,g),new st(p,c)];if(u.length>2){for(const w of x)if(Ra(u,w))return!0}for(let w=0;w<u.length-1;w++)if(Is(u[w],u[w+1],x))return!0;return!1}function Is(u,a,c){const p=c[0],g=c[2];if(u.x<p.x&&a.x<p.x||u.x>g.x&&a.x>g.x||u.y<p.y&&a.y<p.y||u.y>g.y&&a.y>g.y)return!1;const x=wn(u,a,c[0]);return x!==wn(u,a,c[1])||x!==wn(u,a,c[2])||x!==wn(u,a,c[3])}function Ni(u,a,c,p,g,x){let w=a.y-u.y,C=u.x-a.x;if(x=x||0){const N=w*w+C*C;if(N===0)return!0;const D=Math.sqrt(N);w/=D,C/=D}return!((c.x-u.x)*w+(c.y-u.y)*C-x<0||(p.x-u.x)*w+(p.y-u.y)*C-x<0||(g.x-u.x)*w+(g.y-u.y)*C-x<0)}function Ds(u,a,c,p,g,x,w){return!(Ni(u,a,p,g,x,w)||Ni(a,c,p,g,x,w)||Ni(c,u,p,g,x,w)||Ni(p,g,u,a,c,w)||Ni(g,x,u,a,c,w)||Ni(x,p,u,a,c,w))}function Ma(u,a,c){const p=a.paint.get(u).value;return p.kind==="constant"?p.value:c.programConfigurations.get(a.id).getMaxValue(u)}function vs(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function Yl(u,a,c,p,g){if(!a[0]&&!a[1])return u;const x=st.convert(a)._mult(g);c==="viewport"&&x._rotate(-p);const w=[];for(let C=0;C<u.length;C++)w.push(u[C].sub(x));return w}function Qp(u,a,c,p){const g=st.convert(u)._mult(p);return a==="viewport"&&g._rotate(-c),g}let vd,em;function tm(u,a,c){var p=2*Math.PI*6378137/256/Math.pow(2,c);return[u*p-2*Math.PI*6378137/2,a*p-2*Math.PI*6378137/2]}_r(ls,"CircleBucket",{omit:["layers"]});class Jl{constructor(a,c,p){this.z=a,this.x=c,this.y=p,this.key=Ql(0,a,a,c,p)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}isChildOf(a){const c=this.z-a.z;return a.z===0||a.z<this.z&&a.x===this.x>>c&&a.y===this.y>>c}url(a,c){const p=function(x,w,C){var N=tm(256*x,256*(w=Math.pow(2,C)-w-1),C),D=tm(256*(x+1),256*(w+1),C);return N[0]+","+N[1]+","+D[0]+","+D[1]}(this.x,this.y,this.z),g=function(x,w,C){let N,D="";for(let U=x;U>0;U--)N=1<<U-1,D+=(w&N?1:0)+(C&N?2:0);return D}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",g).replace("{bbox-epsg-3857}",p)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Iu{constructor(a,c){this.wrap=a,this.canonical=c,this.key=Ql(a,c.z,c.z,c.x,c.y)}}class Sa{constructor(a,c,p,g,x){this.overscaledZ=a,this.wrap=c,this.canonical=new Jl(p,+g,+x),this.key=c===0&&a===p?this.canonical.key:Ql(c,a,p,g,x)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){const c=this.canonical.z-a;return a>this.canonical.z?new Sa(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Sa(a,this.wrap,a,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(a,c=!0){if(this.overscaledZ===a&&c)return this.key;if(a>this.canonical.z)return Ql(this.wrap*+c,a,this.canonical.z,this.canonical.x,this.canonical.y);{const p=this.canonical.z-a;return Ql(this.wrap*+c,a,a,this.canonical.x>>p,this.canonical.y>>p)}}isChildOf(a){if(a.wrap!==this.wrap)return!1;const c=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.z<this.canonical.z&&a.canonical.x===this.canonical.x>>c&&a.canonical.y===this.canonical.y>>c}children(a){if(this.overscaledZ>=a)return[new Sa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,p=2*this.canonical.x,g=2*this.canonical.y;return[new Sa(c,this.wrap,c,p,g),new Sa(c,this.wrap,c,p+1,g),new Sa(c,this.wrap,c,p,g+1),new Sa(c,this.wrap,c,p+1,g+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new Sa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new Sa(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Iu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ql(u,a,c,p,g){const x=1<<Math.min(c,22);let w=x*(g%x)+p%x;return u&&c<22&&(w+=x*x*((u<0?-2*u-1:2*u)%(1<<2*(22-c)))),16*(32*w+c)+(a-c)}const Ef=[u=>{let a=u.canonical.x-1,c=u.wrap;return a<0&&(a=(1<<u.canonical.z)-1,c--),new Sa(u.overscaledZ,c,u.canonical.z,a,u.canonical.y)},u=>{let a=u.canonical.x+1,c=u.wrap;return a===1<<u.canonical.z&&(a=0,c++),new Sa(u.overscaledZ,c,u.canonical.z,a,u.canonical.y)},u=>new Sa(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,(u.canonical.y===0?1<<u.canonical.z:u.canonical.y)-1),u=>new Sa(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y===(1<<u.canonical.z)-1?0:u.canonical.y+1)];_r(Jl,"CanonicalTileID"),_r(Sa,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const XA=Cn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:lx}=XA,lhe=Cn([{name:"a_pos_3",components:3,type:"Int16"}]);var bU=Cn([{name:"a_pos",type:"Int16",components:2}]);function YA(u){return u*vl/G}const che=[new xn([j,j,j],[k,k,k]),new xn([j,j,j],[0,0,k]),new xn([0,j,j],[k,0,k]),new xn([j,0,j],[0,k,k]),new xn([0,0,j],[k,k,k])];function wU(u,a,c,p=!0){const g=Oe([],u._camera.position,u.worldSize),x=[a,c,1,1];Qt(x,x,u.pixelMatrixInverse),ut(x,x,1/x[3]);const w=Me([],Pt([],x,g)),C=u.globeMatrix,N=[C[12],C[13],C[14]],D=Pt([],N,g),U=be(D),q=Me([],D),H=u.worldSize/(2*Math.PI),Y=We(q,w),J=Math.asin(H/U);if(J<Math.acos(Y)){if(!p)return null;const At=[],pt=[];Oe(At,w,U/Y),Me(pt,Pt(pt,At,D)),Me(w,_e(w,D,Oe(w,pt,Math.tan(J)*U)))}const oe=[];new hn(g,w).closestPointOnSphere(N,H,oe);const ce=Me([],ks(C,0)),he=Me([],ks(C,1)),Se=Me([],ks(C,2)),Te=We(ce,oe),ke=We(he,oe),qe=We(Se,oe),Fe=Fo(Math.asin(-ke/H));let Xe=Fo(Math.atan2(Te,qe));Xe=u.center.lng+function(At,pt){const jt=(pt-At+180)%360-180;return jt<-180?jt+360:jt}(u.center.lng,Xe);const et=xe(Xe),it=ve(ye(Fe),0,1);return new dt(et,it)}class uhe{constructor(a,c,p){this.a=Pt([],a,p),this.b=Pt([],c,p),this.center=p;const g=Me([],this.a),x=Me([],this.b);this.angle=Math.acos(We(g,x))}}function OR(u,a){if(u.angle===0)return null;let c;return c=u.a[a]===0?1/u.angle*.5*Math.PI:1/u.angle*Math.atan(u.b[a]/u.a[a]/Math.sin(u.angle)-1/Math.tan(u.angle)),c<0||c>1?null:function(p,g,x,w){const C=Math.sin(x);return p*(Math.sin((1-w)*x)/C)+g*(Math.sin(w*x)/C)}(u.a[a],u.b[a],u.angle,ve(c,0,1))+u.center[a]}function hh(u){if(u.z<=1)return che[u.z+2*u.y+u.x];const a=kR(JA(u));return xn.fromPoints(a)}function Tf(u,a,c){return Oe(u,u,1-c),Je(u,u,a,c)}function SU(u,a,c){for(const p of u)Ht(p,p,a),Oe(p,p,c)}function EU(u,a,c,p){const g=a/u.worldSize,x=u.globeMatrix;if(c.z<=1){const it=hh(c).getCorners();return SU(it,x,g),xn.fromPoints(it)}const w=JA(c,p),C=kR(w,vl+YA(u._tileCoverLift));SU(C,x,g);const N=Number.MAX_VALUE,D=[-N,-N,-N],U=[N,N,N];if(w.contains(u.center)){for(const pt of C)ge(U,U,pt),pe(D,D,pt);D[2]=0;const it=u.point,At=[it.x*g,it.y*g,0];return ge(U,U,At),pe(D,D,At),new xn(U,D)}if(u._tileCoverLift>0){for(const it of C)ge(U,U,it),pe(D,D,it);return new xn(U,D)}const q=[x[12]*g,x[13]*g,x[14]*g],H=w.getCenter(),Y=ve(u.center.lat,-Ie,Ie),J=ve(H.lat,-Ie,Ie),oe=xe(u.center.lng),ce=ye(Y);let he=oe-xe(H.lng);const Se=ce-ye(J);he>.5?he-=1:he<-.5&&(he+=1);let Te=0;Math.abs(he)>Math.abs(Se)?Te=he>=0?1:3:(Te=Se>=0?0:2,Je(q,q,[x[4]*g,x[5]*g,x[6]*g],-Math.sin(_n(Se>=0?w.getSouth():w.getNorth()))*vl));const ke=C[Te],qe=C[(Te+1)%4],Fe=new uhe(ke,qe,q),Xe=[OR(Fe,0)||ke[0],OR(Fe,1)||ke[1],OR(Fe,2)||ke[2]],et=rm(u.zoom);if(et>0){const it=function({x:pt,y:jt,z:Rt},zt,Yt,qt,Dt){const Vt=1/(1<<Rt);let St=pt*Vt,xt=St+Vt,$t=jt*Vt,Kt=$t+Vt,Ft=0;const gr=(St+xt)/2-qt;return gr>.5?Ft=-1:gr<-.5&&(Ft=1),St=((St+Ft)*zt-(qt*=zt))*Yt+qt,xt=((xt+Ft)*zt-qt)*Yt+qt,$t=($t*zt-(Dt*=zt))*Yt+Dt,Kt=(Kt*zt-Dt)*Yt+Dt,[[St,Kt,0],[xt,Kt,0],[xt,$t,0],[St,$t,0]]}(c,a,u._pixelsPerMercatorPixel,oe,ce);for(let pt=0;pt<C.length;pt++)Tf(C[pt],it[pt],et);const At=_e([],it[Te],it[(Te+1)%4]);Oe(At,At,.5),Tf(Xe,At,et)}for(const it of C)ge(U,U,it),pe(D,D,it);return U[2]=Math.min(ke[2],qe[2]),ge(U,U,Xe),pe(D,D,Xe),new xn(U,D)}function JA({x:u,y:a,z:c},p=!1){const g=1/(1<<c),x=new Q(Ne(u*g),a===(1<<c)-1&&p?-90:je((a+1)*g)),w=new Q(Ne((u+1)*g),a===0&&p?90:je(a*g));return new X(x,w)}function kR(u,a=vl){const c=_n(u.getNorth()),p=_n(u.getSouth()),g=Math.cos(c),x=Math.cos(p),w=Math.sin(c),C=Math.sin(p),N=u.getWest(),D=u.getEast();return[L(x,C,N,a),L(x,C,D,a),L(g,w,D,a),L(g,w,N,a)]}function q1(u,a,c,p){const g=1<<c.z,x=(u/tr+c.x)/g;return B(je((a/tr+c.y)/g),Ne(x),p)}function QA({min:u,max:a}){return f/Math.max(a[0]-u[0],a[1]-u[1],a[2]-u[2])}const TU=new Float64Array(16);function eC(u){const a=QA(u),c=ee(TU,[a,a,a]);return F(c,c,nt([],u.min))}function NR(u){const a=(p=u.min,(c=TU)[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=p[0],c[13]=p[1],c[14]=p[2],c[15]=1,c);var c,p;const g=1/QA(u);return z(a,a,[g,g,g])}function IR(u){const a=tr/(2*Math.PI);return u/(2*Math.PI)/a}function AU(u,a){return tr/(512*Math.pow(2,u))*QA(hh(a))}function CU(u,a,c,p,g){const x=IR(c),w=[u,a,-c/(2*Math.PI)],C=I(new Float64Array(16));return F(C,C,w),z(C,C,[x,x,x]),$(C,C,_n(-g)),W(C,C,_n(-p)),C}function rm(u){return De(v,l,u)}function jU(u,a){const c=B(a.lat,a.lng),p=function(J){const oe=B(J._center.lat,J._center.lng);let ce=gt([],we(0,1,0),oe);const he=ne([],-J.angle,oe);ce=Ht(ce,ce,he),ne(he,-J._pitch,ce);const Se=Me([],oe);return Oe(Se,Se,YA(J.cameraToCenterDistance/J.pixelsPerMeter)),Ht(Se,Se,he),_e([],oe,Se)}(u);return w=(g=me([],p,c))[0],C=g[1],N=g[2],D=(x=c)[0],U=x[1],q=x[2],Y=(H=Math.sqrt((w*w+C*C+N*N)*(D*D+U*U+q*q)))&&We(g,x)/H,Math.acos(Math.min(Math.max(Y,-1),1));var g,x,w,C,N,D,U,q,H,Y}function RR(u,a){return jU(u,a)>Math.PI/2*1.01}const PU=_n(85),dhe=Math.cos(PU),hhe=Math.sin(PU),fhe=O(),OU=u=>{const a=[];return u.paint.get("circle-pitch-alignment")==="map"&&a.push("PITCH_WITH_MAP"),u.paint.get("circle-pitch-scale")==="map"&&a.push("SCALE_WITH_MAP"),a};function kU(u,a,c,p,g,x,w,C,N){if(x&&u.queryGeometry.isAboveHorizon)return!1;x&&(N*=u.pixelToTileUnitsFactor);const D=u.tileID.canonical,U=c.projection.upVectorScale(D,c.center.lat,c.worldSize).metersToTile;for(const q of a)for(const H of q){const Y=H.add(C),J=g&&c.elevation?c.elevation.exaggeration()*g.getElevationAt(Y.x,Y.y,!0):0,oe=c.projection.projectTilePoint(Y.x,Y.y,D);if(J>0){const Te=c.projection.upVector(D,Y.x,Y.y);oe.x+=Te[0]*U*J,oe.y+=Te[1]*U*J,oe.z+=Te[2]*U*J}const ce=x?Y:phe(oe.x,oe.y,oe.z,p),he=x?u.tilespaceRays.map(Te=>ghe(Te,J)):u.queryGeometry.screenGeometry,Se=Qt([],[oe.x,oe.y,oe.z,1],p);if(!w&&x?N*=Se[3]/c.cameraToCenterDistance:w&&!x&&(N*=c.cameraToCenterDistance/Se[3]),x){const Te=je((H.y/tr+D.y)/(1<<D.z));N/=c.projection.pixelsPerMeter(Te,1)/Ee(1,Te)}if(hs(he,ce,N))return!0}return!1}function phe(u,a,c,p){const g=Qt([],[u,a,c,1],p);return new st(g[0]/g[3],g[1]/g[3])}const NU=we(0,0,0),mhe=we(0,0,1);function ghe(u,a){const c=ae();return NU[2]=a,u.intersectsPlane(NU,mhe,c),new st(c[0],c[1])}class IU extends ls{}let RU,MU,DU,LU;function FU(u,{width:a,height:c},p,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==a*c*p)throw new RangeError("mismatched image size")}else g=new Uint8Array(a*c*p);return u.width=a,u.height=c,u.data=g,u}function zU(u,a,c){const{width:p,height:g}=a;p===u.width&&g===u.height||(MR(u,a,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,p),height:Math.min(u.height,g)},c,null),u.width=p,u.height=g,u.data=a.data)}function MR(u,a,c,p,g,x,w,C){if(g.width===0||g.height===0)return a;if(g.width>u.width||g.height>u.height||c.x>u.width-g.width||c.y>u.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>a.width||g.height>a.height||p.x>a.width-g.width||p.y>a.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const N=u.data,D=a.data,U=x===4&&C;for(let q=0;q<g.height;q++){const H=((c.y+q)*u.width+c.x)*x,Y=((p.y+q)*a.width+p.x)*x;if(U)for(let J=0;J<g.width;J++){const oe=H+J*x+3,ce=Y+J*x;D[ce+0]=255,D[ce+1]=255,D[ce+2]=255,D[ce+3]=N[oe]}else if(w)for(let J=0;J<g.width;J++){const oe=H+J*x,ce=Y+J*x,he=new hi(N[oe+0]/255,N[oe+1]/255,N[oe+2]/255,N[oe+3]).toNonPremultipliedRenderColor(w).toArray();D[ce+0]=he[0],D[ce+1]=he[1],D[ce+2]=he[2],D[ce+3]=he[3]}else for(let J=0;J<g.width*x;J++)D[Y+J]=N[H+J]}return a}_r(IU,"HeatmapBucket",{omit:["layers"]});class nm{constructor(a,c){FU(this,a,1,c)}resize(a){zU(this,new nm(a),1)}clone(){return new nm({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,c,p,g,x){MR(a,c,p,g,x,1,null)}}class So{constructor(a,c){FU(this,a,4,c)}resize(a){zU(this,new So(a),4)}replace(a,c){c?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new So({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,c,p,g,x,w,C){MR(a,c,p,g,x,4,w,C)}}class BU{constructor(a,c){this.width=a.width,this.height=a.height,this.data=c instanceof Uint8Array?new Float32Array(c.buffer):c}}function H1(u){const a={},c=u.resolution||256,p=u.clips?u.clips.length:1,g=u.image||new So({width:c,height:p}),x=(w,C,N)=>{a[u.evaluationKey]=N;const D=u.expression.evaluate(a),U=D?D.toNonPremultipliedRenderColor(null):null;U&&(g.data[w+C+0]=Math.floor(255*U.r),g.data[w+C+1]=Math.floor(255*U.g),g.data[w+C+2]=Math.floor(255*U.b),g.data[w+C+3]=Math.floor(255*U.a))};if(u.clips)for(let w=0,C=0;w<p;++w,C+=4*c)for(let N=0,D=0;N<c;N++,D+=4){const U=N/(c-1),{start:q,end:H}=u.clips[w];x(C,D,q*(1-U)+H*U)}else for(let w=0,C=0;w<c;w++,C+=4)x(0,C,w/(c-1));return g}_r(nm,"AlphaImage"),_r(So,"RGBAImage");const yhe=Cn([{name:"a_pos",components:2,type:"Int16"}],4),vhe=Cn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),_he=Cn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),xhe=Cn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function cx(u,a,c=2){const p=a&&a.length,g=p?a[0]*c:u.length;let x=$U(u,0,g,c,!0);const w=[];if(!x||x.next===x.prev)return w;let C,N,D;if(p&&(x=function(U,q,H,Y){const J=[];for(let oe=0,ce=q.length;oe<ce;oe++){const he=$U(U,q[oe]*Y,oe<ce-1?q[oe+1]*Y:U.length,Y,!1);he===he.next&&(he.steiner=!0),J.push(jhe(he))}J.sort(The);for(let oe=0;oe<J.length;oe++)H=Ahe(J[oe],H);return H}(u,a,x,c)),u.length>80*c){C=u[0],N=u[1];let U=C,q=N;for(let H=c;H<g;H+=c){const Y=u[H],J=u[H+1];Y<C&&(C=Y),J<N&&(N=J),Y>U&&(U=Y),J>q&&(q=J)}D=Math.max(U-C,q-N),D=D!==0?32767/D:0}return G1(x,w,c,C,N,D,0),w}function $U(u,a,c,p,g){let x;if(g===function(w,C,N,D){let U=0;for(let q=C,H=N-D;q<N;q+=D)U+=(w[H]-w[q])*(w[q+1]+w[H+1]),H=q;return U}(u,a,c,p)>0)for(let w=a;w<c;w+=p)x=HU(w/p|0,u[w],u[w+1],x);else for(let w=c-p;w>=a;w-=p)x=HU(w/p|0,u[w],u[w+1],x);return x&&ux(x,x.next)&&(Z1(x),x=x.next),x}function xy(u,a){if(!u)return u;a||(a=u);let c,p=u;do if(c=!1,p.steiner||!ux(p,p.next)&&Da(p.prev,p,p.next)!==0)p=p.next;else{if(Z1(p),p=a=p.prev,p===p.next)break;c=!0}while(c||p!==a);return a}function G1(u,a,c,p,g,x,w){if(!u)return;!w&&x&&function(N,D,U,q){let H=N;do H.z===0&&(H.z=DR(H.x,H.y,D,U,q)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next;while(H!==N);H.prevZ.nextZ=null,H.prevZ=null,function(Y){let J,oe=1;do{let ce,he=Y;Y=null;let Se=null;for(J=0;he;){J++;let Te=he,ke=0;for(let Fe=0;Fe<oe&&(ke++,Te=Te.nextZ,Te);Fe++);let qe=oe;for(;ke>0||qe>0&&Te;)ke!==0&&(qe===0||!Te||he.z<=Te.z)?(ce=he,he=he.nextZ,ke--):(ce=Te,Te=Te.nextZ,qe--),Se?Se.nextZ=ce:Y=ce,ce.prevZ=Se,Se=ce;he=Te}Se.nextZ=null,oe*=2}while(J>1)}(H)}(u,p,g,x);let C=u;for(;u.prev!==u.next;){const N=u.prev,D=u.next;if(x?whe(u,p,g,x):bhe(u))a.push(N.i,u.i,D.i),Z1(u),u=D.next,C=D.next;else if((u=D)===C){w?w===1?G1(u=She(xy(u),a),a,c,p,g,x,2):w===2&&Ehe(u,a,c,p,g,x):G1(xy(u),a,c,p,g,x,1);break}}}function bhe(u){const a=u.prev,c=u,p=u.next;if(Da(a,c,p)>=0)return!1;const g=a.x,x=c.x,w=p.x,C=a.y,N=c.y,D=p.y,U=Math.min(g,x,w),q=Math.min(C,N,D),H=Math.max(g,x,w),Y=Math.max(C,N,D);let J=p.next;for(;J!==a;){if(J.x>=U&&J.x<=H&&J.y>=q&&J.y<=Y&&W1(g,C,x,N,w,D,J.x,J.y)&&Da(J.prev,J,J.next)>=0)return!1;J=J.next}return!0}function whe(u,a,c,p){const g=u.prev,x=u,w=u.next;if(Da(g,x,w)>=0)return!1;const C=g.x,N=x.x,D=w.x,U=g.y,q=x.y,H=w.y,Y=Math.min(C,N,D),J=Math.min(U,q,H),oe=Math.max(C,N,D),ce=Math.max(U,q,H),he=DR(Y,J,a,c,p),Se=DR(oe,ce,a,c,p);let Te=u.prevZ,ke=u.nextZ;for(;Te&&Te.z>=he&&ke&&ke.z<=Se;){if(Te.x>=Y&&Te.x<=oe&&Te.y>=J&&Te.y<=ce&&Te!==g&&Te!==w&&W1(C,U,N,q,D,H,Te.x,Te.y)&&Da(Te.prev,Te,Te.next)>=0||(Te=Te.prevZ,ke.x>=Y&&ke.x<=oe&&ke.y>=J&&ke.y<=ce&&ke!==g&&ke!==w&&W1(C,U,N,q,D,H,ke.x,ke.y)&&Da(ke.prev,ke,ke.next)>=0))return!1;ke=ke.nextZ}for(;Te&&Te.z>=he;){if(Te.x>=Y&&Te.x<=oe&&Te.y>=J&&Te.y<=ce&&Te!==g&&Te!==w&&W1(C,U,N,q,D,H,Te.x,Te.y)&&Da(Te.prev,Te,Te.next)>=0)return!1;Te=Te.prevZ}for(;ke&&ke.z<=Se;){if(ke.x>=Y&&ke.x<=oe&&ke.y>=J&&ke.y<=ce&&ke!==g&&ke!==w&&W1(C,U,N,q,D,H,ke.x,ke.y)&&Da(ke.prev,ke,ke.next)>=0)return!1;ke=ke.nextZ}return!0}function She(u,a){let c=u;do{const p=c.prev,g=c.next.next;!ux(p,g)&&VU(p,c,c.next,g)&&K1(p,g)&&K1(g,p)&&(a.push(p.i,c.i,g.i),Z1(c),Z1(c.next),c=u=g),c=c.next}while(c!==u);return xy(c)}function Ehe(u,a,c,p,g,x){let w=u;do{let C=w.next.next;for(;C!==w.prev;){if(w.i!==C.i&&Phe(w,C)){let N=qU(w,C);return w=xy(w,w.next),N=xy(N,N.next),G1(w,a,c,p,g,x,0),void G1(N,a,c,p,g,x,0)}C=C.next}w=w.next}while(w!==u)}function The(u,a){let c=u.x-a.x;return c===0&&(c=u.y-a.y,c===0)&&(c=(u.next.y-u.y)/(u.next.x-u.x)-(a.next.y-a.y)/(a.next.x-a.x)),c}function Ahe(u,a){const c=function(g,x){let w=x;const C=g.x,N=g.y;let D,U=-1/0;if(ux(g,w))return w;do{if(ux(g,w.next))return w.next;if(N<=w.y&&N>=w.next.y&&w.next.y!==w.y){const oe=w.x+(N-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(oe<=C&&oe>U&&(U=oe,D=w.x<w.next.x?w:w.next,oe===C))return D}w=w.next}while(w!==x);if(!D)return null;const q=D,H=D.x,Y=D.y;let J=1/0;w=D;do{if(C>=w.x&&w.x>=H&&C!==w.x&&UU(N<Y?C:U,N,H,Y,N<Y?U:C,N,w.x,w.y)){const oe=Math.abs(N-w.y)/(C-w.x);K1(w,g)&&(oe<J||oe===J&&(w.x>D.x||w.x===D.x&&Che(D,w)))&&(D=w,J=oe)}w=w.next}while(w!==q);return D}(u,a);if(!c)return a;const p=qU(c,u);return xy(p,p.next),xy(c,c.next)}function Che(u,a){return Da(u.prev,u,a.prev)<0&&Da(a.next,u,u.next)<0}function DR(u,a,c,p,g){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-c)*g|0)|u<<8))|u<<4))|u<<2))|u<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-p)*g|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function jhe(u){let a=u,c=u;do(a.x<c.x||a.x===c.x&&a.y<c.y)&&(c=a),a=a.next;while(a!==u);return c}function UU(u,a,c,p,g,x,w,C){return(g-w)*(a-C)>=(u-w)*(x-C)&&(u-w)*(p-C)>=(c-w)*(a-C)&&(c-w)*(x-C)>=(g-w)*(p-C)}function W1(u,a,c,p,g,x,w,C){return!(u===w&&a===C)&&UU(u,a,c,p,g,x,w,C)}function Phe(u,a){return u.next.i!==a.i&&u.prev.i!==a.i&&!function(c,p){let g=c;do{if(g.i!==c.i&&g.next.i!==c.i&&g.i!==p.i&&g.next.i!==p.i&&VU(g,g.next,c,p))return!0;g=g.next}while(g!==c);return!1}(u,a)&&(K1(u,a)&&K1(a,u)&&function(c,p){let g=c,x=!1;const w=(c.x+p.x)/2,C=(c.y+p.y)/2;do g.y>C!=g.next.y>C&&g.next.y!==g.y&&w<(g.next.x-g.x)*(C-g.y)/(g.next.y-g.y)+g.x&&(x=!x),g=g.next;while(g!==c);return x}(u,a)&&(Da(u.prev,u,a.prev)||Da(u,a.prev,a))||ux(u,a)&&Da(u.prev,u,u.next)>0&&Da(a.prev,a,a.next)>0)}function Da(u,a,c){return(a.y-u.y)*(c.x-a.x)-(a.x-u.x)*(c.y-a.y)}function ux(u,a){return u.x===a.x&&u.y===a.y}function VU(u,a,c,p){const g=rC(Da(u,a,c)),x=rC(Da(u,a,p)),w=rC(Da(c,p,u)),C=rC(Da(c,p,a));return g!==x&&w!==C||!(g!==0||!tC(u,c,a))||!(x!==0||!tC(u,p,a))||!(w!==0||!tC(c,u,p))||!(C!==0||!tC(c,a,p))}function tC(u,a,c){return a.x<=Math.max(u.x,c.x)&&a.x>=Math.min(u.x,c.x)&&a.y<=Math.max(u.y,c.y)&&a.y>=Math.min(u.y,c.y)}function rC(u){return u>0?1:u<0?-1:0}function K1(u,a){return Da(u.prev,u,u.next)<0?Da(u,a,u.next)>=0&&Da(u,u.prev,a)>=0:Da(u,a,u.prev)<0||Da(u,u.next,a)<0}function qU(u,a){const c=LR(u.i,u.x,u.y),p=LR(a.i,a.x,a.y),g=u.next,x=a.prev;return u.next=a,a.prev=u,c.next=g,g.prev=c,p.next=c,c.prev=p,x.next=p,p.prev=x,p}function HU(u,a,c,p){const g=LR(u,a,c);return p?(g.next=p.next,g.prev=p,p.next.prev=g,p.next=g):(g.prev=g,g.next=g),g}function Z1(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function LR(u,a,c){return{i:u,x:a,y:c,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function X1(u,a){const c=u.length;if(c<=1)return[u];const p=[];let g,x;for(let w=0;w<c;w++){const C=An(u[w]);C!==0&&(u[w].area=Math.abs(C),x===void 0&&(x=C<0),x===C<0?(g&&p.push(g),g=[u[w]]):g.push(u[w]))}if(g&&p.push(g),a>1)for(let w=0;w<p.length;w++)p[w].length<=a||(dd(p[w],a,1,p[w].length-1,Ohe),p[w]=p[w].slice(0,a));return p}function Ohe(u,a){return a.area-u.area}function GU(u,a,c=1){if(!u)return null;const p=typeof u=="string"?gl.from(u).getPrimary():u.getPrimary(),g=typeof u=="string"?null:u.getSecondary();for(const x of[p,g]){if(!x)continue;const w=x.id.toString();a.has(w)||a.set(w,[]),x.scaleSelf(c),a.get(w).push(x)}return{primary:p.toString(),secondary:g?g.toString():null}}function FR(u,a,c,p){const g=p.patternDependencies;let x=!1;for(const w of a){const C=w.paint.get(`${u}-pattern`);C.isConstant()||(x=!0),GU(C.constantOr(null),g,c)&&(x=!0)}return x}function zR(u,a,c,p,g,x){const w=x.patternDependencies;for(const C of a){const N=C.paint.get(`${u}-pattern`).value;if(N.kind!=="constant"){let D=N.evaluate({zoom:p},c,{},x.availableImages);D=D&&D.name?D.name:D;const U=GU(D,w,g);if(!U)continue;const{primary:q,secondary:H}=U;q&&(c.patterns[C.id]=[q,H].filter(Boolean))}}return c}class WU{constructor(){this.polygons=new Map}add(a,...c){const p=this.polygons.get(a);p?p.push(...c):this.polygons.set(a,c)}merge(a){for(const[c,p]of a.polygons)this.add(c,...p)}}class Af{constructor(){this.portals=[]}static isOnBorder(a,c){return a<=0&&c<=0||a>=tr&&c>=tr}static evaluate(a){if(a.length===0)return new Af;let c=[];for(const N of a)c.push(...N.portals);if(c.length===0)return new Af;for(const N of c){const D=N.va,U=N.vb;(Af.isOnBorder(D.x,U.x)||Af.isOnBorder(D.y,U.y))&&(N.type="border")}const p=c.filter(N=>N.type!=="unevaluated"),g=c.filter(N=>N.type==="unevaluated");if(g.length===0)return new Af;g.sort((N,D)=>N.hash===D.hash?N.isTunnel===D.isTunnel?0:N.isTunnel?-1:1:N.hash<D.hash?1:-1),c=p.concat(g);let x=p.length,w=x,C=x;do if(w++,w===c.length||c[x].hash!==c[w].hash){if(w-x==2){C<x&&(c[C]=c[x],c[x]=null);const N=c[C],D=c[w-1];N.type=N.isTunnel!==D.isTunnel?"tunnel":"polygon",N.connection={a:N.connection.a,b:D.connection.a},C++}x=w}while(x!==c.length);return c.splice(C),c.sort((N,D)=>N.hash<D.hash?1:-1),{portals:c}}}_r(Af,"ElevationPortalGraph"),_r(WU,"ElevationPolygons");class khe{constructor(a,c,p){this.outPositions=a,this.outNormals=c,this.outIndices=p,this.vertexLookup=new Map}addVertex(a,c,p){let g=a[2];p!=null&&(g*=p);const x=`${a[0]},${a[1]},${a[2]},${c[0]},${c[1]},${c[2]}`,w=this.vertexLookup.get(x);if(w!=null)return w;const C=this.outPositions.length;this.vertexLookup.set(x,C);const N=Math.trunc(16384*c[0]),D=Math.trunc(16384*c[1]),U=Math.trunc(16384*c[2]);return this.outPositions.emplaceBack(a[0],a[1],g),this.outNormals.emplaceBack(N,D,U),C}addTriangle(a,c,p){this.outIndices.emplaceBack(a,c,p)}addTriangles(a,c,p){if(a.length===0)return;const g=p.length===1,x=ae(),w=ae();for(let C=0;C<a.length;C+=3){const N=c[a[C+0]],D=c[a[C+1]],U=c[a[C+2]],q=g?p[0]:p[a[C+1]],H=g?p[0]:p[a[C+2]];Ce(x,N.x,N.y,g?p[0]:p[a[C+0]]);const Y=this.addVertex(x,w);Ce(x,D.x,D.y,q);const J=this.addVertex(x,w);Ce(x,U.x,U.y,H);const oe=this.addVertex(x,w);this.outIndices.emplaceBack(Y,J,oe)}}addQuad(a,c,p,g,x,w){const C=this.addVertex(a,x,w),N=this.addVertex(c,x,w),D=this.addVertex(p,x,w),U=this.addVertex(g,x,w);this.addTriangle(C,N,D),this.addTriangle(D,U,C)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class ec{constructor(a,c,p,g){this.unevaluatedPortals=new Af,this.portalPolygons=new WU,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new A1,this.vertexNormals=new C1,this.indexArray=new is,this.tileToMeters=Ke(a),this.bridgeProgramConfigurations=new nu(c,{zoom:p,lut:g},x=>x!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new nu(c,{zoom:p,lut:g},x=>x!=="fill-bridge-guard-rail-color")}addVertices(a,c){const p=this.unevalVertices.length;for(let g=0;g<a.length;g++)this.unevalVertices.push(a[g]),this.unevalHeights.push(c[g]);return p}addTriangles(a,c,p){const g=p?this.unevalTunnelTriangles:this.unevalTriangles;for(const x of a)g.push(x+c)}addRenderableRing(a,c,p,g,x,w){const C=[new st(x.min.x,x.min.y),new st(x.max.x,x.min.y),new st(x.max.x,x.max.y),new st(x.min.x,x.max.y)];for(let N=0;N<p-1;N++){const D=c+N,U=D+1,q=this.unevalVertices[D],H=this.unevalVertices[U];if(!(q.x>=x.min.x&&q.x<=x.max.x&&q.y>=x.min.y&&q.y<=x.max.y||H.x>=x.min.x&&H.x<=x.max.x&&H.y>=x.min.y&&H.y<=x.max.y||Is(q,H,C))||this.isOnBorder(q.x,H.x)||this.isOnBorder(q.y,H.y))continue;const Y=ec.computeEdgeHash(this.unevalVertices[D],this.unevalVertices[U]);let J,oe=this.vertexHashLookup.get(ec.computePosHash(q));oe!=null?J=oe.next:(oe=this.vertexHashLookup.get(ec.computePosHash(H)),J=oe!=null?oe.prev:Y),this.unevalEdges.push({polygonIdx:a,a:D,b:U,hash:Y,portalHash:J,isTunnel:g,type:"unevaluated",featureInfo:w})}}addPortalCandidates(a,c,p,g,x){if(c.length===0)return;this.portalPolygons.add(a,{geometry:c,zLevel:x});const w=c[0];this.vertexHashLookup.clear();let C=ec.computeEdgeHash(w[w.length-2],w[w.length-1]);for(let N=0;N<w.length-1;N++){const D=w[N+0],U=w[N+1],q=Ua(U.x-D.x,U.y-D.y),H=Fi(q);if(H===0)continue;let Y="unevaluated";const J=g.pointElevation(D),oe=g.pointElevation(U);Math.abs(J)<.01&&Math.abs(oe)<.01?Y="entrance":(this.isOnBorder(D.x,U.x)||this.isOnBorder(D.y,U.y))&&(Y="border");const ce=ec.computeEdgeHash(D,U);this.unevaluatedPortals.portals.push({connection:{a,b:void 0},va:D,vb:U,vab:q,length:H,hash:ce,isTunnel:p,type:Y});const he=ec.computePosHash(D);this.vertexHashLookup.set(he,{prev:C,next:ce}),C=ce}}construct(a){if(this.unevalVertices.length===0)return;const c=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),p=H=>{H.primitiveLength=this.indexArray.length-H.primitiveOffset},g=new khe(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(a.portals,this.unevalEdges);const x=c(),w=c(),C=c(),N=(H,Y)=>{H.sort((oe,ce)=>oe.type===Y&&ce.type!==Y?-1:oe.type!==Y&&ce.type===Y?1:0);const J=H.findIndex(oe=>oe.type!==Y);return J>=0?J:H.length};let D=0;this.unevalEdges.length>0&&(D=N(this.unevalEdges,"none"),this.constructBridgeStructures(g,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:D},this.tileToMeters)),p(C);const U=c(),q=c();if(this.unevalEdges.length>0){const H=this.unevalEdges.splice(D),Y=N(H,"tunnel")+D;this.unevalEdges.push(...H),this.constructTunnelStructures(g,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:D},{min:D,max:Y})}p(U),g.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),p(q),g.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),p(w),g.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),p(x),this.maskSegments=ds.simpleSegment(0,q.primitiveOffset,0,q.primitiveLength),this.depthSegments=ds.simpleSegment(0,w.primitiveOffset,0,w.primitiveLength),this.renderableBridgeSegments=ds.simpleSegment(0,C.primitiveOffset,0,C.primitiveLength),this.renderableTunnelSegments=ds.simpleSegment(0,U.primitiveOffset,0,U.primitiveLength),this.shadowCasterSegments=ds.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength)}update(a,c,p,g,x,w,C,N){this.bridgeProgramConfigurations.updatePaintArrays(a,c,x,p,g,w,C,N),this.tunnelProgramConfigurations.updatePaintArrays(a,c,x,p,g,w,C,N)}upload(a){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=a.createVertexBuffer(this.vertexPositions,_he.members),this.vertexBufferNormal=a.createVertexBuffer(this.vertexNormals,xhe.members),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(a),this.tunnelProgramConfigurations.upload(a))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(a,c,p,g,x){const w=(C,N)=>{for(let D=0;D<N.length-1;D++){const U=N[D].featureIndex,q=N[D+1].vertexStart,H=a.feature(U);C.populatePaintArrays(q,H,U,{},p,c,g,void 0,x)}};w(this.bridgeProgramConfigurations,this.bridgeFeatureSections),w(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(a,c,p,g,x){const w=new Map;for(let C=g;C<x;C++){const N=p[C],D=N.a,U=N.b,q=ec.computePosHash(a[D]),H=ec.computePosHash(a[U]);let Y=w.get(q);Y||(Y={},w.set(q,Y));let J=w.get(H);J||(J={},w.set(H,J)),c[D]<=0&&c[U]<=0||(Y.to=U,J.from=D)}return w}isTerminalVertex(a,c){const p=ec.computePosHash(this.unevalVertices[a]),g=c.get(p);return!g||!g.from||!g.to}constructBridgeStructures(a,c,p,g,x,w){a.clearVertexLookup();const C=this.computeVertexConnections(c,p,g,x.min,x.max),N=1/w,D=.5*N,U=(Yt,qt)=>Ce(Yt,c[qt].x,c[qt].y,p[qt]*N),q=ae(),H=ae(),Y=ae(),J=ae(),oe=ae(),ce=(Yt,qt)=>{const Dt=C.get(ec.computePosHash(c[qt])),Vt=Dt.from,St=Dt.to;if(!Vt||!St)return;U(q,Vt),U(H,qt),U(Y,St),Rr(J),Dr(q,H)||(Pt(oe,H,q),Me(J,oe)),Dr(Y,H)||(Pt(oe,Y,H),_e(J,J,Me(oe,oe)));const xt=He(J);return xt>0?Oe(Yt,J,1/xt):void 0};let he=Number.POSITIVE_INFINITY;this.sortSubarray(g,x.min,x.max,(Yt,qt)=>Yt.featureInfo.featureIndex-qt.featureInfo.featureIndex);const Se=ae(),Te=ae(),ke=ae(),qe=ae(),Fe=ae(),Xe=ae(),et=ae(),it=ae(),At=ae(),pt=[ae(),ae(),ae(),ae()],jt=[ae(),ae(),ae(),ae()],Rt=[{coord:new st(0,0),height:0},{coord:new st(0,0),height:0}],zt=(Yt,qt)=>Yt>qt;for(let Yt=x.min;Yt<x.max;Yt++){const qt=g[Yt];if(!qt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Rt,c,p,qt,zt))continue;const[Dt,Vt]=Rt;if(Ce(Se,Dt.coord.x,Dt.coord.y,N*Dt.height),Ce(Te,Vt.coord.x,Vt.coord.y,N*Vt.height),Dr(Se,Te))continue;Pt(ke,Te,Se),Me(ke,ke);const St=ce(it,qt.a)||ke,xt=ce(At,qt.b)||ke;Ce(qe,St[1],-St[0],0),Me(qe,qe),Ce(Fe,xt[1],-xt[0],0),Me(Fe,Fe),gt(it,qe,St),Me(Xe,it),gt(it,Fe,xt),Me(et,it),_e(pt[0],Se,Oe(it,Pt(it,qe,Xe),D)),_e(pt[1],Se,Oe(it,_e(it,qe,Xe),D)),_e(pt[2],Se,Oe(it,Xe,D)),pt[3]=Se,_e(jt[0],Te,Oe(it,Pt(it,Fe,et),D)),_e(jt[1],Te,Oe(it,_e(it,Fe,et),D)),_e(jt[2],Te,Oe(it,et,D)),jt[3]=Te,he=this.addFeatureSection(qt.featureInfo.featureIndex,he,this.bridgeFeatureSections,a);const $t=a.addVertex(pt[0],qe,w),Kt=a.addVertex(pt[1],qe,w),Ft=a.addVertex(jt[0],Fe,w),gr=a.addVertex(jt[1],Fe,w);a.addTriangle($t,Kt,Ft),a.addTriangle(Kt,gr,Ft);const br=a.addVertex(pt[1],Xe,w),hr=a.addVertex(pt[2],Xe,w),ar=a.addVertex(jt[1],et,w),en=a.addVertex(jt[2],et,w);a.addTriangle(br,hr,ar),a.addTriangle(hr,en,ar),nt(qe,qe),nt(Fe,Fe);const lr=a.addVertex(pt[2],qe,w),Lr=a.addVertex(pt[3],qe,w),rn=a.addVertex(jt[2],Fe,w),Sn=a.addVertex(jt[3],Fe,w);a.addTriangle(lr,Lr,rn),a.addTriangle(Lr,Sn,rn);const qn=this.isTerminalVertex(qt.a,C),on=this.isTerminalVertex(qt.b,C);Dt.height<.01&&qn&&a.addQuad(pt[3],pt[2],pt[1],pt[0],nt(St,St),w),Vt.height<.01&&on&&a.addQuad(jt[0],jt[1],jt[2],jt[3],xt,w)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:a.getVertexCount()})}constructTunnelStructures(a,c,p,g,x,w){a.clearVertexLookup();let C=Number.POSITIVE_INFINITY;const N=(he,Se)=>he.featureInfo.featureIndex-Se.featureInfo.featureIndex;this.sortSubarray(g,x.min,x.max,N),this.sortSubarray(g,w.min,w.max,N);const D=he=>Me(he,he),U=[{coord:new st(0,0),height:0},{coord:new st(0,0),height:0}],q=(he,Se)=>he<Se,H=ae(),Y=ae(),J=ae(),oe=ae(),ce=ae();for(let he=x.min;he<x.max;he++){if(!this.prepareEdgePoints(U,c,p,g[he],q))continue;const[Se,Te]=U,ke=D(Ce(ce,-(Te.coord.y-Se.coord.y),Te.coord.x-Se.coord.x,0));C=this.addFeatureSection(g[he].featureInfo.featureIndex,C,this.tunnelFeatureSections,a),a.addQuad(Ce(H,Se.coord.x,Se.coord.y,Se.height),Ce(Y,Te.coord.x,Te.coord.y,Te.height),Ce(J,Te.coord.x,Te.coord.y,g[he].isTunnel?-.1:0),Ce(oe,Se.coord.x,Se.coord.y,g[he].isTunnel?-.1:0),ke)}for(let he=w.min;he<w.max;he++){const Se=g[he];Se.isTunnel&&([Se.a,Se.b]=[Se.b,Se.a]);const Te=c[Se.a],ke=c[Se.b],qe=D(Ce(ce,-(ke.y-Te.y),ke.x-Te.x,0));C=this.addFeatureSection(Se.featureInfo.featureIndex,C,this.tunnelFeatureSections,a),a.addQuad(Ce(H,ke.x,ke.y,0),Ce(Y,Te.x,Te.y,0),Ce(J,Te.x,Te.y,p[Se.a]+4),Ce(oe,ke.x,ke.y,p[Se.b]+4),qe),a.addQuad(Ce(H,Te.x,Te.y,0),Ce(Y,ke.x,ke.y,0),Ce(J,ke.x,ke.y,p[Se.b]+4),Ce(oe,Te.x,Te.y,p[Se.a]+4),qe)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:a.getVertexCount()})}setElevatedPoint(a,c,p,g){a.coord.x=c,a.coord.y=p,a.height=g}prepareEdgePoints(a,c,p,g,x){let w=c[g.a].x,C=c[g.a].y,N=c[g.b].x,D=c[g.b].y,U=p[g.a],q=p[g.b];const H=x(U,0),Y=x(q,0);if(H&&Y)return this.setElevatedPoint(a[0],w,C,U),this.setElevatedPoint(a[1],N,D,q),!0;if(!H&&!Y)return!1;if(H){if(!Y){const J=q/(q-U);N=Kr(N,w,J),D=Kr(D,C,J),q=Kr(q,U,J)}}else{const J=U/(U-q);w=Kr(w,N,J),C=Kr(C,D,J),U=Kr(U,q,J)}return this.setElevatedPoint(a[0],w,C,U),this.setElevatedPoint(a[1],N,D,q),!0}prepareEdges(a,c){if(c.length===0)return;c.sort((C,N)=>C.hash===N.hash?N.polygonIdx-C.polygonIdx:N.hash>C.hash?1:-1);let p=0,g=0,x=0,w=c[p].polygonIdx;do g++,(g===c.length||c[p].hash!==c[g].hash)&&((g-p==1||c[g-1].polygonIdx!==w)&&(x<p&&(c[x]=c[p],c[p]=null),c[x].type="none",x++),p=g,p!==c.length&&(w=c[p].polygonIdx));while(p!==c.length);if(c.splice(x),c.length!==0&&a.length!==0){c.sort((D,U)=>D.portalHash<U.portalHash?1:-1);let C=0,N=0;for(;C!==c.length&&N!==a.length;){const D=c[C],U=a[N];D.portalHash>U.hash?C++:U.hash>D.portalHash?N++:(D.type=U.type,C++)}}}isOnBorder(a,c){return a<=0&&c<=0||a>=tr&&c>=tr}addFeatureSection(a,c,p,g){return a!==c&&(c=a,p.push({featureIndex:a,vertexStart:g.getVertexCount()}),g.clearVertexLookup()),c}sortSubarray(a,c,p,g){const x=a.slice(c,p);x.sort(g),a.splice(c,x.length,...x)}static computeEdgeHash(a,c){return(a.y===c.y&&a.x>c.x||a.y>c.y)&&([a,c]=[c,a]),BigInt(ec.computePosHash(a))<<32n|BigInt(ec.computePosHash(c))}static computePosHash(a){return((65535&a.x)<<16|65535&a.y)>>>0}}var KU,ZU={exports:{}},XU=(KU||(KU=1,function(u,a){(function(c){function p(ze,Re){return ze>Re?1:ze<Re?-1:0}var g=function(ze,Re){ze===void 0&&(ze=p),Re===void 0&&(Re=!1),this._compare=ze,this._root=null,this._size=0,this._noDuplicates=!!Re},x={size:{configurable:!0}};function w(ze,Re,Ot,ir,kt){var or=kt-ir;if(or>0){var jr=ir+Math.floor(or/2),Tr={key:Re[jr],data:Ot[jr],parent:ze};return Tr.left=w(Tr,Re,Ot,ir,jr),Tr.right=w(Tr,Re,Ot,jr+1,kt),Tr}return null}function C(ze,Re,Ot,ir,kt){if(!(Ot>=ir)){for(var or=ze[Ot+ir>>1],jr=Ot-1,Tr=ir+1;;){do jr++;while(kt(ze[jr],or)<0);do Tr--;while(kt(ze[Tr],or)>0);if(jr>=Tr)break;var cn=ze[jr];ze[jr]=ze[Tr],ze[Tr]=cn,cn=Re[jr],Re[jr]=Re[Tr],Re[Tr]=cn}C(ze,Re,Ot,Tr,kt),C(ze,Re,Tr+1,ir,kt)}}g.prototype.rotateLeft=function(ze){var Re=ze.right;Re&&(ze.right=Re.left,Re.left&&(Re.left.parent=ze),Re.parent=ze.parent),ze.parent?ze===ze.parent.left?ze.parent.left=Re:ze.parent.right=Re:this._root=Re,Re&&(Re.left=ze),ze.parent=Re},g.prototype.rotateRight=function(ze){var Re=ze.left;Re&&(ze.left=Re.right,Re.right&&(Re.right.parent=ze),Re.parent=ze.parent),ze.parent?ze===ze.parent.left?ze.parent.left=Re:ze.parent.right=Re:this._root=Re,Re&&(Re.right=ze),ze.parent=Re},g.prototype._splay=function(ze){for(;ze.parent;){var Re=ze.parent;Re.parent?Re.left===ze&&Re.parent.left===Re?(this.rotateRight(Re.parent),this.rotateRight(Re)):Re.right===ze&&Re.parent.right===Re?(this.rotateLeft(Re.parent),this.rotateLeft(Re)):Re.left===ze&&Re.parent.right===Re?(this.rotateRight(Re),this.rotateLeft(Re)):(this.rotateLeft(Re),this.rotateRight(Re)):Re.left===ze?this.rotateRight(Re):this.rotateLeft(Re)}},g.prototype.splay=function(ze){for(var Re,Ot,ir,kt,or;ze.parent;)(Ot=(Re=ze.parent).parent)&&Ot.parent?((ir=Ot.parent).left===Ot?ir.left=ze:ir.right=ze,ze.parent=ir):(ze.parent=null,this._root=ze),kt=ze.left,or=ze.right,ze===Re.left?(Ot&&(Ot.left===Re?(Re.right?(Ot.left=Re.right,Ot.left.parent=Ot):Ot.left=null,Re.right=Ot,Ot.parent=Re):(kt?(Ot.right=kt,kt.parent=Ot):Ot.right=null,ze.left=Ot,Ot.parent=ze)),or?(Re.left=or,or.parent=Re):Re.left=null,ze.right=Re,Re.parent=ze):(Ot&&(Ot.right===Re?(Re.left?(Ot.right=Re.left,Ot.right.parent=Ot):Ot.right=null,Re.left=Ot,Ot.parent=Re):(or?(Ot.left=or,or.parent=Ot):Ot.left=null,ze.right=Ot,Ot.parent=ze)),kt?(Re.right=kt,kt.parent=Re):Re.right=null,ze.left=Re,Re.parent=ze)},g.prototype.replace=function(ze,Re){ze.parent?ze===ze.parent.left?ze.parent.left=Re:ze.parent.right=Re:this._root=Re,Re&&(Re.parent=ze.parent)},g.prototype.minNode=function(ze){if(ze===void 0&&(ze=this._root),ze)for(;ze.left;)ze=ze.left;return ze},g.prototype.maxNode=function(ze){if(ze===void 0&&(ze=this._root),ze)for(;ze.right;)ze=ze.right;return ze},g.prototype.insert=function(ze,Re){var Ot=this._root,ir=null,kt=this._compare;if(this._noDuplicates)for(;Ot;){if(ir=Ot,kt(Ot.key,ze)===0)return;Ot=kt(Ot.key,ze)<0?Ot.right:Ot.left}else for(;Ot;)ir=Ot,Ot=kt(Ot.key,ze)<0?Ot.right:Ot.left;return Ot={key:ze,data:Re,left:null,right:null,parent:ir},ir?kt(ir.key,Ot.key)<0?ir.right=Ot:ir.left=Ot:this._root=Ot,this.splay(Ot),this._size++,Ot},g.prototype.find=function(ze){for(var Re=this._root,Ot=this._compare;Re;){var ir=Ot(Re.key,ze);if(ir<0)Re=Re.right;else{if(!(ir>0))return Re;Re=Re.left}}return null},g.prototype.contains=function(ze){for(var Re=this._root,Ot=this._compare;Re;){var ir=Ot(ze,Re.key);if(ir===0)return!0;Re=ir<0?Re.left:Re.right}return!1},g.prototype.remove=function(ze){var Re=this.find(ze);if(!Re)return!1;if(this.splay(Re),Re.left)if(Re.right){var Ot=this.minNode(Re.right);Ot.parent!==Re&&(this.replace(Ot,Ot.right),Ot.right=Re.right,Ot.right.parent=Ot),this.replace(Re,Ot),Ot.left=Re.left,Ot.left.parent=Ot}else this.replace(Re,Re.left);else this.replace(Re,Re.right);return this._size--,!0},g.prototype.removeNode=function(ze){if(!ze)return!1;if(this.splay(ze),ze.left)if(ze.right){var Re=this.minNode(ze.right);Re.parent!==ze&&(this.replace(Re,Re.right),Re.right=ze.right,Re.right.parent=Re),this.replace(ze,Re),Re.left=ze.left,Re.left.parent=Re}else this.replace(ze,ze.left);else this.replace(ze,ze.right);return this._size--,!0},g.prototype.erase=function(ze){var Re=this.find(ze);if(Re){this.splay(Re);var Ot=Re.left,ir=Re.right,kt=null;Ot&&(Ot.parent=null,kt=this.maxNode(Ot),this.splay(kt),this._root=kt),ir&&(Ot?kt.right=ir:this._root=ir,ir.parent=kt),this._size--}},g.prototype.pop=function(){var ze=this._root,Re=null;if(ze){for(;ze.left;)ze=ze.left;Re={key:ze.key,data:ze.data},this.remove(ze.key)}return Re},g.prototype.next=function(ze){var Re=ze;if(Re)if(Re.right)for(Re=Re.right;Re&&Re.left;)Re=Re.left;else for(Re=ze.parent;Re&&Re.right===ze;)ze=Re,Re=Re.parent;return Re},g.prototype.prev=function(ze){var Re=ze;if(Re)if(Re.left)for(Re=Re.left;Re&&Re.right;)Re=Re.right;else for(Re=ze.parent;Re&&Re.left===ze;)ze=Re,Re=Re.parent;return Re},g.prototype.forEach=function(ze){for(var Re=this._root,Ot=[],ir=!1,kt=0;!ir;)Re?(Ot.push(Re),Re=Re.left):Ot.length>0?(ze(Re=Ot.pop(),kt++),Re=Re.right):ir=!0;return this},g.prototype.range=function(ze,Re,Ot,ir){for(var kt=[],or=this._compare,jr=this._root;kt.length!==0||jr;)if(jr)kt.push(jr),jr=jr.left;else{if(or((jr=kt.pop()).key,Re)>0)break;if(or(jr.key,ze)>=0&&Ot.call(ir,jr))return this;jr=jr.right}return this},g.prototype.keys=function(){for(var ze=this._root,Re=[],Ot=[],ir=!1;!ir;)ze?(Re.push(ze),ze=ze.left):Re.length>0?(ze=Re.pop(),Ot.push(ze.key),ze=ze.right):ir=!0;return Ot},g.prototype.values=function(){for(var ze=this._root,Re=[],Ot=[],ir=!1;!ir;)ze?(Re.push(ze),ze=ze.left):Re.length>0?(ze=Re.pop(),Ot.push(ze.data),ze=ze.right):ir=!0;return Ot},g.prototype.at=function(ze){for(var Re=this._root,Ot=[],ir=!1,kt=0;!ir;)if(Re)Ot.push(Re),Re=Re.left;else if(Ot.length>0){if(Re=Ot.pop(),kt===ze)return Re;kt++,Re=Re.right}else ir=!0;return null},g.prototype.load=function(ze,Re,Ot){if(ze===void 0&&(ze=[]),Re===void 0&&(Re=[]),Ot===void 0&&(Ot=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var ir=ze.length;return Ot&&C(ze,Re,0,ir-1,this._compare),this._root=w(null,ze,Re,0,ir),this._size=ir,this},g.prototype.min=function(){var ze=this.minNode(this._root);return ze?ze.key:null},g.prototype.max=function(){var ze=this.maxNode(this._root);return ze?ze.key:null},g.prototype.isEmpty=function(){return this._root===null},x.size.get=function(){return this._size},g.createTree=function(ze,Re,Ot,ir,kt){return new g(Ot,kt).load(ze,Re,ir)},Object.defineProperties(g.prototype,x);var N=0,D=1,U=2,q=3,H=0,Y=1,J=2,oe=3;function ce(ze,Re,Ot){Re===null?(ze.inOut=!1,ze.otherInOut=!0):(ze.isSubject===Re.isSubject?(ze.inOut=!Re.inOut,ze.otherInOut=Re.otherInOut):(ze.inOut=!Re.otherInOut,ze.otherInOut=Re.isVertical()?!Re.inOut:Re.inOut),Re&&(ze.prevInResult=!he(Re,Ot)||Re.isVertical()?Re.prevInResult:Re));var ir=he(ze,Ot);ze.resultTransition=ir?function(kt,or){var jr,Tr=!kt.inOut,cn=!kt.otherInOut;switch(or){case H:jr=Tr&&cn;break;case Y:jr=Tr||cn;break;case oe:jr=Tr^cn;break;case J:jr=kt.isSubject?Tr&&!cn:cn&&!Tr}return jr?1:-1}(ze,Ot):0}function he(ze,Re){switch(ze.type){case N:switch(Re){case H:return!ze.otherInOut;case Y:return ze.otherInOut;case J:return ze.isSubject&&ze.otherInOut||!ze.isSubject&&!ze.otherInOut;case oe:return!0}break;case U:return Re===H||Re===Y;case q:return Re===J;case D:return!1}return!1}var Se=function(ze,Re,Ot,ir,kt){this.left=Re,this.point=ze,this.otherEvent=Ot,this.isSubject=ir,this.type=kt||N,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},Te={inResult:{configurable:!0}};function ke(ze,Re){return ze[0]===Re[0]&&ze[1]===Re[1]}Se.prototype.isBelow=function(ze){var Re=this.point,Ot=this.otherEvent.point;return this.left?(Re[0]-ze[0])*(Ot[1]-ze[1])-(Ot[0]-ze[0])*(Re[1]-ze[1])>0:(Ot[0]-ze[0])*(Re[1]-ze[1])-(Re[0]-ze[0])*(Ot[1]-ze[1])>0},Se.prototype.isAbove=function(ze){return!this.isBelow(ze)},Se.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},Te.inResult.get=function(){return this.resultTransition!==0},Se.prototype.clone=function(){var ze=new Se(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ze.contourId=this.contourId,ze.resultTransition=this.resultTransition,ze.prevInResult=this.prevInResult,ze.isExteriorRing=this.isExteriorRing,ze.inOut=this.inOut,ze.otherInOut=this.otherInOut,ze},Object.defineProperties(Se.prototype,Te);var qe=11102230246251565e-32,Fe=134217729,Xe=(3+8*qe)*qe;function et(ze,Re,Ot,ir,kt){var or,jr,Tr,cn,qr=Re[0],Sr=ir[0],Jn=0,Ai=0;Sr>qr==Sr>-qr?(or=qr,qr=Re[++Jn]):(or=Sr,Sr=ir[++Ai]);var Wr=0;if(Jn<ze&&Ai<Ot)for(Sr>qr==Sr>-qr?(Tr=or-((jr=qr+or)-qr),qr=Re[++Jn]):(Tr=or-((jr=Sr+or)-Sr),Sr=ir[++Ai]),or=jr,Tr!==0&&(kt[Wr++]=Tr);Jn<ze&&Ai<Ot;)Sr>qr==Sr>-qr?(Tr=or-((jr=or+qr)-(cn=jr-or))+(qr-cn),qr=Re[++Jn]):(Tr=or-((jr=or+Sr)-(cn=jr-or))+(Sr-cn),Sr=ir[++Ai]),or=jr,Tr!==0&&(kt[Wr++]=Tr);for(;Jn<ze;)Tr=or-((jr=or+qr)-(cn=jr-or))+(qr-cn),qr=Re[++Jn],or=jr,Tr!==0&&(kt[Wr++]=Tr);for(;Ai<Ot;)Tr=or-((jr=or+Sr)-(cn=jr-or))+(Sr-cn),Sr=ir[++Ai],or=jr,Tr!==0&&(kt[Wr++]=Tr);return or===0&&Wr!==0||(kt[Wr++]=or),Wr}function it(ze){return new Float64Array(ze)}var At=33306690738754716e-32,pt=22204460492503146e-32,jt=11093356479670487e-47,Rt=it(4),zt=it(8),Yt=it(12),qt=it(16),Dt=it(4);function Vt(ze,Re,Ot){var ir=function(kt,or,jr,Tr,cn,qr){var Sr=(or-qr)*(jr-cn),Jn=(kt-cn)*(Tr-qr),Ai=Sr-Jn;if(Sr===0||Jn===0||Sr>0!=Jn>0)return Ai;var Wr=Math.abs(Sr+Jn);return Math.abs(Ai)>=At*Wr?Ai:-function(Bn,Ci,fi,_s,es,Bi,xi){var ni,un,ii,$i,Hr,Hn,ts,As,Ls,na,rs,Ys,Il,Js,rc,Eo,su,Rl,nc=Bn-es,To=fi-es,ic=Ci-Bi,au=_s-Bi;Rt[0]=(rc=(As=nc-(ts=(Hn=Fe*nc)-(Hn-nc)))*(na=au-(Ls=(Hn=Fe*au)-(Hn-au)))-((Js=nc*au)-ts*Ls-As*Ls-ts*na))-((rs=rc-(su=(As=ic-(ts=(Hn=Fe*ic)-(Hn-ic)))*(na=To-(Ls=(Hn=Fe*To)-(Hn-To)))-((Eo=ic*To)-ts*Ls-As*Ls-ts*na)))+(Hr=rc-rs))+(Hr-su),Rt[1]=(Il=Js-((Ys=Js+rs)-(Hr=Ys-Js))+(rs-Hr))-((rs=Il-Eo)+(Hr=Il-rs))+(Hr-Eo),Rt[2]=Ys-((Rl=Ys+rs)-(Hr=Rl-Ys))+(rs-Hr),Rt[3]=Rl;var Ya=function(cm,gh){for(var HC=gh[0],Px=1;Px<4;Px++)HC+=gh[Px];return HC}(0,Rt),ol=pt*xi;if(Ya>=ol||-Ya>=ol||(ni=Bn-(nc+(Hr=Bn-nc))+(Hr-es),ii=fi-(To+(Hr=fi-To))+(Hr-es),un=Ci-(ic+(Hr=Ci-ic))+(Hr-Bi),$i=_s-(au+(Hr=_s-au))+(Hr-Bi),ni===0&&un===0&&ii===0&&$i===0)||(ol=jt*xi+Xe*Math.abs(Ya),(Ya+=nc*$i+au*ni-(ic*ii+To*un))>=ol||-Ya>=ol))return Ya;Dt[0]=(rc=(As=ni-(ts=(Hn=Fe*ni)-(Hn-ni)))*(na=au-(Ls=(Hn=Fe*au)-(Hn-au)))-((Js=ni*au)-ts*Ls-As*Ls-ts*na))-((rs=rc-(su=(As=un-(ts=(Hn=Fe*un)-(Hn-un)))*(na=To-(Ls=(Hn=Fe*To)-(Hn-To)))-((Eo=un*To)-ts*Ls-As*Ls-ts*na)))+(Hr=rc-rs))+(Hr-su),Dt[1]=(Il=Js-((Ys=Js+rs)-(Hr=Ys-Js))+(rs-Hr))-((rs=Il-Eo)+(Hr=Il-rs))+(Hr-Eo),Dt[2]=Ys-((Rl=Ys+rs)-(Hr=Rl-Ys))+(rs-Hr),Dt[3]=Rl;var mh=et(4,Rt,4,Dt,zt);Dt[0]=(rc=(As=nc-(ts=(Hn=Fe*nc)-(Hn-nc)))*(na=$i-(Ls=(Hn=Fe*$i)-(Hn-$i)))-((Js=nc*$i)-ts*Ls-As*Ls-ts*na))-((rs=rc-(su=(As=ic-(ts=(Hn=Fe*ic)-(Hn-ic)))*(na=ii-(Ls=(Hn=Fe*ii)-(Hn-ii)))-((Eo=ic*ii)-ts*Ls-As*Ls-ts*na)))+(Hr=rc-rs))+(Hr-su),Dt[1]=(Il=Js-((Ys=Js+rs)-(Hr=Ys-Js))+(rs-Hr))-((rs=Il-Eo)+(Hr=Il-rs))+(Hr-Eo),Dt[2]=Ys-((Rl=Ys+rs)-(Hr=Rl-Ys))+(rs-Hr),Dt[3]=Rl;var lm=et(mh,zt,4,Dt,Yt);Dt[0]=(rc=(As=ni-(ts=(Hn=Fe*ni)-(Hn-ni)))*(na=$i-(Ls=(Hn=Fe*$i)-(Hn-$i)))-((Js=ni*$i)-ts*Ls-As*Ls-ts*na))-((rs=rc-(su=(As=un-(ts=(Hn=Fe*un)-(Hn-un)))*(na=ii-(Ls=(Hn=Fe*ii)-(Hn-ii)))-((Eo=un*ii)-ts*Ls-As*Ls-ts*na)))+(Hr=rc-rs))+(Hr-su),Dt[1]=(Il=Js-((Ys=Js+rs)-(Hr=Ys-Js))+(rs-Hr))-((rs=Il-Eo)+(Hr=Il-rs))+(Hr-Eo),Dt[2]=Ys-((Rl=Ys+rs)-(Hr=Rl-Ys))+(rs-Hr),Dt[3]=Rl;var jx=et(lm,Yt,4,Dt,qt);return qt[jx-1]}(kt,or,jr,Tr,cn,qr,Wr)}(ze[0],ze[1],Re[0],Re[1],Ot[0],Ot[1]);return ir>0?-1:ir<0?1:0}function St(ze,Re){var Ot=ze.point,ir=Re.point;return Ot[0]>ir[0]?1:Ot[0]<ir[0]?-1:Ot[1]!==ir[1]?Ot[1]>ir[1]?1:-1:function(kt,or,jr,Tr){return kt.left!==or.left?kt.left?1:-1:Vt(jr,kt.otherEvent.point,or.otherEvent.point)!==0?kt.isBelow(or.otherEvent.point)?-1:1:!kt.isSubject&&or.isSubject?1:-1}(ze,Re,Ot)}function xt(ze,Re,Ot){var ir=new Se(Re,!1,ze,ze.isSubject),kt=new Se(Re,!0,ze.otherEvent,ze.isSubject);return ke(ze.point,ze.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ze),ir.contourId=kt.contourId=ze.contourId,St(kt,ze.otherEvent)>0&&(ze.otherEvent.left=!0,kt.left=!1),ze.otherEvent.otherEvent=kt,ze.otherEvent=ir,Ot.push(kt),Ot.push(ir),Ot}function $t(ze,Re){return ze[0]*Re[1]-ze[1]*Re[0]}function Kt(ze,Re){return ze[0]*Re[0]+ze[1]*Re[1]}function Ft(ze,Re,Ot){var ir=function(cn,qr,Sr,Jn,Ai){var Wr=[qr[0]-cn[0],qr[1]-cn[1]],Bn=[Jn[0]-Sr[0],Jn[1]-Sr[1]];function Ci(Hn,ts,As){return[Hn[0]+ts*As[0],Hn[1]+ts*As[1]]}var fi=[Sr[0]-cn[0],Sr[1]-cn[1]],_s=$t(Wr,Bn),es=_s*_s,Bi=Kt(Wr,Wr);if(es>0){var xi=$t(fi,Bn)/_s;if(xi<0||xi>1)return null;var ni=$t(fi,Wr)/_s;return ni<0||ni>1?null:xi===0||xi===1?[Ci(cn,xi,Wr)]:ni===0||ni===1?[Ci(Sr,ni,Bn)]:[Ci(cn,xi,Wr)]}if((es=(_s=$t(fi,Wr))*_s)>0)return null;var un=Kt(Wr,fi)/Bi,ii=un+Kt(Wr,Bn)/Bi,$i=Math.min(un,ii),Hr=Math.max(un,ii);return $i<=1&&Hr>=0?$i===1?[Ci(cn,$i>0?$i:0,Wr)]:Hr===0?[Ci(cn,Hr<1?Hr:1,Wr)]:[Ci(cn,$i>0?$i:0,Wr),Ci(cn,Hr<1?Hr:1,Wr)]:null}(ze.point,ze.otherEvent.point,Re.point,Re.otherEvent.point),kt=ir?ir.length:0;if(kt===0||kt===1&&(ke(ze.point,Re.point)||ke(ze.otherEvent.point,Re.otherEvent.point))||kt===2&&ze.isSubject===Re.isSubject)return 0;if(kt===1)return ke(ze.point,ir[0])||ke(ze.otherEvent.point,ir[0])||xt(ze,ir[0],Ot),ke(Re.point,ir[0])||ke(Re.otherEvent.point,ir[0])||xt(Re,ir[0],Ot),1;var or=[],jr=!1,Tr=!1;return ke(ze.point,Re.point)?jr=!0:St(ze,Re)===1?or.push(Re,ze):or.push(ze,Re),ke(ze.otherEvent.point,Re.otherEvent.point)?Tr=!0:St(ze.otherEvent,Re.otherEvent)===1?or.push(Re.otherEvent,ze.otherEvent):or.push(ze.otherEvent,Re.otherEvent),jr&&Tr||jr?(Re.type=D,ze.type=Re.inOut===ze.inOut?U:q,jr&&!Tr&&xt(or[1].otherEvent,or[0].point,Ot),2):Tr?(xt(or[0],or[1].point,Ot),3):or[0]!==or[3].otherEvent?(xt(or[0],or[1].point,Ot),xt(or[1],or[2].point,Ot),3):(xt(or[0],or[1].point,Ot),xt(or[3].otherEvent,or[2].point,Ot),3)}function gr(ze,Re){if(ze===Re)return 0;if(Vt(ze.point,ze.otherEvent.point,Re.point)!==0||Vt(ze.point,ze.otherEvent.point,Re.otherEvent.point)!==0)return ke(ze.point,Re.point)?ze.isBelow(Re.otherEvent.point)?-1:1:ze.point[0]===Re.point[0]?ze.point[1]<Re.point[1]?-1:1:St(ze,Re)===1?Re.isAbove(ze.point)?-1:1:ze.isBelow(Re.point)?-1:1;if(ze.isSubject!==Re.isSubject)return ze.isSubject?-1:1;var Ot=ze.point,ir=Re.point;return Ot[0]===ir[0]&&Ot[1]===ir[1]?(Ot=ze.otherEvent.point)[0]===(ir=Re.otherEvent.point)[0]&&Ot[1]===ir[1]?0:ze.contourId>Re.contourId?1:-1:St(ze,Re)===1?1:-1}var br=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function hr(ze,Re,Ot,ir){var kt,or=ze+1,jr=Re[ze].point,Tr=Re.length;for(or<Tr&&(kt=Re[or].point);or<Tr&&kt[0]===jr[0]&&kt[1]===jr[1];){if(!Ot[or])return or;++or<Tr&&(kt=Re[or].point)}for(or=ze-1;Ot[or]&&or>ir;)or--;return or}br.prototype.isExterior=function(){return this.holeOf==null};var ar=lr,en=lr;function lr(ze,Re){if(!(this instanceof lr))return new lr(ze,Re);if(this.data=ze||[],this.length=this.data.length,this.compare=Re||Lr,this.length>0)for(var Ot=(this.length>>1)-1;Ot>=0;Ot--)this._down(Ot)}function Lr(ze,Re){return ze<Re?-1:ze>Re?1:0}lr.prototype={push:function(ze){this.data.push(ze),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ze=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ze}},peek:function(){return this.data[0]},_up:function(ze){for(var Re=this.data,Ot=this.compare,ir=Re[ze];ze>0;){var kt=ze-1>>1,or=Re[kt];if(Ot(ir,or)>=0)break;Re[ze]=or,ze=kt}Re[ze]=ir},_down:function(ze){for(var Re=this.data,Ot=this.compare,ir=this.length>>1,kt=Re[ze];ze<ir;){var or=1+(ze<<1),jr=or+1,Tr=Re[or];if(jr<this.length&&Ot(Re[jr],Tr)<0&&(or=jr,Tr=Re[jr]),Ot(Tr,kt)>=0)break;Re[ze]=Tr,ze=or}Re[ze]=kt}},ar.default=en;var rn=Math.max,Sn=Math.min,qn=0;function on(ze,Re,Ot,ir,kt,or){var jr,Tr,cn,qr,Sr,Jn;for(jr=0,Tr=ze.length-1;jr<Tr;jr++)if(qr=ze[jr+1],Sr=new Se(cn=ze[jr],!1,void 0,Re),Jn=new Se(qr,!1,Sr,Re),Sr.otherEvent=Jn,cn[0]!==qr[0]||cn[1]!==qr[1]){Sr.contourId=Jn.contourId=Ot,or||(Sr.isExteriorRing=!1,Jn.isExteriorRing=!1),St(Sr,Jn)>0?Jn.left=!0:Sr.left=!0;var Ai=cn[0],Wr=cn[1];kt[0]=Sn(kt[0],Ai),kt[1]=Sn(kt[1],Wr),kt[2]=rn(kt[2],Ai),kt[3]=rn(kt[3],Wr),ir.push(Sr),ir.push(Jn)}}var ti=[];function ri(ze,Re,Ot){typeof ze[0][0][0]=="number"&&(ze=[ze]),typeof Re[0][0][0]=="number"&&(Re=[Re]);var ir=function(Wr,Bn,Ci){var fi=null;return Wr.length*Bn.length==0&&(Ci===H?fi=ti:Ci===J?fi=Wr:Ci!==Y&&Ci!==oe||(fi=Wr.length===0?Bn:Wr)),fi}(ze,Re,Ot);if(ir)return ir===ti?null:ir;var kt=[1/0,1/0,-1/0,-1/0],or=[1/0,1/0,-1/0,-1/0],jr=function(Wr,Bn,Ci,fi,_s){var es,Bi,xi,ni,un,ii,$i=new ar(null,St);for(xi=0,ni=Wr.length;xi<ni;xi++)for(un=0,ii=(es=Wr[xi]).length;un<ii;un++)(Bi=un===0)&&qn++,on(es[un],!0,qn,$i,Ci,Bi);for(xi=0,ni=Bn.length;xi<ni;xi++)for(un=0,ii=(es=Bn[xi]).length;un<ii;un++)Bi=un===0,_s===J&&(Bi=!1),Bi&&qn++,on(es[un],!1,qn,$i,fi,Bi);return $i}(ze,Re,kt,or,Ot);if(ir=function(Wr,Bn,Ci,fi,_s){var es=null;return(Ci[0]>fi[2]||fi[0]>Ci[2]||Ci[1]>fi[3]||fi[1]>Ci[3])&&(_s===H?es=ti:_s===J?es=Wr:_s!==Y&&_s!==oe||(es=Wr.concat(Bn))),es}(ze,Re,kt,or,Ot))return ir===ti?null:ir;for(var Tr=function(Wr){var Bn,Ci,fi=function(xi){var ni,un,ii,$i,Hr=[];for(un=0,ii=xi.length;un<ii;un++)((ni=xi[un]).left&&ni.inResult||!ni.left&&ni.otherEvent.inResult)&&Hr.push(ni);for(var Hn=!1;!Hn;)for(Hn=!0,un=0,ii=Hr.length;un<ii;un++)un+1<ii&&St(Hr[un],Hr[un+1])===1&&($i=Hr[un],Hr[un]=Hr[un+1],Hr[un+1]=$i,Hn=!1);for(un=0,ii=Hr.length;un<ii;un++)(ni=Hr[un]).otherPos=un;for(un=0,ii=Hr.length;un<ii;un++)(ni=Hr[un]).left||($i=ni.otherPos,ni.otherPos=ni.otherEvent.otherPos,ni.otherEvent.otherPos=$i);return Hr}(Wr),_s={},es=[],Bi=function(){if(!_s[Bn]){var xi=es.length,ni=function(Hr,Hn,ts){var As=new br;if(Hr.prevInResult!=null){var Ls=Hr.prevInResult,na=Ls.outputContourId;if(Ls.resultTransition>0){var rs=Hn[na];if(rs.holeOf!=null){var Ys=rs.holeOf;Hn[Ys].holeIds.push(ts),As.holeOf=Ys,As.depth=Hn[na].depth}else Hn[na].holeIds.push(ts),As.holeOf=na,As.depth=Hn[na].depth+1}else As.holeOf=null,As.depth=Hn[na].depth}else As.holeOf=null,As.depth=0;return As}(fi[Bn],es,xi),un=function(Hr){_s[Hr]=!0,Hr<fi.length&&fi[Hr]&&(fi[Hr].outputContourId=xi)},ii=Bn,$i=Bn;for(ni.points.push(fi[Bn].point);un(ii),un(ii=fi[ii].otherPos),ni.points.push(fi[ii].point),!((ii=hr(ii,fi,_s,$i))==$i||ii>=fi.length)&&fi[ii];);es.push(ni)}};for(Bn=0,Ci=fi.length;Bn<Ci;Bn++)Bi();return es}(function(Wr,Bn,Ci,fi,_s,es){for(var Bi,xi,ni,un=new g(gr),ii=[],$i=Math.min(fi[2],_s[2]);Wr.length!==0;){var Hr=Wr.pop();if(ii.push(Hr),es===H&&Hr.point[0]>$i||es===J&&Hr.point[0]>fi[2])break;if(Hr.left){xi=Bi=un.insert(Hr),Bi=Bi!==(ni=un.minNode())?un.prev(Bi):null,xi=un.next(xi);var Hn=Bi?Bi.key:null;if(ce(Hr,Hn,es),xi&&Ft(Hr,xi.key,Wr)===2&&(ce(Hr,Hn,es),ce(xi.key,Hr,es)),Bi&&Ft(Bi.key,Hr,Wr)===2){var ts=Bi;ce(Hn,(ts=ts!==ni?un.prev(ts):null)?ts.key:null,es),ce(Hr,Hn,es)}}else xi=Bi=un.find(Hr=Hr.otherEvent),Bi&&xi&&(Bi=Bi!==ni?un.prev(Bi):null,xi=un.next(xi),un.remove(Hr),xi&&Bi&&Ft(Bi.key,xi.key,Wr))}return ii}(jr,0,0,kt,or,Ot)),cn=[],qr=0;qr<Tr.length;qr++){var Sr=Tr[qr];if(Sr.isExterior()){for(var Jn=[Sr.points],Ai=0;Ai<Sr.holeIds.length;Ai++)Jn.push(Tr[Sr.holeIds[Ai]].points);cn.push(Jn)}}return cn}var cs={UNION:Y,DIFFERENCE:J,INTERSECTION:H,XOR:oe};c.diff=function(ze,Re){return ri(ze,Re,J)},c.intersection=function(ze,Re){return ri(ze,Re,H)},c.operations=cs,c.union=function(ze,Re){return ri(ze,Re,Y)},c.xor=function(ze,Re){return ri(ze,Re,oe)},Object.defineProperty(c,"__esModule",{value:!0})})(a)}(0,ZU.exports)),ZU.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function nC(u,a,c,p){const g=[],x=p===0?(w,C,N,D,U,q)=>{w.push(new st(q,N+(q-C)/(D-C)*(U-N)))}:(w,C,N,D,U,q)=>{w.push(new st(C+(q-N)/(U-N)*(D-C),q))};for(const w of u){const C=[];for(const N of w){if(N.length<=2)continue;const D=[];for(let H=0;H<N.length-1;H++){const Y=N[H].x,J=N[H].y,oe=N[H+1].x,ce=N[H+1].y,he=p===0?Y:J,Se=p===0?oe:ce;he<a?Se>a&&x(D,Y,J,oe,ce,a):he>c?Se<c&&x(D,Y,J,oe,ce,c):D.push(N[H]),Se<a&&he>=a&&x(D,Y,J,oe,ce,a),Se>c&&he<=c&&x(D,Y,J,oe,ce,c)}let U=N[N.length-1];const q=p===0?U.x:U.y;q>=a&&q<=c&&D.push(U),D.length&&(U=D[D.length-1],D[0].x===U.x&&D[0].y===U.y||D.push(D[0]),C.push(D))}C.length&&g.push(C)}return g}function Nhe(u,a){const c=BR(u),p=BR([a]),g=XU.intersection(c,p);return g==null?[]:YU(g)}function Ihe(u,a){let p=BR(u,65536);const g=[];for(;a.valid();a.next()){const[x,w]=a.get(),C=x.x*65536,N=x.y*65536,D=w.x*65536,U=w.y*65536,q=D-C,H=U-N,Y=Math.hypot(q,H);if(Y===0)continue;const J=Math.trunc(H/Y*3),oe=-Math.trunc(q/Y*3);g.push([[[C,N],[D,U],[D+J,U+oe],[C+J,N+oe],[C,N]]])}return g.length>0&&(p=XU.diff(p,g)),YU(p,1/65536)}function BR(u,a=1){return[u.map(c=>c.map(p=>[p.x*a,p.y*a]))]}function YU(u,a=1){return u.map(c=>c.map((p,g)=>{const x=p.map(w=>new st(w[0]*a,w[1]*a).round());return g>0&&x.reverse(),x}))}class $R{constructor(a,c){this.layoutVertexArray=new yl,this.indexArray=new is,this.lineIndexArray=new Oc,this.triangleSegments=new ds,this.lineSegments=new ds,this.programConfigurations=new nu(a.layers,{zoom:a.zoom,lut:a.lut}),this.uploaded=!1,c&&(this.elevatedLayoutVertexArray=new md)}update(a,c,p,g,x,w,C,N){this.programConfigurations.updatePaintArrays(a,c,x,p,g,w,C,N)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,yhe.members),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.lineIndexBuffer=a.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=a.createVertexBuffer(this.elevatedLayoutVertexArray,vhe.members))),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(a,c,p,g,x,w,C){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,p,g,x,w,void 0,C)}}class UR{constructor(a){this.zoom=a.zoom,this.pixelRatio=a.pixelRatio,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=a.lut,this.bufferData=new $R(a,!1),this.elevationBufferData=new $R(a,!0),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.projection=a.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=a.sourceLayerIndex,this.worldview=a.worldview,this.hasAppearances=null}updateFootprints(a,c){}updateAppearances(a,c,p,g){}populate(a,c,p,g){this.hasPattern=FR("fill",this.layers,this.pixelRatio,c);const x=this.layers[0].layout.get("fill-sort-key"),w=[];for(const{feature:C,id:N,index:D,sourceLayerIndex:U}of a){const q=this.layers[0]._featureFilter.needGeometry,H=vt(C,q);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),H,p))continue;const Y=x?x.evaluate(H,{},p,c.availableImages):void 0,J={id:N,properties:C.properties,type:C.type,sourceLayerIndex:U,index:D,geometry:q?H.geometry:It(C,p,g),patterns:{},sortKey:Y};w.push(J)}x&&w.sort((C,N)=>C.sortKey-N.sortKey);for(const C of w){const{geometry:N,index:D,sourceLayerIndex:U}=C;if(this.hasPattern){const q=zR("fill",this.layers,C,this.zoom,this.pixelRatio,c);this.patternFeatures.push(q)}else this.addFeature(C,N,D,p,{},c.availableImages,c.brightness,c.elevationFeatures);c.featureIndex.insert(a[D].feature,N,D,U,this.index)}}update(a,c,p,g,x,w,C){this.bufferData.update(a,c,p,g,x,w,C,this.worldview),this.elevationBufferData.update(a,c,p,g,x,w,C,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(a,c,p,g,x,w,C,this.worldview)}addFeatures(a,c,p,g,x,w){for(const C of this.patternFeatures)this.addFeature(C,C.geometry,C.index,c,p,g,w,a.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(a){this.bufferData.upload(a),this.elevationBufferData.upload(a),this.elevatedStructures&&this.elevatedStructures.upload(a)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(a,c,p,g,x,w=[],C,N){const D=X1(c,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(a,D,g,p,N):this.addGeometry(D,this.bufferData),this.bufferData.populatePaintArrays(a,p,x,w,g,C,this.worldview),this.elevationBufferData.populatePaintArrays(a,p,x,w,g,C,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(a,c,p,g,x){this.elevatedStructures&&(this.elevatedStructures.construct(a),this.elevatedStructures.populatePaintArrays(c,p,g,x,this.worldview))}addElevatedRoadFeature(a,c,p,g,x){const w=new Array,C=Qr.getElevationFeature(a,x);if(!C)return void this.addGeometry(c,this.bufferData);{const D=this.clipPolygonsToTile(c,1);D.length>0&&w.push({polygons:D,elevationFeature:C,elevationTileID:p})}const N={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(a,{},p),featureIndex:g};for(const D of w)if(D.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new ec(D.elevationTileID,this.layers,this.zoom,this.lut));const q=D.elevationFeature.isTunnel();let H=0;a.properties.hasOwnProperty(mr)&&(H=+a.properties[mr]);for(const Y of D.polygons)this.elevatedStructures.addPortalCandidates(D.elevationFeature.id,Y,q,D.elevationFeature,H)}D.elevationFeature.constantHeight==null&&(D.polygons=this.prepareElevatedPolygons(D.polygons,D.elevationFeature,D.elevationTileID));const U=new Vn(p,D.elevationTileID);this.addElevatedGeometry(D.polygons,U,D.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,g,N)}}addElevatedGeometry(a,c,p,g,x,w){const C={elevation:p,elevationSampler:c,bias:g,index:x,featureInfo:w},[N,D]=this.addGeometry(a,this.elevationBufferData,C);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:N,max:D}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,N),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,D))}addGeometry(a,c,p){let g=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,w=null;p&&(w=p.elevationSampler.constantElevation(p.elevation,p.bias),w!=null&&(g=w,x=w));const C=(N,D,U)=>{if(p!=null)if(D.push(N),w!=null)c.elevatedLayoutVertexArray.emplaceBack(w),U.push(w);else{const q=p.elevationSampler.pointElevation(N,p.elevation,p.bias);c.elevatedLayoutVertexArray.emplaceBack(q),U.push(q),g=Math.min(g,q),x=Math.max(x,q)}};for(const N of a){let D=0;for(const Te of N)D+=Te.length;const U=c.triangleSegments.prepareSegment(D,c.layoutVertexArray,c.indexArray),q=U.vertexLength,H=[],Y=[],J=[],oe=[],ce=[],he=c.layoutVertexArray.length;for(const Te of N){if(Te.length===0)continue;Te!==N[0]&&Y.push(H.length/2);const ke=c.lineSegments.prepareSegment(Te.length,c.layoutVertexArray,c.lineIndexArray),qe=ke.vertexLength;p&&ce.push(c.layoutVertexArray.length-he),C(Te[0],J,oe),c.layoutVertexArray.emplaceBack(Te[0].x,Te[0].y),c.lineIndexArray.emplaceBack(qe+Te.length-1,qe),H.push(Te[0].x),H.push(Te[0].y);for(let Fe=1;Fe<Te.length;Fe++)C(Te[Fe],J,oe),c.layoutVertexArray.emplaceBack(Te[Fe].x,Te[Fe].y),c.lineIndexArray.emplaceBack(qe+Fe-1,qe+Fe),H.push(Te[Fe].x),H.push(Te[Fe].y);ke.vertexLength+=Te.length,ke.primitiveLength+=Te.length}const Se=cx(H,Y);for(let Te=0;Te<Se.length;Te+=3)c.indexArray.emplaceBack(q+Se[Te],q+Se[Te+1],q+Se[Te+2]);if(Se.length>0&&p&&this.elevationMode==="hd-road-base"){const Te=p.elevation.isTunnel(),ke=p.elevation.safeArea,qe=this.elevatedStructures.addVertices(J,oe);this.elevatedStructures.addTriangles(Se,qe,Te);const Fe=ce.length;if(Fe>0){for(let Xe=0;Xe<Fe-1;Xe++)this.elevatedStructures.addRenderableRing(p.index,ce[Xe]+qe,ce[Xe+1]-ce[Xe],Te,ke,p.featureInfo);this.elevatedStructures.addRenderableRing(p.index,ce[Fe-1]+qe,J.length-ce[Fe-1],Te,ke,p.featureInfo)}}U.vertexLength+=D,U.primitiveLength+=Se.length/3}return[g,x]}prepareElevatedPolygons(a,c,p){const g=1/Ke(p),x=[];for(const w of a){const C=Ihe(w,new Wi(c,g));x.push(...C)}return x}clipPolygonsToTile(a,c){const p=-c,g=-c,x=tr+c,w=tr+c;let C=0;const N=[],D=[];for(;C<a.length;C++){const H=a[C],Y=Yg(H);(Y.min.x>=p&&Y.max.x<=x&&Y.min.y>=g&&Y.max.y<=w?N:D).push(H)}if(N.length===a.length)return a;const U=[new st(p,g),new st(x,g),new st(x,w),new st(p,w),new st(p,g)],q=N;for(const H of D)q.push(...Nhe(H,U));return q}}let JU,QU,eV,tV;_r(UR,"FillBucket",{omit:["layers","patternFeatures"]}),_r($R,"FillBufferData"),_r(ec,"ElevatedStructures");class iC{constructor(a,c,p,g){if(this.triangleCount=c.length/3,this.min=new st(0,0),this.max=new st(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||a.length===0)return;const[x,w]=[a[0].clone(),a[0].clone()];for(let q=1;q<a.length;++q){const H=a[q];x.x=Math.min(x.x,H.x),x.y=Math.min(x.y,H.y),w.x=Math.max(w.x,H.x),w.y=Math.max(w.y,H.y)}if(g){const q=Math.ceil(Math.max(w.x-x.x,w.y-x.y)/g);p=Math.max(p,q)}if(p===0)return;this.min=x,this.max=w;const C=this.max.sub(this.min);C.x=Math.max(C.x,1),C.y=Math.max(C.y,1);const N=Math.max(C.x,C.y)/p;this.cellsX=Math.max(1,Math.ceil(C.x/N)),this.cellsY=Math.max(1,Math.ceil(C.y/N)),this.xScale=1/N,this.yScale=1/N;const D=[];for(let q=0;q<this.triangleCount;q++){const H=a[c[3*q+0]].sub(this.min),Y=a[c[3*q+1]].sub(this.min),J=a[c[3*q+2]].sub(this.min),oe=fh(Math.floor(Math.min(H.x,Y.x,J.x)),this.xScale,this.cellsX),ce=fh(Math.floor(Math.max(H.x,Y.x,J.x)),this.xScale,this.cellsX),he=fh(Math.floor(Math.min(H.y,Y.y,J.y)),this.yScale,this.cellsY),Se=fh(Math.floor(Math.max(H.y,Y.y,J.y)),this.yScale,this.cellsY),Te=new st(0,0),ke=new st(0,0),qe=new st(0,0),Fe=new st(0,0);for(let Xe=he;Xe<=Se;++Xe){Te.y=ke.y=Xe*N,qe.y=Fe.y=(Xe+1)*N;for(let et=oe;et<=ce;++et)Te.x=qe.x=et*N,ke.x=Fe.x=(et+1)*N,(Ds(H,Y,J,Te,ke,Fe)||Ds(H,Y,J,Te,Fe,qe))&&D.push({cellIdx:Xe*this.cellsX+et,triIdx:q})}}if(D.length===0)return;D.sort((q,H)=>q.cellIdx-H.cellIdx||q.triIdx-H.triIdx);let U=0;for(;U<D.length;){const q=D[U].cellIdx,H={start:this.payload.length,len:0};for(;U<D.length&&D[U].cellIdx===q;)++H.len,this.payload.push(D[U++].triIdx);this.cells[q]=H}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(a,c){if(this.triangleCount===0||this.cells.length===0||a.x>this.max.x||this.min.x>a.x||a.y>this.max.y||this.min.y>a.y)return;const p=fh(a.x-this.min.x,this.xScale,this.cellsX),g=fh(a.y-this.min.y,this.yScale,this.cellsY),x=this.cells[g*this.cellsX+p];if(x){this._lazyInitLookup();for(let w=0;w<x.len;w++){const C=this.payload[x.start+w],N=Math.floor(C/8),D=1<<C%8;if(!(this.lookup[N]&D)&&(this.lookup[N]|=D,c.push(C),c.length===this.triangleCount))return}}}query(a,c,p){if(this.triangleCount===0||this.cells.length===0||a.x>this.max.x||this.min.x>c.x||a.y>this.max.y||this.min.y>c.y)return;this._lazyInitLookup();const g=fh(a.x-this.min.x,this.xScale,this.cellsX),x=fh(c.x-this.min.x,this.xScale,this.cellsX),w=fh(a.y-this.min.y,this.yScale,this.cellsY),C=fh(c.y-this.min.y,this.yScale,this.cellsY);for(let N=w;N<=C;N++)for(let D=g;D<=x;D++){const U=this.cells[N*this.cellsX+D];if(U)for(let q=0;q<U.len;q++){const H=this.payload[U.start+q],Y=Math.floor(H/8),J=1<<H%8;if(!(this.lookup[Y]&J)&&(this.lookup[Y]|=J,p.push(H),p.length===this.triangleCount))return}}}}function fh(u,a,c){return Math.max(0,Math.min(c-1,Math.floor(u*a)))}_r(iC,"TriangleGridIndex");class rV{constructor(a){this.zoom=a.zoom,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.footprints=[],this.worldview=a.worldview,this.hasAppearances=null}updateFootprints(a,c){for(const p of this.footprints)c.push({footprint:p,id:a})}updateAppearances(a,c,p,g){}populate(a,c,p,g){const x=[];for(const{feature:w,id:C,index:N,sourceLayerIndex:D}of a){const U=this.layers[0]._featureFilter.needGeometry,q=vt(w,U);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),q,p))continue;const H={id:C,properties:w.properties,type:w.type,sourceLayerIndex:D,index:N,geometry:U?q.geometry:It(w,p,g),patterns:{}};x.push(H)}for(const w of x){const{geometry:C,index:N,sourceLayerIndex:D}=w;this.addFeature(w,C,N,p,{},c.availableImages,c.brightness),c.featureIndex.insert(a[N].feature,C,N,D,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(a){}update(a,c,p,g,x,w,C){}destroy(){}addFeature(a,c,p,g,x,w=[],C){for(const N of X1(c,2)){const D=[],U=[],q=[],H=new st(1/0,1/0),Y=new st(-1/0,-1/0);for(const ce of N)if(ce.length!==0){ce!==N[0]&&q.push(U.length/2);for(let he=0;he<ce.length;he++)U.push(ce[he].x),U.push(ce[he].y),D.push(ce[he]),H.x=Math.min(H.x,ce[he].x),H.y=Math.min(H.y,ce[he].y),Y.x=Math.max(Y.x,ce[he].x),Y.y=Math.max(Y.y,ce[he].y)}const J=cx(U,q),oe=new iC(D,J,8,256);this.footprints.push({vertices:D,indices:J,grid:oe,min:H,max:Y})}}}_r(rV,"ClipBucket",{omit:["layers"]});const Rhe=Cn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Mhe=Cn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Dhe=Cn([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),Lhe=Cn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Fhe=Cn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),zhe=Cn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Bhe=Cn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:$he}=Rhe,Y1=Number.MAX_SAFE_INTEGER,nV=Y1-1;function iV(u,a,c,p){return u.order<a||u.order===Y1||!(u.clipMask&c)||function(g,x){return x.length!==0&&x.find(w=>w===g)===void 0}(p,u.clipScope)}function sC(u,a){return u.x-a.x||u.y-a.y}function sV(u,a){return sC(u.min,a.min)===0&&sC(u.max,a.max)===0}function VR(u,a){return!(u.min.x>a.max.x||u.max.x<a.min.x||u.min.y>a.max.y||u.max.y<a.min.y)}function aC(u,a){if(u.length!==a.length)return!1;for(let c=0;c<u.length;c++)if(u[c].sourceId!==a[c].sourceId||!sV(u[c],a[c])||u[c].order!==a[c].order||u[c].clipMask!==a[c].clipMask||!yn(u[c].clipScope,a[c].clipScope))return!1;return!0}function aV(u,a,c){const p=1/tr,g=1/(1<<c.canonical.z),x=(a.x*p+c.canonical.x)*g+c.wrap,w=(a.y*p+c.canonical.y)*g;return{min:new st((u.x*p+c.canonical.x)*g+c.wrap,(u.y*p+c.canonical.y)*g),max:new st(x,w)}}function Uhe(u,a,c){const p=1<<c.canonical.z,g=((a.x-c.wrap)*p-c.canonical.x)*tr,x=(a.y*p-c.canonical.y)*tr;return{min:new st(((u.x-c.wrap)*p-c.canonical.x)*tr,(u.y*p-c.canonical.y)*tr),max:new st(g,x)}}function qR(u,a,c,p,g,x,w){const C=u.indices,N=u.vertices,D=[];for(let U=p;U<p+g;U+=3){const q=a[c[U+0]+x],H=a[c[U+1]+x],Y=a[c[U+2]+x],J=Math.min(q.x,H.x,Y.x),oe=Math.max(q.x,H.x,Y.x),ce=Math.min(q.y,H.y,Y.y),he=Math.max(q.y,H.y,Y.y);D.length=0,u.grid.query(new st(J,ce),new st(oe,he),D);for(let Se=0;Se<D.length;Se++){const Te=D[Se];if(Ds(N[C[3*Te+0]],N[C[3*Te+1]],N[C[3*Te+2]],q,H,Y,w))return!0}}return!1}function oV(u,a,c,p){if(!u||!c)return!1;let g=u.vertices;if(!a.canonical.equals(p.canonical)||a.wrap!==p.wrap){if(c.vertices.length<u.vertices.length)return oV(c,p,u,a);const x=a.canonical,w=p.canonical,C=Math.pow(2,w.z-x.z);g=u.vertices.map(N=>new st((N.x+x.x*tr)*C-w.x*tr,(N.y+x.y*tr)*C-w.y*tr))}return qR(c,g,u.indices,0,u.indices.length,0,0)}function lV(u,a,c,p){const g=Math.pow(2,p.z-c.z);return new st((u+c.x*tr)*g-p.x*tr,(a+c.y*tr)*g-p.y*tr)}function HR(u,a){const c=[];a.grid.queryPoint(u,c);const p=a.indices,g=a.vertices;for(let x=0;x<c.length;x++){const w=c[x];if(Ra([g[p[3*w+0]],g[p[3*w+1]],g[p[3*w+2]]],u))return!0}return!1}const GR=[new st(0,0),new st(tr,0),new st(tr,tr),new st(0,tr)];function cV(u,a){const c=[];let p=[];if(!a||u.length<2)return[u];if(u.length===2)return Is(u[0],u[1],GR)?[u]:[];for(let g=0;g<u.length+2;g++){const x=u[g%u.length],w=u[(g+1)%u.length],C=Is(g===0?u[u.length-1]:u[(g-1)%u.length],x,GR),N=Is(x,w,GR),D=C||N;D&&p.push(x),D&&N||p.length>0&&(p.length>1&&c.push(p),p=[])}return p.length>1&&c.push(p),c}const WR=Bt.types,Vhe=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],qhe=["fill-extrusion-flood-light-ground-radius"],Hhe=Math.pow(2,13),Ghe=Math.pow(2,15)-1,uV=new st(0,1),im=2147483648,dV=7,hV=450;function J1(u,a,c,p,g,x,w,C){u.emplaceBack((a<<1)+w,(c<<1)+x,(Math.floor(p*Hhe)<<1)+g,Math.round(C))}function Q1(u,a,c){u.emplaceBack(a.x*tr,a.y*tr,c?1:0)}function oC(u,a,c,p,g,x){u.emplaceBack(a.x,a.y,(c.x<<1)+p,(c.y<<1)+g,x)}function eS(u,a,c){u.emplaceBack(a.x,a.y,a.z,c[0]*16384,c[1]*16384,c[2]*16384)}class fV{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class pV{constructor(){this.centroidXY=new st(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new st(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new st(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new st(this.max.x-this.min.x,this.max.y-this.min.y)}}class mV{constructor(){this.acc=new st(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(a,c){a.min.x===Number.MAX_VALUE&&(a.min.x=a.max.x=c.x,a.min.y=a.max.y=c.y)}appendEdge(a,c,p){this.accCount++,this.acc._add(c);let g=!!this.borders;c.x<a.min.x?(a.min.x=c.x,g=!0):c.x>a.max.x&&(a.max.x=c.x,g=!0),c.y<a.min.y?(a.min.y=c.y,g=!0):c.y>a.max.y&&(a.max.y=c.y,g=!0),((c.x===0||c.x===tr)&&c.x===p.x)!=((c.y===0||c.y===tr)&&c.y===p.y)&&this.processBorderOverlap(c,p),g&&this.checkBorderIntersection(c,p)}checkBorderIntersection(a,c){c.x<0!=a.x<0&&this.addBorderIntersection(0,Kr(c.y,a.y,(0-c.x)/(a.x-c.x))),c.x>tr!=a.x>tr&&this.addBorderIntersection(1,Kr(c.y,a.y,(tr-c.x)/(a.x-c.x))),c.y<0!=a.y<0&&this.addBorderIntersection(2,Kr(c.x,a.x,(0-c.y)/(a.y-c.y))),c.y>tr!=a.y>tr&&this.addBorderIntersection(3,Kr(c.x,a.x,(tr-c.y)/(a.y-c.y)))}addBorderIntersection(a,c){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const p=this.borders[a];c<p[0]&&(p[0]=c),c>p[1]&&(p[1]=c)}processBorderOverlap(a,c){if(a.x===c.x){if(a.y===c.y)return;const p=a.x===0?0:1;this.addBorderIntersection(p,c.y),this.addBorderIntersection(p,a.y)}else{const p=a.y===0?2:3;this.addBorderIntersection(p,c.x),this.addBorderIntersection(p,a.x)}}centroid(){return this.accCount===0?new st(0,0):new st(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((a,c)=>a+ +(c[0]!==Number.MAX_VALUE),0):0}}function gV(u,a){const c=u.add(a)._unit(),p=ve(u.x*c.x+u.y*c.y,-1,1);var g,x,w;return g=Math.acos(p),Math.min(4,Math.max(-4,Math.tan(g)))/4*Ghe*((x=u).x*(w=a).y-x.y*w.x<0?-1:1)}const Whe=[u=>u.x<0,u=>u.x>tr,u=>u.y<0,u=>u.y>tr];function Khe(u,a,c,p){const g=[4];if(p===0)return g;c._mult(p);const x=u.sub(c),w=a.sub(c),C=[u,a,x,w];for(let N=0;N<4;N++)for(const D of C)if(Whe[N](D)){g.push(N);break}return g}class KR{constructor(a){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new K_,this.indexArray=new is,this.programConfigurations=new nu(a.layers,{zoom:a.zoom,lut:a.lut},c=>qhe.includes(c)),this._segments=new ds,this.hiddenByLandmarkVertexArray=new tx,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ds}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(a,c,p,g=!1){const x=a.length;if(x>2){let w=Math.max(0,this._segments.get().length-1);const C=this._segments._prepareSegment(4*x,this.vertexArray.length,2*this._segmentToGroundQuads[w].length);let N;w!==this._segments.get().length-1&&(w++,this._segmentToGroundQuads[w]=[],this._segmentToRegionTriCounts[w]=[0,0,0,0,0]);{const D=a[0],U=a[1];N=gV(D.sub(a[x-1])._perp()._unit(),U.sub(D)._perp()._unit())}for(let D=0;D<x;D++){const U=D===x-1?0:D+1,q=a[D],H=a[U],Y=a[U===x-1?0:U+1],J=H.sub(q)._perp()._unit(),oe=gV(J,Y.sub(H)._perp()._unit()),ce=N,he=oe;if(ZR(q,H,c)||g&&_V(q,c)&&_V(H,c)){N=oe;continue}const Se=C.vertexLength;oC(this.vertexArray,q,H,1,1,ce),oC(this.vertexArray,q,H,1,0,ce),oC(this.vertexArray,q,H,0,1,he),oC(this.vertexArray,q,H,0,0,he),C.vertexLength+=4;const Te=Khe(q,H,J,p);for(const ke of Te)this._segmentToGroundQuads[w].push({id:Se,region:ke}),this._segmentToRegionTriCounts[w][ke]+=2,C.primitiveLength+=2;N=oe}}}prepareBorderSegments(){if(!this.hasData())return;const a=this._segments.get(),c=a.length;for(let p=0;p<c;p++)this._segmentToGroundQuads[p].sort((g,x)=>g.region-x.region);for(let p=0;p<c;p++){const g=this._segmentToGroundQuads[p],x=a[p],w=this._segmentToRegionTriCounts[p];w.reduce((N,D)=>N+D,0);let C=0;for(let N=0;N<=4;N++){const D=w[N];if(D!==0){let U=this.regionSegments[N];U||(U=this.regionSegments[N]=new ds);const q={vertexOffset:x.vertexOffset,primitiveOffset:x.primitiveOffset+C,vertexLength:x.vertexLength,primitiveLength:D};U.get().push(q)}C+=D}for(let N=0;N<g.length;N++){const D=g[N].id;this.indexArray.emplaceBack(D,D+1,D+3),this.indexArray.emplaceBack(D,D+3,D+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(a,c,p,g,x,w,C){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,a,c,p,g,x,w,void 0,C)}upload(a){this.hasData()&&(this.vertexBuffer=a.createVertexBuffer(this.vertexArray,Mhe.members),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=a.createVertexBuffer(this.groundRadiusArray,Dhe.members)))}uploadPaintProperties(a){this.hasData()&&this.programConfigurations.upload(a)}update(a,c,p,g,x,w,C,N){this.hasData()&&this.programConfigurations.updatePaintArrays(a,c,p,g,x,w,C,N)}updateHiddenByLandmark(a){this.updateHiddenByLandmarkRange(a.groundVertexArrayOffset,a.groundVertexCount,!!(a.flags&im))}updateHiddenByLandmarkRange(a,c,p){if(!this.hasData())return;const g=c+a;if(c!==0){for(let x=a;x<g;++x)this.hiddenByLandmarkVertexArray.emplace(x,p?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(a){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=a.createVertexBuffer(this.hiddenByLandmarkVertexArray,zhe.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let a=0;a<=4;a++){const c=this.regionSegments[a];c&&c.destroy()}}}}class lC{constructor(a){this.zoom=a.zoom,this.canonical=a.canonical,this.overscaling=a.overscaling,this.layers=a.layers,this.pixelRatio=a.pixelRatio,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=a.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new is,this.footprintVertices=new yl,this.footprintSegments=[],this.layoutVertexArray=new Gp,this.centroidVertexArray=new VA,this.wallVertexArray=new HA,this.indexArray=new is,this.programConfigurations=new nu(a.layers,{zoom:a.zoom,lut:a.lut},c=>Vhe.includes(c)),this.segments=new ds,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.groundEffect=new KR(a),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=a.worldview,this.hasAppearances=null}updateFootprints(a,c){}updateAppearances(a,c,p,g){}populate(a,c,p,g){this.features=[],this.hasPattern=FR("fill-extrusion",this.layers,this.pixelRatio,c),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Ke(p),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:x,id:w,index:C,sourceLayerIndex:N}of a){const D=this.layers[0]._featureFilter.needGeometry,U=vt(x,D);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),U,p))continue;const q={id:w,sourceLayerIndex:N,index:C,geometry:D?U.geometry:It(x,p,g),properties:x.properties,type:x.type,patterns:{}},H=this.layoutVertexArray.length,Y=WR[q.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:x.id,feature:zR("fill-extrusion",this.layers,q,this.zoom,this.pixelRatio,c)});else if(this.wallMode)for(const J of q.geometry)for(const oe of cV(J,Y))this.addFeature(x.id,q,[oe],C,p,{},c.availableImages,g,c.brightness);else this.addFeature(x.id,q,q.geometry,C,p,{},c.availableImages,g,c.brightness);c.featureIndex.insert(x,q.geometry,C,N,this.index,H)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(a,c,p,g,x,w){for(const{featureId:C,feature:N}of this.features){const D=WR[N.type]==="Polygon",{geometry:U}=N;if(this.wallMode)for(const q of U)for(const H of cV(q,D))this.addFeature(C,N,[H],N.index,c,p,g,x,w);else this.addFeature(C,N,U,N.index,c,p,g,x,w)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(a,c,p,g,x,w,C){this.programConfigurations.updatePaintArrays(a,c,x,p,g,w,C,this.worldview),this.groundEffect.update(a,c,x,p,g,w,C,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,$he),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.wallVertexBuffer=a.createVertexBuffer(this.wallVertexArray,Fhe.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=a.createVertexBuffer(this.layoutVertexExtArray,Bhe.members,!0)),this.groundEffect.upload(a)),this.groundEffect.uploadPaintProperties(a),this.programConfigurations.upload(a),this.uploaded=!0}uploadCentroid(a){this.groundEffect.uploadHiddenByLandmark(a),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,Lhe.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,c,p,g,x,w,C,N,D){const U=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(c,{})/this.tileToMeter,q=[new st(0,0),new st(tr,tr)],H=N.projection,Y=H.name==="globe",J=this.wallMode||WR[c.type]==="Polygon",oe=new mV;oe.centroidDataIndex=this.centroidData.length;const ce=new pV;ce.buildingId=a,c.properties&&c.properties.hasOwnProperty("building_id")&&(ce.buildingId=c.properties.building_id);const he=this.layers[0].paint.get("fill-extrusion-base").evaluate(c,{},x)<=0,Se=this.layers[0].paint.get("fill-extrusion-height").evaluate(c,{},x);let Te;if(ce.height=Se,ce.vertexArrayOffset=this.layoutVertexArray.length,ce.groundVertexArrayOffset=this.groundEffect.vertexArray.length,Y&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new X_),this.wallMode){if(Y)return void zr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(p.length!==1)return;Te=function(pt){const jt=pt[0].x===pt[pt.length-1].x&&pt[0].y===pt[pt.length-1].y;(function(hr){let ar=0;const en=hr.length;for(let lr=0;lr<en;lr++)ar+=(hr[(lr+1)%en].x-hr[lr].x)*(hr[(lr+1)%en].y+hr[lr].y);return ar>=0})(pt)||(pt=pt.reverse());const zt={geometry:[],joinNormals:[],indices:[]},Yt=[],qt=[],Dt=[];let Vt=pt.length;for(;Vt>=2&&pt[Vt-1].equals(pt[Vt-2]);)Vt--;if(Vt<(jt?3:2))return zt;let St,xt,$t,Kt,Ft,gr=0;for(;gr<Vt-1&&pt[gr].equals(pt[gr+1]);)gr++;jt&&(St=pt[Vt-2],Ft=pt[gr].sub(St)._unit()._perp());for(let hr=gr;hr<Vt;hr++){if($t=hr===Vt-1?jt?pt[gr+1]:void 0:pt[hr+1],$t&&pt[hr].equals($t))continue;Ft&&(Kt=Ft),St&&(xt=St),St=pt[hr],Ft=$t?$t.sub(St)._unit()._perp():Kt,Kt=Kt||Ft;let ar=Kt.add(Ft);ar.x===0&&ar.y===0||ar._unit();const en=ar.x*Ft.x+ar.y*Ft.y,lr=en!==0?1/en:1/0,Lr=Kt.x*Ft.y-Kt.y*Ft.x>0;let rn="miter";const Sn=2;rn==="miter"&&lr>Sn&&(rn="bevel"),rn==="bevel"&&(lr>100&&(rn="flipbevel"),lr<Sn&&(rn="miter"));const qn=(on,ti,ri,cs)=>{const ze=new st(on.x,on.y),Re=new st(on.x,on.y);ze.x+=ti.x*cs,ze.y+=ti.y*cs,Re.x-=ti.x*Math.max(ri,1),Re.y-=ti.y*Math.max(ri,1),Dt.push(ti),Yt.push(ze),qt.push(Re)};if(rn==="miter")ar._mult(lr),qn(St,ar,0,0);else if(rn==="flipbevel")ar=Ft.mult(-1),qn(St,ar,0,0),qn(St,ar.mult(-1),0,0);else{const on=-Math.sqrt(lr*lr-1),ti=Lr?on:0,ri=Lr?0:on;xt&&qn(St,Kt,ti,ri),$t&&qn(St,Ft,ti,ri)}}zt.geometry=[...Yt,...qt.reverse(),Yt[0]],zt.joinNormals=[...Dt,...Dt.reverse(),Dt[Dt.length-1]];const br=zt.geometry.length-1;for(let hr=0;hr<br/2;hr++)if(hr+1<br/2){let ar=hr,en=hr+1,lr=br-1-hr,Lr=br-2-hr;ar=ar===0?br-1:ar-1,en=en===0?br-1:en-1,lr=lr===0?br-1:lr-1,Lr=Lr===0?br-1:Lr-1,zt.indices.push(lr),zt.indices.push(en),zt.indices.push(ar),zt.indices.push(lr),zt.indices.push(Lr),zt.indices.push(en)}return zt}(p[0]),p=[Te.geometry]}const ke=(pt,jt)=>pt<(jt.length-1)/2||pt===jt.length-1,qe=this.wallMode?[p]:X1(p,500);for(let pt=qe.length-1;pt>=0;pt--){const jt=qe[pt];(jt.length===0||(Fe=jt[0]).every(Rt=>Rt.x<=0)||Fe.every(Rt=>Rt.x>=tr)||Fe.every(Rt=>Rt.y<=0)||Fe.every(Rt=>Rt.y>=tr))&&qe.splice(pt,1)}var Fe;let Xe;if(Y)Xe=SV(qe,q,x);else{Xe=[];for(const pt of qe)Xe.push({polygon:pt,bounds:q})}const et=J?this.edgeRadius:0,it=et>0&&this.zoom<17,At=(pt,jt)=>{if(pt.length===0)return!1;const Rt=pt[pt.length-1];return jt.x===Rt.x&&jt.y===Rt.y};for(const{polygon:pt,bounds:jt}of Xe){let Rt=0,zt=0;for(const Vt of pt)J&&!Vt[0].equals(Vt[Vt.length-1])&&Vt.push(Vt[0]),zt+=J?Vt.length-1:Vt.length;const Yt=this.segments.prepareSegment((J?5:4)*zt,this.layoutVertexArray,this.indexArray);ce.footprintSegIdx<0&&(ce.footprintSegIdx=this.footprintSegments.length),ce.polygonSegIdx<0&&(ce.polygonSegIdx=this.polygonSegments.length);const qt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Dt=new fV;if(Dt.vertexOffset=this.footprintVertices.length,Dt.indexOffset=3*this.footprintIndices.length,Dt.ringIndices=[],J){const Vt=[],St=[];Rt=Yt.vertexLength;for(let $t=0;$t<pt.length;$t++){const Kt=pt[$t];Kt.length&&$t!==0&&St.push(Vt.length/2);const Ft=[];let gr,br;gr=Kt[1].sub(Kt[0])._perp()._unit(),Dt.ringIndices.push(Kt.length-1);for(let hr=1;hr<Kt.length;hr++){const ar=Kt[hr],en=Kt[hr===Kt.length-1?1:hr+1],lr=ar.clone();if(et){br=en.sub(ar)._perp()._unit();const Lr=gr.add(br)._unit(),rn=et*Math.min(4,1/(gr.x*Lr.x+gr.y*Lr.y));lr.x+=rn*Lr.x,lr.y+=rn*Lr.y,lr.x=Math.round(lr.x),lr.y=Math.round(lr.y),gr=br}if(!he||et!==0&&!it||At(Ft,lr)||Ft.push(lr),J1(this.layoutVertexArray,lr.x,lr.y,0,0,1,1,0),this.wallMode){const Lr=ke(hr,Kt);Q1(this.wallVertexArray,Te.joinNormals[hr],!Lr)}Yt.vertexLength++,this.footprintVertices.emplaceBack(ar.x,ar.y),Vt.push(ar.x,ar.y),Y&&eS(this.layoutVertexExtArray,H.projectTilePoint(lr.x,lr.y,x),H.upVector(x,lr.x,lr.y))}he&&(et===0||it)&&(Ft.length!==0&&At(Ft,Ft[0])&&Ft.pop(),this.groundEffect.addData(Ft,jt,U))}const xt=this.wallMode?Te.indices:cx(Vt,St);for(let $t=0;$t<xt.length;$t+=3)this.footprintIndices.emplaceBack(Dt.vertexOffset+xt[$t+0],Dt.vertexOffset+xt[$t+1],Dt.vertexOffset+xt[$t+2]),this.indexArray.emplaceBack(Rt+xt[$t],Rt+xt[$t+2],Rt+xt[$t+1]),Yt.primitiveLength++;Dt.indexCount+=xt.length,Dt.vertexCount+=this.footprintVertices.length-Dt.vertexOffset}for(let Vt=0;Vt<pt.length;Vt++){const St=pt[Vt];oe.startRing(ce,St[0]);let xt=St.length>4&&xV(St[St.length-2],St[0],St[1]),$t=et?Zhe(St[St.length-2],St[0],St[1],et):0;const Kt=[];let Ft,gr,br;gr=St[1].sub(St[0])._perp()._unit();let hr=!0;for(let ar=1,en=0;ar<St.length;ar++){let lr=St[ar-1],Lr=St[ar];const rn=St[ar===St.length-1?1:ar+1];if(oe.appendEdge(ce,Lr,lr),ZR(Lr,lr,jt)){et&&(gr=rn.sub(Lr)._perp()._unit(),hr=!hr);continue}const Sn=Lr.sub(lr)._perp(),qn=Sn.x/(Math.abs(Sn.x)+Math.abs(Sn.y)),on=Sn.y>0?1:0,ti=lr.dist(Lr);if(en+ti>32768&&(en=0),et){br=rn.sub(Lr)._perp()._unit();let Re=vV(lr,Lr,rn,yV(gr,br),et);isNaN(Re)&&(Re=0);const Ot=Lr.sub(lr)._unit();lr=lr.add(Ot.mult($t))._round(),Lr=Lr.add(Ot.mult(-Re))._round(),$t=Re,gr=br,he&&this.zoom>=17&&(At(Kt,lr)||Kt.push(lr),At(Kt,Lr)||Kt.push(Lr))}const ri=Yt.vertexLength,cs=St.length>4&&xV(lr,Lr,rn);let ze=bV(en,xt,hr);if(J1(this.layoutVertexArray,lr.x,lr.y,qn,on,0,0,ze),J1(this.layoutVertexArray,lr.x,lr.y,qn,on,0,1,ze),this.wallMode){const Re=ke(ar-1,St),Ot=Te.joinNormals[ar-1];Q1(this.wallVertexArray,Ot,Re),Q1(this.wallVertexArray,Ot,Re)}if(en+=ti,ze=bV(en,cs,!hr),xt=cs,J1(this.layoutVertexArray,Lr.x,Lr.y,qn,on,0,0,ze),J1(this.layoutVertexArray,Lr.x,Lr.y,qn,on,0,1,ze),this.wallMode){const Re=ke(ar,St),Ot=Te.joinNormals[ar];Q1(this.wallVertexArray,Ot,Re),Q1(this.wallVertexArray,Ot,Re)}if(Yt.vertexLength+=4,this.indexArray.emplaceBack(ri+0,ri+1,ri+2),this.indexArray.emplaceBack(ri+1,ri+3,ri+2),Yt.primitiveLength+=2,et){const Re=Rt+(ar===1?St.length-2:ar-2),Ot=ar===1?Rt:Re+1;if(this.indexArray.emplaceBack(ri+1,Re,ri+3),this.indexArray.emplaceBack(Re,Ot,ri+3),Yt.primitiveLength+=2,Ft===void 0&&(Ft=ri),!ZR(rn,St[ar],jt)){const ir=ar===St.length-1?Ft:Yt.vertexLength;this.indexArray.emplaceBack(ri+2,ri+3,ir),this.indexArray.emplaceBack(ri+3,ir+1,ir),this.indexArray.emplaceBack(ri+3,Ot,ir+1),Yt.primitiveLength+=3}hr=!hr}if(Y){const Re=this.layoutVertexExtArray,Ot=H.projectTilePoint(lr.x,lr.y,x),ir=H.projectTilePoint(Lr.x,Lr.y,x),kt=H.upVector(x,lr.x,lr.y),or=H.upVector(x,Lr.x,Lr.y);eS(Re,Ot,kt),eS(Re,Ot,kt),eS(Re,ir,or),eS(Re,ir,or)}}J&&(Rt+=St.length-1),he&&et&&this.zoom>=17&&(Kt.length!==0&&At(Kt,Kt[0])&&Kt.pop(),this.groundEffect.addData(Kt,jt,U,et>0))}this.footprintSegments.push(Dt),qt.triangleCount=this.indexArray.length-qt.triangleArrayOffset,this.polygonSegments.push(qt),++ce.footprintSegLen,++ce.polygonSegLen}if(ce.vertexCount=this.layoutVertexArray.length-ce.vertexArrayOffset,ce.groundVertexCount=this.groundEffect.vertexArray.length-ce.groundVertexArrayOffset,ce.vertexCount!==0){if(ce.centroidXY=oe.borders?uV:this.encodeCentroid(oe,ce),this.centroidData.push(ce),oe.borders){this.featuresOnBorder.push(oe);const pt=this.featuresOnBorder.length-1;for(let jt=0;jt<oe.borders.length;jt++)oe.borders[jt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[jt].push(pt)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,g,w,C,x,D,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(c,g,w,C,x,D,this.worldview),this.maxHeight=Math.max(this.maxHeight,Se)}}sortBorders(){for(let a=0;a<this.borderFeatureIndices.length;a++)this.borderFeatureIndices[a].sort((c,p)=>this.featuresOnBorder[c].borders[a][0]-this.featuresOnBorder[p].borders[a][0])}splitToSubtiles(){const a=[];for(let C=0;C<this.centroidData.length;C++){const N=this.centroidData[C],D=+(N.min.y+N.max.y>tr),U=2*D+(+(N.min.x+N.max.x>tr)^D);for(let q=0;q<N.polygonSegLen;q++){const H=N.polygonSegIdx+q;a.push({centroidIdx:C,subtile:U,polygonSegmentIdx:H,triangleSegmentIdx:this.polygonSegments[H].triangleSegIdx})}}const c=new is;a.sort((C,N)=>C.triangleSegmentIdx===N.triangleSegmentIdx?C.subtile-N.subtile:C.triangleSegmentIdx-N.triangleSegmentIdx);let p=0,g=0,x=0;for(const C of a){if(C.triangleSegmentIdx!==p)break;x++}const w=a.length;for(;g!==a.length;){p=a[g].triangleSegmentIdx;let C=0,N=g,D=g;for(let U=N;U<x&&a[U].subtile===C;U++)D++;for(;N!==x;){const U=a[N];C=U.subtile;const q=this.centroidData[U.centroidIdx].min.clone(),H=this.centroidData[U.centroidIdx].max.clone(),Y={vertexOffset:this.segments.segments[p].vertexOffset,primitiveOffset:c.length,vertexLength:this.segments.segments[p].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let J=N;J<D;J++){const oe=a[J],ce=this.polygonSegments[oe.polygonSegmentIdx],he=this.centroidData[oe.centroidIdx].min,Se=this.centroidData[oe.centroidIdx].max,Te=this.indexArray.uint16;for(let ke=ce.triangleArrayOffset;ke<ce.triangleArrayOffset+ce.triangleCount;ke++)c.emplaceBack(Te[3*ke],Te[3*ke+1],Te[3*ke+2]);Y.primitiveLength+=ce.triangleCount,q.x=Math.min(q.x,he.x),q.y=Math.min(q.y,he.y),H.x=Math.max(H.x,Se.x),H.y=Math.max(H.y,Se.y)}Y.primitiveLength>0&&this.triangleSubSegments.push({segment:Y,min:q,max:H}),N=D;for(let J=N;J<x&&a[J].subtile===a[N].subtile;J++)D++}g=x;for(let U=g;U<w&&a[U].triangleSegmentIdx===a[g].triangleSegmentIdx;U++)x++}c._trim(),this.indexArray=c}getVisibleSegments(a,c,p){const g=new ds;if(this.wallMode){for(const oe of this.triangleSubSegments)g.segments.push(oe.segment);return g}let x=0,w=0;const C=1<<a.canonical.z;if(c){const oe=c.getMinMaxForTile(a);oe&&(x=oe.min,w=oe.max)}w+=this.maxHeight;const N=a.toUnwrapped();let D;const U=[N.canonical.x/C+N.wrap,N.canonical.y/C],q=[(N.canonical.x+1)/C+N.wrap,(N.canonical.y+1)/C],H=(oe,ce,he)=>[oe[0]*(1-he[0])+ce[0]*he[0],oe[1]*(1-he[1])+ce[1]*he[1]],Y=[],J=[];for(const oe of this.triangleSubSegments){Y[0]=oe.min.x/tr,Y[1]=oe.min.y/tr,J[0]=oe.max.x/tr,J[1]=oe.max.y/tr;const ce=H(U,q,Y),he=H(U,q,J);if(new xn([ce[0],ce[1],x],[he[0],he[1],w]).intersectsPrecise(p)===0){D&&(g.segments.push(D),D=void 0);continue}const Se=oe.segment;D&&D.vertexOffset!==Se.vertexOffset&&(g.segments.push(D),D=void 0),D?(D.vertexLength+=Se.vertexLength,D.primitiveLength+=Se.primitiveLength):D={vertexOffset:Se.vertexOffset,primitiveLength:Se.primitiveLength,vertexLength:Se.vertexLength,primitiveOffset:Se.primitiveOffset,sortKey:void 0,vaos:{}}}return D&&g.segments.push(D),g}encodeCentroid(a,c){const p=a.centroid(),g=c.span(),x=Math.min(7,Math.round(g.x*this.tileToMeter/10)),w=Math.min(7,Math.round(g.y*this.tileToMeter/10));return new st(ve(p.x,1,tr-1)<<3|x,ve(p.y,1,tr-1)<<3|w)}encodeBorderCentroid(a){if(!a.borders)return new st(0,0);const c=a.borders,p=Number.MAX_VALUE;if(c[0][0]!==p||c[1][0]!==p){const g=c[0][0]!==p?0:1;return new st(6|(c[0][0]!==p?0:65528),(c[g][0]+c[g][1])/2<<3|6)}{const g=c[2][0]!==p?2:3;return new st((c[g][0]+c[g][1])/2<<3|6,6|(c[2][0]!==p?0:65528))}}showCentroid(a){const c=this.centroidData[a.centroidDataIndex];c.flags&=2147483647,c.centroidXY.x=0,c.centroidXY.y=0,this.writeCentroidToBuffer(c)}writeCentroidToBuffer(a){this.groundEffect.updateHiddenByLandmark(a);const c=a.vertexArrayOffset,p=a.vertexCount+a.vertexArrayOffset,g=a.flags&im?uV:a.centroidXY,x=this.centroidVertexArray.geta_centroid_pos0(c);if(this.centroidVertexArray.geta_centroid_pos1(c)!==g.y||x!==g.x){for(let w=c;w<p;++w)this.centroidVertexArray.emplace(w,g.x,g.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const a of this.centroidData)this.writeCentroidToBuffer(a)}updateReplacement(a,c,p){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const g=c.getReplacementRegionsForTile(a.toUnwrapped());if(aC(this.activeReplacements,g))return;if(this.activeReplacements=g,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const w of this.centroidData)w.flags&=2147483647;const x=[];for(const w of this.activeReplacements){if(w.order<p)continue;const C=Math.max(1,Math.pow(2,w.footprintTileId.canonical.z-a.canonical.z));if(w.footprint.buildingId){const N=w.footprint.buildingId;for(const D of this.centroidData)D.buildingId===N&&(D.flags|=im)}else for(const N of this.centroidData)if(!(N.flags&im||w.min.x>N.max.x||N.min.x>w.max.x||w.min.y>N.max.y||N.min.y>w.max.y))for(let D=0;D<N.footprintSegLen;D++){const U=this.footprintSegments[N.footprintSegIdx+D];if(x.length=0,Xhe(this.footprintVertices,U.vertexOffset,U.vertexCount,w.footprintTileId.canonical,a.canonical,x),qR(w.footprint,x,this.footprintIndices.uint16,U.indexOffset,U.indexCount,-U.vertexOffset,-C)){N.flags|=im;break}}}for(const w of this.centroidData)this.writeCentroidToBuffer(w);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(a,c,p){let g=!1;for(let x=0;x<p.footprintSegLen;x++){const w=this.footprintSegments[p.footprintSegIdx+x];let C=0;for(const N of w.ringIndices){for(let D=C,U=N+C-1;D<N+C;U=D++){const q=this.footprintVertices.int16[2*(D+w.vertexOffset)+0],H=this.footprintVertices.int16[2*(D+w.vertexOffset)+1],Y=this.footprintVertices.int16[2*(U+w.vertexOffset)+1];H>c!=Y>c&&a<(this.footprintVertices.int16[2*(U+w.vertexOffset)+0]-q)*(c-H)/(Y-H)+q&&(g=!g)}C=N}}return g}getHeightAtTileCoord(a,c){let p=Number.NEGATIVE_INFINITY,g=!0;const x=4*(a+tr)*tr+(c+tr);if(this.partLookup.hasOwnProperty(x)){const w=this.partLookup[x];return w?{height:w.height,hidden:!!(w.flags&im)}:void 0}for(const w of this.centroidData)a>w.max.x||w.min.x>a||c>w.max.y||w.min.y>c||w.height<=p||this.footprintContainsPoint(a,c,w)&&(p=w.height,this.partLookup[x]=w,g=!!(w.flags&im));if(p!==Number.NEGATIVE_INFINITY)return{height:p,hidden:g};this.partLookup[x]=void 0}}function yV(u,a){const c=u.add(a)._unit();return u.x*c.x+u.y*c.y}function Zhe(u,a,c,p){const g=a.sub(u)._perp()._unit(),x=c.sub(a)._perp()._unit();return vV(u,a,c,yV(g,x),p)}function vV(u,a,c,p,g){const x=Math.sqrt(1-p*p);return Math.min(u.dist(a)/3,a.dist(c)/3,g*x/p)}function ZR(u,a,c){return u.x<c[0].x&&a.x<c[0].x||u.x>c[1].x&&a.x>c[1].x||u.y<c[0].y&&a.y<c[0].y||u.y>c[1].y&&a.y>c[1].y}function _V(u,a){return u.x<a[0].x||u.x>a[1].x||u.y<a[0].y||u.y>a[1].y}function xV(u,a,c){if(u.x<0||u.x>=tr||a.x<0||a.x>=tr||c.x<0||c.x>=tr)return!1;const p=c.sub(a),g=p.perp(),x=u.sub(a);return(p.x*x.x+p.y*x.y)/Math.sqrt((p.x*p.x+p.y*p.y)*(x.x*x.x+x.y*x.y))>-.866&&g.x*x.x+g.y*x.y<0}function bV(u,a,c){const p=a?2|u:-3&u;return c?1|p:-2&p}function wV(){const u=Math.PI/32,a=Math.tan(u),c=G;return c*Math.sqrt(1+2*a*a)-c}function SV(u,a,c){const p=1<<c.z,g=Ne(c.x/p),x=Ne((c.x+1)/p),w=je(c.y/p),C=je((c.y+1)/p);return function(N,D,U,q,H=0,Y){const J=[];if(!N.length||!U||!q)return J;const oe=(Fe,Xe)=>{for(const et of Fe)J.push({polygon:et,bounds:Xe})},ce=Math.ceil(Math.log2(U)),he=Math.ceil(Math.log2(q)),Se=ce-he,Te=[];for(let Fe=0;Fe<Math.abs(Se);Fe++)Te.push(Se>0?0:1);for(let Fe=0;Fe<Math.min(ce,he);Fe++)Te.push(0),Te.push(1);let ke=N;if(ke=nC(ke,D[0].y-H,D[1].y+H,1),ke=nC(ke,D[0].x-H,D[1].x+H,0),!ke.length)return J;const qe=[];for(Te.length?qe.push({polygons:ke,bounds:D,depth:0}):oe(ke,D);qe.length;){const Fe=qe.pop(),Xe=Fe.depth,et=Te[Xe],it=Fe.bounds[0],At=Fe.bounds[1],pt=et===0?it.x:it.y,jt=et===0?At.x:At.y,Rt=Y?Y(et,pt,jt):.5*(pt+jt),zt=nC(Fe.polygons,pt-H,Rt+H,et),Yt=nC(Fe.polygons,Rt-H,jt+H,et);if(zt.length){const qt=[it,new st(et===0?Rt:At.x,et===1?Rt:At.y)];Te.length>Xe+1?qe.push({polygons:zt,bounds:qt,depth:Xe+1}):oe(zt,qt)}if(Yt.length){const qt=[new st(et===0?Rt:it.x,et===1?Rt:it.y),At];Te.length>Xe+1?qe.push({polygons:Yt,bounds:qt,depth:Xe+1}):oe(Yt,qt)}}return J}(u,a,Math.ceil((x-g)/11.25),Math.ceil((w-C)/11.25),1,(N,D,U)=>{if(N===0)return .5*(D+U);{const q=je((c.y+D/tr)/p);return(ye(.5*(je((c.y+U/tr)/p)+q))*p-c.y)*tr}})}function Xhe(u,a,c,p,g,x){const w=Math.pow(2,p.z-g.z);for(let C=0;C<c;C++){let N=u.int16[2*(C+a)+0],D=u.int16[2*(C+a)+1];N=(N+g.x*tr)*w-p.x*tr,D=(D+g.y*tr)*w-p.y*tr,x.push(new st(N,D))}}let EV,TV;_r(lC,"FillExtrusionBucket",{omit:["layers","features"]}),_r(pV,"PartData"),_r(fV,"FootprintSegment"),_r(mV,"BorderCentroidData"),_r(KR,"GroundEffect");class by extends st{constructor(a,c,p){super(a,c),this.z=p}}class AV extends by{constructor(a,c,p,g){super(a,c,p),this.w=g}}function CV(u,a,c,p){const g=c==="x"?"y":"x",x=(p-u[c])/(a[c]-u[c]);u[g]=Math.round(u[g]+(a[g]-u[g])*x),u[c]=p,u.hasOwnProperty("z")&&(u.z=Kr(u.z,a.z,x)),u.hasOwnProperty("w")&&(u.w=Kr(u.w,a.w,x))}function jV(u,a,c,p){const g=c,x=p;for(const w of["x","y"]){let C=u,N=a;C[w]>=N[w]&&(C=a,N=u),C[w]<g&&N[w]>g&&CV(C,N,w,g),C[w]<x&&N[w]>x&&CV(N,C,w,x)}}function cC(u,a,c,p,g,x){const w=[];for(let C=0;C<u.length;C++){const N=u[C];let D;const U=w.length;let q=0;for(let H=0;H<N.length-1;H++){let Y=N[H],J=N[H+1],oe=0;const ce=q;let he,Se;x&&(oe=Math.hypot(J.x-Y.x,J.y-Y.y),q+=oe,he=Y,Se=J),Y.x<a&&J.x<a||(Y.x<a?Y=new st(a,Y.y+(a-Y.x)/(J.x-Y.x)*(J.y-Y.y))._round():J.x<a&&(J=new st(a,Y.y+(a-Y.x)/(J.x-Y.x)*(J.y-Y.y))._round()),Y.y<c&&J.y<c||(Y.y<c?Y=new st(Y.x+(c-Y.y)/(J.y-Y.y)*(J.x-Y.x),c)._round():J.y<c&&(J=new st(Y.x+(c-Y.y)/(J.y-Y.y)*(J.x-Y.x),c)._round()),Y.x>=p&&J.x>=p||(Y.x>=p?Y=new st(p,Y.y+(p-Y.x)/(J.x-Y.x)*(J.y-Y.y))._round():J.x>=p&&(J=new st(p,Y.y+(p-Y.x)/(J.x-Y.x)*(J.y-Y.y))._round()),Y.y>=g&&J.y>=g||(Y.y>=g?Y=new st(Y.x+(g-Y.y)/(J.y-Y.y)*(J.x-Y.x),g)._round():J.y>=g&&(J=new st(Y.x+(g-Y.y)/(J.y-Y.y)*(J.x-Y.x),g)._round()),D&&Y.equals(D[D.length-1])||(D=[Y],w.push(D),x&&x.push({progress:{min:ce+PV(he,Se,Y)*oe,max:1},parentIndex:C,prevPoint:he,nextPoint:Se})),D.push(J),x&&(x[x.length-1].progress.max=ce+PV(he,Se,J)*oe,x[x.length-1].nextPoint=Se)))))}if(x&&q>0)for(let H=U;H<w.length;H++)x[H].progress.min/=q,x[H].progress.max/=q}return w}function Yhe(u,a,c,p,g){if(u.length<2)return void p.push(u);const x=[];for(;a.valid();){const[D,U]=a.get();for(let q=0;q<u.length-1;q++){const H=u[q],Y=u[q+1],J=Zl(H,Y,D,U);if(J){const[oe]=J,ce=new st(Kr(H.x,Y.x,oe),Kr(H.y,Y.y,oe));x.push({t:q+oe,distance:0,point:ce})}}a.next()}if(x.length===0)return void p.push(u);x.sort((D,U)=>D.t-U.t);let w=0,C=0,N=[];for(p.push(N);w!==u.length;){if(C===x.length){for(;w!==u.length;)N.length!==0&&N[N.length-1].equals(u[w])||N.push(u[w]),w++;break}x[C].t<=w?(N.length!==0&&N[N.length-1].equals(x[C].point)||N.push(x[C].point),Math.trunc(x[C].t),C++):(N.length!==0&&N[N.length-1].equals(u[w])||N.push(u[w]),w++)}}function PV(u,a,c){return u.x!==a.x?(c.x-u.x)/(a.x-u.x):u.y!==a.y?(c.y-u.y)/(a.y-u.y):0}function tS(u,a){return u.x*a.x+u.y*a.y}function OV(u,a){if(u.length===1){let c=0;const p=a[c++];let g;for(;!g||p.equals(g);)if(g=a[c++],!g)return 1/0;for(;c<a.length;c++){const x=a[c],w=u[0],C=g.sub(p),N=x.sub(p),D=w.sub(p),U=tS(C,C),q=tS(C,N),H=tS(N,N),Y=tS(D,C),J=tS(D,N),oe=U*H-q*q,ce=(H*Y-q*J)/oe,he=(U*J-q*Y)/oe,Se=p.z*(1-ce-he)+g.z*ce+x.z*he;if(isFinite(Se))return Se}return 1/0}{let c=1/0;for(const p of a)c=Math.min(c,p.z);return c}}function kV(u,a,c){let p=1/0;Ss(c,a)&&(p=OV(c,a[0]));for(let g=0;g<a.length;g++){const x=a[g],w=u[g];for(let C=0;C<x.length-1;C++){const N=x[C],D=[N,x[C+1],w[C+1],w[C],N];Ns(c,D)&&(p=Math.min(p,OV(c,D)))}}return p!==1/0&&p}function NV(u,a,c,p,g,x,w,C,N,D,U){return u.projection.name==="globe"?function(q,H,Y,J,oe,ce,he,Se,Te,ke,qe){const Fe=[],Xe=[],et=q.projection.upVectorScale(qe,q.center.lat,q.worldSize).metersToTile,it=[0,0,0,1],At=[0,0,0,1],pt=(Rt,zt,Yt,qt)=>{Rt[0]=zt,Rt[1]=Yt,Rt[2]=qt,Rt[3]=1},jt=wV();Y>0&&(Y+=jt),J+=jt;for(const Rt of H){const zt=[],Yt=[];for(const qt of Rt){const Dt=qt.x+oe.x,Vt=qt.y+oe.y,St=q.projection.projectTilePoint(Dt,Vt,qe),xt=q.projection.upVector(qe,qt.x,qt.y);let $t=Y,Kt=J;if(he){const Ft=IV(Dt,Vt,Y,J,he,Se,Te,ke);$t+=Ft.base,Kt+=Ft.top}Y!==0?pt(it,St.x+xt[0]*et*$t,St.y+xt[1]*et*$t,St.z+xt[2]*et*$t):pt(it,St.x,St.y,St.z),pt(At,St.x+xt[0]*et*Kt,St.y+xt[1]*et*Kt,St.z+xt[2]*et*Kt),Ht(it,it,ce),Ht(At,At,ce),zt.push(new by(it[0],it[1],it[2])),Yt.push(new by(At[0],At[1],At[2]))}Fe.push(zt),Xe.push(Yt)}return[Fe,Xe]}(u,a,c,p,g,x,w,C,N,D,U):w?function(q,H,Y,J,oe,ce,he,Se,Te){const ke=[],qe=[],Fe=[0,0,0,1];for(const Xe of q){const et=[],it=[];for(const At of Xe){const pt=At.x+J.x,jt=At.y+J.y,Rt=IV(pt,jt,H,Y,ce,he,Se,Te);Fe[0]=pt,Fe[1]=jt,Fe[2]=Rt.base,Fe[3]=1,Qt(Fe,Fe,oe),Fe[3]=Math.max(Fe[3],1e-5);const zt=new by(Fe[0]/Fe[3],Fe[1]/Fe[3],Fe[2]/Fe[3]);Fe[0]=pt,Fe[1]=jt,Fe[2]=Rt.top,Fe[3]=1,Qt(Fe,Fe,oe),Fe[3]=Math.max(Fe[3],1e-5);const Yt=new by(Fe[0]/Fe[3],Fe[1]/Fe[3],Fe[2]/Fe[3]);et.push(zt),it.push(Yt)}ke.push(et),qe.push(it)}return[ke,qe]}(a,c,p,g,x,w,C,N,D):function(q,H,Y,J,oe){const ce=[],he=[],Se=oe[8]*H,Te=oe[9]*H,ke=oe[10]*H,qe=oe[11]*H,Fe=oe[8]*Y,Xe=oe[9]*Y,et=oe[10]*Y,it=oe[11]*Y;for(const At of q){const pt=[],jt=[];for(const Rt of At){const zt=Rt.x+J.x,Yt=Rt.y+J.y,qt=oe[0]*zt+oe[4]*Yt+oe[12],Dt=oe[1]*zt+oe[5]*Yt+oe[13],Vt=oe[2]*zt+oe[6]*Yt+oe[14],St=oe[3]*zt+oe[7]*Yt+oe[15],xt=qt+Se,$t=Dt+Te,Kt=Vt+ke,Ft=Math.max(St+qe,1e-5),gr=qt+Fe,br=Dt+Xe,hr=Vt+et,ar=Math.max(St+it,1e-5);pt.push(new by(xt/Ft,$t/Ft,Kt/Ft)),jt.push(new by(gr/ar,br/ar,hr/ar))}ce.push(pt),he.push(jt)}return[ce,he]}(a,c,p,g,x)}function IV(u,a,c,p,g,x,w,C){const N=w*g.getElevationAt(u,a,!0,!0),D=x[0]!==0,U=D?x[1]===0?w*(x[0]/dV-hV):w*function(q,H,Y){const J=Math.floor(H[0]/8),oe=Math.floor(H[1]/8),ce=10*(H[0]-8*J),he=10*(H[1]-8*oe),Se=q.getElevationAt(J,oe,!0,!0),Te=q.getMeterToDEM(Y),ke=Math.floor(.5*(ce*Te-1)),qe=Math.floor(.5*(he*Te-1)),Fe=q.tileCoordToPixel(J,oe),Xe=2*ke+1,et=2*qe+1,it=function(Yt,qt,Dt,Vt,St){return[Yt.getElevationAtPixel(qt,Dt,!0),Yt.getElevationAtPixel(qt+St,Dt,!0),Yt.getElevationAtPixel(qt,Dt+St,!0),Yt.getElevationAtPixel(qt+Vt,Dt+St,!0)]}(q,Fe.x-ke,Fe.y-qe,Xe,et),At=Math.abs(it[0]-it[1]),pt=Math.abs(it[2]-it[3]),jt=Math.abs(it[0]-it[2])+Math.abs(it[1]-it[3]),Rt=Math.min(.25,.5*Te*(At+pt)/Xe),zt=Math.min(.25,.5*Te*jt/et);return Se+Math.max(Rt*ce,zt*he)}(g,x,C):N;return{base:N+(c===0?-1:c),top:D?Math.max(U+p,N+c+2):N+p}}class Jhe{constructor(a){this._callback=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Qhe{constructor(){this.tasks={},this.taskQueue=[],_t(["process"],this),this.invoker=new Jhe(this.process),this.nextId=0}add(a,c){const p=this.nextId++,g=function({type:x,isSymbolTile:w,zoom:C}){return C=C||0,x==="message"?0:x!=="maybePrepare"||w?x!=="parseTile"||w?x==="parseTile"&&w?300-C:x==="maybePrepare"&&w?400-C:500:200-C:100-C}(c);if(g===0){try{a()}finally{}return null}return this.tasks[p]={fn:a,metadata:c,priority:g,id:p},this.taskQueue.push(p),this.invoker.trigger(),{cancel:()=>{delete this.tasks[p]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(p=>!!this.tasks[p]),!this.taskQueue.length)return;const a=this.pick();if(a===null)return;const c=this.tasks[a];if(delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),!c)return;c.fn()}finally{}}pick(){let a=null,c=1/0;for(let g=0;g<this.taskQueue.length;g++){const x=this.tasks[this.taskQueue[g]];x.priority<c&&(c=x.priority,a=g)}if(a===null)return null;const p=this.taskQueue[a];return this.taskQueue.splice(a,1),p}remove(){this.invoker.remove()}}class RV{constructor(a,c,p){this.target=a,this.parent=c,this.mapId=p,this.callbacks={},this.cancelCallbacks={},_t(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Qhe}send(a,c,p,g,x=!1,w){const C=Math.round(1e18*Math.random()).toString(36).substring(0,10);p&&(p.metadata=w,this.callbacks[C]=p);const N=new Set;return this.target.postMessage({id:C,type:a,hasCallback:!!p,targetMapId:g,mustQueue:x,sourceMapId:this.mapId,data:ah(c,N)},N),{cancel:()=>{p&&delete this.callbacks[C],this.target.postMessage({id:C,type:"<cancel>",targetMapId:g,sourceMapId:this.mapId})}}}receive(a){const c=a.data;if(!c)return;const p=c.id;if(p&&(!c.targetMapId||this.mapId===c.targetMapId))if(c.type==="<cancel>"){const g=this.cancelCallbacks[p];delete this.cancelCallbacks[p],g&&g.cancel()}else if(c.mustQueue||bs(self)){const g=this.callbacks[p],x=this.scheduler.add(()=>this.processTask(p,c),g&&g.metadata||{type:"message"});x&&(this.cancelCallbacks[p]=x)}else this.processTask(p,c)}processTask(a,c){if(delete this.cancelCallbacks[a],c.type==="<response>"){const p=this.callbacks[a];delete this.callbacks[a],p&&(c.error?p(oh(c.error)):p(null,oh(c.data)))}else{const p=new Set,g=c.hasCallback?(w,C)=>{this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:w?ah(w):null,data:ah(C,p)},p)}:()=>{},x=oh(c.data);if(this.parent[c.type])this.parent[c.type](c.sourceMapId,x,g);else if(this.parent.getWorkerSource){const w=c.type.split("."),{source:C,scope:N}=x;this.parent.getWorkerSource(c.sourceMapId,w[0],C,N)[w[1]](x,g)}else g(new Error(`Could not find function ${c.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var rS={workerUrl:"",workerClass:null,workerParams:void 0};const XR="mapboxgl_preloaded_worker_pool";class wy{constructor(){this.active={}}acquire(a,c=wy.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<c;)this.workers.push(rS.workerClass!=null?new rS.workerClass:new self.Worker(rS.workerUrl,rS.workerParams));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.workers&&this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[XR]}numActive(){return Object.keys(this.active).length}}wy.workerCount=2;class dx{constructor(a,c,p="Worker",g=wy.workerCount){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=bt();const x=this.workerPool.acquire(this.id,g);for(let w=0;w<x.length;w++){const C=new dx.Actor(x[w],c,this.id);C.name=`${p} ${w}`,this.actors.push(C)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(a,c,p){Ye(this.actors,(g,x)=>{g.send(a,c,x)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}let nS,YR;function uC(){return nS||(nS=new wy),nS}dx.Actor=RV;class efe{constructor(a){this.module=a}createIntArray(a){const c=new Int32Array(a),p=this.module.malloc(c.length*c.BYTES_PER_ELEMENT);return this.module.heap32.set(c,p/c.BYTES_PER_ELEMENT),p}createFloatArray(a){const c=new Float32Array(a),p=this.module.malloc(c.length*c.BYTES_PER_ELEMENT);return this.module.heapF32.set(c,p/c.BYTES_PER_ELEMENT),p}createStringBuffer(a){const c=this.module.malloc(a.length+1);for(let p=0;p<a.length;++p)this.module.heapU8[c+p]=a.charCodeAt(p);return this.module.heapU8[c+a.length]=0,c}readStringBuffer(a){let c="";for(;this.module.heapU8[a]!==0;)c+=String.fromCharCode(this.module.heapU8[a]),++a;return c}setStyle(a){const c=a.entranceColorRgb,p=a.facadeGlazingColorRgb,g=a.roofColorRgb,x=a.wallColorRgb,w=a.normalScale;this.module.setStyle(c[0],c[1],c[2],p[0],p[1],p[2],g[0],g[1],g[2],x[0],x[1],x[2],w[0],w[1],w[2],a.tileToMeters)}setAOOptions(a,c){this.module.setAOOptions(a?1:0,c)}setMetricOptions(a,c){this.module.setMetricOptions(a?1:0,c)}setStructuralOptions(a){this.module.setStructuralOptions(a?1:0)}setFacadeOptions(a,c){this.module.setFacadeOptions(a,c?1:0)}setFauxFacadeOptions(a,c,p){this.module.setFauxFacadeOptions(a?1:0,c?1:0,p)}setFacadeClassifierOptions(a){this.module.setFacadeClassifierOptions(a)}generateMesh(a,c){for(const C of a){const N=this.createStringBuffer(C.roofType),D=[0],U=[];for(const Y of C.coordinates)if(Array.isArray(Y)){for(const J of Y)U.push(J.x),U.push(J.y);D.push(U.length)}const q=this.createIntArray(D),H=this.createFloatArray(U);this.module.addFeature(C.id,C.sourceId,C.minHeight,C.height,N,C.roofType.length,H,q,D.length-1),this.module.free(N),this.module.free(q),this.module.free(H)}for(const C of c){let N;N=C.entrances?JSON.parse(C.entrances):[];const D=this.createFloatArray(N),U=[];for(const H of C.coordinates)U.push(H.x),U.push(H.y);const q=this.createFloatArray(U);this.module.addFacade(C.sourceId,C.crossPerc,C.distanceToRoad,D,N.length,q,U.length),this.module.free(D),this.module.free(q)}if(!this.module.generateMesh()){const C=this.module.getLastError();return this.readStringBuffer(C)}const p=this.module.getMeshCount(),g=new Array(p);for(let C=0;C<p;C++){const N=this.module.getPositionsPtr(C),D=this.module.getPositionsLength(C),U=new Float32Array(this.module.heapF32.buffer,N,D),q=this.module.getNormalsPtr(C),H=this.module.getNormalsLength(C),Y=new Float32Array(this.module.heapF32.buffer,q,H),J=this.module.getColorsPtr(C),oe=this.module.getColorsLength(C),ce=new Uint8Array(this.module.heapU8.buffer,J,oe),he=this.module.getAOPtr(C),Se=this.module.getAOLength(C),Te=new Float32Array(this.module.heapF32.buffer,he,Se),ke=this.module.getUVPtr(C),qe=this.module.getUVLength(C),Fe=new Float32Array(this.module.heapF32.buffer,ke,qe),Xe=this.module.getFauxFacadePtr(C),et=this.module.getFauxFacadeLength(C),it=new Uint8Array(this.module.heapU8.buffer,Xe,et),At=this.module.getIndicesPtr(C),pt=this.module.getIndicesLength(C),jt=new Int32Array(this.module.heap32.buffer,At,pt),Rt=this.module.getBuildingPart(C),zt=this.readStringBuffer(Rt);g[C]={positions:U,normals:Y,colors:ce,ao:Te,uv:Fe,isFauxFacade:it,indices:jt,buildingPart:zt}}const x=this.module.getRingCount(),w=[];for(let C=0;C<x;C++){const N=this.module.getRingPtr(C),D=this.module.getRingLength(C),U=new Float32Array(this.module.heapF32.buffer,N,D);w.push(U)}return{meshes:g,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:w}}}let iS,JR,_d,hx,QR,fx=null,px=null,MV=null,dC=null;function DV(){return bs(self)&&self.worker.dracoUrl?self.worker.dracoUrl:JR||Ji.DRACO_URL}function LV(){if(bs(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(hx)return hx;const u=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return hx=WebAssembly.validate(u)?Ji.MESHOPT_SIMD_URL:Ji.MESHOPT_URL,hx}function tfe(){return dC}const hC={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},rfe={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},sS={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function FV(u,a,c){const p=c.json.bufferViews.length,g=c.buffers.length;a.bufferView=p,c.json.bufferViews[p]={buffer:g,byteLength:u.byteLength},c.buffers[g]=u}const eM="KHR_draco_mesh_compression";function nfe(u,a){const c=u.extensions&&u.extensions[eM];if(!c)return;const p=new _d.Decoder,g=UV(a,c.bufferView),x=new _d.Mesh;if(!p.DecodeArrayToMesh(g,g.byteLength,x))throw new Error("Failed to decode Draco mesh");const w=a.json.accessors[u.indices],C=hC[w.componentType],N=w.count*C.BYTES_PER_ELEMENT,D=_d._malloc(N);C===Uint16Array?p.GetTrianglesUInt16Array(x,N,D):p.GetTrianglesUInt32Array(x,N,D),FV(_d.memory.buffer.slice(D,D+N),w,a),_d._free(D);for(const U of Object.keys(c.attributes)){const q=p.GetAttributeByUniqueId(x,c.attributes[U]),H=a.json.accessors[u.attributes[U]],Y=rfe[H.componentType],J=H.count*sS[H.type]*hC[H.componentType].BYTES_PER_ELEMENT,oe=_d._malloc(J);p.GetAttributeDataArrayForAllPoints(x,q,_d[Y],J,oe),FV(_d.memory.buffer.slice(oe,oe+J),H,a),_d._free(oe)}p.destroy(),x.destroy(),delete u.extensions[eM]}const fC="EXT_meshopt_compression";function ife(u,a){if(!u.extensions||!u.extensions[fC])return;const c=u.extensions[fC],p=new Uint8Array(a.buffers[c.buffer],c.byteOffset||0,c.byteLength||0),g=new Uint8Array(c.count*c.byteStride);QR.decodeGltfBuffer(g,c.count,c.byteStride,p,c.mode,c.filter),u.buffer=a.buffers.length,u.byteOffset=0,a.buffers[u.buffer]=g.buffer,delete u.extensions[fC]}const zV=1179937895,BV=new TextDecoder("utf8");function $V(u,a){return new URL(u,a).href}function sfe(u,a,c,p){return fetch($V(u.uri,p)).then(g=>g.arrayBuffer()).then(g=>{a.buffers[c]=g})}function UV(u,a){const c=u.json.bufferViews[a];return new Uint8Array(u.buffers[c.buffer],c.byteOffset||0,c.byteLength)}function afe(u,a,c,p){if(u.uri){const g=$V(u.uri,p);return fetch(g).then(x=>x.blob()).then(x=>createImageBitmap(x)).then(x=>{a.images[c]=x})}if(u.bufferView!==void 0){const g=UV(a,u.bufferView),x=new Blob([g],{type:u.mimeType});return createImageBitmap(x).then(w=>{a.images[c]=w})}}function VV(u,a=0,c){const p={json:null,images:[],buffers:[]};if(new Uint32Array(u,a,1)[0]===zV){const U=new Uint32Array(u,a);let q=2;const H=(U[q++]>>2)-3,Y=U[q++]>>2;if(q++,p.json=JSON.parse(BV.decode(U.subarray(q,q+Y))),q+=Y,q<H){const J=U[q++];q++;const oe=a+(q<<2);p.buffers[0]=u.slice(oe,oe+J)}}else p.json=JSON.parse(BV.decode(new Uint8Array(u,a)));const{buffers:g,images:x,meshes:w,extensionsUsed:C,bufferViews:N}=p.json;let D=Promise.resolve();if(g){const U=[];for(let q=0;q<g.length;q++){const H=g[q];H.uri?U.push(sfe(H,p,q,c)):p.buffers[q]||(p.buffers[q]=null)}D=Promise.all(U)}return D.then(()=>{const U=[],q=C&&C.includes(eM),H=C&&C.includes(fC);if(q&&U.push(function(){if(!_d)return iS??(iS=function(Y){let J,oe=null;function ce(){J=new Uint8Array(oe.buffer)}function he(){throw new Error("Unexpected Draco error.")}const Se={a:{a:he,d:function(Te,ke,qe){return J.copyWithin(Te,ke,ke+qe)},c:function(Te){const ke=J.length,qe=Math.max(Te>>>0,Math.ceil(1.2*ke)),Fe=Math.ceil((qe-ke)/65536);try{return oe.grow(Fe),ce(),!0}catch{return!1}},b:he}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(Y,Se):Y.then(Te=>Te.arrayBuffer()).then(Te=>WebAssembly.instantiate(Te,Se))).then(Te=>{const{Rb:ke,Qb:qe,P:Fe,T:Xe,X:et,Ja:it,La:At,Qa:pt,Va:jt,Wa:Rt,eb:zt,jb:Yt,f:qt,e:Dt,yb:Vt,zb:St,Ab:xt,Bb:$t,Db:Kt,Gb:Ft}=Te.instance.exports;oe=Dt;const gr=(()=>{let br=0,hr=0,ar=0,en=0;return lr=>{ar&&(ke(en),ke(br),hr+=ar,ar=br=0),br||(hr+=128,br=qe(hr));const Lr=lr.length+7&-8;let rn=br;Lr>=hr&&(ar=Lr,rn=en=qe(Lr));for(let Sn=0;Sn<lr.length;Sn++)J[rn+Sn]=lr[Sn];return rn}})();return ce(),qt(),{memory:Dt,_free:ke,_malloc:qe,Mesh:class{constructor(){this.ptr=Fe()}destroy(){Xe(this.ptr)}},Decoder:class{constructor(){this.ptr=it()}destroy(){Yt(this.ptr)}DecodeArrayToMesh(br,hr,ar){const en=gr(br),lr=At(this.ptr,en,hr,ar.ptr);return!!et(lr)}GetAttributeByUniqueId(br,hr){return{ptr:pt(this.ptr,br.ptr,hr)}}GetTrianglesUInt16Array(br,hr,ar){jt(this.ptr,br.ptr,hr,ar)}GetTrianglesUInt32Array(br,hr,ar){Rt(this.ptr,br.ptr,hr,ar)}GetAttributeDataArrayForAllPoints(br,hr,ar,en,lr){zt(this.ptr,br.ptr,hr.ptr,ar,en,lr)}},DT_INT8:Vt(),DT_UINT8:St(),DT_INT16:xt(),DT_UINT16:$t(),DT_UINT32:Kt(),DT_FLOAT32:Ft()}})}(fetch(DV())),iS.then(Y=>{_d=Y,iS=void 0}))}()),H&&U.push(function(){if(QR)return;const Y=function(J){let oe;const ce=WebAssembly.instantiateStreaming(J,{}).then(Te=>{oe=Te.instance,oe.exports.__wasm_call_ctors()}),he={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Se={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:ce,supported:!0,decodeGltfBuffer(Te,ke,qe,Fe,Xe,et){(function(it,At,pt,jt,Rt,zt,Yt){const qt=it.exports.sbrk,Dt=jt+3&-4,Vt=qt(Dt*Rt),St=qt(zt.length),xt=new Uint8Array(it.exports.memory.buffer);xt.set(zt,St);const $t=At(Vt,jt,Rt,St,zt.length);if($t===0&&Yt&&Yt(Vt,Dt,Rt),pt.set(xt.subarray(Vt,Vt+jt*Rt)),qt(Vt-qt(0)),$t!==0)throw new Error(`Malformed buffer data: ${$t}`)})(oe,oe.exports[Se[Xe]],Te,ke,qe,Fe,oe.exports[he[et]])}}}(fetch(LV()));return Y.ready.then(()=>{QR=Y})}()),x)for(let Y=0;Y<x.length;Y++)U.push(afe(x[Y],p,Y,c));return(U.length?Promise.all(U):Promise.resolve()).then(()=>{if(q&&w)for(const{primitives:Y}of w)for(const J of Y)nfe(J,p);if(H&&w&&N)for(const Y of N)ife(Y,p);return p})})}function qV(u){return fetch(u).then(a=>a.arrayBuffer()).then(a=>VV(a,0,u))}function tM(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function rM(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class nM{constructor(a,c,p,g){this.context=a,this.format=p,this.useMipmap=g&&g.useMipmap,this.texture=a.gl.createTexture(),this.update(c,{premultiply:g&&g.premultiply})}update(a,c){const p=a&&a instanceof HTMLVideoElement&&a.width===0?a.videoWidth:a.width,g=a&&a instanceof HTMLVideoElement&&a.height===0?a.videoHeight:a.height,{context:x}=this,{gl:w}=x,{x:C,y:N}=c&&c.position?c.position:{x:0,y:0},D=C+p,U=N+g;!this.size||this.size[0]===D&&this.size[1]===U||(w.bindTexture(w.TEXTURE_2D,null),w.deleteTexture(this.texture),this.texture=w.createTexture(),this.size=null),w.bindTexture(w.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA8&&(!c||c.premultiply!==!1));const q=a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||ImageBitmap&&a instanceof ImageBitmap;if(!this.size&&D>0&&U>0){const H=this.useMipmap?Math.floor(Math.log2(Math.max(D,U)))+1:1;w.texStorage2D(w.TEXTURE_2D,H,this.format,D,U),this.size=[D,U]}this.size&&(q?w.texSubImage2D(w.TEXTURE_2D,0,C,N,tM(this.format),rM(this.format),a):"data"in a&&a.data&&w.texSubImage2D(w.TEXTURE_2D,0,C,N,p,g,tM(this.format),rM(this.format),a.data)),this.useMipmap&&w.generateMipmap(w.TEXTURE_2D)}bind(a,c,p=!1){const{context:g}=this,{gl:x}=g;x.bindTexture(x.TEXTURE_2D,this.texture),a!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,a),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap&&!p?a===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:a),this.minFilter=a),c!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,c),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,c),this.wrapS=c)}bindExtraParam(a,c,p,g,x){const{context:w}=this,{gl:C}=w;C.bindTexture(C.TEXTURE_2D,this.texture),c!==this.magFilter&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,c),this.magFilter=c),a!==this.minFilter&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,this.useMipmap?a===C.NEAREST?C.NEAREST_MIPMAP_NEAREST:C.LINEAR_MIPMAP_LINEAR:a),this.minFilter=a),p!==this.wrapS&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,p),this.wrapS=p),g!==this.wrapT&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,g),this.wrapT=g),x!==this.compareMode&&(x?(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_COMPARE_MODE,C.COMPARE_REF_TO_TEXTURE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_COMPARE_FUNC,x)):C.texParameteri(C.TEXTURE_2D,C.TEXTURE_COMPARE_MODE,C.NONE),this.compareMode=x)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}class aS{constructor(a,c){this.context=a,this.texture=c}bind(a,c){const{context:p}=this,{gl:g}=p;g.bindTexture(g.TEXTURE_2D,this.texture),a!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,a),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,a),this.minFilter=a),c!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,c),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,c),this.wrapS=c)}}const ofe=Cn([{name:"a_pos_3f",components:3,type:"Float32"}]),lfe=Cn([{name:"a_color_3f",components:3,type:"Float32"}]),cfe=Cn([{name:"a_color_4f",components:4,type:"Float32"}]),ufe=Cn([{name:"a_uv_2f",components:2,type:"Float32"}]),dfe=Cn([{name:"a_normal_3f",components:3,type:"Float32"}]),hfe=Cn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),ffe=Cn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function HV(u,a){const c=pC(u.projection,u.zoom,u.width,u.height),p=function(x,w,C,N,D){const U=new Q(C.lng-180*sm,C.lat),q=new Q(C.lng+180*sm,C.lat),H=x.project(U.lng,U.lat),Y=x.project(q.lng,q.lat),J=-Math.atan2(Y.y-H.y,Y.x-H.x),oe=dt.fromLngLat(C);oe.y=ve(oe.y,-1+sm,1-sm);const ce=oe.toLngLat(),he=x.project(ce.lng,ce.lat),Se=dt.fromLngLat(ce);Se.x+=sm;const Te=Se.toLngLat(),ke=x.project(Te.lng,Te.lat),qe=WV(ke.x-he.x,ke.y-he.y,J),Fe=dt.fromLngLat(ce);Fe.y+=sm;const Xe=Fe.toLngLat(),et=x.project(Xe.lng,Xe.lat),it=WV(et.x-he.x,et.y-he.y,J),At=Math.abs(qe.x)/Math.abs(it.y),pt=I([]);K(pt,pt,-J*(1-(D?0:N)));const jt=I([]);return z(jt,jt,[1,1-(1-At)*N,1]),jt[4]=-it.x/it.y*N,K(jt,jt,J),M(jt,pt,jt),jt}(u.projection,0,u.center,c,a),g=GV(u);return z(p,p,[g,g,1]),p}function GV(u){const a=u.projection,c=pC(u.projection,u.zoom,u.width,u.height),p=iM(a,u.center),g=iM(a,Q.convert(a.center));return Math.pow(2,p*c+(1-c)*g)}function pC(u,a,c,p,g=1/0){const x=u.range;if(!x)return 0;const w=Math.min(g,Math.max(c,p)),C=Math.log2(w/1024);return De(x[0]+C,x[1]+C,a)}const sm=1/4e4;function iM(u,a){const c=ve(a.lat,-Ie,Ie),p=new Q(a.lng-180*sm,c),g=new Q(a.lng+180*sm,c),x=u.project(p.lng,c),w=u.project(g.lng,c),C=dt.fromLngLat(p),N=dt.fromLngLat(g),D=w.x-x.x,U=w.y-x.y,q=N.x-C.x,H=N.y-C.y,Y=Math.sqrt((q*q+H*H)/(D*D+U*U));return Math.log2(Y)}function WV(u,a,c){const p=Math.cos(c),g=Math.sin(c);return{x:u*p-a*g,y:u*g+a*p}}function KV(u,a,c){I(u),K(u,u,_n(a[2])),$(u,u,_n(a[0])),W(u,u,_n(a[1])),z(u,u,c),M(u,u,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function mC(u,a,c,p,g,x,w,C){const N=[c[0]-a[0],c[1]-a[1],0],D=[p[0]-a[0],p[1]-a[1],0];if(be(N)<1e-12||be(D)<1e-12)return Cr(u);const U=gt([],N,D);Me(U,U),me(D,p,a),N[2]=(x-g)*C,D[2]=(w-g)*C;const q=N;return gt(q,N,D),Me(q,q),xs(u,U,q)}function gC(u,a,c=!1){const p=rm(a.zoom),g=function(x,w,C){const N=w.worldSize,D=[x[12],x[13],x[14]],U=je(D[1]/N),q=Ne(D[0]/N),H=I([]),Y=Ee(1,U)*N,J=Ee(1,0)*N*$e(U,w.zoom),oe=1/IR(N);let ce=J*oe;if(C){const ke=pC(w.projection,w.zoom,w.width,w.height,1024);ce=oe*w.projection.pixelSpaceConversion(w.center.lat,N,ke)}const he=B(U,q);_e(he,he,Oe([],Me([],he),Y*ce*D[2]));const Se=function(ke){const qe=[ke[0],ke[1],ke[2]];let Fe=[0,1,0];const Xe=gt([],Fe,qe);return gt(Fe,qe,Xe),Be(Fe)===0&&(Fe=[0,1,0],gt(Xe,qe,Fe)),Me(Xe,Xe),Me(Fe,Fe),Me(qe,qe),[Xe[0],Xe[1],Xe[2],0,Fe[0],Fe[1],Fe[2],0,qe[0],qe[1],qe[2],0,ke[0],ke[1],ke[2],1]}(he);z(H,H,[ce,ce,ce*Y]),F(H,H,[-D[0],-D[1],-D[2]]);const Te=M([],w.globeMatrix,Se);return M(Te,Te,H),M(Te,Te,x),Te}(u,a,c);if(p>0){const x=function(w,C){const N=C.worldSize,D=Ee(1,0)*N*$e(C.center.lat,C.zoom)/IR(N),U=Ee(1,C.center.lat)*N,q=I([]);W(q,q,_n(C.center.lng)),$(q,q,_n(C.center.lat)),F(q,q,[0,0,vl]),z(q,q,[D,D,D*U]);const H=C.point;return F(q,q,[-H.x,-H.y,0]),M(q,q,w),M(q,C.globeMatrix,q)}(u,a);return function(w,C,N){const D=(J,oe,ce)=>{const he=be(J),Se=be(oe),Te=Tf(J,oe,ce);return Oe(Te,Te,1/be(Te)*Kr(he,Se,ce))},U=D([w[0],w[1],w[2]],[C[0],C[1],C[2]],N),q=D([w[4],w[5],w[6]],[C[4],C[5],C[6]],N),H=D([w[8],w[9],w[10]],[C[8],C[9],C[10]],N),Y=Tf([w[12],w[13],w[14]],[C[12],C[13],C[14]],N);return[U[0],U[1],U[2],0,q[0],q[1],q[2],0,H[0],H[1],H[2],0,Y[0],Y[1],Y[2],1]}(g,x,p)}return g}function sM(u,a,c,p){const g=xn.projectAabbCorners(p,c);let x=Number.MAX_VALUE;for(let C=0;C<g.length;++C){const N=g[C];N[0]=(.5*N[0]+.5)*a.width,N[1]=(.5-.5*N[1])*a.height,N[2]<x&&(x=N[2])}const w=function(C){const N=[];let D=0;for(let Y=1;Y<C.length;Y++)(C[Y][0]<C[D][0]||C[Y][0]===C[D][0]&&C[Y][1]<C[D][1])&&(D=Y);let U,q=D;const H=new Uint8Array(C.length);do{if(H[q])break;N.push(new st(C[q][0],C[q][1])),H[q]=1,U=(q+1)%C.length;for(let Y=0;Y<C.length;Y++){if(C[Y][0]===C[U][0]&&C[Y][1]===C[U][1]||C[Y][0]===C[q][0]&&C[Y][1]===C[q][1])continue;const J=[C[Y][0]-C[q][0],C[Y][1]-C[q][1]],oe=[C[U][0]-C[q][0],C[U][1]-C[q][1]],ce=J[0]*oe[1]-J[1]*oe[0];(ce>0||ce===0&&J[0]*oe[0]+J[1]*oe[1]>=0&&J[0]*J[0]+J[1]*J[1]>oe[0]*oe[0]+oe[1]*oe[1])&&(U=Y)}q=U}while(q!==D);return N.length>0&&N.push(N[0]),N}(g);if(Ns(u,w))return x}const Sy=64,mx={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function yC(u,a,c,p,g,x,w,C,N,D=!1){const U=c.zoom,q=c.project(p),H=$e(p.lat,U),Y=1/H;I(u),F(u,u,[q.x+w[0]*Y,q.y+w[1]*Y,w[2]]);let J=1,oe=1;const ce=c.worldSize;if(D){if(c.projection.name==="mercator"){let ke=0;c.elevation&&(ke=c.elevation.getAtPointOrZero(new dt(q.x/ce,q.y/ce),0));const qe=Qt([],[q.x,q.y,ke,1],c.projMatrix)[3]/c.cameraToCenterDistance;J=qe,oe=qe*$e(c.center.lat,U)}else if(c.projection.name==="globe"){const ke=gC(u,c),qe=[0,0,0,1];Qt(qe,qe,M([],c.projMatrix,ke));const Fe=qe[3]/c.cameraToCenterDistance,Xe=rm(U),et=c.projection.pixelsPerMeter(p.lat,ce)*$e(p.lat,U),it=c.projection.pixelsPerMeter(c.center.lat,ce)*$e(c.center.lat,U);J=Fe/Kr(et,Ge(c.center.lat),Xe),oe=Fe*H/et,J*=it,oe*=it}}else J=Y;z(u,u,[J,J,oe]);const he=[...u],Se=a.orientation,Te=[];if(KV(Te,[Se[0]+(g?g[0]:0),Se[1]+(g?g[1]:0),Se[2]+(g?g[2]:0)],x),M(u,he,Te),C&&c.elevation){let ke=0;const qe=[];if(N&&c.elevation){ke=function(Xe,et,it,At,pt){const jt=et.elevation;if(!jt)return 0;const Rt=xn.projectAabbCorners(it,At),zt=Ee(1,pt.lat)*et.worldSize,Yt=function(hr,ar){const en=[0,0,1],lr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Lr of lr){const rn=hr[Lr.corners[0]],Sn=hr[Lr.corners[1]],qn=hr[Lr.corners[2]],on=[Sn[0]-rn[0],Sn[1]-rn[1],ar*(Sn[2]-rn[2])],ti=gt(on,on,[qn[0]-rn[0],qn[1]-rn[1],ar*(qn[2]-rn[2])]);Me(ti,ti),Lr.dotProductWithUp=We(ti,en)}return lr.sort((Lr,rn)=>Lr.dotProductWithUp-rn.dotProductWithUp),lr[0].corners}(Rt,zt),qt=Rt[Yt[0]],Dt=Rt[Yt[1]],Vt=Rt[Yt[2]],St=Rt[Yt[3]],xt=jt.getAtPointOrZero(new dt(qt[0]/et.worldSize,qt[1]/et.worldSize),0),$t=jt.getAtPointOrZero(new dt(Dt[0]/et.worldSize,Dt[1]/et.worldSize),0),Kt=jt.getAtPointOrZero(new dt(Vt[0]/et.worldSize,Vt[1]/et.worldSize),0),Ft=jt.getAtPointOrZero(new dt(St[0]/et.worldSize,St[1]/et.worldSize),0),gr=(xt+Ft)/2,br=($t+Kt)/2;return gr>br?$t<Kt?mC(Xe,Dt,St,qt,$t,Ft,xt,zt):mC(Xe,Vt,qt,St,Kt,xt,Ft,zt):xt<Ft?mC(Xe,qt,Dt,Vt,xt,$t,Kt,zt):mC(Xe,St,Vt,Dt,Ft,Kt,$t,zt),Math.max(gr,br)}(qe,c,a.aabb,u,p);const Fe=M([],re([],qe),Te);M(u,he,Fe)}else ke=c.elevation.getAtPointOrZero(new dt(q.x/ce,q.y/ce),0);ke!==0&&(u[14]+=ke)}}class ZV{constructor(a,c,p,g,x){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=a,this.uri=c,this.position=p!=null?new Q(p[0],p[1]):new Q(0,0),this.orientation=g??[0,0,0],this.nodes=x,this.uploaded=!1,this.aabb=new xn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(a,c){M(a.globalMatrix,c,a.localMatrix);const p=this.nodeOverrides.get(a.name);if(p!==void 0){const w=[];x=p.orientation,I(g=w),W(g,g,_n(x[1])),K(g,g,_n(x[2])),$(g,g,_n(x[0])),M(a.globalMatrix,a.globalMatrix,w)}var g,x;if(a.meshes)for(const w of a.meshes){const C=xn.applyTransformFast(w.aabb,a.globalMatrix);this.aabb.encapsulate(C)}if(a.children)for(const w of a.children)this._applyTransformations(w,a.globalMatrix)}computeBoundsAndApplyParent(){const a=I([]);this.aabb=new xn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.nodes)this._applyTransformations(c,a)}computeModelMatrix(a,c,p,g,x,w,C=!1){yC(this.matrix,this,a.transform,this.position,c,p,g,x,w,C)}upload(a){if(!this.uploaded){for(const c of this.nodes)aM(c,a);for(const c of this.nodes)vC(c);this.uploaded=!0}}destroy(){for(const a of this.nodes)oM(a)}}function oS(u,a,c=!1){u.uploaded||(u.gfxTexture=new nM(a,u.image,c?a.gl.R8:a.gl.RGBA8,{useMipmap:u.sampler.minFilter>=a.gl.NEAREST_MIPMAP_NEAREST}),u.uploaded=!0,u.image=null)}function pfe(u,a,c){u.indexBuffer=a.createIndexBuffer(u.indexArray,!1,!0),u.vertexBuffer=a.createVertexBuffer(u.vertexArray,ofe.members,!1,!0),u.normalArray&&(u.normalBuffer=a.createVertexBuffer(u.normalArray,dfe.members,!1,!0)),u.texcoordArray&&(u.texcoordBuffer=a.createVertexBuffer(u.texcoordArray,ufe.members,!1,!0)),u.colorArray&&(u.colorBuffer=a.createVertexBuffer(u.colorArray,(u.colorArray.bytesPerElement===12?lfe:cfe).members,!1,!0)),u.featureArray&&(u.pbrBuffer=a.createVertexBuffer(u.featureArray,ffe.members,!0)),u.segments=ds.simpleSegment(0,0,u.vertexArray.length,u.indexArray.length);const p=u.material;p.pbrMetallicRoughness.baseColorTexture&&oS(p.pbrMetallicRoughness.baseColorTexture,a),p.pbrMetallicRoughness.metallicRoughnessTexture&&oS(p.pbrMetallicRoughness.metallicRoughnessTexture,a),p.normalTexture&&oS(p.normalTexture,a),p.occlusionTexture&&oS(p.occlusionTexture,a,c),p.emissionTexture&&oS(p.emissionTexture,a)}function aM(u,a,c){if(u.meshes)for(const p of u.meshes)pfe(p,a,c);if(u.children)for(const p of u.children)aM(p,a,c)}function vC(u){if(u.meshes)for(const a of u.meshes)a.indexArray.destroy(),a.vertexArray.destroy(),a.colorArray&&a.colorArray.destroy(),a.normalArray&&a.normalArray.destroy(),a.texcoordArray&&a.texcoordArray.destroy(),a.featureArray&&a.featureArray.destroy();if(u.children)for(const a of u.children)vC(a)}function oM(u){if(u.meshes)for(const c of u.meshes)c.vertexBuffer&&(c.vertexBuffer.destroy(),c.indexBuffer.destroy(),c.normalBuffer&&c.normalBuffer.destroy(),c.texcoordBuffer&&c.texcoordBuffer.destroy(),c.colorBuffer&&c.colorBuffer.destroy(),c.pbrBuffer&&c.pbrBuffer.destroy(),c.segments.destroy(),c.material&&((a=c.material).pbrMetallicRoughness.baseColorTexture&&a.pbrMetallicRoughness.baseColorTexture.gfxTexture&&a.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),a.pbrMetallicRoughness.metallicRoughnessTexture&&a.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&a.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),a.normalTexture&&a.normalTexture.gfxTexture&&a.normalTexture.gfxTexture.destroy(),a.emissionTexture&&a.emissionTexture.gfxTexture&&a.emissionTexture.gfxTexture.destroy(),a.occlusionTexture&&a.occlusionTexture.gfxTexture&&a.occlusionTexture.gfxTexture.destroy()));var a;if(u.children)for(const c of u.children)oM(c)}function Ey(u,a){const c=u.json.bufferViews[a.bufferView],p=hC[a.componentType];return new p(u.buffers[c.buffer],(a.byteOffset||0)+(c.byteOffset||0),a.count*(c.byteStride&&c.byteStride!==sS[a.type]*p.BYTES_PER_ELEMENT?c.byteStride/p.BYTES_PER_ELEMENT:sS[a.type]))}function lM(u,a,c,p){const g=hC[a.componentType],x=function(U){switch(U){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(g),w=u.json.bufferViews[a.bufferView],C=w.byteStride?w.byteStride/g.BYTES_PER_ELEMENT:sS[a.type],N=c.float32,D=N.length/c.capacity;for(let U=0,q=0;U<a.count*C;U+=C,q+=D)for(let H=0;H<D;H++)N[q+H]=p[U+H]*x;c._trim()}function mfe(u,a,c){const p=u.indices,g=u.attributes,x={};x.indexArray=new is;const w=a.json.accessors[p],C=w.count/3;x.indexArray.reserve(C);const N=Ey(a,w);for(let H=0;H<C;H++)x.indexArray.emplaceBack(N[3*H],N[3*H+1],N[3*H+2]);x.indexArray._trim(),x.vertexArray=new Kl;const D=a.json.accessors[g.POSITION];x.vertexArray.reserve(D.count);const U=Ey(a,D);for(let H=0;H<D.count;H++)x.vertexArray.emplaceBack(U[3*H],U[3*H+1],U[3*H+2]);if(x.vertexArray._trim(),x.aabb=new xn(D.min,D.max),x.centroid=function(H,Y){const J=[0,0,0],oe=H.length;if(oe>0){for(let ce=0;ce<oe;ce++){const he=3*H[ce];J[0]+=Y[he],J[1]+=Y[he+1],J[2]+=Y[he+2]}J[0]/=oe,J[1]/=oe,J[2]/=oe}return J}(N,U),g.COLOR_0!==void 0){const H=a.json.accessors[g.COLOR_0],Y=sS[H.type],J=Ey(a,H);x.colorArray=Y===3?new Kl:new uh,x.colorArray.resize(H.count),lM(a,H,x.colorArray,J)}if(g.NORMAL!==void 0){x.normalArray=new Kl;const H=a.json.accessors[g.NORMAL];x.normalArray.resize(H.count);const Y=Ey(a,H);lM(a,H,x.normalArray,Y)}if(g.TEXCOORD_0!==void 0&&c.length>0){x.texcoordArray=new dh;const H=a.json.accessors[g.TEXCOORD_0];x.texcoordArray.resize(H.count);const Y=Ey(a,H);lM(a,H,x.texcoordArray,Y)}if(g._FEATURE_ID_RGBA4444!==void 0){const H=a.json.accessors[g._FEATURE_ID_RGBA4444];a.json.extensionsUsed&&a.json.extensionsUsed.includes("EXT_meshopt_compression")&&(x.featureData=Ey(a,H))}g._FEATURE_RGBA4444!==void 0&&(x.featureData=new Uint32Array(Ey(a,a.json.accessors[g._FEATURE_RGBA4444]).buffer));const q=u.material;return x.material=function(H,Y){const{emissiveFactor:J=[0,0,0],alphaMode:oe="OPAQUE",alphaCutoff:ce=.5,normalTexture:he,occlusionTexture:Se,emissiveTexture:Te,doubleSided:ke,name:qe}=H,{baseColorFactor:Fe=[1,1,1,1],metallicFactor:Xe=1,roughnessFactor:et=1,baseColorTexture:it,metallicRoughnessTexture:At}=H.pbrMetallicRoughness||{},pt=Se?Y[Se.index]:void 0;if(Se&&Se.extensions&&Se.extensions.KHR_texture_transform&&pt){const jt=Se.extensions.KHR_texture_transform;pt.offsetScale=[jt.offset[0],jt.offset[1],jt.scale[0],jt.scale[1]]}return{name:qe,pbrMetallicRoughness:{baseColorFactor:new hi(...Fe),metallicFactor:Xe,roughnessFactor:et,baseColorTexture:it?Y[it.index]:void 0,metallicRoughnessTexture:At?Y[At.index]:void 0},doubleSided:ke,emissiveFactor:new hi(...J),alphaMode:oe,alphaCutoff:ce,normalTexture:he?Y[he.index]:void 0,occlusionTexture:pt,emissionTexture:Te?Y[Te.index]:void 0,defined:H.defined===void 0}}(q!==void 0?a.json.materials[q]:{defined:!1},c),x}function XV(u,a,c){const{matrix:p,rotation:g,translation:x,scale:w,mesh:C,extras:N,children:D,name:U}=u,q={};if(q.name=U,q.localMatrix=p||function(H,Y,J,oe){var ce=Y[0],he=Y[1],Se=Y[2],Te=Y[3],ke=ce+ce,qe=he+he,Fe=Se+Se,Xe=ce*ke,et=ce*qe,it=ce*Fe,At=he*qe,pt=he*Fe,jt=Se*Fe,Rt=Te*ke,zt=Te*qe,Yt=Te*Fe,qt=oe[0],Dt=oe[1],Vt=oe[2];return H[0]=(1-(At+jt))*qt,H[1]=(et+Yt)*qt,H[2]=(it-zt)*qt,H[3]=0,H[4]=(et-Yt)*Dt,H[5]=(1-(Xe+jt))*Dt,H[6]=(pt+Rt)*Dt,H[7]=0,H[8]=(it+zt)*Vt,H[9]=(pt-Rt)*Vt,H[10]=(1-(Xe+At))*Vt,H[11]=0,H[12]=J[0],H[13]=J[1],H[14]=J[2],H[15]=1,H}([],g||[0,0,0,1],x||[0,0,0],w||[1,1,1]),q.globalMatrix=P(q.localMatrix),C!==void 0){q.meshes=c[C];const H=q.anchor=[0,0];for(const Y of q.meshes){const{min:J,max:oe}=Y.aabb;H[0]+=J[0]+oe[0],H[1]+=J[1]+oe[1]}H[0]=Math.floor(H[0]/q.meshes.length/2),H[1]=Math.floor(H[1]/q.meshes.length/2)}if(N&&(N.id&&(q.id=N.id),N.lights&&(q.lights=function(H){if(!H.length)return[];const Y=function(Se){const Te=atob(Se),ke=new Uint8Array(Te.length);for(let qe=0;qe<Te.length;qe++)ke[qe]=Te.codePointAt(qe);return ke}(H),J=[],oe=Y.length/24,ce=new Uint16Array(Y.buffer),he=new Float32Array(Y.buffer);for(let Se=0;Se<oe;Se++){const Te=ce[2*Se*6]/30,ke=ce[2*Se*6+1]/30,qe=ce[2*Se*6+10]/100,Fe=he[6*Se+1],Xe=he[6*Se+2],et=he[6*Se+3],it=he[6*Se+4],At=et-Fe,pt=it-Xe,jt=Math.hypot(At,pt);J.push({pos:[Fe+.5*At,Xe+.5*pt,ke],normal:[pt/jt,-At/jt,0],width:jt,height:Te,depth:qe,points:[Fe,Xe,et,it]})}return J}(N.lights)),N.MAPBOX_geometry_bloom&&(q.isGeometryBloom=N.MAPBOX_geometry_bloom)),D){const H=[];for(const Y of D)H.push(XV(a.json.nodes[Y],a,c));q.children=H}return q}function gfe(u){if(u.vertices.length===0||u.indices.length===0)return null;const a=new iC(u.vertices,u.indices,8,256),[c,p]=[a.min.clone(),a.max.clone()];return{vertices:u.vertices,indices:u.indices,grid:a,min:c,max:p}}function yfe(u){if(!u.extras||!u.extras.ground)return null;const a=u.extras.ground;if(!a||!Array.isArray(a)||a.length===0)return null;const c=a[0];if(!c||!Array.isArray(c)||c.length===0)return null;const p=[];for(const w of c){if(!Array.isArray(w)||w.length!==2)continue;const C=w[0],N=w[1];typeof C=="number"&&typeof N=="number"&&p.push(new st(C,N))}if(p.length<3)return null;p.length>1&&p[p.length-1].equals(p[0])&&p.pop();let g=0;for(let w=0;w<p.length;w++){const C=p[w],N=p[(w+1)%p.length],D=p[(w+2)%p.length];g+=(C.x-N.x)*(D.y-N.y)-(D.x-N.x)*(C.y-N.y)}g>0&&p.reverse();const x=cx(p.flatMap(w=>[w.x,w.y]),[]);return x.length===0?null:{vertices:p,indices:x}}function vfe(u,a){const c=[],p=[];let g=0;const x=[];for(const w of u){g=c.length;const C=w.vertexArray.float32,N=w.indexArray.uint16;for(let D=0;D<w.vertexArray.length;D++)x[0]=C[3*D+0],x[1]=C[3*D+1],x[2]=C[3*D+2],Ht(x,x,a),c.push(new st(x[0],x[1]));for(let D=0;D<3*w.indexArray.length;D++)p.push(N[D]+g)}if(p.length%3!=0)return null;for(let w=0;w<p.length;w+=3){const C=c[p[w+0]],N=c[p[w+1]],D=c[p[w+2]];(C.x-N.x)*(D.y-N.y)-(D.x-N.x)*(C.y-N.y)>0&&([p[w+1],p[w+2]]=[p[w+2],p[w+1]])}return{vertices:c,indices:p}}function cM(u){const a=function(N,D){const U=[],q=WebGL2RenderingContext;if(N.json.textures)for(const H of N.json.textures){const Y={magFilter:q.LINEAR,minFilter:q.NEAREST,wrapS:q.REPEAT,wrapT:q.REPEAT};H.sampler!==void 0&&Object.assign(Y,N.json.samplers[H.sampler]),U.push({image:D[H.source],sampler:Y,uploaded:!1})}return U}(u,u.images),c=function(N,D){const U=[];for(const q of N.json.meshes){const H=[];for(const Y of q.primitives)H.push(mfe(Y,N,D));U.push(H)}return U}(u,a),{scenes:p,scene:g,nodes:x}=u.json,w=p?p[g||0].nodes:[...x.keys()],C=[];for(const N of w)C.push(XV(x[N],u,c));return function(N,D,U){const q={},H=new Set;for(let Y=0;Y<N.length;Y++){const J=U[D[Y]];if(!J.extras)continue;const oe=J.extras["mapbox:footprint:version"],ce=J.extras["mapbox:footprint:id"];(oe||ce)&&H.add(Y),oe==="1.0.0"&&ce&&(q[ce]=Y)}for(let Y=0;Y<N.length;Y++){if(H.has(Y))continue;const J=N[Y],oe=U[D[Y]];if(!oe.extras)continue;let ce=null;J.id in q&&(ce=vfe(N[q[J.id]].meshes,J.localMatrix)),ce||(ce=yfe(oe)),ce&&(J.footprint=gfe(ce))}if(H.size>0){const Y=Array.from(H.values()).sort((J,oe)=>J-oe);for(let J=Y.length-1;J>=0;J--)N.splice(Y[J],1)}}(C,w,u.json.nodes),C}function _fe(u){u.heightmap=new Float32Array(4096),u.heightmap.fill(-1);const a=u.vertexArray.float32,c=u.aabb.min[0]-1,p=u.aabb.min[1]-1,g=Sy/(u.aabb.max[0]-c+2),x=Sy/(u.aabb.max[1]-p+2);for(let w=0;w<a.length;w+=3){const C=a[w+2],N=(a[w+0]-c)*g|0,D=(a[w+1]-p)*x|0;C>u.heightmap[D*Sy+N]&&(u.heightmap[D*Sy+N]=C)}}function YV(u,a,c,p,g){c.reserve(c.length+4*u.length),p.reserve(p.length+10*u.length),g.reserve(g.length+10*u.length);let x=p.length;for(const w of u){const C=Math.min(10,Math.max(4,1.3*w.height))*a,N=[-w.normal[1],w.normal[0],0],D=Math.min(.29,.1*w.width/w.depth),U=w.width-2*w.depth*a*(D+.01),q=Je([],w.pos,N,U/2),H=Je([],w.pos,N,-U/2),Y=[q[0],q[1],q[2]+w.height],J=[H[0],H[1],H[2]+w.height],oe=Je([],w.normal,N,D);Oe(oe,oe,C);const ce=Je([],w.normal,N,-D);Oe(ce,ce,C),_e(oe,q,oe),_e(ce,H,ce),q[2]+=.1,H[2]+=.1,p.emplaceBack(oe[0],oe[1],oe[2]),p.emplaceBack(ce[0],ce[1],ce[2]),p.emplaceBack(q[0],q[1],q[2]),p.emplaceBack(H[0],H[1],H[2]),p.emplaceBack(Y[0],Y[1],Y[2]),p.emplaceBack(J[0],J[1],J[2]),p.emplaceBack(q[0],q[1],q[2]),p.emplaceBack(H[0],H[1],H[2]),p.emplaceBack(oe[0],oe[1],oe[2]),p.emplaceBack(ce[0],ce[1],ce[2]);const he=U/C/2;g.emplaceBack(-he-D,-1,he,.8),g.emplaceBack(he+D,-1,he,.8),g.emplaceBack(-he,0,he,1.3),g.emplaceBack(he,0,he,1.3),g.emplaceBack(he+D,-.8,he,.7),g.emplaceBack(he+D,-.8,he,.7),g.emplaceBack(0,0,he,1.3),g.emplaceBack(0,0,he,1.3),g.emplaceBack(he+D,-1.2,he,.8),g.emplaceBack(he+D,-1.2,he,.8),c.emplaceBack(6+x,4+x,8+x),c.emplaceBack(7+x,9+x,5+x),c.emplaceBack(0+x,1+x,2+x),c.emplaceBack(1+x,3+x,2+x),x+=10}}function xfe(u,a){const c={};c.indexArray=new is,c.vertexArray=new Kl,c.colorArray=new uh,YV(u,a,c.indexArray,c.vertexArray,c.colorArray);const p={defined:!0};p.emissiveFactor=hi.black;const g={};return g.baseColorFactor=hi.white,p.pbrMetallicRoughness=g,c.material=p,c.aabb=new xn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),c}const JV=Cn([{name:"a_pos_3f",components:3,type:"Float32"}]),bfe=Cn([{name:"a_normal_3",components:3,type:"Int16"}]),wfe=Cn([{name:"a_centroid_3",components:3,type:"Int16"}]),QV=Cn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),Sfe=Cn([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),Efe=Cn([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),Tfe=Cn([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),Afe=Cn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),Cfe=Cn([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),e6=Bt.types,_C=32767;function jfe(u,a){const c=tr+a;for(const p of u)for(const g of p)if(g.x<-a||g.x>c||g.y<-a||g.y>c)return!1;return!0}class t6{constructor(){this.layoutVertexArray=new Kl,this.layoutAttenuationArray=new uh,this.layoutColorArray=new Oc,this.indexArray=new is,this.indexArrayForConflation=new is,this.segmentsBucket=new ds}}class uM{constructor(){this.layoutVertexArray=new Kl,this.layoutNormalArray=new bf,this.layoutCentroidArray=new bf,this.layoutColorArray=new Oc,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutFloodLightDataArray=new Q_,this.layoutAOArray=new md,this.indexArray=new is,this.indexArrayForConflation=new is,this.segmentsBucket=new ds,this.entranceBloom=new t6}}class r6{constructor(a){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new uM,this.buildingWithFacade=new uM,this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.footprintLookup={},this.zoom=a.zoom,this.canonical=a.canonical,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.worldview=a.worldview,this.lut=a.lut,this.buildingWithFacade.layoutFacadePaintArray=new Oc,this.buildingWithFacade.layoutFacadeDataArray=new wf,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new Oc,this.programConfigurations=new nu(a.layers,{zoom:a.zoom,lut:a.lut}),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.projection=a.projection,this.groundEffect=new KR(a),this.groundEffect.groundRadiusArray=new md,this.hasAppearances=null}updateFootprints(a,c){for(const p of this.footprints)c.push({footprint:p,id:a})}updateAppearances(a,c,p,g){}prepare(){return function(){if(dC!=null||MV!=null)return null;if(px!=null)return px;const a=fetch(Ji.BUILDING_GEN_URL);return px=function(c){let p,g,x,w;function C(){p=new Uint8Array(w.buffer),g=new Int32Array(w.buffer),x=new Float32Array(w.buffer)}function N(){throw new Error("Unexpected BuildingGen error.")}const D=()=>{},U={a:{a:N,f:function(q){const H=p.length,Y=Math.max(q>>>0,Math.ceil(1.2*H)),J=Math.ceil((Y-H)/65536);try{return w.grow(J),C(),!0}catch{return!1}},g:N,b:D,c:D,d:D,e:D}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(c,U):c.then(q=>q.arrayBuffer()).then(q=>WebAssembly.instantiate(q,U))).then(q=>{const H=q.instance.exports;return(0,H.g)(),w=H.f,C(),new efe({setStyle:H.h,setAOOptions:H.i,setMetricOptions:H.j,setStructuralOptions:H.k,setFacadeOptions:H.l,setFauxFacadeOptions:H.m,setFacadeClassifierOptions:H.n,addFeature:H.o,addFacade:H.p,generateMesh:H.q,getLastError:H.r,getOuterRingLength:H.s,getMeshCount:H.t,getPositionsPtr:H.u,getPositionsLength:H.v,getNormalsPtr:H.w,getNormalsLength:H.x,getColorsPtr:H.y,getColorsLength:H.z,getAOPtr:H.A,getAOLength:H.B,getUVPtr:H.C,getUVLength:H.D,getFauxFacadePtr:H.E,getFauxFacadeLength:H.F,getIndicesPtr:H.G,getIndicesLength:H.H,getBuildingPart:H.I,getRingCount:H.J,getRingPtr:H.K,getRingLength:H.L,free:H.M,malloc:H.N,heapU8:p,heap32:g,heapF32:x})})}(a).then(c=>(px=null,dC=c,dC)).catch(c=>{zr("Could not load building-gen"),px=null,MV=c}),px}()}populate(a,c,p,g){const x=tfe();if(!x)return;const w=Ke(p);this.tileToMeter=w,this.brightness=c.brightness,x.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,w],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:w,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),x.setAOOptions(!1,.3),x.setMetricOptions(!1,16),x.setStructuralOptions(!0),x.setFacadeClassifierOptions(3);const C=new Map,N=new Map;for(const{feature:D}of a){if(e6[D.type]!=="LineString"){C.set(D.id,D.properties.source_id);continue}const U=this.layers[0]._featureFilter.needGeometry,q=vt(D,U);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),q,p))continue;const H=U?q.geometry:It(D,p,g),Y=[];for(const he of H)for(const Se of he)Y.push({x:Se.x,y:Se.y});const J={coordinates:Y,crossPerc:D.properties.cross_perc,distanceToRoad:D.properties.distance_to_road,entrances:D.properties.entrances,sourceId:0},oe=D.properties.source_id;let ce=N.get(oe);ce||(ce=[],N.set(oe,ce)),ce.push(J)}this.maxHeight=0;for(const{feature:D,id:U,index:q,sourceLayerIndex:H}of a){if(e6[D.type]==="LineString")continue;const Y=this.layers[0]._featureFilter.needGeometry,J=vt(D,Y);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),J,p))continue;const oe=Y?J.geometry:It(D,p,g),ce=X1(oe,500);if(!jfe(oe,163))continue;const he=this.layers[0],Se=he.layout.get("building-roof-shape").evaluate(D,{},p);if(Se==="flat")continue;const Te=he.layout.get("building-base").evaluate(D,{},p),ke=he.layout.get("building-height").evaluate(D,{},p),qe=he.layout.get("building-flood-light-ground-radius").evaluate(D,{},p),Fe=he.paint.get("building-ambient-occlusion-intensity"),Xe=qe/this.tileToMeter;let et=he.layout.get("building-flood-light-wall-radius").evaluate(D,{},p);et=ve(et,0,2048);const it=et/2048*_C,At=C.get(U);let pt;pt=N.has(At)?N.get(At):[];const jt=pt.length!==0&&he.layout.get("building-facade").evaluate(D,{},p);x.setFacadeOptions(4,!0),x.setFauxFacadeOptions(jt,!1,1);let Rt=0,zt=0,Yt=0,qt=0,Dt=0,Vt=0;if(jt){let kt=Math.round(he.layout.get("building-facade-floors").evaluate(D,{},p));if(Te===0){kt=Math.max(1,kt-(pt.length>0?1:0));let jr=4;if(ke>100){const Tr=[10,13,15];jr=Tr[D.id?D.id%Tr.length:0],x.setFacadeOptions(jr,!0)}Dt=1.6803*jr/w}else Dt=Te/w;Vt=ke/w,Dt=Math.min(Dt,Vt),Yt=he.layout.get("building-facade-unit-width").evaluate(D,{},p)/w,qt=(Vt-Dt)/kt,x.setFauxFacadeOptions(!0,!0,Yt);const or=he.layout.get("building-facade-window").evaluate(D,{},p);Rt=or[0],zt=or[1]}const St=[],xt=new st(1/0,1/0),$t=new st(-1/0,-1/0),Kt=new st(0,0);let Ft=0;for(const kt of ce)if(kt.length>0){const or=[];for(const jr of kt){const Tr=[];for(let cn=jr.length-1;cn>=0;cn--){const qr=jr[cn];Tr.push({x:qr.x,y:qr.y}),xt.x=Math.min(xt.x,qr.x),xt.y=Math.min(xt.y,qr.y),$t.x=Math.max($t.x,qr.x),$t.y=Math.max($t.y,qr.y),Kt.x+=qr.x,Kt.y+=qr.y,Ft++}or.push(Tr)}St.push({id:D.id?D.id:0,height:ke,minHeight:Te,sourceId:0,roofType:Se,coordinates:or})}Kt.x/=Ft||1,Kt.y/=Ft||1;const gr=x.generateMesh(St,pt);if(typeof gr=="string"){zr(`Unable to generate building ${D.id}: ${gr}`);continue}if(gr.meshes.length===0||gr.modifiedPolygonRings.length===0)continue;let br=0;for(const kt of gr.meshes)br+=kt.positions.length/3;const hr=jt?this.buildingWithFacade:this.buildingWithoutFacade,ar=hr.segmentsBucket.prepareSegment(br,hr.layoutVertexArray,hr.indexArray),en=[];let lr=null,Lr=0,rn=-1;const Sn=hr.layoutVertexArray.length,qn=hr.indexArray.length;let on=0;for(const kt of gr.meshes){const or=hr.layoutVertexArray.length;if(kt.buildingPart==="entrance"){const Sr=new Array;for(let Bn=0;Bn<kt.positions.length;Bn+=12){const Ci=kt.positions[Bn+0],fi=kt.positions[Bn+1],_s=kt.positions[Bn+3],es=kt.positions[Bn+4],Bi=kt.positions[Bn+2],xi=kt.positions[Bn+8]-Bi,ni=1,un=_s-Ci,ii=es-fi,$i=Math.hypot(un,ii);Sr.push({pos:[Ci+.5*un,fi+.5*ii,Bi],normal:[ii/$i,-un/$i,0],width:$i,height:xi,depth:ni,points:[Ci,fi,_s,es]})}const Jn=hr.entranceBloom.segmentsBucket.prepareSegment(10*Sr.length,hr.entranceBloom.layoutVertexArray,hr.entranceBloom.indexArray),Ai=hr.entranceBloom.layoutVertexArray.length;Lr=hr.entranceBloom.indexArray.length,YV(Sr,.5/this.tileToMeter,hr.entranceBloom.indexArray,hr.entranceBloom.layoutVertexArray,hr.entranceBloom.layoutAttenuationArray);const Wr=hr.entranceBloom.layoutVertexArray.length-Ai;rn=hr.entranceBloom.indexArray.length-Lr;for(let Bn=0;Bn<Wr;Bn++)hr.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Jn.vertexLength+=Wr,Jn.primitiveLength+=rn,lr={part:kt.buildingPart,vertexOffset:Ai,vertexLength:Wr}}for(let Sr=0;Sr<kt.positions.length;Sr+=3)on=Math.max(on,kt.positions[Sr+2]),hr.layoutVertexArray.emplaceBack(kt.positions[Sr],kt.positions[Sr+1],kt.positions[Sr+2]);const jr=Math.floor(Kt.x),Tr=Math.floor(Kt.y),cn=Math.floor(on);for(let Sr=0;Sr<kt.positions.length;Sr+=3)hr.layoutCentroidArray.emplaceBack(jr,Tr,cn),hr.layoutFloodLightDataArray.emplaceBack(kt.buildingPart==="wall"?it:0);for(let Sr=0;Sr<kt.normals.length;Sr+=3)hr.layoutNormalArray.emplaceBack(kt.normals[Sr+0]*_C,kt.normals[Sr+1]*_C,kt.normals[Sr+2]*_C);for(let Sr=0;Sr<kt.ao.length;Sr++)hr.layoutAOArray.emplaceBack(kt.ao[Sr]);for(let Sr=0;Sr<kt.colors.length;Sr+=3){const Jn=1+(kt.ao[Sr/3]-1)*Fe;hr.layoutColorArray.emplaceBack(kt.colors[Sr]*Jn<<8|kt.colors[Sr+1]*Jn,kt.colors[Sr+2]*Jn<<8)}if(jt){for(let Sr=0;Sr<kt.positions.length;Sr+=3)hr.layoutFacadePaintArray.emplaceBack(65535,255);for(let Sr=0;Sr<kt.isFauxFacade.length;Sr++)if(kt.isFauxFacade[Sr]){const Jn=1|Math.min(65535,Math.floor(kt.uv[2*Sr]*gr.outerRingLength)),Ai=Math.floor(255*Rt)<<8|Math.floor(255*zt),Wr=Math.floor(65535*Math.min(1,Yt/tr)),Bn=Math.floor(65535*Math.min(1,qt/tr));hr.layoutFacadeDataArray.emplaceBack(Jn,Ai,Wr,Bn);const Ci=Math.floor(65535*Math.min(1,Dt/tr)),fi=Math.floor(65535*Math.min(1,Vt/tr));hr.layoutFacadeVerticalRangeArray.emplaceBack(Ci,fi)}else hr.layoutFacadeDataArray.emplaceBack(0,0,0,0),hr.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const qr=ar.vertexLength;for(let Sr=0;Sr<kt.indices.length;Sr+=3)hr.indexArray.emplaceBack(qr+kt.indices[Sr],qr+kt.indices[Sr+1],qr+kt.indices[Sr+2]);ar.vertexLength+=kt.positions.length/3,ar.primitiveLength+=kt.indices.length/3,(kt.buildingPart==="roof"||kt.buildingPart==="wall"||kt.buildingPart==="facade_glazing"||kt.buildingPart==="entrance")&&en.push({part:kt.buildingPart,vertexOffset:or,vertexLength:kt.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,on),this.buildingFeatures.push({promoteId:U,feature:J,hasFauxFacade:jt,segment:ar,parts:en,buildingBloom:lr});const ti=hr.indexArray.length-qn,ri=[],cs=[],ze=new st(1/0,1/0),Re=new st(-1/0,-1/0),Ot=this.groundEffect.vertexArray.length;for(const kt of gr.modifiedPolygonRings){const or=[],jr=new st(1/0,1/0),Tr=new st(-1/0,-1/0);for(let cn=0;cn<kt.length;cn+=2){const qr=kt.length-cn-2;jr.x=Math.min(jr.x,kt[qr]),jr.y=Math.min(jr.y,kt[qr+1]),Tr.x=Math.max(Tr.x,kt[qr]),Tr.y=Math.max(Tr.y,kt[qr+1]);const Sr=new st(kt[qr],kt[qr+1]);or.push(Sr),ri.push(Sr.x,Sr.y),cs.push(Sr.clone())}ze.x=Math.min(ze.x,jr.x),ze.y=Math.min(ze.y,jr.y),Re.x=Math.max(Re.x,Tr.x),Re.y=Math.max(Re.y,Tr.y),this.groundEffect.addData(or,[jr,Tr],Xe)}const ir=this.groundEffect.vertexArray.length-Ot;for(let kt=0;kt<ir;kt++)this.groundEffect.groundRadiusArray.emplaceBack(qe);(xt.x<0||$t.x>tr||xt.y<0||$t.y>tr)&&this.featuresOnBorder.push({featureId:D.id,footprintIndex:this.footprints.length});{const kt=cx(ri,null,2),or=new iC(cs,kt,8,256);let jr=D.id;D.properties&&D.properties.hasOwnProperty("building_id")&&(jr=D.properties.building_id);const Tr={vertices:cs,indices:kt,grid:or,min:ze,max:Re,buildingId:jr,hiddenFlags:0,indicesOffset:qn,indicesLength:ti,bloomIndicesOffset:Lr,bloomIndicesLength:rn,groundEffectVertexOffset:Ot,groundEffectVertexLength:ir,hasFauxFacade:jt,segment:ar,height:on};D.id!==void 0&&this.featureFootprintLookup.set(D.id,this.footprints.length),this.footprints.push(Tr)}this.programConfigurations.populatePaintArrays(hr.layoutVertexArray.length,D,q,{},c.availableImages,p,c.brightness),this.groundEffect.addPaintPropertiesData(D,q,{},c.availableImages,p,c.brightness),c.featureIndex.insert(D,oe,q,H,this.index,Sn)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(a,c,p,g,x,w,C){this.programConfigurations.updatePaintArrays(a,c,x,p,g,w,C),this.groundEffect.update(a,c,x,p,g,w,C),this.evaluate(this.layers[0],a),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(a){const c=p=>{p.layoutVertexBuffer=a.createVertexBuffer(p.layoutVertexArray,JV.members),p.layoutNormalBuffer=a.createVertexBuffer(p.layoutNormalArray,bfe.members),p.layoutCentroidBuffer=a.createVertexBuffer(p.layoutCentroidArray,wfe.members),p.layoutFloodLightDataBuffer=a.createVertexBuffer(p.layoutFloodLightDataArray,Cfe.members),p.layoutFacadeDataArray&&p.layoutFacadeDataArray.length&&(p.layoutFacadeDataBuffer=a.createVertexBuffer(p.layoutFacadeDataArray,Efe.members)),p.layoutFacadeVerticalRangeArray&&p.layoutFacadeVerticalRangeArray.length&&(p.layoutFacadeVerticalRangeBuffer=a.createVertexBuffer(p.layoutFacadeVerticalRangeArray,Tfe.members)),p.entranceBloom.layoutVertexArray.length&&(p.entranceBloom.layoutVertexBuffer=a.createVertexBuffer(p.entranceBloom.layoutVertexArray,JV.members),p.entranceBloom.layoutAttenuationBuffer=a.createVertexBuffer(p.entranceBloom.layoutAttenuationArray,Afe.members)),this.uploadUpdatedColorBuffer(a),this.uploadUpdatedIndexBuffer(a)};this.uploaded||(c(this.buildingWithoutFacade),c(this.buildingWithFacade),this.groundEffect.upload(a)),this.groundEffect.uploadPaintProperties(a),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){const a=c=>{c.layoutVertexBuffer&&(c.layoutVertexBuffer.destroy(),c.layoutNormalBuffer.destroy(),c.layoutColorBuffer.destroy(),c.segmentsBucket.destroy(),c.indexBuffer&&c.indexBuffer.destroy(),c.entranceBloom.layoutVertexBuffer&&(c.entranceBloom.layoutVertexBuffer.destroy(),c.entranceBloom.layoutColorBuffer.destroy(),c.entranceBloom.layoutAttenuationBuffer.destroy(),c.entranceBloom.indexBuffer.destroy(),c.entranceBloom.segmentsBucket.destroy()))};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(a,c,p=!0){let g=!1;const x=p?c:0,w=0|(p?-1:~c);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const C of a){const N=this.footprints[C],D=N.hiddenFlags&w|x;N.hiddenFlags!==D&&(N.hiddenFlags=D,g=!0,this.groundEffect.updateHiddenByLandmarkRange(N.groundEffectVertexOffset,N.groundEffectVertexLength,N.hiddenFlags!==0))}return g&&(this.indexArrayForConflationUploaded=!1),g}uploadUpdatedIndexBuffer(a){if(this.groundEffect.uploadHiddenByLandmark(a),this.indexArrayForConflationUploaded)return;const c=g=>{g.indexArray.length!==0&&(g.indexArrayForConflation.resize(g.indexArray.length),g.indexArrayForConflation.uint16.set(g.indexArray.uint16),g.entranceBloom.indexArrayForConflation.resize(g.entranceBloom.indexArray.length),g.entranceBloom.indexArrayForConflation.uint16.set(g.entranceBloom.indexArray.uint16))};c(this.buildingWithoutFacade),c(this.buildingWithFacade);for(const g of this.footprints){const x=g.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,w=g.indicesOffset+g.indicesLength;if(g.hiddenFlags!==0){for(let N=g.indicesOffset;N<w;N++)x.indexArrayForConflation.uint16[3*N+0]=0,x.indexArrayForConflation.uint16[3*N+1]=0,x.indexArrayForConflation.uint16[3*N+2]=0;const C=g.bloomIndicesOffset+g.bloomIndicesLength;for(let N=g.bloomIndicesOffset;N<C;N++)x.entranceBloom.indexArrayForConflation.uint16[3*N+0]=0,x.entranceBloom.indexArrayForConflation.uint16[3*N+1]=0,x.entranceBloom.indexArrayForConflation.uint16[3*N+2]=0}}const p=g=>{g.indexArray.length!==0&&(g.indexBuffer?g.indexBuffer.updateData(g.indexArrayForConflation):g.indexBuffer=a.createIndexBuffer(g.indexArrayForConflation,!0),g.entranceBloom.indexBuffer?g.entranceBloom.indexBuffer.updateData(g.entranceBloom.indexArrayForConflation):g.entranceBloom.indexBuffer=a.createIndexBuffer(g.entranceBloom.indexArrayForConflation,!0))};p(this.buildingWithoutFacade),p(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(a){const c=p=>{p.layoutColorBuffer?p.layoutColorBuffer.updateData(p.layoutColorArray):p.layoutColorBuffer=a.createVertexBuffer(p.layoutColorArray,QV.members,!0),p.layoutFacadePaintArray&&(p.layoutFacadePaintBuffer?p.layoutFacadePaintBuffer.updateData(p.layoutFacadePaintArray):p.layoutFacadePaintBuffer=a.createVertexBuffer(p.layoutFacadePaintArray,Sfe.members,!0)),p.entranceBloom.layoutColorBuffer?p.entranceBloom.layoutColorBuffer.updateData(p.entranceBloom.layoutColorArray):p.entranceBloom.layoutColorBuffer=a.createVertexBuffer(p.entranceBloom.layoutColorArray,QV.members,!0)};c(this.buildingWithoutFacade),c(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(a,c){const p=a.paint.get("building-ambient-occlusion-intensity");for(const g of this.buildingFeatures){const x=c[g.promoteId],w=g.feature;w.properties["building-part"]="roof";const C=a.paint.get("building-color").evaluate(w,x,this.canonical).toPremultipliedRenderColor(this.lut),N=a.paint.get("building-emissive-strength").evaluate(w,x,this.canonical);w.properties["building-part"]="wall";const D=a.paint.get("building-color").evaluate(w,x,this.canonical).toPremultipliedRenderColor(this.lut),U=a.paint.get("building-emissive-strength").evaluate(w,x,this.canonical);w.properties["building-part"]="window";const q=a.paint.get("building-color").evaluate(w,x,this.canonical).toPremultipliedRenderColor(this.lut),H=a.paint.get("building-emissive-strength").evaluate(w,x,this.canonical);w.properties["building-part"]="door";const Y=a.paint.get("building-color").evaluate(w,x,this.canonical).toPremultipliedRenderColor(this.lut),J=a.paint.get("building-emissive-strength").evaluate(w,x,this.canonical),oe=g.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const he of g.parts){let Se,Te=C;he.part==="roof"?(Te=C,Se=N):he.part==="wall"?(Te=D,Se=U):he.part==="facade_glazing"?(Te=q,Se=H):he.part==="entrance"&&(Te=Y,Se=J),Se=ve(Se,0,1);for(let ke=0;ke<he.vertexLength;ke++){const qe=he.vertexOffset+ke,Fe=1+(oe.layoutAOArray.float32[qe]-1)*p;oe.layoutColorArray.emplace(qe,Te.r*Fe*255<<8|Te.g*Fe*255,Te.b*Fe*255<<8|255*Se),g.hasFauxFacade&&oe.layoutFacadePaintArray.emplace(qe,255*q.r<<8|255*q.g,255*q.b<<8|255*H)}}const ce=g.buildingBloom;if(ce)for(let he=0;he<ce.vertexLength;he++)oe.entranceBloom.layoutColorArray.emplace(ce.vertexOffset+he,255*Y.r<<8|255*Y.g,255*Y.b<<8|51*J)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(a,c,p){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const g=c.getReplacementRegionsForTile(a.toUnwrapped());if(aC(this.activeReplacements,g))return;this.activeReplacements=g;for(const w of this.footprints)w.hiddenFlags&=-2;const x=[];for(const w of this.activeReplacements){if(w.order<=nV)continue;const C=Math.max(1,Math.pow(2,w.footprintTileId.canonical.z-a.canonical.z));for(const N of this.footprints)N.min.x>w.max.x||N.max.x<w.min.x||N.min.y>w.max.y||N.max.y<w.min.y||(x.length=0,Pfe(N.vertices,0,N.vertices.length,w.footprintTileId.canonical,a.canonical,x),qR(w.footprint,x,N.indices,0,N.indices.length,0,-C)&&(N.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const w of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(w.groundEffectVertexOffset,w.groundEffectVertexLength,w.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(a){if(a.id!==void 0){const c=this.featureFootprintLookup.get(a.id);return this.footprints[c]}return null}getHeightAtTileCoord(a,c){let p=Number.NEGATIVE_INFINITY,g=!0;const x=4*(a+tr)*tr+(c+tr);if(this.footprintLookup.hasOwnProperty(x)){const C=this.footprintLookup[x];return C?{height:C.height,hidden:C.hiddenFlags!==0}:void 0}const w=new st(a,c);for(const C of this.footprints)a>C.max.x||C.min.x>a||c>C.max.y||C.min.y>c||C.height<=p||HR(w,C)&&(p=C.height,this.footprintLookup[x]=C,g=C.hiddenFlags!==0);if(p!==Number.NEGATIVE_INFINITY)return{height:p,hidden:g};this.footprintLookup[x]=void 0}}function Pfe(u,a,c,p,g,x){const w=Math.pow(2,p.z-g.z);for(let C=0;C<c;C++){let N=u[C+a].x,D=u[C+a].y;N=(N+g.x*tr)*w-p.x*tr,D=(D+g.y*tr)*w-p.y*tr,x.push(new st(N,D))}}let n6,i6;_r(r6,"BuildingBucket",{omit:["layers"]}),_r(uM,"BuildingGeometry"),_r(t6,"BuildingBloomGeometry");const Ofe=Cn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),kfe=Cn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Nfe}=Ofe,Ife=Cn([{name:"a_packed",components:3,type:"Float32"}]),{members:Rfe}=Ife,Mfe=Cn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Dfe}=Mfe;class s6{constructor(a,c){this.width=a,this.height=c,this.nextRow=0,this.image=new nm({width:a,height:c}),this.positions={},this.uploaded=!1}getDash(a,c){const p=this.getKey(a,c);return this.positions[p]}trim(){const a=this.width,c=this.height=ct(this.nextRow);this.image.resize({width:a,height:c})}getKey(a,c){return a.join(",")+c}getDashRanges(a,c,p){const g=[];let x=a.length%2==1?-a[a.length-1]*p:0,w=a[0]*p,C=!0;g.push({left:x,right:w,isDash:C,zeroLength:a[0]===0});let N=a[0];for(let D=1;D<a.length;D++){C=!C;const U=a[D];x=N*p,N+=U,w=N*p,g.push({left:x,right:w,isDash:C,zeroLength:U===0})}return g}addRoundDash(a,c,p){const g=c/2;for(let x=-p;x<=p;x++){const w=this.width*(this.nextRow+p+x);let C=0,N=a[C];for(let D=0;D<this.width;D++){D/N.right>1&&(N=a[++C]);const U=Math.abs(D-N.left),q=Math.abs(D-N.right),H=Math.min(U,q);let Y;const J=x/p*(g+1);if(N.isDash){const oe=g-Math.abs(J);Y=Math.sqrt(H*H+oe*oe)}else Y=g-Math.sqrt(H*H+J*J);this.image.data[w+D]=Math.max(0,Math.min(255,Y+128))}}}addRegularDash(a,c){for(let N=a.length-1;N>=0;--N){const D=a[N],U=a[N+1];D.zeroLength?a.splice(N,1):U&&U.isDash===D.isDash&&(U.left=D.left,a.splice(N,1))}const p=a[0],g=a[a.length-1];p.isDash===g.isDash&&(p.left=g.left-this.width,g.right=p.right+this.width);const x=this.width*this.nextRow;let w=0,C=a[w];for(let N=0;N<this.width;N++){N/C.right>1&&(C=a[++w]);const D=Math.abs(N-C.left),U=Math.abs(N-C.right),q=Math.min(D,U);this.image.data[x+N]=Math.max(0,Math.min(255,(C.isDash?q:-q)+c+128))}}addDash(a,c){const p=this.getKey(a,c);if(this.positions[p])return this.positions[p];const g=c==="round",x=g?7:0,w=2*x+1;if(this.nextRow+w>this.height)return zr("LineAtlas out of space"),null;a.length===0&&a.push(1);let C=0;for(let U=0;U<a.length;U++)a[U]<0&&(zr("Negative value is found in line dasharray, replacing values with 0"),a[U]=0),C+=a[U];if(C!==0){const U=this.width/C,q=this.getDashRanges(a,this.width,U);g?this.addRoundDash(q,U,x):this.addRegularDash(q,c==="square"?.5*U:0)}const N=this.nextRow+x;this.nextRow+=w;const D={tl:[N,x],br:[C,0]};return this.positions[p]=D,D}}_r(s6,"LineAtlas");const Lfe=Bt.types,Ffe=Math.cos(Math.PI/180*37.5),zfe=Math.cos(Math.PI/180*5);class dM{constructor(a){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=a.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=a.overscaling,this.pixelRatio=a.pixelRatio,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.projection=a.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new Z_,this.layoutVertexArray2=new Kl,this.patternVertexArray=new Kl,this.indexArray=new is,this.programConfigurations=new nu(a.layers,{zoom:a.zoom,lut:a.lut}),this.segments=new ds,this.maxLineLength=0,this.zOffsetVertexArray=new Kl,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.tessellationStep=a.tessellationStep?a.tessellationStep:tr/64,this.worldview=a.worldview,this.hasAppearances=null}updateFootprints(a,c){}updateAppearances(a,c,p,g){}populate(a,c,p,g){this.hasPattern=FR("line",this.layers,this.pixelRatio,c);const x=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Ke(p);const w=this.layers[0].layout.get("line-elevation-reference");if(w==="hd-road-markup")this.elevationType="road";else{const H=this.layers[0].layout.get("line-z-offset"),Y=H.isConstant()&&!H.constantOr(0);this.elevationType=w!=="sea"&&w!=="ground"&&Y?"none":"offset",this.elevationType==="offset"&&w==="none"&&zr(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const C=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&C!==void 0;const N=[];for(const{feature:H,id:Y,index:J,sourceLayerIndex:oe}of a){const ce=this.layers[0]._featureFilter.needGeometry,he=vt(H,ce);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),he,p))continue;const Se=x?x.evaluate(he,{},p):void 0,Te={id:Y,properties:H.properties,type:H.type,sourceLayerIndex:oe,index:J,geometry:ce?he.geometry:It(H,p,g),patterns:{},sortKey:Se};N.push(Te)}x&&N.sort((H,Y)=>H.sortKey-Y.sortKey);const{lineAtlas:D,featureIndex:U}=c,q=this.addConstantDashes(D);for(const H of N){const{geometry:Y,index:J,sourceLayerIndex:oe}=H;if(q&&this.addFeatureDashes(H,D),this.hasPattern){const ce=zR("line",this.layers,H,this.zoom,this.pixelRatio,c);this.patternFeatures.push(ce)}else this.addFeature(H,Y,J,p,D.positions,c.availableImages,c.brightness,c.elevationFeatures);U.insert(a[J].feature,Y,J,oe,this.index)}}addConstantDashes(a){let c=!1;for(const p of this.layers){const g=p.paint.get("line-dasharray").value,x=p.layout.get("line-cap").value;if(g.kind!=="constant"||x.kind!=="constant")c=!0;else{const w=x.value,C=g.value;if(!C)continue;a.addDash(C,w)}}return c}addFeatureDashes(a,c){const p=this.zoom;for(const g of this.layers){const x=g.paint.get("line-dasharray").value,w=g.layout.get("line-cap").value;if(x.kind==="constant"&&w.kind==="constant")continue;let C,N;if(x.kind==="constant"){if(C=x.value,!C)continue}else C=x.evaluate({zoom:p},a);N=w.kind==="constant"?w.value:w.evaluate({zoom:p},a),c.addDash(C,N),a.patterns[g.id]=[c.getKey(C,N)]}}update(a,c,p,g,x,w,C,N){this.programConfigurations.updatePaintArrays(a,c,x,p,g,w,C,N)}addFeatures(a,c,p,g,x,w){for(const C of this.patternFeatures)this.addFeature(C,C.geometry,C.index,c,p,g,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,Rfe)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=a.createVertexBuffer(this.patternVertexArray,Dfe)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=a.createVertexBuffer(this.zOffsetVertexArray,kfe.members,!0)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Nfe),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a,c){let p,g;if(c&&c>0?(p=`mapbox_clip_start_${c}`,g=`mapbox_clip_end_${c}`):(p="mapbox_clip_start",g="mapbox_clip_end"),a.properties&&a.properties.hasOwnProperty(p)&&a.properties.hasOwnProperty(g))return{start:+a.properties[p],end:+a.properties[g]}}addFeature(a,c,p,g,x,w,C,N){const D=this.layers[0].layout,U=D.get("line-join").evaluate(a,{}),q=D.get("line-cap").evaluate(a,{}),H=D.get("line-miter-limit"),Y=D.get("line-round-limit");this.lineClips=this.lineFeatureClips(a),this.lineFeature=a;const J=!(!a.properties||!a.properties.hasOwnProperty("mapbox_line_metrics"))&&a.properties.mapbox_line_metrics;this.zOffsetValue=D.get("line-z-offset").value;const oe=this.layers[0].paint.get("line-width").value;if(oe.kind!=="constant"&&oe.isLineProgressConstant===!1&&(this.variableWidthValue=oe),this.elevationType==="road"){const ce=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(a,c,g,N,U,q,H,Y)){const[he,Se]=this.clipRuntimeLinesToTile(c,1);for(let Te=0;Te<he.length;Te++){const ke=he[Te],qe=Se[Te],Fe={progress:{min:qe.progress.min,max:qe.progress.max},nextDir:this.computeSegNextDir(qe,ke),prevDir:this.computeSegPrevDir(qe,ke)};this.addLine(ke,a,g,U,q,H,Y,Fe,J&&qe.parentIndex>0?qe.parentIndex:null)}this.fillNonElevatedRoadSegment(ce)}}else for(let ce=0;ce<c.length;ce++)this.addLine(c[ce],a,g,U,q,H,Y,void 0,J&&ce>0?ce:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,x,w,g,C,void 0,this.worldview)}computeSegNextDir(a,c){return a.nextPoint.sub(c.at(-2)).unit()}computeSegPrevDir(a,c){return c[1].sub(a.prevPoint).unit()}clipLinesToTile(a,c){return cC(a,-c,-c,tr+c,tr+c)}clipRuntimeLinesToTile(a,c){const p=[];return[cC(a,-c,-c,tr+c,tr+c,p),p]}addElevatedRoadFeature(a,c,p,g,x,w,C,N){const D=[],U=Qr.getElevationFeature(a,g);if(U){const q=this.clipLinesToTile(c,1),H=this.prepareElevatedLines(q,U,p);for(const Y of H)D.push({geometry:Y,elevation:U,elevationTileID:p,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(D.length===0)return!1;for(const q of D){const H=this.layoutVertexArray.length;this.addLine(q.geometry,a,p,x,w,C,N);const Y=new Vn(p,q.elevationTileID);if(q.elevation)for(let J=H;J<this.layoutVertexArray.length;J++){const oe=new st(this.layoutVertexArray.int16[6*J]>>1,this.layoutVertexArray.int16[6*J+1]>>1),ce=Y.pointElevation(oe,q.elevation,.05);this.updateHeightRange(ce),this.zOffsetVertexArray.emplaceBack(ce,0,0)}else this.fillNonElevatedRoadSegment(H)}return!0}prepareElevatedLines(a,c,p){if(c.constantHeight!=null)return a;const g=[],x=1/Ke(p);for(const w of a)Yhe(w,new Wi(c,x),0,g);return g}fillNonElevatedRoadSegment(a){for(let c=a;c<this.layoutVertexArray.length;c++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(a){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,a),this.heightRange.max=Math.max(this.heightRange.max,a)):this.heightRange={min:a,max:a}}addLine(a,c,p,g,x,w,C,N,D){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=D?this.lineFeatureClips(c,D):this.lineClips;const U=g==="none";this.patternJoinNone=this.hasPattern&&U,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const q=N&&N.progress.min>0,H=N&&N.progress.max<1;if(this.lineClips){let it={min:this.lineClips.start,max:this.lineClips.end},At=1;if(N){const Rt=this.lineClips.end-this.lineClips.start;it=function(zt,Yt,qt){return{min:Ti(zt.min,Yt,qt),max:Ti(zt.max,Yt,qt)}}(N.progress,{min:0,max:1},it),Rt>0&&(At=(it.max-it.min)/Rt)}const pt=+c.properties.mapbox_clip_feature_len,jt=+c.properties.mapbox_clip_seg_len;if(Number.isNaN(pt)||Number.isNaN(jt)){for(let zt=0;zt<a.length-1;zt++)this.totalDistance+=a[zt].dist(a[zt+1]);const Rt=this.totalDistance/(it.max-it.min);this.totalFeatureLength=Number.isFinite(Rt)?Rt:0,this.lineClips.start=it.min,this.lineClips.end=it.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=pt,this.distance=jt*At,this.lineClips.start=it.min,this.lineClips.end=it.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const Y=Lfe[c.type]==="Polygon";let J=a.length;for(;J>=2&&a[J-1].equals(a[J-2]);)J--;let oe=0;for(;oe<J-1&&a[oe].equals(a[oe+1]);)oe++;if(J<(Y?3:2))return;g==="bevel"&&(w=1.05);const ce=this.segments.prepareSegment(10*J,this.layoutVertexArray,this.indexArray);let he,Se,Te,ke,qe,Fe,Xe,et;N&&N.prevDir&&(Fe=N.prevDir.perp()),N&&N.nextDir&&(Xe=N.nextDir.perp()),this.e1=this.e2=-1,Y&&(he=a[J-2],qe=a[oe].sub(he)._unit()._perp());for(let it=oe;it<J;it++){if(Te=it===J-1?Y?a[oe+1]:void 0:a[it+1],Te&&a[it].equals(Te))continue;qe&&(ke=qe),he&&(Se=he),he=a[it],et=this.evaluateLineProgressFeatures(Se?Se.dist(he):0),qe=Te?Te.sub(he)._unit()._perp():ke,ke=ke||qe;const At=Se&&Te;let pt=At?g:Y||U?"butt":x;const jt=ke.x*qe.x+ke.y*qe.y;if(U){const xt=function($t){if($t.patternJoinNone){const Kt=$t.segmentPoints.length/2,Ft=$t.lineSoFar-$t.segmentStart;for(let gr=0;gr<Kt;++gr){const br=$t.segmentPoints[2*gr+1],hr=Math.round($t.segmentPoints[2*gr])+.5+.25*br;$t.patternVertexArray.emplaceBack(hr,Ft,$t.segmentStart),$t.patternVertexArray.emplaceBack(hr,Ft,$t.segmentStart)}$t.segmentPoints.length=0}$t.e1=$t.e2=-1};if(At&&jt<zfe){this.updateDistance(Se,he),this.addCurrentVertex(he,ke,1,1,ce,et),xt(this),this.addCurrentVertex(he,qe,-1,-1,ce,et);continue}if(Se){if(!Te){this.updateDistance(Se,he),this.addCurrentVertex(he,ke,1,1,ce,et),xt(this);continue}pt="miter"}}let Rt=ke.add(qe);Rt.x===0&&Rt.y===0||Rt._unit();const zt=Rt.x*qe.x+Rt.y*qe.y,Yt=zt!==0?1/zt:1/0,qt=2*Math.sqrt(2-2*zt),Dt=zt<Ffe&&Se&&Te,Vt=ke.x*qe.y-ke.y*qe.x>0,St=this.overscaling<=16?15*tr/(512*this.overscaling):0;if(At&&pt==="round"){if(Yt<C)pt="miter";else if(Yt<=2){const xt=hM(he,-10,tr+10);pt=this.elevationType==="offset"&&(xt||this.hasCrossSlope)?"miter":"fakeround"}}if(pt==="miter"&&Yt>w&&(pt="bevel"),pt==="bevel"&&(Yt>2&&(pt="flipbevel"),Yt<w&&(pt="miter")),Se&&!(pt==="miter"&&Dt)&&this.updateDistance(Se,he),pt==="miter")if(Dt){const xt=he.dist(Se);if(xt>2*St){const Kt=he.sub(he.sub(Se)._mult(St/xt)._round());this.updateDistance(Se,Kt),this.addCurrentVertex(Kt,ke,0,0,ce,et),Se=Kt}this.updateDistance(Se,he),Rt._mult(Yt),this.addCurrentVertex(he,Rt,0,0,ce,et);const $t=he.dist(Te);if($t>2*St){const Kt=he.add(Te.sub(he)._mult(St/$t)._round());this.updateDistance(he,Kt),this.addCurrentVertex(Kt,qe,0,0,ce,et),he=Kt}}else Rt._mult(Yt),this.addCurrentVertex(he,Rt,0,0,ce,et);else if(pt==="flipbevel"){if(Yt>100)Rt=qe.mult(-1);else{const xt=Yt*ke.add(qe).mag()/ke.sub(qe).mag();Rt._perp()._mult(xt*(Vt?-1:1))}this.addCurrentVertex(he,Rt,0,0,ce,et),this.addCurrentVertex(he,Rt.mult(-1),0,0,ce,et)}else if(pt==="bevel"||pt==="fakeround"){et!=null&&Se&&this.addCurrentVertex(he,Xe||ke,-1,-1,ce,et);const xt=he.dist(Se)<=2*St&&pt!=="bevel",$t=Rt.mult(Vt?1:-1);$t._mult(Yt);const Kt=qe.mult(Vt?-1:1),Ft=ke.mult(Vt?-1:1),gr=this.evaluateLineProgressFeatures(this.distance);if(et==null&&(this.addHalfVertex(he,$t.x,$t.y,!1,!Vt,0,ce,gr),xt||this.addHalfVertex(he,$t.x+2*Ft.x,$t.y+2*Ft.y,!1,Vt,0,ce,gr)),pt==="fakeround"){const br=Math.round(180*qt/Math.PI/20);this.addHalfVertex(he,Ft.x,Ft.y,!1,Vt,0,ce,gr);for(let hr=0;hr<br;hr++){let ar=hr/br;if(ar!==.5){const lr=ar-.5;ar+=ar*lr*(ar-1)*((1.0904+jt*(jt*(3.55645-1.43519*jt)-3.2452))*lr*lr+(.848013+jt*(.215638*jt-1.06021)))}const en=Kt.sub(Ft)._mult(ar)._add(Ft)._unit();this.addHalfVertex(he,en.x,en.y,!1,Vt,0,ce,gr)}this.addHalfVertex(he,Kt.x,Kt.y,!1,Vt,0,ce,gr)}xt||et!=null||this.addHalfVertex(he,$t.x+2*Kt.x,$t.y+2*Kt.y,!1,Vt,0,ce,gr),et!=null&&Te&&this.addCurrentVertex(he,Fe||qe,1,1,ce,et)}else if(pt==="butt")this.addCurrentVertex(he,Rt,0,0,ce,et);else if(pt==="square"){if(!Se){const xt=q?0:-1;this.addCurrentVertex(he,Rt,xt,xt,ce,et)}if(this.addCurrentVertex(he,Rt,0,0,ce,et),Se){const xt=H?0:1;this.addCurrentVertex(he,Rt,xt,xt,ce,et)}}else if(pt==="round"){if(Se){const xt=!At&&Xe?Xe:ke;this.addCurrentVertex(he,xt,0,0,ce,et),!At&&H||this.addCurrentVertex(he,xt,1,1,ce,et,!0)}if(Te){const xt=!At&&Fe?Fe:qe;!At&&q||this.addCurrentVertex(he,xt,-1,-1,ce,et,!0),this.addCurrentVertex(he,xt,0,0,ce,et)}}}}addVerticesTo(a,c,p,g,x,w,C,N,D,U){const q=(c.w-a.w)/this.tessellationStep|0;let H=0;const Y=this.scaledDistance;if(q>1){this.lineSoFar=a.w;const oe=(c.x-a.x)/q,ce=(c.y-a.y)/q,he=(c.z-a.z)/q,Se=(c.w-a.w)/q;for(let Te=1;Te<q;++Te){a.x+=oe,a.y+=ce,a.z+=he,this.lineSoFar+=Se,H+=Se;const ke=this.evaluateLineProgressFeatures(this.prevDistance+H);this.scaledDistance=(this.prevDistance+H)/this.totalDistance,this.addHalfVertex(a,p,g,U,!1,C,D,ke),this.addHalfVertex(a,x,w,U,!0,-N,D,ke)}}this.lineSoFar=c.w,this.scaledDistance=Y;const J=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(c,p,g,U,!1,C,D,J),this.addHalfVertex(c,x,w,U,!0,-N,D,J)}evaluateLineProgressFeatures(a){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+a)/this.totalFeatureLength):zr(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let c=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(c=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:c}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:c}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:c}}addCurrentVertex(a,c,p,g,x,w,C=!1){const N=c.x+c.y*p,D=c.y-c.x*p,U=c.y*g-c.x,q=-c.y-c.x*g;if(w!=null){const H=this.elevationType==="offset",Y=-10,J=tr+10,oe=w.zOffset,ce=new AV(a.x,a.y,oe,this.lineSoFar),he=!!H&&hM(a,Y,J),Se=this.lineSoFar,Te=this.distance;if(this.currentVertex)if(he){const ke=this.currentVertexIsOutside,qe=this.currentVertex,Fe=new AV(a.x,a.y,oe,this.lineSoFar);if(jV(qe,Fe,Y,J),!hM(Fe,Y,J)){if(ke){this.e1=this.e2=-1,this.distance-=qe.dist(ce),this.lineSoFar=qe.w;const Xe=this.evaluateLineProgressFeatures(qe.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(qe,N,D,C,!1,p,x,Xe),this.addHalfVertex(qe,U,q,C,!0,-g,x,Xe),this.prevDistance=this.distance}this.distance=this.prevDistance+qe.dist(Fe),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(qe,Fe,N,D,U,q,p,g,x,C),this.distance=Te,this.scaledDistance=this.distance/this.totalDistance}}else{const ke=this.currentVertex;if(this.currentVertexIsOutside){jV(ke,ce,Y,J),this.e1=this.e2=-1,this.distance-=ke.dist(ce),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=ke.w;const qe=this.evaluateLineProgressFeatures(ke.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ke,N,D,C,!1,p,x,qe),this.addHalfVertex(ke,U,q,C,!0,-g,x,qe),this.prevDistance=this.distance,this.distance=Te,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(ke,ce,N,D,U,q,p,g,x,C)}else he||(this.addHalfVertex(a,N,D,C,!1,p,x,w),this.addHalfVertex(a,U,q,C,!0,-g,x,w));this.currentVertex=ce,this.currentVertexIsOutside=he,this.lineSoFar=Se}else this.addHalfVertex(a,N,D,C,!1,p,x,w),this.addHalfVertex(a,U,q,C,!0,-g,x,w)}addHalfVertex({x:a,y:c},p,g,x,w,C,N,D){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),w||this.segmentPoints.push(this.lineSoFar-this.segmentStart,C)),this.layoutVertexArray.emplaceBack((a<<1)+(x?1:0),(c<<1)+(w?1:0),Math.round(63*p)+128,Math.round(63*g)+128,1+(C===0?0:C<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const q=Kr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,q)}const U=N.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,U),N.primitiveLength++),w?this.e2=U:this.e1=U,D!=null&&this.zOffsetVertexArray.emplaceBack(D.zOffset,D.variableWidth,D.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(a,c){this.prevDistance=this.distance,this.distance+=a.dist(c),this.updateScaledDistance()}}function hM(u,a,c){return u.x<a||u.x>c||u.y<a||u.y>c}let a6,o6;function l6(u,a,c){return a*(tr/(u.tileSize*Math.pow(2,c-u.tileID.overscaledZ)))}_r(dM,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const c6=(u,a,c)=>(1-c)*u+c*a;function u6(u,a){return 1/l6(u,1,a.tileZoom)}function d6(u,a,c,p){return u.translatePosMatrix(p||a.tileID.projMatrix,a,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const h6=u=>{const a=[];f6(u)&&a.push("RENDER_LINE_DASH"),u.paint.get("line-gradient")&&a.push("RENDER_LINE_GRADIENT");const c=u.paint.get("line-trim-offset");c[0]===0&&c[1]===0||a.push("RENDER_LINE_TRIM_OFFSET"),u.paint.get("line-border-width").constantOr(1)!==0&&a.push("RENDER_LINE_BORDER");const p=u.layout.get("line-join").constantOr("miter")==="none",g=!!u.paint.get("line-pattern").constantOr(1);return p&&g&&a.push("LINE_JOIN_NONE"),a};function f6(u){const a=u.paint.get("line-dasharray").value;return a.kind!=="constant"||a.value}let fM;const p6=()=>fM||(fM={layout:a6||(a6=new ws({"line-cap":new ur(ft.layout_line["line-cap"]),"line-join":new ur(ft.layout_line["line-join"]),"line-miter-limit":new Gt(ft.layout_line["line-miter-limit"]),"line-round-limit":new Gt(ft.layout_line["line-round-limit"]),"line-sort-key":new ur(ft.layout_line["line-sort-key"]),"line-z-offset":new ur(ft.layout_line["line-z-offset"]),"line-elevation-reference":new Gt(ft.layout_line["line-elevation-reference"]),"line-cross-slope":new Gt(ft.layout_line["line-cross-slope"]),visibility:new Gt(ft.layout_line.visibility),"line-width-unit":new Gt(ft.layout_line["line-width-unit"])})),paint:o6||(o6=new ws({"line-opacity":new ur(ft.paint_line["line-opacity"]),"line-color":new ur(ft.paint_line["line-color"]),"line-translate":new Gt(ft.paint_line["line-translate"]),"line-translate-anchor":new Gt(ft.paint_line["line-translate-anchor"]),"line-width":new ur(ft.paint_line["line-width"]),"line-gap-width":new ur(ft.paint_line["line-gap-width"]),"line-offset":new ur(ft.paint_line["line-offset"]),"line-blur":new ur(ft.paint_line["line-blur"]),"line-dasharray":new ur(ft.paint_line["line-dasharray"]),"line-pattern":new ur(ft.paint_line["line-pattern"]),"line-pattern-cross-fade":new Gt(ft.paint_line["line-pattern-cross-fade"]),"line-gradient":new $p(ft.paint_line["line-gradient"]),"line-trim-offset":new Gt(ft.paint_line["line-trim-offset"]),"line-trim-fade-range":new Gt(ft.paint_line["line-trim-fade-range"]),"line-trim-color":new Gt(ft.paint_line["line-trim-color"]),"line-emissive-strength":new Gt(ft.paint_line["line-emissive-strength"]),"line-border-width":new ur(ft.paint_line["line-border-width"]),"line-border-color":new ur(ft.paint_line["line-border-color"]),"line-occlusion-opacity":new Gt(ft.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},fM);class Bfe extends ur{possiblyEvaluate(a,c){return c=new Vi(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,transition:c.transition,worldview:c.worldview}),super.possiblyEvaluate(a,c)}evaluate(a,c,p,g){return c=Object.assign({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(a,c,p,g)}}let lS;function m6(u,a){return a>0?a+2*u:u}const $fe=Cn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ufe=Cn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Vfe=Cn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Cn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const qfe=Cn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Hfe=Cn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),Gfe=Cn([{name:"a_texb",components:2,type:"Uint16"}]),Wfe=Cn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Kfe=Cn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Cn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const g6=Cn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Zfe=Cn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Cn([{name:"triangle",components:3,type:"Uint16"}]),Cn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Cn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Cn([{type:"Float32",name:"offsetX"}]),Cn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Xa=24;function Xfe(u,a,c){return u.sections.forEach(p=>{p.text=function(g,x,w){const C=x.layout.get("text-transform").evaluate(w,{});return C==="uppercase"?g=g.toLocaleUpperCase():C==="lowercase"&&(g=g.toLocaleLowerCase()),Nl.applyArabicShaping&&(g=Nl.applyArabicShaping(g)),g}(p.text,a,c)}),u}const cS={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Yfe(u){return u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""}function Jfe(u){return u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""}const pM=4294967296,y6=1/pM,v6=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let xC=class{constructor(u=new Uint8Array(16)){this.buf=ArrayBuffer.isView(u)?u:new Uint8Array(u),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(u,a,c=this.length){for(;this.pos<c;){const p=this.readVarint(),g=p>>3,x=this.pos;this.type=7&p,u(g,a,this),this.pos===x&&this.skip(p)}return a}readMessage(u,a){return this.readFields(u,a,this.readVarint()+this.pos)}readFixed32(){const u=this.dataView.getUint32(this.pos,!0);return this.pos+=4,u}readSFixed32(){const u=this.dataView.getInt32(this.pos,!0);return this.pos+=4,u}readFixed64(){const u=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*pM;return this.pos+=8,u}readSFixed64(){const u=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*pM;return this.pos+=8,u}readFloat(){const u=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,u}readDouble(){const u=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,u}readVarint(u){const a=this.buf;let c,p;return p=a[this.pos++],c=127&p,p<128?c:(p=a[this.pos++],c|=(127&p)<<7,p<128?c:(p=a[this.pos++],c|=(127&p)<<14,p<128?c:(p=a[this.pos++],c|=(127&p)<<21,p<128?c:(p=a[this.pos],c|=(15&p)<<28,function(g,x,w){const C=w.buf;let N,D;if(D=C[w.pos++],N=(112&D)>>4,D<128||(D=C[w.pos++],N|=(127&D)<<3,D<128)||(D=C[w.pos++],N|=(127&D)<<10,D<128)||(D=C[w.pos++],N|=(127&D)<<17,D<128)||(D=C[w.pos++],N|=(127&D)<<24,D<128)||(D=C[w.pos++],N|=(1&D)<<31,D<128))return gx(g,N,x);throw new Error("Expected varint not more than 10 bytes")}(c,u,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const u=this.readVarint();return u%2==1?(u+1)/-2:u/2}readBoolean(){return!!this.readVarint()}readString(){const u=this.readVarint()+this.pos,a=this.pos;return this.pos=u,u-a>=12&&v6?v6.decode(this.buf.subarray(a,u)):function(c,p,g){let x="",w=p;for(;w<g;){const C=c[w];let N,D,U,q=null,H=C>239?4:C>223?3:C>191?2:1;if(w+H>g)break;H===1?C<128&&(q=C):H===2?(N=c[w+1],(192&N)==128&&(q=(31&C)<<6|63&N,q<=127&&(q=null))):H===3?(N=c[w+1],D=c[w+2],(192&N)==128&&(192&D)==128&&(q=(15&C)<<12|(63&N)<<6|63&D,(q<=2047||q>=55296&&q<=57343)&&(q=null))):H===4&&(N=c[w+1],D=c[w+2],U=c[w+3],(192&N)==128&&(192&D)==128&&(192&U)==128&&(q=(15&C)<<18|(63&N)<<12|(63&D)<<6|63&U,(q<=65535||q>=1114112)&&(q=null))),q===null?(q=65533,H=1):q>65535&&(q-=65536,x+=String.fromCharCode(q>>>10&1023|55296),q=56320|1023&q),x+=String.fromCharCode(q),w+=H}return x}(this.buf,a,u)}readBytes(){const u=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,u);return this.pos=u,a}readPackedVarint(u=[],a){const c=this.readPackedEnd();for(;this.pos<c;)u.push(this.readVarint(a));return u}readPackedSVarint(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readSVarint());return u}readPackedBoolean(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readBoolean());return u}readPackedFloat(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readFloat());return u}readPackedDouble(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readDouble());return u}readPackedFixed32(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readFixed32());return u}readPackedSFixed32(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readSFixed32());return u}readPackedFixed64(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readFixed64());return u}readPackedSFixed64(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readSFixed64());return u}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(u){const a=7&u;if(a===0)for(;this.buf[this.pos++]>127;);else if(a===2)this.pos=this.readVarint()+this.pos;else if(a===5)this.pos+=4;else{if(a!==1)throw new Error(`Unimplemented type: ${a}`);this.pos+=8}}writeTag(u,a){this.writeVarint(u<<3|a)}realloc(u){let a=this.length||16;for(;a<this.pos+u;)a*=2;if(a!==this.length){const c=new Uint8Array(a);c.set(this.buf),this.buf=c,this.dataView=new DataView(c.buffer),this.length=a}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(u){this.realloc(4),this.dataView.setInt32(this.pos,u,!0),this.pos+=4}writeSFixed32(u){this.realloc(4),this.dataView.setInt32(this.pos,u,!0),this.pos+=4}writeFixed64(u){this.realloc(8),this.dataView.setInt32(this.pos,-1&u,!0),this.dataView.setInt32(this.pos+4,Math.floor(u*y6),!0),this.pos+=8}writeSFixed64(u){this.realloc(8),this.dataView.setInt32(this.pos,-1&u,!0),this.dataView.setInt32(this.pos+4,Math.floor(u*y6),!0),this.pos+=8}writeVarint(u){(u=+u||0)>268435455||u<0?function(a,c){let p,g;if(a>=0?(p=a%4294967296|0,g=a/4294967296|0):(p=~(-a%4294967296),g=~(-a/4294967296),4294967295^p?p=p+1|0:(p=0,g=g+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(x,w,C){C.buf[C.pos++]=127&x|128,x>>>=7,C.buf[C.pos++]=127&x|128,x>>>=7,C.buf[C.pos++]=127&x|128,x>>>=7,C.buf[C.pos++]=127&x|128,C.buf[C.pos]=127&(x>>>=7)}(p,0,c),function(x,w){const C=(7&x)<<4;w.buf[w.pos++]|=C|((x>>>=3)?128:0),x&&(w.buf[w.pos++]=127&x|((x>>>=7)?128:0),x&&(w.buf[w.pos++]=127&x|((x>>>=7)?128:0),x&&(w.buf[w.pos++]=127&x|((x>>>=7)?128:0),x&&(w.buf[w.pos++]=127&x|((x>>>=7)?128:0),x&&(w.buf[w.pos++]=127&x)))))}(g,c)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))}writeSVarint(u){this.writeVarint(u<0?2*-u-1:2*u)}writeBoolean(u){this.writeVarint(+u)}writeString(u){u=String(u),this.realloc(4*u.length),this.pos++;const a=this.pos;this.pos=function(p,g,x){for(let w,C,N=0;N<g.length;N++){if(w=g.charCodeAt(N),w>55295&&w<57344){if(!C){w>56319||N+1===g.length?(p[x++]=239,p[x++]=191,p[x++]=189):C=w;continue}if(w<56320){p[x++]=239,p[x++]=191,p[x++]=189,C=w;continue}w=C-55296<<10|w-56320|65536,C=null}else C&&(p[x++]=239,p[x++]=191,p[x++]=189,C=null);w<128?p[x++]=w:(w<2048?p[x++]=w>>6|192:(w<65536?p[x++]=w>>12|224:(p[x++]=w>>18|240,p[x++]=w>>12&63|128),p[x++]=w>>6&63|128),p[x++]=63&w|128)}return x}(this.buf,u,this.pos);const c=this.pos-a;c>=128&&_6(a,c,this),this.pos=a-1,this.writeVarint(c),this.pos+=c}writeFloat(u){this.realloc(4),this.dataView.setFloat32(this.pos,u,!0),this.pos+=4}writeDouble(u){this.realloc(8),this.dataView.setFloat64(this.pos,u,!0),this.pos+=8}writeBytes(u){const a=u.length;this.writeVarint(a),this.realloc(a);for(let c=0;c<a;c++)this.buf[this.pos++]=u[c]}writeRawMessage(u,a){this.pos++;const c=this.pos;u(a,this);const p=this.pos-c;p>=128&&_6(c,p,this),this.pos=c-1,this.writeVarint(p),this.pos+=p}writeMessage(u,a,c){this.writeTag(u,2),this.writeRawMessage(a,c)}writePackedVarint(u,a){a.length&&this.writeMessage(u,Qfe,a)}writePackedSVarint(u,a){a.length&&this.writeMessage(u,epe,a)}writePackedBoolean(u,a){a.length&&this.writeMessage(u,npe,a)}writePackedFloat(u,a){a.length&&this.writeMessage(u,tpe,a)}writePackedDouble(u,a){a.length&&this.writeMessage(u,rpe,a)}writePackedFixed32(u,a){a.length&&this.writeMessage(u,ipe,a)}writePackedSFixed32(u,a){a.length&&this.writeMessage(u,spe,a)}writePackedFixed64(u,a){a.length&&this.writeMessage(u,ape,a)}writePackedSFixed64(u,a){a.length&&this.writeMessage(u,ope,a)}writeBytesField(u,a){this.writeTag(u,2),this.writeBytes(a)}writeFixed32Field(u,a){this.writeTag(u,5),this.writeFixed32(a)}writeSFixed32Field(u,a){this.writeTag(u,5),this.writeSFixed32(a)}writeFixed64Field(u,a){this.writeTag(u,1),this.writeFixed64(a)}writeSFixed64Field(u,a){this.writeTag(u,1),this.writeSFixed64(a)}writeVarintField(u,a){this.writeTag(u,0),this.writeVarint(a)}writeSVarintField(u,a){this.writeTag(u,0),this.writeSVarint(a)}writeStringField(u,a){this.writeTag(u,2),this.writeString(a)}writeFloatField(u,a){this.writeTag(u,5),this.writeFloat(a)}writeDoubleField(u,a){this.writeTag(u,1),this.writeDouble(a)}writeBooleanField(u,a){this.writeVarintField(u,+a)}};function gx(u,a,c){return c?4294967296*a+(u>>>0):4294967296*(a>>>0)+(u>>>0)}function _6(u,a,c){const p=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));c.realloc(p);for(let g=c.pos-1;g>=u;g--)c.buf[g+p]=c.buf[g]}function Qfe(u,a){for(let c=0;c<u.length;c++)a.writeVarint(u[c])}function epe(u,a){for(let c=0;c<u.length;c++)a.writeSVarint(u[c])}function tpe(u,a){for(let c=0;c<u.length;c++)a.writeFloat(u[c])}function rpe(u,a){for(let c=0;c<u.length;c++)a.writeDouble(u[c])}function npe(u,a){for(let c=0;c<u.length;c++)a.writeBoolean(u[c])}function ipe(u,a){for(let c=0;c<u.length;c++)a.writeFixed32(u[c])}function spe(u,a){for(let c=0;c<u.length;c++)a.writeSFixed32(u[c])}function ape(u,a){for(let c=0;c<u.length;c++)a.writeFixed64(u[c])}function ope(u,a){for(let c=0;c<u.length;c++)a.writeSFixed64(u[c])}const mM=3;function lpe(u,a,c){a.glyphs=[],u===1&&c.readMessage(cpe,a)}function cpe(u,a,c){if(u===3){const{id:p,bitmap:g,width:x,height:w,left:C,top:N,advance:D}=c.readMessage(upe,{});a.glyphs.push({id:p,bitmap:new nm({width:x+2*mM,height:w+2*mM},g),metrics:{width:x,height:w,left:C,top:N,advance:D}})}else u===4?a.ascender=c.readSVarint():u===5&&(a.descender=c.readSVarint())}function upe(u,a,c){u===1?a.id=c.readVarint():u===2?a.bitmap=c.readBytes():u===3?a.width=c.readVarint():u===4?a.height=c.readVarint():u===5?a.left=c.readSVarint():u===6?a.top=c.readSVarint():u===7&&(a.advance=c.readVarint())}const x6=mM,tc={horizontal:1,vertical:2,horizontalOnly:3};class uS{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(a,c){const p=new uS;return p.scale=a||1,p.fontStack=c,p}static forImage(a){const c=new uS;return c.image=a,c}}class yx{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(a,c,p){const g=new yx;for(let x=0;x<a.sections.length;x++){const w=a.sections[x];w.image?g.addImageSection(w,p):g.addTextSection(w,c)}return g}length(){return this.text.length}getSection(a){return this.sections[this.sectionIndex[a]]}getSections(){return this.sections}getSectionIndex(a){return this.sectionIndex[a]}getCodePoint(a){return this.text.codePointAt(a)}verticalizePunctuation(a){this.text=function(c,p){let g="";for(let x=0;x<c.length;x++){const w=c.charCodeAt(x+1)||null,C=c.charCodeAt(x-1)||null;g+=!p&&(w&&p1(w)&&!cS[c[x+1]]||C&&p1(C)&&!cS[c[x-1]])||!cS[c[x]]?c[x]:cS[c[x]]}return g}(this.text,a)}trim(){let a=0;for(let p=0;p<this.text.length&&bC[this.text.charCodeAt(p)];p++)a++;let c=this.text.length;for(let p=this.text.length-1;p>=0&&p>=a&&bC[this.text.charCodeAt(p)];p--)c--;this.text=this.text.substring(a,c),this.sectionIndex=this.sectionIndex.slice(a,c)}substring(a,c){const p=new yx;return p.text=this.text.substring(a,c),p.sectionIndex=this.sectionIndex.slice(a,c),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((a,c)=>Math.max(a,this.sections[c].scale),0)}addTextSection(a,c){this.text+=a.text,this.sections.push(uS.forText(a.scale,a.fontStack||c));const p=this.sections.length-1;for(let g=0;g<a.text.length;++g)this.sectionIndex.push(p)}addImageSection(a,c){const p=a.image?a.image.getPrimary():null;if(!p)return void zr("Can't add FormattedSection with an empty image.");p.scaleSelf(c);const g=this.getNextImageSectionCharCode();g?(this.text+=String.fromCodePoint(g),this.sections.push(uS.forImage(p)),this.sectionIndex.push(this.sections.length-1)):zr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function gM(u,a,c,p,g,x,w,C,N,D,U,q,H,Y,J,oe=1){const ce=yx.fromFeature(u,g,oe);q===tc.vertical&&ce.verticalizePunctuation(H);let he=[];const Se=function(Xe,et,it,At,pt,jt){if(!Xe)return[];const Rt=[],zt=function(Vt,St,xt,$t,Kt,Ft){let gr=0;for(let br=0;br<Vt.length();br++){const hr=Vt.getSection(br);gr+=b6(Vt.getCodePoint(br),hr,$t,Kt,St,Ft)}return gr/Math.max(1,Math.ceil(gr/xt))}(Xe,et,it,At,pt,jt),Yt=Xe.text.indexOf("")>=0;let qt=0;for(let Vt=0;Vt<Xe.length();Vt++){const St=Xe.getSection(Vt),xt=Xe.getCodePoint(Vt);if(bC[xt]||(qt+=b6(xt,St,At,pt,et,jt)),Vt<Xe.length()-1){const $t=!((Dt=xt)<11904||!(Br["Bopomofo Extended"](Dt)||Br.Bopomofo(Dt)||Br["CJK Compatibility Forms"](Dt)||Br["CJK Compatibility Ideographs"](Dt)||Br["CJK Compatibility"](Dt)||Br["CJK Radicals Supplement"](Dt)||Br["CJK Strokes"](Dt)||Br["CJK Symbols and Punctuation"](Dt)||Br["CJK Unified Ideographs Extension A"](Dt)||Br["CJK Unified Ideographs"](Dt)||Br["Enclosed CJK Letters and Months"](Dt)||Br["Halfwidth and Fullwidth Forms"](Dt)||Br.Hiragana(Dt)||Br["Ideographic Description Characters"](Dt)||Br["Kangxi Radicals"](Dt)||Br["Katakana Phonetic Extensions"](Dt)||Br.Katakana(Dt)||Br["Vertical Forms"](Dt)||Br["Yi Radicals"](Dt)||Br["Yi Syllables"](Dt)));(dpe[xt]||$t||St.image)&&Rt.push(S6(Vt+1,qt,zt,Rt,hpe(xt,Xe.getCodePoint(Vt+1),$t&&Yt),!1))}}var Dt;return E6(S6(Xe.length(),qt,zt,Rt,0,!0))}(ce,D,x,a,p,Y),{processBidirectionalText:Te,processStyledBidirectionalText:ke}=Nl;if(Te&&ce.sections.length===1){const Xe=Te(ce.toString(),Se);for(const et of Xe){const it=new yx;it.text=et,it.sections=ce.sections;for(let At=0;At<et.length;At++)it.sectionIndex.push(0);he.push(it)}}else if(ke){const Xe=ke(ce.text,ce.sectionIndex,Se);for(const et of Xe){const it=new yx;it.text=et[0],it.sectionIndex=et[1],it.sections=ce.sections,he.push(it)}}else he=function(Xe,et){const it=[],At=Xe.text;let pt=0;for(const jt of et)it.push(Xe.substring(pt,jt)),pt=jt;return pt<At.length&&it.push(Xe.substring(pt,At.length)),it}(ce,Se);const qe=[],Fe={positionedLines:qe,text:ce.toString(),top:U[1],bottom:U[1],left:U[0],right:U[0],writingMode:q,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Xe,et,it,At,pt,jt,Rt,zt,Yt,qt,Dt,Vt){let St=0,xt=0,$t=0;const Kt=zt==="right"?1:zt==="left"?0:.5;let Ft=!1;for(const lr of pt){const Lr=lr.getSections();for(const rn of Lr){if(rn.image)continue;const Sn=et[rn.fontStack];if(Sn&&(Ft=Sn.ascender!==void 0&&Sn.descender!==void 0,!Ft))break}if(!Ft)break}let gr=0;for(const lr of pt){lr.trim();const Lr=lr.getMaxScale(),rn=(Lr-1)*Xa,Sn={positionedGlyphs:[],lineOffset:0};Xe.positionedLines[gr]=Sn;const qn=Sn.positionedGlyphs;let on=0;if(!lr.length()){xt+=jt,++gr;continue}let ti=0,ri=0;for(let ze=0;ze<lr.length();ze++){const Re=lr.getSection(ze),Ot=lr.getSectionIndex(ze),ir=lr.getCodePoint(ze);let kt=Re.scale,or=null,jr=null,Tr=null,cn=Xa,qr=0,Sr=Yt;Sr===tc.vertical&&((br=ir)===12312||br===12313||br===12316||br===12540||br===12448)&&(Sr=tc.horizontal);const Jn=!(Sr===tc.horizontal||!Dt&&!q_(ir)||Dt&&(bC[ir]||m1(ir)));if(Re.image){const Ai=At.get(Re.image.toString());if(!Ai)continue;Tr=Re.image,Xe.iconsInText=Xe.iconsInText||!0,jr=Ai.paddedRect;const Wr=Ai.displaySize;kt=kt*Xa/Vt,or={width:Wr[0],height:Wr[1],left:0,top:-x6,advance:Jn?Wr[1]:Wr[0],localGlyph:!1},qr=Ft?-or.height*kt:Lr*Xa-17-Wr[1]*kt,cn=or.advance;const Bn=(Jn?Wr[0]:Wr[1])*kt-Xa*Lr;Bn>0&&Bn>on&&(on=Bn)}else{const Ai=it[Re.fontStack];if(!Ai)continue;Ai[ir]&&(jr=Ai[ir]);const Wr=et[Re.fontStack];if(!Wr)continue;const Bn=Wr.glyphs[ir];if(!Bn)continue;if(or=Bn.metrics,cn=ir!==8203?Xa:0,Ft){const Ci=Wr.ascender!==void 0?Math.abs(Wr.ascender):0,fi=Wr.descender!==void 0?Math.abs(Wr.descender):0,_s=(Ci+fi)*kt;ti<_s&&(ti=_s,ri=(Ci-fi)/2*kt),qr=-Ci*kt}else qr=(Lr-kt)*Xa-17}Jn?(Xe.verticalizable=!0,qn.push({glyph:ir,image:Tr,x:St,y:xt+qr,vertical:Jn,scale:kt,localGlyph:or.localGlyph,fontStack:Re.fontStack,sectionIndex:Ot,metrics:or,rect:jr}),St+=cn*kt+qt):(qn.push({glyph:ir,image:Tr,x:St,y:xt+qr,vertical:Jn,scale:kt,localGlyph:or.localGlyph,fontStack:Re.fontStack,sectionIndex:Ot,metrics:or,rect:jr}),St+=or.advance*kt+qt)}qn.length!==0&&($t=Math.max(St-qt,$t),Ft?T6(qn,Kt,on,ri,jt*Lr/2):T6(qn,Kt,on,0,jt/2)),St=0;const cs=jt*Lr+on;Sn.lineOffset=Math.max(on,rn),xt+=cs,++gr}var br;const hr=xt,{horizontalAlign:ar,verticalAlign:en}=yM(Rt);(function(lr,Lr,rn,Sn,qn,on){const ti=(Lr-rn)*qn,ri=-on*Sn;for(const cs of lr)for(const ze of cs.positionedGlyphs)ze.x+=ti,ze.y+=ri})(Xe.positionedLines,Kt,ar,en,$t,hr),Xe.top+=-en*hr,Xe.bottom=Xe.top+hr,Xe.left+=-ar*$t,Xe.right=Xe.left+$t,Xe.hasBaseline=Ft}(Fe,a,c,p,he,w,C,N,q,D,H,J),!function(Xe){for(const et of Xe)if(et.positionedGlyphs.length!==0)return!1;return!0}(qe))return Fe}const bC={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},dpe={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function b6(u,a,c,p,g,x){if(a.image){const w=p.get(a.image.toString());return w?w.displaySize[0]*a.scale*Xa/x+g:0}{const w=c[a.fontStack],C=w&&w.glyphs[u];return C?C.metrics.advance*a.scale+g:0}}function w6(u,a,c,p){const g=Math.pow(u-a,2);return p?u<a?g/2:2*g:g+Math.abs(c)*c}function hpe(u,a,c){let p=0;return u===10&&(p-=1e4),c&&(p+=150),u!==40&&u!==65288||(p+=50),a!==41&&a!==65289||(p+=50),p}function S6(u,a,c,p,g,x){let w=null,C=w6(a,c,g,x);for(const N of p){const D=w6(a-N.x,c,g,x)+N.badness;D<=C&&(w=N,C=D)}return{index:u,x:a,priorBreak:w,badness:C}}function E6(u){return u?E6(u.priorBreak).concat(u.index):[]}function yM(u){let a=.5,c=.5;switch(u){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:a,verticalAlign:c}}function T6(u,a,c,p,g){if(!(a||c||p||g))return;const x=u.length-1,w=u[x],C=(w.x+w.metrics.advance*w.scale)*a;for(let N=0;N<=x;N++)u[N].x-=C,u[N].y+=c+p+g}function A6(u){return u.imagePrimary!==void 0&&u.top!==void 0&&u.bottom!==void 0&&u.left!==void 0&&u.right!==void 0}function wC(u,a,c,p){const{horizontalAlign:g,verticalAlign:x}=yM(p),w=c[0]-u.displaySize[0]*g,C=c[1]-u.displaySize[1]*x;return{imagePrimary:u,imageSecondary:a,top:C,bottom:C+u.displaySize[1],left:w,right:w+u.displaySize[0]}}function vM(u,a,c,p,g,x){const w=u.imagePrimary;let C;if(w.content){const ce=w.content,he=w.pixelRatio||1;C=[ce[0]/he,ce[1]/he,w.displaySize[0]-ce[2]/he,w.displaySize[1]-ce[3]/he]}const N=a.left*x,D=a.right*x;let U,q,H,Y;c==="width"||c==="both"?(Y=g[0]+N-p[3],q=g[0]+D+p[1]):(Y=g[0]+(N+D-w.displaySize[0])/2,q=Y+w.displaySize[0]);const J=a.top*x,oe=a.bottom*x;return c==="height"||c==="both"?(U=g[1]+J-p[0],H=g[1]+oe+p[2]):(U=g[1]+(J+oe-w.displaySize[1])/2,H=U+w.displaySize[1]),{imagePrimary:w,imageSecondary:void 0,top:U,right:q,bottom:H,left:Y,collisionPadding:C}}function C6(u){return!u.imagePrimary.stretchX}function j6(u){return!u.imagePrimary.stretchY}function P6(u){return{width:u.right-u.left,height:u.bottom-u.top}}const xd=128;function vx(u,a,c){const{expression:p}=a;if(p.kind==="constant")return{kind:"constant",layoutSize:p.evaluate(new Vi(u+1,{worldview:c}))};if(p.kind==="source")return{kind:"source"};{const{zoomStops:g,interpolationType:x}=p;let w=0;for(;w<g.length&&g[w]<=u;)w++;w=Math.max(0,w-1);let C=w;for(;C<g.length&&g[C]<u+1;)C++;C=Math.min(g.length-1,C);const N=g[w],D=g[C];return p.kind==="composite"?{kind:"composite",minZoom:N,maxZoom:D,interpolationType:x}:{kind:"camera",minZoom:N,maxZoom:D,minSize:p.evaluate(new Vi(N,{worldview:c})),maxSize:p.evaluate(new Vi(D,{worldview:c})),interpolationType:x}}}function _M(u,{uSize:a,uSizeT:c},{lowerSize:p,upperSize:g}){return u.kind==="source"?p/xd:u.kind==="composite"?Kr(p/xd,g/xd,c):a}function _x(u,a,c=1){let p=0,g=0;if(u.kind==="constant")g=u.layoutSize*c;else if(u.kind!=="source"){const{interpolationType:x,minZoom:w,maxZoom:C}=u,N=x?ve(Gl.interpolationFactor(x,a,w,C),0,1):0;u.kind==="camera"?g=Kr(u.minSize,u.maxSize,N)*c:p=N*c}return{uSizeT:p,uSize:g}}class Cf extends st{constructor(a,c,p,g,x){super(a,c),this.angle=g,this.z=p,x!==void 0&&(this.segment=x)}clone(){return new Cf(this.x,this.y,this.z,this.angle,this.segment)}}function O6(u,a,c,p,g){if(a.segment===void 0)return!0;let x=a,w=a.segment+1,C=0;for(;C>-c/2;){if(w--,w<0)return!1;C-=u[w].dist(x),x=u[w]}C+=u[w].dist(u[w+1]),w++;const N=[];let D=0;for(;C<c/2;){const U=u[w],q=u[w+1];if(!q)return!1;let H=u[w-1].angleTo(U)-U.angleTo(q);for(H=Math.abs((H+3*Math.PI)%(2*Math.PI)-Math.PI),N.push({distance:C,angleDelta:H}),D+=H;C-N[0].distance>p;)D-=N.shift().angleDelta;if(D>g)return!1;w++,C+=U.dist(q)}return!0}function k6(u){let a=0;for(let c=0;c<u.length-1;c++)a+=u[c].dist(u[c+1]);return a}function N6(u,a,c){return u?.6*a*c:0}function I6(u,a){return Math.max(u?u.right-u.left:0,a?a.right-a.left:0)}function fpe(u,a,c,p,g,x){const w=N6(c,g,x),C=I6(c,p)*x;let N=0;const D=k6(u)/2;for(let U=0;U<u.length-1;U++){const q=u[U],H=u[U+1],Y=q.dist(H);if(N+Y>D){const J=(D-N)/Y,oe=Kr(q.x,H.x,J),ce=Kr(q.y,H.y,J),he=new Cf(oe,ce,0,H.angleTo(q),U);return!w||O6(u,he,C,w,a)?he:void 0}N+=Y}}function ppe(u,a,c,p,g,x,w,C,N){const D=N6(p,x,w),U=I6(p,g),q=U*w,H=u[0].x===0||u[0].x===N||u[0].y===0||u[0].y===N;return a-q<a/4&&(a=q+a/4),R6(u,H?a/2*C%a:(U/2+2*x)*w*C%a,a,D,c,q,H,!1,N)}function R6(u,a,c,p,g,x,w,C,N){const D=x/2,U=k6(u);let q=0,H=a-c,Y=[];for(let J=0;J<u.length-1;J++){const oe=u[J],ce=u[J+1],he=oe.dist(ce),Se=ce.angleTo(oe);for(;H+c<q+he;){H+=c;const Te=(H-q)/he,ke=Kr(oe.x,ce.x,Te),qe=Kr(oe.y,ce.y,Te);if(ke>=0&&ke<N&&qe>=0&&qe<N&&H-D>=0&&H+D<=U){const Fe=new Cf(ke,qe,0,Se,J);p&&!O6(u,Fe,x,p,g)||Y.push(Fe)}}q+=he}return C||Y.length||w||(Y=R6(u,q/2,c,p,g,x,w,!0,N)),Y}function M6(u){let a=0,c=0;for(const w of u)a+=w.w*w.h,c=Math.max(c,w.w);u.sort((w,C)=>C.h-w.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),c),h:1/0}];let g=0,x=0;for(const w of u)for(let C=p.length-1;C>=0;C--){const N=p[C];if(!(w.w>N.w||w.h>N.h)){if(w.x=N.x,w.y=N.y,x=Math.max(x,w.y+w.h),g=Math.max(g,w.x+w.w),w.w===N.w&&w.h===N.h){const D=p.pop();D&&C<p.length&&(p[C]=D)}else w.h===N.h?(N.x+=w.w,N.w-=w.w):w.w===N.w?(N.y+=w.h,N.h-=w.h):(p.push({x:N.x+w.w,y:N.y,w:N.w-w.w,h:w.h}),N.y+=w.h,N.h-=w.h);break}}return{w:g,h:x,fill:a/(g*x)||0}}_r(Cf,"Anchor");const Ty=1;class dS{static getImagePositionScale(a,c,p){if(c&&a&&a.options&&a.options.transform){const g=a.options.transform;return{x:g.a,y:g.d}}return{x:p,y:p}}constructor(a,c,p,g){this.paddedRect=a;const{pixelRatio:x,version:w,stretchX:C,stretchY:N,content:D,sdf:U,usvg:q}=c;this.pixelRatio=x,this.stretchX=C,this.stretchY=N,this.content=D,this.version=w,this.padding=p,this.sdf=U,this.usvg=q,this.scale=dS.getImagePositionScale(g,q,x)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function xM(u,a,c){const p=cd.parse(u),g=function(x,w,C=[1,1]){return{x:0,y:0,w:(x.data?x.data.width:x.width*C[0])+2*w,h:(x.data?x.data.height:x.height*C[1])+2*w}}(a,c,[p.options.transform.a,p.options.transform.d]);return{bin:g,imagePosition:new dS(g,a,c,p),imageVariant:p}}class D6{constructor(a,c,p){const g=new Map,x=new Map;this.haveRenderCallbacks=[];const w=[];this.addImages(a,g,Ty,w),this.addImages(c,x,2,w);const{w:C,h:N}=M6(w),D=new So({width:C||1,height:N||1});for(const[U,q]of a.entries()){const H=g.get(U).paddedRect;So.copy(q.data,D,{x:0,y:0},{x:H.x+Ty,y:H.y+Ty},q.data,null,q.sdf)}for(const[U,q]of c.entries()){const H=x.get(U),Y=H.paddedRect;let J=H.padding;const oe=Y.x+J,ce=Y.y+J,he=q.data.width,Se=q.data.height;J=J>1?J-1:J,So.copy(q.data,D,{x:0,y:0},{x:oe,y:ce},q.data,p),So.copy(q.data,D,{x:0,y:Se-J},{x:oe,y:ce-J},{width:he,height:J},p),So.copy(q.data,D,{x:0,y:0},{x:oe,y:ce+Se},{width:he,height:J},p),So.copy(q.data,D,{x:he-J,y:0},{x:oe-J,y:ce},{width:J,height:Se},p),So.copy(q.data,D,{x:0,y:0},{x:oe+he,y:ce},{width:J,height:Se},p),So.copy(q.data,D,{x:he-J,y:Se-J},{x:oe-J,y:ce-J},{width:J,height:J},p),So.copy(q.data,D,{x:0,y:Se-J},{x:oe+he,y:ce-J},{width:J,height:J},p),So.copy(q.data,D,{x:0,y:0},{x:oe+he,y:ce+Se},{width:J,height:J},p),So.copy(q.data,D,{x:he-J,y:0},{x:oe-J,y:ce+Se},{width:J,height:J},p)}this.lut=p,this.image=D,this.iconPositions=g,this.patternPositions=x}addImages(a,c,p,g){for(const[x,w]of a.entries()){const{bin:C,imagePosition:N,imageVariant:D}=xM(x,w,p);c.set(x,N),g.push(C),w.hasRenderCallback&&this.haveRenderCallbacks.push(D.id)}}patchUpdatedImages(a,c,p){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(g=>a.hasImage(g,p)),a.dispatchRenderCallbacks(this.haveRenderCallbacks,p);for(const g of a.getUpdatedImages(p)){for(const x of this.iconPositions.keys()){const w=cd.parse(x);if(da.isEqual(w.id,g)){const C=a.getImage(g,p);this.patchUpdatedImage(this.iconPositions.get(x),C,c,null)}}for(const x of this.patternPositions.keys()){const w=cd.parse(x);if(da.isEqual(w.id,g)){const C=a.getImage(g,p);this.patchUpdatedImage(this.patternPositions.get(x),C,c,this.lut)}}}}patchUpdatedImage(a,c,p,g=null){if(!a||!c||a.version===c.version)return;a.version=c.version;const[x,w]=a.tl,C=a.sdf;if(this.lut||C){const N={width:c.data.width,height:c.data.height},D=new So(N);So.copy(c.data,D,{x:0,y:0},{x:0,y:0},N,g,C),p.update(D,{position:{x,y:w}})}else p.update(c.data,{position:{x,y:w}})}}_r(dS,"ImagePosition"),_r(D6,"ImageAtlas");const hS=1e20;function L6(u,a,c,p,g,x,w,C,N){for(let D=a;D<a+p;D++)F6(u,c*x+D,x,g,w,C,N);for(let D=c;D<c+g;D++)F6(u,D*x+a,1,p,w,C,N)}function F6(u,a,c,p,g,x,w){x[0]=0,w[0]=-hS,w[1]=hS,g[0]=u[a];for(let C=1,N=0,D=0;C<p;C++){g[C]=u[a+C*c];const U=C*C;do{const q=x[N];D=(g[C]-g[q]+U-q*q)/(C-q)/2}while(D<=w[N]&&--N>-1);N++,x[N]=C,w[N]=D,w[N+1]=hS}for(let C=0,N=0;C<p;C++){for(;w[N+1]<C;)N++;const D=x[N],U=C-D;u[a+C*c]=g[D]+U*U}}const bd=2,bM={none:0,ideographs:1,all:2};class xx{constructor(a,c,p){this.requestManager=a,this.localGlyphMode=c,this.localFontFamily=p,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(a){this.url=a}getGlyphs(a,c){const p=[],g=this.url||Ji.GLYPHS_URL;for(const x in a)for(const w of a[x])p.push({stack:x,id:w});Ye(p,({stack:x,id:w},C)=>{let N=this.entries[x];N||(N=this.entries[x]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let D=N.glyphs[w];if(D!==void 0)return void C(null,{stack:x,id:w,glyph:D});if(D=this._tinySDF(N,x,w),D)return N.glyphs[w]=D,void C(null,{stack:x,id:w,glyph:D});const U=Math.floor(w/256);if(256*U>65535)return zr("glyphs > 65535 not supported"),void C(null,{stack:x,id:w,glyph:D});if(N.ranges[U])return void C(null,{stack:x,id:w,glyph:D});let q=N.requests[U];q||(q=N.requests[U]=[],xx.loadGlyphRange(x,U,g,this.requestManager,(H,Y)=>{if(Y){N.ascender=Y.ascender,N.descender=Y.descender;for(const J in Y.glyphs)this._doesCharSupportLocalGlyph(+J)||(N.glyphs[+J]=Y.glyphs[+J]);N.ranges[U]=!0}for(const J of q)J(H,Y);delete N.requests[U]})),q.push((H,Y)=>{H?C(H):Y&&C(null,{stack:x,id:w,glyph:Y.glyphs[w]||null})})},(x,w)=>{if(x)c(x);else if(w){const C={};for(const{stack:N,id:D,glyph:U}of w)C[N]===void 0&&(C[N]={}),C[N].glyphs===void 0&&(C[N].glyphs={}),C[N].glyphs[D]=U&&{id:U.id,bitmap:U.bitmap.clone(),metrics:U.metrics},C[N].ascender=this.entries[N].ascender,C[N].descender=this.entries[N].descender;c(null,C)}})}_doesCharSupportLocalGlyph(a){return this.localGlyphMode!==bM.none&&(this.localGlyphMode===bM.all?!!this.localFontFamily:!!this.localFontFamily&&(Br["CJK Unified Ideographs"](a)||Br["Hangul Syllables"](a)||Br.Hiragana(a)||Br.Katakana(a)||Br["CJK Symbols and Punctuation"](a)||Br["CJK Unified Ideographs Extension A"](a)||Br["CJK Unified Ideographs Extension B"](a)||Br.Osage(a)))}_tinySDF(a,c,p){const g=this.localFontFamily;if(!g||!this._doesCharSupportLocalGlyph(p))return;let x=a.tinySDF;if(!x){let oe="400";/bold/i.test(c)?oe="900":/medium/i.test(c)?oe="500":/light/i.test(c)&&(oe="200"),x=a.tinySDF=new xx.TinySDF({fontFamily:g,fontWeight:oe,fontSize:24*bd,buffer:3*bd,radius:8*bd}),x.fontWeight=oe}if(this.localGlyphs[x.fontWeight][p])return this.localGlyphs[x.fontWeight][p];const w=String.fromCodePoint(p),{data:C,width:N,height:D,glyphWidth:U,glyphHeight:q,glyphLeft:H,glyphTop:Y,glyphAdvance:J}=x.draw(w);return this.localGlyphs[x.fontWeight][p]={id:p,bitmap:new nm({width:N,height:D},C),metrics:{width:U/bd,height:q/bd,left:H/bd,top:Y/bd-27,advance:J/bd,localGlyph:!0}}}}xx.loadGlyphRange=function(u,a,c,p,g){const x=256*a,w=x+255,C=p.transformRequest(p.normalizeGlyphsURL(c).replace("{fontstack}",u).replace("{range}",`${x}-${w}`),of.Glyphs);_p(C,(N,D)=>{if(N)g(N);else if(D){const U={},q=function(H){return new xC(H).readFields(lpe,{})}(D);for(const H of q.glyphs)U[H.id]=H;g(null,{glyphs:U,ascender:q.ascender,descender:q.descender})}})},xx.TinySDF=class{constructor({fontSize:u=24,buffer:a=3,radius:c=8,cutoff:p=.25,fontFamily:g="sans-serif",fontWeight:x="normal",fontStyle:w="normal",lang:C=null}={}){this.buffer=a,this.cutoff=p,this.radius=c,this.lang=C;const N=this.size=u+4*a,D=this._createCanvas(N),U=this.ctx=D.getContext("2d",{willReadFrequently:!0});U.font=`${w} ${x} ${u}px ${g}`,U.textBaseline="alphabetic",U.textAlign="left",U.fillStyle="black",this.gridOuter=new Float64Array(N*N),this.gridInner=new Float64Array(N*N),this.f=new Float64Array(N),this.z=new Float64Array(N+1),this.v=new Uint16Array(N)}_createCanvas(u){const a=document.createElement("canvas");return a.width=a.height=u,a}draw(u){const{width:a,actualBoundingBoxAscent:c,actualBoundingBoxDescent:p,actualBoundingBoxLeft:g,actualBoundingBoxRight:x}=this.ctx.measureText(u),w=Math.ceil(c),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-g))),N=Math.min(this.size-this.buffer,w+Math.ceil(p)),D=C+2*this.buffer,U=N+2*this.buffer,q=Math.max(D*U,0),H=new Uint8ClampedArray(q),Y={data:H,width:D,height:U,glyphWidth:C,glyphHeight:N,glyphTop:w,glyphLeft:0,glyphAdvance:a};if(C===0||N===0)return Y;const{ctx:J,buffer:oe,gridInner:ce,gridOuter:he}=this;this.lang&&(J.lang=this.lang),J.clearRect(oe,oe,C,N),J.fillText(u,oe,oe+w);const Se=J.getImageData(oe,oe,C,N);he.fill(hS,0,q),ce.fill(0,0,q);for(let Te=0;Te<N;Te++)for(let ke=0;ke<C;ke++){const qe=Se.data[4*(Te*C+ke)+3]/255;if(qe===0)continue;const Fe=(Te+oe)*D+ke+oe;if(qe===1)he[Fe]=0,ce[Fe]=hS;else{const Xe=.5-qe;he[Fe]=Xe>0?Xe*Xe:0,ce[Fe]=Xe<0?Xe*Xe:0}}L6(he,0,0,D,U,D,this.f,this.v,this.z),L6(ce,oe,oe,C,N,D,this.f,this.v,this.z);for(let Te=0;Te<q;Te++){const ke=Math.sqrt(he[Te])-Math.sqrt(ce[Te]);H[Te]=Math.round(255-255*(ke/this.radius+this.cutoff))}return Y}};const ph=Ty;function z6(u,a){return u+a[1]-a[0]}function wM(u,a,c,p,g=1){const x=[],w=u.imagePrimary,C=w.pixelRatio,N=w.paddedRect.w-2*ph,D=w.paddedRect.h-2*ph,U=(u.right-u.left)*g,q=(u.bottom-u.top)*g,H=w.stretchX||[[0,N]],Y=w.stretchY||[[0,D]],J=H.reduce(z6,0),oe=Y.reduce(z6,0),ce=N-J,he=D-oe;let Se=0,Te=J,ke=0,qe=oe,Fe=0,Xe=ce,et=0,it=he;if(w.content&&p){const pt=w.content;Se=SC(H,0,pt[0]),ke=SC(Y,0,pt[1]),Te=SC(H,pt[0],pt[2]),qe=SC(Y,pt[1],pt[3]),Fe=pt[0]-Se,et=pt[1]-ke,Xe=pt[2]-pt[0]-Te,it=pt[3]-pt[1]-qe}const At=(pt,jt,Rt,zt)=>{const Yt=EC(pt.stretch-Se,Te,U,u.left*g),qt=TC(pt.fixed-Fe,Xe,pt.stretch,J),Dt=EC(jt.stretch-ke,qe,q,u.top*g),Vt=TC(jt.fixed-et,it,jt.stretch,oe),St=EC(Rt.stretch-Se,Te,U,u.left*g),xt=TC(Rt.fixed-Fe,Xe,Rt.stretch,J),$t=EC(zt.stretch-ke,qe,q,u.top*g),Kt=TC(zt.fixed-et,it,zt.stretch,oe),Ft=new st(Yt,Dt),gr=new st(St,Dt),br=new st(St,$t),hr=new st(Yt,$t),ar=new st(qt/C,Vt/C),en=new st(xt/C,Kt/C),lr=a*Math.PI/180;if(lr){const ti=Math.sin(lr),ri=Math.cos(lr),cs=[ri,-ti,ti,ri];Ft._matMult(cs),gr._matMult(cs),hr._matMult(cs),br._matMult(cs)}const Lr=pt.stretch+pt.fixed,rn=Rt.stretch+Rt.fixed,Sn=jt.stretch+jt.fixed,qn=zt.stretch+zt.fixed,on=u.imageSecondary;return{tl:Ft,tr:gr,bl:hr,br,texPrimary:{x:w.paddedRect.x+ph+Lr,y:w.paddedRect.y+ph+Sn,w:rn-Lr,h:qn-Sn},texSecondary:on?{x:on.paddedRect.x+ph+Lr,y:on.paddedRect.y+ph+Sn,w:rn-Lr,h:qn-Sn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ar,pixelOffsetBR:en,minFontScaleX:Xe/C/U,minFontScaleY:it/C/q,isSDF:c}};if(p&&(w.stretchX||w.stretchY)){const pt=B6(H,ce,J),jt=B6(Y,he,oe);for(let Rt=0;Rt<pt.length-1;Rt++){const zt=pt[Rt],Yt=pt[Rt+1];for(let qt=0;qt<jt.length-1;qt++)x.push(At(zt,jt[qt],Yt,jt[qt+1]))}}else x.push(At({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:N+1},{fixed:0,stretch:D+1}));return x}function mpe(u,a){const c=u.stretchY||[[0,u.paddedRect.h-2*ph]];return a&&(u.stretchX||u.stretchY)?$6(u.stretchX||[[0,u.paddedRect.w-2*ph]])*$6(c):1}function SC(u,a,c){let p=0;for(const g of u)p+=Math.max(a,Math.min(c,g[1]))-Math.max(a,Math.min(c,g[0]));return p}function B6(u,a,c){const p=[{fixed:-ph,stretch:0}];for(const[g,x]of u){const w=p[p.length-1];p.push({fixed:g-w.stretch,stretch:w.stretch}),p.push({fixed:g-w.stretch,stretch:w.stretch+(x-g)})}return p.push({fixed:a+ph,stretch:c}),p}function $6(u){return 2*u.length+1}function EC(u,a,c,p){return u/a*c+p}function TC(u,a,c,p){return u-a*c/p}function gpe(u,a,c,p){const g=a+u.positionedLines[p].lineOffset;return p===0?c+g/2:c+(g+(a+u.positionedLines[p-1].lineOffset))/2}function ype(u,a=1,c=!1){let p=1/0,g=1/0,x=-1/0,w=-1/0;const C=u[0];for(let Y=0;Y<C.length;Y++){const J=C[Y];(!Y||J.x<p)&&(p=J.x),(!Y||J.y<g)&&(g=J.y),(!Y||J.x>x)&&(x=J.x),(!Y||J.y>w)&&(w=J.y)}const N=Math.min(x-p,w-g);let D=N/2;const U=new g_([],vpe);if(N===0)return new st(p,g);for(let Y=p;Y<x;Y+=N)for(let J=g;J<w;J+=N)U.push(new bx(Y+D,J+D,D,u));let q=function(Y){let J=0,oe=0,ce=0;const he=Y[0];for(let Se=0,Te=he.length,ke=Te-1;Se<Te;ke=Se++){const qe=he[Se],Fe=he[ke],Xe=qe.x*Fe.y-Fe.x*qe.y;oe+=(qe.x+Fe.x)*Xe,ce+=(qe.y+Fe.y)*Xe,J+=3*Xe}return new bx(oe/J,ce/J,0,Y)}(u),H=U.length;for(;U.length;){const Y=U.pop();(Y.d>q.d||!q.d)&&(q=Y,c&&console.log("found best %d after %d probes",Math.round(1e4*Y.d)/1e4,H)),Y.max-q.d<=a||(D=Y.h/2,U.push(new bx(Y.p.x-D,Y.p.y-D,D,u)),U.push(new bx(Y.p.x+D,Y.p.y-D,D,u)),U.push(new bx(Y.p.x-D,Y.p.y+D,D,u)),U.push(new bx(Y.p.x+D,Y.p.y+D,D,u)),H+=4)}return c&&(console.log(`num probes: ${H}`),console.log(`best distance: ${q.d}`)),q.p}function vpe(u,a){return a.max-u.max}class bx{constructor(a,c,p,g){this.p=new st(a,c),this.h=p,this.d=function(x,w){let C=!1,N=1/0;for(let D=0;D<w.length;D++){const U=w[D];for(let q=0,H=U.length,Y=H-1;q<H;Y=q++){const J=U[q],oe=U[Y];J.y>x.y!=oe.y>x.y&&x.x<(oe.x-J.x)*(x.y-J.y)/(oe.y-J.y)+J.x&&(C=!C),N=Math.min(N,Xl(x,J,oe))}}return(C?1:-1)*Math.sqrt(N)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}}const _pe=Object.keys,SM=Number.POSITIVE_INFINITY,xpe=Math.sqrt(2);function AC(u,a,c,p){const g=u.collisionPadding||[0,0,0,0],x={top:u.top-g[1],bottom:u.bottom+g[3],left:u.left-g[0],right:u.right+g[2],scaled:!1};return p!==void 0&&function(w,C){w.top*=C,w.bottom*=C,w.left*=C,w.right*=C,w.scaled=!0}(x,p),c&&function(w,C){if(!C)return;const N=_n(C),D=new st(w.left,w.top),U=new st(w.right,w.top),q=new st(w.left,w.bottom),H=new st(w.right,w.bottom);D._rotateAround(N,new st(0,0)),U._rotateAround(N,new st(0,0)),q._rotateAround(N,new st(0,0)),H._rotateAround(N,new st(0,0)),w.left=Math.min(D.x,U.x,q.x,H.x),w.right=Math.max(D.x,U.x,q.x,H.x),w.top=Math.min(D.y,U.y,q.y,H.y),w.bottom=Math.max(D.y,U.y,q.y,H.y)}(x,c),a?{top:Math.min(a.top,x.top),bottom:Math.max(a.bottom,x.bottom),left:Math.min(a.left,x.left),right:Math.max(a.right,x.right),scaled:a.scaled||x.scaled}:x}function U6(u,[a,c]){let p=0,g=0;if(c===SM){a<0&&(a=0);const x=a/xpe;switch(u){case"top-right":case"top-left":g=x-7;break;case"bottom-right":case"bottom-left":g=7-x;break;case"bottom":g=7-a;break;case"top":g=a-7}switch(u){case"top-right":case"bottom-right":p=-x;break;case"top-left":case"bottom-left":p=x;break;case"left":p=a;break;case"right":p=-a}}else{switch(a=Math.abs(a),c=Math.abs(c),u){case"top-right":case"top-left":case"top":g=c-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-c}switch(u){case"top-right":case"bottom-right":case"right":p=-a;break;case"top-left":case"bottom-left":case"left":p=a}}return[p,g]}function bpe(u,a,c,p,g,x,w,C,N,D,U){const q=u.layers[0],H=q.appearances;if(H.length===0)return{iconBBox:null,iconVerticalBBox:null};let Y=null,J=null;const oe=p.get("icon-rotate").evaluate(g,{},x);a&&(Y=AC(a,Y,oe,w),c)&&(J=AC(c,J,oe+90,w));const[ce,he]=p.get("icon-size-scale-range"),Se=ve(1,ce,he);for(const Te of H){const ke=Te.getUnevaluatedProperties(),qe=ke._values["icon-image"].value!==void 0,Fe=ke._values["icon-size"].value!==void 0,Xe=ke._values["icon-offset"].value!==void 0,et=ke._values["icon-rotate"].value!==void 0;if(qe||Fe||Xe||et){const it=Xe?q.getAppearanceValueAndResolveTokens(Te,"icon-offset",g,x,[]):null,At=it&&Array.isArray(it)?it:C,pt=et?q.getAppearanceValueAndResolveTokens(Te,"icon-rotate",g,x,[]):null,jt=typeof pt=="number"?pt:oe,Rt=Fe?q.getAppearanceValueAndResolveTokens(Te,"icon-size",g,x,[]):null,zt=typeof Rt=="number"?Rt*N.iconScaleFactor:w;let Yt=null,qt=null,Dt=null;if(qe){const Vt=q.getAppearanceValueAndResolveTokens(Te,"icon-image",g,x,[]);if(Vt){const St=u.getResolvedImageFromTokens(Vt),xt=ke._values["icon-size"],$t=fS(St,vx(u.zoom,xt,u.worldview),xt,x,u.zoom,g,u.pixelRatio,Se,u.worldview);Dt=D.get($t.iconPrimary.toString())}}else a&&(Dt=a.imagePrimary);Dt&&(Yt=wC(Dt,null,At,U),u.allowVerticalPlacement&&(qt=wC(Dt,null,At,U))),Yt&&(Y=AC(Yt,Y,jt,zt)),qt&&(J=AC(qt,J,jt+90,zt))}}return{iconBBox:Y,iconVerticalBBox:J}}function CC(u,a,c,p,g,x,w,C,N){if(!a||!a.usvg)return;const D=P6(p),U=P6(g),q=x!=="both"&&x!=="width"||!C6(p)?1:U.width/D.width,H=x!=="both"&&x!=="height"||!j6(p)?1:U.height/D.height;c.scaleSelf(q,H);const Y=c.toString();w.set(Y,c),C.set(Y,a);const{imagePosition:J}=xM(Y,a,Ty);N.set(Y,J)}function V6(u,a,c,p,g,x,w,C,N){if(!u)return;const D=function(U,q,H,Y,J,oe){if(U.kind==="camera")return U.maxSize;if(U.kind==="composite"){const ce=q.possiblyEvaluate(new Vi(U.maxZoom,{worldview:oe}),H).evaluate(J,{},H),he=q.possiblyEvaluate(new Vi(U.minZoom,{worldview:oe}),H).evaluate(J,{},H);return Math.max(ce,he)}return q.possiblyEvaluate(new Vi(Y,{worldview:oe})).evaluate(J,{},H)}(a,c,p,g,x,N);return u.scaleSelf(D*C*w)}function fS(u,a,c,p,g,x,w,C,N){return{iconPrimary:V6(u.getPrimary(),a,c,p,g,x,w,C,N),iconSecondary:V6(u.getSecondary(),a,c,p,g,x,w,C,N)}}function wpe(u,a,c){if(!a)return;const p=c.get(u.toString()),g=c.get(a.toString());p&&g&&(p.paddedRect.w===g.paddedRect.w&&p.paddedRect.h===g.paddedRect.h||zr(`Mismatch in icon variant sizes: ${u.toString()} and ${a.toString()}`),p.usvg!==g.usvg&&zr(`Mismatch in icon variant image types: ${u.id} and ${a.id}`))}function q6(u,a,c,p){if(!u)return;const g=a.get(c.toString());if(u.imagePrimary=g,p){const x=a.get(p.toString());u.imageSecondary=x}}function Spe(u,a){for(const c in u.horizontal)H6(u.horizontal[c],a);H6(u.vertical,a)}function H6(u,a){if(u){for(const c of u.positionedLines)for(const p of c.positionedGlyphs)if(p.image!==null){const g=p.image.toString();p.rect=a.get(g).paddedRect}}}function EM(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Epe(u,a,c,p,g,x,w,C,N){const D=TM(x.horizontal)||x.vertical,U=c.get("icon-text-fit-padding").evaluate(p,{},g);let q,H=a;return a&&N!=="none"&&(u.allowVerticalPlacement&&x.vertical&&(q=vM(a,x.vertical,N,U,C,w)),D&&(H=vM(a,D,N,U,C,w))),{defaultShapedIcon:H,verticallyShapedIcon:q}}function Tpe(u,a,c,p,g,x,w,C,N,D,U,q,H,Y,J,oe,ce,he,Se,Te,ke,qe){let Fe=w.textMaxSize.evaluate(a,{},H);Fe===void 0?Fe=C*w.textScaleFactor:Fe*=w.textScaleFactor;const Xe=u.layers[0].layout,et=Xa,it=C*w.textScaleFactor/et,At=TM(c.horizontal)||c.vertical;if(ce!=="none"&&u.appearanceFeatureData&&a.index<u.appearanceFeatureData.length){const Ft=u.appearanceFeatureData[a.index];Ft&&(Ft.textShaping=At,Ft.iconTextFitPadding=Xe.get("icon-text-fit-padding").evaluate(a,{},H),Ft.fontScale=it)}const pt=Y.name==="globe",jt=u.tilePixelRatio*Fe/et,Rt=(St=u.overscaling,u.zoom>18&&St>2&&(St>>=1),Math.max(tr/(512*St),1)*Xe.get("symbol-spacing")),zt=Xe.get("text-padding")*u.tilePixelRatio,Yt=Xe.get("icon-padding")*u.tilePixelRatio,qt=_n(Xe.get("text-max-angle")),Dt=Xe.get("icon-rotation-alignment")==="map"&&Te!=="point",Vt=Rt/2;var St;u.hasAnyIconTextFit===!1&&ce!=="none"&&(u.hasAnyIconTextFit=!0);const xt=a.properties?+a.properties[dr]:null,$t=xt&&u.elevationFeatureIdToIndex?u.elevationFeatureIdToIndex.get(xt):65535,Kt=(Ft,gr,br)=>{if(gr.x<0||gr.x>=tr||gr.y<0||gr.y>=tr)return;let hr=null;if(pt){const{x:ar,y:en,z:lr}=Y.projectTilePoint(gr.x,gr.y,br);hr={anchor:new Cf(ar,en,lr,0,void 0),up:Y.upVector(br,gr.x,gr.y)}}(function(ar,en,lr,Lr,rn,Sn,qn,on,ti,ri,cs,ze,Re,Ot,ir,kt,or,jr,Tr,cn,qr,Sr,Jn,Ai,Wr,Bn,Ci,fi,_s,es,Bi){const xi=ar.addToLineVertexArray(en,Lr);let ni,un,ii,$i,Hr,Hn,ts,As=0,Ls=0,na=0,rs=0,Ys=-1,Il=-1;const Js={};let rc=Bg("");const Eo=lr?lr.anchor:en,su=fi!=="none";let Rl=0,nc=0;if(ti._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Ya=ti.layout.get("text-offset").evaluate(qr,{},Wr);Rl=Ya[0]*Xa,nc=Ya[1]*Xa}else Rl=ti.layout.get("text-radial-offset").evaluate(qr,{},Wr)*Xa,nc=SM;if(ar.allowVerticalPlacement&&rn.vertical){const Ya=rn.vertical;if(ir)Hn=AM(Ya),on&&(ts=AM(on));else{const ol=ti.layout.get("text-rotate").evaluate(qr,{},Wr)+90;ii=jC(ri,Eo,en,cs,ze,Re,Ya,Ot,ol,kt),on&&($i=jC(ri,Eo,en,cs,ze,Re,on,jr,ol,null,Bi))}}if(Sn){const Ya=ar.iconSizeData,ol=ti.layout.get("icon-rotate").evaluate(qr,{},Wr),mh=wM(Sn,ol,Jn,su,Sr.iconScaleFactor),lm=on?wM(on,ol,Jn,su,Sr.iconScaleFactor):void 0;un=jC(ri,Eo,en,cs,ze,Re,Sn,jr,ol,null,es);const jx=function(gh,HC,Px,Fme,uq,dq,zme,Bme){const hq=gh.layers[0],fq=hq.appearances;let Ox=HC.length;if(Px&&(Ox=Math.max(Ox,Px.length)),fq.length===0)return Ox;const[$me,Ume]=Fme.get("icon-size-scale-range"),Vme=ve(1,$me,Ume);for(const pq of fq){const mq=pq.getUnevaluatedProperties();if(mq._values["icon-image"].value!==void 0){const gq=hq.getAppearanceValueAndResolveTokens(pq,"icon-image",uq,dq,[]);if(gq){const yq=gh.getResolvedImageFromTokens(gq);if(yq){const vq=mq._values["icon-size"],qme=fS(yq,vx(gh.zoom,vq,gh.worldview),vq,dq,gh.zoom,uq,gh.pixelRatio,Vme,gh.worldview),Hme=zme.get(qme.iconPrimary.toString());Ox=Math.max(Ox,mpe(Hme,Bme))}}}}return Ox}(ar,mh,lm,ti.layout,qr,Wr,ar.iconAtlasPositions,su);As=4*jx;let cm=null;Ya.kind==="source"?(cm=[xd*ti.layout.get("icon-size").evaluate(qr,{},Wr)*Sr.iconScaleFactor],cm[0]>jf&&zr(`${ar.layerIds[0]}: Value for "icon-size" is >= ${pS}. Reduce your "icon-size".`)):Ya.kind==="composite"&&(cm=[xd*Sr.compositeIconSizes[0].evaluate(qr,{},Wr)*Sr.iconScaleFactor,xd*Sr.compositeIconSizes[1].evaluate(qr,{},Wr)*Sr.iconScaleFactor],(cm[0]>jf||cm[1]>jf)&&zr(`${ar.layerIds[0]}: Value for "icon-size" is >= ${pS}. Reduce your "icon-size".`)),ar.addSymbols(ar.icon,mh,cm,cn,Tr,qr,void 0,lr,en,xi.lineStartIndex,xi.lineLength,-1,Ai,Wr,Bn,Ci,ar.symbolInstances.length,jx),Ys=ar.icon.placedSymbolArray.length-1,lm&&(Ls=4*jx,ar.addSymbols(ar.icon,lm,cm,cn,Tr,qr,tc.vertical,lr,en,xi.lineStartIndex,xi.lineLength,-1,Ai,Wr,Bn,Ci,ar.symbolInstances.length,jx),Il=ar.icon.placedSymbolArray.length-1)}for(const Ya in rn.horizontal){const ol=Ya,mh=rn.horizontal[ol];ni||(rc=Bg(mh.text),ir?Hr=AM(mh):ni=jC(ri,Eo,en,cs,ze,Re,mh,Ot,ti.layout.get("text-rotate").evaluate(qr,{},Wr),kt));const lm=mh.positionedLines.length===1;if(na+=G6(ar,lr,en,mh,qn,ti,ir,qr,kt,xi,rn.vertical?tc.horizontal:tc.horizontalOnly,lm?_pe(rn.horizontal):[ol],Js,Ys,Sr,Ai,Wr,ar.symbolInstances.length,Bn),lm)break}rn.vertical&&(rs+=G6(ar,lr,en,rn.vertical,qn,ti,ir,qr,kt,xi,tc.vertical,["vertical"],Js,Il,Sr,Ai,Wr,ar.symbolInstances.length,Bn));let To=-1;const ic=(Ya,ol)=>Ya?Math.max(Ya,ol):ol;To=ic(Hr,To),To=ic(Hn,To),To=ic(ts,To);const au=To>-1?1:0;ar.glyphOffsetArray.length>=65535&&zr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),qr.sortKey!==void 0&&ar.addToSortKeyRanges(ar.symbolInstances.length,qr.sortKey),ar.symbolInstances.emplaceBack(en.x,en.y,Eo.x,Eo.y,Eo.z,Js.right>=0?Js.right:-1,Js.center>=0?Js.center:-1,Js.left>=0?Js.left:-1,Js.vertical>=0?Js.vertical:-1,Ys,Il,rc,ni!==void 0?ni:ar.collisionBoxArray.length,ni!==void 0?ni+1:ar.collisionBoxArray.length,ii!==void 0?ii:ar.collisionBoxArray.length,ii!==void 0?ii+1:ar.collisionBoxArray.length,un!==void 0?un:ar.collisionBoxArray.length,un!==void 0?un+1:ar.collisionBoxArray.length,$i||ar.collisionBoxArray.length,$i?$i+1:ar.collisionBoxArray.length,cs,na,rs,As,Ls,au,0,Rl,nc,To,0,su?1:0,_s)})(u,gr,hr,Ft,c,p,x,g,u.layers[0],u.collisionBoxArray,a.index,a.sourceLayerIndex,u.index,zt,Se,D,0,Yt,Dt,he,a,w,U,q,H,J,oe,ce,$t,ke,qe)};if(Te==="line")for(const Ft of cC(a.geometry,0,0,tr,tr)){const gr=ppe(Ft,Rt,qt,c.vertical||At,p,et,jt,u.overscaling,tr);for(const br of gr)At&&Ape(u,At.text,Vt,br)||Kt(Ft,br,H)}else if(Te==="line-center"){for(const Ft of a.geometry)if(Ft.length>1){const gr=fpe(Ft,qt,c.vertical||At,p,et,jt);gr&&Kt(Ft,gr,H)}}else if(a.type==="Polygon")for(const Ft of X1(a.geometry,0)){const gr=ype(Ft,16);Kt(Ft[0],new Cf(gr.x,gr.y,0,0,void 0),H)}else if(a.type==="LineString")for(const Ft of a.geometry)Kt(Ft,new Cf(Ft[0].x,Ft[0].y,0,0,void 0),H);else if(a.type==="Point")for(const Ft of a.geometry)for(const gr of Ft)Kt([gr],new Cf(gr.x,gr.y,0,0,void 0),H)}const pS=255,jf=pS*xd;function G6(u,a,c,p,g,x,w,C,N,D,U,q,H,Y,J,oe,ce,he,Se){const Te=function(Fe,Xe,et,it,At,pt,jt,Rt){const zt=[];if(Xe.positionedLines.length===0)return zt;const Yt=it.layout.get("text-rotate").evaluate(pt,{})*Math.PI/180,qt=function($t){const Kt=$t[0],Ft=$t[1],gr=Kt*Ft;return gr>0?[Kt,-Ft]:gr<0?[-Kt,Ft]:Kt===0?[Ft,Kt]:[Ft,-Kt]}(et);let Dt=Math.abs(Xe.top-Xe.bottom);for(const $t of Xe.positionedLines)Dt-=$t.lineOffset;const Vt=Xe.positionedLines.length,St=Dt/Vt;let xt=Xe.top-et[1];for(let $t=0;$t<Vt;++$t){const Kt=Xe.positionedLines[$t];xt=gpe(Xe,St,xt,$t);for(const Ft of Kt.positionedGlyphs){if(!Ft.rect)continue;const gr=Ft.rect||{};let br=x6+1,hr=!0,ar=1,en=0;if(Ft.image){const Tr=jt.get(Ft.image.toString());if(!Tr)continue;if(Tr.sdf){zr("SDF images are not supported in formatted text and will be ignored.");continue}hr=!1,ar=Tr.pixelRatio,br=Ty/ar}const lr=(At||Rt)&&Ft.vertical,Lr=Ft.metrics.advance*Ft.scale/2,rn=Ft.metrics,Sn=Ft.rect;if(Sn===null)continue;Rt&&Xe.verticalizable&&(en=Ft.image?Lr-Ft.metrics.width*Ft.scale/2:0);const qn=At?[Ft.x+Lr,Ft.y]:[0,0];let on=[0,0],ti=[0,0],ri=!1;At||(lr?(ti=[Ft.x+Lr+qt[0],Ft.y+qt[1]-en],ri=!0):on=[Ft.x+Lr+et[0],Ft.y+et[1]-en]);const cs=Sn.w*Ft.scale/(ar*(Ft.localGlyph?bd:1)),ze=Sn.h*Ft.scale/(ar*(Ft.localGlyph?bd:1));let Re,Ot,ir,kt;if(lr){const Tr=Ft.y-xt,cn=new st(-Lr,Lr-Tr),qr=-Math.PI/2,Sr=new st(...ti);Re=new st(-Lr+on[0],on[1]),Re._rotateAround(qr,cn)._add(Sr),Re.x+=-Tr+Lr,Re.y-=(rn.left-br)*Ft.scale;const Jn=Ft.image?rn.advance*Ft.scale:Xa*Ft.scale,Ai=String.fromCodePoint(Ft.glyph);Yfe(Ai)?Re.x+=(1-br)*Ft.scale:Jfe(Ai)?Re.x+=Jn-rn.height*Ft.scale+(-br-1)*Ft.scale:Re.x+=Ft.image||rn.width+2*br===Sn.w&&rn.height+2*br===Sn.h?(Jn-ze)/2:(Jn-(rn.height+2*br)*Ft.scale)/2,Ot=new st(Re.x,Re.y-cs),ir=new st(Re.x+ze,Re.y),kt=new st(Re.x+ze,Re.y-cs)}else{const Tr=(rn.left-br)*Ft.scale-Lr+on[0],cn=(-rn.top-br)*Ft.scale+on[1],qr=Tr+cs,Sr=cn+ze;Re=new st(Tr,cn),Ot=new st(qr,cn),ir=new st(Tr,Sr),kt=new st(qr,Sr)}if(Yt){let Tr;Tr=At?new st(0,0):ri?new st(qt[0],qt[1]):new st(et[0],et[1]),Re._rotateAround(Yt,Tr),Ot._rotateAround(Yt,Tr),ir._rotateAround(Yt,Tr),kt._rotateAround(Yt,Tr)}const or=new st(0,0),jr=new st(0,0);zt.push({tl:Re,tr:Ot,bl:ir,br:kt,texPrimary:gr,texSecondary:void 0,writingMode:Xe.writingMode,glyphOffset:qn,sectionIndex:Ft.sectionIndex,isSDF:hr,pixelOffsetTL:or,pixelOffsetBR:jr,minFontScaleX:0,minFontScaleY:0})}}return zt}(0,p,N,x,w,C,g,u.allowVerticalPlacement),ke=u.textSizeData;let qe=null;ke.kind==="source"?(qe=[xd*x.layout.get("text-size").evaluate(C,{},ce)*J.textScaleFactor],qe[0]>jf&&zr(`${u.layerIds[0]}: Value for "text-size" is >= ${pS}. Reduce your "text-size".`)):ke.kind==="composite"&&(qe=[xd*J.compositeTextSizes[0].evaluate(C,{},ce)*J.textScaleFactor,xd*J.compositeTextSizes[1].evaluate(C,{},ce)*J.textScaleFactor],(qe[0]>jf||qe[1]>jf)&&zr(`${u.layerIds[0]}: Value for "text-size" is >= ${pS}. Reduce your "text-size".`)),u.addSymbols(u.text,Te,qe,N,w,C,U,a,c,D.lineStartIndex,D.lineLength,Y,oe,ce,Se,!1,he,Te.length);for(const Fe of q)H[Fe]=u.text.placedSymbolArray.length-1;return 4*Te.length}function TM(u){for(const a in u)return u[a];return null}function jC(u,a,c,p,g,x,w,C,N,D,U){let q,H,Y,J;if(q=U?U.top:w.top,H=U?U.bottom:w.bottom,Y=U?U.left:w.left,J=U?U.right:w.right,A6(w)&&w.collisionPadding){const oe=w.collisionPadding;Y-=oe[0],q-=oe[1],J+=oe[2],H+=oe[3]}if(N){const oe=new st(Y,q),ce=new st(J,q),he=new st(Y,H),Se=new st(J,H),Te=_n(N);let ke=new st(0,0);D&&(ke=new st(D[0],D[1])),oe._rotateAround(Te,ke),ce._rotateAround(Te,ke),he._rotateAround(Te,ke),Se._rotateAround(Te,ke),Y=Math.min(oe.x,ce.x,he.x,Se.x),J=Math.max(oe.x,ce.x,he.x,Se.x),q=Math.min(oe.y,ce.y,he.y,Se.y),H=Math.max(oe.y,ce.y,he.y,Se.y)}return u.emplaceBack(a.x,a.y,a.z,c.x,c.y,Y,q,J,H,C,p,g,x),u.length-1}function AM(u){A6(u)&&u.collisionPadding&&(u.top-=u.collisionPadding[1],u.bottom+=u.collisionPadding[3]);const a=u.bottom-u.top;return a>0?Math.max(10,a):null}function Ape(u,a,c,p){const g=u.compareText;if(a in g){const x=g[a];for(let w=x.length-1;w>=0;w--)if(p.dist(x[w])<c)return!0}else g[a]=[];return g[a].push(p),!1}function W6(u,a){const c=u.fovAboveCenter,p=u.elevation?u.elevation.getMinElevationBelowMSL()*a:0,g=(u._camera.position[2]*u.worldSize-p)/Math.cos(u._pitch),x=Math.sin(c)*g/Math.sin(Math.max(Math.PI/2-u._pitch-c,.01));let w=Math.sin(u._pitch)*x+g;const C=g*(1/u._horizonShift);if(!u.elevation||u.elevation.exaggeration()===0){let N=Math.max(u.zoom-17,0);u.isOrthographic&&(N/=10),w*=1+N}return Math.min(1.01*w,C)}function mS(u,a){if(!a.isReprojectedInTileSpace)return{scale:1<<u.z,x:u.x,y:u.y,x2:u.x+1,y2:u.y+1,projection:a};const c=Math.pow(2,-u.z),p=u.x*c,g=(u.x+1)*c,x=u.y*c,w=(u.y+1)*c,C=Ne(p),N=Ne(g),D=je(x),U=je(w),q=a.project(C,D),H=a.project(N,D),Y=a.project(N,U),J=a.project(C,U);let oe=Math.min(q.x,H.x,Y.x,J.x),ce=Math.min(q.y,H.y,Y.y,J.y),he=Math.max(q.x,H.x,Y.x,J.x),Se=Math.max(q.y,H.y,Y.y,J.y);const Te=c/16;function ke(Fe,Xe,et,it,At,pt){const jt=(et+At)/2,Rt=(it+pt)/2,zt=a.project(Ne(jt),je(Rt)),Yt=Math.max(0,oe-zt.x,ce-zt.y,zt.x-he,zt.y-Se);oe=Math.min(oe,zt.x),he=Math.max(he,zt.x),ce=Math.min(ce,zt.y),Se=Math.max(Se,zt.y),Yt>Te&&(ke(Fe,zt,et,it,jt,Rt),ke(zt,Xe,jt,Rt,At,pt))}ke(q,H,p,x,g,x),ke(H,Y,g,x,g,w),ke(Y,J,g,w,p,w),ke(J,q,p,w,p,x),oe-=Te,ce-=Te,he+=Te,Se+=Te;const qe=1/Math.max(he-oe,Se-ce);return{scale:qe,x:oe*qe,y:ce*qe,x2:he*qe,y2:Se*qe,projection:a}}function K6(u,{x:a,y:c},p=0){return new st(((a-p)*u.scale-u.x)*tr,(c*u.scale-u.y)*tr)}const Cpe=I(new Float32Array(16));class am{constructor(a){this.spec=a,this.name=a.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(a,c){return{x:0,y:0,z:0}}unproject(a,c){return new Q(0,0)}projectTilePoint(a,c,p){return{x:a,y:c,z:0}}locationPoint(a,c,p,g=!0){return a._coordinatePoint(a.locationCoordinate(c,p),g)}pixelsPerMeter(a,c){return Ee(1,a)*c}pixelSpaceConversion(a,c,p){return 1}farthestPixelDistance(a){return W6(a,a.pixelsPerMeter)}pointCoordinate(a,c,p,g){const x=a.horizonLineFromTop(!1),w=new st(c,Math.max(x,p));return a.rayIntersectionCoordinate(a.pointRayIntersection(w,g))}pointCoordinate3D(a,c,p){const g=new st(c,p);if(a.elevation)return a.elevation.pointCoordinate(g);{const x=this.pointCoordinate(a,g.x,g.y,0);return[x.x,x.y,x.z]}}isPointAboveHorizon(a,c){if(a.elevation&&a.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(a,c.x,c.y);const p=a.horizonLineFromTop();return c.y<p}createInversionMatrix(a,c){return Cpe}createTileMatrix(a,c,p){let g,x,w;const C=p.canonical,N=I(new Float64Array(16));if(this.isReprojectedInTileSpace){const D=mS(C,this);g=1,x=D.x+p.wrap*D.scale,w=D.y,z(N,N,[g/D.scale,g/D.scale,a.pixelsPerMeter/c])}else g=c/a.zoomScale(C.z),x=(C.x+Math.pow(2,C.z)*p.wrap)*g,w=C.y*g;return F(N,N,[x,w,0]),z(N,N,[g/tr,g/tr,1]),N}upVector(a,c,p){return[0,0,1]}upVectorScale(a,c,p){return{metersToTile:1}}}class jpe extends am{constructor(a){super(a),this.range=[4,7],this.center=a.center||[-96,37.5];const[c,p]=this.parallels=a.parallels||[29.5,45.5],g=Math.sin(_n(c));this.n=(g+Math.sin(_n(p)))/2,this.c=1+g*(2*this.n-g),this.r0=Math.sqrt(this.c)/this.n}project(a,c){const{n:p,c:g,r0:x}=this,w=_n(a-this.center[0]),C=_n(c),N=Math.sqrt(g-2*p*Math.sin(C))/p;return{x:N*Math.sin(w*p),y:N*Math.cos(w*p)-x,z:0}}unproject(a,c){const{n:p,c:g,r0:x}=this,w=x+c;let C=Math.atan2(a,Math.abs(w))*Math.sign(w);w*p<0&&(C-=Math.PI*Math.sign(a)*Math.sign(w));const N=_n(this.center[0])*p;C=Qe(C,-Math.PI-N,Math.PI-N);const D=ve(Fo(C/p)+this.center[0],-180,180),U=Math.asin(ve((g-(a*a+w*w)*p*p)/(2*p),-1,1)),q=ve(Fo(U),-Ie,Ie);return new Q(D,q)}}const gS=1.340264,yS=-.081106,vS=893e-6,_S=.003796,PC=Math.sqrt(3)/2;class Ppe extends am{project(a,c){c=c/180*Math.PI,a=a/180*Math.PI;const p=Math.asin(PC*Math.sin(c)),g=p*p,x=g*g*g;return{x:.5*(a*Math.cos(p)/(PC*(gS+3*yS*g+x*(7*vS+9*_S*g)))/Math.PI+.5),y:1-.5*(p*(gS+yS*g+x*(vS+_S*g))/Math.PI+1),z:0}}unproject(a,c){a=(2*a-.5)*Math.PI;let p=c=(2*(1-c)-1)*Math.PI,g=p*p,x=g*g*g;for(let U,q,H,Y=0;Y<12&&(q=p*(gS+yS*g+x*(vS+_S*g))-c,H=gS+3*yS*g+x*(7*vS+9*_S*g),U=q/H,p=ve(p-U,-Math.PI/3,Math.PI/3),g=p*p,x=g*g*g,!(Math.abs(U)<1e-12));++Y);const w=PC*a*(gS+3*yS*g+x*(7*vS+9*_S*g))/Math.cos(p),C=Math.asin(Math.sin(p)/PC),N=ve(180*w/Math.PI,-180,180),D=ve(180*C/Math.PI,-Ie,Ie);return new Q(N,D)}}class Ope extends am{constructor(a){super(a),this.wrap=!0,this.supportsWorldCopies=!0}project(a,c){return{x:.5+a/360,y:.5-c/360,z:0}}unproject(a,c){const p=360*(a-.5),g=ve(360*(.5-c),-Ie,Ie);return new Q(p,g)}}const wx=Math.PI/2;function OC(u){return Math.tan((wx+u)/2)}class kpe extends am{constructor(a){super(a),this.center=a.center||[0,30];const[c,p]=this.parallels=a.parallels||[30,30];let g=_n(c),x=_n(p);this.southernCenter=g+x<0,this.southernCenter&&(g=-g,x=-x);const w=Math.cos(g),C=OC(g);this.n=g===x?Math.sin(g):Math.log(w/Math.cos(x))/Math.log(OC(x)/C),this.f=w*Math.pow(OC(g),this.n)/this.n}project(a,c){c=_n(c),this.southernCenter&&(c=-c),a=_n(a-this.center[0]);const p=1e-6,{n:g,f:x}=this;x>0?c<-wx+p&&(c=-wx+p):c>wx-p&&(c=wx-p);const w=x/Math.pow(OC(c),g);let C=w*Math.sin(g*a),N=x-w*Math.cos(g*a);return C=.5*(C/Math.PI+.5),N=.5*(N/Math.PI+.5),{x:C,y:this.southernCenter?N:1-N,z:0}}unproject(a,c){a=(2*a-.5)*Math.PI,this.southernCenter&&(c=1-c),c=(2*(1-c)-.5)*Math.PI;const{n:p,f:g}=this,x=g-c,w=Math.sign(x),C=Math.sign(p)*Math.sqrt(a*a+x*x);let N=Math.atan2(a,Math.abs(x))*w;x*p<0&&(N-=Math.PI*Math.sign(a)*w);const D=ve(Fo(N/p)+this.center[0],-180,180),U=ve(Fo(2*Math.atan(Math.pow(g/C,1/p))-wx),-Ie,Ie);return new Q(D,this.southernCenter?-U:U)}}class Z6 extends am{constructor(a){super(a),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(a,c){return{x:xe(a),y:ye(c),z:0}}unproject(a,c){const p=Ne(a),g=je(c);return new Q(p,g)}}const X6=_n(Ie);class Npe extends am{project(a,c){const p=(c=_n(c))*c,g=p*p;return{x:.5*((a=_n(a))*(.8707-.131979*p+g*(g*(.003971*p-.001529*g)-.013791))/Math.PI+.5),y:1-.5*(c*(1.007226+p*(.015085+g*(.028874*p-.044475-.005916*g)))/Math.PI+1),z:0}}unproject(a,c){a=(2*a-.5)*Math.PI;let p=c=(2*(1-c)-1)*Math.PI,g=25,x=0,w=p*p;do{w=p*p;const D=w*w;x=(p*(1.007226+w*(.015085+D*(.028874*w-.044475-.005916*D)))-c)/(1.007226+w*(.045255+D*(.259866*w-.311325-.005916*11*D))),p=ve(p-x,-X6,X6)}while(Math.abs(x)>1e-6&&--g>0);w=p*p;const C=ve(Fo(a/(.8707+w*(w*(w*w*w*(.003971-.001529*w)-.013791)-.131979))),-180,180),N=Fo(p);return new Q(C,N)}}const Y6=_n(Ie);class Ipe extends am{project(a,c){c=_n(c),a=_n(a);const p=Math.cos(c),g=2/Math.PI,x=Math.acos(p*Math.cos(a/2)),w=Math.sin(x)/x,C=.5*(a*g+2*p*Math.sin(a/2)/w)||0,N=.5*(c+Math.sin(c)/w)||0;return{x:.5*(C/Math.PI+.5),y:1-.5*(N/Math.PI+1),z:0}}unproject(a,c){let p=a=(2*a-.5)*Math.PI,g=c=(2*(1-c)-1)*Math.PI,x=25;const w=1e-6;let C=0,N=0;do{const D=Math.cos(g),U=Math.sin(g),q=2*U*D,H=U*U,Y=D*D,J=Math.cos(p/2),oe=Math.sin(p/2),ce=2*J*oe,he=oe*oe,Se=1-Y*J*J,Te=Se?1/Se:0,ke=Se?Math.acos(D*J)*Math.sqrt(1/Se):0,qe=.5*(2*ke*D*oe+2*p/Math.PI)-a,Fe=.5*(ke*U+g)-c,Xe=.5*Te*(Y*he+ke*D*J*H)+1/Math.PI,et=Te*(ce*q/4-ke*U*oe),it=.125*Te*(q*oe-ke*U*Y*ce),At=.5*Te*(H*J+ke*he*D)+.5,pt=et*it-At*Xe;C=(Fe*et-qe*At)/pt,N=(qe*it-Fe*Xe)/pt,p=ve(p-C,-Math.PI,Math.PI),g=ve(g-N,-Y6,Y6)}while((Math.abs(C)>w||Math.abs(N)>w)&&--x>0);return new Q(Fo(p),Fo(g))}}class J6 extends am{constructor(a){super(a),this.center=a.center||[0,0],this.parallels=a.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(_n(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(a,c){const{scale:p,cosPhi:g}=this;return{x:_n(a)*g*p+.5,y:-Math.sin(_n(c))/g*p+.5,z:0}}unproject(a,c){const{scale:p,cosPhi:g}=this,x=-(c-.5)/p,w=ve(Fo((a-.5)/p)/g,-180,180),C=Math.asin(ve(x*g,-1,1)),N=ve(Fo(C),-Ie,Ie);return new Q(w,N)}}class Rpe extends Z6{constructor(a){super(a),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(a,c,p){const g=q1(a,c,p);return Ht(g,g,eC(hh(p))),{x:g[0],y:g[1],z:g[2]}}locationPoint(a,c,p){const g=B(c.lat,c.lng),x=Me([],g),w=p?a._centerAltitude+p:a.elevation?a.elevation.getAtPointOrZero(a.locationCoordinate(c),a._centerAltitude):a._centerAltitude;Je(g,g,x,Ee(1,0)*tr*w);const C=I(new Float64Array(16));return M(C,a.pixelMatrix,a.globeMatrix),Ht(g,g,C),new st(g[0],g[1])}pixelsPerMeter(a,c){return Ee(1,0)*c}pixelSpaceConversion(a,c,p){const g=Ee(1,a)*c,x=Kr(Ee(1,45)*c,g,p);return this.pixelsPerMeter(a,c)/x}createTileMatrix(a,c,p){const g=NR(hh(p.canonical));return M(new Float64Array(16),a.globeMatrix,g)}createInversionMatrix(a,c){const{center:p}=a,g=eC(hh(c));return W(g,g,_n(p.lng)),$(g,g,_n(p.lat)),z(g,g,[a._pixelsPerMercatorPixel,a._pixelsPerMercatorPixel,1]),Float32Array.from(g)}pointCoordinate(a,c,p,g){return wU(a,c,p,!0)||new dt(0,0)}pointCoordinate3D(a,c,p){const g=this.pointCoordinate(a,c,p,0);return[g.x,g.y,g.z]}isPointAboveHorizon(a,c){return!wU(a,c.x,c.y,!1)}farthestPixelDistance(a){const c=function(g,x){const w=g.cameraToCenterDistance,C=g._centerAltitude*x,N=g._camera,D=g._camera.forward(),U=_e([],Oe([],D,-w),[0,0,C]),q=g.worldSize/(2*Math.PI),H=[0,0,-q],Y=g.width/g.height,J=Math.tan(g.fovAboveCenter),oe=Oe([],N.up(),J),ce=Oe([],N.right(),J*Y),he=Me([],_e([],_e([],D,oe),ce)),Se=[];let Te;if(new hn(U,he).closestPointOnSphere(H,q,Se)){const ke=_e([],Se,H),qe=Pt([],ke,U);Te=Math.cos(g.fovAboveCenter)*be(qe)}else{const ke=Pt([],U,H),qe=Pt([],H,U);Me(qe,qe);const Fe=be(ke)-q;Te=Math.sqrt(Fe*(Fe+2*q));const Xe=Math.acos(Te/(q+Fe))-Math.acos(We(D,qe));Te*=Math.cos(Xe)}return 1.01*Te}(a,this.pixelsPerMeter(a.center.lat,a.worldSize)),p=rm(a.zoom);if(p>0){const g=W6(a,Ee(1,a.center.lat)*a.worldSize),x=a.worldSize/(2*Math.PI),w=Math.max(a.width,a.height)/a.worldSize*Math.PI;return Kr(c,g+x*(1-Math.cos(w)),Math.pow(p,10))}return c}upVector(a,c,p){return q1(c,p,a,1)}upVectorScale(a){return{metersToTile:YA(QA(hh(a)))}}}function Q6(u){const a=u.parallels,c=!!a&&Math.abs(a[0]+a[1])<.01;switch(u.name){case"mercator":return new Z6(u);case"equirectangular":return new Ope(u);case"naturalEarth":return new Npe(u);case"equalEarth":return new Ppe(u);case"winkelTripel":return new Ipe(u);case"albers":return c?new J6(u):new jpe(u);case"lambertConformalConic":return c?new J6(u):new kpe(u);case"globe":return new Rpe(u)}throw new Error(`Invalid projection name: ${u.name}`)}const Mpe=Bt.types,Dpe=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function xS(u,a,c,p,g,x,w,C,N,D,U,q,H){const Y=C?Math.min(jf,Math.round(C[0])):0,J=C?Math.min(jf,Math.round(C[1])):0;u.emplaceBack(a,c,Math.round(32*p),Math.round(32*g),x,w,(Y<<1)+(N?1:0),0+(J<<1),16*D,16*U,256*q,256*H)}function bS(u,a,c){u.emplaceBack(a,c)}function wS(u,a,c,p,g,x,w){u.emplaceBack(a,c,p,g,x,w)}const kC=(u,a,c,p)=>{for(let g=0;g<a;g++)u.emplaceBack(c[0],c[1],c[2],p[0],p[1],p[2])};function Sx(u,a,c,p,g){u.emplaceBack(a,c,p,g),u.emplaceBack(a,c,p,g),u.emplaceBack(a,c,p,g),u.emplaceBack(a,c,p,g)}function Lpe(u){for(const a of u.sections)if(mR(a.text))return!0;return!1}class CM{constructor(a){this.layoutVertexArray=new Y_,this.indexArray=new is,this.programConfigurations=a,this.segments=new ds,this.dynamicLayoutVertexArray=new uh,this.opacityVertexArray=new j1,this.placedSymbolArray=new py,this.iconTransitioningVertexArray=new Oc,this.globeExtVertexArray=new Wp,this.zOffsetVertexArray=new md,this.orientationVertexArray=new k1,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(a,c){const p=[],g=this.layoutVertexArray.uint16;for(let x=0;x<c;++x){const w=12*(a+x);p.push(...g.slice(w,w+12))}return p}updateIconVertexData(a,c,p,g,x,w,C,N,D,U,q,H,Y){const J=this.layoutVertexArray.uint16,oe=12*a;J[oe]=c,J[oe+1]=p,J[oe+2]=g,J[oe+3]=x,J[oe+4]=w,J[oe+5]=C,J[oe+6]=N,J[oe+7]=D,J[oe+8]=U,J[oe+9]=q,J[oe+10]=H,J[oe+11]=Y}upload(a,c,p,g,x,w){this.isEmpty()||(p&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,$fe.members,!!w),this.indexBuffer=a.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,Vfe.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,Dpe,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=a.createVertexBuffer(this.iconTransitioningVertexArray,Gfe.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=a.createVertexBuffer(this.globeExtVertexArray,Ufe.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||x)&&(this.zOffsetVertexBuffer=a.createVertexBuffer(this.zOffsetVertexArray,qfe.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=a.createVertexBuffer(this.orientationVertexArray,Hfe.members,!0)),this.opacityVertexBuffer.itemSize=1),(p||g)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}_r(CM,"SymbolBuffers");class jM{constructor(a,c,p){this.layoutVertexArray=new a,this.layoutAttributes=c,this.indexArray=new p,this.segments=new ds,this.collisionVertexArray=new Zp,this.collisionVertexArrayExt=new uh}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,Wfe.members,!0),this.collisionVertexBufferExt=a.createVertexBuffer(this.collisionVertexArrayExt,Kfe.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}_r(jM,"CollisionBuffers");class NC{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(w=>w.fqid),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=I([]),this.placementViewportMatrix=I([]);const c=this.layers[0]._unevaluatedLayout._values;this.worldview=a.worldview,this.textSizeData=vx(this.zoom,c["text-size"],this.worldview),this.iconSizeData=vx(this.zoom,c["icon-size"],this.worldview);const p=this.layers[0].layout,g=p.get("symbol-sort-key"),x=p.get("symbol-z-order");this.lut=a.lut,this.canOverlap=p.get("text-allow-overlap")||p.get("icon-allow-overlap")||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&g.constantOr(1)!==void 0,this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=p.get("text-writing-mode").map(w=>tc[w]),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=a.sourceID,this.projection=a.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null}hasAnyAppearanceProperty(a){const c=this.layers[0].getAppearances();return!(!c||c.length===0)&&c.some(p=>p.getProperty(a)!=null)}createArrays(){this.text=new CM(new nu(this.layers,{zoom:this.zoom,lut:this.lut},a=>a.startsWith("text")||a.startsWith("symbol"))),this.icon=new CM(new nu(this.layers,{zoom:this.zoom,lut:this.lut},a=>a.startsWith("icon")||a.startsWith("symbol"))),this.glyphOffsetArray=new F1,this.lineVertexArray=new $A,this.symbolInstances=new BA}calculateGlyphDependencies(a,c,p,g,x){for(const w of a){const C=w.codePointAt(0);if(C===void 0)break;if(c[C]=!0,g&&x&&C<=65535){const N=cS[w];N&&(c[N.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(a,c,p,g,x,w){let C=1;const N=a.getUnevaluatedProperties()._values["icon-size"],D=vx(this.zoom,N,this.worldview),U=_x(D,c);if(D.kind!=="constant"&&D.kind!=="camera"||(C=U.uSize),D.kind==="composite"){const{minZoom:q,maxZoom:H}=D,Y=N.possiblyEvaluate(new Vi(q,{worldview:this.worldview}),g),J=N.possiblyEvaluate(new Vi(H,{worldview:this.worldview}),g),oe=Y.evaluate(p,{},g,x);C=oe+(J.evaluate(p,{},g,x)-oe)*U.uSizeT}return D.kind==="source"&&(C=N.possiblyEvaluate(new Vi(this.zoom,{worldview:this.worldview}),g).evaluate(p,{},g,x)),C*w}updateFootprints(a,c){}updateReplacement(a,c){if(c.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=c.updateTime;const p=c.getReplacementRegionsForTile(a.toUnwrapped(),!0);return!aC(this.activeReplacements,p)&&(this.activeReplacements=p,!0)}getResolvedImageFromTokens(a){return typeof a=="string"?gl.build(a):a}populate(a,c,p,g){const x=this.layers[0],w=x.layout,C=this.projection.name==="globe",N=w.get("text-font"),D=w.get("text-field"),U=w.get("icon-image"),[q,H]=w.get("icon-size-scale-range"),Y=ve(c.scaleFactor||1,q,H),J=(D.value.kind!=="constant"||D.value.value instanceof Ia&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&(N.value.kind!=="constant"||N.value.value.length>0),oe=U.value.kind!=="constant"||!!U.value.value||Object.keys(U.parameters).length>0,ce=this.hasAnyAppearanceProperty("icon-image"),he=w.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!J&&!oe&&!ce)return;const Se=c.iconDependencies,Te=c.glyphDependencies,ke=c.availableImages,qe=new Vi(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),Fe=Xe=>{const et=Xe.id.toString();Se.has(et)?Se.get(et).push(Xe):Se.set(et,[Xe])};for(const Xe of a){const{feature:et,id:it,index:At,sourceLayerIndex:pt}=Xe,jt=x._featureFilter.needGeometry,Rt=vt(et,jt);if(!x._featureFilter.filter(qe,Rt,p))continue;if(jt||(Rt.geometry=It(et,p,g)),C&&et.type!==1&&p.z<=5){const $t=Rt.geometry,Kt=.98078528056,Ft=(gr,br)=>We(q1(gr.x,gr.y,p,1),q1(br.x,br.y,p,1))<Kt;for(let gr=0;gr<$t.length;gr++)$t[gr]=Nt($t[gr],Ft)}let zt,Yt;if(J){const $t=x.getValueAndResolveTokens("text-field",Rt,p,ke),Kt=Ia.factory($t);Lpe(Kt)&&(this.hasRTLText=!0),(!this.hasRTLText||_1()==="unavailable"||this.hasRTLText&&Nl.isParsed())&&(zt=Xfe(Kt,x,Rt))}if(oe){const $t=x.getValueAndResolveTokens("icon-image",Rt,p,ke);Yt=this.getResolvedImageFromTokens($t)}const qt=this.layers[0];let Dt=!1;if(!Yt&&ce){const $t=qt.getAppearances();for(const Kt of $t)if(Kt.getProperty("icon-image")){const Ft=qt.getAppearanceValueAndResolveTokens(Kt,"icon-image",Rt,p,ke);if(Ft){Yt=this.getResolvedImageFromTokens(Ft),Dt=!0;break}}}if(!zt&&!Yt)continue;const Vt=this.sortFeaturesByKey?he.evaluate(Rt,{},p):void 0,St={id:it,text:zt,icon:Yt,index:At,sourceLayerIndex:pt,geometry:Rt.geometry,properties:et.properties,type:Mpe[et.type],sortKey:Vt};if(this.features.push(St),this.appearanceFeatureData.push({id:it,properties:et.properties,usesAppearanceIconAsPlaceholder:Dt,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),Yt){const $t=qt._unevaluatedLayout._values,{iconPrimary:Kt,iconSecondary:Ft}=fS(Yt,this.iconSizeData,$t["icon-size"],p,this.zoom,St,this.pixelRatio,Y,this.worldview);Fe(Kt),Ft&&(this.hasAnySecondaryIcon=!0,Fe(Ft))}const xt=qt.getAppearances();if(xt.length!==0&&xt.forEach($t=>{if(!$t.getProperty("icon-image"))return;const Kt=this.getCombinedIconPrimary($t,qt,Rt,p,ke,St,Y);Kt&&Fe(Kt)}),zt){const $t=N.evaluate(Rt,{},p).join(","),Kt=w.get("text-rotation-alignment")==="map"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(tc.vertical)>=0;for(const Ft of zt.sections)if(Ft.image){const gr=Ft.image.getPrimary().scaleSelf(this.pixelRatio),br=gr.id.toString(),hr=Se.get(br)||[];hr.push(gr),Se.set(br,hr)}else{const gr=f1(zt.toString()),br=Ft.fontStack||$t,hr=Te[br]=Te[br]||{};this.calculateGlyphDependencies(Ft.text,hr,Kt,this.allowVerticalPlacement,gr)}}}if(w.get("symbol-placement")==="line"&&(this.features=function(Xe){const et={},it={},At=[];let pt=0;function jt(qt){At.push(Xe[qt]),pt++}function Rt(qt,Dt,Vt){const St=it[qt];return delete it[qt],it[Dt]=St,At[St].geometry[0].pop(),At[St].geometry[0]=At[St].geometry[0].concat(Vt[0]),St}function zt(qt,Dt,Vt){const St=et[Dt];return delete et[Dt],et[qt]=St,At[St].geometry[0].shift(),At[St].geometry[0]=Vt[0].concat(At[St].geometry[0]),St}function Yt(qt,Dt,Vt){const St=Vt?Dt[0][Dt[0].length-1]:Dt[0][0];return`${qt}:${St.x}:${St.y}`}for(let qt=0;qt<Xe.length;qt++){const Dt=Xe[qt],Vt=Dt.geometry,St=Dt.text?Dt.text.toString():null;if(!St){jt(qt);continue}const xt=Yt(St,Vt),$t=Yt(St,Vt,!0);if(xt in it&&$t in et&&it[xt]!==et[$t]){const Kt=zt(xt,$t,Vt),Ft=Rt(xt,$t,At[Kt].geometry);delete et[xt],delete it[$t],it[Yt(St,At[Ft].geometry,!0)]=Ft,At[Kt].geometry=null}else xt in it?Rt(xt,$t,Vt):$t in et?zt(xt,$t,Vt):(jt(qt),et[xt]=pt-1,it[$t]=pt-1)}return At.filter(qt=>qt.geometry)}(this.features)),w.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",c.elevationFeatures){!this.elevationFeatures&&c.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Xe of c.elevationFeatures)this.elevationFeatureIdToIndex.set(Xe.id,this.elevationFeatures.length),this.elevationFeatures.push(Xe)}}else w.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Xe,et)=>Xe.sortKey-et.sortKey)}getCombinedIconPrimary(a,c,p,g,x,w,C){let N,D;const U=a.getUnevaluatedProperties();if(U._values["icon-image"].value!==void 0){const q=c.getAppearanceValueAndResolveTokens(a,"icon-image",p,g,x);N=this.getResolvedImageFromTokens(q)}else{const q=c.getValueAndResolveTokens("icon-image",p,g,x);N=this.getResolvedImageFromTokens(q)}if(N){const q=U._values["icon-size"]||c._unevaluatedLayout._values["icon-size"];D=fS(N,vx(this.zoom,q,this.worldview),q,g,this.zoom,w,this.pixelRatio,C,this.worldview).iconPrimary}return D}updateAppearanceBasedIconTextures(a,c,p,g){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const x=this.layers[0];let w=!1,C=0;const N=x.layout,[D,U]=N.get("icon-size-scale-range"),q=ve(1,D,U);for(let H=0;H<this.symbolInstances.length;H++){const Y=this.symbolInstances.get(H),J=this.appearanceFeatureData[Y.featureIndex];if(J&&Y.placedIconSymbolIndex>=0){const oe=J.id,ce=c&&oe!==void 0?c[String(oe)]:void 0,he={type:"Point",id:J.id,properties:J.properties,geometry:[]},Se=this.layers[0].appearances&&this.layers[0].appearances.find(Te=>Te.isActive({globals:g,feature:he,canonical:a,featureState:ce}));if(J.activeAppearance===Se)continue;if(Se){J.activeAppearance=Se;const Te={sortKey:void 0,text:void 0,icon:null,index:Y.featureIndex,sourceLayerIndex:Y.featureIndex,geometry:[],properties:J.properties,type:"Point",id:J.id};if(!Se.hasCachedIconPrimary()){const Xe=this.getCombinedIconPrimary(Se,x,he,a,p,Te,q);Se.setCachedIconPrimary(Xe)}const ke=Se.getCachedIconPrimary();if(!ke)continue;const qe=ke.toString(),Fe=this.iconAtlasPositions&&this.iconAtlasPositions.get(qe);if(Fe){const Xe=x.getAppearanceValueAndResolveTokens(Se,"icon-offset",he,a,p),et=Xe&&Array.isArray(Xe)?Xe:[0,0];let it=wC(Fe,void 0,et,x.layout.get("icon-anchor").evaluate(he,{},a));const At=x.getAppearanceValueAndResolveTokens(Se,"icon-rotate",he,a,p),pt=typeof At=="number"?At:0,jt=Fe.sdf,Rt=x.layout.get("icon-text-fit").constantOr("none");Rt!=="none"&&J.textShaping&&J.iconTextFitPadding&&J.fontScale&&(it=vM(it,J.textShaping,Rt,J.iconTextFitPadding,et,J.fontScale));const zt=this.calculateEffectiveAppearanceIconSize(Se,g.zoom,he,a,p,q),Yt=0,qt=1+(Math.min(jf,Math.round(zt*xd))<<1),Dt=wM(it,pt,jt,Rt!=="none",q);J.isUsingAppearanceVertexData||(J.isUsingAppearanceVertexData=!0,J.layoutBasedVertexData=this.icon.getIconVertexData(C,Y.numIconVertices));for(let St=0;St<Dt.length;++St){const xt=Dt[St],$t=J.layoutBasedVertexData[0]||Y.tileAnchorX,Kt=J.layoutBasedVertexData[1]||Y.tileAnchorY,Ft=16*xt.pixelOffsetTL.x,gr=16*xt.pixelOffsetTL.y,br=16*xt.pixelOffsetBR.x,hr=16*xt.pixelOffsetBR.y,ar=16*xt.minFontScaleX,en=16*xt.minFontScaleY;this.icon.updateIconVertexData(C,$t,Kt,Math.round(32*xt.tl.x),Math.round(32*xt.tl.y),xt.texPrimary.x,xt.texPrimary.y,Yt,qt,Ft,gr,ar,en),this.icon.updateIconVertexData(C+1,$t,Kt,Math.round(32*xt.tr.x),Math.round(32*xt.tr.y),xt.texPrimary.x+xt.texPrimary.w,xt.texPrimary.y,Yt,qt,br,gr,ar,en),this.icon.updateIconVertexData(C+2,$t,Kt,Math.round(32*xt.bl.x),Math.round(32*xt.bl.y),xt.texPrimary.x,xt.texPrimary.y+xt.texPrimary.h,Yt,qt,Ft,hr,ar,en),this.icon.updateIconVertexData(C+3,$t,Kt,Math.round(32*xt.br.x),Math.round(32*xt.br.y),xt.texPrimary.x+xt.texPrimary.w,xt.texPrimary.y+xt.texPrimary.h,Yt,qt,br,hr,ar,en),C+=4}const Vt=Y.numIconVertices-4*Dt.length;for(let St=0;St<Vt;++St)this.icon.updateIconVertexData(C+St,0,0,0,0,0,0,0,0,0,0,0,0);w=!0}else C+=Y.numIconVertices}else if(J.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(C,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(C+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(C+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(C+3,0,0,0,0,0,0,0,0,0,0,0,0),w=!0),C+=Y.numIconVertices,J.activeAppearance=null;else if(J.isUsingAppearanceVertexData){const ke=J.layoutBasedVertexData.length/12;for(let qe=0;qe<ke;++qe){const Fe=qe*12;this.icon.updateIconVertexData(C+qe,J.layoutBasedVertexData[Fe+0],J.layoutBasedVertexData[Fe+1],J.layoutBasedVertexData[Fe+2],J.layoutBasedVertexData[Fe+3],J.layoutBasedVertexData[Fe+4],J.layoutBasedVertexData[Fe+5],J.layoutBasedVertexData[Fe+6],J.layoutBasedVertexData[Fe+7],J.layoutBasedVertexData[Fe+8],J.layoutBasedVertexData[Fe+9],J.layoutBasedVertexData[Fe+10],J.layoutBasedVertexData[Fe+11])}C+=ke,J.isUsingAppearanceVertexData=!1,J.activeAppearance=null,w=!0}else C+=Y.numIconVertices,J.activeAppearance=null}}return w}update(a,c,p,g,x,w,C){this.text.programConfigurations.updatePaintArrays(a,c,x,p,g,w,C,this.worldview),this.icon.programConfigurations.updatePaintArrays(a,c,x,p,g,w,C,this.worldview)}updateRoadElevation(a){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let c=!1;const p=Ke(a),g=1/p;let x=!1,w=!1;for(let C=0;C<this.symbolInstances.length;C++){const N=this.symbolInstances.get(C),D=we(1,0,0),U=we(0,1,0),{numHorizontalGlyphVertices:q,numVerticalGlyphVertices:H,numIconVertices:Y,numVerticalIconVertices:J}=N,oe=q>0||H>0,ce=Y>0,he=this.elevationFeatures[N.elevationFeatureIndex];if(he){const Se=new st(N.tileAnchorX,N.tileAnchorY),Te=.075+he.pointElevation(Se);N.zOffset!==Te&&(c=!0,N.zOffset=Te),Te!==0&&(this.hasAnyZOffset=!0);const ke=he.computeSlopeNormal(Se,g),qe=xs(er(),we(0,0,1),ke);nr(D,D,qe),nr(U,U,qe),D[2]*=p,U[2]*=p,D[0]===1&&D[1]===0&&D[2]===0&&U[0]===0&&U[1]===1&&U[2]===0||(x=x||oe,w=w||ce)}if(oe&&(kC(this.text.orientationVertexArray,q,D,U),kC(this.text.orientationVertexArray,H,D,U)),ce){const{placedIconSymbolIndex:Se,verticalPlacedIconSymbolIndex:Te}=N;Se>=0&&kC(this.icon.orientationVertexArray,Y,D,U),Te>=0&&kC(this.icon.orientationVertexArray,J,D,U)}}x||(this.text.orientationVertexArray=void 0),w||(this.icon.orientationVertexArray=void 0),c&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const a=(x,w,C)=>{p+=w,p>x.length&&x.resize(p);for(let N=-w;N<0;N++)x.emplace(N+p,C)},c=(x,w,C)=>{g+=w,g>x.length&&x.resize(g);for(let N=-w;N<0;N++)x.emplace(N+g,C)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let p=0,g=0;for(let x=0;x<this.symbolInstances.length;x++){const w=this.symbolInstances.get(x),{numHorizontalGlyphVertices:C,numVerticalGlyphVertices:N,numIconVertices:D}=w,U=w.zOffset,q=D>0;if((C>0||N>0)&&(a(this.text.zOffsetVertexArray,C,U),a(this.text.zOffsetVertexArray,N,U)),q){const{placedIconSymbolIndex:H,verticalPlacedIconSymbolIndex:Y}=w;H>=0&&c(this.icon.zOffsetVertexArray,D,U),Y>=0&&c(this.icon.zOffsetVertexArray,w.numVerticalIconVertices,U)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a,c,p,g,x){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(w=>w.appearances&&w.appearances.length>0)),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(a,c,p,g){return!!(a&&c&&p)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(a,c,p,g)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Q6(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,c){const p=this.lineVertexArray.length;if(a.segment!==void 0)for(const{x:g,y:x}of c)this.lineVertexArray.emplaceBack(g,x);return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(a,c,p,g,x,w,C,N,D,U,q,H,Y,J,oe,ce,he,Se){const Te=a.indexArray,ke=a.layoutVertexArray,qe=a.globeExtVertexArray,Fe=a.segments.prepareSegment(4*Se,ke,Te,this.canOverlap?w.sortKey:void 0),Xe=this.glyphOffsetArray.length,et=Fe.vertexLength,it=this.allowVerticalPlacement&&C===tc.vertical?Math.PI/2:0,At=w.text&&w.text.sections;for(let Rt=0;Rt<c.length;Rt++){const{tl:zt,tr:Yt,bl:qt,br:Dt,texPrimary:Vt,texSecondary:St,pixelOffsetTL:xt,pixelOffsetBR:$t,minFontScaleX:Kt,minFontScaleY:Ft,glyphOffset:gr,isSDF:br,sectionIndex:hr}=c[Rt],ar=Fe.vertexLength,en=gr[1];if(xS(ke,D.x,D.y,zt.x,en+zt.y,Vt.x,Vt.y,p,br,xt.x,xt.y,Kt,Ft),xS(ke,D.x,D.y,Yt.x,en+Yt.y,Vt.x+Vt.w,Vt.y,p,br,$t.x,xt.y,Kt,Ft),xS(ke,D.x,D.y,qt.x,en+qt.y,Vt.x,Vt.y+Vt.h,p,br,xt.x,$t.y,Kt,Ft),xS(ke,D.x,D.y,Dt.x,en+Dt.y,Vt.x+Vt.w,Vt.y+Vt.h,p,br,$t.x,$t.y,Kt,Ft),N){const{x:lr,y:Lr,z:rn}=N.anchor,[Sn,qn,on]=N.up;wS(qe,lr,Lr,rn,Sn,qn,on),wS(qe,lr,Lr,rn,Sn,qn,on),wS(qe,lr,Lr,rn,Sn,qn,on),wS(qe,lr,Lr,rn,Sn,qn,on),Sx(a.dynamicLayoutVertexArray,lr,Lr,rn,it)}else Sx(a.dynamicLayoutVertexArray,D.x,D.y,D.z,it);if(ce){const lr=St||Vt;bS(a.iconTransitioningVertexArray,lr.x,lr.y),bS(a.iconTransitioningVertexArray,lr.x+lr.w,lr.y),bS(a.iconTransitioningVertexArray,lr.x,lr.y+lr.h),bS(a.iconTransitioningVertexArray,lr.x+lr.w,lr.y+lr.h)}Te.emplaceBack(ar,ar+1,ar+2),Te.emplaceBack(ar+1,ar+2,ar+3),Fe.vertexLength+=4,Fe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(gr[0]),Rt!==c.length-1&&hr===c[Rt+1].sectionIndex||a.programConfigurations.populatePaintArrays(ke.length,w,w.index,{},Y,J,oe,At&&At[hr],this.worldview)}const pt=Se-c.length;pt!==0&&this._addNullVertices(pt,ke,p,N,qe,a,ce,Fe,Te);const jt=N?N.anchor:D;a.placedSymbolArray.emplaceBack(jt.x,jt.y,jt.z,D.x,D.y,Xe,this.glyphOffsetArray.length-Xe,et,U,q,D.segment,p?p[0]:0,p?p[1]:0,g[0],g[1],C,0,0,0,H,0),a.symbolInstanceIndices.push(he)}_addNullVertices(a,c,p,g,x,w,C,N,D){for(let U=0;U<a;U++){for(let H=0;H<4;H++)xS(c,0,0,0,0,0,0,p,!1,0,0,0,0),g&&wS(x,0,0,0,0,0,0),Sx(w.dynamicLayoutVertexArray,0,0,0,0),C&&bS(w.iconTransitioningVertexArray,0,0);const q=N.vertexLength;D.emplaceBack(q,q+1,q+2),D.emplaceBack(q+1,q+2,q+3),N.vertexLength+=4,N.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(a,c,p,g,x,w,C){a.emplaceBack(c,p,g,x,w,Math.round(C.x),Math.round(C.y))}_addCollisionDebugVertices(a,c,p,g,x,w,C){const N=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),D=N.vertexLength,U=C.tileAnchorX,q=C.tileAnchorY;for(let Y=0;Y<4;Y++)p.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(p.collisionVertexArrayExt,c,a.padding,C.zOffset),this._commitLayoutVertex(p.layoutVertexArray,g,x,w,U,q,new st(a.x1,a.y1)),this._commitLayoutVertex(p.layoutVertexArray,g,x,w,U,q,new st(a.x2,a.y1)),this._commitLayoutVertex(p.layoutVertexArray,g,x,w,U,q,new st(a.x2,a.y2)),this._commitLayoutVertex(p.layoutVertexArray,g,x,w,U,q,new st(a.x1,a.y2)),N.vertexLength+=4;const H=p.indexArray;H.emplaceBack(D,D+1),H.emplaceBack(D+1,D+2),H.emplaceBack(D+2,D+3),H.emplaceBack(D+3,D),N.primitiveLength+=4}_addTextDebugCollisionBoxes(a,c,p,g,x,w){for(let C=g;C<x;C++){const N=p.get(C),D=this.getSymbolInstanceTextSize(a,w,c,C);this._addCollisionDebugVertices(N,D,this.textCollisionBox,N.projectedAnchorX,N.projectedAnchorY,N.projectedAnchorZ,w)}}_addIconDebugCollisionBoxes(a,c,p,g,x,w){for(let C=g;C<x;C++){const N=p.get(C),D=this.getSymbolInstanceIconSize(a,c,w.placedIconSymbolIndex);this._addCollisionDebugVertices(N,D,this.iconCollisionBox,N.projectedAnchorX,N.projectedAnchorY,N.projectedAnchorZ,w)}}generateCollisionDebugBuffers(a,c,p){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new jM(J_,g6.members,Oc),this.iconCollisionBox=new jM(J_,g6.members,Oc);const g=_x(this.iconSizeData,a),x=_x(this.textSizeData,a,p);for(let w=0;w<this.symbolInstances.length;w++){const C=this.symbolInstances.get(w);this._addTextDebugCollisionBoxes(x,a,c,C.textBoxStartIndex,C.textBoxEndIndex,C),this._addTextDebugCollisionBoxes(x,a,c,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C),this._addIconDebugCollisionBoxes(g,a,c,C.iconBoxStartIndex,C.iconBoxEndIndex,C),this._addIconDebugCollisionBoxes(g,a,c,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex,C)}}getSymbolInstanceTextSize(a,c,p,g){const x=this.text.placedSymbolArray.get(c.rightJustifiedTextSymbolIndex>=0?c.rightJustifiedTextSymbolIndex:c.centerJustifiedTextSymbolIndex>=0?c.centerJustifiedTextSymbolIndex:c.leftJustifiedTextSymbolIndex>=0?c.leftJustifiedTextSymbolIndex:c.verticalPlacedTextSymbolIndex>=0?c.verticalPlacedTextSymbolIndex:g),w=_M(this.textSizeData,a,x)/Xa;return this.tilePixelRatio*w}getSymbolInstanceIconSize(a,c,p){const g=this.icon.placedSymbolArray.get(p),x=_M(this.iconSizeData,a,g);return this.tilePixelRatio*x}_commitDebugCollisionVertexUpdate(a,c,p,g){a.emplaceBack(c,-p,-p,g),a.emplaceBack(c,p,-p,g),a.emplaceBack(c,p,p,g),a.emplaceBack(c,-p,p,g)}_updateTextDebugCollisionBoxes(a,c,p,g,x,w,C){for(let N=g;N<x;N++){const D=p.get(N),U=this.getSymbolInstanceTextSize(a,w,c,N);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,U,D.padding,w.zOffset)}}_updateIconDebugCollisionBoxes(a,c,p,g,x,w,C){for(let N=g;N<x;N++){const D=p.get(N),U=this.getSymbolInstanceIconSize(a,c,w.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,U,D.padding,w.zOffset)}}updateCollisionDebugBuffers(a,c,p,g){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const x=_x(this.iconSizeData,a,g),w=_x(this.textSizeData,a,p);for(let C=0;C<this.symbolInstances.length;C++){const N=this.symbolInstances.get(C);this._updateTextDebugCollisionBoxes(w,a,c,N.textBoxStartIndex,N.textBoxEndIndex,N,p),this._updateTextDebugCollisionBoxes(w,a,c,N.verticalTextBoxStartIndex,N.verticalTextBoxEndIndex,N,p),this._updateIconDebugCollisionBoxes(x,a,c,N.iconBoxStartIndex,N.iconBoxEndIndex,N,g),this._updateIconDebugCollisionBoxes(x,a,c,N.verticalIconBoxStartIndex,N.verticalIconBoxEndIndex,N,g)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(a,c,p,g,x,w,C,N,D){const U={};if(c<p){const{x1:q,y1:H,x2:Y,y2:J,padding:oe,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:Se,tileAnchorX:Te,tileAnchorY:ke,featureIndex:qe}=a.get(c);U.textBox={x1:q,y1:H,x2:Y,y2:J,padding:oe,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:Se,tileAnchorX:Te,tileAnchorY:ke},U.textFeatureIndex=qe}if(g<x){const{x1:q,y1:H,x2:Y,y2:J,padding:oe,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:Se,tileAnchorX:Te,tileAnchorY:ke,featureIndex:qe}=a.get(g);U.verticalTextBox={x1:q,y1:H,x2:Y,y2:J,padding:oe,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:Se,tileAnchorX:Te,tileAnchorY:ke},U.verticalTextFeatureIndex=qe}if(w<C){const{x1:q,y1:H,x2:Y,y2:J,padding:oe,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:Se,tileAnchorX:Te,tileAnchorY:ke,featureIndex:qe}=a.get(w);U.iconBox={x1:q,y1:H,x2:Y,y2:J,padding:oe,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:Se,tileAnchorX:Te,tileAnchorY:ke},U.iconFeatureIndex=qe}if(N<D){const{x1:q,y1:H,x2:Y,y2:J,padding:oe,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:Se,tileAnchorX:Te,tileAnchorY:ke,featureIndex:qe}=a.get(N);U.verticalIconBox={x1:q,y1:H,x2:Y,y2:J,padding:oe,projectedAnchorX:ce,projectedAnchorY:he,projectedAnchorZ:Se,tileAnchorX:Te,tileAnchorY:ke},U.verticalIconFeatureIndex=qe}return U}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const p=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(a,c){const p=a.placedSymbolArray.get(c),g=p.vertexStartIndex+4*p.numGlyphs;for(let x=p.vertexStartIndex;x<g;x+=4)a.indexArray.emplaceBack(x,x+1,x+2),a.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(a),p=Math.cos(a),g=[],x=[],w=[];for(let C=0;C<this.symbolInstances.length;++C){w.push(C);const N=this.symbolInstances.get(C);g.push(0|Math.round(c*N.tileAnchorX+p*N.tileAnchorY)),x.push(N.featureIndex)}return w.sort((C,N)=>g[C]-g[N]||x[N]-x[C]),w}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let a=0;a<this.symbolInstances.length;++a)this.symbolInstanceIndexesSortedZOffset.push(a)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((a,c)=>this.symbolInstances.get(c).zOffset-this.symbolInstances.get(a).zOffset)}addToSortKeyRanges(a,c){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===c?p.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const p=this.symbolInstances.get(c);this.featureSortOrder.push(p.featureIndex);const{rightJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:x,leftJustifiedTextSymbolIndex:w,verticalPlacedTextSymbolIndex:C,placedIconSymbolIndex:N,verticalPlacedIconSymbolIndex:D}=p;g>=0&&this.addIndicesForPlacedSymbol(this.text,g),x>=0&&x!==g&&this.addIndicesForPlacedSymbol(this.text,x),w>=0&&w!==x&&w!==g&&this.addIndicesForPlacedSymbol(this.text,w),C>=0&&this.addIndicesForPlacedSymbol(this.text,C),N>=0&&this.addIndicesForPlacedSymbol(this.icon,N),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(a){const c=this.symbolInstances.get(this.text.symbolInstanceIndices[a]).elevationFeatureIndex;let p;return this.elevationFeatures&&c<this.elevationFeatures.length&&(p=this.elevationFeatures[c]),p}}function e8(u,a){return a.replace(/{([^{}]+)}/g,(c,p)=>p in u?String(u[p]):"")}let t8,r8,PM;_r(NC,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),NC.addDynamicAttributes=Sx;class n8{constructor(a){this.type=a.property.overrides?a.property.overrides.runtimeType:bp,this.defaultValue=a}evaluate(a){if(a.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(a.formattedSection))return c.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}_r(n8,"FormatSectionOverride",{omit:["defaultValue"]});const OM=()=>PM||(PM={layout:t8||(t8=new ws({"symbol-placement":new Gt(ft.layout_symbol["symbol-placement"]),"symbol-spacing":new Gt(ft.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Gt(ft.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ur(ft.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Gt(ft.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Gt(ft.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Gt(ft.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Gt(ft.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Gt(ft.layout_symbol["icon-ignore-placement"]),"icon-optional":new Gt(ft.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Gt(ft.layout_symbol["icon-rotation-alignment"]),"icon-size":new ur(ft.layout_symbol["icon-size"]),"icon-size-scale-range":new Gt(ft.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new ur(ft.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ur(ft.layout_symbol["icon-text-fit-padding"]),"icon-image":new ur(ft.layout_symbol["icon-image"]),"icon-image-use-theme":new Gt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new ur(ft.layout_symbol["icon-rotate"]),"icon-padding":new Gt(ft.layout_symbol["icon-padding"]),"icon-keep-upright":new Gt(ft.layout_symbol["icon-keep-upright"]),"icon-offset":new ur(ft.layout_symbol["icon-offset"]),"icon-anchor":new ur(ft.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Gt(ft.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Gt(ft.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Gt(ft.layout_symbol["text-rotation-alignment"]),"text-field":new ur(ft.layout_symbol["text-field"]),"text-font":new ur(ft.layout_symbol["text-font"]),"text-size":new ur(ft.layout_symbol["text-size"]),"text-size-scale-range":new Gt(ft.layout_symbol["text-size-scale-range"]),"text-max-width":new ur(ft.layout_symbol["text-max-width"]),"text-line-height":new ur(ft.layout_symbol["text-line-height"]),"text-letter-spacing":new ur(ft.layout_symbol["text-letter-spacing"]),"text-justify":new ur(ft.layout_symbol["text-justify"]),"text-radial-offset":new ur(ft.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Gt(ft.layout_symbol["text-variable-anchor"]),"text-anchor":new ur(ft.layout_symbol["text-anchor"]),"text-max-angle":new Gt(ft.layout_symbol["text-max-angle"]),"text-writing-mode":new Gt(ft.layout_symbol["text-writing-mode"]),"text-rotate":new ur(ft.layout_symbol["text-rotate"]),"text-padding":new Gt(ft.layout_symbol["text-padding"]),"text-keep-upright":new Gt(ft.layout_symbol["text-keep-upright"]),"text-transform":new ur(ft.layout_symbol["text-transform"]),"text-offset":new ur(ft.layout_symbol["text-offset"]),"text-allow-overlap":new Gt(ft.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Gt(ft.layout_symbol["text-ignore-placement"]),"text-optional":new Gt(ft.layout_symbol["text-optional"]),visibility:new Gt(ft.layout_symbol.visibility)})),paint:r8||(r8=new ws({"icon-opacity":new ur(ft.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new ur(ft.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new ur(ft.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ur(ft.paint_symbol["text-emissive-strength"]),"icon-color":new ur(ft.paint_symbol["icon-color"]),"icon-halo-color":new ur(ft.paint_symbol["icon-halo-color"]),"icon-halo-width":new ur(ft.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ur(ft.paint_symbol["icon-halo-blur"]),"icon-translate":new Gt(ft.paint_symbol["icon-translate"]),"icon-translate-anchor":new Gt(ft.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Gt(ft.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ur(ft.paint_symbol["text-opacity"]),"text-occlusion-opacity":new ur(ft.paint_symbol["text-occlusion-opacity"]),"text-color":new ur(ft.paint_symbol["text-color"],{runtimeType:Ol,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new ur(ft.paint_symbol["text-halo-color"]),"text-halo-width":new ur(ft.paint_symbol["text-halo-width"]),"text-halo-blur":new ur(ft.paint_symbol["text-halo-blur"]),"text-translate":new Gt(ft.paint_symbol["text-translate"]),"text-translate-anchor":new Gt(ft.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Gt(ft.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Gt(ft.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Gt(ft.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Gt(ft.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new ur(ft.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},PM);class IC extends $o{constructor(a,c,p,g){super(a,OM(),c,p,g,a.layout?a.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=I([]),this.hasOcclusionOpacityProperties=a.paint!==void 0&&("icon-occlusion-opacity"in a.paint||"text-occlusion-opacity"in a.paint)}_handleSpecialPaintPropertyUpdate(a){a!=="icon-occlusion-opacity"&&a!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(a,c){super.recalculate(a,c),this.appearances&&this.appearances.forEach(g=>{g.recalculate(a,c,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const p=this.layout.get("text-writing-mode");if(p){const g=[];for(const x of p)g.indexOf(x)<0&&g.push(x);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(a,c,p,g){return this._saturation===a&&this._contrast===c&&this._brightnessMin===p&&this._brightnessMax===g||(this._colorAdjustmentMatrix=function(x,w,C,N){x=gs(x),w=Yi(w);const D=O(),U=x/3,q=1-2*U,H=[q,U,U,0,U,q,U,0,U,U,q,0,0,0,0,1],Y=.5-.5*w,J=N-C;return M(D,[J,0,0,0,0,J,0,0,0,0,J,0,C,C,C,1],[w,0,0,0,0,w,0,0,0,0,w,0,Y,Y,Y,1]),M(D,D,H),D}(a,c,p,g),this._saturation=a,this._contrast=c,this._brightnessMin=p,this._brightnessMax=g),this._colorAdjustmentMatrix}getValueAndResolveTokens(a,c,p,g){const x=this.layout.get(a).evaluate(c,{},p,g),w=this._unevaluatedLayout._values[a];return w.isDataDriven()||z_(w.value)||!x?x:e8(c.properties,x)}getAppearanceValueAndResolveTokens(a,c,p,g,x){const w=a.getProperty(c);if(!w)return;const C=w.evaluate(p,{},g,x),N=a.getUnevaluatedProperties()._values[c];return N.isDataDriven()||z_(N.value)||!C||typeof C!="string"?C:e8(p.properties,C)}createBucket(a){return new NC(a)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const a of OM().paint.overridableProperties){if(!IC.hasPaintOverride(this.layout,a))continue;const c=this.paint.get(a),p=new n8(c),g=new F_(p,c.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let x=null;x=c.value.kind==="constant"||c.value.kind==="source"?new ly("source",g):new sh("composite",g,c.value.zoomStops,c.value.interpolationType),this.paint._values[a]=new Pc(c.property,x,c.parameters)}}_handleOverridablePaintPropertyUpdate(a,c,p){return!(!this.layout||c.isDataDriven()||p.isDataDriven())&&IC.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,c){const p=a.get("text-field"),g=OM().paint.properties[c];let x=!1;const w=C=>{for(const N of C)if(g.overrides&&g.overrides.hasOverride(N))return void(x=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Ia)w(p.value.value.sections);else if(p.value.kind==="source"){const C=D=>{x||(D instanceof ud&&wa(D.value)===uf?w(D.value.sections):D instanceof df?w(D.sections):D.eachChild(C))},N=p.value;N._styleExpression&&C(N._styleExpression.expression)}return x}getProgramIds(){return["symbol"]}getDefaultProgramParams(a,c,p){return{config:new yd(this,{zoom:c,lut:p}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let i8,s8,a8,o8;var kM=Cn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function RC(u,a,c,p,g,x,w,C){const N=[u,a,1,c,p,1,g,x,1],D=[w,C,1],U=T([],N),[q,H,Y]=Lt(D,D,U);return A(N,N,[q,0,0,0,H,0,0,0,Y])}function l8(u,a,c,p,g,x,w,C){const N=function(D,U,q,H,Y,J,oe,ce){const he=RC(0,0,1,0,1,1,0,1),Se=RC(D,U,q,H,Y,J,oe,ce);return A(Se,Se,T([],he))}(u,a,c,p,g,x,w,C);return[N[2]/N[8]/tr,N[5]/N[8]/tr]}function MC(u){return[u[0],Math.min(Math.max(u[1],-Ie),Ie)]}class c8 extends od{constructor(a,c,p,g){super(),this.id=a,this.dispatcher=p,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(g),this.options=c,this._dirty=!1}load(a,c){if(this._loaded=c||!1,this.fire(new ql("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return a&&(this.coordinates=a),this._loaded=!0,void this._finishLoading();this._imageRequest=Nw(this.map._requestManager.transformRequest(this.url,of.Image),(p,g)=>{this._imageRequest=null,this._loaded=!0,p?this.fire(new $g(p)):g&&(this.image=g instanceof HTMLImageElement?Pl.getImageData(g):g,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading())})}loaded(){return this._loaded}updateImage(a){return a.url?(this._imageRequest&&a.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}setTexture(a){if(!(a.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new aS(this.map.painter.context,a.handle),this.width=a.dimensions[0],this.height=a.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ql("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(a){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof aS||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(a){if(this.coordinates=a,this._boundsArray=void 0,this._unsupportedCoords=!1,!a.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let c=a[0][1],p=a[0][1];for(const x of a)x[1]>p&&(p=x[1]),x[1]<c&&(c=x[1]);const g=(p+c)/2;if(g>Ie?this.onNorthPole=!0:g<-Ie&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const x=a.map(dt.fromLngLat);this.tileID=function(w){let C=1/0,N=1/0,D=-1/0,U=-1/0;for(const oe of w)C=Math.min(C,oe.x),N=Math.min(N,oe.y),D=Math.max(D,oe.x),U=Math.max(U,oe.y);const q=Math.max(D-C,U-N),H=Math.max(0,Math.floor(-Math.log2(q))),Y=Math.pow(2,H);let J=Math.floor((C+D)/2*Y);return J>1&&(J-=1),new Jl(H,J,Math.floor((N+U)/2*Y))}(x),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ql("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof aS||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(a){for(const he in this.tiles){const Se=this.tiles[he];Se.state!=="loaded"&&(Se.state="loaded",Se.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const c=mS(new Jl(0,0,0),this.map.transform.projection),p=[c.projection.project(this.coordinates[0][0],this.coordinates[0][1]),c.projection.project(this.coordinates[1][0],this.coordinates[1][1]),c.projection.project(this.coordinates[2][0],this.coordinates[2][1]),c.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(he){const Se=he[1].x-he[0].x,Te=he[1].y-he[0].y,ke=he[2].x-he[1].x,qe=he[2].y-he[1].y,Fe=he[3].x-he[2].x,Xe=he[3].y-he[2].y,et=he[0].x-he[3].x,it=he[0].y-he[3].y,At=Se*qe-ke*Te,pt=ke*Xe-Fe*qe,jt=Fe*it-et*Xe,Rt=et*Te-Se*it;return At>0&&pt>0&&jt>0&&Rt>0||At<0&&pt<0&&jt<0&&Rt<0}(p))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const g=mS(this.tileID,this.map.transform.projection),[x,w,C,N]=this.coordinates.map(he=>{const Se=g.projection.project(he[0],he[1]);return K6(g,Se)._round()});this.perspectiveTransform=l8(x.x,x.y,w.x,w.y,C.x,C.y,N.x,N.y);const D=this._boundsArray=new Gp;D.emplaceBack(x.x,x.y,0,0),D.emplaceBack(w.x,w.y,tr,0),D.emplaceBack(N.x,N.y,0,tr),D.emplaceBack(C.x,C.y,tr,tr),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=a.createVertexBuffer(D,kM.members),this.boundsSegments=ds.simpleSegment(0,0,4,2);const U=[],q=[MC((H=this.coordinates)[0]),MC(H[1]),MC(H[2]),MC(H[3])];var H;const[Y,J,oe,ce]=function(he){let Se=he[0][0],Te=Se,ke=he[0][1],qe=ke;for(let Fe=1;Fe<he.length;Fe++)he[Fe][0]<Se?Se=he[Fe][0]:he[Fe][0]>Te&&(Te=he[Fe][0]),he[Fe][1]<ke?ke=he[Fe][1]:he[Fe][1]>qe&&(qe=he[Fe][1]);return[Se,ke,Te-Se,qe-ke]}(q);{const he=new Gp,[Se,Te,ke,qe]=function(Dt){let Vt=Dt[0].x,St=Vt,xt=Dt[0].y,$t=xt;for(let Kt=1;Kt<Dt.length;Kt++)Dt[Kt].x<Vt?Vt=Dt[Kt].x:Dt[Kt].x>St&&(St=Dt[Kt].x),Dt[Kt].y<xt?xt=Dt[Kt].y:Dt[Kt].y>$t&&($t=Dt[Kt].y);return[Vt,xt,St-Vt,$t-xt]}(p),Fe=Dt=>[(Dt.x-Se)/ke,(Dt.y-Te)/qe],[Xe,et,it,At]=p.map(Fe),pt=function(Dt,Vt,St,xt,$t,Kt,Ft,gr){const br=RC(0,0,1,0,1,1,0,1);return A(br,br,T([],RC(Dt,Vt,St,xt,$t,Kt,Ft,gr)))}(Xe[0],Xe[1],et[0],et[1],it[0],it[1],At[0],At[1]);this.elevatedGlobePerspectiveTransform=l8(Xe[0],Xe[1],et[0],et[1],it[0],it[1],At[0],At[1]);const jt=(Dt,Vt)=>{U.push(Dt.lng);const St=Math.round((Dt.lng-Y)/oe*tr),xt=Math.round((Dt.lat-J)/ce*tr),$t=Fe(Vt),Kt=Lt([],[$t[0],$t[1],1],pt),Ft=Math.round(Kt[0]/Kt[2]*tr),gr=Math.round(Kt[1]/Kt[2]*tr);he.emplaceBack(St,xt,Ft,gr)},Rt=p[3].x-p[0].x,zt=p[3].y-p[0].y,Yt=p[2].x-p[1].x,qt=p[2].y-p[1].y;for(let Dt=0;Dt<65;Dt++){const Vt=Dt/64,St=[p[0].x+Vt*Rt,p[0].y+Vt*zt],xt=[p[1].x+Vt*Yt,p[1].y+Vt*qt],$t=xt[0]-St[0],Kt=xt[1]-St[1];for(let Ft=0;Ft<65;Ft++){const gr=Ft/64,br={x:St[0]+$t*gr,y:St[1]+Kt*gr};jt(c.projection.unproject(br.x,br.y),br)}}this.elevatedGlobeVertexBuffer=a.createVertexBuffer(he,kM.members)}{this.maxLongitudeTriangleSize=0;let he=[],Se=new is;const Te=(ke,qe,Fe)=>{Se.emplaceBack(ke,qe,Fe);const Xe=U[ke],et=U[qe],it=U[Fe],At=Math.min(Math.min(Xe,et),it),pt=Math.max(Math.max(Xe,et),it)-At;pt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=pt),he.push(At+pt/2)};for(let ke=0;ke<64;ke++)for(let qe=0;qe<64;qe++){const Fe=65*ke+qe,Xe=Fe+1,et=Fe+65,it=et+1;Te(Fe,et,Xe),Te(Xe,et,it)}[he,Se]=function(ke,qe){const Fe=Array.from({length:ke.length},(it,At)=>At);Fe.sort((it,At)=>ke[it]-ke[At]);const Xe=[],et=new is;for(let it=0;it<Fe.length;it++){const At=Fe[it];Xe.push(ke[At]);const pt=3*At,jt=pt+1;et.emplaceBack(qe.uint16[pt],qe.uint16[jt],qe.uint16[jt+1])}return[Xe,et]}(he,Se),this.elevatedGlobeTrianglesCenterLongitudes=he,this.elevatedGlobeIndexBuffer=a.createIndexBuffer(Se)}this.elevatedGlobeSegments=ds.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,oe/tr,0,ce/tr,0,0,J,Y,0])}prepare(){const a=Object.keys(this.tiles).length!==0;if(this.tileID&&!a)return;const c=this.map.painter.context,p=c.gl;!this._dirty||this.texture instanceof aS||(this.texture?this.texture.update(this.image):(this.texture=new nM(c,this.image,p.RGBA8),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE)),this._dirty=!1),a&&this._prepareData(c)}loadTile(a,c){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},c(null)):(a.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(a){const c=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!c)return null;const p=this.elevatedGlobeTrianglesCenterLongitudes;let g=(x=a+180)+360*Math.round((p[0]-x)/360);var x;const w=new ds,C=(q,H)=>{w.segments.push({vertexOffset:0,primitiveOffset:q,vertexLength:c.segments[0].vertexLength,primitiveLength:H,sortKey:void 0,vaos:{}})},N=.51*this.maxLongitudeTriangleSize;if(Math.abs(p[0]-g)<=N){const q=Mn(p,0,p.length,g+N);return q===p.length||C(q,_i(p,q+1,p.length,g+360-N)-q),w}g<p[0]&&(g+=360);const D=_i(p,0,p.length,g-N);if(D===p.length)return C(0,p.length),w;C(0,D-0);const U=Mn(p,D+1,p.length,g+N);return U!==p.length&&C(U,p.length-U),w}}const Fpe=(Math.pow(256,2)-1)/16907520;class u8 extends $o{constructor(a,c,p,g){super(a,{layout:a8||(a8=new ws({visibility:new Gt(ft.layout_raster.visibility)})),paint:o8||(o8=new ws({"raster-opacity":new Gt(ft.paint_raster["raster-opacity"]),"raster-color":new $p(ft.paint_raster["raster-color"]),"raster-color-mix":new Gt(ft.paint_raster["raster-color-mix"]),"raster-color-range":new Gt(ft.paint_raster["raster-color-range"]),"raster-hue-rotate":new Gt(ft.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Gt(ft.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Gt(ft.paint_raster["raster-brightness-max"]),"raster-saturation":new Gt(ft.paint_raster["raster-saturation"]),"raster-contrast":new Gt(ft.paint_raster["raster-contrast"]),"raster-resampling":new Gt(ft.paint_raster["raster-resampling"]),"raster-fade-duration":new Gt(ft.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Gt(ft.paint_raster["raster-emissive-strength"]),"raster-array-band":new Gt(ft.paint_raster["raster-array-band"]),"raster-elevation":new Gt(ft.paint_raster["raster-elevation"]),"raster-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},c,p,g),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(a){return!(a&&a._source instanceof c8&&(a._source.onNorthPole||a._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(a){a!=="raster-color"&&a!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(a){if(!this.hasColorMap()||!this._curRampRange)return;const c=this._transitionablePaint._values["raster-color"].value.expression,[p,g]=a||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(p)&&isNaN(g)||p===this._curRampRange[0]&&g===this._curRampRange[1]||(this.colorRamp=H1({expression:c,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:p,end:g}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[p,g])}}let d8,h8,f8,p8,m8;class g8 extends $o{constructor(a,c,p,g){super(a,{layout:d8||(d8=new ws({visibility:new Gt(ft["layout_raster-particle"].visibility)})),paint:h8||(h8=new ws({"raster-particle-array-band":new Gt(ft["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Gt(ft["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new $p(ft["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Gt(ft["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Gt(ft["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Gt(ft["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Gt(ft["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Gt(ft["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},c,p,g),this._updateColorRamp(),this.lastInvalidatedAt=Pl.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(a){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(a){return!1}_handleSpecialPaintPropertyUpdate(a){a!=="raster-particle-color"&&a!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),a==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const a=this._transitionablePaint._values["raster-particle-color"].value.expression,c=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=H1({expression:a,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:c}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Pl.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class zpe extends $o{constructor(a,c){super(a,{},c,null),this.implementation=a,a.slot&&(this.slot=a.slot)}is3D(a){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(a){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(a){this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)}onRemove(a){this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)}}function NM(u,a,c){const p=[0,0,1],g=Cr([]);return fn(g,g,c?-_n(u)+Math.PI:_n(u)),dn(g,g,-_n(a)),nr(p,p,g),Me(p,p)}const y8={None:0,Model:1,Symbol:2,FillExtrusion:4};class DC{constructor(a,c,p,g){this.message=(a?`${a}: `:"")+p,g&&(this.identifier=g),c!=null&&c.__line__&&(this.line=c.__line__)}}function IM(u,a){const c=u.indexOf("://")===-1;try{return new URL(u,c&&a?"http://example.com":void 0),!0}catch{return!1}}class v8{constructor(a,c){this.feature=a,this.instancedDataOffset=c,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class _8{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new ex,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(a){const c=16*a,p=this.instancedDataArray.float32;let g=Math.floor(p[c+2]);const x=1.05*(p[c+2]-g);return g/=100,[p[c]%1*1.05,p[c+1]%1*1.05,x,g]}tileCoordinatesForInstance(a){const c=16*a,p=this.instancedDataArray.float32;let g=p[c+0];return g=g>tr?g-tr:g,new st(Math.trunc(g),Math.trunc(p[c+1]))}translationForInstance(a){const c=16*a,p=this.instancedDataArray.float32;return[p[c+4],p[c+5],p[c+6]]}rotationScaleForInstance(a){const c=16*a,p=this.instancedDataArray.float32;return[p[c+7],p[c+8],p[c+9],p[c+10],p[c+11],p[c+12],p[c+13],p[c+14],p[c+15]]}transformForInstance(a){const c=16*a,p=this.instancedDataArray.float32;return[p[c+7],p[c+8],p[c+9],p[c+4],p[c+10],p[c+11],p[c+12],p[c+5],p[c+13],p[c+14],p[c+15],p[c+6],0,0,0,1]}}class RM{constructor(a){this.zoom=a.zoom,this.canonical=a.canonical,this.overscaledZ=this.canonical.z+Math.log2(a.overscaling),this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.projection=a.projection,this.index=a.index,this.worldview=a.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=a.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(a,c){}updateAppearances(a,c,p,g){}populate(a,c,p,g){this.tileToMeter=Ke(p);const x=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:w,id:C,index:N,sourceLayerIndex:D}of a){const U=C??(w.properties&&w.properties.hasOwnProperty("id")?w.properties.id:void 0),q=vt(w,x);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),q,p))continue;const H={id:U,sourceLayerIndex:D,index:N,geometry:x?q.geometry:It(w,p,g),properties:w.properties,type:w.type,patterns:{}},Y=this.addFeature(H,H.geometry,q);Y&&c.featureIndex.insert(w,H.geometry,N,D,this.index,this.instancesPerModel[Y].instancedDataArray.length,tr/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const a=this.layers[0].modelManager,c=this.layers[0].scope;let p=0;for(const g of this.modelUris){const x=a.getModel(g,c);if(!x)continue;const w=this.instancesPerModel[g];if(w){const C=.5*Ze(x.aabb.max,x.aabb.min)*w.maxScale+w.maxXYTranslationDistance,N=Math.min(tr,Math.max(C/this.tileToMeter,tr/32));p=Math.max(N,p)}}return p}update(a,c,p,g){for(const x in this.instancesPerModel){const w=this.instancesPerModel[x];for(const C in a)w.idToFeaturesIndex.hasOwnProperty(C)&&(this.evaluate(w.features[w.idToFeaturesIndex[C]],a[C],w,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let a=!1;for(const c in this.instancesPerModel){const p=this.instancesPerModel[c];for(const g of p.features){const x=this.layers[0],w=g.feature,C=this.canonical,N=x.paint.get("model-rotation").evaluate(w,{},C),D=x.paint.get("model-scale").evaluate(w,{},C),U=x.paint.get("model-translation").evaluate(w,{},C);Dr(g.rotation,N)&&Dr(g.scale,D)&&Dr(g.translation,U)||(this.evaluate(g,g.featureStates,p,!0),a=!0)}}return a}updateReplacement(a,c,p,g){if(c.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=c.updateTime;const x=c.getReplacementRegionsForTile(a.toUnwrapped(),!0);if(aC(this.activeReplacements,x))return!1;this.activeReplacements=x;let w=!1;for(const C in this.instancesPerModel){const N=this.instancesPerModel[C],D=N.instancedDataArray;for(const U of N.features){const q=U.instancedDataOffset,H=U.instancedDataCount;for(let Y=0;Y<H;Y++){const J=16*(Y+q);let oe=D.float32[J+0];const ce=oe>tr;oe=ce?oe-tr:oe;const he=Math.floor(oe),Se=Math.floor(D.float32[J+1]);let Te=!1;for(const ke of this.activeReplacements)if(!iV(ke,p,y8.Model,g)&&!(ke.min.x>he||he>ke.max.x||ke.min.y>Se||Se>ke.max.y)&&(Te=HR(lV(he,Se,a.canonical,ke.footprintTileId.canonical),ke.footprint),Te))break;D.float32[J]=Te?oe+tr:oe,w=w||Te!==ce}}}return w}isEmpty(){for(const a in this.instancesPerModel)if(this.instancesPerModel[a].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(a){if(!this.uploaded)for(const c in this.instancesPerModel){const p=this.instancesPerModel[c];p.instancedDataArray.length<0||p.instancedDataArray.length===0||(p.instancedDataBuffer?p.instancedDataBuffer.updateData(p.instancedDataArray):p.instancedDataBuffer=a.createVertexBuffer(p.instancedDataArray,hfe.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const c in this.instancesPerModel){const p=this.instancesPerModel[c];p.instancedDataArray.length!==0&&p.instancedDataBuffer&&p.instancedDataBuffer.destroy()}const a=this.layers[0].modelManager;if(a&&this.modelUris&&this.modelsRequested)for(const c of this.modelUris)a.removeModel(c,"",!0)}addFeature(a,c,p){const g=this.layers[0],x=g.layout.get("model-id").evaluate(p,{},this.canonical);if(!x)return zr(`modelId is not evaluated for layer ${g.id} and it is not going to get rendered.`),x;(IM(x,!1)||this.styleDefinedModelURLs[x]!==void 0)&&(this.modelUris.includes(x)||this.modelUris.push(x)),this.instancesPerModel[x]||(this.instancesPerModel[x]=new _8);const w=this.instancesPerModel[x],C=w.instancedDataArray,N=new v8(p,C.length);for(const D of c)for(const U of D){if(U.x<0||U.x>=tr||U.y<0||U.y>=tr)continue;if(this.lookupDim!==0){const H=(this.lookupDim-1)/tr,Y=this.lookupDim*(U.y*H|0)+U.x*H|0;if(this.lookup){if(this.lookup[Y]!==0)continue;this.lookup[Y]=1}}this.instanceCount++;const q=C.length;C.resize(q+1),w.instancesEvaluatedElevation.push(0),C.float32[16*q]=U.x,C.float32[16*q+1]=U.y}return N.instancedDataCount=w.instancedDataArray.length-N.instancedDataOffset,N.instancedDataCount>0&&(a.id&&(w.idToFeaturesIndex[a.id]=w.features.length),w.features.push(N),this.evaluate(N,{},w,!1)),x}getModelUris(){return this.modelUris}evaluate(a,c,p,g){const x=this.layers[0],w=a.feature,C=this.canonical,N=a.rotation=x.paint.get("model-rotation").evaluate(w,c,C),D=a.scale=x.paint.get("model-scale").evaluate(w,c,C),U=a.translation=x.paint.get("model-translation").evaluate(w,c,C),q=Object.assign({},x.paint.get("model-color").evaluate(w,c,C));q.a=x.paint.get("model-color-mix-intensity").evaluate(w,c,C);const H=[];this.maxVerticalOffset<U[2]&&(this.maxVerticalOffset=U[2]);const Y=U[0]*U[0]+U[1]*U[1],J=Y>0?Math.sqrt(Y):0;p.maxScale=Math.max(Math.max(p.maxScale,D[0]),Math.max(D[1],D[2])),p.maxXYTranslationDistance=Math.max(p.maxXYTranslationDistance,J),this.maxScale=Math.max(Math.max(this.maxScale,D[0]),Math.max(D[1],D[2])),KV(H,N,D);const oe=Math.round(100*q.a)+q.b/1.05;for(let ce=0;ce<a.instancedDataCount;++ce){const he=a.instancedDataOffset+ce,Se=16*he,Te=p.instancedDataArray.float32;let ke=0;g&&(ke=Te[Se+6]-p.instancesEvaluatedElevation[he]);const qe=0|Te[Se+1];Te[Se]=(0|Te[Se])+q.r/1.05,Te[Se+1]=qe+q.g/1.05,Te[Se+2]=oe,Te[Se+3]=1/(C.z>10?this.tileToMeter:Ke(C,qe)),Te[Se+4]=U[0],Te[Se+5]=U[1],Te[Se+6]=U[2]+ke,Te[Se+7]=H[0],Te[Se+8]=H[1],Te[Se+9]=H[2],Te[Se+10]=H[4],Te[Se+11]=H[5],Te[Se+12]=H[6],Te[Se+13]=H[8],Te[Se+14]=H[9],Te[Se+15]=H[10],p.instancesEvaluatedElevation[he]=U[2]}}}let x8,b8;_r(RM,"ModelBucket",{omit:["layers"]}),_r(_8,"PerModelAttributes"),_r(v8,"ModelFeature");class Ex{constructor(a,c,p){this._demTile=a,this._dem=this._demTile.dem,this._scale=c,this._offset=p}static create(a,c,p){const g=p||a.findDEMTileFor(c);if(!g||!g.dem)return;const x=g.dem,w=g.tileID,C=1<<c.canonical.z-w.canonical.z;return new Ex(g,x.dim/tr/C,[(c.canonical.x/C-w.canonical.x)*x.dim,(c.canonical.y/C-w.canonical.y)*x.dim])}tileCoordToPixel(a,c){const p=c*this._scale+this._offset[1];return new st(Math.floor(a*this._scale+this._offset[0]),Math.floor(p))}getElevationAt(a,c,p,g){const x=a*this._scale+this._offset[0],w=c*this._scale+this._offset[1],C=Math.floor(x),N=Math.floor(w),D=this._dem;return g=!!g,p?Kr(Kr(D.get(C,N,g),D.get(C,N+1,g),w-N),Kr(D.get(C+1,N,g),D.get(C+1,N+1,g),w-N),x-C):D.get(C,N,g)}getElevationAtPixel(a,c,p){return this._dem.get(a,c,!!p)}getMeterToDEM(a){return(1<<this._demTile.tileID.canonical.z)*Ee(1,a)*this._dem.stride}}const MM=new Float32Array(262144),Ay=new Uint8Array(262144);function w8(u){let a=0;if(u.meshes)for(const c of u.meshes)a=Math.max(a,c.aabb.max[2]);if(u.children)for(const c of u.children)a=Math.max(a,w8(c));return a}function S8(u,a,c){if(u.meshes)for(const p of u.meshes){if(p.aabb.min[0]===1/0)continue;const g=xn.applyTransform(p.aabb,u.globalMatrix);c.insert(a,g.min[0],g.min[1],g.max[0],g.max[1])}if(u.children)for(const p of u.children)S8(p,a,c)}const E8=["","wall","door","roof","window","lamp","logo"];class T8{constructor(a){this.node=a,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:a.id,geometry:[],properties:{height:w8(a)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new xn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let a=0;const c=new xn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const p of this.node.meshes)this.node.lightMeshIndex!==a&&(p.transformedAabb=xn.applyTransformFast(p.aabb,this.node.globalMatrix),c.encapsulate(p.transformedAabb)),a++;this.aabb=c}return this.aabb}}class LC{constructor(a,c,p,g,x,w,C,N){this.id=p,this.layers=a,this.layerIds=this.layers.map(D=>D.fqid),this.stateDependentLayerIds=this.layers.filter(D=>D.isStateDependent()).map(D=>D.id),this.modelTraits|=mx.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,g&&(this.modelTraits|=mx.HasMapboxMeshFeatures),x&&(this.modelTraits|=mx.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=w,this.worldview=N,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const D of c)this.nodesInfo.push(new T8(D)),S8(D,C.featureIndexArray.length,C.grid),C.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,C.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(a,c){for(const p of this.getNodesInfo()){const g=p.node;g.footprint&&c.push({footprint:g.footprint,id:a})}}updateAppearances(a,c,p,g){}update(a){const c=Object.keys(a).length!==0;if(c&&!this.stateDependentLayers.length)return;const p=c?this.stateDependentLayers:this.layers;if(!yn(a,this.states))for(const g of p)this.evaluate(g,a);this.states=structuredClone(a)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(a){if(!this.needsUpload)return;const c=this.getNodesInfo();for(const p of c){const g=p.node;this.uploaded?this.updatePbrBuffer(g):aM(g,a,!0)}for(const p of c)vC(p.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(a){let c=!1;if(!a.meshes)return c;for(const p of a.meshes)p.pbrBuffer&&(p.pbrBuffer.updateData(p.featureArray),c=!0);return c}needsReEvaluation(a,c,p){const g=a.transform.projectionOptions,x=a.style.getBrightness(),w=this.brightness!==x;if(!this.uploaded||this.dirty||g.name!==this.projection.name||SS(p.paint.get("model-color").value,w)||SS(p.paint.get("model-color-mix-intensity").value,w)||SS(p.paint.get("model-roughness").value,w)||SS(p.paint.get("model-emissive-strength").value,w)||SS(p.paint.get("model-height-based-emissive-strength-multiplier").value,w)){this.projection=g,this.brightness=x;const C=this.getNodesInfo();for(const N of C)N.state=null;return!0}return!1}evaluateTransform(a,c){if(a.transform.zoom===this.zoom)return;this.zoom=a.transform.zoom;const p=this.getNodesInfo(),g=this.id.canonical;for(const x of p){const w=x.feature;x.evaluatedTranslation=c.paint.get("model-translation").evaluate(w,{},g),x.evaluatedScale=c.paint.get("model-scale").evaluate(w,{},g)}}evaluate(a,c){const p=this.getNodesInfo();for(const g of p){if(!g.node.meshes)continue;const x=g.feature,w=c&&c[x.id];if(yn(w,g.state))continue;g.state=structuredClone(w);const C=g.node.meshes&&g.node.meshes[0].featureData,N=g.evaluatedColor[2],D=g.evaluatedRMEA[2],U=this.id.canonical;if(g.hasTranslucentParts=!1,C){for(let q=0;q<E8.length;q++){const H=E8[q];H.length&&(x.properties.part=H);const Y=a.paint.get("model-color").evaluate(x,w,U).toPremultipliedRenderColor(null),J=a.paint.get("model-color-mix-intensity").evaluate(x,w,U);g.evaluatedColor[q]=[Y.r,Y.g,Y.b,J],g.evaluatedRMEA[q][0]=a.paint.get("model-roughness").evaluate(x,w,U),g.evaluatedRMEA[q][2]=a.paint.get("model-emissive-strength").evaluate(x,w,U),g.evaluatedRMEA[q][3]=Y.a,g.emissionHeightBasedParams[q]=a.paint.get("model-height-based-emissive-strength-multiplier").evaluate(x,w,U),!g.hasTranslucentParts&&Y.a<1&&(g.hasTranslucentParts=!0)}delete x.properties.part,$pe(g,N!==g.evaluatedColor[2]||D!==g.evaluatedRMEA[2],this.modelTraits)}else g.evaluatedRMEA[0][2]=a.paint.get("model-emissive-strength").evaluate(x,w,U);g.evaluatedTranslation=a.paint.get("model-translation").evaluate(x,w,U),g.evaluatedScale=a.paint.get("model-scale").evaluate(x,w,U),this.updatePbrBuffer(g.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(a,c,p,g){const x=a.findDEMTileFor(p);if(x&&(x.tileID.canonical!==this.terrainTile||c!==this.terrainExaggeration)){if(x.dem&&x.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=x.tileID.overscaledZ;const w=Ex.create(a,p,x);if(!w)return;this.modelTraits&mx.HasMapboxMeshFeatures&&this.updateDEM(a,w,p,g);for(const C of this.getNodesInfo()){const N=C.node;if(!N.footprint||!N.footprint.vertices||!N.footprint.vertices.length)continue;const D=N.footprint.vertices;let U=w.getElevationAt(D[0].x,D[0].y,!0,!0);for(let q=1;q<D.length;q++)U=Math.min(U,w.getElevationAt(D[q].x,D[q].y,!0,!0));N.elevation=U}}this.terrainTile=x.tileID.canonical,this.terrainExaggeration=c}}updateDEM(a,c,p,g){let x=c._dem._modifiedForSources[g];if(x===void 0&&(c._dem._modifiedForSources[g]=[],x=c._dem._modifiedForSources[g]),x.includes(p.canonical))return;const w=c._dem.dim;x.push(p.canonical);let C=!1;for(const N of this.getNodesInfo()){const D=N.node;if(!D.footprint||!D.footprint.grid)continue;const U=D.footprint.grid,q=c.tileCoordToPixel(U.min.x,U.min.y),H=c.tileCoordToPixel(U.max.x,U.max.y),Y=Math.min(Math.min(w-H.y,q.x),Math.min(q.y,w-H.x));if(Y<0)continue;const J=ve(Y,2,5);let oe=Math.max(0,q.x-J),ce=Math.max(0,q.y-J),he=Math.min(H.x+J,w-1),Se=Math.min(H.y+J,w-1);for(let Fe=ce;Fe<=Se;++Fe)for(let Xe=oe;Xe<=he;++Xe)Ay[Fe*w+Xe]=255;let Te=0,ke=0;for(let Fe=0;Fe<U.cellsY;++Fe)for(let Xe=0;Xe<U.cellsX;++Xe){if(!U.cells[Fe*U.cellsX+Xe])continue;const et=c.tileCoordToPixel(U.min.x+Xe/U.xScale,U.min.y+Fe/U.yScale),it=c.tileCoordToPixel(U.min.x+(Xe+1)/U.xScale,U.min.y+(Fe+1)/U.yScale);for(let At=et.y;At<=Math.min(it.y+1,w-1);++At)for(let pt=et.x;pt<=Math.min(it.x+1,w-1);++pt)Ay[At*w+pt]===255&&(Ay[At*w+pt]=0,Te+=c.getElevationAtPixel(pt,At),ke++)}const qe=Te/ke;oe=Math.max(1,q.x-J),ce=Math.max(1,q.y-J),he=Math.min(H.x+J,w-2),Se=Math.min(H.y+J,w-2),C=!0;for(let Fe=ce;Fe<=Se;++Fe)for(let Xe=oe;Xe<=he;++Xe)Ay[Fe*w+Xe]===0&&(MM[Fe*w+Xe]=c._dem.set(Xe,Fe,qe));for(let Fe=1;Fe<J;++Fe){oe=Math.max(1,q.x-Fe),ce=Math.max(1,q.y-Fe),he=Math.min(H.x+Fe,w-2),Se=Math.min(H.y+Fe,w-2);for(let Xe=ce;Xe<=Se;++Xe)for(let et=oe;et<=he;++et){const it=Xe*w+et;if(Ay[it]===255){let At=0,pt=0,jt=-1,Rt=-1;for(let zt=-1;zt<=1;++zt)for(let Yt=-1;Yt<=1;++Yt){const qt=(Xe+zt)*w+et+Yt;if(Ay[qt]>=Fe)continue;const Dt=MM[qt],Vt=Math.abs(Dt);Vt>pt&&(At=Dt,pt=Vt,jt=Yt,Rt=zt)}if(pt>.1){const zt=1-(Fe+.5*Math.abs(jt*Rt))/J;let Yt=c._dem.get(et,Xe)+At*zt;const qt=c._dem.get(et+jt,Xe+Rt),Dt=c._dem.get(et-jt,Xe-Rt,!0);(Yt-qt)*(Yt-Dt)>0&&(Yt=(qt+Dt)/2),MM[it]=c._dem.set(et,Xe,Yt),Ay[it]=Fe}}}}}C&&(c._demTile.needsDEMTextureUpload=!0,c._dem._timestamp=Pl.now())}setFilter(a){this.filter=a?H_(a):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(a=>this.filter.filter(new Vi(this.id.overscaledZ,{worldview:this.worldview}),a.feature,this.id.canonical)):this.nodesInfo}destroy(){const a=this.getNodesInfo();for(const c of a)vC(c.node),oM(c.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(a,c){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const p=c.getReplacementRegionsForTile(a.toUnwrapped());for(const g of this.getNodesInfo()){const x=g.node.footprint;g.hiddenByReplacement=!!x&&!p.find(w=>w.footprint===x)}}getHeightAtTileCoord(a,c){const p=[],g=[0,0,0],x=I([]);for(const w of this.getNodesInfo()){const C=w.node.meshes[0],N=C.transformedAabb;if(a<N.min[0]||c<N.min[1]||a>N.max[0]||c>N.max[1])continue;if(w.node.hidden===!0)return{height:1/0,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};R(x,w.node.globalMatrix),g[0]=a,g[1]=c,Ht(g,g,x);const D=(g[0]-C.aabb.min[0])/(C.aabb.max[0]-C.aabb.min[0])*Sy|0,U=Math.min(63,(g[1]-C.aabb.min[1])/(C.aabb.max[1]-C.aabb.min[1])*Sy|0)*Sy+Math.min(63,D),q=C.heightmap[U];if(!(q<0&&w.node.footprint))return w.hiddenByReplacement?void 0:{height:q,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};if(w.node.footprint.grid.query(new st(a,c),new st(a,c),p),p.length>0)return{height:void 0,maxHeight:w.feature.properties.height,hidden:w.hiddenByReplacement,verticalScale:w.evaluatedScale[2]}}}}function SS(u,a){return u instanceof ly&&!u.isLightConstant&&a}function Bpe(u,a,c,p,g,x,w,C){let N=(61440&a|(61440&a)>>4)>>8,D=(3840&a|(3840&a)>>4)>>4,U=240&a|(240&a)>>4;c[3]>0&&(N=Kr(N,255*c[0],c[3]),D=Kr(D,255*c[1],c[3]),U=Kr(U,255*c[2],c[3]));const q=N<<8|D,H=U<<8|Math.floor(255*p[3]),Y=function(Fe){const Xe=ve(Fe,0,2);return Math.min(Math.round(.5*Xe*255),255)}(p[2])<<8|15*p[0]<<4|15*p[1],J=ve(g[0],0,1),oe=ve(g[1],0,1),ce=ve(g[2],0,1),he=ve(g[3],0,1);let Se,Te,ke,qe;if(J!==oe&&w!==x&&oe!==J){const Fe=w-x;Te=1/(Fe*(oe-J)),ke=-(x+Fe*J)/(Fe*(oe-J));const Xe=ve(g[4],-1,1);qe=Math.pow(10,Xe),Se=255*ce<<8|255*he}else Se=65535,Te=0,ke=1,qe=1;if(u.emplaceBack(q,H,Y,Se,Te,ke,qe),C){const Fe=C.length;C.clear();for(let Xe=0;Xe<Fe;Xe++)C.emplaceBack(q,H,Y,Se,Te,ke,qe)}}function $pe(u,a,c){const p=u.node;let g=0;const x=c&mx.HasMeshoptCompression;for(const w of p.meshes){if(p.lights&&p.lightMeshIndex===g||!w.featureData)continue;w.featureArray=new Yp,w.featureArray.reserve(w.featureData.length);let C=a;for(const N of w.featureData){const D=x?65535&N:N>>16&65535,U=x?N>>16&65535:65535&N,q=(15&U)<8?15&U:0,H=u.evaluatedRMEA[q],Y=u.evaluatedColor[q],J=u.emissionHeightBasedParams[q];let oe;if(C&&q===2&&p.lights&&(oe=new Yp,oe.resize(10*p.lights.length)),Bpe(w.featureArray,D,Y,H,J,w.aabb.min[2],w.aabb.max[2],oe),oe&&C){C=!1;const ce=p.meshes[p.lightMeshIndex];ce.featureArray=oe,ce.featureArray._trim()}}w.featureArray._trim(),g++}}_r(LC,"Tiled3dModelBucket",{omit:["layers"]}),_r(T8,"Tiled3dModelFeature");const Upe=["id","tile","layer","source","sourceLayer","state"];class Cy{constructor(a,c,p,g,x){this.type="Feature",this._vectorTileFeature=a,this._z=c,this._x=p,this._y=g,this.properties=a?a.properties:{},this.id=x}clone(){const a=new Cy(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(a.state=Object.assign({},this.state)),this.layer&&(a.layer=Object.assign({},this.layer)),this.source&&(a.source=this.source),this.sourceLayer&&(a.sourceLayer=this.sourceLayer),a}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const c of Upe)this[c]!==void 0&&(a[c]=this[c]);return a}}class jy extends od{constructor(a,c,p,g){super(),this.id=a,this.type="model",this.models=[],this._loaded=!1,this._options=c,this._modelsInfo=new Map}load(){const a=[];for(const c in this._options.models){const p=this._options.models[c],g=this._modelsInfo.get(c);if(g){const x=g.model;x.position=p.position!=null?new Q(p.position[0],p.position[1]):new Q(0,0),x.orientation=p.orientation!=null?p.orientation:[0,0,0],g.modelSpec=p,jy.applyModelSpecification(x,p),x.computeBoundsAndApplyParent(),this.models.push(x)}else{const x=qV(this.map._requestManager.transformRequest(p.uri,of.Model).url).then(w=>{if(!w)return;const C=cM(w),N=new ZV(c,p.uri,p.position,p.orientation,C);jy.applyModelSpecification(N,p),N.computeBoundsAndApplyParent(),this.models.push(N),this._modelsInfo.set(c,{modelSpec:p,model:N})}).catch(w=>{this.fire(new $g(new Error(`Could not load model ${c} from ${p.uri}: ${w.message}`)))});a.push(x)}}Promise.allSettled(a).then(()=>{this._loaded=!0,this.fire(new ql("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(c=>{this._loaded=!0,this.fire(new $g(new Error(`Could not load models: ${c.message}`)))})}static applyModelSpecification(a,c){c.nodeOverrides&&jy.convertNodeOverrides(a,c.nodeOverrides),c.materialOverrides&&jy.convertMaterialOverrides(a,c.materialOverrides),c.nodeOverrideNames&&(a.nodeOverrideNames=[...c.nodeOverrideNames]),c.materialOverrideNames&&(a.materialOverrideNames=[...c.materialOverrideNames]),c.featureProperties&&(a.featureProperties=c.featureProperties)}static convertNodeOverrides(a,c){if(Array.isArray(c)&&c.every(p=>typeof p=="string")){a.nodeOverrideNames=[];for(const p of c)a.nodeOverrideNames.push(p)}else Object.entries(c).forEach(([p,g])=>{const x={orientation:[0,0,0]};if(g.hasOwnProperty("orientation")){const w=g.orientation;w&&(x.orientation=w)}a.nodeOverrides.set(p,x)})}static convertMaterialOverrides(a,c){if(Array.isArray(c)&&c.every(p=>typeof p=="string")){a.materialOverrideNames=[];for(const p of c)a.materialOverrideNames.push(p)}else Object.entries(c).forEach(([p,g])=>{const x={color:new hi(1,1,1),colorMix:0,emissionStrength:0,opacity:1},w=g["model-color"];w!==void 0&&(x.color.r=w[0],x.color.g=w[1],x.color.b=w[2]);const C=g["model-color-mix-intensity"];C!==void 0&&(x.colorMix=C);const N=g["model-emissive-strength"];N!==void 0&&(x.emissionStrength=N);const D=g["model-opacity"];D!==void 0&&(x.opacity=D),a.materialOverrides.set(p,x)})}onAdd(a){this.map=a,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(a,c){}serialize(){return this._options}setProperty(a,c){return!1}reload(){const a=xf(this.id,this.scope);this.map.style.clearSource(a),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(a){this.models=[];const c=new Map;for(const p in a){const g=a[p];if(this._modelsInfo.has(p)){const x=this._modelsInfo.get(p);x&&x.modelSpec.uri===g.uri&&c.set(p,x)}}this._modelsInfo=c,this._options.models=a,this._loaded=!1,this.load()}}function DM(u,a,c,p){const g=1<<u.z;a.lat=je((p/tr+u.y)/g),a.lng=Ne((c/tr+u.x)/g)}function Vpe(u,a,c,p){const g=u.getNodesInfo()[a];if(!g||g.hiddenByReplacement||!g.node.meshes)return;let x=Number.MAX_VALUE;const w=g.node,C=c.tile,N=p.calculatePosMatrix(C.tileID.toUnwrapped(),p.worldSize),D=g.evaluatedScale;let U=0;p.elevation&&w.elevation&&(U=w.elevation*p.elevation.exaggeration()),F(N,N,[(w.anchor?w.anchor[0]:0)*(D[0]-1),(w.anchor?w.anchor[1]:0)*(D[1]-1),U]),z(N,N,D);const q=c.queryGeometry,H=q.isPointQuery()?q.screenBounds:q.screenGeometry,Y=function(oe){const ce=M([],N,oe.globalMatrix);M(ce,p.expandedFarZProjMatrix,ce);for(let he=0;he<oe.meshes.length;++he){const Se=oe.meshes[he];if(he===oe.lightMeshIndex)continue;const Te=sM(H,p,ce,Se.aabb);Te!=null&&(x=Math.min(Te,x))}if(oe.children)for(const he of oe.children)Y(he)};if(Y(w),x===Number.MAX_VALUE)return;const J=new Q(0,0);return DM(C.tileID.canonical,J,g.node.anchor[0],g.node.anchor[1]),{intersectionZ:x,position:J,feature:g.feature}}const qpe={circle:class extends $o{constructor(u,a,c,p){super(u,{layout:vd||(vd=new ws({"circle-sort-key":new ur(ft.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Gt(ft.layout_circle["circle-elevation-reference"]),visibility:new Gt(ft.layout_circle.visibility)})),paint:em||(em=new ws({"circle-radius":new ur(ft.paint_circle["circle-radius"]),"circle-color":new ur(ft.paint_circle["circle-color"]),"circle-blur":new ur(ft.paint_circle["circle-blur"]),"circle-opacity":new ur(ft.paint_circle["circle-opacity"]),"circle-translate":new Gt(ft.paint_circle["circle-translate"]),"circle-translate-anchor":new Gt(ft.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Gt(ft.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Gt(ft.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ur(ft.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ur(ft.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ur(ft.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Gt(ft.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},a,c,p)}createBucket(u){return new ls(u)}queryRadius(u){const a=u;return Ma("circle-radius",this,a)+Ma("circle-stroke-width",this,a)+vs(this.paint.get("circle-translate"))}queryIntersectsFeature(u,a,c,p,g,x,w,C){const N=Qp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,u.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(a,c)+this.paint.get("circle-stroke-width").evaluate(a,c);return kU(u,p,x,w,C,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",N,D)}getProgramIds(){return["circle"]}getDefaultProgramParams(u,a,c){const p=OU(this);return{config:new yd(this,{zoom:a,lut:c}),defines:p,overrideFog:!1}}is3D(u){return!u&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends $o{createBucket(u){return new IU(u)}constructor(u,a,c,p){super(u,{layout:RU||(RU=new ws({visibility:new Gt(ft.layout_heatmap.visibility)})),paint:MU||(MU=new ws({"heatmap-radius":new ur(ft.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ur(ft.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Gt(ft.paint_heatmap["heatmap-intensity"]),"heatmap-color":new $p(ft.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Gt(ft.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},a,c,p),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=H1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(u){return Ma("heatmap-radius",this,u)}queryIntersectsFeature(u,a,c,p,g,x,w,C){const N=this.paint.get("heatmap-radius").evaluate(a,c);return kU(u,p,x,w,C,!0,!0,new st(0,0),N)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(u,a,c){return u==="heatmap"?{config:new yd(this,{zoom:a,lut:c}),overrideFog:!1}:{}}},hillshade:class extends $o{constructor(u,a,c,p){super(u,{layout:DU||(DU=new ws({visibility:new Gt(ft.layout_hillshade.visibility)})),paint:LU||(LU=new ws({"hillshade-illumination-direction":new Gt(ft.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Gt(ft.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Gt(ft.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Gt(ft.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Gt(ft.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Gt(ft.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Gt(ft.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},a,c,p)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(u,a,c){return{overrideFog:!1}}},fill:class extends $o{constructor(u,a,c,p){super(u,{layout:JU||(JU=new ws({"fill-sort-key":new ur(ft.layout_fill["fill-sort-key"]),visibility:new Gt(ft.layout_fill.visibility),"fill-elevation-reference":new Gt(ft.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new ur(ft.layout_fill["fill-construct-bridge-guard-rail"])})),paint:QU||(QU=new ws({"fill-antialias":new Gt(ft.paint_fill["fill-antialias"]),"fill-opacity":new ur(ft.paint_fill["fill-opacity"]),"fill-color":new ur(ft.paint_fill["fill-color"]),"fill-outline-color":new ur(ft.paint_fill["fill-outline-color"]),"fill-translate":new Gt(ft.paint_fill["fill-translate"]),"fill-translate-anchor":new Gt(ft.paint_fill["fill-translate-anchor"]),"fill-pattern":new ur(ft.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Gt(ft.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Gt(ft.paint_fill["fill-emissive-strength"]),"fill-z-offset":new ur(ft.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new ur(ft.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new ur(ft.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},a,c,p)}getProgramIds(){const u=this.paint.get("fill-pattern"),a=u&&u.constantOr(1),c=[a?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&c.push(a&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),c}getDefaultProgramParams(u,a,c){return{config:new yd(this,{zoom:a,lut:c}),overrideFog:!1}}recalculate(u,a){super.recalculate(u,a);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new UR(u)}queryRadius(){return vs(this.paint.get("fill-translate"))}queryIntersectsFeature(u,a,c,p,g,x){return!u.queryGeometry.isAboveHorizon&&Ss(Yl(u.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,u.pixelToTileUnitsFactor),p)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(u){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const a=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return u!=null?a&&!u:a}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends $o{constructor(u,a,c,p){super(u,{layout:EV||(EV=new ws({visibility:new Gt(ft["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Gt(ft["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:TV||(TV=new ws({"fill-extrusion-opacity":new Gt(ft["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ur(ft["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Gt(ft["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Gt(ft["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ur(ft["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Gt(ft["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new ur(ft["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ur(ft["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Gt(ft["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Gt(ft["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Gt(ft["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Gt(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Gt(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Gt(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Gt(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Gt(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Gt(ft["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Gt(ft["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ur(ft["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ur(ft["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Gt(ft["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Gt(ft["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Gt(ft["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Gt(ft["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ur(ft["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new ur(ft["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Gt(ft["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},a,c,p),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new lC(u)}queryRadius(){return vs(this.paint.get("fill-extrusion-translate"))}is3D(u){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(u,a,c,p,g,x,w,C,N){const D=Qp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,u.pixelToTileUnitsFactor),U=this.paint.get("fill-extrusion-height").evaluate(a,c),q=this.paint.get("fill-extrusion-base").evaluate(a,c),H=[0,0],Y=C&&x.elevation,J=x.elevation?x.elevation.exaggeration():1,oe=u.tile.getBucket(this);if(Y&&oe instanceof lC){const ke=oe.centroidVertexArray,qe=N+1;qe<ke.length&&(H[0]=ke.geta_centroid_pos0(qe),H[1]=ke.geta_centroid_pos1(qe))}if(H[0]===0&&H[1]===1)return!1;x.projection.name==="globe"&&(p=SV([p],[new st(0,0),new st(tr,tr)],u.tileID.canonical).map(ke=>ke.polygon).flat());const ce=Y?C:null,[he,Se]=NV(x,p,q,U,D,w,ce,H,J,x.center.lat,u.tileID.canonical),Te=u.queryGeometry;return kV(he,Se,Te.isPointQuery()?Te.screenBounds:Te.screenGeometry)}},building:class extends $o{constructor(u,a,c,p){super(u,{layout:n6||(n6=new ws({visibility:new Gt(ft.layout_building.visibility),"building-facade":new ur(ft.layout_building["building-facade"]),"building-facade-floors":new ur(ft.layout_building["building-facade-floors"]),"building-facade-unit-width":new ur(ft.layout_building["building-facade-unit-width"]),"building-facade-window":new ur(ft.layout_building["building-facade-window"]),"building-roof-shape":new ur(ft.layout_building["building-roof-shape"]),"building-height":new ur(ft.layout_building["building-height"]),"building-base":new ur(ft.layout_building["building-base"]),"building-flood-light-wall-radius":new ur(ft.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new ur(ft.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new ur(ft.layout_building["building-flip-roof-orientation"])})),paint:i6||(i6=new ws({"building-opacity":new Gt(ft.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Gt(ft.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Gt(ft.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Gt(ft.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Gt(ft.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Gt(ft.paint_building["building-vertical-scale"]),"building-cast-shadows":new Gt(ft.paint_building["building-cast-shadows"]),"building-color":new ur(ft.paint_building["building-color"]),"building-emissive-strength":new ur(ft.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Gt(ft.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Gt(ft.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Gt(ft.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Gt(ft.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Gt(ft.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},a,c,p),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new r6(u)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(u){return!0}queryRadius(u){return 0}queryIntersectsFeature(u,a,c,p,g,x,w,C,N){let D=this.layout.get("building-height").evaluate(a,c);const U=this.layout.get("building-base").evaluate(a,c),q=u.tile.getBucket(this).getFootprint(a);if(q){if(q.hiddenFlags!==0)return!1;D=q.height}const[H,Y]=NV(x,p,U,D,new st(0,0),w,null,[0,0],1,x.center.lat,u.tileID.canonical),J=u.queryGeometry;return kV(H,Y,J.isPointQuery()?J.screenBounds:J.screenGeometry)}},line:class extends $o{constructor(u,a,c,p){const g=p6();super(u,g,a,c,p),g.layout&&(this.layout=new _f(g.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(u){if(u==="line-gradient"){const a=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=a._styleExpression&&a._styleExpression.expression instanceof ry,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(u,a){super.recalculate(u,a),this.paint._values["line-floorwidth"]=(()=>{if(lS)return lS;const c=p6();return lS=new Bfe(c.paint.properties["line-width"].specification),lS.useIntegerZoom=!0,lS})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new dM(u)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(u,a,c){const p=h6(this);return{config:new yd(this,{zoom:a,lut:c}),defines:p,overrideFog:!1}}queryRadius(u){const a=u,c=m6(Ma("line-width",this,a),Ma("line-gap-width",this,a)),p=Ma("line-offset",this,a);return c/2+Math.abs(p)+vs(this.paint.get("line-translate"))}queryIntersectsFeature(u,a,c,p,g,x){if(u.queryGeometry.isAboveHorizon)return!1;const w=Yl(u.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,u.pixelToTileUnitsFactor),C=u.pixelToTileUnitsFactor/2*m6(this.paint.get("line-width").evaluate(a,c),this.paint.get("line-gap-width").evaluate(a,c)),N=this.paint.get("line-offset").evaluate(a,c);return N&&(p=function(D,U){const q=[],H=new st(0,0);for(let Y=0;Y<D.length;Y++){const J=D[Y],oe=[];for(let ce=0;ce<J.length;ce++){const he=J[ce],Se=J[ce+1],Te=ce===0?H:he.sub(J[ce-1])._unit()._perp(),ke=ce===J.length-1?H:Se.sub(he)._unit()._perp(),qe=Te._add(ke)._unit();qe._mult(1/(qe.x*ke.x+qe.y*ke.y)),oe.push(qe._mult(U)._add(he))}q.push(oe)}return q}(p,N*u.pixelToTileUnitsFactor)),function(D,U,q){for(let H=0;H<U.length;H++){const Y=U[H];if(D.length>=3){for(let J=0;J<Y.length;J++)if(Ra(D,Y[J]))return!0}if(_l(D,Y,q))return!0}return!1}(w,p,C)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(u){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:IC,background:class extends $o{constructor(u,a,c,p){super(u,{layout:i8||(i8=new ws({visibility:new Gt(ft.layout_background.visibility)})),paint:s8||(s8=new ws({"background-pitch-alignment":new Gt(ft.paint_background["background-pitch-alignment"]),"background-color":new Gt(ft.paint_background["background-color"]),"background-pattern":new Gt(ft.paint_background["background-pattern"]),"background-opacity":new Gt(ft.paint_background["background-opacity"]),"background-emissive-strength":new Gt(ft.paint_background["background-emissive-strength"]),"background-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},a,c,p)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(u,a,c){return{overrideFog:!1}}is3D(u){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:u8,"raster-particle":g8,sky:class extends $o{constructor(u,a,c,p){super(u,{layout:f8||(f8=new ws({visibility:new Gt(ft.layout_sky.visibility)})),paint:p8||(p8=new ws({"sky-type":new Gt(ft.paint_sky["sky-type"]),"sky-atmosphere-sun":new Gt(ft.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Gt(ft.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Gt(ft.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Gt(ft.paint_sky["sky-gradient-radius"]),"sky-gradient":new $p(ft.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Gt(ft.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Gt(ft.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Gt(ft.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},a,c,p),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(u){u==="sky-gradient"?this._updateColorRamp():u!=="sky-atmosphere-sun"&&u!=="sky-atmosphere-halo-color"&&u!=="sky-atmosphere-color"&&u!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=H1({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(u){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const a=u.style.light.properties.get("position");return this._lightPosition.azimuthal!==a.azimuthal||this._lightPosition.polar!==a.polar}return!1}getCenter(u,a){if(this.paint.get("sky-type")==="atmosphere"){const p=this.paint.get("sky-atmosphere-sun"),g=!p,x=u.style.light,w=x.properties.get("position");return g&&x.properties.get("anchor")==="viewport"&&zr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),g?NM(w.azimuthal,90-w.polar,a):NM(p[0],90-p[1],a)}const c=this.paint.get("sky-gradient-center");return NM(c[0],90-c[1],a)}isSky(){return!0}markSkyboxValid(u){this._skyboxInvalidated=!1,this._lightPosition=u.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const u=this.paint.get("sky-type");return u==="atmosphere"?["skyboxCapture","skybox"]:u==="gradient"?["skyboxGradient"]:null}},slot:class extends $o{constructor(u,a,c,p){super(u,{paint:m8||(m8=new ws({}))},a,null)}},model:class extends $o{constructor(u,a,c,p){super(u,{layout:x8||(x8=new ws({visibility:new Gt(ft.layout_model.visibility),"model-id":new ur(ft.layout_model["model-id"])})),paint:b8||(b8=new ws({"model-opacity":new ur(ft.paint_model["model-opacity"]),"model-rotation":new ur(ft.paint_model["model-rotation"]),"model-scale":new ur(ft.paint_model["model-scale"]),"model-translation":new ur(ft.paint_model["model-translation"]),"model-color":new ur(ft.paint_model["model-color"]),"model-color-mix-intensity":new ur(ft.paint_model["model-color-mix-intensity"]),"model-type":new Gt(ft.paint_model["model-type"]),"model-cast-shadows":new Gt(ft.paint_model["model-cast-shadows"]),"model-receive-shadows":new Gt(ft.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Gt(ft.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ur(ft.paint_model["model-emissive-strength"]),"model-roughness":new ur(ft.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ur(ft.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Gt(ft.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Gt(ft.paint_model["model-front-cutoff"]),"model-elevation-reference":new Gt(ft.paint_model["model-elevation-reference"]),"model-color-use-theme":new ur({type:"string",default:"default","property-type":"data-driven"})}))},a,c,p),this.layer=u,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new RM(u)}getProgramIds(){return["model"]}is3D(u){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(u){return u instanceof LC?tr-1:0}queryRenderedFeatures(u,a,c){const p=a.getSource();if(!(p&&p instanceof jy))return{};const g=p,x={};x[this.id]=[];const w=x[this.id];let C=0;for(const N of g.models){const D=a.getFeatureState(this.sourceLayer,N.id),U={type:"Unknown",id:N.id,properties:N.featureProperties},q=this.paint.get("model-rotation").evaluate(U,D),H=this.paint.get("model-scale").evaluate(U,D),Y=this.paint.get("model-translation").evaluate(U,D),J=this.paint.get("model-elevation-reference");let oe=[];yC(oe,N,c,N.position,q,H,Y,J==="ground",J==="ground",!1),c.projection.name==="globe"&&(oe=gC(oe,c));const ce=M([],c.projMatrix,oe),he=sM(u.isPointQuery()?u.screenBounds:u.screenGeometry,c,ce,N.aabb);if(he!=null){const Se=new Cy(void 0,0,0,0,N.id);Se.layer=this.layer,Se.properties=structuredClone(N.featureProperties),Se.properties.layer=this.id,Se.properties.uri=N.uri,Se.properties.orientation=N.orientation,Se.sourceLayer=this.sourceLayer,Se.geometry={type:"Point",coordinates:[N.position.lng,N.position.lat]},Se.state=D,Se.source=this.source,w.push({featureIndex:C,feature:Se,intersectionZ:he})}++C}return x}queryIntersectsFeature(u,a,c,p,g,x){if(!this.modelManager)return!1;const w=this.modelManager,C=u.tile.getBucket(this);if(!(C&&C instanceof RM))return!1;for(const N in C.instancesPerModel){const D=C.instancesPerModel[N],U=a.id!==void 0?a.id:a.properties&&a.properties.hasOwnProperty("id")?a.properties.id:void 0;if(D.idToFeaturesIndex.hasOwnProperty(U)){const q=D.features[D.idToFeaturesIndex[U]],H=w.getModel(N,this.scope);if(!H)return!1;let Y=[];const J=new Q(0,0),oe=C.canonical;let ce=Number.MAX_VALUE;for(let he=0;he<q.instancedDataCount;++he){const Se=16*(q.instancedDataOffset+he),Te=D.instancedDataArray.float32,ke=[Te[Se+4],Te[Se+5],Te[Se+6]];DM(oe,J,Math.floor(Te[Se]),Math.floor(Te[Se+1])),yC(Y,H,x,J,q.rotation,q.scale,ke,!1,!1,!1),x.projection.name==="globe"&&(Y=gC(Y,x));const qe=M([],x.projMatrix,Y),Fe=u.queryGeometry,Xe=sM(Fe.isPointQuery()?Fe.screenBounds:Fe.screenGeometry,x,qe,H.aabb);Xe!=null&&(ce=Math.min(Xe,ce))}return ce!==Number.MAX_VALUE&&ce}}return!1}_handleOverridablePaintPropertyUpdate(u,a,c){return!(!this.layout||a.isDataDriven()||c.isDataDriven()||u!=="model-color"&&u!=="model-color-mix-intensity"&&u!=="model-rotation"&&u!=="model-scale"&&u!=="model-translation"&&u!=="model-emissive-strength")}_isPropertyZoomDependent(u){const a=this._transitionablePaint._values[u];return a!=null&&a.value!=null&&a.value.expression!=null&&a.value.expression instanceof sh}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends $o{constructor(u,a,c,p){super(u,{layout:eV||(eV=new ws({"clip-layer-types":new Gt(ft.layout_clip["clip-layer-types"]),"clip-layer-scope":new Gt(ft.layout_clip["clip-layer-scope"])})),paint:tV||(tV=new ws({}))},a,c,p)}recalculate(u,a){super.recalculate(u,a)}createBucket(u){return new rV(u)}is3D(u){return!0}}},LM=new hi(0,0,0),FM={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},zM={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},FC={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},Hpe={PAINT_ORDER_FILL_AND_STROKE:1},ES={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},A8={MASK_TYPE_LUMINANCE:1};function Gpe(u,a,c){u===1&&a.icons.push(function(p,g){return function(x){if(x.usvg_tree.height||(x.usvg_tree.height=x.usvg_tree.width),!x.metadata)return x;const{metadata:w}=x;if(w.content_area){const{content_area:C}=w;C.left==null&&(C.left=0),C.top==null&&(C.top=C.left),C.width==null&&(C.width=x.usvg_tree.width),C.height==null&&(C.height=C.width)}if(w.text_placeholder){const{text_placeholder:C}=w;C.top==null&&(C.top=C.left),C.height==null&&(C.height=C.width)}return w.stretch_x&&w.stretch_x.length&&C8(w,"x"),w.stretch_y&&w.stretch_y.length&&C8(w,"y"),x}(p.readFields(Wpe,{name:void 0},g))}(c,c.readVarint()+c.pos))}function C8(u,a){const c=[],p=u[`stretch_${a}`];let g=null;for(let x=0;x<p.length;x++)g===null?g=c.length===0?p[0]:c[c.length-1][1]+p[x]:(c.push([g,g+p[x]]),g=null);u[`stretch_${a}_areas`]=c}function Wpe(u,a,c){u===1?a.name=c.readString():u===2?a.metadata=function(p,g){return p.readFields(Kpe,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},g)}(c,c.readVarint()+c.pos):u===3&&(a.usvg_tree=function(p,g){return p.readFields(Ype,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},g)}(c,c.readVarint()+c.pos),a.data="usvg_tree")}function Kpe(u,a,c){u===1?a.stretch_x=c.readPackedVarint():u===2?a.stretch_y=c.readPackedVarint():u===3?a.content_area=j8(c,c.readVarint()+c.pos):u===4?a.variables.push(function(p,g){return p.readFields(Xpe,{name:void 0},g)}(c,c.readVarint()+c.pos)):u===5&&(a.text_placeholder=j8(c,c.readVarint()+c.pos))}function j8(u,a){return u.readFields(Zpe,{},a)}function Zpe(u,a,c){u===1?a.left=c.readVarint():u===2?a.width=c.readVarint():u===3?a.top=c.readVarint():u===4&&(a.height=c.readVarint())}function Xpe(u,a,c){u===1?a.name=c.readString():u===2&&(a.rgb_color=$C(c.readVarint()),a.value="rgb_color")}function Ype(u,a,c){u===1?a.width=a.height=c.readVarint():u===2?a.height=c.readVarint():u===3?a.children.push(zC(c,c.readVarint()+c.pos)):u===4?a.linear_gradients.push(function(p,g){return p.readFields(ime,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},g)}(c,c.readVarint()+c.pos)):u===5?a.radial_gradients.push(function(p,g){return p.readFields(ame,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},g)}(c,c.readVarint()+c.pos)):u===7?a.clip_paths.push(function(p,g){return p.readFields(ome,{children:[]},g)}(c,c.readVarint()+c.pos)):u===8&&a.masks.push(function(p,g){const x=p.readFields(lme,{left:0,width:20,mask_type:A8.MASK_TYPE_LUMINANCE,children:[]},g);return x.height==null&&(x.height=x.width),x.top==null&&(x.top=x.left),x}(c,c.readVarint()+c.pos))}function zC(u,a){return u.readFields(Jpe,{},a)}function Jpe(u,a,c){u===1?(a.group=function(p,g){return p.readFields(Qpe,{opacity:255,children:[]},g)}(c,c.readVarint()+c.pos),a.node="group"):u===2&&(a.path=function(p,g){return p.readFields(tme,{paint_order:1,commands:[],step:1,diffs:[],rule:FM.PATH_RULE_NON_ZERO},g)}(c,c.readVarint()+c.pos),a.node="path")}function Qpe(u,a,c){u===1?a.transform=BC(c,c.readVarint()+c.pos):u===2?a.opacity=c.readVarint():u===5?a.clip_path_idx=c.readVarint():u===6?a.mask_idx=c.readVarint():u===7&&a.children.push(zC(c,c.readVarint()+c.pos))}function BC(u,a){return u.readFields(eme,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},a)}function eme(u,a,c){u===1?a.sx=c.readFloat():u===2?a.ky=c.readFloat():u===3?a.kx=c.readFloat():u===4?a.sy=c.readFloat():u===5?a.tx=c.readFloat():u===6&&(a.ty=c.readFloat())}function tme(u,a,c){u===1?a.fill=function(p,g){return p.readFields(rme,{rgb_color:LM,paint:"rgb_color",opacity:255},g)}(c,c.readVarint()+c.pos):u===2?a.stroke=function(p,g){return p.readFields(nme,{rgb_color:LM,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},g)}(c,c.readVarint()+c.pos):u===3?a.paint_order=c.readVarint():u===5?c.readPackedVarint(a.commands):u===6?a.step=c.readFloat():u===7?c.readPackedSVarint(a.diffs):u===8&&(a.rule=c.readVarint())}function rme(u,a,c){u===1?(a.rgb_color=$C(c.readVarint()),a.paint="rgb_color"):u===2?(a.linear_gradient_idx=c.readVarint(),a.paint="linear_gradient_idx"):u===3?(a.radial_gradient_idx=c.readVarint(),a.paint="radial_gradient_idx"):u===5&&(a.opacity=c.readVarint())}function $C(u){return new hi((u>>16&255)/255,(u>>8&255)/255,(255&u)/255,1)}function nme(u,a,c){u===1?(a.rgb_color=$C(c.readVarint()),a.paint="rgb_color"):u===2?(a.linear_gradient_idx=c.readVarint(),a.paint="linear_gradient_idx"):u===3?(a.radial_gradient_idx=c.readVarint(),a.paint="radial_gradient_idx"):u===5?c.readPackedFloat(a.dasharray):u===6?a.dashoffset=c.readFloat():u===7?a.miterlimit=c.readFloat():u===8?a.opacity=c.readVarint():u===9?a.width=c.readFloat():u===10?a.linecap=c.readVarint():u===11&&(a.linejoin=c.readVarint())}function ime(u,a,c){u===1?a.transform=BC(c,c.readVarint()+c.pos):u===2?a.spread_method=c.readVarint():u===3?a.stops.push(P8(c,c.readVarint()+c.pos)):u===4?a.x1=c.readFloat():u===5?a.y1=c.readFloat():u===6?a.x2=c.readFloat():u===7&&(a.y2=c.readFloat())}function P8(u,a){return u.readFields(sme,{offset:0,opacity:255,rgb_color:LM},a)}function sme(u,a,c){u===1?a.offset=c.readFloat():u===2?a.opacity=c.readVarint():u===3&&(a.rgb_color=$C(c.readVarint()))}function ame(u,a,c){u===1?a.transform=BC(c,c.readVarint()+c.pos):u===2?a.spread_method=c.readVarint():u===3?a.stops.push(P8(c,c.readVarint()+c.pos)):u===4?a.cx=c.readFloat():u===5?a.cy=c.readFloat():u===6?a.r=c.readFloat():u===7?a.fx=c.readFloat():u===8?a.fy=c.readFloat():u===9&&(a.fr=c.readFloat())}function ome(u,a,c){u===1?a.transform=BC(c,c.readVarint()+c.pos):u===2?a.clip_path_idx=c.readVarint():u===3&&a.children.push(zC(c,c.readVarint()+c.pos))}function lme(u,a,c){u===1?a.left=a.top=c.readFloat():u===2?a.width=a.height=c.readFloat():u===3?a.top=c.readFloat():u===4?a.height=c.readFloat():u===5?a.mask_type=c.readVarint():u===6?a.mask_idx=c.readVarint():u===7&&a.children.push(zC(c,c.readVarint()+c.pos))}class cme{static calculate(a={},c=[]){const p=new Map,g=new Map;if(Object.keys(a).length===0)return p;c.forEach(x=>{g.set(x.name,x.rgb_color||new hi(0,0,0))});for(const[x,w]of Object.entries(a))g.has(x)?p.set(g.get(x).toString(),w):console.warn(`Ignoring unknown image variable "${x}"`);return p}}function Tx(u,a=255,c){const p=a/255,g=u.toString(),x=c.has(g)?c.get(g).clone():u.clone();return x.a*=p,x.toString()}function TS(u,a){if(!jl()){const c=document.createElement("canvas");return c.width=u,c.height=a,c}return new OffscreenCanvas(u,a)}function ume(u,a){const c=cme.calculate(a.params,u.metadata?u.metadata.variables:[]),p=u.usvg_tree,g=p.width,x=p.height,w=a.transform?a.transform:new DOMMatrix,C=Math.max(1,Math.round(g*w.a)),N=Math.max(1,Math.round(x*w.d)),D=new DOMMatrix([C/g,0,0,N/x,0,0]),U=TS(C,N).getContext("2d");return BM(U,D,p,p,c),U.getImageData(0,0,C,N)}function BM(u,a,c,p,g){for(const x of p.children)O8(u,a,c,x,g)}function O8(u,a,c,p,g){p.group?(u.save(),function(x,w,C,N,D){const U=N.mask_idx!=null?C.masks[N.mask_idx]:null,q=N.clip_path_idx!=null?C.clip_paths[N.clip_path_idx]:null;if(N.transform&&(w=Ax(N.transform).preMultiplySelf(w)),!function(J,oe,ce){return J.opacity!==255||oe||ce}(N,q!=null,U!=null))return void BM(x,w,C,N,D);const H=TS(x.canvas.width,x.canvas.height),Y=H.getContext("2d");BM(Y,w,C,N,D),q&&L8(Y,w,C,q),U&&F8(Y,w,C,U,D),x.globalAlpha=N.opacity/255,x.drawImage(H,0,0)}(u,a,c,p.group,g),u.restore()):p.path&&(u.save(),function(x,w,C,N,D){x.setTransform(w),N.paint_order===Hpe.PAINT_ORDER_FILL_AND_STROKE?(k8(x,C,N,D),I8(x,C,N,D)):(I8(x,C,N,D),k8(x,C,N,D))}(u,a,c,p.path,g),u.restore())}function k8(u,a,c,p){const g=c.fill;if(!g)return;const x=g.opacity/255;switch(u.save(),u.beginPath(),z8(c,u),g.paint){case"rgb_color":u.fillStyle=Tx(g.rgb_color,g.opacity,p);break;case"linear_gradient_idx":{const w=a.linear_gradients[g.linear_gradient_idx];w.transform&&u.setTransform(Ax(w.transform).preMultiplySelf(u.getTransform())),u.fillStyle=R8(u,w,x,p);break}case"radial_gradient_idx":{const w=a.radial_gradients[g.radial_gradient_idx];w.transform&&u.setTransform(Ax(w.transform).preMultiplySelf(u.getTransform())),u.fillStyle=M8(u,w,x,p)}}u.fill(N8(c)),u.restore()}function N8(u){return u.rule===FM.PATH_RULE_NON_ZERO?"nonzero":u.rule===FM.PATH_RULE_EVEN_ODD?"evenodd":void 0}function I8(u,a,c,p){const g=c.stroke;if(!g)return;const x=B8(c);u.lineWidth=g.width,u.miterLimit=g.miterlimit,u.setLineDash(g.dasharray),u.lineDashOffset=g.dashoffset;const w=g.opacity/255;switch(g.paint){case"rgb_color":u.strokeStyle=Tx(g.rgb_color,g.opacity,p);break;case"linear_gradient_idx":u.strokeStyle=R8(u,a.linear_gradients[g.linear_gradient_idx],w,p,!0);break;case"radial_gradient_idx":u.strokeStyle=M8(u,a.radial_gradients[g.radial_gradient_idx],w,p,!0)}switch(g.linejoin){case FC.LINE_JOIN_MITER_CLIP:case FC.LINE_JOIN_MITER:u.lineJoin="miter";break;case FC.LINE_JOIN_ROUND:u.lineJoin="round";break;case FC.LINE_JOIN_BEVEL:u.lineJoin="bevel"}switch(g.linecap){case zM.LINE_CAP_BUTT:u.lineCap="butt";break;case zM.LINE_CAP_ROUND:u.lineCap="round";break;case zM.LINE_CAP_SQUARE:u.lineCap="square"}u.stroke(x)}function R8(u,a,c,p,g=!1){if(a.stops.length===1){const H=a.stops[0];return Tx(H.rgb_color,H.opacity*c,p)}const{x1:x,y1:w,x2:C,y2:N}=a;let D=new DOMPoint(x,w),U=new DOMPoint(C,N);if(g){const H=Ax(a.transform);D=H.transformPoint(D),U=H.transformPoint(U)}const q=u.createLinearGradient(D.x,D.y,U.x,U.y);for(const H of a.stops)q.addColorStop(H.offset,Tx(H.rgb_color,H.opacity*c,p));return q}function M8(u,a,c,p,g=!1){if(a.stops.length===1){const he=a.stops[0];return Tx(he.rgb_color,he.opacity*c,p)}const x=Ax(a.transform),{fx:w,fy:C,fr:N,cx:D,cy:U,r:q}=a;let H=new DOMPoint(w,C),Y=new DOMPoint(D,U),J=N,oe=q;if(g){H=x.transformPoint(H),Y=x.transformPoint(Y);const he=(x.a+x.d)/2;J=N*he,oe=a.r*he}const ce=u.createRadialGradient(H.x,H.y,J,Y.x,Y.y,oe);for(const he of a.stops)ce.addColorStop(he.offset,Tx(he.rgb_color,he.opacity*c,p));return ce}function D8(u,a,c,p){const g=p.transform?Ax(p.transform).preMultiplySelf(a):a,x=TS(u.canvas.width,u.canvas.height),w=x.getContext("2d");for(const N of p.children)if(N.group)D8(w,g,c,N.group);else if(N.path){const D=N.path,U=new Path2D;U.addPath(B8(D),g),w.fill(U,N8(D))}const C=p.clip_path_idx!=null?c.clip_paths[p.clip_path_idx]:null;C&&L8(w,g,c,C),u.globalCompositeOperation="source-over",u.drawImage(x,0,0)}function L8(u,a,c,p){const g=TS(u.canvas.width,u.canvas.height);D8(g.getContext("2d"),a,c,p),u.globalCompositeOperation="destination-in",u.drawImage(g,0,0)}function F8(u,a,c,p,g){if(p.children.length===0)return;const x=p.mask_idx!=null?c.masks[p.mask_idx]:null;x&&F8(u,a,c,x,g);const w=u.canvas.width,C=u.canvas.height,N=TS(w,C),D=N.getContext("2d"),U=p.width,q=p.height,H=p.left,Y=p.top,J=new Path2D,oe=new Path2D;oe.rect(H,Y,U,q),J.addPath(oe,a),D.clip(J);for(const Se of p.children)O8(D,a,c,Se,g);const ce=D.getImageData(0,0,w,C),he=ce.data;if(p.mask_type===A8.MASK_TYPE_LUMINANCE)for(let Se=0;Se<he.length;Se+=4)he[Se+3]=he[Se+3]/255*(.2126*he[Se]+.7152*he[Se+1]+.0722*he[Se+2]);D.putImageData(ce,0,0),u.globalCompositeOperation="destination-in",u.drawImage(N,0,0)}function Ax(u){return u?new DOMMatrix([u.sx,u.ky,u.kx,u.sy,u.tx,u.ty]):new DOMMatrix}function z8(u,a){const c=u.step;let p=u.diffs[0]*c,g=u.diffs[1]*c;a.moveTo(p,g);for(let x=0,w=2;x<u.commands.length;x++)switch(u.commands[x]){case ES.PATH_COMMAND_MOVE:p+=u.diffs[w++]*c,g+=u.diffs[w++]*c,a.moveTo(p,g);break;case ES.PATH_COMMAND_LINE:p+=u.diffs[w++]*c,g+=u.diffs[w++]*c,a.lineTo(p,g);break;case ES.PATH_COMMAND_QUAD:{const C=p+u.diffs[w++]*c,N=g+u.diffs[w++]*c;p=C+u.diffs[w++]*c,g=N+u.diffs[w++]*c,a.quadraticCurveTo(C,N,p,g);break}case ES.PATH_COMMAND_CUBIC:{const C=p+u.diffs[w++]*c,N=g+u.diffs[w++]*c,D=C+u.diffs[w++]*c,U=N+u.diffs[w++]*c;p=D+u.diffs[w++]*c,g=U+u.diffs[w++]*c,a.bezierCurveTo(C,N,D,U,p,g);break}case ES.PATH_COMMAND_CLOSE:a.closePath()}return a}function B8(u){return z8(u,new Path2D)}class UC{constructor(a){this.capacity=a,this.cache=new Map}get(a){if(!this.cache.has(a))return;const c=this.cache.get(a);return this.cache.delete(a),this.cache.set(a,c),c}put(a,c){this.cache.has(a)?this.cache.delete(a):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(a,c)}delete(a){this.cache.delete(a)}}_r(UC,"LRUCache");class $M{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(a){return new So(a,a.data)}getFromCache(a,c,p){return this.cacheMap.has(p)||this.cacheMap.set(p,new UC(150)),this.cacheMap.get(p).get(xf(a.toString(),c))}setInCache(a,c,p,g){this.cacheDependenciesMap.has(g)||this.cacheDependenciesMap.set(g,new Map),this.cacheMap.has(g)||this.cacheMap.set(g,new UC(150));const x=this.cacheDependenciesMap.get(g),w=xf(a.id.toString(),p);x.get(w)||x.set(w,new Set);const C=this.cacheMap.get(g),N=a.toString();x.get(w).add(N),C.put(xf(a.toString(),p),c)}removeImagesFromCacheByIds(a,c,p=0){if(!this.cacheMap.has(p)||!this.cacheDependenciesMap.has(p))return;const g=this.cacheMap.get(p),x=this.cacheDependenciesMap.get(p);for(const w of a){const C=xf(w.toString(),c);if(x.has(C)){for(const N of x.get(C))g.delete(N);x.delete(C)}}}rasterize(a,c,p,g,x=ume){const w=this.getFromCache(a,p,g);if(w)return w.clone();const C=x(c.icon,a.options),N=$M._getImage(C);return this.setInCache(a,N,p,g),N.clone()}}class $8{constructor(a){this.size=a,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(a,c){const p=this.toIdx(a,c);return{min:this.minimums[p],max:this.maximums[p]}}isLeaf(a,c){return this.leaves[this.toIdx(a,c)]}toIdx(a,c){return c*this.size+a}}function U8(u,a,c,p){let g=0,x=Number.MAX_VALUE;for(let w=0;w<3;w++)if(Math.abs(p[w])<1e-15){if(c[w]<u[w]||c[w]>a[w])return null}else{const C=1/p[w];let N=(u[w]-c[w])*C,D=(a[w]-c[w])*C;if(N>D){const U=N;N=D,D=U}if(N>g&&(g=N),D<x&&(x=D),g>x)return null}return g}function V8(u,a,c,p,g,x,w,C,N,D,U){const q=p-u,H=g-a,Y=x-c,J=w-u,oe=C-a,ce=N-c,he=U[1]*ce-U[2]*oe,Se=U[2]*J-U[0]*ce,Te=U[0]*oe-U[1]*J,ke=q*he+H*Se+Y*Te;if(Math.abs(ke)<1e-15)return null;const qe=1/ke,Fe=D[0]-u,Xe=D[1]-a,et=D[2]-c,it=(Fe*he+Xe*Se+et*Te)*qe;if(it<0||it>1)return null;const At=Xe*Y-et*H,pt=et*q-Fe*Y,jt=Fe*H-Xe*q,Rt=(U[0]*At+U[1]*pt+U[2]*jt)*qe;return Rt<0||it+Rt>1?null:(J*At+oe*pt+ce*jt)*qe}function q8(u,a,c){return(u-a)/(c-a)}function H8(u,a,c,p,g,x,w,C,N){const D=1<<c,U=x-p,q=w-g,H=(u+1)/D*U+p,Y=(a+0)/D*q+g,J=(a+1)/D*q+g;C[0]=(u+0)/D*U+p,C[1]=Y,N[0]=H,N[1]=J}class G8{constructor(a){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=a,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const c=function(x){const w=Math.ceil(Math.log2(x.dim/8)),C=[];let N=Math.ceil(Math.pow(2,w));const D=1/N,U=(Y,J,oe,ce,he)=>{const Se=ce?1:0,Te=(Y+1)*oe-Se,ke=J*oe,qe=(J+1)*oe-Se;he[0]=Y*oe,he[1]=ke,he[2]=Te,he[3]=qe};let q=new $8(N);const H=[];for(let Y=0;Y<N*N;Y++){U(Y%N,Math.floor(Y/N),D,!1,H);const J=om(H[0],H[1],x),oe=om(H[2],H[1],x),ce=om(H[2],H[3],x),he=om(H[0],H[3],x);q.minimums.push(Math.min(J,oe,ce,he)),q.maximums.push(Math.max(J,oe,ce,he)),q.leaves.push(1)}for(C.push(q),N/=2;N>=1;N/=2){const Y=C[C.length-1];q=new $8(N);for(let J=0;J<N*N;J++){U(J%N,Math.floor(J/N),2,!0,H);const oe=Y.getElevation(H[0],H[1]),ce=Y.getElevation(H[2],H[1]),he=Y.getElevation(H[2],H[3]),Se=Y.getElevation(H[0],H[3]),Te=Y.isLeaf(H[0],H[1]),ke=Y.isLeaf(H[2],H[1]),qe=Y.isLeaf(H[2],H[3]),Fe=Y.isLeaf(H[0],H[3]),Xe=Math.min(oe.min,ce.min,he.min,Se.min),et=Math.max(oe.max,ce.max,he.max,Se.max),it=Te&&ke&&qe&&Fe;q.maximums.push(et),q.minimums.push(Xe),q.leaves.push(et-Xe<=5&&it?1:0)}C.push(q)}return C}(this.dem),p=c.length-1,g=c[p];this._addNode(g.minimums[0],g.maximums[0],g.leaves[0]),this._construct(c,0,0,p,0)}raycastRoot(a,c,p,g,x,w,C=1){return U8([a,c,-100],[p,g,this.maximums[0]*C],x,w)}raycast(a,c,p,g,x,w,C=1){if(!this.nodeCount)return null;const N=this.raycastRoot(a,c,p,g,x,w,C);if(N==null)return null;const D=[],U=[],q=[],H=[],Y=[{idx:0,t:N,nodex:0,nodey:0,depth:0}];for(;Y.length>0;){const{idx:J,t:oe,nodex:ce,nodey:he,depth:Se}=Y.pop();if(this.leaves[J]){H8(ce,he,Se,a,c,p,g,q,H);const ke=1<<Se,qe=(ce+0)/ke,Fe=(ce+1)/ke,Xe=(he+0)/ke,et=(he+1)/ke,it=om(qe,Xe,this.dem)*C,At=om(Fe,Xe,this.dem)*C,pt=om(Fe,et,this.dem)*C,jt=om(qe,et,this.dem)*C,Rt=V8(q[0],q[1],it,H[0],q[1],At,H[0],H[1],pt,x,w),zt=V8(H[0],H[1],pt,q[0],H[1],jt,q[0],q[1],it,x,w),Yt=Math.min(Rt!==null?Rt:Number.MAX_VALUE,zt!==null?zt:Number.MAX_VALUE);if(Yt!==Number.MAX_VALUE)return Yt;{const qt=Je([],x,w,oe);if(W8(it,At,jt,pt,q8(qt[0],q[0],H[0]),q8(qt[1],q[1],H[1]))>=qt[2])return oe}continue}let Te=0;for(let ke=0;ke<this._siblingOffset.length;ke++){H8((ce<<1)+this._siblingOffset[ke][0],(he<<1)+this._siblingOffset[ke][1],Se+1,a,c,p,g,q,H),q[2]=-100,H[2]=this.maximums[this.childOffsets[J]+ke]*C;const qe=U8(q,H,x,w);if(qe!=null){const Fe=qe;D[ke]=Fe;let Xe=!1;for(let et=0;et<Te&&!Xe;et++)Fe>=D[U[et]]&&(U.splice(et,0,ke),Xe=!0);Xe||(U[Te]=ke),Te++}}for(let ke=0;ke<Te;ke++){const qe=U[ke];Y.push({idx:this.childOffsets[J]+qe,t:D[qe],nodex:(ce<<1)+this._siblingOffset[qe][0],nodey:(he<<1)+this._siblingOffset[qe][1],depth:Se+1})}}return null}_addNode(a,c,p){return this.minimums.push(a),this.maximums.push(c),this.leaves.push(p),this.childOffsets.push(0),this.nodeCount++}_construct(a,c,p,g,x){if(a[g].isLeaf(c,p)===1)return;this.childOffsets[x]||(this.childOffsets[x]=this.nodeCount);const w=g-1,C=a[w];let N=0,D=0;for(let U=0;U<this._siblingOffset.length;U++){const q=2*c+this._siblingOffset[U][0],H=2*p+this._siblingOffset[U][1],Y=C.getElevation(q,H),J=C.isLeaf(q,H),oe=this._addNode(Y.min,Y.max,J);J&&(N|=1<<U),D||(D=oe)}for(let U=0;U<this._siblingOffset.length;U++)N&1<<U||this._construct(a,2*c+this._siblingOffset[U][0],2*p+this._siblingOffset[U][1],w,D+U)}}function W8(u,a,c,p,g,x){return Kr(Kr(u,c,x),Kr(a,p,x),g)}function om(u,a,c){const p=c.dim,g=ve(u*p-.5,0,p-1),x=ve(a*p-.5,0,p-1),w=Math.floor(g),C=Math.floor(x),N=Math.min(w+1,p-1),D=Math.min(C+1,p-1);return W8(c.get(w,C),c.get(N,C),c.get(w,D),c.get(N,D),g-w,x-C)}const dme={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function hme(u,a,c){return(256*u*256+256*a+c)/10-1e4}function fme(u,a,c){return 256*u+a+c/256-32768}class VC{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(a,c,p,g=!1){if(this.uid=a,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(p&&p!=="mapbox"&&p!=="terrarium")return void zr(`"${p}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=c.height;const x=this.dim=c.height-2,w=new Uint32Array(c.data.buffer);if(this.pixels=new Uint8Array(c.data.buffer),this.floatView=new Float32Array(c.data.buffer),this.borderReady=g,this._modifiedForSources={},!g){for(let N=0;N<x;N++)w[this._idx(-1,N)]=w[this._idx(0,N)],w[this._idx(x,N)]=w[this._idx(x-1,N)],w[this._idx(N,-1)]=w[this._idx(N,0)],w[this._idx(N,x)]=w[this._idx(N,x-1)];w[this._idx(-1,-1)]=w[this._idx(0,0)],w[this._idx(x,-1)]=w[this._idx(x-1,0)],w[this._idx(-1,x)]=w[this._idx(0,x-1)],w[this._idx(x,x)]=w[this._idx(x-1,x-1)]}const C=p==="terrarium"?fme:hme;for(let N=0;N<w.length;++N){const D=4*N;this.floatView[N]=C(this.pixels[D],this.pixels[D+1],this.pixels[D+2])}this._timestamp=Pl.now()}_buildQuadTree(){this._tree=new G8(this)}get(a,c,p=!1){p&&(a=ve(a,-1,this.dim),c=ve(c,-1,this.dim));const g=this._idx(a,c);return this.floatView[g]}set(a,c,p){const g=this._idx(a,c),x=this.floatView[g];return this.floatView[g]=p,p-x}static getUnpackVector(a){return dme[a]}_idx(a,c){if(a<-1||a>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(a+1)}static pack(a,c){const p=[0,0,0,0],g=VC.getUnpackVector(c);let x=Math.floor((a+g[3])/g[2]);return p[2]=x%256,x=Math.floor(x/256),p[1]=x%256,x=Math.floor(x/256),p[0]=x,p}getPixels(){return new BU({width:this.stride,height:this.stride},this.pixels)}backfillBorder(a,c,p){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let g=c*this.dim,x=c*this.dim+this.dim,w=p*this.dim,C=p*this.dim+this.dim;switch(c){case-1:g=x-1;break;case 1:x=g+1}switch(p){case-1:w=C-1;break;case 1:C=w+1}const N=-c*this.dim,D=-p*this.dim;for(let U=w;U<C;U++)for(let q=g;q<x;q++){const H=4*this._idx(q,U),Y=4*this._idx(q+N,U+D);this.pixels[H+0]=a.pixels[Y+0],this.pixels[H+1]=a.pixels[Y+1],this.pixels[H+2]=a.pixels[Y+2],this.pixels[H+3]=a.pixels[Y+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function pme(u,a,c){u===1?a.headerLength=c.readFixed32():u===2?a.x=c.readVarint():u===3?a.y=c.readVarint():u===4?a.z=c.readVarint():u===5&&a.layers.push(function(p,g){return p.readFields(_me,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},g)}(c,c.readVarint()+c.pos))}function mme(u,a,c){u===1?(a.delta_filter=function(p,g){return p.readFields(gme,{blockSize:0},g)}(c,c.readVarint()+c.pos),a.filter="delta_filter"):u===2?(c.readVarint(),a.filter="zigzag_filter"):u===3?(c.readVarint(),a.filter="bitshuffle_filter"):u===4&&(c.readVarint(),a.filter="byteshuffle_filter")}function gme(u,a,c){u===1&&(a.blockSize=c.readVarint())}function yme(u,a,c){u===1?(c.readVarint(),a.codec="gzip_data"):u===2?(c.readVarint(),a.codec="jpeg_image"):u===3?(c.readVarint(),a.codec="webp_image"):u===4&&(c.readVarint(),a.codec="png_image")}function vme(u,a,c){let p=0,g=0;u===1?a.firstByte=c.readFixed64():u===2?a.lastByte=c.readFixed64():u===3?a.filters.push(function(x,w){return x.readFields(mme,{},w)}(c,c.readVarint()+c.pos)):u===4?a.codec=function(x,w){return x.readFields(yme,{},w)}(c,c.readVarint()+c.pos):u===5?g=c.readFloat():u===6?p=c.readFloat():u===7?a.bands.push(c.readString()):u===8?a.offset=c.readDouble():u===9&&(a.scale=c.readDouble()),a.offset===0&&(a.offset=g),a.scale===0&&(a.scale=p)}function _me(u,a,c){u===1?a.version=c.readVarint():u===2?a.name=c.readString():u===3?a.units=c.readString():u===4?a.tileSize=c.readVarint():u===5?a.buffer=c.readVarint():u===6?a.pixelFormat=c.readVarint():u===7&&a.dataIndex.push(function(p,g){return p.readFields(vme,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},g)}(c,c.readVarint()+c.pos))}function xme(u,a,c){if(u===2)(function(p,g,x){p.readFields(bme,x,g)})(c,c.readVarint()+c.pos,a);else if(u===3)throw new Error("Not implemented")}function bme(u,a,c){if(u===1){let p=0;const g=c.readVarint()+c.pos;for(;c.pos<g;)a[p++]=c.readVarint()}}function wme(u,a){if(a.length!==4)throw new Error(`Expected data of dimension 4 but got ${a.length}.`);let c=a[3];for(let p=2;p>=1;p--){const g=p===1?1:0,x=p===2?1:0;for(let w=0;w<a[0];w++){const C=a[1]*w;for(let N=g;N<a[1];N++){const D=a[2]*(N+C);for(let U=x;U<a[2];U++){const q=a[3]*(U+D);for(let H=0;H<a[3];H++){const Y=q+H;u[Y]+=u[Y-c]}}}}c*=a[p]}return u}function Sme(u){for(let a=0,c=u.length;a<c;a++)u[a]=u[a]>>>1^-(1&u[a]);return u}function Eme(u,a){switch(a){case"uint32":return u;case"uint16":for(let c=0;c<u.length;c+=2){const p=u[c],g=u[c+1];u[c]=(240&p)>>4|(61440&p)>>8|(240&g)<<4|61440&g,u[c+1]=15&p|(3840&p)>>4|(15&g)<<8|(3840&g)<<4}return u;case"uint8":for(let c=0;c<u.length;c+=4){const p=u[c],g=u[c+1],x=u[c+2],w=u[c+3];u[c+0]=(192&p)>>6|(192&g)>>4|(192&x)>>2|192&w,u[c+1]=(48&p)>>4|(48&g)>>2|48&x|(48&w)<<2,u[c+2]=(12&p)>>2|12&g|(12&x)<<2|(12&w)<<4,u[c+3]=3&p|(3&g)<<2|(3&x)<<4|(3&w)<<6}return u;default:throw new Error(`Invalid pixel format, "${a}"`)}}_r(VC,"DEMData"),_r(G8,"DemMinMaxQuadTree",{omit:["dem"]});var iu=Uint8Array,AS=Uint16Array,Tme=Int32Array,K8=new iu([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Z8=new iu([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ame=new iu([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),X8=function(u,a){for(var c=new AS(31),p=0;p<31;++p)c[p]=a+=1<<u[p-1];var g=new Tme(c[30]);for(p=1;p<30;++p)for(var x=c[p];x<c[p+1];++x)g[x]=x-c[p]<<5|p;return{b:c,r:g}},Y8=X8(K8,2),J8=Y8.b,Cme=Y8.r;J8[28]=258,Cme[258]=28;for(var jme=X8(Z8,0).b,Q8=new AS(32768),ha=0;ha<32768;++ha){var Cx=(43690&ha)>>1|(21845&ha)<<1;Q8[ha]=((65280&(Cx=(61680&(Cx=(52428&Cx)>>2|(13107&Cx)<<2))>>4|(3855&Cx)<<4))>>8|(255&Cx)<<8)>>1}var CS=function(u,a,c){for(var p=u.length,g=0,x=new AS(a);g<p;++g)u[g]&&++x[u[g]-1];var w,C=new AS(a);for(g=1;g<a;++g)C[g]=C[g-1]+x[g-1]<<1;w=new AS(1<<a);var N=15-a;for(g=0;g<p;++g)if(u[g])for(var D=g<<4|u[g],U=a-u[g],q=C[u[g]-1]++<<U,H=q|(1<<U)-1;q<=H;++q)w[Q8[q]>>N]=D;return w},jS=new iu(288);for(ha=0;ha<144;++ha)jS[ha]=8;for(ha=144;ha<256;++ha)jS[ha]=9;for(ha=256;ha<280;++ha)jS[ha]=7;for(ha=280;ha<288;++ha)jS[ha]=8;var eq=new iu(32);for(ha=0;ha<32;++ha)eq[ha]=5;var Pme=CS(jS,9),Ome=CS(eq,5),UM=function(u){for(var a=u[0],c=1;c<u.length;++c)u[c]>a&&(a=u[c]);return a},wd=function(u,a,c){var p=a/8|0;return(u[p]|u[p+1]<<8)>>(7&a)&c},VM=function(u,a){var c=a/8|0;return(u[c]|u[c+1]<<8|u[c+2]<<16)>>(7&a)},kme=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Sd=function(u,a,c){var p=new Error(a||kme[u]);if(p.code=u,Error.captureStackTrace&&Error.captureStackTrace(p,Sd),!c)throw p;return p},Nme=new iu(0),Ime=typeof TextDecoder<"u"&&new TextDecoder;try{Ime.decode(Nme,{stream:!0})}catch{}const Rme={gzip_data:"gzip"};class Ru extends Error{constructor(a){super(a),this.name="MRTError"}}const Mme={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},tq={uint32:1,uint16:2,uint8:4},Dme={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let qM;class qC{constructor(a=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=a}getLayer(a){const c=this.layers[a];if(!c)throw new Ru(`Layer '${a}' not found`);return c}getHeaderLength(a){const c=new Uint8Array(a),p=new DataView(a);if(c[0]!==13)throw new Ru("File is not a valid MRT.");return p.getUint32(1,!0)}parseHeader(a){const c=new Uint8Array(a),p=this.getHeaderLength(a);if(c.length<p)throw new Ru(`Expected header with length >= ${p} but got buffer of length ${c.length}`);const g=new qM(c.subarray(0,p)).readFields(pme,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==g.x||this.y!==g.y||this.z!==g.z))throw new Ru(`Invalid attempt to parse header ${g.z}/${g.x}/${g.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=g.x,this.y=g.y,this.z=g.z;for(const x of g.layers)this.layers[x.name]=new rq(x,{cacheSize:this._cacheSize});return this}createDecodingTask(a){const c=[],p=this.getLayer(a.layerName);for(let g of a.blockIndices){const x=p.dataIndex[g],w=x.firstByte-a.firstByte,C=x.lastByte-a.firstByte;if(p._blocksInProgress.has(g))continue;const N={layerName:p.name,firstByte:w,lastByte:C,pixelFormat:p.pixelFormat,blockIndex:g,blockShape:[x.bands.length].concat(p.bandShape),buffer:p.buffer,codec:x.codec.codec,filters:x.filters.map(D=>D.filter)};p._blocksInProgress.add(g),c.push(N)}return new nq(c,()=>{c.forEach(g=>p._blocksInProgress.delete(g.blockIndex))},(g,x)=>{if(c.forEach(w=>p._blocksInProgress.delete(w.blockIndex)),g)throw g;x.forEach(w=>{this.getLayer(w.layerName).processDecodedData(w)})})}}class rq{constructor({version:a,name:c,units:p,tileSize:g,pixelFormat:x,buffer:w,dataIndex:C},N){if(this.version=a,this.version!==1)throw new Ru(`Cannot parse raster layer encoded with MRT version ${a}`);this.name=c,this.units=p,this.tileSize=g,this.buffer=w,this.pixelFormat=Mme[x],this.dataIndex=C,this.bandShape=[g+2*w,g+2*w,tq[this.pixelFormat]],this._decodedBlocks=new UC(N?N.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return tq[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:a})=>a).flat()}processDecodedData(a){const c=a.blockIndex.toString();this._decodedBlocks.get(c)||this._decodedBlocks.put(c,a.data)}getBlockForBand(a){let c=0;switch(typeof a){case"string":for(const[p,g]of this.dataIndex.entries()){for(const[x,w]of g.bands.entries())if(w===a)return{bandIndex:c+x,blockIndex:p,blockBandIndex:x};c+=g.bands.length}break;case"number":for(const[p,g]of this.dataIndex.entries()){if(a>=c&&a<c+g.bands.length)return{bandIndex:a,blockIndex:p,blockBandIndex:a-c};c+=g.bands.length}break;default:throw new Ru(`Invalid band \`${JSON.stringify(a)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(a){let c=1/0,p=-1/0;const g=[],x=new Set;for(const w of a){const{blockIndex:C}=this.getBlockForBand(w);if(C<0)throw new Ru(`Invalid band: ${JSON.stringify(w)}`);const N=this.dataIndex[C];g.includes(C)||g.push(C),x.add(C),c=Math.min(c,N.firstByte),p=Math.max(p,N.lastByte)}if(x.size>this.cacheSize)throw new Ru(`Number of blocks to decode (${x.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:c,lastByte:p,blockIndices:g}}hasBand(a){const{blockIndex:c}=this.getBlockForBand(a);return c>=0}hasDataForBand(a){const{blockIndex:c}=this.getBlockForBand(a);return c>=0&&!!this._decodedBlocks.get(c.toString())}getBandView(a){const{blockIndex:c,blockBandIndex:p}=this.getBlockForBand(a);if(c<0)throw new Ru(`Band not found: ${JSON.stringify(a)}`);const g=this._decodedBlocks.get(c.toString());if(!g)throw new Ru(`Data for band ${JSON.stringify(a)} of layer "${this.name}" not decoded.`);const x=this.dataIndex[c],w=this.bandShape.reduce((D,U)=>D*U,1),C=p*w,N=g.subarray(C,C+w);return{data:N,bytes:new Uint8Array(N.buffer).subarray(N.byteOffset,N.byteOffset+N.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:x.offset,scale:x.scale}}}qC.setPbf=function(u){qM=u};class nq{constructor(a,c,p){this.tasks=a,this._onCancel=c,this._onComplete=p,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(a,c){this._finalized||(this._onComplete(a,c),this._finalized=!0)}}qC.performDecoding=function(u,a){const c=new Uint8Array(u);return Promise.all(a.tasks.map(p=>{const{layerName:g,firstByte:x,lastByte:w,pixelFormat:C,blockShape:N,blockIndex:D,filters:U,codec:q}=p,H=c.subarray(x,w+1),Y=new Uint32Array(N[0]*N[1]*N[2]);let J;if(q!=="gzip_data")throw new Ru(`Unhandled codec: ${q}`);return J=function(oe,ce){if(!globalThis.DecompressionStream&&ce==="gzip_data")return Promise.resolve(((ke=function(Xe){Xe[0]==31&&Xe[1]==139&&Xe[2]==8||Sd(6,"invalid gzip data");var et=Xe[3],it=10;4&et&&(it+=2+(Xe[10]|Xe[11]<<8));for(var At=(et>>3&1)+(et>>4&1);At>0;At-=!Xe[it++]);return it+(2&et)}(Te=oe))+8>Te.length&&Sd(6,"invalid gzip data"),function(Xe,et,it,At){var pt=Xe.length;if(!pt||et.f&&!et.l)return it||new iu(0);var jt=!it,Rt=jt||et.i!=2,zt=et.i;jt&&(it=new iu(3*pt));var Yt,qt,Dt=function(_s){var es=it.length;if(_s>es){var Bi=new iu(Math.max(2*es,_s));Bi.set(it),it=Bi}},Vt=et.f||0,St=et.p||0,xt=et.b||0,$t=et.l,Kt=et.d,Ft=et.m,gr=et.n,br=8*pt;do{if(!$t){Vt=wd(Xe,St,1);var hr=wd(Xe,St+1,3);if(St+=3,!hr){var ar=Xe[(ze=4+((St+7)/8|0))-4]|Xe[ze-3]<<8,en=ze+ar;if(en>pt){zt&&Sd(0);break}Rt&&Dt(xt+ar),it.set(Xe.subarray(ze,en),xt),et.b=xt+=ar,et.p=St=8*en,et.f=Vt;continue}if(hr==1)$t=Pme,Kt=Ome,Ft=9,gr=5;else if(hr==2){var lr=wd(Xe,St,31)+257,Lr=wd(Xe,St+10,15)+4,rn=lr+wd(Xe,St+5,31)+1;St+=14;for(var Sn=new iu(rn),qn=new iu(19),on=0;on<Lr;++on)qn[Ame[on]]=wd(Xe,St+3*on,7);St+=3*Lr;var ti=UM(qn),ri=(1<<ti)-1,cs=CS(qn,ti);for(on=0;on<rn;){var ze,Re=cs[wd(Xe,St,ri)];if(St+=15&Re,(ze=Re>>4)<16)Sn[on++]=ze;else{var Ot=0,ir=0;for(ze==16?(ir=3+wd(Xe,St,3),St+=2,Ot=Sn[on-1]):ze==17?(ir=3+wd(Xe,St,7),St+=3):ze==18&&(ir=11+wd(Xe,St,127),St+=7);ir--;)Sn[on++]=Ot}}var kt=Sn.subarray(0,lr),or=Sn.subarray(lr);Ft=UM(kt),gr=UM(or),$t=CS(kt,Ft),Kt=CS(or,gr)}else Sd(1);if(St>br){zt&&Sd(0);break}}Rt&&Dt(xt+131072);for(var jr=(1<<Ft)-1,Tr=(1<<gr)-1,cn=St;;cn=St){var qr=(Ot=$t[VM(Xe,St)&jr])>>4;if((St+=15&Ot)>br){zt&&Sd(0);break}if(Ot||Sd(2),qr<256)it[xt++]=qr;else{if(qr==256){cn=St,$t=null;break}var Sr=qr-254;qr>264&&(Sr=wd(Xe,St,(1<<(Wr=K8[on=qr-257]))-1)+J8[on],St+=Wr);var Jn=Kt[VM(Xe,St)&Tr],Ai=Jn>>4;if(Jn||Sd(3),St+=15&Jn,or=jme[Ai],Ai>3){var Wr=Z8[Ai];or+=VM(Xe,St)&(1<<Wr)-1,St+=Wr}if(St>br){zt&&Sd(0);break}Rt&&Dt(xt+131072);var Bn=xt+Sr;if(xt<or){var Ci=0-or,fi=Math.min(or,Bn);for(Ci+xt<0&&Sd(3);xt<fi;++xt)it[xt]=(void 0)[Ci+xt]}for(;xt<Bn;++xt)it[xt]=it[xt-or]}}et.l=$t,et.p=cn,et.b=xt,et.f=Vt,$t&&(Vt=1,et.m=Ft,et.d=Kt,et.n=gr)}while(!Vt);return xt!=it.length&&jt?(Yt=it,((qt=xt)==null||qt>Yt.length)&&(qt=Yt.length),new iu(Yt.subarray(0,qt))):it.subarray(0,xt)}(Te.subarray(ke,-8),{i:2},new iu(((he=Te)[(Se=he.length)-4]|he[Se-3]<<8|he[Se-2]<<16|he[Se-1]<<24)>>>0))));var he,Se,Te,ke;const qe=Rme[ce];if(!qe)throw new Error(`Unhandled codec: ${ce}`);const Fe=new globalThis.DecompressionStream(qe);return new Response(new Blob([oe]).stream().pipeThrough(Fe)).arrayBuffer().then(Xe=>new Uint8Array(Xe))}(H,q).then(oe=>(function(ce,he){ce.readFields(xme,he)}(new qM(oe),Y),new Dme[C](Y.buffer))),J.then(oe=>{for(let ce=U.length-1;ce>=0;ce--)switch(U[ce]){case"delta_filter":wme(oe,N);break;case"zigzag_filter":Sme(oe);break;case"bitshuffle_filter":Eme(oe,C);break;default:throw new Ru(`Unhandled filter "${U[ce]}"`)}return{layerName:g,blockIndex:D,data:oe}}).catch(oe=>{throw oe})}))},_r(nq,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),_r(qC,"MapboxRasterTile"),_r(rq,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class iq{constructor(a){this._stringToNumber={},this._numberToString=[];for(let c=0;c<a.length;c++){const p=a[c];this._stringToNumber[p]=c,this._numberToString[c]=p}}encode(a){return this._stringToNumber[a]}decode(a){return this._numberToString[a]}}class sq{constructor(a,c){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new vf(tr,16,0),this.featureIndexArray=new UA,this.promoteId=c,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(a,c,p,g,x,w=0,C=0){const N=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,g,x,w);const D=this.grid;for(let U=0;U<c.length;U++){const q=c[U],H=[1/0,1/0,-1/0,-1/0];for(let Y=0;Y<q.length;Y++){const J=q[Y];H[0]=Math.min(H[0],J.x),H[1]=Math.min(H[1],J.y),H[2]=Math.max(H[2],J.x),H[3]=Math.max(H[3],J.y)}C!==0&&(H[0]-=C,H[1]-=C,H[2]+=C,H[3]+=C),H[0]<tr&&H[1]<tr&&H[2]>=0&&H[3]>=0&&D.insert(N,H[0],H[1],H[2],H[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new wr(new xC(this.rawTileData)).layers,this.sourceLayerCoder=new iq(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const a in this.vtLayers)this.vtFeatures[a]=[]}return this.vtLayers}query(a,c){const{tilespaceGeometry:p,transform:g,tileTransform:x,pixelPosMatrix:w,availableImages:C,worldview:N}=c;this.loadVTLayers(),this.serializedLayersCache.clear();const D=c.queryRadius?c.queryRadius:0,U=p.bufferedTilespaceBounds,q=this.grid.query(U.min.x,U.min.y,U.max.x,U.max.y,(oe,ce,he,Se)=>ys(p.bufferedTilespaceGeometry,oe-D,ce-D,he+D,Se+D));q.sort(Lme);let H=null;g.elevation&&q.length>0&&(H=Ex.create(g.elevation,this.tileID));const Y={};let J;for(let oe=0;oe<q.length;oe++){const ce=q[oe];if(ce===J)continue;J=ce;const he=this.featureIndexArray.get(ce);let Se=null;this.is3DTile?this.loadMatchingModelFeature(Y,he,a,p,g,N):this.loadMatchingFeature(Y,he,a,C,N,(Te,ke,qe,Fe=0)=>(Se||(Se=It(Te,this.tileID.canonical,x)),ke.queryIntersectsFeature(p,Te,qe,Se,this.z,g,w,H,Fe)))}return Y}loadMatchingFeature(a,c,p,g,x,w){const{featureIndex:C,bucketIndex:N,sourceLayerIndex:D,layoutVertexArrayOffset:U}=c,q=this.bucketLayerIDs[N],H=p.layers,Y=Object.keys(H);if(Y.length&&!Jr(Y,q))return;const J=p.sourceCache,oe=this.sourceLayerCoder.decode(D),ce=this.vtLayers[oe].feature(C),he=this.getId(ce,oe);for(let Se=0;Se<q.length;Se++){const Te=q[Se];if(!H[Te])continue;const{styleLayer:ke,targets:qe}=H[Te];let Fe={};he!==void 0&&(Fe=J.getFeatureState(ke.sourceLayer,he));const Xe=!w||w(ce,ke,Fe,U);if(!Xe)continue;const et=new Cy(ce,this.z,this.x,this.y,he);et.tile=this.tileID.canonical,et.state=Fe;let it=this.serializedLayersCache.get(Te);it||(it=ke.serialize(),it.id=Te,this.serializedLayersCache.set(Te,it)),et.source=it.source,et.sourceLayer=it["source-layer"],et.layer=Object.assign({},it),et.layer.paint=aq(it.paint,ke.paint,ce,Fe,g),et.layer.layout=aq(it.layout,ke.layout,ce,Fe,g);let At=!1;for(const pt of qe){this.updateFeatureProperties(et,pt);const{filter:jt}=pt;if(jt){if(ce.properties=et.properties,jt.needGeometry){const Rt=vt(ce,!0);if(!jt.filter(new Vi(this.tileID.overscaledZ,{worldview:x}),Rt,this.tileID.canonical))continue}else if(!jt.filter(new Vi(this.tileID.overscaledZ,{worldview:x}),ce))continue}At=!0,pt.targetId&&this.addFeatureVariant(et,pt)}At&&this.appendToResult(a,Te,C,et,Xe)}}loadMatchingModelFeature(a,c,p,g,x,w){const{featureIndex:C,bucketIndex:N}=c,D=this.bucketLayerIDs[N],U=p.layers,q=Object.keys(U);if(!q.length||Jr(q,D))for(let H=0;H<D.length;H++){const Y=D[H],{styleLayer:J,targets:oe}=U[Y];if(J.type!=="model")continue;const ce=g.tile,he=ce.getBucket(J);if(!(he&&he instanceof LC))continue;const Se=Vpe(he,C,g,x);if(!Se)continue;const{z:Te,x:ke,y:qe}=ce.tileID.canonical,{feature:Fe,intersectionZ:Xe,position:et}=Se;let it={};Fe.id!==void 0&&(it=p.sourceCache.getFeatureState(J.sourceLayer,Fe.id));const At=new Cy({},Te,ke,qe,Fe.id);At.tile=this.tileID.canonical,At.state=it,At.properties=Fe.properties,At.geometry={type:"Point",coordinates:[et.lng,et.lat]};let pt=this.serializedLayersCache.get(Y);pt||(pt=J.serialize(),pt.id=Y,this.serializedLayersCache.set(Y,pt)),At.source=pt.source,At.sourceLayer=pt["source-layer"],At.layer=Object.assign({},pt);let jt=!1;for(const Rt of oe){this.updateFeatureProperties(At,Rt);const{filter:zt}=Rt;if(zt){if(Fe.properties=At.properties,zt.needGeometry){if(!zt.filter(new Vi(this.tileID.overscaledZ,{worldview:w}),Fe,this.tileID.canonical))continue}else if(!zt.filter(new Vi(this.tileID.overscaledZ,{worldview:w}),Fe))continue}jt=!0,Rt.targetId&&this.addFeatureVariant(At,Rt)}jt&&this.appendToResult(a,Y,C,At,Xe)}}updateFeatureProperties(a,c,p){if(c.properties){const g={};for(const x in c.properties){const w=c.properties[x].evaluate({zoom:this.z},a._vectorTileFeature,a.state,a.tile,p);w!=null&&(g[x]=w)}a.properties=g}}addFeatureVariant(a,c,p){const g={target:c.target,namespace:c.namespace,uniqueFeatureID:c.uniqueFeatureID};c.properties&&(g.properties=a.properties),a.variants=a.variants||{},a.variants[c.targetId]=a.variants[c.targetId]||[],a.variants[c.targetId].push(g)}appendToResult(a,c,p,g,x){let w=a[c];w===void 0&&(w=a[c]=[]),w.push({featureIndex:p,feature:g,intersectionZ:x})}lookupSymbolFeatures(a,c,p,g,x,w){const C={};this.loadVTLayers();for(const N of a)this.loadMatchingFeature(C,{bucketIndex:c,sourceLayerIndex:p,featureIndex:N,layoutVertexArrayOffset:0},g,x,w);return C}loadFeature(a){const{featureIndex:c,sourceLayerIndex:p}=a;this.loadVTLayers();const g=this.sourceLayerCoder.decode(p),x=this.vtFeatures[g];if(x[c])return x[c];const w=this.vtLayers[g].feature(c);return x[c]=w,w}hasLayer(a){for(const c of this.bucketLayerIDs)for(const p of c)if(a===p)return!0;return!1}getId(a,c){let p=a.id;if(this.promoteId){const g=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[c];if(g!=null)if(Array.isArray(g)){if(!this.promoteIdExpression){const x=ku(g);if(x.result!=="success"){const w=x.value.map(C=>`${C.key}: ${C.message}`).join(", ");return void zr(`Failed to create expression for promoteId: ${w}`)}this.promoteIdExpression=x.value}p=this.promoteIdExpression.evaluate({zoom:0},a)}else p=a.properties[g];typeof p=="boolean"&&(p=Number(p))}return p}}function aq(u,a,c,p,g){return Zt(u,(x,w)=>{const C=a instanceof _f?a.get(w):null;return C&&C.evaluate?C.evaluate(c,p,void 0,g):C})}function Lme(u,a){return a-u}_r(sq,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const oq=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class HM{static from(a){if(!(a instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,p]=new Uint8Array(a,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=p>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const x=oq[15&p];if(!x)throw new Error("Unrecognized array type.");const[w]=new Uint16Array(a,2,1),[C]=new Uint32Array(a,4,1);return new HM(C,w,x,a)}constructor(a,c=64,p=Float64Array,g){if(isNaN(a)||a<0)throw new Error(`Unpexpected numItems value: ${a}.`);this.numItems=+a,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=p,this.IndexArrayType=a<65536?Uint16Array:Uint32Array;const x=oq.indexOf(this.ArrayType),w=2*a*this.ArrayType.BYTES_PER_ELEMENT,C=a*this.IndexArrayType.BYTES_PER_ELEMENT,N=(8-C%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${p}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+C+N,2*a),this._pos=2*a,this._finished=!0):(this.data=new ArrayBuffer(8+w+C+N),this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+C+N,2*a),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=a)}add(a,c){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=a,this.coords[this._pos++]=c,p}finish(){const a=this._pos>>1;if(a!==this.numItems)throw new Error(`Added ${a} items when expected ${this.numItems}.`);return GM(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(a,c,p,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:w,nodeSize:C}=this,N=[0,x.length-1,0],D=[];for(;N.length;){const U=N.pop()||0,q=N.pop()||0,H=N.pop()||0;if(q-H<=C){for(let ce=H;ce<=q;ce++){const he=w[2*ce],Se=w[2*ce+1];he>=a&&he<=p&&Se>=c&&Se<=g&&D.push(x[ce])}continue}const Y=H+q>>1,J=w[2*Y],oe=w[2*Y+1];J>=a&&J<=p&&oe>=c&&oe<=g&&D.push(x[Y]),(U===0?a<=J:c<=oe)&&(N.push(H),N.push(Y-1),N.push(1-U)),(U===0?p>=J:g>=oe)&&(N.push(Y+1),N.push(q),N.push(1-U))}return D}within(a,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:x,nodeSize:w}=this,C=[0,g.length-1,0],N=[],D=p*p;for(;C.length;){const U=C.pop()||0,q=C.pop()||0,H=C.pop()||0;if(q-H<=w){for(let ce=H;ce<=q;ce++)cq(x[2*ce],x[2*ce+1],a,c)<=D&&N.push(g[ce]);continue}const Y=H+q>>1,J=x[2*Y],oe=x[2*Y+1];cq(J,oe,a,c)<=D&&N.push(g[Y]),(U===0?a-p<=J:c-p<=oe)&&(C.push(H),C.push(Y-1),C.push(1-U)),(U===0?a+p>=J:c+p>=oe)&&(C.push(Y+1),C.push(q),C.push(1-U))}return N}}function GM(u,a,c,p,g,x){if(g-p<=c)return;const w=p+g>>1;lq(u,a,w,p,g,x),GM(u,a,c,p,w-1,1-x),GM(u,a,c,w+1,g,1-x)}function lq(u,a,c,p,g,x){for(;g>p;){if(g-p>600){const D=g-p+1,U=c-p+1,q=Math.log(D),H=.5*Math.exp(2*q/3),Y=.5*Math.sqrt(q*H*(D-H)/D)*(U-D/2<0?-1:1);lq(u,a,c,Math.max(p,Math.floor(c-U*H/D+Y)),Math.min(g,Math.floor(c+(D-U)*H/D+Y)),x)}const w=a[2*c+x];let C=p,N=g;for(PS(u,a,p,c),a[2*g+x]>w&&PS(u,a,p,g);C<N;){for(PS(u,a,C,N),C++,N--;a[2*C+x]<w;)C++;for(;a[2*N+x]>w;)N--}a[2*p+x]===w?PS(u,a,p,N):(N++,PS(u,a,N,g)),N<=c&&(p=N+1),c<=N&&(g=N-1)}}function PS(u,a,c,p){WM(u,c,p),WM(a,2*c,2*p),WM(a,2*c+1,2*p+1)}function WM(u,a,c){const p=u[a];u[a]=u[c],u[c]=p}function cq(u,a,c,p){const g=u-c,x=a-p;return g*g+x*x}i.$=d_,i.A=cd,i.B=xf,i.C=2,i.D=dx,i.E=od,i.F=dS,i.G=M6,i.H=u_,i.I=da,i.J=w1,i.K=Ep,i.L=Zg,i.M=M_,i.N=R_,i.O=c1,i.P=st,i.Q=z_,i.R=of,i.S=Up,i.T=nM,i.U=ku,i.V=DC,i.W=d1,i.X=Np,i.Y=kp,i.Z=ty,i._=Bo,i.a=function(u){return Ji.API_CDN_URL_REGEX.test(u)},i.a$=Gp,i.a0=Xr,i.a1=Mw,i.a2=Vp,i.a3=class extends DC{},i.a4=D_,i.a5=l1,i.a6=ft,i.a7=function(u){const a=u.value;return a?Xr(a)?IM(a,!0)?[]:[new DC(u.key,a,`invalid url "${a}"`)]:[new DC(u.key,a,`string expected, "${Ep(a)}" found`)]:[]},i.a8=kA,i.a9=ws,i.aA=ve,i.aB=M,i.aC=Qt,i.aD=vl,i.aE=Ra,i.aF=xe,i.aG=Et,i.aH=function(u,a){const c={};for(let p=0;p<a.length;p++){const g=a[p];g in u&&(c[g]=u[g])}return c},i.aI=X,i.aJ=ye,i.aK=class{constructor(u){this.entries={},this.scheduler=u}request(u,a,c,p){const g=this.entries[u]=this.entries[u]||{callbacks:[]};if(g.result){const[x,w]=g.result;return this.scheduler?this.scheduler.add(()=>{p(x,w)},a):p(x,w),()=>{}}return g.callbacks.push(p),g.cancel||(g.cancel=c((x,w)=>{g.result=[x,w];for(const C of g.callbacks)this.scheduler?this.scheduler.add(()=>{C(x,w)},a):C(x,w);setTimeout(()=>delete this.entries[u],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(x=>x!==p),g.callbacks.length||(g.cancel(),delete this.entries[u]))}}},i.aL=function(u,a,c){const p=JSON.stringify(u.request);return u.data&&(this.deduped.entries[p]={result:[null,u.data]}),this.deduped.request(p,{type:"parseTile",isSymbolTile:u.isSymbolTile,zoom:u.tileZoom},g=>{const x=_p(u.request,(w,C,N)=>{w?g(w):C&&g(null,{vectorTile:c?void 0:new wr(new xC(C)),rawData:C,responseHeaders:new Map(N.entries())})});return()=>{x.cancel(),g()}},a)},i.aM=function(u){return u?{cacheControl:u.get("Cache-Control"),expires:u.get("Expires")}:{cacheControl:void 0,expires:void 0}},i.aN=function(u){s_++,s_>ml&&(u.getActor().send("enforceCacheSizeLimit",Ig),s_=0)},i.aO=function(u){return u<=1?1:Math.pow(2,Math.floor(Math.log2(u)))},i.aP=Sa,i.aQ=u8,i.aR=g8,i.aS=Q,i.aT=c8,i.aU=function(u,a){const c=document.createElement("video");c.muted=!0,c.onloadstart=function(){a(null,c)};for(let p=0;p<u.length;p++){const g=document.createElement("source");si(u[p])||(c.crossOrigin="Anonymous"),g.src=u[p],c.appendChild(g)}return{cancel:()=>{}}},i.aV=aS,i.aW=jy,i.aX=_t,i.aY=mS,i.aZ=Ne,i.a_=je,i.aa=Gt,i.ab=class{constructor(u){this.specification=u}possiblyEvaluate(u,a){return Si(u.expression.evaluate(a))}interpolate(u,a,c){return{x:Kr(u.x,a.x,c),y:Kr(u.y,a.y,c),z:Kr(u.z,a.z,c),azimuthal:Kr(u.azimuthal,a.azimuthal,c),polar:Kr(u.polar,a.polar,c)}}},i.ac=Vi,i.ad=sh,i.ae=dt,i.af=Ht,i.ag=be,i.ah=De,i.ai=_f,i.aj=rm,i.ak=Kr,i.al=tr,i.am=Vg,i.an=_n,i.ao=hi,i.ap=class{constructor(u){this.specification=u}possiblyEvaluate(u,a){return function([c,p]){const g=Si([1,c,p]);return{x:g.x,y:g.y,z:g.z}}(u.expression.evaluate(a))}interpolate(u,a,c){return{x:Kr(u.x,a.x,c),y:Kr(u.y,a.y,c),z:Kr(u.z,a.z,c)}}},i.aq=function(u,a,c=0,p=!0){const g=new st(c,c),x=u.sub(g),w=a.add(g),C=[x,new st(w.x,x.y),w,new st(x.x,w.y)];return p&&C.push(x.clone()),C},i.ar=function(u,a){const c=[];for(let p=0;p<u.length;p++){const g=Qe(p-1,-1,u.length-1),x=Qe(p+1,-1,u.length-1),w=u[p],C=u[x],N=u[g].sub(w).unit(),D=C.sub(w).unit(),U=D.angleWithSep(N.x,N.y),q=N.add(D).unit().mult(-1*a/Math.sin(U/2));c.push(w.add(q))}return c},i.as=K6,i.at=ys,i.au=function(u,a,c=0){return we(((a.x-c)*u.scale-u.x)*tr,(a.y*u.scale-u.y)*tr,Ve(a.z,a.y))},i.av=Pt,i.aw=Me,i.ax=hn,i.ay=l6,i.az=function(u){let a=1/0,c=1/0,p=-1/0,g=-1/0;for(const x of u)a=Math.min(a,x.x),c=Math.min(c,x.y),p=Math.max(p,x.x),g=Math.max(g,x.y);return{min:new st(a,c),max:new st(p,g)}},i.b=function(u){return Ji.API_FONTS_REGEX.test(u)},i.b$=HR,i.b0=is,i.b1=bt,i.b2=zA,i.b3=NC,i.b4=function(){Nl.isLoading()||Nl.isLoaded()||_1()!=="deferred"||x1()},i.b5=H_,i.b6=vt,i.b7=Cy,i.b8=Xs,i.b9=dM,i.bA=K,i.bB=O,i.bC=function(u,a){const{x:c,y:p}=u.point,g=CU(c,p,u.worldSize/u._pixelsPerMercatorPixel,0,0);return M(g,g,NR(hh(a)))},i.bD=S,i.bE=Rr,i.bF=Ze,i.bG=Je,i.bH=gt,i.bI=We,i.bJ=_x,i.bK=tc,i.bL=_M,i.bM=function(u,a,c,p,g){const x=5*a+2;u.float32[x+0]=c,u.float32[x+1]=p,u.float32[x+2]=g},i.bN=Sx,i.bO=Ua,i.bP=Ha,i.bQ=Lo,i.bR=Ln,i.bS=Qe,i.bT=function(u,a,c,p){var g=new y(4);return g[0]=u,g[1]=a,g[2]=c,g[3]=p,g},i.bU=class{isDataAvailableAtPoint(u){const a=this._source();if(this.isUsingMockSource()||!a||u.y<0||u.y>1)return!1;const c=a.getSource().maxzoom,p=1<<c,g=Math.floor(u.x),x=Math.floor((u.x-g)*p),w=Math.floor(u.y*p),C=this.findDEMTileFor(new Sa(c,g,c,x,w));return!(!C||!C.dem)}getAtPointOrZero(u,a=0){return this.getAtPoint(u,a)||0}getAtPoint(u,a,c=!0){if(this.isUsingMockSource())return null;a==null&&(a=null);const p=this._source();if(!p||u.y<0||u.y>1)return a;const g=p.getSource().maxzoom,x=1<<g,w=Math.floor(u.x),C=u.x-w,N=new Sa(g,w,g,Math.floor(C*x),Math.floor(u.y*x)),D=this.findDEMTileFor(N);if(!D||!D.dem)return a;const U=D.dem,q=1<<D.tileID.canonical.z,H=(C*q-D.tileID.canonical.x)*U.dim,Y=(u.y*q-D.tileID.canonical.y)*U.dim,J=Math.floor(H),oe=Math.floor(Y);return(c?this.exaggeration():1)*Kr(Kr(U.get(J,oe),U.get(J,oe+1),Y-oe),Kr(U.get(J+1,oe),U.get(J+1,oe+1),Y-oe),H-J)}static getAtTileOffset(u,a,c,p){const g=1<<u.canonical.z;return p?p.pointElevation(a):c?c.getAtPointOrZero(new dt(u.wrap+(u.canonical.x+a.x/tr)/g,(u.canonical.y+a.y/tr)/g)):0}static getAtTileOffsetFunc(u,a,c,p){return(g,x,w)=>{const C=this.getAtTileOffset(u,g,x,w),N=p.upVector(u.canonical,g.x,g.y);return Oe(N,N,C*p.upVectorScale(u.canonical,a,c).metersToTile),N}}getForTilePoints(u,a,c,p){if(this.isUsingMockSource())return!1;const g=Ex.create(this,u,p);return!!g&&(a.forEach(x=>{x[2]=this.exaggeration()*g.getElevationAt(x[0],x[1],c)}),!0)}getMinMaxForTile(u){if(this.isUsingMockSource())return null;const a=this.findDEMTileFor(u);if(!a||!a.dem)return null;const c=a.dem.tree,p=a.tileID,g=1<<u.canonical.z-p.canonical.z;let x=u.canonical.x/g-p.canonical.x,w=u.canonical.y/g-p.canonical.y,C=0;for(let N=0;N<u.canonical.z-p.canonical.z&&!c.leaves[C];N++){x*=2,w*=2;const D=2*Math.floor(w)+Math.floor(x);C=c.childOffsets[C]+D,x%=1,w%=1}return{min:this.exaggeration()*c.minimums[C],max:this.exaggeration()*c.maximums[C]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(u,a,c){throw new Error("Pure virtual method called.")}pointCoordinate(u){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(u){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const u=this.visibleDemTiles;if(u.length===0)return null;let a=!1,c=Number.MAX_VALUE,p=Number.MIN_VALUE;for(const g of u){const x=this.getMinMaxForTile(g.tileID);x&&(c=Math.min(c,x.min),p=Math.max(p,x.max),a=!0)}return a?{min:c,max:p}:null}},i.bV=cC,i.bW=Ns,i.bX=Xa,i.bY=iV,i.bZ=y8,i.b_=lV,i.ba=UR,i.bb=It,i.bc=yl,i.bd=Q_,i.be=bU,i.bf=ds,i.bg=cx,i.bh=kM,i.bi=function(u,a){const c=rm(a.zoom);if(c===0)return hh(u);const p=JA(u),g=kR(p),x=xe(p.getWest())*a.worldSize,w=xe(p.getEast())*a.worldSize,C=ye(p.getNorth())*a.worldSize,N=ye(p.getSouth())*a.worldSize,D=[x,C,0],U=[w,C,0],q=[x,N,0],H=[w,N,0],Y=R([],a.globeMatrix);return Ht(D,D,Y),Ht(U,U,Y),Ht(q,q,Y),Ht(H,H,Y),g[0]=Tf(g[0],q,c),g[1]=Tf(g[1],H,c),g[2]=Tf(g[2],U,c),g[3]=Tf(g[3],D,c),xn.fromPoints(g)},i.bj=eC,i.bk=R,i.bl=q1,i.bm=Tf,i.bn=bf,i.bo=lhe,i.bp=ee,i.bq=F,i.br=qC,i.bs=xC,i.bt=_p,i.bu=function(u,a){const c=[];for(const p in u)p in a||c.push(p);return c},i.bv=Ye,i.bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.bx=yn,i.by=P,i.bz=I,i.c=zo,i.c$=function(u){return u*u*u*u*u},i.c0=yM,i.c1=U6,i.c2=EM,i.c3=HM,i.c4=Oe,i.c5=He,i.c6=Cr,i.c7=function(u,a,c){c*=.5;var p=a[0],g=a[1],x=a[2],w=a[3],C=Math.sin(c),N=Math.cos(c);return u[0]=p*N+g*C,u[1]=g*N-p*C,u[2]=x*N+w*C,u[3]=w*N-x*C,u},i.c8=dn,i.c9=ks,i.cA=ai,i.cB=GV,i.cC=Jl,i.cD=EU,i.cE=function(u,a,c,p,g,x,w,C,N){if(N.name==="globe")return EU(u,a,new Jl(c,p,g),!1);const D=mS({z:c,x:p,y:g},N);return new xn([(x+D.x/D.scale)*a,a*(D.y/D.scale),w],[(x+D.x2/D.scale)*a,a*(D.y2/D.scale),C])},i.cF=function(u,a,c){return u[0]=Math.min(a[0],c[0]),u[1]=Math.min(a[1],c[1]),u[2]=Math.min(a[2],c[2]),u[3]=Math.min(a[3],c[3]),u},i.cG=function(u,a,c){return u[0]=Math.max(a[0],c[0]),u[1]=Math.max(a[1],c[1]),u[2]=Math.max(a[2],c[2]),u[3]=Math.max(a[3],c[3]),u},i.cH=function(u){const a=Math.round((u+45+360)%360/90)%4;return Cw[a]},i.cI=Ie,i.cJ=ut,i.cK=l,i.cL=function(u){const a=I(new Float64Array(16));M(a,u.pixelMatrix,u.globeMatrix);const c=[0,j,0],p=[0,k,0];return Ht(c,c,a),Ht(p,p,a),[c[0]>0&&c[0]<=u.width&&c[1]>0&&c[1]<=u.height&&!RR(u,new Q(u.center.lat,90)),p[0]>0&&p[0]<=u.width&&p[1]>0&&p[1]<=u.height&&!RR(u,new Q(u.center.lat,-90))]},i.cM=function(u,a){const{scale:c}=u.tileTransform,p=c*tr/(u.tileSize*Math.pow(2,a.zoom-u.tileID.overscaledZ+u.tileID.canonical.z));return function(g,x,w){var C=x[1],N=x[2],D=x[3],U=w[0],q=w[1];return g[0]=x[0]*U,g[1]=C*U,g[2]=N*q,g[3]=D*q,g}(new Float32Array(4),a.inverseAdjustmentMatrix,[p,p])},i.cN=pC,i.cO=te,i.cP=HV,i.cQ=function(u){const a=HV(u,!0);return S([],[a[0],a[1],a[4],a[5]])},i.cR=z,i.cS=yi,i.cT=$,i.cU=function(u){const{x:a,y:c}=u.point,{lng:p,lat:g}=u._center;return CU(a,c,u.worldSize,p,g)},i.cV=Ae,i.cW=Fo,i.cX=Ql,i.cY=Is,i.cZ=v,i.c_=function(u,a,c){let p=0;for(let g=0;g<2;++g)u[g]>0&&(p+=(u[g]-0)*(u[g]-0)),a[g]<0&&(p+=(0-a[g])*(0-a[g]));return p},i.ca=function(u,a){return u[0]=-a[0],u[1]=-a[1],u[2]=-a[2],u[3]=a[3],u},i.cb=re,i.cc=function(u,a,c,p,g){var x=1/Math.tan(a/2);if(u[0]=x/c,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=x,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,g!=null&&g!==1/0){var w=1/(p-g);u[10]=(g+p)*w,u[14]=2*g*p*w}else u[10]=-1,u[14]=-2*p;return u},i.cd=function(u,a,c,p,g,x,w){var C=1/(a-c),N=1/(p-g),D=1/(x-w);return u[0]=-2*C,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*N,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*D,u[11]=0,u[12]=(a+c)*C,u[13]=(g+p)*N,u[14]=(w+x)*D,u[15]=1,u},i.ce=Ee,i.cf=function(u,a,c){u[4*a+0]=c[0],u[4*a+1]=c[1],u[4*a+2]=c[2],u[4*a+3]=c[3]},i.cg=sx,i.ch=Jp,i.ci=Bs,i.cj=Nu,i.ck=vy,i.cl=Q6,i.cm=function(){var u=new y(4);return y!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u},i.cn=function(u,a,c){var p=a[0],g=a[1],x=a[2],w=a[3],C=Math.sin(c),N=Math.cos(c);return u[0]=p*N+x*C,u[1]=g*N+w*C,u[2]=p*-C+x*N,u[3]=g*-C+w*N,u},i.co=function(u,a){return u[0]===a[0]&&u[1]===a[1]&&u[2]===a[2]&&u[3]===a[3]},i.cp=Dr,i.cq=function(u){var a=u[0],c=u[1],p=u[2],g=u[3];return Math.sqrt(a*a+c*c+p*p+g*g)},i.cr=ka,i.cs=nr,i.ct=Iu,i.cu=3,i.cv=2,i.cw=7,i.cx=6,i.cy=rt,i.cz=ae,i.d=function(u){return Ji.API_TILEJSON_REGEX.test(u)},i.d$=OU,i.d0=de,i.d1=45,i.d2=yy,i.d3=function(u,a,c){const p=Math.sqrt(u*u+a*a+c*c),g=p>0?Math.acos(c/p)*Na:0;let x=u!==0||a!==0?Math.atan2(-a,-u)*Na+90:0;return x<0&&(x+=360),[p,x,g]},i.d4=we,i.d5=Si,i.d6=Ke,i.d7=_e,i.d8=xn,i.d9=me,i.dA=B1,i.dB=class extends kc{constructor(u){super(u),this.current=TR}set(u,a,c){if(this.fetchUniformLocation(u,a)){for(let p=0;p<9;p++)if(c[p]!==this.current[p]){this.current=c,this.gl.uniformMatrix3fv(this.location,!1,c);break}}}},i.dC=Og,i.dD=function(u,a,c){const p=rm(c.zoom),g=u.style.map._antialias,x=u.terrain&&u.terrain.exaggeration()>0;return p===0&&!g&&!x},i.dE=function(u){const a=u.pixelsPerMeter,c=a/Ee(1,u.center.lat),p=I(new Float64Array(16));return F(p,p,[u.point.x,u.point.y,0]),z(p,p,[c,c,a]),Float32Array.from(p)},i.dF=JA,i.dG=function(u){const a=Ie-5;u=ve(u,-a,a)/a*90;const c=Math.pow(Math.abs(Math.sin(_n(u))),3);return Math.round(c*(E.length-1))},i.dH=function(u,a,c,p){const g=a.getNorth(),x=a.getSouth(),w=a.getWest(),C=a.getEast(),N=1<<u.z,D=C-w,U=g-x,q=D/_,H=-U/E[c],Y=[0,q,0,H,0,0,g,w,0];if(u.z>0){const J=180/p;A(Y,Y,[J/D+1,0,0,0,J/U+1,0,-.5*J/q,.5*J/H,1])}return Y[2]=N,Y[5]=u.x,Y[8]=u.y,Y},i.dI=hh,i.dJ=function(u,a,c){const p=I(new Float64Array(16)),g=(a/(1<<u)-.5)*Math.PI*2;return W(p,c.globeMatrix,g),Float32Array.from(p)},i.dK=BU,i.dL=YA,i.dM=function(u,a){return[Math.pow(u[0],2.2)*a,Math.pow(u[1],2.2)*a,Math.pow(u[2],2.2)*a]},i.dN=b,i.dO=function(u,a){var c=Math.sin(a),p=Math.cos(a);return u[0]=p,u[1]=c,u[2]=0,u[3]=-c,u[4]=p,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},i.dP=Lt,i.dQ=AU,i.dR=Yi,i.dS=gs,i.dT=256,i.dU=function(u,a){const c=[0,0,0];return Ht(c,c,eC(hh(a.canonical))),Ht(c,c,u),c},i.dV=u=>({u_matrix:new vy(u),u_texsize:new Nu(u),u_pixels_to_tile_units:new $1(u),u_device_pixel_ratio:new Bs(u),u_width_scale:new Bs(u),u_floor_width_scale:new Bs(u),u_image:new sx(u),u_units_to_pixels:new Nu(u),u_tile_units_to_pixels:new Bs(u),u_alpha_discard_threshold:new Bs(u),u_trim_offset:new Nu(u),u_trim_fade_range:new Nu(u),u_trim_color:new yy(u),u_emissive_strength:new Bs(u),u_zbias_factor:new Bs(u),u_tile_to_meter:new Bs(u),u_ground_shadow_factor:new Jp(u),u_pattern_transition:new Bs(u)}),i.dW=u=>({u_matrix:new vy(u),u_pixels_to_tile_units:new $1(u),u_device_pixel_ratio:new Bs(u),u_width_scale:new Bs(u),u_floor_width_scale:new Bs(u),u_units_to_pixels:new Nu(u),u_dash_image:new sx(u),u_gradient_image:new sx(u),u_image_height:new Bs(u),u_texsize:new Nu(u),u_tile_units_to_pixels:new Bs(u),u_alpha_discard_threshold:new Bs(u),u_trim_offset:new Nu(u),u_trim_fade_range:new Nu(u),u_trim_color:new yy(u),u_emissive_strength:new Bs(u),u_zbias_factor:new Bs(u),u_tile_to_meter:new Bs(u),u_ground_shadow_factor:new Jp(u)}),i.dX=u=>({u_camera_to_center_distance:new Bs(u),u_extrude_scale:new $1(u),u_device_pixel_ratio:new Bs(u),u_matrix:new vy(u),u_inv_rot_matrix:new vy(u),u_merc_center:new Nu(u),u_tile_id:new Jp(u),u_zoom_transition:new Bs(u),u_up_dir:new Jp(u),u_emissive_strength:new Bs(u)}),i.dY=Kp,i.dZ=Zfe,i.d_=class{constructor(u,a,c,p){this.context=u,this.format=p,this.size=c,this.texture=u.gl.createTexture();const[g,x,w]=this.size,{gl:C}=u;C.bindTexture(C.TEXTURE_3D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in a&&a.data&&C.texImage3D(C.TEXTURE_3D,0,this.format,g,x,w,0,tM(this.format),rM(this.format),a.data)}bind(u,a){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_3D,this.texture),u!==this.minFilter&&(p.texParameteri(p.TEXTURE_3D,p.TEXTURE_MAG_FILTER,u),p.texParameteri(p.TEXTURE_3D,p.TEXTURE_MIN_FILTER,u),this.minFilter=u),a!==this.wrapS&&(p.texParameteri(p.TEXTURE_3D,p.TEXTURE_WRAP_S,a),p.texParameteri(p.TEXTURE_3D,p.TEXTURE_WRAP_T,a),this.wrapS=a)}destroy(){const{gl:u}=this.context;u.deleteTexture(this.texture),this.texture=null}},i.da=function(u){return[Math.pow(u[0],1/2.2),Math.pow(u[1],1/2.2),Math.pow(u[2],1/2.2)]},i.db=qV,i.dc=cM,i.dd=ZV,i.de=IM,i.df=function(u,a){return u.readFields(Gpe,{icons:[]},a)},i.dg=uC,i.dh=xx,i.di=bM,i.dj=Ow,i.dk=OA,i.dl=kg,i.dm=Bg,i.dn=Ar,i.dp=function(u){const a=u.indexOf(dy);return a>=0?u.slice(0,a):u},i.dq=function(u){return u.indexOf(dy)>=0},i.dr=function(u){const a=u.lastIndexOf(dy);return a>=0?u.slice(a+1):""},i.ds=function(u){const a=[],c=u.id;return c===void 0&&a.push({message:`layers.${c}: missing required property "id"`}),u.render===void 0&&a.push({message:`layers.${c}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&a.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),a},i.dt=function(u,a,c,p){return u.type==="custom"?new zpe(u,a):new qpe[u.type](u,a,c,p)},i.du=Ut,i.dv=function(u){const a=u.indexOf(dy);return a>=0?u.slice(a+1):""},i.dw=class extends Cy{constructor(u,a){super(u._vectorTileFeature,u._z,u._x,u._y,u.id),u.state&&(this.state=Object.assign({},u.state)),this.target=a.target,this.namespace=a.namespace,a.properties&&(this.properties=a.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=u.source,this.sourceLayer=u.sourceLayer,this.layer=u.layer)}toJSON(){const u=super.toJSON();return u.target=this.target,u.namespace=this.namespace,u}},i.dx=v1,i.dy=Rg,i.dz=function(u){return u({pluginStatus:sl,pluginURL:lh}),v1.on("pluginStateChange",u),u},i.e=Ji,i.e$=function([u,a,c]){const p=Math.hypot(u,a,c),g=Math.atan2(u,c),x=.5*Math.PI-Math.acos(-a/p);return new Q(Fo(g),Fo(x))},i.e0=(u,a,c,p,g,x)=>{const w=u.transform,C=w.projection.name==="globe";let N;if(x.paint.get("circle-pitch-alignment")==="map")if(C){const U=AU(w.zoom,a.canonical)*w._pixelsPerMercatorPixel;N=Float32Array.from([U,0,0,U])}else N=w.calculatePixelsToTileUnitsMatrix(c);else N=new Float32Array([w.pixelsToGLUnits[0],0,0,w.pixelsToGLUnits[1]]);const D={u_camera_to_center_distance:u.transform.getCameraToCenterDistance(w.projection),u_matrix:u.translatePosMatrix(a.projMatrix,c,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Pl.devicePixelRatio,u_extrude_scale:N,u_inv_rot_matrix:fhe,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:x.paint.get("circle-emissive-strength")};if(C){D.u_inv_rot_matrix=p,D.u_merc_center=g,D.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],D.u_zoom_transition=rm(w.zoom);const U=g[0]*tr,q=g[1]*tr;D.u_up_dir=w.projection.upVector(new Jl(0,0,0),U,q)}return D},i.e1=h6,i.e2=gl,i.e3=(u,a,c,p,g,x,w,C,N,D)=>{const U=u.transform,q=U.pitch<15?c6(.07,.7,ve((14-U.zoom)/5,0,1)):.07,H=c.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:d6(u,a,c,p),u_texsize:a.imageAtlasTexture?a.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:U.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:g,u_width_scale:x,u_floor_width_scale:w,u_image:0,u_tile_units_to_pixels:u6(a,U),u_units_to_pixels:[1/U.pixelsToGLUnits[0],1/U.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:C,u_trim_fade_range:c.paint.get("line-trim-fade-range"),u_trim_color:c.paint.get("line-trim-color").toPremultipliedRenderColor(H?null:c.lut).toArray01(),u_emissive_strength:c.paint.get("line-emissive-strength"),u_zbias_factor:q,u_tile_to_meter:Ke(a.tileID.canonical,0),u_ground_shadow_factor:N,u_pattern_transition:D}},i.e4=(u,a,c,p,g,x,w,C,N,D)=>{const U=u.transform,q=U.calculatePixelsToTileUnitsMatrix(a),H=c.paint.get("line-trim-color-use-theme").constantOr("default")==="none",Y=U.pitch<15?c6(.07,.7,ve((14-U.zoom)/5,0,1)):.07;return{u_matrix:d6(u,a,c,p),u_pixels_to_tile_units:q,u_device_pixel_ratio:x,u_width_scale:w,u_floor_width_scale:C,u_units_to_pixels:[1/U.pixelsToGLUnits[0],1/U.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:g,u_texsize:f6(c)&&a.lineAtlasTexture?a.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:u6(a,u.transform),u_alpha_discard_threshold:0,u_trim_offset:N,u_trim_fade_range:c.paint.get("line-trim-fade-range"),u_trim_color:c.paint.get("line-trim-color").toPremultipliedRenderColor(H?null:c.lut).toArray01(),u_emissive_strength:c.paint.get("line-emissive-strength"),u_zbias_factor:Y,u_tile_to_meter:Ke(a.tileID.canonical,0),u_ground_shadow_factor:D}},i.e5=ct,i.e6=H1,i.e7=Ve,i.e8=Ef,i.e9=lC,i.eA=DM,i.eB=yC,i.eC=gC,i.eD=[1,1,1],i.eE=Ex,i.eF=lt,i.eG=function(u,a,c,p){var g=a[0],x=a[1],w=a[2],C=a[3];return u[0]=g+p*(c[0]-g),u[1]=x+p*(c[1]-x),u[2]=w+p*(c[2]-w),u[3]=C+p*(c[3]-C),u},i.eH=mx,i.eI=Oc,i.eJ=dh,i.eK=function(u,a,c,p,g,x,w,C,N,D,U,q,H,Y,J,oe){var ce=new y(16);return ce[0]=u,ce[1]=a,ce[2]=c,ce[3]=p,ce[4]=g,ce[5]=x,ce[6]=w,ce[7]=C,ce[8]=N,ce[9]=D,ce[10]=U,ce[11]=q,ce[12]=H,ce[13]=Y,ce[14]=J,ce[15]=oe,ce},i.eL=G,i.eM=I1,i.eN=fy,i.eO=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new st(1/0,1/0),max:new st(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(u,a=!1){const c=aV(new st(0,0),new st(tr,tr),u),p=[];if(a&&!VR(c,this._globalClipBounds))return p;for(const g of this._activeRegions){if(g.hiddenByOverlap||!VR(c,g))continue;const x=Uhe(g.min,g.max,u);p.push({min:x.min,max:x.max,sourceId:this._sourceIds[g.priority],footprint:g.footprint,footprintTileId:g.tileId,order:g.order,clipMask:g.clipMask,clipScope:g.clipScope})}return p}setSources(u){this._setSources(u.map(a=>({getSourceId:()=>a.cache.id,getFootprints:()=>{const c=[];for(const p of a.cache.getVisibleCoordinates()){const g=a.cache.getTile(p).buckets[a.layer];g&&g.updateFootprints(p.toUnwrapped(),c)}return c},getOrder:()=>a.order,getClipMask:()=>a.clipMask,getClipScope:()=>a.clipScope})))}_addSource(u){const a=u.getFootprints();if(a.length===0)return;const c=u.getOrder(),p=u.getClipMask(),g=u.getClipScope();for(const x of a){if(!x.footprint)continue;const w=aV(x.footprint.min,x.footprint.max,x.id);this._activeRegions.push({min:w.min,max:w.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:x.id,footprint:x.footprint,order:c,clipMask:p,clipScope:g})}this._sourceIds.push(u.getSourceId())}_computeReplacement(){this._activeRegions.sort((a,c)=>a.priority-c.priority||sC(a.min,c.min)||sC(a.max,c.max)||a.order-c.order||a.clipMask-c.clipMask||function(p,g){const x=(w,C)=>w+C;return p.length-g.length||p.reduce(x,"").localeCompare(g.reduce(x,""))}(a.clipScope,c.clipScope));let u=this._activeRegions.length!==this._prevRegions.length;if(!u){let a=0;for(;!u&&a!==this._activeRegions.length;){const c=this._activeRegions[a],p=this._prevRegions[a];u=c.priority!==p.priority||!sV(c,p)||c.order!==p.order||c.clipMask!==p.clipMask||!yn(c.clipScope,p.clipScope),this._activeRegions[a].hiddenByOverlap=p.hiddenByOverlap,++a}}if(u){++this._updateTime;for(const c of this._activeRegions)c.order!==Y1&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,c.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,c.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,c.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,c.max.y));const a=c=>{const p=this._activeRegions;if(c>=p.length)return c;const g=p[c].priority;for(;c<p.length&&p[c].priority===g;)++c;return c};if(this._sourceIds.length>1){let c=0,p=a(c);for(;c!==p;){let g=c;const x=c;for(;g!==p;){const w=this._activeRegions[g];w.hiddenByOverlap=!1;for(let C=0;C<x;C++){const N=this._activeRegions[C];if(!N.hiddenByOverlap&&w.order===Y1&&VR(w,N)&&(w.hiddenByOverlap=oV(w.footprint,w.tileId,N.footprint,N.tileId),w.hiddenByOverlap))break}++g}c=p,p=a(c)}}}}_setSources(u){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let a=u.length-1;a>=0;a--)this._addSource(u[a]);this._computeReplacement()}},i.eP=Y1,i.eQ=class{constructor(u){this._createGrid(u),this._createPoles(u)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const u of this._poleSegments)u.destroy();for(const u of this._gridSegments)u.withSkirts.destroy(),u.withoutSkirts.destroy()}_fillGridMeshWithLods(u,a){const c=new yl,p=new is,g=[],x=u+1+2,w=a[0]+1,C=a[0]+1+(1+a.length),N=(D,U,q)=>{let H=D===x-1?D-2:D===0?D:D-1;return H+=q?24575:0,[H,U]};for(let D=0;D<x;++D)c.emplaceBack(...N(D,0,!0));for(let D=0;D<w;++D)for(let U=0;U<x;++U)c.emplaceBack(...N(U,D,(U===0||U===x-1)&&!0));for(let D=0;D<a.length;++D){const U=a[D];for(let q=0;q<x;++q)c.emplaceBack(...N(q,U,!0))}for(let D=0;D<a.length;++D){const U=p.length,q=a[D]+1+2,H=new is;for(let oe=0;oe<q-1;oe++){const ce=oe===q-2,he=ce?x*(C-a.length+D-oe):x;for(let Se=0;Se<x-1;Se++){const Te=oe*x+Se;oe===0||ce||Se===0||Se===x-2?(H.emplaceBack(Te+1,Te,Te+he),H.emplaceBack(Te+he,Te+he+1,Te+1)):(p.emplaceBack(Te+1,Te,Te+he),p.emplaceBack(Te+he,Te+he+1,Te+1))}}const Y=ds.simpleSegment(0,U,c.length,p.length-U);for(let oe=0;oe<H.uint16.length;oe+=3)p.emplaceBack(H.uint16[oe],H.uint16[oe+1],H.uint16[oe+2]);const J=ds.simpleSegment(0,U,c.length,p.length-U);g.push({withoutSkirts:Y,withSkirts:J})}return{vertices:c,indices:p,segments:g}}_createGrid(u){const a=this._fillGridMeshWithLods(_,E);this._gridSegments=a.segments,this._gridBuffer=u.createVertexBuffer(a.vertices,bU.members),this._gridIndexBuffer=u.createIndexBuffer(a.indices,!0)}_createPoles(u){const a=new is;for(let w=0;w<=_;w++)a.emplaceBack(0,w+1,w+2);this._poleIndexBuffer=u.createIndexBuffer(a,!0);const c=new Sf,p=new Sf,g=new Sf,x=new Sf;this._poleSegments=[];for(let w=0,C=0;w<v;w++){const N=360/(1<<w);c.emplaceBack(0,-vl,0,.5,0),p.emplaceBack(0,-vl,0,.5,1),g.emplaceBack(0,-vl,0,.5,.5),x.emplaceBack(0,-vl,0,.5,.5);for(let D=0;D<=_;D++){let U=D/_,q=0;const H=Kr(0,N,U),[Y,J,oe]=L(dhe,hhe,H,vl);c.emplaceBack(Y,J,oe,U,q),p.emplaceBack(Y,J,oe,U,1-q);const ce=_n(H);U=.5+.5*Math.sin(ce),q=.5+.5*Math.cos(ce),g.emplaceBack(Y,J,oe,U,q),x.emplaceBack(Y,J,oe,U,1-q)}this._poleSegments.push(ds.simpleSegment(C,0,66,64)),C+=66}this._poleNorthVertexBuffer=u.createVertexBuffer(c,lx,!1),this._poleSouthVertexBuffer=u.createVertexBuffer(p,lx,!1),this._texturedPoleNorthVertexBuffer=u.createVertexBuffer(g,lx,!1),this._texturedPoleSouthVertexBuffer=u.createVertexBuffer(x,lx,!1)}getGridBuffers(u,a){return[this._gridBuffer,this._gridIndexBuffer,a?this._gridSegments[u].withSkirts:this._gridSegments[u].withoutSkirts]}getPoleBuffers(u,a){return[a?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,a?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[u]]}},i.eR=nV,i.eS=ht,i.eT=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.eU=fe,i.eV=Le,i.eW=function(u,a,c){return u[0]=a[0]/c[0],u[1]=a[1]/c[1],u[2]=a[2]/c[2],u},i.eX=wt,i.eY=B,i.eZ=Be,i.e_=Ce,i.ea=wV,i.eb=im,i.ec=hV,i.ed=dV,i.ee=$e,i.ef=function(u,a){if(u===a){var c=a[1],p=a[2],g=a[3],x=a[6],w=a[7],C=a[11];u[1]=a[4],u[2]=a[8],u[3]=a[12],u[4]=c,u[6]=a[9],u[7]=a[13],u[8]=p,u[9]=x,u[11]=a[14],u[12]=g,u[13]=w,u[14]=C}else u[0]=a[0],u[1]=a[4],u[2]=a[8],u[3]=a[12],u[4]=a[1],u[5]=a[5],u[6]=a[9],u[7]=a[13],u[8]=a[2],u[9]=a[6],u[10]=a[10],u[11]=a[14],u[12]=a[3],u[13]=a[7],u[14]=a[11],u[15]=a[15];return u},i.eg=Fpe,i.eh=Cn,i.ei=M1,i.ej=256,i.ek=NR,i.el=Kl,i.em=W,i.en=function(u,a){return u[0]=a[0],u[1]=a[1],u[2]=a[2],u[3]=a[4],u[4]=a[5],u[5]=a[6],u[6]=a[8],u[7]=a[9],u[8]=a[10],u},i.eo=Sf,i.ep=N1,i.eq=SA,i.er=function(u,a,c,p,g){return ve((u-a)/(c-a)*(g-p)+p,p,g)},i.es=fn,i.et=function(u,a){var c=a[0],p=a[1],g=a[2],x=a[3],w=a[4],C=a[5],N=a[6],D=a[7],U=a[8],q=U*w-C*D,H=-U*x+C*N,Y=D*x-w*N,J=c*q+p*H+g*Y;return J?(u[0]=q*(J=1/J),u[1]=(-U*p+g*D)*J,u[2]=(C*p-g*w)*J,u[3]=H*J,u[4]=(U*c-g*N)*J,u[5]=(-C*c+g*x)*J,u[6]=Y*J,u[7]=(-D*c+p*N)*J,u[8]=(w*c-p*x)*J,u):null},i.eu=2,i.ev=nt,i.ew=er,i.ex=ie,i.ey=function(u,a){var c=new y(3);ie(c,a);var p=1/c[0],g=1/c[1],x=1/c[2],w=a[0]*p,C=a[1]*g,N=a[2]*x,D=a[4]*p,U=a[5]*g,q=a[6]*x,H=a[8]*p,Y=a[9]*g,J=a[10]*x,oe=w+U+J,ce=0;return oe>0?(ce=2*Math.sqrt(oe+1),u[3]=.25*ce,u[0]=(q-Y)/ce,u[1]=(H-N)/ce,u[2]=(C-D)/ce):w>U&&w>J?(ce=2*Math.sqrt(1+w-U-J),u[3]=(q-Y)/ce,u[0]=.25*ce,u[1]=(C+D)/ce,u[2]=(H+N)/ce):U>J?(ce=2*Math.sqrt(1+U-w-J),u[3]=(H-N)/ce,u[0]=(C+D)/ce,u[1]=.25*ce,u[2]=(q+Y)/ce):(ce=2*Math.sqrt(1+J-w-U),u[3]=(C-D)/ce,u[0]=(H+N)/ce,u[1]=(q+Y)/ce,u[2]=.25*ce),u},i.ez=function(u,a){var c=2*Math.acos(a[3]),p=Math.sin(c/2);return p>m?(u[0]=a[0]/p,u[1]=a[1]/p,u[2]=a[2]/p):(u[0]=1,u[1]=0,u[2]=0),c},i.f=function(u){return btoa(encodeURIComponent(u).replace(/%([0-9A-F]{2})/g,(a,c)=>String.fromCharCode(+("0x"+c))))},i.f0=sr,i.f1=iM,i.f2=function(u){const a=u.navigator?u.navigator.userAgent:null;return!!function(c){if(Rs==null){const p=c.navigator?c.navigator.userAgent:null;Rs=!!c.safari||!(!p||!(/\b(iPad|iPhone|iPod)\b/.test(p)||p.match("Safari")&&!p.match("Chrome")))}return Rs}(u)&&!(!a||!(a.match("Version/15.4")||a.match("Version/15.5")||a.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},i.f3=function(u,a){Ig=u,ml=a},i.f4=RR,i.f5=jU,i.f6=function(u){const a=[0,0,0],c=I(new Float64Array(16));return M(c,u.pixelMatrix,u.globeMatrix),Ht(a,a,c),new st(a[0],a[1])},i.f7=function(){const u=nS;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(XR),nS=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.f8=function(){uC().acquire(XR)},i.f9=_1,i.fA=Bt,i.fB=function(u){let a=0;if(new Uint32Array(u,0,1)[0]!==zV){const c=new Uint32Array(u,0,7),[,,p,g,x,w]=c;a=c.byteLength+g+x+w+x,(p!==u.byteLength||a>=u.byteLength)&&zr("Invalid b3dm header information.")}return VV(u,a)},i.fC=function(u,a){const c=cM(u);for(const p of c){for(const g of p.meshes)_fe(g);p.lights&&(p.lightMeshIndex=p.meshes.length,p.meshes.push(xfe(p.lights,a)))}return c},i.fD=LC,i.fE=bs,i.fF=RV,i.fG=Nl,i.fH=kl,i.fI=function(u){af(),il!=null&&il.then(a=>{a.keys().then(c=>{for(let p=0;p<c.length-u;p++)a.delete(c[p]).catch(g=>zr(g.message))}).catch(c=>zr(c.message))}).catch(a=>zr(a.message))},i.fa=function(u,a,c=!1){if(sl===kl.deferred||sl===kl.loading||sl===kl.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");lh=Pl.resolveURL(u),sl=kl.deferred,g1=a,y1(),c||x1()},i.fb=function(u){hx=Pl.resolveURL(u),fx||(fx=new dx(uC(),new od)),fx.broadcast("setMeshoptUrl",hx)},i.fc=LV,i.fd=function(u){JR=Pl.resolveURL(u),fx||(fx=new dx(uC(),new od)),fx.broadcast("setDracoUrl",JR)},i.fe=DV,i.ff=rS,i.fg=function(u){const a=ad();if(!a)return;const c=a.delete(Ng);u&&c.then(()=>u()).catch(u)},i.fh=wy,i.fi=_r,i.fj=nm,i.fk=bd,i.fl=iq,i.fm=sq,i.fn=s6,i.fo=dr,i.fp="hd_road_elevation",i.fq=Qr,i.fr=Zt,i.fs=Af,i.ft=xM,i.fu=Ty,i.fv=function(u,a,c,p,g,x,w,C=1,N,D,U){u.createArrays(),u.tilePixelRatio=tr/(512*u.overscaling),u.compareText={},u.iconsNeedLinear=!1;const q=u.layers[0].layout,H=u.layers[0]._unevaluatedLayout._values,Y={};Y.scaleFactor=C,Y.textSizeScaleRange=q.get("text-size-scale-range"),Y.iconSizeScaleRange=q.get("icon-size-scale-range");const[J,oe]=Y.textSizeScaleRange,[ce,he]=Y.iconSizeScaleRange;Y.textScaleFactor=ve(Y.scaleFactor,J,oe),Y.iconScaleFactor=ve(Y.scaleFactor,ce,he);const Se=H["text-size"],Te=H["icon-size"];if(u.textSizeData.kind==="composite"){const{minZoom:it,maxZoom:At}=u.textSizeData;Y.compositeTextSizes=[Se.possiblyEvaluate(new Vi(it,{worldview:U}),x),Se.possiblyEvaluate(new Vi(At,{worldview:U}),x)]}if(u.iconSizeData.kind==="composite"){const{minZoom:it,maxZoom:At}=u.iconSizeData;Y.compositeIconSizes=[Te.possiblyEvaluate(new Vi(it,{worldview:U}),x),Te.possiblyEvaluate(new Vi(At,{worldview:U}),x)]}Y.layoutTextSize=Se.possiblyEvaluate(new Vi(w+1,{worldview:U}),x),Y.layoutIconSize=Te.possiblyEvaluate(new Vi(w+1,{worldview:U}),x),Y.textMaxSize=Se.possiblyEvaluate(new Vi(18,{worldview:U}),x);const ke=q.get("symbol-placement"),qe=q.get("text-rotation-alignment")==="map"&&ke!=="point",Fe=q.get("text-size");let Xe=!1;const et=[];for(const it of u.features){const At=q.get("text-font").evaluate(it,{},x).join(","),pt=Fe.evaluate(it,{},x)*Y.textScaleFactor,jt=Y.layoutTextSize.evaluate(it,{},x)*Y.textScaleFactor,Rt=Y.layoutIconSize.evaluate(it,{},x)*Y.iconScaleFactor,zt={horizontal:{},vertical:void 0},Yt=it.text;let qt,Dt=[0,0];if(Yt){const Sn=Yt.toString(),qn=q.get("text-letter-spacing").evaluate(it,{},x)*Xa,on=q.get("text-line-height").evaluate(it,{},x)*Xa,ti=jA(Sn)?qn:0,ri=q.get("text-anchor").evaluate(it,{},x),cs=q.get("text-variable-anchor");if(!cs){const kt=q.get("text-radial-offset").evaluate(it,{},x);if(kt)Dt=U6(ri,[kt*Xa,SM]);else{const or=q.get("text-offset").evaluate(it,{},x);Dt=[or[0]*Xa,or[1]*Xa]}}let ze=qe?"center":q.get("text-justify").evaluate(it,{},x);const Re=ke==="point",Ot=Re?q.get("text-max-width").evaluate(it,{},x)*Xa:1/0,ir=kt=>{u.allowVerticalPlacement&&f1(Sn)&&(zt.vertical=gM(Yt,a,c,g,At,Ot,on,ri,kt,ti,Dt,tc.vertical,!0,jt,pt,N))};if(!qe&&cs){const kt=ze==="auto"?cs.map(jr=>EM(jr)):[ze];let or=!1;for(let jr=0;jr<kt.length;jr++){const Tr=kt[jr];if(!zt.horizontal[Tr])if(or)zt.horizontal[Tr]=zt.horizontal[0];else{const cn=gM(Yt,a,c,g,At,Ot,on,"center",Tr,ti,Dt,tc.horizontal,!1,jt,pt,N);cn&&(zt.horizontal[Tr]=cn,or=cn.positionedLines.length===1)}}ir("left")}else{if(ze==="auto"&&(ze=EM(ri)),Re||q.get("text-writing-mode").indexOf("horizontal")>=0||!f1(Sn)){const kt=gM(Yt,a,c,g,At,Ot,on,ri,ze,ti,Dt,tc.horizontal,!1,jt,pt,N);kt&&(zt.horizontal[ze]=kt)}ir(Re?"left":ze)}}let Vt,St,xt,$t,Kt,Ft,gr=!1;const br=q.get("icon-text-fit").evaluate(it,{},x);if(it.icon&&it.icon.hasPrimary()){const Sn=fS(it.icon,u.iconSizeData,H["icon-size"],x,u.zoom,it,N,Y.iconScaleFactor,U);Vt=Sn.iconPrimary,xt=Sn.iconSecondary;const qn=Vt.toString();if(St=p.get(qn),St&&(Kt=q.get("icon-offset").evaluate(it,{},x),Ft=q.get("icon-anchor").evaluate(it,{},x),qt=wC(g.get(qn),xt?g.get(xt.toString()):void 0,Kt,Ft),gr=St.sdf,u.sdfIcons===void 0?u.sdfIcons=St.sdf:u.sdfIcons!==St.sdf&&zr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(St.pixelRatio!==u.pixelRatio||q.get("icon-rotate").constantOr(1)!==0)&&(u.iconsNeedLinear=!0)),xt){const on=xt.toString();$t=p.get(on)}}Xe=Xe||!(!it.icon||!it.icon.hasSecondary());const hr=TM(zt.horizontal)||zt.vertical;u.iconsInText||(u.iconsInText=!!hr&&hr.iconsInText);const ar=jt*Y.textScaleFactor/Xa,{defaultShapedIcon:en,verticallyShapedIcon:lr}=Epe(u,qt,q,it,x,zt,ar,Kt,br);br!=="none"&&qt&&(C6(qt)||j6(qt))&&(CC(0,St,Vt,qt,en,br,D,p,g),CC(0,$t,xt,qt,en,br,D,p,g),lr&&(CC(0,St,Vt,qt,lr,br,D,p,g),CC(0,$t,xt,qt,lr,br,D,p,g))),qt=en;const{iconBBox:Lr,iconVerticalBBox:rn}=bpe(u,qt,lr,q,it,x,Rt,Kt,Y,g,Ft);et.push({feature:it,shapedTextOrientations:zt,shapedText:hr,shapedIcon:qt,iconPrimary:Vt,iconSecondary:xt,iconOffset:Kt,iconAnchor:Ft,verticallyShapedIcon:lr,layoutTextSize:jt,layoutIconSize:Rt,textOffset:Dt,isSDFIcon:gr,iconTextFit:br,iconCollisionBounds:Lr,iconVerticalCollisionBounds:rn})}return{featureData:et,sizes:Y,hasAnySecondaryIcon:Xe,textAlongLine:qe,symbolPlacement:ke}},i.fw=D6,i.fx=function(u,a,c,p,g,x,w,C,N,D){u.iconAtlasPositions=D.iconPositions;const{featureData:U,hasAnySecondaryIcon:q,sizes:H,textAlongLine:Y,symbolPlacement:J}=a;for(const oe of U){const{shapedIcon:ce,verticallyShapedIcon:he,feature:Se,shapedTextOrientations:Te,shapedText:ke,layoutTextSize:qe,textOffset:Fe,isSDFIcon:Xe,iconPrimary:et,iconSecondary:it,iconTextFit:At,iconOffset:pt,iconCollisionBounds:jt,iconVerticalCollisionBounds:Rt}=oe;q6(ce,D.iconPositions,et,it),q6(he,D.iconPositions,et,it),Spe(Te,D.iconPositions),wpe(et,it,D.iconPositions),(ke||ce)&&Tpe(u,Se,Te,ce,he,N,H,qe,0,Fe,Xe,p,g,w,C,q,At,pt,Y,J,jt,Rt)}c&&u.generateCollisionDebugBuffers(x,u.collisionBoxArray,H.textScaleFactor)},i.fy=wr,i.fz=VC,i.g=function(u,a){return Rg(Object.assign(u,{method:"GET"}),a)},i.h=function(u){return u.indexOf("mapbox:")===0},i.i=function(u){return Ji.API_STYLE_REGEX.test(u)&&!zo(u)},i.j=ua,i.k=a_,i.l=function(u){return decodeURIComponent(atob(u).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.m=function(u,a){return Rg(Object.assign(u,{type:"json"}),a)},i.n=Nw,i.o=Pl,i.p=function(u,a){return Rg(Object.assign(u,{method:"POST"}),a)},i.q=So,i.r=jl,i.s=function(u){try{const a=self[u];return a.setItem("_mapbox_test_",1),a.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=function(){return YR||(YR=new wy),YR},i.u=function(){return function u(a){return a?(a^Math.random()*(16>>a/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,u)}()},i.v=function(u){return!!u&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(u)},i.w=zr,i.x=$M,i.y=$g,i.z=ql}),o(["./shared"],function(i){function m(ht){const fe=ht?ht.url.toString():void 0;return fe?performance.getEntriesByName(fe):[]}function y(ht){if(typeof ht=="number"||typeof ht=="boolean"||typeof ht=="string"||ht==null)return JSON.stringify(ht);if(Array.isArray(ht)){let ve="[";for(const De of ht)ve+=`${y(De)},`;return`${ve}]`}let fe="{";for(const ve of Object.keys(ht).sort())fe+=`${ve}:${y(ht[ve])},`;return`${fe}}`}function S(ht){let fe="";for(const ve of i.bw)fe+=`/${y(ht[ve])}`;return fe}class b{constructor(fe){this.keyCache={},this._layers={},this._layerConfigs={},fe&&this.replace(fe)}replace(fe,ve){this._layerConfigs={},this._layers={},this.update(fe,[],ve)}update(fe,ve,De){this._options=De;for(const Ye of fe)this._layerConfigs[Ye.id]=Ye,(this._layers[Ye.id]=i.dt(Ye,this.scope,null,this._options)).compileFilter(De),this.keyCache[Ye.id]&&delete this.keyCache[Ye.id];for(const Ye of ve)delete this.keyCache[Ye],delete this._layerConfigs[Ye],delete this._layers[Ye];this.familiesBySource={};const Qe=function(Ye,ot){const bt={};for(let _t=0;_t<Ye.length;_t++){const Zt=Ye[_t];let Ut=ot&&ot[Zt.id];Ut||(Zt.type==="symbol"?Ut=Zt.id:(Ut=S(Zt),Zt.type==="line"&&Zt.paint&&function Jr(Zr){return typeof Zr=="string"&&Zr==="line-progress"||(Array.isArray(Zr)?Zr.some(Jr):!(!Zr||typeof Zr!="object")&&Object.values(Zr).some(Jr))}(Zt.paint["line-width"])&&(Ut+=`/${y(Zt.paint["line-width"])}`))),ot&&(ot[Zt.id]=Ut);let Ar=bt[Ut];Ar||(Ar=bt[Ut]=[]),Ar.push(Zt)}const ct=[];for(const _t in bt)ct.push(bt[_t]);return ct}(Object.values(this._layerConfigs),this.keyCache);for(const Ye of Qe){const ot=Ye.map(Ar=>this._layers[Ar.id]),bt=ot[0];if(bt.visibility==="none")continue;const ct=bt.source||"";let _t=this.familiesBySource[ct];_t||(_t=this.familiesBySource[ct]={});const Zt=bt.sourceLayer||"_geojsonTileLayer";let Ut=_t[Zt];Ut||(Ut=_t[Zt]=[]),Ut.push(ot)}}}const T=1*i.fk;class A{constructor(fe){const ve={},De=[];for(const bt in fe){const ct=fe[bt],_t=ve[bt]={};for(const Zt in ct.glyphs){const Ut=ct.glyphs[+Zt];if(!Ut||Ut.bitmap.width===0||Ut.bitmap.height===0)continue;const Ar=Ut.metrics.localGlyph?T:1,Jr={x:0,y:0,w:Ut.bitmap.width+2*Ar,h:Ut.bitmap.height+2*Ar};De.push(Jr),_t[Zt]=Jr}}const{w:Qe,h:Ye}=i.G(De),ot=new i.fj({width:Qe||1,height:Ye||1});for(const bt in fe){const ct=fe[bt];for(const _t in ct.glyphs){const Zt=ct.glyphs[+_t];if(!Zt||Zt.bitmap.width===0||Zt.bitmap.height===0)continue;const Ut=ve[bt][_t],Ar=Zt.metrics.localGlyph?T:1;i.fj.copy(Zt.bitmap,ot,{x:0,y:0},{x:Ut.x+Ar,y:Ut.y+Ar},Zt.bitmap)}}this.image=ot,this.positions=ve}}function O(ht,fe,ve){ht[fe]?ve&&(ht[fe].center=ve):ht[fe]={floorIds:new Set,center:ve||[0,0],floors:{}}}function P(ht,fe,ve,De){for(const Qe of fe)O(ht,Qe),ht[Qe].floors[ve]=De,ht[Qe].floorIds.add(ve)}function I(ht){return{id:ht.properties.id.toString(),center:ht.properties.center.toString().split(";").map(Number)}}function R(ht){return{id:ht.properties.id.toString(),isDefault:!!ht.properties.is_default&&ht.properties.is_default,connections:ht.properties.connected_floor_ids?new Set(ht.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:ht.properties.conflicted_floor_ids?new Set(ht.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:ht.properties.building_ids?new Set(ht.properties.building_ids.toString().split(";")):new Set,name:ht.properties.name.toString(),zIndex:ht.properties.z_index}}function M(ht,fe){return fe.every(ve=>ht.properties&&ht.properties[ve]!=null)}function F(ht){return M(ht,["type","id","name"])&&ht.properties.type==="building"}function z(ht){return M(ht,["type","id","name","z_index"])&&ht.properties.type==="floor"}i.fi(A,"GlyphAtlas");class ${constructor(fe){this.tileID=new i.aP(fe.tileID.overscaledZ,fe.tileID.wrap,fe.tileID.canonical.z,fe.tileID.canonical.x,fe.tileID.canonical.y),this.tileZoom=fe.tileZoom,this.uid=fe.uid,this.zoom=fe.zoom,this.lut=fe.lut,this.canonical=fe.tileID.canonical,this.pixelRatio=fe.pixelRatio,this.tileSize=fe.tileSize,this.source=fe.source,this.scope=fe.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=fe.showCollisionBoxes,this.collectResourceTiming=!!fe.request&&fe.request.collectResourceTiming,this.promoteId=fe.promoteId,this.isSymbolTile=fe.isSymbolTile,this.tileTransform=i.aY(fe.tileID.canonical,fe.projection),this.projection=fe.projection,this.worldview=fe.worldview,this.localizableLayerIds=fe.localizableLayerIds,this.brightness=fe.brightness,this.extraShadowCaster=!!fe.extraShadowCaster,this.tessellationStep=fe.tessellationStep,this.scaleFactor=fe.scaleFactor,this.worldview=fe.worldview,this.indoor=fe.indoor}parse(fe,ve,De,Qe,Ye,ot){this.status="parsing",this.data=fe,this.collisionBoxArray=new i.b2;const bt=new i.fl(Object.keys(fe.layers).sort()),ct=new i.fm(this.tileID,this.promoteId);ct.bucketLayerIDs=[];const _t={},Zt=new i.fn(256,256),Ut={featureIndex:ct,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Zt,availableImages:De,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const zr=this.indoor.indoorState.activeFloorsVisible,wn=function(An,Si,bs){const Xs=function(_i,Mn){if(!_i)return i.w("No source layers defined in indoor specification"),Mn;if(_i.size===0)return Mn;const Yi=_i.difference(Mn);for(const gs of Yi)i.w(`Missing source layer required in indoor specification: ${gs}`);return Mn.intersection(Mn)}(Si.sourceLayers,new Set(Object.keys(An.layers))),Rs=Si.indoorState,ks=function(_i,Mn,Yi,gs){const Ti=new Set,Ji=new Set,ua=new Set,zo=new Map,bc={},sf=ba=>{const wc=zo.get(ba)||new Set;for(const nl of Ti)if((zo.get(nl)||new Set).has(ba)||wc.has(nl))return!0;return!1};for(const ba of Mn){const wc=_i.layers[ba];if(wc)for(let nl=0;nl<wc.length;nl++){const eu=wc.feature(nl);if(F(eu)){const{id:jl,center:Pl}=I(eu);O(bc,jl,Pl),Ti.add(jl)}else if(z(eu)){const{id:jl,isDefault:Pl,connections:i_,conflicts:kg,buildings:Ng,name:Ig,zIndex:ml}=R(eu);P(bc,Ng,jl,{name:Ig,zIndex:ml}),zo.set(jl,kg),(jl===gs||i_.has(gs))&&Ti.add(jl),Ji.add(jl),Pl&&ua.add(jl)}}else i.w(`indoor source layer not found: ${ba}`)}if(Yi)for(const ba of Yi)Ji.has(ba)&&(sf(ba)||Ti.add(ba));for(const ba of ua)Ti.has(ba)||sf(ba)||Ti.add(ba);return{buildings:bc,activeFloors:Ti}}(An,Xs,Rs.lastActiveFloors,Rs.selectedFloorId);return bs.send("setIndoorData",ks),ks}(fe,this.indoor,Ye);Ut.activeFloors=zr?wn.activeFloors:void 0}const Ar=[],Jr=ve.familiesBySource[this.source];for(const zr in Jr){const wn=fe.layers[zr];if(!wn)continue;let An=!1,Si=!1,bs=!1;for(const _i of Jr[zr])_i[0].type==="symbol"?An=!0:Si=!0,_i[0].is3D()&&_i[0].type!=="model"&&(bs=!0);if(this.extraShadowCaster&&!bs||this.isSymbolTile===!0&&!An||this.isSymbolTile===!1&&!Si)continue;wn.version===1&&i.w(`Vector tile source "${this.source}" layer "${zr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Xs=bt.encode(zr),Rs=[];let ks=!1;for(let _i=0,Mn=0;_i<wn.length;_i++){const Yi=wn.feature(_i),gs=ct.getId(Yi,zr);if(this.localizableLayerIds&&this.localizableLayerIds.has(zr)){const Ti=Yi.properties?Yi.properties.worldview:null;if(this.worldview&&typeof Ti=="string")if(Ti==="all")Yi.properties.$localized=!0;else{if(!Ti.split(",").includes(this.worldview))continue;Yi.properties.$localized=!0,Yi.properties.worldview=this.worldview}}!ks&&Yi.properties&&Yi.properties.hasOwnProperty(i.fo)&&(ks=!0),Rs.push({feature:Yi,id:gs,index:Mn,sourceLayerIndex:Xs}),Mn++}ks&&!Ut.elevationFeatures&&fe.layers.hasOwnProperty(i.fp)&&(Ut.elevationFeatures=i.fq.parseFrom(fe.layers[i.fp],this.canonical));for(const _i of Jr[zr]){const Mn=_i[0];if(this.extraShadowCaster&&(!Mn.is3D()||Mn.type==="model")||this.isSymbolTile!==void 0&&Mn.type==="symbol"!==this.isSymbolTile||Mn.minzoom&&this.zoom<Math.floor(Mn.minzoom)||Mn.maxzoom&&this.zoom>=Mn.maxzoom||Mn.visibility==="none")continue;W(_i,this.zoom,Ut.brightness,De,this.worldview);const Yi=_t[Mn.id]=Mn.createBucket({index:ct.bucketLayerIDs.length,layers:_i,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Xs,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Qe,worldview:this.worldview});ct.bucketLayerIDs.push(_i.map(Ti=>i.B(Ti.id,Ti.scope)));let gs=Yi.prepare?Yi.prepare():null;gs!=null?(gs=gs.then(()=>Yi.populate(Rs,Ut,this.tileID.canonical,this.tileTransform)),Ar.push(gs)):Yi.populate(Rs,Ut,this.tileID.canonical,this.tileTransform)}}const Zr=()=>{let zr,wn,An,Si,bs,Xs;Zt.trim();const Rs={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ks=()=>{if(zr)return this.status="done",ot(zr);if(this.extraShadowCaster)this.status="done",ot(null,{buckets:Object.values(_t).filter(Mn=>!Mn.isEmpty()),featureIndex:ct,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ut.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(wn&&An&&Si){const Mn=new A(wn),Yi=new Map;for(const[Ji,ua]of An.entries()){const{imagePosition:zo}=i.ft(Ji,ua,i.fu);Yi.set(Ji,zo)}const gs={};for(const Ji in _t){const ua=_t[Ji];ua instanceof i.b3&&(W(ua.layers,this.zoom,Ut.brightness,De,this.worldview),gs[Ji]=i.fv(ua,wn,Mn.positions,An,Yi,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,bs,this.worldview))}const Ti={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ye,An,bs,()=>{Ti.iconsPending=!1,_i(gs,Mn,Ti)}),this.rasterizeIfNeeded(Ye,Si,Xs,()=>{Ti.patternsPending=!1,_i(gs,Mn,Ti)})}},_i=(Mn,Yi,gs,Ti)=>{if(gs.iconsPending||gs.patternsPending)return;const Ji=new i.fw(An,Si,this.lut);for(const ua in _t){const zo=_t[ua];if(ua in Mn)i.fx(zo,Mn[ua],this.showCollisionBoxes,De,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,An,Ji);else if(zo.hasPattern&&(zo instanceof i.b9||zo instanceof i.ba||zo instanceof i.e9)){W(zo.layers,this.zoom,Ut.brightness,De,this.worldview);const bc=Object.fromEntries(Ji.patternPositions);zo.addFeatures(Ut,this.tileID.canonical,bc,De,this.tileTransform,this.brightness)}}this.status="done",ot(null,{buckets:Object.values(_t).filter(ua=>!ua.isEmpty()),featureIndex:ct,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Yi.image,lineAtlas:Zt,imageAtlas:Ji,brightness:Ut.brightness})};if(!this.extraShadowCaster){const Mn=i.fr(Ut.glyphDependencies,Ti=>Object.keys(Ti).map(Number));Object.keys(Mn).length?Ye.send("getGlyphs",{uid:this.uid,stacks:Mn},(Ti,Ji)=>{zr||(zr=Ti,wn=Ji,ks())},void 0,!1,Rs):wn={};const Yi=Array.from(Ut.iconDependencies.keys()).map(Ti=>i.I.parse(Ti));Yi.length?Ye.send("getImages",{images:Yi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Ti,Ji)=>{zr||(zr=Ti,An=new Map,bs=this.updateImageMapAndGetImageTaskQueue(An,Ji,Ut.iconDependencies),ks())},void 0,!1,Rs):(An=new Map,bs=new Map);const gs=Array.from(Ut.patternDependencies.keys()).map(Ti=>i.I.parse(Ti));gs.length?Ye.send("getImages",{images:gs,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Ti,Ji)=>{zr||(zr=Ti,Si=new Map,Xs=this.updateImageMapAndGetImageTaskQueue(Si,Ji,Ut.patternDependencies),ks())},void 0,!1,Rs):(Si=new Map,Xs=new Map)}if(Ut.elevationFeatures&&Ut.elevationFeatures.length>0){const Mn=[];for(const gs of Object.values(_t))if(gs instanceof i.ba){const Ti=gs.getUnevaluatedPortalGraph();Ti&&Mn.push(Ti)}const Yi=i.fs.evaluate(Mn);for(const gs of Object.values(_t))if(gs instanceof i.ba){const Ti=fe.layers[bt.decode(gs.sourceLayerIndex)];gs.setEvaluatedPortalGraph(Yi,Ti,this.tileID.canonical,Ut.availableImages,Ut.brightness)}}ks()};Ar.length>0?Promise.allSettled(Ar).then(Zr).catch(ot):Zr()}updateParameters(fe){this.scaleFactor=fe.scaleFactor,this.showCollisionBoxes=fe.showCollisionBoxes,this.projection=fe.projection,this.brightness=fe.brightness,this.tileTransform=i.aY(fe.tileID.canonical,fe.projection),this.extraShadowCaster=fe.extraShadowCaster,this.lut=fe.lut,this.worldview=fe.worldview,this.indoor=fe.indoor}rasterizeIfNeeded(fe,ve,De,Qe){Array.from(ve.values()).some(Ye=>Ye.usvg)?this.rasterize(fe,ve,De,Qe):Qe()}updateImageMapAndGetImageTaskQueue(fe,ve,De){const Qe=new Map;for(const Ye of ve.keys()){const ot=De.get(Ye)||[];for(const bt of ot){const ct=bt.toString(),_t=ve.get(bt.id.toString());_t.usvg?Qe.has(ct)||(Qe.set(ct,bt),fe.set(ct,Object.assign({},_t))):fe.set(ct,_t)}}return Qe}rasterize(fe,ve,De,Qe){this.rasterizeTask=fe.send("rasterizeImages",{scope:this.scope,tasks:De},(Ye,ot)=>{if(!Ye)for(const[bt,ct]of ot.entries()){const _t=Object.assign(ve.get(bt),{data:ct});ve.set(bt,_t)}Qe()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function W(ht,fe,ve,De,Qe){const Ye=new i.ac(fe,{brightness:ve,worldview:Qe});for(const ot of ht)ot.recalculate(Ye,De)}class K extends i.E{constructor(fe,ve,De,Qe,Ye,ot,bt){super(),this.actor=fe,this.layerIndex=ve,this.availableImages=De,this.availableModels=Qe,this.loadVectorData=ot||i.aL,this.loading={},this.loaded={},this.deduped=new i.aK(fe.scheduler),this.isSpriteLoaded=Ye,this.scheduler=fe.scheduler,this.brightness=bt}loadTile(fe,ve){const De=fe.uid,Qe=fe&&fe.request,Ye=Qe&&Qe.collectResourceTiming,ot=this.loading[De]=new $(fe);ot.abort=this.loadVectorData(fe,(bt,ct)=>{const _t=!this.loading[De];if(delete this.loading[De],ot.cancelRasterize(),_t||bt||!ct)return ot.status="done",_t||(this.loaded[De]=ot),ve(bt);const Zt=ct.rawData,Ut={},Ar=i.aM(ct.responseHeaders);Ar&&Ar.expires&&(Ut.expires=Ar.expires),Ar&&Ar.cacheControl&&(Ut.cacheControl=Ar.cacheControl),ot.vectorTile=ct.vectorTile||new i.fy(new i.bs(Zt));const Jr=()=>{ot.parse(ot.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Zr,zr)=>{if(Zr||!zr)return ve(Zr);const wn={};if(Ye){const An=m(Qe);An.length>0&&(wn.resourceTiming=JSON.parse(JSON.stringify(An)))}ve(null,Object.assign({rawTileData:Zt.slice(0),responseHeaders:ct.responseHeaders},zr,Ut,wn))})};this.isSpriteLoaded?Jr():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Jr,{type:"parseTile",isSymbolTile:fe.isSymbolTile,zoom:fe.tileZoom}):Jr()}),this.loaded=this.loaded||{},this.loaded[De]=ot})}reloadTile(fe,ve){const De=this.loaded,Qe=fe.uid;if(De&&De[Qe]){const Ye=De[Qe];Ye.updateParameters(fe);const ot=(bt,ct)=>{const _t=Ye.reloadCallback;_t&&(delete Ye.reloadCallback,Ye.parse(Ye.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,_t)),ve(bt,ct)};Ye.status==="parsing"?Ye.reloadCallback=ot:Ye.status==="done"&&(Ye.vectorTile?Ye.parse(Ye.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ot):ot())}else ve(null,void 0)}abortTile(fe,ve){const De=fe.uid,Qe=this.loading[De];Qe&&(Qe.abort&&Qe.abort(),delete this.loading[De]),ve()}removeTile(fe,ve){const De=this.loaded,Qe=fe.uid;De&&De[Qe]&&delete De[Qe],ve()}}class ee{loadTile(fe,ve){const{uid:De,encoding:Qe,rawImageData:Ye,padding:ot}=fe,bt=ImageBitmap&&Ye instanceof ImageBitmap?this.getImageData(Ye,ot):Ye;ve(null,new i.fz(De,bt,Qe,ot<1))}reloadTile(fe,ve){ve(null,null)}abortTile(fe,ve){ve()}removeTile(fe,ve){ve()}getImageData(fe,ve){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(fe.width,fe.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=fe.width,this.offscreenCanvas.height=fe.height,this.offscreenCanvasContext.drawImage(fe,0,0,fe.width,fe.height);const De=this.offscreenCanvasContext.getImageData(-ve,-ve,fe.width+2*ve,fe.height+2*ve);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),De}}i.br.setPbf(i.bs);class ne{constructor(fe){this._mrt=new i.br(fe.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=fe.uid,this.tileID=fe.tileID,this.source=fe.source}parse(fe,ve){const De=this._mrt;this.status="parsing",this._entireBuffer=fe;try{De.parseHeader(fe),this._isHeaderLoaded=!0;const Qe=[];for(const Ye in De.layers){const ot=De.getLayer(Ye),bt=ot.getDataRange(ot.getBandList()),ct=De.createDecodingTask(bt),_t=fe.slice(bt.firstByte,bt.lastByte+1),Zt=i.br.performDecoding(_t,ct).then(Ut=>ct.complete(null,Ut)).catch(Ut=>ct.complete(Ut,null));Qe.push(Zt)}Promise.allSettled(Qe).then(()=>ve(null,De)).catch(Ye=>ve(Ye))}catch(Qe){ve(Qe)}}}class ie{constructor(fe){this.actor=fe,this.loading={},this.loaded={}}loadTile(fe,ve){const De=fe.uid,Qe=fe.request,Ye=this.loading[De]=new ne(fe),{cancel:ot}=i.bt(Qe,(bt,ct,_t)=>{const Zt=!this.loading[De];if(delete this.loading[De],Zt||bt||!ct)return Ye.status="done",Zt||(this.loaded[De]=Ye),ve(bt);Ye.parse(ct,(Ut,Ar)=>{if(Ut||!Ar)return ve(Ut);ve(null,Ar,_t)}),this.loaded[De]=Ye});Ye.abort=ot}reloadTile(fe,ve){ve(null,void 0)}abortTile(fe,ve){const De=fe.uid,Qe=this.loading[De];Qe&&(Qe.abort&&Qe.abort(),delete this.loading[De]),ve()}removeTile(fe,ve){const De=fe.uid;this.loaded[De]&&delete this.loaded[De],ve()}decodeRasterArray(fe,ve){i.br.performDecoding(fe.buffer,fe.task).then(De=>ve(null,De)).catch(De=>ve(De))}}const re=i.fA.prototype.toGeoJSON;class te{constructor(fe){this._feature=fe,this.extent=i.al,this.type=fe.type,this.properties=fe.tags,"id"in fe&&!isNaN(fe.id)&&(this.id=parseInt(fe.id,10))}loadGeometry(){if(this._feature.type===1){const fe=[];for(const ve of this._feature.geometry)fe.push([new i.P(ve[0],ve[1])]);return fe}{const fe=[];for(const ve of this._feature.geometry){const De=[];for(const Qe of ve)De.push(new i.P(Qe[0],Qe[1]));fe.push(De)}return fe}}toGeoJSON(fe,ve,De){return re.call(this,fe,ve,De)}}class ae{constructor(fe,ve){this.name=fe,this.extent=i.al,this.length=ve.length,this._jsonFeatures=ve}feature(fe){return new te(this._jsonFeatures[fe])}}class ue{constructor(fe){this.layers={},this.extent=i.al;for(const ve of Object.keys(fe))this.layers[ve]=new ae(ve,fe[ve])}}const be=64/4096,we=128;class Ce{constructor(){this.features=new Map}clear(){this.features.clear()}load(fe=[],ve){for(const De of fe){const Qe=De.id;if(Qe==null)continue;let Ye=this.features.get(Qe);Ye&&this.updateCache(Ye,ve),De.geometry?(Ye=me(De),this.updateCache(Ye,ve),this.features.set(Qe,Ye)):this.features.delete(Qe),this.updateCache(Ye,ve)}}updateCache(fe,ve){for(const{canonical:De,uid:Qe}of Object.values(ve)){const{z:Ye,x:ot,y:bt}=De;_e(fe,Math.pow(2,Ye),ot,bt)&&delete ve[Qe]}}getTile(fe,ve,De){const Qe=Math.pow(2,fe),Ye=[];for(const ot of this.features.values())_e(ot,Qe,ve,De)&&Ye.push(Oe(ot,Qe,ve,De));return{features:Ye}}getFeatures(){return[...this.features.values()]}}function _e({minX:ht,minY:fe,maxX:ve,maxY:De},Qe,Ye,ot){return ht<(Ye+1+be)/Qe&&fe<(ot+1+be)/Qe&&ve>(Ye-be)/Qe&&De>(ot-be)/Qe}function me(ht){const{id:fe,geometry:ve,properties:De}=ht;if(!ve)return;if(ve.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Qe,coordinates:Ye}=ve,ot={id:fe,type:1,geometry:[],tags:De,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},bt=ot.geometry;if(Qe==="Point")Ae(Ye,bt,ot);else if(Qe==="MultiPoint")for(const ct of Ye)Ae(ct,bt,ot);else if(Qe==="LineString")ot.type=2,ge(Ye,bt,ot);else if(Qe==="MultiLineString")ot.type=2,pe(Ye,bt,ot);else if(Qe==="Polygon")ot.type=3,pe(Ye,bt,ot,!0);else{if(Qe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");ot.type=3;for(const ct of Ye)pe(ct,bt,ot,!0)}return ot}function Ae([ht,fe],ve,De){const Qe=i.aF(ht);let Ye=i.aJ(fe);Ye=Ye<0?0:Ye>1?1:Ye,ve.push(Qe,Ye),De.minX=Math.min(De.minX,Qe),De.minY=Math.min(De.minY,Ye),De.maxX=Math.max(De.maxX,Qe),De.maxY=Math.max(De.maxY,Ye)}function ge(ht,fe,ve,De=!1,Qe=!1){const Ye=[];for(const ot of ht)Ae(ot,Ye,ve);fe.push(Ye),De&&function(ot,bt){let ct=0;for(let _t=0,Zt=ot.length,Ut=Zt-2;_t<Zt;Ut=_t,_t+=2)ct+=(ot[_t]-ot[Ut])*(ot[_t+1]+ot[Ut+1]);if(ct>0===bt)for(let _t=0,Zt=ot.length;_t<Zt/2;_t+=2){const Ut=ot[_t],Ar=ot[_t+1];ot[_t]=ot[Zt-2-_t],ot[_t+1]=ot[Zt-1-_t],ot[Zt-2-_t]=Ut,ot[Zt-1-_t]=Ar}}(Ye,Qe)}function pe(ht,fe,ve,De=!1){for(let Qe=0;Qe<ht.length;Qe++)ge(ht[Qe],fe,ve,De,Qe===0)}function Oe(ht,fe,ve,De){const{id:Qe,type:Ye,geometry:ot,tags:bt}=ht,ct=[];if(Ye===1)(function(_t,Zt,Ut,Ar,Jr){for(let Zr=0;Zr<_t.length;Zr+=2){const zr=Math.round(i.al*(_t[Zr+0]*Zt-Ut)),wn=Math.round(i.al*(_t[Zr+1]*Zt-Ar));Jr.push([zr,wn])}})(ot,fe,ve,De,ct);else for(const _t of ot)Je(_t,fe,ve,De,ct);return{id:Qe,type:Ye,geometry:ct,tags:bt}}function Je(ht,fe,ve,De,Qe){const Ye=-we,ot=i.al+we;let bt;for(let ct=0;ct<ht.length-2;ct+=2){let _t=Math.round(i.al*(ht[ct+0]*fe-ve)),Zt=Math.round(i.al*(ht[ct+1]*fe-De)),Ut=Math.round(i.al*(ht[ct+2]*fe-ve)),Ar=Math.round(i.al*(ht[ct+3]*fe-De));const Jr=Ut-_t,Zr=Ar-Zt;_t<Ye&&Ut<Ye||(_t<Ye?(Zt+=Math.round(Zr*((Ye-_t)/Jr)),_t=Ye):Ut<Ye&&(Ar=Zt+Math.round(Zr*((Ye-_t)/Jr)),Ut=Ye),Zt<Ye&&Ar<Ye||(Zt<Ye?(_t+=Math.round(Jr*((Ye-Zt)/Zr)),Zt=Ye):Ar<Ye&&(Ut=_t+Math.round(Jr*((Ye-Zt)/Zr)),Ar=Ye),_t>=ot&&Ut>=ot||(_t>=ot?(Zt+=Math.round(Zr*((ot-_t)/Jr)),_t=ot):Ut>=ot&&(Ar=Zt+Math.round(Zr*((ot-_t)/Jr)),Ut=ot),Zt>=ot&&Ar>=ot||(Zt>=ot?(_t+=Math.round(Jr*((ot-Zt)/Zr)),Zt=ot):Ar>=ot&&(Ut=_t+Math.round(Jr*((ot-Zt)/Zr)),Ar=ot),bt&&_t===bt[bt.length-1][0]&&Zt===bt[bt.length-1][1]||(bt=[[_t,Zt]],Qe.push(bt)),bt.push([Ut,Ar])))))}}function Ze({name:ht,features:fe},ve){ve.writeStringField(1,ht),ve.writeVarintField(5,i.al);const De=new Map,Qe=new Map,Ye={keys:De,values:Qe,feature:null};for(const ot of fe)Ye.feature=ot,ve.writeMessage(2,Pe,Ye);for(const ot of De.keys())ve.writeStringField(3,ot);for(const ot of Qe.keys())ve.writeMessage(4,gt,ot)}function Pe(ht,fe){const ve=ht.feature;ve.id!==void 0&&Number.isSafeInteger(+ve.id)&&fe.writeVarintField(1,+ve.id),ve.tags&&fe.writeMessage(2,Be,ht),fe.writeVarintField(3,ve.type),fe.writeMessage(4,We,ve)}function Be({keys:ht,values:fe,feature:ve},De){for(const Qe of Object.keys(ve.tags)){let Ye=ve.tags[Qe];if(Ye===null)continue;let ot=ht.get(Qe);ot===void 0&&(ot=ht.size,ht.set(Qe,ot)),De.writeVarint(ot);const bt=typeof Ye;bt!=="string"&&bt!=="boolean"&&bt!=="number"&&(Ye=JSON.stringify(Ye));let ct=fe.get(Ye);ct===void 0&&(ct=fe.size,fe.set(Ye,ct)),De.writeVarint(ct)}}function nt(ht,fe){return(fe<<3)+(7&ht)}function Me(ht){return ht<<1^ht>>31}function We(ht,fe){const{geometry:ve,type:De}=ht;let Qe=0,Ye=0;if(De===1){fe.writeVarint(nt(1,ve.length));for(const ot of ve){const bt=ot[0]-Qe,ct=ot[1]-Ye;fe.writeVarint(Me(bt)),fe.writeVarint(Me(ct)),Qe+=bt,Ye+=ct}}else for(const ot of ve){fe.writeVarint(nt(1,1));const bt=ot.length-(De===3?1:0);for(let ct=0;ct<bt;ct++){ct===1&&fe.writeVarint(nt(2,bt-1));const _t=ot[ct][0]-Qe,Zt=ot[ct][1]-Ye;fe.writeVarint(Me(_t)),fe.writeVarint(Me(Zt)),Qe+=_t,Ye+=Zt}De===3&&fe.writeVarint(nt(7,1))}}function gt(ht,fe){const ve=typeof ht;ve==="string"?fe.writeStringField(1,ht):ve==="boolean"?fe.writeBooleanField(7,ht):ve==="number"&&(ht%1!=0?fe.writeDoubleField(3,ht):ht<0?fe.writeSVarintField(6,ht):fe.writeVarintField(5,ht))}const rt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ht=>ht},Ht=Math.fround||(Lt=new Float32Array(1),ht=>(Lt[0]=+ht,Lt[0]));var Lt;const nr=3,Rr=5,Dr=6;class Pt{constructor(fe){this.options=Object.assign(Object.create(rt),fe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(fe){const{log:ve,minZoom:De,maxZoom:Qe}=this.options;ve&&console.time("total time");const Ye=`prepare ${fe.length} points`;ve&&console.time(Ye),this.points=fe;const ot=[];for(let ct=0;ct<fe.length;ct++){const _t=fe[ct];if(!_t.geometry)continue;const[Zt,Ut]=_t.geometry.coordinates,Ar=Ht(lt(Zt)),Jr=Ht(ut(Ut));ot.push(Ar,Jr,1/0,ct,-1,1),this.options.reduce&&ot.push(0)}let bt=this.trees[Qe+1]=this._createTree(ot);ve&&console.timeEnd(Ye);for(let ct=Qe;ct>=De;ct--){const _t=+Date.now();bt=this.trees[ct]=this._createTree(this._cluster(bt,ct)),ve&&console.log("z%d: %d clusters in %dms",ct,bt.numItems,+Date.now()-_t)}return ve&&console.timeEnd("total time"),this}getClusters(fe,ve){let De=((fe[0]+180)%360+360)%360-180;const Qe=Math.max(-90,Math.min(90,fe[1]));let Ye=fe[2]===180?180:((fe[2]+180)%360+360)%360-180;const ot=Math.max(-90,Math.min(90,fe[3]));if(fe[2]-fe[0]>=360)De=-180,Ye=180;else if(De>Ye){const Ut=this.getClusters([De,Qe,180,ot],ve),Ar=this.getClusters([-180,Qe,Ye,ot],ve);return Ut.concat(Ar)}const bt=this.trees[this._limitZoom(ve)],ct=bt.range(lt(De),ut(ot),lt(Ye),ut(Qe)),_t=bt.data,Zt=[];for(const Ut of ct){const Ar=this.stride*Ut;Zt.push(_t[Ar+Rr]>1?wt(_t,Ar,this.clusterProps):this.points[_t[Ar+nr]])}return Zt}getChildren(fe){const ve=this._getOriginId(fe),De=this._getOriginZoom(fe),Qe="No cluster with the specified id.",Ye=this.trees[De];if(!Ye)throw new Error(Qe);const ot=Ye.data;if(ve*this.stride>=ot.length)throw new Error(Qe);const bt=this.options.radius/(this.options.extent*Math.pow(2,De-1)),ct=Ye.within(ot[ve*this.stride],ot[ve*this.stride+1],bt),_t=[];for(const Zt of ct){const Ut=Zt*this.stride;ot[Ut+4]===fe&&_t.push(ot[Ut+Rr]>1?wt(ot,Ut,this.clusterProps):this.points[ot[Ut+nr]])}if(_t.length===0)throw new Error(Qe);return _t}getLeaves(fe,ve,De){const Qe=[];return this._appendLeaves(Qe,fe,ve=ve||10,De=De||0,0),Qe}getTile(fe,ve,De){const Qe=this.trees[this._limitZoom(fe)],Ye=Math.pow(2,fe),{extent:ot,radius:bt}=this.options,ct=bt/ot,_t=(De-ct)/Ye,Zt=(De+1+ct)/Ye,Ut={features:[]};return this._addTileFeatures(Qe.range((ve-ct)/Ye,_t,(ve+1+ct)/Ye,Zt),Qe.data,ve,De,Ye,Ut),ve===0&&this._addTileFeatures(Qe.range(1-ct/Ye,_t,1,Zt),Qe.data,Ye,De,Ye,Ut),ve===Ye-1&&this._addTileFeatures(Qe.range(0,_t,ct/Ye,Zt),Qe.data,-1,De,Ye,Ut),Ut.features.length?Ut:null}getClusterExpansionZoom(fe){let ve=this._getOriginZoom(fe)-1;for(;ve<=this.options.maxZoom;){const De=this.getChildren(fe);if(ve++,De.length!==1)break;fe=De[0].properties.cluster_id}return ve}_appendLeaves(fe,ve,De,Qe,Ye){const ot=this.getChildren(ve);for(const bt of ot){const ct=bt.properties;if(ct&&ct.cluster?Ye+ct.point_count<=Qe?Ye+=ct.point_count:Ye=this._appendLeaves(fe,ct.cluster_id,De,Qe,Ye):Ye<Qe?Ye++:fe.push(bt),fe.length===De)break}return Ye}_createTree(fe){const ve=new i.c3(fe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let De=0;De<fe.length;De+=this.stride)ve.add(fe[De],fe[De+1]);return ve.finish(),ve.data=fe,ve}_addTileFeatures(fe,ve,De,Qe,Ye,ot){for(const bt of fe){const ct=bt*this.stride,_t=ve[ct+Rr]>1;let Zt,Ut,Ar;if(_t)Zt=He(ve,ct,this.clusterProps),Ut=ve[ct],Ar=ve[ct+1];else{const zr=this.points[ve[ct+nr]];Zt=zr.properties;const[wn,An]=zr.geometry.coordinates;Ut=lt(wn),Ar=ut(An)}const Jr={type:1,geometry:[[Math.round(this.options.extent*(Ut*Ye-De)),Math.round(this.options.extent*(Ar*Ye-Qe))]],tags:Zt};let Zr;Zr=_t||this.options.generateId?ve[ct+nr]:this.points[ve[ct+nr]].id,Zr!==void 0&&(Jr.id=Zr),ot.features.push(Jr)}}_limitZoom(fe){return Math.max(this.options.minZoom,Math.min(Math.floor(+fe),this.options.maxZoom+1))}_cluster(fe,ve){const{radius:De,extent:Qe,reduce:Ye,minPoints:ot}=this.options,bt=De/(Qe*Math.pow(2,ve)),ct=fe.data,_t=[],Zt=this.stride;for(let Ut=0;Ut<ct.length;Ut+=Zt){if(ct[Ut+2]<=ve)continue;ct[Ut+2]=ve;const Ar=ct[Ut],Jr=ct[Ut+1],Zr=fe.within(ct[Ut],ct[Ut+1],bt),zr=ct[Ut+Rr];let wn=zr;for(const An of Zr){const Si=An*Zt;ct[Si+2]>ve&&(wn+=ct[Si+Rr])}if(wn>zr&&wn>=ot){let An,Si=Ar*zr,bs=Jr*zr,Xs=-1;const Rs=(Ut/Zt<<5)+(ve+1)+this.points.length;for(const ks of Zr){const _i=ks*Zt;if(ct[_i+2]<=ve)continue;ct[_i+2]=ve;const Mn=ct[_i+Rr];Si+=ct[_i]*Mn,bs+=ct[_i+1]*Mn,ct[_i+4]=Rs,Ye&&(An||(An=this._map(ct,Ut,!0),Xs=this.clusterProps.length,this.clusterProps.push(An)),Ye(An,this._map(ct,_i)))}ct[Ut+4]=Rs,_t.push(Si/wn,bs/wn,1/0,Rs,-1,wn),Ye&&_t.push(Xs)}else{for(let An=0;An<Zt;An++)_t.push(ct[Ut+An]);if(wn>1)for(const An of Zr){const Si=An*Zt;if(!(ct[Si+2]<=ve)){ct[Si+2]=ve;for(let bs=0;bs<Zt;bs++)_t.push(ct[Si+bs])}}}}return _t}_getOriginId(fe){return fe-this.points.length>>5}_getOriginZoom(fe){return(fe-this.points.length)%32}_map(fe,ve,De){if(fe[ve+Rr]>1){const ot=this.clusterProps[fe[ve+Dr]];return De?Object.assign({},ot):ot}const Qe=this.points[fe[ve+nr]].properties,Ye=this.options.map(Qe);return De&&Ye===Qe?Object.assign({},Ye):Ye}}function wt(ht,fe,ve){return{type:"Feature",id:ht[fe+nr],properties:He(ht,fe,ve),geometry:{type:"Point",coordinates:[(De=ht[fe],360*(De-.5)),sr(ht[fe+1])]}};var De}function He(ht,fe,ve){const De=ht[fe+Rr],Qe=De>=1e4?`${Math.round(De/1e3)}k`:De>=1e3?Math.round(De/100)/10+"k":De,Ye=ht[fe+Dr],ot=Ye===-1?{}:Object.assign({},ve[Ye]);return Object.assign(ot,{cluster:!0,cluster_id:ht[fe+nr],point_count:De,point_count_abbreviated:Qe})}function lt(ht){return ht/360+.5}function ut(ht){const fe=Math.sin(ht*Math.PI/180),ve=.5-.25*Math.log((1+fe)/(1-fe))/Math.PI;return ve<0?0:ve>1?1:ve}function sr(ht){const fe=(180-360*ht)*Math.PI/180;return 360*Math.atan(Math.exp(fe))/Math.PI-90}function Qt(ht,fe,ve,De){let Qe=De;const Ye=fe+(ve-fe>>1);let ot,bt=ve-fe;const ct=ht[fe],_t=ht[fe+1],Zt=ht[ve],Ut=ht[ve+1];for(let Ar=fe+3;Ar<ve;Ar+=3){const Jr=er(ht[Ar],ht[Ar+1],ct,_t,Zt,Ut);if(Jr>Qe)ot=Ar,Qe=Jr;else if(Jr===Qe){const Zr=Math.abs(Ar-Ye);Zr<bt&&(ot=Ar,bt=Zr)}}Qe>De&&(ot-fe>3&&Qt(ht,fe,ot,De),ht[ot+2]=Qe,ve-ot>3&&Qt(ht,ot,ve,De))}function er(ht,fe,ve,De,Qe,Ye){let ot=Qe-ve,bt=Ye-De;if(ot!==0||bt!==0){const ct=((ht-ve)*ot+(fe-De)*bt)/(ot*ot+bt*bt);ct>1?(ve=Qe,De=Ye):ct>0&&(ve+=ot*ct,De+=bt*ct)}return ot=ht-ve,bt=fe-De,ot*ot+bt*bt}function Cr(ht,fe,ve,De){const Qe={id:ht??null,type:fe,geometry:ve,tags:De,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")dn(Qe,ve);else if(fe==="Polygon")dn(Qe,ve[0]);else if(fe==="MultiLineString")for(const Ye of ve)dn(Qe,Ye);else if(fe==="MultiPolygon")for(const Ye of ve)dn(Qe,Ye[0]);return Qe}function dn(ht,fe){for(let ve=0;ve<fe.length;ve+=3)ht.minX=Math.min(ht.minX,fe[ve]),ht.minY=Math.min(ht.minY,fe[ve+1]),ht.maxX=Math.max(ht.maxX,fe[ve]),ht.maxY=Math.max(ht.maxY,fe[ve+1])}function fn(ht,fe,ve,De){if(!fe.geometry)return;const Qe=fe.geometry.coordinates;if(Qe&&Qe.length===0)return;const Ye=fe.geometry.type,ot=Math.pow(ve.tolerance/((1<<ve.maxZoom)*ve.extent),2);let bt=[],ct=fe.id;if(ve.promoteId?ct=fe.properties[ve.promoteId]:ve.generateId&&(ct=De||0),Ye==="Point")Zn(Qe,bt);else if(Ye==="MultiPoint")for(const _t of Qe)Zn(_t,bt);else if(Ye==="LineString")Gn(Qe,bt,ot,!1);else if(Ye==="MultiLineString"){if(ve.lineMetrics){for(const _t of Qe)bt=[],Gn(_t,bt,ot,!1),ht.push(Cr(ct,"LineString",bt,fe.properties));return}Di(Qe,bt,ot,!1)}else if(Ye==="Polygon")Di(Qe,bt,ot,!0);else{if(Ye!=="MultiPolygon"){if(Ye==="GeometryCollection"){for(const _t of fe.geometry.geometries)fn(ht,{id:ct,geometry:_t,properties:fe.properties},ve,De);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const _t of Qe){const Zt=[];Di(_t,Zt,ot,!0),bt.push(Zt)}}ht.push(Cr(ct,Ye,bt,fe.properties))}function Zn(ht,fe){fe.push(ka(ht[0]),xs(ht[1]),0)}function Gn(ht,fe,ve,De){let Qe,Ye,ot=0;for(let ct=0;ct<ht.length;ct++){const _t=ka(ht[ct][0]),Zt=xs(ht[ct][1]);fe.push(_t,Zt,0),ct>0&&(ot+=De?(Qe*Zt-_t*Ye)/2:Math.sqrt(Math.pow(_t-Qe,2)+Math.pow(Zt-Ye,2))),Qe=_t,Ye=Zt}const bt=fe.length-3;fe[2]=1,Qt(fe,0,bt,ve),fe[bt+2]=1,fe.size=Math.abs(ot),fe.start=0,fe.end=fe.size}function Di(ht,fe,ve,De){for(let Qe=0;Qe<ht.length;Qe++){const Ye=[];Gn(ht[Qe],Ye,ve,De),fe.push(Ye)}}function ka(ht){return ht/360+.5}function xs(ht){const fe=Math.sin(ht*Math.PI/180),ve=.5-.25*Math.log((1+fe)/(1-fe))/Math.PI;return ve<0?0:ve>1?1:ve}function mi(ht,fe,ve,De,Qe,Ye,ot,bt){if(De/=fe,Ye>=(ve/=fe)&&ot<De)return ht;if(ot<ve||Ye>=De)return null;const ct=[];for(const _t of ht){const Zt=_t.geometry;let Ut=_t.type;const Ar=Qe===0?_t.minX:_t.minY,Jr=Qe===0?_t.maxX:_t.maxY;if(Ar>=ve&&Jr<De){ct.push(_t);continue}if(Jr<ve||Ar>=De)continue;let Zr=[];if(Ut==="Point"||Ut==="MultiPoint")Ua(Zt,Zr,ve,De,Qe);else if(Ut==="LineString")Va(Zt,Zr,ve,De,Qe,!1,bt.lineMetrics);else if(Ut==="MultiLineString")qa(Zt,Zr,ve,De,Qe,!1);else if(Ut==="Polygon")qa(Zt,Zr,ve,De,Qe,!0);else if(Ut==="MultiPolygon")for(const zr of Zt){const wn=[];qa(zr,wn,ve,De,Qe,!0),wn.length&&Zr.push(wn)}if(Zr.length){if(bt.lineMetrics&&Ut==="LineString"){for(const zr of Zr)ct.push(Cr(_t.id,Ut,zr,_t.tags));continue}Ut!=="LineString"&&Ut!=="MultiLineString"||(Zr.length===1?(Ut="LineString",Zr=Zr[0]):Ut="MultiLineString"),Ut!=="Point"&&Ut!=="MultiPoint"||(Ut=Zr.length===3?"Point":"MultiPoint"),ct.push(Cr(_t.id,Ut,Zr,_t.tags))}}return ct.length?ct:null}function Ua(ht,fe,ve,De,Qe){for(let Ye=0;Ye<ht.length;Ye+=3){const ot=ht[Ye+Qe];ot>=ve&&ot<=De&&Ha(fe,ht[Ye],ht[Ye+1],ht[Ye+2])}}function Va(ht,fe,ve,De,Qe,Ye,ot){let bt=Lo(ht);const ct=Qe===0?Fi:Ks;let _t,Zt,Ut=ht.start;for(let wn=0;wn<ht.length-3;wn+=3){const An=ht[wn],Si=ht[wn+1],bs=ht[wn+2],Xs=ht[wn+3],Rs=ht[wn+4],ks=Qe===0?An:Si,_i=Qe===0?Xs:Rs;let Mn=!1;ot&&(_t=Math.sqrt(Math.pow(An-Xs,2)+Math.pow(Si-Rs,2))),ks<ve?_i>ve&&(Zt=ct(bt,An,Si,Xs,Rs,ve),ot&&(bt.start=Ut+_t*Zt)):ks>De?_i<De&&(Zt=ct(bt,An,Si,Xs,Rs,De),ot&&(bt.start=Ut+_t*Zt)):Ha(bt,An,Si,bs),_i<ve&&ks>=ve&&(Zt=ct(bt,An,Si,Xs,Rs,ve),Mn=!0),_i>De&&ks<=De&&(Zt=ct(bt,An,Si,Xs,Rs,De),Mn=!0),!Ye&&Mn&&(ot&&(bt.end=Ut+_t*Zt),fe.push(bt),bt=Lo(ht)),ot&&(Ut+=_t)}let Ar=ht.length-3;const Jr=ht[Ar],Zr=ht[Ar+1],zr=Qe===0?Jr:Zr;zr>=ve&&zr<=De&&Ha(bt,Jr,Zr,ht[Ar+2]),Ar=bt.length-3,Ye&&Ar>=3&&(bt[Ar]!==bt[0]||bt[Ar+1]!==bt[1])&&Ha(bt,bt[0],bt[1],bt[2]),bt.length&&fe.push(bt)}function Lo(ht){const fe=[];return fe.size=ht.size,fe.start=ht.start,fe.end=ht.end,fe}function qa(ht,fe,ve,De,Qe,Ye){for(const ot of ht)Va(ot,fe,ve,De,Qe,Ye,!1)}function Ha(ht,fe,ve,De){ht.push(fe,ve,De)}function Fi(ht,fe,ve,De,Qe,Ye){const ot=(Ye-fe)/(De-fe);return Ha(ht,Ye,ve+(Qe-ve)*ot,1),ot}function Ks(ht,fe,ve,De,Qe,Ye){const ot=(Ye-ve)/(Qe-ve);return Ha(ht,fe+(De-fe)*ot,Ye,1),ot}function rl(ht,fe){const ve=[];for(let De=0;De<ht.length;De++){const Qe=ht[De],Ye=Qe.type;let ot;if(Ye==="Point"||Ye==="MultiPoint"||Ye==="LineString")ot=xa(Qe.geometry,fe);else if(Ye==="MultiLineString"||Ye==="Polygon"){ot=[];for(const bt of Qe.geometry)ot.push(xa(bt,fe))}else if(Ye==="MultiPolygon"){ot=[];for(const bt of Qe.geometry){const ct=[];for(const _t of bt)ct.push(xa(_t,fe));ot.push(ct)}}ve.push(Cr(Qe.id,Ye,ot,Qe.tags))}return ve}function xa(ht,fe){const ve=[];ve.size=ht.size,ht.start!==void 0&&(ve.start=ht.start,ve.end=ht.end);for(let De=0;De<ht.length;De+=3)ve.push(ht[De]+fe,ht[De+1],ht[De+2]);return ve}function so(ht,fe){if(ht.transformed)return ht;const ve=1<<ht.z,De=ht.x,Qe=ht.y;for(const Ye of ht.features){const ot=Ye.geometry,bt=Ye.type;if(Ye.geometry=[],bt===1)for(let ct=0;ct<ot.length;ct+=2)Ye.geometry.push(Ln(ot[ct],ot[ct+1],fe,ve,De,Qe));else for(let ct=0;ct<ot.length;ct++){const _t=[];for(let Zt=0;Zt<ot[ct].length;Zt+=2)_t.push(Ln(ot[ct][Zt],ot[ct][Zt+1],fe,ve,De,Qe));Ye.geometry.push(_t)}}return ht.transformed=!0,ht}function Ln(ht,fe,ve,De,Qe,Ye){return[Math.round(ve*(ht*De-Qe)),Math.round(ve*(fe*De-Ye))]}function zi(ht,fe,ve,De,Qe){const Ye=fe===Qe.maxZoom?0:Qe.tolerance/((1<<fe)*Qe.extent),ot={features:[],numPoints:0,numSimplified:0,numFeatures:ht.length,source:null,x:ve,y:De,z:fe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const bt of ht)ms(ot,bt,Ye,Qe);return ot}function ms(ht,fe,ve,De){const Qe=fe.geometry,Ye=fe.type,ot=[];if(ht.minX=Math.min(ht.minX,fe.minX),ht.minY=Math.min(ht.minY,fe.minY),ht.maxX=Math.max(ht.maxX,fe.maxX),ht.maxY=Math.max(ht.maxY,fe.maxY),Ye==="Point"||Ye==="MultiPoint")for(let bt=0;bt<Qe.length;bt+=3)ot.push(Qe[bt],Qe[bt+1]),ht.numPoints++,ht.numSimplified++;else if(Ye==="LineString")Ga(ot,Qe,ht,ve,!1,!1);else if(Ye==="MultiLineString"||Ye==="Polygon")for(let bt=0;bt<Qe.length;bt++)Ga(ot,Qe[bt],ht,ve,Ye==="Polygon",bt===0);else if(Ye==="MultiPolygon")for(let bt=0;bt<Qe.length;bt++){const ct=Qe[bt];for(let _t=0;_t<ct.length;_t++)Ga(ot,ct[_t],ht,ve,!0,_t===0)}if(ot.length){let bt=fe.tags||null;if(Ye==="LineString"&&De.lineMetrics){bt={};for(const _t in fe.tags)bt[_t]=fe.tags[_t];bt.mapbox_clip_start=Qe.start/Qe.size,bt.mapbox_clip_end=Qe.end/Qe.size}const ct={geometry:ot,type:Ye==="Polygon"||Ye==="MultiPolygon"?3:Ye==="LineString"||Ye==="MultiLineString"?2:1,tags:bt};fe.id!==null&&(ct.id=fe.id),ht.features.push(ct)}}function Ga(ht,fe,ve,De,Qe,Ye){const ot=De*De;if(De>0&&fe.size<(Qe?ot:De))return void(ve.numPoints+=fe.length/3);const bt=[];for(let ct=0;ct<fe.length;ct+=3)(De===0||fe[ct+2]>ot)&&(ve.numSimplified++,bt.push(fe[ct],fe[ct+1])),ve.numPoints++;Qe&&function(ct,_t){let Zt=0;for(let Ut=0,Ar=ct.length,Jr=Ar-2;Ut<Ar;Jr=Ut,Ut+=2)Zt+=(ct[Ut]-ct[Jr])*(ct[Ut+1]+ct[Jr+1]);if(Zt>0===_t)for(let Ut=0,Ar=ct.length;Ut<Ar/2;Ut+=2){const Jr=ct[Ut],Zr=ct[Ut+1];ct[Ut]=ct[Ar-2-Ut],ct[Ut+1]=ct[Ar-1-Ut],ct[Ar-2-Ut]=Jr,ct[Ar-1-Ut]=Zr}}(bt,Ye),ht.push(bt)}const st={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class yn{constructor(fe,ve){const De=(ve=this.options=function(Ye,ot){for(const bt in ot)Ye[bt]=ot[bt];return Ye}(Object.create(st),ve)).debug;if(De&&console.time("preprocess data"),ve.maxZoom<0||ve.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ve.promoteId&&ve.generateId)throw new Error("promoteId and generateId cannot be used together.");let Qe=function(Ye,ot){const bt=[];if(Ye.type==="FeatureCollection")for(let ct=0;ct<Ye.features.length;ct++)fn(bt,Ye.features[ct],ot,ct);else fn(bt,Ye.type==="Feature"?Ye:{geometry:Ye},ot);return bt}(fe,ve);this.tiles={},this.tileCoords=[],De&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ve.indexMaxZoom,ve.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Qe=function(Ye,ot){const bt=ot.buffer/ot.extent;let ct=Ye;const _t=mi(Ye,1,-1-bt,bt,0,-1,2,ot),Zt=mi(Ye,1,1-bt,2+bt,0,-1,2,ot);return(_t||Zt)&&(ct=mi(Ye,1,-bt,1+bt,0,-1,2,ot)||[],_t&&(ct=rl(_t,1).concat(ct)),Zt&&(ct=ct.concat(rl(Zt,-1)))),ct}(Qe,ve),Qe.length&&this.splitTile(Qe,0,0,0),De&&(Qe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(fe,ve,De,Qe,Ye,ot,bt){const ct=[fe,ve,De,Qe],_t=this.options,Zt=_t.debug;for(;ct.length;){Qe=ct.pop(),De=ct.pop(),ve=ct.pop(),fe=ct.pop();const Ut=1<<ve,Ar=Zs(ve,De,Qe);let Jr=this.tiles[Ar];if(!Jr&&(Zt>1&&console.time("creation"),Jr=this.tiles[Ar]=zi(fe,ve,De,Qe,_t),this.tileCoords.push({z:ve,x:De,y:Qe}),Zt)){Zt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ve,De,Qe,Jr.numFeatures,Jr.numPoints,Jr.numSimplified),console.timeEnd("creation"));const Mn=`z${ve}`;this.stats[Mn]=(this.stats[Mn]||0)+1,this.total++}if(Jr.source=fe,Ye==null){if(ve===_t.indexMaxZoom||Jr.numPoints<=_t.indexMaxPoints)continue}else{if(ve===_t.maxZoom||ve===Ye)continue;if(Ye!=null){const Mn=Ye-ve;if(De!==ot>>Mn||Qe!==bt>>Mn)continue}}if(Jr.source=null,fe.length===0)continue;Zt>1&&console.time("clipping");const Zr=.5*_t.buffer/_t.extent,zr=.5-Zr,wn=.5+Zr,An=1+Zr;let Si=null,bs=null,Xs=null,Rs=null,ks=mi(fe,Ut,De-Zr,De+wn,0,Jr.minX,Jr.maxX,_t),_i=mi(fe,Ut,De+zr,De+An,0,Jr.minX,Jr.maxX,_t);fe=null,ks&&(Si=mi(ks,Ut,Qe-Zr,Qe+wn,1,Jr.minY,Jr.maxY,_t),bs=mi(ks,Ut,Qe+zr,Qe+An,1,Jr.minY,Jr.maxY,_t),ks=null),_i&&(Xs=mi(_i,Ut,Qe-Zr,Qe+wn,1,Jr.minY,Jr.maxY,_t),Rs=mi(_i,Ut,Qe+zr,Qe+An,1,Jr.minY,Jr.maxY,_t),_i=null),Zt>1&&console.timeEnd("clipping"),ct.push(Si||[],ve+1,2*De,2*Qe),ct.push(bs||[],ve+1,2*De,2*Qe+1),ct.push(Xs||[],ve+1,2*De+1,2*Qe),ct.push(Rs||[],ve+1,2*De+1,2*Qe+1)}}getTile(fe,ve,De){fe=+fe,ve=+ve,De=+De;const Qe=this.options,{extent:Ye,debug:ot}=Qe;if(fe<0||fe>24)return null;const bt=1<<fe,ct=Zs(fe,ve=ve+bt&bt-1,De);if(this.tiles[ct])return so(this.tiles[ct],Ye);ot>1&&console.log("drilling down to z%d-%d-%d",fe,ve,De);let _t,Zt=fe,Ut=ve,Ar=De;for(;!_t&&Zt>0;)Zt--,Ut>>=1,Ar>>=1,_t=this.tiles[Zs(Zt,Ut,Ar)];return _t&&_t.source?(ot>1&&(console.log("found parent tile z%d-%d-%d",Zt,Ut,Ar),console.time("drilling down")),this.splitTile(_t.source,Zt,Ut,Ar,fe,ve,De),ot>1&&console.timeEnd("drilling down"),this.tiles[ct]?so(this.tiles[ct],Ye):null):null}}function Zs(ht,fe,ve){return 32*((1<<ht)*ve+fe)+ht}function Na(ht,fe){const ve=ht.tileID.canonical;if(!this._geoJSONIndex)return void fe(null,null);const De=this._geoJSONIndex.getTile(ve.z,ve.x,ve.y);if(!De)return void fe(null,null);const Qe=_t=>_t.tags&&"3d_elevation_id"in _t.tags&&"source"in _t.tags&&_t.tags.source==="elevation",Ye=De.features.filter(_t=>Qe(_t));let ot={_geojsonTileLayer:De.features};Ye.length>0&&(ot={_geojsonTileLayer:De.features.filter(_t=>!Qe(_t)),hd_road_elevation:Ye});const bt=new ue(ot),ct=function(_t){const Zt=new i.bs;for(const Ut of Object.keys(_t))Zt.writeMessage(3,Ze,{name:Ut,features:_t[Ut]});return Zt.finish()}(ot).buffer;fe(null,{vectorTile:bt,rawData:ct})}class _n extends K{constructor(fe,ve,De,Qe,Ye,ot,bt){super(fe,ve,De,Qe,Ye,Na,bt),ot&&(this.loadGeoJSON=ot),this._dynamicIndex=new Ce}loadData(fe,ve){const De=fe&&fe.request,Qe=De&&De.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(fe,(Ye,ot)=>{if(Ye||!ot)return ve(Ye);if(typeof ot!="object")return ve(new Error(`Input data given to '${fe.source}' is not a valid GeoJSON object.`));{try{if(fe.filter){const ct=i.U(fe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ct.result==="error")throw new Error(ct.value.map(_t=>`${_t.key}: ${_t.message}`).join(", "));ot.features=ot.features.filter(_t=>ct.value.evaluate({zoom:0},_t))}fe.dynamic?(ot.type==="Feature"&&(ot={type:"FeatureCollection",features:[ot]}),fe.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(ot.features,this.loaded),fe.cluster&&(ot.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=fe.cluster?new Pt(function({superclusterOptions:ct,clusterProperties:_t}){if(!_t||!ct)return ct;const Zt={},Ut={},Ar={accumulated:null,zoom:0},Jr={properties:null},Zr=Object.keys(_t);for(const zr of Zr){const[wn,An]=_t[zr],Si=i.U(An),bs=i.U(typeof wn=="string"?[wn,["accumulated"],["get",zr]]:wn);Zt[zr]=Si.value,Ut[zr]=bs.value}return ct.map=zr=>{Jr.properties=zr;const wn={};for(const An of Zr)wn[An]=Zt[An].evaluate(Ar,Jr);return wn},ct.reduce=(zr,wn)=>{Jr.properties=wn;for(const An of Zr)Ar.accumulated=zr[An],zr[An]=Ut[An].evaluate(Ar,Jr)},ct}(fe)).load(ot.features):fe.dynamic?this._dynamicIndex:function(ct,_t){return new yn(ct,_t)}(ot,fe.geojsonVtOptions)}catch(ct){return ve(ct)}const bt={};if(Qe){const ct=m(De);ct&&(bt.resourceTiming={},bt.resourceTiming[fe.source]=JSON.parse(JSON.stringify(ct)))}ve(null,bt)}})}reloadTile(fe,ve){const De=this.loaded;return De&&De[fe.uid]?fe.partial?ve(null,void 0):super.reloadTile(fe,ve):this.loadTile(fe,ve)}loadGeoJSON(fe,ve){if(fe.request)i.m(fe.request,ve);else{if(typeof fe.data!="string")return ve(new Error(`Input data given to '${fe.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return ve(null,JSON.parse(fe.data))}catch{return ve(new Error(`Input data given to '${fe.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(fe,ve){try{ve(null,this._geoJSONIndex.getClusterExpansionZoom(fe.clusterId))}catch(De){ve(De)}}getClusterChildren(fe,ve){try{ve(null,this._geoJSONIndex.getChildren(fe.clusterId))}catch(De){ve(De)}}getClusterLeaves(fe,ve){try{ve(null,this._geoJSONIndex.getLeaves(fe.clusterId,fe.limit,fe.offset))}catch(De){ve(De)}}}class Fo{constructor(fe,ve,De){this.tileID=new i.aP(fe.tileID.overscaledZ,fe.tileID.wrap,fe.tileID.canonical.z,fe.tileID.canonical.x,fe.tileID.canonical.y),this.tileZoom=fe.tileZoom,this.uid=fe.uid,this.zoom=fe.zoom,this.canonical=fe.tileID.canonical,this.pixelRatio=fe.pixelRatio,this.tileSize=fe.tileSize,this.source=fe.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=fe.projection,this.brightness=ve,this.worldview=De}parse(fe,ve,De,Qe){this.status="parsing";const Ye=new i.aP(De.tileID.overscaledZ,De.tileID.wrap,De.tileID.canonical.z,De.tileID.canonical.x,De.tileID.canonical.y),ot=[],bt=ve.familiesBySource[De.source],ct=new i.fm(Ye,De.promoteId);ct.bucketLayerIDs=[],ct.is3DTile=!0,i.fB(fe).then(_t=>{if(!_t)return Qe(new Error("Could not parse tile"));const Zt=_t.json.extensionsUsed&&_t.json.extensionsUsed.includes("MAPBOX_mesh_features")||_t.json.asset.extras&&_t.json.asset.extras.MAPBOX_mesh_features,Ut=_t.json.extensionsUsed&&_t.json.extensionsUsed.includes("EXT_meshopt_compression"),Ar=new i.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Jr in bt)for(const Zr of bt[Jr]){const zr=Zr[0];ct.bucketLayerIDs.push(Zr.map(Si=>i.B(Si.id,Si.scope))),zr.recalculate(Ar,[]);const wn=i.fC(_t,1/i.d6(De.tileID.canonical)),An=new i.fD(Zr,wn,Ye,Zt,Ut,this.brightness,ct,this.worldview);Zt||(An.needsUpload=!0),ot.push(An),An.evaluate(zr)}this.status="done",Qe(null,{buckets:ot,featureIndex:ct,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(_t=>Qe(new Error(_t.message)))}}class Cw{constructor(fe,ve,De,Qe,Ye,ot,bt,ct){this.actor=fe,this.layerIndex=ve,this.availableImages=De,this.availableModels=Qe,this.brightness=bt,this.loading={},this.loaded={},this.worldview=ct}loadTile(fe,ve){const De=fe.uid,Qe=this.loading[De]=new Fo(fe,this.brightness,this.worldview);i.bt(fe.request,(Ye,ot)=>{const bt=!this.loading[De];return delete this.loading[De],bt||Ye?(Qe.status="done",bt||(this.loaded[De]=Qe),ve(Ye)):ot&&ot.byteLength!==0?void Qe.parse(ot,this.layerIndex,fe,(ct,_t)=>{Qe.status="done",this.loaded=this.loaded||{},this.loaded[De]=Qe,ct||!_t?ve(ct):ve(null,_t)}):(Qe.status="done",this.loaded[De]=Qe,ve())})}reloadTile(fe,ve){const De=this.loaded,Qe=fe.uid;if(De&&De[Qe]){const Ye=De[Qe];Ye.projection=fe.projection,Ye.brightness=fe.brightness;const ot=(bt,ct)=>{Ye.reloadCallback&&(delete Ye.reloadCallback,this.loadTile(fe,ve)),ve(bt,ct)};Ye.status==="parsing"?Ye.reloadCallback=ot:Ye.status==="done"&&this.loadTile(fe,ve)}}abortTile(fe,ve){const De=fe.uid;this.loading[De]&&delete this.loading[De],ve()}removeTile(fe,ve){const De=this.loaded,Qe=fe.uid;De&&De[Qe]&&delete De[Qe],ve()}}class Og{constructor(fe){this.self=fe,this.actor=new i.fF(fe,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new i.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=i.cl({name:"mercator"}),this.workerSourceTypes={vector:K,geojson:_n,"raster-dem":ee,"raster-array":ie,"batched-model":Cw},this.workerSources={},this.self.registerWorkerSource=(ve,De)=>{if(this.workerSourceTypes[ve])throw new Error(`Worker source with name "${ve}" already registered.`);this.workerSourceTypes[ve]=De},this.self.registerRTLTextPlugin=ve=>{if(i.fG.isParsed())throw new Error("RTL text plugin already registered.");i.fG.setState({pluginStatus:i.fH.parsed,pluginURL:i.fG.getPluginURL()}),i.fG.applyArabicShaping=ve.applyArabicShaping,i.fG.processBidirectionalText=ve.processBidirectionalText,i.fG.processStyledBidirectionalText=ve.processStyledBidirectionalText;for(const De of this.rtlPluginParsingListeners)De(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(fe,ve,De){delete this.layerIndexes[fe],delete this.availableImages[fe],delete this.availableModels[fe],delete this.workerSources[fe],De()}checkIfReady(fe,ve,De){De()}setReferrer(fe,ve){this.referrer=ve}spriteLoaded(fe,ve){this.isSpriteLoaded[fe]||(this.isSpriteLoaded[fe]={});const{scope:De,isLoaded:Qe}=ve;if(this.isSpriteLoaded[fe][De]=Qe,this.workerSources[fe]&&this.workerSources[fe][De])for(const Ye in this.workerSources[fe][De]){const ot=this.workerSources[fe][De][Ye];for(const bt in ot){const ct=ot[bt];ct instanceof K&&(ct.isSpriteLoaded=Qe,ct.fire(new i.z("isSpriteLoaded")))}}}setImages(fe,ve,De){this.availableImages[fe]||(this.availableImages[fe]={});const{scope:Qe,images:Ye}=ve;if(this.availableImages[fe][Qe]=Ye,this.workerSources[fe]&&this.workerSources[fe][Qe]){for(const ot in this.workerSources[fe][Qe]){const bt=this.workerSources[fe][Qe][ot];for(const ct in bt)bt[ct].availableImages=Ye}De()}else De()}setModels(fe,{scope:ve,models:De},Qe){if(this.availableModels[fe]||(this.availableModels[fe]={}),this.availableModels[fe][ve]=De,this.workerSources[fe]&&this.workerSources[fe][ve]){for(const Ye in this.workerSources[fe][ve]){const ot=this.workerSources[fe][ve][Ye];for(const bt in ot)ot[bt].availableModels=De}Qe()}else Qe()}setProjection(fe,ve){this.projections[fe]=i.cl(ve)}setBrightness(fe,ve,De){this.brightness=ve,De()}setWorldview(fe,ve,De){this.worldview=ve,De()}setLayers(fe,ve,De){this.getLayerIndex(fe,ve.scope).replace(ve.layers,ve.options),De()}updateLayers(fe,ve,De){this.getLayerIndex(fe,ve.scope).update(ve.layers,ve.removedIds,ve.options),De()}loadTile(fe,ve,De){ve.projection=this.projections[fe]||this.defaultProjection,this.getWorkerSource(fe,ve.type,ve.source,ve.scope).loadTile(ve,De)}decodeRasterArray(fe,ve,De){this.getWorkerSource(fe,ve.type,ve.source,ve.scope).decodeRasterArray(ve,De)}reloadTile(fe,ve,De){ve.projection=this.projections[fe]||this.defaultProjection,this.getWorkerSource(fe,ve.type,ve.source,ve.scope).reloadTile(ve,De)}abortTile(fe,ve,De){this.getWorkerSource(fe,ve.type,ve.source,ve.scope).abortTile(ve,De)}removeTile(fe,ve,De){this.getWorkerSource(fe,ve.type,ve.source,ve.scope).removeTile(ve,De)}removeSource(fe,ve,De){if(!(this.workerSources[fe]&&this.workerSources[fe][ve.scope]&&this.workerSources[fe][ve.scope][ve.type]&&this.workerSources[fe][ve.scope][ve.type][ve.source]))return;const Qe=this.workerSources[fe][ve.scope][ve.type][ve.source];delete this.workerSources[fe][ve.scope][ve.type][ve.source],Qe.removeSource!==void 0?Qe.removeSource(ve,De):De()}loadWorkerSource(fe,ve,De){try{this.self.importScripts(ve.url),De()}catch(Qe){De(Qe.toString())}}syncRTLPluginState(fe,ve,De){if(i.fG.isParsed())De(null,!0);else if(i.fG.isParsing())this.rtlPluginParsingListeners.push(De);else try{i.fG.setState(ve);const Qe=i.fG.getPluginURL();!i.fG.isLoaded()||i.fG.isParsed()||i.fG.isParsing()||Qe==null||(i.fG.setState({pluginStatus:i.fH.parsing,pluginURL:i.fG.getPluginURL()}),this.self.importScripts(Qe),i.fG.isParsed()?De(null,!0):this.rtlPluginParsingListeners.push(De))}catch(Qe){De(Qe.toString())}}setDracoUrl(fe,ve){this.dracoUrl=ve}getAvailableImages(fe,ve){this.availableImages[fe]||(this.availableImages[fe]={});let De=this.availableImages[fe][ve];return De||(De=[]),De}getAvailableModels(fe,ve){this.availableModels[fe]||(this.availableModels[fe]={});let De=this.availableModels[fe][ve];return De||(De={}),De}getLayerIndex(fe,ve){this.layerIndexes[fe]||(this.layerIndexes[fe]={});let De=this.layerIndexes[fe][ve];return De||(De=this.layerIndexes[fe][ve]=new b,De.scope=ve),De}getWorkerSource(fe,ve,De,Qe){const Ye=this.workerSources;return Ye[fe]||(Ye[fe]={}),Ye[fe][Qe]||(Ye[fe][Qe]={}),Ye[fe][Qe][ve]||(Ye[fe][Qe][ve]={}),this.isSpriteLoaded[fe]||(this.isSpriteLoaded[fe]={}),Ye[fe][Qe][ve][De]||(Ye[fe][Qe][ve][De]=new this.workerSourceTypes[ve]({send:(ot,bt,ct,_t,Zt,Ut)=>this.actor.send(ot,bt,ct,fe,Zt,Ut),scheduler:this.actor.scheduler},this.getLayerIndex(fe,Qe),this.getAvailableImages(fe,Qe),this.getAvailableModels(fe,Qe),this.isSpriteLoaded[fe][Qe],void 0,this.brightness,this.worldview)),Ye[fe][Qe][ve][De]}rasterizeImagesWorker(fe,ve,De){const Qe=new Map;for(const[Ye,{image:ot,imageVariant:bt}]of ve.tasks.entries()){const ct=this.imageRasterizer.rasterize(bt,ot,ve.scope,fe);Qe.set(Ye,ct)}De(void 0,Qe)}removeRasterizedImages(fe,ve,De){this.imageRasterizer.removeImagesFromCacheByIds(ve.imageIds,ve.scope,fe),De()}enforceCacheSizeLimit(fe,ve){i.fI(ve)}getWorkerPerformanceMetrics(fe,ve,De){De(void 0,void 0)}}return i.fE(self)&&(self.worker=new Og(self)),Og}),o(["./shared"],function(i){var m="3.16.0";const y={create:"create",load:"load",fullLoad:"fullLoad"},S={mark(v){performance.mark(v)},measure(v,l,f){performance.measure(v,l,f)}};function b(v){const l=v.name.split("?")[0];return i.a(l)&&l.includes("mapbox-gl.js")?"javascript":i.a(l)&&l.includes("mapbox-gl.css")?"css":i.b(l)?"fontRange":i.c(l)?"sprite":i.i(l)?"style":i.d(l)?"tilejson":"other"}var T,A={},O=function(){if(T)return A;function v(_){return!l(_)}function l(_){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var j,k,L=new Blob([""],{type:"text/javascript"}),B=URL.createObjectURL(L);try{k=new Worker(B),j=!0}catch{j=!1}return k&&k.terminate(),URL.revokeObjectURL(B),j}()?function(){var j=document.createElement("canvas");j.width=j.height=1;var k=j.getContext("2d");if(!k)return!1;var L=k.getImageData(0,0,1,1);return L&&L.width===j.width}()?(f[E=_&&_.failIfMajorPerformanceCaveat]===void 0&&(f[E]=function(j){var k,L=function(B){var G=document.createElement("canvas"),Z=Object.create(v.webGLContextAttributes);return Z.failIfMajorPerformanceCaveat=B,G.getContext("webgl2",Z)}(j);if(!L)return!1;try{k=L.createShader(L.VERTEX_SHADER)}catch{return!1}return!(!k||L.isContextLost())&&(L.shaderSource(k,"void main() {}"),L.compileShader(k),L.getShaderParameter(k,L.COMPILE_STATUS)===!0)}(E)),f[E]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var E}T=1,A.supported=v,A.notSupportedReason=l;var f={};return v.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},A}();function P(v,l,f){const _=document.createElement(v);return l!=null&&(_.className=l),f&&f.appendChild(_),_}function I(v,l,f){const _=document.createElementNS("http://www.w3.org/2000/svg",v);for(const E of Object.keys(l))_.setAttributeNS(null,E,String(l[E]));return f&&f.appendChild(_),_}const R=typeof document<"u"?document.documentElement&&document.documentElement.style:null,M=R&&R.userSelect!==void 0?"userSelect":"WebkitUserSelect";let F;function z(){R&&M&&(F=R[M],R[M]="none")}function $(){R&&M&&(R[M]=F)}function W(v){v.preventDefault(),v.stopPropagation(),window.removeEventListener("click",W,!0)}function K(){window.addEventListener("click",W,!0),window.setTimeout(()=>{window.removeEventListener("click",W,!0)},0)}function ee(v,l){const f=v.getBoundingClientRect();return re(v,f,l)}function ne(v,l){const f=v.getBoundingClientRect(),_=[];for(let E=0;E<l.length;E++)_.push(re(v,f,l[E]));return _}function ie(v){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&v.button===2&&v.ctrlKey?0:v.button}function re(v,l,f){const _=v.offsetWidth===l.width?1:v.offsetWidth/l.width;return new i.P((f.clientX-l.left)*_,(f.clientY-l.top)*_)}const te="01",ae="NO_ACCESS_TOKEN";class ue{constructor(l,f,_){this._transformRequestFn=l,this._customAccessToken=f,this._silenceAuthErrors=!!_,this._createSkuToken()}_createSkuToken(){const l=function(){let f="";for(let _=0;_<10;_++)f+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",te,f].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=l.token,this._skuTokenExpiresAt=l.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(l,f){return this._transformRequestFn&&this._transformRequestFn(l,f)||{url:l}}normalizeStyleURL(l,f){if(!i.h(l))return l;const _=we(l);return _.params.push(`sdk=js-${m}`),_.path=`/styles/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||f)}normalizeGlyphsURL(l,f){if(!i.h(l))return l;const _=we(l);return _.path=`/fonts/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||f)}normalizeModelURL(l,f){if(!i.h(l))return l;const _=we(l);return _.path=`/models/v1${_.path}`,this._makeAPIURL(_,this._customAccessToken||f)}normalizeSourceURL(l,f,_,E){if(!i.h(l))return l;const j=we(l);return j.path=`/v4/${j.authority}.json`,j.params.push("secure"),_&&j.params.push(`language=${_}`),E&&j.params.push(`worldview=${E}`),this._makeAPIURL(j,this._customAccessToken||f)}normalizeIconsetURL(l,f){const _=we(l);return i.h(l)?(_.path=`/styles/v1${_.path}/iconset.pbf`,this._makeAPIURL(_,this._customAccessToken||f)):Ce(_)}normalizeSpriteURL(l,f,_,E){const j=we(l);return i.h(l)?(j.path=`/styles/v1${j.path}/sprite${f}${_}`,this._makeAPIURL(j,this._customAccessToken||E)):(j.path+=`${f}${_}`,Ce(j))}normalizeTileURL(l,f,_){if(this._isSkuTokenExpired()&&this._createSkuToken(),l&&!i.h(l))return l;const E=we(l);E.path=E.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${f||_&&E.authority!=="raster"&&_===512?"@2x":""}${i.k.supported?".webp":"$1"}`),E.authority==="raster"?E.path=`/${i.e.RASTER_URL_PREFIX}${E.path}`:E.authority==="rasterarrays"?E.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${E.path}`:E.authority==="3dtiles"?E.path=`/${i.e.TILES3D_URL_PREFIX}${E.path}`:(E.path=E.path.replace(/^.+\/v4\//,"/"),E.path=`/${i.e.TILE_URL_VERSION}${E.path}`);const j=this._customAccessToken||function(k){for(const L of k){const B=L.match(/^access_token=(.*)$/);if(B)return B[1]}return null}(E.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&j&&this._skuToken&&E.params.push(`sku=${this._skuToken}`),this._makeAPIURL(E,j)}canonicalizeTileURL(l,f){const _=we(l);if(!_.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!_.path.match(/\.[\w]+$/))return l;let E="mapbox://";_.path.match(/^\/raster\/v1\//)?E+=`raster/${_.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:_.path.match(/^\/rasterarrays\/v1\//)?E+=`rasterarrays/${_.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:E+=`tiles/${_.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let j=_.params;return f&&(j=j.filter(k=>!k.match(/^access_token=/))),j.length&&(E+=`?${j.join("&")}`),E}canonicalizeTileset(l,f){const _=!!f&&i.h(f),E=[];for(const j of l.tiles||[])i.j(j)?E.push(this.canonicalizeTileURL(j,_)):E.push(j);return E}_makeAPIURL(l,f){const _="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",E=we(i.e.API_URL);if(l.protocol=E.protocol,l.authority=E.authority,l.protocol==="http"){const j=l.params.indexOf("secure");j>=0&&l.params.splice(j,1)}if(E.path!=="/"&&(l.path=`${E.path}${l.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return Ce(l);if(f=f||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!f)throw new Error(`An API access token is required to use Mapbox GL. ${_}`);if(f[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${_}`)}return l.params=l.params.filter(j=>j.indexOf("access_token")===-1),l.params.push(`access_token=${f||""}`),Ce(l)}}const be=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function we(v){const l=v.match(be);if(!l)throw new Error("Unable to parse URL object");return{protocol:l[1],authority:l[2],path:l[3]||"/",params:l[4]?l[4].split("&"):[]}}function Ce(v){const l=v.params.length?`?${v.params.join("&")}`:"";return`${v.protocol}://${v.authority}${v.path}${l}`}const _e="mapbox.eventData";function me(v){if(!v)return null;const l=v.split(".");if(!l||l.length!==3)return null;try{return JSON.parse(i.l(l[1]))}catch{return null}}class Ae{constructor(l){this.type=l,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(l){const f=me(i.e.ACCESS_TOKEN);let _="";return _=f&&f.u?i.f(f.u):i.e.ACCESS_TOKEN||"",l?`${_e}.${l}:${_}`:`${_e}:${_}`}fetchEventData(){const l=i.s("localStorage"),f=this.getStorageKey(),_=this.getStorageKey("uuid"),E=this.getStorageKey("uuidTimestamp");if(l)try{const j=localStorage.getItem(f);j&&(this.eventData=JSON.parse(j));const k=localStorage.getItem(_);k&&(this.anonId=k);const L=localStorage.getItem(E);L&&(this.anonIdTimestamp=Number(L));const B=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<B)&&this.refreshUUID()}catch{i.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=i.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const l=i.s("localStorage"),f=this.getStorageKey(),_=this.getStorageKey("uuid"),E=this.getStorageKey("uuidTimestamp"),j=this.anonId,k=this.anonIdTimestamp;if(l&&j)try{localStorage.setItem(_,j),Object.keys(this.eventData).length>=1&&localStorage.setItem(f,JSON.stringify(this.eventData)),k&&localStorage.setItem(E,k.toString())}catch{i.w("Unable to write to LocalStorage")}}processRequests(l){}postEvent(l,f,_,E){if(!i.e.EVENTS_URL)return;const j=we(i.e.EVENTS_URL);j.params.push(`access_token=${E||i.e.ACCESS_TOKEN||""}`);const k={event:this.type,created:new Date(l).toISOString()},L=f?Object.assign(k,f):k,B={url:Ce(j),headers:{"Content-Type":"text/plain"},body:JSON.stringify([L])};this.pendingRequest=i.p(B,G=>{this.pendingRequest=null,_(G),this.saveEventData(),this.processRequests(E)})}queueRequest(l,f){this.queue.push(l),this.processRequests(f)}}const ge=new class extends Ae{constructor(v){super("appUserTurnstile"),this._customAccessToken=v}postTurnstileEvent(v,l){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(v)&&v.some(f=>i.h(f)||i.j(f))&&this.queueRequest(Date.now(),l)}processRequests(v){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const l=me(i.e.ACCESS_TOKEN),f=l?l.u:i.e.ACCESS_TOKEN;let _=f!==this.eventData.tokenU;i.v(this.anonId)||(this.refreshUUID(),_=!0);const E=this.queue.shift();if(this.eventData.lastSuccess){const j=new Date(this.eventData.lastSuccess),k=new Date(E),L=(E-this.eventData.lastSuccess)/864e5;_=_||L>=1||L<-1||j.getDate()!==k.getDate()}else _=!0;_?this.postEvent(E,{sdkIdentifier:"mapbox-gl-js",sdkVersion:m,skuId:te,"enabled.telemetry":!1,userId:this.anonId},j=>{j||(this.eventData.lastSuccess=E,this.eventData.tokenU=f)},v):this.processRequests()}},pe=ge.postTurnstileEvent.bind(ge),Oe=new class extends Ae{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(v,l,f,_){this.skuToken=l,this.errorCb=_,i.e.EVENTS_URL&&(f||i.e.ACCESS_TOKEN?this.queueRequest({id:v,timestamp:Date.now()},f):this.errorCb(new Error(ae)))}processRequests(v){if(this.pendingRequest||this.queue.length===0)return;const{id:l,timestamp:f}=this.queue.shift();l&&this.success[l]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID(),this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:m,skuId:te,skuToken:this.skuToken,userId:this.anonId},_=>{_?this.errorCb(_):l&&(this.success[l]=!0)},v))}remove(){this.errorCb=null}},Je=Oe.postMapLoadEvent.bind(Oe),Ze=new class extends Ae{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(v){let l=this.mapInstanceIdMap.get(v);return l||(l=i.u(),this.mapInstanceIdMap.set(v,l)),l}getEventId(v){const l=this.eventIdPerMapInstanceMap.get(v)||0;return this.eventIdPerMapInstanceMap.set(v,l+1),l}postStyleLoadEvent(v,l){const{map:f,style:_,importedStyles:E}=l;if(!i.e.EVENTS_URL||!v&&!i.e.ACCESS_TOKEN)return;const j=this.getMapInstanceId(f),k={mapInstanceId:j,eventId:this.getEventId(j),style:_};E.length&&(k.importedStyles=E),this.queueRequest({timestamp:Date.now(),payload:k},v)}processRequests(v){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:l,payload:f}=this.queue.shift();this.postEvent(l,f,()=>{},v)}},Pe=Ze.postStyleLoadEvent.bind(Ze),Be=new class extends Ae{constructor(v){super("metrics"),v&&(this.data=v)}postMetricsEvent(v){if(!i.e.EVENTS_URL||!v&&!i.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID();const l=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:l},v)}processRequests(v){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:l,payload:f}=this.queue.shift();this.postEvent(l,f,()=>{},v)}}({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),nt=Be.postMetricsEvent.bind(Be),Me=new class extends Ae{constructor(){super("gljs.performance")}postPerformanceEvent(v,l){i.e.EVENTS_URL&&(v||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:l},v)}processRequests(v){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:l,performanceData:f}=this.queue.shift(),_=function(E){const j=performance.getEntriesByType("resource"),k=performance.getEntriesByType("mark"),L=function(se){const le={};if(se){for(const de in se)if(de!=="other")for(const xe of se[de]){const ye=`${de}ResolveRangeMin`,Ee=`${de}ResolveRangeMax`,Ne=`${de}RequestCount`,je=`${de}RequestCachedCount`;le[ye]=Math.min(le[ye]||1/0,xe.startTime),le[Ee]=Math.max(le[Ee]||-1/0,xe.responseEnd);const Ve=Ie=>{le[Ie]===void 0&&(le[Ie]=0),++le[Ie]};xe.transferSize!==void 0&&xe.transferSize===0&&Ve(je),Ve(Ne)}}return le}(function(se,le){const de={};if(se)for(const xe of se){const ye=le(xe);de[ye]===void 0&&(de[ye]=[]),de[ye].push(xe)}return de}(j,b)),B=window.devicePixelRatio,G=navigator.connection||navigator.mozConnection||navigator.webkitConnection,Z=G?G.effectiveType:void 0,Q={counters:[],metadata:[],attributes:[]},X=(se,le,de)=>{de!=null&&se.push({name:le,value:de.toString()})};for(const se in L)X(Q.counters,se,L[se]);if(E.interactionRange[0]!==1/0&&E.interactionRange[1]!==-1/0&&(X(Q.counters,"interactionRangeMin",E.interactionRange[0]),X(Q.counters,"interactionRangeMax",E.interactionRange[1])),k)for(const se of Object.values(y)){const le=k.find(de=>de.name===se);le&&X(Q.counters,se,le.startTime)}return X(Q.counters,"visibilityHidden",E.visibilityHidden),X(Q.attributes,"style",function(se){if(se)for(const le of se){const de=le.name.split("?")[0];if(i.i(de)){const xe=de.split("/").slice(-2);if(xe.length===2)return`mapbox://styles/${xe[0]}/${xe[1]}`}}}(j)),X(Q.attributes,"terrainEnabled",E.terrainEnabled?"true":"false"),X(Q.attributes,"fogEnabled",E.fogEnabled?"true":"false"),X(Q.attributes,"projection",E.projection),X(Q.attributes,"zoom",E.zoom),X(Q.metadata,"devicePixelRatio",B),X(Q.metadata,"connectionEffectiveType",Z),X(Q.metadata,"navigatorUserAgent",navigator.userAgent),X(Q.metadata,"screenWidth",window.screen.width),X(Q.metadata,"screenHeight",window.screen.height),X(Q.metadata,"windowWidth",window.innerWidth),X(Q.metadata,"windowHeight",window.innerHeight),X(Q.metadata,"mapWidth",E.width/B),X(Q.metadata,"mapHeight",E.height/B),X(Q.metadata,"webglRenderer",E.renderer),X(Q.metadata,"webglVendor",E.vendor),X(Q.metadata,"sdkVersion",m),X(Q.metadata,"sdkIdentifier","mapbox-gl-js"),Q}(f);for(const E of _.metadata);for(const E of _.counters);for(const E of _.attributes);this.postEvent(l,_,()=>{},v)}},We=Me.postPerformanceEvent.bind(Me),gt=new class extends Ae{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(v,l,f,_){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const E=we(i.e.API_URL+i.e.SESSION_PATH);E.params.push(`sku=${l||""}`),E.params.push(`access_token=${_||i.e.ACCESS_TOKEN||""}`);const j={url:Ce(E),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(j,k=>{this.pendingRequest=null,f(k),this.saveEventData(),this.processRequests(_)})}getSessionAPI(v,l,f,_){this.skuToken=l,this.errorCb=_,i.e.SESSION_PATH&&i.e.API_URL&&(f||i.e.ACCESS_TOKEN?this.queueRequest({id:v,timestamp:Date.now()},f):this.errorCb(new Error(ae)))}processRequests(v){if(this.pendingRequest||this.queue.length===0)return;const{id:l,timestamp:f}=this.queue.shift();l&&this.success[l]||this.getSession(f,this.skuToken,_=>{_?this.errorCb(_):l&&(this.success[l]=!0)},v)}remove(){this.errorCb=null}},rt=gt.getSessionAPI.bind(gt),Ht=new Set;function Lt(v,l){l?Ht.add(v):Ht.delete(v)}class nr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(l,f){this._updatedSourceCaches[l]=f,this.setDirty()}discardSourceCacheUpdate(l){delete this._updatedSourceCaches[l]}updateLayer(l){const f=l.scope;this._updatedLayers[f]=this._updatedLayers[f]||new Set,this._updatedLayers[f].add(l.id),this.setDirty()}removeLayer(l){const f=l.scope;this._removedLayers[f]=this._removedLayers[f]||{},this._updatedLayers[f]=this._updatedLayers[f]||new Set,this._removedLayers[f][l.id]=l,this._updatedLayers[f].delete(l.id),this._updatedPaintProps.delete(l.fqid),this.setDirty()}getRemovedLayer(l){return this._removedLayers[l.scope]?this._removedLayers[l.scope][l.id]:null}discardLayerRemoval(l){this._removedLayers[l.scope]&&delete this._removedLayers[l.scope][l.id]}getLayerUpdatesByScope(){const l={};for(const f in this._updatedLayers)l[f]=l[f]||{},l[f].updatedIds=Array.from(this._updatedLayers[f].values());for(const f in this._removedLayers)l[f]=l[f]||{},l[f].removedIds=Object.keys(this._removedLayers[f]);return l}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(l){this._updatedPaintProps.add(l.fqid),this.setDirty()}getUpdatedImages(l){return this._updatedImages[l]?Array.from(this._updatedImages[l].values()):[]}updateImage(l,f){this._updatedImages[f]=this._updatedImages[f]||new Set,this._updatedImages[f].add(i.I.toString(l)),this.setDirty()}resetUpdatedImages(l){this._updatedImages[l]&&this._updatedImages[l].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Rr(v){const{userImage:l}=v;return!!(l&&l.render&&l.render())&&(v.data.replace(new Uint8Array(l.data.buffer)),!0)}class Dr extends i.E{constructor(l){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=l,l!=="raster"&&i.r()&&(this.imageRasterizerDispatcher=new i.D(i.t(),this,"Image Rasterizer Worker",1))}addScope(l){this.loaded.set(l,!1),this.imageProviders.set(l,new Map),this.images.set(l,new Map),this.updatedImages.set(l,new Set),this.callbackDispatchedThisFrame.set(l,new Set),this.patterns.set(l,new Map),this.atlasImage.set(l,new i.q({width:1,height:1}))}removeScope(l){this.loaded.delete(l),this.imageProviders.delete(l),this.images.delete(l),this.updatedImages.delete(l),this.callbackDispatchedThisFrame.delete(l),this.patterns.delete(l),this.atlasImage.delete(l);const f=this.atlasTexture.get(l);f&&(f.destroy(),this.atlasTexture.delete(l))}addImageProvider(l,f){this.imageProviders.has(f)||this.imageProviders.set(f,new Map),this.imageProviders.get(f).set(l.id,l)}removeImageProvider(l,f){this.imageProviders.has(f)&&this.imageProviders.get(f).delete(l)}getPendingImageProviders(){const l=[];for(const f of this.imageProviders.values())for(const _ of f.values())_.hasPendingRequests()&&l.push(_);return l}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.x),this._imageRasterizer}isLoaded(){for(const l of this.loaded.keys())if(!this.loaded.get(l))return!1;return!0}setLoaded(l,f){if(this.loaded.get(f)!==l&&(this.loaded.set(f,l),l)){for(const{ids:_,callback:E}of this.requestors)this._notify(_,f,E);this.requestors=[]}}hasImage(l,f){return!!this.getImage(l,f)}getImage(l,f){return this.images.get(f).get(l.toString())}addImage(l,f,_){this._validate(l,_)&&this.images.get(f).set(l.toString(),_)}_validate(l,f){let _=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new i.y(new Error(`Image "${l.name}" has invalid "stretchX" value`))),_=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new i.y(new Error(`Image "${l.name}" has invalid "stretchY" value`))),_=!1),this._validateContent(f.content,f)||(this.fire(new i.y(new Error(`Image "${l.name}" has invalid "content" value`))),_=!1),_}_validateStretch(l,f){if(!l)return!0;let _=0;for(const E of l){if(E[0]<_||E[1]<E[0]||f<E[1])return!1;_=E[1]}return!0}_validateContent(l,f){return l?l.length!==4||!f.usvg&&(l[0]<0||f.data.width<l[0]||l[1]<0||f.data.height<l[1]||l[2]<0||f.data.width<l[2]||l[3]<0||f.data.height<l[3])?!1:!(l[2]<l[0]||l[3]<l[1]):!0}updateImage(l,f,_){const E=this.images.get(f).get(l.toString());_.version=E.version+1,this.images.get(f).set(l.toString(),_),this.updatedImages.get(f).add(l),this.removeFromImageRasterizerCache(l,f)}clearUpdatedImages(l){this.updatedImages.get(l).clear()}removeFromImageRasterizerCache(l,f){this.spriteFormat!=="raster"&&(i.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[l],scope:f}):this.imageRasterizer.removeImagesFromCacheByIds([l],f))}removeImage(l,f){const _=this.images.get(f),E=_.get(l.toString());_.delete(l.toString()),this.patterns.get(f).delete(l.toString()),this.removeFromImageRasterizerCache(l,f),E.userImage&&E.userImage.onRemove&&E.userImage.onRemove()}listImages(l){return Array.from(this.images.get(l).keys()).map(f=>i.I.from(f))}getImages(l,f,_){const E=[],j=[],k=this.imageProviders.get(f);for(const Z of l){if(!Z.iconsetId){E.push(Z);continue}const Q=k.get(Z.iconsetId);Q&&(this.getImage(Z,f)?j.push(Z):Q.addPendingRequest(Z))}if(E.length===0)return void this._notify(j,f,_);let L=!0;const B=!!this.loaded.get(f),G=this.images.get(f);if(!B)for(const Z of E)G.has(Z.toString())||(L=!1);B||L?this._notify(E,f,_):this.requestors.push({ids:E,scope:f,callback:_})}rasterizeImages(l,f){const _=new Map,{tasks:E,scope:j}=l;for(const[k,L]of E.entries()){const B=this.getImage(L.id,j);B&&_.set(k,{image:B,imageVariant:L})}this._rasterizeImages(j,_,f)}_rasterizeImages(l,f,_){if(i.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:f,scope:l},_);else{const E=new Map;for(const[j,{image:k,imageVariant:L}]of f.entries())E.set(j,this.imageRasterizer.rasterize(L,k,l,0));_(void 0,E)}}getUpdatedImages(l){return this.updatedImages.get(l)||new Set}_notify(l,f,_){const E=this.images.get(f),j=new Map;for(const k of l){if(!E.get(k.toString())){if(k.iconsetId)continue;this.fire(new i.z("styleimagemissing",{id:k.name}))}const L=E.get(k.toString());if(!L){i.w(`Image "${k.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const B={data:L.usvg?null:L.data.clone(),pixelRatio:L.pixelRatio,sdf:L.sdf,usvg:L.usvg,version:L.version,stretchX:L.stretchX,stretchY:L.stretchY,content:L.content,hasRenderCallback:!!(L.userImage&&L.userImage.render)};L.usvg&&Object.assign(B,{width:L.icon.usvg_tree.width,height:L.icon.usvg_tree.height}),j.set(i.I.toString(k),B)}_(null,j)}getPixelSize(l){const{width:f,height:_}=this.atlasImage.get(l);return{width:f,height:_}}getPattern(l,f,_){const E=l.toString(),j=this.patterns.get(f),k=j.get(E),L=this.getImage(l,f);if(!L)return null;if(k){if(k.position.version===L.version)return k.position;k.position.version=L.version}else{if(L.usvg&&!L.data){const B=this.getPatternInFlightId(E,f);if(this.patternsInFlight.has(B))return null;this.patternsInFlight.add(B);const G=new i.A(l).scaleSelf(i.o.devicePixelRatio),Z=new Map([[G.toString(),{image:L,imageVariant:G}]]);return this._rasterizeImages(f,Z,(Q,X)=>this.storePatternImage(G,f,L,_,X)),null}this.storePattern(l,f,L)}return this._updatePatternAtlas(f,_),j.get(E).position}getPatternInFlightId(l,f){return i.B(l,f)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(l,f,_,E,j){const k=l.toString(),L=j?j.get(k):void 0;L&&(_.data=L,this.storePattern(l.id,f,_),this._updatePatternAtlas(f,E),this.patternsInFlight.delete(this.getPatternInFlightId(l.id.toString(),f)))}storePattern(l,f,_){const E={w:_.data.width+2*i.C,h:_.data.height+2*i.C,x:0,y:0},j=new i.F(E,_,i.C);this.patterns.get(f).set(l.toString(),{bin:E,position:j})}destroyAtlasTextures(){for(const l of this.atlasTexture.values())l&&l.destroy();this.atlasTexture.clear()}bind(l,f){const _=l.gl;let E=this.atlasTexture.get(f);E?this.dirty&&(E.update(this.atlasImage.get(f)),this.dirty=!1):(E=new i.T(l,this.atlasImage.get(f),_.RGBA8),this.atlasTexture.set(f,E)),E.bind(_.LINEAR,_.CLAMP_TO_EDGE)}_updatePatternAtlas(l,f){const _=this.patterns.get(l),E=Array.from(_.values()).map(({bin:G})=>G),{w:j,h:k}=i.G(E),L=this.atlasImage.get(l);L.resize({width:j||1,height:k||1});const B=this.images.get(l);for(const[G,{bin:Z,position:Q}]of _.entries()){let X=Q.padding;const se=Z.x+X,le=Z.y+X,de=B.get(G).data,xe=de.width,ye=de.height;X=X>1?X-1:X,i.q.copy(de,L,{x:0,y:0},{x:se,y:le},{width:xe,height:ye},f),i.q.copy(de,L,{x:0,y:ye-X},{x:se,y:le-X},{width:xe,height:X},f),i.q.copy(de,L,{x:0,y:0},{x:se,y:le+ye},{width:xe,height:X},f),i.q.copy(de,L,{x:xe-X,y:0},{x:se-X,y:le},{width:X,height:ye},f),i.q.copy(de,L,{x:0,y:0},{x:se+xe,y:le},{width:X,height:ye},f),i.q.copy(de,L,{x:xe-X,y:ye-X},{x:se-X,y:le-X},{width:X,height:X},f),i.q.copy(de,L,{x:0,y:ye-X},{x:se+xe,y:le-X},{width:X,height:X},f),i.q.copy(de,L,{x:0,y:0},{x:se+xe,y:le+ye},{width:X,height:X},f),i.q.copy(de,L,{x:xe-X,y:0},{x:se-X,y:le+ye},{width:X,height:X},f)}this.dirty=!0}beginFrame(){for(const l of this.images.keys())this.callbackDispatchedThisFrame.set(l,new Set)}dispatchRenderCallbacks(l,f){const _=this.images.get(f);for(const E of l){if(this.callbackDispatchedThisFrame.get(f).has(E.toString()))continue;this.callbackDispatchedThisFrame.get(f).add(E.toString());const j=_.get(E.toString());Rr(j)&&this.updateImage(E,f,j)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Pt(v){const l=v.value,f=v.valueSpec,_=v.style,E=v.styleSpec,j=v.key,k=v.arrayElementValidator||Fi;if(!Array.isArray(l))return[new i.V(j,l,`array expected, ${i.K(l)} found`)];if(f.length&&l.length!==f.length)return[new i.V(j,l,`array length ${f.length} expected, length ${l.length} found`)];if(f["min-length"]&&l.length<f["min-length"])return[new i.V(j,l,`array length at least ${f["min-length"]} expected, length ${l.length} found`)];let L={type:f.value,values:f.values,minimum:f.minimum,maximum:f.maximum,function:void 0};E.$version<7&&(L.function=f.function),i.H(f.value)&&(L=f.value);let B=[];for(let G=0;G<l.length;G++)B=B.concat(k({array:l,arrayIndex:G,value:l[G],valueSpec:L,style:_,styleSpec:E,key:`${j}[${G}]`},!0));return B}function wt(v){const l=v.key,f=v.value,_=v.valueSpec;if(!i.L(f))return[new i.V(l,f,`number expected, ${i.K(f)} found`)];if(f!=f)return[new i.V(l,f,"number expected, NaN found")];if("minimum"in _){let E=_.minimum;if(Array.isArray(_.minimum)&&(E=_.minimum[v.arrayIndex]),f<E)return[new i.V(l,f,`${f} is less than the minimum value ${E}`)]}if("maximum"in _){let E=_.maximum;if(Array.isArray(_.maximum)&&(E=_.maximum[v.arrayIndex]),f>E)return[new i.V(l,f,`${f} is greater than the maximum value ${E}`)]}return[]}function He(v){const l=v.key,f=v.value;if(!i.H(f))return[new i.V(l,f,`object expected, ${i.K(f)} found`)];const _=v.valueSpec,E=i.J(f.type);let j,k,L,B={};const G=E!=="categorical"&&f.property===void 0,Z=!G,Q=function(de){const xe=de.stops;return Array.isArray(xe)&&Array.isArray(xe[0])&&i.H(xe[0][0])}(f),X=Ks({key:v.key,value:v.value,valueSpec:v.styleSpec.function,style:v.style,styleSpec:v.styleSpec,objectElementValidators:{stops:function(de){if(E==="identity")return[new i.V(de.key,de.value,'identity function may not have a "stops" property')];let xe=[];const ye=de.value;return xe=xe.concat(Pt({key:de.key,value:ye,valueSpec:de.valueSpec,style:de.style,styleSpec:de.styleSpec,arrayElementValidator:se})),Array.isArray(ye)&&ye.length===0&&xe.push(new i.V(de.key,ye,"array must have at least one stop")),xe},default:function(de){return Fi({key:de.key,value:de.value,valueSpec:_,style:de.style,styleSpec:de.styleSpec})}}});return E==="identity"&&G&&X.push(new i.V(v.key,v.value,'missing required property "property"')),E==="identity"||f.stops||X.push(new i.V(v.key,v.value,'missing required property "stops"')),E==="exponential"&&_.expression&&!i.M(_)&&X.push(new i.V(v.key,v.value,"exponential functions not supported")),v.styleSpec.$version>=8&&(Z&&!i.N(_)?X.push(new i.V(v.key,v.value,"property functions not supported")):G&&!i.O(_)&&X.push(new i.V(v.key,v.value,"zoom functions not supported"))),E!=="categorical"&&!Q||f.property!==void 0||X.push(new i.V(v.key,v.value,'"property" property is required')),X;function se(de){let xe=[];const ye=de.value,Ee=de.key;if(!Array.isArray(ye))return[new i.V(Ee,ye,`array expected, ${i.K(ye)} found`)];if(ye.length!==2)return[new i.V(Ee,ye,`array length 2 expected, length ${ye.length} found`)];if(Q){if(!i.H(ye[0]))return[new i.V(Ee,ye,`object expected, ${i.K(ye[0])} found`)];const Ne=ye[0];if(Ne.zoom===void 0)return[new i.V(Ee,ye,"object stop key must have zoom")];if(Ne.value===void 0)return[new i.V(Ee,ye,"object stop key must have value")];const je=i.J(Ne.zoom);if(typeof je!="number")return[new i.V(Ee,Ne.zoom,"stop zoom values must be numbers")];if(L&&L>je)return[new i.V(Ee,Ne.zoom,"stop zoom values must appear in ascending order")];je!==L&&(L=je,k=void 0,B={}),xe=xe.concat(Ks({key:`${Ee}[0]`,value:ye[0],valueSpec:{zoom:{}},style:de.style,styleSpec:de.styleSpec,objectElementValidators:{zoom:wt,value:le}}))}else xe=xe.concat(le({key:`${Ee}[0]`,value:ye[0],style:de.style,styleSpec:de.styleSpec},ye));return i.Q(i.S(ye[1]))?xe.concat([new i.V(`${Ee}[1]`,ye[1],"expressions are not allowed in function stops.")]):xe.concat(Fi({key:`${Ee}[1]`,value:ye[1],valueSpec:_,style:de.style,styleSpec:de.styleSpec}))}function le(de,xe){const ye=i.K(de.value),Ee=i.J(de.value),Ne=de.value!==null?de.value:xe;if(j){if(ye!==j)return[new i.V(de.key,Ne,`${ye} stop domain type must match previous stop domain type ${j}`)]}else j=ye;if(ye!=="number"&&ye!=="string"&&ye!=="boolean"&&typeof Ee!="number"&&typeof Ee!="string"&&typeof Ee!="boolean")return[new i.V(de.key,Ne,"stop domain value must be a number, string, or boolean")];if(ye!=="number"&&E!=="categorical"){let je=`number expected, ${ye} found`;return i.N(_)&&E===void 0&&(je+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(de.key,Ne,je)]}return E!=="categorical"||ye!=="number"||typeof Ee=="number"&&isFinite(Ee)&&Math.floor(Ee)===Ee?E!=="categorical"&&ye==="number"&&typeof Ee=="number"&&typeof k=="number"&&k!==void 0&&Ee<k?[new i.V(de.key,Ne,"stop domain values must appear in ascending order")]:(k=Ee,E==="categorical"&&Ee in B?[new i.V(de.key,Ne,"stop domain values must be unique")]:(B[Ee]=!0,[])):[new i.V(de.key,Ne,`integer expected, found ${String(Ee)}`)]}}function lt(v){const l=(v.expressionContext==="property"?i.W:i.U)(i.S(v.value),v.valueSpec);if(l.result==="error")return l.value.map(_=>new i.V(`${v.key}${_.key}`,v.value,_.message));const f=l.value.expression||l.value._styleExpression.expression;if(v.expressionContext==="property"&&v.propertyKey==="text-font"&&!f.outputDefined())return[new i.V(v.key,v.value,`Invalid data expression for "${v.propertyKey}". Output values must be contained as literals within the expression.`)];if(v.expressionContext==="property"&&v.propertyType==="layout"&&!i.Z(f))return[new i.V(v.key,v.value,'"feature-state" data expressions are not supported with layout properties.')];if(v.expressionContext==="filter")return ut(f,v);if(v.expressionContext==="appearance")return sr(f,v);if(v.expressionContext&&v.expressionContext.indexOf("cluster")===0){if(!i.X(f,["zoom","feature-state"]))return[new i.V(v.key,v.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(v.expressionContext==="cluster-initial"&&!i.Y(f))return[new i.V(v.key,v.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ut(v,l){const f=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(l.valueSpec&&l.valueSpec.expression)for(const E of l.valueSpec.expression.parameters)f.delete(E);if(f.size===0)return[];const _=[];return v instanceof i._&&f.has(v.name)?[new i.V(l.key,l.value,`["${v.name}"] expression is not supported in a filter for a ${l.object.type} layer with id: ${l.object.id}`)]:(v.eachChild(E=>{_.push(...ut(E,l))}),_)}function sr(v,l){const f=new Set;if(l.valueSpec&&l.valueSpec.expression)for(const E of l.valueSpec.expression.parameters)f.add(E);if(f.size===0)return[];const _=[];return v instanceof i._&&!f.has(v.name)?[new i.V(l.key,l.value,`["${v.name}"] is not an allowed parameter`)]:(v.eachChild(E=>{_.push(...sr(E,l))}),_)}function Qt(v){const l=v.key,f=v.value,_=v.valueSpec,E=[];return Array.isArray(_.values)?_.values.indexOf(i.J(f))===-1&&E.push(new i.V(l,f,`expected one of [${_.values.join(", ")}], ${JSON.stringify(f)} found`)):Object.keys(_.values).indexOf(i.J(f))===-1&&E.push(new i.V(l,f,`expected one of [${Object.keys(_.values).join(", ")}], ${JSON.stringify(f)} found`)),E}function er(v){return i.a2(i.S(v.value))?lt(Object.assign({},v,{expressionContext:"filter",valueSpec:v.styleSpec[`filter_${v.layerType||"fill"}`]})):Cr(v)}function Cr(v){const l=v.value,f=v.key;if(!Array.isArray(l))return[new i.V(f,l,`array expected, ${i.K(l)} found`)];if(l.length<1)return[new i.V(f,l,"filter array must have at least 1 element")];const _=v.styleSpec;let E=Qt({key:`${f}[0]`,value:l[0],valueSpec:_.filter_operator});switch(i.J(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&i.J(l[1])==="$type"&&E.push(new i.V(f,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&E.push(new i.V(f,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(i.a0(l[1])||E.push(new i.V(`${f}[1]`,l[1],`string expected, ${i.K(l[1])} found`)));for(let j=2;j<l.length;j++)i.J(l[1])==="$type"?E=E.concat(Qt({key:`${f}[${j}]`,value:l[j],valueSpec:_.geometry_type})):i.a0(l[j])||i.L(l[j])||i.$(l[j])||E.push(new i.V(`${f}[${j}]`,l[j],`string, number, or boolean expected, ${i.K(l[j])} found.`));break;case"any":case"all":case"none":for(let j=1;j<l.length;j++)E=E.concat(Cr({key:`${f}[${j}]`,value:l[j],style:v.style,styleSpec:v.styleSpec}));break;case"has":case"!has":l.length!==2?E.push(new i.V(f,l,`filter array for "${l[0]}" operator must have 2 elements`)):i.a0(l[1])||E.push(new i.V(`${f}[1]`,l[1],`string expected, ${i.K(l[1])} found`))}return E}function dn(v,l){const f=v.key,_=v.style,E=v.layer,j=v.styleSpec,k=v.value,L=v.objectKey,B=j[`${l}_${v.layerType}`];if(!B)return[];const G=L.match(/^(.*)-use-theme$/);if(G&&B[G[1]])return i.Q(i.S(k))?[].concat(Fi({key:f,value:k,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:_,styleSpec:j,expressionContext:"property",propertyType:l,propertyKey:L})):Fi({key:f,value:k,valueSpec:{type:"string"},style:_,styleSpec:j});const Z=L.match(/^(.*)-transition$/);if(l==="paint"&&Z&&B[Z[1]]&&B[Z[1]].transition)return Fi({key:f,value:k,valueSpec:j.transition,style:_,styleSpec:j});const Q=v.valueSpec||B[L];if(!Q)return[new i.a3(f,k,`unknown property "${L}"`)];let X;if(i.a0(k)&&i.N(Q)&&!Q.tokens&&(X=/^{([^}]+)}$/.exec(k))){const le=`\`{ "type": "identity", "property": ${X?JSON.stringify(X[1]):'"_"'} }\``;return[new i.V(f,k,`"${L}" does not support interpolation syntax
Use an identity property function instead: ${le}.`)]}const se=[];if(v.layerType==="symbol")L!=="text-field"||!_||_.glyphs||_.imports||se.push(new i.V(f,k,'use of "text-field" requires a style "glyphs" property')),L==="text-font"&&i.a4(i.S(k))&&i.J(k.type)==="identity"&&se.push(new i.V(f,k,'"text-font" does not support identity functions'));else if(v.layerType==="model"&&l==="paint"&&E&&E.layout&&E.layout.hasOwnProperty("model-id")&&i.N(Q)&&(i.a5(Q)||i.O(Q))){const le=i.W(i.S(k),Q).value,de="expression"in le&&le.expression||"_styleExpression"in le&&le._styleExpression&&le._styleExpression.expression;de&&!i.X(de,["measure-light"])&&(L==="model-emissive-strength"&&i.Y(de)&&i.Z(de)||se.push(new i.V(f,k,`${L} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return se.concat(Fi({key:v.key,value:k,valueSpec:Q,style:_,styleSpec:j,expressionContext:"property",propertyType:l,propertyKey:L}))}function fn(v){return dn(v,"paint")}function Zn(v){return dn(v,"layout")}function Gn(v){let l=[];const f=v.value,_=v.key,E=v.style,j=v.styleSpec;if(!i.H(f))return[new i.V(_,f,"object expected")];f.type||f.ref||l.push(new i.V(_,f,'either "type" or "ref" is required'));let k=i.J(f.type);const L=i.J(f.ref);if(f.id){const B=i.J(f.id);for(let G=0;G<v.arrayIndex;G++){const Z=E.layers[G];i.J(Z.id)===B&&l.push(new i.V(_,f.id,`duplicate layer id "${B}", previously used at line ${Z.id.__line__}`))}}if("ref"in f){let B;["type","source","source-layer","filter","layout"].forEach(G=>{G in f&&l.push(new i.V(_,f[G],`"${G}" is prohibited for ref layers`))}),E.layers.forEach(G=>{i.J(G.id)===L&&(B=G)}),B?B.ref?l.push(new i.V(_,f.ref,"ref cannot reference another ref layer")):k=i.J(B.type):typeof L=="string"&&l.push(new i.V(_,f.ref,`ref layer "${L}" not found`))}else if(k!=="background"&&k!=="sky"&&k!=="slot")if(f.source)if(i.a0(f.source)){const B=E.sources&&E.sources[f.source],G=B&&i.J(B.type);B?G==="vector"&&k==="raster"?l.push(new i.V(_,f.source,`layer "${f.id}" requires a raster source`)):G==="raster"&&k!=="raster"?l.push(new i.V(_,f.source,`layer "${f.id}" requires a vector source`)):G!=="vector"||f["source-layer"]?G==="raster-dem"&&k!=="hillshade"?l.push(new i.V(_,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):G!=="raster-array"||["raster","raster-particle"].includes(k)?k==="line"&&f.paint&&(f.paint["line-gradient"]||f.paint["line-trim-offset"])&&G==="geojson"&&!B.lineMetrics?l.push(new i.V(_,f,`layer "${f.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):k==="raster-particle"&&G!=="raster-array"&&l.push(new i.V(_,f.source,`layer "${f.id}" requires a 'raster-array' source.`)):l.push(new i.V(_,f.source,"raster-array source can only be used with layer type 'raster'.")):l.push(new i.V(_,f,`layer "${f.id}" must specify a "source-layer"`)):l.push(new i.V(_,f.source,`source "${f.source}" not found`))}else l.push(new i.V(`${_}.source`,f.source,'"source" must be a string'));else l.push(new i.V(_,f,'missing required property "source"'));return l=l.concat(Ks({key:_,value:f,valueSpec:j.layer,style:v.style,styleSpec:v.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Fi({key:`${_}.type`,value:f.type,valueSpec:j.layer.type,style:v.style,styleSpec:v.styleSpec,object:f,objectKey:"type"}),filter:B=>er(Object.assign({layerType:k},B)),layout:B=>Ks({layer:f,key:B.key,value:B.value,valueSpec:{},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{"*":G=>Zn(Object.assign({layerType:k},G))}}),paint:B=>Ks({layer:f,key:B.key,value:B.value,valueSpec:{},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{"*":G=>fn(Object.assign({layerType:k,layer:f},G))}}),appearances(B){const G=Pt({key:B.key,value:B.value,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:X=>function(se){const{key:le,layer:de,layerType:xe}=se,ye=i.J(se.value),Ee=i.J(ye.name),Ne=i.J(ye.condition),je=Ks({key:le,value:ye,valueSpec:se.styleSpec.appearance,style:se.style,styleSpec:se.styleSpec,objectElementValidators:{condition:Ve=>function(Ie){const Ge=[];return Ge.push(...lt({key:Ie.key,value:Ie.object.condition,valueSpec:i.a6.appearance.condition,expressionContext:"appearance"})),Ge}(Object.assign({layer:de,layerType:xe},Ve)),properties:Ve=>function(Ie){const Ge=[],{styleSpec:$e,layer:Le,layerType:Ke}=Ie,dt=$e[`paint_${Ke}`],at=$e[`layout_${Ke}`],Et=Ie.object[Ie.objectKey];for(const yt in Et){const Nt=yt in dt?"paint":yt in at?"layout":void 0;if(!Nt){Ge.push(new i.V(Ie.key,yt,`unknown property "${yt}" for layer type "${Ke}"`));continue}const Xt=Object.assign({},Ie,{key:`${Ie.key}.${yt}`,object:Et,objectKey:yt,layer:Le,layerType:Ke,value:Et[yt],valueSpec:Nt==="paint"?dt[yt]:at[yt]});Ge.push(...dn(Xt,Nt))}return Ge}(Object.assign({layer:de,layerType:xe},Ve))}});return Ee!=="hidden"&&Ne===void 0&&je.push(new i.V(se.key,"name",'Appearance with name different than "hidden" must have a condition')),je}(Object.assign({layerType:k,layer:f},X))}),Z=Array.isArray(B.value)?B.value:[],Q=new Set;return Z.forEach((X,se)=>{const le=i.J(X.name);if(le)if(Q.has(le)){const de=i.J(f.id);G.push(new i.V(B.key,le,`Duplicated appearance name "${le}" for layer "${de}"`))}else Q.add(le)}),G}}})),l}function Di({key:v,value:l}){return i.a0(l)?[]:[new i.V(v,l,`string expected, ${i.K(l)} found`)]}const ka={promoteId:function v({key:l,value:f}){if(i.a0(f))return Di({key:l,value:f});if(Array.isArray(f)){const E=[],j=i.S(f),k=i.U(j);return k.result==="error"&&k.value.forEach(L=>{E.push(new i.V(`${l}${L.key}`,null,`${L.message}`))}),i.X(k.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||E.push(new i.V(`${l}`,null,"promoteId expression should be only feature dependent")),E}if(!i.H(f))return[new i.V(l,f,`string, expression or object expected, "${i.K(f)}" found`)];const _=[];for(const E in f)_.push(...v({key:`${l}.${E}`,value:f[E]}));return _}};function xs(v){const l=v.value,f=v.key,_=v.styleSpec,E=v.style;if(!i.H(l))return[new i.V(f,l,`object expected, ${i.K(l)} found`)];if(!("type"in l))return[new i.V(f,l,'"type" is required')];const j=i.J(l.type);let k=[];switch(["vector","raster","raster-dem","raster-array"].includes(j)&&("url"in l||"tiles"in l||k.push(new i.a3(f,l,'Either "url" or "tiles" is required.'))),j){case"vector":case"raster":case"raster-dem":case"raster-array":return k=k.concat(Ks({key:f,value:l,valueSpec:_[`source_${j.replace("-","_")}`],style:v.style,styleSpec:_,objectElementValidators:ka})),k;case"geojson":if(k=Ks({key:f,value:l,valueSpec:_.source_geojson,style:E,styleSpec:_,objectElementValidators:ka}),"cluster"in l&&"clusterProperties"in l){if(!i.H(l.clusterProperties))return[new i.V(`${f}.clusterProperties`,l,`object expected, ${i.K(l)} found`)];for(const L in l.clusterProperties){const B=l.clusterProperties[L];if(!Array.isArray(B))return[new i.V(`${f}.clusterProperties.${L}`,B,"array expected")];const[G,Z]=B,Q=typeof G=="string"?[G,["accumulated"],["get",L]]:G;k.push(...lt({key:`${f}.${L}.map`,value:Z,expressionContext:"cluster-map"})),k.push(...lt({key:`${f}.${L}.reduce`,value:Q,expressionContext:"cluster-reduce"}))}}return k;case"video":return Ks({key:f,value:l,valueSpec:_.source_video,style:E,styleSpec:_});case"image":return Ks({key:f,value:l,valueSpec:_.source_image,style:E,styleSpec:_});case"canvas":return[new i.V(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Qt({key:`${f}.type`,value:l.type,valueSpec:{values:mi(_)}})}}function mi(v){return v.source.reduce((l,f)=>{const _=v[f];return _.type.type==="enum"&&(l=l.concat(Object.keys(_.type.values||{}))),l},[])}function Ua(v){const l=v.value,f=v.styleSpec,_=f.light,E=v.style;if(l===void 0)return[];if(!i.H(l))return[new i.V("light",l,`object expected, ${i.K(l)} found`)];let j=[];for(const k in l){const L=k.match(/^(.*)-transition$/),B=k.match(/^(.*)-use-theme$/);j=j.concat(B&&_[B[1]]?Fi({key:k,value:l[k],valueSpec:{type:"string"},style:E,styleSpec:f}):L&&_[L[1]]&&_[L[1]].transition?Fi({key:k,value:l[k],valueSpec:f.transition,style:E,styleSpec:f}):_[k]?Fi({key:k,value:l[k],valueSpec:_[k],style:E,styleSpec:f}):[new i.V(k,l[k],`unknown property "${k}"`)])}return j}function Va(v){const l=v.value;if(!l)return[];const f=v.key;if(!i.H(l))return[new i.V(f,l,`object expected, ${i.K(l)} found`)];let _=[];const E=v.styleSpec,j=E["light-3d"],k=v.style,L=v.style.lights;for(const Z of["type","id"])if(!(Z in l))return _=_.concat([new i.V(f,l,`missing property "${Z}"`)]),_;if(!i.a0(l.type))return _=_.concat([new i.V(`${f}.type`,l.type,"string expected")]),_;if(L)for(let Z=0;Z<v.arrayIndex;Z++){const Q=i.J(l.type),X=L[Z];i.J(X.type)===Q&&_.push(new i.V(f,l.id,`duplicate light type "${l.type}", previously defined at line ${X.id.__line__}`))}const B=`properties_light_${l.type}`;if(!(B in E))return _=_.concat([new i.V(`${f}.type`,l,`Invalid light type ${l.type}`)]),_;const G=E[B];for(const Z in l)if(Z==="properties"){const Q=l[Z];if(!i.H(Q))return _=_.concat([new i.V("properties",Q,`object expected, ${i.K(Q)} found`)]),_;for(const X in Q){const se=X.match(/^(.*)-transition$/),le=X.match(/^(.*)-use-theme$/);_=_.concat(le&&G[le[1]]?Fi({key:Z,value:Q[X],valueSpec:{type:"string"},style:k,styleSpec:E}):se&&G[se[1]]&&G[se[1]].transition?Fi({key:Z,value:l[Z],valueSpec:E.transition,style:k,styleSpec:E}):G[X]?Fi({key:X,value:Q[X],valueSpec:G[X],style:k,styleSpec:E}):[new i.a3(v.key,Q[X],`unknown property "${X}"`)])}}else _=_.concat(j[Z]?Fi({key:Z,value:l[Z],valueSpec:j[Z],style:k,styleSpec:E}):[new i.a3(Z,l[Z],`unknown property "${Z}"`)]);return _}function Lo(v){const l=v.value,f=v.key,_=v.style,E=v.styleSpec,j=E.terrain;if(l==null)return[];if(!i.H(l))return[new i.V("terrain",l,`object expected, ${i.K(l)} found`)];let k=[];for(const L in l){const B=L.match(/^(.*)-transition$/),G=L.match(/^(.*)-use-theme$/);k=k.concat(G&&j[G[1]]?Fi({key:L,value:l[L],valueSpec:{type:"string"},style:_,styleSpec:E}):B&&j[B[1]]&&j[B[1]].transition?Fi({key:L,value:l[L],valueSpec:E.transition,style:_,styleSpec:E}):j[L]?Fi({key:L,value:l[L],valueSpec:j[L],style:_,styleSpec:E}):[new i.a3(L,l[L],`unknown property "${L}"`)])}if(l.source)if(i.a0(l.source)){const L=_.sources&&_.sources[l.source],B=L&&i.J(L.type);L?B!=="raster-dem"&&k.push(new i.V(`${f}.source`,l.source,`terrain cannot be used with a source of type ${B}, it only be used with a "raster-dem" source type`)):k.push(new i.V(`${f}.source`,l.source,`source "${l.source}" not found`))}else k.push(new i.V(`${f}.source`,l.source,"source must be a string"));else k.push(new i.V(f,l,'terrain is missing required property "source"'));return k}function qa(v){const l=v.value,f=v.style,_=v.styleSpec,E=_.fog;if(l===void 0)return[];if(!i.H(l))return[new i.V("fog",l,`object expected, ${i.K(l)} found`)];let j=[];for(const k in l){const L=k.match(/^(.*)-transition$/),B=k.match(/^(.*)-use-theme$/);j=j.concat(B&&E[B[1]]?Fi({key:k,value:l[k],valueSpec:{type:"string"},style:f,styleSpec:_}):L&&E[L[1]]&&E[L[1]].transition?Fi({key:k,value:l[k],valueSpec:_.transition,style:f,styleSpec:_}):E[k]?Fi({key:k,value:l[k],valueSpec:E[k],style:f,styleSpec:_}):[new i.a3(k,l[k],`unknown property "${k}"`)])}return j}const Ha={"*":()=>[],array:Pt,boolean:function(v){const l=v.value,f=v.key;return i.$(l)?[]:[new i.V(f,l,`boolean expected, ${i.K(l)} found`)]},number:wt,color:function({key:v,value:l}){return i.a0(l)?i.a1.parseCSSColor(l)===null?[new i.V(v,l,`color expected, "${l}" found`)]:[]:[new i.V(v,l,`color expected, ${i.K(l)} found`)]},enum:Qt,filter:er,function:He,layer:Gn,object:Ks,source:xs,model:i.a7,light:Ua,"light-3d":Va,terrain:Lo,fog:qa,string:Di,formatted:function(v){return Di(v).length===0?[]:lt(v)},resolvedImage:function(v){return Di(v).length===0?[]:lt(v)},projection:function(v){const l=v.value,f=v.styleSpec,_=f.projection,E=v.style;if(i.H(l)){let j=[];for(const k in l)j=j.concat(Fi({key:k,value:l[k],valueSpec:_[k],style:E,styleSpec:f}));return j}return i.a0(l)?[]:[new i.V("projection",l,`object or string expected, ${i.K(l)} found`)]},import:function(v){const l=v.key,{value:f,styleSpec:_}=v;if(!i.H(f))return[new i.V(l,f,"import must be an object")];const{data:E,...j}=f;Object.defineProperty(j,"__line__",{value:f.__line__,enumerable:!1});let k=Ks(Object.assign({},v,{value:j,valueSpec:_.import}));return i.J(j.id)===""&&k.push(new i.V(`${v.key}.id`,j,"import id can't be an empty string")),E&&(k=k.concat(xa(E,_,{key:`${v.key}.data`}))),k},iconset:function(v){const l=v.value,f=v.key,_=v.styleSpec,E=v.style;if(!i.H(l))return[new i.V(f,l,"object expected")];if(!l.type)return[new i.V(f,l,'"type" is required')];const j=i.J(l.type);let k=[];if(k=k.concat(Ks({key:f,value:l,valueSpec:_[`iconset_${j}`],style:E,styleSpec:_})),function(L,B){return!(L!=="source"||!B.source)}(j,l)){const L=E.sources&&E.sources[l.source],B=L&&i.J(L.type);L?B!=="raster-array"&&k.push(new i.V(f,l.source,`iconset cannot be used with a source of type ${String(B)}, it only be used with a "raster-array" source type`)):k.push(new i.V(f,l.source,`source "${l.source}" not found`))}return k}};function Fi(v,l=!1){const f=v.value,_=v.valueSpec,E=v.styleSpec;if(_.expression){if(i.a4(i.J(f)))return He(v);if(i.Q(i.S(f)))return lt(v)}if(_.type&&Ha[_.type]){const j=Ha[_.type](v);return l===!0&&j.length>0&&Array.isArray(v.value)?lt(v):j}return Ks(Object.assign({},v,{valueSpec:_.type?E[_.type]:_}))}function Ks(v){const l=v.key,f=v.value,_=v.valueSpec||{},E=v.objectElementValidators||{},j=v.style,k=v.styleSpec;if(!i.H(f))return[new i.V(l,f,`object expected, ${i.K(f)} found`)];let L=[];for(const B in f){const G=B.split(".")[0];let Z;E[G]?Z=E[G]:_[G]?Z=Fi:E["*"]?Z=E["*"]:_["*"]&&(Z=Fi),Z?L=L.concat(Z({key:(l&&`${l}.`)+B,value:f[B],valueSpec:_[G]||_["*"],style:j,styleSpec:k,object:f,objectKey:B},f)):L.push(new i.a3(l,f[B],`unknown property "${B}"`))}for(const B in _){if(E[B])continue;const G=_[B];G.required&&G.default===void 0&&f[B]===void 0&&L.push(new i.V(l,f,`missing required property "${B}"`))}return L}function rl({key:v,value:l}){const f=Di({key:v,value:l});if(f.length)return f;const _=l;return _.indexOf("{fontstack}")===-1&&f.push(new i.V(v,l,'"glyphs" url must include a "{fontstack}" token')),_.indexOf("{range}")===-1&&f.push(new i.V(v,l,'"glyphs" url must include a "{range}" token')),f}function xa(v,l=i.a6,f={}){return Ks({key:f.key||"",value:v,valueSpec:Object.assign(l.$root,{"*":{type:"*"}}),styleSpec:l,style:v,objectElementValidators:{glyphs:rl}})}function so(v,l=i.a6){return ht(xa(v,l))}const Ln=v=>ht(xs(v)),zi=v=>ht(Ua(v)),ms=v=>ht(Va(v)),Ga=v=>ht(Lo(v)),st=v=>ht(qa(v)),yn=v=>ht(function(l){const f=l.value,_=l.style,E=l.styleSpec,j=E.snow;if(f===void 0)return[];if(!i.H(f))return[new i.V("snow",f,`object expected, ${i.K(f)} found`)];let k=[];for(const L in f){const B=L.match(/^(.*)-transition$/);k=k.concat(B&&j[B[1]]&&j[B[1]].transition?Fi({key:L,value:f[L],valueSpec:E.transition,style:_,styleSpec:E}):j[L]?Fi({key:L,value:f[L],valueSpec:j[L],style:_,styleSpec:E}):[new i.a3(L,f[L],`unknown property "${L}"`)])}return k}(v)),Zs=v=>ht(function(l){const f=l.value,_=l.style,E=l.styleSpec,j=E.rain;if(f===void 0)return[];if(!i.H(f))return[new i.V("rain",f,`object expected, ${i.K(f)} found`)];let k=[];for(const L in f){const B=L.match(/^(.*)-transition$/);k=k.concat(B&&j[B[1]]&&j[B[1]].transition?Fi({key:L,value:f[L],valueSpec:E.transition,style:_,styleSpec:E}):j[L]?Fi({key:L,value:f[L],valueSpec:j[L],style:_,styleSpec:E}):[new i.a3(L,f[L],`unknown property "${L}"`)])}return k}(v)),Na=v=>ht(Gn(v)),_n=v=>ht(er(v)),Fo=v=>ht(fn(v)),Cw=v=>ht(Zn(v)),Og=v=>ht(i.a7(v));function ht(v){return v.slice().sort((l,f)=>l.line&&f.line?l.line-f.line:0)}function fe(v,l){let f=!1;if(l&&l.length)for(const _ of l)_ instanceof i.a3?i.w(_.message):(v.fire(new i.y(new Error(_.message))),f=!0);return f}const ve=i.a6.light;let De;class Qe extends i.E{constructor(l,f="flat"){super(),this._transitionable=new i.a8(De||(De=new i.a9({anchor:new i.aa(ve.anchor),position:new i.ab(ve.position),color:new i.aa(ve.color),intensity:new i.aa(ve.intensity)}))),this.setLight(l,f),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,f,_={}){this._validate(zi,l,_)||(this._transitionable.setTransitionOrValue(l),this.id=f)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,_){return(!_||_.validate!==!1)&&fe(this,l.call(so,Object.assign({value:f,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}const Ye=i.a6.terrain;let ot=class extends i.E{constructor(v,l,f,_,E){super(),this.scope=f,this._transitionable=new i.a8(new i.a9({source:new i.aa(Ye.source),exaggeration:new i.aa(Ye.exaggeration)}),f,_),this._transitionable.setTransitionOrValue(v,_),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l,this.worldview=E}get(){return this._transitionable.serialize()}set(v,l){this._transitionable.setTransitionOrValue(v,l)}updateTransitions(v){this._transitioning=this._transitionable.transitioned(v,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(v){this.properties=this._transitioning.possiblyEvaluate(v)}getExaggeration(v){return this._transitioning.possiblyEvaluate(new i.ac(v,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const v=this._transitionable._values.exaggeration;if(!v)return null;const l=v.value.expression;if(!l)return null;let f=-1,_=-1,E=1;for(const j of l.zoomStops)E=l.evaluate(new i.ac(j,{worldview:this.worldview})),E>.01?(f=j,_=-1):_=j;return E<.01&&f>0&&_>f?[f,_]:null}isZoomDependent(){const v=this._transitionable._values.exaggeration;return v!=null&&v.value!=null&&v.value.expression!=null&&v.value.expression instanceof i.ad}};const bt=45,ct=65,_t=.05;function Zt(v,l,f,_){const E=i.ah(bt,ct,f),[j,k]=Ut(v,_);let L=1-Math.min(1,Math.exp((l-j)/(k-j)*-6));return L*=L*L,L=Math.min(1,1.00747*L),L*E*v.alpha}function Ut(v,l){const f=.5/Math.tan(.5*l);return[v.range[0]+f,v.range[1]+f]}function Ar(v,l,f,_,E){const j=i.af([],[l,f,_],E.mercatorFogMatrix);return Zt(v,i.ag(j),E.pitch,E._fov)}function Jr(v,l,f,_,E,j,k){const L=[[f,_,0],[E,_,0],[E,j,0],[f,j,0]];let B=Number.MAX_VALUE,G=-Number.MAX_VALUE;for(const Z of L){const Q=i.af([],Z,l),X=i.ag(Q);B=Math.min(B,X),G=Math.max(G,X)}return[Zt(v,B,k.pitch,k._fov),Zt(v,G,k.pitch,k._fov)]}const Zr=i.a6.fog;class zr extends i.E{constructor(l,f,_,E){super();const j=new i.a9({range:new i.aa(Zr.range),color:new i.aa(Zr.color),"color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.aa(Zr["high-color"]),"high-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.aa(Zr["space-color"]),"space-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.aa(Zr["horizon-blend"]),"star-intensity":new i.aa(Zr["star-intensity"]),"vertical-range":new i.aa(Zr["vertical-range"])});this._transitionable=new i.a8(j,_,new Map(E)),this.set(l,E),this._transitioning=this._transitionable.untransitioned(),this._transform=f,this.properties=new i.ai(j),this.scope=_}get state(){const l=this._transform,f=l.projection.name==="globe",_=i.aj(l.zoom),E=this.properties.get("range"),j=[.5,3];return{range:f?[i.ak(j[0],E[0],_),i.ak(j[1],E[1],_)]:E,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,f,_={}){if(this._validate(st,l,_))return;const E=Object.assign({},l);for(const j of Object.keys(Zr))E[j]===void 0&&(E[j]=Zr[j].default);this._options=E,this._transitionable.setTransitionOrValue(this._options,f)}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const f=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.ah(bt,ct,l))*f.a}getOpacityAtLatLng(l,f){return this._transform.projection.supportsFog?function(_,E,j){const k=i.ae.fromLngLat(E),L=j.elevation?j.elevation.getAtPointOrZero(k):0;return Ar(_,k.x,k.y,L,j)}(this.state,l,f):0}getOpacityForTile(l){if(!this._transform.projection.supportsFog)return[1,1];const f=this._transform.calculateFogTileMatrix(l.toUnwrapped());return Jr(this.state,f,0,0,i.al,i.al,this._transform)}getOpacityForBounds(l,f,_,E,j){return this._transform.projection.supportsFog?Jr(this.state,l,f,_,E,j,this._transform):[1,1]}getFovAdjustedRange(l){return this._transform.projection.supportsFog?Ut(this.state,l):[0,1]}isVisibleOnFrustum(l){if(!this._transform.projection.supportsFog)return!1;const f=[4,5,6,7];for(const _ of f){const E=l.points[_];let j;if(E[2]>=0)j=E;else{const k=l.points[_-4];j=i.am(k,E,k[2]/(k[2]-E[2]))}if(Ar(this.state,j[0],j[1],0,this._transform)>=_t)return!0}return!1}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,_){return(!_||_.validate!==!1)&&fe(this,l.call(so,Object.assign({value:f,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}let wn,An,Si,bs,Xs=class extends i.E{constructor(v,l,f,_){super();const E=wn||(wn=new i.a9({density:new i.aa(i.a6.snow.density),intensity:new i.aa(i.a6.snow.intensity),color:new i.aa(i.a6.snow.color),opacity:new i.aa(i.a6.snow.opacity),vignette:new i.aa(i.a6.snow.vignette),"vignette-color":new i.aa(i.a6.snow["vignette-color"]),"center-thinning":new i.aa(i.a6.snow["center-thinning"]),direction:new i.aa(i.a6.snow.direction),"flake-size":new i.aa(i.a6.snow["flake-size"])}));this._transitionable=new i.a8(E,f,new Map(_)),this.set(v,_),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(E),this.scope=f}get state(){const v=this.properties.get("opacity"),l=this.properties.get("color"),f=this.properties.get("direction"),_=i.an(f[0]),E=-Math.max(i.an(f[1]),.01),j=[Math.cos(_)*Math.cos(E),Math.sin(_)*Math.cos(E),Math.sin(E)],k=this.properties.get("vignette"),L=this.properties.get("vignette-color");return L.a=k,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(l.r,l.g,l.b,l.a*v),direction:j,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:L}}get(){return this._transitionable.serialize()}set(v,l,f={}){if(this._validate(yn,v,f))return;const _=Object.assign({},v),E=i.a6.snow;for(const j of Object.keys(E))_[j]===void 0&&(_[j]=E[j].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,l)}updateConfig(v){this._transitionable.setTransitionOrValue(this._options,new Map(v))}updateTransitions(v){this._transitioning=this._transitionable.transitioned(v,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(v){this.properties=this._transitioning.possiblyEvaluate(v)}_validate(v,l,f){return(!f||f.validate!==!1)&&fe(this,v.call(so,Object.assign({value:l,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}},Rs=class extends i.E{constructor(v,l,f,_){super();const E=An||(An=new i.a9({density:new i.aa(i.a6.rain.density),intensity:new i.aa(i.a6.rain.intensity),color:new i.aa(i.a6.rain.color),opacity:new i.aa(i.a6.rain.opacity),vignette:new i.aa(i.a6.rain.vignette),"vignette-color":new i.aa(i.a6.rain["vignette-color"]),"center-thinning":new i.aa(i.a6.rain["center-thinning"]),direction:new i.aa(i.a6.rain.direction),"droplet-size":new i.aa(i.a6.rain["droplet-size"]),"distortion-strength":new i.aa(i.a6.rain["distortion-strength"])}));this._transitionable=new i.a8(E,f,new Map(_)),this.set(v,_),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(E),this.scope=f}get state(){const v=this.properties.get("opacity"),l=this.properties.get("color"),f=this.properties.get("direction"),_=i.an(f[0]),E=-Math.max(i.an(f[1]),.01),j=[Math.cos(_)*Math.cos(E),Math.sin(_)*Math.cos(E),Math.sin(E)],k=this.properties.get("vignette-color");return k.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(l.r,l.g,l.b,l.a*v),direction:j,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:k}}get(){return this._transitionable.serialize()}set(v,l,f={}){if(this._validate(Zs,v,f))return;const _=Object.assign({},v),E=i.a6.rain;for(const j of Object.keys(E))_[j]===void 0&&(_[j]=E[j].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,l)}updateConfig(v){this._transitionable.setTransitionOrValue(this._options,new Map(v))}updateTransitions(v){this._transitioning=this._transitionable.transitioned(v,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(v){this.properties=this._transitioning.possiblyEvaluate(v)}_validate(v,l,f){return(!f||f.validate!==!1)&&fe(this,v.call(so,Object.assign({value:l,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}};class ks extends i.E{constructor(l,f,_,E){super(),this.scope=_,this._options=l,this.properties=new i.ai(f),this._transitionable=new i.a8(f,_,new Map(E)),this._transitionable.setTransitionOrValue(l.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(l){this._transitionable.setTransitionOrValue(this._options.properties,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(l,f){this._options=l,this._transitionable.setTransitionOrValue(l.properties,f)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class _i{constructor(l,f,_){this.screenBounds=l,this.cameraPoint=_.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(l,f){let _,E;if(l instanceof i.P||typeof l[0]=="number"){const j=i.P.convert(l);_=[j],E=f.isPointAboveHorizon(j)}else{const j=i.P.convert(l[0]),k=i.P.convert(l[1]),L=j.add(k)._div(2);_=[j,k],E=i.aq(j,k).every(B=>f.isPointAboveHorizon(B))&&f.isPointAboveHorizon(L)}return new _i(_,E,f)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(l){return i.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const f=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],E=i.aq(f,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>f.x&&this.cameraPoint.x<_.x?E.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?E[2]=this.cameraPoint:this.cameraPoint.x<=f.x&&(E[3]=this.cameraPoint)),i.ar(E,l)}bufferedCameraGeometryGlobe(l){const f=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],E=i.aq(f,_,l),j=this.cameraPoint.clone();switch(3*((j.y>f.y)+(j.y>_.y))+((j.x>f.x)+(j.x>_.x))){case 0:E[0]=j,E[4]=j.clone();break;case 1:E.splice(1,0,j);break;case 2:E[1]=j;break;case 3:E.splice(4,0,j);break;case 5:E.splice(2,0,j);break;case 6:E[3]=j;break;case 7:E.splice(3,0,j);break;case 8:E[2]=j}return E}containsTile(l,f,_,E=0){const j=Math.max(l.queryPadding,l.evaluateQueryRenderedFeaturePadding())/f._pixelsPerMercatorPixel+1,k=_?this._bufferedCameraMercator(j,f):this._bufferedScreenMercator(j,f);let L=l.tileID.wrap+(k.unwrapped?E:0);const B=k.polygon.map(xe=>i.as(l.tileTransform,xe,L));if(!i.at(B,0,0,i.al,i.al))return;L=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?E:0);const G=this.screenGeometryMercator.polygon.map(xe=>i.au(l.tileTransform,xe,L)),Z=G.map(xe=>new i.P(xe[0],xe[1])),Q=f.getFreeCameraOptions().position||new i.ae(0,0,0),X=i.au(l.tileTransform,Q,L),se=G.map(xe=>{const ye=i.av(xe,xe,X);return i.aw(ye,ye),new i.ax(X,ye)}),le=i.ay(l,1,f.zoom)*f._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:Z,tilespaceRays:se,bufferedTilespaceGeometry:B,bufferedTilespaceBounds:(de=i.az(B),de.min.x=i.aA(de.min.x,0,i.al),de.min.y=i.aA(de.min.y,0,i.al),de.max.x=i.aA(de.max.x,0,i.al),de.max.y=i.aA(de.max.y,0,i.al),de),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:le};var de}_bufferedScreenMercator(l,f){const _=gs(l);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let E;return E=f.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(l),f):{polygon:this.bufferedScreenGeometry(l).map(j=>f.pointCoordinate3D(j)),unwrapped:!0},this._screenRaycastCache[_]=E,E}}_bufferedCameraMercator(l,f){const _=gs(l);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let E;return E=f.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),f):{polygon:this.bufferedCameraGeometry(l).map(j=>f.pointCoordinate3D(j)),unwrapped:!0},this._cameraRaycastCache[_]=E,E}}_projectAndResample(l,f){const _=function(j,k){const L=i.aB([],k.pixelMatrix,k.globeMatrix),B=[0,-i.aD,0,1],G=[0,i.aD,0,1],Z=[0,0,0,1];i.aC(B,B,L),i.aC(G,G,L),i.aC(Z,Z,L);const Q=new i.P(B[0]/B[3],B[1]/B[3]),X=new i.P(G[0]/G[3],G[1]/G[3]),se=i.aE(j,Q)&&B[3]<Z[3],le=i.aE(j,X)&&G[3]<Z[3];if(!se&&!le)return null;const de=function(Ge,$e,Le){for(let Ke=1;Ke<Ge.length;Ke++){const dt=Yi($e.pointCoordinate3D(Ge[Ke-1]).x),at=Yi($e.pointCoordinate3D(Ge[Ke]).x);if(Le<0){if(dt<at)return{idx:Ke,t:-dt/(at-1-dt)}}else if(at<dt)return{idx:Ke,t:(1-dt)/(at+1-dt)}}return null}(j,k,se?-1:1);if(!de)return null;const{idx:xe,t:ye}=de;let Ee=xe>1?Mn(j.slice(0,xe),k):[],Ne=xe<j.length?Mn(j.slice(xe),k):[];Ee=Ee.map(Ge=>new i.P(Yi(Ge.x),Ge.y)),Ne=Ne.map(Ge=>new i.P(Yi(Ge.x),Ge.y));const je=[...Ee];je.length===0&&je.push(Ne[Ne.length-1]);const Ve=i.ak(je[je.length-1].y,(Ne.length===0?Ee[0]:Ne[0]).y,ye);let Ie;return Ie=se?[new i.P(0,Ve),new i.P(0,0),new i.P(1,0),new i.P(1,Ve)]:[new i.P(1,Ve),new i.P(1,1),new i.P(0,1),new i.P(0,Ve)],je.push(...Ie),Ne.length===0?je.push(Ee[0]):je.push(...Ne),{polygon:je.map(Ge=>new i.ae(Ge.x,Ge.y)),unwrapped:!1}}(l,f);if(_)return _;const E=function(j,k){let L=!1,B=-1/0,G=0;for(let Q=0;Q<j.length-1;Q++)j[Q].x>B&&(B=j[Q].x,G=Q);for(let Q=0;Q<j.length-1;Q++){const X=(G+Q)%(j.length-1),se=j[X],le=j[X+1];Math.abs(se.x-le.x)>.5&&(se.x<le.x?(se.x+=1,X===0&&(j[j.length-1].x+=1)):(le.x+=1,X+1===j.length-1&&(j[0].x+=1)),L=!0)}const Z=i.aF(k.center.lng);return L&&Z<Math.abs(Z-1)&&j.forEach(Q=>{Q.x-=1}),{polygon:j,unwrapped:L}}(Mn(l,f).map(j=>new i.P(Yi(j.x),j.y)),f);return{polygon:E.polygon.map(j=>new i.ae(j.x,j.y)),unwrapped:E.unwrapped}}}function Mn(v,l){return i.aG(v,f=>{const _=l.pointCoordinate3D(f);f.x=_.x,f.y=_.y},1/256)}function Yi(v){return v<0?1+v%1:v%1}function gs(v){return 100*v|0}function Ti(v,l,f,_,E){const j=function(L,B){if(L)return E(L);if(B){if(v.url&&B.tiles&&v.tiles&&delete v.tiles,B.variants){if(!Array.isArray(B.variants))return E(new Error("variants must be an array"));for(const Z of B.variants){if(Z==null||typeof Z!="object"||Z.constructor!==Object)return E(new Error("variant must be an object"));if(!Array.isArray(Z.capabilities))return E(new Error("capabilities must be an array"));if(Z.capabilities.length===1&&Z.capabilities[0]==="meshopt"){B=Object.assign(B,Z);break}}}const G=i.aH(Object.assign({},B,v),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);G.tiles=l.canonicalizeTileset(G,v.url),E(null,G)}},k=function(L,B,G){if(!L)return null;if(!B&&!G)return L;G=G||L.worldview_default;const Z=Object.values(L.language||{});if(Z.length===0)return null;const Q=Object.values(L.worldview||{});if(Q.length===0)return null;const X=Z.every(le=>le===B),se=Q.every(le=>le===G);return X&&se?L:B in(L.language_options||{})||G in(L.worldview_options||{})?null:L.language_options&&L.worldview_options?L:null}(v.data,f,_);return k?i.o.frame(()=>j(null,k)):v.url?i.m(l.transformRequest(l.normalizeSourceURL(v.url,null,f,_),i.R.Source),j):i.o.frame(()=>{const{data:L,...B}=v;j(null,B)})}function Ji(v,l){const f=Math.pow(2,l.z),_=Math.floor(i.aF(v.getWest())*f),E=Math.floor(i.aJ(v.getNorth())*f),j=Math.ceil(i.aF(v.getEast())*f),k=Math.ceil(i.aJ(v.getSouth())*f);return l.x>=_&&l.x<j&&l.y>=E&&l.y<k}class ua{constructor(l,f,_){this.bounds=l?i.aI.convert(this.validateBounds(l)):null,this.minzoom=f||0,this.maxzoom=_||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}addExtraBounds(l){if(l){this.extraBounds||(this.extraBounds=[]);for(const f of l)this.extraBounds.push(i.aI.convert(this.validateBounds(f)))}}contains(l){if(l.z>this.maxzoom||l.z<this.minzoom||this.bounds&&!Ji(this.bounds,l))return!1;if(!this.extraBounds)return!0;for(const f of this.extraBounds)if(Ji(f,l))return!0;return!1}static fromTileJSON(l){if(!l.bounds&&!l.extra_bounds)return null;const f=new ua(l.bounds,l.minzoom,l.maxzoom);return f.addExtraBounds(l.extra_bounds),f}}class zo extends i.E{constructor(l,f,_,E){if(super(),this.id=l,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,i.aH(f,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},f),this._collectResourceTiming=!!f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(E),this._tileWorkers={},this._deduped=new i.aK}load(l){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const f=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map.getWorldview();this._tileJSONRequest=Ti(this._options,this.map._requestManager,f,_,(E,j)=>{if(this._tileJSONRequest=null,this._loaded=!0,E)f&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${f}`),_&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new i.y(E));else if(j){if(Object.assign(this,j),this.hasWorldviews=!!j.worldview_options,j.worldview_default&&(this.worldviewDefault=j.worldview_default),j.vector_layers){this.vectorLayers=j.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const k of j.vector_layers)this.vectorLayerIds.push(k.id),j.worldview&&j.worldview[k.source]&&this.localizableLayerIds.add(k.id)}this.tileBounds=ua.fromTileJSON(j),pe(j.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}l&&l(E)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(l){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(l,f){const _=l.tileID.canonical.url(this.tiles,this.scheme),E=this.map._requestManager.normalizeTileURL(_),j=this.map._requestManager.transformRequest(E,i.R.Tile),k=this.map.style?this.map.style.getLut(this.scope):null,L=k?{image:k.image.clone()}:null,B={request:j,data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,lut:L,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&i.h(_)&&(B.localizableLayerIds=this.localizableLayerIds),B.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=f:l.request=l.actor.send("reloadTile",B,G.bind(this));else if(l.actor=this._tileWorkers[E]=this._tileWorkers[E]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",B,G.bind(this),void 0,!0);else{const Z=i.aL.call({deduped:this._deduped},B,(Q,X)=>{if(Q||!X)G.call(this,Q);else{const se=i.aM(X.responseHeaders);B.data={cacheControl:se.cacheControl,expires:se.expires,rawData:X.rawData.slice(0)},l.actor&&l.actor.send("loadTile",B,G.bind(this),void 0,!0)}},!0);l.request={cancel:Z}}function G(Z,Q){return delete l.request,l.aborted?f(null):Z&&Z.status!==404?f(Z):(Q&&Q.resourceTiming&&(l.resourceTiming=Q.resourceTiming),this.map._refreshExpiredTiles&&Q&&l.setExpiryData(Q),l.loadVectorData(Q,this.map.painter),i.aN(this.dispatcher),f(null,Q),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(l,f){l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class bc extends i.E{constructor(l,f,_,E){super(),this.id=l,this.dispatcher=_,this.setEventedParent(E),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},f),Object.assign(this,i.aH(f,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const f=this.map.getWorldview();this._tileJSONRequest=Ti(this._options,this.map._requestManager,null,f,(_,E)=>{this._tileJSONRequest=null,this._loaded=!0,_?this.fire(new i.y(_)):E&&(Object.assign(this,E),E.raster_layers&&(this.rasterLayers=E.raster_layers,this.rasterLayerIds=this.rasterLayers.map(j=>j.id)),this.tileBounds=ua.fromTileJSON(E),pe(E.tiles),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),l&&l(_)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(l){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,f){const _=i.o.devicePixelRatio>=2,E=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);l.request=i.n(this.map._requestManager.transformRequest(E,i.R.Tile),(j,k,L)=>{if(delete l.request,l.aborted)return l.state="unloaded",f(null);if(j)return l.state="errored",f(j);if(!k)return f(null);const B=i.aM(L);this.map._refreshExpiredTiles&&l.setExpiryData(B),l.setTexture(k,this.map.painter),l.state="loaded",i.aN(this.dispatcher),f(null)})}abortTile(l,f){l.request&&(l.request.cancel(),delete l.request),f&&f()}unloadTile(l,f){l.texture&&l.texture instanceof i.T?(l.destroy(!0),l.texture&&l.texture instanceof i.T&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),f&&f()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function sf([v,l],f,_,{scaled:E=!0}={}){const{tileSize:j,buffer:k}=_,{x:L,y:B,z:G}=f;if(!isFinite(L)||!isFinite(B)||!isFinite(G))throw new Error("Invalid MRT header");const Z=2**G,Q=Z*i.aF(v),X=Z*i.aJ(l);return function([se,le],de,{scaled:xe=!0}={}){if(!de)throw new Error("bandView is undefined");const{data:ye,tileSize:Ee,buffer:Ne,offset:je,scale:Ve,dimension:Ie}=de;if(se<-Ne||se>Ee+Ne||le<-Ne||le>Ee+Ne)throw new Error(`Point (${se}, ${le}) out of bounds for tileSize=${Ee}, buffer=${Ne}`);const Ge=(le+Ne)*(Ee+2*Ne)+(se+Ne);if(new Uint32Array(ye.buffer)[Ge]===4294967295)return null;let $e=[];$e=xe?[]:new de.data.constructor(Ie);for(let Le=0;Le<Ie;Le++)$e[Le]=Math.round(1e12*(ye[Ie*Ge+Le]*Ve+je))/1e12;return $e}([Math.min(Math.max(-k,Math.floor((Q-L)*j)),j-1+k),Math.min(Math.max(-k,Math.floor((X-B)*j)),j-1+k)],_,{scaled:E})}class ba extends bc{constructor(l,f,_,E){super(l,f,_,E),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},f)}triggerRepaint(l){const f=this.map.painter._terrain,_=this.map.style.getSourceCache(this.id);f&&f.enabled&&_&&f._clearRenderCacheForTile(_.id,l.tileID),this.map.triggerRepaint()}loadTile(l,f){const _=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),E=this.map._requestManager.transformRequest(_,i.R.Tile),j={request:E,uid:l.uid,tileID:l.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};l.source=this.id,l.scope=this.scope,l.requestParams=E,l.actor||(l.actor=this.dispatcher.getActor());const k=(L,B,G)=>{if(delete l.request,l.aborted)return l.state="unloaded",f(null);if(L)return L.name==="AbortError"?void 0:(l.state="errored",f(L));if(this.map._refreshExpiredTiles&&B){const Z=i.aM(G);l.setExpiryData(Z)}if(this.partial&&l.state!=="expired")l.state="empty";else if(!this.partial){if(!B)return f(null);l.state="loaded",l._isHeaderLoaded=!0,l._mrt=B}f(null)};l.request=this.partial?l.fetchHeader(void 0,k.bind(this)):l.actor.send("loadTile",j,k.bind(this),void 0,!0)}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(l,f){const _=l.texturePerLayer;if(l.flushAllQueues(),_.size){l.destroy(!0);for(const E of _.values())this.map.painter.saveTileTexture(E)}else l.destroy()}prepareTile(l,f,_,E){l._isHeaderLoaded&&(l.state!=="empty"&&(l.state="reloading"),l.fetchBandForRender(f,_,E,(j,k)=>{if(j)return l.state="errored",this.fire(new i.y(j)),void this.triggerRepaint(l);k&&(l._isHeaderLoaded=!0,l.setTexturePerLayer(_,k,this.map.painter),l.state="loaded",this.triggerRepaint(l))}))}getInitialBand(l){if(!this.rasterLayers)return 0;const f=this.rasterLayers.find(({id:j})=>j===l),_=f&&f.fields,E=_&&_.bands&&_.bands;return E?E[0]:0}getTextureDescriptor(l,f,_){if(!l)return;const E=f.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!E)return;let j=null;f instanceof i.aQ?j=f.paint.get("raster-array-band"):f instanceof i.aR&&(j=f.paint.get("raster-particle-array-band"));const k=j||this.getInitialBand(E);if(k==null)return;if(!l.textureDescriptorPerLayer.get(f.id))return void this.prepareTile(l,E,f.id,k);if(l.updateNeeded(f.id,k)&&!_)return;const L=l.textureDescriptorPerLayer.get(f.id);return Object.assign({},L,{texture:l.texturePerLayer.get(f.id)})}getImages(l,f){const _=new Map;for(const E of l)for(const j of f){const[k,L]=j.split("/"),B=E.getLayer(k);if(!B||!B.hasBand(L)||!B.hasDataForBand(L))continue;const{bytes:G,tileSize:Z,buffer:Q}=B.getBandView(L),X=Z+2*Q,se={data:new i.q({width:X,height:X},G),pixelRatio:2,sdf:!1,usvg:!1,version:0};_.set(j,se)}return _}queryRasterArrayValueByBandId(l,f,_){const E=f._mrt;return new Promise(j=>{const k={},L=new Set;for(const[B,G]of Object.entries(E.layers)){if(_.layerName&&B!==_.layerName)continue;const Z={};k[B]=Z;for(const{bands:Q}of G.dataIndex)for(const X of Q)_.bands&&!_.bands.includes(X)||(L.add(i.B(B,X)),f.fetchBand(B,null,X,se=>{i.o.frame(()=>{Z[X]=se?null:sf([l.lng,l.lat],E,G.getBandView(X)),L.delete(i.B(B,X)),L.size===0&&j(k)})},!1))}L.size===0&&j(k)})}_loadTileForQuery(l,f){if(this._loadTileLoaded[l.uid])return void f(null,l._mrt);if(this._loadTilePending[l.uid])return void this._loadTilePending[l.uid].push(f);this._loadTilePending[l.uid]=[f];const _=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),E=this.map._requestManager.transformRequest(_,i.R.Tile);l.actor.send("loadTile",{request:E,uid:l.uid,tileID:l.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(j,k,L)=>{if(j)return this._loadTilePending[l.uid].forEach(B=>B(j,null)),void delete this._loadTilePending[l.uid];if(!k)return this._loadTilePending[l.uid].forEach(B=>B(null,null)),void delete this._loadTilePending[l.uid];if(this.map._refreshExpiredTiles&&k){const B=i.aM(L);l.setExpiryData(B)}l._mrt=k,l._isHeaderLoaded=!0,l.state="loaded",this._loadTilePending[l.uid].forEach(B=>B(null,k)),this._loadTileLoaded[l.uid]=!0,delete this._loadTilePending[l.uid]},void 0,!0)}queryRasterArrayValueByAllBands(l,f,_){return new Promise((E,j)=>{this._loadTileForQuery(f,(k,L)=>{k?j(k):E(L?this.queryRasterArrayValueByBandId(l,f,_):null)})})}queryRasterArrayValue(l,f){const _=i.aS.convert(l),E=this.findLoadedParent(_);return E&&E._mrt?f.bands||!this.partial?this.queryRasterArrayValueByBandId(_,E,f):this.queryRasterArrayValueByAllBands(_,E,f):Promise.resolve(null)}findLoadedParent(l){const f=i.ae.fromLngLat(l,this.map.transform.tileSize),_=this.maxzoom+1,E=1<<_,j=Math.floor(f.x),k=Math.floor((f.x-j)*E),L=Math.floor(f.y*E),B=this.map.style.getSourceCache(this.id),G=new i.aP(_,j,_,k,L);return B.findLoadedParent(G,this.minzoom)}}const wc={vector:zo,raster:bc,"raster-dem":class extends bc{constructor(v,l,f,_){super(v,l,f,_),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(v,l){const f=this.map._requestManager.normalizeTileURL(v.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(E,j){E&&(v.state="errored",l(E)),j&&(v.dem=j,v.dem.onDeserialize(),v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0,v.state="loaded",l(null))}v.request=i.n(this.map._requestManager.transformRequest(f,i.R.Tile),(function(E,j,k){if(delete v.request,v.aborted)v.state="unloaded",l(null);else if(E)v.state="errored",l(E);else if(j){const L=i.aM(k);this.map._refreshExpiredTiles&&v.setExpiryData(L);const B=ImageBitmap&&j instanceof ImageBitmap&&i.r(),G=1-(j.width-i.aO(j.width))/2;G<1||v.neighboringTiles||(v.neighboringTiles=this._getNeighboringTiles(v.tileID));const Z=B?j:i.o.getImageData(j,G),Q={uid:v.uid,tileID:v.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:Z,encoding:this.encoding,padding:G};v.actor&&v.state!=="expired"||(v.actor=this.dispatcher.getActor(),v.actor.send("loadTile",Q,_.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(v){const l=v.canonical,f=Math.pow(2,l.z),_=(l.x-1+f)%f,E=l.x===0?v.wrap-1:v.wrap,j=(l.x+1+f)%f,k=l.x+1===f?v.wrap+1:v.wrap,L={};return L[new i.aP(v.overscaledZ,E,l.z,_,l.y).key]={backfilled:!1},L[new i.aP(v.overscaledZ,k,l.z,j,l.y).key]={backfilled:!1},l.y>0&&(L[new i.aP(v.overscaledZ,E,l.z,_,l.y-1).key]={backfilled:!1},L[new i.aP(v.overscaledZ,v.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},L[new i.aP(v.overscaledZ,k,l.z,j,l.y-1).key]={backfilled:!1}),l.y+1<f&&(L[new i.aP(v.overscaledZ,E,l.z,_,l.y+1).key]={backfilled:!1},L[new i.aP(v.overscaledZ,v.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},L[new i.aP(v.overscaledZ,k,l.z,j,l.y+1).key]={backfilled:!1}),L}},"raster-array":ba,geojson:class extends i.E{constructor(v,l,f,_){super(),this.id=v,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=f.getActor(),this.setEventedParent(_),this._data=l.data,this._options=Object.assign({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.minzoom!==void 0&&(this.minzoom=l.minzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const E=i.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*E,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*E,extent:i.al,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:i.al,radius:(l.clusterRadius!==void 0?l.clusterRadius:50)*E,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter,dynamic:l.dynamic},l.workerOptions)}onAdd(v){this.map=v,this.setData(this._data)}setData(v){return this._data=v,this._updateWorkerData(),this}updateData(v){if(!this._options.dynamic)return this.fire(new i.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof v!="string"&&(v.type==="Feature"&&(v={type:"FeatureCollection",features:[v]}),v.type!=="FeatureCollection"))return this.fire(new i.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof v!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const l=new Map;for(const f of this._data.features)l.set(f.id,f);for(const f of v.features)l.set(f.id,f);this._data.features=[...l.values()]}else this._data=v;return this._updateWorkerData(!0),this}getClusterExpansionZoom(v,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:v,source:this.id,scope:this.scope},l),this}getClusterChildren(v,l){return this.actor.send("geojson.getClusterChildren",{clusterId:v,source:this.id,scope:this.scope},l),this}getClusterLeaves(v,l,f,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:v,limit:l,offset:f},_),this}_updateWorkerData(v=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.z("dataloading",{dataType:"source"})),this._loaded=!1;const l=Object.assign({append:v},this.workerOptions);l.scope=this.scope;const f=this._data;typeof f=="string"?(l.request=this.map._requestManager.transformRequest(i.o.resolveURL(f),i.R.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(f),this._pendingLoad=this.actor.send(`${this.type}.loadData`,l,(_,E)=>{if(this._loaded=!0,this._pendingLoad=null,_)this.fire(new i.y(_));else{const j={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&E&&E.resourceTiming&&E.resourceTiming[this.id]&&(j.resourceTiming=E.resourceTiming[this.id]),v&&(this._partialReload=!0),this.fire(new i.z("data",j)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(v),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const v=i.B(this.id,this.scope);this.map.style.clearSource(v),this._updateWorkerData()}loadTile(v,l){const f=v.actor?"reloadTile":"loadTile";v.actor=this.actor;const _=this.map.style?this.map.style.getLut(this.scope):null,E=_?{image:_.image.clone()}:null,j=this._partialReload,k={type:this.type,uid:v.uid,tileID:v.tileID,tileZoom:v.tileZoom,zoom:v.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:E,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:v.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:j,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};v.request=this.actor.send(f,k,(L,B)=>j&&!B?(v.state="loaded",l(null)):(delete v.request,v.destroy(),v.aborted?l(null):L?l(L):(v.loadVectorData(B,this.map.painter,f==="reloadTile"),l(null))),void 0,f==="loadTile")}abortTile(v){v.request&&(v.request.cancel(),delete v.request),v.aborted=!0}unloadTile(v,l){this.actor.send("removeTile",{uid:v.uid,type:this.type,source:this.id,scope:this.scope}),v.destroy()}onRemove(v){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aT{constructor(v,l,f,_){super(v,l,f,_),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const v=this.options;this.urls=[];for(const l of v.urls)this.urls.push(this.map._requestManager.transformRequest(l,i.R.Source).url);i.aU(this.urls,(l,f)=>{this._loaded=!0,l?this.fire(new i.y(l)):f&&(this.video=f,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(v){if(this.video){const l=this.video.seekable;v<l.start(0)||v>l.end(0)?this.fire(new i.y(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=v}}getVideo(){return this.video}onAdd(v){this.map||(this.map=v,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const v=this.map.painter.context,l=v.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(v,this.video,l.RGBA8),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(v)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aT,model:i.aW,"batched-model":class extends i.E{constructor(v,l,f,_){super(),this.type="batched-model",this.id=v,this.tileSize=512,this._options=l,this.tiles=this._options.tiles,this.maxzoom=l.maxzoom||19,this.minzoom=l.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=f,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(_)}onAdd(v){this.map=v,this.load()}reload(){this.cancelTileJSONRequest();const v=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(v))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(v){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map.getWorldview();this._tileJSONRequest=Ti(this._options,this.map._requestManager,l,f,(_,E)=>{this._tileJSONRequest=null,this._loaded=!0,_?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new i.y(_))):E&&(Object.assign(this,E),E.bounds&&(this.tileBounds=new ua(E.bounds,this.minzoom,this.maxzoom)),pe(E.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),v&&v(_)})}hasTransition(){return!1}hasTile(v){return!this.tileBounds||this.tileBounds.contains(v.canonical)}loaded(){return this._loaded}loadTile(v,l){const f=this.map._requestManager.normalizeTileURL(v.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(f,i.R.Tile),data:void 0,uid:v.uid,tileID:v.tileID,tileZoom:v.tileZoom,zoom:v.tileID.overscaledZ,tileSize:this.tileSize*v.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:v.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.o.devicePixelRatio,promoteId:this.promoteId};if(v.actor&&v.state!=="expired")if(v.state==="loading")v.reloadCallback=l;else{if(v.buckets){const j=Object.values(v.buckets);for(const k of j)k.dirty=!0;return void(v.state="loaded")}v.request=v.actor.send("reloadTile",_,E.bind(this))}else v.actor=this.dispatcher.getActor(),v.request=v.actor.send("loadTile",_,E.bind(this),void 0,!0);function E(j,k){return v.aborted?l(null):j&&j.status!==404?l(j):(this.map._refreshExpiredTiles&&k&&v.setExpiryData(k),v.loadModelData(k,this.map.painter),v.state="loaded",void l(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends i.aT{constructor(v,l,f,_){super(v,l,f,_),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(E=>!Array.isArray(E)||E.length!==2||E.some(j=>typeof j!="number"))||this.fire(new i.y(new i.V(`sources.${v}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.y(new i.V(`sources.${v}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new i.y(new i.V(`sources.${v}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new i.y(new i.V(`sources.${v}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.y(new i.V(`sources.${v}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(v){this.map=v,this.load(),this.canvas&&this.animate&&this.play()}onRemove(v){this.pause()}prepare(){let v=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,v=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,v=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context;this.texture?!v&&!this._playing||this.texture instanceof i.aV||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(l,this.canvas,l.gl.RGBA8,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const v of[this.canvas.width,this.canvas.height])if(isNaN(v)||v<=0)return!0;return!1}},custom:class extends i.E{constructor(v,l,f,_){super(),this.id=v,this.type="custom",this._dataType="raster",this._dispatcher=f,this._implementation=l,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ua(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,i.aH(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(v){this.map=v,this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(v),this.load()}onRemove(v){this._implementation.onRemove&&this._implementation.onRemove(v)}hasTile(v){if(this._implementation.hasTile){const{x:l,y:f,z:_}=v.canonical;return this._implementation.hasTile({x:l,y:f,z:_})}return!this.tileBounds||this.tileBounds.contains(v.canonical)}loadTile(v,l){const{x:f,y:_,z:E}=v.tileID.canonical,j=new AbortController;v.request=Promise.resolve(this._implementation.loadTile({x:f,y:_,z:E},{signal:j.signal})).then((function(k){return delete v.request,v.aborted?(v.state="unloaded",l(null)):k===void 0?(v.state="errored",l(null)):k===null?(this.loadTileData(v,{width:this.tileSize,height:this.tileSize,data:null}),v.state="loaded",l(null)):function(L){return L instanceof ImageData||L instanceof HTMLCanvasElement||L instanceof ImageBitmap||L instanceof HTMLImageElement}(k)?(this.loadTileData(v,k),v.state="loaded",void l(null)):(v.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(k=>{k.name!=="AbortError"&&(v.state="errored",l(k))}),v.request.cancel=()=>j.abort()}loadTileData(v,l){v.setTexture(l,this.map.painter)}unloadTile(v,l){if(v.texture&&v.texture instanceof i.T?(v.destroy(!0),v.texture&&v.texture instanceof i.T&&this.map.painter.saveTileTexture(v.texture)):v.destroy(),this._implementation.unloadTile){const{x:f,y:_,z:E}=v.tileID.canonical;this._implementation.unloadTile({x:f,y:_,z:E})}l&&l()}abortTile(v,l){v.request&&v.request.cancel&&(v.request.cancel(),delete v.request),l&&l()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(v=>({x:v.canonical.x,y:v.canonical.y,z:v.canonical.z}))}_clearTiles(){const v=i.B(this.id,this.scope);this.map.style.clearSource(v)}_update(){this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}}},nl=function(v,l,f,_){const E=new wc[l.type](v,l,f,_);if(E.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${E.id}`);return i.aX(["load","abort","unload","serialize","prepare"],E),E};function eu(v,l,f=""){return`${f}:${l.id||""}:${l.layer.id}:${function(_){if("layerId"in _)return`layer:${_.layerId}`;{const{featuresetId:E,importId:j}=_;return`featureset:${E}${j?`:import:${j}`:""}`}}(v.target)}`}function jl(v,l,f,_=""){if(v.uniqueFeatureID){const E=eu(v,l,_);if(f.has(E))return!0;f.add(E)}return!1}function Pl(v,l,f,_,E=!1){const j=l.sourceCache.transform,k=l.sourceCache.tilesIn(v,l.has3DLayers,E);k.sort(Ng);const L=[];for(const B of k){const G=B.tile.queryRenderedFeatures(l,B,f,_,j,E);Object.keys(G).length&&L.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:G})}for(const B in l.layers){const G=l.layers[B];if(G.styleLayer){const Z=G.styleLayer.queryRenderedFeatures(v,l.sourceCache,_);Object.keys(Z).length&&L.push({wrappedTileID:0,queryResults:Z})}}return L.length===0?{}:function(B){const G={},Z={};for(const Q of B){const X=Q.queryResults,se=Q.wrappedTileID,le=Z[se]=Z[se]||{};for(const de in X){const xe=X[de],ye=le[de]=le[de]||{},Ee=G[de]=G[de]||[];for(const Ne of xe)ye[Ne.featureIndex]||(ye[Ne.featureIndex]=!0,Ee.push(Ne))}}return G}(L)}function i_(v,l,f,_,E,j){const k={},L=_.queryRenderedSymbols(v),B=[];for(const G of Object.keys(L).map(Number))B.push(E[G]);B.sort(Ng);for(const G of B){const Z=G.featureIndex.lookupSymbolFeatures(L[G.bucketInstanceId],G.bucketIndex,G.sourceLayerIndex,l,f,j);for(const Q in Z){const X=k[Q]=k[Q]||[],se=Z[Q];se.sort((le,de)=>{const xe=G.featureSortOrder;if(xe){const ye=xe.indexOf(le.featureIndex);return xe.indexOf(de.featureIndex)-ye}return de.featureIndex-le.featureIndex});for(const le of se)X.push(le)}}return k}function kg(v,l){const f=v.getRenderableIds().map(j=>v.getTileByID(j)),_=[],E={};for(let j=0;j<f.length;j++){const k=f[j],L=k.tileID.canonical.key;E[L]||(E[L]=!0,k.querySourceFeatures(_,l))}return _}function Ng(v,l){const f=v.tileID,_=l.tileID;return f.overscaledZ-_.overscaledZ||f.canonical.y-_.canonical.y||f.wrap-_.wrap||f.canonical.x-_.canonical.x}function Ig(v,l){const f={};if(!l)return f;for(const _ of v){const E=_.layerIds.map(j=>l.getLayer(j)).filter(Boolean);if(E.length!==0){_.layers=E,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(j=>E.filter(k=>k.id===j)[0]));for(const j of E)f[j.fqid]=_}}return f}const ml=32,tu=33,il=new Uint16Array(8184);for(let v=0;v<2046;v++){let l=v+2,f=0,_=0,E=0,j=0,k=0,L=0;for(1&l?E=j=k=ml:f=_=L=ml;(l>>=1)>1;){const G=f+E>>1,Z=_+j>>1;1&l?(E=f,j=_,f=k,_=L):(f=E,_=j,E=k,j=L),k=G,L=Z}const B=4*v;il[B+0]=f,il[B+1]=_,il[B+2]=E,il[B+3]=j}const Vl=new Uint16Array(2178),ad=new Uint8Array(1089),af=new Uint16Array(1089);function s_(v){return v===0?-.03125:v===32?.03125:0}const a_={type:2,extent:i.al,loadGeometry:()=>[[new i.P(0,0),new i.P(i.al+1,0),new i.P(i.al+1,i.al+1),new i.P(0,i.al+1),new i.P(0,0)]]};class Cu{constructor(l,f,_,E,j,k){this.tileID=l,this.uid=i.b1(),this.uses=0,this.tileSize=f,this.tileZoom=_,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=j,E&&E.style&&(this._lastUpdatedBrightness=E.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",E&&E.transform&&(this.projection=E.transform.projection),this.worldview=k,this._hasAppearances=null}registerFadeDuration(l){const f=l+this.timeAdded;f<i.o.now()||this.fadeEndTime&&f<this.fadeEndTime||(this.fadeEndTime=f)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aY(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(l,f,_){if(this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=Ig(l.buckets,f.style),this.hasSymbolBuckets=!1;for(const E in this.buckets){const j=this.buckets[E];if(j instanceof i.b3){if(this.hasSymbolBuckets=!0,!_)break;j.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const E in this.buckets){const j=this.buckets[E];if(j instanceof i.b3&&j.hasRTLText){this.hasRTLText=!0,i.b4();break}}this.queryPadding=0;for(const E in this.buckets){const j=this.buckets[E],k=f.style.getOwnLayer(E);if(!k)continue;const L=k.queryRadius(j);this.queryPadding=Math.max(this.queryPadding,L)}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage),l.lineAtlas&&(this.lineAtlas=l.lineAtlas),this._lastUpdatedBrightness=l.brightness}else this.collisionBoxArray=new i.b2}unloadVectorData(){if(this.hasData()){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(l,f,_){l&&(l.resourceTiming&&(this.resourceTiming=l.resourceTiming),this.buckets=Object.assign({},this.buckets,Ig(l.buckets,f.style)),l.featureIndex&&(this.latestFeatureIndex=l.featureIndex))}getBucket(l){return this.buckets[l.fqid]}upload(l,f){for(const j in this.buckets){const k=this.buckets[j];if(k.uploadPending()){let L={},B=[],G={zoom:0,pitch:0,brightness:0,worldview:""};if(f){if(f.style){B=f.style.listImages();const Z=k.layers[0],Q=Z.sourceLayer||"_geojsonTileLayer",X=f.style.getLayerSourceCache(Z);X&&(L=X._state.getState(Q,void 0))}G={zoom:f.transform.zoom||0,pitch:f.transform.pitch||0,brightness:f.style.getBrightness()||0,worldview:f.worldview||""}}k.upload(l,this.tileID.canonical,L,B,G)}}const _=l.gl,E=this.imageAtlas;E&&!E.uploaded&&(this.imageAtlasTexture=new i.T(l,E.image,_.RGBA8,{useMipmap:!!E.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(l,this.glyphAtlasImage,_.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(l,this.lineAtlas.image,_.R8),this.lineAtlas.uploaded=!0)}prepare(l,f,_){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture,_),!f||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const E=f.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(f)),(this._lastUpdatedBrightness||E||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&E&&Math.abs(this._lastUpdatedBrightness-E)<.001||(this.updateBuckets(f,this._lastUpdatedBrightness!==E),this._lastUpdatedBrightness=E))}evaluateQueryRenderedFeaturePadding(){let l=0;for(const f in this.buckets){const _=this.buckets[f];_.evaluateQueryRenderedFeaturePadding&&(l=Math.max(l,_.evaluateQueryRenderedFeaturePadding()))}return l}queryRenderedFeatures(l,f,_,E,j,k){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const L=this.evaluateQueryRenderedFeaturePadding(),B=function(G,Z){const Q=i.bp([],[.5*G.width,.5*-G.height,1]);return i.bq(Q,Q,[1,-1,0]),i.aB(Q,Q,G.calculateProjMatrix(Z.toUnwrapped())),Float32Array.from(Q)}(j,this.tileID);return this.latestFeatureIndex.query(l,{tilespaceGeometry:f,pixelPosMatrix:B,transform:E,availableImages:_,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:L})}querySourceFeatures(l,f){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const E=_.loadVTLayers(),j=f?f.sourceLayer:"",k=E._geojsonTileLayer||E[j];if(!k)return;const L=i.b5(f&&f.filter),{z:B,x:G,y:Z}=this.tileID.canonical,Q={z:B,x:G,y:Z};for(let X=0;X<k.length;X++){const se=k.feature(X);if(L.needGeometry){const xe=i.b6(se,!0);if(!L.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),xe,this.tileID.canonical))continue}else if(!L.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),se))continue;const le=_.getId(se,j),de=new i.b7(se,B,G,Z,le);de.tile=Q,l.push(de)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(l){const f=this.expirationTime;if(l.cacheControl){const _=i.b8(l.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const _=Date.now();let E=!1;if(this.expirationTime>_)E=!1;else if(f)if(this.expirationTime<f)E=!0;else{const j=this.expirationTime-f;j?this.expirationTime=_+Math.max(j,3e4):E=!0}else E=!0;E?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(l){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&l&&this.updateBuckets(l)}hasAppearances(l){for(const f in this.buckets)if(l.style.hasLayer(f)&&this.buckets[f].layers.some(_=>_.appearances&&_.appearances.length>0))return!0;return!1}updateBuckets(l,f){if(!this.latestFeatureIndex||!l.style)return;const _=this.latestFeatureIndex.loadVTLayers(),E=l.style.listImages(),j=l.style.getBrightness();for(const k in this.buckets){if(!l.style.hasLayer(k))continue;const L=this.buckets[k],B=L.layers[0],G=B.sourceLayer||"_geojsonTileLayer",Z=_[G],Q=l.style.getLayerSourceCache(B);let X={};Q&&(X=Q._state.getState(G,void 0));const se=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},le=Object.keys(X).length>0&&!f;if(L.hasAppearances=L.layers.some(xe=>xe.appearances&&xe.appearances.length>0),(le&&L.stateDependentLayers.length!==0||f)&&L.update(X,Z,E,se,le?L.stateDependentLayers:L.layers,f,j),le&&L.stateDependentLayers.length!==0||f||L.hasAppearances){const xe={zoom:l.transform.zoom,pitch:l.transform.pitch,brightness:l.style.getBrightness()||0,worldview:l.worldview};L.updateAppearances(this.tileID.canonical,X,E,xe)}(L instanceof i.b9||L instanceof i.ba)&&l._terrain&&l._terrain.enabled&&Q&&L.uploadPending()&&l._terrain._clearRenderCacheForTile(Q.id,this.tileID);const de=l&&l.style&&l.style.getOwnLayer(k);de&&(this.queryPadding=Math.max(this.queryPadding,de.queryRadius(L)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=i.o.now()+l}setTexture(l,f){const _=f.context,E=_.gl;this.texture=this.texture||f.getTileTexture(l.width),this.texture&&this.texture instanceof i.T?this.texture.update(l):(this.texture=new i.T(_,l,E.RGBA8,{useMipmap:!0}),this.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE))}setDependencies(l,f){const _={};for(const E of f)_[E]=!0;this.dependencies[l]=_}hasDependency(l,f){for(const _ of l){const E=this.dependencies[_];if(E){for(const j of f)if(E[j])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(l,f){if(!f||f.name==="mercator"||this._tileDebugBuffer)return;const _=i.bb(a_,this.tileID.canonical,this.tileTransform)[0],E=new i.bc,j=new i.bd;for(let k=0;k<_.length;k++){const{x:L,y:B}=_[k];E.emplaceBack(L,B),j.emplaceBack(k)}j.emplaceBack(0),this._tileDebugIndexBuffer=l.createIndexBuffer(j),this._tileDebugBuffer=l.createVertexBuffer(E,i.be.members),this._tileDebugSegments=i.bf.simpleSegment(0,0,E.length,j.length)}_makeTileBoundsBuffers(l,f){if(this._tileBoundsBuffer||!f||f.name==="mercator")return;const _=i.bb(a_,this.tileID.canonical,this.tileTransform)[0];let E,j;if(this.isRaster){const k=function(L,B){const G=i.aY(L,B),Z=Math.pow(2,L.z);for(let xe=0;xe<tu;xe++)for(let ye=0;ye<tu;ye++){const Ee=i.aZ((L.x+(ye+s_(ye))/ml)/Z),Ne=i.a_((L.y+(xe+s_(xe))/ml)/Z),je=B.project(Ee,Ne),Ve=xe*tu+ye;Vl[2*Ve+0]=Math.round((je.x*G.scale-G.x)*i.al),Vl[2*Ve+1]=Math.round((je.y*G.scale-G.y)*i.al)}ad.fill(0),af.fill(0);for(let xe=2045;xe>=0;xe--){const ye=4*xe,Ee=il[ye+0],Ne=il[ye+1],je=il[ye+2],Ve=il[ye+3],Ie=Ee+je>>1,Ge=Ne+Ve>>1,$e=Ie+Ge-Ne,Le=Ge+Ee-Ie,Ke=Ne*tu+Ee,dt=Ve*tu+je,at=Ge*tu+Ie,Et=Math.hypot((Vl[2*Ke+0]+Vl[2*dt+0])/2-Vl[2*at+0],(Vl[2*Ke+1]+Vl[2*dt+1])/2-Vl[2*at+1])>=16;ad[at]=ad[at]||(Et?1:0),xe<1022&&(ad[at]=ad[at]||ad[(Ne+Le>>1)*tu+(Ee+$e>>1)]||ad[(Ve+Le>>1)*tu+(je+$e>>1)])}const Q=new i.a$,X=new i.b0;let se=0;function le(xe,ye){const Ee=ye*tu+xe;return af[Ee]===0&&(Q.emplaceBack(Vl[2*Ee+0],Vl[2*Ee+1],xe*i.al/ml,ye*i.al/ml),af[Ee]=++se),af[Ee]-1}function de(xe,ye,Ee,Ne,je,Ve){const Ie=xe+Ee>>1,Ge=ye+Ne>>1;if(Math.abs(xe-je)+Math.abs(ye-Ve)>1&&ad[Ge*tu+Ie])de(je,Ve,xe,ye,Ie,Ge),de(Ee,Ne,je,Ve,Ie,Ge);else{const $e=le(xe,ye),Le=le(Ee,Ne),Ke=le(je,Ve);X.emplaceBack($e,Le,Ke)}}return de(0,0,ml,ml,ml,0),de(ml,ml,0,0,0,ml),{vertices:Q,indices:X}}(this.tileID.canonical,f);E=k.vertices,j=k.indices}else{E=new i.a$,j=new i.b0;for(const{x:L,y:B}of _)E.emplaceBack(L,B,0,0);const k=i.bg(E.int16.subarray(0,4*E.length),void 0,4);for(let L=0;L<k.length;L+=3)j.emplaceBack(k[L],k[L+1],k[L+2])}this._tileBoundsBuffer=l.createVertexBuffer(E,i.bh.members),this._tileBoundsIndexBuffer=l.createIndexBuffer(j),this._tileBoundsSegments=i.bf.simpleSegment(0,0,E.length,j.length)}_makeGlobeTileDebugBuffers(l,f){const _=f.projection;if(!_||_.name!=="globe"||f.freezeTileCoverage)return;const E=this.tileID.canonical,j=i.bi(E,f),k=i.bj(j),L=i.aj(f.zoom);let B;L>0&&(B=i.bk(new Float64Array(16),f.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(l,E,f,k,B,L),this._makeGlobeTileDebugTextBuffer(l,E,f,k,B,L)}_globePoint(l,f,_,E,j,k,L){let B=i.bl(l,f,_);if(k){const G=1<<_.z,Z=i.aF(E.center.lng),Q=i.aJ(E.center.lat),X=(_.x+.5)/G-Z;let se=0;X>.5?se=-1:X<-.5&&(se=1);let le=(l/i.al+_.x)/G+se,de=(f/i.al+_.y)/G;le=(le-Z)*E._pixelsPerMercatorPixel+Z,de=(de-Q)*E._pixelsPerMercatorPixel+Q;const xe=[le*E.worldSize,de*E.worldSize,0];i.af(xe,xe,k),B=i.bm(B,xe,L)}return i.af(B,B,j)}_makeGlobeTileDebugBorderBuffer(l,f,_,E,j,k){const L=new i.bc,B=new i.bd,G=new i.bn,Z=(X,se,le,de,xe)=>{const ye=(le-X)/(xe-1),Ee=(de-se)/(xe-1),Ne=L.length;for(let je=0;je<xe;je++){const Ve=X+je*ye,Ie=se+je*Ee;L.emplaceBack(Ve,Ie);const Ge=this._globePoint(Ve,Ie,f,_,E,j,k);G.emplaceBack(Ge[0],Ge[1],Ge[2]),B.emplaceBack(Ne+je)}},Q=i.al;Z(0,0,Q,0,16),Z(Q,0,Q,Q,16),Z(Q,Q,0,Q,16),Z(0,Q,0,0,16),this._tileDebugIndexBuffer=l.createIndexBuffer(B),this._tileDebugBuffer=l.createVertexBuffer(L,i.be.members),this._globeTileDebugBorderBuffer=l.createVertexBuffer(G,i.bo.members),this._tileDebugSegments=i.bf.simpleSegment(0,0,L.length,B.length)}_makeGlobeTileDebugTextBuffer(l,f,_,E,j,k){const L=i.al/4,B=new i.bc,G=new i.b0,Z=new i.bn,Q=25;G.reserve(32),B.reserve(Q),Z.reserve(Q);const X=(se,le)=>Q*se+le;for(let se=0;se<Q;se++){const le=se*L;for(let de=0;de<Q;de++){const xe=de*L;B.emplaceBack(xe,le);const ye=this._globePoint(xe,le,f,_,E,j,k);Z.emplaceBack(ye[0],ye[1],ye[2])}}for(let se=0;se<4;se++)for(let le=0;le<4;le++){const de=X(se,le),xe=X(se,le+1),ye=X(se+1,le),Ee=X(se+1,le+1);G.emplaceBack(de,xe,ye),G.emplaceBack(ye,xe,Ee)}this._tileDebugTextIndexBuffer=l.createIndexBuffer(G),this._tileDebugTextBuffer=l.createVertexBuffer(B,i.be.members),this._globeTileDebugTextBuffer=l.createVertexBuffer(Z,i.bo.members),this._tileDebugTextSegments=i.bf.simpleSegment(0,0,Q,32)}destroy(l=!1){for(const f in this.buckets)this.buckets[f].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!l&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.br.setPbf(i.bs);class Qd extends Cu{constructor(l,f,_,E,j){super(l,f,_,E,j),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(l){return this._mrt&&this._mrt.getLayer(l)}setTexturePerLayer(l,f,_){const E=_.context,j=E.gl;let k=this.texturePerLayer.get(l)||_.getTileTexture(f.width);k&&k instanceof i.T?k.update(f,{premultiply:!1}):k=new i.T(E,f,j.RGBA8,{premultiply:!1}),this.texturePerLayer.has(l)||this.texturePerLayer.set(l,k)}flushQueues(l){const f=this._workQueuePerLayer.get(l)||[],_=this._fetchQueuePerLayer.get(l)||[];for(;f.length;)f.pop()();for(;_.length;)_.pop()()}flushAllQueues(){for(const l of this._workQueuePerLayer.keys()){const f=this._workQueuePerLayer.get(l)||[];for(;f.length;)f.pop()()}for(const l of this._fetchQueuePerLayer.keys()){const f=this._fetchQueuePerLayer.get(l)||[];for(;f.length;)f.pop()()}}fetchHeader(l=16384,f){const _=this._mrt=new i.br(30),E=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(l-1)}});return this.entireBuffer=null,this.request=i.bt(E,(j,k,L)=>{if(j)f(j);else try{const B=_.getHeaderLength(k);if(B>l)return void(this.request=this.fetchHeader(B,f));_.parseHeader(k),this._isHeaderLoaded=!0;let G=0;for(const Z of Object.values(_.layers))G=Math.max(G,Z.dataIndex[Z.dataIndex.length-1].lastByte);k.byteLength>=G&&(this.entireBuffer=k),f(null,this.entireBuffer||k,L)}catch(B){f(B)}}),this.request}fetchBandForRender(l,f,_,E){this.fetchBand(l,f,_,j=>{if(j)return void E(j);this.updateTextureDescriptor(l,f,_);const k=this.textureDescriptorPerLayer.get(f);E(null,k?k.img:null)})}fetchBand(l,f,_,E,j=!0){const k=this._mrt;if(!this._isHeaderLoaded||!k)return void E(new Error("Tile header is not ready"));const L=this.actor;if(!L)return void E(new Error("Can't fetch tile band without an actor"));let B;const G=i.B(String(_),i.B(this.tileID.key,l));let Z=this._taskQueue.get(G);Z?Z.add(E):(Z=new Set,Z.add(E),this._taskQueue.set(G,Z));const Q=(de,xe)=>{B.complete(de,xe),de?E(de):(Z.values().forEach(ye=>ye(null,xe)),this._taskQueue.delete(G))},X=(de,xe)=>{if(de)return E(de);const ye=L.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:xe,task:B},Q,void 0,!0);if(f!==null){const Ee=this._workQueuePerLayer.get(f)||[];Ee.push(()=>{ye&&ye.cancel(),B.cancel()}),this._workQueuePerLayer.has(f)||this._workQueuePerLayer.set(f,Ee)}};let se;try{se=k.getLayer(l)}catch(de){if(this.state==="reloading")return;throw de}if(!se)return void E(new Error(`Unknown sourceLayer "${l}"`));if(se.hasDataForBand(_))return Z.values().forEach(de=>de(null,null)),void this._taskQueue.delete(G);const le=se.getDataRange([_]);if(B=k.createDecodingTask(le),!B||B.tasks.length)if(f!==null&&this.flushQueues(f),this.entireBuffer)X(null,this.entireBuffer.slice(le.firstByte,le.lastByte+1));else{const de=Object.assign({},this.requestParams,{headers:{Range:`bytes=${le.firstByte}-${le.lastByte}`}}),xe=i.bt(de,X);if(f!==null){const ye=this._fetchQueuePerLayer.get(f)||[];ye.push(()=>{xe.cancel(),B.cancel()}),this._fetchQueuePerLayer.has(f)||this._fetchQueuePerLayer.set(f,ye)}}}updateNeeded(l,f){return(!this.textureDescriptorPerLayer.get(l)||this.textureDescriptorPerLayer.get(l).band!==f||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(l,f,_){if(!this._mrt)return;const E=this._mrt.getLayer(l);if(!E||!E.hasBand(_)||!E.hasDataForBand(_))return;const{bytes:j,tileSize:k,buffer:L,offset:B,scale:G}=E.getBandView(_),Z=k+2*L,Q=new i.q({width:Z,height:Z},j),X=this.texturePerLayer.get(f);X&&X instanceof i.T&&X.update(Q,{premultiply:!1}),this.textureDescriptorPerLayer.set(f,{layer:l,band:_,img:Q,buffer:L,offset:B,tileSize:k,format:E.pixelFormat,mix:[G,256*G,65536*G,16777216*G]})}destroy(l=!1){if(super.destroy(l),delete this._mrt,!l)for(const f of this.texturePerLayer.values())f&&f instanceof i.T&&f.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class jw{constructor(l,f){this.max=l,this.onRemove=f,this.reset()}reset(){for(const l in this.data)for(const f of this.data[l])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(l,f,_){const E=l.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);const j={value:f,timeout:void 0};if(_!==void 0&&(j.timeout=setTimeout(()=>{this.remove(l,j)},_)),this.data[E].push(j),this.order.push(E),this.order.length>this.max){const k=this._getAndRemoveByKey(this.order[0]);k&&this.onRemove(k)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value}getByKey(l){const f=this.data[l];return f?f[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,f){if(!this.has(l))return this;const _=l.wrapped().key,E=f===void 0?0:this.data[_].indexOf(f),j=this.data[_][E];return this.data[_].splice(E,1),j.timeout&&clearTimeout(j.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(j.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(l){const f=[];for(const _ in this.data)for(const E of this.data[_])l(E.value)||f.push(E);for(const _ of f)this.remove(_.value.tileID,_)}}class tA{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,f,_){const E=String(f);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][E]=this.stateChanges[l][E]||{},Object.assign(this.stateChanges[l][E],_),this.deletedStates[l]===null){this.deletedStates[l]={};for(const j in this.state[l])j!==E&&(this.deletedStates[l][j]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][E]===null){this.deletedStates[l][E]={};for(const j in this.state[l][E])_[j]||(this.deletedStates[l][E][j]=null)}else for(const j in _)this.deletedStates[l]&&this.deletedStates[l][E]&&this.deletedStates[l][E][j]===null&&delete this.deletedStates[l][E][j]}removeFeatureState(l,f,_){if(this.deletedStates[l]===null)return;const E=String(f);if(this.deletedStates[l]=this.deletedStates[l]||{},_&&f!==void 0)this.deletedStates[l][E]!==null&&(this.deletedStates[l][E]=this.deletedStates[l][E]||{},this.deletedStates[l][E][_]=null);else if(f!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][E])for(_ in this.deletedStates[l][E]={},this.stateChanges[l][E])this.deletedStates[l][E][_]=null;else this.deletedStates[l][E]=null;else this.deletedStates[l]=null}getState(l,f){const _=this.state[l]||{},E=this.stateChanges[l]||{},j=this.deletedStates[l];if(j===null)return{};if(f!==void 0){const L=String(f),B=Object.assign({},_[L],E[L]);if(j){const G=j[f];if(G===null)return{};for(const Z in G)delete B[Z]}return B}const k=Object.assign({},_,E);if(j)for(const L in j)delete k[L];return k}initializeTileState(l,f){l.refreshFeatureState(f)}coalesceChanges(l,f){const _={};for(const E in this.stateChanges){this.state[E]=this.state[E]||{};const j={};for(const k in this.stateChanges[E])this.state[E][k]||(this.state[E][k]={}),Object.assign(this.state[E][k],this.stateChanges[E][k]),j[k]=this.state[E][k];_[E]=j}for(const E in this.deletedStates){this.state[E]=this.state[E]||{};const j={};if(this.deletedStates[E]===null)for(const k in this.state[E])j[k]={},this.state[E][k]={};else for(const k in this.deletedStates[E]){if(this.deletedStates[E][k]===null)this.state[E][k]={};else if(this.state[E][k])for(const L of Object.keys(this.deletedStates[E][k]))delete this.state[E][k][L];j[k]=this.state[E][k]}_[E]=_[E]||{},Object.assign(_[E],j)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const E in l)l[E].refreshFeatureState(f)}}class Sc extends i.E{constructor(l,f,_){super(),this.id=l,this._onlySymbols=_,f.on("data",E=>{E.dataType==="source"&&E.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&E.dataType==="source"&&E.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),f.on("error",()=>{this._sourceErrored=!0}),this._source=f,this._tiles={},this._cache=new jw(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new tA,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(l){this.map=l,this._minTileCacheSize=this._minTileCacheSize===void 0&&l?l._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&l?l._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const l in this._tiles)if(!this._tiles[l].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(l,f){return l.isSymbolTile=this._onlySymbols,l.isExtraShadowCaster=this._shadowCasterTiles[l.tileID.key],this._source.loadTile(l,f)}_unloadTile(l){if(this._source.unloadTile)return this._source.unloadTile(l)}_abortTile(l){if(this._source.abortTile)return this._source.abortTile(l)}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const f in this._tiles){const _=this._tiles[f];_.upload(l,this.map?this.map.painter:void 0),_.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(l=>l.tileID).sort(Pw).map(l=>l.key)}getRenderableIds(l,f){const _=[];for(const E in this._tiles)this._isIdRenderable(+E,l,f)&&_.push(this._tiles[E]);return l?_.sort((E,j)=>{const k=E.tileID,L=j.tileID,B=new i.P(k.canonical.x,k.canonical.y)._rotate(this.transform.angle),G=new i.P(L.canonical.x,L.canonical.y)._rotate(this.transform.angle);return k.overscaledZ-L.overscaledZ||G.y-B.y||G.x-B.x}).map(E=>E.tileID.key):_.map(E=>E.tileID).sort(Pw).map(E=>E.key)}hasRenderableParent(l){const f=this.findLoadedParent(l,0);return!!f&&this._isIdRenderable(f.tileID.key)}_isIdRenderable(l,f,_){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(f||!this._tiles[l].holdingForFade())&&(_||!this._shadowCasterTiles[l])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(+l,"reloading")}}_reloadTile(l,f){const _=this._tiles[l];_&&(_.state!=="loading"&&(_.state=f),this._loadTile(_,this._tileLoaded.bind(this,_,l,f)))}_tileLoaded(l,f,_,E,j){if(E){if(l.state="errored",E.status!==404)this._source.fire(new i.y(E,{tile:l}));else{if(this._source.fire(new i.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:l})),!(l.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const L=this.map.painter.terrain;this.update(this.transform,L.getScaledDemTileSize(),!0),L.resetTileLookupCache(this.id)}else this.update(this.transform)}return}l.timeAdded=i.o.now(),_==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(f,l),this._source.type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null);let k=new Map;j&&j.responseHeaders&&(k=j.responseHeaders),this._source.fire(new i.z("data",{dataType:"source",tile:l,coord:l.tileID,sourceCacheId:this.id,responseHeaders:k}))}_backfillDEM(l){const f=this.getRenderableIds();for(let E=0;E<f.length;E++){const j=f[E];if(l.neighboringTiles&&l.neighboringTiles[j]){const k=this.getTileByID(j);_(l,k),_(k,l)}}function _(E,j){if(!E.dem||E.dem.borderReady)return;E.needsHillshadePrepare=!0,E.needsDEMTextureUpload=!0;let k=j.tileID.canonical.x-E.tileID.canonical.x;const L=j.tileID.canonical.y-E.tileID.canonical.y,B=Math.pow(2,E.tileID.canonical.z),G=j.tileID.key;k===0&&L===0||Math.abs(L)>1||(Math.abs(k)>1&&(Math.abs(k+B)===1?k+=B:Math.abs(k-B)===1&&(k-=B)),j.dem&&E.dem&&(E.dem.backfillBorder(j.dem,k,L),E.neighboringTiles&&E.neighboringTiles[G]&&(E.neighboringTiles[G].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,f,_,E){for(const j in this._tiles){let k=this._tiles[j];if(E[j]||!k.hasData()||k.tileID.overscaledZ<=f||k.tileID.overscaledZ>_)continue;let L=k.tileID;for(;k&&k.tileID.overscaledZ>f+1;){const G=k.tileID.scaledTo(k.tileID.overscaledZ-1);k=this._tiles[G.key],k&&k.hasData()&&(L=G)}let B=L;for(;B.overscaledZ>f;)if(B=B.scaledTo(B.overscaledZ-1),l[B.key]){E[L.key]=L;break}}}findLoadedParent(l,f){if(l.key in this._loadedParentTiles){const _=this._loadedParentTiles[l.key];return _&&_.tileID.overscaledZ>=f?_:null}for(let _=l.overscaledZ-1;_>=f;_--){const E=l.scaledTo(_),j=this._getLoadedTile(E);if(j)return j}}_getLoadedTile(l){const f=this._tiles[l.key];return f&&f.hasData()?f:this._cache.getByKey(this._source.reparseOverscaled?l.wrapped().key:l.canonical.key)}updateCacheSize(l,f){f=f||this._source.tileSize;const _=Math.ceil(l.width/f)+1,E=Math.ceil(l.height/f)+1,j=Math.floor(_*E*5),k=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,j):j,L=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,k):k;this._cache.setMaxSize(L)}handleWrapJump(l){const f=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,f){const _={};for(const E in this._tiles){const j=this._tiles[E];j.tileID=j.tileID.unwrapTo(j.tileID.wrap+f),_[j.tileID.key]=j}this._tiles=_;for(const E in this._timers)clearTimeout(this._timers[E]),delete this._timers[E];for(const E in this._tiles)this._setTileReloadTimer(+E,this._tiles[E])}}update(l,f,_,E,j){if(this.transform=l,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!_)return;this.updateCacheSize(l,f),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const k=this._source.type==="batched-model";let L,B=this._source.maxzoom;const G=this.map&&this.map.painter?this.map.painter._terrain:null;if(G&&G.sourceCache===this&&G.attenuationRange()){const X=G.attenuationRange()[0],se=Math.floor(X)-Math.log2(G.getDemUpscale());B>se&&(B=se)}if(this.used||this.usedForTerrain){if(this._source.tileID)L=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(X=>new i.aP(X.canonical.z,X.wrap,X.canonical.z,X.canonical.x,X.canonical.y));else if(this.tileCoverLift!==0){const X=l.clone();X.tileCoverLift=this.tileCoverLift,L=X.coveringTiles({tileSize:f||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:B,roundZoom:this._source.roundZoom&&!_,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:k}),this._source.minzoom<=1&&l.projection.name==="globe"&&(L.push(new i.aP(1,0,1,0,0)),L.push(new i.aP(1,0,1,1,0)),L.push(new i.aP(1,0,1,0,1)),L.push(new i.aP(1,0,1,1,1)))}else if(L=l.coveringTiles({tileSize:f||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:B,roundZoom:this._source.roundZoom&&!_,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:k}),this._source.hasTile){const X=this._source.hasTile.bind(this._source);L=L.filter(se=>X(se))}}else L=[];if(L.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!of(this._source.type)){const X=l.coveringZoomLevel({tileSize:f||this._source.tileSize,roundZoom:this._source.roundZoom&&!_}),se=Math.min(X,this._source.maxzoom);if(k){const le=l.extendTileCover(L,se);for(const de of le)L.push(de)}else if(j){const le=l.extendTileCoverToNearPlane(L,this.transform.getFrustum(se),se);for(const de of le)L.push(de)}else if(this.castsShadows&&E){const le=l.extendTileCover(L,se,E);for(const de of le)this._shadowCasterTiles[de.key]=!0,L.push(de)}}const Z=this._updateRetainedTiles(L);if(of(this._source.type)&&L.length!==0){const X={},se={},le=Object.keys(Z);for(const xe of le){const ye=Z[xe],Ee=this._tiles[xe];if(!Ee||Ee.fadeEndTime&&Ee.fadeEndTime<=i.o.now())continue;const Ne=this.findLoadedParent(ye,Math.max(ye.overscaledZ-Sc.maxOverzooming,this._source.minzoom));Ne&&(this._addTile(Ne.tileID),X[Ne.tileID.key]=Ne.tileID),se[xe]=ye}const de=L[L.length-1].overscaledZ;for(const xe in this._tiles){const ye=this._tiles[xe];if(Z[xe]||!ye.hasData())continue;let Ee=ye.tileID;for(;Ee.overscaledZ>de;){Ee=Ee.scaledTo(Ee.overscaledZ-1);const Ne=this._tiles[Ee.key];if(Ne&&Ne.hasData()&&se[Ee.key]){Z[xe]=ye.tileID;break}}}for(const xe in X)Z[xe]||(this._coveredTiles[xe]=!0,Z[xe]=X[xe])}for(const X in Z)this._tiles[X].clearFadeHold();const Q=i.bu(this._tiles,Z);for(const X of Q){const se=this._tiles[X];se.hasSymbolBuckets&&!se.holdingForFade()?se.setHoldDuration(this.map._fadeDuration):se.hasSymbolBuckets&&!se.symbolFadeFinished()||this._removeTile(+X)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(+l)}_updateRetainedTiles(l){const f={};if(l.length===0)return f;const _={},E=l.reduce((G,Z)=>Math.min(G,Z.overscaledZ),1/0),j=l[0].overscaledZ,k=Math.max(j-Sc.maxOverzooming,this._source.minzoom),L=Math.max(j+Sc.maxUnderzooming,this._source.minzoom),B={};for(const G of l){const Z=this._addTile(G);f[G.key]=G,Z.hasData()||E<this._source.maxzoom&&(B[G.key]=G)}this._retainLoadedChildren(B,E,L,f);for(const G of l){let Z=this._tiles[G.key];if(Z.hasData())continue;if(G.canonical.z>=this._source.maxzoom){const X=G.children(this._source.maxzoom)[0],se=this.getTile(X);if(se&&se.hasData()){f[X.key]=X;continue}}else{const X=G.children(this._source.maxzoom);if(f[X[0].key]&&f[X[1].key]&&f[X[2].key]&&f[X[3].key])continue}let Q=Z.wasRequested();for(let X=G.overscaledZ-1;X>=k;--X){const se=G.scaledTo(X);if(_[se.key]||(_[se.key]=!0,Z=this.getTile(se),!Z&&Q&&(Z=this._addTile(se)),Z&&(f[se.key]=se,Q=Z.wasRequested(),Z.hasData())))break}}return f}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const f=[];let _,E=this._tiles[l].tileID;for(;E.overscaledZ>0;){if(E.key in this._loadedParentTiles){_=this._loadedParentTiles[E.key];break}f.push(E.key);const j=E.scaledTo(E.overscaledZ-1);if(_=this._getLoadedTile(j),_)break;E=j}for(const j of f)this._loadedParentTiles[j]=_}}_addTile(l){let f=this._tiles[l.key];if(f)return f.isExtraShadowCaster!==!0||this._shadowCasterTiles[l.key]||this._reloadTile(l.key,"reloading"),f;f=this._cache.getAndRemove(l),f&&(this._setTileReloadTimer(l.key,f),f.tileID=l,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,f)));const _=!!f;if(!_){const E=this.map?this.map.painter:null,j=this._source.tileSize*l.overscaleFactor();f=this._source.type==="raster-array"?new Qd(l,j,this.transform.tileZoom,E,this._isRaster):new Cu(l,j,this.transform.tileZoom,E,this._isRaster,this._source.worldview),this._loadTile(f,this._tileLoaded.bind(this,f,l.key,f.state))}return f.uses++,this._tiles[l.key]=f,_||this._source.fire(new i.z("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(l,f){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const _=f.getExpiryTimeout();_&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},_))}_removeTile(l){const f=this._tiles[l];f&&(f.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),f.uses>0||(f.hasData()&&f.state!=="reloading"||f.state==="empty"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(+l);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(l,f,_){const E=[],j=this.transform;if(!j)return E;const k=j.projection.name==="globe",L=i.aF(j.center.lng);for(const B in this._tiles){const G=this._tiles[B];if(_&&G.clearQueryDebugViz(),G.holdingForFade())continue;let Z;if(k){const Q=G.tileID.canonical;if(Q.z===0){const X=[Math.abs(i.aA(L,...lf(Q,-1))-L),Math.abs(i.aA(L,...lf(Q,1))-L)];Z=[0,2*X.indexOf(Math.min(...X))-1]}else{const X=[Math.abs(i.aA(L,...lf(Q,-1))-L),Math.abs(i.aA(L,...lf(Q,0))-L),Math.abs(i.aA(L,...lf(Q,1))-L)];Z=[X.indexOf(Math.min(...X))-1]}}else Z=[0];for(const Q of Z){const X=l.containsTile(G,j,f,Q);X&&E.push(X)}}return E}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(l){return this._getRenderableCoordinates(l)}_getRenderableCoordinates(l,f){const _=this.getRenderableIds(l,f).map(j=>this._tiles[j].tileID),E=this.transform.projection.name==="globe";for(const j of _)j.projMatrix=this.transform.calculateProjMatrix(j.toUnwrapped()),j.expandedProjMatrix=E?this.transform.calculateProjMatrix(j.toUnwrapped(),!1,!0):j.projMatrix;return _}sortCoordinatesByDistance(l){const f=l.slice(),_=this.transform._camera.position,E=this.transform._camera.forward(),j={};for(const k of f){const L=1/(1<<k.canonical.z);j[k.key]=((k.canonical.x+.5)*L+k.wrap-_[0])*E[0]+((k.canonical.y+.5)*L-_[1])*E[1]-_[2]*E[2]}return f.sort((k,L)=>j[k.key]-j[L.key]),f}hasTransition(){if(this._source.hasTransition())return!0;if(of(this._source.type))for(const l in this._tiles){const f=this._tiles[l];if(f.fadeEndTime!==void 0&&f.fadeEndTime>=i.o.now())return!0}return!1}setFeatureState(l,f,_){this._state.updateState(l=l||"_geojsonTileLayer",f,_)}removeFeatureState(l,f,_){this._state.removeFeatureState(l=l||"_geojsonTileLayer",f,_)}getFeatureState(l,f){return this._state.getState(l=l||"_geojsonTileLayer",f)}setDependencies(l,f,_){const E=this._tiles[l];E&&E.setDependencies(f,_)}reloadTilesForDependencies(l,f){for(const _ in this._tiles)this._tiles[_].hasDependency(l,f)&&this._reloadTile(+_,"reloading");this._cache.filter(_=>!_.hasDependency(l,f))}_preloadTiles(l,f){if(!this._sourceLoaded){const B=()=>{this._sourceLoaded&&(this._source.off("data",B),this._preloadTiles(l,f))};return void this._source.on("data",B)}const _=new Map,E=Array.isArray(l)?l:[l],j=this.map.painter.terrain,k=this.usedForTerrain&&j?j.getScaledDemTileSize():this._source.tileSize;for(const B of E){const G=B.coveringTiles({tileSize:k,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const Z of G)_.set(Z.key,Z);this.usedForTerrain&&B.updateElevation(!1)}const L=Array.from(_.values());i.bv(L,(B,G)=>{const Z=new Cu(B,this._source.tileSize*B.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(Z,Q=>{this._source.type==="raster-dem"&&Z.dem&&this._backfillDEM(Z),G(Q,Z)})},f)}}function Pw(v,l){const f=Math.abs(2*v.wrap)-+(v.wrap<0),_=Math.abs(2*l.wrap)-+(l.wrap<0);return v.overscaledZ-l.overscaledZ||_-f||l.canonical.y-v.canonical.y||l.canonical.x-v.canonical.x}function of(v){return v==="raster"||v==="image"||v==="video"||v==="custom"}function lf(v,l){const f=1<<v.z;return[v.x/f+l,(v.x+1)/f+l]}Sc.maxOverzooming=10,Sc.maxUnderzooming=3;class Ow{constructor(l){this.style=l,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const l=!1,f=!1;for(const _ in this.style._mergedLayers){const E=this.style._mergedLayers[_];if(E.type==="fill-extrusion"||E.type==="building")this.layers.push({layer:E,visible:l,visibilityChanged:f});else if(E.type==="model"){const j=this.style.getLayerSource(E);j&&j.type==="batched-model"&&this.layers.push({layer:E,visible:l,visibilityChanged:f})}}}onNewFrame(l){this.layersGotHidden=!1;for(const f of this.layers){const _=f.layer;let E=!1;_.type==="fill-extrusion"?E=!_.isHidden(l)&&_.paint.get("fill-extrusion-opacity")>0:_.type==="building"?E=!_.isHidden(l)&&_.paint.get("building-opacity")>0:_.type==="model"&&(E=!_.isHidden(l)&&_.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!E&&f.visible,f.visible=E}}updateZOffset(l,f){this.currentBuildingBuckets=[];for(const E of this.layers){const j=E.layer,k=this.style.getLayerSourceCache(j);let L=1;j.type==="fill-extrusion"?L=E.visible?j.paint.get("fill-extrusion-vertical-scale"):0:j.type==="building"&&(L=E.visible?j.paint.get("building-vertical-scale"):0);let B=k?k.getTile(f):null;if(!B&&k)for(const G in k._tiles){const Z=k._tiles[G];if(f.canonical.isChildOf(Z.tileID.canonical)){B=Z;break}}this.currentBuildingBuckets.push({bucket:B?B.getBucket(j):null,tileID:B?B.tileID:f,verticalScale:L})}l.hasAnyZOffset=!1;let _=!1;for(let E=0;E<l.symbolInstances.length;E++){const j=l.symbolInstances.get(E),k=j.zOffset,L=this._getHeightAtTileOffset(f,j.tileAnchorX,j.tileAnchorY);j.zOffset=L!==Number.NEGATIVE_INFINITY?L:k,_||k===j.zOffset||(_=!0),l.hasAnyZOffset||j.zOffset===0||(l.hasAnyZOffset=!0)}_&&(l.zOffsetBuffersNeedUpload=!0,l.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(l,f,_,E){let j=f,k=_;if(l.canonical.z!==E.canonical.z){const L=E.canonical,B=1/(1<<l.canonical.z-L.z);j=(f+l.canonical.x*i.al)*B-L.x*i.al|0,k=(_+l.canonical.y*i.al)*B-L.y*i.al|0}return{tileX:j,tileY:k}}_getHeightAtTileOffset(l,f,_){let E,j;for(let k=0;k<this.layers.length;++k){const L=this.layers[k].layer;if(L.type!=="fill-extrusion"&&L.type!=="building")continue;const{bucket:B,tileID:G,verticalScale:Z}=this.currentBuildingBuckets[k];if(!B)continue;const{tileX:Q,tileY:X}=this._mapCoordToOverlappingTile(l,f,_,G),se=B.getHeightAtTileCoord(Q,X);se&&se.height!==void 0&&(se.hidden?E=se.height:j=Math.max(se.height*Z,j||0))}if(j!==void 0)return j;for(let k=0;k<this.layers.length;++k){const L=this.layers[k];if(L.layer.type!=="model"||!L.visible)continue;const{bucket:B,tileID:G}=this.currentBuildingBuckets[k];if(!B)continue;const{tileX:Z,tileY:Q}=this._mapCoordToOverlappingTile(l,f,_,G),X=B.getHeightAtTileCoord(Z,Q);if(X&&!X.hidden)return X.height===void 0&&E!==void 0?Math.min(X.maxHeight,E)*X.verticalScale:X.height?X.height*X.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Rg(v,l){const f={};for(const _ in v)_!=="ref"&&(f[_]=v[_]);return i.bw.forEach(_=>{_ in l&&(f[_]=l[_])}),f}function _p(v){v=v.slice();const l=Object.create(null);for(let f=0;f<v.length;f++)l[v[f].id]=v[f];for(let f=0;f<v.length;f++)"ref"in v[f]&&(v[f]=Rg(v[f],l[v[f].ref]));return v}const si={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function kw(v,l,f){f.push({command:si.addSource,args:[v,l[v]]})}function Mg(v,l,f){l.push({command:si.removeSource,args:[v]}),f[v]=!0}function Dg(v,l,f,_){Mg(v,f,_),kw(v,l,f)}function Nw(v,l,f){let _;for(_ in v[f])if(v[f].hasOwnProperty(_)&&_!=="data"&&!i.bx(v[f][_],l[f][_]))return!1;for(_ in l[f])if(l[f].hasOwnProperty(_)&&_!=="data"&&!i.bx(v[f][_],l[f][_]))return!1;return!0}function Lg(v,l,f,_,E,j){let k;for(k in l=l||{},v=v||{})v.hasOwnProperty(k)&&(i.bx(v[k],l[k])||f.push({command:j,args:[_,k,l[k],E]}));for(k in l)l.hasOwnProperty(k)&&!v.hasOwnProperty(k)&&(i.bx(v[k],l[k])||f.push({command:j,args:[_,k,l[k],E]}))}function Fg(v){return v.id}function zg(v,l){return v[l.id]=l,v}function cf(v,l,f){const _=l.createTileMatrix(v,v.worldSize,f.toUnwrapped());return i.aB(new Float32Array(16),v.projMatrix,_)}function rA(v,l,f){if(l.projection.name===f.projection.name)return v.projMatrix;const _=f.clone();return _.setProjection(l.projection),cf(_,l.getProjection(),v)}function o_(v,l,f){return l.name===f.projection.name?v.projMatrix:cf(f,l,v)}class HI{constructor(l,f){this.reset(l,f)}reset(l,f){this.points=l||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=i.aA(l,0,1);let f=1,_=this._distances[f];const E=l*this.paddedLength+this.padding;for(;_<E&&f<this._distances.length;)_=this._distances[++f];const j=f-1,k=this._distances[j],L=_-k,B=L>0?(E-k)/L:0;return this.points[j].mult(1-B).add(this.points[f].mult(B))}}class Bg{constructor(l,f,_){const E=this.boxCells=[],j=this.circleCells=[];this.xCellCount=Math.ceil(l/_),this.yCellCount=Math.ceil(f/_);for(let k=0;k<this.xCellCount*this.yCellCount;k++)E.push([]),j.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,f,_,E,j){this._forEachCell(f,_,E,j,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(E),this.bboxes.push(j)}insertCircle(l,f,_,E){this._forEachCell(f-E,_-E,f+E,_+E,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(_),this.circles.push(E)}_insertBoxCell(l,f,_,E,j,k){this.boxCells[j].push(k)}_insertCircleCell(l,f,_,E,j,k){this.circleCells[j].push(k)}_query(l,f,_,E,j,k){if(_<0||l>this.width||E<0||f>this.height)return!j&&[];const L=[];if(l<=0&&f<=0&&this.width<=_&&this.height<=E){if(j)return!0;for(let B=0;B<this.boxKeys.length;B++)L.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const G=this.circles[3*B],Z=this.circles[3*B+1],Q=this.circles[3*B+2];L.push({key:this.circleKeys[B],x1:G-Q,y1:Z-Q,x2:G+Q,y2:Z+Q})}return k?L.filter(k):L}return this._forEachCell(l,f,_,E,this._queryCell,L,{hitTest:j,seenUids:{box:{},circle:{}}},k),j?L.length>0:L}_queryCircle(l,f,_,E,j){const k=l-_,L=l+_,B=f-_,G=f+_;if(L<0||k>this.width||G<0||B>this.height)return!E&&[];const Z=[];return this._forEachCell(k,B,L,G,this._queryCellCircle,Z,{hitTest:E,circle:{x:l,y:f,radius:_},seenUids:{box:{},circle:{}}},j),E?Z.length>0:Z}query(l,f,_,E,j){return this._query(l,f,_,E,!1,j)}hitTest(l,f,_,E,j){return this._query(l,f,_,E,!0,j)}hitTestCircle(l,f,_,E){return this._queryCircle(l,f,_,!0,E)}_queryCell(l,f,_,E,j,k,L,B){const G=L.seenUids,Z=this.boxCells[j];if(Z!==null){const X=this.bboxes;for(const se of Z)if(!G.box[se]){G.box[se]=!0;const le=4*se;if(l<=X[le+2]&&f<=X[le+3]&&_>=X[le+0]&&E>=X[le+1]&&(!B||B(this.boxKeys[se]))){if(L.hitTest)return k.push(!0),!0;k.push({key:this.boxKeys[se],x1:X[le],y1:X[le+1],x2:X[le+2],y2:X[le+3]})}}}const Q=this.circleCells[j];if(Q!==null){const X=this.circles;for(const se of Q)if(!G.circle[se]){G.circle[se]=!0;const le=3*se;if(this._circleAndRectCollide(X[le],X[le+1],X[le+2],l,f,_,E)&&(!B||B(this.circleKeys[se]))){if(L.hitTest)return k.push(!0),!0;{const de=X[le],xe=X[le+1],ye=X[le+2];k.push({key:this.circleKeys[se],x1:de-ye,y1:xe-ye,x2:de+ye,y2:xe+ye})}}}}}_queryCellCircle(l,f,_,E,j,k,L,B){const G=L.circle,Z=L.seenUids,Q=this.boxCells[j];if(Q!==null){const se=this.bboxes;for(const le of Q)if(!Z.box[le]){Z.box[le]=!0;const de=4*le;if(this._circleAndRectCollide(G.x,G.y,G.radius,se[de+0],se[de+1],se[de+2],se[de+3])&&(!B||B(this.boxKeys[le])))return k.push(!0),!0}}const X=this.circleCells[j];if(X!==null){const se=this.circles;for(const le of X)if(!Z.circle[le]){Z.circle[le]=!0;const de=3*le;if(this._circlesCollide(se[de],se[de+1],se[de+2],G.x,G.y,G.radius)&&(!B||B(this.circleKeys[le])))return k.push(!0),!0}}}_forEachCell(l,f,_,E,j,k,L,B){const G=this._convertToXCellCoord(l),Z=this._convertToYCellCoord(f),Q=this._convertToXCellCoord(_),X=this._convertToYCellCoord(E);for(let se=G;se<=Q;se++)for(let le=Z;le<=X;le++)if(j.call(this,l,f,_,E,this.xCellCount*le+se,k,L,B))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,f,_,E,j,k){const L=E-l,B=j-f,G=_+k;return G*G>L*L+B*B}_circleAndRectCollide(l,f,_,E,j,k,L){const B=(k-E)/2,G=Math.abs(l-(E+B));if(G>B+_)return!1;const Z=(L-j)/2,Q=Math.abs(f-(j+Z));if(Q>Z+_)return!1;if(G<=B||Q<=Z)return!0;const X=G-B,se=Q-Z;return X*X+se*se<=_*_}}const ql={unknown:0,flipRequired:1,flipNotRequired:2},$g=Math.tan(85*Math.PI/180);function xp(v,l,f,_,E,j,k){const L=i.bB();if(f)if(j.name==="globe"){const B=i.bC(E,l);i.aB(L,L,B)}else{const B=i.bD([],k);L[0]=B[0],L[1]=B[1],L[4]=B[2],L[5]=B[3],_||i.bA(L,L,E.angle)}else i.aB(L,E.labelPlaneMatrix,v);return L}function Ug(v,l,f,_,E,j,k){const L=xp(v,l,f,_,E,j,k);return j.name==="globe"&&f||(L[2]=L[6]=L[10]=L[14]=0),L}function od(v,l,f,_,E,j,k){if(f){if(j.name==="globe"){const L=xp(v,l,f,_,E,j,k);return i.bk(L,L),i.aB(L,v,L),L}{const L=i.by(v),B=i.bz([]);return B[0]=k[0],B[1]=k[1],B[4]=k[2],B[5]=k[3],i.aB(L,L,B),_||i.bA(L,L,-E.angle),L}}return E.glCoordMatrix}function da(v,l,f,_){const E=[v,l,f,1];f?i.aC(E,E,_):Ec(E,E,_);const j=E[3];return E[0]/=j,E[1]/=j,E[2]/=j,E}function Iw(v,l){return Math.min(.5+v/l*.5,1.5)}function Rw(v,l){const f=v[0]/v[3],_=v[1]/v[3];return f>=-l[0]&&f<=l[0]&&_>=-l[1]&&_<=l[1]}function Mw(v,l,f,_,E,j,k,L,B,G,Z=1){const Q=f.transform,X=_?v.textSizeData:v.iconSizeData,se=i.bJ(X,f.transform.zoom,Z),le=Q.projection.name==="globe",de=[256/f.width*2+1,256/f.height*2+1],xe=_?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;xe.clear();let ye=null;le&&(ye=_?v.text.globeExtVertexArray:v.icon.globeExtVertexArray);const Ee=v.lineVertexArray,Ne=_?v.text.placedSymbolArray:v.icon.placedSymbolArray,je=f.transform.width/f.transform.height;let Ve,Ie=!1;for(let Ge=0;Ge<Ne.length;Ge++){const $e=Ne.get(Ge),{numGlyphs:Le,writingMode:Ke}=$e;if(Ke!==i.bK.vertical||Ie||Ve===i.bK.horizontal||(Ie=!0),Ve=Ke,($e.hidden||Ke===i.bK.vertical)&&!Ie){ld(Le,xe);continue}Ie=!1;const dt=new i.P($e.tileAnchorX,$e.tileAnchorY),at=v.elevationType==="road",Et=!!Q.elevation||at;let{x:yt,y:Nt,z:Xt}=Q.projection.projectTilePoint(dt.x,dt.y,G.canonical),mt=null;if(Et){const mr=at?v.getElevationFeatureForText(Ge):null;mt={getElevation:B,elevation:Q.elevation,elevationFeature:mr};const[$r,jn,Fn]=B(dt,Q.elevation,mr);yt+=$r,Nt+=jn,Xt+=Fn}const tt=[yt,Nt,Xt,1];if(i.aC(tt,tt,l),!Rw(tt,de)){ld(Le,xe);continue}const It=tt[3],vt=Iw(f.transform.getCameraToCenterDistance(Q.projection),It),Bt=i.bL(X,se,$e),rr=k?Bt/vt:Bt*vt,xr=da(yt,Nt,Xt,E);if(xr[3]<=0){ld(Le,xe);continue}let Wt={};const Jt=i.an(v.layers[0].layout.get("text-max-angle")),wr=Math.cos(Jt),pr=k?null:mt,dr=nA($e,rr,!1,L,l,E,j,v.glyphOffsetArray,Ee,xe,ye,xr,dt,Wt,je,pr,Q.projection,G,k,wr);Ie=dr.useVertical,pr&&dr.needsFlipping&&(Wt={}),(dr.notEnoughRoom||Ie||dr.needsFlipping&&nA($e,rr,!0,L,l,E,j,v.glyphOffsetArray,Ee,xe,ye,xr,dt,Wt,je,pr,Q.projection,G,k,wr).notEnoughRoom)&&ld(Le,xe)}_?(v.text.dynamicLayoutVertexBuffer.updateData(xe),ye&&v.text.globeExtVertexBuffer&&v.text.globeExtVertexBuffer.updateData(ye)):(v.icon.dynamicLayoutVertexBuffer.updateData(xe),ye&&v.icon.globeExtVertexBuffer&&v.icon.globeExtVertexBuffer.updateData(ye))}function hi(v,l,f,_,E,j,k,L,B,G,Z,Q,X,se,le,de,xe){const{lineStartIndex:ye,glyphStartIndex:Ee,segment:Ne}=L,je=Ee+L.numGlyphs,Ve=ye+L.lineLength,Ie=l.getoffsetX(Ee),Ge=l.getoffsetX(je-1),$e=Vg(v*Ie,f,_,E,j,k,Ne,ye,Ve,B,G,Z,Q,X,!0,se,le,de,xe);if(!$e)return null;const Le=Vg(v*Ge,f,_,E,j,k,Ne,ye,Ve,B,G,Z,Q,X,!0,se,le,de,xe);return Le?{first:$e,last:Le}:null}function Dw(v,l,f,_){return v===i.bK.horizontal&&Math.abs(_)>Math.abs(f)?{useVertical:!0}:v===i.bK.vertical?_>0?{needsFlipping:!0}:null:l!==ql.unknown&&function(E,j){return E===0||Math.abs(j/E)>$g}(f,_)?l===ql.flipRequired?{needsFlipping:!0}:null:f<0?{needsFlipping:!0}:null}function nA(v,l,f,_,E,j,k,L,B,G,Z,Q,X,se,le,de,xe,ye,Ee,Ne){const je=l/24,Ve=v.lineOffsetX*je,Ie=v.lineOffsetY*je,{lineStartIndex:Ge,glyphStartIndex:$e,numGlyphs:Le,segment:Ke,writingMode:dt,flipState:at}=v,Et=Ge+v.lineLength,yt=Nt=>{if(Z){const[It,vt,Bt]=Nt.up,rr=G.length;i.bM(Z,rr+0,It,vt,Bt),i.bM(Z,rr+1,It,vt,Bt),i.bM(Z,rr+2,It,vt,Bt),i.bM(Z,rr+3,It,vt,Bt)}const[Xt,mt,tt]=Nt.point;i.bN(G,Xt,mt,tt,Nt.angle)};if(Le>1){const Nt=hi(je,L,Ve,Ie,f,Q,X,v,B,j,se,de,!1,xe,ye,Ee,Ne);if(!Nt)return{notEnoughRoom:!0};if(_&&!f){let[Xt,mt,tt]=Nt.first.point,[It,vt,Bt]=Nt.last.point;[Xt,mt]=da(Xt,mt,tt,k),[It,vt]=da(It,vt,Bt,k);const rr=Dw(dt,at,(It-Xt)*le,vt-mt);if(v.flipState=rr&&rr.needsFlipping?ql.flipRequired:ql.flipNotRequired,rr)return rr}yt(Nt.first);for(let Xt=$e+1;Xt<$e+Le-1;Xt++){const mt=Vg(je*L.getoffsetX(Xt),Ve,Ie,f,Q,X,Ke,Ge,Et,B,j,se,de,!1,!1,xe,ye,Ee,Ne);if(!mt)return G.length-=4*(Xt-$e),{notEnoughRoom:!0};yt(mt)}yt(Nt.last)}else{if(_&&!f){const Xt=da(X.x,X.y,0,E),mt=Ge+Ke+1,tt=new i.P(B.getx(mt),B.gety(mt)),It=da(tt.x,tt.y,0,E),vt=It[3]>0?It:Kr(X,tt,Xt,1,E,void 0,xe,ye.canonical),Bt=Dw(dt,at,(vt[0]-Xt[0])*le,vt[1]-Xt[1]);if(v.flipState=Bt&&Bt.needsFlipping?ql.flipRequired:ql.flipNotRequired,Bt)return Bt}const Nt=Vg(je*L.getoffsetX($e),Ve,Ie,f,Q,X,Ke,Ge,Et,B,j,se,de,!1,!1,xe,ye,Ee,Ne);if(!Nt)return{notEnoughRoom:!0};yt(Nt)}return{}}function iA(v,l,f,_,E){const{x:j,y:k,z:L}=_.projectTilePoint(v.x,v.y,l);if(!E)return da(j,k,L,f);const[B,G,Z]=E.getElevation(v,E.elevation,E.elevationFeature);return da(j+B,k+G,L+Z,f)}function Kr(v,l,f,_,E,j,k,L){const B=iA(v.sub(l)._unit()._add(v),L,E,k,j);return i.av(B,f,B),i.aw(B,B),i.bG(B,f,B,_)}function Vg(v,l,f,_,E,j,k,L,B,G,Z,Q,X,se,le,de,xe,ye,Ee){const Ne=_?v-l:v+l;let je=Ne>0?1:-1,Ve=0;_&&(je*=-1,Ve=Math.PI),je<0&&(Ve+=Math.PI);let Ie=L+k+(je>0?0:1)|0,Ge=E,$e=E,Le=0,Ke=0;const dt=Math.abs(Ne),at=[],Et=[];let yt=j,Nt=yt,Xt=i.bE([]);const mt=()=>Kr(Nt,yt,$e,dt-Le+1,Z,X,de,xe.canonical);for(;Le+Ke<=dt;){if(Ie+=je,Ie<L||Ie>=B)return null;if($e=Ge,Nt=yt,at.push($e),se&&Et.push(Nt),yt=new i.P(G.getx(Ie),G.gety(Ie)),Ge=Q[Ie],!Ge){const pr=iA(yt,xe.canonical,Z,de,X);Ge=pr[3]>0?Q[Ie]=pr:mt()}Le+=Ke;const Jt=i.av([],Ge,$e),wr=i.bF($e,Ge);if(f&&wr>0&&Ke>0&&i.bI(Xt,Jt)/(Ke*wr)<Ee)return null;Ke=wr,Xt=Jt}le&&X&&(Q[Ie]&&(Ge=mt(),Ke=i.bF($e,Ge),Xt=i.av([],Ge,$e)),Q[Ie]=Ge);const tt=(dt-Le)/Ke,It=yt.sub(Nt)._mult(tt)._add(Nt),vt=i.bG([],$e,Xt,tt);let Bt=[0,0,1],rr=Xt[0],xr=Xt[1];if(ye&&(Bt=de.upVector(xe.canonical,It.x,It.y),Bt[0]!==0||Bt[1]!==0||Bt[2]!==1)){const Jt=[Bt[2],0,-Bt[0]],wr=i.bH([],Bt,Jt);i.aw(Jt,Jt),i.aw(wr,wr),rr=i.bI(Xt,Jt),xr=i.bI(Xt,wr)}if(f){const Jt=i.bH([],Bt,Xt);i.aw(Jt,Jt),i.bG(vt,vt,Jt,f*je)}const Wt=Ve+Math.atan2(xr,rr);return at.push(vt),se&&Et.push(It),{point:vt,angle:Wt,path:at,tilePath:Et,up:Bt}}function ld(v,l){const f=l.length,_=f+4*v;l.resize(_),l.float32.fill(-1/0,4*f,4*_)}function Ec(v,l,f){const _=l[0],E=l[1];return v[0]=f[0]*_+f[4]*E+f[12],v[1]=f[1]*_+f[5]*E+f[13],v[3]=f[3]*_+f[7]*E+f[15],v}const Tc=100;class bp{constructor(l,f,_=new Bg(l.width+200,l.height+200,25),E=new Bg(l.width+200,l.height+200,25)){this.transform=l,this.grid=_,this.ignoredGrid=E,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Tc,this.screenBottomBoundary=l.height+Tc,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=f}placeCollisionBox(l,f,_,E,j,k,L,B,G,Z,Q){let X=_.projectedAnchorX,se=_.projectedAnchorY,le=_.projectedAnchorZ;const de=_.tileAnchorX,xe=_.tileAnchorY,ye=_.elevation,Ee=_.tileID,Ne=l.getProjection();if(ye&&Ee){const[Et,yt,Nt]=Ne.upVector(Ee.canonical,_.tileAnchorX,_.tileAnchorY),Xt=Ne.upVectorScale(Ee.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;X+=Et*ye*Xt,se+=yt*ye*Xt,le+=Nt*ye*Xt}const je=l.projection.name==="globe",Ve=l.projection.name==="globe"?i.aj(this.transform.zoom):0;if(Ee&&je&&Ve<1&&!k){const Et=1<<Ee.canonical.z,yt=i.bO(de,xe);i.bP(yt,yt,1/i.al),i.bQ(yt,yt,i.bO(Ee.canonical.x,Ee.canonical.y)),i.bP(yt,yt,1/Et),i.bR(yt,yt,i.bO(E[0],E[1])),yt[0]=i.bS(yt[0],-.5,.5),i.bP(yt,yt,i.al);const Nt=i.bT(yt[0],yt[1],i.al/(2*Math.PI),1);i.aC(Nt,Nt,j),X=i.ak(X,Nt[0],Ve),se=i.ak(se,Nt[1],Ve),le=i.ak(le,Nt[2],Ve)}const Ie=this.projectAndGetPerspectiveRatio(Z,X,se,le,_.tileID,Ne.name==="globe"||!!ye||this.transform.pitch>0,Ne),Ge=G*Ie.perspectiveRatio,$e=(_.x1*f+L.x-_.padding)*Ge+Ie.point.x,Le=(_.y1*f+L.y-_.padding)*Ge+Ie.point.y,Ke=(_.x2*f+L.x+_.padding)*Ge+Ie.point.x,dt=(_.y2*f+L.y+_.padding)*Ge+Ie.point.y,at=Ie.perspectiveRatio<=.55||Ie.occluded;return!this.isInsideGrid($e,Le,Ke,dt)||!B&&this.grid.hitTest($e,Le,Ke,dt,Q)||at?{box:[],offscreen:!1,occluded:Ie.occluded}:{box:[$e,Le,Ke,dt],offscreen:this.isOffscreen($e,Le,Ke,dt),occluded:!1}}placeCollisionCircles(l,f,_,E,j,k,L,B,G,Z,Q,X,se,le,de,xe){const ye=[],Ee=this.transform.elevation,Ne=l.getProjection(),je=l.elevationType==="road",Ve=!!Ee||je,Ie=i.bU.getAtTileOffsetFunc(xe,this.transform.center.lat,this.transform.worldSize,Ne),Ge=new i.P(_.tileAnchorX,_.tileAnchorY),$e=new i.P(_.tileAnchorX,_.tileAnchorY);let{x:Le,y:Ke,z:dt}=Ne.projectTilePoint($e.x,$e.y,xe.canonical),at=null;if(Ve){const wr=je?l.getElevationFeatureForText(E):null;at={getElevation:Ie,elevation:Ee,elevationFeature:wr};const[pr,dr,mr]=Ie(Ge,Ee,wr);Le+=pr,Ke+=dr,dt+=mr}const Et=Ne.name==="globe",yt=this.projectAndGetPerspectiveRatio(B,Le,Ke,dt,xe,Et||!!Ee||this.transform.pitch>0,Ne),{perspectiveRatio:Nt}=yt,Xt=(X?L/Nt:L*Nt)/i.bX,mt=da(Le,Ke,dt,G),tt=_.lineOffsetX*Xt,It=_.lineOffsetY*Xt,vt=i.an(l.layers[0].layout.get("text-max-angle")),Bt=Math.cos(vt),rr=yt.signedDistanceFromCamera>0?hi(Xt,k,tt,It,je&&_.flipState===1,mt,$e,_,j,G,{},Ve&&!X?at:null,X&&Ve,Ne,xe,X,Bt):null;let xr=!1,Wt=!1,Jt=!0;if(rr&&!yt.occluded){const wr=.5*le*Nt+de,pr=new i.P(-100,-100),dr=new i.P(this.screenRightBoundary,this.screenBottomBoundary),mr=new HI,{first:$r,last:jn}=rr,Fn=$r.path.length;let Ei=[];for(let hn=Fn-1;hn>=1;hn--)Ei.push($r.path[hn]);for(let hn=1;hn<jn.path.length;hn++)Ei.push(jn.path[hn]);const Yr=2.5*wr;Z&&(Ei=Ei.map(([hn,yi,zn],Li)=>(Ve&&!Et&&(zn=Ie(Li<Fn-1?$r.tilePath[Fn-1-Li]:jn.tilePath[Li-Fn+2],Ee,at.elevationFeature)[2]),da(hn,yi,zn,Z))),Ei.some(hn=>hn[3]<=0)&&(Ei=[]));let Dn=[];if(Ei.length>0){let hn=1/0,yi=-1/0,zn=1/0,Li=-1/0;for(const Yn of Ei)hn=Math.min(hn,Yn[0]),zn=Math.min(zn,Yn[1]),yi=Math.max(yi,Yn[0]),Li=Math.max(Li,Yn[1]);yi>=pr.x&&hn<=dr.x&&Li>=pr.y&&zn<=dr.y&&(Dn=[Ei.map(Yn=>new i.P(Yn[0],Yn[1]))],(hn<pr.x||yi>dr.x||zn<pr.y||Li>dr.y)&&(Dn=i.bV(Dn,pr.x,pr.y,dr.x,dr.y)))}for(const hn of Dn){mr.reset(hn,.25*wr);let yi=0;yi=mr.length<=.5*wr?1:Math.ceil(mr.paddedLength/Yr)+1;for(let zn=0;zn<yi;zn++){const Li=zn/Math.max(yi-1,1),Yn=mr.lerp(Li),pn=Yn.x+Tc,ai=Yn.y+Tc;ye.push(pn,ai,wr,0);const xn=pn-wr,Wi=ai-wr,di=pn+wr,Qr=ai+wr;if(Jt=Jt&&this.isOffscreen(xn,Wi,di,Qr),Wt=Wt||this.isInsideGrid(xn,Wi,di,Qr),!f&&this.grid.hitTestCircle(pn,ai,wr,se)&&(xr=!0,!Q))return{circles:[],offscreen:!1,collisionDetected:xr,occluded:!1}}}}return{circles:!Q&&xr||!Wt?[]:ye,offscreen:Jt,collisionDetected:xr,occluded:yt.occluded}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let _=1/0,E=1/0,j=-1/0,k=-1/0;for(const Z of l){const Q=new i.P(Z.x+Tc,Z.y+Tc);_=Math.min(_,Q.x),E=Math.min(E,Q.y),j=Math.max(j,Q.x),k=Math.max(k,Q.y),f.push(Q)}const L=this.grid.query(_,E,j,k).concat(this.ignoredGrid.query(_,E,j,k)),B={},G={};for(const Z of L){const Q=Z.key;if(B[Q.bucketInstanceId]===void 0&&(B[Q.bucketInstanceId]={}),B[Q.bucketInstanceId][Q.featureIndex])continue;const X=[new i.P(Z.x1,Z.y1),new i.P(Z.x2,Z.y1),new i.P(Z.x2,Z.y2),new i.P(Z.x1,Z.y2)];i.bW(f,X)&&(B[Q.bucketInstanceId][Q.featureIndex]=!0,G[Q.bucketInstanceId]===void 0&&(G[Q.bucketInstanceId]=[]),G[Q.bucketInstanceId].push(Q.featureIndex))}return G}insertCollisionBox(l,f,_,E,j){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:E,collisionGroupID:j},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,f,_,E,j){const k=f?this.ignoredGrid:this.grid,L={bucketInstanceId:_,featureIndex:E,collisionGroupID:j};for(let B=0;B<l.length;B+=4)k.insertCircle(L,l[B],l[B+1],l[B+2])}projectAndGetPerspectiveRatio(l,f,_,E,j,k,L){const B=[f,_,E,1];let G=!1;E||this.transform.pitch>0?(i.aC(B,B,l),this.fogState&&j&&L.name!=="globe"&&(G=function(X,se,le,de,xe,ye){const Ee=ye.calculateFogTileMatrix(xe),Ne=[se,le,de];return i.af(Ne,Ne,Ee),Zt(X,i.ag(Ne),ye.pitch,ye._fov)}(this.fogState,f,_,E,j.toUnwrapped(),this.transform)>.9)):Ec(B,B,l);const Z=B[3];return{point:new i.P((B[0]/Z+1)/2*this.transform.width+Tc,(-B[1]/Z+1)/2*this.transform.height+Tc),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(L)/Z*.5,1.5),signedDistanceFromCamera:Z,occluded:k&&B[2]>Z||G}}isOffscreen(l,f,_,E){return _<Tc||l>=this.screenRightBoundary||E<Tc||f>this.screenBottomBoundary}isInsideGrid(l,f,_,E){return _>=0&&l<this.gridRightBoundary&&E>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const l=i.bz([]);return i.bq(l,l,[-100,-100,0]),l}}class Or{constructor(l,f,_,E){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):E&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class Xn{constructor(l,f,_,E,j,k=!1){this.text=new Or(l?l.text:null,f,_,j),this.icon=new Or(l?l.icon:null,f,E,j),this.clipped=k}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ui{constructor(l,f,_,E=!1){this.text=l,this.icon=f,this.skipFade=_,this.clipped=E}}class Ol{constructor(){this.invProjMatrix=i.bB(),this.viewportMatrix=i.bB(),this.circles=[]}}class wp{constructor(l,f,_,E,j){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=_,this.bucketIndex=E,this.tileID=j}}class gi{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:_=>_.collisionGroupID===f}}return this.collisionGroups[l]}}function qg(v,l,f,_,E){const{horizontalAlign:j,verticalAlign:k}=i.c0(v),L=-(j-.5)*l,B=-(k-.5)*f,G=i.c1(v,_);return new i.P(L+G[0]*E,B+G[1]*E)}function uf(v,l,f,_,E){const j=new i.P(v,l);return f&&j._rotate(_?E:-E),j}class Hg{constructor(l,f,_,E,j,k){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new bp(this.transform,j),this.buildingIndex=k,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new gi(_),this.collisionCircleArrays={},this.prevPlacement=E,E&&(E.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,f,_,E,j=1){const k=_.getBucket(f),L=_.latestFeatureIndex;if(!k||!L||f.fqid!==k.layerIds[0])return;const B=k.layers[0].layout,G=k.layers[0].paint,Z=_.collisionBoxArray,Q=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),X=_.tileSize/i.al,se=_.tileID.toUnwrapped();this.transform.setProjection(k.projection);const le=(de=_.tileID,xe=k.getProjection(),ye=this.transform,xe.name===this.projection?ye.calculateProjMatrix(de.toUnwrapped()):cf(ye,xe,de));var de,xe,ye;const Ee=B.get("text-pitch-alignment")==="map",Ne=B.get("text-rotation-alignment")==="map";f.compileFilter(f.options);const je=f.dynamicFilter(),Ve=f.dynamicFilterNeedsFeature(),Ie=this.transform.calculatePixelsToTileUnitsMatrix(_),Ge=Ug(le,_.tileID.canonical,Ee,Ne,this.transform,k.getProjection(),Ie);let $e=null;const Le=k.getProjection().createInversionMatrix(this.transform,_.tileID.canonical);if(Ee){const tt=od(le,_.tileID.canonical,Ee,Ne,this.transform,k.getProjection(),Ie);$e=i.aB([],this.transform.labelPlaneMatrix,tt)}let Ke=null;je&&_.latestFeatureIndex&&(Ke={unwrappedTileID:se,dynamicFilter:je,dynamicFilterNeedsFeature:Ve}),this.retainedQueryData[k.bucketInstanceId]=new wp(k.bucketInstanceId,L,k.sourceLayerIndex,k.index,_.tileID);const[dt,at]=k.layers[0].layout.get("text-size-scale-range"),Et=i.aA(j,dt,at),[yt,Nt]=B.get("icon-size-scale-range"),Xt=i.aA(j,yt,Nt),mt={bucket:k,layout:B,paint:G,posMatrix:le,invMatrix:Le,mercatorCenter:[i.aF(this.transform.center.lng),i.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Ge,labelToScreenMatrix:$e,clippingData:Ke,scale:Q,textPixelRatio:X,holdingForFade:_.holdingForFade(),collisionBoxArray:Z,partiallyEvaluatedTextSize:i.bJ(k.textSizeData,this.transform.zoom,Et),partiallyEvaluatedIconSize:i.bJ(k.iconSizeData,this.transform.zoom,Xt),collisionGroup:this.collisionGroups.get(k.sourceID),latestFeatureIndex:_.latestFeatureIndex};if(E)for(const tt of k.sortKeyRanges){const{sortKey:It,symbolInstanceStart:vt,symbolInstanceEnd:Bt}=tt;l.push({sortKey:It,symbolInstanceStart:vt,symbolInstanceEnd:Bt,parameters:mt})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:k.symbolInstances.length,parameters:mt})}attemptAnchorPlacement(l,f,_,E,j,k,L,B,G,Z,Q,X,se,le,de,xe,ye,Ee,Ne,je,Ve){const{textOffset0:Ie,textOffset1:Ge,crossTileID:$e}=de,Le=[Ie,Ge],Ke=qg(l,k,L,Le,B),dt=this.collisionIndex.placeCollisionBox(ye,B,f,_,E,j,uf(Ke.x,Ke.y,G,Z,this.transform.angle),le,Q,X,se.predicate);if(Ne){const at=ye.getSymbolInstanceIconSize(Ve,this.transform.zoom,de.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ye,at,Ne,_,E,j,uf(Ke.x,Ke.y,G,Z,this.transform.angle),le,Q,X,se.predicate).box.length===0)return}if(dt.box.length>0){let at;return this.prevPlacement&&this.prevPlacement.variableOffsets[$e]&&this.prevPlacement.placements[$e]&&this.prevPlacement.placements[$e].text&&(at=this.prevPlacement.variableOffsets[$e].anchor),this.variableOffsets[$e]={textOffset:Le,width:k,height:L,anchor:l,textScale:B,prevAnchor:at},this.markUsedJustification(ye,l,de,Ee),ye.allowVerticalPlacement&&(this.markUsedOrientation(ye,Ee,de),this.placedOrientations[$e]=Ee),{shift:Ke,placedGlyphBoxes:dt}}}placeLayerBucketPart(l,f,_,E,j=1){const{bucket:k,layout:L,paint:B,posMatrix:G,textLabelPlaneMatrix:Z,labelToScreenMatrix:Q,clippingData:X,textPixelRatio:se,mercatorCenter:le,invMatrix:de,holdingForFade:xe,collisionBoxArray:ye,partiallyEvaluatedTextSize:Ee,partiallyEvaluatedIconSize:Ne,collisionGroup:je,latestFeatureIndex:Ve}=l.parameters,Ie=L.get("text-optional"),Ge=L.get("icon-optional"),$e=L.get("text-allow-overlap"),Le=L.get("icon-allow-overlap"),Ke=L.get("text-rotation-alignment")==="map",dt=L.get("icon-rotation-alignment")==="map",at=L.get("text-pitch-alignment")==="map",Et=B.get("symbol-z-offset"),yt=L.get("symbol-elevation-reference")==="sea",Nt=L.get("symbol-placement"),[Xt,mt]=L.get("text-size-scale-range"),[tt,It]=L.get("icon-size-scale-range"),vt=i.aA(j,Xt,mt),Bt=i.aA(j,tt,It),rr=L.get("text-variable-anchor"),xr=Ke&&Nt!=="point",Wt=dt&&Nt!=="point",Jt=rr&&k.hasTextData(),wr=k.hasIconTextFit()&&Jt&&k.hasIconData();this.transform.setProjection(k.projection);const pr=Jt||xr,dr=Wt||wr;let mr=$e&&(Le||!k.hasIconData()||Ge),$r=Le&&($e||!k.hasTextData()||Ie);const jn=!Et.isConstant();!k.collisionArrays&&ye&&k.deserializeCollisionBoxes(ye),_&&E&&k.updateCollisionDebugBuffers(this.transform.zoom,ye,vt,Bt);const Fn=(Yr,Dn,hn)=>{const{crossTileID:yi,numVerticalGlyphVertices:zn}=Yr;let Li=null;if(X&&X.dynamicFilterNeedsFeature||jn){const ys=this.retainedQueryData[k.bucketInstanceId];Li=Ve.loadFeature({featureIndex:Yr.featureIndex,bucketIndex:ys.bucketIndex,sourceLayerIndex:ys.sourceLayerIndex,layoutVertexArrayOffset:0})}if(X&&!(0,X.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:k.worldview},Li,this.retainedQueryData[k.bucketInstanceId].tileID.canonical,new i.P(Yr.tileAnchorX,Yr.tileAnchorY),this.transform.calculateDistanceTileData(X.unwrappedTileID)))return this.placements[yi]=new ui(!1,!1,!1,!0),void f.add(yi);const Yn=Et.evaluate(Li,{});if(f.has(yi))return;if(xe)return void(this.placements[yi]=new ui(!1,!1,!1));let pn=!1,ai=!1,xn=!0,Wi=!1,di=!1,Qr=null,Vn={box:null,offscreen:null,occluded:null},ls={box:null},Ns=null,hs=null,Ss=null,_l=0,al=0,ao=0;hn.textFeatureIndex?_l=hn.textFeatureIndex:Yr.useRuntimeCollisionCircles&&(_l=Yr.featureIndex),hn.verticalTextFeatureIndex&&(al=hn.verticalTextFeatureIndex);const wo=k.elevationFeatures?k.elevationFeatures[Yr.elevationFeatureIndex]:void 0,Zl=ys=>{ys.tileID=this.retainedQueryData[k.bucketInstanceId].tileID;const Is=this.transform.elevation;ys.elevation=yt?Yn:Yn+i.bU.getAtTileOffset(ys.tileID,new i.P(ys.tileAnchorX,ys.tileAnchorY),Is,wo),ys.elevation+=Yr.zOffset},oo=hn.textBox;if(oo){Zl(oo);const ys=Ni=>{let Ds=i.bK.horizontal;if(k.allowVerticalPlacement&&!Ni&&this.prevPlacement){const Ma=this.prevPlacement.placedOrientations[yi];Ma&&(this.placedOrientations[yi]=Ma,Ds=Ma,this.markUsedOrientation(k,Ds,Yr))}return Ds},Is=(Ni,Ds)=>{if(k.allowVerticalPlacement&&zn>0&&hn.verticalTextBox){for(const Ma of k.writingModes)if(Ma===i.bK.vertical?(Vn=Ds(),ls=Vn):Vn=Ni(),Vn&&Vn.box&&Vn.box.length)break}else Vn=Ni()};if(rr){let Ni=rr;if(this.prevPlacement&&this.prevPlacement.variableOffsets[yi]){const vs=this.prevPlacement.variableOffsets[yi];Ni.indexOf(vs.anchor)>0&&(Ni=Ni.filter(Yl=>Yl!==vs.anchor),Ni.unshift(vs.anchor))}const Ds=(vs,Yl,Qp)=>{const vd=k.getSymbolInstanceTextSize(Ee,Yr,this.transform.zoom,Dn),em=(vs.x2-vs.x1)*vd+2*vs.padding,tm=(vs.y2-vs.y1)*vd+2*vs.padding,Jl=Yr.hasIconTextFit&&!Le?Yl:null;Jl&&Zl(Jl);let Iu={box:[],offscreen:!1,occluded:!1};const Sa=$e?2*Ni.length:Ni.length;for(let Ql=0;Ql<Sa;++Ql){const Ef=this.attemptAnchorPlacement(Ni[Ql%Ni.length],vs,le,de,pr,em,tm,vd,Ke,at,se,G,je,Ql>=Ni.length,Yr,Dn,k,Qp,Jl,Ee,Ne);if(Ef&&(Iu=Ef.placedGlyphBoxes,Iu&&Iu.box&&Iu.box.length)){pn=!0,Qr=Ef.shift;break}}return Iu};Is(()=>Ds(oo,hn.iconBox,i.bK.horizontal),()=>{const vs=hn.verticalTextBox;return vs&&Zl(vs),k.allowVerticalPlacement&&!(Vn&&Vn.box&&Vn.box.length)&&zn>0&&vs?Ds(vs,hn.verticalIconBox,i.bK.vertical):{box:null,offscreen:null,occluded:null}}),Vn&&(pn=Vn.box,xn=Vn.offscreen,Wi=Vn.occluded);const Ma=ys(!(!Vn||!Vn.box));if(!pn&&this.prevPlacement){const vs=this.prevPlacement.variableOffsets[yi];vs&&(this.variableOffsets[yi]=vs,this.markUsedJustification(k,vs.anchor,Yr,Ma))}}else{const Ni=(Ds,Ma)=>{const vs=k.getSymbolInstanceTextSize(Ee,Yr,this.transform.zoom,Dn),Yl=this.collisionIndex.placeCollisionBox(k,vs,Ds,le,de,pr,new i.P(0,0),$e,se,G,je.predicate);return Yl&&Yl.box&&Yl.box.length&&(this.markUsedOrientation(k,Ma,Yr),this.placedOrientations[yi]=Ma),Yl};Is(()=>Ni(oo,i.bK.horizontal),()=>{const Ds=hn.verticalTextBox;return k.allowVerticalPlacement&&zn>0&&Ds?(Zl(Ds),Ni(Ds,i.bK.vertical)):{box:null,offscreen:null,occluded:null}}),ys(!!(Vn&&Vn.box&&Vn.box.length))}}if(Ns=Vn,pn=Ns&&Ns.box&&Ns.box.length>0,xn=Ns&&Ns.offscreen,Wi=Ns&&Ns.occluded,Yr.useRuntimeCollisionCircles){const ys=Yr.centerJustifiedTextSymbolIndex>=0?Yr.centerJustifiedTextSymbolIndex:Yr.verticalPlacedTextSymbolIndex,Is=k.text.placedSymbolArray.get(ys),Ni=i.bL(k.textSizeData,Ee,Is),Ds=L.get("text-padding");hs=this.collisionIndex.placeCollisionCircles(k,$e,Is,ys,k.lineVertexArray,k.glyphOffsetArray,Ni,G,Z,Q,_,at,je.predicate,Yr.collisionCircleDiameter*Ni/i.bX,Ds,this.retainedQueryData[k.bucketInstanceId].tileID),pn=$e||hs.circles.length>0&&!hs.collisionDetected,xn=xn&&hs.offscreen,Wi=hs.occluded}if(hn.iconFeatureIndex&&(ao=hn.iconFeatureIndex),hn.iconBox){const ys=Is=>{Zl(Is);const Ni=Yr.hasIconTextFit&&Qr?uf(Qr.x,Qr.y,Ke,at,this.transform.angle):new i.P(0,0),Ds=k.getSymbolInstanceIconSize(Ne,this.transform.zoom,Yr.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(k,Ds,Is,le,de,dr,Ni,Le,se,G,je.predicate)};ls&&ls.box&&ls.box.length&&hn.verticalIconBox?(Ss=ys(hn.verticalIconBox),ai=Ss.box.length>0):(Ss=ys(hn.iconBox),ai=Ss.box.length>0),xn=xn&&Ss.offscreen,di=Ss.occluded}const Xl=Ie||Yr.numHorizontalGlyphVertices===0&&zn===0,Nc=Ge||Yr.numIconVertices===0;if(Xl||Nc?Nc?Xl||(ai=ai&&pn):pn=ai&&pn:ai=pn=ai&&pn,pn&&Ns&&Ns.box&&this.collisionIndex.insertCollisionBox(Ns.box,L.get("text-ignore-placement"),k.bucketInstanceId,ls&&ls.box&&al?al:_l,je.ID),ai&&Ss&&this.collisionIndex.insertCollisionBox(Ss.box,L.get("icon-ignore-placement"),k.bucketInstanceId,ao,je.ID),hs&&(pn&&this.collisionIndex.insertCollisionCircles(hs.circles,L.get("text-ignore-placement"),k.bucketInstanceId,_l,je.ID),_)){const ys=k.bucketInstanceId;let Is=this.collisionCircleArrays[ys];Is===void 0&&(Is=this.collisionCircleArrays[ys]=new Ol);for(let Ni=0;Ni<hs.circles.length;Ni+=4)Is.circles.push(hs.circles[Ni+0]),Is.circles.push(hs.circles[Ni+1]),Is.circles.push(hs.circles[Ni+2]),Is.circles.push(hs.collisionDetected?1:0)}const Ra=k.projection.name!=="globe";mr=mr&&(Ra||!Wi),$r=$r&&(Ra||!di),this.placements[yi]=new ui(pn||mr,ai||$r,xn||k.justReloaded),f.add(yi)},Ei=this.retainedQueryData[k.bucketInstanceId].tileID;if(k.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(k,Ei),k.elevationType==="road"&&k.updateRoadElevation(Ei.canonical),k.updateZOffset(),k.sortFeaturesByY){const Yr=k.getSortedSymbolIndexes(this.transform.angle);for(let Dn=Yr.length-1;Dn>=0;--Dn){const hn=Yr[Dn];Fn(k.symbolInstances.get(hn),hn,k.collisionArrays[hn])}k.hasAnyZOffset&&i.w(`${k.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(k.hasAnyZOffset){const Yr=k.getSortedIndexesByZOffset();for(let Dn=0;Dn<Yr.length;++Dn){const hn=Yr[Dn];Fn(k.symbolInstances.get(hn),hn,k.collisionArrays[hn])}}else for(let Yr=l.symbolInstanceStart;Yr<l.symbolInstanceEnd;Yr++)Fn(k.symbolInstances.get(Yr),Yr,k.collisionArrays[Yr]);if(_&&k.bucketInstanceId in this.collisionCircleArrays){const Yr=this.collisionCircleArrays[k.bucketInstanceId];i.bk(Yr.invProjMatrix,G),Yr.viewportMatrix=this.collisionIndex.getViewportMatrix()}k.justReloaded=!1}markUsedJustification(l,f,_,E){const{leftJustifiedTextSymbolIndex:j,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:L,verticalPlacedTextSymbolIndex:B,crossTileID:G}=_,Z=i.c2(f),Q=E===i.bK.vertical?B:Z==="left"?j:Z==="center"?k:Z==="right"?L:-1;j>=0&&(l.text.placedSymbolArray.get(j).crossTileID=Q>=0&&j!==Q?0:G),k>=0&&(l.text.placedSymbolArray.get(k).crossTileID=Q>=0&&k!==Q?0:G),L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=Q>=0&&L!==Q?0:G),B>=0&&(l.text.placedSymbolArray.get(B).crossTileID=Q>=0&&B!==Q?0:G)}markUsedOrientation(l,f,_){const E=f===i.bK.horizontal||f===i.bK.horizontalOnly?f:0,j=f===i.bK.vertical?f:0,{leftJustifiedTextSymbolIndex:k,centerJustifiedTextSymbolIndex:L,rightJustifiedTextSymbolIndex:B,verticalPlacedTextSymbolIndex:G}=_,Z=l.text.placedSymbolArray;k>=0&&(Z.get(k).placedOrientation=E),L>=0&&(Z.get(L).placedOrientation=E),B>=0&&(Z.get(B).placedOrientation=E),G>=0&&(Z.get(G).placedOrientation=j)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let _=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const E=f?f.symbolFadeChange(l):1,j=f?f.opacities:{},k=f?f.variableOffsets:{},L=f?f.placedOrientations:{};for(const B in this.placements){const G=this.placements[B],Z=j[B];Z?(this.opacities[B]=new Xn(Z,E,G.text,G.icon,null,G.clipped),_=_||G.text!==Z.text.placed||G.icon!==Z.icon.placed):(this.opacities[B]=new Xn(null,E,G.text,G.icon,G.skipFade,G.clipped),_=_||G.text||G.icon)}for(const B in j){const G=j[B];if(!this.opacities[B]){const Z=new Xn(G,E,!1,!1);Z.isHidden()||(this.opacities[B]=Z,_=_||G.text.placed||G.icon.placed)}}for(const B in k)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=k[B]);for(const B in L)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=L[B]);_?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)}updateLayerOpacities(l,f,_,E){const j=new Set;for(const k of f){const L=k.getBucket(l);L&&k.latestFeatureIndex&&l.fqid===L.layerIds[0]&&(this.updateBucketOpacities(L,j,k,k.collisionBoxArray,_,E,k.tileID,l.scope),L.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(L,k.tileID),L.elevationType==="road"&&L.updateRoadElevation(k.tileID.canonical),L.updateZOffset())}}updateBucketOpacities(l,f,_,E,j,k,L,B){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const G=l.layers[0].layout,Z=l.layers[0].paint,Q=!!l.layers[0].dynamicFilter(),X=new Xn(null,0,!1,!1,!0),se=G.get("text-allow-overlap"),le=G.get("icon-allow-overlap"),de=G.get("text-variable-anchor"),xe=G.get("text-rotation-alignment")==="map",ye=G.get("text-pitch-alignment")==="map",Ee=Z.get("symbol-z-offset"),Ne=G.get("symbol-elevation-reference")==="sea",je=!Ee.isConstant(),Ve=new Xn(null,0,se&&(le||!l.hasIconData()||G.get("icon-optional")),le&&(se||!l.hasTextData()||G.get("text-optional")),!0);!l.collisionArrays&&E&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(E);const Ie=($e,Le,Ke)=>{for(let dt=0;dt<Le/4;dt++)$e.opacityVertexArray.emplaceBack(Ke)};let Ge=0;k&&l.updateReplacement(L,k);for(let $e=0;$e<l.symbolInstances.length;$e++){const Le=l.symbolInstances.get($e),{numHorizontalGlyphVertices:Ke,numVerticalGlyphVertices:dt,crossTileID:at,numIconVertices:Et,tileAnchorX:yt,tileAnchorY:Nt}=Le;let Xt=null;const mt=this.retainedQueryData[l.bucketInstanceId];je&&Le&&mt&&(Xt=_.latestFeatureIndex.loadFeature({featureIndex:Le.featureIndex,bucketIndex:mt.bucketIndex,sourceLayerIndex:mt.sourceLayerIndex,layoutVertexArrayOffset:0}));const tt=Ee.evaluate(Xt,{}),It=f.has(at);let vt=this.opacities[at];It?vt=X:vt||(vt=Ve,this.opacities[at]=vt),f.add(at);const Bt=Ke>0||dt>0,rr=Et>0,xr=this.placedOrientations[at],Wt=xr===i.bK.vertical,Jt=xr===i.bK.horizontal||xr===i.bK.horizontalOnly;!Bt&&!rr||vt.isHidden()||Ge++;let wr=!1;if((Bt||rr)&&k)for(const pr of l.activeReplacements){if(i.bY(pr,j,i.bZ.Symbol,B)||pr.min.x>yt||yt>pr.max.x||pr.min.y>Nt||Nt>pr.max.y)continue;const dr=i.b_(yt,Nt,L.canonical,pr.footprintTileId.canonical);if(wr=i.b$(dr,pr.footprint),wr)break}if(Bt){const pr=wr?Ia:Kg(vt.text);Ie(l.text,Ke,Wt?Ia:pr),Ie(l.text,dt,Jt?Ia:pr);const dr=vt.text.isHidden(),{leftJustifiedTextSymbolIndex:mr,centerJustifiedTextSymbolIndex:$r,rightJustifiedTextSymbolIndex:jn,verticalPlacedTextSymbolIndex:Fn}=Le,Ei=l.text.placedSymbolArray,Yr=dr||Wt?1:0;mr>=0&&(Ei.get(mr).hidden=Yr),$r>=0&&(Ei.get($r).hidden=Yr),jn>=0&&(Ei.get(jn).hidden=Yr),Fn>=0&&(Ei.get(Fn).hidden=dr||Jt?1:0);const Dn=this.variableOffsets[at];Dn&&this.markUsedJustification(l,Dn.anchor,Le,xr);const hn=this.placedOrientations[at];hn&&(this.markUsedJustification(l,"left",Le,hn),this.markUsedOrientation(l,hn,Le))}if(rr){const pr=wr?Ia:Kg(vt.icon),{placedIconSymbolIndex:dr,verticalPlacedIconSymbolIndex:mr}=Le,$r=l.icon.placedSymbolArray,jn=vt.icon.isHidden()?1:0;dr>=0&&(Ie(l.icon,Et,Wt?Ia:pr),$r.get(dr).hidden=jn),mr>=0&&(Ie(l.icon,Le.numVerticalIconVertices,Jt?Ia:pr),$r.get(mr).hidden=jn)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const pr=l.collisionArrays[$e];if(pr){let dr=new i.P(0,0),mr=!0;if(pr.textBox||pr.verticalTextBox){if(de){const jn=this.variableOffsets[at];jn?(dr=qg(jn.anchor,jn.width,jn.height,jn.textOffset,jn.textScale),xe&&dr._rotate(ye?this.transform.angle:-this.transform.angle)):mr=!1}Q&&(mr=!vt.clipped),pr.textBox&&Wa(l.textCollisionBox.collisionVertexArray,vt.text.placed,!mr||Wt,tt,Ne,dr.x,dr.y),pr.verticalTextBox&&Wa(l.textCollisionBox.collisionVertexArray,vt.text.placed,!mr||Jt,tt,Ne,dr.x,dr.y)}const $r=mr&&!!(!Jt&&pr.verticalIconBox);pr.iconBox&&Wa(l.iconCollisionBox.collisionVertexArray,vt.icon.placed,$r,tt,Ne,Le.hasIconTextFit?dr.x:0,Le.hasIconTextFit?dr.y:0),pr.verticalIconBox&&Wa(l.iconCollisionBox.collisionVertexArray,vt.icon.placed,!$r,tt,Ne,Le.hasIconTextFit?dr.x:0,Le.hasIconTextFit?dr.y:0)}}}if(l.fullyClipped=Ge===0,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const $e=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=$e.invProjMatrix,l.placementViewportMatrix=$e.viewportMatrix,l.collisionCircleArray=$e.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,f){const _=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*_>l}setStale(){this.stale=!0}}function Wa(v,l,f,_,E,j,k){v.emplaceBack(l?1:0,f?1:0,j||0,k||0,_,E?1:0),v.emplaceBack(l?1:0,f?1:0,j||0,k||0,_,E?1:0),v.emplaceBack(l?1:0,f?1:0,j||0,k||0,_,E?1:0),v.emplaceBack(l?1:0,f?1:0,j||0,k||0,_,E?1:0)}const ra=Math.pow(2,25),GI=Math.pow(2,24),Gg=Math.pow(2,17),Lw=Math.pow(2,16),Wg=Math.pow(2,9),l_=Math.pow(2,8),Fw=Math.pow(2,1);function Kg(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const l=v.placed?1:0,f=Math.floor(127*v.opacity);return f*ra+l*GI+f*Gg+l*Lw+f*Wg+l*l_+f*Fw+l}const Ia=0;class cd{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(l,f,_,E,j,k){const L=this._bucketParts;for(;this._currentTileIndex<l.length;)if(f.getBucketParts(L,E,l[this._currentTileIndex],this._sortAcrossTiles,k),this._currentTileIndex++,j())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,L.sort((B,G)=>B.sortKey-G.sortKey));this._currentPartIndex<L.length;){const B=L[this._currentPartIndex];if(f.placeLayerBucketPart(B,this._seenCrossTileIDs,_,B.symbolInstanceStart===0,k),this._currentPartIndex++,j())return!0}return!1}}class gl{constructor(l,f,_,E,j,k,L,B,G){this.placement=new Hg(l,j,k,L,B,G),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=E,this._done=!1}isDone(){return this._done}continuePlacement(l,f,_,E,j){const k=i.o.now(),L=()=>{const B=i.o.now()-k;return!this._forceFullPlacement&&B>2};for(;this._currentPlacementIndex>=0;){const B=f[l[this._currentPlacementIndex]],G=this.placement.collisionIndex.transform.zoom;if(B.type==="symbol"&&(!B.minzoom||B.minzoom<=G)&&(!B.maxzoom||B.maxzoom>G)){const Z=B,Q=Z.layout.get("symbol-z-elevate"),X=Z.layout.get("symbol-sort-key").constantOr(1)!==void 0,se=Z.layout.get("symbol-z-order"),le=se==="viewport-y"||se==="auto"&&!(se!=="viewport-y"&&X),de=Z.layout.get("text-allow-overlap")||Z.layout.get("icon-allow-overlap")||Z.layout.get("text-ignore-placement")||Z.layout.get("icon-ignore-placement"),xe=le&&de,ye=this._inProgressLayer=this._inProgressLayer||new cd(Z),Ee=i.B(B.source,B.scope);if(ye.continuePlacement(Q||xe?E[Ee]:_[Ee],this.placement,this._showCollisionBoxes,B,L,j))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const c_=512/i.al/2;class Sp{constructor(l,f,_){this.tileID=l,this.bucketInstanceId=_,this.index=new i.c3(f.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const E=l.canonical.x*i.al,j=l.canonical.y*i.al;for(let k=0;k<f.length;k++){const{key:L,crossTileID:B,tileAnchorX:G,tileAnchorY:Z}=f.get(k),Q=Math.floor((E+G)*c_),X=Math.floor((j+Z)*c_);this.index.add(Q,X),this.keys.push(L),this.crossTileIDs.push(B)}this.index.finish()}findMatches(l,f,_){const E=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),j=c_/Math.pow(2,f.canonical.z-this.tileID.canonical.z),k=f.canonical.x*i.al,L=f.canonical.y*i.al;for(let B=0;B<l.length;B++){const G=l.get(B);if(G.crossTileID)continue;const{key:Z,tileAnchorX:Q,tileAnchorY:X}=G,se=Math.floor((k+Q)*j),le=Math.floor((L+X)*j),de=this.index.range(se-E,le-E,se+E,le+E).sort((xe,ye)=>xe-ye);for(const xe of de){const ye=this.crossTileIDs[xe];if(this.keys[xe]===Z&&!_.has(ye)){_.add(ye),G.crossTileID=ye;break}}}}}class wa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ju{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const f=Math.round((l-this.lng)/360);if(f!==0)for(const _ in this.indexes){const E=this.indexes[_],j={};for(const k in E){const L=E[k];L.tileID=L.tileID.unwrapTo(L.tileID.wrap+f),j[L.tileID.key]=L}this.indexes[_]=j}this.lng=l}addBucket(l,f,_){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let j=0;j<f.symbolInstances.length;j++)f.symbolInstances.get(j).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]=new Set);const E=this.usedCrossTileIDs[l.overscaledZ];for(const j in this.indexes){const k=this.indexes[j];if(Number(j)>l.overscaledZ)for(const L in k){const B=k[L];B.tileID.isChildOf(l)&&B.findMatches(f.symbolInstances,l,E)}else{const L=k[l.scaledTo(Number(j)).key];L&&L.findMatches(f.symbolInstances,l,E)}}for(let j=0;j<f.symbolInstances.length;j++){const k=f.symbolInstances.get(j);k.crossTileID||(k.crossTileID=_.generate(),E.add(k.crossTileID))}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Sp(l,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(l,f){for(const _ of f.crossTileIDs)this.usedCrossTileIDs[l].delete(_)}removeStaleBuckets(l){let f=!1;for(const _ in this.indexes){const E=this.indexes[_];for(const j in E)l[E[j].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,E[j]),delete E[j],f=!0)}return f}}class ud{constructor(){this.layerIndexes={},this.crossTileIDs=new wa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,f,_,E){let j=this.layerIndexes[l.fqid];j===void 0&&(j=this.layerIndexes[l.fqid]=new ju);let k=!1;const L={};E.name!=="globe"&&j.handleWrapJump(_);for(const B of f){const G=B.getBucket(l);G&&l.fqid===G.layerIds[0]&&(G.bucketInstanceId||(G.bucketInstanceId=++this.maxBucketInstanceId),j.addBucket(B.tileID,G,this.crossTileIDs)&&(k=!0),L[G.bucketInstanceId]=!0)}return j.removeStaleBuckets(L)&&(k=!0),k}pruneUnusedLayers(l){const f={};l.forEach(_=>{f[_]=!0});for(const _ in this.layerIndexes)f[_]||delete this.layerIndexes[_]}}const Ms=771;class vn{constructor(l,f,_,E){this.blendFunction=l,this.blendColor=f.toNonPremultipliedRenderColor(null),this.mask=_,this.blendEquation=E}}vn.Replace=[1,0,1,0],vn.disabled=new vn(vn.Replace,i.ao.transparent,[!1,!1,!1,!1]),vn.unblended=new vn(vn.Replace,i.ao.transparent,[!0,!0,!0,!0]),vn.alphaBlended=new vn([1,Ms,1,Ms],i.ao.transparent,[!0,!0,!0,!0]),vn.alphaBlendedNonPremultiplied=new vn([770,Ms,770,Ms],i.ao.transparent,[!0,!0,!0,!0]),vn.multiply=new vn([774,0,774,0],i.ao.transparent,[!0,!0,!0,!0]),vn.additive=new vn([1,1,1,1],i.ao.transparent,[!0,!0,!0,!0]);class Er{constructor(l,f,_){this.func=l,this.mask=f,this.range=_}}Er.ReadOnly=!1,Er.ReadWrite=!0,Er.disabled=new Er(519,Er.ReadOnly,[0,1]);const df=7680;class tn{constructor(l,f,_,E,j,k){this.test=l,this.ref=f,this.mask=_,this.fail=E,this.depthFail=j,this.pass=k}}tn.disabled=new tn({func:519,mask:0},0,0,df,df,df);const Ep=1029,u_=2305;class Xr{constructor(l,f,_){this.enable=l,this.mode=f,this.frontFace=_}}function Zg(v,l){const f=i.c9(v,3);i.cb(v,l),i.cf(v,3,f)}function d_(v,l){const f=i.c6([]);return i.c7(f,f,-l),i.c8(f,f,-v),f}function sA(v,l){const f=[v[0],v[1],0],_=[l[0],l[1],0];if(i.ag(f)>=1e-15){const k=i.aw([],f);i.c4(_,k,i.bI(_,k)),l[0]=_[0],l[1]=_[1]}const E=i.bH([],l,v);if(i.c5(E)<1e-15)return null;const j=Math.atan2(-E[1],E[0]);return d_(Math.atan2(Math.sqrt(v[0]*v[0]+v[1]*v[1]),-v[2]),j)}Xr.disabled=new Xr(!1,Ep,u_),Xr.backCCW=new Xr(!0,Ep,u_),Xr.backCW=new Xr(!0,Ep,2304),Xr.frontCW=new Xr(!0,1028,2304),Xr.frontCCW=new Xr(!0,1028,u_);class Pu{constructor(l,f){this.position=l,this.orientation=f}get position(){return this._position}set position(l){if(l){const f=l instanceof i.ae?l:new i.ae(l[0],l[1],l[2]);this._renderWorldCopies&&(f.x=i.bS(f.x,0,1)),this._position=f}else this._position=null}lookAtPoint(l,f,_){if(this.orientation=null,!this.position)return;const E=this.position,j=_||(this._elevation?this._elevation.getAtPointOrZero(i.ae.fromLngLat(l)):0),k=i.ae.fromLngLat(l,j),L=[k.x-E.x,k.y-E.y,k.z-E.z];f||(f=[0,0,1]),f[2]=Math.abs(f[2]),this.orientation=sA(L,f)}setPitchBearing(l,f){this.orientation=d_(i.an(l),i.an(-f))}}class h_{constructor(l,f){this._transform=i.bz([]),this.orientation=f,this.position=l}get mercatorPosition(){const l=this.position;return new i.ae(l[0],l[1],l[2])}get position(){const l=i.c9(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var f;l&&i.cf(this._transform,3,[(f=l)[0],f[1],f[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||i.c6([]),l&&Zg(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),f=this.right();return{bearing:Math.atan2(-f[1],f[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,f){this._orientation=d_(l,f),Zg(this._transform,this._orientation)}forward(){const l=i.c9(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=i.c9(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=i.c9(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,f){const _=new Float64Array(16);return i.bk(_,this.getWorldToCamera(l,f)),_}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(l,f,_){const E=this.position;i.c4(E,E,-l);const j=new Float64Array(16);return i.bp(j,[_,_,_]),i.bq(j,j,E),j[10]*=f,j}getWorldToCamera(l,f){const _=new Float64Array(16),E=new Float64Array(4),j=this.position;return i.ca(E,this._orientation),i.c4(j,j,-l),i.cb(_,E),i.bq(_,_,j),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=f,_[9]*=f,_[10]*=f,_[11]*=f,_}getCameraToClipPerspective(l,f,_,E){const j=new Float64Array(16);return i.cc(j,l,f,_,E),j}getCameraToClipOrthographic(l,f,_,E,j,k){const L=new Float64Array(16);return i.cd(L,l,f,_,E,j,k),L}getDistanceToElevation(l,f=!1){const _=l===0?0:i.ce(l,f?i.a_(this.position[1]):this.position[1]),E=this.forward();return(_-this.position[2])/E[2]}clone(){return new h_([...this.position],[...this.orientation])}}const Ka={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Bo{constructor(l=0,f=0,_=0,E=0){if(isNaN(l)||l<0||isNaN(f)||f<0||isNaN(_)||_<0||isNaN(E)||E<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=_,this.right=E}interpolate(l,f,_){return f.top!=null&&l.top!=null&&(this.top=i.ak(l.top,f.top,_)),f.bottom!=null&&l.bottom!=null&&(this.bottom=i.ak(l.bottom,f.bottom,_)),f.left!=null&&l.left!=null&&(this.left=i.ak(l.left,f.left,_)),f.right!=null&&l.right!=null&&(this.right=i.ak(l.right,f.right,_)),this}getCenter(l,f){const _=i.aA((this.left+l-this.right)/2,0,l),E=i.aA((this.top+f-this.bottom)/2,0,f);return new i.P(_,E)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new Bo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const hf=15;class Tp{constructor(l,f,_,E,j,k,L){this.tileSize=512,this._renderWorldCopies=j===void 0||j,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=_??0,this._maxPitch=E??60,this.setProjection(k),this.setMaxBounds(L),this.width=0,this.height=0,this._center=new i.aS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Bo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new h_,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const l=new Tp(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l._allowWorldUnderZoom=this._allowWorldUnderZoom,l}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<hf}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(l,f=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_)&&this._updateCameraOnTerrain(),(l||_)&&this._constrainCamera(f),this._calcMatrices()}getProjection(){return i.aH(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const f=this.projection?this.getProjection():void 0;this.projection=i.cl(this.projectionOptions);const _=this.getProjection(),E=!i.bx(f,_);return E&&this._calcMatrices(),this.mercatorFromTransition=!1,E}setOrthographicProjectionAtLowPitch(l){return this._orthographicProjectionAtLowPitch!==l&&(this._orthographicProjectionAtLowPitch=l,this._calcMatrices(),!0)}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.cl({name:"mercator"});const f=l!==this.projection.name;return f&&this._calcMatrices(),f}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bS(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const f=-l*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=i.cm(),i.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const f=i.aA(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=i.an(l),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._setZoom(f),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(l){this._tileCoverLift!==l&&(this._tileCoverLift=l)}_updateCameraOnTerrain(){const l=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,f=this.elevation&&l===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||l===Number.NEGATIVE_INFINITY&&(!f||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const _=this._elevation;f||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&_.exaggeration()&&this._centerAltitudeValidForExaggeration!==_.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*_.exaggeration(),this._centerAltitudeValidForExaggeration=_.exaggeration()):(this._centerAltitude=l||0,this._centerAltitudeValidForExaggeration=_.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const l=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(l)}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,f=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let E=0,j=0;for(let k=0;k<f.length;k++){const L=new i.P(f[k][0]*this.width,_+f[k][1]*(this.height-_)),B=l.pointCoordinate(L);if(!B)continue;const G=1/Math.hypot(B[0]-this._camera.position[0],B[1]-this._camera.position[1]);E+=B[3]*G,j+=G}return j===0?NaN:E/j}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const l=this._seaLevelZoom,f=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*f,E=this._mercatorZfromZoom(l),j=this._mercatorZfromZoom(this._maxZoom),k=Math.max(E-_,j);this._setZoom(this._zoomFromMercatorZ(k))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const f=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let _;_=l.z<this._camera.position[2]?[f.x,f.y,f.z]:[l.x,l.y,l.z];const E=i.ag(i.av([],this._camera.position,_));return i.aA(this._zoomFromMercatorZ(E),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let f=!1;if(l.orientation&&!i.co(l.orientation,this._camera.orientation)&&(f=this._setCameraOrientation(l.orientation)),l.position){const _=[l.position.x,l.position.y,l.position.z];i.cp(_,this._camera.position)||(this._setCameraPosition(_),f=!0)}f&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,f=new Pu;return f.position=new i.ae(l[0],l[1],l[2]),f.orientation=this._camera.orientation,f._elevation=this.elevation,f._renderWorldCopies=this.renderWorldCopies,f}_setCameraOrientation(l){if(!i.cq(l))return!1;i.cr(l,l);const f=i.cs([],[0,0,-1],l),_=i.cs([],[0,-1,0],l);if(_[2]<0)return!1;const E=sA(f,_);return!!E&&(this._camera.orientation=E,!0)}_setCameraPosition(l){const f=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,E=this.cameraToCenterDistance;l[2]=i.aA(l[2],E/_,E/f),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,f,_){this._unmodified=!1,this._edgeInsets.interpolate(l,f,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(l){const f=[new i.ct(0,l)];if(this.renderWorldCopies){const _=this.pointCoordinate(new i.P(0,0)),E=this.pointCoordinate(new i.P(this.width,0)),j=this.pointCoordinate(new i.P(this.width,this.height)),k=this.pointCoordinate(new i.P(0,this.height)),L=Math.floor(Math.min(_.x,E.x,j.x,k.x)),B=Math.floor(Math.max(_.x,E.x,j.x,k.x)),G=1;for(let Z=L-G;Z<=B+G;Z++)Z!==0&&f.push(new i.ct(Z,l))}return f}isLODDisabled(l){return(!l||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(l,f,_){let E=[];const j=_!=null,k=!j;if(k&&this.zoom<f||j&&_[0]===0&&_[1]===0)return E;const L=new Set,B=(Z,Q,X,se,le)=>{const de=i.cX(Q,Z,X,se,le);L.has(de)||(E.push(new i.aP(Z,Q,X,se,le)),L.add(de))};for(let Z=0;Z<l.length;Z++){const Q=l[Z];if(k&&Q.canonical.z!==f)continue;const X=Q.canonical,se=Q.overscaledZ,le=Q.wrap,de=1<<X.z,xe=X.x+1<de,ye=X.x>0,Ee=X.y+1<de,Ne=X.y>0,je=Q.wrap-(ye?0:1),Ve=Q.wrap+(xe?0:1),Ie=ye?X.x-1:de-1,Ge=xe?X.x+1:0;if(j)_[0]<0?(B(se,Ve,X.z,Ge,X.y),_[1]<0&&Ee&&(B(se,le,X.z,X.x,X.y+1),B(se,Ve,X.z,Ge,X.y+1)),_[1]>0&&Ne&&(B(se,le,X.z,X.x,X.y-1),B(se,Ve,X.z,Ge,X.y-1))):_[0]>0?(B(se,je,X.z,Ie,X.y),_[1]<0&&Ee&&(B(se,le,X.z,X.x,X.y+1),B(se,je,X.z,Ie,X.y+1)),_[1]>0&&Ne&&(B(se,le,X.z,X.x,X.y-1),B(se,je,X.z,Ie,X.y-1))):_[1]<0&&Ee?B(se,le,X.z,X.x,X.y+1):Ne&&B(se,le,X.z,X.x,X.y-1);else{const $e=Q.visibleQuadrants;1&$e&&(B(se,je,X.z,Ie,X.y),Ne&&(B(se,le,X.z,X.x,X.y-1),B(se,je,X.z,Ie,X.y-1))),2&$e&&(B(se,Ve,X.z,Ge,X.y),Ne&&(B(se,le,X.z,X.x,X.y-1),B(se,Ve,X.z,Ge,X.y-1))),4&$e&&(B(se,je,X.z,Ie,X.y),Ee&&(B(se,le,X.z,X.x,X.y+1),B(se,je,X.z,Ie,X.y+1))),8&$e&&(B(se,Ve,X.z,Ge,X.y),Ee&&(B(se,le,X.z,X.x,X.y+1),B(se,Ve,X.z,Ge,X.y+1)))}}const G=[];for(const Z of E)E.some(Q=>Z.isChildOf(Q))||G.push(Z);if(E=G.filter(Z=>!l.some(Q=>!!(Z.overscaledZ<f&&Q.isChildOf(Z))||Z.equals(Q)||Z.isChildOf(Q))),k){const Z=1<<f,Q=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=[Z*Q.x,Z*Q.y],se=4,le=se*se;E=E.filter(de=>{const xe=de.canonical.x+.5-X[0],ye=de.canonical.y+.5-X[1];return xe*xe+ye*ye<le})}return E}extendTileCoverToNearPlane(l,f,_){const E=[],j=new Set;for(const Ee of l)j.add(Ee.key);const k=(Ee,Ne,je,Ve,Ie)=>{const Ge=i.cX(Ne,Ee,je,Ve,Ie);j.has(Ge)||(E.push(new i.aP(Ee,Ne,je,Ve,Ie)),j.add(Ge))},L=l.reduce((Ee,Ne)=>Math.max(Ee,Ne.overscaledZ),_),B=1<<_,G=[new i.P(0,0),new i.P(i.al,0),new i.P(i.al,i.al),new i.P(0,i.al)],Z=new i.P(0,0),Q=new i.P(0,0),X=(Ee,Ne)=>{const je=Math.floor(Ee[0]),Ve=Math.floor(Ee[1]),Ie=(Ee[0]-je)*i.al,Ge=(Ee[1]-Ve)*i.al,$e=Math.floor(Ne[0]),Le=Math.floor(Ne[1]),Ke=(Ne[0]-$e)*i.al,dt=(Ne[1]-Le)*i.al;for(let at=-1;at<=1;at++){const Et=je+at;if(!(Et<0||Et>=B)){Z.x=Ie-at*i.al,Q.x=Ke-(Et-$e)*i.al;for(let yt=-1;yt<=1;yt++){const Nt=Ve+yt;Z.y=Ge-yt*i.al,Q.y=dt-(Nt-Le)*i.al,i.cY(Z,Q,G)&&k(L,0,_,Et,Nt)}}}},se=f.points,le=se[i.cu],de=se[i.cv],xe=this._projectToGround(le,se[i.cw]),ye=this._projectToGround(de,se[i.cx]);return X(le,xe),X(de,ye),E}_projectToGround(l,f){return i.cy(i.cz(),l,f,l[2]/(l[2]-f[2]))}coveringTiles(l){let f=this.coveringZoomLevel(l);const _=f,E=this.elevation&&this.elevation.exaggeration(),j=E&&!l.isTerrainDEM,k=this.projection.name==="mercator";if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);const L=this.locationCoordinate(this.center),B=this.center.lat,G=1<<f,Z=[G*L.x,G*L.y,0],Q=this.projection.name==="globe",X=!Q,se=i.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f,X),le=Q?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),de=G*i.ce(1,this.center.lat),xe=this._camera.position[2]/i.ce(1,this.center.lat),ye=[G*le.x,G*le.y,xe*(X?1:de)],Ee=Q||E,Ne=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),je=this.isLODDisabled(!0)?f:0;let Ve;if(this._elevation&&l.isTerrainDEM)Ve=1e4*this._elevation.exaggeration();else if(this._elevation){const tt=this._elevation.getMinMaxForVisibleTiles();Ve=tt?tt.max:this._centerAltitude}else Ve=this._centerAltitude;const Ie=l.isTerrainDEM?-Ve:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ge=this.projection.isReprojectedInTileSpace?i.cB(this):1,$e=tt=>{const vt=new i.ae(tt.x+25e-6,tt.y,tt.z),Bt=new i.ae(tt.x,tt.y+25e-6,tt.z),rr=tt.toLngLat(),xr=vt.toLngLat(),Wt=Bt.toLngLat(),Jt=this.locationCoordinate(rr),wr=this.locationCoordinate(xr),pr=this.locationCoordinate(Wt),dr=Math.hypot(wr.x-Jt.x,wr.y-Jt.y),mr=Math.hypot(pr.x-Jt.x,pr.y-Jt.y);return Math.sqrt(dr*mr)*Ge/25e-6},Le=tt=>{const It=Ve,vt=Ie;return{aabb:i.cE(this,G,0,0,0,tt,vt,It,this.projection),zoom:0,x:0,y:0,minZ:vt,maxZ:It,wrap:tt,fullyVisible:!1}},Ke=[];let dt=[];const at=f,Et=l.reparseOverscaled?_:f,yt=(xe-this._centerAltitude)*de,Nt=tt=>{if(!this._elevation||!tt.tileID||!k)return;const It=this._elevation.getMinMaxForTile(tt.tileID),vt=tt.aabb;It?(vt.min[2]=It.min,vt.max[2]=It.max,vt.center[2]=(vt.min[2]+vt.max[2])/2):(tt.shouldSplit=mt(tt),tt.shouldSplit||(vt.min[2]=vt.max[2]=vt.center[2]=this._centerAltitude))},Xt=(tt,It)=>{if(.707*It<tt)return 1;const vt=It/tt;return vt/(1.4144271570014144+(Math.pow(1.1,vt-1.4144271570014144+1)-1)/(1.1-1)-1)},mt=tt=>{if(tt.zoom<je)return!0;if(tt.zoom===at)return!1;if(tt.shouldSplit!=null)return tt.shouldSplit;const It=tt.aabb.distanceX(ye),vt=tt.aabb.distanceY(ye);let Bt=yt,rr=1;if(Q){Bt=tt.aabb.distanceZ(ye);const mr=Math.pow(2,tt.zoom),$r=i.a_((tt.y+1)/mr),jn=i.a_(tt.y/mr),Fn=Math.min(Math.max(B,$r),jn),Ei=i.d0(Fn)/i.d0(B);if(rr=Fn===B?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ei/this._mercatorScaleRatio),this.zoom<=i.cZ&&tt.zoom===at-1&&Ei>=.9)return!0}else if(j&&(Bt=tt.aabb.distanceZ(ye)*de),this.projection.isReprojectedInTileSpace&&_<=5){const mr=Math.pow(2,tt.zoom),$r=$e(new i.ae((tt.x+.5)/mr,(tt.y+.5)/mr));rr=$r>.85?1:$r}if(!k&&!Q){const mr=Math.sqrt(It*It+vt*vt+Bt*Bt);let $r=(1<<at-tt.zoom)*Ne*rr;return $r*=Xt(Math.max(Bt,yt),mr),mr<$r}let xr=Number.MAX_VALUE,Wt=0;const Jt=tt.aabb.getCorners(),wr=[];for(const mr of Jt){i.av(wr,mr,ye),Q||(j?wr[2]*=de:wr[2]=yt);const $r=i.bI(wr,this._camera.forward());$r<xr&&(xr=$r,Wt=Math.abs(wr[2]))}let pr=(1<<at-tt.zoom)*Ne*rr;if(pr*=Xt(Math.max(Wt,yt),xr),xr<pr)return!0;const dr=tt.aabb.closestPoint(Z);return dr[0]===Z[0]&&dr[1]===Z[1]};if(this.renderWorldCopies)for(let tt=1;tt<=3;tt++)Ke.push(Le(-tt)),Ke.push(Le(tt));for(Ke.push(Le(0));Ke.length>0;){const tt=Ke.pop(),It=tt.x,vt=tt.y;let Bt=tt.fullyVisible;const rr=()=>this.projection.name==="globe"&&(tt.y===0||tt.y===(1<<tt.zoom)-1);if(!Bt){let xr=Ee?tt.aabb.intersects(se):tt.aabb.intersectsFlat(se);if(xr===0&&rr()){const Wt=new i.cC(tt.zoom,It,vt);xr=i.cD(this,G,Wt,!0).intersects(se)}if(xr===0)continue;Bt=xr===2}if(tt.zoom!==at&&mt(tt))for(let xr=0;xr<4;xr++){const Wt=(It<<1)+xr%2,Jt=(vt<<1)+(xr>>1),wr={aabb:k?tt.aabb.quadrant(xr):i.cE(this,G,tt.zoom+1,Wt,Jt,tt.wrap,tt.minZ,tt.maxZ,this.projection),zoom:tt.zoom+1,x:Wt,y:Jt,wrap:tt.wrap,fullyVisible:Bt,tileID:void 0,shouldSplit:void 0,minZ:tt.minZ,maxZ:tt.maxZ};j&&!Q&&(wr.tileID=new i.aP(tt.zoom+1===at?Et:tt.zoom+1,tt.wrap,tt.zoom+1,Wt,Jt),Nt(wr)),Ke.push(wr)}else{const xr=tt.zoom===at?Et:tt.zoom;if(l.minzoom&&l.minzoom>xr)continue;let Wt=0;if(!Bt){let dr=Ee?tt.aabb.intersectsPrecise(se):tt.aabb.intersectsPreciseFlat(se);if(dr===0&&rr()){const mr=new i.cC(tt.zoom,It,vt);dr=i.cD(this,G,mr,!0).intersectsPrecise(se)}if(dr===0)continue;if(l.calculateQuadrantVisibility)if(se.containsPoint(tt.aabb.center))Wt=15;else for(let mr=0;mr<4;mr++)tt.aabb.quadrant(mr).intersects(se)!==0&&(Wt|=1<<mr)}const Jt=Z[0]-(.5+It+(tt.wrap<<tt.zoom))*(1<<f-tt.zoom),wr=Z[1]-.5-vt,pr=tt.tileID?tt.tileID:new i.aP(xr,tt.wrap,tt.zoom,It,vt);l.calculateQuadrantVisibility&&(pr.visibleQuadrants=Wt),dt.push({tileID:pr,distanceSq:Jt*Jt+wr*wr})}}if(this.fogCullDistSq){const tt=this.fogCullDistSq,It=this.horizonLineFromTop();dt=dt.filter(vt=>{const Bt=[0,0,0,1],rr=[i.al,i.al,0,1],xr=this.calculateFogTileMatrix(vt.tileID.toUnwrapped());i.aC(Bt,Bt,xr),i.aC(rr,rr,xr);const Wt=i.cF([],Bt,rr),Jt=i.cG([],Bt,rr),wr=i.c_(Wt,Jt);if(wr===0)return!0;let pr=!1;const dr=this._elevation;if(dr&&wr>tt&&It!==0){const mr=this.calculateProjMatrix(vt.tileID.toUnwrapped());let $r;l.isTerrainDEM||($r=dr.getMinMaxForTile(vt.tileID)),$r||($r={min:Ie,max:Ve});const jn=i.cH(this.rotation),Fn=[jn[0]*i.al,jn[1]*i.al,$r.max];i.af(Fn,Fn,mr),pr=(1-Fn[1])*this.height*.5<It}return wr<tt||pr})}return dt.sort((tt,It)=>tt.distanceSq-It.distanceSq).map(tt=>tt.tileID)}resize(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log2(l)}project(l){const f=i.aA(l.lat,-i.cI,i.cI),_=this.projection.project(l.lng,f);return new i.P(_.x*this.worldSize,_.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,f){let _,E;const j=this.centerPoint;if(this.projection.name==="globe"){const L=this.worldSize;_=(f.x-j.x)/L,E=(f.y-j.y)/L}else{const L=this.pointCoordinate(f),B=this.pointCoordinate(j);_=L.x-B.x,E=L.y-B.y}const k=this.locationCoordinate(l);this.setLocation(new i.ae(k.x-_,k.y-E))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l,f){return this.projection.locationPoint(this,l,f)}locationPoint3D(l,f){return this.projection.locationPoint(this,l,f,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l,f){return this.coordinateLocation(this.pointCoordinate3D(l,f))}locationCoordinate(l,f){const _=f?i.ce(f,l.lat):void 0,E=this.projection.project(l.lng,l.lat);return new i.ae(E.x,E.y,_)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,f){const _=f??this._centerAltitude,E=[l.x,l.y,0,1],j=[l.x,l.y,1,1];i.aC(E,E,this.pixelMatrixInverse),i.aC(j,j,this.pixelMatrixInverse);const k=j[3];i.cJ(E,E,1/E[3]),i.cJ(j,j,1/k);const L=E[2],B=j[2];return{p0:E,p1:j,t:L===B?0:(_-L)/(B-L)}}screenPointToMercatorRay(l){const f=[l.x,l.y,0,1],_=[l.x,l.y,1,1];return i.aC(f,f,this.pixelMatrixInverse),i.aC(_,_,this.pixelMatrixInverse),i.cJ(f,f,1/f[3]),i.cJ(_,_,1/_[3]),f[2]=i.ce(f[2],this._center.lat)*this.worldSize,_[2]=i.ce(_[2],this._center.lat)*this.worldSize,i.cJ(f,f,1/this.worldSize),i.cJ(_,_,1/this.worldSize),new i.ax([f[0],f[1],f[2]],i.aw([],i.av([],_,f)))}rayIntersectionCoordinate(l){const{p0:f,p1:_,t:E}=l,j=i.ce(f[2],this._center.lat),k=i.ce(_[2],this._center.lat);return new i.ae(i.ak(f[0],_[0],E)/this.worldSize,i.ak(f[1],_[1],E)/this.worldSize,i.ak(j,k,E))}pointCoordinate(l,f=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,f)}pointCoordinate3D(l,f){if(!this.elevation)return this.pointCoordinate(l,f);let _=this.projection.pointCoordinate3D(this,l.x,l.y);if(_)return new i.ae(_[0],_[1],_[2]);let E=0,j=this.horizonLineFromTop();if(l.y>j)return this.pointCoordinate(l,f);const k=.02*j,L=l.clone();for(let B=0;B<10&&j-E>k;B++){L.y=i.ak(E,j,.66);const G=this.projection.pointCoordinate3D(this,L.x,L.y);G?(j=L.y,_=G):E=L.y}return _?new i.ae(_[0],_[1],_[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}isPointOnSurface(l){if(l.y<0||l.y>this.height||l.x<0||l.x>this.width)return!1;if(this.elevation||this.zoom>=i.cK)return!this.isPointAboveHorizon(l);const f=this.pointCoordinate(l);return f.y>=0&&f.y<=1}_coordinatePoint(l,f){const _=f&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,E=[l.x*this.worldSize,l.y*this.worldSize,_+l.toAltitude(),1];return i.aC(E,E,this.pixelMatrix),E[3]>0?new i.P(E[0]/E[3],E[1]/E[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:l,left:f}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,j=this.pointLocation3D(new i.P(f,l)),k=this.pointLocation3D(new i.P(E,l)),L=this.pointLocation3D(new i.P(E,_)),B=this.pointLocation3D(new i.P(f,_));let G=Math.min(j.lng,k.lng,L.lng,B.lng),Z=Math.max(j.lng,k.lng,L.lng,B.lng),Q=Math.min(j.lat,k.lat,L.lat,B.lat),X=Math.max(j.lat,k.lat,L.lat,B.lat);const se=Math.pow(2,-this.zoom)/16*270,le=this.projection.name==="globe"?1:4,de=(xe,ye,Ee,Ne,je)=>{const Ve=(xe+Ee)/2,Ie=(ye+Ne)/2,Ge=new i.P(Ve,Ie),{lng:$e,lat:Le}=this.pointLocation3D(Ge),Ke=Math.max(0,G-$e,Q-Le,$e-Z,Le-X);G=Math.min(G,$e),Z=Math.max(Z,$e),Q=Math.min(Q,Le),X=Math.max(X,Le),(je<le||Ke>se)&&(de(xe,ye,Ve,Ie,je+1),de(Ve,Ie,Ee,Ne,je+1))};if(de(f,l,E,l,1),de(E,l,E,_,1),de(E,_,f,_,1),de(f,_,f,l,1),this.projection.name==="globe"){const[xe,ye]=i.cL(this);xe?(X=90,Z=180,G=-180):ye&&(Q=-90,Z=180,G=-180)}return new i.aI(new i.aS(G,Q),new i.aS(Z,X))}_getBoundsRectangular(l,f){const{top:_,left:E}=this._edgeInsets,j=this.height-this._edgeInsets.bottom,k=this.width-this._edgeInsets.right,L=new i.P(E,_),B=new i.P(k,_),G=new i.P(k,j),Z=new i.P(E,j);let Q=this.pointCoordinate(L,l),X=this.pointCoordinate(B,l);const se=this.pointCoordinate(G,f),le=this.pointCoordinate(Z,f),de=(xe,ye)=>(ye.y-xe.y)/(ye.x-xe.x);return Q.y>1&&X.y>=0?Q=new i.ae((1-le.y)/de(le,Q)+le.x,1):Q.y<0&&X.y<=1&&(Q=new i.ae(-le.y/de(le,Q)+le.x,0)),X.y>1&&Q.y>=0?X=new i.ae((1-se.y)/de(se,X)+se.x,1):X.y<0&&Q.y<=1&&(X=new i.ae(-se.y/de(se,X)+se.x,0)),new i.aI().extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(le)).extend(this.coordinateLocation(se))}_getBoundsRectangularTerrain(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);const f=l.visibleDemTiles.reduce((_,E)=>{if(E.dem){const j=E.dem.tree;_.min=Math.min(_.min,j.minimums[0]),_.max=Math.max(_.max,j.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(f.min*l.exaggeration(),f.max*l.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){const f=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,_=this.height/2-f*(1-this._horizonShift);return l?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-i.cI,this.maxLat=i.cI,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.aF(this.minLng)*this.tileSize,this.worldMaxX=i.aF(this.maxLng)*this.tileSize,this.worldMinY=i.aJ(this.maxLat)*this.tileSize,this.worldMaxY=i.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,f){return this.projection.createTileMatrix(this,f,l)}calculateDistanceTileData(l){const f=l.key,_=this._distanceTileDataCache;if(_[f])return _[f];const E=l.canonical,j=1/this.height,k=this.cameraWorldSize,L=k/this.zoomScale(E.z),B=(E.x+Math.pow(2,E.z)*l.wrap)*L,G=E.y*L,Z=this.point;Z.x*=k/this.worldSize,Z.y*=k/this.worldSize;const Q=this.angle,X=Math.sin(-Q),se=-Math.cos(-Q);return _[f]={bearing:[X,se],center:[(Z.x-B)*j,(Z.y-G)*j],scale:L/i.al*j},_[f]}calculateFogTileMatrix(l){const f=l.key,_=this._fogTileMatrixCache;if(_[f])return _[f];const E=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return i.aB(E,this.worldToFogMatrix,E),_[f]=new Float32Array(E),_[f]}calculateProjMatrix(l,f=!1,_=!1){const E=l.key;let j;if(j=_?this._expandedProjMatrixCache:f?this._alignedProjMatrixCache:this._projMatrixCache,j[E])return j[E];const k=this.calculatePosMatrix(l,this.worldSize);let L;return L=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:_?this.expandedFarZProjMatrix:f?this.alignedProjMatrix:this.projMatrix,i.aB(k,L,k),j[E]=new Float32Array(k),j[E]}calculatePixelsToTileUnitsMatrix(l){const f=l.tileID.key,_=this._pixelsToTileUnitsCache;if(_[f])return _[f];const E=i.cM(l,this);return _[f]=E,_[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const l=1/this.worldSize,f=i.bp([],[l,l,l]);return i.aB(f,f,this.globeMatrix),f}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const l=this._elevation;this._updateCameraState();const f=i.ce(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(f),E=this._camera.forward(),j=i.ce(1,this._center.lat);_[2]/=j,E[2]/=j,i.aw(E,E);const k=l.raycast(_,E,l.exaggeration());if(k){const L=i.bG([],_,E,k),B=new i.ae(L[0],L[1],i.ce(L[2],i.a_(L[1]))),G=(B.z+i.ag([B.x-_[0],B.y-_[1],B.z-_[2]*j]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(G),this._centerAltitude=B.toAltitude(),this._center=this.coordinateLocation(B),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;const f=this._elevation,_=i.ce(1,this._center.lat)*this.worldSize,E=this._computeCameraPosition(_),j=f.getAtPointOrZero(new i.ae(...E)),k=this.pixelsPerMeter/this.worldSize*j,L=this._minimumHeightOverTerrain(),B=E[2]-k;if(B<=L)if(B<0||l){const G=this.locationCoordinate(this._center,this._centerAltitude),Z=[E[0],E[1],G.z-E[2]],Q=i.ag(Z);Z[2]-=(L-B)/this._pixelsPerMercatorPixel;const X=i.ag(Z);if(X===0)return;i.c4(Z,Z,Q/X*this._pixelsPerMercatorPixel),this._camera.position=[E[0],E[1],G.z*this._pixelsPerMercatorPixel-Z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const X=this.center;return X.lat=i.aA(X.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(X.lng=i.aA(X.lng,this.minLng,this.maxLng)),this.center=X,void(this._constraining=!1)}const f=this._unmodified,{x:_,y:E}=this.point;let j=0,k=_,L=E;const B=this.width/2,G=this.height/2,Z=this.worldMinY*this.scale,Q=this.worldMaxY*this.scale;if(E-G<Z&&(L=Z+G),E+G>Q&&(L=Q-G),Q-Z<this.height&&(j=Math.max(j,this.height/(Q-Z)),L=(Q+Z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const X=this.worldMinX*this.scale,se=this.worldMaxX*this.scale,le=this.worldSize/2-(X+se)/2;k=(_+le+this.worldSize)%this.worldSize-le,k-B<X&&(k=X+B),k+B>se&&(k=se-B),se-X<this.width&&(j=Math.max(j,this.width/(se-X)),k=(se+X)/2)}k===_&&L===E||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(k,L))),j&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(j)),this._constrainCamera(),this._unmodified=f,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,f=this.projection.name==="globe",_=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.ce(1,this.center.lat)/i.ce(1,i.d1));const E=i.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,E),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const j=this.projection.zAxisUnit==="meters"?_:1,k=this._camera.getWorldToCamera(this.worldSize,j);let L;const B=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(B[8]=2*-l.x/this.width,B[9]=2*l.y/this.height,this.isOrthographic){let Le=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ke=Le*this.aspect,dt=-Ke,at=-Le;Ke-=l.x,dt-=l.x,Le+=l.y,at+=l.y,L=this._camera.getCameraToClipOrthographic(dt,Ke,at,Le,this._nearZ,this._farZ),((Et,yt,Nt,Xt)=>{for(let mt=0;mt<16;mt++)Et[mt]=i.ak(yt[mt],Nt[mt],Xt)})(L,L,B,i.c$(this.pitch>=hf?1:this.pitch/hf))}else L=B;const G=i.cO([],B,k);let Z=i.cO([],L,k);if(this.projection.isReprojectedInTileSpace){const Le=this.locationCoordinate(this.center),Ke=i.bz([]);i.bq(Ke,Ke,[Le.x*this.worldSize,Le.y*this.worldSize,0]),i.aB(Ke,Ke,i.cP(this)),i.bq(Ke,Ke,[-Le.x*this.worldSize,-Le.y*this.worldSize,0]),i.aB(Z,Z,Ke),i.aB(G,G,Ke),this.inverseAdjustmentMatrix=i.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.cR([],Z,[this.worldSize,this.worldSize,this.worldSize/j,1]),this.projMatrix=Z,this.invProjMatrix=i.bk(new Float64Array(16),this.projMatrix),f){const Le=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Le[8]=2*-l.x/this.width,Le[9]=2*l.y/this.height,this.expandedFarZProjMatrix=i.cO([],Le,k)}else this.expandedFarZProjMatrix=this.projMatrix;const Q=i.bk([],L);this.frustumCorners=i.cS.fromInvProjectionMatrix(Q,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!f);const X=new Float32Array(16);i.bz(X),i.cR(X,X,[1,-1,1]),i.cT(X,X,this._pitch),i.bA(X,X,this.angle);const se=i.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.by(se);const le=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;se[8]=2*-l.x/this.width,se[9]=2*(l.y+le)/this.height,this.skyboxMatrix=i.aB(X,se,X);const de=this.point,xe=de.x,ye=de.y,Ee=this.width%2/2,Ne=this.height%2/2,je=Math.cos(this.angle),Ve=Math.sin(this.angle),Ie=xe-Math.round(xe)+je*Ee+Ve*Ne,Ge=ye-Math.round(ye)+je*Ne+Ve*Ee,$e=new Float64Array(Z);if(i.bq($e,$e,[Ie>.5?Ie-1:Ie,Ge>.5?Ge-1:Ge,0]),this.alignedProjMatrix=$e,Z=i.bB(),i.cR(Z,Z,[this.width/2,-this.height/2,1]),i.bq(Z,Z,[1,-1,0]),this.labelPlaneMatrix=Z,Z=i.bB(),i.cR(Z,Z,[1,-1,1]),i.bq(Z,Z,[-1,-1,0]),i.cR(Z,Z,[2/this.width,2/this.height,1]),this.glCoordMatrix=Z,this.pixelMatrix=i.aB(new Float64Array(16),this.labelPlaneMatrix,G),this._calcFogMatrices(),this._distanceTileDataCache={},Z=i.bk(new Float64Array(16),this.pixelMatrix),!Z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=Z,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.cU(this);const Le=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.af(Le,Le,k),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=Z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSizeForFog,f=this.cameraPixelsPerMeter,_=this._camera.position,E=1/this.height/this._pixelsPerMercatorPixel,j=[l,l,f];i.c4(j,j,E),i.c4(_,_,-1),i.cV(_,_,j);const k=i.bB();i.bq(k,k,_),i.cR(k,k,j),this.mercatorFogMatrix=k,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,f,E)}_computeCameraPosition(l){const f=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),E=this.point,j=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*f-l/this.worldSize*this._centerAltitude;return[E.x/this.worldSize-_[0]*j,E.y/this.worldSize-_[1]*j,l/this.worldSize*this._centerAltitude-_[2]*j]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const f=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],E=l[2];let j=1;this.projection.wrap&&(this.center=this.center.wrap()),E>0&&(j=Math.min((f-_)/E,1)),this._camera.position=i.bG([],this._camera.position,l,j),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,f=this._camera.forward(),{pitch:_,bearing:E}=this._camera.getPitchBearing(),j=i.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,k=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.an(this._maxPitch)),L=Math.max((l[2]-j)/Math.cos(_),k),B=this._zoomFromMercatorZ(L);i.bG(l,l,f,L),this._pitch=i.aA(_,i.an(this.minPitch),i.an(this.maxPitch)),this.angle=i.bS(E,-Math.PI,Math.PI),this._setZoom(i.aA(B,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ae(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,l)*this.tileSize))}zoomFromMercatorZAdjusted(l){let f=0,_=i.cK,E=0,j=1/0;for(;_-f>1e-6&&_>f;){const k=f+.5*(_-f),L=this.tileSize*Math.pow(2,k),B=this.getCameraToCenterDistance(this.projection,k,L),G=this.scaleZoom(B/(Math.max(0,l)*this.tileSize)),Z=Math.abs(k-G);Z<j&&(j=Z,E=k),k<G?f=k:_=k}return E}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,f){const _=Math.min(l.x,f.x),E=Math.max(l.x,f.x),j=Math.min(l.y,f.y),k=Math.max(l.y,f.y);if(j<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const L=[new i.P(_,j),new i.P(E,k),new i.P(_,k),new i.P(E,j)],B=this.renderWorldCopies?-3:0,G=this.renderWorldCopies?4:1;for(const Z of L){const Q=this.pointRayIntersection(Z);if(Q.t<0)return!0;const X=this.rayIntersectionCoordinate(Q);if(X.x<B||X.y<0||X.x>G||X.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(l,f){const _=i.ag(i.av([],this._camera.position,l)),E=this._zoomFromMercatorZ(_)+f;return _-this._mercatorZfromZoom(E)}getCameraPoint(){if(this.projection.name==="globe"){const l=function([f,_,E],j){const k=[f,_,E,1];i.aC(k,k,j);const L=k[3]=Math.max(k[3],1e-6);return k[0]/=L,k[1]/=L,k[2]/=L,k}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,l))}}getCameraToCenterDistance(l,f=this.zoom,_=this.worldSize){const E=i.cN(l,f,this.width,this.height,1024),j=l.pixelSpaceConversion(this.center.lat,_,E);let k=.5/Math.tan(.5*this._fov)*this.height*j;return this.isOrthographic&&(k=i.ak(1,k,i.c$(this.pitch>=hf?1:this.pitch/hf))),k}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.aB(l,l,this.globeMatrix),l}getFrustum(l){return i.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,this.projection.zAxisUnit==="meters")}}const dd=(v,l)=>{if(l>0&&v.terrain&&i.w("Cutoff is currently disabled on terrain"),l<=0||v.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const f=v.transform,_=Math.max(Math.abs(f._zoom-(v.minCutoffZoom-1)),1),E=f.isLODDisabled(!1)?i.ah(60,45,f.pitch):i.ah(30,15,f.pitch),j=f._farZ-f._nearZ,k=l*f.height,L=((1-(B=E))*f.cameraToCenterDistance+B*(f._farZ+k))*_;var B;return{shouldRenderCutoff:E<1,uniformValues:{u_cutoff_params:[f._nearZ,f._farZ,(L-f._nearZ)/j,(L-k-f._nearZ)/j]}}},Za={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class WI{constructor(l,f){this.aabb=l,this.lastCascade=f}}class KI{add(l,f){const _=this.receivers[l.key];_!==void 0?(_.aabb.min[0]=Math.min(_.aabb.min[0],f.min[0]),_.aabb.min[1]=Math.min(_.aabb.min[1],f.min[1]),_.aabb.min[2]=Math.min(_.aabb.min[2],f.min[2]),_.aabb.max[0]=Math.max(_.aabb.max[0],f.max[0]),_.aabb.max[1]=Math.max(_.aabb.max[1],f.max[1]),_.aabb.max[2]=Math.max(_.aabb.max[2],f.max[2])):this.receivers[l.key]=new WI(f,null)}clear(){this.receivers={}}get(l){return this.receivers[l.key]}computeRequiredCascades(l,f,_){const E=i.d8.fromPoints(l.points);let j=0;for(const k in this.receivers){const L=this.receivers[k];if(!L||!E.intersectsAabb(L.aabb))continue;L.aabb.min=E.closestPoint(L.aabb.min),L.aabb.max=E.closestPoint(L.aabb.max);const B=L.aabb.getCorners();for(let G=0;G<_.length;G++){let Z=!0;for(const Q of B){const X=[Q[0]*f,Q[1]*f,Q[2]];if(i.af(X,X,_[G].matrix),X[0]<-1||X[0]>1||X[1]<-1||X[1]>1){Z=!1;break}}if(L.lastCascade=G,j=Math.max(j,G),Z)break}}return j+1}}class Xg{constructor(l){this.painter=l,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new KI,this._depthMode=new Er(l.context.gl.LEQUAL,Er.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,l.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),l.tp.registerParameter(Za,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),l.tp.registerParameter(Za,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),l.tp.registerParameter(Za,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),l.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const l of this._cascades)l.texture.destroy(),l.framebuffer.destroy();this._cascades=[]}updateShadowParameters(l,f){const _=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!f||!f.properties)return;const E=f.properties.get("shadow-intensity");if(!f.shadowsEnabled()||E<=0||(this._shadowLayerCount=_.style.order.reduce((le,de)=>{const xe=_.style._mergedLayers[de];return le+(xe.hasShadowPass()&&!xe.isHidden(l.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const j=_.context,k=Za.shadowMapResolution,L=Za.shadowMapResolution;if(this._cascades.length===0||Za.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let le=0;le<Za.cascadeCount;++le){const de=_._shadowMapDebug,xe=j.gl,ye=j.createFramebuffer(k,L,de,"texture"),Ee=new i.T(j,{width:k,height:L,data:null},xe.DEPTH_COMPONENT16);if(ye.depthAttachment.set(Ee.texture),de){const Ne=new i.T(j,{width:k,height:L,data:null},xe.RGBA8);ye.colorAttachment.set(Ne.texture)}this._cascades.push({framebuffer:ye,texture:Ee,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.cA,scale:0})}}this.shadowDirection=aA(f);let B=0;if(l.elevation){const le=l.elevation,de=[1e4,-1e4];le.visibleDemTiles.filter(xe=>xe.dem).forEach(xe=>{const ye=xe.dem.tree;de[0]=Math.min(de[0],ye.minimums[0]),de[1]=Math.max(de[1],ye.maximums[0])}),de[0]!==1e4&&(B=(de[1]-de[0])*le.exaggeration())}const G=1.5*l.cameraToCenterDistance,Z=3*G,Q=new Float64Array(16);for(let le=0;le<this._cascades.length;++le){const de=this._cascades[le];let xe=l.height/50,ye=1;Za.cascadeCount===1?ye=Z:le===0?ye=G:(xe=G,ye=Z);const[Ee,Ne]=oA(l,this.shadowDirection,xe,ye,Za.shadowMapResolution,B);de.scale=l.scale,de.matrix=Ee,de.boundingSphereRadius=Ne,i.bk(Q,de.matrix),de.frustum=i.cA.fromInvProjectionMatrix(Q,1,0,!0),de.far=ye}const X=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[X].far,this._cascades[X].far],this._uniformValues.u_shadow_intensity=E,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Za.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Za.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ka.ShadowMap0,this._uniformValues.u_shadowmap_1=Ka.ShadowMap0+1,this._groundShadowTiles=_.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const se=_.transform.elevation;for(const le of this._groundShadowTiles){let de={min:0,max:0};if(se){const xe=se.getMinMaxForTile(le);xe&&(de=xe)}this.addShadowReceiver(le.toUnwrapped(),de.min,de.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(l){this._enabled=l}drawShadowPass(l,f){if(!this.enabled)return;const _=this.painter,E=_.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(_.transform.getFrustum(0),_.transform.worldSize,this._cascades),E.viewport.set([0,0,Za.shadowMapResolution,Za.shadowMapResolution]);for(let j=0;j<this._numCascadesToRender;++j){_.currentShadowCascade=j,E.bindFramebuffer.set(this._cascades[j].framebuffer.framebuffer),E.clear({color:i.ao.white,depth:1});for(const k of l.order){const L=l._mergedLayers[k];if(!L.hasShadowPass()||L.isHidden(_.transform.zoom))continue;const B=l.getLayerSourceCache(L),G=B?f[B.id]:void 0;(L.type==="model"||G&&G.length)&&_.renderLayer(_,B,L,G)}}_.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const l=this.painter,f=l.style,_=l.context,E=_.gl,j=f.directionalLight,k=f.ambientLight;if(!j||!k)return;const L=[],B=dd(l,l.longestCutoffRange);B.shouldRenderCutoff&&L.push("RENDER_CUTOFF"),L.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&L.push("NORMAL_OFFSET");const G=Ac(f,j,k),Z=new Er(E.LEQUAL,Er.ReadOnly,l.depthRangeFor3D),Q=new tn({func:E.EQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.KEEP);for(const X of this._groundShadowTiles){const se=X.toUnwrapped(),le=l.isTileAffectedByFog(X),de=l.getOrCreateProgram("groundShadow",{defines:L,overrideFog:le});this.setupShadows(se,de),l.uploadCommonUniforms(_,de,se,null,B);const xe={u_matrix:l.transform.calculateProjMatrix(se),u_ground_shadow_factor:G};de.draw(l,E.TRIANGLES,Z,Q,vn.multiply,Xr.disabled,xe,"ground_shadow",l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments,null,l.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?vn.unblended:vn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(l){const f=this.painter.transform,_=f.calculatePosMatrix(l,f.worldSize);return i.aB(_,this._cascades[this.painter.currentShadowCascade].matrix,_),Float32Array.from(_)}calculateShadowPassMatrixFromMatrix(l){const f=i.by(l);return i.aB(f,this._cascades[this.painter.currentShadowCascade].matrix,l),f}setupShadows(l,f,_){if(!this.enabled)return;const E=this.painter.transform,j=this.painter.context,k=j.gl,L=this._uniformValues,B=new Float64Array(16),G=E.calculatePosMatrix(l,E.worldSize);for(let Z=0;Z<this._cascades.length;Z++)i.aB(B,this._cascades[Z].matrix,G),L[Z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(B),j.activeTexture.set(k.TEXTURE0+Ka.ShadowMap0+Z),this._cascades[Z].texture.bindExtraParam(k.LINEAR,k.LINEAR,k.CLAMP_TO_EDGE,k.CLAMP_TO_EDGE,k.GREATER);if(this.useNormalOffset=!!_,this.useNormalOffset){const Z=i.d6(l.canonical),Q=2/E.tileSize*i.al/Za.shadowMapResolution,X=Q*this._cascades[0].boundingSphereRadius,se=Q*this._cascades[this._cascades.length-1].boundingSphereRadius,le=(_==="vector-tile"?1:3)*function(de,xe,ye,Ee,Ne){const je=i.aA((de-22)/-22,0,1);return .125*(1-je)+4*je}(E.zoom);L.u_shadow_normal_offset=[Z,X*le,se*le],L.u_shadow_bias=[1e-4,.0012,.012]}else L.u_shadow_bias=[36e-5,.0012,.012];f.setShadowUniformValues(j,L)}setupShadowsFromMatrix(l,f,_=!1){if(!this.enabled)return;const E=this.painter.context,j=E.gl,k=this._uniformValues,L=new Float64Array(16);for(let B=0;B<Za.cascadeCount;B++)i.aB(L,this._cascades[B].matrix,l),k[B===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(L),E.activeTexture.set(j.TEXTURE0+Ka.ShadowMap0+B),this._cascades[B].texture.bindExtraParam(j.LINEAR,j.LINEAR,j.CLAMP_TO_EDGE,j.CLAMP_TO_EDGE,j.GREATER);if(this.useNormalOffset=_,_){const B=Za.normalOffset;k.u_shadow_normal_offset=[1,B,B],k.u_shadow_bias=[6e-5,.0012,.012]}else k.u_shadow_bias=[36e-5,.0012,.012];f.setShadowUniformValues(E,k)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(l,f,_,E){if(E[2]>=0)return{};const j=function(B,G,Z){const Q=Z/(1<<B.canonical.z);return new i.d8([B.canonical.x*Q+B.wrap*Z,B.canonical.y*Q+B.wrap*Z,0],[(B.canonical.x+1)*Q+B.wrap*Z,(B.canonical.y+1)*Q+B.wrap*Z,G])}(l,f,_).getCorners(),k=f/-E[2];E[0]<0?(i.d7(j[0],j[0],[E[0]*k,0,0]),i.d7(j[3],j[3],[E[0]*k,0,0])):E[0]>0&&(i.d7(j[1],j[1],[E[0]*k,0,0]),i.d7(j[2],j[2],[E[0]*k,0,0])),E[1]<0?(i.d7(j[0],j[0],[0,E[1]*k,0]),i.d7(j[1],j[1],[0,E[1]*k,0])):E[1]>0&&(i.d7(j[2],j[2],[0,E[1]*k,0]),i.d7(j[3],j[3],[0,E[1]*k,0]));const L={};return L.vertices=j,L.planes=[eh(j[1],j[0],j[4]),eh(j[2],j[1],j[5]),eh(j[3],j[2],j[6]),eh(j[0],j[3],j[7])],L}addShadowReceiver(l,f,_){this._receivers.add(l,i.d8.fromTileIdAndHeight(l,f,_))}getMaxCascadeForTile(l){const f=this._receivers.get(l);return f&&f.lastCascade?f.lastCascade:0}}function eh(v,l,f){const _=i.av([],f,l),E=i.av([],v,l),j=i.bH([],_,E),k=i.ag(j);return k===0?[0,0,1,0]:(i.c4(j,j,1/k),[j[0],j[1],j[2],-i.bI(j,l)])}function aA(v){const l=v.properties.get("direction"),f=i.d3(l.x,l.y,l.z);f[2]=i.aA(f[2],0,75);const _=i.d5([f[0],f[1],f[2]]);return i.d4(_.x,_.y,_.z)}function Ac(v,l,f){const _=l.properties.get("color-use-theme")==="none",E=l.properties.get("color"),j=l.properties.get("intensity"),k=l.properties.get("direction"),L=[k.x,k.y,k.z],B=f.properties.get("color-use-theme")==="none",G=f.properties.get("color"),Z=f.properties.get("intensity"),Q=Math.max(i.bI([0,0,1],L),0),X=[0,0,0];i.c4(X,G.toPremultipliedRenderColor(B?null:v.getLut(l.scope)).toArray01Linear().slice(0,3),Z);const se=[0,0,0];return i.c4(se,E.toPremultipliedRenderColor(_?null:v.getLut(f.scope)).toArray01Linear().slice(0,3),Q*j),i.da([X[0]>0?X[0]/(X[0]+se[0]):0,X[1]>0?X[1]/(X[1]+se[1]):0,X[2]>0?X[2]/(X[2]+se[2]):0])}function oA(v,l,f,_,E,j){const k=v.zoom,L=v.scale,B=v.worldSize,G=1/B,Z=v.aspect,Q=Math.sqrt(1+Z*Z)*Math.tan(.5*v.fovX),X=Q*Q,se=_-f,le=_+f;let de,xe;X>se/le?(de=_,xe=_*Q):(de=.5*le*(1+X),xe=.5*Math.sqrt(se*se+2*(_*_+f*f)*X+le*le*X*X));const ye=v.projection.pixelsPerMeter(v.center.lat,B),Ee=v._camera.getCameraToWorldMercator(),Ne=[0,0,-de*G];i.af(Ne,Ne,Ee);let je=xe*G;const Ve=v._edgeInsets;if(!(Ve.left===0&&Ve.top===0&&Ve.right===0&&Ve.bottom===0||Ve.left===Ve.right&&Ve.top===Ve.bottom)){const Bt=v._camera.getWorldToCamera(v.worldSize,v.projection.zAxisUnit==="meters"?ye:1),rr=v._camera.getCameraToClipPerspective(v._fov,v.width/v.height,f,_);rr[8]=2*-v.centerOffset.x/v.width,rr[9]=2*v.centerOffset.y/v.height;const xr=new Float64Array(16);i.cO(xr,rr,Bt);const Wt=new Float64Array(16);i.bk(Wt,xr);const Jt=i.cA.fromInvProjectionMatrix(Wt,B,k,!0);for(const wr of Jt.points){const pr=((Ie=wr)[0]/=L,Ie[1]/=L,Ie[2]=i.ce(Ie[2],v._center.lat),Ie);je=Math.max(je,i.c5(i.d9([],Ne,pr)))}}var Ie;je*=E/(E-1);const Ge=Math.acos(l[2]),$e=Math.atan2(-l[0],-l[1]),Le=new h_;Le.position=Ne,Le.setPitchBearing(Ge,$e);const Ke=Le.getWorldToCamera(B,ye),dt=je*B,at=Math.min(v._mercatorZfromZoom(17)*B*-2,-2*dt),Et=Le.getCameraToClipOrthographic(-dt,dt,-dt,dt,at,(dt+j*ye)/l[2]),yt=new Float64Array(16);i.aB(yt,Et,Ke);const Nt=i.d4(Math.floor(1e6*Ne[0])/1e6*B,Math.floor(1e6*Ne[1])/1e6*B,0),Xt=.5*E,mt=[0,0,0];i.af(mt,Nt,yt),i.c4(mt,mt,Xt);const tt=[Math.floor(mt[0]),Math.floor(mt[1]),Math.floor(mt[2])],It=[0,0,0];i.av(It,mt,tt),i.c4(It,It,-1/Xt);const vt=new Float64Array(16);return i.bz(vt),i.bq(vt,vt,It),i.aB(yt,vt,yt),[yt,dt]}class f_ extends i.E{constructor(l){super(),this.requestManager=l,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(l,f){return i.db(this.requestManager.transformRequest(f,i.R.Model).url).then(_=>{if(!_)return;const E=i.dc(_),j=new i.dd(l,f,void 0,void 0,E);return j.computeBoundsAndApplyParent(),j}).catch(_=>{if(_&&_.status===404)return null;this.fire(new i.y(new Error(`Could not load model ${l} from ${f}: ${_.message}`)))})}load(l,f,_={forceReload:!1}){this.models[f]||(this.models[f]={});const E=Object.keys(l),j=[],k=[];for(const L of E){const B=l[L];this.hasURLBeenRequested(B)&&!_.forceReload||(this.modelByURL[B]={modelId:L,scope:f},j.push(this.loadModel(L,B)),k.push(L)),this.models[f][L]||(this.models[f][L]={model:null,numReferences:1})}this.numModelsLoading[f]=(this.numModelsLoading[f]||0)+k.length,Promise.allSettled(j).then(L=>{for(let B=0;B<L.length;B++){const{status:G}=L[B];if(G==="rejected")continue;const{value:Z}=L[B];this.models[f][k[B]]||(this.models[f][k[B]]={model:null,numReferences:1}),this.models[f][k[B]].model=Z}this.numModelsLoading[f]-=k.length,this.fire(new i.z("data",{dataType:"style"}))}).catch(L=>{this.fire(new i.y(new Error(`Could not load models: ${L.message}`)))})}isLoaded(){for(const l in this.numModelsLoading)if(this.numModelsLoading[l]>0)return!1;return!0}hasModel(l,f,_={exactIdMatch:!1}){return!!(_.exactIdMatch?this.getModel(l,f):this.getModelByURL(this.modelUris[f][l]))}getModel(l,f){return this.models[f]||(this.models[f]={}),this.models[f][l]?this.models[f][l].model:void 0}getModelByURL(l){if(!l)return null;const f=this.modelByURL[l];return f?this.models[f.scope][f.modelId].model:null}hasModelBeenAdded(l,f){return this.models[f]&&this.models[f][l]!==void 0}getModelURIs(l){return this.modelUris[l]||{}}addModel(l,f,_){this.models[_]||(this.models[_]={}),this.modelUris[_]||(this.modelUris[_]={});const E=this.requestManager.normalizeModelURL(f);if((this.hasModel(l,_,{exactIdMatch:!0})||this.hasModelBeenAdded(l,_))&&this.modelUris[_][l]===E)this.models[_][l].numReferences++;else if(this.hasURLBeenRequested(E)){const{scope:j,modelId:k}=this.modelByURL[E];this.models[j][k].numReferences++}else this.modelUris[_][l]=E,this.load({[l]:this.modelUris[_][l]},_)}addModelURLs(l,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={});const _=this.modelUris[f];for(const E in l)_[E]=this.requestManager.normalizeModelURL(l[E])}reloadModels(l){this.load(this.modelUris[l],l,{forceReload:!0})}addModelsFromBucket(l,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={});const _={};for(const E of l)this.hasModel(E,f,{exactIdMatch:!0})||this.hasURLBeenRequested(E)?this.models[f][E].numReferences++:this.modelUris[f][E]&&!this.hasURLBeenRequested(E)?_[E]=this.modelUris[f][E]:!this.hasURLBeenRequested(E)&&i.de(E,!1)&&(this.modelUris[f][E]=this.requestManager.normalizeModelURL(E),_[E]=this.modelUris[f][E]);this.load(_,f)}hasURLBeenRequested(l){return this.modelByURL[l]!==void 0}removeModel(l,f,_=!1,E=!1){if(this.models[f]&&this.models[f][l]&&(this.models[f][l].numReferences--,this.models[f][l].numReferences===0||E)){const j=this.modelUris[f][l];_||delete this.modelUris[f][l],delete this.modelByURL[j];const k=this.models[f][l].model;if(!k)return;delete this.models[f][l],k.destroy()}}destroy(){for(const l of Object.keys(this.models))for(const f of Object.keys(this.models[l])){const _=this.models[l][f].model;delete this.models[l][f],_&&_.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(l){return this.models[l]||(this.models[l]={}),Object.keys(this.models[l])}upload(l,f){this.models[f]||(this.models[f]={});for(const _ in this.models[f])this.models[f][_].model&&this.models[f][_].model.upload(l.context)}}const Yg=i.a6.colorTheme,th=new i.a9({data:new i.aa(Yg.data)});function ZI(v){if(!v.metadata||!v.metadata.content_area)return;const l=i.o.devicePixelRatio,{left:f,top:_,width:E,height:j}=v.metadata.content_area,k=f*l,L=_*l;return[k,L,k+E*l,L+j*l]}function lA(v){if(v)return v.map(([l,f])=>[l*i.o.devicePixelRatio,f*i.o.devicePixelRatio])}class XI{constructor(l,f,_){this.id=l,this.scope=f,this.sourceCache=_,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(l){this.missingRequests.has(l.name)||this.pendingRequests.has(l.name)||this.pendingRequests.add(l.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const l=new Map;if(!this.sourceCache.loaded())return l;const f=this.sourceCache.getVisibleCoordinates();if(f.length===0)return l;const _=this.sourceCache.getSource();if(!(_ instanceof ba))return l;const E=f.map(k=>this.sourceCache.getTile(k)),j=_.getImages(E,Array.from(this.pendingRequests));for(const[k,L]of j)l.set(i.I.from({name:k,iconsetId:this.id}),L),this.pendingRequests.delete(k);for(const k of this.pendingRequests)this.missingRequests.add(k);return this.pendingRequests.clear(),l}}const rh=(v,l)=>fe(v,l&&l.filter(f=>f.identifier!=="source.canvas")),YI=i.aH(si,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),zw=i.aH(si,["setCenter","setZoom","setBearing","setPitch"]),p_=new Set(["background","sky","slot","custom"]),Bw={version:8,layers:[],sources:{}},$w={duration:300,delay:0};class Cc extends i.E{constructor(l,f={}){super(),this.map=l,this.scope=f.scope||"",this.globalId=null,this.fragments=[],this.importDepth=f.importDepth||0,this.importsCache=f.importsCache||new Map,this.resolvedImports=f.resolvedImports||new Set,this.transition=Object.assign({},$w),this._buildingIndex=new Ow(this),this.crossTileSymbolIndex=new ud,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=f.styleChanges||new nr,this.dispatcher=f.dispatcher?f.dispatcher:new i.D(i.dg(),this),f.imageManager?this.imageManager=f.imageManager:(this.imageManager=new Dr(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=f.glyphManager?f.glyphManager:new i.dh(l._requestManager,f.localFontFamily?i.di.all:f.localIdeographFontFamily?i.di.ideographs:i.di.none,f.localFontFamily||f.localIdeographFontFamily),f.modelManager?this.modelManager=f.modelManager:(this.modelManager=new f_(l._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=f.configOptions?f.configOptions:new Map,this._configDependentLayers=f.configDependentLayers?f.configDependentLayers:new Set,this._indoorDependentLayers=f.indoorDependentLayers?f.indoorDependentLayers:new Set,this._config=f.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:f.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=f.initialConfig,this.dispatcher.broadcast("setReferrer",i.dj());const _=this;this._rtlTextPluginCallback=Cc.registerForPluginStateChange(E=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:E.pluginStatus,pluginURL:E.pluginURL},(j,k)=>{if(i.dk(j),k&&k.every(L=>L))for(const L in _._sourceCaches){const B=_._sourceCaches[L],G=B.getSource().type;G!=="vector"&&G!=="geojson"||B.reload()}})}),this.on("data",E=>{if(E.dataType!=="source"||E.sourceDataType!=="metadata")return;const j=this.getOwnSource(E.sourceId);if(j&&j.vectorLayerIds)for(const k in this._layers){const L=this._layers[k];L.source===j.id&&this._validateLayer(L)}})}load(l){return l?(typeof l=="string"?this.loadURL(l):this.loadJSON(l),this):this}_getGlobalId(l){if(!l)return null;if(typeof l=="string"){if(i.h(l))return l;const f=i.dl(l);if(!f.startsWith("http"))try{return new URL(f,location.href).toString()}catch{return f}return f}return`json://${i.dm(JSON.stringify(l))}`}_diffStyle(l,f,_){this.globalId=this._getGlobalId(l);const E=(j,k)=>{try{k(null,this.setState(j,_))}catch(L){k(L,!1)}};if(typeof l=="string"){const j=this.map._requestManager.normalizeStyleURL(l),k=this.map._requestManager.transformRequest(j,i.R.Style);i.m(k,(L,B)=>{L?this.fire(new i.y(L)):B&&E(B,f)})}else typeof l=="object"&&E(l,f)}loadURL(l,f={}){this.fire(new i.z("dataloading",{dataType:"style"}));const _=typeof f.validate=="boolean"?f.validate:!i.h(l);this.globalId=this._getGlobalId(l),l=this.map._requestManager.normalizeStyleURL(l,f.accessToken),this.resolvedImports.add(l);const E=this.importsCache.get(l);if(E)return this._load(E,_);const j=this.map._requestManager.transformRequest(l,i.R.Style);this._request=i.m(j,(k,L)=>{if(this._request=null,k)this.fire(new i.y(k));else if(L)return this.importsCache.set(l,L),this._load(L,_)})}loadJSON(l,f={}){this.fire(new i.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(l),this._request=i.o.frame(()=>{this._request=null,this._load(l,f.validate!==!1)})}loadEmpty(){this.fire(new i.z("dataloading",{dataType:"style"})),this._load(Bw,!1)}_loadImports(l,f,_){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const E=[];for(const j of l){const k=this._createFragmentStyle(j),L=new Promise(Z=>{k.once("style.import.load",Z),k.once("error",Z)}).then(()=>this.mergeAll());if(E.push(L),this.resolvedImports.has(j.url)){k.loadEmpty();continue}const B=j.data||this.importsCache.get(j.url);B?(k.loadJSON(B,{validate:f}),this._isInternalStyle(B)&&(k.globalId=null)):j.url?k.loadURL(j.url,{validate:f}):k.loadEmpty();const G={style:k,id:j.id,config:j.config};if(_){const Z=this.fragments.findIndex(({id:Q})=>Q===_);this.fragments=this.fragments.slice(0,Z).concat(G).concat(this.fragments.slice(Z))}else this.fragments.push(G)}return Promise.allSettled(E)}getImportGlobalIds(l=this,f=new Set){for(const _ of l.fragments)_.style.globalId&&f.add(_.style.globalId),this.getImportGlobalIds(_.style,f);return[...f.values()]}_createFragmentStyle(l){const f=this.scope?i.B(l.id,this.scope):l.id;let _;const E=this._initialConfig&&this._initialConfig[f];(l.config||E)&&(_=Object.assign({},l.config,E));const j=new Cc(this.map,{scope:f,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:_,configOptions:this.options,colorThemeOverride:l["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return j.setEventedParent(this.map,{style:j}),j}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(l){return this.isRootStyle()&&(l.fragment||!!l.schema&&l.fragment!==!1)}_load(l,f){if(this._isInternalStyle(l)){const j=Object.assign({},Bw,{imports:[{id:"basemap",data:l,url:""}]},l.center?{center:l.center}:{},l.bearing?{bearing:l.bearing}:{},l.pitch?{pitch:l.pitch}:{},l.zoom?{zoom:l.zoom}:{},l.light?{light:l.light}:{});return this._importedAsBasemap=!0,void this._load(j,f)}if(this.updateConfig(this._config,l.schema),f&&rh(this,so(l)))return;this._loaded=!0,this.stylesheet=i.dn(l);const _=()=>{for(const B in l.sources)this.addSource(B,l.sources[B],{validate:!1,isInitialLoad:!0});if(l.iconsets)for(const B in l.iconsets)this.addIconset(B,l.iconsets[B]);l.sprite?this._loadIconset(l.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&l.glyphs&&this.glyphManager.setURL(l.glyphs);const j=_p(this.stylesheet.layers);if(this._order=j.map(B=>B.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const B=this.stylesheet.lights[0];this.light=new Qe(B.properties,B.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Qe(this.stylesheet.light)),this._layers={};for(const B of j){const G=i.dt(B,this.scope,this._styleColorTheme.lut,this.options);G.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(G.fqid),G.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(G.fqid),this._hasAppearances=this._hasAppearances||G.getAppearances().length!==0,G.setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G;const Z=this.getOwnLayerSourceCache(G),Q=!!this.directionalLight&&this.directionalLight.shadowsEnabled();Z&&G.canCastShadows()&&Q&&(Z.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const k=this.stylesheet.terrain;k&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(k,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.z("data",{dataType:"style"}));const L=this.isRootStyle();l.imports?this._loadImports(l.imports,f).then(()=>{this._reloadImports(),this.fire(new i.z(L?"style.load":"style.import.load"))}).catch(B=>{this.fire(new i.y(new Error("Failed to load imports",B))),this.fire(new i.z(L?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.z(L?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const E=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(E){const j=this._evaluateColorThemeData(E);this._loadColorTheme(j).then(()=>{_()}).catch(k=>{i.w(`Couldn't load color theme from the stylesheet: ${k}`),_()})}else this._styleColorTheme.lut=null,_()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances}mergeAll(){let l,f,_,E,j,k,L,B,G,Z;const Q={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(X=>{if(X.stylesheet){if(X.light!=null&&(l=X.light),X.stylesheet.lights)for(const se of X.stylesheet.lights)se.type==="ambient"&&X.ambientLight!=null&&(f=X.ambientLight),se.type==="directional"&&X.directionalLight!=null&&(_=X.directionalLight);E=this._prioritizeTerrain(E,X.terrain,X.stylesheet.terrain),X.stylesheet.fog&&X.fog!=null&&(j=X.fog),X.stylesheet.snow&&X.snow!=null&&(k=X.snow),X.stylesheet.rain&&X.rain!=null&&(L=X.rain),X.stylesheet.camera!=null&&(Z=X.stylesheet.camera),X.stylesheet.projection!=null&&(B=X.stylesheet.projection),X.stylesheet.transition!=null&&(G=X.stylesheet.transition),Q[X.scope]=X._styleColorTheme}}),this.light=l,this.ambientLight=f,this.directionalLight=_,this.fog=j,this.snow=k,this.rain=L,this._styleColorThemeForScope=Q,E===null?delete this.terrain:this.terrain=E,this.camera=Z||{"camera-projection":"perspective"},this.projection=B||{name:"mercator"},this.transition=Object.assign({},$w,G),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(l){const f=_=>{for(const E of _.fragments)f(E.style);l(_)};f(this)}_prioritizeTerrain(l,f,_){const E=l&&l.drapeRenderMode===0;return _===null?f&&f.drapeRenderMode===0?f:E?l:null:f!=null&&(!l||E||f&&f.drapeRenderMode===1)?f:l}mergeTerrain(){let l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(f=>{l=this._prioritizeTerrain(l,f.terrain,f.stylesheet.terrain)}),l===null?delete this.terrain:this.terrain=l}mergeProjection(){let l;this.forEachFragmentStyle(f=>{f.stylesheet.projection!=null&&(l=f.stylesheet.projection)}),this.projection=l||{name:"mercator"}}mergeSources(){const l={},f={},_={};this.forEachFragmentStyle(E=>{for(const j in E._sourceCaches){const k=i.B(j,E.scope);l[k]=E._sourceCaches[j]}for(const j in E._otherSourceCaches){const k=i.B(j,E.scope);f[k]=E._otherSourceCaches[j]}for(const j in E._symbolSourceCaches){const k=i.B(j,E.scope);_[k]=E._symbolSourceCaches[j]}}),this._mergedSourceCaches=l,this._mergedOtherSourceCaches=f,this._mergedSymbolSourceCaches=_}mergeIndoor(){this.forEachFragmentStyle(l=>{if(l.stylesheet&&l.stylesheet.indoor)for(const f of Object.values(l.stylesheet.indoor)){const _=f,E=i.B(_.sourceId,l.scope);this._mergedIndoor[E]=new Set(_.sourceLayers||[])}})}mergeLayers(){const l={},f=[],_={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(k=>{for(const L of k._order){const B=k._layers[L];if(B.type==="slot"){const G=i.dp(L);if(l[G])continue;l[G]=[]}B.slot&&l[B.slot]?l[B.slot].push(B):f.push(B)}}),this._mergedOrder=[];let E=-1;const j=(k=[])=>{for(const L of k)if(L.type==="slot"){const B=i.dp(L.id);l[B]&&j(l[B]),this._mergedSlots.push(B)}else{const B=i.B(L.id,L.scope);this._mergedOrder.push(B),_[B]=L,L.is3D(!!this.terrain)&&(this._has3DLayers=!0,E=this._mergedOrder.length-1),L.type==="circle"&&(this._hasCircleLayers=!0),L.type==="symbol"&&(this._hasSymbolLayers=!0),L.type==="clip"&&(this._clipLayerPresent=!0)}};if(j(f),this._has3DLayers){const k={};for(let L=0;L<this._mergedOrder.length;++L){const B=this._mergedOrder[L];k[B]=L===E?1:L<E?_[B].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((L,B)=>k[L]-k[B])}this._mergedLayers=_,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(l){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,l),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(l){return l.data?function(f,_,E,j){const k=Object.assign({},_);for(const B of Object.keys(Yg))k[B]===void 0&&(k[B]=Yg[B].default);const L=new i.a8(th,f,new Map(E));return L.setTransitionOrValue(k,E),L.untransitioned().possiblyEvaluate(new i.ac(0,{worldview:void 0}))}(this.scope,l,this.options).get("data"):null}_loadColorTheme(l){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const f=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((_,E)=>{const j="data:image/png;base64,";if(!l||l.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void _();let k=l;k.startsWith(j)||(k=j+k);const L=i.I.from("mapbox-reserved-lut"),B=new Image;B.src=k,B.onerror=()=>{this._styleColorTheme.lutLoading=!1,E(new Error("Failed to load image data"))},B.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==f)return void _();this._styleColorTheme.lutLoading=!1;const{width:G,height:Z,data:Q}=i.o.getImageData(B);if(Z>32)return void E(new Error("The height of the image must be less than or equal to 32 pixels."));if(G!==Z*Z)return void E(new Error("The width of the image must be equal to the height squared."));this.getImage(L)&&this.removeImage(L),this.addImage(L,{data:new i.q({width:G,height:Z},Q),pixelRatio:1,sdf:!1,usvg:!1,version:0});const X=this.imageManager.getImage(L,this.scope);X?(this._styleColorTheme.lut={image:X.data,data:l},_()):E(new Error("Missing LUT image."))}})}getLut(l){const f=this._styleColorThemeForScope[l];return f?f.lut:null}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(l){this._spriteRequest=function(f,_,E){let j,k,L;const B=i.o.devicePixelRatio>1?"@2x":"";let G=i.m(_.transformRequest(_.normalizeSpriteURL(f,B,".json"),i.R.SpriteJSON),(X,se)=>{G=null,L||(L=X,j=se,Q())}),Z=i.n(_.transformRequest(_.normalizeSpriteURL(f,B,".png"),i.R.SpriteImage),(X,se)=>{Z=null,L||(L=X,k=se,Q())});function Q(){if(L)E(L);else if(j&&k){const X=i.o.getImageData(k),se={};for(const le in j){const{width:de,height:xe,x:ye,y:Ee,sdf:Ne,pixelRatio:je,stretchX:Ve,stretchY:Ie,content:Ge}=j[le],$e=new i.q({width:de,height:xe});i.q.copy(X,$e,{x:ye,y:Ee},{x:0,y:0},{width:de,height:xe},null),se[le]={data:$e,pixelRatio:je!==void 0?je:1,sdf:Ne!==void 0&&Ne,stretchX:Ve,stretchY:Ie,content:Ge,usvg:!1,version:0}}E(null,se)}}return{cancel(){G&&(G.cancel(),G=null),Z&&(Z.cancel(),Z=null)}}}(l,this.map._requestManager,(f,_)=>{if(this._spriteRequest=null,f)this.fire(new i.y(f));else if(_){const E=new Map;for(const j in _)E.set(i.I.from(j),_[j]);this.addImages(E)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))})}addIconset(l,f){if(f.type==="sprite")return void this._loadSprite(f.url);const _=this.getOwnSourceCache(f.source);if(!_)return void this.fire(new i.y(new Error(`Source "${f.source}" as specified by iconset "${l}" does not exist and cannot be used as an iconset source`)));const E=_.getSource();if(E.type!=="raster-array")return void this.fire(new i.y(new Error(`Source "${f.source}" as specified by iconset "${l}" is not a "raster-array" source and cannot be used as an iconset source`)));E.partial=!1;const j=new XI(l,this.scope,_);this.imageManager.addImageProvider(j,this.scope)}removeIconset(l){this.imageManager.removeImageProvider(l,this.scope)}_loadIconset(l){if(!i.h(l)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(l);const f=this.map._spriteFormat==="auto";var _,E;this._spriteRequest=(E=(j,k)=>{if(this._spriteRequest=null,j)f?this._loadSprite(l):this.fire(new i.y(j));else if(k){const L=new Map;for(const B in k)L.set(i.I.from(B),k[B]);this.addImages(L)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))},i.bt((_=this.map._requestManager).transformRequest(_.normalizeIconsetURL(l),i.R.Iconset),(j,k)=>{if(j)return void E(j);const L={},B=i.df(new i.bs(k));for(const G of B.icons){const Z={version:1,pixelRatio:i.o.devicePixelRatio,content:ZI(G),stretchX:G.metadata?lA(G.metadata.stretch_x_areas):void 0,stretchY:G.metadata?lA(G.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:G};L[G.name]=Z}E(null,L)}))}_validateLayer(l){const f=this.getOwnSource(l.source);if(!f)return;const _=l.sourceLayer;_&&(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(_)===-1)&&this.fire(new i.y(new Error(`Source layer "${_}" does not exist on source "${f.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:l}of this.fragments)if(!l.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((l,f)=>{const _=this.fragments[f];return _&&_.style&&(l.data=_.style.serialize()),l})}_serializeSources(){const l={};for(const f in this._sourceCaches){const _=this._sourceCaches[f].getSource();l[_.id]||(l[_.id]=_.serialize())}return l}_serializeLayers(l){const f=[];for(const _ of l){const E=this._layers[_];E&&E.type!=="custom"&&f.push(E.serialize())}return f}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(l){return l?this.order:this._mergedOrder}isLayerDraped(l){return!!this.terrain&&l.isDraped(this.getLayerSourceCache(l))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(l){const f=this.getOwnLayer(l);if(f)return f;this.fire(new i.y(new Error(`The layer '${l}' does not exist in the map's style.`)))}_checkSource(l){const f=this.getOwnSource(l);if(f)return f;this.fire(new i.y(new Error(`The source '${l}' does not exist in the map's style.`)))}precompilePrograms(l,f){const _=this.map.painter;if(_)for(let E=l.minzoom||0;E<(l.maxzoom||25.5);E++){const j=l.getProgramIds();if(j)for(const k of j){const L=l.getDefaultProgramParams(k,f.zoom,this._styleColorTheme.lut);L&&(_.style=this,this.fog&&(_._fogVisible=!0,L.overrideFog=!0,_.getOrCreateProgram(k,L)),_._fogVisible=!1,L.overrideFog=!1,_.getOrCreateProgram(k,L),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(L.overrideRtt=!0,_.getOrCreateProgram(k,L)))}}}update(l){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(l),this.directionalLight&&this.directionalLight.recalculate(l);const f=this.calculateLightsBrightness();l.brightness=f||0,f!==this._brightness&&(this._brightness=f,this.dispatcher.broadcast("setBrightness",f)),l.worldview!==this._worldview&&(this._worldview=l.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const _=this._changes.isDirty();let E=!1;if(this._changes.isDirty()){const L=this._changes.getLayerUpdatesByScope();for(const B in L){const{updatedIds:G,removedIds:Z}=L[B];(G||Z)&&(this._updateWorkerLayers(B,G,Z),E=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(l),this.light&&this.light.updateTransitions(l),this.ambientLight&&this.ambientLight.updateTransitions(l),this.directionalLight&&this.directionalLight.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this.snow&&this.snow.updateTransitions(l),this.rain&&this.rain.updateTransitions(l),this._changes.reset()}const j={};for(const L in this._mergedSourceCaches){const B=this._mergedSourceCaches[L];j[L]=B.used,B.used=!1,B.tileCoverLift=0}for(const L of this._mergedOrder){const B=this._mergedLayers[L];if(B.recalculate(l,this._availableImages),!B.isHidden(l.zoom)){const G=this.getLayerSourceCache(B);G&&(G.used=!0,G.tileCoverLift=Math.max(G.tileCoverLift,B.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(B,l)}):this.precompilePrograms(B,l))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&E&&this.mergeLayers();const k=this.imageManager.getPendingImageProviders();for(const L of k)L.sourceCache.used=!0;for(const L in j){const B=this._mergedSourceCaches[L];j[L]!==B.used&&B.getSource().fire(new i.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:B.getSource().id}))}this.light&&this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.snow&&this.snow.recalculate(l),this.rain&&this.rain.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),_&&this.fire(new i.z("data",{dataType:"style"}))}updateImageProviders(){const l=this.imageManager.getPendingImageProviders();for(const f of l){const _=f.resolvePendingRequests(),E=this.getFragmentStyle(f.scope);E&&E.addImages(_)}}_updateTilesForChangedImages(){const l={};for(const f in this._mergedSourceCaches){const _=this._mergedSourceCaches[f].getSource().scope;l[_]=l[_]||this._changes.getUpdatedImages(_),l[_].length!==0&&this._mergedSourceCaches[f].reloadTilesForDependencies(["icons","patterns"],l[_])}for(const f in l)this._changes.resetUpdatedImages(f)}_updateWorkerLayers(l,f,_){const E=this.getFragmentStyle(l);E&&this.dispatcher.broadcast("updateLayers",{layers:f?E._serializeLayers(f):[],scope:l,removedIds:_||[],options:E.options})}setState(l,f){if(this._checkLoaded(),rh(this,so(l)))return!1;(l=i.dn(l)).layers=_p(l.layers);const _=function(k,L){if(!k)return[{command:si.setStyle,args:[L]}];let B=[];try{if(!i.bx(k.version,L.version))return[{command:si.setStyle,args:[L]}];if(i.bx(k.center,L.center)||B.push({command:si.setCenter,args:[L.center]}),i.bx(k.zoom,L.zoom)||B.push({command:si.setZoom,args:[L.zoom]}),i.bx(k.bearing,L.bearing)||B.push({command:si.setBearing,args:[L.bearing]}),i.bx(k.pitch,L.pitch)||B.push({command:si.setPitch,args:[L.pitch]}),i.bx(k.sprite,L.sprite)||B.push({command:si.setSprite,args:[L.sprite]}),i.bx(k.glyphs,L.glyphs)||B.push({command:si.setGlyphs,args:[L.glyphs]}),i.bx(k.imports,L.imports)||function(se=[],le=[],de){le=le||[];const xe=(se=se||[]).map(Fg),ye=le.map(Fg),Ee=se.reduce(zg,{}),Ne=le.reduce(zg,{}),je=xe.slice();let Ve,Ie,Ge,$e;for(Ve=0,Ie=0;Ve<xe.length;Ve++)Ge=xe[Ve],Ne.hasOwnProperty(Ge)?Ie++:(de.push({command:si.removeImport,args:[Ge]}),je.splice(je.indexOf(Ge,Ie),1));for(Ve=0,Ie=0;Ve<ye.length;Ve++)Ge=ye[ye.length-1-Ve],je[je.length-1-Ve]!==Ge&&(Ee.hasOwnProperty(Ge)?(de.push({command:si.removeImport,args:[Ge]}),je.splice(je.lastIndexOf(Ge,je.length-Ie),1)):Ie++,$e=je[je.length-Ve],de.push({command:si.addImport,args:[Ne[Ge],$e]}),je.splice(je.length-Ve,0,Ge));for(const Le of le){const Ke=Ee[Le.id];Ke&&(delete Ke.data,i.bx(Ke,Le)||de.push({command:si.updateImport,args:[Le.id,Le]}))}}(k.imports,L.imports,B),i.bx(k.transition,L.transition)||B.push({command:si.setTransition,args:[L.transition]}),i.bx(k.light,L.light)||B.push({command:si.setLight,args:[L.light]}),i.bx(k.fog,L.fog)||B.push({command:si.setFog,args:[L.fog]}),i.bx(k.snow,L.snow)||B.push({command:si.setSnow,args:[L.snow]}),i.bx(k.rain,L.rain)||B.push({command:si.setRain,args:[L.rain]}),i.bx(k.projection,L.projection)||B.push({command:si.setProjection,args:[L.projection]}),i.bx(k.lights,L.lights)||B.push({command:si.setLights,args:[L.lights]}),i.bx(k.camera,L.camera)||B.push({command:si.setCamera,args:[L.camera]}),i.bx(k.iconsets,L.iconsets)||function(se,le,de){let xe;for(xe in le=le||{},se=se||{})se.hasOwnProperty(xe)&&(le.hasOwnProperty(xe)||de.push({command:si.removeIconset,args:[xe]}));for(xe in le){if(!le.hasOwnProperty(xe))continue;const ye=le[xe];se.hasOwnProperty(xe)?i.bx(se[xe],ye)||(de.push({command:si.removeIconset,args:[xe]}),de.push({command:si.addIconset,args:[xe,ye]})):de.push({command:si.addIconset,args:[xe,ye]})}}(k.iconsets,L.iconsets,B),!i.bx(k["color-theme"],L["color-theme"]))return[{command:si.setStyle,args:[L]}];const G={},Z=[];(function(se,le,de,xe){let ye;for(ye in le=le||{},se=se||{})se.hasOwnProperty(ye)&&(le.hasOwnProperty(ye)||Mg(ye,de,xe));for(ye in le){if(!le.hasOwnProperty(ye))continue;const Ee=le[ye];se.hasOwnProperty(ye)?i.bx(se[ye],Ee)||(se[ye].type==="geojson"&&Ee.type==="geojson"&&Nw(se,le,ye)?de.push({command:si.setGeoJSONSourceData,args:[ye,Ee.data]}):Dg(ye,le,de,xe)):kw(ye,le,de)}})(k.sources,L.sources,Z,G);const Q=[];k.layers&&k.layers.forEach(se=>{se.source&&G[se.source]?B.push({command:si.removeLayer,args:[se.id]}):Q.push(se)});let X=k.terrain;X&&G[X.source]&&(B.push({command:si.setTerrain,args:[void 0]}),X=void 0),B=B.concat(Z),i.bx(X,L.terrain)||B.push({command:si.setTerrain,args:[L.terrain]}),function(se,le,de){le=le||[];const xe=(se=se||[]).map(Fg),ye=le.map(Fg),Ee=se.reduce(zg,{}),Ne=le.reduce(zg,{}),je=xe.slice(),Ve=Object.create(null);let Ie,Ge,$e,Le,Ke,dt,at;for(Ie=0,Ge=0;Ie<xe.length;Ie++)$e=xe[Ie],Ne.hasOwnProperty($e)?Ge++:(de.push({command:si.removeLayer,args:[$e]}),je.splice(je.indexOf($e,Ge),1));for(Ie=0,Ge=0;Ie<ye.length;Ie++)$e=ye[ye.length-1-Ie],je[je.length-1-Ie]!==$e&&(Ee.hasOwnProperty($e)?(de.push({command:si.removeLayer,args:[$e]}),je.splice(je.lastIndexOf($e,je.length-Ge),1)):Ge++,dt=je[je.length-Ie],de.push({command:si.addLayer,args:[Ne[$e],dt]}),je.splice(je.length-Ie,0,$e),Ve[$e]=!0);for(Ie=0;Ie<ye.length;Ie++)if($e=ye[Ie],Le=Ee[$e],Ke=Ne[$e],!Ve[$e]&&!i.bx(Le,Ke))if(i.bx(Le.source,Ke.source)&&i.bx(Le["source-layer"],Ke["source-layer"])&&i.bx(Le.type,Ke.type)){for(at in Lg(Le.layout,Ke.layout,de,$e,null,si.setLayoutProperty),Lg(Le.paint,Ke.paint,de,$e,null,si.setPaintProperty),i.bx(Le.slot,Ke.slot)||de.push({command:si.setSlot,args:[$e,Ke.slot]}),i.bx(Le.filter,Ke.filter)||de.push({command:si.setFilter,args:[$e,Ke.filter]}),i.bx(Le.minzoom,Ke.minzoom)&&i.bx(Le.maxzoom,Ke.maxzoom)||de.push({command:si.setLayerZoomRange,args:[$e,Ke.minzoom,Ke.maxzoom]}),Le)Le.hasOwnProperty(at)&&at!=="layout"&&at!=="paint"&&at!=="filter"&&at!=="metadata"&&at!=="minzoom"&&at!=="maxzoom"&&at!=="slot"&&(at.indexOf("paint.")===0?Lg(Le[at],Ke[at],de,$e,at.slice(6),si.setPaintProperty):i.bx(Le[at],Ke[at])||de.push({command:si.setLayerProperty,args:[$e,at,Ke[at]]}));for(at in Ke)Ke.hasOwnProperty(at)&&!Le.hasOwnProperty(at)&&at!=="layout"&&at!=="paint"&&at!=="filter"&&at!=="metadata"&&at!=="minzoom"&&at!=="maxzoom"&&at!=="slot"&&(at.indexOf("paint.")===0?Lg(Le[at],Ke[at],de,$e,at.slice(6),si.setPaintProperty):i.bx(Le[at],Ke[at])||de.push({command:si.setLayerProperty,args:[$e,at,Ke[at]]}))}else de.push({command:si.removeLayer,args:[$e]}),dt=je[je.lastIndexOf($e)+1],de.push({command:si.addLayer,args:[Ke,dt]})}(Q,L.layers,B)}catch(G){console.warn("Unable to compute style diff:",G),B=[{command:si.setStyle,args:[L]}]}return B}(this.serialize(),l).filter(k=>!(k.command in zw));if(_.length===0)return!1;const E=_.filter(k=>!(k.command in YI));if(E.length>0)throw new Error(`Unimplemented: ${E.map(k=>k.command).join(", ")}.`);const j=[];return _.forEach(k=>{j.push(this[k.command](...k.args))}),f&&Promise.all(j).then(f).catch(f),this.stylesheet=l,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(l){if(l.size===0)return this;for(const[f,_]of l.entries()){if(this.getImage(f))return this.fire(new i.y(new Error(`An image with the name "${f.name}" already exists.`)));this.imageManager.addImage(f,this.scope,_),this._changes.updateImage(f,this.scope)}return this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this}addImage(l,f){return this.getImage(l)?this.fire(new i.y(new Error(`An image with the name "${l.name}" already exists.`))):(this.imageManager.addImage(l,this.scope,f),this._changes.updateImage(l,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this)}updateImage(l,f,_=!1){this.imageManager.updateImage(l,this.scope,f),_&&(this._changes.updateImage(l,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})))}getImage(l){return this.imageManager.getImage(l,this.scope)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l,this.scope),this._changes.updateImage(l,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(l){return this.modelManager.addModelURLs(l,this.scope),this._updateWorkerModels(),this.fire(new i.z("data",{dataType:"style"})),this}addModel(l,f,_={}){return this._checkLoaded(),this._validate(Og,`models.${l}`,f,null,_)||(this.modelManager.addModel(l,f,this.scope),this.fire(new i.z("data",{dataType:"style"}))),this}hasModel(l){return this.modelManager.hasModel(l,this.scope)}removeModel(l){return this.hasModel(l)?(this.modelManager.removeModel(l,this.scope,!1,!0),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(l,f,_={}){if(this._checkLoaded(),this.getOwnSource(l)!==void 0)throw new Error(`There is already a source with ID "${l}".`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(Ln,`sources.${l}`,f,null,_))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const E=nl(l,f,this.dispatcher,this);E.scope=this.scope,E.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(E.id),source:E.serialize(),sourceId:E.id}));const j=k=>{const L=(k?"symbol:":"other:")+E.id,B=i.B(L,this.scope),G=this._sourceCaches[L]=new Sc(B,E,k);(k?this._symbolSourceCaches:this._otherSourceCaches)[E.id]=G,G.onAdd(this.map)};j(!1),f.type!=="vector"&&f.type!=="geojson"||j(!0),E.onAdd&&E.onAdd(this.map),_.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(l){this._checkLoaded();const f=this.getOwnSource(l);if(!f)throw new Error("There is no source with this ID");for(const E in this._layers)if(this._layers[E].source===l)return this.fire(new i.y(new Error(`Source "${l}" cannot be removed while layer "${E}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===l)return this.fire(new i.y(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const E=Object.entries(this.stylesheet.iconsets).find(([j,k])=>k.type==="source"&&k.source===l);if(E)return this.fire(new i.y(new Error(`Source "${l}" cannot be removed while iconset "${E[0]}" is using it.`)))}const _=this.getOwnSourceCaches(l);for(const E of _){const j=i.dp(E.id);delete this._sourceCaches[j],this._changes.discardSourceCacheUpdate(E.id),E.fire(new i.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:E.getSource().id})),E.setEventedParent(null),E.clearTiles()}return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],this.mergeSources(),f.setEventedParent(null),f.onRemove&&f.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(l,f){this._checkLoaded(),this.getOwnSource(l).setData(f),this._changes.setDirty()}getOwnSource(l){const f=this.getOwnSourceCache(l);return f&&f.getSource()}getOwnSources(){const l=[];for(const f in this._otherSourceCaches){const _=this.getOwnSourceCache(f);_&&l.push(_.getSource())}return l}areTilesLoaded(){const l=this._mergedSourceCaches;for(const f in l){const _=l[f]._tiles;for(const E in _){const j=_[E];if(j.state!=="loaded"&&j.state!=="errored")return!1}}return!0}setLights(l){if(this._checkLoaded(),!l)return delete this.ambientLight,void delete this.directionalLight;const f=this._getTransitionParameters();for(const j of l){if(this._validate(ms,"lights",j))return;switch(j.type){case"ambient":if(this.ambientLight){const k=this.ambientLight;k.set(j),k.updateTransitions(f)}else this.ambientLight=new ks(j,Si||(Si=new i.a9({color:new i.aa(i.a6.properties_light_ambient.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const k=this.directionalLight;k.set(j),k.updateTransitions(f)}else this.directionalLight=new ks(j,bs||(bs=new i.a9({direction:new i.ap(i.a6.properties_light_directional.direction),color:new i.aa(i.a6.properties_light_directional.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_directional.intensity),"cast-shadows":new i.aa(i.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new i.aa(i.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.aa(i.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const _=Object.assign(f,{worldview:this.map.getWorldview()}),E=new i.ac(this.z||0,_);this.ambientLight&&this.ambientLight.recalculate(E),this.directionalLight&&this.directionalLight.recalculate(E),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const l=this.directionalLight,f=this.ambientLight;if(!l||!f)return;const _=X=>.2126*(X[0]<=.03928?X[0]/12.92:Math.pow((X[0]+.055)/1.055,2.4))+.7152*(X[1]<=.03928?X[1]/12.92:Math.pow((X[1]+.055)/1.055,2.4))+.0722*(X[2]<=.03928?X[2]/12.92:Math.pow((X[2]+.055)/1.055,2.4)),E=l.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),j=l.properties.get("intensity"),k=l.properties.get("direction"),L=1-i.d3(k.x,k.y,k.z)[2]/90,B=_(E)*j*L,G=f.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),Z=f.properties.get("intensity"),Q=_(G)*Z;return Number(((B+Q)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const l=[];return this.directionalLight&&l.push(this.directionalLight.get()),this.ambientLight&&l.push(this.ambientLight.get()),l}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(l){if(l==null||l===""&&this.isRootStyle())return this;if(i.dq(l)){const f=i.dr(l),_=this.fragments.find(({id:j})=>j===f);if(!_)return;const E=i.dp(l);return _.style.getFragmentStyle(E)}{const f=this.fragments.find(({id:_})=>_===l);return f?f.style:void 0}}setFeaturesetSelectors(l){if(!l)return;const f={},_=(E,j="")=>`${E}::${j}`;this._featuresetSelectors={};for(const E in l){const j=this._featuresetSelectors[E]=[];for(const k of l[E].selectors){if(k.featureNamespace){const B=this.getOwnLayer(k.layer);if(!B){i.w(`Layer is undefined for selector: ${k.layer}`);continue}const G=_(B.source,B.sourceLayer);if(G in f&&f[G]!==k.featureNamespace){i.w(`"featureNamespace ${k.featureNamespace} of featureset ${E}'s selector is not associated to the same source, skip this selector`);continue}f[G]=k.featureNamespace}let L;if(k.properties)for(const B in k.properties){const G=i.U(k.properties[B]);G.result==="success"&&(L=L||{},L[B]=G.value)}j.push({layerId:k.layer,namespace:k.featureNamespace,properties:L,uniqueFeatureID:k._uniqueFeatureID})}}}getFeaturesetDescriptors(l){const f=this.getFragmentStyle(l);if(!f||!f.stylesheet.featuresets)return[];const _=[];for(const E in f.stylesheet.featuresets)_.push({featuresetId:E,importId:f.scope?f.scope:void 0});return _}getFeaturesetLayers(l,f){const _=this.getFragmentStyle(f),E=_.stylesheet.featuresets;if(!E||!E[l])return this.fire(new i.y(new Error(`The featureset '${l}' does not exist in the map's style and cannot be queried.`))),[];const j=[];for(const k of E[l].selectors){const L=_.getOwnLayer(k.layer);L&&j.push(L)}return j}getConfigProperty(l,f){const _=this.getFragmentStyle(l);if(!_)return null;const E=i.B(f,_.scope),j=_.options.get(E),k=j?j.value||j.default:null;return k?k.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(l,f){const _=i.B(l,f);return this._mergedIndoor[_]}setIndoorData(l,f){this.map.indoor.setIndoorData(f)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(l,f,_){const E=this.getFragmentStyle(l);if(!E)return;const j=E.stylesheet.schema;if(!j||!j[f])return;const k=i.U(_);if(k.result!=="success")return void rh(this,k.value);const L=k.value.expression,B=i.B(f,E.scope),G=E.options.get(B);if(!G)return;let Z;const{minValue:Q,maxValue:X,stepValue:se,type:le,values:de}=j[f],xe=i.U(j[f].default);xe.result==="success"&&(Z=xe.value.expression),Z?(this.options.set(B,Object.assign({},G,{value:L,default:Z,minValue:Q,maxValue:X,stepValue:se,type:le,values:de})),this.updateConfigDependencies(f)):this.fire(new i.y(new Error(`No schema defined for the config option "${f}" in the "${l}" fragment.`)))}getConfig(l){const f=this.getFragmentStyle(l);if(!f)return null;const _=f.stylesheet.schema;if(!_)return null;const E={};for(const j in _){const k=i.B(j,f.scope),L=f.options.get(k),B=L?L.value||L.default:null;E[j]=B?B.serialize():null}return E}setConfig(l,f){const _=this.getFragmentStyle(l);_&&(_.updateConfig(f,_.stylesheet.schema),this.updateConfigDependencies())}getSchema(l){const f=this.getFragmentStyle(l);return f?f.stylesheet.schema:null}setSchema(l,f){const _=this.getFragmentStyle(l);_&&(_.stylesheet.schema=f,_.updateConfig(_._config,f),this.updateConfigDependencies())}updateConfig(l,f){if(this._config=l,l||f)if(f)for(const _ in f){let E,j;const k=i.U(f[_].default);if(k.result==="success"&&(E=k.value.expression),l&&l[_]!==void 0){const X=i.U(l[_]);X.result==="success"&&(j=X.value.expression)}const{minValue:L,maxValue:B,stepValue:G,type:Z,values:Q}=f[_];if(E){const X=i.B(_,this.scope);this.options.set(X,{default:E,value:j,minValue:L,maxValue:B,stepValue:G,type:Z,values:Q})}else this.fire(new i.y(new Error(`No schema defined for config option "${_}".`)))}else this.fire(new i.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(l,f=()=>!0){for(const _ of l){const E=this.getLayer(_);E&&f(E)&&(E.possiblyEvaluateVisibility(),this._updateLayer(E),this._changes.setDirty())}}updateConfigDependencies(l){this._updateLayers(this._configDependentLayers,f=>!l||f.expressionDependencies.configDependencies.has(l)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(f=>{const _=f._styleColorTheme.colorThemeOverride?f._styleColorTheme.colorThemeOverride:f._styleColorTheme.colorTheme;if(_){const E=f._evaluateColorThemeData(_);(!f._styleColorTheme.lut&&E!==""||f._styleColorTheme.lut&&E!==f._styleColorTheme.lut.data)&&f.setColorTheme(_)}}),this._changes.setDirty()}addLayer(l,f,_={}){this._checkLoaded();const E=l.id;if(this._layers[E])return void this.fire(new i.y(new Error(`Layer with id "${E}" already exists on this map`)));let j;if(l.type==="custom"){if(rh(this,i.ds(l)))return;j=i.dt(l,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof l.source=="object"&&(this.addSource(E,l.source),l=i.dn(l),l=Object.assign(l,{source:E})),this._validate(Na,`layers.${E}`,l,{arrayIndex:-1},_))return;j=i.dt(l,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(j),j.setEventedParent(this,{layer:{id:E}})}const k=i.B(j.source,j.scope);j.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(k),j.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(k);let L=this._order.length;if(f){const Q=this._order.indexOf(f);if(Q===-1)return void this.fire(new i.y(new Error(`Layer with id "${f}" does not exist on this map.`)));j.slot===this._layers[f].slot?L=Q:i.w(`Layer with id "${f}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(L,0,E),this._layerOrderChanged=!0,this._layers[E]=j;const B=this.getOwnLayerSourceCache(j),G=!!this.directionalLight&&this.directionalLight.shadowsEnabled();B&&j.canCastShadows()&&G&&(B.castsShadows=!0);const Z=this._changes.getRemovedLayer(j);if(Z&&j.source&&B&&j.type!=="custom"){this._changes.discardLayerRemoval(j);const Q=i.B(j.source,j.scope);Z.type!==j.type?this._changes.updateSourceCache(Q,"clear"):(this._changes.updateSourceCache(Q,"reload"),B.pause())}this._updateLayer(j),j.onAdd&&j.onAdd(this.map),j.scope=this.scope,this.mergeLayers()}moveLayer(l,f){this._checkLoaded();const _=this._checkLayer(l);if(!_||l===f)return;const E=this._order.indexOf(l);this._order.splice(E,1);let j=this._order.length;if(f){const k=this._order.indexOf(f);if(k===-1)return void this.fire(new i.y(new Error(`Layer with id "${f}" does not exist on this map.`)));_.slot===this._layers[f].slot?j=k:i.w(`Layer with id "${f}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(j,0,l),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(l){this._checkLoaded();const f=this._checkLayer(l);if(!f)return;f.setEventedParent(null);const _=this._order.indexOf(l);this._order.splice(_,1),delete this._layers[l],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(f.fqid),this._indoorDependentLayers.delete(f.fqid),this._changes.removeLayer(f);const E=this.getOwnLayerSourceCache(f);if(E&&E.castsShadows){let j=!1;for(const k in this._layers)if(this._layers[k].source===f.source&&this._layers[k].canCastShadows()){j=!0;break}E.castsShadows=j}f.onRemove&&f.onRemove(this.map),this.mergeLayers()}getOwnLayer(l){return this._layers[l]}hasLayer(l){return l in this._mergedLayers}hasLayerType(l){for(const f in this._layers)if(this._layers[f].type===l)return!0;return!1}setLayerZoomRange(l,f,_){this._checkLoaded();const E=this._checkLayer(l);E&&(E.minzoom===f&&E.maxzoom===_||(f!=null&&(E.minzoom=f),_!=null&&(E.maxzoom=_),this._updateLayer(E)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(l,f){this._checkLoaded();const _=this._checkLayer(l);_&&_.slot!==f&&(_.slot=f,this._updateLayer(_))}setFilter(l,f,_={}){this._checkLoaded();const E=this._checkLayer(l);if(E&&!i.bx(E.filter,f))return f==null?(E.filter=void 0,void this._updateLayer(E)):void(this._validate(_n,`layers.${E.id}.filter`,f,{layerType:E.type},_)||(E.filter=i.dn(f),this._updateLayer(E)))}getFilter(l){const f=this._checkLayer(l);if(f)return i.dn(f.filter)}setLayoutProperty(l,f,_,E={}){this._checkLoaded();const j=this._checkLayer(l);if(j&&!i.bx(j.getLayoutProperty(f),_)){if(_!=null&&(!E||E.validate!==!1)&&rh(j,Cw.call(so,{key:`layers.${l}.layout.${f}`,layerType:j.type,objectKey:f,value:_,styleSpec:i.a6,style:{glyphs:!0,sprite:!0}})))return;j.setLayoutProperty(f,_),j.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(j.fqid),j.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(j.fqid),this._updateLayer(j)}}setLayerProperty(l,f,_,E={}){this._checkLoaded();const j=this._checkLayer(l);j&&(f==="appearances"?(j.setAppearances(_),this._changes.setDirty()):j.isPaintProperty(f)?this.setPaintProperty(l,f,_,E):this.setLayoutProperty(l,f,_,E))}getLayoutProperty(l,f){const _=this._checkLayer(l);if(_)return _.getLayoutProperty(f)}setPaintProperty(l,f,_,E={}){this._checkLoaded();const j=this._checkLayer(l);if(!j||i.bx(j.getPaintProperty(f),_)||_!=null&&(!E||E.validate!==!1)&&rh(j,Fo.call(so,{key:`layers.${l}.paint.${f}`,layerType:j.type,objectKey:f,value:_,styleSpec:i.a6})))return;const k=j.setPaintProperty(f,_);j.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(j.fqid),j.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(j.fqid),k&&this._updateLayer(j),this._changes.updatePaintProperties(j)}getPaintProperty(l,f){const _=this._checkLayer(l);if(_)return _.getPaintProperty(f)}setFeatureState(l,f){if(this._checkLoaded(),"target"in l){if("featuresetId"in l.target){const{featuresetId:B,importId:G}=l.target,Z=this.getFragmentStyle(G),Q=Z.getFeaturesetLayers(B);for(const{source:X,sourceLayer:se}of Q)Z.setFeatureState({id:l.id,source:X,sourceLayer:se},f)}else if("layerId"in l.target){const{layerId:B}=l.target,G=this.getLayer(B);this.setFeatureState({id:l.id,source:G.source,sourceLayer:G.sourceLayer},f)}return}const _=l.source,E=l.sourceLayer,j=this._checkSource(_);if(!j)return;const k=j.type;if(k==="geojson"&&E)return void this.fire(new i.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(k==="vector"&&!E)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));l.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided.")));const L=this.getOwnSourceCaches(_);for(const B of L)B.setFeatureState(E,l.id,f)}removeFeatureState(l,f){if(this._checkLoaded(),"target"in l){if("featuresetId"in l.target){const{featuresetId:B,importId:G}=l.target,Z=this.getFragmentStyle(G),Q=Z.getFeaturesetLayers(B);for(const{source:X,sourceLayer:se}of Q)Z.removeFeatureState({id:l.id,source:X,sourceLayer:se},f)}else if("layerId"in l.target){const{layerId:B}=l.target,G=this.getLayer(B);this.removeFeatureState({id:l.id,source:G.source,sourceLayer:G.sourceLayer},f)}return}const _=l.source,E=this._checkSource(_);if(!E)return;const j=E.type,k=j==="vector"?l.sourceLayer:void 0;if(j==="vector"&&!k)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(f&&typeof l.id!="string"&&typeof l.id!="number")return void this.fire(new i.y(new Error("A feature id is required to remove its specific state property.")));const L=this.getOwnSourceCaches(_);for(const B of L)B.removeFeatureState(k,l.id,f)}getFeatureState(l){if(this._checkLoaded(),"target"in l){let j;if("featuresetId"in l.target){const{featuresetId:k,importId:L}=l.target,B=this.getFragmentStyle(L),G=B.getFeaturesetLayers(k);for(const{source:Z,sourceLayer:Q}of G){const X=B.getFeatureState({id:l.id,source:Z,sourceLayer:Q});if(X&&!j)j=X;else if(!i.bx(j,X))return void this.fire(new i.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in l.target){const{layerId:k}=l.target,L=this.getLayer(k);j=this.getFeatureState({id:l.id,source:L.source,sourceLayer:L.sourceLayer})}return j}const f=l.source,_=l.sourceLayer,E=this._checkSource(f);if(E){if(E.type!=="vector"||_)return l.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(f)[0].getFeatureState(_,l.id);this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(l){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,l),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const l=this.getTerrain(),f=l&&this.terrain&&this.terrain.scope===this.scope?l:this.stylesheet.terrain;return i.du({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:f,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},_=>_!==void 0)}_updateFilteredLayers(l){for(const f of Object.values(this._mergedLayers))l(f)&&this._updateLayer(f)}_updateLayer(l){this._changes.updateLayer(l);const f=this.getLayerSourceCache(l),_=i.B(l.source,l.scope),E=this._changes.getUpdatedSourceCaches();l.source&&!E[_]&&f&&f.getSource().type!=="raster"&&(this._changes.updateSourceCache(_,"reload"),f.pause()),l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const f=L=>this._mergedLayers[L].is3D(!!this.terrain),_=this.order,E={},j=[];for(let L=_.length-1;L>=0;L--){const B=_[L];if(f(B)){E[B]=L;for(const G of l){const Z=G[B];if(Z)for(const Q of Z)j.push(Q)}}}j.sort((L,B)=>B.intersectionZ-L.intersectionZ);const k=[];for(let L=_.length-1;L>=0;L--){const B=_[L];if(f(B))for(let G=j.length-1;G>=0;G--){const Z=j[G].feature;if(Z.layer&&E[Z.layer.id]<L)break;k.push(Z),j.pop()}else for(const G of l){const Z=G[B];if(Z)for(const Q of Z)k.push(Q.feature)}}return k}queryRasterValue(l,f,_){const E=this.getOwnSource(l);return E?E.type!=="raster-array"?(this.fire(new i.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):E.queryRasterArrayValue(f,_):(this.fire(new i.y(new Error(`Source with id "${l}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(l,f,_){let E;f&&!Array.isArray(f)&&f.filter&&(this._validate(_n,"queryRenderedFeatures.filter",f.filter,null,f),E=i.b5(f.filter));const j={},k=Z=>{if(p_.has(Z.type))return;const Q=this.getOwnLayerSourceCache(Z),X=j[Q.id]=j[Q.id]||{sourceCache:Q,layers:{},has3DLayers:!1};Z.is3D(!!this.terrain)&&(X.has3DLayers=!0),X.layers[Z.fqid]=X.layers[Z.fqid]||{styleLayer:Z,targets:[]},X.layers[Z.fqid].targets.push({filter:E})};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new i.y(new Error("parameters.layers must be an Array."))),[];for(const Z of f.layers){const Q=this._layers[Z];if(!Q)return this.fire(new i.y(new Error(`The layer '${Z}' does not exist in the map's style and cannot be queried for features.`))),[];k(Q)}}else for(const Z in this._layers)k(this._layers[Z]);const L=this._queryRenderedFeatures(l,j,_),B=this._flattenAndSortRenderedFeatures(L),G=[];for(const Z of B)i.dv(Z.layer.id)===this.scope&&G.push(Z);return G}queryRenderedFeatureset(l,f,_){let E;f&&!Array.isArray(f)&&f.filter&&(this._validate(_n,"queryRenderedFeatures.filter",f.filter,null,f),E=i.b5(f.filter));const j="mock",k=[];if(f&&f.target)k.push(Object.assign({},f,{targetId:j,filter:E}));else{const Z=this.getFeaturesetDescriptors();for(const Q of Z)k.push({targetId:j,filter:E,target:Q});for(const{style:Q}of this.fragments){const X=Q.getFeaturesetDescriptors();for(const se of X)k.push({targetId:j,filter:E,target:se})}}const L=this.queryRenderedTargets(l,k,_),B=[],G=new Set;for(const Z of L)for(const Q of Z.variants[j])jl(Q,Z,G)||B.push(new i.dw(Z,Q));return B}queryRenderedTargets(l,f,_){const E={},j=(L,B,G,Z)=>{const Q=E[B.id]=E[B.id]||{sourceCache:B,layers:{},has3DLayers:!1};if(Q.layers[L.fqid]=Q.layers[L.fqid]||{styleLayer:L,targets:[]},L.is3D(!!this.terrain)&&(Q.has3DLayers=!0),!Z)return G.uniqueFeatureID=!1,void Q.layers[L.fqid].targets.push(G);Q.layers[L.fqid].targets.push(Object.assign({},G,{namespace:Z.namespace,properties:Z.properties,uniqueFeatureID:Z.uniqueFeatureID}))};for(const L of f)if("featuresetId"in L.target){const{featuresetId:B,importId:G}=L.target,Z=this.getFragmentStyle(G);if(!Z||!Z._featuresetSelectors)continue;const Q=Z._featuresetSelectors[B];if(!Q){this.fire(new i.y(new Error(`The featureset '${B}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const X of Q){const se=Z.getOwnLayer(X.layerId);se&&!p_.has(se.type)&&j(se,Z.getOwnLayerSourceCache(se),L,X)}}else if("layerId"in L.target){const{layerId:B}=L.target,G=this.getLayer(B);if(!G||p_.has(G.type))continue;j(G,this.getLayerSourceCache(G),L)}const k=this._queryRenderedFeatures(l,E,_);return this._flattenAndSortRenderedFeatures(k)}_queryRenderedFeatures(l,f,_){const E=[],j=!!this.map._showQueryGeometry,k=_i.createFromScreenPoints(l,_);for(const L in f){const B=Pl(k,f[L],this._availableImages,_,j);Object.keys(B).length&&E.push(B)}if(this.placement)for(const L in f){if(!f[L].sourceCache._onlySymbols)continue;const B=i_(k.screenGeometry,f[L],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(B).length&&E.push(B)}return E}querySourceFeatures(l,f){const _=f&&f.filter;_&&this._validate(_n,"querySourceFeatures.filter",_,null,f);let E=[];const j=this.getOwnSourceCaches(l);for(const k of j)E=E.concat(kg(k,f));return E}addSourceType(l,f,_){return Cc.getSourceType(l)?_(new Error(`A source type called "${l}" already exists.`)):(Cc.setSourceType(l,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:f.workerSourceURL},_):_(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(l,f,_={}){this._checkLoaded();const E=this.light.getLight();let j=!1;for(const L in l)if(!i.bx(l[L],E[L])){j=!0;break}if(!j)return;const k=this._getTransitionParameters();this.light.setLight(l,f,_),this.light.updateTransitions(k)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(l,f=1){if(this._checkLoaded(),!l)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),f===0&&delete this.terrain,l===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let _=l;const E=l.source==null;if(f===1){if(this.disableElevatedTerrain)return;if(typeof _.source=="object"){const L="terrain-dem-src";this.addSource(L,_.source),_=i.dn(_),_=Object.assign(_,{source:L})}const j=Object.assign({},_),k={};if(this.terrain&&E){j.source=this.terrain.get().source;const L=this.terrain?this.getFragmentStyle(this.terrain.scope):null;L&&(k.style=L.serialize())}if(this._validate(Ga,"terrain",j,k))return}if(!this.terrain||this.terrain.scope!==this.scope&&!E||this.terrain&&f!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,f),this.fire(new i.z("data",{dataType:"style"}))}else{const j=this.terrain,k=j.get();for(const L of Object.keys(i.a6.terrain))!_.hasOwnProperty(L)&&i.a6.terrain[L].default&&(_[L]=i.a6.terrain[L].default);for(const L in l)if(!i.bx(l[L],k[L])){j.set(l,this.options),this.stylesheet.terrain=l;const B=this._getTransitionParameters({duration:0});j.updateTransitions(B),this.fire(new i.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const f=this.fog=new zr(l,this.map.transform,this.scope,this.options);this.stylesheet.fog=f.get();const _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}_createSnow(l){const f=this.snow=new Xs(l,this.map.transform,this.scope,this.options);this.stylesheet.snow=f.get();const _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}_createRain(l){const f=this.rain=new Rs(l,this.map.transform,this.scope,this.options);this.stylesheet.rain=f.get();const _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const f=this.fog;if(!i.bx(f.get(),l)){f.set(l,this.options),this.stylesheet.fog=f.get();const _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}}else this._createFog(l);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(l){if(this._checkLoaded(),!l)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const f=this.snow;if(!i.bx(f.get(),l)){f.set(l,this.options),this.stylesheet.snow=f.get();const _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}}else this._createSnow(l);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(l){if(this._checkLoaded(),!l)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const f=this.rain;if(!i.bx(f.get(),l)){f.set(l,this.options),this.stylesheet.rain=f.get();const _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}}else this._createRain(l);this._markersNeedUpdate=!0}_reloadColorTheme(){const l=()=>{for(const E in this._layers)this._layers[E].lut=this._styleColorTheme.lut;for(const E in this._sourceCaches)this._sourceCaches[E].clearTiles()},f=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!f)return this._styleColorTheme.lut=null,void l();const _=this._evaluateColorThemeData(f);this._loadColorTheme(_).then(()=>{this.fire(new i.z("colorthemeset")),l()}).catch(E=>{i.w(`Couldn't set color theme: ${E}`)})}setColorTheme(l){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=l,this._reloadColorTheme()}setImportColorTheme(l,f){const _=this.getFragmentStyle(l);_&&(_._styleColorTheme.colorThemeOverride=f,_._reloadColorTheme())}_getTransitionParameters(l){return{now:i.o.now(),transition:Object.assign(this.transition,l)}}updateDrapeFirstLayers(){if(!this.terrain)return;const l=[],f=[];for(const _ of this._mergedOrder)this.isLayerDraped(this._mergedLayers[_])?l.push(_):f.push(_);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...f)}_createTerrain(l,f){const _=this.terrain=new ot(l,f,this.scope,this.options,this.map.getWorldview());f===1&&(this.stylesheet.terrain=l),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const E=this._getTransitionParameters({duration:0});_.updateTransitions(E)}_force3DLayerUpdate(){for(const l in this._layers){const f=this._layers[l];f.type==="fill-extrusion"&&this._updateLayer(f)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const f=this._layers[l];f.type==="symbol"&&this._updateLayer(f)}}_validate(l,f,_,E,j={}){if(j&&j.validate===!1)return!1;const k=Object.assign({},this.serialize());return rh(this,l.call(so,Object.assign({key:f,style:k,value:_,styleSpec:i.a6},E)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.dx.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._mergedLayers)this._mergedLayers[l].setEventedParent(null);for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles(),this._mergedSourceCaches[l].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(l){const f=this.getSourceCaches(l);for(const _ of f)_.clearTiles()}clearSources(){for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles()}clearLayers(){for(const l in this._mergedLayers){const f=this._mergedLayers[l];f._clear&&f._clear()}}reloadSource(l){const f=this.getSourceCaches(l);for(const _ of f)_.resume(),_.reload()}reloadSources(){for(const l of this.getSources())l.reload&&l.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(l=>{l.modelManager.reloadModels(l.scope)})}updateSources(l){let f;this.directionalLight&&(f=aA(this.directionalLight));const _=new Set;for(const E in this._mergedLayers){const j=this._mergedLayers[E];j.hasElevation()&&!_.has(j.source)&&_.add(j.source)}for(const E in this._mergedSourceCaches){const j=this._mergedSourceCaches[E],k=_.has(j._source.id);j.update(l,void 0,void 0,f,k)}}_generateCollisionBoxes(){for(const l in this._sourceCaches){const f=this._sourceCaches[l];f.resume(),f.reload()}}_updatePlacement(l,f,_,E,j,k,L=!1){let B=!1,G=!1;const Z={},Q={};for(const X of this._mergedOrder){const se=this._mergedLayers[X];if(se.type!=="symbol")continue;const le=i.B(se.source,se.scope);let de=Z[le];if(!de){const ye=this.getLayerSourceCache(se);if(!ye)continue;const Ee=ye.getRenderableIds(!0).map(Ne=>ye.getTileByID(Ne));Q[le]=Ee.slice(),de=Z[le]=Ee.sort((Ne,je)=>je.tileID.overscaledZ-Ne.tileID.overscaledZ||(Ne.tileID.isLessThan(je.tileID)?-1:1))}const xe=this.crossTileSymbolIndex.addLayer(se,de,f.center.lng,f.projection);B=B||xe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),L=L||this._layerOrderChanged||E===0,this._layerOrderChanged&&this.fire(new i.z("neworder")),(L||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.o.now(),f.zoom))&&(this.pauseablePlacement=new gl(f,this._mergedOrder,L,_,E,j,this.placement,this.fog&&f.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,Z,Q,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.o.now()),G=!0),B&&this.pauseablePlacement.placement.setStale()),G||B){this._buildingIndex.onNewFrame(f.zoom);for(let X=0;X<this._mergedOrder.length;X++){const se=this._mergedLayers[this._mergedOrder[X]];if(se.type!=="symbol")continue;const le=this.isLayerClipped(se);this.placement.updateLayerOpacities(se,Z[i.B(se.source,se.scope)],X,le?k:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.o.now())}}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}addImport(l,f){this._checkLoaded();const _=this.stylesheet.imports=this.stylesheet.imports||[];if(_.findIndex(({id:j})=>j===l.id)!==-1)return void this.fire(new i.y(new Error(`Import with id '${l.id}' already exists in the map's style.`)));if(!f)return _.push(l),this._loadImports([l],!0);const E=_.findIndex(({id:j})=>j===f);return E===-1&&this.fire(new i.y(new Error(`Import with id "${f}" does not exist on this map.`))),this.stylesheet.imports=_.slice(0,E).concat(l).concat(_.slice(E)),this._loadImports([l],!0,f)}updateImport(l,f){this._checkLoaded();const _=this.stylesheet.imports||[],E=this.getImportIndex(l);return E===-1?this:typeof f=="string"?(this.setImportUrl(l,f),this):(f.url&&f.url!==_[E].url&&this.setImportUrl(l,f.url),i.bx(f.config,_[E].config)||this.setImportConfig(l,f.config,f.data.schema),i.bx(f.data,_[E].data)||this.setImportData(l,f.data),this)}moveImport(l,f){this._checkLoaded();let _=this.stylesheet.imports||[];const E=this.getImportIndex(l);if(E===-1)return this;const j=this.getImportIndex(f);if(j===-1)return this;const k=_[E],L=this.fragments[E];return _=_.filter(({id:B})=>B!==l),this.fragments=this.fragments.filter(({id:B})=>B!==l),this.stylesheet.imports=_.slice(0,j).concat(k).concat(_.slice(j)),this.fragments=this.fragments.slice(0,j).concat(L).concat(this.fragments.slice(j)),this.mergeLayers(),this}setImportUrl(l,f){this._checkLoaded();const _=this.stylesheet.imports||[],E=this.getImportIndex(l);if(E===-1)return this;_[E].url=f;const j=this.fragments[E];return j.style=this._createFragmentStyle(_[E]),j.style.on("style.import.load",()=>this.mergeAll()),j.style.loadURL(f),this}setImportData(l,f){this._checkLoaded();const _=this.getImportIndex(l),E=this.stylesheet.imports||[];return _===-1?this:f?(this.fragments[_].style.setState(f),this._reloadImports(),this):(delete E[_].data,this.setImportUrl(l,E[_].url))}setImportConfig(l,f,_){this._checkLoaded();const E=this.getImportIndex(l),j=this.stylesheet.imports||[];if(E===-1)return this;f?j[E].config=f:delete j[E].config;const k=this.fragments[E];_&&k.style.stylesheet&&(k.style.stylesheet.schema=_);const L=k.style.stylesheet&&k.style.stylesheet.schema;return k.config=f,k.style.updateConfig(f,L),this.updateConfigDependencies(),this}removeImport(l){this._checkLoaded();const f=this.stylesheet.imports||[],_=this.getImportIndex(l);_!==-1&&(f.splice(_,1),this.fragments[_].style._remove(),this.fragments.splice(_,1),this._reloadImports())}getImportIndex(l){const f=(this.stylesheet.imports||[]).findIndex(_=>_.id===l);return f===-1&&this.fire(new i.y(new Error(`Import '${l}' does not exist in the map's style and cannot be updated.`))),f}getLayer(l){return this._mergedLayers[l]}getSources(){const l=[];for(const f in this._mergedOtherSourceCaches){const _=this._mergedOtherSourceCaches[f];_&&l.push(_.getSource())}return l}getSource(l,f){const _=this.getSourceCache(l,f);return _&&_.getSource()}getLayerSource(l){const f=this.getLayerSourceCache(l);return f&&f.getSource()}getSourceCache(l,f){const _=i.B(l,f);return this._mergedOtherSourceCaches[_]}getLayerSourceCache(l){const f=i.B(l.source,l.scope);return l.type==="symbol"?this._mergedSymbolSourceCaches[f]:this._mergedOtherSourceCaches[f]}getSourceCaches(l){if(l==null)return Object.values(this._mergedSourceCaches);const f=[];return this._mergedOtherSourceCaches[l]&&f.push(this._mergedOtherSourceCaches[l]),this._mergedSymbolSourceCaches[l]&&f.push(this._mergedSymbolSourceCaches[l]),f}updateSourceCaches(){const l=this._changes.getUpdatedSourceCaches();for(const f in l){const _=l[f];_==="reload"?this.reloadSource(f):_==="clear"&&this.clearSource(f)}}updateLayers(l){const f=this._changes.getUpdatedPaintProperties();for(const _ of f){const E=this.getLayer(_);E&&E.updateTransitions(l)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(l){this.stylesheet.glyphs=l,this.glyphManager.setURL(l)}getImages(l,f,_){this.imageManager.getImages(f.images,f.scope,_),this._updateTilesForChangedImages();const E=k=>{if(k){const L=f.images.map(B=>i.I.toString(B));k.setDependencies(f.tileID.key,f.type,L)}},j=i.B(f.source,f.scope);E(this._mergedOtherSourceCaches[j]),E(this._mergedSymbolSourceCaches[j]),f.images.some(k=>k.iconsetId)&&this.fire(new i.z("data",{dataType:"style"}))}rasterizeImages(l,f,_){this.imageManager.rasterizeImages(f,_)}getGlyphs(l,f,_){this.glyphManager.getGlyphs(f.stacks,_)}getResource(l,f,_){return i.dy(f,_)}getOwnSourceCache(l){return this._otherSourceCaches[l]}getOwnLayerSourceCache(l){return l.type==="symbol"?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}getOwnSourceCaches(l){const f=[];return this._otherSourceCaches[l]&&f.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&f.push(this._symbolSourceCaches[l]),f}_isSourceCacheLoaded(l){const f=this.getOwnSourceCaches(l);return f.length===0?(this.fire(new i.y(new Error(`There is no source with ID '${l}'`))),!1):f.every(_=>_.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(l,f){if(!this._clipLayerPresent&&l.type!=="fill-extrusion"&&l.type!=="building")return!1;const _=l.type==="fill-extrusion"&&(l.sourceLayer==="building"||l.sourceLayer==="procedural_buildings"),E=l.type==="building";if(l.is3D(!!this.terrain)){if(_||E||f&&f.type==="batched-model"||l.type==="model")return!0}else if(l.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(l=>{l.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Cc.getSourceType=function(v){return wc[v]},Cc.setSourceType=function(v,l){wc[v]=l},Cc.registerForPluginStateChange=i.dz;class ff extends i.E{constructor(l){super(),this._style=l,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},i.aX(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(l){l===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=l,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(l){this._activeFloorsVisible=l,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(l){for(const[f,_]of Object.entries(l.buildings))if(this._buildings[f])for(const E of _.floorIds)this._buildings[f].floors[E]||(this._buildings[f].floors[E]=_.floors[E]);else this._buildings[f]=_;for(const f of l.activeFloors)this._activeFloors.add(f);this._updateIndoorSelector()}getIndoorTileOptions(l,f){const _=this._style.getIndoorSourceLayers(l,f);return _&&this._indoorState?{sourceLayers:_,indoorState:this._indoorState}:null}_updateUI(l,f,_){const E=function(j,k,L,B){let G=null,Z=Number.MAX_SAFE_INTEGER;if(B<16)return null;for(const[Q,X]of Object.entries(j)){const se=X.center;if(se){const le=k.distanceTo(i.aS.convert(se));le<Z&&L.contains(se)&&(Z=le,G=Q)}}return G}(this._buildings,f,_,l);E!==this._closestBuildingId&&(this._closestBuildingId=E,this._updateIndoorSelector())}_updateIndoorSelector(){const l=this._buildings,f=this._closestBuildingId,_=f&&l?l[f]:void 0;if(!_)return void this.fire(new i.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let E=null;for(const k of _.floorIds)if(this._activeFloors&&this._activeFloors.has(k)){E=k;break}const j=Array.from(_.floorIds).map(k=>({id:k,name:_.floors[k].name,zIndex:_.floors[k].zIndex})).sort((k,L)=>L.zIndex-k.zIndex);this.fire(new i.z("selector-update",{selectedFloorId:E,activeFloorsVisible:this._activeFloorsVisible,floors:j}))}_updateActiveFloors(){const l=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:l,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Jg=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Uw=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Vw=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,Ap="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Cp=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,qw=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,m_=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Hl=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,g_=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,tr=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Hw=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const jp=[];jc(Jg,jp),jc(Vw,jp),jc(Uw,jp);const Pp={"_prelude_fog.vertex.glsl":qw,"_prelude_terrain.vertex.glsl":Cp,"_prelude_shadow.vertex.glsl":tr,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":m_,"_prelude_shadow.fragment.glsl":Hw,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Hl,"_prelude_raster_particle.glsl":g_},Qg={};Nn("",Cp),Nn(m_,qw),Nn(Hw,tr),Nn(Hl,""),Nn(g_,"");const ey=Nn(Uw,Vw),Ou=Jg;var y_={background:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:Nn(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:Nn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Nn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Nn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Nn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Nn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Nn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Nn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Nn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Nn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Nn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Nn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Nn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Nn(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Nn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Nn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Nn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Nn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Nn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Nn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ap),skyboxGradient:Nn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ap),skyboxCapture:Nn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Nn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Nn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Nn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Nn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Nn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Nn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Nn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Nn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function jc(v,l){const f=v.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _ of f)if(_=_.trim(),_[0]==="#"&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const E=_.split(" ");for(const j of E)l.includes(j)||l.push(j)}}function Nn(v,l){const f=/#include\s+"([^"]+)"/g,_=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,E={},j=[],k=[];if(v=v.replace(f,(B,G)=>(k.push(G),"")),(l=l.replace(f,(B,G)=>(j.push(G),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let L=[...jp];jc(v,L),jc(l,L);for(const B of[...j,...k])Pp[B]||console.error(`Undefined include: ${B}`),Qg[B]||(Qg[B]=[],jc(Pp[B],Qg[B])),L=[...L,...Qg[B]];return{fragmentSource:v=v.replace(_,(B,G,Z,Q,X)=>(E[X]=!0,G==="define"?`
#ifndef HAS_UNIFORM_u_${X}
in ${Z} ${Q} ${X};
#else
uniform ${Z} ${Q} u_${X};
#endif
`:G==="initialize"?`
#ifdef HAS_UNIFORM_u_${X}
    ${Z} ${Q} ${X} = u_${X};
#endif
`:G==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    in ${Z} ${Q} ${X};
#endif
`:G==="initialize-attribute"?"":void 0)),vertexSource:l=l.replace(_,(B,G,Z,Q,X)=>{const se=`MATERIAL_ATTRIBUTE_OFFSET_${X}`,le=Q==="float"?"vec2":Q,de=`GET_ATTRIBUTE_${le}(a_${X}, materialInfo, ${se})`,xe=X.match(/color/)?"color":le;return G==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${X}
in ${Z} ${Q} a_${X};
#endif
`:E[X]?G==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
    #if !defined(${se})
        in ${Z} ${le} a_${X};
    #endif
out ${Z} ${Q} ${X};
#else
uniform ${Z} ${Q} u_${X};
#endif
`:G==="initialize"?xe==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = a_${X};
#else
    ${Z} ${Q} ${X} = u_${X};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${X}) 
    #ifdef ${se}
        ${X} = unpack_mix_${xe}(${de}, u_${X}_t);
    #else
        ${X} = unpack_mix_${xe}(a_${X}, u_${X}_t);
    #endif
#else
    ${Z} ${Q} ${X} = u_${X};
#endif
`:G==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    in ${Z} ${Q} a_${X};
    out ${Z} ${Q} ${X};
#endif
`:G==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    ${X} = a_${X};
#endif
`:void 0:G==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
    #if !defined(${se})
        in ${Z} ${le} a_${X};
    #endif  
#else
uniform ${Z} ${Q} u_${X};
#endif
`:G==="define-instanced"?xe==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${X}0;
in vec4 a_${X}1;
in vec4 a_${X}2;
in vec4 a_${X}3;
#else
uniform ${Z} ${Q} u_${X};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${Z} ${le} a_${X};
#else
uniform ${Z} ${Q} u_${X};
#endif
`:G==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    ${Z} ${Q} ${X} = a_${X};
#endif
`:xe==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    #ifdef ${se}
        ${Z} ${Q} ${X} = ${de};
    #else
        ${Z} ${Q} ${X} = a_${X};
    #endif
#else
    ${Z} ${Q} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    #ifdef ${se}
        ${Z} ${Q} ${X} = unpack_mix_${xe}(${de}, u_${X}_t);
    #else
        ${Z} ${Q} ${X} = unpack_mix_${xe}(a_${X}, u_${X}_t);
    #endif
#else
    ${Z} ${Q} ${X} = u_${X};
#endif
`}),usedDefines:L,vertexIncludes:j,fragmentIncludes:k}}class Op{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,f,_,E,j,k,L,B){this.context=l;let G=this.boundPaintVertexBuffers.length!==E.length;for(let Q=0;!G&&Q<E.length;Q++)this.boundPaintVertexBuffers[Q]!==E[Q]&&(G=!0);let Z=this.boundDynamicVertexBuffers.length!==L.length;for(let Q=0;!Z&&Q<L.length;Q++)this.boundDynamicVertexBuffers[Q]!==L[Q]&&(Z=!0);if(!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==_||G||Z||this.boundIndexBuffer!==j||this.boundVertexOffset!==k)this.freshBind(f,_,E,j,k,L,B);else{l.bindVertexArrayOES.set(this.vao);for(const Q of L)Q&&(Q.bind(),B&&Q.instanceCount&&Q.setVertexAttribDivisor(l.gl,f,B));j&&j.dynamicDraw&&j.bind()}}freshBind(l,f,_,E,j,k,L){const B=this.context,G=B.gl;this.vao&&this.destroy(),this.vao=B.gl.createVertexArray(),B.bindVertexArrayOES.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=E,this.boundVertexOffset=j,this.boundDynamicVertexBuffers=k,f.enableAttributes(G,l),f.bind(),f.setVertexAttribPointers(G,l,j);for(const Z of _)Z.enableAttributes(G,l),Z.bind(),Z.setVertexAttribPointers(G,l,j);for(const Z of k)Z&&(Z.enableAttributes(G,l),Z.bind(),Z.setVertexAttribPointers(G,l,j),L&&Z.instanceCount&&Z.setVertexAttribDivisor(G,l,L));E&&E.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function JI(v,l){const f=Math.pow(2,l.canonical.z),_=l.canonical.y;return[new i.ae(0,_/f).toLngLat().lat,new i.ae(0,(_+1)/f).toLngLat().lat]}function QI(v,l,f,_,E,j,k){const L=v.context,B=L.gl,G=f.hillshadeFBO;if(!G)return;v.prepareDrawTile();const Z=v.isTileAffectedByFog(l),Q=v.getOrCreateProgram("hillshade",{overrideFog:Z});L.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,G.colorAttachment.get());const X=((xe,ye,Ee,Ne)=>{const je=Ee.paint.get("hillshade-shadow-color"),Ve=Ee.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ie=Ee.paint.get("hillshade-highlight-color"),Ge=Ee.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",$e=Ee.paint.get("hillshade-accent-color"),Le=Ee.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ke=Ee.paint.get("hillshade-emissive-strength");let dt=i.an(Ee.paint.get("hillshade-illumination-direction"));if(Ee.paint.get("hillshade-illumination-anchor")==="viewport")dt-=xe.transform.angle;else if(xe.style&&xe.style.enable3dLights()&&xe.style.directionalLight){const Et=xe.style.directionalLight.properties.get("direction"),yt=i.d3(Et.x,Et.y,Et.z);dt=i.an(yt[1])}const at=!xe.options.moving;return{u_matrix:Ne||xe.transform.calculateProjMatrix(ye.tileID.toUnwrapped(),at),u_image:0,u_latrange:JI(0,ye.tileID),u_light:[Ee.paint.get("hillshade-exaggeration"),dt],u_shadow:je.toPremultipliedRenderColor(Ve?null:Ee.lut),u_highlight:Ie.toPremultipliedRenderColor(Ge?null:Ee.lut),u_emissive_strength:Ke,u_accent:$e.toPremultipliedRenderColor(Le?null:Ee.lut)}})(v,f,_,v.terrain?l.projMatrix:null);v.uploadCommonUniforms(L,Q,l.toUnwrapped());const{tileBoundsBuffer:se,tileBoundsIndexBuffer:le,tileBoundsSegments:de}=v.getTileBoundsBuffers(f);Q.draw(v,B.TRIANGLES,E,j,k,Xr.disabled,X,_.id,se,le,de)}function v_(v,l,f){if(!l.needsDEMTextureUpload)return;const _=v.context,E=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||v.getTileTexture(f.stride);const j=f.getPixels();l.demTexture?l.demTexture.update(j,{premultiply:!1}):l.demTexture=new i.T(_,j,E.R32F,{premultiply:!1}),l.needsDEMTextureUpload=!1}function eR(v,l,f){const _=v.context,E=_.gl;if(!l.dem)return;const j=l.dem;if(_.activeTexture.set(E.TEXTURE1),v_(v,l,j),!l.demTexture)return;l.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);const k=j.dim;_.activeTexture.set(E.TEXTURE0);let L=l.hillshadeFBO;if(!L){const X=new i.T(_,{width:k,height:k,data:null},E.RGBA8);X.bind(E.LINEAR,E.CLAMP_TO_EDGE),L=l.hillshadeFBO=_.createFramebuffer(k,k,!0,"renderbuffer"),L.colorAttachment.set(X.texture)}_.bindFramebuffer.set(L.framebuffer),_.viewport.set([0,0,k,k]);const{tileBoundsBuffer:B,tileBoundsIndexBuffer:G,tileBoundsSegments:Z}=v.getMercatorTileBoundsBuffers(),Q=[];v.linearFloatFilteringSupported()&&Q.push("TERRAIN_DEM_FLOAT_FORMAT"),v.getOrCreateProgram("hillshadePrepare",{defines:Q}).draw(v,E.TRIANGLES,Er.disabled,tn.disabled,vn.unblended,Xr.disabled,((X,se)=>{const le=se.stride,de=i.bB();return i.cd(de,0,i.al,-i.al,0,0,1),i.bq(de,de,[0,-i.al,0]),{u_matrix:de,u_image:1,u_dimension:[le,le],u_zoom:X.overscaledZ}})(l.tileID,j),f.id,B,G,Z),l.needsHillshadePrepare=!1}class us{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class cA extends us{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Gw extends us{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class tR extends us{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class rR extends us{getDefault(){return[!0,!0,!0,!0]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class nR extends us{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class iR extends us{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class uA extends us{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const f=this.current;(l.func!==f.func||l.ref!==f.ref||l.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class sR extends us{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class __ extends us{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=l,this.dirty=!1}}class aR extends us{getDefault(){return[0,1]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class dA extends us{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=l,this.dirty=!1}}class Ww extends us{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class x_ extends us{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.BLEND):f.disable(f.BLEND),this.current=l,this.dirty=!1}}class Kw extends us{getDefault(){const l=this.gl;return[l.ONE,l.ZERO,l.ONE,l.ZERO]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.blendFuncSeparate(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class pf extends us{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class kp extends us{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(l,l),this.current=l,this.dirty=!1)}}class ty extends us{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=l,this.dirty=!1}}class Np extends us{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class hA extends us{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}let Zw=class extends us{getDefault(){return null}set(v){(v!==this.current||this.dirty)&&(this.gl.useProgram(v),this.current=v,this.dirty=!1)}};class fA extends us{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class Ip extends us{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class b_ extends us{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class w_ extends us{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Xw extends us{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class S_ extends us{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class ry extends us{getDefault(){return null}set(l){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class pA extends us{getDefault(){return null}set(l){this.gl&&(l!==this.current||this.dirty)&&(this.gl.bindVertexArray(l),this.current=l,this.dirty=!1)}}class mA extends us{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class gA extends us{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Rp extends us{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class E_ extends us{constructor(l,f){super(l),this.context=l,this.parent=f}getDefault(){return null}}class oR extends E_{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class yA extends E_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,this.attachment(),f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class lR extends E_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,this.attachment(),f.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Yw extends yA{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Jw=(v,l,f)=>({u_matrix:v,u_image0:0,u_skirt_height:l,u_ground_shadow_factor:f}),T_=(v,l,f,_,E,j,k,L,B,G,Z,Q,X,se,le,de)=>({u_proj_matrix:Float32Array.from(v),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:f,u_zoom_transition:E,u_merc_center:j,u_image0:0,u_frustum_tl:k,u_frustum_tr:L,u_frustum_br:B,u_frustum_bl:G,u_globe_pos:Z,u_globe_radius:Q,u_viewport:X,u_grid_matrix:de?Float32Array.from(de):new Float32Array(9),u_skirt_height:se,u_far_z_cutoff:le});function A_(v,l){return v!=null&&l!=null&&!(!v.hasData()||!l.hasData())&&v.demTexture!=null&&l.demTexture!=null&&v.tileID.key!==l.tileID.key}const mf=new class{constructor(){this.operations={}}newMorphing(v,l,f,_,E){if(v in this.operations){const j=this.operations[v];j.to.tileID.key!==f.tileID.key&&(j.queued=f)}else this.operations[v]={startTime:_,phase:0,duration:E,from:l,to:f,queued:null}}getMorphValuesForProxy(v){if(!(v in this.operations))return null;const l=this.operations[v];return{from:l.from,to:l.to,phase:l.phase}}update(v){for(const l in this.operations){const f=this.operations[l];for(f.phase=(v-f.startTime)/f.duration;f.phase>=1||!this._validOp(f);)if(!this._nextOp(f,v)){delete this.operations[l];break}}}_nextOp(v,l){return!!v.queued&&(v.from=v.to,v.to=v.queued,v.queued=null,v.phase=0,v.startTime=l,!0)}_validOp(v){return v.from.hasData()&&v.to.hasData()}},Qw={0:null,1:"TERRAIN_VERTEX_MORPHING"};function vA(v,l,f){if(l===0)return 0;const _=l<1&&f===514?.25/l:1;return 6*Math.pow(1.5,22-v)*Math.max(l,1)*_}function ny(v,l){const f=1<<v.z;return!l&&(v.x===0||v.x===f-1)||v.y===0||v.y===f-1}const gf=v=>({u_matrix:v});function C_(v,l,f,_,E){if(E>0){const j=i.o.now(),k=(j-v.timeAdded)/E,L=l?(j-l.timeAdded)/E:-1,B=f.getSource(),G=_.coveringZoomLevel({tileSize:B.tileSize,roundZoom:B.roundZoom}),Z=!l||Math.abs(l.tileID.overscaledZ-G)>Math.abs(v.tileID.overscaledZ-G),Q=Z&&v.refreshedUponExpiration?1:i.aA(Z?k:1-L,0,1);return l?{opacity:1,mix:1-Q,isFading:k<1}:{opacity:Q,mix:0,isFading:k<1}}return{opacity:1,mix:0,isFading:!1}}class Gl extends Sc{constructor(l){const f=nl("mock-dem",{type:"raster-dem",maxzoom:l.transform.maxZoom},l.style.dispatcher,l.style);super("mock-dem",f,!1),f.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,f){l.state="loaded",f(null)}}class e1 extends Sc{constructor(l){const f=nl("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},l.style.dispatcher,l.style);super("proxy",f,!1),f.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,f,_){if(l.freezeTileCoverage)return;this.transform=l;const E=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((j,k)=>{if(j[k.key]="",!this._tiles[k.key]){const L=new Cu(k,this._source.tileSize*k.overscaleFactor(),l.tileZoom,void 0,void 0,this._source.worldview);L.state="loaded",this._tiles[k.key]=L}return j},{});for(const j in this._tiles)j in E||(this.freeFBO(j),this._tiles[j].unloadVectorData(),delete this._tiles[j])}freeFBO(l){const f=this.proxyCachedFBO[l];if(f!==void 0){const _=Object.values(f);this.renderCachePool.push(..._),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class iy extends i.aP{constructor(l,f,_){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=f,this.projMatrix=_}}class sy extends i.bU{constructor(l,f){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},l.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,E,j]=function(B){const G=new i.bc,Z=new i.b0,Q=131;G.reserve(17161),Z.reserve(33800);const X=i.al/128,se=i.al+X/2,le=se+X;for(let xe=-X;xe<le;xe+=X)for(let ye=-X;ye<le;ye+=X){const Ee=ye<0||ye>se||xe<0||xe>se?24575:0,Ne=i.aA(Math.round(ye),0,i.al),je=i.aA(Math.round(xe),0,i.al);G.emplaceBack(Ne+Ee,je)}const de=(xe,ye)=>{const Ee=ye*Q+xe;Z.emplaceBack(Ee+1,Ee,Ee+Q),Z.emplaceBack(Ee+Q,Ee+Q+1,Ee+1)};for(let xe=1;xe<129;xe++)for(let ye=1;ye<129;ye++)de(ye,xe);return[0,129].forEach(xe=>{for(let ye=0;ye<130;ye++)de(ye,xe),de(xe,ye)}),[G,Z,32768]}(),k=l.context;this.gridBuffer=k.createVertexBuffer(_,i.be.members),this.gridIndexBuffer=k.createIndexBuffer(E),this.gridSegments=i.bf.simpleSegment(0,0,_.length,E.length),this.gridNoSkirtSegments=i.bf.simpleSegment(0,0,_.length,j),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new e1(f.map),this.orthoMatrix=i.bB(),i.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.al,0,i.al,0,1);const L=k.gl;this._overlapStencilMode=new tn({func:L.GEQUAL,mask:255},0,255,L.KEEP,L.KEEP,L.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=f,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Gl(f.map),this._pendingGroundEffectLayers=[]}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),this._style=l,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,f,_){if(l&&l.terrain){this._style!==l&&(this.style=l,this._evaluationZoom=void 0);const E=l.terrain.properties,j=l.terrain.drapeRenderMode===0,k=l.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.o.now();const L=l.terrain&&l.terrain.scope,B=E.get("source"),G=j?this._mockSourceCache:l.getSourceCache(B,L);if(!G)return void i.w(`Couldn't find terrain source "${B}".`);if(this.sourceCache=G,this._attenuationRange=l.terrain.getAttenuationRange(),this._exaggeration=k?this.calculateExaggeration(f):E.get("exaggeration"),!f.projection.requiresDraping&&k&&this._exaggeration===0)return void this._disable();this.enabled=!0;const Z=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Q=this.getScaledDemTileSize();this.sourceCache.update(f,Q,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,Z(),this._initializing=!0),Z(),f.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(f),this._emptyDEMTextureDirty=!0,this._previousZoom=f.zoom}else this._disable()}calculateExaggeration(l){if(this._attenuationRange&&l.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(l.zoom);const f=this._previousCameraAltitude,_=l.getFreeCameraOptions().position.z/l.pixelsPerMeter*l.worldSize;this._previousCameraAltitude=_;const E=f!=null?_-f:Number.MAX_VALUE;if(Math.abs(E)<2)return this._exaggeration;const j=l.zoom,k=this._style.terrain;if(!this._previousUpdateTimestamp)return k.getExaggeration(j);let L=j-this._previousZoom;const B=this._previousUpdateTimestamp;let G=j;this._evaluationZoom!=null&&(G=this._evaluationZoom,Math.abs(j-G)>.5&&(L=.5*(j-G+L)),L*E<0&&(G+=L)),this._evaluationZoom=G;const Z=k.getExaggeration(G),Q=Z===k.getExaggeration(Math.max(0,G-.1));if(Q&&Math.abs(Z-this._exaggeration)<.01)return Z;let X=Math.min(.1,.00375*(this._updateTimestamp-B));return(Q||Z<.1||Math.abs(L)<1e-4)&&(X=Math.min(.2,4*X)),i.ak(this._exaggeration,Z,X)}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(l){l.dataType==="source"&&l.coord?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):l.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._mergedSourceCaches)this._style._mergedSourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const f=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(i.ae.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const E=this.proxyCoords=f.getIds().map(B=>{const G=f.getTileByID(B).tileID;return G.projMatrix=_.calculateProjMatrix(G.toUnwrapped()),G});(function(B,G){const Z=G.transform.pointCoordinate(G.transform.getCameraPoint()),Q=new i.P(Z.x,Z.y);B.sort((X,se)=>{if(se.overscaledZ-X.overscaledZ)return se.overscaledZ-X.overscaledZ;const le=new i.P(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),de=new i.P(se.canonical.x+(1<<se.canonical.z)*se.wrap,se.canonical.y),xe=Q.mult(1<<X.canonical.z);return xe.x-=.5,xe.y-=.5,xe.distSqr(le)-xe.distSqr(de)})})(E,this.painter);const j=this.proxyToSource||{};this.proxyToSource={},E.forEach(B=>{this.proxyToSource[B.key]={}}),this.terrainTileForTile={};const k=this._style._mergedSourceCaches;for(const B in k){const G=k[B];if(!G.used||(G!==this.sourceCache&&this.resetTileLookupCache(G.id),this._setupProxiedCoordsForOrtho(G,l[B],j),G.usedForTerrain))continue;const Z=l[B];G.getSource().reparseOverscaled&&this._assignTerrainTiles(Z)}this.proxiedCoords[f.id]=E.map(B=>new iy(B,B.key,this.orthoMatrix)),this._assignTerrainTiles(E),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(j),this.renderingToTexture=!1;const L={};this._visibleDemTiles=[];for(const B of this.proxyCoords){const G=this.terrainTileForTile[B.key];if(!G)continue;const Z=G.tileID.key;Z in L||(this._visibleDemTiles.push(G),L[Z]=Z)}}_assignTerrainTiles(l){this._initializing||l.forEach(f=>{if(this.terrainTileForTile[f.key])return;const _=this._findTileCoveringTileID(f,this.sourceCache);_&&(this.terrainTileForTile[f.key]=_)})}_prepareDEMTextures(){const l=this.painter.context,f=l.gl;for(const _ in this.terrainTileForTile){const E=this.terrainTileForTile[_],j=E.dem;!j||E.demTexture&&!E.needsDEMTextureUpload||(l.activeTexture.set(f.TEXTURE1),v_(this.painter,E,j))}}_prepareDemTileUniforms(l,f,_,E){if(!f||f.demTexture==null)return!1;const j=l.tileID.canonical,k=Math.pow(2,f.tileID.canonical.z-j.z),L=E||"";return _[`u_dem_tl${L}`]=[j.x*k%1,j.y*k%1],_[`u_dem_scale${L}`]=k,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let l=0;const f=this._visibleDemTiles.reduce((_,E)=>{if(!E.dem)return _;const j=E.dem.tree.minimums[0];return j>0&&l++,_+j},0);return l?f/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,f=l.gl;l.activeTexture.set(f.TEXTURE2);const _=this._getLoadedAreaMinimum(),E=new i.dK({width:1,height:1},new Float32Array([_]));this._emptyDEMTextureDirty=!1;let j=this._emptyDEMTexture;return j?j.update(E,{premultiply:!1}):j=this._emptyDEMTexture=new i.T(l,E,f.R32F,{premultiply:!1}),j}setupElevationDraw(l,f,_){const E=this.painter.context,j=E.gl,k={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};k.u_exaggeration=this.exaggeration();let L=null,B=null,G=1;if(_&&_.morphing&&this._useVertexMorphing){const se=_.morphing.srcDemTile,le=_.morphing.dstDemTile;G=_.morphing.phase,se&&le&&(this._prepareDemTileUniforms(l,se,k,"_prev")&&(B=se),this._prepareDemTileUniforms(l,le,k)&&(L=le))}const Z=se=>se&&se.demTexture&&this.painter.linearFloatFilteringSupported()?j.LINEAR:j.NEAREST;let Q=null;var X;if(this.enabled?B&&L?(Q=L.demTexture,E.activeTexture.set(j.TEXTURE4),B.demTexture.bind(Z(B),j.CLAMP_TO_EDGE),k.u_dem_lerp=G):(L=this.terrainTileForTile[l.tileID.key],Q=this._prepareDemTileUniforms(l,L,k)?L.demTexture:this.emptyDEMTexture):Q=this.emptyDEMTexture,E.activeTexture.set(j.TEXTURE2),Q&&(k.u_dem_size=(X=Q).size[0]===1?1:X.size[0]-2,Q.bind(Z(L),j.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(_&&_.useDepthForOcclusion,f,k),_&&_.useMeterToDem&&L){const se=(1<<L.tileID.canonical.z)*i.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;k.u_meter_to_dem=se}if(_&&_.labelPlaneMatrixInv&&(k.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),f.setTerrainUniformValues(E,k),this.painter.transform.projection.name==="globe"){const se=this.globeUniformValues(this.painter.transform,l.tileID.canonical,_&&_.useDenormalizedUpVectorScale);f.setGlobeUniformValues(E,se)}}globeUniformValues(l,f,_){const E=l.projection;return{u_tile_tl_up:E.upVector(f,0,0),u_tile_tr_up:E.upVector(f,i.al,0),u_tile_br_up:E.upVector(f,i.al,i.al),u_tile_bl_up:E.upVector(f,0,i.al),u_tile_up_scale:_?i.dL(1):E.upVectorScale(f,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const f=this.painter,_=this.painter.context;l.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,f.width,f.height]),f.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(E,j,k,L,B){if(E.transform.projection.name==="globe")(function(G,Z,Q,X,se){const le=G.context,de=le.gl;let xe,ye;const Ee=G.transform,Ne=i.dD(G,le,Ee),je=(Et,yt)=>{if(ye===yt)return;const Nt=[Qw[yt],"PROJECTION_GLOBE_VIEW"];Ne&&Nt.push("CUSTOM_ANTIALIASING");const Xt=G.isTileAffectedByFog(Et);xe=G.getOrCreateProgram("globeRaster",{defines:Nt,overrideFog:Xt}),ye=yt},Ve=G.colorModeForRenderPass(),Ie=new Er(de.LEQUAL,Er.ReadWrite,G.depthRangeFor3D);mf.update(se);const Ge=i.dE(Ee),$e=[i.aF(Ee.center.lng),i.aJ(Ee.center.lat)],Le=G.globeSharedBuffers,Ke=[Ee.width*i.o.devicePixelRatio,Ee.height*i.o.devicePixelRatio],dt=Float32Array.from(Ee.globeMatrix),at={useDenormalizedUpVectorScale:!0};{const Et=G.transform,yt=vA(Et.zoom,Z.exaggeration(),Z.sourceCache._source.tileSize);ye=-1;const Nt=de.TRIANGLES;for(const Xt of X){const mt=Q.getTile(Xt),tt=tn.disabled,It=Z.prevTerrainTileForTile[Xt.key],vt=Z.terrainTileForTile[Xt.key];A_(It,vt)&&mf.newMorphing(Xt.key,It,vt,se,250),le.activeTexture.set(de.TEXTURE0),mt.texture&&mt.texture.bind(de.LINEAR,de.CLAMP_TO_EDGE);const Bt=mf.getMorphValuesForProxy(Xt.key),rr=Bt?1:0;Bt&&Object.assign(at,{morphing:{srcDemTile:Bt.from,dstDemTile:Bt.to,phase:i.dC(Bt.phase)}});const xr=i.dF(Xt.canonical),Wt=i.dG(xr.getCenter().lat),Jt=i.dH(Xt.canonical,xr,Wt,Et.worldSize/Et._pixelsPerMercatorPixel),wr=i.bj(i.dI(Xt.canonical)),pr=T_(Et.expandedFarZProjMatrix,dt,Ge,wr,i.aj(Et.zoom),$e,Et.frustumCorners.TL,Et.frustumCorners.TR,Et.frustumCorners.BR,Et.frustumCorners.BL,Et.globeCenterInViewSpace,Et.globeRadius,Ke,yt,Et._farZ,Jt);if(je(Xt,rr),xe&&(Z.setupElevationDraw(mt,xe,at),G.uploadCommonUniforms(le,xe,Xt.toUnwrapped()),Le)){const[dr,mr,$r]=Le.getGridBuffers(Wt,yt!==0);xe.draw(G,Nt,Ie,tt,Ve,Xr.backCCW,pr,"globe_raster",dr,mr,$r)}}}if(Le&&(G.renderDefaultNorthPole||G.renderDefaultSouthPole)){const Et=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Ne&&Et.push("CUSTOM_ANTIALIASING"),xe=G.getOrCreateProgram("globeRaster",{defines:Et});for(const yt of X){const{x:Nt,y:Xt,z:mt}=yt.canonical,tt=Xt===0,It=Xt===(1<<mt)-1,[vt,Bt,rr,xr]=Le.getPoleBuffers(mt,!1);if(xr&&(tt||It)){const Wt=Q.getTile(yt);le.activeTexture.set(de.TEXTURE0),Wt.texture&&Wt.texture.bind(de.LINEAR,de.CLAMP_TO_EDGE);let Jt=i.dJ(mt,Nt,Ee);const wr=i.bj(i.dI(yt.canonical)),pr=(dr,mr)=>dr.draw(G,de.TRIANGLES,Ie,tn.disabled,Ve,Xr.disabled,T_(Ee.expandedFarZProjMatrix,Jt,Jt,wr,0,$e,Ee.frustumCorners.TL,Ee.frustumCorners.TR,Ee.frustumCorners.BR,Ee.frustumCorners.BL,Ee.globeCenterInViewSpace,Ee.globeRadius,Ke,0,Ee._farZ),"globe_pole_raster",mr,rr,xr);Z.setupElevationDraw(Wt,xe,at),G.uploadCommonUniforms(le,xe,yt.toUnwrapped()),tt&&G.renderDefaultNorthPole&&pr(xe,vt),It&&G.renderDefaultSouthPole&&(Jt=i.cR(i.bB(),Jt,[1,-1,1]),pr(xe,Bt))}}}})(E,j,k,L,B);else{const G=E.context,Z=G.gl;let Q,X;const se=E.shadowRenderer,le=dd(E,E.longestCutoffRange),de=Ve=>{if(X===Ve)return;const Ie=[];Ie.push(Qw[Ve]),le.shouldRenderCutoff&&Ie.push("RENDER_CUTOFF"),se&&(Ie.push("RENDER_SHADOWS","DEPTH_TEXTURE"),se.useNormalOffset&&Ie.push("NORMAL_OFFSET")),Q=E.getOrCreateProgram("terrainRaster",{defines:Ie}),X=Ve},xe=E.colorModeForRenderPass(),ye=new Er(Z.LEQUAL,Er.ReadWrite,E.depthRangeFor3D);mf.update(B);const Ee=E.transform,Ne=vA(Ee.zoom,j.exaggeration(),j.sourceCache._source.tileSize);let je=[0,0,0];if(se){const Ve=E.style.directionalLight,Ie=E.style.ambientLight;Ve&&Ie&&(je=Ac(E.style,Ve,Ie))}{X=-1;const Ve=Z.TRIANGLES,[Ie,Ge]=[j.gridIndexBuffer,j.gridSegments];for(const $e of L){const Le=k.getTile($e),Ke=tn.disabled,dt=j.prevTerrainTileForTile[$e.key],at=j.terrainTileForTile[$e.key];A_(dt,at)&&mf.newMorphing($e.key,dt,at,B,250),G.activeTexture.set(Z.TEXTURE0),Le.texture&&Le.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const Et=mf.getMorphValuesForProxy($e.key),yt=Et?1:0;let Nt;Et&&(Nt={morphing:{srcDemTile:Et.from,dstDemTile:Et.to,phase:i.dC(Et.phase)}});const Xt=Jw($e.projMatrix,ny($e.canonical,Ee.renderWorldCopies)?Ne/10:Ne,je);if(de(yt),!Q)continue;j.setupElevationDraw(Le,Q,Nt);const mt=$e.toUnwrapped();se&&se.setupShadows(mt,Q),E.uploadCommonUniforms(G,Q,mt,null,le),Q.draw(E,Ve,ye,Ke,xe,Xr.backCCW,Xt,"terrain_raster",j.gridBuffer,Ie,Ge)}}}}(f,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,f.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(this._drapedRenderBatches.length===0)return l+1;this.renderingToTexture=!0;const f=this.painter,_=this.painter.context,E=this.proxySourceCache,j=this.proxiedCoords[E.id],k=this._drapedRenderBatches.shift(),L=f.style.order,B=[];let G=0;for(const Z of j){const Q=E.getTileByID(Z.proxyTileKey),X=E.proxyCachedFBO[Z.key]?E.proxyCachedFBO[Z.key][l]:void 0,se=X!==void 0?E.renderCache[X]:this.pool[G++],le=X!==void 0;if(Q.texture=se.tex,le&&!se.dirty){B.push(Q.tileID);continue}let de;_.bindFramebuffer.set(se.fb.framebuffer),this.renderedToTile=!1,se.dirty&&(_.clear({color:i.ao.transparent,stencil:0}),se.dirty=!1);for(let xe=k.start;xe<=k.end;++xe){const ye=f.style._mergedLayers[L[xe]];if(ye.isHidden(f.transform.zoom))continue;const Ee=f.style.getLayerSourceCache(ye),Ne=Ee?this.proxyToSource[Z.key][Ee.id]:[Z];if(!Ne)continue;const je=Ne;_.viewport.set([0,0,se.fb.width,se.fb.height]),de!==(Ee?Ee.id:null)&&(this._setupStencil(se,Ne,ye,Ee),de=Ee?Ee.id:null),f.renderLayer(f,Ee,ye,je)}if(this._drapedRenderBatches.length===0)for(const xe of this._pendingGroundEffectLayers){const ye=f.style._mergedLayers[L[xe]];if(ye.isHidden(f.transform.zoom))continue;const Ee=f.style.getLayerSourceCache(ye),Ne=Ee?this.proxyToSource[Z.key][Ee.id]:[Z];if(!Ne)continue;const je=Ne;_.viewport.set([0,0,se.fb.width,se.fb.height]),de!==(Ee?Ee.id:null)&&(this._setupStencil(se,Ne,ye,Ee),de=Ee?Ee.id:null),f.renderLayer(f,Ee,ye,je)}this.renderedToTile?(se.dirty=!0,B.push(Q.tileID)):le||--G,G===5&&(G=0,this.renderToBackBuffer(B))}return this.renderToBackBuffer(B),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,f.width,f.height]),k.end+1}postRender(){}isLayerOrderingCorrect(l){const f=l.order.length;let _=-1,E=f;for(let j=0;j<f;++j)this._style.isLayerDraped(l._mergedLayers[l.order[j]])?_=Math.max(_,j):E=Math.min(E,j);return E>_}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(f=>f.dem).forEach(f=>{l=Math.min(l,f.dem.tree.minimums[0])}),l===0?l:(l-30)*this._exaggeration}raycast(l,f,_){if(!this._visibleDemTiles)return null;const E=this._visibleDemTiles.filter(j=>j.dem).map(j=>{const k=j.tileID,L=1<<k.overscaledZ,{x:B,y:G}=k.canonical,Z=B/L,Q=(B+1)/L,X=G/L,se=(G+1)/L;return{minx:Z,miny:X,maxx:Q,maxy:se,t:j.dem.tree.raycastRoot(Z,X,Q,se,l,f,_),tile:j}});E.sort((j,k)=>(j.t!==null?j.t:Number.MAX_VALUE)-(k.t!==null?k.t:Number.MAX_VALUE));for(const j of E){if(j.t==null)return null;const k=j.tile.dem.tree.raycast(j.minx,j.miny,j.maxx,j.maxy,l,f,_);if(k!=null)return k}return null}_createFBO(){const l=this.painter.context,f=l.gl,_=this.drapeBufferSize;l.activeTexture.set(f.TEXTURE0);const E=new i.T(l,{width:_[0],height:_[1],data:null},f.RGBA8);E.bind(f.LINEAR,f.CLAMP_TO_EDGE);const j=l.createFramebuffer(_[0],_[1],!0,null);return j.colorAttachment.set(E.texture),j.depthAttachment=new Yw(l,j.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,j.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):j.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&f.texParameterf(f.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:j,tex:E,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const l in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const f=this._style._mergedLayers[l],_=f.isHidden(this.painter.transform.zoom);return f.type==="hillshade"||f.type==="custom"?!_&&f.shouldRedrape():!_&&f.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(const _ of this._style.getSources())if(_ instanceof zo){l=!0;break}if(!l)return;const f={};for(let _=0;_<this._style.order.length;++_){const E=this._style._mergedLayers[this._style.order[_]],j=this._style.getLayerSourceCache(E);if(j&&!f[j.id]&&!E.isHidden(this.painter.transform.zoom)&&E.type==="line"&&E.widthExpression()instanceof i.ad){f[j.id]=!0;for(const k of this.proxyCoords){const L=this.proxyToSource[k.key][j.id];if(L)for(const B of L)this._clearRenderCacheForTile(j.id,B)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(const _ in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[_]._source instanceof bc){l=!0;break}if(!l)return;const f={};for(let _=0;_<this._style.order.length;++_){const E=this._style._mergedLayers[this._style.order[_]],j=this._style.getLayerSourceCache(E);if(!j||f[j.id]||E.isHidden(this.painter.transform.zoom)||E.type!=="raster")continue;const k=E.paint.get("raster-fade-duration");for(const L of this.proxyCoords){const B=this.proxyToSource[L.key][j.id];if(B)for(const G of B){const Z=C_(j.getTile(G),j.findLoadedParent(G,0),j,this.painter.transform,k);(Z.opacity!==1||Z.mix!==0)&&this._clearRenderCacheForTile(j.id,G)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const l=this._style.order,f=l.length;if(f===0)return;const _=[];this._pendingGroundEffectLayers=[];let E,j=0,k=this._style._mergedLayers[l[j]];for(;!this._style.isLayerDraped(k)&&k.isHidden(this.painter.transform.zoom)&&++j<f;)k=this._style._mergedLayers[l[j]];for(;j<f;++j){const L=this._style._mergedLayers[l[j]];L.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(L)?E===void 0&&(E=j):(L.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(j),E!==void 0&&(_.push({start:E,end:j-1}),E=void 0)))}if(E!==void 0&&_.push({start:E,end:j-1}),_.length!==0){const L=_[_.length-1];this._pendingGroundEffectLayers.every(B=>B>L.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=_}_setupRenderCache(l){const f=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,f.renderCache.length>f.renderCachePool.length){const k=Object.values(f.proxyCachedFBO);f.proxyCachedFBO={};for(let L=0;L<k.length;++L){const B=Object.values(k[L]);f.renderCachePool.push(...B)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,E=this._tilesDirty;for(let k=_.length-1;k>=0;k--){const L=_[k];if(f.getTileByID(L.key),f.proxyCachedFBO[L.key]!==void 0){const B=l[L.key],G=this.proxyToSource[L.key];let Z=0;for(const Q in G){const X=G[Q],se=B[Q];if(!se||se.length!==X.length||X.some((le,de)=>le!==se[de]||E[Q]&&E[Q].hasOwnProperty(le.key))){Z=-1;break}++Z}for(const Q in f.proxyCachedFBO[L.key])f.renderCache[f.proxyCachedFBO[L.key][Q]].dirty=Z<0||Z!==Object.values(B).length}}const j=[...this._drapedRenderBatches];j.sort((k,L)=>L.end-L.start-(k.end-k.start));for(const k of j)for(const L of _){if(f.proxyCachedFBO[L.key])continue;let B=f.renderCachePool.pop();B===void 0&&f.renderCache.length<50&&(B=f.renderCache.length,f.renderCache.push(this._createFBO())),B!==void 0&&(f.proxyCachedFBO[L.key]={},f.proxyCachedFBO[L.key][k.start]=B,f.renderCache[B].dirty=!0)}this._tilesDirty={}}_setupStencil(l,f,_,E){if(!E||!this._sourceTilesOverlap[E.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const j=this.painter.context,k=j.gl;if(f.length<=1)return void(this._overlapStencilType=!1);let L;if(_.isTileClipped())L=f.length,this._overlapStencilMode.test={func:k.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(f[0].overscaledZ>f[f.length-1].overscaledZ))return void(this._overlapStencilType=!1);L=1,this._overlapStencilMode.test={func:k.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+L>255&&(j.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=L,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(f,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):tn.disabled}_renderTileClippingMasks(l,f){const _=this.painter,E=this.painter.context,j=E.gl;_._tileClippingMaskIDs={},E.setColorMode(vn.disabled),E.setDepthMode(Er.disabled);const k=_.getOrCreateProgram("clippingMask");for(const L of l){const B=_._tileClippingMaskIDs[L.key]=--f;k.draw(_,j.TRIANGLES,Er.disabled,new tn({func:j.ALWAYS,mask:0},B,255,j.KEEP,j.KEEP,j.REPLACE),vn.disabled,Xr.disabled,gf(L.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(l){const f=this.painter.transform;if(l.x<0||l.x>f.width||l.y<0||l.y>f.height)return null;const _=[l.x,l.y,1,1];i.aC(_,_,f.pixelMatrixInverse),i.cJ(_,_,1/_[3]),_[0]/=f.worldSize,_[1]/=f.worldSize;const E=f._camera.position,j=i.ce(1,f.center.lat),k=[E[0],E[1],E[2]/j,0],L=i.d9([],_.slice(0,3),k);i.aw(L,L);const B=this.raycast(k,L,this._exaggeration);return B!==null&&B?(i.bG(k,k,L,B),k[3]=k[2],k[2]*=j,k):null}_setupProxiedCoordsForOrtho(l,f,_){if(l.getSource()instanceof i.aT)return this._setupProxiedCoordsForImageSource(l,f,_);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const E=this.proxiedCoords[l.id]=[],j=this.proxyCoords;for(let B=0;B<j.length;B++){const G=j[B],Z=this._findTileCoveringTileID(G,l);if(Z){const Q=this._createProxiedId(G,Z,_[G.key]&&_[G.key][l.id]);E.push(Q),this.proxyToSource[G.key][l.id]=[Q]}}let k=!1;const L=new Set;for(let B=0;B<f.length;B++){const G=l.getTile(f[B]);if(!G||!G.hasData())continue;const Z=this._findTileCoveringTileID(G.tileID,this.proxySourceCache);if(Z&&Z.tileID.canonical.z!==G.tileID.canonical.z){const Q=this.proxyToSource[Z.tileID.key][l.id],X=this._createProxiedId(Z.tileID,G,_[Z.tileID.key]&&_[Z.tileID.key][l.id]);Q?Q.splice(Q.length-1,0,X):this.proxyToSource[Z.tileID.key][l.id]=[X];const se=this.proxyToSource[Z.tileID.key][l.id];L.has(se)||L.add(se),E.push(X),k=!0}}if(this._sourceTilesOverlap[l.id]=k,k&&this._debugParams.sortTilesHiZFirst)for(const B of L)B.sort((G,Z)=>Z.overscaledZ-G.overscaledZ)}_setupProxiedCoordsForImageSource(l,f,_){if(!l.getSource().loaded())return;const E=this.proxiedCoords[l.id]=[],j=this.proxyCoords,k=l.getSource(),L=k.tileID;if(!L)return;const B=new i.P(L.x,L.y)._div(1<<L.z),G=k.coordinates.map(i.ae.fromLngLat).reduce((Q,X)=>(Q.min.x=Math.min(Q.min.x,X.x-B.x),Q.min.y=Math.min(Q.min.y,X.y-B.y),Q.max.x=Math.max(Q.max.x,X.x-B.x),Q.max.y=Math.max(Q.max.y,X.y-B.y),Q),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),Z=(Q,X)=>{const se=Q.wrap+Q.canonical.x/(1<<Q.canonical.z),le=Q.canonical.y/(1<<Q.canonical.z),de=i.al/(1<<Q.canonical.z),xe=X.wrap+X.canonical.x/(1<<X.canonical.z),ye=X.canonical.y/(1<<X.canonical.z);return se+de<xe+G.min.x||se>xe+G.max.x||le+de<ye+G.min.y||le>ye+G.max.y};for(let Q=0;Q<j.length;Q++){const X=j[Q];for(let se=0;se<f.length;se++){const le=l.getTile(f[se]);if(!le||!le.hasData()||Z(X,le.tileID))continue;const de=this._createProxiedId(X,le,_[X.key]&&_[X.key][l.id]),xe=this.proxyToSource[X.key][l.id];xe?xe.push(de):this.proxyToSource[X.key][l.id]=[de],E.push(de)}}}_createProxiedId(l,f,_){let E=this.orthoMatrix;if(_){const j=_.find(k=>k.key===f.tileID.key);if(j)return j}if(f.tileID.key!==l.key){const j=l.canonical.z-f.tileID.canonical.z;let k,L,B;E=i.bB();const G=f.tileID.wrap-l.wrap<<l.overscaledZ;j>0?(k=i.al>>j,L=k*((f.tileID.canonical.x<<j)-l.canonical.x+G),B=k*((f.tileID.canonical.y<<j)-l.canonical.y)):(k=i.al<<-j,L=i.al*(f.tileID.canonical.x-(l.canonical.x+G<<-j)),B=i.al*(f.tileID.canonical.y-(l.canonical.y<<-j))),i.cd(E,0,k,0,k,0,1),i.bq(E,E,[L,B,0])}return new iy(f.tileID,l.key,E)}_findTileCoveringTileID(l,f){let _=f.getTile(l);if(_&&_.hasData())return _;const E=this._findCoveringTileCache[f.id],j=E[l.key];if(_=j?f.getTileByID(j):null,_&&_.hasData()||j===null)return _;let k=_?_.tileID:l,L=k.overscaledZ;const B=f.getSource().minzoom,G=[];if(!j){const Q=f.getSource().maxzoom;if(l.canonical.z>=Q){const X=l.canonical.z-Q;f.getSource().reparseOverscaled?(L=Math.max(l.canonical.z+2,f.transform.tileZoom),k=new i.aP(L,l.wrap,Q,l.canonical.x>>X,l.canonical.y>>X)):X!==0&&(L=Q,k=new i.aP(L,l.wrap,Q,l.canonical.x>>X,l.canonical.y>>X))}k.key!==l.key&&(G.push(k.key),_=f.getTile(k))}const Z=Q=>{G.forEach(X=>{E[X]=Q}),G.length=0};for(L-=1;L>=B&&(!_||!_.hasData());L--){_&&Z(_.tileID.key);const Q=k.calculateScaledKey(L);if(_=f.getTileByID(Q),_&&_.hasData())break;const X=E[Q];if(X===null)break;X===void 0?G.push(Q):_=f.getTileByID(X)}return Z(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,f){let _=this._tilesDirty[l];_||(_=this._tilesDirty[l]={}),_[f.key]=!0}}function t1(v,l,f){const _=function(L,B,G){const Z=i.bI(B,L),Q=i.bI(G,[.2126,.7152,.0722]),X=(le,de,xe)=>(1-xe)*le+xe*de,se=X(1-.3*Math.min(Q,1),1,Math.min(Z+1,1));return X(.92,1,Math.asin(i.aA(B[2],-1,1))/Math.PI+.5)*se}(v,[0,0,1],l),E=[0,0,0];i.c4(E,f.slice(0,3),_);const j=[0,0,0];i.c4(j,l.slice(0,3),v[2]);const k=[0,0,0];return i.d7(k,E,j),i.da(k)}const r1=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],n1=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class ay{static cacheKey(l,f,_,E){let j=`${f}${E?E.cacheKey:""}`;for(const k of _)l.usedDefines.includes(k)&&(j+=`/${k}`);return j}constructor(l,f,_,E,j,k){const L=l.gl;this.program=L.createProgram(),this.configuration=E,this.name=f,this.fixedDefines=[...k];let B=E?E.defines():[];B=B.concat(k.map(le=>`#define ${le}`));const G=`#version 300 es
`;let Z=G+B.concat("precision mediump float;",Ou,ey.fragmentSource).join(`
`);for(const le of _.fragmentIncludes)Z+=`
${Pp[le]}`;Z+=`
${_.fragmentSource}`;let Q=G+B.concat("precision highp float;",Ou,ey.vertexSource).join(`
`);for(const le of _.vertexIncludes)Q+=`
${Pp[le]}`;this.forceManualRenderingForInstanceIDShaders=l.forceManualRenderingForInstanceIDShaders&&_.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(Q+=`
uniform int u_instanceID;
`),Q+=`
${_.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(Q=Q.replaceAll("gl_InstanceID","u_instanceID"));const X=L.createShader(L.FRAGMENT_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);L.shaderSource(X,Z),L.compileShader(X),L.attachShader(this.program,X);const se=L.createShader(L.VERTEX_SHADER);L.isContextLost()?this.failedToCreate=!0:(L.shaderSource(se,Q),L.compileShader(se),L.attachShader(this.program,se),this.attributes={},L.linkProgram(this.program),L.deleteShader(se),L.deleteShader(X),this.fixedUniforms=j(l),this.binderUniforms=E?E.getUniforms(l):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(le=>({u_instanceID:new i.cg(le)}))(l)),(k.includes("TERRAIN")||f.indexOf("symbol")!==-1||f.indexOf("circle")!==-1)&&(this.terrainUniforms=(le=>({u_dem:new i.cg(le),u_dem_prev:new i.cg(le),u_dem_tl:new i.cj(le),u_dem_scale:new i.ci(le),u_dem_tl_prev:new i.cj(le),u_dem_scale_prev:new i.ci(le),u_dem_size:new i.ci(le),u_dem_lerp:new i.ci(le),u_exaggeration:new i.ci(le),u_depth:new i.cg(le),u_depth_size_inv:new i.cj(le),u_depth_range_unpack:new i.cj(le),u_occluder_half_size:new i.ci(le),u_occlusion_depth_offset:new i.ci(le),u_meter_to_dem:new i.ci(le),u_label_plane_matrix_inv:new i.ck(le)}))(l)),k.includes("GLOBE")&&(this.globeUniforms=(le=>({u_tile_tl_up:new i.ch(le),u_tile_tr_up:new i.ch(le),u_tile_br_up:new i.ch(le),u_tile_bl_up:new i.ch(le),u_tile_up_scale:new i.ci(le)}))(l)),k.includes("FOG")&&(this.fogUniforms=(le=>({u_fog_matrix:new i.ck(le),u_fog_range:new i.cj(le),u_fog_color:new i.d2(le),u_fog_horizon_blend:new i.ci(le),u_fog_vertical_limit:new i.cj(le),u_fog_temporal_offset:new i.ci(le),u_frustum_tl:new i.ch(le),u_frustum_tr:new i.ch(le),u_frustum_br:new i.ch(le),u_frustum_bl:new i.ch(le),u_globe_pos:new i.ch(le),u_globe_radius:new i.ci(le),u_globe_transition:new i.ci(le),u_is_globe:new i.cg(le),u_viewport:new i.cj(le)}))(l)),k.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(le=>({u_cutoff_params:new i.d2(le)}))(l)),k.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(le=>({u_lighting_ambient_color:new i.ch(le),u_lighting_directional_dir:new i.ch(le),u_lighting_directional_color:new i.ch(le),u_ground_radiance:new i.ch(le)}))(l)),k.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(le=>({u_light_matrix_0:new i.ck(le),u_light_matrix_1:new i.ck(le),u_fade_range:new i.cj(le),u_shadow_normal_offset:new i.ch(le),u_shadow_intensity:new i.ci(le),u_shadow_texel_size:new i.ci(le),u_shadow_map_resolution:new i.ci(le),u_shadow_direction:new i.ch(le),u_shadow_bias:new i.ch(le),u_shadowmap_0:new i.cg(le),u_shadowmap_1:new i.cg(le)}))(l)))}getAttributeLocation(l,f){let _=this.attributes[f];return _===void 0&&(_=this.attributes[f]=l.getAttribLocation(this.program,f)),_}setTerrainUniformValues(l,f){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const E in f)_[E]&&_[E].set(this.program,E,f[E])}}setGlobeUniformValues(l,f){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const E in f)_[E]&&_[E].set(this.program,E,f[E])}}setFogUniformValues(l,f){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const E in f)_[E].set(this.program,E,f[E])}}setCutoffUniformValues(l,f){if(!this.cutoffUniforms)return;const _=this.cutoffUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const E in f)_[E].set(this.program,E,f[E])}}setLightsUniformValues(l,f){if(!this.lightsUniforms)return;const _=this.lightsUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const E in f)_[E].set(this.program,E,f[E])}}setShadowUniformValues(l,f){if(this.failedToCreate||!this.shadowUniforms)return;const _=this.shadowUniforms;l.program.set(this.program);for(const E in f)_[E].set(this.program,E,f[E])}_drawDebugWireframe(l,f,_,E,j,k,L,B,G,Z){const Q=l.options.wireframe;if(Q.terrain===!1&&Q.layers2D===!1&&Q.layers3D===!1)return;const X=l.context;if(!(!(!Q.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!Q.layers2D||l._terrain&&l._terrain.renderingToTexture||!r1.includes(this.name))||!(!Q.layers3D||!n1.includes(this.name))))return;const se=X.gl,le=l.wireframeDebugCache.getLinesFromTrianglesBuffer(l.frameCounter,j,X);if(!le)return;const de=[...this.fixedDefines];de.push("DEBUG_WIREFRAME");const xe=l.getOrCreateProgram(this.name,{config:this.configuration,defines:de});X.program.set(xe.program);const ye=(je,Ve,Ie)=>{if(Ve[je]&&Ie[je])for(const Ge in Ve[je])Ie[je][Ge]&&Ie[je][Ge].set(Ie.program,Ge,Ve[je][Ge].current)};G&&G.setUniforms(xe.program,X,xe.binderUniforms,L,{zoom:B}),ye("fixedUniforms",this,xe),ye("terrainUniforms",this,xe),ye("globeUniforms",this,xe),ye("fogUniforms",this,xe),ye("lightsUniforms",this,xe),ye("shadowUniforms",this,xe),le.bind(),X.setColorMode(new vn([se.ONE,se.ONE_MINUS_SRC_ALPHA,se.ZERO,se.ONE],i.ao.transparent,[!0,!0,!0,!1])),X.setDepthMode(new Er(f.func===se.LESS?se.LEQUAL:f.func,Er.ReadOnly,f.range)),X.setStencilMode(tn.disabled);const Ee=3*k.primitiveLength*2,Ne=3*k.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const je=Z||1;for(let Ve=0;Ve<je;++Ve)xe.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ve),se.drawElements(se.LINES,Ee,se.UNSIGNED_SHORT,Ne)}else Z&&Z>1?se.drawElementsInstanced(se.LINES,Ee,se.UNSIGNED_SHORT,Ne,Z):se.drawElements(se.LINES,Ee,se.UNSIGNED_SHORT,Ne);j.bind(),X.program.set(this.program),X.setDepthMode(f),X.setStencilMode(_),X.setColorMode(E)}checkUniforms(l,f,_){if(this.fixedDefines.includes(f)){for(const E of Object.keys(_))if(!_[E].initialized)throw new Error(`Program '${this.name}', from draw '${l}': uniform ${E} not set but required by ${f} being defined`)}}draw(l,f,_,E,j,k,L,B,G,Z,Q,X,se,le,de,xe){const ye=l.context,Ee=ye.gl;if(this.failedToCreate)return;ye.program.set(this.program),ye.setDepthMode(_),ye.setStencilMode(E),ye.setColorMode(j),ye.setCullFace(k);for(const Ve of Object.keys(this.fixedUniforms))this.fixedUniforms[Ve].set(this.program,Ve,L[Ve]);le&&le.setUniforms(this.program,ye,this.binderUniforms,X,{zoom:se});const Ne={[Ee.POINTS]:1,[Ee.LINES]:2,[Ee.TRIANGLES]:3,[Ee.LINE_STRIP]:1}[f];this.checkUniforms(B,"RENDER_SHADOWS",this.shadowUniforms);const je=xe&&xe>0?1:void 0;for(const Ve of Q.get()){const Ie=Ve.vaos||(Ve.vaos={});if((Ie[B]||(Ie[B]=new Op)).bind(ye,this,G,le?le.getPaintVertexBuffers():[],Z,Ve.vertexOffset,de||[],je),this.forceManualRenderingForInstanceIDShaders){const Ge=xe||1;for(let $e=0;$e<Ge;++$e)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",$e),Z?Ee.drawElements(f,Ve.primitiveLength*Ne,Ee.UNSIGNED_SHORT,Ve.primitiveOffset*Ne*2):Ee.drawArrays(f,Ve.vertexOffset,Ve.vertexLength)}else xe&&xe>1?Ee.drawElementsInstanced(f,Ve.primitiveLength*Ne,Ee.UNSIGNED_SHORT,Ve.primitiveOffset*Ne*2,xe):Z?Ee.drawElements(f,Ve.primitiveLength*Ne,Ee.UNSIGNED_SHORT,Ve.primitiveOffset*Ne*2):Ee.drawArrays(f,Ve.vertexOffset,Ve.vertexLength);f===Ee.TRIANGLES&&Z&&this._drawDebugWireframe(l,_,E,j,Z,Ve,X,se,le,xe)}}}function j_(v,l,f=0){const _=Math.pow(2,l.tileID.overscaledZ),E=l.tileSize*Math.pow(2,v.transform.tileZoom)/_,j=E*(l.tileID.canonical.x+l.tileID.wrap*_),k=E*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture?l.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.ay(l,1,v.transform.tileZoom),u_pixel_coord_upper:[j>>16,k>>16],u_pixel_coord_lower:[65535&j,65535&k],u_pattern_transition:f}}const Mp={terrain:0,flat:1},P_=i.bB(),O_=(v,l,f,_,E,j,k,L,B,G,Z,Q,X,se,le,de,xe,ye)=>{const Ee=l.style.light,Ne=Ee.properties.get("position"),je=[Ne.x,Ne.y,Ne.z],Ve=i.dN();Ee.properties.get("anchor")==="viewport"&&(i.dO(Ve,-l.transform.angle),i.dP(je,je,Ve));const Ie=Ee.properties.get("color").toPremultipliedRenderColor(null),Ge=l.transform,$e={u_matrix:v,u_lightpos:je,u_lightintensity:Ee.properties.get("intensity"),u_lightcolor:[Ie.r,Ie.g,Ie.b],u_vertical_gradient:+f,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:P_,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Mp[G],u_base_type:Mp[Z],u_ao:E,u_edge_radius:j,u_width_scale:k,u_flood_light_color:le,u_vertical_scale:de,u_flood_light_intensity:xe,u_ground_shadow_factor:ye};return Ge.projection.name==="globe"&&($e.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],$e.u_zoom_transition=Q,$e.u_inv_rot_matrix=se,$e.u_merc_center=X,$e.u_up_dir=Ge.projection.upVector(new i.cC(0,0,0),X[0]*i.al,X[1]*i.al),$e.u_height_lift=B),$e},_A=(v,l,f,_,E,j)=>({u_matrix:v,u_edge_radius:l,u_width_scale:f,u_vertical_scale:_,u_height_type:Mp[E],u_base_type:Mp[j]}),xA=(v,l,f,_,E,j,k,L,B,G,Z,Q,X,se,le,de,xe,ye)=>{const Ee=O_(v,l,f,_,E,j,k,L,G,Z,Q,X,se,le,de,xe,1,[0,0,0]),Ne={u_height_factor:-Math.pow(2,L.overscaledZ)/B.tileSize/8};return Object.assign(Ee,j_(l,B,ye),Ne)},Dp=(v,l,f,_,E,j,k,L,B,G,Z)=>({u_matrix:l,u_opacity:f,u_ao_pass:_?1:0,u_meter_to_tile:E,u_ao:j,u_flood_light_intensity:k,u_flood_light_color:L,u_attenuation:B,u_edge_radius:G,u_fb:0,u_fb_size:Z,u_dynamic_offset:1}),bA=(v,l,f)=>({u_matrix:v,u_emissive_strength:l,u_ground_shadow_factor:f}),wA=(v,l,f,_,E,j=0)=>Object.assign(bA(v,l,E),j_(f,_,j)),cR=(v,l,f,_)=>({u_matrix:v,u_world:f,u_emissive_strength:l,u_ground_shadow_factor:_}),uR=(v,l,f,_,E,j,k=0)=>Object.assign(wA(v,l,f,_,j,k),{u_world:E}),dR=(v,l)=>({u_matrix:v,u_ground_shadow_factor:l}),k_=(v,l,f,_,E)=>({u_matrix:v,u_camera_pos:[l[0],l[1],l[2]],u_depth_bias:f,u_height_scale:_,u_reset_depth:E}),i1=(v,l,f,_,E,j,k,L,B)=>({u_matrix:v,u_normal_matrix:l,u_opacity:f,u_faux_facade_ao_intensity:_,u_camera_pos:E,u_tile_to_meter:j,u_facade_emissive_chance:k,u_flood_light_color:L,u_flood_light_intensity:B}),s1=v=>({u_matrix:v}),SA=v=>({u_matrix:v}),Lp=(v,l,f,_,E,j,k,L)=>{const B=i.al/j.tileSize;return{u_matrix:v,u_inv_rot_matrix:l,u_camera_to_center_distance:f.getCameraToCenterDistance(L),u_extrude_scale:[f.pixelsToGLUnits[0]/B,f.pixelsToGLUnits[1]/B],u_zoom_transition:_,u_tile_id:k,u_merc_center:E}},a1=(v,l,f=1)=>({u_matrix:v,u_color:l,u_overlay:0,u_overlay_scale:f}),EA=i.bB(),TA=(v,l,f,_,E,j,k)=>{const L=v.transform,B=L.projection.name==="globe",G=B?i.dQ(L.zoom,l.canonical)*L._pixelsPerMercatorPixel:i.ay(f,1,j),Z={u_matrix:l.projMatrix,u_extrude_scale:G,u_intensity:k,u_inv_rot_matrix:EA,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(B){Z.u_inv_rot_matrix=_,Z.u_merc_center=E,Z.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],Z.u_zoom_transition=i.aj(L.zoom);const Q=E[0]*i.al,X=E[1]*i.al;Z.u_up_dir=L.projection.upVector(new i.cC(0,0,0),Q,X)}return Z};function N_(v,[l,f,_,E],[j,k]){if(j===k)return[0,0,0,0];const L=255*(v-1)/(v*(k-j));return[l*L,f*L,_*L,E*L]}function hd(v,l,[f,_]){return f===_?0:.5/v+(l-f)*(v-1)/(v*(_-f))}const oy=(v,l,f,_,E,j,k,L,B,G,Z,Q,X,se,le,de,xe,ye,Ee,Ne,je)=>({u_matrix:v,u_normalize_matrix:l,u_globe_matrix:f,u_merc_matrix:_,u_grid_matrix:E,u_tl_parent:j,u_scale_parent:G,u_fade_t:Z.mix,u_opacity:Z.opacity*Q.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Q.paint.get("raster-brightness-min"),u_brightness_high:Q.paint.get("raster-brightness-max"),u_saturation_factor:i.dS(Q.paint.get("raster-saturation")),u_contrast_factor:i.dR(Q.paint.get("raster-contrast")),u_spin_weights:I_(Q.paint.get("raster-hue-rotate")),u_perspective_transform:X,u_raster_elevation:se,u_zoom_transition:k,u_merc_center:L,u_cutoff_params:B,u_colorization_mix:N_(i.dT,de,ye),u_colorization_offset:hd(i.dT,xe,ye),u_color_ramp:le,u_texture_offset:[Ne/(Ee+2*Ne),Ee/(Ee+2*Ne)],u_texture_res:[Ee+2*Ne,Ee+2*Ne],u_emissive_strength:je});function I_(v){v*=Math.PI/180;const l=Math.sin(v),f=Math.cos(v);return[(2*f+1)/3,(-Math.sqrt(3)*l-f+1)/3,(Math.sqrt(3)*l-f+1)/3]}const yf=.05,nh=(v,l,f,_,E,j,k,L,B,G,Z,Q)=>({u_matrix:v,u_normalize_matrix:l,u_globe_matrix:f,u_merc_matrix:_,u_grid_matrix:E,u_tl_parent:j,u_scale_parent:G,u_fade_t:Z.mix,u_opacity:Z.opacity,u_image0:0,u_image1:1,u_raster_elevation:Q,u_zoom_transition:k,u_merc_center:L,u_cutoff_params:B}),o1=(v,l,f,_,E,j,k,L,B,G)=>({u_particle_texture:v,u_particle_texture_side_len:l,u_tile_offset:f,u_velocity:_,u_color_ramp:j,u_velocity_res:E,u_max_speed:k,u_uv_offset:L,u_data_scale:[255*B[0],255*B[1]],u_data_offset:G,u_particle_pos_scale:1.1,u_particle_pos_offset:[yf,yf]}),R_=(v,l,f,_,E,j,k,L,B,G)=>({u_particle_texture:v,u_particle_texture_side_len:l,u_velocity:f,u_velocity_res:_,u_max_speed:E,u_speed_factor:j,u_reset_rate:k,u_rand_seed:Math.random(),u_uv_offset:L,u_data_scale:[255*B[0],255*B[1]],u_data_offset:G,u_particle_pos_scale:1.1,u_particle_pos_offset:[yf,yf]}),l1=i.bB(),c1=(v,l,f,_,E,j,k,L,B,G,Z,Q,X,se,le,de,xe,ye,Ee,Ne,je,Ve,Ie,Ge)=>{const $e=E.transform,Le={u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:$e.getCameraToCenterDistance(Ee),u_rotate_symbol:+f,u_aspect_ratio:$e.width/$e.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:j,u_label_plane_matrix:k,u_coord_matrix:L,u_is_text:+G,u_elevation_from_sea:B?1:0,u_pitch_with_map:+_,u_texsize:Z,u_texsize_icon:Q,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:l1,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:l1,u_up_vector:[0,-1,0],u_color_adj_mat:Ve,u_icon_transition:Ie||0,u_gamma_scale:_?E.transform.getCameraToCenterDistance(Ee)*Math.cos(E.terrain?0:E.transform._pitch):1,u_device_pixel_ratio:i.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Ge||1,u_ground_shadow_factor:Ne,u_inv_matrix:i.bk(i.bB(),k),u_normal_scale:je,u_lutTexture:Ka.LUT};return Ee.name==="globe"&&(Le.u_tile_id=[se.canonical.x,se.canonical.y,1<<se.canonical.z],Le.u_zoom_transition=le,Le.u_inv_rot_matrix=xe,Le.u_merc_center=de,Le.u_camera_forward=$e._camera.forward(),Le.u_ecef_origin=i.dU($e.globeMatrix,se.toUnwrapped()),Le.u_tile_matrix=Float32Array.from($e.globeMatrix),Le.u_up_vector=ye),Le},M_=(v,l,f,_)=>({u_matrix:v,u_emissive_strength:l,u_opacity:f,u_color:_}),D_=(v,l,f,_,E,j,k,L,B)=>Object.assign(function(G,Z,Q,X,se,le){const{width:de,height:xe}=X.imageManager.getPixelSize(Z),ye=Math.pow(2,le.tileID.overscaledZ),Ee=le.tileSize*Math.pow(2,X.transform.tileZoom)/ye,Ne=Ee*(le.tileID.canonical.x+le.tileID.wrap*ye),je=Ee*le.tileID.canonical.y;return{u_image:0,u_pattern_tl:Q.tl,u_pattern_br:Q.br,u_texsize:[de,xe],u_pattern_size:Q.displaySize,u_pattern_units_to_pixels:se?[X.transform.width,-1*X.transform.height]:[1/i.ay(le,1,X.transform.tileZoom),1/i.ay(le,1,X.transform.tileZoom)],u_pixel_coord_upper:[Ne>>16,je>>16],u_pixel_coord_lower:[65535&Ne,65535&je]}}(0,j,k,_,L,B),{u_matrix:v,u_emissive_strength:l,u_opacity:f}),u1=new Float32Array(i.bz([])),L_=(v,l,f,_,E,j,k,L,B,G,Z,Q,X,se=[0,0,0],le,de,xe)=>{const ye=E.style.light,Ee=ye.properties.get("position"),Ne=[-Ee.x,-Ee.y,Ee.z],je=i.dN();ye.properties.get("anchor")==="viewport"&&(i.dO(je,-E.transform.angle),i.dP(Ne,Ne,je));const Ve=Z.alphaMode==="MASK",Ie=ye.properties.get("color").toNonPremultipliedRenderColor(null),Ge=X.paint.get("model-ambient-occlusion-intensity"),$e=X.paint.get("model-color").constantOr(i.ao.white).toNonPremultipliedRenderColor(null);return $e.a=X.paint.get("model-color-mix-intensity").constantOr(0),xe&&($e.r=xe[0],$e.g=xe[1],$e.b=xe[2],$e.a=xe[3]),de&&($e.r=de.color.r,$e.g=de.color.g,$e.b=de.color.b,$e.a=de.colorMix,Q=de.emissionStrength,j=de.opacity),{u_matrix:v,u_lighting_matrix:l,u_normal_matrix:f,u_node_matrix:_||u1,u_lightpos:Ne,u_lightintensity:ye.properties.get("intensity"),u_lightcolor:[Ie.r,Ie.g,Ie.b],u_camera_pos:se,u_opacity:j,u_baseTextureIsAlpha:0,u_alphaMask:+Ve,u_alphaCutoff:Z.alphaCutoff,u_baseColorFactor:k.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:L.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:B,u_roughnessFactor:G,u_baseColorTexture:Ka.BaseColor,u_metallicRoughnessTexture:Ka.MetallicRoughness,u_normalTexture:Ka.Normal,u_occlusionTexture:Ka.Occlusion,u_emissionTexture:Ka.Emission,u_lutTexture:Ka.LUT,u_color_mix:$e.toArray01(),u_aoIntensity:Ge,u_emissive_strength:Q,u_occlusionTextureTransform:le||[0,0,0,0]}},Fp=(v,l=u1,f=u1)=>({u_matrix:v,u_instance:l,u_node_matrix:f}),hR={fillExtrusion:v=>({u_matrix:new i.ck(v),u_lightpos:new i.ch(v),u_lightintensity:new i.ci(v),u_lightcolor:new i.ch(v),u_vertical_gradient:new i.ci(v),u_opacity:new i.ci(v),u_edge_radius:new i.ci(v),u_width_scale:new i.ci(v),u_ao:new i.cj(v),u_height_type:new i.cg(v),u_base_type:new i.cg(v),u_tile_id:new i.ch(v),u_zoom_transition:new i.ci(v),u_inv_rot_matrix:new i.ck(v),u_merc_center:new i.cj(v),u_up_dir:new i.ch(v),u_height_lift:new i.ci(v),u_flood_light_color:new i.ch(v),u_vertical_scale:new i.ci(v),u_flood_light_intensity:new i.ci(v),u_ground_shadow_factor:new i.ch(v)}),fillExtrusionDepth:v=>({u_matrix:new i.ck(v),u_edge_radius:new i.ci(v),u_width_scale:new i.ci(v),u_vertical_scale:new i.ci(v),u_height_type:new i.cg(v),u_base_type:new i.cg(v)}),fillExtrusionPattern:v=>({u_matrix:new i.ck(v),u_lightpos:new i.ch(v),u_lightintensity:new i.ci(v),u_lightcolor:new i.ch(v),u_vertical_gradient:new i.ci(v),u_height_factor:new i.ci(v),u_edge_radius:new i.ci(v),u_width_scale:new i.ci(v),u_ao:new i.cj(v),u_height_type:new i.cg(v),u_base_type:new i.cg(v),u_tile_id:new i.ch(v),u_zoom_transition:new i.ci(v),u_inv_rot_matrix:new i.ck(v),u_merc_center:new i.cj(v),u_up_dir:new i.ch(v),u_height_lift:new i.ci(v),u_image:new i.cg(v),u_texsize:new i.cj(v),u_pixel_coord_upper:new i.cj(v),u_pixel_coord_lower:new i.cj(v),u_tile_units_to_pixels:new i.ci(v),u_opacity:new i.ci(v),u_pattern_transition:new i.ci(v)}),fillExtrusionGroundEffect:v=>({u_matrix:new i.ck(v),u_opacity:new i.ci(v),u_ao_pass:new i.ci(v),u_meter_to_tile:new i.ci(v),u_ao:new i.cj(v),u_flood_light_intensity:new i.ci(v),u_flood_light_color:new i.ch(v),u_attenuation:new i.ci(v),u_edge_radius:new i.ci(v),u_fb:new i.cg(v),u_fb_size:new i.ci(v),u_dynamic_offset:new i.ci(v)}),fill:v=>({u_matrix:new i.ck(v),u_emissive_strength:new i.ci(v),u_ground_shadow_factor:new i.ch(v)}),fillPattern:v=>({u_matrix:new i.ck(v),u_emissive_strength:new i.ci(v),u_image:new i.cg(v),u_texsize:new i.cj(v),u_pixel_coord_upper:new i.cj(v),u_pixel_coord_lower:new i.cj(v),u_tile_units_to_pixels:new i.ci(v),u_ground_shadow_factor:new i.ch(v),u_pattern_transition:new i.ci(v)}),fillOutline:v=>({u_matrix:new i.ck(v),u_emissive_strength:new i.ci(v),u_world:new i.cj(v),u_ground_shadow_factor:new i.ch(v)}),fillOutlinePattern:v=>({u_matrix:new i.ck(v),u_emissive_strength:new i.ci(v),u_world:new i.cj(v),u_image:new i.cg(v),u_texsize:new i.cj(v),u_pixel_coord_upper:new i.cj(v),u_pixel_coord_lower:new i.cj(v),u_tile_units_to_pixels:new i.ci(v),u_ground_shadow_factor:new i.ch(v),u_pattern_transition:new i.ci(v)}),building:v=>({u_matrix:new i.ck(v),u_normal_matrix:new i.ck(v),u_opacity:new i.ci(v),u_faux_facade_ao_intensity:new i.ci(v),u_camera_pos:new i.ch(v),u_tile_to_meter:new i.ci(v),u_facade_emissive_chance:new i.ci(v),u_flood_light_color:new i.ch(v),u_flood_light_intensity:new i.ci(v)}),buildingBloom:v=>({u_matrix:new i.ck(v)}),buildingDepth:v=>({u_matrix:new i.ck(v)}),elevatedStructuresDepth:v=>({u_matrix:new i.ck(v),u_depth_bias:new i.ci(v)}),elevatedStructures:v=>({u_matrix:new i.ck(v),u_ground_shadow_factor:new i.ch(v)}),elevatedStructuresDepthReconstruct:v=>({u_matrix:new i.ck(v),u_camera_pos:new i.ch(v),u_depth_bias:new i.ci(v),u_height_scale:new i.ci(v),u_reset_depth:new i.ci(v)}),circle:i.dX,collisionBox:v=>({u_matrix:new i.ck(v),u_inv_rot_matrix:new i.ck(v),u_camera_to_center_distance:new i.ci(v),u_extrude_scale:new i.cj(v),u_zoom_transition:new i.ci(v),u_merc_center:new i.cj(v),u_tile_id:new i.ch(v)}),collisionCircle:v=>({u_matrix:new i.ck(v),u_inv_matrix:new i.ck(v),u_camera_to_center_distance:new i.ci(v),u_viewport_size:new i.cj(v)}),debug:v=>({u_color:new i.dA(v),u_matrix:new i.ck(v),u_overlay:new i.cg(v),u_overlay_scale:new i.ci(v)}),clippingMask:v=>({u_matrix:new i.ck(v)}),heatmap:v=>({u_extrude_scale:new i.ci(v),u_intensity:new i.ci(v),u_matrix:new i.ck(v),u_inv_rot_matrix:new i.ck(v),u_merc_center:new i.cj(v),u_tile_id:new i.ch(v),u_zoom_transition:new i.ci(v),u_up_dir:new i.ch(v)}),heatmapTexture:v=>({u_image:new i.cg(v),u_color_ramp:new i.cg(v),u_opacity:new i.ci(v)}),hillshade:v=>({u_matrix:new i.ck(v),u_image:new i.cg(v),u_latrange:new i.cj(v),u_light:new i.cj(v),u_shadow:new i.dA(v),u_highlight:new i.dA(v),u_emissive_strength:new i.ci(v),u_accent:new i.dA(v)}),hillshadePrepare:v=>({u_matrix:new i.ck(v),u_image:new i.cg(v),u_dimension:new i.cj(v),u_zoom:new i.ci(v)}),line:i.dW,linePattern:i.dV,raster:v=>({u_matrix:new i.ck(v),u_normalize_matrix:new i.ck(v),u_globe_matrix:new i.ck(v),u_merc_matrix:new i.ck(v),u_grid_matrix:new i.dB(v),u_tl_parent:new i.cj(v),u_scale_parent:new i.ci(v),u_fade_t:new i.ci(v),u_opacity:new i.ci(v),u_image0:new i.cg(v),u_image1:new i.cg(v),u_brightness_low:new i.ci(v),u_brightness_high:new i.ci(v),u_saturation_factor:new i.ci(v),u_contrast_factor:new i.ci(v),u_spin_weights:new i.ch(v),u_perspective_transform:new i.cj(v),u_raster_elevation:new i.ci(v),u_zoom_transition:new i.ci(v),u_merc_center:new i.cj(v),u_cutoff_params:new i.d2(v),u_colorization_mix:new i.d2(v),u_colorization_offset:new i.ci(v),u_color_ramp:new i.cg(v),u_texture_offset:new i.cj(v),u_texture_res:new i.cj(v),u_emissive_strength:new i.ci(v)}),rasterParticle:v=>({u_matrix:new i.ck(v),u_normalize_matrix:new i.ck(v),u_globe_matrix:new i.ck(v),u_merc_matrix:new i.ck(v),u_grid_matrix:new i.dB(v),u_tl_parent:new i.cj(v),u_scale_parent:new i.ci(v),u_fade_t:new i.ci(v),u_opacity:new i.ci(v),u_image0:new i.cg(v),u_image1:new i.cg(v),u_raster_elevation:new i.ci(v),u_zoom_transition:new i.ci(v),u_merc_center:new i.cj(v),u_cutoff_params:new i.d2(v)}),rasterParticleTexture:v=>({u_texture:new i.cg(v),u_opacity:new i.ci(v)}),rasterParticleDraw:v=>({u_particle_texture:new i.cg(v),u_particle_texture_side_len:new i.ci(v),u_tile_offset:new i.cj(v),u_velocity:new i.cg(v),u_color_ramp:new i.cg(v),u_velocity_res:new i.cj(v),u_max_speed:new i.ci(v),u_uv_offset:new i.cj(v),u_data_scale:new i.cj(v),u_data_offset:new i.ci(v),u_particle_pos_scale:new i.ci(v),u_particle_pos_offset:new i.cj(v)}),rasterParticleUpdate:v=>({u_particle_texture:new i.cg(v),u_particle_texture_side_len:new i.ci(v),u_velocity:new i.cg(v),u_velocity_res:new i.cj(v),u_max_speed:new i.ci(v),u_speed_factor:new i.ci(v),u_reset_rate:new i.ci(v),u_rand_seed:new i.ci(v),u_uv_offset:new i.cj(v),u_data_scale:new i.cj(v),u_data_offset:new i.ci(v),u_particle_pos_scale:new i.ci(v),u_particle_pos_offset:new i.cj(v)}),symbol:v=>({u_is_size_zoom_constant:new i.cg(v),u_is_size_feature_constant:new i.cg(v),u_size_t:new i.ci(v),u_size:new i.ci(v),u_camera_to_center_distance:new i.ci(v),u_rotate_symbol:new i.cg(v),u_aspect_ratio:new i.ci(v),u_fade_change:new i.ci(v),u_matrix:new i.ck(v),u_label_plane_matrix:new i.ck(v),u_coord_matrix:new i.ck(v),u_is_text:new i.cg(v),u_elevation_from_sea:new i.cg(v),u_pitch_with_map:new i.cg(v),u_texsize:new i.cj(v),u_texsize_icon:new i.cj(v),u_texture:new i.cg(v),u_texture_icon:new i.cg(v),u_gamma_scale:new i.ci(v),u_device_pixel_ratio:new i.ci(v),u_tile_id:new i.ch(v),u_zoom_transition:new i.ci(v),u_inv_rot_matrix:new i.ck(v),u_merc_center:new i.cj(v),u_camera_forward:new i.ch(v),u_tile_matrix:new i.ck(v),u_up_vector:new i.ch(v),u_ecef_origin:new i.ch(v),u_is_halo:new i.cg(v),u_icon_transition:new i.ci(v),u_color_adj_mat:new i.ck(v),u_scale_factor:new i.ci(v),u_ground_shadow_factor:new i.ch(v),u_inv_matrix:new i.ck(v),u_normal_scale:new i.ci(v),u_lutTexture:new i.cg(v)}),background:v=>({u_matrix:new i.ck(v),u_emissive_strength:new i.ci(v),u_opacity:new i.ci(v),u_color:new i.dA(v)}),backgroundPattern:v=>({u_matrix:new i.ck(v),u_emissive_strength:new i.ci(v),u_opacity:new i.ci(v),u_image:new i.cg(v),u_pattern_tl:new i.cj(v),u_pattern_br:new i.cj(v),u_texsize:new i.cj(v),u_pattern_size:new i.cj(v),u_pixel_coord_upper:new i.cj(v),u_pixel_coord_lower:new i.cj(v),u_pattern_units_to_pixels:new i.cj(v)}),terrainRaster:v=>({u_matrix:new i.ck(v),u_image0:new i.cg(v),u_skirt_height:new i.ci(v),u_ground_shadow_factor:new i.ch(v)}),skybox:v=>({u_matrix:new i.ck(v),u_sun_direction:new i.ch(v),u_cubemap:new i.cg(v),u_opacity:new i.ci(v),u_temporal_offset:new i.ci(v)}),skyboxGradient:v=>({u_matrix:new i.ck(v),u_color_ramp:new i.cg(v),u_center_direction:new i.ch(v),u_radius:new i.ci(v),u_opacity:new i.ci(v),u_temporal_offset:new i.ci(v)}),skyboxCapture:v=>({u_matrix_3f:new i.dB(v),u_sun_direction:new i.ch(v),u_sun_intensity:new i.ci(v),u_color_tint_r:new i.d2(v),u_color_tint_m:new i.d2(v),u_luminance:new i.ci(v)}),globeRaster:v=>({u_proj_matrix:new i.ck(v),u_globe_matrix:new i.ck(v),u_normalize_matrix:new i.ck(v),u_merc_matrix:new i.ck(v),u_zoom_transition:new i.ci(v),u_merc_center:new i.cj(v),u_image0:new i.cg(v),u_grid_matrix:new i.dB(v),u_skirt_height:new i.ci(v),u_far_z_cutoff:new i.ci(v),u_frustum_tl:new i.ch(v),u_frustum_tr:new i.ch(v),u_frustum_br:new i.ch(v),u_frustum_bl:new i.ch(v),u_globe_pos:new i.ch(v),u_globe_radius:new i.ci(v),u_viewport:new i.cj(v)}),globeAtmosphere:v=>({u_frustum_tl:new i.ch(v),u_frustum_tr:new i.ch(v),u_frustum_br:new i.ch(v),u_frustum_bl:new i.ch(v),u_horizon:new i.ci(v),u_transition:new i.ci(v),u_fadeout_range:new i.ci(v),u_atmosphere_fog_color:new i.d2(v),u_high_color:new i.d2(v),u_space_color:new i.d2(v),u_temporal_offset:new i.ci(v),u_horizon_angle:new i.ci(v)}),model:v=>({u_matrix:new i.ck(v),u_lighting_matrix:new i.ck(v),u_normal_matrix:new i.ck(v),u_node_matrix:new i.ck(v),u_lightpos:new i.ch(v),u_lightintensity:new i.ci(v),u_lightcolor:new i.ch(v),u_camera_pos:new i.ch(v),u_opacity:new i.ci(v),u_baseColorFactor:new i.d2(v),u_emissiveFactor:new i.d2(v),u_metallicFactor:new i.ci(v),u_roughnessFactor:new i.ci(v),u_baseTextureIsAlpha:new i.cg(v),u_alphaMask:new i.cg(v),u_alphaCutoff:new i.ci(v),u_baseColorTexture:new i.cg(v),u_metallicRoughnessTexture:new i.cg(v),u_normalTexture:new i.cg(v),u_occlusionTexture:new i.cg(v),u_emissionTexture:new i.cg(v),u_lutTexture:new i.cg(v),u_color_mix:new i.d2(v),u_aoIntensity:new i.ci(v),u_emissive_strength:new i.ci(v),u_occlusionTextureTransform:new i.d2(v)}),modelDepth:v=>({u_matrix:new i.ck(v),u_instance:new i.ck(v),u_node_matrix:new i.ck(v)}),groundShadow:v=>({u_matrix:new i.ck(v),u_ground_shadow_factor:new i.ch(v)}),stars:v=>({u_matrix:new i.ck(v),u_up:new i.ch(v),u_right:new i.ch(v),u_intensity_multiplier:new i.ci(v)}),snowParticle:v=>({u_modelview:new i.ck(v),u_projection:new i.ck(v),u_time:new i.ci(v),u_cam_pos:new i.ch(v),u_velocityConeAperture:new i.ci(v),u_velocity:new i.ci(v),u_horizontalOscillationRadius:new i.ci(v),u_horizontalOscillationRate:new i.ci(v),u_boxSize:new i.ci(v),u_billboardSize:new i.ci(v),u_simpleShapeParameters:new i.cj(v),u_screenSize:new i.cj(v),u_thinningCenterPos:new i.cj(v),u_thinningShape:new i.ch(v),u_thinningAffectedRatio:new i.ci(v),u_thinningParticleOffset:new i.ci(v),u_particleColor:new i.d2(v),u_direction:new i.ch(v)}),rainParticle:v=>({u_modelview:new i.ck(v),u_projection:new i.ck(v),u_time:new i.ci(v),u_cam_pos:new i.ch(v),u_texScreen:new i.cg(v),u_velocityConeAperture:new i.ci(v),u_velocity:new i.ci(v),u_boxSize:new i.ci(v),u_rainDropletSize:new i.cj(v),u_distortionStrength:new i.ci(v),u_rainDirection:new i.ch(v),u_color:new i.d2(v),u_screenSize:new i.cj(v),u_thinningCenterPos:new i.cj(v),u_thinningShape:new i.ch(v),u_thinningAffectedRatio:new i.ci(v),u_thinningParticleOffset:new i.ci(v),u_shapeDirectionalPower:new i.ci(v),u_shapeNormalPower:new i.ci(v),u_mode:new i.ci(v)}),vignette:v=>({u_vignetteShape:new i.ch(v),u_vignetteColor:new i.d2(v)}),occlusion:v=>({u_matrix:new i.ck(v),u_anchorPos:new i.ch(v),u_screenSizePx:new i.cj(v),u_occluderSizePx:new i.cj(v),u_color:new i.d2(v)})};class ih{constructor(l,f,_,E){this.id=ih.uniqueIdxCounter,ih.uniqueIdxCounter++,this.context=l;const j=l.gl;this.buffer=j.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),j.bufferData(j.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?j.DYNAMIC_DRAW:j.STATIC_DRAW),this.dynamicDraw||E||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){this.id=ih.uniqueIdxCounter,ih.uniqueIdxCounter++;const f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}ih.uniqueIdxCounter=0;const AA={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class fR{constructor(l,f,_,E,j,k){this.length=f.length,this.attributes=_,this.itemSize=f.bytesPerElement,this.dynamicDraw=E,this.instanceCount=k,this.context=l;const L=l.gl;this.buffer=L.createBuffer(),l.bindVertexBuffer.set(this.buffer),L.bufferData(L.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?L.DYNAMIC_DRAW:L.STATIC_DRAW),this.dynamicDraw||j||f.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,f){for(let _=0;_<this.attributes.length;_++){const E=f.getAttributeLocation(l,this.attributes[_].name);E!==-1&&l.enableVertexAttribArray(E)}}setVertexAttribPointers(l,f,_){for(let E=0;E<this.attributes.length;E++){const j=this.attributes[E],k=f.getAttributeLocation(l,j.name);k!==-1&&l.vertexAttribPointer(k,j.components,l[AA[j.type]],!1,this.itemSize,j.offset+this.itemSize*(_||0))}}setVertexAttribDivisor(l,f,_){for(let E=0;E<this.attributes.length;E++){const j=f.getAttributeLocation(l,this.attributes[E].name);j!==-1&&this.instanceCount&&this.instanceCount>0&&l.vertexAttribDivisor(j,_)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class F_{constructor(l,f,_,E,j){this.context=l,this.width=f,this.height=_;const k=this.framebuffer=l.gl.createFramebuffer();E&&(this.colorAttachment=new oR(l,k)),j&&(this.depthAttachmentType=j,this.depthAttachment=j==="renderbuffer"?new yA(l,k):new lR(l,k))}destroy(){const l=this.context.gl;if(this.colorAttachment){const f=this.colorAttachment.get();f&&l.deleteTexture(f)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const f=this.depthAttachment.get();f&&l.deleteRenderbuffer(f)}else{const f=this.depthAttachment.get();f&&l.deleteTexture(f)}l.deleteFramebuffer(this.framebuffer)}}class z_{constructor(l,f){this.gl=l,this.clearColor=new cA(this),this.clearDepth=new Gw(this),this.clearStencil=new tR(this),this.colorMask=new rR(this),this.depthMask=new nR(this),this.stencilMask=new iR(this),this.stencilFunc=new uA(this),this.stencilOp=new sR(this),this.stencilTest=new __(this),this.depthRange=new aR(this),this.depthTest=new dA(this),this.depthFunc=new Ww(this),this.blend=new x_(this),this.blendFunc=new Kw(this),this.blendColor=new pf(this),this.blendEquation=new kp(this),this.cullFace=new ty(this),this.cullFaceSide=new Np(this),this.frontFace=new hA(this),this.program=new Zw(this),this.activeTexture=new fA(this),this.viewport=new Ip(this),this.bindFramebuffer=new b_(this),this.bindRenderbuffer=new w_(this),this.bindTexture=new Xw(this),this.bindVertexBuffer=new S_(this),this.bindElementBuffer=new ry(this),this.bindVertexArrayOES=new pA(this),this.pixelStoreUnpack=new mA(this),this.pixelStoreUnpackPremultiplyAlpha=new gA(this),this.pixelStoreUnpackFlipY=new Rp(this),this.options=f?Object.assign({},f):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=f&&!!f.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=l.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),this.maxPointSize=l.getParameter(l.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,f,_){return new ih(this,l,f,_)}createVertexBuffer(l,f,_,E,j){return new fR(this,l,f,_,E,j)}createRenderbuffer(l,f,_){const E=this.gl,j=E.createRenderbuffer();return this.bindRenderbuffer.set(j),E.renderbufferStorage(E.RENDERBUFFER,l,f,_),this.bindRenderbuffer.set(null),j}createFramebuffer(l,f,_,E){return new F_(this,l,f,_,E)}clear({color:l,depth:f,stencil:_,colorMask:E}){const j=this.gl;let k=0;l&&(k|=j.COLOR_BUFFER_BIT,this.clearColor.set(l.toNonPremultipliedRenderColor(null)),this.colorMask.set(E||[!0,!0,!0,!0])),f!==void 0&&(k|=j.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),_!==void 0&&(k|=j.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),j.clear(k)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){i.bx(l.blendFunction,vn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor),l.blendEquation?this.blendEquation.set(l.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(l.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let ku;function ly(v,l,f,_,E,j,k){const L=v.context,B=L.gl,G=v.transform,Z=[i.aF(G.center.lng),i.aJ(G.center.lat)],Q=f.layout.get("symbol-placement"),X=f.layout.get("text-variable-anchor"),se=f.layout.get("icon-rotation-alignment")==="map",le=f.layout.get("text-rotation-alignment")==="map",de=Q!=="point",xe=[];let ye=0,Ee=0;for(let Le=0;Le<_.length;Le++){const Ke=_[Le],dt=l.getTile(Ke),at=dt.getBucket(f);if(!at)continue;const Et=at.getProjection().createInversionMatrix(G,Ke.canonical),yt=[],Nt=rA(Ke,at,G),Xt=!k&&se&&de,mt=k&&le&&de,tt=X&&at.hasTextData(),It=at.hasIconTextFit()&&tt&&at.hasIconData(),vt=Xt||mt||k&&tt||It,Bt=at.projection.name==="globe",rr=Bt?i.aj(G.zoom):0;Bt&&(yt.push("PROJECTION_GLOBE_VIEW"),vt&&yt.push("PROJECTED_POS_ON_VIEWPORT"));const xr=v.getOrCreateProgram("collisionBox",{defines:yt});let Wt=Nt;E[0]===0&&E[1]===0||(Wt=v.translatePosMatrix(Nt,dt,E,j));const Jt=k?at.textCollisionBox:at.iconCollisionBox,wr=at.collisionCircleArray;if(wr.length>0){const dr=i.bB(),mr=Wt;i.cO(dr,at.placementInvProjMatrix,G.glCoordMatrix),i.cO(dr,dr,at.placementViewportMatrix),xe.push({circleArray:wr,circleOffset:Ee,transform:mr,invTransform:dr,projection:at.getProjection()}),ye+=wr.length/4,Ee=ye}if(!Jt)continue;v.terrain&&v.terrain.setupElevationDraw(dt,xr);const pr=Bt?[Ke.canonical.x,Ke.canonical.y,1<<Ke.canonical.z]:[0,0,0];xr.draw(v,B.LINES,Er.disabled,tn.disabled,v.colorModeForRenderPass(),Xr.disabled,Lp(Wt,Et,G,rr,Z,dt,pr,at.getProjection()),f.id,Jt.layoutVertexBuffer,Jt.indexBuffer,Jt.segments,null,G.zoom,null,[Jt.collisionVertexBuffer,Jt.collisionVertexBufferExt])}if(!k||!xe.length)return;const Ne=v.getOrCreateProgram("collisionCircle"),je=new i.dY;je.resize(4*ye),je._trim();let Ve=0;for(const Le of xe)for(let Ke=0;Ke<Le.circleArray.length/4;Ke++){const dt=4*Ke,at=Le.circleArray[dt+0],Et=Le.circleArray[dt+1],yt=Le.circleArray[dt+2],Nt=Le.circleArray[dt+3];je.emplace(Ve++,at,Et,yt,Nt,0),je.emplace(Ve++,at,Et,yt,Nt,1),je.emplace(Ve++,at,Et,yt,Nt,2),je.emplace(Ve++,at,Et,yt,Nt,3)}(!ku||ku.length<2*ye)&&(ku=function(Le){const Ke=2*Le,dt=new i.b0;dt.resize(Ke),dt._trim();for(let at=0;at<Ke;at++){const Et=6*at;dt.uint16[Et+0]=4*at+0,dt.uint16[Et+1]=4*at+1,dt.uint16[Et+2]=4*at+2,dt.uint16[Et+3]=4*at+2,dt.uint16[Et+4]=4*at+3,dt.uint16[Et+5]=4*at+0}return dt}(ye));const Ie=L.createIndexBuffer(ku,!0),Ge=L.createVertexBuffer(je,i.dZ.members,!0);for(const Le of xe){const Ke={u_matrix:Le.transform,u_inv_matrix:Le.invTransform,u_camera_to_center_distance:($e=G).getCameraToCenterDistance(Le.projection),u_viewport_size:[$e.width,$e.height]};Ne.draw(v,B.TRIANGLES,Er.disabled,tn.disabled,v.colorModeForRenderPass(),Xr.disabled,Ke,f.id,Ge,Ie,i.bf.simpleSegment(0,2*Le.circleOffset,Le.circleArray.length,Le.circleArray.length/2),null,G.zoom)}var $e;Ge.destroy(),Ie.destroy()}const sh=i.bB();function d1(v){const l=v._camera.getWorldToCamera(v.worldSize,1),f=i.aB([],l,v.globeMatrix);i.bk(f,f);const _=[0,0,0],E=[0,1,0,0];return i.aC(E,E,f),_[0]=E[0],_[1]=E[1],_[2]=E[2],i.aw(_,_),_}function B_({width:v,height:l,anchor:f,textOffset:_,textScale:E},j){const{horizontalAlign:k,verticalAlign:L}=i.c0(f),B=-(k-.5)*v,G=-(L-.5)*l,Z=i.c1(f,_);return new i.P((B/E+Z[0])*j,(G/E+Z[1])*j)}function $_(v,l,f,_,E,j,k,L,B,G){const Z=v.text.placedSymbolArray,Q=v.text.dynamicLayoutVertexArray,X=v.icon.dynamicLayoutVertexArray,se={},le=v.getProjection(),de=o_(k,le,E),xe=E.elevation,ye=le.upVectorScale(k.canonical,E.center.lat,E.worldSize).metersToTile;Q.clear();for(let Ee=0;Ee<Z.length;Ee++){const Ne=Z.get(Ee),{tileAnchorX:je,tileAnchorY:Ve,numGlyphs:Ie}=Ne,Ge=Ne.hidden||!Ne.crossTileID||v.allowVerticalPlacement&&!Ne.placedOrientation?null:_[Ne.crossTileID];if(Ge){let $e=0,Le=0,Ke=0;const dt=v.elevationType==="road";if(xe||dt){const vt=dt?v.getElevationFeatureForText(Ee):null,Bt=i.bU.getAtTileOffset(k,new i.P(je,Ve),xe,vt),[rr,xr,Wt]=le.upVector(k.canonical,je,Ve);$e=Bt*rr*ye,Le=Bt*xr*ye,Ke=Bt*Wt*ye}let[at,Et,yt,Nt]=da(Ne.projectedAnchorX+$e,Ne.projectedAnchorY+Le,Ne.projectedAnchorZ+Ke,f?de:j);const Xt=Iw(E.getCameraToCenterDistance(le),Nt);let mt=i.bL(v.textSizeData,B,Ne)*Xt/i.bX;f&&(mt*=v.tilePixelRatio/L);const tt=B_(Ge,mt);f?({x:at,y:Et,z:yt}=le.projectTilePoint(je+tt.x,Ve+tt.y,k.canonical),[at,Et,yt]=da(at+$e,Et+Le,yt+Ke,j)):(l&&tt._rotate(-E.angle),at+=tt.x,Et+=tt.y,yt=0);const It=v.allowVerticalPlacement&&Ne.placedOrientation===i.bK.vertical?Math.PI/2:0;for(let vt=0;vt<Ie;vt++)i.bN(Q,at,Et,yt,It);G&&Ne.associatedIconIndex>=0&&(se[Ne.associatedIconIndex]={x:at,y:Et,z:yt,angle:It})}else ld(Ie,Q)}if(G){X.clear();const Ee=v.icon.placedSymbolArray;for(let Ne=0;Ne<Ee.length;Ne++){const je=Ee.get(Ne),{numGlyphs:Ve}=je,Ie=se[Ne];if(je.hidden||!Ie)ld(Ve,X);else{const{x:Ge,y:$e,z:Le,angle:Ke}=Ie;for(let dt=0;dt<Ve;dt++)i.bN(X,Ge,$e,Le,Ke)}}v.icon.dynamicLayoutVertexBuffer.updateData(X)}v.text.dynamicLayoutVertexBuffer.updateData(Q)}function cy(v,l,f,_,E,j,k={}){const L=f.paint.get("icon-translate"),B=f.paint.get("text-translate"),G=f.paint.get("icon-translate-anchor"),Z=f.paint.get("text-translate-anchor"),Q=f.layout.get("icon-rotation-alignment"),X=f.layout.get("text-rotation-alignment"),se=f.layout.get("icon-pitch-alignment"),le=f.layout.get("text-pitch-alignment"),de=f.layout.get("icon-keep-upright"),xe=f.layout.get("text-keep-upright"),ye=f.paint.get("icon-color-saturation"),Ee=f.paint.get("icon-color-contrast"),Ne=f.paint.get("icon-color-brightness-min"),je=f.paint.get("icon-color-brightness-max"),Ve=f.layout.get("symbol-elevation-reference")==="sea",Ie=f.layout.get("icon-image-use-theme")==="none",Ge=v.context,$e=Ge.gl,Le=v.transform,Ke=Q==="map",dt=X==="map",at=se==="map",Et=le==="map",yt=f.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Nt=!1;const Xt=v.depthModeForSublayer(0,Er.ReadOnly),mt=new Er(v.context.gl.LEQUAL,Er.ReadOnly,v.depthRangeFor3D),tt=[i.aF(Le.center.lng),i.aJ(Le.center.lat)],It=f.layout.get("text-variable-anchor"),vt=Le.projection.name==="globe",Bt=[],rr=[0,-1,0];for(const xr of _){const Wt=l.getTile(xr),Jt=Wt.getBucket(f);if(!Jt||Jt.projection.name==="mercator"&&vt||Jt.fullyClipped)continue;const wr=Jt.projection.name==="globe",pr=wr?i.aj(Le.zoom):0,dr=o_(xr,Jt.getProjection(),Le),mr=Le.calculatePixelsToTileUnitsMatrix(Wt),$r=It&&Jt.hasTextData(),jn=Jt.hasIconTextFit()&&$r&&Jt.hasIconData(),Fn=Jt.getProjection().createInversionMatrix(Le,xr.canonical),Ei=(1<<Wt.tileID.canonical.z)*i.al/v.transform.worldSize,Yr=di=>{let Qr=[0,0,0];if(di){const Vn=v.style.directionalLight,ls=v.style.ambientLight;Vn&&ls&&(Qr=Ac(v.style,Vn,ls))}return Qr},Dn=di=>{Le.depthOcclusionForSymbolsAndCircles&&(f.hasOcclusionOpacityProperties||v.terrain)&&(di.push("DEPTH_D24"),di.push("DEPTH_OCCLUSION"))},hn=di=>{f.lut&&!Ie&&(f.lut.texture||(f.lut.texture=new i.d_(v.context,f.lut.image,[f.lut.image.height,f.lut.image.height,f.lut.image.height],Ge.gl.RGBA8)),Ge.activeTexture.set(Ge.gl.TEXTURE0+Ka.LUT),f.lut.texture&&f.lut.texture.bind(Ge.gl.LINEAR,Ge.gl.CLAMP_TO_EDGE),di.push("APPLY_LUT_ON_GPU"))},yi=()=>{const di=Ke&&f.layout.get("symbol-placement")!=="point",Qr=[];Dn(Qr),hn(Qr);const Vn=di||jn,ls=Jt.elevationType==="road",Ns=v.shadowRenderer,hs=ls&&at&&!!Ns&&Ns.enabled,Ss=Yr(hs),_l=ls&&at&&!v.terrain?mt:Xt,al=f.paint.get("icon-image-cross-fade");v.terrainRenderModeElevated()&&at&&Qr.push("PITCH_WITH_MAP_TERRAIN"),wr&&(Qr.push("PROJECTION_GLOBE_VIEW"),Vn&&Qr.push("PROJECTED_POS_ON_VIEWPORT")),al>0&&Jt.hasAnySecondaryIcon&&Qr.push("ICON_TRANSITION"),!Jt.icon.zOffsetVertexBuffer||ls&&v.terrain||Qr.push("Z_OFFSET"),ye===0&&Ee===0&&Ne===0&&je===1||Qr.push("COLOR_ADJUSTMENT"),Jt.sdfIcons&&Qr.push("RENDER_SDF"),hs&&Qr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ls&&at&&!v.terrain&&Jt.icon.orientationVertexBuffer&&Qr.push("ELEVATED_ROADS");const ao=Jt.icon.programConfigurations.get(f.id),wo=v.getOrCreateProgram("symbol",{config:ao,defines:Qr}),Zl=Wt.imageAtlasTexture?Wt.imageAtlasTexture.size:[0,0],oo=Jt.iconSizeData,Xl=i.bJ(oo,Le.zoom),Nc=at||!Le.isOrthographic,Ra=xp(dr,Wt.tileID.canonical,at,Ke,Le,Jt.getProjection(),mr),ys=od(dr,Wt.tileID.canonical,at,Ke,Le,Jt.getProjection(),mr),Is=v.translatePosMatrix(ys,Wt,L,G,!0),Ni=v.translatePosMatrix(dr,Wt,L,G),Ds=Vn?sh:Ra,Ma=Ke&&!at&&!di;let vs=rr;!vt&&!Le.mercatorFromTransition||Ke||(vs=d1(Le));const Yl=wr?vs:rr,Qp=f.getColorAdjustmentMatrix(ye,Ee,Ne,je),vd=c1(oo.kind,Xl,Ma,at,v,Ni,Ds,Is,Ve,!1,Zl,[0,0],0,xr,pr,tt,Fn,Yl,Jt.getProjection(),Ss,Ei,Qp,al,null),em=Wt.imageAtlasTexture?Wt.imageAtlasTexture:null,tm=f.layout.get("icon-size").constantOr(0)!==1||Jt.iconsNeedLinear,Jl=Jt.sdfIcons||v.options.rotating||v.options.zooming||tm||Nc?$e.LINEAR:$e.NEAREST,Iu=Jt.sdfIcons&&f.paint.get("icon-halo-width").constantOr(1)!==0,Sa=v.terrain&&at&&di?i.bk(i.bB(),Ra):sh;if(di&&Jt.icon){const Ql=i.bU.getAtTileOffsetFunc(xr,Le.center.lat,Le.worldSize,Jt.getProjection()),Ef=Ug(dr,Wt.tileID.canonical,at,Ke,Le,Jt.getProjection(),mr),XA=f.layout.get("icon-size-scale-range"),lx=i.aA(v.scaleFactor,XA[0],XA[1]);Mw(Jt,dr,v,!1,Ef,ys,at,de,Ql,xr,lx)}return{program:wo,buffers:Jt.icon,uniformValues:vd,atlasTexture:em,atlasTextureIcon:null,atlasInterpolation:Jl,atlasInterpolationIcon:null,isSDF:Jt.sdfIcons,hasHalo:Iu,depthMode:_l,tile:Wt,renderWithShadows:hs,labelPlaneMatrixInv:Sa}},zn=()=>{const di=dt&&f.layout.get("symbol-placement")!=="point",Qr=[],Vn=di||It||jn,ls=Jt.elevationType==="road",Ns=v.shadowRenderer,hs=ls&&Et&&!!Ns&&Ns.enabled,Ss=Yr(hs),_l=ls&&Et&&!v.terrain?mt:Xt;v.terrainRenderModeElevated()&&Et&&Qr.push("PITCH_WITH_MAP_TERRAIN"),wr&&(Qr.push("PROJECTION_GLOBE_VIEW"),Vn&&Qr.push("PROJECTED_POS_ON_VIEWPORT")),!Jt.text.zOffsetVertexBuffer||ls&&v.terrain||Qr.push("Z_OFFSET"),Jt.iconsInText&&Qr.push("RENDER_TEXT_AND_SYMBOL"),Qr.push("RENDER_SDF"),hs&&Qr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ls&&Et&&!v.terrain&&Jt.text.orientationVertexBuffer&&Qr.push("ELEVATED_ROADS"),Dn(Qr);const al=Jt.text.programConfigurations.get(f.id),ao=v.getOrCreateProgram("symbol",{config:al,defines:Qr});let wo,Zl=[0,0],oo=null;const Xl=Jt.textSizeData;Jt.iconsInText&&(Zl=Wt.imageAtlasTexture?Wt.imageAtlasTexture.size:[0,0],oo=Wt.imageAtlasTexture?Wt.imageAtlasTexture:null,wo=Et||!Le.isOrthographic||v.options.rotating||v.options.zooming||Xl.kind==="composite"||Xl.kind==="camera"?$e.LINEAR:$e.NEAREST);const Nc=Wt.glyphAtlasTexture?Wt.glyphAtlasTexture.size:[0,0],Ra=f.layout.get("text-size-scale-range"),ys=i.aA(v.scaleFactor,Ra[0],Ra[1]),Is=i.bJ(Xl,Le.zoom,ys),Ni=xp(dr,Wt.tileID.canonical,Et,dt,Le,Jt.getProjection(),mr),Ds=od(dr,Wt.tileID.canonical,Et,dt,Le,Jt.getProjection(),mr),Ma=v.translatePosMatrix(Ds,Wt,B,Z,!0),vs=v.translatePosMatrix(dr,Wt,B,Z),Yl=Vn?sh:Ni,Qp=dt&&!Et&&!di;let vd=rr;!vt&&!Le.mercatorFromTransition||dt||(vd=d1(Le));const em=c1(Xl.kind,Is,Qp,Et,v,vs,Yl,Ma,Ve,!0,Nc,Zl,0,xr,pr,tt,Fn,wr?vd:rr,Jt.getProjection(),Ss,Ei,null,null,ys),tm=Wt.glyphAtlasTexture?Wt.glyphAtlasTexture:null,Jl=$e.LINEAR,Iu=f.paint.get("text-halo-width").constantOr(1)!==0,Sa=v.terrain&&Et&&di?i.bk(i.bB(),Ni):sh;if(di&&Jt.text){const Ql=i.bU.getAtTileOffsetFunc(xr,Le.center.lat,Le.worldSize,Jt.getProjection()),Ef=Ug(dr,Wt.tileID.canonical,Et,dt,Le,Jt.getProjection(),mr);Mw(Jt,dr,v,!0,Ef,Ds,Et,xe,Ql,xr,ys)}return{program:ao,buffers:Jt.text,uniformValues:em,atlasTexture:tm,atlasTextureIcon:oo,atlasInterpolation:Jl,atlasInterpolationIcon:wo,isSDF:!0,hasHalo:Iu,depthMode:_l,tile:Wt,renderWithShadows:hs,labelPlaneMatrixInv:Sa}},Li=Jt.icon.segments.get().length,Yn=Jt.text.segments.get().length,pn=Li&&!k.onlyText?yi():null,ai=Yn&&!k.onlyIcons?zn():null,xn=f.paint.get("icon-opacity").constantOr(1),Wi=f.paint.get("text-opacity").constantOr(1);if(yt&&Jt.canOverlap){Nt=!0;const di=xn&&!k.onlyText?Jt.icon.segments.get():[],Qr=Wi&&!k.onlyIcons?Jt.text.segments.get():[];for(const Vn of di)Bt.push({segments:new i.bf([Vn]),sortKey:Vn.sortKey,state:pn});for(const Vn of Qr)Bt.push({segments:new i.bf([Vn]),sortKey:Vn.sortKey,state:ai})}else k.onlyText||Bt.push({segments:xn?Jt.icon.segments:new i.bf([]),sortKey:0,state:pn}),k.onlyIcons||Bt.push({segments:Wi?Jt.text.segments:new i.bf([]),sortKey:0,state:ai})}Nt&&Bt.sort((xr,Wt)=>xr.sortKey-Wt.sortKey);for(const xr of Bt){const Wt=xr.state;if(Wt)if(v.terrain?v.terrain.setupElevationDraw(Wt.tile,Wt.program,{useDepthForOcclusion:Le.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Wt.labelPlaneMatrixInv}):v.setupDepthForOcclusion(Le.depthOcclusionForSymbolsAndCircles,Wt.program),Ge.activeTexture.set($e.TEXTURE0),Wt.atlasTexture&&Wt.atlasTexture.bind(Wt.atlasInterpolation,$e.CLAMP_TO_EDGE,!0),Wt.atlasTextureIcon&&(Ge.activeTexture.set($e.TEXTURE1),Wt.atlasTextureIcon&&Wt.atlasTextureIcon.bind(Wt.atlasInterpolationIcon,$e.CLAMP_TO_EDGE,!0)),Wt.renderWithShadows&&v.shadowRenderer.setupShadows(Wt.tile.tileID.toUnwrapped(),Wt.program,"vector-tile"),v.uploadCommonLightUniforms(v.context,Wt.program),Wt.hasHalo){const Jt=Wt.uniformValues;Jt.u_is_halo=1,U_(Wt.buffers,xr.segments,f,v,Wt.program,Wt.depthMode,E,j,Jt,2),Jt.u_is_halo=0}else{if(Wt.isSDF){const Jt=Wt.uniformValues;Wt.hasHalo&&(Jt.u_is_halo=1,U_(Wt.buffers,xr.segments,f,v,Wt.program,Wt.depthMode,E,j,Jt,1)),Jt.u_is_halo=0}U_(Wt.buffers,xr.segments,f,v,Wt.program,Wt.depthMode,E,j,Wt.uniformValues,1)}}}function U_(v,l,f,_,E,j,k,L,B,G){const Z=[v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer,v.iconTransitioningVertexBuffer,v.globeExtVertexBuffer,v.zOffsetVertexBuffer,v.orientationVertexBuffer];E.draw(_,_.context.gl.TRIANGLES,j,k,L,Xr.disabled,B,f.id,v.layoutVertexBuffer,v.indexBuffer,l,f.paint,_.transform.zoom,v.programConfigurations.get(f.id),Z,G)}function CA(v,l){const f=1<<v.canonical.z,_=(l.x*f-v.canonical.x-v.wrap*f)*i.al,E=(l.y*f-v.canonical.y)*i.al,j=i.e7(l.z,l.y);return i.d4(_,E,j)}function vf(v,l,f,_,E){if(!f.layout||f.layout.get("fill-elevation-reference")==="none"||f.paint.get("fill-opacity").constantOr(1)===0)return;const j=v.context.gl,k=new Er(v.context.gl.LEQUAL,Er.ReadWrite,v.depthRangeFor3D),L=new Er(v.context.gl.GREATER,Er.ReadWrite,v.depthRangeFor3D),B=function(se){let le=.01;return se.isOrthographic&&(le=i.ak(1e-4,le,i.c$(se.pitch>=hf?1:se.pitch/hf))),2*le}(v.transform),G=v.transform.getFreeCameraOptions().position,Z="elevatedStructuresDepthReconstruct",Q=v.getOrCreateProgram(Z,{defines:["DEPTH_RECONSTRUCTION"]}),X=v.getOrCreateProgram(Z);for(const se of _){const le=l.getTile(se),de=le.getBucket(f);if(!de)continue;const xe=de.elevatedStructures;if(!xe)continue;const ye=de.elevationBufferData.heightRange,Ee=CA(se.toUnwrapped(),G),Ne=v.translatePosMatrix(se.projMatrix,le,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));let je,Ve,Ie,Ge;if(E==="initialize"){if(!ye||ye.min>=1||xe.depthSegments.segments[0].primitiveLength===0)continue;je=k_(Ne,Ee,B,1,0),Ve=k,Ie=xe.depthSegments,Ge=Q}else if(E==="reset"){if(!ye||ye.min>=0||xe.maskSegments.segments[0].primitiveLength===0)continue;je=k_(Ne,Ee,0,0,1),Ve=L,Ie=xe.maskSegments,Ge=Q}else if(E==="geometry"){if(xe.depthSegments.segments[0].primitiveLength===0)continue;je=k_(Ne,Ee,B,1,0),Ve=k,Ie=xe.depthSegments,Ge=X}Ge.draw(v,j.TRIANGLES,Ve,tn.disabled,vn.disabled,Xr.disabled,je,f.id,xe.vertexBuffer,xe.indexBuffer,Ie,f.paint,v.transform.zoom)}}function zp(v,l,f){const{painter:_,sourceCache:E,layer:j,coords:k,colorMode:L,elevationType:B,terrainEnabled:G,pass:Z}=v,Q=_.context.gl,X=j.paint.get("fill-pattern"),se=j.paint.get("fill-pattern-cross-fade"),le=X.constantOr(null);let de=B;B!=="road"||l&&!G||(de="none");const xe=de==="road",ye=v.painter.shadowRenderer,Ee=xe&&!!ye&&ye.enabled,Ne=new Er(_.context.gl.LEQUAL,Er.ReadOnly,_.depthRangeFor3D);let je=[0,0,0];if(Ee){const Ge=_.style.directionalLight,$e=_.style.ambientLight;Ge&&$e&&(je=Ac(_.style,Ge,$e))}const Ve=X&&X.constantOr(1),Ie=(Ge,$e)=>{let Le,Ke,dt,at,Et;$e?(Le=Ve&&!j.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",dt=Q.LINES):(Le=Ve?"fillPattern":"fill",dt=Q.TRIANGLES);for(const yt of k){const Nt=E.getTile(yt);if(Ve&&!Nt.patternsLoaded())continue;const Xt=Nt.getBucket(j);if(!Xt)continue;const mt=l?Xt.elevationBufferData:Xt.bufferData;if(mt.isEmpty())continue;_.prepareDrawTile();const tt=mt.programConfigurations.get(j.id),It=_.isTileAffectedByFog(yt),vt=[],Bt=[];xe&&(vt.push("ELEVATED_ROADS"),Bt.push(mt.elevatedLayoutVertexBuffer)),Ee&&vt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ve&&(_.context.activeTexture.set(Q.TEXTURE0),Nt.imageAtlasTexture&&Nt.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),tt.updatePaintBuffers());let rr=!1;if(le&&Nt.imageAtlas){const pr=Nt.imageAtlas,dr=i.e2.from(le),mr=dr.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),$r=dr.getSecondary(),jn=pr.patternPositions.get(mr),Fn=$r?pr.patternPositions.get($r.scaleSelf(i.o.devicePixelRatio).toString()):null;rr=!!jn&&!!Fn,jn&&tt.setConstantPatternPositions(jn,Fn)}se>0&&(rr||tt.getPatternTransitionVertexBuffer("fill-pattern"))&&vt.push("FILL_PATTERN_TRANSITION");const xr=_.getOrCreateProgram(Le,{config:tt,overrideFog:It,defines:vt}),Wt=_.translatePosMatrix(yt.projMatrix,Nt,j.paint.get("fill-translate"),j.paint.get("fill-translate-anchor"));Ee&&ye.setupShadows(Nt.tileID.toUnwrapped(),xr,"vector-tile");const Jt=j.paint.get("fill-emissive-strength");if($e){at=mt.lineIndexBuffer,Et=mt.lineSegments;const pr=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[Q.drawingBufferWidth,Q.drawingBufferHeight];Ke=Le==="fillOutlinePattern"&&Ve?uR(Wt,Jt,_,Nt,pr,je,se):cR(Wt,Jt,pr,je)}else at=mt.indexBuffer,Et=mt.triangleSegments,Ke=Ve?wA(Wt,Jt,_,Nt,je,se):bA(Wt,Jt,je);_.uploadCommonUniforms(_.context,xr,yt.toUnwrapped());let wr=Ge;(B==="road"&&!G||B==="offset")&&(wr=Ne),xr.draw(_,dt,wr,f||_.stencilModeForClipping(yt),L,Xr.disabled,Ke,j.id,mt.layoutVertexBuffer,at,Et,j.paint,_.transform.zoom,tt,Bt)}};_.renderPass===Z&&Ie(_.depthModeForSublayer(1,_.renderPass==="opaque"?Er.ReadWrite:Er.ReadOnly),!1),de==="none"&&_.renderPass==="translucent"&&j.paint.get("fill-antialias")&&Ie(_.depthModeForSublayer(j.getPaintProperty("fill-outline-color")?2:0,Er.ReadOnly),!0)}function _r(v,l,f,_,E,j,k,L){f.resetLayerRenderingStats(v);const B=v.context,G=B.gl,Z=v.transform,Q=f.paint.get("fill-extrusion-pattern"),X=f.paint.get("fill-extrusion-pattern-cross-fade"),se=Q.constantOr(null),le=Q.constantOr(1),de=f.paint.get("fill-extrusion-opacity"),xe=v.style.enable3dLights(),ye=f.paint.get(xe&&!le?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Ee=[f.paint.get("fill-extrusion-ambient-occlusion-intensity"),ye],Ne=f.layout.get("fill-extrusion-edge-radius"),je=Ne>0&&!f.paint.get("fill-extrusion-rounded-roof"),Ve=je?0:Ne,Ie=Z.projection.name==="globe"?i.ea():0,Ge=Z.projection.name==="globe",$e=Ge?i.aj(Z.zoom):0,Le=[i.aF(Z.center.lng),i.aJ(Z.center.lat)],Ke=f.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",dt=f.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ke?null:f.lut).toArray01().slice(0,3),at=f.paint.get("fill-extrusion-flood-light-intensity"),Et=f.paint.get("fill-extrusion-vertical-scale"),yt=f.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Nt=f.paint.get("fill-extrusion-height-alignment"),Xt=f.paint.get("fill-extrusion-base-alignment"),mt=dd(v,f.paint.get("fill-extrusion-cutoff-fade-range")),tt=[];let It;Ge&&tt.push("PROJECTION_GLOBE_VIEW"),Ee[0]>0&&tt.push("FAUX_AO"),je&&tt.push("ZERO_ROOF_RADIUS"),L&&tt.push("HAS_CENTROID"),at>0&&tt.push("FLOOD_LIGHT"),mt.shouldRenderCutoff&&tt.push("RENDER_CUTOFF"),yt&&tt.push("RENDER_WALL_MODE");const vt=v.renderPass==="shadow",Bt=v.shadowRenderer,rr=vt&&!!Bt,xr=vt?Xr.disabled:Xr.backCCW;v.shadowRenderer&&(v.shadowRenderer.useNormalOffset=!0);let Wt=[0,0,0];if(Bt){const pr=v.style.directionalLight,dr=v.style.ambientLight;pr&&dr&&(Wt=Ac(v.style,pr,dr)),vt||(tt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Bt.useNormalOffset&&tt.push("NORMAL_OFFSET")),It=tt.concat(["SHADOWS_SINGLE_CASCADE"])}const Jt=rr?"fillExtrusionDepth":le?"fillExtrusionPattern":"fillExtrusion",wr=f.getLayerRenderingStats();for(const pr of _){const dr=l.getTile(pr),mr=dr.getBucket(f);if(!mr||mr.projection.name!==Z.projection.name)continue;let $r=!1;Bt&&($r=Bt.getMaxCascadeForTile(pr.toUnwrapped())===0);const jn=v.isTileAffectedByFog(pr),Fn=mr.programConfigurations.get(f.id);let Ei=!1;if(se&&dr.imageAtlas){const Yn=dr.imageAtlas,pn=i.e2.from(se),ai=pn.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),xn=pn.getSecondary(),Wi=Yn.patternPositions.get(ai),di=xn?Yn.patternPositions.get(xn.scaleSelf(i.o.devicePixelRatio).toString()):null;Ei=!!Wi&&!!di,Wi&&Fn.setConstantPatternPositions(Wi,di)}X>0&&(Ei||Fn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&tt.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Yr=v.getOrCreateProgram(Jt,{config:Fn,defines:$r?It:tt,overrideFog:jn});if(v.terrain&&v.terrain.setupElevationDraw(dr,Yr,{useMeterToDem:!0}),!mr.centroidVertexBuffer){const Yn=Yr.getAttributeLocation(G,"a_centroid_pos");Yn!==-1&&G.vertexAttrib2f(Yn,0,0)}!vt&&Bt&&Bt.setupShadows(dr.tileID.toUnwrapped(),Yr,"vector-tile"),le&&(v.context.activeTexture.set(G.TEXTURE0),dr.imageAtlasTexture&&dr.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Fn.updatePaintBuffers());const Dn=f.paint.get("fill-extrusion-vertical-gradient"),hn=1/mr.tileToMeter;let yi;if(vt&&Bt){if(jA(dr.tileID,mr.maxHeight,v))continue;const Yn=Bt.calculateShadowPassMatrixFromTile(dr.tileID.toUnwrapped());yi=_A(Yn,Ve,hn,Et,Nt,Xt)}else{const Yn=v.translatePosMatrix(pr.expandedProjMatrix,dr,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),pn=Z.projection.createInversionMatrix(Z,pr.canonical);yi=le?xA(Yn,v,Dn,de,Ee,Ve,hn,pr,dr,Ie,Nt,Xt,$e,Le,pn,dt,Et,X):O_(Yn,v,Dn,de,Ee,Ve,hn,pr,Ie,Nt,Xt,$e,Le,pn,dt,Et,at,Wt)}v.uploadCommonUniforms(B,Yr,pr.toUnwrapped(),null,mt);let zn=mr.segments;if(Z.projection.name==="mercator"&&!vt&&(zn=mr.getVisibleSegments(dr.tileID,v.terrain,v.transform.getFrustum(0)),!zn.get().length))continue;if(wr)if(vt)for(const Yn of zn.get())wr.numRenderedVerticesInShadowPass+=Yn.primitiveLength;else for(const Yn of zn.get())wr.numRenderedVerticesInTransparentPass+=Yn.primitiveLength;const Li=[];(v.terrain||L)&&Li.push(mr.centroidVertexBuffer),Ge&&Li.push(mr.layoutVertexExtBuffer),yt&&Li.push(mr.wallVertexBuffer),Yr.draw(v,B.gl.TRIANGLES,E,j,k,xr,yi,f.id,mr.layoutVertexBuffer,mr.indexBuffer,zn,f.paint,v.transform.zoom,Fn,Li)}v.shadowRenderer&&(v.shadowRenderer.useNormalOffset=!1)}class h1{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function fd(v,l,f,_,E,j,k,L,B,G,Z,Q,X,se,le,de,xe,ye,Ee,Ne){const je=l.context,Ve=je.gl,Ie=l.transform,Ge=l.transform.zoom,$e=[],Le=v.translate,Ke=v.translateAnchor,dt=v.edgeRadius,at=dd(l,v.cutoffFadeRange);Z==="clear"?($e.push("CLEAR_SUBPASS"),Ne&&($e.push("CLEAR_FROM_TEXTURE"),je.activeTexture.set(Ve.TEXTURE0),Ne.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE))):Z==="sdf"&&$e.push("SDF_SUBPASS"),ye&&$e.push("HAS_CENTROID"),at.shouldRenderCutoff&&$e.push("RENDER_CUTOFF");const Et=(yt,Nt,Xt,mt,tt)=>{let It=$e;Nt.groundRadiusBuffer!=null&&(It=$e.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const vt=Nt.programConfigurations.get(_.id),Bt=l.isTileAffectedByFog(yt),rr=l.getOrCreateProgram("fillExtrusionGroundEffect",{config:vt,defines:It,overrideFog:Bt}),xr=Dp(l,mt,Q,G,tt,[X,se*tt],le,de,xe,Ge>=17?0:dt*tt,Ne?Ne.size[0]:0),Wt=[];ye&&Wt.push(Nt.hiddenByLandmarkVertexBuffer),Nt.groundRadiusBuffer!=null&&Wt.push(Nt.groundRadiusBuffer),l.uploadCommonUniforms(je,rr,yt.toUnwrapped(),null,at),rr.draw(l,je.gl.TRIANGLES,j,k,L,B,xr,_.id,Nt.vertexBuffer,Nt.indexBuffer,Xt,_.paint,Ge,vt,Wt)};for(const yt of E){const Nt=f.getTile(yt),Xt=Nt.getBucket(_);if(!Xt||Xt.projection.name!==Ie.projection.name||!Xt.groundEffect||Xt.groundEffect&&!Xt.groundEffect.hasData())continue;const mt=Xt.groundEffect,tt=1/Xt.tileToMeter;{const It=l.translatePosMatrix(yt.projMatrix,Nt,Le,Ke),vt=mt.getDefaultSegment();Et(yt,mt,vt,It,tt)}if(Ee)for(let It=0;It<4;It++){const vt=i.e8[It](yt),Bt=f.getTile(vt);if(!Bt)continue;const rr=Bt.getBucket(_);if(!rr||rr.projection.name!==Ie.projection.name||!rr.groundEffect||rr.groundEffect&&!rr.groundEffect.hasData())continue;const xr=rr.groundEffect;let Wt,Jt;It===0?(Wt=[-i.al,0,0],Jt=1):It===1?(Wt=[i.al,0,0],Jt=0):It===2?(Wt=[0,-i.al,0],Jt=3):(Wt=[0,i.al,0],Jt=2);const wr=xr.regionSegments[Jt];if(!wr)continue;const pr=new Float32Array(16);i.bq(pr,yt.projMatrix,Wt),Et(yt,xr,wr,l.translatePosMatrix(pr,Nt,Le,Ke),tt)}}}function ah(v,l,f,_,E,j,k){_.centroidVertexArray.length===0&&_.createCentroidsBuffer();const L=j?j.findDEMTileFor(f):null;if(!(L&&L.dem||k))return;j&&L&&L.dem&&_.selfDEMTileTimestamp!==L.dem._timestamp&&(_.borderDoneWithNeighborZ=[-1,-1,-1,-1],_.selfDEMTileTimestamp=L.dem._timestamp);const B=ye=>new i.P(Math.ceil((ye+i.ec)*i.ed),0),G=ye=>{const Ee=l.getSource().minzoom,Ne=Ve=>{const Ie=l.getTileByID(Ve);if(Ie&&Ie.hasData())return Ie.getBucket(E)},je=[0,-1,1];for(const Ve of je){if(ye.overscaledZ+Ve<Ee)continue;const Ie=Ne(ye.calculateScaledKey(ye.overscaledZ+Ve));if(Ie)return Ie}},Z=[0,0,0],Q=(ye,Ee)=>(Z[0]=Math.min(ye.min.y,Ee.min.y),Z[1]=Math.max(ye.max.y,Ee.max.y),Z[2]=i.al-Ee.min.x>ye.max.x?Ee.min.x-i.al:ye.max.x,Z),X=(ye,Ee)=>(Z[0]=Math.min(ye.min.x,Ee.min.x),Z[1]=Math.max(ye.max.x,Ee.max.x),Z[2]=i.al-Ee.min.y>ye.max.y?Ee.min.y-i.al:ye.max.y,Z),se=[(ye,Ee)=>Q(ye,Ee),(ye,Ee)=>Q(Ee,ye),(ye,Ee)=>X(ye,Ee),(ye,Ee)=>X(Ee,ye)],le=(ye,Ee,Ne,je,Ve,Ie,Ge)=>{if(!j)return 0;const $e=[[Ie?Ne:ye,Ie?ye:Ne,0],[Ie?Ne:Ee,Ie?Ee:Ne,0]],Le=Ge<0?i.al+Ge:Ge,Ke=[Ie?Le:(ye+Ee)/2,Ie?(ye+Ee)/2:Le,0];return Ne===0&&Ge<0||Ne!==0&&Ge>0?j.getForTilePoints(Ve,[Ke],!0,je):$e.push(Ke),j.getForTilePoints(f,$e,!0,L),Math.max($e[0][2],$e[1][2],Ke[2])/j.exaggeration()};for(let ye=0;ye<4;ye++){const Ee=_.borderFeatureIndices[ye];if(Ee.length===0)continue;const Ne=i.e8[ye](f),je=G(Ne);if(!(je&&je instanceof i.e9))continue;const Ve=j?j.findDEMTileFor(Ne):null;if(!(Ve&&Ve.dem||k)||(j&&Ve&&Ve.dem&&_.borderDEMTileTimestamp[ye]!==Ve.dem._timestamp&&(_.borderDoneWithNeighborZ[ye]=-1,_.borderDEMTileTimestamp[ye]=Ve.dem._timestamp),_.borderDoneWithNeighborZ[ye]===je.canonical.z))continue;je.centroidVertexArray.length===0&&je.createCentroidsBuffer();const Ie=(ye<2?1:5)-ye,Ge=je.borderDoneWithNeighborZ[Ie]!==_.canonical.z,$e=je.borderFeatureIndices[Ie];let Le=0;if(_.canonical.z!==je.canonical.z){for(const Ke of Ee)_.showCentroid(_.featuresOnBorder[Ke]);if(Ge)for(const Ke of $e)je.showCentroid(je.featuresOnBorder[Ke]);_.borderDoneWithNeighborZ[ye]=je.canonical.z,je.borderDoneWithNeighborZ[Ie]=_.canonical.z}for(const Ke of Ee){const dt=_.featuresOnBorder[Ke],at=_.centroidData[dt.centroidDataIndex],Et=dt.borders[ye];let yt;for(;Le<$e.length;){yt=je.featuresOnBorder[$e[Le]];const Nt=yt.borders[Ie];if(Nt[1]>Et[0]+3||Nt[0]>Et[0]-3)break;je.showCentroid(yt),Le++}if(yt&&Le<$e.length){const Nt=Le;let Xt=0;for(;!(yt.borders[Ie][0]>Et[1]-3)&&(Xt++,++Le!==$e.length);)yt=je.featuresOnBorder[$e[Le]];yt=je.featuresOnBorder[$e[Nt]];let mt=!1;if(Xt>=1){const vt=yt.borders[Ie];Math.abs(Et[0]-vt[0])<3&&Math.abs(Et[1]-vt[1])<3&&(Xt=1,mt=!0,Le=Nt+1)}else if(Xt===0){_.showCentroid(dt);continue}const tt=je.centroidData[yt.centroidDataIndex];k&&mt&&(((de=at).flags|(xe=tt).flags)&i.eb?(de.flags|=i.eb,xe.flags|=i.eb):(de.flags&=~i.eb,xe.flags&=~i.eb));const It=dt.intersectsCount()>1||yt.intersectsCount()>1;if(Xt>1)Le=Nt,at.centroidXY=tt.centroidXY=new i.P(0,0);else if(Ve&&Ve.dem&&!It){const vt=se[ye](at,tt),Bt=ye%2?i.al-1:0,rr=le(vt[0],Math.min(i.al-1,vt[1]),Bt,Ve,Ne,ye<2,vt[2]);at.centroidXY=tt.centroidXY=B(rr)}else It?at.centroidXY=tt.centroidXY=new i.P(0,0):(at.centroidXY=_.encodeBorderCentroid(dt),tt.centroidXY=je.encodeBorderCentroid(yt));_.writeCentroidToBuffer(at),je.writeCentroidToBuffer(tt)}else _.showCentroid(dt)}_.borderDoneWithNeighborZ[ye]=je.canonical.z,je.borderDoneWithNeighborZ[Ie]=_.canonical.z}var de,xe;(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(v)}const oh=[1,0,0],Br=[0,1,0],f1=[0,0,1];function jA(v,l,f){const _=f.transform,E=f.shadowRenderer;if(!E)return!0;const j=v.toUnwrapped(),k=_.tileSize*E._cascades[f.currentShadowCascade].scale;let L=l;if(_.elevation){const de=_.elevation.getMinMaxForTile(v);de&&(L+=de.max)}const B=[...E.shadowDirection];B[2]=-B[2];const G=E.computeSimplifiedTileShadowVolume(j,L,k,B);if(!G)return!1;const Z=[oh,Br,f1,B,[B[0],0,B[2]],[0,B[1],B[2]]],Q=_.projection.name==="globe",X=_.scaleZoom(k),se=i.cA.fromInvProjectionMatrix(_.invProjMatrix,_.worldSize,X,!Q),le=E.getCurrentCascadeFrustum();return se.intersectsPrecise(G.vertices,G.planes,Z)===0||le.intersectsPrecise(G.vertices,G.planes,Z)===0}function V_(v){const{painter:l,source:f,layer:_,coords:E}=v;let j=v.defines;const k=l.context,L=l.renderPass==="shadow",B=l.renderPass==="light-beam",G=l.shadowRenderer,Z=i.ee(l.transform.center.lat,l.transform.zoom),Q=dd(l,_.paint.get("building-cutoff-fade-range"));Q.shouldRenderCutoff&&(j=j.concat("RENDER_CUTOFF")),v.floodLightIntensity>0&&(j=j.concat("FLOOD_LIGHT"));for(const X of E){const se=f.getTile(X),le=se.getBucket(_);if(!le)continue;G&&G.getMaxCascadeForTile(X.toUnwrapped())===0&&(j=j.concat("SHADOWS_SINGLE_CASCADE"));const de=le.programConfigurations.get(_.id);let xe,ye,Ee,Ne=l.translatePosMatrix(X.expandedProjMatrix,se,[0,0],"map");if(Ne=i.cR(i.bB(),Ne,[1,1,v.verticalScale]),L&&G){if(jA(se.tileID,le.maxHeight*Z,l))continue;let Ve=G.calculateShadowPassMatrixFromTile(se.tileID.toUnwrapped());Ve=i.cR(i.bB(),Ve,[1,1,v.verticalScale]),Ee=SA(Ve),xe=ye=l.getOrCreateProgram("buildingDepth",{config:de,defines:j,overrideFog:!1})}else if(B)xe=ye=l.getOrCreateProgram("buildingBloom",{config:de,defines:j,overrideFog:!1}),Ee=s1(Ne);else{const Ve=l.transform.calculatePosMatrix(X.toUnwrapped(),l.transform.worldSize);i.cR(Ve,Ve,[1,1,v.verticalScale]);const Ie=i.bB();i.cR(Ie,Ve,[1,-1,1/Z]),i.bk(Ie,Ie),i.ef(Ie,Ie);const Ge=l.transform.getFreeCameraOptions().position,$e=1<<X.canonical.z;if(Ee=i1(Ne,Ie,v.opacity,v.facadeAOIntensity,[((Ge.x-X.wrap)*$e-X.canonical.x)*i.al,(Ge.y*$e-X.canonical.y)*i.al,Ge.z*$e*i.al],le.tileToMeter,v.facadeEmissiveChance,v.floodLightColor,v.floodLightIntensity),ye=l.getOrCreateProgram("building",{config:de,defines:j,overrideFog:!1}),v.depthOnly===!0)xe=ye;else{const Le=j.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);xe=l.getOrCreateProgram("building",{config:de,defines:Le,overrideFog:!1})}G&&(G.setupShadowsFromMatrix(Ve,ye,!0),xe!==ye&&G.setupShadowsFromMatrix(Ve,xe,!0))}const je=(Ve,Ie)=>{if(B){const Ge=Ve.entranceBloom;Ie.draw(l,k.gl.TRIANGLES,v.depthMode,tn.disabled,v.blendMode,Xr.disabled,Ee,_.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segmentsBucket,_.paint,l.transform.zoom,de,[Ge.layoutAttenuationBuffer,Ge.layoutColorBuffer])}else{const Ge=Ve.segmentsBucket;let $e=[Ve.layoutNormalBuffer,Ve.layoutCentroidBuffer,Ve.layoutColorBuffer,Ve.layoutFloodLightDataBuffer];Ve.layoutFacadePaintBuffer&&($e=$e.concat([Ve.layoutFacadeDataBuffer,Ve.layoutFacadeVerticalRangeBuffer,Ve.layoutFacadePaintBuffer])),Ie.draw(l,k.gl.TRIANGLES,v.depthMode,tn.disabled,v.blendMode,L?Xr.disabled:Xr.backCW,Ee,_.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ge,_.paint,l.transform.zoom,de,$e)}};l.uploadCommonUniforms(k,ye,X.toUnwrapped(),null,Q),le.buildingWithoutFacade&&je(le.buildingWithoutFacade,ye),le.buildingWithFacade&&(xe!==ye&&l.uploadCommonUniforms(k,xe,X.toUnwrapped(),null,Q),je(le.buildingWithFacade,xe))}}function q_(v,l,f,_,E,j,k,L,B,G,Z,Q,X){const se=v.context.gl,le=v.depthModeForSublayer(1,Er.ReadOnly,se.LEQUAL,!0),de=.1*(1-(xe=Z))+3*xe;var xe;const ye=v._showOverdrawInspector,Ee=Q,Ne=new h1;ye||fd(Ne,v,l,f,_,le,new tn({func:se.ALWAYS,mask:255},255,255,se.KEEP,se.KEEP,se.REPLACE),new vn([se.ONE,se.ONE,se.ONE,se.ONE],i.ao.transparent,[!1,!1,!1,!0],se.MIN),Xr.disabled,E,"sdf",j,k,L,B,G,de,Ee,!1);{const je=ye?tn.disabled:new tn({func:se.EQUAL,mask:255},255,255,se.KEEP,se.DECR,se.DECR),Ve=ye?v.colorModeForRenderPass():new vn([se.ONE_MINUS_DST_ALPHA,se.DST_ALPHA,se.ONE,se.ONE],i.ao.transparent,[!0,!0,!0,!0]);fd(Ne,v,l,f,_,le,je,Ve,Xr.disabled,E,"color",j,k,L,B,G,de,Ee,!1)}}function p1(v){return[v[0]*i.eg,v[1]*i.eg,v[2]*i.eg,0]}function m1(v,l,f,_,E,j,k,L,B){const G=_.getSource(),Z=f.globeSharedBuffers;if(!Z)return;let Q,X,se;if(l&&(Q=_.getTile(l)),G instanceof i.aT?(X=G.texture,se=i.dJ(0,0,f.transform)):Q&&l&&(X=Q.texture,se=i.dJ(l.canonical.z,l.canonical.x,f.transform)),!X||!se)return;v||(se=i.cR(i.bB(),se,[1,-1,1]));const le=f.context,de=le.gl,xe=E.paint.get("raster-resampling")==="nearest"?de.NEAREST:de.LINEAR,ye=f.colorModeForDrapableLayerRenderPass(j),Ee=k.defines;Ee.push("GLOBE_POLES");const Ne=new Er(de.LEQUAL,Er.ReadWrite,f.depthRangeFor3D),je=Float32Array.from(f.transform.expandedFarZProjMatrix),Ve=Float32Array.from(i.bj(i.dI(new i.cC(0,0,0))));f.terrain&&f.terrain.prepareDrawTile(),le.activeTexture.set(de.TEXTURE0),X.bind(xe,de.CLAMP_TO_EDGE),le.activeTexture.set(de.TEXTURE1),X.bind(xe,de.CLAMP_TO_EDGE),"useMipmap"in X&&le.extTextureFilterAnisotropic&&f.transform.pitch>20&&de.texParameterf(de.TEXTURE_2D,le.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,le.extTextureFilterAnisotropicMax);const[Ie,Ge,$e,Le]=l?Z.getPoleBuffers(l.canonical.z,!1):Z.getPoleBuffers(0,!0),Ke=E.paint.get("raster-elevation");let dt;v?(dt=Ie,f.renderDefaultNorthPole=Ke!==0):(dt=Ge,f.renderDefaultSouthPole=Ke!==0);const at=p1(k.mix),Et=((Nt,Xt,mt,tt,It,vt,Bt,rr,xr,Wt,Jt,wr,pr)=>oy(Nt,Xt,mt,new Float32Array(16),new Float32Array(9),[0,0],tt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},vt,[0,0],rr,2,Wt,Jt,wr,1,0,pr))(je,Ve,se,i.aj(f.transform.zoom),0,E,0,Ke,0,at,k.offset,k.range,j),yt=f.getOrCreateProgram("raster",{defines:Ee});f.uploadCommonUniforms(le,yt,null),yt.draw(f,de.TRIANGLES,Ne,B,ye,L,Et,E.id,dt,$e,Le)}function PA(v){const l=v._nearZ,f=v.projection.farthestPixelDistance(v),_=f-l,E=.2*v.height,j=l+E;return[l,f,(j-E-l)/_,(j-l)/_]}function pR(v,l,f,_){if(v)return l instanceof ba&&v instanceof Qd?l.getTextureDescriptor(v,f,!0):{texture:v.texture,mix:p1(_.mix),offset:_.offset,buffer:0,tileSize:1}}var mR=i.eh([{name:"a_index",type:"Int16",components:1}]);class kl{constructor(l,f,_,E){const j={width:_[0],height:_[1],data:null},k=l.gl;this.targetColorTexture=new i.T(l,j,k.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(l,j,k.RGBA8,{useMipmap:!1}),this.context=l,this.updateParticleTexture(f,E),this.lastInvalidatedAt=0}updateParticleTexture(l,f){if(this.particleTextureDimension===f.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const _=this.context.gl,E=f.width*f.height;this.particleTexture0=new i.T(this.context,f,_.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,f,_.RGBA8,{premultiply:!1,useMipmap:!1});const j=new i.ei;j.reserve(E);for(let k=0;k<E;k++)j.emplaceBack(k);this.particleIndexBuffer=this.context.createVertexBuffer(j,mR.members,!0),this.particleSegment=i.bf.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=f.width}update(l){return!(this.lastInvalidatedAt<l&&(this.lastInvalidatedAt=i.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function g1(v,l,f){if(!v)return null;const _=l.getTextureDescriptor(v,f,!0);if(!_)return null;let{texture:E,mix:j,offset:k,tileSize:L,buffer:B,format:G}=_;if(!E||!G)return null;let Z=!1;return G==="uint32"&&(Z=!0,j[3]=0,j=N_(i.ej,j,[0,f.paint.get("raster-particle-max-speed")]),k=hd(i.ej,k,[0,f.paint.get("raster-particle-max-speed")])),{texture:E,textureOffset:[B/(L+2*B),L/(L+2*B)],tileSize:L,scalarData:Z,scale:j,offset:k,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[G]]}}function sl(v){const l=v._nearZ,f=v.projection.farthestPixelDistance(v),_=f-l,E=.2*v.height,j=l+E;return[l,f,(j-E-l)/_,(j-l)/_]}const lh=new i.ao(1,0,0,1),OA=new i.ao(0,1,0,1),y1=new i.ao(0,0,1,1),v1=new i.ao(1,0,1,1),_1=new i.ao(0,1,1,1);function x1(v,l,f,_,E,j){for(let k=0;k<f.length;k++)if(E){const G=new i.ao(_.r*.8,_.g*.8,_.b*.8,1);Nl(v,l,f[k],_,-1,-1,j),Nl(v,l,f[k],_,-1,1,j),Nl(v,l,f[k],_,1,1,j),Nl(v,l,f[k],_,1,-1,j),Nl(v,l,f[k],G,0,0,j)}else Nl(v,l,f[k],_,0,0,j)}function Nl(v,l,f,_,E,j,k){const L=v.context,B=v.transform,G=L.gl,Z=B.projection.name==="globe",Q=Z?["PROJECTION_GLOBE_VIEW"]:[];let X=i.by(f.projMatrix);if(Z&&i.aj(B.zoom)>0){const at=i.bi(f.canonical,B),Et=i.ek(at);X=i.aB(new Float32Array(16),B.globeMatrix,Et),i.aB(X,B.projMatrix,X)}const se=i.bB();se[12]+=2*E/(i.o.devicePixelRatio*B.width),se[13]+=2*j/(i.o.devicePixelRatio*B.height),i.aB(X,se,X);const le=v.getOrCreateProgram("debug",{defines:Q}),de=l.getTileByID(f.key);v.terrain&&v.terrain.setupElevationDraw(de,le);const xe=Er.disabled,ye=tn.disabled,Ee=v.colorModeForRenderPass(),Ne="$debug";L.activeTexture.set(G.TEXTURE0),v.emptyTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Z?de._makeGlobeTileDebugBuffers(v.context,B):de._makeDebugTileBoundsBuffers(v.context,B.projection);const je=de._tileDebugBuffer||v.debugBuffer,Ve=de._tileDebugIndexBuffer||v.debugIndexBuffer,Ie=de._tileDebugSegments||v.debugSegments;if(le.draw(v,G.LINE_STRIP,xe,ye,Ee,Xr.disabled,a1(X,_.toPremultipliedRenderColor(null)),Ne,je,Ve,Ie,null,null,null,[de._globeTileDebugBorderBuffer]),k){const at=de.latestRawTileData,Et=Math.floor((at&&at.byteLength||0)/1024);let yt=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(yt+=` => ${f.overscaledZ}`),yt+=` ${de.state}`,yt+=` ${Et}kb`,function(Nt,Xt){Nt.initDebugOverlayCanvas();const mt=Nt.debugOverlayCanvas,tt=Nt.context.gl,It=Nt.debugOverlayCanvas.getContext("2d");It.clearRect(0,0,mt.width,mt.height),It.shadowColor="white",It.shadowBlur=2,It.lineWidth=1.5,It.strokeStyle="white",It.textBaseline="top",It.font="bold 36px Open Sans, sans-serif",It.fillText(Xt,5,5),It.strokeText(Xt,5,5),Nt.debugOverlayTexture.update(mt),Nt.debugOverlayTexture.bind(tt.LINEAR,tt.CLAMP_TO_EDGE)}(v,yt)}const Ge=l.getTile(f).tileSize,$e=512/Math.min(Ge,512)*(f.overscaledZ/B.zoom)*.5,Le=de._tileDebugTextBuffer||v.debugBuffer,Ke=de._tileDebugTextIndexBuffer||v.quadTriangleIndexBuffer,dt=de._tileDebugTextSegments||v.debugSegments;le.draw(v,G.TRIANGLES,xe,ye,vn.alphaBlended,Xr.disabled,a1(X,i.ao.transparent.toPremultipliedRenderColor(null),$e),Ne,Le,Ke,dt,null,null,null,[de._globeTileDebugTextBuffer])}function Vi(v,l,f,_){Bp(v,0,l+f/2,v.transform.width,f,_)}function uy(v,l,f,_){Bp(v,l-f/2,0,f,v.transform.height,_)}function Bp(v,l,f,_,E,j){const k=v.context,L=k.gl;L.enable(L.SCISSOR_TEST),L.scissor(l*i.o.devicePixelRatio,f*i.o.devicePixelRatio,_*i.o.devicePixelRatio,E*i.o.devicePixelRatio),k.clear({color:j}),L.disable(L.SCISSOR_TEST)}const kA=i.eh([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:NA}=kA;function pd(v,l,f,_){v.emplaceBack(l,f,_)}class b1{constructor(l){this.vertexArray=new i.el,this.indices=new i.b0,pd(this.vertexArray,-1,-1,1),pd(this.vertexArray,1,-1,1),pd(this.vertexArray,-1,1,1),pd(this.vertexArray,1,1,1),pd(this.vertexArray,-1,-1,-1),pd(this.vertexArray,1,-1,-1),pd(this.vertexArray,-1,1,-1),pd(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,NA),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=i.bf.simpleSegment(0,0,36,12)}}function Pc(v,l,f,_,E,j){const k=v.context.gl,L=l.paint.get("sky-atmosphere-color"),B=l.paint.get("sky-atmosphere-halo-color"),G=l.paint.get("sky-atmosphere-sun-intensity"),Z=((Q,X,se,le,de)=>({u_matrix_3f:Q,u_sun_direction:X,u_sun_intensity:se,u_color_tint_r:[le.r,le.g,le.b,le.a],u_color_tint_m:[de.r,de.g,de.b,de.a],u_luminance:5e-5}))(i.en(i.dN(),_),E,G,L.toPremultipliedRenderColor(null),B.toPremultipliedRenderColor(null));k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_CUBE_MAP_POSITIVE_X+j,l.skyboxTexture,0),f.draw(v,k.TRIANGLES,Er.disabled,tn.disabled,vn.unblended,Xr.frontCW,Z,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const _f=i.eh([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Gt{constructor(l){const f=new i.eo;f.emplaceBack(-1,1,1,0,0),f.emplaceBack(1,1,1,1,0),f.emplaceBack(1,-1,1,1,1),f.emplaceBack(-1,-1,1,0,1);const _=new i.b0;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(f,_f.members),this.indexBuffer=l.createIndexBuffer(_),this.segments=i.bf.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ur=i.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class $p{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class ws{constructor(l){this.colorModeAlphaBlendedWriteRGB=new vn([1,Ms,1,Ms],i.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new vn([1,0,1,0],i.ao.transparent,[!1,!1,!1,!0]),this.params=new $p,this.updateNeeded=!0,l.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),l.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),l.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),l.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(l){const f=l.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Gt(f);const _=this.params.sizeRange,E=this.params.intensityRange,j=function(Z){const Q=i.eq(30),X=[];for(let se=0;se<Z;++se){const le=2*Math.PI*Q(),de=Math.acos(1-2*Q())-.5*Math.PI;X.push(i.d4(Math.cos(de)*Math.cos(le),Math.cos(de)*Math.sin(le),Math.sin(de)))}return X}(this.params.starsCount),k=i.eq(300),L=new i.ep,B=new i.b0;let G=0;for(let Z=0;Z<j.length;++Z){const Q=i.c4([],j[Z],200),X=Math.max(0,1+.01*_*(1*k()-.5)),se=Math.max(0,1+.01*E*(1*k()-.5));L.emplaceBack(Q[0],Q[1],Q[2],-1,-1,X,se),L.emplaceBack(Q[0],Q[1],Q[2],1,-1,X,se),L.emplaceBack(Q[0],Q[1],Q[2],1,1,X,se),L.emplaceBack(Q[0],Q[1],Q[2],-1,1,X,se),B.emplaceBack(G+0,G+1,G+2),B.emplaceBack(G+0,G+2,G+3),G+=4}this.starsVx=f.createVertexBuffer(L,ur.members),this.starsIdx=f.createIndexBuffer(B),this.starsSegments=i.bf.simpleSegment(0,0,L.length,B.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(l,f){const _=l.context,E=_.gl,j=l.transform,k=new Er(E.LEQUAL,Er.ReadOnly,[0,1]),L=i.aj(j.zoom),B=l.style.getLut(f.scope),G=f.properties.get("color-use-theme")==="none",Z=f.properties.get("color").toNonPremultipliedRenderColor(G?null:B),Q=f.properties.get("high-color-use-theme")==="none",X=f.properties.get("high-color").toNonPremultipliedRenderColor(Q?null:B),se=f.properties.get("space-color-use-theme")==="none",le=f.properties.get("space-color").toNonPremultipliedRenderColor(se?null:B),de=5e-4,xe=i.er(f.properties.get("horizon-blend"),0,1,de,.25),ye=i.dD(l,_,j)&&xe===de?j.worldSize/(2*Math.PI*1.025)-1:j.globeRadius,Ee=l.frameCounter/1e3%1,Ne=i.ag(j.globeCenterInViewSpace),je=Math.sqrt(Math.pow(Ne,2)-Math.pow(ye,2)),Ve=Math.acos(je/Ne),Ie=Ge=>{const $e=j.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ge&&$e.push("ALPHA_PASS");const Le=l.getOrCreateProgram("globeAtmosphere",{defines:$e}),Ke=((at,Et,yt,Nt,Xt,mt,tt,It,vt,Bt,rr,xr)=>({u_frustum_tl:at,u_frustum_tr:Et,u_frustum_br:yt,u_frustum_bl:Nt,u_horizon:Xt,u_transition:mt,u_fadeout_range:tt,u_atmosphere_fog_color:It.toArray01(),u_high_color:vt.toArray01(),u_space_color:Bt.toArray01(),u_temporal_offset:rr,u_horizon_angle:xr}))(j.frustumCorners.TL,j.frustumCorners.TR,j.frustumCorners.BR,j.frustumCorners.BL,j.frustumCorners.horizon,L,xe,Z,X,le,Ee,Ve);l.uploadCommonUniforms(_,Le);const dt=this.atmosphereBuffer;dt&&Le.draw(l,E.TRIANGLES,k,tn.disabled,Ge?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Xr.backCW,Ke,Ge?"atmosphere_glow_alpha":"atmosphere_glow",dt.vertexBuffer,dt.indexBuffer,dt.segments)};Ie(!1),Ie(!0)}drawStars(l,f){const _=i.aA(f.properties.get("star-intensity"),0,1);if(_===0)return;const E=l.context,j=E.gl,k=l.transform,L=l.getOrCreateProgram("stars"),B=i.c6([]);i.c8(B,B,-k._pitch),i.c7(B,B,-k.angle),i.c8(B,B,i.an(k._center.lat)),i.es(B,B,-i.an(k._center.lng));const G=i.cb(new Float32Array(16),B),Z=i.aB([],k.starsProjMatrix,G),Q=i.en([],G),X=i.et([],Q),se=[0,1,0];i.dP(se,se,X),i.c4(se,se,this.params.sizeMultiplier);const le=[1,0,0];i.dP(le,le,X),i.c4(le,le,this.params.sizeMultiplier);const de=(xe=se,ye=le,Ee=_,{u_matrix:Float32Array.from(Z),u_up:xe,u_right:ye,u_intensity_multiplier:Ee});var xe,ye,Ee;l.uploadCommonUniforms(E,L),this.starsVx&&this.starsIdx&&L.draw(l,j.TRIANGLES,Er.disabled,tn.disabled,this.colorModeAlphaBlendedWriteRGB,Xr.disabled,de,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class ft{constructor(){this.visibleTiles=[]}updateBorders(l,f){const _=[],E=[],j=l._getRenderableCoordinates(!1,!0);for(const B of j){const G=l.getTile(B);if(!G.hasData())continue;const Z=G.getBucket(f);Z&&(Z.isEmpty()||(_.push(B.key),E.push({bucket:Z,tileID:B.canonical})))}let k=_.length!==this.visibleTiles.length;if(!k){_.sort();for(let B=0;B<_.length;B++)if(_[B]!==this.visibleTiles[B]){k=!0;break}}if(!k)return;const L=new Set;this.visibleTiles=_,E.sort((B,G)=>B.tileID.z-G.tileID.z||B.tileID.x-G.tileID.x||B.tileID.y-G.tileID.y);for(const B of E){const G=new Array,Z=new Array,Q=B.bucket;for(const X of Q.featuresOnBorder)L.has(X.featureId)?Z.push(X.footprintIndex):(L.add(X.featureId),G.push(X.footprintIndex));Q.updateFootprintHiddenFlags(G,i.eu,!1),Q.updateFootprintHiddenFlags(Z,i.eu,!0)}}}function w1(v,l){const f=[...v],_=l.cameraWorldSizeForFog/l.worldSize,E=i.bz([]);return i.cR(E,E,[_,_,1]),i.aB(f,E,f),i.aB(f,l.worldToFogMatrix,f),f}function Up(v,l,f,_,E){const j=f.material,k=_.context,{baseColorTexture:L,metallicRoughnessTexture:B}=j.pbrMetallicRoughness,{normalTexture:G,occlusionTexture:Z,emissionTexture:Q}=j;function X(le,de,xe){if(le&&(v.push(de),k.activeTexture.set(k.gl.TEXTURE0+xe),le.gfxTexture)){const{minFilter:ye,magFilter:Ee,wrapS:Ne,wrapT:je}=le.sampler;le.gfxTexture.bindExtraParam(ye,Ee,Ne,je)}}X(L,"HAS_TEXTURE_u_baseColorTexture",Ka.BaseColor),X(B,"HAS_TEXTURE_u_metallicRoughnessTexture",Ka.MetallicRoughness),X(G,"HAS_TEXTURE_u_normalTexture",Ka.Normal),X(Z,"HAS_TEXTURE_u_occlusionTexture",Ka.Occlusion),X(Q,"HAS_TEXTURE_u_emissionTexture",Ka.Emission),E&&(E.texture||(E.texture=new i.d_(_.context,E.image,[E.image.height,E.image.height,E.image.height],k.gl.RGBA8)),k.activeTexture.set(k.gl.TEXTURE0+Ka.LUT),E.texture&&E.texture.bind(k.gl.LINEAR,k.gl.CLAMP_TO_EDGE),v.push("APPLY_LUT_ON_GPU")),f.texcoordBuffer&&(v.push("HAS_ATTRIBUTE_a_uv_2f"),l.push(f.texcoordBuffer)),f.colorBuffer&&(v.push(f.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),l.push(f.colorBuffer)),f.normalBuffer&&(v.push("HAS_ATTRIBUTE_a_normal_3f"),l.push(f.normalBuffer)),f.pbrBuffer&&(v.push("HAS_ATTRIBUTE_a_pbr"),v.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),l.push(f.pbrBuffer)),j.alphaMode!=="OPAQUE"&&j.alphaMode!=="MASK"||v.push("UNPREMULT_TEXTURE_IN_SHADER"),j.defined||v.push("DIFFUSE_SHADED");const se=_.shadowRenderer;se&&(v.push("RENDER_SHADOWS","DEPTH_TEXTURE"),se.useNormalOffset&&v.push("NORMAL_OFFSET"))}function Vp(v,l,f,_,E,j){const k=f.paint.get("model-opacity").constantOr(1),L=l.context,B=new Er(l.context.gl.LEQUAL,v.isLightMesh?Er.ReadOnly:Er.ReadWrite,l.depthRangeFor3D),G=l.transform,Z=v.mesh,Q=Z.material,X=Q.pbrMetallicRoughness,se=l.style.fog;let le;le=l.transform.projection.zAxisUnit==="pixels"?[...v.nodeModelMatrix]:i.aB([],_.zScaleMatrix,v.nodeModelMatrix),i.aB(le,_.negCameraPosMatrix,le);const de=i.bk([],le);i.ef(de,de);const xe=f.paint.get("model-color-use-theme").constantOr("default")==="none",ye=f.paint.get("model-emissive-strength").constantOr(0),Ee=L_(new Float32Array(v.worldViewProjection),new Float32Array(le),new Float32Array(de),null,l,k,X.baseColorFactor,Q.emissiveFactor,X.metallicFactor,X.roughnessFactor,Q,ye,f,void 0,void 0,v.materialOverride,v.modelColor),Ne={defines:[]},je=[],Ve=l.shadowRenderer;Ve&&(Ve.useNormalOffset=!1),Up(Ne.defines,je,Z,l,xe?null:f.lut);let Ie=null;if(se){const Le=w1(v.nodeModelMatrix,l.transform);if(Ie=new Float32Array(Le),G.projection.name!=="globe"){const Ke=Z.aabb.min,dt=Z.aabb.max,[at,Et]=se.getOpacityForBounds(Le,Ke[0],Ke[1],dt[0],dt[1]);Ne.overrideFog=at>=_t||Et>=_t}}const Ge=dd(l,f.paint.get("model-cutoff-fade-range"));Ge.shouldRenderCutoff&&Ne.defines.push("RENDER_CUTOFF");const $e=l.getOrCreateProgram("model",Ne);l.uploadCommonUniforms(L,$e,null,Ie,Ge),l.renderPass!=="shadow"&&Ve&&Ve.setupShadowsFromMatrix(v.nodeModelMatrix,$e),$e.draw(l,L.gl.TRIANGLES,B,E,j,Z.material.doubleSided?Xr.disabled:Xr.backCCW,Ee,f.id,Z.vertexBuffer,Z.indexBuffer,Z.segments,f.paint,l.transform.zoom,void 0,je)}function H_(v,l,f){return v.type==="vector"?l.scope:f?"basemap":""}function G_(v,l,f,_,E,j,k,L,B){const G=v.transform,Z=!!l.isGeometryBloom&&l.isGeometryBloom;if(Z&&v.renderPass==="shadow")return;const Q=G.projection.name==="globe"?i.eC(f,G):[...f];i.aB(Q,Q,l.globalMatrix);const X=i.aB([],_,Q);if(l.meshes)for(const se of l.meshes){const le=L.get(se.material.name);if(le&&le.opacity<=0)continue;if(se.material.alphaMode!=="BLEND"){k.push({mesh:se,depth:0,modelIndex:E,worldViewProjection:X,nodeModelMatrix:Q,isLightMesh:Z,materialOverride:le,modelColor:B});continue}const de=i.af([],se.centroid,X);!G.isOrthographic&&de[2]<=0||j.push({mesh:se,depth:de[2],modelIndex:E,worldViewProjection:X,nodeModelMatrix:Q,isLightMesh:Z,materialOverride:le,modelColor:B})}if(l.children)for(const se of l.children)G_(v,se,f,_,E,j,k,L,B)}function qp(v,l,f,_){const E=f.shadowRenderer;if(!E)return;const j=E.getShadowPassDepthMode(),k=E.getShadowPassColorMode(),L=E.calculateShadowPassMatrixFromMatrix(l),B=Fp(L);f.getOrCreateProgram("modelDepth",{defines:f._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(f,f.context.gl.TRIANGLES,j,tn.disabled,k,Xr.disabled,B,_.id,v.vertexBuffer,v.indexBuffer,v.segments,_.paint,f.transform.zoom,void 0,void 0)}function Hp(v,l,f,_,E,j){for(const k of E){const L=Object.assign({},_);L.part=k;const B={type:"Unknown",id:l,properties:L},G={orientation:v.paint.get("model-rotation").evaluate(B,f)};j.set(k,G)}}function gR(v,l,f,_,E,j){for(const k of E){const L=Object.assign({},_);L.part=k;const B={type:"Unknown",id:l,properties:L},G={color:v.paint.get("model-color").evaluate(B,f),colorMix:v.paint.get("model-color-mix-intensity").evaluate(B,f),opacity:v.paint.get("model-opacity").evaluate(B,f),emissionStrength:v.paint.get("model-emissive-strength").evaluate(B,f)};j.set(k,G)}}function IA(v,l,f,_,E,j){if(f===1)for(const L of E)Vp(L,v,l,j[L.modelIndex],tn.disabled,v.colorModeForRenderPass());else{for(const L of E)Vp(L,v,l,j[L.modelIndex],tn.disabled,vn.disabled);for(const L of E)Vp(L,v,l,j[L.modelIndex],v.stencilModeFor3D(),v.colorModeForRenderPass());v.resetStencilClippingMasks()}const k=vn.additive;for(const L of _)Vp(L,v,l,j[L.modelIndex],tn.disabled,L.isLightMesh?k:v.colorModeForRenderPass())}function RA(v,l,f){const _=l.updateZoomBasedPaintProperties(),E=function(j,k,L){let B,G,Z,Q=j.terrain?j.terrain.exaggeration():0;if(j.terrain&&Q>0){const X=j.terrain,se=X.findDEMTileFor(L);se&&se.dem?B=i.eE.create(X,L,se):Q=0}if(Q===0&&(k.terrainElevationMin=0,k.terrainElevationMax=0),Q===k.validForExaggeration&&(Q===0||B&&B._demTile&&B._demTile.tileID===k.validForDEMTile.id&&B._dem._timestamp===k.validForDEMTile.timestamp))return!1;for(const X in k.instancesPerModel){const se=k.instancesPerModel[X];for(let le=0;le<se.instancedDataArray.length;++le){const de=(B?Q*B.getElevationAt(0|se.instancedDataArray.float32[16*le],0|se.instancedDataArray.float32[16*le+1],!0,!0):0)+se.instancesEvaluatedElevation[le];se.instancedDataArray.float32[16*le+6]=de,G=G?Math.min(k.terrainElevationMin,de):de,Z=Z?Math.max(k.terrainElevationMax,de):de}}return k.terrainElevationMin=G||0,k.terrainElevationMax=Z||0,k.validForExaggeration=Q,k.validForDEMTile=B&&B._demTile?{id:B._demTile.tileID,timestamp:B._dem._timestamp}:{id:void 0,timestamp:0},!0}(v,l,f);(_||E)&&(l.uploaded=!1,l.upload(v.context))}const Wl={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.d8([0,0,0],[i.al,i.al,0])};function S1(v,l){const f=1<<v.canonical.z,_=l.getFreeCameraOptions().position,E=l.elevation,j=v.canonical.x/f,k=(v.canonical.x+1)/f,L=v.canonical.y/f,B=(v.canonical.y+1)/f;let G=l._centerAltitude;if(E){const se=E.getMinMaxForTile(v);se&&se.max>G&&(G=se.max)}const Z=i.aA(_.x,j,k)-_.x,Q=i.aA(_.y,L,B)-_.y,X=i.ce(G,l.center.lat)-_.z;return l._zoomFromMercatorZ(Math.sqrt(Z*Z+Q*Q+X*X))}function E1(v,l,f,_,E,j,k){const L=v.context,B=v.renderPass==="shadow",G=v.shadowRenderer,Z=B&&G?G.getShadowPassDepthMode():new Er(L.gl.LEQUAL,Er.ReadWrite,v.depthRangeFor3D),Q=v.isTileAffectedByFog(j),X=v.transform.projection.name==="globe";if(f.meshes)for(const se of f.meshes){const le=X?[]:["MODEL_POSITION_ON_GPU"],de=[];let xe,ye,Ee;const Ne=!X&&_.instancedDataArray.length>20;Ne&&le.push("INSTANCED_ARRAYS");const je=dd(v,l.paint.get("model-cutoff-fade-range"));if(je.shouldRenderCutoff&&le.push("RENDER_CUTOFF"),B&&G)xe=v.getOrCreateProgram("modelDepth",{defines:le}),ye=Fp(k.shadowTileMatrix,k.shadowTileMatrix,Float32Array.from(f.globalMatrix)),Ee=G.getShadowPassColorMode();else{Up(le,de,se,v,l.paint.get("model-color-use-theme").constantOr("default")==="none"?null:l.lut),xe=v.getOrCreateProgram("model",{defines:le,overrideFog:Q});const Ie=se.material,Ge=Ie.pbrMetallicRoughness,$e=l.paint.get("model-opacity").constantOr(1),Le=l.paint.get("model-emissive-strength").constantOr(0);ye=L_(j.expandedProjMatrix,Float32Array.from(f.globalMatrix),new Float32Array(16),null,v,$e,Ge.baseColorFactor,Ie.emissiveFactor,Ge.metallicFactor,Ge.roughnessFactor,Ie,Le,l,E),G&&(k.shadowUniformsInitialized?xe.setShadowUniformValues(L,G.getShadowUniformValues()):(G.setupShadows(j.toUnwrapped(),xe,"model-tile"),k.shadowUniformsInitialized=!0)),Ee=je.shouldRenderCutoff||$e<1||Ie.alphaMode!=="OPAQUE"?vn.alphaBlended:vn.unblended}v.uploadCommonUniforms(L,xe,j.toUnwrapped(),null,je);const Ve=se.material.doubleSided?Xr.disabled:Xr.backCCW;if(Ne)de.push(_.instancedDataBuffer),xe.draw(v,L.gl.TRIANGLES,Z,tn.disabled,Ee,Ve,ye,l.id,se.vertexBuffer,se.indexBuffer,se.segments,l.paint,v.transform.zoom,void 0,de,_.instancedDataArray.length);else{const Ie=B?"u_instance":"u_normal_matrix";for(let Ge=0;Ge<_.instancedDataArray.length;++Ge)ye[Ie]=new Float32Array(_.instancedDataArray.arrayBuffer,64*Ge,16),xe.draw(v,L.gl.TRIANGLES,Z,tn.disabled,Ee,Ve,ye,l.id,se.vertexBuffer,se.indexBuffer,se.segments,l.paint,v.transform.zoom,void 0,de)}}if(f.children)for(const se of f.children)E1(v,l,se,_,E,j,k)}const MA=[1,-1,1];function W_(v,l,f,_){if(!f.modelManager)return!0;const E=f.modelManager;if(!f.shadowRenderer)return!0;const j=f.shadowRenderer,k=l.aabb;let L=!0,B=v.maxHeight;if(B===0){let Z=0;for(const Q in v.instancesPerModel){const X=E.getModel(Q,_);X?Z=Math.max(Z,Math.max(Math.max(X.aabb.max[0],X.aabb.max[1]),X.aabb.max[2])):L=!1}B=v.maxScale*Z*1.41+v.maxVerticalOffset,L&&(v.maxHeight=B)}k.max[2]=B,k.min[2]+=v.terrainElevationMin,k.max[2]+=v.terrainElevationMax,i.af(k.min,k.min,l.tileMatrix),i.af(k.max,k.max,l.tileMatrix);const G=k.intersects(j.getCurrentCascadeFrustum());return f.currentShadowCascade===0&&(v.isInsideFirstShadowMapFrustum=G===2),G===0}function dy(v,l){const f=v.uniformValues.u_cutoff_params[0],_=v.uniformValues.u_cutoff_params[1],E=v.uniformValues.u_cutoff_params[2],j=v.uniformValues.u_cutoff_params[3];return _===f||j===E?1:i.aA(((l-f)/(_-f)-E)/(j-E),0,1)}function xf(v,l,f,_){if(l.pitch<20)return 1;const E=l.getWorldToCameraMatrix();i.aB(E,E,v);const j=i.bT(f.min[0],f.min[1],f.min[2],1);let k=i.aC(i.eF(),j,E),L=k,B=k;j[1]=f.max[1],k=i.aC(i.eF(),j,E),L=k[1]<L[1]?k:L,B=k[1]>B[1]?k:B,j[0]=f.max[0],k=i.aC(i.eF(),j,E),L=k[1]<L[1]?k:L,B=k[1]>B[1]?k:B,j[1]=f.min[1],k=i.aC(i.eF(),j,E),L=k[1]<L[1]?k:L,B=k[1]>B[1]?k:B;const G=i.aA(_[0],0,1),Z=100*l.pixelsPerMeter*i.aA(_[1],0,1),Q=i.aA(_[2],0,1),X=i.eG(i.eF(),L,B,G),se=Math.tan(.5*l.fovX),le=-X[2]*se;if(Z===0)return X[1]<-Math.abs(le)?Q:1;const de=(-Math.abs(le)-X[1])/Z,xe=(Ee,Ne,je)=>(1-je)*Ee+je*Ne,ye=i.aA(xe(1,Q,de),Q,1);return xe(1,ye,i.aA((l.pitch-20)/20,0,1))}class DA{}class LA{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(l,f,_){{const Q=this._storage.get(f.id);if(Q)return Q.lastUsedFrameIdx=l,Q.buf}const E=_.gl,j=E.getBufferParameter(E.ELEMENT_ARRAY_BUFFER,E.BUFFER_SIZE),k=new ArrayBuffer(j),L=new Int16Array(k);E.getBufferSubData(E.ELEMENT_ARRAY_BUFFER,0,new Int16Array(k));const B=new i.eI;for(let Q=0;Q<j/2;Q+=3){const X=L[Q],se=L[Q+1],le=L[Q+2];B.emplaceBack(X,se),B.emplaceBack(se,le),B.emplaceBack(le,X)}const G=_.bindVertexArrayOES.current,Z=new DA;return Z.buf=new ih(_,B),Z.lastUsedFrameIdx=l,this._storage.set(f.id,Z),_.bindVertexArrayOES.set(G),Z.buf}update(l){for(const[f,_]of this._storage)l-_.lastUsedFrameIdx>30&&(_.buf.destroy(),this._storage.delete(f))}destroy(){for(const[l,f]of this._storage)f.buf.destroy(),this._storage.delete(l)}}class yR{constructor(l){this.occluderSize=30,this.depthOffset=-1e-4,l.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),l.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const FA=i.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class vR{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class $o{constructor(l,f){this.revealStart=11,this.revealRange=2,l.registerParameter(this,[...f,"Reveal"],"revealStart",{min:0,max:17,step:.05}),l.registerParameter(this,[...f,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const _R=i.eh([{type:"Float32",name:"a_pos_2f",components:2}]);class hy{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(l,f){const _=l.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const k=new i.eJ,L=new i.b0;k.emplaceBack(-1,-1),k.emplaceBack(1,-1),k.emplaceBack(1,1),k.emplaceBack(-1,1),L.emplaceBack(0,1,2),L.emplaceBack(0,2,3),this.vignetteVx=l.context.createVertexBuffer(k,_R.members),this.vignetteIdx=l.context.createIndexBuffer(L)}const E=i.bf.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){l.uploadCommonUniforms(l.context,_);const k={u_vignetteShape:(j={vignetteShape:[f.start,f.range,Math.pow(10,f.fadePower)],vignetteColor:[f.color.r,f.color.g,f.color.b,f.color.a*f.strength]}).vignetteShape,u_vignetteColor:j.vignetteColor};_.draw(l,l.context.gl.TRIANGLES,Er.disabled,tn.disabled,vn.alphaBlended,Xr.disabled,k,"vignette",this.vignetteVx,this.vignetteIdx,E)}var j}}class Qi{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(l,f){const _=l.getFreeCameraOptions().position,E=_.toAltitude(),j=_.toLngLat(),k=i.an(j.lng),L=i.an(j.lat),B=l.pixelsPerMeter/f,G=k*i.eL,Z=i.eL*Math.log(Math.tan(Math.PI/4+L/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const Q=-this._offsetYPrev+Z,X=-this._elevationPrev+E;this._accumulatedOffsetX+=(-this._offsetXPrev+G)*B,this._accumulatedOffsetY+=Q*B,this._accumulatedElevation+=X*B,this._offsetXPrev=G,this._offsetYPrev=Z,this._elevationPrev=E}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Cn(v,l){return[-(v[0]-Math.floor(v[0]/l)*l),-(v[1]-Math.floor(v[1]/l)*l),-(v[2]-Math.floor(v[2]/l)*l)]}function T1(v){const l=i.eq(1323123451230),f=[];for(let _=0;_<v;++_){const E=2*l()-1,j=2*l()-1,k=2*l()-1;f.push(i.d4(E,j,k))}return f}function yl(v,l,f,_,E){const j=i.aA((E-f)/(_-f),0,1);return(1-j)*v+j*l}class bf{constructor(l){this._movement=new Qi,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new hy,this._ppmScaleFactor=l}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(l,f){const _=l.transform;this._movement.update(_,this._ppmScaleFactor);const E=_.starsProjMatrix,j=i.c6([]);i.c8(j,j,i.an(90)-_._pitch),i.c7(j,j,-_.angle);const k=i.cb(new Float32Array(16),j),L=i.eK(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),B=i.ef([],L),G=i.aB([],B,k),Z=Date.now()/1e3;return this._accumulatedTimeFromStart+=(Z-this._prevTime)*f,this._prevTime=Z,{projectionMatrix:E,modelviewMatrix:G}}}class Gp extends bf{constructor(l){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new $o(l.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(l){const f=l.context;if(!this.particlesVx){const _=T1(this.particlesCount),E=new i.eM,j=new i.b0;let k=0;const L=i.eq(1323123451230);for(let B=0;B<_.length;++B){const G=_[B],Z=[2*L()-1,L(),L(),L()];E.emplaceBack(G[0],G[1],G[2],-1,-1,...Z),E.emplaceBack(G[0],G[1],G[2],1,-1,...Z),E.emplaceBack(G[0],G[1],G[2],1,1,...Z),E.emplaceBack(G[0],G[1],G[2],-1,1,...Z),j.emplaceBack(k+0,k+1,k+2),j.emplaceBack(k+0,k+2,k+3),k+=4}this.particlesVx=f.createVertexBuffer(E,FA.members),this.particlesIdx=f.createIndexBuffer(j)}}draw(l){if(!this._params.overrideStyleParameters&&!l.style.rain)return;const f=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},_=l.transform.zoom;if(f.revealStart>_)return;const E=yl(0,1,f.revealStart,f.revealStart+f.revealRange,_);if(!this.particlesVx||!this.particlesIdx)return;const j=structuredClone(this._params);let k=[-j.direction.x,j.direction.y,-100];i.aw(k,k);const L=structuredClone(this._vignetteParams);L.strength*=E,j.overrideStyleParameters||(j.intensity=l.style.rain.state.density,j.timeFactor=l.style.rain.state.intensity,j.color=structuredClone(l.style.rain.state.color),k=structuredClone(l.style.rain.state.direction),j.screenThinning.intensity=l.style.rain.state.centerThinning,j.dropletSizeX=l.style.rain.state.dropletSize[0],j.dropletSizeYScale=l.style.rain.state.dropletSize[1]/l.style.rain.state.dropletSize[0],j.distortionStrength=100*l.style.rain.state.distortionStrength,L.strength=1,L.color=structuredClone(l.style.rain.state.vignetteColor));const B=this.updateOnRender(l,j.timeFactor),G=l.context,Z=G.gl,Q=l.transform;this.screenTexture&&this.screenTexture.size[0]===l.width&&this.screenTexture.size[1]===l.height||(this.screenTexture=new i.T(G,{width:l.width,height:l.height,data:null},Z.RGBA8)),j.distortionStrength>0&&(G.activeTexture.set(Z.TEXTURE0),this.screenTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),Z.copyTexSubImage2D(Z.TEXTURE_2D,0,0,0,0,0,l.width,l.height));const X=l.getOrCreateProgram("rainParticle");l.uploadCommonUniforms(G,X),G.activeTexture.set(Z.TEXTURE0),this.screenTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const se=[j.color.r,j.color.g,j.color.b,j.color.a],le=(de,xe)=>{const ye=Cn(this._movement.getPosition(),de),Ee=j.dropletSizeX,Ne=j.dropletSizeX*j.dropletSizeYScale,je=l.width/2,Ve=l.height/2,Ie=yl(0,j.screenThinning.start,0,1,j.screenThinning.intensity),Ge=yl(.001,j.screenThinning.range,0,1,j.screenThinning.intensity),$e=yl(0,j.screenThinning.particleOffset,0,1,j.screenThinning.intensity),Le=(Ke={modelview:B.modelviewMatrix,projection:B.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ye,velocityConeAperture:j.velocityConeAperture,velocity:j.velocity,boxSize:de,rainDropletSize:[Ee,Ne],distortionStrength:j.distortionStrength,rainDirection:k,color:se,screenSize:[Q.width,Q.height],thinningCenterPos:[je,Ve],thinningShape:[Ie,Ge,Math.pow(10,j.screenThinning.fadePower)],thinningAffectedRatio:j.screenThinning.affectedRatio,thinningParticleOffset:$e,shapeDirectionalPower:j.shapeDirPower,shapeNormalPower:j.shapeNormalPower,mode:xe?0:1},{u_modelview:Float32Array.from(Ke.modelview),u_projection:Float32Array.from(Ke.projection),u_time:Ke.time,u_cam_pos:Ke.camPos,u_texScreen:0,u_velocityConeAperture:Ke.velocityConeAperture,u_velocity:Ke.velocity,u_boxSize:Ke.boxSize,u_rainDropletSize:Ke.rainDropletSize,u_distortionStrength:Ke.distortionStrength,u_rainDirection:Ke.rainDirection,u_color:Ke.color,u_screenSize:Ke.screenSize,u_thinningCenterPos:Ke.thinningCenterPos,u_thinningShape:Ke.thinningShape,u_thinningAffectedRatio:Ke.thinningAffectedRatio,u_thinningParticleOffset:Ke.thinningParticleOffset,u_shapeDirectionalPower:Ke.shapeDirectionalPower,u_shapeNormalPower:Ke.shapeNormalPower,u_mode:Ke.mode});var Ke;const dt=Math.round(j.intensity*this.particlesCount),at=i.bf.simpleSegment(0,0,4*dt,2*dt);X.draw(l,Z.TRIANGLES,Er.disabled,tn.disabled,vn.alphaBlended,Xr.disabled,Le,"rain_particles",this.particlesVx,this.particlesIdx,at)};j.distortionStrength>0&&le(j.boxSize,!0),le(j.boxSize,!1),this._vignette.draw(l,L)}}const md=i.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class A1 extends bf{constructor(l){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new $o(l.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(l){const f=l.context;if(!this.particlesVx){const _=T1(this.particlesCount),E=new i.eN,j=new i.b0;let k=0;const L=i.eq(1323123451230);for(let B=0;B<_.length;++B){const G=_[B],Z=L(),Q=L(),X=L(),se=[B/_.length,Z,Q,X],le=[L(),L()];E.emplaceBack(G[0],G[1],G[2],-1,-1,...se,...le),E.emplaceBack(G[0],G[1],G[2],1,-1,...se,...le),E.emplaceBack(G[0],G[1],G[2],1,1,...se,...le),E.emplaceBack(G[0],G[1],G[2],-1,1,...se,...le),j.emplaceBack(k+0,k+1,k+2),j.emplaceBack(k+0,k+2,k+3),k+=4}this.particlesVx=f.createVertexBuffer(E,md.members),this.particlesIdx=f.createIndexBuffer(j)}}draw(l){if(!this._params.overrideStyleParameters&&!l.style.snow)return;const f=structuredClone(this._params);let _=[-f.direction.x,f.direction.y,-100];i.aw(_,_);const E=structuredClone(this._vignetteParams),j=f.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},k=l.transform.zoom;if(j.revealStart>k)return;const L=yl(0,1,j.revealStart,j.revealStart+j.revealRange,k);E.strength*=L,f.overrideStyleParameters||(f.intensity=l.style.snow.state.density,f.timeFactor=l.style.snow.state.intensity,f.color=structuredClone(l.style.snow.state.color),_=structuredClone(l.style.snow.state.direction),f.screenThinning.intensity=l.style.snow.state.centerThinning,f.billboardSize=2.79*l.style.snow.state.flakeSize,E.strength=1,E.color=structuredClone(l.style.snow.state.vignetteColor));const B=this.updateOnRender(l,f.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const G=l.context,Z=G.gl,Q=l.transform,X=l.getOrCreateProgram("snowParticle");l.uploadCommonUniforms(G,X),((se,le,de)=>{const xe=Cn(this._movement.getPosition(),se),ye=Q.width/2,Ee=Q.height/2,Ne=yl(0,de.screenThinning.start,0,1,de.screenThinning.intensity),je=yl(.001,de.screenThinning.range,0,1,de.screenThinning.intensity),Ve=yl(0,de.screenThinning.particleOffset,0,1,de.screenThinning.intensity),Ie=(Ge={modelview:B.modelviewMatrix,projection:B.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:xe,velocityConeAperture:de.velocityConeAperture,velocity:de.velocity,horizontalOscillationRadius:de.horizontalOscillationRadius,horizontalOscillationRate:de.horizontalOscillationRate,boxSize:se,billboardSize:1*de.billboardSize,simpleShapeParameters:[de.shapeFadeStart,de.shapeFadePower],screenSize:[Q.width,Q.height],thinningCenterPos:[ye,Ee],thinningShape:[Ne,je,Math.pow(10,de.screenThinning.fadePower)],thinningAffectedRatio:de.screenThinning.affectedRatio,thinningParticleOffset:Ve,color:[de.color.r,de.color.g,de.color.b,de.color.a],direction:_},{u_modelview:Float32Array.from(Ge.modelview),u_projection:Float32Array.from(Ge.projection),u_time:Ge.time,u_cam_pos:Ge.camPos,u_velocityConeAperture:Ge.velocityConeAperture,u_velocity:Ge.velocity,u_horizontalOscillationRadius:Ge.horizontalOscillationRadius,u_horizontalOscillationRate:Ge.horizontalOscillationRate,u_boxSize:Ge.boxSize,u_billboardSize:Ge.billboardSize,u_simpleShapeParameters:Ge.simpleShapeParameters,u_screenSize:Ge.screenSize,u_thinningCenterPos:Ge.thinningCenterPos,u_thinningShape:Ge.thinningShape,u_thinningAffectedRatio:Ge.thinningAffectedRatio,u_thinningParticleOffset:Ge.thinningParticleOffset,u_particleColor:Ge.color,u_direction:Ge.direction});var Ge;const $e=Math.round(de.intensity*this.particlesCount),Le=i.bf.simpleSegment(0,0,4*$e,2*$e);this.particlesVx&&this.particlesIdx&&X.draw(l,Z.TRIANGLES,Er.disabled,tn.disabled,vn.alphaBlended,Xr.disabled,Ie,"snow_particles",this.particlesVx,this.particlesIdx,Le)})(f.boxSize,0,f),this._vignette.draw(l,E)}}const C1={symbol:function(v,l,f,_,E){if(v.renderPass!=="translucent")return;const j=tn.disabled,k=v.colorModeForRenderPass(),L=f.layout.get("text-variable-anchor"),B=f.layout.get("text-size-scale-range"),G=i.aA(v.scaleFactor,B[0],B[1]);L&&function(X,se,le,de,xe,ye,Ee,Ne){const je=se.transform,Ve=xe==="map",Ie=ye==="map";for(const Ge of X){const $e=de.getTile(Ge),Le=$e.getBucket(le);if(!Le||!Le.text||!Le.text.segments.get().length)continue;const Ke=i.bJ(Le.textSizeData,je.zoom,Ne),dt=o_(Ge,Le.getProjection(),je),at=je.calculatePixelsToTileUnitsMatrix($e),Et=xp(dt,$e.tileID.canonical,Ie,Ve,je,Le.getProjection(),at),yt=Le.hasIconTextFit()&&Le.hasIconData();Ke&&$_(Le,Ve,Ie,Ee,je,Et,Ge,Math.pow(2,je.zoom-$e.tileID.overscaledZ),Ke,yt)}}(_,v,f,l,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),E,G);const Z=f.paint.get("icon-opacity").constantOr(1)!==0,Q=f.paint.get("text-opacity").constantOr(1)!==0;f.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(Z||Q)?cy(v,l,f,_,j,k):(Z&&cy(v,l,f,_,j,k,{onlyIcons:!0}),Q&&cy(v,l,f,_,j,k,{onlyText:!0})),l.map.showCollisionBoxes&&(ly(v,l,f,_,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),ly(v,l,f,_,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))},circle:function(v,l,f,_){if(v.renderPass!=="translucent")return;const E=f.paint.get("circle-opacity"),j=f.paint.get("circle-stroke-width"),k=f.paint.get("circle-stroke-opacity"),L=f.layout.get("circle-sort-key").constantOr(1)!==void 0,B=f.paint.get("circle-emissive-strength");if(E.constantOr(1)===0&&(j.constantOr(1)===0||k.constantOr(1)===0))return;const G=v.context,Z=G.gl,Q=v.transform,X=!(!v.terrain||!v.terrain.enabled),se=f.layout.get("circle-elevation-reference"),le=v.depthModeForSublayer(0,Er.ReadOnly),de=new Er(v.context.gl.LEQUAL,Er.ReadOnly,v.depthRangeFor3D),xe=se==="none"||X?le:de,ye=tn.disabled,Ee=v.colorModeForDrapableLayerRenderPass(B),Ne=Q.projection.name==="globe",je=[i.aF(Q.center.lng),i.aJ(Q.center.lat)],Ve=[];for(let Ge=0;Ge<_.length;Ge++){const $e=_[Ge],Le=l.getTile($e),Ke=Le.getBucket(f);if(!Ke||Ke.projection.name!==Q.projection.name)continue;const dt=Ke.programConfigurations.get(f.id),at=Ke.layoutVertexBuffer,Et=Ke.globeExtVertexBuffer,yt=Ke.indexBuffer,Nt=i.d$(f),Xt=[Et],mt=v.isTileAffectedByFog($e);Ne&&Nt.push("PROJECTION_GLOBE_VIEW"),Nt.push("DEPTH_D24"),v.terrain&&Q.depthOcclusionForSymbolsAndCircles&&Nt.push("DEPTH_OCCLUSION"),Ke.hasElevation&&!v.terrain&&(Nt.push("ELEVATED_ROADS"),Xt.push(Ke.elevatedLayoutVertexBuffer));const tt=v.getOrCreateProgram("circle",{config:dt,defines:Nt,overrideFog:mt}),It=Q.projection.createInversionMatrix(Q,$e.canonical),vt={programConfiguration:dt,program:tt,layoutVertexBuffer:at,dynamicBuffers:Xt,indexBuffer:yt,uniformValues:i.e0(v,$e,Le,It,je,f),tile:Le};if(L){const Bt=Ke.segments.get();for(const rr of Bt)Ve.push({segments:new i.bf([rr]),sortKey:rr.sortKey,state:vt})}else Ve.push({segments:Ke.segments,sortKey:0,state:vt})}L&&Ve.sort((Ge,$e)=>Ge.sortKey-$e.sortKey);const Ie={useDepthForOcclusion:Q.depthOcclusionForSymbolsAndCircles};for(const Ge of Ve){const{programConfiguration:$e,program:Le,layoutVertexBuffer:Ke,dynamicBuffers:dt,indexBuffer:at,uniformValues:Et,tile:yt}=Ge.state,Nt=Ge.segments;v.terrain&&v.terrain.setupElevationDraw(yt,Le,Ie),v.uploadCommonUniforms(G,Le,yt.tileID.toUnwrapped()),Le.draw(v,Z.TRIANGLES,xe,ye,Ee,Xr.disabled,Et,f.id,Ke,at,Nt,f.paint,Q.zoom,$e,dt)}},heatmap:function(v,l,f,_){if(f.paint.get("heatmap-opacity")!==0)if(v.renderPass==="offscreen"){const E=v.context,j=E.gl,k=tn.disabled,L=new vn([j.ONE,j.ONE,j.ONE,j.ONE],i.ao.transparent,[!0,!0,!0,!0]);(function(se,le,de,xe){const ye=se.gl,Ee=le.width*xe,Ne=le.height*xe;se.activeTexture.set(ye.TEXTURE1),se.viewport.set([0,0,Ee,Ne]);let je=de.heatmapFbo;if(!je||je&&(je.width!==Ee||je.height!==Ne)){je&&je.destroy();const Ve=ye.createTexture();ye.bindTexture(ye.TEXTURE_2D,Ve),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_WRAP_S,ye.CLAMP_TO_EDGE),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_WRAP_T,ye.CLAMP_TO_EDGE),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_MIN_FILTER,ye.LINEAR),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_MAG_FILTER,ye.LINEAR),je=de.heatmapFbo=se.createFramebuffer(Ee,Ne,!0,null),function(Ie,Ge,$e,Le,Ke,dt){const at=Ie.gl;at.texImage2D(at.TEXTURE_2D,0,Ie.extRenderToTextureHalfFloat?at.RGBA16F:at.RGBA,Ke,dt,0,at.RGBA,Ie.extRenderToTextureHalfFloat?at.HALF_FLOAT:at.UNSIGNED_BYTE,null),Le.colorAttachment.set($e)}(se,0,Ve,je,Ee,Ne)}else ye.bindTexture(ye.TEXTURE_2D,je.colorAttachment.get()),se.bindFramebuffer.set(je.framebuffer)})(E,v,f,v.transform.projection.name==="globe"?.5:.25),E.clear({color:i.ao.transparent});const B=v.transform,G=B.projection.name==="globe",Z=G?["PROJECTION_GLOBE_VIEW"]:[],Q=G?Xr.frontCCW:Xr.disabled,X=[i.aF(B.center.lng),i.aJ(B.center.lat)];for(let se=0;se<_.length;se++){const le=_[se];if(l.hasRenderableParent(le))continue;const de=l.getTile(le),xe=de.getBucket(f);if(!xe||xe.projection.name!==B.projection.name)continue;const ye=v.isTileAffectedByFog(le),Ee=xe.programConfigurations.get(f.id),Ne=v.getOrCreateProgram("heatmap",{config:Ee,defines:Z,overrideFog:ye}),{zoom:je}=v.transform;v.terrain&&v.terrain.setupElevationDraw(de,Ne),v.uploadCommonUniforms(E,Ne,le.toUnwrapped());const Ve=B.projection.createInversionMatrix(B,le.canonical);Ne.draw(v,j.TRIANGLES,Er.disabled,k,L,Q,TA(v,le,de,Ve,X,je,f.paint.get("heatmap-intensity")),f.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,f.paint,v.transform.zoom,Ee,G?[xe.globeExtVertexBuffer]:null)}E.viewport.set([0,0,v.width,v.height])}else v.renderPass==="translucent"&&(v.context.setColorMode(v.colorModeForRenderPass()),function(E,j){const k=E.context,L=k.gl,B=j.heatmapFbo;if(!B)return;k.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,B.colorAttachment.get()),k.activeTexture.set(L.TEXTURE1);let G=j.colorRampTexture;G||(G=j.colorRampTexture=new i.T(k,j.colorRamp,L.RGBA8)),G.bind(L.LINEAR,L.CLAMP_TO_EDGE),E.getOrCreateProgram("heatmapTexture").draw(E,L.TRIANGLES,Er.disabled,tn.disabled,E.colorModeForRenderPass(),Xr.disabled,((Z,Q,X,se)=>({u_image:0,u_color_ramp:1,u_opacity:Q.paint.get("heatmap-opacity")}))(0,j),j.id,E.viewportBuffer,E.quadTriangleIndexBuffer,E.viewportSegments,j.paint,E.transform.zoom)}(v,f))},line:function(v,l,f,_){if(v.renderPass!=="translucent")return;const E=f.paint.get("line-opacity"),j=f.paint.get("line-width");if(E.constantOr(1)===0||j.constantOr(1)===0)return;const k=f.paint.get("line-emissive-strength"),L=f.paint.get("line-occlusion-opacity"),B=f.layout.get("line-elevation-reference"),G=f.layout.get("line-width-unit")==="meters",Z=B==="sea",Q=!(!v.terrain||!v.terrain.enabled),X=v.context,se=X.gl;if(f.hasElevatedBuckets&&v.transform.projection.name==="globe")return;const le=f.layout.get("line-cross-slope"),de=le!==void 0,xe=le<1,ye=v.colorModeForDrapableLayerRenderPass(k),Ee=v.terrain&&v.terrain.renderingToTexture,Ne=Ee?1:i.o.devicePixelRatio,je=f.paint.get("line-dasharray"),Ve=je.constantOr(1),Ie=f.layout.get("line-cap"),Ge=je.constantOr(null),$e=Ie.constantOr(null),Le=f.paint.get("line-pattern"),Ke=Le.constantOr(1),dt=f.paint.get("line-pattern-cross-fade"),at=Le.constantOr(null),Et=f.paint.get("line-opacity").constantOr(1);let yt=!Ke&&Et!==1||v.depthOcclusion&&L>0&&L<1;const Nt=f.paint.get("line-gradient"),Xt=Ke?"linePattern":"line",mt=i.e1(f);let tt;if(Ee&&v.terrain&&v.terrain.clipOrMaskOverlapStencilType()&&(yt=!1),L!==0&&v.depthOcclusion){const rr=f.paint._values["line-opacity"];rr&&rr.value&&rr.value.kind==="constant"?tt=rr.value:i.w(`Occlusion opacity for layer ${f.id} is supported only when line-opacity isn't data-driven.`)}j.value.kind!=="constant"&&j.value.isLineProgressConstant===!1&&mt.push("VARIABLE_LINE_WIDTH");const It=(rr,xr,Wt,Jt,wr,pr)=>{for(const dr of rr){const mr=l.getTile(dr);if(Ke&&!mr.patternsLoaded())continue;const $r=mr.getBucket(f);if(!$r||$r.elevationType!=="none"&&!wr||$r.elevationType==="none"&&wr)continue;v.prepareDrawTile();const jn=[...xr],Fn=v.shadowRenderer,Ei=$r.elevationType==="road"&&!!Fn&&Fn.enabled;let Yr=[0,0,0];if(Ei){const Qr=v.style.directionalLight,Vn=v.style.ambientLight;Qr&&Vn&&(Yr=Ac(v.style,Qr,Vn)),jn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Dn=$r.programConfigurations.get(f.id);let hn=!1;if(at&&mr.imageAtlas){const Qr=i.e2.from(at),Vn=Qr.getPrimary().scaleSelf(Ne).toString(),ls=mr.imageAtlas.patternPositions.get(Vn),Ns=Qr.getSecondary(),hs=Ns?mr.imageAtlas.patternPositions.get(Ns.scaleSelf(Ne).toString()):null;hn=!!ls&&!!hs,ls&&Dn.setConstantPatternPositions(ls,hs)}dt>0&&(hn||Dn.getPatternTransitionVertexBuffer("line-pattern"))&&jn.push("LINE_PATTERN_TRANSITION");const yi=v.isTileAffectedByFog(dr),zn=v.getOrCreateProgram(Xt,{config:Dn,defines:jn,overrideFog:yi});if(!Ke&&Ge&&$e&&mr.lineAtlas){const Qr=mr.lineAtlas.getDash(Ge,$e);Qr&&Dn.setConstantPatternPositions(Qr)}Ei&&Fn.setupShadows(mr.tileID.toUnwrapped(),zn,"vector-tile");let[Li,Yn]=f.paint.get("line-trim-offset");($e==="round"||$e==="square")&&Li!==Yn&&(Li===0&&(Li-=1),Yn===1&&(Yn+=1));const pn=Ee?dr.projMatrix:null,ai=G?1/$r.tileToMeter/i.ay(mr,1,v.transform.zoom):1,xn=G?1/$r.tileToMeter/i.ay(mr,1,Math.floor(v.transform.zoom)):1,Wi=Ke?i.e3(v,mr,f,pn,Ne,ai,xn,[Li,Yn],Yr,dt):i.e4(v,mr,f,pn,$r.lineClipsArray.length,Ne,ai,xn,[Li,Yn],Yr);if(Nt){const Qr=$r.gradients[f.id];let Vn=Qr.texture;if(f.gradientVersion!==Qr.version){let ls=256;if(f.stepInterpolant){const Ns=l.getSource().maxzoom,hs=dr.canonical.z===Ns?Math.ceil(1<<v.transform.maxZoom-dr.canonical.z):1;ls=i.aA(i.e5($r.maxLineLength/i.al*1024*hs),256,X.maxTextureSize)}Qr.gradient=i.e6({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:ls,image:Qr.gradient||void 0,clips:$r.lineClipsArray}),Qr.texture?Qr.texture.update(Qr.gradient):Qr.texture=new i.T(X,Qr.gradient,se.RGBA8),Qr.version=f.gradientVersion,Vn=Qr.texture}X.activeTexture.set(se.TEXTURE1),Vn.bind(f.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}Ve&&(X.activeTexture.set(se.TEXTURE0),mr.lineAtlasTexture&&mr.lineAtlasTexture.bind(se.LINEAR,se.REPEAT),Dn.updatePaintBuffers()),Ke&&(X.activeTexture.set(se.TEXTURE0),mr.imageAtlasTexture&&mr.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),Dn.updatePaintBuffers()),wr&&!Z&&v.terrain.setupElevationDraw(mr,zn),v.uploadCommonUniforms(X,zn,dr.toUnwrapped());const di=Qr=>{tt!=null&&(tt.value=Et*L),zn.draw(v,se.TRIANGLES,Wt,Qr,ye,Xr.disabled,Wi,f.id,$r.layoutVertexBuffer,$r.indexBuffer,$r.segments,f.paint,v.transform.zoom,Dn,[$r.layoutVertexBuffer2,$r.patternVertexBuffer,$r.zOffsetVertexBuffer]),tt!=null&&(tt.value=Et)};if(yt&&!wr){const Qr=v.stencilModeForClipping(dr).ref;Qr===0&&Ee&&X.clear({stencil:0});const Vn={func:se.EQUAL,mask:255};Wi.u_alpha_discard_threshold=.8,di(new tn(Vn,Qr,255,se.KEEP,se.KEEP,se.INVERT)),Wi.u_alpha_discard_threshold=0,di(new tn(Vn,Qr,255,se.KEEP,se.KEEP,se.KEEP))}else Wi.u_alpha_discard_threshold=yt&&wr&&pr?.8:0,di(wr?Jt:v.stencilModeForClipping(dr))}};let vt=v.depthModeForSublayer(0,Er.ReadOnly);const Bt=new Er(v.depthOcclusion?se.GREATER:se.LEQUAL,Er.ReadOnly,v.depthRangeFor3D);if(f.hasNonElevatedBuckets){const rr=!Ee&&v.terrain;L!==0&&rr?i.w(`Occlusion opacity for layer ${f.id} is supported on terrain only if the layer has line-z-offset enabled.`):rr?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${f.id}.`):It(_,mt,vt,tn.disabled,!1,!0)}if(f.hasElevatedBuckets){B==="hd-road-markup"?Q||(vt=Bt,mt.push("ELEVATED_ROADS")):(mt.push("ELEVATED"),vt=Bt,de&&mt.push(xe?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),Z&&mt.push("ELEVATION_REFERENCE_SEA"));const rr=yt?v.stencilModeFor3D():tn.disabled;v.forceTerrainMode=!0,It(_,mt,vt,rr,!0,!0),yt&&It(_,mt,vt,rr,!0,!1),v.forceTerrainMode=!1}yt&&(v.resetStencilClippingMasks(),Ee&&X.clear({stencil:0})),L===0||v.depthOcclusion||Ee||v.layersWithOcclusionOpacity.push(v.currentLayer)},fill:function(v,l,f,_){const E=f.paint.get("fill-color"),j=f.paint.get("fill-opacity");if(j.constantOr(1)===0)return;const k=f.paint.get("fill-emissive-strength"),L=v.colorModeForDrapableLayerRenderPass(k),B=f.paint.get("fill-pattern"),G=v.opaquePassEnabledForLayer()&&!B.constantOr(1)&&E.constantOr(i.ao.transparent).a===1&&j.constantOr(0)===1?"opaque":"translucent";let Z="none";f.layout.get("fill-elevation-reference")!=="none"?Z="road":f.paint.get("fill-z-offset").constantOr(1)!==0&&(Z="offset");const Q=!(!v.terrain||!v.terrain.enabled),X={painter:v,sourceCache:l,layer:f,coords:_,colorMode:L,elevationType:Z,terrainEnabled:Q,pass:G};if(v.renderPass!=="shadow")if(Z!=="offset"){if(zp(X,!1),Z==="road"){const se=!Q&&v.renderPass==="translucent";se&&vf(v,l,f,_,"geometry"),zp(X,!0,tn.disabled),se&&function(le){const{painter:de,sourceCache:xe,layer:ye,coords:Ee,colorMode:Ne}=le,je=de.context.gl,Ve=le.painter.shadowRenderer,Ie=!!Ve&&Ve.enabled,Ge=new Er(de.context.gl.LEQUAL,Er.ReadOnly,de.depthRangeFor3D);let $e=[0,0,0];if(Ie){const Ke=de.style.directionalLight,dt=de.style.ambientLight;Ke&&dt&&($e=Ac(de.style,Ke,dt))}const Le=Ke=>{for(const dt of Ee){const at=xe.getTile(dt),Et=at.getBucket(ye);if(!Et)continue;const yt=Et.elevatedStructures;if(!yt)continue;let Nt,Xt;if(Ke?(Nt=yt.renderableBridgeSegments,Xt=yt.bridgeProgramConfigurations.get(ye.id)):(Nt=yt.renderableTunnelSegments,Xt=yt.tunnelProgramConfigurations.get(ye.id)),!Nt||Nt.segments[0].primitiveLength===0)continue;Xt.updatePaintBuffers(),de.prepareDrawTile();const mt=de.isTileAffectedByFog(dt),tt=[];Ie&&tt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const It=de.getOrCreateProgram("elevatedStructures",{config:Xt,overrideFog:mt,defines:tt}),vt=de.translatePosMatrix(dt.projMatrix,at,ye.paint.get("fill-translate"),ye.paint.get("fill-translate-anchor"));Ie&&Ve.setupShadows(at.tileID.toUnwrapped(),It,"vector-tile");const Bt=dR(vt,$e);de.uploadCommonUniforms(de.context,It,dt.toUnwrapped()),It.draw(de,je.TRIANGLES,Ge,tn.disabled,Ne,Xr.backCCW,Bt,ye.id,yt.vertexBuffer,yt.indexBuffer,Nt,ye.paint,de.transform.zoom,Xt,[yt.vertexBufferNormal])}};Le(!0),Le(!1)}(X)}}else zp(X,!1,v.stencilModeFor3D());else v.shadowRenderer&&Z==="road"&&!Q&&function(se){const{painter:le,sourceCache:de,layer:xe,coords:ye}=se,Ee=le.context.gl,Ne=se.painter.shadowRenderer;for(const je of ye){const Ve=de.getTile(je),Ie=Ve.getBucket(xe);if(!Ie)continue;const Ge=Ie.elevatedStructures;if(!Ge||!Ge.shadowCasterSegments||Ge.shadowCasterSegments.segments[0].primitiveLength===0)continue;le.prepareDrawTile();const $e=Ie.bufferData.programConfigurations.get(xe.id),Le=le.isTileAffectedByFog(je),Ke=le.getOrCreateProgram("elevatedStructuresDepth",{config:$e,overrideFog:Le}),dt=Ne.calculateShadowPassMatrixFromTile(Ve.tileID.toUnwrapped());le.uploadCommonUniforms(le.context,Ke,je.toUnwrapped());const at={u_matrix:dt,u_depth_bias:0};Ke.draw(le,Ee.TRIANGLES,Ne.getShadowPassDepthMode(),tn.disabled,Ne.getShadowPassColorMode(),Xr.disabled,at,xe.id,Ge.vertexBuffer,Ge.indexBuffer,Ge.shadowCasterSegments,xe.paint,le.transform.zoom,$e)}}(X)},"fill-extrusion":function(v,l,f,_){const E=f.paint.get("fill-extrusion-opacity"),j=v.context,k=j.gl,L=v.terrain,B=L&&L.renderingToTexture;if(E===0)return;const G=v.conflationActive&&v.style.isLayerClipped(f,l.getSource()),Z=v.style.order.indexOf(f.fqid);if(G&&function(Q,X,se,le,de){for(const xe of le){const ye=X.getTile(xe).getBucket(se);ye&&(ye.updateReplacement(xe,Q.replacementSource,de),ye.uploadCentroid(Q.context))}}(v,l,f,_,Z),L||G)for(const Q of _){const X=l.getTile(Q).getBucket(f);X&&ah(v.context,l,Q,X,f,L,G)}if(v.renderPass==="shadow"&&v.shadowRenderer){const Q=v.shadowRenderer;if(L&&E<.65&&f._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ad)return;const X=Q.getShadowPassDepthMode(),se=Q.getShadowPassColorMode();_r(v,l,f,_,X,tn.disabled,se,G)}else if(v.renderPass==="translucent"){const Q=!f.paint.get("fill-extrusion-pattern").constantOr(1),X=f.paint.get("fill-extrusion-color").constantOr(i.ao.white);if(!B&&X.a!==0){const se=new Er(v.context.gl.LEQUAL,Er.ReadWrite,v.depthRangeFor3D);E===1&&Q?_r(v,l,f,_,se,tn.disabled,vn.unblended,G):(_r(v,l,f,_,se,tn.disabled,vn.disabled,G),_r(v,l,f,_,se,v.stencilModeFor3D(),v.colorModeForRenderPass(),G),v.resetStencilClippingMasks())}if(v.style.enable3dLights()&&Q&&(!L&&v.transform.projection.name!=="globe"||B)){const se=f.paint.get("fill-extrusion-opacity"),le=f.paint.get("fill-extrusion-ambient-occlusion-intensity"),de=f.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),xe=f.paint.get("fill-extrusion-flood-light-intensity"),ye=f.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ee=f.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ye?null:f.lut).toArray01().slice(0,3),Ne=le>0&&de>0,je=xe>0,Ve=($e,Le,Ke)=>(1-Ke)*$e+Ke*Le,Ie=new h1;Ie.translate=f.paint.get("fill-extrusion-translate"),Ie.translateAnchor=f.paint.get("fill-extrusion-translate-anchor"),Ie.edgeRadius=f.layout.get("fill-extrusion-edge-radius"),Ie.cutoffFadeRange=f.paint.get("fill-extrusion-cutoff-fade-range");const Ge=$e=>{const Le=v.depthModeForSublayer(1,Er.ReadOnly,k.LEQUAL,!0),Ke=f.paint.get($e?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),dt=Ve(.1,3,Ke),at=v._showOverdrawInspector;if(!at){const Et=new tn({func:k.ALWAYS,mask:255},255,255,k.KEEP,k.KEEP,k.REPLACE),yt=new vn([k.ONE,k.ONE,k.ONE,k.ONE],i.ao.transparent,[!1,!1,!1,!0],k.MIN);fd(Ie,v,l,f,_,Le,Et,yt,Xr.disabled,$e,"sdf",se,le,de,xe,Ee,dt,G,!1)}{const Et=at?tn.disabled:new tn({func:k.EQUAL,mask:255},255,255,k.KEEP,k.DECR,k.DECR),yt=at?v.colorModeForRenderPass():new vn([k.ONE_MINUS_DST_ALPHA,k.DST_ALPHA,k.ONE,k.ONE],i.ao.transparent,[!0,!0,!0,!0]);fd(Ie,v,l,f,_,Le,Et,yt,Xr.disabled,$e,"color",se,le,de,xe,Ee,dt,G,!1)}};if(B){const $e=(Le,Ke,dt)=>{const at=v.depthModeForSublayer(1,Er.ReadOnly,k.LEQUAL,!1),Et=f.paint.get(Le?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),yt=Ve(.1,3,Et);{const Nt=new vn([k.ONE,k.ONE,k.ONE,k.ONE],i.ao.transparent,[!1,!1,!1,!0]);fd(Ie,v,l,f,_,at,tn.disabled,Nt,Xr.disabled,Le,"clear",se,le,de,xe,Ee,yt,G,Ke)}{const Nt=new tn({func:k.ALWAYS,mask:255},255,255,k.KEEP,k.KEEP,k.REPLACE),Xt=new vn([k.ONE,k.ONE,k.ONE,k.ONE],i.ao.transparent,[!1,!1,!1,!0],k.MIN);fd(Ie,v,l,f,_,at,Nt,Xt,Xr.disabled,Le,"sdf",se,le,de,xe,Ee,yt,G,Ke)}{const Nt=Le?k.ZERO:k.ONE_MINUS_DST_ALPHA,Xt=new tn({func:k.EQUAL,mask:255},255,255,k.KEEP,k.DECR,k.DECR),mt=new vn([Nt,k.DST_ALPHA,k.ONE_MINUS_DST_ALPHA,k.ZERO],i.ao.transparent,[!0,!0,!0,!0]);fd(Ie,v,l,f,_,at,Xt,mt,Xr.disabled,Le,"color",se,le,de,xe,Ee,yt,G,Ke)}{const Nt=new vn([k.ONE,k.ONE,k.ONE,Le?k.ZERO:k.ONE],i.ao.transparent,[!1,!1,!1,!0],Le?k.FUNC_ADD:k.MAX);fd(Ie,v,l,f,_,at,tn.disabled,Nt,Xr.disabled,Le,"clear",se,le,de,xe,Ee,yt,G,Ke,dt)}};if(Ne||je){let Le;if(v.prepareDrawTile(),L){const Ke=L.drapeBufferSize[0],dt=L.drapeBufferSize[1];Le=L.framebufferCopyTexture,Le&&(!Le||Le.size[0]===Ke&&Le.size[1]===dt)||(Le&&Le.destroy(),Le=L.framebufferCopyTexture=new i.T(j,new i.q({width:Ke,height:dt}),k.RGBA8)),Le.bind(k.LINEAR,k.CLAMP_TO_EDGE),k.copyTexSubImage2D(k.TEXTURE_2D,0,0,0,0,0,Ke,dt)}Ne&&$e(!0,!1,Le),je&&$e(!1,!0,Le)}}else Ne&&Ge(!0),je&&Ge(!1),(Ne||je)&&v.resetStencilClippingMasks()}}},building:function(v,l,f,_){v.currentLayer<v.firstLightBeamLayer&&(v.firstLightBeamLayer=v.currentLayer);const E=f.paint.get("building-ambient-occlusion-ground-intensity"),j=f.paint.get("building-ambient-occlusion-ground-radius"),k=f.paint.get("building-ambient-occlusion-ground-attenuation"),L=f.paint.get("building-opacity");if(L<=0)return;let B=E>0&&j>0,G=!0;const Z=f.paint.get("building-vertical-scale");if(Z<=0)return;(!v.shadowRenderer||Z<1)&&(G=!1);const Q=v.conflationActive&&v.style.isLayerClipped(f,l.getSource()),X=v.style.order.indexOf(f.fqid);if(function(se,le,de,xe,ye,Ee){for(const Ne of Ee){const je=le.getTile(Ne).getBucket(de);je&&(ye&&je.updateReplacement(Ne,se.replacementSource,xe),je.uploadUpdatedIndexBuffer(se.context))}}(v,l,f,X,Q,_),function(se,le,de,xe){for(const ye of xe){const Ee=le.getTile(ye).getBucket(de);Ee&&Ee.needsEvaluation()&&Ee.uploadUpdatedColorBuffer(se.context)}}(v,l,f,_),f.resetLayerRenderingStats(v),v.shadowRenderer&&(v.shadowRenderer.useNormalOffset=!0),v.renderPass==="shadow"&&v.shadowRenderer){const se=v.shadowRenderer,le=[],de=se.getShadowPassDepthMode();V_({painter:v,source:l,layer:f,coords:_,defines:le,blendMode:se.getShadowPassColorMode(),depthMode:de,opacity:L,verticalScale:Z,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(v.renderPass==="translucent"){let se=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];G&&(se=se.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),v.shadowRenderer&&v.shadowRenderer.useNormalOffset&&(se=se.concat("NORMAL_OFFSET"));const le=f.paint.get("building-facade-emissive-chance"),de=f.paint.get("building-ambient-occlusion-intensity"),xe=f.paint.get("building-flood-light-intensity"),ye=f.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",Ee=f.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(ye?null:f.lut).toArray01().slice(0,3),Ne=f.paint.get("building-flood-light-ground-attenuation"),je=xe>0,Ve=new Er(v.context.gl.LEQUAL,Er.ReadWrite,v.depthRangeFor3D);L<1&&V_({painter:v,source:l,layer:f,coords:_,defines:se,blendMode:vn.disabled,depthMode:Ve,opacity:L,verticalScale:Z,facadeEmissiveChance:le,facadeAOIntensity:de,floodLightIntensity:xe,floodLightColor:Ee,depthOnly:!0});const Ie=v.colorModeForRenderPass();V_({painter:v,source:l,layer:f,coords:_,defines:se,blendMode:Ie,depthMode:Ve,opacity:L,verticalScale:Z,facadeEmissiveChance:le,facadeAOIntensity:de,floodLightIntensity:xe,floodLightColor:Ee}),B&&q_(v,l,f,_,!0,L,E,j,xe,Ee,k,Q),je&&q_(v,l,f,_,!1,L,E,j,xe,Ee,Ne,Q)}else if(v.renderPass==="light-beam"){const se=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],le=new Er(v.context.gl.LEQUAL,Er.ReadOnly,v.depthRangeFor3D);V_({painter:v,source:l,layer:f,coords:_,defines:se,blendMode:vn.alphaBlended,depthMode:le,opacity:L,verticalScale:Z,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}v.shadowRenderer&&(v.shadowRenderer.useNormalOffset=!1),v.resetStencilClippingMasks()},hillshade:function(v,l,f,_){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent"||v.style.disableElevatedTerrain)return;const E=v.context,j=v.terrain&&v.terrain.renderingToTexture,[k,L]=v.renderPass!=="translucent"||j?[{},_]:v.stencilConfigForOverlap(_);for(const B of L){const G=l.getTile(B);if(G.needsHillshadePrepare&&v.renderPass==="offscreen")eR(v,G,f);else if(v.renderPass==="translucent"){const Z=v.depthModeForSublayer(0,Er.ReadOnly),Q=f.paint.get("hillshade-emissive-strength"),X=v.colorModeForDrapableLayerRenderPass(Q),se=j&&v.terrain?v.terrain.stencilModeForRTTOverlap(B):k[B.overscaledZ];QI(v,B,G,f,Z,se,X)}}E.viewport.set([0,0,v.width,v.height]),v.resetStencilClippingMasks()},raster:function(v,l,f,_,E,j){if(v.renderPass!=="translucent"||f.paint.get("raster-opacity")===0)return;const k=v.transform.projection.name==="globe",L=f.paint.get("raster-elevation")!==0,B=L&&k;if(v.renderElevatedRasterBackface&&!B)return;const G=v.context,Z=G.gl,Q=l.getSource(),X=function(Ie,Ge,$e,Le){const Ke=Ge.paint.get("raster-color"),dt=Ie.type==="raster-array",at=[],Et=Ge.paint.get("raster-resampling"),yt=Ge.paint.get("raster-color-mix");let Nt=Ge.paint.get("raster-color-range");const Xt=[yt[0],yt[1],yt[2],0],mt=yt[3];let tt=Et==="nearest"?Le.NEAREST:Le.LINEAR;if(dt&&(at.push("RASTER_ARRAY"),Ke||at.push("RASTER_COLOR"),Et==="linear"&&at.push("RASTER_ARRAY_LINEAR"),tt=Le.NEAREST,!Nt&&Ie.rasterLayers)){const It=Ie.rasterLayers.find(({id:vt})=>vt===Ge.sourceLayer);It&&It.fields&&It.fields.range&&(Nt=It.fields.range)}if(Nt=Nt||[0,1],Ke){at.push("RASTER_COLOR"),$e.activeTexture.set(Le.TEXTURE2),Ge.updateColorRamp(Nt);let It=Ge.colorRampTexture;It||(It=Ge.colorRampTexture=new i.T($e,Ge.colorRamp,Le.RGBA8)),It.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)}return{mix:Xt,range:Nt,offset:mt,defines:at,resampling:tt}}(Q,f,G,Z);if(Q instanceof i.aT&&!_.length&&!k)return;const se=f.paint.get("raster-emissive-strength"),le=v.colorModeForDrapableLayerRenderPass(se),de=v.terrain&&v.terrain.renderingToTexture,xe=!v.options.moving,ye=f.paint.get("raster-resampling")==="nearest"?Z.NEAREST:Z.LINEAR;if(Q instanceof i.aT&&!_.length&&(Q.onNorthPole||Q.onSouthPole)){const Ie=L?v.stencilModeFor3D():tn.disabled;return void m1(!!Q.onNorthPole,null,v,l,f,se,X,Xr.disabled,Ie)}if(!_.length)return;const[Ee,Ne]=Q instanceof i.aT||de?[{},_]:v.stencilConfigForOverlap(_),je=Ne[Ne.length-1].overscaledZ;B&&X.defines.push("PROJECTION_GLOBE_VIEW"),L&&X.defines.push("RENDER_CUTOFF");const Ve=(Ie,Ge,$e)=>{for(const Le of Ie){const Ke=Le.toUnwrapped(),dt=l.getTile(Le);if(de&&(!dt||!dt.hasData()))continue;G.activeTexture.set(Z.TEXTURE0);const at=pR(dt,Q,f,X);if(!at||!at.texture)continue;const{texture:Et,mix:yt,offset:Nt,tileSize:Xt,buffer:mt}=at;let tt,It;de?(tt=Er.disabled,It=Le.projMatrix):L?(tt=new Er(Z.LEQUAL,Er.ReadWrite,v.depthRangeFor3D),It=k?Float32Array.from(v.transform.expandedFarZProjMatrix):v.transform.calculateProjMatrix(Ke,xe)):(tt=v.depthModeForSublayer(Le.overscaledZ-je,f.paint.get("raster-opacity")===1?Er.ReadWrite:Er.ReadOnly,Z.LESS),It=v.transform.calculateProjMatrix(Ke,xe));const vt=v.terrain&&de?v.terrain.stencilModeForRTTOverlap(Le):Ee[Le.overscaledZ],Bt=j?0:f.paint.get("raster-fade-duration");dt.registerFadeDuration(Bt);const rr=l.findLoadedParent(Le,0),xr=C_(dt,rr,l,v.transform,Bt);let Wt,Jt;!xr.isFading&&dt.refreshedUponExpiration&&(dt.refreshedUponExpiration=!1),v.terrain&&v.terrain.prepareDrawTile(),G.activeTexture.set(Z.TEXTURE0),Et.bind(ye,Z.CLAMP_TO_EDGE),G.activeTexture.set(Z.TEXTURE1),rr?(rr.texture&&rr.texture.bind(ye,Z.CLAMP_TO_EDGE),Wt=Math.pow(2,rr.tileID.overscaledZ-dt.tileID.overscaledZ),Jt=[dt.tileID.canonical.x*Wt%1,dt.tileID.canonical.y*Wt%1]):Et.bind(ye,Z.CLAMP_TO_EDGE),"useMipmap"in Et&&G.extTextureFilterAnisotropic&&v.transform.pitch>20&&Z.texParameterf(Z.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax);const wr=v.transform;let pr;const dr=L?PA(wr):[0,0,0,0];let mr,$r,jn,Fn,Ei,Yr=0;if(B&&Q instanceof i.aT&&Q.coordinates.length>3)mr=Float32Array.from(i.bj(i.dI(new i.cC(0,0,0)))),$r=Float32Array.from(wr.globeMatrix),jn=Float32Array.from(i.dE(wr)),Fn=[i.aF(wr.center.lng),i.aJ(wr.center.lat)],pr=Q.elevatedGlobePerspectiveTransform,Ei=Q.elevatedGlobeGridMatrix||new Float32Array(9);else if(B){const zn=i.dF(Le.canonical);Yr=i.dG(zn.getCenter().lat),mr=Float32Array.from(i.bj(i.dI(Le.canonical))),$r=Float32Array.from(wr.globeMatrix),jn=Float32Array.from(i.dE(wr)),Fn=[i.aF(wr.center.lng),i.aJ(wr.center.lat)],pr=[0,0],Ei=Float32Array.from(i.dH(Le.canonical,zn,Yr,wr.worldSize/wr._pixelsPerMercatorPixel))}else pr=Q instanceof i.aT?Q.perspectiveTransform:[0,0],mr=new Float32Array(16),$r=new Float32Array(9),jn=new Float32Array(16),Fn=[0,0],Ei=new Float32Array(9);const Dn=oy(It,mr,$r,jn,Ei,Jt||[0,0],i.aj(v.transform.zoom),Fn,dr,Wt||1,xr,f,pr,L?f.paint.get("raster-elevation"):0,2,yt,Nt,X.range,Xt,mt,se),hn=v.isTileAffectedByFog(Le),yi=v.getOrCreateProgram("raster",{defines:X.defines,overrideFog:hn});if(v.uploadCommonUniforms(G,yi,Ke),Q instanceof i.aT){const zn=Q.elevatedGlobeVertexBuffer,Li=Q.elevatedGlobeIndexBuffer;if(de||!k)Q.boundsBuffer&&Q.boundsSegments&&yi.draw(v,Z.TRIANGLES,tt,tn.disabled,le,Xr.disabled,Dn,f.id,Q.boundsBuffer,v.quadTriangleIndexBuffer,Q.boundsSegments);else if(zn&&Li){const Yn=wr.zoom<=i.cZ?Q.elevatedGlobeSegments:Q.getSegmentsForLongitude(wr.center.lng);Yn&&yi.draw(v,Z.TRIANGLES,tt,tn.disabled,le,Ge,Dn,f.id,zn,Li,Yn)}}else if(B){tt=new Er(Z.LEQUAL,Er.ReadOnly,v.depthRangeFor3D);const zn=v.globeSharedBuffers;if(zn){const[Li,Yn,pn]=zn.getGridBuffers(Yr,!1);yi.draw(v,Z.TRIANGLES,tt,$e||vt,v.colorModeForRenderPass(),Ge,Dn,f.id,Li,Yn,pn)}}else{const{tileBoundsBuffer:zn,tileBoundsIndexBuffer:Li,tileBoundsSegments:Yn}=v.getTileBoundsBuffers(dt);yi.draw(v,Z.TRIANGLES,tt,vt,le,Xr.disabled,Dn,f.id,zn,Li,Yn)}}if(!(Q instanceof i.aT)&&B)for(const Le of Ie){const Ke=Le.canonical.y===(1<<Le.canonical.z)-1;Le.canonical.y===0&&m1(!0,Le,v,l,f,se,X,Ge,$e||tn.disabled),Ke&&m1(!1,Le,v,l,f,se,X,Ge===Xr.frontCW?Xr.backCW:Xr.frontCW,$e||tn.disabled)}};B?Ve(Ne,v.renderElevatedRasterBackface?Xr.backCW:Xr.frontCW,v.stencilModeFor3D()):Ve(Ne,Xr.disabled,void 0),v.resetStencilClippingMasks()},"raster-particle":function(v,l,f,_,E,j){v.renderPass==="offscreen"&&function(k,L,B,G){if(!G.length)return;const Z=k.context,Q=Z.gl,X=L.getSource();if(!(X instanceof ba))return;const se=Math.ceil(Math.sqrt(B.paint.get("raster-particle-count")));let le=B.particlePositionRGBAImage;if(!le||le.width!==se){const Ne=function(je){const Ve=je*je,Ie=new Uint8Array(4*Ve),Ge=function(Le){return Le|=0,Le=Math.imul(2747636419^Le,2654435769),Le=Math.imul(Le^Le>>>16,2654435769),((Le=Math.imul(Le^Le>>>16,2654435769))>>>0)/4294967296},$e=1/1.1;for(let Le=0;Le<Ve;Le++){const Ke=$e*(Ge(2*Le+0)+yf),dt=$e*(Ge(2*Le+1)+yf),at=255*Ke%1,Et=255*dt%1,yt=at,Nt=dt-Et/255,Xt=Et;Ie[4*Le+0]=255*(Ke-at/255),Ie[4*Le+1]=255*yt,Ie[4*Le+2]=255*Nt,Ie[4*Le+3]=255*Xt}return Ie}(se);le=B.particlePositionRGBAImage=new i.q({width:se,height:se},Ne)}let de=B.particleFramebuffer;de?de.width!==se&&(de.destroy(),de=B.particleFramebuffer=Z.createFramebuffer(se,se,!0,null)):de=B.particleFramebuffer=Z.createFramebuffer(se,se,!0,null);const xe=[];for(const Ne of G){const je=L.getTile(Ne);if(!(je instanceof Qd))continue;const Ve=g1(je,X,B);if(!Ve)continue;const Ie=[je.tileSize,je.tileSize];let Ge=B.tileFramebuffer;Ge||(Ge=B.tileFramebuffer=Z.createFramebuffer(Ie[0],Ie[1],!0,null));let $e=je.rasterParticleState;$e||($e=je.rasterParticleState=new kl(Z,Ne,Ie,le));const Le=$e.update(B.lastInvalidatedAt);$e.particleTextureDimension!==se&&$e.updateParticleTexture(Ne,le);const Ke=$e.targetColorTexture;$e.targetColorTexture=$e.backgroundColorTexture,$e.backgroundColorTexture=Ke;const dt=$e.particleTexture0;$e.particleTexture0=$e.particleTexture1,$e.particleTexture1=dt,xe.push([Ne,Ve,$e,Le])}if(xe.length===0)return;const ye=i.o.now(),Ee=B.previousDrawTimestamp?.001*(ye-B.previousDrawTimestamp):.0167;if(B.previousDrawTimestamp=ye,B.hasColorMap()){Z.activeTexture.set(Q.TEXTURE0+2);let Ne=B.colorRampTexture;Ne||(Ne=B.colorRampTexture=new i.T(Z,B.colorRamp,Q.RGBA8)),Ne.bind(Q.LINEAR,Q.CLAMP_TO_EDGE)}Z.bindFramebuffer.set(B.tileFramebuffer.framebuffer),function(Ne,je,Ve){const Ie=Ne.context,Ge=Ie.gl,$e=je.tileFramebuffer;Ie.activeTexture.set(Ge.TEXTURE0);const Le={u_texture:0,u_opacity:1.05*(dt=je.paint.get("raster-particle-fade-opacity-factor"))/(dt+.05)},Ke=Ne.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var dt;for(const at of Ve){const[,,Et,yt]=at;$e.colorAttachment.set(Et.targetColorTexture.texture),Ie.viewport.set([0,0,$e.width,$e.height]),Ie.clear({color:i.ao.transparent}),yt&&(Et.backgroundColorTexture.bind(Ge.NEAREST,Ge.CLAMP_TO_EDGE),Ke.draw(Ne,Ge.TRIANGLES,Er.disabled,tn.disabled,vn.alphaBlended,Xr.disabled,Le,je.id,Ne.viewportBuffer,Ne.quadTriangleIndexBuffer,Ne.viewportSegments))}}(k,B,xe),function(Ne,je,Ve,Ie){const Ge=Ne.context,$e=Ge.gl,Le=Ve.tileFramebuffer,Ke=Ne.transform.projection.name==="globe",dt=Ve.paint.get("raster-particle-max-speed");for(const at of Ie){const[Et,yt,Nt]=at;Ge.activeTexture.set($e.TEXTURE0+0),yt.texture.bind($e.LINEAR,$e.CLAMP_TO_EDGE),Le.colorAttachment.set(Nt.targetColorTexture.texture);const Xt=Ne.getOrCreateProgram("rasterParticleDraw",{defines:yt.defines,overrideFog:!1});Ge.activeTexture.set($e.TEXTURE0+1);const mt=yt.scalarData?[]:[0,1,2,3].map(vt=>i.e8[vt](Et));mt.push(Et);const tt=Et.canonical.x,It=Et.canonical.y;for(const vt of mt){const Bt=je.getTile(Ke?vt.wrapped():vt);if(!Bt)continue;const rr=Bt.rasterParticleState;if(!rr)continue;const xr=vt.canonical.x+(1<<vt.canonical.z)*(vt.wrap-Et.wrap),Wt=vt.canonical.y;rr.particleTexture0.bind($e.NEAREST,$e.CLAMP_TO_EDGE);const Jt=o1(1,rr.particleTexture0.size[0],[xr-tt,Wt-It],0,yt.texture.size,2,dt,yt.textureOffset,yt.scale,yt.offset);Xt.draw(Ne,$e.POINTS,Er.disabled,tn.disabled,vn.alphaBlended,Xr.disabled,Jt,Ve.id,rr.particleIndexBuffer,void 0,rr.particleSegment)}}}(k,L,B,xe),Z.bindFramebuffer.set(B.particleFramebuffer.framebuffer),function(Ne,je,Ve,Ie){const Ge=Ne.context,$e=Ge.gl,Le=je.paint.get("raster-particle-max-speed"),Ke=Ie*je.paint.get("raster-particle-speed-factor")*.15,dt=function(Et){return Math.pow(Et,6)}(.01+1*je.paint.get("raster-particle-reset-rate-factor")),at=je.particleFramebuffer;Ge.viewport.set([0,0,at.width,at.height]);for(const Et of Ve){const[,yt,Nt]=Et;Ge.activeTexture.set($e.TEXTURE0+0),yt.texture.bind($e.LINEAR,$e.CLAMP_TO_EDGE),Ge.activeTexture.set($e.TEXTURE0+1);const Xt=Nt.particleTexture0;Xt.bind($e.NEAREST,$e.CLAMP_TO_EDGE);const mt=R_(1,Xt.size[0],0,yt.texture.size,Le,Ke,dt,yt.textureOffset,yt.scale,yt.offset);at.colorAttachment.set(Nt.particleTexture1.texture),Ge.clear({color:i.ao.transparent}),Ne.getOrCreateProgram("rasterParticleUpdate",{defines:yt.defines}).draw(Ne,$e.TRIANGLES,Er.disabled,tn.disabled,vn.unblended,Xr.disabled,mt,je.id,Ne.viewportBuffer,Ne.quadTriangleIndexBuffer,Ne.viewportSegments)}}(k,B,xe,Ee)}(v,l,f,_),v.renderPass==="translucent"&&(function(k,L,B,G,Z){const Q=k.context,X=Q.gl,se=L.getSource().tileSize,le=5*(1-i.ah(i.cK,i.cK+1,k.transform.zoom))*se+B.paint.get("raster-particle-elevation"),de=!k.options.moving,xe=k.transform.projection.name==="globe";if(!G.length)return;const[ye,Ee]=k.stencilConfigForOverlap(G),Ne=[];xe&&Ne.push("PROJECTION_GLOBE_VIEW");const je=k.stencilModeFor3D();for(const Ve of Ee){const Ie=Ve.toUnwrapped(),Ge=L.getTile(Ve);if(!Ge.rasterParticleState)continue;const $e=Ge.rasterParticleState,Le=100;Ge.registerFadeDuration(Le);const Ke=L.findLoadedParent(Ve,0),dt=C_(Ge,Ke,L,k.transform,Le);let at,Et;k.terrain&&k.terrain.prepareDrawTile(),Q.activeTexture.set(X.TEXTURE0),$e.targetColorTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),Q.activeTexture.set(X.TEXTURE1),Ke&&Ke.rasterParticleState?(Ke.rasterParticleState.targetColorTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),at=Math.pow(2,Ke.tileID.overscaledZ-Ge.tileID.overscaledZ),Et=[Ge.tileID.canonical.x*at%1,Ge.tileID.canonical.y*at%1]):$e.targetColorTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const yt=xe?Float32Array.from(k.transform.expandedFarZProjMatrix):k.transform.calculateProjMatrix(Ie,de),Nt=k.transform,Xt=sl(Nt),mt=i.dF(Ve.canonical),tt=i.dG(mt.getCenter().lat);let It,vt,Bt,rr,xr;xe?(It=Float32Array.from(i.bj(i.dI(Ve.canonical))),vt=Float32Array.from(Nt.globeMatrix),Bt=Float32Array.from(i.dE(Nt)),rr=[i.aF(Nt.center.lng),i.aJ(Nt.center.lat)],xr=Float32Array.from(i.dH(Ve.canonical,mt,tt,Nt.worldSize/Nt._pixelsPerMercatorPixel))):(It=new Float32Array(16),vt=new Float32Array(9),Bt=new Float32Array(16),rr=[0,0],xr=new Float32Array(9));const Wt=nh(yt,It,vt,Bt,xr,Et||[0,0],i.aj(k.transform.zoom),rr,Xt,at||1,dt,le),Jt=k.isTileAffectedByFog(Ve),wr=k.getOrCreateProgram("rasterParticle",{defines:Ne,overrideFog:Jt});if(k.uploadCommonUniforms(Q,wr,Ie),xe){const pr=new Er(X.LEQUAL,Er.ReadOnly,k.depthRangeFor3D),dr=0,mr=k.globeSharedBuffers;if(mr){const[$r,jn,Fn]=mr.getGridBuffers(tt,dr!==0);wr.draw(k,X.TRIANGLES,pr,je,vn.alphaBlended,k.renderElevatedRasterBackface?Xr.frontCCW:Xr.backCCW,Wt,B.id,$r,jn,Fn)}}else{const pr=k.depthModeForSublayer(0,Er.ReadOnly),dr=ye[Ve.overscaledZ],{tileBoundsBuffer:mr,tileBoundsIndexBuffer:$r,tileBoundsSegments:jn}=k.getTileBoundsBuffers(Ge);wr.draw(k,X.TRIANGLES,pr,dr,vn.alphaBlended,Xr.disabled,Wt,B.id,mr,$r,jn)}}k.resetStencilClippingMasks()}(v,l,f,_),v.style.map.triggerRepaint())},background:function(v,l,f,_){const E=f.paint.get("background-color"),j=f.paint.get("background-color-use-theme").constantOr("default")==="none",k=f.paint.get("background-opacity"),L=f.paint.get("background-emissive-strength"),B=f.paint.get("background-pitch-alignment")==="viewport";if(k===0)return;const G=v.context,Z=G.gl,Q=v.transform,X=Q.tileSize,se=f.paint.get("background-pattern");let le;if(se!==void 0&&(se===null||(le=v.imageManager.getPattern(i.I.from(se.toString()),f.scope,v.style.getLut(f.scope)),!le)))return;const de=!se&&E.a===1&&k===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==de)return;const xe=tn.disabled,ye=v.depthModeForSublayer(0,de==="opaque"?Er.ReadWrite:Er.ReadOnly),Ee=v.colorModeForDrapableLayerRenderPass(L),Ne=se?"backgroundPattern":"background";let je,Ve=_;if(Ve||(je=v.getBackgroundTiles(),Ve=Object.values(je).map(Ie=>Ie.tileID)),se&&(G.activeTexture.set(Z.TEXTURE0),v.imageManager.bind(v.context,f.scope)),B){const Ie=v.getOrCreateProgram(Ne,{overrideFog:!1,overrideRtt:!0}),Ge=new Float32Array(i.bz([])),$e=new i.aP(0,0,0,0,0),Le=se?D_(Ge,L,k,v,0,f.scope,le,B,{tileID:$e,tileSize:X}):M_(Ge,L,k,E.toPremultipliedRenderColor(j?null:f.lut));Ie.draw(v,Z.TRIANGLES,ye,xe,Ee,Xr.disabled,Le,f.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments)}else for(const Ie of Ve){const Ge=v.isTileAffectedByFog(Ie),$e=v.getOrCreateProgram(Ne,{overrideFog:Ge}),Le=Ie.toUnwrapped(),Ke=_?Ie.projMatrix:v.transform.calculateProjMatrix(Le);v.prepareDrawTile();const dt=l?l.getTile(Ie):je?je[Ie.key]:new Cu(Ie,X,Q.zoom,v),at=se?D_(Ke,L,k,v,0,f.scope,le,B,{tileID:Ie,tileSize:X}):M_(Ke,L,k,E.toPremultipliedRenderColor(j?null:f.lut));v.uploadCommonUniforms(G,$e,Le);const{tileBoundsBuffer:Et,tileBoundsIndexBuffer:yt,tileBoundsSegments:Nt}=v.getTileBoundsBuffers(dt);$e.draw(v,Z.TRIANGLES,ye,xe,Ee,Xr.disabled,at,f.id,Et,yt,Nt)}},sky:function(v,l,f){const _=v._atmosphere?i.aj(v.transform.zoom):1,E=f.paint.get("sky-opacity")*_;if(E===0)return;const j=v.context,k=f.paint.get("sky-type"),L=new Er(j.gl.LEQUAL,Er.ReadOnly,[0,1]),B=v.frameCounter/1e3%1;k==="atmosphere"?v.renderPass==="offscreen"?f.needsSkyboxCapture(v)&&(function(G,Z,Q,X){const se=G.context,le=se.gl;let de=Z.skyboxFbo;if(!de){de=Z.skyboxFbo=se.createFramebuffer(32,32,!0,null),Z.skyboxGeometry=new b1(se),Z.skyboxTexture=se.gl.createTexture(),le.bindTexture(le.TEXTURE_CUBE_MAP,Z.skyboxTexture),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_S,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_T,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MIN_FILTER,le.LINEAR),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MAG_FILTER,le.LINEAR);for(let Ne=0;Ne<6;++Ne)le.texImage2D(le.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,0,le.RGBA,32,32,0,le.RGBA,le.UNSIGNED_BYTE,null)}se.bindFramebuffer.set(de.framebuffer),se.viewport.set([0,0,32,32]);const xe=Z.getCenter(G,!0),ye=G.getOrCreateProgram("skyboxCapture"),Ee=new Float64Array(16);i.bz(Ee),i.em(Ee,Ee,.5*-Math.PI),Pc(G,Z,ye,Ee,xe,0),i.bz(Ee),i.em(Ee,Ee,.5*Math.PI),Pc(G,Z,ye,Ee,xe,1),i.bz(Ee),i.cT(Ee,Ee,.5*-Math.PI),Pc(G,Z,ye,Ee,xe,2),i.bz(Ee),i.cT(Ee,Ee,.5*Math.PI),Pc(G,Z,ye,Ee,xe,3),i.bz(Ee),Pc(G,Z,ye,Ee,xe,4),i.bz(Ee),i.em(Ee,Ee,Math.PI),Pc(G,Z,ye,Ee,xe,5),se.viewport.set([0,0,G.width,G.height])}(v,f),f.markSkyboxValid(v)):v.renderPass==="sky"&&function(G,Z,Q,X,se){const le=G.context,de=le.gl,xe=G.transform,ye=G.getOrCreateProgram("skybox");le.activeTexture.set(de.TEXTURE0),de.bindTexture(de.TEXTURE_CUBE_MAP,Z.skyboxTexture);const Ee=((Ne,je,Ve,Ie,Ge)=>({u_matrix:Ne,u_sun_direction:je,u_cubemap:0,u_opacity:Ie,u_temporal_offset:Ge}))(xe.skyboxMatrix,Z.getCenter(G,!1),0,X,se);G.uploadCommonUniforms(le,ye),ye.draw(G,de.TRIANGLES,Q,tn.disabled,G.colorModeForRenderPass(),Xr.backCW,Ee,"skybox",Z.skyboxGeometry.vertexBuffer,Z.skyboxGeometry.indexBuffer,Z.skyboxGeometry.segment)}(v,f,L,E,B):k==="gradient"&&v.renderPass==="sky"&&function(G,Z,Q,X,se){const le=G.context,de=le.gl,xe=G.transform,ye=G.getOrCreateProgram("skyboxGradient");Z.skyboxGeometry||(Z.skyboxGeometry=new b1(le)),le.activeTexture.set(de.TEXTURE0);let Ee=Z.colorRampTexture;Ee||(Ee=Z.colorRampTexture=new i.T(le,Z.colorRamp,de.RGBA8)),Ee.bind(de.LINEAR,de.CLAMP_TO_EDGE);const Ne=((je,Ve,Ie,Ge,$e)=>({u_matrix:je,u_color_ramp:0,u_center_direction:Ve,u_radius:i.an(Ie),u_opacity:Ge,u_temporal_offset:$e}))(xe.skyboxMatrix,Z.getCenter(G,!1),Z.paint.get("sky-gradient-radius"),X,se);G.uploadCommonUniforms(le,ye),ye.draw(G,de.TRIANGLES,Q,tn.disabled,G.colorModeForRenderPass(),Xr.backCW,Ne,"skyboxGradient",Z.skyboxGeometry.vertexBuffer,Z.skyboxGeometry.indexBuffer,Z.skyboxGeometry.segment)}(v,f,L,E,B)},custom:function(v,l,f,_){const E=v.context,j=f.implementation;if(!v.transform.projection.unsupportedLayers||!v.transform.projection.unsupportedLayers.includes("custom")||v.terrain&&(v.terrain.renderingToTexture||v.renderPass==="offscreen")&&f.isDraped(l)){if(v.renderPass==="offscreen"){const k=j.prerender;if(k){if(v.setCustomLayerDefaults(),E.setColorMode(v.colorModeForRenderPass()),v.transform.projection.name==="globe"){const L=v.transform.pointMerc;k.call(j,E.gl,v.transform.customLayerMatrix(),v.transform.getProjection(),v.transform.globeToMercatorMatrix(),i.aj(v.transform.zoom),[L.x,L.y],v.transform.pixelsPerMeterRatio)}else k.call(j,E.gl,v.transform.customLayerMatrix());E.setDirty(),v.setBaseState()}}else if(v.renderPass==="translucent"){if(v.terrain&&v.terrain.renderingToTexture){const L=j.renderToTile;if(L){const B=_[0].canonical,G={x:B.x+_[0].wrap*(j.wrapTileId?0:1<<B.z),y:B.y,z:B.z};E.setDepthMode(Er.disabled),E.setStencilMode(tn.disabled),E.setColorMode(v.colorModeForRenderPass()),v.setCustomLayerDefaults(),L.call(j,E.gl,G),E.setDirty(),v.setBaseState()}return}v.setCustomLayerDefaults(),E.setColorMode(v.colorModeForRenderPass()),E.setStencilMode(tn.disabled);const k=j.renderingMode==="3d"?new Er(v.context.gl.LEQUAL,Er.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,Er.ReadOnly);if(E.setDepthMode(k),v.transform.projection.name==="globe"){const L=v.transform.pointMerc;j.render(E.gl,v.transform.customLayerMatrix(),v.transform.getProjection(),v.transform.globeToMercatorMatrix(),i.aj(v.transform.zoom),[L.x,L.y],v.transform.pixelsPerMeterRatio)}else j.render(E.gl,v.transform.customLayerMatrix());E.setDirty(),v.setBaseState(),E.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(v,l,f,_){if(v.renderPass==="opaque")return;const E=f.paint.get("model-opacity").constantOr(1),j=f.paint.get("model-elevation-reference"),k=j==="ground",L=j==="ground";if(E===0)return;const B=f.paint.get("model-cast-shadows");if(v.renderPass==="shadow"&&(!B||v.terrain&&E<.65&&f._transitionablePaint._values["model-opacity"].value.expression instanceof i.ad))return;const G=v.shadowRenderer,Z=f.paint.get("model-receive-shadows");G&&(G.useNormalOffset=!0,Z||(G.enabled=!1));const Q=()=>{G&&(G.useNormalOffset=!0,Z||(G.enabled=!0))},X=l.getSource();if(v.renderPass==="light-beam"&&X.type!=="batched-model")return;if(X.type==="vector"||X.type==="geojson")return function(je,Ve,Ie,Ge,$e){const Le=je.transform,Ke=Le.projection.name==="globe",dt=Le.getFreeCameraOptions().position;if(!je.modelManager)return;const at=je.modelManager;Ie.modelManager=at;const Et=je.shadowRenderer;if(!Ie._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const yt=Ie._unevaluatedLayout._values["model-id"],Nt=Object.assign({},Ie.layout.get("model-id").parameters),Xt=je.style.order.indexOf(Ie.fqid);for(const mt of Ge){const tt=Ve.getTile(mt).getBucket(Ie);if(!tt||tt.projection.name!==Le.projection.name)continue;const It=tt.getModelUris();if(It&&!tt.modelsRequested&&(at.addModelsFromBucket(It,$e),tt.modelsRequested=!0),Ke)Nt.zoom=mt.overscaledZ;else{const pr=S1(mt,Le);Nt.zoom=pr}const vt=yt.possiblyEvaluate(Nt);if(RA(je,tt,mt),Wl.shadowUniformsInitialized=!1,Wl.useSingleShadowCascade=!!Et&&Et.getMaxCascadeForTile(mt.toUnwrapped())===0,je.renderPass==="shadow"&&Et){if(je.currentShadowCascade===1&&tt.isInsideFirstShadowMapFrustum)continue;const pr=Le.calculatePosMatrix(mt.toUnwrapped(),Le.worldSize);if(Wl.tileMatrix.set(pr),Wl.shadowTileMatrix=Float32Array.from(Et.calculateShadowPassMatrixFromMatrix(pr)),Wl.aabb.min=[0,0,0],Wl.aabb.max[0]=Wl.aabb.max[1]=i.al,Wl.aabb.max[2]=0,W_(tt,Wl,je,Ie.scope))continue}const Bt=1<<mt.canonical.z,rr=[((dt.x-mt.wrap)*Bt-mt.canonical.x)*i.al,(dt.y*Bt-mt.canonical.y)*i.al,dt.z*Bt*i.al];je.conflationActive&&Object.keys(tt.instancesPerModel).length>0&&je.style.isLayerClipped(Ie,Ve.getSource())&&tt.updateReplacement(mt,je.replacementSource,Xt,$e)&&(tt.uploaded=!1,tt.upload(je.context));let xr=0;const Wt=new Array,Jt=new Array,wr=new Array;for(let pr in tt.instancesPerModel){const dr=tt.instancesPerModel[pr];dr.features.length>0&&!Ke&&(pr=vt.evaluate(dr.features[0].feature,{}));const mr=at.getModel(pr,$e);if(mr||at.hasURLBeenRequested(pr)||tt.modelUris.includes(pr)||(tt.modelUris.push(pr),tt.modelsRequested=!1),mr&&mr.uploaded)if(Ke){const $r=i.c4([],[dt.x,dt.y,dt.z],je.transform.worldSize);i.ev($r,$r);for(let jn=0;jn<dr.instancedDataArray.length;++jn){const Fn=[0,0,0],Ei=[1,1,1],Yr=i.ew(),Dn=dr.tileCoordinatesForInstance(jn),hn=dr.transformForInstance(jn);i.ex(Ei,hn),i.ey(Yr,hn),i.ez(Fn,Yr);const yi=dr.translationForInstance(jn),zn=new i.aS(0,0);i.eA(tt.canonical,zn,Dn.x,Dn.y);const Li=i.bB();i.eB(Li,mr,je.transform,zn,Fn,Ei,yi,!0,!1,!1);const Yn=dr.colorForInstance(jn),pn=i.bz([]),ai=i.ee(zn.lat,je.transform.zoom),xn=i.bp([],[1,1,1/ai]);i.bq(pn,pn,$r),wr.push({zScaleMatrix:xn,negCameraPosMatrix:pn});for(const Wi of mr.nodes)G_(je,Wi,Li,je.transform.expandedFarZProjMatrix,xr,Wt,Jt,mr.materialOverrides,Yn);++xr}}else for(const $r of mr.nodes)E1(je,Ie,$r,dr,rr,mt,Wl)}if(Ke)if(je.renderPass==="shadow"){for(const pr of Jt)qp(pr.mesh,pr.nodeModelMatrix,je,Ie);for(const pr of Wt)qp(pr.mesh,pr.nodeModelMatrix,je,Ie)}else IA(je,Ie,1,Wt,Jt,wr)}}(v,l,f,_,H_(X,f,v.style._importedAsBasemap)),void Q();if(!X.loaded())return;if(X.type==="batched-model")return function(je,Ve,Ie,Ge){Ie.resetLayerRenderingStats(je);const $e=je.context,Le=je.transform,Ke=je.style.fog,dt=je.shadowRenderer;if(Le.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${Le.projection.name} projection is not yet implemented`);const at=je.transform.getFreeCameraOptions().position,Et=i.c4([],[at.x,at.y,at.z],je.transform.worldSize),yt=i.ev([],Et),Nt=i.bz([]),Xt=i.ee(Le.center.lat,Le.zoom),mt=i.bp([],[1,1,1/Xt]);i.bq(Nt,Nt,yt);const tt=Ie.paint.get("model-opacity").constantOr(1),It=new Er($e.gl.LEQUAL,Er.ReadWrite,je.depthRangeFor3D),vt=new Er($e.gl.LEQUAL,Er.ReadOnly,je.depthRangeFor3D),Bt=new i.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),rr=je.renderPass==="shadow",xr=rr&&dt?dt.getCurrentCascadeFrustum():Le.getFrustum(Le.scaleZoom(Le.worldSize)),Wt=Ie.paint.get("model-front-cutoff"),Jt=Wt[2]<1,wr=dd(je,Ie.paint.get("model-cutoff-fade-range")),pr=Ie.getLayerRenderingStats();(function(dr,mr,$r,jn){const Fn=dr.terrain?dr.terrain.exaggeration():0,Ei=dr.transform.zoom;for(const Yr of jn){const Dn=mr.getTile(Yr).getBucket($r);Dn&&(Dn.setFilter($r.filter),dr.conflationActive&&Dn.updateReplacement(Yr,dr.replacementSource),Dn.evaluateTransform(dr,$r),dr.terrain&&Fn>0&&Dn.elevationUpdate(dr.terrain,Fn,Yr,$r.source),Dn.needsReEvaluation(dr,Ei,$r)&&Dn.evaluate($r))}})(je,Ve,Ie,Ge),function(){let dr,mr,$r;Jt?(dr=Ge.length-1,mr=-1,$r=-1):(dr=0,mr=Ge.length,$r=1);const jn=new Float64Array(16),Fn=i.cz(),Ei=new i.P(0,0);for(let Yr=dr;Yr!==mr;Yr+=$r){const Dn=Ge[Yr],hn=Ve.getTile(Dn).getBucket(Ie);if(!hn||!hn.uploaded)continue;let yi=!1;dt&&(yi=dt.getMaxCascadeForTile(Dn.toUnwrapped())===0);const zn=Le.calculatePosMatrix(Dn.toUnwrapped(),Le.worldSize),Li=hn.modelTraits;!rr&&Jt&&(i.bk(jn,zn),i.af(Fn,Et,jn),Ei.x=Fn[0],Ei.y=Fn[1]);const Yn=[];hn.setFilter(Ie.filter);for(const pn of hn.getNodesInfo()){if(pn.hiddenByReplacement||!pn.node.meshes)continue;const ai=pn.node;let xn=0;je.terrain&&ai.elevation&&(xn=ai.elevation*je.terrain.exaggeration());const Wi=(()=>{const wo=pn.aabb;return Bt.min=[...wo.min],Bt.max=[...wo.max],Bt.min[2]+=xn,Bt.max[2]+=xn,i.af(Bt.min,Bt.min,zn),i.af(Bt.max,Bt.max,zn),Bt})(),di=pn.evaluatedScale;if(di[0]<=1&&di[1]<=1&&di[2]<=1&&Wi.intersects(xr)===0)continue;if(!rr&&Jt){const wo=.16666666666666666;pn.cameraCollisionOpacity=Et[0]>Wi.min[0]&&Et[0]<Wi.max[0]&&Et[1]>Wi.min[1]&&Et[1]<Wi.max[1]&&Et[2]*Xt<Wi.max[2]&&ai.footprint&&i.b$(Ei,ai.footprint)?Math.max(pn.cameraCollisionOpacity-wo,0):Math.min(1,pn.cameraCollisionOpacity+wo)}const Qr=[...zn],Vn=1/i.d6(Dn.canonical),ls=ai.anchor?ai.anchor[0]:0,Ns=ai.anchor?ai.anchor[1]:0;i.bq(Qr,Qr,[ls*(di[0]-1)+pn.evaluatedTranslation[0]*Vn,Ns*(di[1]-1)+pn.evaluatedTranslation[1]*Vn,xn+pn.evaluatedTranslation[2]]),i.cp(di,i.eD)||i.cR(Qr,Qr,di);const hs=i.aB([],Qr,ai.globalMatrix),Ss=i.aB([],Le.expandedFarZProjMatrix,hs),_l=i.aB([],Le.expandedFarZProjMatrix,Qr),al=i.aC([],[ls,Ns,xn,1],Ss)[2];ai.hidden=!1;let ao=tt;rr||(Jt&&(ao*=pn.cameraCollisionOpacity,ao*=xf(Qr,Le,pn.aabb,Wt)),ao*=dy(wr,al)),ao!==0?Yn.push({nodeInfo:pn,depth:al,opacity:ao,wvpForNode:Ss,wvpForTile:_l,nodeModelMatrix:hs,tileModelMatrix:Qr}):ai.hidden=!0}rr||Yn.sort((pn,ai)=>!Jt||pn.opacity===1&&ai.opacity===1?pn.depth<ai.depth?-1:1:pn.opacity===1?-1:ai.opacity===1?1:pn.depth>ai.depth?-1:1);for(const pn of Yn){const ai=pn.nodeInfo,xn=ai.node;let Wi=i.aB([],mt,pn.tileModelMatrix);i.aB(Wi,Nt,Wi);const di=i.bk([],Wi);i.ef(di,di),i.cR(di,di,MA),Wi=i.aB(Wi,Wi,xn.globalMatrix);const Qr=je.renderPass==="light-beam",Vn=Ie.paint.get("model-color-use-theme").constantOr("default")==="none",ls=Li&i.eH.HasMapboxMeshFeatures,Ns=ls?0:ai.evaluatedRMEA[0][2];for(let hs=0;hs<xn.meshes.length;++hs){const Ss=xn.meshes[hs],_l=hs===xn.lightMeshIndex;let al=pn.wvpForNode;if(_l){if(!Qr&&!je.terrain&&je.shadowRenderer){je.currentLayer<je.firstLightBeamLayer&&(je.firstLightBeamLayer=je.currentLayer);continue}al=pn.wvpForTile}else if(Qr)continue;const ao={defines:[]},wo=[];if(!rr&&dt&&(dt.useNormalOffset=!!Ss.normalBuffer),Up(ao.defines,wo,Ss,je,Vn?null:Ie.lut),ls||ao.defines.push("DIFFUSE_SHADED"),yi&&ao.defines.push("SHADOWS_SINGLE_CASCADE"),pr&&(rr?pr.numRenderedVerticesInShadowPass+=Ss.vertexArray.length:pr.numRenderedVerticesInTransparentPass+=Ss.vertexArray.length),rr){qp(Ss,pn.nodeModelMatrix,je,Ie);continue}let Zl=null;if(Ke){const Is=w1(pn.nodeModelMatrix,je.transform);if(Zl=new Float32Array(Is),Le.projection.name!=="globe"){const Ni=Ss.aabb.min,Ds=Ss.aabb.max,[Ma,vs]=Ke.getOpacityForBounds(Is,Ni[0],Ni[1],Ds[0],Ds[1]);ao.overrideFog=Ma>=_t||vs>=_t}}const oo=Ss.material;let Xl;oo.occlusionTexture&&oo.occlusionTexture.offsetScale&&(Xl=oo.occlusionTexture.offsetScale,ao.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Nc=je.getOrCreateProgram("model",ao);!rr&&dt&&dt.setupShadowsFromMatrix(pn.tileModelMatrix,Nc,dt.useNormalOffset),je.uploadCommonUniforms($e,Nc,null,Zl);const Ra=oo.pbrMetallicRoughness;Ra.metallicFactor=.9,Ra.roughnessFactor=.5;const ys=L_(new Float32Array(al),new Float32Array(Wi),new Float32Array(di),new Float32Array(xn.globalMatrix),je,pn.opacity,Ra.baseColorFactor,oo.emissiveFactor,Ra.metallicFactor,Ra.roughnessFactor,oo,Ns,Ie,[0,0,0],Xl);!_l&&(ai.hasTranslucentParts||pn.opacity<1)&&Nc.draw(je,$e.gl.TRIANGLES,It,tn.disabled,vn.disabled,Xr.backCCW,ys,Ie.id,Ss.vertexBuffer,Ss.indexBuffer,Ss.segments,Ie.paint,je.transform.zoom,void 0,wo),Nc.draw(je,$e.gl.TRIANGLES,_l?vt:It,tn.disabled,_l||pn.opacity<1||ai.hasTranslucentParts?vn.alphaBlended:vn.unblended,Xr.backCCW,ys,Ie.id,Ss.vertexBuffer,Ss.indexBuffer,Ss.segments,Ie.paint,je.transform.zoom,void 0,wo)}}}}()}(v,l,f,_),void Q();if(X.type!=="model")return;const se=X.getModels(),le=[],de=v.transform.getFreeCameraOptions().position,xe=i.c4([],[de.x,de.y,de.z],v.transform.worldSize);i.ev(xe,xe);const ye=[],Ee=[];let Ne=0;for(const je of se){const Ve=l.getFeatureState("",je.id),Ie={type:"Unknown",id:je.id,properties:je.featureProperties},Ge=f.paint.get("model-rotation").evaluate(Ie,Ve),$e=f.paint.get("model-scale").evaluate(Ie,Ve),Le=f.paint.get("model-translation").evaluate(Ie,Ve);Hp(f,je.id,Ve,je.featureProperties,je.nodeOverrideNames,je.nodeOverrides),gR(f,je.id,Ve,je.featureProperties,je.materialOverrideNames,je.materialOverrides),je.nodeOverrides.size>0&&je.computeBoundsAndApplyParent(),je.computeModelMatrix(v,Ge,$e,Le,L,k,!1);const Ke=i.bz([]),dt=i.ee(je.position.lat,v.transform.zoom),at=i.bp([],[1,1,1/dt]);i.bq(Ke,Ke,xe),le.push({zScaleMatrix:at,negCameraPosMatrix:Ke});for(const Et of je.nodes)G_(v,Et,je.matrix,v.transform.expandedFarZProjMatrix,Ne,ye,Ee,je.materialOverrides);Ne++}if(ye.sort((je,Ve)=>Ve.depth-je.depth),v.renderPass!=="shadow")IA(v,f,E,ye,Ee,le),Q();else{for(const je of Ee)qp(je.mesh,je.nodeModelMatrix,v,f);for(const je of ye)qp(je.mesh,je.nodeModelMatrix,v,f);Q()}}},K_={line:function(v,l,f){if(v.hasElevatedBuckets=!1,v.hasNonElevatedBuckets=!1,v._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||v._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(l){const _=l.getVisibleCoordinates();for(const E of _){const j=l.getTile(E).getBucket(v);if(j&&(j.elevationType!=="none"?v.hasElevatedBuckets=!0:v.hasNonElevatedBuckets=!0,v.hasElevatedBuckets&&v.hasNonElevatedBuckets))break}}}else v.hasNonElevatedBuckets=!0},model:function(v,l,f){const _=l.getSource();if(!_.loaded())return;if(_.type==="vector"||_.type==="geojson"){const j=H_(_,v,f.style._importedAsBasemap);return void(f.modelManager&&f.modelManager.upload(f,j))}if(_.type==="batched-model"||_.type!=="model")return;const E=_.getModels();for(const j of E)j.upload(f.context)},raster:function(v,l,f){const _=l.getSource();if(!(_ instanceof ba&&_.loaded()))return;const E=v.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!E)return;const j=v.paint.get("raster-array-band")||_.getInitialBand(E);if(j==null)return;const k=l.getIds().map(L=>l.getTileByID(L));for(const L of k)L.updateNeeded(v.id,j)&&_.prepareTile(L,E,v.id,j)},"raster-particle":function(v,l,f){const _=l.getSource();if(!(_ instanceof ba&&_.loaded()))return;const E=v.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!E)return;const j=v.paint.get("raster-particle-array-band")||_.getInitialBand(E);if(j==null)return;const k=l.getIds().map(L=>l.getTileByID(L));for(const L of k)L.updateNeeded(v.id,j)&&_.prepareTile(L,E,v.id,j)}},Z_={fill:vf},Kl={fill:function(v,l,f,_){if(!f.layout||f.layout.get("fill-elevation-reference")==="none"||f.paint.get("fill-opacity").constantOr(1)===0)return;const E=v.context.gl,j=new Er(E.LEQUAL,Er.ReadOnly,v.depthRangeFor3D),k=new tn({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),L=v.transform.getFreeCameraOptions().position,B=v.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const G of _){const Z=l.getTile(G),Q=Z.getBucket(f);if(!Q)continue;const X=Q.elevatedStructures;if(!X||X.depthSegments.segments[0].primitiveLength===0)continue;const se=CA(G.toUnwrapped(),L),le=v.translatePosMatrix(G.projMatrix,Z,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor")),de=k_(le,se,0,1,0);B.draw(v,E.TRIANGLES,j,k,vn.disabled,Xr.disabled,de,f.id,X.vertexBuffer,X.indexBuffer,X.depthSegments,f.paint,v.transform.zoom)}}};class ch{constructor(l,f,_,E,j,k){this.context=new z_(l,f),this.transform=_,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=j,this._timeStamp=i.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const L=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const G of L)this._debugParams.enabledLayers[G]=!0;j.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),j.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),j.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),j.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),j.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),j.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const G of L)j.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],G);this.occlusionParams=new yR(j),this.setup(),this.numSublayers=Sc.maxUnderzooming+Sc.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.eO,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Xg(this),this._wireframeDebugCache=new LA,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const B=new i.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,B,l.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=E,this.worldview=k}updateTerrain(l,f){const _=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new sy(this,l));const E=this._terrain;this.transform.elevation=_?E:null,E.update(l,this.transform,f),this.transform.elevation&&!E.enabled&&(this.transform.elevation=null)}_updateFog(l){const f=l.fog;if(!f||this.transform.projection.name==="globe"||f.getOpacity(this.transform.pitch)<1||f.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,E]=f.getFovAdjustedRange(this.transform._fov);if(_>E)return void(this.transform.fogCullDistSq=null);const j=_+.78*(E-_);this.transform.fogCullDistSq=j*j}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(l){l&&!this._terrain&&(this._terrain=new sy(this,this.style)),this._forceTerrainMode=l}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(l,f){if(this.width=l*i.o.devicePixelRatio,this.height=f*i.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._mergedLayers[_].resize()}setup(){const l=this.context,f=new i.bc;f.emplaceBack(0,0),f.emplaceBack(i.al,0),f.emplaceBack(0,i.al),f.emplaceBack(i.al,i.al),this.tileExtentBuffer=l.createVertexBuffer(f,i.be.members),this.tileExtentSegments=i.bf.simpleSegment(0,0,4,2);const _=new i.bc;_.emplaceBack(0,0),_.emplaceBack(i.al,0),_.emplaceBack(0,i.al),_.emplaceBack(i.al,i.al),this.debugBuffer=l.createVertexBuffer(_,i.be.members),this.debugSegments=i.bf.simpleSegment(0,0,4,5);const E=new i.bc;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(-1,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,i.be.members),this.viewportSegments=i.bf.simpleSegment(0,0,4,2);const j=new i.a$;j.emplaceBack(0,0,0,0),j.emplaceBack(i.al,0,i.al,0),j.emplaceBack(0,i.al,0,i.al),j.emplaceBack(i.al,i.al,i.al,i.al),this.mercatorBoundsBuffer=l.createVertexBuffer(j,i.bh.members),this.mercatorBoundsSegments=i.bf.simpleSegment(0,0,4,2);const k=new i.b0;k.emplaceBack(0,1,2),k.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(k);const L=new i.bd;for(const G of[0,1,3,2,0])L.emplaceBack(G);this.debugIndexBuffer=l.createIndexBuffer(L),this.emptyTexture=new i.T(l,new i.q({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA8),this.identityMat=i.bB();const B=this.context.gl;this.stencilClearMode=new tn({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,l.TRIANGLES,Er.disabled,this.stencilClearMode,vn.disabled,Xr.disabled,gf(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,f,_){if(!f||this.currentStencilSource===f.id||!l.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let L=!1;for(const B of _)if(this._tileClippingMaskIDs[B.key]===void 0){L=!0;break}if(!L)return}this.currentStencilSource=f.id;const E=this.context,j=E.gl;this.nextStencilID+_.length>256&&this.clearStencil(),E.setColorMode(vn.disabled),E.setDepthMode(Er.disabled);const k=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const L of _){const B=f.getTile(L),G=this._tileClippingMaskIDs[L.key]=this.nextStencilID++,{tileBoundsBuffer:Z,tileBoundsIndexBuffer:Q,tileBoundsSegments:X}=this.getTileBoundsBuffers(B);k.draw(this,j.TRIANGLES,Er.disabled,new tn({func:j.ALWAYS,mask:0},G,255,j.KEEP,j.KEEP,j.REPLACE),vn.disabled,Xr.disabled,gf(L.projMatrix),"$clipping",Z,Q,X)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,f=this.context.gl;return new tn({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const f=this.context.gl;return new tn({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(l){const f=this.context.gl,_=l.sort((k,L)=>L.overscaledZ-k.overscaledZ),E=_[_.length-1].overscaledZ,j=_[0].overscaledZ-E+1;if(j>1){this.currentStencilSource=void 0,this.nextStencilID+j>256&&this.clearStencil();const k={};for(let L=0;L<j;L++)k[L+E]=new tn({func:f.GEQUAL,mask:255},L+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=j,[k,_]}return[{[E]:tn.disabled},_]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new vn([l.CONSTANT_COLOR,l.ONE,l.CONSTANT_COLOR,l.ONE],new i.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?vn.unblended:vn.alphaBlended}colorModeForDrapableLayerRenderPass(l){const f=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new vn([f.ONE,f.ONE_MINUS_SRC_ALPHA,f.CONSTANT_ALPHA,f.ONE_MINUS_SRC_ALPHA],new i.ao(0,0,0,l===void 0?0:l),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(l,f,_,E=!1){if(this.depthOcclusion)return new Er(this.context.gl.GREATER,Er.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!E)return Er.disabled;const j=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new Er(_||this.context.gl.LEQUAL,f,[j,j])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const l=this.context.gl,f=Math.ceil(this.width),_=Math.ceil(this.height),E=this.context.bindFramebuffer.get(),j=l.getParameter(l.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===f&&this.depthFBO.height===_||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),f!==0&&_!==0&&(this.depthFBO=new F_(this.context,f,_,!1,"texture"),this.depthTexture=new i.T(this.context,{width:f,height:_,data:null},l.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(E),l.bindTexture(l.TEXTURE_2D,j),this.depthFBO&&(l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),l.blitFramebuffer(0,0,f,_,0,0,f,_,l.DEPTH_BUFFER_BIT,l.NEAREST),l.bindFramebuffer(l.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((l,f)=>l+f/this._fpsHistory.length,0))}render(l,f){const _=i.o.now();this._dt=_-this._timeStamp,this._timeStamp=_,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=l.map.repaint,this.style=l,this.options=f;const E=this.style._mergedLayers,j=!(!this.terrain||!this.terrain.enabled),k=()=>this.style._getOrder(j).filter(mt=>{const tt=E[mt];return!(tt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[tt.type]});let L=k(),B=!1,G=!1,Z=null;for(const mt of L){const tt=E[mt];tt.type==="circle"?B=!0:tt.type==="building"?Z=tt:tt.type==="symbol"&&(tt.hasOcclusionOpacityProperties?G=!0:B=!0)}let Q=L.map(mt=>E[mt]);const X=this.style._mergedSourceCaches;this.imageManager=l.imageManager,this.modelManager=l.modelManager,this.symbolFadeChange=l.placement.symbolFadeChange(i.o.now()),this.imageManager.beginFrame();let se=0,le=!1;for(const mt in X){const tt=X[mt];tt.used&&(tt.prepare(this.context),tt.getSource().usedInConflation&&++se)}let de=!1;for(const mt of Q)mt.isHidden(this.transform.zoom)||(mt.type==="clip"&&(de=!0),this.prepareLayer(mt));const xe={},ye={},Ee={},Ne={},je={};for(const mt in X){const tt=X[mt];xe[mt]=tt.getVisibleCoordinates(),ye[mt]=xe[mt].slice().reverse(),Ee[mt]=tt.getVisibleCoordinates(!0).reverse(),Ne[mt]=tt.getShadowCasterCoordinates(),je[mt]=tt.sortCoordinatesByDistance(xe[mt])}const Ve=mt=>{const tt=this.style.getLayerSourceCache(mt);return tt&&tt.used?tt.getSource():null};if(se||de||this._clippingActiveLastFrame){const mt=[],tt=[];let It=0;for(const vt of Q)this.isSourceForClippingOrConflation(vt,Ve(vt))&&(mt.push(vt),tt.push(It)),It++;if(mt&&(de||mt.length>1)||this._clippingActiveLastFrame){de=!1;const vt=[];for(let Bt=0;Bt<mt.length;Bt++){const rr=mt[Bt],xr=tt[Bt],Wt=this.style.getLayerSourceCache(rr);if(!Wt||!Wt.used||!Wt.getSource().usedInConflation&&rr.type!=="clip"&&rr.type!=="building")continue;let Jt=i.eP,wr=i.bZ.None;const pr=[];let dr=!0;if(rr.type==="building")Jt=i.eR;else if(rr.type==="clip"){Jt=xr;for(const mr of rr.layout.get("clip-layer-types"))wr|=mr==="model"?i.bZ.Model:mr==="symbol"?i.bZ.Symbol:i.bZ.FillExtrusion;for(const mr of rr.layout.get("clip-layer-scope"))pr.push(mr);rr.isHidden(this.transform.zoom)?dr=!1:de=!0}dr&&vt.push({layer:rr.fqid,cache:Wt,order:Jt,clipMask:wr,clipScope:pr})}this.replacementSource.setSources(vt),le=!0}}this._clippingActiveLastFrame=de,le||this.replacementSource.clear(),this.conflationActive=le,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let mt=0;mt<Q.length;mt++){const tt=Q[mt],It=tt.cutoffRange();if(this.longestCutoffRange=Math.max(It,this.longestCutoffRange),It>0){const vt=Ve(tt);vt&&(this.minCutoffZoom=Math.max(vt.minzoom,this.minCutoffZoom)),tt.minzoom&&(this.minCutoffZoom=Math.max(tt.minzoom,this.minCutoffZoom))}tt.is3D(j)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=mt),this._lastOcclusionLayer=mt)}const Ie=this.style&&this.style.fog;Ie?(this._fogVisible=Ie.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ie.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Ee),this.opaquePassCutoff=0,L=k(),Q=L.map(mt=>E[mt]));const Ge=this._shadowRenderer;if(Ge){Ge.updateShadowParameters(this.transform,this.style.directionalLight);for(const mt in X)for(const tt of xe[mt]){let It={min:0,max:0};this.terrain&&(It=this.terrain.getMinMaxForTile(tt)||It),Ge.addShadowReceiver(tt.toUnwrapped(),It.min,It.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.eQ(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new ws(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const $e=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Le=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if($e&&!this._snow&&(this._snow=new A1(this)),!$e&&this._snow&&(this._snow.destroy(),delete this._snow),Le&&!this._rain&&(this._rain=new Gp(this)),!Le&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),Z){this.buildingTileBorderManager||(this.buildingTileBorderManager=new ft);const mt=this.style.getLayerSourceCache(Z);this.buildingTileBorderManager.updateBorders(mt,Z)}if(!Ht.has(this.context.gl))return;this.renderPass="offscreen";for(const mt of Q){const tt=l.getLayerSourceCache(mt);if(!mt.hasOffscreenPass()||mt.isHidden(this.transform.zoom))continue;const It=tt?ye[tt.id]:void 0;(mt.type==="custom"||mt.type==="raster"||mt.type==="raster-particle"||mt.isSky()||It&&It.length)&&this.renderLayer(this,tt,mt,It)}this.depthRangeFor3D=[0,1-(Q.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Ne)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ke=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),dt=(()=>{if(f.showOverdrawInspector)return i.ao.black;const mt=this.style.fog;if(mt&&this.transform.projection.supportsFog){const tt=this.style.getLut(mt.scope);if(!Ke){const It=mt.properties.get("color-use-theme")==="none",vt=mt.properties.get("color").toNonPremultipliedRenderColor(It?null:tt).toArray01();return new i.ao(...vt)}if(Ke){const It=mt.properties.get("space-color-use-theme")==="none",vt=mt.properties.get("space-color").toNonPremultipliedRenderColor(It?null:tt).toArray01();return new i.ao(...vt)}}return i.ao.transparent})();if(this.context.clear({color:dt,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ke&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=L.length-1;this.currentLayer>=0;this.currentLayer--){const mt=Q[this.currentLayer],tt=l.getLayerSourceCache(mt);if(mt.isSky())continue;const It=tt?(mt.is3D(j)?je:ye)[tt.id]:void 0;this._renderTileClippingMasks(mt,tt,It),this.renderLayer(this,tt,mt,It)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ke&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<L.length;this.currentLayer++){const mt=Q[this.currentLayer],tt=l.getLayerSourceCache(mt);mt.isSky()&&this.renderLayer(this,tt,mt,tt?ye[tt.id]:void 0)}function at(mt,tt){let It;return tt&&(It=(mt.type==="symbol"?Ee:mt.is3D(j)?je:ye)[tt.id]),It}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<L.length;){const mt=Q[this.currentLayer];if(mt.type==="raster"||mt.type==="raster-particle"){const tt=l.getLayerSourceCache(mt);this.renderLayer(this,tt,mt,at(mt,tt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Et=0;Ge&&(Et=Ge.getShadowCastingLayerCount());let yt=!1,Nt=-1;for(let mt=0;mt<L.length;++mt){const tt=Q[mt];tt.isHidden(this.transform.zoom)||tt.is3D(j)&&(Nt=mt)}G&&Nt===-1&&(B=!0);let Xt=!1;for(;this.currentLayer<L.length;){const mt=Q[this.currentLayer],tt=l.getLayerSourceCache(mt);if(mt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(mt)){if(mt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Xt&&mt.is3D(j)&&!j){const It=this.currentLayer,vt=Bt=>{for(this.currentLayer=0;this.currentLayer<Q.length;this.currentLayer++){const rr=Q[this.currentLayer];if(Z_[rr.type]){const xr=this.style.getLayerSourceCache(rr);Z_[rr.type](this,xr,rr,at(rr,xr),Bt)}}};vt("initialize"),vt("reset"),this.currentLayer=It,Xt=!0}if(B&&!yt&&this.terrain&&!this.transform.isOrthographic&&(yt=!0,this.blitDepth()),G&&Nt!==-1&&this.currentLayer===Nt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(mt,tt,tt?xe[tt.id]:void 0),this.renderLayer(this,tt,mt,at(mt,tt)),!this.terrain&&Ge&&Et>0&&mt.hasShadowPass()&&--Et==0){{this.clearStencil(),this.resetStencilClippingMasks();const It=this.currentLayer;for(this.currentLayer=0;this.currentLayer<Q.length;this.currentLayer++){const vt=Q[this.currentLayer];if(Kl[vt.type]){const Bt=this.style.getLayerSourceCache(vt);Kl[vt.type](this,Bt,vt,at(vt,Bt))}}this.currentLayer=It}if(Ge.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const It=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=It;this.currentLayer++){const vt=Q[this.currentLayer];if(!vt.hasLightBeamPass())continue;const Bt=l.getLayerSourceCache(vt);this.renderLayer(this,Bt,vt,Bt?ye[Bt.id]:void 0)}this.currentLayer=It,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const It=this.currentLayer;this.depthOcclusion=!0;for(const vt of this.layersWithOcclusionOpacity){this.currentLayer=vt;const Bt=Q[this.currentLayer],rr=l.getLayerSourceCache(Bt),xr=rr?ye[rr.id]:void 0;this.terrain||this._renderTileClippingMasks(Bt,rr,rr?xe[rr.id]:void 0),this.renderLayer(this,rr,Bt,xr)}this.depthOcclusion=!1,this.currentLayer=It,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let mt=null;Q.forEach(tt=>{const It=l.getLayerSourceCache(tt);It&&!tt.isHidden(this.transform.zoom)&&It.getVisibleCoordinates().length&&(!mt||mt.getSource().maxzoom<It.getSource().maxzoom)&&(mt=It)}),mt&&this.options.showTileBoundaries&&x1(this,mt,mt.getVisibleCoordinates(),i.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&x1(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(mt){const tt=mt.transform.padding;Vi(mt,mt.transform.height-(tt.top||0),3,lh),Vi(mt,tt.bottom||0,3,OA),uy(mt,tt.left||0,3,y1),uy(mt,mt.transform.width-(tt.right||0),3,v1);const It=mt.transform.centerPoint;(function(vt,Bt,rr,xr){Bp(vt,Bt-1,rr-10,2,20,xr),Bp(vt,Bt-10,rr-1,20,2,xr)})(mt,It.x,mt.transform.height-It.y,_1)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),le||(this.conflationActive=!1)}prepareLayer(l){this.gpuTimingStart(l);const{unsupportedLayers:f}=this.transform.projection,_=!f||!f.includes(l.type);if(K_[l.type]&&(_||this.terrain&&l.type==="custom")){const E=this.style.getLayerSourceCache(l);K_[l.type](l,E,this)}this.gpuTimingEnd()}renderLayer(l,f,_,E){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||_.type==="model"||_.type==="raster"||_.type==="raster-particle"||E&&E.length)&&(this.id=_.id,this.gpuTimingStart(_),l.transform.projection.unsupportedLayers&&l.transform.projection.unsupportedLayers.includes(_.type)&&(!l.terrain||_.type!=="custom")||_.type==="clip"||C1[_.type](l,f,_,E,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery,_=this.context.gl;let E=this.gpuTimers[l.id];E||(E=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:_.createQuery()}),E.calls++,_.beginQuery(f.TIME_ELAPSED_EXT,E.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,f=this.context.gl,_=f.createQuery();this.deferredRenderGpuTimeQueries.push(_),f.beginQuery(l.TIME_ELAPSED_EXT,_)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const f={};for(const _ in l){const E=l[_],j=this.context.extTimerQuery,k=j.getQueryParameter(E.query,this.context.gl.QUERY_RESULT)/1e6;j.deleteQueryEXT(E.query),f[_]=k}return f}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const f=this.context.gl;let _=0;for(const E of l)_+=f.getQueryParameter(E,f.QUERY_RESULT)/1e6,f.deleteQuery(E);return _}translatePosMatrix(l,f,_,E,j){if(!_[0]&&!_[1])return l;const k=j?E==="map"?this.transform.angle:0:E==="viewport"?-this.transform.angle:0;if(k){const G=Math.sin(k),Z=Math.cos(k);_=[_[0]*Z-_[1]*G,_[0]*G+_[1]*Z]}const L=[j?_[0]:i.ay(f,_[0],this.transform.zoom),j?_[1]:i.ay(f,_[1],this.transform.zoom),0],B=new Float32Array(16);return i.bq(B,l,L),B}saveTileTexture(l){if(l.context!==this.context)return;const f=l.size[0],_=this._tileTextures[f];_?_.push(l):this._tileTextures[f]=[l]}getTileTexture(l){const f=this._tileTextures[l];return f&&f.length>0?f.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(l,f,_){const E=_===void 0?this.terrain&&this.terrain.renderingToTexture:_,j=[];return this.style&&this.style.enable3dLights()&&(l==="globeRaster"||l==="terrainRaster"?(j.push("LIGHTING_3D_MODE"),j.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):E||j.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||j.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(j.push("TERRAIN"),this.linearFloatFilteringSupported()&&j.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&j.push("GLOBE"),!this._fogVisible||E||f!==void 0&&!f||j.push("FOG","FOG_DITHERING"),E&&j.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&j.push("OVERDRAW_INSPECTOR"),j}getOrCreateProgram(l,f){this.cache=this.cache||{};const _=f&&f.defines||[],E=f&&f.config,j=this.currentGlobalDefines(l,f&&f.overrideFog,f&&f.overrideRtt).concat(_),k=ay.cacheKey(y_[l],l,j,E);return this.cache[k]||(this.cache[k]=new ay(this.context,l,y_[l],E,hR[l],j)),this.cache[k]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(l,f){if(this.style.enable3dLights()){const _=this.style.directionalLight,E=this.style.ambientLight;if(_&&E){const j=((k,L,B)=>{const G=k.properties.get("direction"),Z=k.properties.get("color-use-theme")==="none",Q=k.properties.get("color").toNonPremultipliedRenderColor(Z?null:B.getLut(k.scope)).toArray01(),X=k.properties.get("intensity"),se=L.properties.get("color-use-theme")==="none",le=L.properties.get("color").toNonPremultipliedRenderColor(se?null:B.getLut(L.scope)).toArray01(),de=L.properties.get("intensity"),xe=[G.x,G.y,G.z],ye=i.dM(le,de),Ee=i.dM(Q,X);return{u_lighting_ambient_color:ye,u_lighting_directional_dir:xe,u_lighting_directional_color:Ee,u_ground_radiance:t1(xe,Ee,ye)}})(_,E,this.style);f.setLightsUniformValues(l,j)}}}uploadCommonUniforms(l,f,_,E,j){if(this.uploadCommonLightUniforms(l,f),this.terrain&&this.terrain.renderingToTexture)return;const k=this.style.fog;if(k){const L=k.getOpacity(this.transform.pitch),B=((G,Z,Q,X,se,le,de,xe,ye,Ee,Ne,je)=>{const Ve=G.transform,Ie=Z.properties.get("color-use-theme")==="none",Ge=Z.properties.get("color").toNonPremultipliedRenderColor(Ie?null:G.style.getLut(Z.scope)).toArray01();Ge[3]=X;const $e=G.frameCounter/1e3%1,[Le,Ke]=Z.properties.get("vertical-range");return{u_fog_matrix:Q?Ve.calculateFogTileMatrix(Q):je||G.identityMat,u_fog_range:Z.getFovAdjustedRange(Ve._fov),u_fog_color:Ge,u_fog_horizon_blend:Z.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Le,Ke),Ke],u_fog_temporal_offset:$e,u_frustum_tl:se,u_frustum_tr:le,u_frustum_br:de,u_frustum_bl:xe,u_globe_pos:ye,u_globe_radius:Ee,u_viewport:Ne,u_globe_transition:i.aj(Ve.zoom),u_is_globe:+(Ve.projection.name==="globe")}})(this,k,_,L,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.o.devicePixelRatio,this.transform.height*i.o.devicePixelRatio],E);f.setFogUniformValues(l,B)}j&&f.setCutoffUniformValues(l,j.uniformValues)}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){const l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){const l=this.context.gl,f=l.createTexture();return l.bindTexture(l.TEXTURE_2D,f),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),f}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&l.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const l=this._backgroundTiles,f=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const E of _)f[E.key]=l[E.key]||new Cu(E,512,this.transform.tileZoom,this,void 0,this.worldview);return f}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(l,f){return!(!l.is3D(!(!this.terrain||!this.terrain.enabled))||l.type!=="clip"&&l.type!=="building"&&(l.minzoom&&l.minzoom>this.transform.zoom||(this.style._clipLayerPresent||l.sourceLayer!=="building"&&l.sourceLayer!=="procedural_buildings")&&(!f||f.type!=="batched-model")))}isTileAffectedByFog(l){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let f=this._cachedTileFogOpacities[l.key];return f||(this._cachedTileFogOpacities[l.key]=f=this.style.fog.getOpacityForTile(l)),f[0]>=_t||f[1]>=_t}setupDepthForOcclusion(l,f,_){const E=this.context,j=E.gl,k=!!_;var L;_||(_={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),E.activeTexture.set(j.TEXTURE3),l&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(j.NEAREST,j.CLAMP_TO_EDGE),_.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],_.u_depth_range_unpack=[2/((L=this.depthRangeFor3D)[1]-L[0]),-1-2*L[0]/(L[1]-L[0])],_.u_occluder_half_size=.5*this.occlusionParams.occluderSize,_.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(j.NEAREST,j.CLAMP_TO_EDGE),E.activeTexture.set(j.TEXTURE0),k||f.setTerrainUniformValues(E,_)}}function wf(v,l){let f=!1,_=null;const E=()=>{_=null,f&&(v(),_=setTimeout(E,l),f=!1)};return()=>(f=!0,_||E(),_)}class X_{constructor(l){this._hashName=l&&encodeURIComponent(l),i.aX(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=wf(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const f=Y_(l);if(this._hashName){const _=this._hashName;let E=!1;const j=location.hash.slice(1).split("&").map(k=>{const L=k.split("=")[0];return L===_?(E=!0,`${L}=${f}`):k}).filter(k=>k);return E||j.push(`${_}=${f}`),`#${j.join("&")}`}return`#${f}`}_getCurrentHash(){const l=location.hash.replace("#","");if(this._hashName){let f;return l.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(f=_)}),(f&&f[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const f=this._getCurrentHash();if(f.length>=3&&!f.some(_=>isNaN(Number(_)))){const _=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(f[3]||0):l.getBearing();return l.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:_,pitch:+(f[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Y_(v,l){const f=v.getCenter(),_=Math.round(100*v.getZoom())/100,E=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),j=Math.pow(10,E),k=Math.round(f.lng*j)/j,L=Math.round(f.lat*j)/j,B=v.getBearing(),G=v.getPitch();let Z=l?`/${k}/${L}/${_}`:`${_}/${L}/${k}`;return(B||G)&&(Z+="/"+Math.round(10*B)/10),G&&(Z+=`/${Math.round(G)}`),Z}const Wp={linearity:.3,easing:i.eS(0,0,.3,1)},uh=Object.assign({deceleration:2500,maxSpeed:1400},Wp),j1=Object.assign({deceleration:20,maxSpeed:1400},Wp),Oc=Object.assign({deceleration:1e3,maxSpeed:360},Wp),P1=Object.assign({deceleration:1e3,maxSpeed:90},Wp);class J_{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.o.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,f=i.o.now();for(;l.length>0&&f-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const f={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:j}of this._inertiaBuffer)f.zoom+=j.zoomDelta||0,f.bearing+=j.bearingDelta||0,f.pitch+=j.pitchDelta||0,j.panDelta&&f.pan._add(j.panDelta),j.around&&(f.around=j.around),j.pinchAround&&(f.pinchAround=j.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,E={};if(f.pan.mag()){const j=Zp(f.pan.mag(),_,Object.assign({},uh,l||{}));E.offset=f.pan.mult(j.amount/f.pan.mag()),E.center=this._map.transform.center,Kp(E,j)}if(f.zoom){const j=Zp(f.zoom,_,j1);E.zoom=this._map.transform.zoom+j.amount,Kp(E,j)}if(f.bearing){const j=Zp(f.bearing,_,Oc);E.bearing=this._map.transform.bearing+i.aA(j.amount,-179,179),Kp(E,j)}if(f.pitch){const j=Zp(f.pitch,_,P1);E.pitch=this._map.transform.pitch+j.amount,Kp(E,j)}if(E.zoom||E.bearing){const j=f.pinchAround===void 0?f.around:f.pinchAround;E.around=j?this._map.unproject(j):this._map.getCenter()}return this.clear(),E.noMoveStart=!0,E}}function Kp(v,l){(!v.duration||v.duration<l.duration)&&(v.duration=l.duration,v.easing=l.easing)}function Zp(v,l,f){const{maxSpeed:_,linearity:E,deceleration:j}=f,k=i.aA(v*E/(l/1e3),-_,_),L=Math.abs(k)/(j*E);return{easing:f.easing,duration:1e3*L,amount:k*(L/2)}}class is extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,_,E={}){const j=ee(f.getCanvasContainer(),_),k=f.unproject(j);super(l,Object.assign({point:j,lngLat:k,originalEvent:_},E)),this._defaultPrevented=!1,this.target=f}}class Xp extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,_){const E=l==="touchend"?_.changedTouches:_.touches,j=ne(f.getCanvasContainer(),E),k=j.map(B=>f.unproject(B)),L=j.reduce((B,G,Z,Q)=>B.add(G.div(Q.length)),new i.P(0,0));super(l,{points:j,point:L,lngLats:k,lngLat:f.unproject(L),originalEvent:_}),this._defaultPrevented=!1}}class O1 extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f){super("wheel",{originalEvent:f}),this._defaultPrevented=!1}}class k1{constructor(l,f){this._map=l,this._clickTolerance=f.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new O1(this._map,l))}mousedown(l,f){return this._mousedownPos=f,this._firePreventable(new is(l.type,this._map,l))}mouseup(l){this._map.fire(new is(l.type,this._map,l))}preclick(l){const f=new MouseEvent("preclick",l);this._map.fire(new is(f.type,this._map,f))}click(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||(this.preclick(l),this._map.fire(new is(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new is(l.type,this._map,l))}mouseover(l){this._map.fire(new is(l.type,this._map,l))}mouseout(l){this._map.fire(new is(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Xp(l.type,this._map,l))}touchmove(l){this._map.fire(new Xp(l.type,this._map,l))}touchend(l){this._map.fire(new Xp(l.type,this._map,l))}touchcancel(l){this._map.fire(new Xp(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Sf{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new is(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new is("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new is(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class N1{constructor(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(z(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(l,f){if(!this._active)return;const _=f,E=this._startPos,j=this._lastPos;if(!E||!j||j.equals(_)||!this._box&&_.dist(E)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=P("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const k=Math.min(E.x,_.x),L=Math.max(E.x,_.x),B=Math.min(E.y,_.y),G=Math.max(E.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${k}px,${B}px)`,this._box.style.width=L-k+"px",this._box.style.height=G-B+"px")})}mouseupWindow(l,f){if(!this._active)return;const _=this._startPos,E=f;if(_&&l.button===0){if(this.reset(),K(),_.x!==E.x||_.y!==E.y)return this._map.fire(new i.z("boxzoomend",{originalEvent:l})),{cameraAnimation:j=>j.fitScreenCoordinates(_,E,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),$(),delete this._startPos,delete this._lastPos}_fireEvent(l,f){return this._map.fire(new i.z(l,{originalEvent:f}))}}function fy(v,l){const f={};for(let _=0;_<v.length;_++)f[v[_].identifier]=l[_];return f}class I1{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,f,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=l.timeStamp),_.length===this.numTouches&&(this.centroid=function(E){const j=new i.P(0,0);for(const k of E)j._add(k);return j.div(E.length)}(f),this.touches=fy(_,f)))}touchmove(l,f,_){if(this.aborted||!this.centroid)return;const E=fy(_,f);for(const j in this.touches){const k=E[j];(!k||k.dist(this.touches[j])>30)&&(this.aborted=!0)}}touchend(l,f,_){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const E=!this.aborted&&this.centroid;if(this.reset(),E)return E}}}class dh{constructor(l){this.singleTap=new I1(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,f,_){this.singleTap.touchstart(l,f,_)}touchmove(l,f,_){this.singleTap.touchmove(l,f,_)}touchend(l,f,_){const E=this.singleTap.touchend(l,f,_);if(E){const j=l.timeStamp-this.lastTime<500,k=!this.lastTap||this.lastTap.dist(E)<30;if(j&&k||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=E,this.count===this.numTaps)return this.reset(),E}}}class R1{constructor(){this._zoomIn=new dh({numTouches:1,numTaps:2}),this._zoomOut=new dh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,f,_){this._zoomIn.touchstart(l,f,_),this._zoomOut.touchstart(l,f,_)}touchmove(l,f,_){this._zoomIn.touchmove(l,f,_),this._zoomOut.touchmove(l,f,_)}touchend(l,f,_){const E=this._zoomIn.touchend(l,f,_),j=this._zoomOut.touchend(l,f,_);return E?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:k.getZoom()+1,around:k.unproject(E)},{originalEvent:l})}):j?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:k.getZoom()-1,around:k.unproject(j)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Q_={0:1,2:2},ex={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Yp{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,f){return!1}_move(l,f){return{}}mousedown(l,f){if(this._lastPoint)return;const _=ie(l);this._correctButton(l,_)&&(this._lastPoint=f,this._eventButton=_)}mousemoveWindow(l,f){const _=this._lastPoint;if(_){if(l.preventDefault(),this._eventButton!=null&&function(E,j){const k=Q_[j];return E.buttons===void 0||(E.buttons&k)!==k}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(_,f)}}mouseupWindow(l){this._lastPoint&&ie(l)===this._eventButton&&(this._moved&&K(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class M1 extends Yp{mousedown(l,f){super.mousedown(l,f),this._lastPoint&&(this._active=!0)}_correctButton(l,f){return f===0&&!l.ctrlKey}_move(l,f){return{around:f,panDelta:f.sub(l)}}}class tx extends Yp{constructor(l){super(l),this._pitchRotateKey=l.pitchRotateKey?ex[l.pitchRotateKey]:void 0}_correctButton(l,f){return this._pitchRotateKey?f===0&&l[this._pitchRotateKey]:f===0&&l.ctrlKey||f===2}_move(l,f){const _=.8*(f.x-l.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(l){this._pitchRotateKey||l.preventDefault()}}class D1 extends Yp{constructor(l){super(l),this._pitchRotateKey=l.pitchRotateKey?ex[l.pitchRotateKey]:void 0}_correctButton(l,f){return this._pitchRotateKey?f===0&&l[this._pitchRotateKey]:f===0&&l.ctrlKey||f===2}_move(l,f){const _=-.5*(f.y-l.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(l){this._pitchRotateKey||l.preventDefault()}}class zA{constructor(l,f){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset(),i.aX(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(l,f,_){return this._calculateTransform(l,f,_)}touchmove(l,f,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1&&!i.eT())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,f,_)}}touchend(l,f,_){this._calculateTransform(l,f,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,f,_){_.length>0&&(this._active=!0);const E=fy(_,f),j=new i.P(0,0),k=new i.P(0,0);let L=0;for(const G in E){const Z=E[G],Q=this._touches[G];Q&&(j._add(Z),k._add(Z.sub(Q)),L++,E[G]=Z)}if(this._touches=E,L<this._minTouches||!k.mag())return;const B=k.div(L);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:j.div(L),panDelta:B}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=P("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class rx{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,f,_){return{}}touchstart(l,f,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([f[0],f[1]]))}touchmove(l,f,_){const E=this._firstTwoTouches;if(!E)return;l.preventDefault();const[j,k]=E,L=py(_,f,j),B=py(_,f,k);if(!L||!B)return;const G=this._aroundCenter?null:L.add(B).div(2);return this._move([L,B],G,l)}touchend(l,f,_){if(!this._firstTwoTouches)return;const[E,j]=this._firstTwoTouches,k=py(_,f,E),L=py(_,f,j);k&&L||(this._active&&K(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function py(v,l,f){for(let _=0;_<v.length;_++)if(v[_].identifier===f)return l[_]}function L1(v,l){return Math.log2(v/l)}class BA extends rx{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,f){const _=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(L1(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:L1(this._distance,_),pinchAround:f}}}function F1(v,l){return 180*v.angleWith(l)/Math.PI}class $A extends rx{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,f){const _=this._vector;if(this._vector=l[0].sub(l[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:F1(this._vector,_),pinchAround:f}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const f=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const E=F1(l,_);return Math.abs(E)<f}}function nx(v){return Math.abs(v.y)>Math.abs(v.x)}class UA extends rx{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,nx(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,f,_){const E=this._lastPoints;if(!E)return;const j=l[0].sub(E[0]),k=l[1].sub(E[1]);return this._map._cooperativeGestures&&!i.eT()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(j,k,_.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(j.y+k.y)/2*-.5})}gestureBeginsVertically(l,f,_){if(this._valid!==void 0)return this._valid;const E=l.mag()>=2,j=f.mag()>=2;if(!E&&!j)return;if(!E||!j)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;const k=l.y>0==f.y>0;return nx(l)&&nx(f)&&k}}const VA={panStep:100,bearingStep:15,pitchStep:10};class qA{constructor(){const l=VA;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let f=0,_=0,E=0,j=0,k=0;switch(l.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:l.shiftKey?_=-1:(l.preventDefault(),j=-1);break;case 39:l.shiftKey?_=1:(l.preventDefault(),j=1);break;case 38:l.shiftKey?E=1:(l.preventDefault(),k=-1);break;case 40:l.shiftKey?E=-1:(l.preventDefault(),k=1);break;default:return}return this._rotationDisabled&&(_=0,E=0),{cameraAnimation:L=>{const B=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:HA,zoom:f?Math.round(B)+f*(l.shiftKey?2:1):B,bearing:L.getBearing()+_*this._bearingStep,pitch:L.getPitch()+E*this._pitchStep,offset:[-j*this._panStep,-k*this._panStep],center:L.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function HA(v){return v*(2-v)}const GA=4.000244140625,xR=1/450;class bR{constructor(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=xR,i.aX(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||i.eT()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let f=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const _=i.o.now(),E=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,f!==0&&f%GA==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":E>400?(this._type=null,this._lastValue=f,this._timeout=window.setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(E*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=ee(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:f,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;this._type==="wheel"&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const f=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(this._delta!==0){const G=this._type==="wheel"&&Math.abs(this._delta)>GA?this._wheelZoomRate:this._defaultZoomRate;let Z=2/(1+Math.exp(-Math.abs(this._delta*G)));this._delta<0&&Z!==0&&(Z=1/Z);const Q=f(),X=Math.pow(2,Q),se=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):X;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(se*Z))),this._type==="wheel"&&(this._startZoom=Q,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const _=typeof this._targetZoom=="number"?this._targetZoom:f(),E=this._startZoom,j=this._easing;let k,L=!1;if(this._type==="wheel"&&E&&j){const G=Math.min((i.o.now()-this._lastWheelEventTime)/200,1),Z=j(G);k=i.ak(E,_,Z),G<1?this._frameId||(this._frameId=!0):L=!0}else k=_,L=!0;this._active=!0,L&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let B=k-f();return B*this._lastDelta<0&&(B=0),{noInertia:!0,needsRenderFrame:!L,zoomDelta:B,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let f=i.eU;if(this._prevEase){const _=this._prevEase,E=(i.o.now()-_.start)/_.duration,j=_.easing(E+.01)-_.easing(E),k=.27/Math.sqrt(j*j+1e-4)*.01,L=Math.sqrt(.0729-k*k);f=i.eS(k,L,.25,1)}return this._prevEase={start:i.o.now(),duration:l,easing:f},f}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=P("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class ds{constructor(l,f){this._clickZoom=l,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class WA{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,f){return l.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(l.shiftKey?-1:1),around:_.unproject(f)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wR{constructor(){this._tap=new dh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,f,_){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=f[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(l,f,_))}touchmove(l,f,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const E=f[0],j=E.y-this._swipePoint.y;return this._swipePoint=E,l.preventDefault(),this._active=!0,{zoomDelta:j/128}}}else this._tap.touchmove(l,f,_)}touchend(l,f,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(l,f,_)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class SR{constructor(l,f,_){this._el=l,this._mousePan=f,this._touchPan=_}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ER{constructor(l,f,_){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class my{constructor(l,f,_,E){this._el=l,this._touchZoom=f,this._touchRotate=_,this._tapDragZoom=E,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const gy=v=>v.zoom||v.drag||v.pitch||v.rotate;class z1 extends i.z{}class ix{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,f){const _=i.av([],f,l);this.radius=i.ag(_[2]<0?i.eW([],_,this.constants):[_[0],_[1],0])}projectRay(l){i.eW(l,l,this.constants),i.aw(l,l),i.eX(l,l,this.constants);const f=i.c4([],l,this.radius);if(f[2]>0){const _=i.c4([],[0,0,1],i.bI(f,[0,0,1])),E=i.c4([],i.aw([],[f[0],f[1],0]),this.radius),j=i.d7([],f,i.c4([],i.av([],i.d7([],E,_),f),2));f[0]=j[0],f[1]=j[1]}return f}}function kc(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class sx{constructor(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new J_(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ix,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(f),i.aX(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[E,j,k]of this._listeners){const L=E===document?this.handleWindowEvent:this.handleEvent;E.addEventListener(j,L,k)}}destroy(){for(const[l,f,_]of this._listeners){const E=l===document?this.handleWindowEvent:this.handleEvent;l.removeEventListener(f,E,_)}}_addDefaultHandlers(l){const f=this._map,_=f.getCanvasContainer();this._add("mapEvent",new k1(f,l));const E=f.boxZoom=new N1(f,l);this._add("boxZoom",E);const j=new R1,k=new WA;f.doubleClickZoom=new ds(k,j),this._add("tapZoom",j),this._add("clickZoom",k);const L=new wR;this._add("tapDragZoom",L);const B=f.touchPitch=new UA(f);this._add("touchPitch",B);const G=new tx(l),Z=new D1(l);f.dragRotate=new ER(l,G,Z),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",Z,["mouseRotate"]);const Q=new M1(l),X=new zA(f,l);f.dragPan=new SR(_,Q,X),this._add("mousePan",Q),this._add("touchPan",X,["touchZoom","touchRotate"]);const se=new $A,le=new BA;f.touchZoomRotate=new my(_,le,se,L),this._add("touchRotate",se,["touchPan","touchZoom"]),this._add("touchZoom",le,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Sf(f));const de=f.scrollZoom=new bR(f,this);this._add("scrollZoom",de,["mousePan"]);const xe=f.keyboard=new qA;this._add("keyboard",xe);for(const ye of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[ye]&&f[ye].enable(l[ye])}_add(l,f,_){this._handlers.push({handlerName:l,handler:f,allowed:_}),this._handlersById[l]=f}stop(l){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!gy(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,f,_){for(const E in l)if(E!==_&&(!f||f.indexOf(E)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const f=[];for(const _ of l)this._el.contains(_.target)&&f.push(_);return f}handleEvent(l,f){this._updatingCamera=!0;const _=l.type==="renderFrame",E=_?void 0:l,j={needsRenderFrame:!1},k={},L={},B=l.touches?this._getMapTouches(l.touches):void 0,G=B?ne(this._el,B):_?void 0:ee(this._el,l);for(const{handlerName:X,handler:se,allowed:le}of this._handlers){if(!se.isEnabled())continue;let de;this._blockedByActive(L,le,X)?se.reset():se[f||l.type]&&(de=se[f||l.type](l,G,B),this.mergeHandlerResult(j,k,de,X,E),de&&de.needsRenderFrame&&this._triggerRenderFrame()),(de||se.isActive())&&(L[X]=se)}const Z={};for(const X in this._previousActiveHandlers)L[X]||(Z[X]=E);this._previousActiveHandlers=L,(Object.keys(Z).length||kc(j))&&(this._changes.push([j,k,Z]),this._triggerRenderFrame()),(Object.keys(L).length||kc(j))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Q}=j;Q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Q(this._map))}mergeHandlerResult(l,f,_,E,j){if(!_)return;Object.assign(l,_);const k={handlerName:E,originalEvent:_.originalEvent||j};_.zoomDelta!==void 0&&(f.zoom=k),_.panDelta!==void 0&&(f.drag=k),_.pitchDelta!==void 0&&(f.pitch=k),_.bearingDelta!==void 0&&(f.rotate=k)}_applyChanges(){const l={},f={},_={};for(const[E,j,k]of this._changes)E.panDelta&&(l.panDelta=(l.panDelta||new i.P(0,0))._add(E.panDelta)),E.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+E.zoomDelta),E.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+E.bearingDelta),E.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+E.pitchDelta),E.around!==void 0&&(l.around=E.around),E.aroundCoord!==void 0&&(l.aroundCoord=E.aroundCoord),E.pinchAround!==void 0&&(l.pinchAround=E.pinchAround),E.noInertia&&(l.noInertia=E.noInertia),Object.assign(f,j),Object.assign(_,k);this._updateMapTransform(l,f,_),this._changes=[]}_updateMapTransform(l,f,_){const E=this._map,j=E.transform,k=Ee=>[Ee.x,Ee.y,Ee.z];if((Ee=>{const Ne=this._eventsInProgress.drag;return Ne&&!this._handlersById[Ne.handlerName].isActive()})()&&!kc(l)){const Ee=j.zoom;j.cameraElevationReference="sea",this._originalZoom!=null&&j._orthographicProjectionAtLowPitch&&j.projection.name!=="globe"&&j.pitch===0?(j.cameraElevationReference="ground",j.zoom=this._originalZoom):(j.recenterOnTerrain(),j.cameraElevationReference="ground"),Ee!==j.zoom&&this._map._update(!0)}if(j._isCameraConstrained&&E._stop(!0),!kc(l))return void this._fireEvents(f,_,!0);let{panDelta:L,zoomDelta:B,bearingDelta:G,pitchDelta:Z,around:Q,aroundCoord:X,pinchAround:se}=l;j._isCameraConstrained&&(B>0&&(B=0),j._isCameraConstrained=!1),se!==void 0&&(Q=se),(B||(Ee=>f[Ee]&&!this._eventsInProgress[Ee])("drag"))&&Q&&(this._dragOrigin=k(j.pointCoordinate3D(Q)),this._originalZoom=j.zoom,this._trackingEllipsoid.setup(j._camera.position,this._dragOrigin)),j.cameraElevationReference="sea",E._stop(!0),Q=Q||E.transform.centerPoint,G&&(j.bearing+=G),Z&&(j.pitch+=Z),j._updateCameraState();const le=[0,0,0];if(L)if(j.projection.name==="mercator"){const Ee=this._trackingEllipsoid.projectRay(j.screenPointToMercatorRay(Q).dir),Ne=this._trackingEllipsoid.projectRay(j.screenPointToMercatorRay(Q.sub(L)).dir);le[0]=Ne[0]-Ee[0],le[1]=Ne[1]-Ee[1]}else{const Ee=j.pointCoordinate(Q);if(j.projection.name==="globe"){L=L.rotate(-j.angle);const Ne=j._pixelsPerMercatorPixel/j.worldSize;le[0]=-L.x*i.eV(i.a_(Ee.y))*Ne,le[1]=-L.y*i.eV(j.center.lat)*Ne}else{const Ne=j.pointCoordinate(Q.sub(L));Ee&&Ne&&(le[0]=Ne.x-Ee.x,le[1]=Ne.y-Ee.y)}}const de=j.zoom,xe=[0,0,0];if(B){const Ee=k(X||j.pointCoordinate3D(Q)),Ne={dir:i.aw([],i.av([],Ee,j._camera.position))};if(Ne.dir[2]<0){const je=j.zoomDeltaToMovement(Ee,B);i.c4(xe,Ne.dir,je)}}const ye=i.d7(le,le,xe);j._translateCameraConstrained(ye),B&&Math.abs(j.zoom-de)>1e-4&&j.recenterOnTerrain(),j.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,_,!0)}_fireEvents(l,f,_){const E=gy(this._eventsInProgress),j=gy(l),k={};for(const Z in l){const{originalEvent:Q}=l[Z];this._eventsInProgress[Z]||(k[`${Z}start`]=Q),this._eventsInProgress[Z]=l[Z]}!E&&j&&this._fireEvent("movestart",j.originalEvent);for(const Z in k)this._fireEvent(Z,k[Z]);j&&this._fireEvent("move",j.originalEvent);for(const Z in l){const{originalEvent:Q}=l[Z];this._fireEvent(Z,Q)}const L={};let B;for(const Z in this._eventsInProgress){const{handlerName:Q,originalEvent:X}=this._eventsInProgress[Z];this._handlersById[Q].isActive()||(delete this._eventsInProgress[Z],B=f[Q]||X,L[`${Z}end`]=B)}for(const Z in L)this._fireEvent(Z,L[Z]);const G=gy(this._eventsInProgress);if(_&&(E||j)&&!G){this._updatingCamera=!0;const Z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Q=X=>X!==0&&-this._bearingSnap<X&&X<this._bearingSnap;Z?(Q(Z.bearing||this._map.getBearing())&&(Z.bearing=0),this._map.easeTo(Z,{originalEvent:B})):(this._map.fire(new i.z("moveend",{originalEvent:B})),Q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,f){this._map.fire(new i.z(l,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new z1("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Bs="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Nu extends i.E{constructor(l,f){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=f.bearingSnap,this._respectPrefersReducedMotion=f.respectPrefersReducedMotion!==!1,i.aX(["_renderFrameCallback"],this)}getCenter(){return new i.aS(this.transform.center.lng,this.transform.center.lat)}setCenter(l,f){return this.jumpTo({center:l},f)}panBy(l,f,_){return l=i.P.convert(l).mult(-1),this.panTo(this.transform.center,Object.assign({offset:l},f),_)}panTo(l,f,_){return this.easeTo(Object.assign({center:l},f),_)}getZoom(){return this.transform.zoom}setZoom(l,f){return this.jumpTo({zoom:l},f),this}zoomTo(l,f,_){return this.easeTo(Object.assign({zoom:l},f),_)}zoomIn(l,f){return this.zoomTo(this.getZoom()+1,l,f),this}zoomOut(l,f){return this.zoomTo(this.getZoom()-1,l,f),this}getBearing(){return this.transform.bearing}setBearing(l,f){return this.jumpTo({bearing:l},f),this}getPadding(){return this.transform.padding}setPadding(l,f){return this.jumpTo({padding:l},f),this}rotateTo(l,f,_){return this.easeTo(Object.assign({bearing:l},f),_)}resetNorth(l,f){return this.rotateTo(0,Object.assign({duration:1e3},l),f),this}resetNorthPitch(l,f){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},l),f),this}snapToNorth(l,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,f):this}getPitch(){return this.transform.pitch}setPitch(l,f){return this.jumpTo({pitch:l},f),this}cameraForBounds(l,f){l=i.aI.convert(l);const _=f&&f.bearing||0,E=f&&f.pitch||0,j=l.getNorthWest(),k=l.getSouthEast();return this._cameraForBounds(this.transform,j,k,_,E,f)}_extendPadding(l){const f={top:0,right:0,bottom:0,left:0};return l==null?Object.assign({},f,this.transform.padding):typeof l=="number"?{top:l,bottom:l,right:l,left:l}:Object.assign({},f,l)}_extendCameraOptions(l){return(l=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=this._extendPadding(l.padding),l}_minimumAABBFrustumDistance(l,f){const _=f.max[0]-f.min[0],E=f.max[1]-f.min[1];return _/E>l.aspect?_/(2*Math.tan(.5*l.fovX)*l.aspect):E/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,f,_,E,j,k){const L=l.clone(),B=this._extendCameraOptions(k);L.bearing=E,L.pitch=j;const G=i.aS.convert(f),Z=i.aS.convert(_),Q=.5*(G.lat+Z.lat),X=.5*(G.lng+Z.lng),se=i.eY(Q,X),le=i.aw([],se),de=i.aw([],i.bH([],le,[0,1,0])),xe=i.bH([],de,le),ye=[de[0],de[1],de[2],0,xe[0],xe[1],xe[2],0,le[0],le[1],le[2],0,0,0,0,1],Ee=[se,i.eY(G.lat,G.lng),i.eY(Z.lat,G.lng),i.eY(Z.lat,Z.lng),i.eY(G.lat,Z.lng),i.eY(Q,G.lng),i.eY(Q,Z.lng),i.eY(G.lat,X),i.eY(Z.lat,X)];let Ne=i.d8.fromPoints(Ee.map(vt=>[i.bI(de,vt),i.bI(xe,vt),i.bI(le,vt)]));const je=i.af([],Ne.center,ye);i.eZ(je)===0&&i.e_(je,0,0,1),i.aw(je,je),i.c4(je,je,i.aD),L.center=i.e$(je);const Ve=L.getWorldToCameraMatrix(),Ie=i.bk(new Float64Array(16),Ve);Ne=i.d8.applyTransform(Ne,i.aB([],Ve,ye));const Ge=this._extendAABB(Ne,L,B,E);if(!Ge)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ne=Ge,i.af(je,je,Ve);const $e=.5*(Ne.max[2]-Ne.min[2]),Le=this._minimumAABBFrustumDistance(L,Ne),Ke=i.c4([],[0,0,1],$e),dt=i.d7(Ke,je,Ke),at=Le+(L.pitch===0?0:i.bF(je,dt)),Et=L.globeCenterInViewSpace,yt=i.av([],je,[Et[0],Et[1],Et[2]]);i.aw(yt,yt),i.c4(yt,yt,at);const Nt=i.d7([],je,yt);i.af(Nt,Nt,Ie);const Xt=i.eL/i.aD,mt=i.ag(Nt),tt=i.ce(Math.max(mt*Xt-i.eL,Number.EPSILON),0),It=Math.min(L.zoomFromMercatorZAdjusted(tt),B.maxZoom);return It>.5*(i.cZ+i.cK)?(L.setProjection({name:"mercator"}),L.zoom=It,this._cameraForBounds(L,f,_,E,j,k)):{center:L.center,zoom:It,bearing:E,pitch:j}}_extendAABB(l,f,_,E){const j=.5*((_.padding.left||0)+(_.padding.right||0)),k=.5*((_.padding.top||0)+(_.padding.bottom||0)),L=k,B=j,G=j,Z=k,Q=f.width-(B+G),X=f.height-(L+Z),se=i.av([],l.max,l.min),le=Math.min(Q/se[0],X/se[1]),de=Math.min(f.scaleZoom(f.scale*le),_.maxZoom);if(isNaN(de))return null;const xe=f.scale/f.zoomScale(de),ye=new i.d8([l.min[0]-B*xe,l.min[1]-Z*xe,l.min[2]],[l.max[0]+G*xe,l.max[1]+L*xe,l.max[2]]),Ee=(typeof _.offset.x=="number"&&typeof _.offset.y=="number"?new i.P(_.offset.x,_.offset.y):i.P.convert(_.offset)).rotate(-i.an(E));return ye.center[0]-=Ee.x*xe,ye.center[1]+=Ee.y*xe,ye}queryTerrainElevation(l,f){const _=this.transform.elevation;return _?(f=Object.assign({},{exaggerated:!0},f),_.getAtPoint(i.ae.fromLngLat(l),null,f.exaggerated)):null}_cameraForBounds(l,f,_,E,j,k){if(l.projection.name==="globe")return this._cameraForBoundsOnGlobe(l,f,_,E,j,k);const L=l.clone(),B=this._extendCameraOptions(k);L.bearing=E,L.pitch=j;const G=i.aS.convert(f),Z=i.aS.convert(_),Q=new i.aS(G.lng,Z.lat),X=new i.aS(Z.lng,G.lat),se=L.project(G),le=L.project(Z),de=this.queryTerrainElevation(G),xe=this.queryTerrainElevation(Z),ye=this.queryTerrainElevation(Q),Ee=this.queryTerrainElevation(X),Ne=[[se.x,se.y,Math.min(de||0,xe||0,ye||0,Ee||0)],[le.x,le.y,Math.max(de||0,xe||0,ye||0,Ee||0)]];let je=i.d8.fromPoints(Ne);const Ve=L.getWorldToCameraMatrix(),Ie=i.bk(new Float64Array(16),Ve);je=i.d8.applyTransform(je,Ve);const Ge=this._extendAABB(je,L,B,E);if(!Ge)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");je=Ge;const $e=.5*i.av([],je.max,je.min)[2],Le=this._minimumAABBFrustumDistance(L,je),Ke=[0,0,1,0];i.aC(Ke,Ke,Ve),i.f0(Ke,Ke);const dt=i.c4([],Ke,Le+$e),at=i.d7([],je.center,dt);i.af(je.center,je.center,Ie),i.af(at,at,Ie);const Et=L.unproject(new i.P(je.center[0],je.center[1])),yt=i.f1(L.projection,Et),Nt=Math.pow(2,yt),Xt=Math.min(L._zoomFromMercatorZ(at[2]*L.pixelsPerMeter*Nt/L.worldSize),B.maxZoom);return L.mercatorFromTransition&&Xt<.5*(i.cZ+i.cK)?(L.setProjection({name:"globe"}),L.zoom=Xt,this._cameraForBounds(L,f,_,E,j,k)):{center:Et,zoom:Xt,bearing:E,pitch:j}}fitBounds(l,f,_){const E=this.cameraForBounds(l,f);return this._fitInternal(E,f,_)}fitScreenCoordinates(l,f,_,E,j){const k=i.P.convert(l),L=i.P.convert(f),B=new i.P(Math.min(k.x,L.x),Math.min(k.y,L.y)),G=new i.P(Math.max(k.x,L.x),Math.max(k.y,L.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(k,L))return this;const Z=this.transform.pointLocation3D(B),Q=this.transform.pointLocation3D(G),X=this.transform.pointLocation3D(new i.P(B.x,G.y)),se=this.transform.pointLocation3D(new i.P(G.x,B.y)),le=[Math.min(Z.lng,Q.lng,X.lng,se.lng),Math.min(Z.lat,Q.lat,X.lat,se.lat)],de=[Math.max(Z.lng,Q.lng,X.lng,se.lng),Math.max(Z.lat,Q.lat,X.lat,se.lat)],xe=E&&E.pitch?E.pitch:this.getPitch(),ye=this._cameraForBounds(this.transform,le,de,_,xe,E);return this._fitInternal(ye,E,j)}_fitInternal(l,f,_){return l?(f=Object.assign(l,f)).linear?this.easeTo(f,_):this.flyTo(f,_):this}jumpTo(l,f){this.stop();const _=l.preloadOnly?this.transform.clone():this.transform;let E=!1,j=!1,k=!1;"zoom"in l&&_.zoom!==+l.zoom&&(E=!0,_.zoom=+l.zoom),l.center!==void 0&&(_.center=i.aS.convert(l.center)),"bearing"in l&&_.bearing!==+l.bearing&&(j=!0,_.bearing=+l.bearing),"pitch"in l&&_.pitch!==+l.pitch&&(k=!0,_.pitch=+l.pitch);const L=typeof l.padding=="number"?this._extendPadding(l.padding):l.padding;if(l.padding!=null&&!_.isPaddingEqual(L))if(l.retainPadding===!1){const B=_.clone();B.padding=L,_.setLocationAtPoint(_.center,B.centerPoint)}else _.padding=L;return l.preloadOnly?(this._preloadTiles(_),this):(this.fire(new i.z("movestart",f)).fire(new i.z("move",f)),E&&this.fire(new i.z("zoomstart",f)).fire(new i.z("zoom",f)).fire(new i.z("zoomend",f)),j&&this.fire(new i.z("rotatestart",f)).fire(new i.z("rotate",f)).fire(new i.z("rotateend",f)),k&&this.fire(new i.z("pitchstart",f)).fire(new i.z("pitch",f)).fire(new i.z("pitchend",f)),this.fire(new i.z("moveend",f)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(Bs),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,f){const _=this.transform;if(!_.projection.supportsFreeCamera)return i.w(Bs),this;this.stop();const E=_.zoom,j=_.pitch,k=_.bearing;_.setFreeCameraOptions(l);const L=E!==_.zoom,B=j!==_.pitch,G=k!==_.bearing;return this.fire(new i.z("movestart",f)).fire(new i.z("move",f)),L&&this.fire(new i.z("zoomstart",f)).fire(new i.z("zoom",f)).fire(new i.z("zoomend",f)),G&&this.fire(new i.z("rotatestart",f)).fire(new i.z("rotate",f)).fire(new i.z("rotateend",f)),B&&this.fire(new i.z("pitchstart",f)).fire(new i.z("pitch",f)).fire(new i.z("pitchend",f)),this.fire(new i.z("moveend",f)),this}easeTo(l,f){this._stop(!1,l.easeId),((l=Object.assign({offset:[0,0],duration:500,easing:i.eU},l)).animate===!1||this._prefersReducedMotion(l))&&(l.duration=0);const _=this.transform,E=this.getZoom(),j=this.getBearing(),k=this.getPitch(),L=this.getPadding(),B="zoom"in l?+l.zoom:E,G="bearing"in l?this._normalizeBearing(l.bearing,j):j,Z="pitch"in l?+l.pitch:k,Q=this._extendPadding(l.padding),X=i.P.convert(l.offset);let se,le,de;if(_.projection.name==="globe"){const Ke=i.ae.fromLngLat(_.center),dt=X.rotate(-_.angle);Ke.x+=dt.x/_.worldSize,Ke.y+=dt.y/_.worldSize;const at=Ke.toLngLat(),Et=i.aS.convert(l.center||at);this._normalizeCenter(Et),se=_.centerPoint.add(dt),le=new i.P(Ke.x,Ke.y).mult(_.worldSize),de=new i.P(i.aF(Et.lng),i.aJ(Et.lat)).mult(_.worldSize).sub(le)}else{se=_.centerPoint.add(X);const Ke=_.pointLocation(se),dt=i.aS.convert(l.center||Ke);this._normalizeCenter(dt),le=_.project(Ke),de=_.project(dt).sub(le)}const xe=_.zoomScale(B-E);let ye,Ee;l.around&&(ye=i.aS.convert(l.around),Ee=_.locationPoint(ye));const Ne=this._zooming||B!==E,je=this._rotating||j!==G,Ve=this._pitching||Z!==k,Ie=!_.isPaddingEqual(Q),Ge=l.retainPadding===!1?_.clone():_,$e=Ke=>dt=>{if(Ne&&(Ke.zoom=i.ak(E,B,dt)),je&&(Ke.bearing=i.ak(j,G,dt)),Ve&&(Ke.pitch=i.ak(k,Z,dt)),Ie&&(Ge.interpolatePadding(L,Q,dt),se=Ge.centerPoint.add(X)),ye)Ke.setLocationAtPoint(ye,Ee);else{const at=Ke.zoomScale(Ke.zoom-E),Et=B>E?Math.min(2,xe):Math.max(.5,xe),yt=Math.pow(Et,1-dt),Nt=Ke.unproject(le.add(de.mult(dt*yt)).mult(at));Ke.setLocationAtPoint(Ke.renderWorldCopies?Nt.wrap():Nt,se)}return l.preloadOnly||this._fireMoveEvents(f),Ke};if(l.preloadOnly){const Ke=this._emulate($e,l.duration,_);return this._preloadTiles(Ke),this}const Le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Ne,this._rotating=je,this._pitching=Ve,this._padding=Ie,this._easeId=l.easeId,this._prepareEase(f,l.noMoveStart,Le),this._ease($e(_),Ke=>{_.cameraElevationReference==="sea"&&_.recenterOnTerrain(),this._afterEase(f,Ke)},l),this}_prepareEase(l,f,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),f||_.moving||this.fire(new i.z("movestart",l)),this._zooming&&!_.zooming&&this.fire(new i.z("zoomstart",l)),this._rotating&&!_.rotating&&this.fire(new i.z("rotatestart",l)),this._pitching&&!_.pitching&&this.fire(new i.z("pitchstart",l))}_fireMoveEvents(l){this.fire(new i.z("move",l)),this._zooming&&this.fire(new i.z("zoom",l)),this._rotating&&this.fire(new i.z("rotate",l)),this._pitching&&this.fire(new i.z("pitch",l))}_afterEase(l,f){if(this._easeId&&f&&this._easeId===f)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,E=this._rotating,j=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new i.z("zoomend",l)),E&&this.fire(new i.z("rotateend",l)),j&&this.fire(new i.z("pitchend",l)),this.fire(new i.z("moveend",l))}flyTo(l,f){if(this._prefersReducedMotion(l)){const vt=i.aH(l,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(vt,f)}this.stop(),l=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:i.eU},l);const _=this.transform,E=this.getZoom(),j=this.getBearing(),k=this.getPitch(),L=this.getPadding(),B="zoom"in l?i.aA(+l.zoom,_.minZoom,_.maxZoom):E,G="bearing"in l?this._normalizeBearing(l.bearing,j):j,Z="pitch"in l?+l.pitch:k,Q=this._extendPadding(l.padding),X=_.zoomScale(B-E),se=i.P.convert(l.offset);let le=_.centerPoint.add(se);const de=_.pointLocation(le),xe=i.aS.convert(l.center||de);this._normalizeCenter(xe);const ye=_.project(de),Ee=_.project(xe).sub(ye);let Ne=l.curve;const je=Math.max(_.width,_.height),Ve=je/X,Ie=Ee.mag();if("minZoom"in l){const vt=i.aA(Math.min(l.minZoom,E,B),_.minZoom,_.maxZoom),Bt=je/_.zoomScale(vt-E);Ne=Math.sqrt(Bt/Ie*2)}const Ge=Ne*Ne;function $e(vt){const Bt=(Ve*Ve-je*je+(vt?-1:1)*Ge*Ge*Ie*Ie)/(2*(vt?Ve:je)*Ge*Ie);return Math.log(Math.sqrt(Bt*Bt+1)-Bt)}function Le(vt){return(Math.exp(vt)-Math.exp(-vt))/2}function Ke(vt){return(Math.exp(vt)+Math.exp(-vt))/2}const dt=$e(0);let at=function(vt){return Ke(dt)/Ke(dt+Ne*vt)},Et=function(vt){return je*((Ke(dt)*(Le(Bt=dt+Ne*vt)/Ke(Bt))-Le(dt))/Ge)/Ie;var Bt},yt=($e(1)-dt)/Ne;if(Math.abs(Ie)<1e-6||!isFinite(yt)){if(Math.abs(je-Ve)<1e-6)return this.easeTo(l,f);const vt=Ve<je?-1:1;yt=Math.abs(Math.log(Ve/je))/Ne,Et=function(){return 0},at=function(Bt){return Math.exp(vt*Ne*Bt)}}l.duration="duration"in l?+l.duration:1e3*yt/("screenSpeed"in l?+l.screenSpeed/Ne:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const Nt=j!==G,Xt=Z!==k,mt=!_.isPaddingEqual(Q),tt=l.retainPadding===!1?_.clone():_,It=vt=>Bt=>{const rr=Bt*yt,xr=1/at(rr);vt.zoom=Bt===1?B:E+vt.scaleZoom(xr),Nt&&(vt.bearing=i.ak(j,G,Bt)),Xt&&(vt.pitch=i.ak(k,Z,Bt)),mt&&(tt.interpolatePadding(L,Q,Bt),le=tt.centerPoint.add(se));const Wt=Bt===1?xe:vt.unproject(ye.add(Ee.mult(Et(rr))).mult(xr));return vt.setLocationAtPoint(vt.renderWorldCopies?Wt.wrap():Wt,le),vt._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(f),vt};if(l.preloadOnly){const vt=this._emulate(It,l.duration,_);return this._preloadTiles(vt),this}return this._zooming=!0,this._rotating=Nt,this._pitching=Xt,this._padding=mt,this._prepareEase(f,!1),this._ease(It(_),()=>this._afterEase(f),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(l){}_cancelRenderFrame(l){}_stop(l,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,f)}if(!l){const _=this.handlers;_&&_.stop(!1)}return this}_ease(l,f,_){_.animate===!1||_.duration===0?(l(1),f()):(this._easeStart=i.o.now(),this._easeOptions=_,this._onEaseFrame=l,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((i.o.now()-this._easeStart)/this._easeOptions.duration,1),f=this._onEaseFrame;f&&f(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,f){l=i.bS(l,-180,180);const _=Math.abs(l-f);return Math.abs(l-360-f)<_&&(l-=360),Math.abs(l+360-f)<_&&(l+=360),l}_normalizeCenter(l){const f=this.transform;if(f.maxBounds||f.projection.name!=="globe"&&!f.renderWorldCopies)return;const _=l.lng-f.center.lng;l.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(l){return this._respectPrefersReducedMotion&&i.o.prefersReducedMotion&&!(l&&l.essential)}_emulate(l,f,_){const E=Math.ceil(15*f/1e3),j=[],k=l(_.clone());for(let L=0;L<=E;L++){const B=k(L/E);j.push(B.clone())}return j}_preloadTiles(l,f){}}class Jp{constructor(l={}){this.options=l,i.aX(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const f=this.options&&this.options.compact,_=l._getUIString("AttributionControl.ToggleAttribution");this._map=l,this._container=P("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=P("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",_);const E=P("span","mapboxgl-ctrl-icon",this._compactButton);return E.setAttribute("aria-hidden","true"),E.setAttribute("title",_),this._innerContainer=P("div","mapboxgl-ctrl-attrib-inner",this._container),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(l){const _=f.reduce((E,j,k)=>(j.value&&(E+=`${j.key}=${j.value}${k<f.length-1?"&":""}`),E),"?");l.href=`${i.e.FEEDBACK_URL}/${_}#${Y_(this._map,!0)}`,l.rel="noopener nofollow"}}_updateData(l){!l||(l.dataType!=="source"||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility")&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const E=this._map.style.stylesheet;this.styleOwner=E.owner,this.styleId=E.id}const f=this._map.style._mergedSourceCaches;for(const E in f){const j=f[E];if(j.used){const k=j.getSource();k.attribution&&l.indexOf(k.attribution)<0&&l.push(k.attribution)}}l.sort((E,j)=>E.length-j.length),l=l.filter((E,j)=>{for(let k=j+1;k<l.length;k++)if(l[k].indexOf(E)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const _=l.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,l.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class yy{constructor(){i.aX(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=P("div","mapboxgl-ctrl");const f=P("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(Object.entries(l).length===0)return!0;for(const f in l){const _=l[f].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}}}class B1{constructor(){i.aX(["_onIndoorUpdate"],this)}onAdd(l){return this._map=l,this._container=P("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",f=>this._onIndoorUpdate(f)),this._container}_createButton(l,f){const _=P("button",l,this._container);return _.type="button",_.addEventListener("click",f),_}_createSeparator(){return P("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(l,f){this._map&&(l.setAttribute("aria-label",f),l.textContent=f)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(l){if(!l||!l.floors)return this._model=l,void(this._container.style.display="none");const f=this._model;this._model=l,this._container.style.display="inline-block",this._container.style.borderRadius="8px",f&&Array.from(this._container.children).forEach(_=>_.remove()),l.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(l.floors,l.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const l=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const f=this._map;this._model&&f&&f._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});P("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&l.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(l),this._createSeparator()}_updateBuildingsButtonState(){const l=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");l&&this._model&&(this._model.activeFloorsVisible?l.classList.remove("mapboxgl-ctrl-level-button-selected"):l.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(l,f){for(let _=0;_<l.length;_++){const E=l[_],j=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(E.id)});this._setButtonTitle(j,E.zIndex.toString()),this._model&&E.id===this._model.selectedFloorId&&f&&j.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(j),_<l.length-1&&this._createSeparator()}}}class KA{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f}remove(l){const f=this._currentlyRunning,_=f?this._queue.concat(f):this._queue;for(const E of _)if(E.id===l)return void(E.cancelled=!0)}run(l=0){const f=this._currentlyRunning=this._queue;this._queue=[];for(const _ of f)if(!_.cancelled&&(_.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class vy{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const f=i.dC((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-f)+this._end*f}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,f,_){this._start=this.getValue(f),this._end=l,this._startTime=f,this._endTime=f+_}}const TR={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class ZA extends i.z{constructor(l,f,_,E){const{point:j,lngLat:k,originalEvent:L,target:B}=l;super(l.type,{point:j,lngLat:k,originalEvent:L,target:B}),this.preventDefault=()=>{l.preventDefault()},this.id=f,this.interaction=_,this.feature=E}}class $1{constructor(l){this.map=l,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(l,f){if(this.typeById.has(l))throw new Error(`Interaction id "${l}" already exists.`);const _=f.filter;let E=f.type;_&&this.filters.set(l,i.b5(_)),E==="mouseover"&&(E="mouseenter"),E==="mouseout"&&(E="mouseleave");const j=this.interactionsByType.get(E)||new Map;E==="mouseenter"||E==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(l,f)):j.size===0&&this.map.on(E,this.handleType),j.size===0&&this.interactionsByType.set(E,j),j.set(l,f),this.typeById.set(l,E)}get(l){const f=this.typeById.get(l);if(!f)return;const _=this.interactionsByType.get(f);return _?_.get(l):void 0}remove(l){const f=this.typeById.get(l);if(!f)return;this.typeById.delete(l),this.filters.delete(l);const _=this.interactionsByType.get(f);_&&(_.delete(l),f==="mouseenter"||f==="mouseleave"?(this.delegatedInteractions.delete(l),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):_.size===0&&this.map.off(f,this.handleType))}queryTargets(l,f){const _=[];for(const[E,j]of f)j.target&&_.push({targetId:E,target:j.target,filter:this.filters.get(E)});return this.map.style.queryRenderedTargets(l,_,this.map.transform)}handleMove(l){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const f=this.queryTargets(l.point,Array.from(this.delegatedInteractions).reverse());f.length&&(l.type="mouseenter",this.handleType(l,f));const _=new Map;for(const[E,{feature:j}]of this.prevHoveredFeatures)this.hoveredFeatures.has(E)||_.set(j.id,j);_.size&&(l.type="mouseleave",this.handleType(l,Array.from(_.values())))}handleOut(l){const f=Array.from(this.hoveredFeatures.values()).map(({feature:_})=>_);f.length&&(l.type="mouseleave",this.handleType(l,f)),this.hoveredFeatures.clear()}handleType(l,f){const _=l.type==="mouseenter";if(_&&!this.interactionsByType.has(l.type))return void i.w("mouseenter interaction required for mouseleave to work.");const E=Array.from(this.interactionsByType.get(l.type)).reverse(),j=!!f;f=f||this.queryTargets(l.point,E);let k=!1;const L=new Set;for(const B of f){for(const[G,Z]of E){if(!Z.target)continue;const Q=B.variants?B.variants[G]:null;if(Q){for(const X of Q){if(jl(X,B,L,G))continue;const se=new i.dw(B,X),le=eu(X,B,G);j&&se.id!==void 0&&(se.state=this.map.getFeatureState(se));const de=_?this.prevHoveredFeatures.get(le):null,xe=new ZA(l,G,Z,se),ye=de?de.stop:Z.handler(xe);if(_&&this.hoveredFeatures.set(le,{feature:B,stop:ye}),ye!==!1){k=!0;break}}if(k)break}}if(k)break}if(!k)for(const[B,G]of E){const{handler:Z,target:Q}=G;if(!Q&&Z(new ZA(l,B,G,null))!==!1)break}}}function U1(v,l){if(Array.isArray(v)&&Array.isArray(l)){const f=new Set(v),_=new Set(l);return f.size===_.size&&v.every(E=>_.has(E))}return i.bx(v,l)}const ax={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},ox={showCompass:!0,showZoom:!0,visualizePitch:!1};class _y{constructor(l,f,_=!1){this._clickTolerance=10,this.element=f,this.mouseRotate=new tx({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,_&&(this.mousePitch=new D1({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),i.aX(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener("mousedown",this.mousedown),f.addEventListener("touchstart",this.touchstart,{passive:!1}),f.addEventListener("touchmove",this.touchmove),f.addEventListener("touchend",this.touchend),f.addEventListener("touchcancel",this.reset)}down(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),z()}move(l,f){const _=this.map,E=this.mouseRotate.mousemoveWindow(l,f),j=E&&E.bearingDelta;if(j&&_.setBearing(_.getBearing()+j),this.mousePitch){const k=this.mousePitch.mousemoveWindow(l,f),L=k&&k.pitchDelta;L&&_.setPitch(_.getPitch()+L)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){$(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(Object.assign({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),ee(this.element,l)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,ee(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ne(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){l.targetTouches.length!==1?this.reset():(this._lastPos=ne(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function gd(v,l,f){if(v=new i.aS(v.lng,v.lat),l){const _=new i.aS(v.lng-360,v.lat),E=new i.aS(v.lng+360,v.lat),j=360*Math.ceil(Math.abs(v.lng-f.center.lng)/360),k=f.locationPoint3D(v).distSqr(l),L=l.x<0||l.y<0||l.x>f.width||l.y>f.height;f.locationPoint3D(_).distSqr(l)<k&&(L||Math.abs(_.lng-f.center.lng)<j)?v=_:f.locationPoint3D(E).distSqr(l)<k&&(L||Math.abs(E.lng-f.center.lng)<j)&&(v=E)}for(;Math.abs(v.lng-f.center.lng)>180;){const _=f.locationPoint3D(v);if(_.x>=0&&_.y>=0&&_.x<=f.width&&_.y<=f.height)break;v.lng>f.center.lng?v.lng-=360:v.lng+=360}return v}const ru={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},bo={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class yd extends i.E{constructor(l,f){super(),(l instanceof HTMLElement||f)&&(l=Object.assign({element:l},f)),i.aX(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:_="center",color:E="#3FB1CE",scale:j=1,draggable:k=!1,clickTolerance:L=0,rotation:B=bo.rotation,rotationAlignment:G=bo.rotationAlignment,pitchAlignment:Z=bo.pitchAlignment,occludedOpacity:Q=bo.occludedOpacity,altitude:X=bo.altitude}=l||{};this._anchor=_,this._color=E,this._scale=j,this._draggable=k,this._clickTolerance=L,this._rotation=B,this._rotationAlignment=G,this._pitchAlignment=Z,this._occludedOpacity=Q,this._altitude=X,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),l&&l.element?(this._element=l.element,this._offset=i.P.convert(l&&l.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(l&&l.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",de=>{de.preventDefault()}),this._element.addEventListener("mousedown",de=>{de.preventDefault()});const se=this._element.classList;for(const de in ru)se.remove(`mapboxgl-marker-anchor-${de}`);se.add(`mapboxgl-marker-anchor-${this._anchor}`);const le=l&&l.className?l.className.trim().split(/\s+/):[];se.add(...le),this._popup=null}_createDefaultMarker(){const l=P("div"),f=I("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},l);if(this._altitude===0){const _=I("radialGradient",{id:"shadowGradient"},I("defs",{},f));I("stop",{offset:"10%","stop-opacity":.4},_),I("stop",{offset:"100%","stop-opacity":.05},_),I("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},f)}return I("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},f),I("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},f),I("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},f),l}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=i.aS.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(l){return l===this._altitude||(this._defaultMarker&&(this._altitude===0&&l!==0||this._altitude!==0&&l===0)&&(this._element=this._createDefaultMarker()),this._altitude=l||bo.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const E=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[E,-1*(38.1-13.5+E)],"bottom-right":[-E,-1*(38.1-13.5+E)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,l._marker=this,l._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const f=l.code,_=l.charCode||l.keyCode;f!=="Space"&&f!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(l){const f=l.originalEvent.target,_=this._element;this._popup&&(f===_||_.contains(f))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,f=this._pos;if(!l||!f)return!1;const _=l.unproject(f,this._altitude),E=l.getFreeCameraOptions();if(!E.position)return!1;const j=E.position.toLngLat();return j.distanceTo(_)<.9*j.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const f=this._pos;if(!f||f.x<0||f.x>l.transform.width||f.y<0||f.y>l.transform.height)return void this._clearFadeTimer();const _=l.unproject(f,this._altitude);let E;l._showingGlobe()&&i.f4(l.transform,this._lngLat)?E=0:(E=1-l._queryFogOpacity(_),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(E*=this._occludedOpacity)),this._element.style.opacity=`${E}`,this._element.style.pointerEvents=E>0?"auto":"none",this._popup&&this._popup._setOpacity(E),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const f=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${l.x}px,${l.y}px)
            ${ru[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${f.x}px,${f.y}px)
        `}_calculateXYTransform(){const l=this._pos,f=this._map,_=this.getPitchAlignment();if(!f||!l||_!=="map")return"";if(!f._showingGlobe()){const B=f.getPitch();return B?`rotateX(${B}deg)`:""}const E=i.cW(i.f5(f.transform,this._lngLat)),j=l.sub(i.f6(f.transform)),k=Math.abs(j.x)+Math.abs(j.y);if(k===0)return"";const L=E/k;return`rotateX(${-j.y*L}deg) rotateY(${j.x*L}deg)`}_calculateZTransform(){const l=this._pos,f=this._map;if(!f||!l)return"";let _=0;const E=this.getRotationAlignment();if(E==="map")if(f._showingGlobe()){const j=f.project(new i.aS(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),k=f.project(new i.aS(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(j);_=i.cW(Math.atan2(k.y,k.x))-90}else _=-f.getBearing();else if(E==="horizon"){const j=i.ah(4,6,f.getZoom()),k=i.f6(f.transform);k.y+=j*f.transform.height;const L=l.sub(k),B=i.cW(Math.atan2(L.y,L.x));_=(B>90?B-270:B+90)*(1-j)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(l){cancelAnimationFrame(this._updateFrameId);const f=this._map;f&&(f.transform.renderWorldCopies&&(this._lngLat=gd(this._lngLat,this._pos,f.transform)),this._pos=f.project(this._lngLat,this._altitude),l===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),f._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(f._showingGlobe()||f.getTerrain()||f.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=i.P.convert(l),this._update(),this}addClassName(l){return this._element.classList.add(l),this}removeClassName(l){return this._element.classList.remove(l),this}toggleClassName(l){return this._element.classList.toggle(l)}_onMove(l){const f=this._map;if(!f)return;const _=this._pointerdownPos,E=this._positionDelta;if(_&&E){if(!this._isDragging){const j=this._clickTolerance||f._clickTolerance;if(l.point.dist(_)<j)return;this._isDragging=!0}this._pos=l.point.sub(E),this._lngLat=f.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.z("dragstart"))),this.fire(new i.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.z("dragend")),this._state="inactive"}_addDragHandler(l){const f=this._map,_=this._pos;f&&_&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(_),this._pointerdownPos=l.point,this._state="pending",f.on("mousemove",this._onMove),f.on("touchmove",this._onMove),f.once("mouseup",this._onUp),f.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const f=this._map;return f&&(l?(f.on("mousedown",this._addDragHandler),f.on("touchstart",this._addDragHandler)):(f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||bo.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||bo.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||bo.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||bo.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const nu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},AR={maxWidth:100,unit:"metric"},CR={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},jR={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},PR=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function V1(v=new i.P(0,0),l="bottom"){if(typeof v=="number"){const f=Math.round(Math.sqrt(.5*Math.pow(v,2)));switch(l){case"top":return new i.P(0,v);case"top-left":return new i.P(f,f);case"top-right":return new i.P(-f,f);case"bottom":return new i.P(0,-v);case"bottom-left":return new i.P(f,-f);case"bottom-right":return new i.P(-f,-f);case"left":return new i.P(v,0);case"right":return new i.P(-v,0)}return new i.P(0,0)}return v instanceof i.P||Array.isArray(v)?i.P.convert(v):i.P.convert(v[l]||[0,0])}return{version:m,supported:O.supported,setRTLTextPlugin:i.fa,getRTLTextPluginStatus:i.f9,Map:class extends Nu{constructor(v){S.mark(y.create);const l=v;if((v=Object.assign({},ax,v)).minZoom!=null&&v.maxZoom!=null&&v.minZoom>v.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(v.minPitch!=null&&v.maxPitch!=null&&v.minPitch>v.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(v.minPitch!=null&&v.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(v.maxPitch!=null&&v.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(v.antialias&&i.f2(window)&&(v.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Tp(v.minZoom,v.maxZoom,v.minPitch,v.maxPitch,v.renderWorldCopies,null,null),v),this._repaint=!!v.repaint,this._interactive=v.interactive,this._minTileCacheSize=v.minTileCacheSize,this._maxTileCacheSize=v.maxTileCacheSize,this._failIfMajorPerformanceCaveat=v.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=v.preserveDrawingBuffer,this._antialias=v.antialias,this._trackResize=v.trackResize,this._bearingSnap=v.bearingSnap,this._refreshExpiredTiles=v.refreshExpiredTiles,this._fadeDuration=v.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=v.crossSourceCollisions,this._collectResourceTiming=v.collectResourceTiming,this._language=this._parseLanguage(v.language),this._worldview=v.worldview,this._renderTaskQueue=new KA,this._domRenderTaskQueue=new KA,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.b1(),this._locale=Object.assign({},TR,v.locale),this._clickTolerance=v.clickTolerance,this._cooperativeGestures=v.cooperativeGestures,this._performanceMetricsCollection=v.performanceMetricsCollection,this._tessellationStep=v.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=v.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new vy(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=v.scaleFactor,this._requestManager=new ue(v.transformRequest,v.accessToken,v.testMode),this._silenceAuthErrors=!!v.testMode,this._contextCreateOptions=v.contextCreateOptions?Object.assign({},v.contextCreateOptions):{},typeof v.container=="string"){const f=document.getElementById(v.container);if(!f)throw new Error(`Container '${v.container.toString()}' not found.`);this._container=f}else{if(!(v.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=v.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),v.maxBounds&&this.setMaxBounds(v.maxBounds),this._spriteFormat=v.spriteFormat,i.aX(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new vR),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new sx(this,v),this._localFontFamily=v.localFontFamily,this._localIdeographFontFamily=v.localIdeographFontFamily,(v.style||!v.testMode)&&this.setStyle(v.style||i.e.DEFAULT_STYLE,{config:v.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),v.projection&&this.setProjection(v.projection),v.hash&&(this._hash=new X_(typeof v.hash=="string"&&v.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){l.center==null&&l.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch});const f=v.bounds;f&&(this.resize(),this.fitBounds(f,Object.assign({},v.fitBoundsOptions,{duration:0})))}this.resize(),v.attributionControl&&this.addControl(new Jp({customAttribution:v.customAttribution})),this._logoControl=new yy,this.addControl(this._logoControl,v.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",f=>{this._update(f.dataType==="style"),this.fire(new i.z(`${f.dataType}data`,f))}),this.on("dataloading",f=>{this.fire(new i.z(`${f.dataType}dataloading`,f))}),this._interactions=new $1(this)}_getMapId(){return this._mapId}addControl(v,l){if(l===void 0&&(l=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new i.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=v.onAdd(this);this._controls.push(v);const _=this._controlPositions[l];return l.indexOf("bottom")!==-1?_.insertBefore(f,_.firstChild):_.appendChild(f),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new i.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(v);return l>-1&&this._controls.splice(l,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(v){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new i.z("movestart",v)).fire(new i.z("move",v)),this.fire(new i.z("resize",v)),l&&this.fire(new i.z("moveend",v)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(v){return this.transform.setMaxBounds(i.aI.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v?this.setZoom(v):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v?this.setZoom(v):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v?this.setPitch(v):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v?this.setPitch(v):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(v){return this._scaleFactor=v,this.painter.scaleFactor=v,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(l=>l.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(v){return v==="auto"?navigator.language:Array.isArray(v)?v.length===0?void 0:v.map(l=>l==="auto"?navigator.language:l):v}setLanguage(v){const l=this._parseLanguage(v);if(!this.style||l===this._language)return this;this._language=l,this.style.reloadSources();for(const f of this._controls)f._setLanguage&&f._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(v){return this.style&&v!==this._worldview?(this._worldview=v,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(v){return this._lazyInitEmptyStyle(),v?typeof v=="string"&&(v={name:v}):v=null,this._useExplicitProjection=!!v,this._prioritizeAndUpdateProjection(v,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const v=this.transform,l=v.projection.name;let f;l==="globe"&&v.zoom>=i.cK?(v.setMercatorFromTransition(),f=!0):l==="mercator"&&v.zoom<i.cK&&(v.setProjection({name:"globe"}),f=!0),f&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(v,l){return this._updateProjection(v||l||{name:"mercator"})}_updateProjection(v){let l;const f=this.transform.mercatorFromTransition;l=v.name==="globe"&&this.transform.zoom>=i.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(v),this.style.applyProjectionUpdate();const _=this.transform.getProjection().name==="mercator"&&f!==this.transform.mercatorFromTransition;return(l||_)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(v,l){return this.transform.locationPoint3D(i.aS.convert(v),l)}unproject(v,l){return this.transform.pointLocation3D(i.P.convert(v),l)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(v,l,f){const _=E=>{let j=[];if(Array.isArray(l)){const k=l.filter(L=>this.getLayer(L));j=k.length?this.queryRenderedFeatures(E,{layers:k}):[]}else j=this.queryRenderedFeatures(E,{target:l});return j};if(v==="mouseenter"||v==="mouseover"){let E=!1;return{listener:f,targets:l,delegates:{mousemove:k=>{const L=_(k.point);L.length?E||(E=!0,f.call(this,new is(v,this,k.originalEvent,{features:L}))):E=!1},mouseout:()=>{E=!1}}}}if(v==="mouseleave"||v==="mouseout"){let E=!1;return{listener:f,targets:l,delegates:{mousemove:L=>{_(L.point).length?E=!0:E&&(E=!1,f.call(this,new is(v,this,L.originalEvent)))},mouseout:L=>{E&&(E=!1,f.call(this,new is(v,this,L.originalEvent)))}}}}{const E=j=>{const k=_(j.point);k.length&&(j.features=k,f.call(this,j),delete j.features)};return{listener:f,targets:l,delegates:{[v]:E}}}}on(v,l,f){if(typeof l=="function"||f===void 0)return super.on(v,l);if(typeof l=="string"&&(l=[l]),!this._areTargetsValid(l))return this;const _=this._createDelegatedListener(v,l,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(_);for(const E in _.delegates)this.on(E,_.delegates[E]);return this}once(v,l,f){if(typeof l=="function"||f===void 0)return super.once(v,l);if(typeof l=="string"&&(l=[l]),!this._areTargetsValid(l))return this;const _=this._createDelegatedListener(v,l,f);for(const E in _.delegates)this.once(E,_.delegates[E]);return this}off(v,l,f){if(typeof l=="function"||f===void 0)return super.off(v,l);if(typeof l=="string"&&(l=[l]),!this._areTargetsValid(l))return this;const _=this._delegatedListeners?this._delegatedListeners[v]:void 0;return _&&(E=>{for(let j=0;j<E.length;j++){const k=E[j];if(k.listener===f&&U1(k.targets,l)){for(const L in k.delegates)this.off(L,k.delegates[L]);return E.splice(j,1),this}}})(_),this}queryRenderedFeatures(v,l){if(!this.style)return[];if(v===void 0||v instanceof i.P||Array.isArray(v)||l!==void 0||(l=v,v=void 0),v=v||[[0,0],[this.transform.width,this.transform.height]],!l){const j=this.style.queryRenderedFeatures(v,void 0,this.transform),k=this.style.queryRenderedFeatureset(v,void 0,this.transform);return j.concat(k)}let f=!0;if(l.target&&(f=this._isTargetValid(l.target),f&&!l.layers))return this.style.queryRenderedFeatureset(v,l,this.transform);let _=!0;if(l.layers&&Array.isArray(l.layers)){for(const j of l.layers)if(!this._isValidId(j)){_=!1;break}if(_&&!l.target)return this.style.queryRenderedFeatures(v,l,this.transform)}let E=[];return _&&(E=E.concat(this.style.queryRenderedFeatures(v,l,this.transform))),f&&(E=E.concat(this.style.queryRenderedFeatureset(v,l,this.transform))),E}querySourceFeatures(v,l){return!v||typeof v=="string"&&!this._isValidId(v)?[]:this.style.querySourceFeatures(v,l)}queryRasterValue(v,l,f){return this._isValidId(v)?this.style.queryRasterValue(v,l,f):Promise.resolve(null)}isPointOnSurface(v){const{name:l}=this.transform.projection;return l!=="globe"&&l!=="mercator"&&i.w(`${l} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(v))}addInteraction(v,l){return this._interactions.add(v,l),this}removeInteraction(v){return this._interactions.remove(v),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(v){return this._cooperativeGestures=v,this}setStyle(v,l){return l=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l),this.style&&v&&l.diff!==!1&&l.localFontFamily===this._localFontFamily&&l.localIdeographFontFamily===this._localIdeographFontFamily&&!l.config?(this.style._diffStyle(v,(f,_)=>{if(f){const E=typeof f=="string"?f:f instanceof Error?f.message:f.error;i.w(`Unable to perform style diff: ${E}. Rebuilding the style from scratch.`),this._updateStyle(v,l)}else _&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(v,l))}_getUIString(v){const l=this._locale[v];if(l==null)throw new Error(`Missing UI string '${v}'`);return l}_updateStyle(v,l){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),v){const f=Object.assign({},l);l&&l.config&&(f.initialConfig=l.config,delete f.config),this.style=new Cc(this,f).load(v),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Cc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(v){return v==null?(this.fire(new i.y(new Error("IDs can't be empty."))),!1):!i.dq(v)||(this.fire(new i.y(new Error(`IDs can't contain special symbols: "${v}".`))),!1)}_isTargetValid(v){return"featuresetId"in v?this._isValidId("importId"in v?v.importId:v.featuresetId):"layerId"in v&&this._isValidId(v.layerId)}_areTargetsValid(v){if(Array.isArray(v)){for(const l of v)if(!this._isValidId(l))return!1;return!0}return this._isTargetValid(v)}addSource(v,l){return this._isValidId(v)?(this._lazyInitEmptyStyle(),this.style.addSource(v,l),this._update(!0)):this}isSourceLoaded(v){return!!this._isValidId(v)&&!!this.style&&this.style._isSourceCacheLoaded(v)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(v,l,f){this._lazyInitEmptyStyle(),this.style.addSourceType(v,l,f)}removeSource(v){return this._isValidId(v)?(this.style.removeSource(v),this._updateTerrain(),this._update(!0)):this}getSource(v){return this._isValidId(v)?this.style.getOwnSource(v):null}addImage(v,l,{pixelRatio:f=1,sdf:_=!1,stretchX:E,stretchY:j,content:k}={}){this._lazyInitEmptyStyle();const L=i.I.from(v);if(l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap){const{width:B,height:G,data:Z}=i.o.getImageData(l);this.style.addImage(L,{data:new i.q({width:B,height:G},Z),pixelRatio:f,stretchX:E,stretchY:j,content:k,sdf:_,version:0,usvg:!1})}else if(l.width===void 0||l.height===void 0)this.fire(new i.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:B,height:G}=l,Z=l;this.style.addImage(L,{data:new i.q({width:B,height:G},new Uint8Array(Z.data)),pixelRatio:f,stretchX:E,stretchY:j,content:k,sdf:_,usvg:!1,version:0,userImage:Z}),Z.onAdd&&Z.onAdd(this,v)}}updateImage(v,l){this._lazyInitEmptyStyle();const f=i.I.from(v),_=this.style.getImage(f);if(!_)return void this.fire(new i.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const E=l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap?i.o.getImageData(l):l,{width:j,height:k,data:L}=E;if(j===void 0||k===void 0)return void this.fire(new i.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(j!==(_.usvg?_.icon.usvg_tree.width:_.data.width)||k!==(_.usvg?_.icon.usvg_tree.height:_.data.height))return void this.fire(new i.y(new Error(`The width and height of the updated image (${j}, ${k})
                must be that same as the previous version of the image
                (${_.data.width}, ${_.data.height})`)));const B=!(l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap);let G=!1;_.usvg?(_.data=new i.q({width:j,height:k},new Uint8Array(L)),_.usvg=!1,_.icon=void 0,G=!0):_.data.replace(L,B),this.style.updateImage(f,_,G)}hasImage(v){return v?!!this.style&&!!this.style.getImage(i.I.from(v)):(this.fire(new i.y(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(i.I.from(v))}loadImage(v,l){i.n(this._requestManager.transformRequest(v,i.R.Image),(f,_)=>{l(f,_ instanceof HTMLImageElement?i.o.getImageData(_):_)})}listImages(){return this.style.listImages().map(v=>v.name)}addModel(v,l){this._lazyInitEmptyStyle(),this.style.addModel(v,l)}hasModel(v){return v?this.style.hasModel(v):(this.fire(new i.y(new Error("Missing required model id"))),!1)}removeModel(v){this.style.removeModel(v)}listModels(){return this.style.listModels()}addLayer(v,l){return this._isValidId(v.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(v,l),this._update(!0)):this}getSlot(v){const l=this.getLayer(v);return l&&l.slot||null}setSlot(v,l){return this.style.setSlot(v,l),this.style.mergeLayers(),this._update(!0)}addImport(v,l){return this.style.addImport(v,l).catch(f=>this.fire(new i.y(new Error("Failed to add import",f)))),this}updateImport(v,l){return typeof l!="string"&&l.id!==v?(this.removeImport(v),this.addImport(l)):(this.style.updateImport(v,l),this._update(!0))}removeImport(v){return this.style.removeImport(v),this}moveImport(v,l){return this.style.moveImport(v,l),this._update(!0)}moveLayer(v,l){return this._isValidId(v)?(this.style.moveLayer(v,l),this._update(!0)):this}removeLayer(v){return this._isValidId(v)?(this.style.removeLayer(v),this._update(!0)):this}getLayer(v){if(!this._isValidId(v))return null;const l=this.style.getOwnLayer(v);return l?l.type==="custom"?l.implementation:l.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(v,l,f){return this._isValidId(v)?(this.style.setLayerZoomRange(v,l,f),this._update(!0)):this}setFilter(v,l,f={}){return this._isValidId(v)?(this.style.setFilter(v,l,f),this._update(!0)):this}getFilter(v){return this._isValidId(v)?this.style.getFilter(v):null}setPaintProperty(v,l,f,_={}){return this._isValidId(v)?(this.style.setPaintProperty(v,l,f,_),this._update(!0)):this}getPaintProperty(v,l){return this._isValidId(v)?this.style.getPaintProperty(v,l):null}setLayoutProperty(v,l,f,_={}){return this._isValidId(v)?(this.style.setLayoutProperty(v,l,f,_),this._update(!0)):this}getLayoutProperty(v,l){return this._isValidId(v)?this.style.getLayoutProperty(v,l):null}setLayerProperty(v,l,f,_={}){return this._isValidId(v)?(this.style.setLayerProperty(v,l,f,_),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(v){return this.style.setGlyphsUrl(v),this._update(!0)}getSchema(v){return this.style.getSchema(v)}setSchema(v,l){return this.style.setSchema(v,l),this._update(!0)}getConfig(v){return this.style.getConfig(v)}setConfig(v,l){return this.style.setConfig(v,l),this._update(!0)}getConfigProperty(v,l){return this.style.getConfigProperty(v,l)}setConfigProperty(v,l,f){return this.style.setConfigProperty(v,l,f),this._update(!0)}getFeaturesetDescriptors(v){return this.style.getFeaturesetDescriptors(v)}setLights(v){if(this._lazyInitEmptyStyle(),v&&v.length===1&&v[0].type==="flat"){const l=v[0];l.properties?this.style.setFlatLight(l.properties,l.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(v),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const v=this.style.getLights()||[];return v.length===0&&v.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),v}setLight(v,l={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:v}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(v){return this._lazyInitEmptyStyle(),!v&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(v),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(v){return this._lazyInitEmptyStyle(),this.style.setFog(v),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(v){return this._lazyInitEmptyStyle(),this.style.setSnow(v),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(v){return this._lazyInitEmptyStyle(),this.style.setRain(v),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(v){return this._lazyInitEmptyStyle(),this.style.setColorTheme(v),this._update(!0)}setImportColorTheme(v,l){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(v,l),this._update(!0)}setCamera(v){return this.style.setCamera(v),this._triggerCameraUpdate(v)}_triggerCameraUpdate(v){return this._update(this.transform.setOrthographicProjectionAtLowPitch(v["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(v){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.aS.convert(v),this.transform):0}setFeatureState(v,l){return v.source&&!this._isValidId(v.source)?this:(this.style.setFeatureState(v,l),this._update())}removeFeatureState(v,l){return v.source&&!this._isValidId(v.source)?this:(this.style.removeFeatureState(v,l),this._update())}getFeatureState(v){return v.source&&!this._isValidId(v.source)?null:this.style.getFeatureState(v)}_selectIndoorFloor(v){this.indoor.selectFloor(v)}_setIndoorActiveFloorsVisibility(v){this.indoor.setActiveFloorsVisibility(v)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new B1),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const v=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let f,_,E,j=this._container;for(;j&&(!_||!E);){const k=window.getComputedStyle(j).transform;k&&k!=="none"&&(f=k.match(/matrix.*\((.+)\)/)[1].split(", "),f[0]&&f[0]!=="0"&&f[0]!=="1"&&(_=f[0]),f[3]&&f[3]!=="0"&&f[3]!=="1"&&(E=f[3])),j=j.parentElement}this._containerWidth=_?Math.abs(v/_):v,this._containerHeight=E?Math.abs(l/E):l}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new ff(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const v=this._container;v.classList.add("mapboxgl-map"),(this._missingCSSCanary=P("div","mapboxgl-canary",v)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=P("div","mapboxgl-canvas-container",v);this._canvas=P("canvas","mapboxgl-canvas",l),this._interactive&&(l.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const f=this._controlContainer=P("div","mapboxgl-control-container",v),_=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(E=>{_[E]=P("div",`mapboxgl-ctrl-${E}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,l){const f=i.o.devicePixelRatio||1;this._canvas.width=f*Math.ceil(v),this._canvas.height=f*Math.ceil(l),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${l}px`}_addMarker(v){this._markers.push(v)}_removeMarker(v){const l=this._markers.indexOf(v);l!==-1&&this._markers.splice(l,1)}_addPopup(v){this._popups.push(v)}_removePopup(v){const l=this._popups.indexOf(v);l!==-1&&this._popups.splice(l,1)}_setupPainter(){const v=Object.assign({},O.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._canvas.getContext("webgl2",v);l?(Lt(l,!0),this.painter=new ch(l,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",f=>{f.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.k.testSupport(l)):this.fire(new i.y(new Error("Failed to initialize WebGL")))}_contextLost(v){v.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.z("webglcontextlost",{originalEvent:v}))}_contextRestored(v){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new i.z("webglcontextrestored",{originalEvent:v}))}_onMapScroll(v){if(v.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(v){return this.style?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_requestDomTask(v){!this.loaded()||this.loaded()&&!this.isMoving()?v():this._domRenderTaskQueue.add(v)}_render(v){let l;this.fire(new i.z("renderstart")),++this._frameId;const f=this.painter.context.extTimerQuery,_=i.o.now(),E=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(l=E.createQuery(),E.beginQuery(f.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(v),this._domRenderTaskQueue.run(v),this._removed)return;this._updateProjectionTransition();const j=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const G=this.transform.zoom,Z=this.transform.pitch,Q=i.o.now(),X=new i.ac(G,{now:Q,fadeDuration:j,pitch:Z,transition:this.style.transition,worldview:this._worldview});this.style.update(X)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let k=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),k=this._updateAverageElevation(_),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):k=this._updateAverageElevation(_);const L=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,j,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),L&&(this._placementDirty=L.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:j,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,S.mark(y.load),this.fire(new i.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const G=i.o.now()-_;E.endQuery(f.TIME_ELAPSED_EXT),setTimeout(()=>{const Z=E.getQueryParameter(l,E.QUERY_RESULT)/1e6;E.deleteQuery(l),this.fire(new i.z("gpu-timing-frame",{cpuTime:G,gpuTime:Z}))},50)}if(this.listens("gpu-timing-layer")){const G=this.painter.collectGpuTimers();setTimeout(()=>{const Z=this.painter.queryGpuTimers(G);this.fire(new i.z("gpu-timing-layer",{layerTimes:Z}))},50)}if(this.listens("gpu-timing-deferred-render")){const G=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const Z=this.painter.queryGpuTimeDeferredRender(G);this.fire(new i.z("gpu-timing-deferred-render",{gpuTime:Z}))},50)}const B=this._sourcesDirty||this._styleDirty||this._placementDirty||k;if(B||this._repaint)this.triggerRepaint();else{const G=this.idle();if(G&&(k=this._updateAverageElevation(_,!0)),k)this.triggerRepaint();else if(this._triggerFrame(!1),G&&(this.fire(new i.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const Z=this._calculateSpeedIndex();this.fire(new i.z("speedindexcompleted",{speedIndex:Z})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||B||(this._fullyLoaded=!0,S.mark(y.fullLoad),this._performanceMetricsCollection&&We(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(v){for(const l of this._markers)v&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!v||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(v,l=!1){const f=E=>(this.transform.averageElevation=E,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&f(0);const _=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(_||(l||v-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(v)){const E=this.transform.averageElevation;let j=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(j)?j=0:this._averageElevationLastSampledAt=v;const k=Math.abs(E-j);if(k>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(j),f(j);this._averageElevation.easeTo(j,v,300)}else if(k>1e-4)return this._averageElevation.jumpTo(j),f(j)}return!!this._averageElevation.isEasing(v)&&f(this._averageElevation.getValue(v))}_authenticate(){rt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,v=>{if(v&&(v.message===ae||v.status===401)){const l=this.painter.context.gl;Lt(l,!1),this._logoControl instanceof yy&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Je(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Pe(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&nt(this._requestManager._customAccessToken)}_updateTerrain(){const v=this._isDragging();this.painter.updateTerrain(this.style,v)}_calculateSpeedIndex(){const v=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const f=this.painter.context.gl,_=f.createFramebuffer();function E(j){f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,j,0);const k=new Uint8Array(f.drawingBufferWidth*f.drawingBufferHeight*4);return f.readPixels(0,0,f.drawingBufferWidth,f.drawingBufferHeight,f.RGBA,f.UNSIGNED_BYTE,k),k}return f.bindFramebuffer(f.FRAMEBUFFER,_),this._canvasPixelComparison(E(v),l.canvasCopies.map(E),l.timeStamps)}_canvasPixelComparison(v,l,f){let _=f[1]-f[0];const E=v.length/4;for(let j=0;j<l.length;j++){const k=l[j];let L=0;for(let B=0;B<k.length;B+=4)k[B]===v[B]&&k[B+1]===v[B+1]&&k[B+2]===v[B+2]&&k[B+3]===v[B+3]&&(L+=1);_+=(f[j+2]-f[j+1])*(1-L/E)}return _}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const v=this.painter.context.gl.getExtension("WEBGL_lose_context");v&&v.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Ht.delete(this.painter.context.gl),gt.remove(),Oe.remove(),this._removed=!0,this.fire(new i.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(v){this._renderNextFrame=this._renderNextFrame||v,this.style&&!this._frame&&(this._frame=i.o.frame(l=>{const f=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,f&&this._render(l)}))}_preloadTiles(v){const l=this.style?this.style.getSourceCaches():[];return i.bv(l,(f,_)=>f._preloadTiles(v,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(v){this._trackResize&&this.resize({originalEvent:v})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(v){this._showParseStatus!==v&&(this._showParseStatus=v,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(v){this._showTerrainWireframe!==v&&(this._showTerrainWireframe=v,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(v){this._showLayers2DWireframe!==v&&(this._showLayers2DWireframe=v,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(v){this._showLayers3DWireframe!==v&&(this._showLayers3DWireframe=v,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(v){this._speedIndexTiming!==v&&(this._speedIndexTiming=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,this._tp.refreshUI(),v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(v){this._showTileAABBs!==v&&(this._showTileAABBs=v,this._tp.refreshUI(),v&&this._update())}_setCacheLimits(v,l){i.f3(v,l)}get version(){return m}},NavigationControl:class{constructor(v={}){this.options=Object.assign({},ox,v),this._container=P("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(i.aX(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),P("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),P("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aX(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{const f=this._map;f&&(this.options.visualizePitch?f.resetNorthPitch({},{originalEvent:l}):f.resetNorth({},{originalEvent:l}))}),this._compassIcon=P("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const v=this._map;if(!v)return;const l=v.getZoom(),f=l===v.getMaxZoom(),_=l===v.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const v=this._map;if(!v)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(v.transform.pitch*(Math.PI/180)),.5)}) rotateX(${v.transform.pitch}deg) rotateZ(${v.transform.angle*(180/Math.PI)}deg)`:`rotate(${v.transform.angle*(180/Math.PI)}deg)`;v._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),v.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&v.on("pitch",this._rotateCompassArrow),v.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _y(v,this._compass,this.options.visualizePitch)),this._container}onRemove(){const v=this._map;v&&(this._container.remove(),this.options.showZoom&&v.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&v.off("pitch",this._rotateCompassArrow),v.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(v,l){const f=P("button",v,this._container);return f.type="button",f.addEventListener("click",l),f}_setButtonTitle(v,l){if(!this._map)return;const f=this._map._getUIString(`NavigationControl.${l}`);v.setAttribute("aria-label",f),v.firstElementChild&&v.firstElementChild.setAttribute("title",f)}},GeolocateControl:class extends i.E{constructor(v={}){super();const l=navigator.geolocation;this.options=Object.assign({geolocation:l},nu,v),i.aX(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=wf(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(v){return this._map=v,this._container=P("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(v){const l=(f=!!this.options.geolocation)=>{this._supportsGeolocation=f,v(f)};this._supportsGeolocation!==void 0?v(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(f=>l(f.state!=="denied")).catch(()=>l()):l()}_isOutOfMapMaxBounds(v){const l=this._map.getMaxBounds(),f=v.coords;return!!l&&(f.longitude<l.getWest()||f.longitude>l.getEast()||f.latitude<l.getSouth()||f.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(v){if(this._map){if(this._isOutOfMapMaxBounds(v))return this._setErrorState(),this.fire(new i.z("outofmaxbounds",v)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=v,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(v),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(v),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("geolocate",Object.assign({coords:v.coords,timestamp:v.timestamp},v.toJSON?{toJSON:v.toJSON.bind(v)}:{}))),this._finish()}}_updateCamera(v){const l=new i.aS(v.coords.longitude,v.coords.latitude),f=v.coords.accuracy,_=this._map.getBearing(),E=Object.assign({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(f),E,{geolocateSource:!0})}_updateMarker(v){if(v){const l=new i.aS(v.coords.longitude,v.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=v.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const v=this._map.transform,l=i.ce(1,v._center.lat)*v.worldSize,f=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(v){if(this._map){if(this.options.trackUserLocation)if(v.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(v.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("error",v)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(v){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=P("button","mapboxgl-ctrl-geolocate",this._container),P("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",v===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=P("div","mapboxgl-user-location"),this._dotElement.appendChild(P("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(P("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new yd({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=P("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new yd({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.z("trackuserlocationend")))})}}_onDeviceOrientation(v){this._userLocationDotMarker&&(v.webkitCompassHeading?this._heading=v.webkitCompassHeading:v.absolute===!0&&(this._heading=-1*v.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(v={maximumAge:6e5,timeout:0},this._noTimeout=!0):(v=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,v),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const v=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(l=>{l==="granted"&&v()}).catch(console.error):v()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Jp,ScaleControl:class{constructor(v={}){this.options=Object.assign({},AR,v),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.aX(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const v=this.options.maxWidth||100,l=this._map,f=l._containerHeight/2,_=l._containerWidth/2-v/2,E=l.unproject([_,f]),j=l.unproject([_+v,f]),k=E.distanceTo(j);if(this.options.unit==="imperial"){const L=3.2808*k;L>5280?this._setScale(v,L/5280,"mile"):this._setScale(v,L,"foot")}else this.options.unit==="nautical"?this._setScale(v,k/1852,"nautical-mile"):k>=1e3?this._setScale(v,k/1e3,"kilometer"):this._setScale(v,k,"meter")}_setScale(v,l,f){this._map._requestDomTask(()=>{const _=function(j){const k=Math.pow(10,`${Math.floor(j)}`.length-1);let L=j/k;return L=L>=10?10:L>=5?5:L>=3?3:L>=2?2:L>=1?1:function(B){const G=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*G)/G}(L),k*L}(l),E=_/l;this._container.innerHTML=this._isNumberFormatSupported&&f!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:f}).format(_):`${_}&nbsp;${CR[f]}`,this._container.style.width=v*E+"px"})}onAdd(v){return this._map=v,this._language=v.getLanguage(),this._container=P("div","mapboxgl-ctrl mapboxgl-ctrl-scale",v.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(v){this._language=v,this._update()}setUnit(v){this.options.unit=v,this._update()}},FullscreenControl:class{constructor(v={}){this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:i.w("Full screen control 'container' must be a DOM element.")),i.aX(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=P("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const v=this._fullscreenButton=P("button","mapboxgl-ctrl-fullscreen",this._controlContainer);P("span","mapboxgl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",v)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:B1,Popup:class extends i.E{constructor(v){super(),this.options=Object.assign(Object.create(jR),v),this._altitude=this.options.altitude,i.aX(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(v&&v.className?v.className.trim().split(/\s+/):[])}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&v.on("preclick",this._onClose),this.options.closeOnMove&&v.on("move",this._onClose),v.on("remove",this.remove),this._update(),v._addPopup(this),this._focusFirstElement(),this._trackPointer?(v.on("mousemove",this._onMouseEvent),v.on("mouseup",this._onMouseEvent),v._canvasContainer.classList.add("mapboxgl-track-pointer")):v.on("move",this._update),this.fire(new i.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const v=this._map;return v&&(v.off("move",this._update),v.off("move",this._onClose),v.off("preclick",this._onClose),v.off("click",this._onClose),v.off("remove",this.remove),v.off("mousemove",this._onMouseEvent),v.off("mouseup",this._onMouseEvent),v.off("drag",this._onMouseEvent),v._canvasContainer&&v._canvasContainer.classList.remove("mapboxgl-track-pointer"),v._removePopup(this),this._map=void 0),this.fire(new i.z("close")),this}getLngLat(){return this._lngLat}setLngLat(v){this._lngLat=i.aS.convert(v),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(v){return this._altitude=v,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const v=this._map;return v&&(v.off("move",this._update),v.on("mousemove",this._onMouseEvent),v.on("drag",this._onMouseEvent),v._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const l=document.createDocumentFragment(),f=document.createElement("body");let _;for(f.innerHTML=v;_=f.firstChild,_;)l.appendChild(_);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=P("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(v),this.options.closeButton){const f=this._closeButton=P("button","mapboxgl-popup-close-button",l);f.type="button",f.setAttribute("aria-label","Close popup"),f.innerHTML='<span aria-hidden="true">&#215;</span>',f.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(v){return this._classList.add(v),this._updateClassList(),this}removeClassName(v){return this._classList.delete(v),this._updateClassList(),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){let l;return this._classList.delete(v)?l=!1:(this._classList.add(v),l=!0),this._updateClassList(),l}_onMouseEvent(v){this._update(v.point)}_getAnchor(v){if(this.options.anchor)return this.options.anchor;const l=this._map,f=this._container,_=this._pos;if(!l||!f||!_)return"bottom";const E=f.offsetWidth,j=f.offsetHeight,k=_.x<E/2,L=_.x>l.transform.width-E/2;if(_.y+v<j)return k?"top-left":L?"top-right":"top";if(_.y>l.transform.height-j){if(k)return"bottom-left";if(L)return"bottom-right"}return k?"left":L?"right":"bottom"}_updateClassList(){const v=this._container;if(!v)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),v.className=l.join(" ")}_update(v){const l=this._map,f=this._content;if(!l||!this._lngLat&&!this._trackPointer||!f)return;let _=this._container;if(_||(_=this._container=P("div","mapboxgl-popup",l.getContainer()),this._tip=P("div","mapboxgl-popup-tip",_),_.appendChild(f)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=gd(this._lngLat,this._pos,l.transform)),!this._trackPointer||v){const E=this._pos=this._trackPointer&&v instanceof i.P?v:l.project(this._lngLat,this._altitude),j=V1(this.options.offset),k=this._anchor=this._getAnchor(j.y),L=V1(this.options.offset,k),B=E.add(L).round();l._requestDomTask(()=>{this._container&&k&&(this._container.style.transform=`${ru[k]} translate(${B.x}px,${B.y}px)`)})}if(!this._marker&&l._showingGlobe()){const E=i.f4(l.transform,this._lngLat)?0:1;this._setOpacity(E)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(PR);v&&v.focus()}_onClose(){this.remove()}_setOpacity(v){this._container&&(this._container.style.opacity=`${v}`),this._content&&(this._content.style.pointerEvents=v?"auto":"none")}},Marker:yd,Style:Cc,LngLat:i.aS,LngLatBounds:i.aI,Point:i.P,MercatorCoordinate:i.ae,FreeCameraOptions:Pu,Evented:i.E,config:i.e,prewarm:i.f8,clearPrewarmedResources:i.f7,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(v){i.e.ACCESS_TOKEN=v},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(v){i.e.API_URL=v},get workerCount(){return i.fh.workerCount},set workerCount(v){i.fh.workerCount=v},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(v){i.e.MAX_PARALLEL_IMAGE_REQUESTS=v},clearStorage(v){i.fg(v)},get workerUrl(){return i.ff.workerUrl},set workerUrl(v){i.ff.workerUrl=v},get workerClass(){return i.ff.workerClass},set workerClass(v){i.ff.workerClass=v},get workerParams(){return i.ff.workerParams},set workerParams(v){i.ff.workerParams=v},get dracoUrl(){return i.fe()},set dracoUrl(v){i.fd(v)},get meshoptUrl(){return i.fc()},set meshoptUrl(v){i.fb(v)},setNow:i.o.setNow,restoreNow:i.o.restoreNow}});var h=s;return h})})(Bie);var jPe=Bie.exports;const Oo=Os(jPe),Uie=({restaurants:e,onRestaurantClick:t,userLocation:r,radiusFilter:n,onMapInit:s,onMarkerClick:o,showViewDetailsButton:h=!1})=>{const{i18n:i,t:m}=ci(),y=V.useRef(null),S=V.useRef(null),b=V.useRef([]),[T,A]=V.useState(!1),O=V.useRef(null);return V.useEffect(()=>{if(!y.current||S.current)return;const P="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";Oo.accessToken=P;const I=r?[r.lng,r.lat]:[-9.1393,38.7223];return S.current=new Oo.Map({container:y.current,style:"mapbox://styles/mapbox/light-v11",center:I,zoom:13,cooperativeGestures:!0,doubleClickZoom:!1}),S.current.addControl(new Oo.NavigationControl({visualizePitch:!0}),"top-right"),S.current.on("load",()=>{A(!0),s&&S.current&&s(S.current)}),()=>{var R;b.current.forEach(M=>M.remove()),b.current=[],O.current&&(O.current.remove(),O.current=null),(R=S.current)==null||R.remove(),S.current=null,A(!1)}},[]),V.useEffect(()=>{S.current&&r&&T&&S.current.flyTo({center:[r.lng,r.lat],zoom:14,duration:1500})},[r,T]),V.useEffect(()=>{if(!S.current||!T)return;b.current.forEach(I=>I.remove()),b.current=[],O.current&&(O.current.remove(),O.current=null);let P=e;if(r&&n&&(P=e.filter(I=>D2(r.lat,r.lng,I.lat,I.lng)<=n)),P.forEach(I=>{const R=document.createElement("div");R.className="p-3 min-w-[200px]",R.innerHTML=`
        <div class="space-y-2">
          <h3 class="font-bold text-base text-foreground">${I.name}</h3>
          ${I.type&&I.type.length>0?`
            <div class="flex flex-wrap gap-1">
              ${I.type.slice(0,2).map(W=>`<span class="text-xs bg-secondary text-secondary-foreground px-2 py-0.5 rounded">${W}</span>`).join("")}
            </div>
          `:""}
          ${I.rating?`
            <div class="flex items-center gap-1">
              <span style="color: #016450;"></span>
              <span class="font-semibold text-sm">${I.rating.toFixed(1)}</span>
            </div>
          `:""}
          <p class="text-xs text-muted-foreground">${I.address}</p>
          ${h?`
            <button 
              id="view-details-${I.id}" 
              class="w-full mt-2 px-3 py-1.5 text-sm font-medium text-white rounded-md transition-colors"
              style="background-color: #016450;"
              onmouseover="this.style.opacity='0.9'"
              onmouseout="this.style.opacity='1'"
            >
              ${m("restaurants.viewDetails")}
            </button>
          `:""}
        </div>
      `;const M=new Oo.Popup({offset:25,closeButton:!0,closeOnClick:!1,closeOnMove:!1,maxWidth:"300px"}).setLngLat([I.lng,I.lat]).setDOMContent(R),F=new Oo.Marker({color:"#016450",draggable:!1}).setLngLat([I.lng,I.lat]).addTo(S.current),z=F.getElement();z.style.cursor="pointer";const $=W=>{W.stopPropagation(),W.preventDefault(),O.current&&O.current!==M&&O.current.remove(),M.addTo(S.current),O.current=M,S.current.easeTo({center:[I.lng,I.lat],zoom:17,duration:800}),o&&o(I)};z.addEventListener("click",$,!0),h&&M.on("open",()=>{const W=document.getElementById(`view-details-${I.id}`);W&&W.addEventListener("click",K=>{K.stopPropagation(),t(I)})}),M.on("close",()=>{O.current===M&&(O.current=null)}),b.current.push(F)}),P.length>0){const I=new Oo.LngLatBounds;P.forEach(R=>{I.extend([R.lng,R.lat])}),r&&I.extend([r.lng,r.lat]),S.current.fitBounds(I,{padding:50,maxZoom:15})}},[e,n,r,T,t,i.language,h,m,o]),V.useEffect(()=>{if(!S.current||!r||!T)return;const P=document.createElement("div");P.className="user-location-marker",P.style.backgroundColor="#3b82f6",P.style.width="20px",P.style.height="20px",P.style.borderRadius="50%",P.style.border="3px solid white",P.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)";const I=new Oo.Marker(P).setLngLat([r.lng,r.lat]).addTo(S.current);return()=>{I.remove()}},[r,T]),d.jsx("div",{ref:y,className:"w-full h-full rounded-lg overflow-hidden"})},xc=()=>{const{i18n:e}=ci(),t=e.language,r=(o,h)=>{let i;if(t==="zh"){const m=`${h}_zh`;i=o[m]||o[h]}else if(t==="pt"){const m=`${h}_pt`;i=o[m]||o[`${h}_en`]||o[h]}else{const m=`${h}_en`;i=o[m]||o[h]}return(h==="name"||h==="title"||h.startsWith("title_"))&&Array.isArray(i)?i.join(", "):i||""};return{getLocalizedField:r,localizeRestaurant:o=>({...o,name:r(o,"name"),type:r(o,"type"),description:r(o,"description")}),localizeActivity:o=>({...o,title:r(o,"title"),content:r(o,"content"),usage_instructions:r(o,"usage_instructions")}),currentLang:t}},Vie=e=>{if(typeof e=="string")return e;const r=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][new Date().getDay()],n=e[r];return n?n.closed?"Closed today":n.splitShift?`${n.open} - ${n.close}, ${n.open2} - ${n.close2}`:`${n.open} - ${n.close}`:"Hours not available"},RN=()=>ei({queryKey:["activities"],queryFn:async()=>{const{data:e,error:t}=await Ct.from("activities").select("*").order("pinned",{ascending:!1}).order("sort_order",{ascending:!0}).order("start_date",{ascending:!1});if(t)throw t;return await Promise.all((e||[]).map(async n=>{const{count:s}=await Ct.from("subscriptions").select("*",{count:"exact",head:!0}).eq("activity_id",n.id),{data:o}=await Ct.rpc("get_activity_creator_info",{creator_user_id:n.creator_id}),h=o;return{...n,subscriber_count:s||0,creator:{isAdmin:(h==null?void 0:h.isAdmin)??!0,restaurant:(h==null?void 0:h.restaurant)??null,avatar_url:(h==null?void 0:h.avatar_url)??null}}}))}}),PPe=e=>ei({queryKey:["activity",e],queryFn:async()=>{const{data:t,error:r}=await Ct.from("activities").select("*").eq("id",e).single();if(r)throw r;return t},enabled:!!e}),OPe=e=>ei({queryKey:["activityRestaurants",e],queryFn:async()=>{const{data:t,error:r}=await Ct.from("activity_restaurants").select("*").eq("activity_id",e);if(r)throw r;if(!t||t.length===0)return[];const n=t.map(h=>h.restaurant_id),{data:s,error:o}=await Ct.from("restaurants").select("id, name, name_en, name_pt, type, type_en, type_pt, address, image_url, rating, lat, lng").in("id",n);if(o)throw o;return t.map(h=>({...h,restaurants:(s==null?void 0:s.find(i=>i.id===h.restaurant_id))||{id:h.restaurant_id,name:"",name_en:null,name_pt:null,type:[],type_en:null,type_pt:null,address:"",image_url:null,rating:null,lat:null,lng:null}}))},enabled:!!e}),O5=()=>{const{user:e}=Kn();return ei({queryKey:["subscriptions",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ct.from("subscriptions").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});if(r)throw r;return await Promise.all((t||[]).map(async s=>{const{data:o}=await Ct.from("activities").select("*").eq("id",s.activity_id).single();return{...s,activity:o}}))},enabled:!!e})},qie=()=>{const{user:e}=Kn(),{toast:t}=Ri(),r=Mi();return Gi({mutationFn:async n=>{if(!e)throw new Error("User not authenticated");const{data:s}=await Ct.from("subscriptions").select("id").eq("activity_id",n).eq("user_id",e.id).maybeSingle();if(s){const{error:o}=await Ct.from("subscriptions").delete().eq("id",s.id);if(o)throw o;return{action:"unsubscribed"}}else{const{error:o}=await Ct.from("subscriptions").insert({activity_id:n,user_id:e.id});if(o)throw o;return{action:"subscribed"}}},onSuccess:n=>{r.invalidateQueries({queryKey:["subscriptions"]}),t({title:n.action==="subscribed"?Pr.t("toast.subscribed"):Pr.t("toast.unsubscribed"),description:n.action==="subscribed"?Pr.t("toast.subscribedDesc"):Pr.t("toast.unsubscribedDesc")})},onError:()=>{t({title:Pr.t("common.error"),description:Pr.t("toast.subscriptionFailed"),variant:"destructive"})}})},kPe=e=>ei({queryKey:["subscriberCount",e],queryFn:async()=>{const{count:t,error:r}=await Ct.from("subscriptions").select("*",{count:"exact",head:!0}).eq("activity_id",e);if(r)throw r;return t||0},enabled:!!e}),NPe=e=>ei({queryKey:["activityCreator",e],queryFn:async()=>{if(!e)return null;const{data:t}=await Ct.rpc("get_activity_creator_info",{creator_user_id:e}),r=t;return{isAdmin:(r==null?void 0:r.isAdmin)??!0,restaurant:(r==null?void 0:r.restaurant)??null,avatar_url:(r==null?void 0:r.avatar_url)??null}},enabled:!!e});function Hie({data:e,initialItemsPerPage:t=12,incrementPerPage:r=12}){const[n,s]=V.useState(t),o=(e==null?void 0:e.length)||0,h=V.useMemo(()=>e?e.slice(0,n):[],[e,n]),i=n<o,m=V.useCallback(()=>{s(S=>{const b=S+r;return Math.min(b,(e==null?void 0:e.length)||S)})},[r,e==null?void 0:e.length]),y=V.useCallback(()=>{s(t)},[t]);return{displayedData:h,hasMore:i,loadMore:m,reset:y,totalItems:o,displayedCount:n}}const IPe=({restaurant:e,language:t})=>{const[r,n]=V.useState(999),s=V.useRef(null),h=e.type.map((S,b)=>({key:`type-${b}`,label:S,variant:"secondary",color:void 0}));V.useEffect(()=>{const S=()=>{var z;if(!s.current)return;const T=s.current,A=Array.from(T.querySelectorAll(".tag-badge"));if(A.length===0){setTimeout(S,50);return}const O=(z=A[0])==null?void 0:z.offsetTop;let P=A.length;for(let $=0;$<A.length;$++)if(A[$].offsetTop>O){P=$;break}if(P===A.length){n(A.length);return}const I=T.offsetWidth,R=40;let M=0,F=P;for(let $=0;$<P;$++)M+=A[$].offsetWidth+8;M+R>I&&(F=Math.max(1,P-1)),n(F)};n(999);const b=setTimeout(S,100);return window.addEventListener("resize",S),()=>{clearTimeout(b),window.removeEventListener("resize",S)}},[h.length,e.id]);const i=h.slice(0,r),m=h.slice(r),y=m.length>0;return d.jsxs("div",{className:"flex items-center gap-2 -mt-1",children:[d.jsx("div",{ref:s,className:"flex gap-2 flex-wrap flex-1",children:i.map(S=>d.jsx(sn,{variant:S.variant,className:"text-xs whitespace-nowrap tag-badge",style:S.color?{backgroundColor:S.color,color:"white"}:void 0,children:S.label},S.key))}),y&&d.jsxs(_T,{children:[d.jsx(xT,{asChild:!0,children:d.jsx(Mt,{variant:"ghost",size:"sm",className:"h-6 px-2 text-muted-foreground hover:text-foreground flex-shrink-0",children:d.jsx(TB,{className:"h-4 w-4"})})}),d.jsx(mb,{className:"w-auto max-w-80",children:d.jsx("div",{className:"flex flex-wrap gap-2",children:m.map(S=>d.jsx(sn,{variant:S.variant,className:"text-xs",style:S.color?{backgroundColor:S.color,color:"white"}:void 0,children:S.label},S.key))})})]})]})},RPe=()=>{const e=Jc(),{t,i18n:r}=ci(),{toast:n}=Ri(),{localizeRestaurant:s}=xc(),[o,h]=V.useState(""),[i,m]=V.useState([]),[y,S]=V.useState(null),[b,T]=V.useState([]),[A,O]=V.useState("list"),[P,I]=V.useState(null),[R,M]=V.useState(null),[F,z]=V.useState(!1),[$,W]=V.useState(!1),[K,ee]=V.useState(!1),{user:ne}=Kn(),{data:ie,isLoading:re}=P5(o,i.length>0?i.join(","):void 0),{data:te=[]}=Die(),{data:ae=[]}=Fie(),{data:ue=[]}=RN(),be=Lie(),we=(We,gt)=>{gt.preventDefault(),gt.stopPropagation(),ne&&be.mutate(We)},Ce=We=>{m(gt=>gt.includes(We)?gt.filter(rt=>rt!==We):[...gt,We])},_e=async()=>{try{const We=await IN();M({lat:We.coords.latitude,lng:We.coords.longitude}),z(!0),n({title:t("restaurants.locationEnabled"),description:t("restaurants.sortByDistance")})}catch{}},me=We=>{I(We),We&&!R&&_e()},Ae=async We=>{if(y===We)S(null),T([]);else{S(We);const{data:gt,error:rt}=await Ct.from("activity_restaurants").select("restaurant_id").eq("activity_id",We);rt?(console.error("Error fetching activity restaurants:",rt),T([])):T(gt.map(Ht=>Ht.restaurant_id))}},ge=(ie==null?void 0:ie.map(We=>{const gt=s(We);if(R){const rt=D2(R.lat,R.lng,We.lat,We.lng);return{...gt,distance:rt}}return gt}))||[],pe=y&&b.length>0?ge.filter(We=>b.includes(We.id)):ge,Oe=P&&R?pe.filter(We=>We.distance&&We.distance<=P):pe,Je=F&&R?[...Oe].sort((We,gt)=>(We.distance||0)-(gt.distance||0)):Oe,{displayedData:Ze,hasMore:Pe,loadMore:Be,reset:nt}=Hie({data:Je,initialItemsPerPage:12,incrementPerPage:12});V.useEffect(()=>{nt()},[o,i,y,P,F,nt]);const Me=We=>{e(`/restaurant/${We.id}`)};return d.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4 animate-fade-in",children:d.jsxs("div",{className:"container mx-auto max-w-7xl",children:[d.jsxs("div",{className:"mb-8",children:[d.jsx("h1",{className:"text-4xl font-bold mb-4 text-foreground",children:t("restaurants.title")}),d.jsx("div",{className:"flex flex-col gap-4",children:d.jsxs("div",{className:"flex flex-col md:flex-row gap-4 md:items-center",children:[d.jsx(cr,{placeholder:t("restaurants.search"),value:o,onChange:We=>h(We.target.value),className:"w-full md:max-w-md"}),d.jsxs("div",{className:"flex gap-2 items-center",children:[d.jsx(Mt,{variant:A==="list"?"default":"outline",size:"icon",onClick:()=>O("list"),title:t("restaurants.listView"),className:"flex-shrink-0",children:d.jsx(PQ,{className:"w-4 h-4"})}),d.jsx(Mt,{variant:A==="map"?"default":"outline",size:"icon",onClick:()=>O("map"),title:t("restaurants.mapView"),className:"flex-shrink-0",children:d.jsx(kQ,{className:"w-4 h-4"})}),d.jsxs(_T,{children:[d.jsx(xT,{asChild:!0,children:d.jsxs(Mt,{variant:i.length>0||y||P?"default":"outline",size:"icon",className:"flex-shrink-0 relative",title:t("restaurants.filter"),children:[d.jsx(rN,{className:"w-4 h-4"}),(i.length>0||y||P)&&d.jsx(sn,{variant:"secondary",className:"absolute -top-1 -right-1 h-5 w-5 p-0 flex items-center justify-center text-xs",children:(i.length>0?1:0)+(y?1:0)+(P?1:0)})]})}),d.jsx(mb,{className:"w-[90vw] max-w-sm p-0",align:"start",children:d.jsxs("div",{className:"flex flex-col",children:[d.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border/50 bg-muted/30",children:[d.jsx("span",{className:"font-semibold text-foreground text-base",children:t("restaurants.filter")}),(i.length>0||y||P)&&d.jsxs(Mt,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>{m([]),S(null),T([]),I(null)},children:[d.jsx(Xc,{className:"w-3 h-3 mr-1"}),t("common.actions.clearFilter")]})]}),d.jsxs("div",{className:"p-4 space-y-5",children:[d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:t("restaurants.restaurantTypes")}),ae.length>8&&d.jsx(Mt,{variant:"link",size:"sm",className:"h-auto p-0 text-xs text-primary hover:text-primary/80",onClick:()=>W(!$),children:t($?"common.showLess":"common.showMore")})]}),d.jsx("div",{className:"flex gap-2 flex-wrap max-h-36 overflow-y-auto pr-1",children:($?ae:ae.slice(0,8)).map(We=>d.jsx(sn,{variant:i.includes(We)?"default":"outline",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs font-normal whitespace-nowrap hover:bg-primary/10 ${i.includes(We)?"bg-primary text-primary-foreground shadow-sm":"bg-background hover:border-primary/50"}`,onClick:()=>Ce(We),children:We},We))})]}),ue.length>0&&d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:t("nav.activities")}),ue.length>8&&d.jsx(Mt,{variant:"link",size:"sm",className:"h-auto p-0 text-xs text-primary hover:text-primary/80",onClick:()=>ee(!K),children:t(K?"common.showLess":"common.showMore")})]}),d.jsx("div",{className:"flex gap-2 flex-wrap max-h-36 overflow-y-auto pr-1",children:(K?ue:ue.slice(0,8)).map(We=>{const gt=r.language==="zh"?We.badge_text_zh||We.title_zh:r.language==="pt"?We.badge_text_pt||We.title_pt:We.badge_text_en||We.title_en;return d.jsx(sn,{variant:y===We.id?"default":"outline",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs font-normal whitespace-nowrap hover:bg-primary/10 ${y===We.id?"bg-primary text-primary-foreground shadow-sm":"bg-background hover:border-primary/50"}`,onClick:()=>Ae(We.id),children:gt},We.id)})})]}),d.jsxs("div",{className:"space-y-3",children:[d.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:t("restaurants.radius")}),d.jsx("div",{className:"flex gap-2 flex-wrap",children:[{value:null,label:t("restaurants.allRestaurants")},{value:5,label:t("restaurants.radius5km")},{value:10,label:t("restaurants.radius10km")},{value:20,label:t("restaurants.radius20km")}].map(We=>d.jsx(sn,{variant:P===We.value?"default":"outline",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs font-normal whitespace-nowrap hover:bg-primary/10 ${P===We.value?"bg-primary text-primary-foreground shadow-sm":"bg-background hover:border-primary/50"}`,onClick:()=>me(We.value),children:We.label},We.value??"all"))})]})]})]})})]}),R?d.jsx(Mt,{variant:F?"default":"outline",onClick:()=>z(!F),className:"flex-shrink-0 whitespace-nowrap",children:t("restaurants.sortByDistance")}):d.jsxs(Mt,{variant:"outline",onClick:_e,className:"flex-shrink-0 whitespace-nowrap",children:[d.jsx(Gu,{className:"w-4 h-4 md:mr-2"}),d.jsx("span",{className:"hidden md:inline",children:t("restaurants.getLocation")})]})]})]})})]}),re&&d.jsx("div",{className:"flex justify-center items-center py-20",children:d.jsx(_a,{className:"w-8 h-8 animate-spin text-primary"})}),!re&&Je&&Je.length===0&&d.jsxs("div",{className:"text-center py-20",children:[d.jsx("p",{className:"text-xl text-muted-foreground",children:t("restaurants.noResults")}),d.jsx("p",{className:"text-muted-foreground mt-2",children:t("restaurants.noResultsDesc")})]}),!re&&A==="map"&&Je&&Je.length>0&&d.jsx("div",{className:"h-[400px] md:h-[500px] lg:h-[600px] xl:h-[700px] rounded-lg overflow-hidden shadow-lg",children:d.jsx(Uie,{restaurants:Je,onRestaurantClick:Me,userLocation:R,radiusFilter:P,showViewDetailsButton:!0})}),!re&&A==="list"&&Je&&Je.length>0&&d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:Ze.map(We=>{var gt;return d.jsxs(Nr,{className:"overflow-hidden hover:shadow-large transition-shadow flex flex-col h-full",children:[d.jsxs("div",{className:"relative h-48 overflow-hidden",children:[d.jsx("img",{src:We.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=600&q=80",alt:We.name,className:"w-full h-full object-cover transition-transform hover:scale-105"}),ne&&d.jsx(Mt,{size:"icon",variant:"secondary",className:"absolute top-3 right-3",onClick:rt=>we(We.id,rt),children:d.jsx(HP,{className:`w-5 h-5 ${te.includes(We.id)?"fill-destructive text-destructive":""}`})})]}),d.jsx(Rn,{className:"mb-px pb-[15px]",children:d.jsxs("div",{className:"flex items-start justify-between",children:[d.jsxs("div",{className:"flex flex-col gap-2",children:[d.jsx("h3",{className:"text-xl font-semibold text-card-foreground",children:We.name}),We.distance!==void 0&&d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx(Gu,{className:"w-4 h-4 text-primary"}),d.jsxs("span",{className:"font-semibold text-sm text-foreground",children:[We.distance.toFixed(1)," km"]})]})]}),d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx(Al,{className:"w-5 h-5 fill-accent text-accent"}),d.jsx("span",{className:"font-semibold text-card-foreground",children:((gt=We.rating)==null?void 0:gt.toFixed(1))||"0.0"})]})]})}),d.jsxs(Mr,{className:"space-y-2 flex-grow",children:[d.jsx(IPe,{restaurant:We,language:r.language}),d.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[d.jsx(Pa,{className:"w-4 h-4 flex-shrink-0"}),d.jsx("span",{className:"line-clamp-1",children:We.address})]}),We.phone&&d.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[d.jsx(Jb,{className:"w-4 h-4 flex-shrink-0"}),d.jsx("span",{children:We.phone})]}),We.opening_hours&&d.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[d.jsx(Kv,{className:"w-4 h-4 flex-shrink-0"}),d.jsx("span",{children:Vie(We.opening_hours)})]})]}),d.jsxs(kN,{className:"gap-2 mt-auto",children:[d.jsx(Mt,{asChild:!0,className:"flex-1",children:d.jsx(ji,{to:`/restaurant/${We.id}`,children:t("restaurants.viewDetails")})}),R&&d.jsx(Mt,{variant:"outline",size:"icon",onClick:()=>zie(We.lat,We.lng,We.name),title:t("restaurants.directions"),children:d.jsx(Gu,{className:"w-4 h-4"})})]})]},We.id)})}),Pe&&d.jsx("div",{className:"flex justify-center mt-8",children:d.jsxs(Mt,{onClick:Be,size:"lg",variant:"outline",children:[t("common.loadMore")," (",Ze.length," / ",Je.length,")"]})})]})]})})};var MPe="Separator",SG="horizontal",DPe=["horizontal","vertical"],Gie=V.forwardRef((e,t)=>{const{decorative:r,orientation:n=SG,...s}=e,o=LPe(n)?n:SG,i=r?{role:"none"}:{"aria-orientation":o==="vertical"?o:void 0,role:"separator"};return d.jsx(ln.div,{"data-orientation":o,...i,...s,ref:t})});Gie.displayName=MPe;function LPe(e){return DPe.includes(e)}var Wie=Gie;const El=V.forwardRef(({className:e,orientation:t="horizontal",decorative:r=!0,...n},s)=>d.jsx(Wie,{ref:s,decorative:r,orientation:t,className:fr("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...n}));El.displayName=Wie.displayName;var MN="Collapsible",[FPe,ust]=Mo(MN),[zPe,k5]=FPe(MN),Kie=V.forwardRef((e,t)=>{const{__scopeCollapsible:r,open:n,defaultOpen:s,disabled:o,onOpenChange:h,...i}=e,[m,y]=Zc({prop:n,defaultProp:s??!1,onChange:h,caller:MN});return d.jsx(zPe,{scope:r,disabled:o,contentId:_u(),open:m,onOpenToggle:V.useCallback(()=>y(S=>!S),[y]),children:d.jsx(ln.div,{"data-state":I5(m),"data-disabled":o?"":void 0,...i,ref:t})})});Kie.displayName=MN;var Zie="CollapsibleTrigger",Xie=V.forwardRef((e,t)=>{const{__scopeCollapsible:r,...n}=e,s=k5(Zie,r);return d.jsx(ln.button,{type:"button","aria-controls":s.contentId,"aria-expanded":s.open||!1,"data-state":I5(s.open),"data-disabled":s.disabled?"":void 0,disabled:s.disabled,...n,ref:t,onClick:Ir(e.onClick,s.onOpenToggle)})});Xie.displayName=Zie;var N5="CollapsibleContent",Yie=V.forwardRef((e,t)=>{const{forceMount:r,...n}=e,s=k5(N5,e.__scopeCollapsible);return d.jsx(Do,{present:r||s.open,children:({present:o})=>d.jsx(BPe,{...n,ref:t,present:o})})});Yie.displayName=N5;var BPe=V.forwardRef((e,t)=>{const{__scopeCollapsible:r,present:n,children:s,...o}=e,h=k5(N5,r),[i,m]=V.useState(n),y=V.useRef(null),S=Un(t,y),b=V.useRef(0),T=b.current,A=V.useRef(0),O=A.current,P=h.open||i,I=V.useRef(P),R=V.useRef(void 0);return V.useEffect(()=>{const M=requestAnimationFrame(()=>I.current=!1);return()=>cancelAnimationFrame(M)},[]),io(()=>{const M=y.current;if(M){R.current=R.current||{transitionDuration:M.style.transitionDuration,animationName:M.style.animationName},M.style.transitionDuration="0s",M.style.animationName="none";const F=M.getBoundingClientRect();b.current=F.height,A.current=F.width,I.current||(M.style.transitionDuration=R.current.transitionDuration,M.style.animationName=R.current.animationName),m(n)}},[h.open,n]),d.jsx(ln.div,{"data-state":I5(h.open),"data-disabled":h.disabled?"":void 0,id:h.contentId,hidden:!P,...o,ref:S,style:{"--radix-collapsible-content-height":T?`${T}px`:void 0,"--radix-collapsible-content-width":O?`${O}px`:void 0,...e.style},children:P&&s})});function I5(e){return e?"open":"closed"}var $Pe=Kie;const d0=$Pe,h0=Xie,f0=Yie,R5=(e,t="restaurant")=>ei({queryKey:["comments",e,t],queryFn:async()=>{const{data:r,error:n}=await Ct.from("comments").select("*").eq("target_id",e).eq("target_type",t).order("created_at",{ascending:!1});if(n)throw n;if(!r||r.length===0)return[];const s=[...new Set(r.map(b=>b.user_id))],{data:o}=await Ct.from("profiles").select("id, display_name, avatar_url").in("id",s),h=new Map((o||[]).map(b=>[b.id,{display_name:b.display_name,avatar_url:b.avatar_url}])),i=r.filter(b=>!b.parent_id),m=r.filter(b=>b.parent_id),y=new Map;return m.forEach(b=>{const T=b.parent_id;y.has(T)||y.set(T,[]),y.get(T).push(b)}),i.map(b=>({...b,profiles:h.get(b.user_id),replies:(y.get(b.id)||[]).sort((T,A)=>new Date(T.created_at).getTime()-new Date(A.created_at).getTime()).map(T=>({...T,profiles:h.get(T.user_id)}))}))},enabled:!!e,staleTime:3e4}),UPe=()=>{const{user:e}=Kn(),{toast:t}=Ri(),r=Mi();return Gi({mutationFn:async({targetId:n,targetType:s,content:o,ratingValue:h,priceRange:i,imageUrl:m,parentId:y})=>{if(!e)throw new Error("User not authenticated");const S={user_id:e.id,target_id:n,target_type:s,content:o,parent_id:y};y||(h&&(S.rating_value=h),i&&(S.price_range=i)),m&&(S.image_url=m);const{data:b,error:T}=await Ct.from("comments").insert(S).select().single();if(T)throw T;return b},onSuccess:(n,s)=>{r.invalidateQueries({queryKey:["comments",s.targetId,s.targetType]}),r.invalidateQueries({queryKey:["restaurants"]}),r.invalidateQueries({queryKey:["restaurant",s.targetId]}),t({title:"Success",description:"Comment added successfully"})},onError:()=>{t({title:"Error",description:"Failed to add comment",variant:"destructive"})}})},VPe=()=>{const{toast:e}=Ri(),t=Mi();return Gi({mutationFn:async r=>{const{error:n}=await Ct.from("comments").delete().eq("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["comments"]}),e({title:"Success",description:"Comment deleted successfully"})},onError:()=>{e({title:"Error",description:"Failed to delete comment",variant:"destructive"})}})},qPe=[{value:"0-5",label:"0-5"},{value:"5-10",label:"5-10"},{value:"10-15",label:"10-15"},{value:"15-20",label:"15-20"},{value:"20-25",label:"20-25"},{value:"25-30",label:"25-30"},{value:"30-40",label:"30-40"},{value:"40-50",label:"40-50"},{value:"50+",label:"50+"}],HPe=({restaurantId:e})=>{var m;const{t}=ci(),{data:r}=R5(e,"restaurant"),n=(r==null?void 0:r.filter(y=>y.rating_value))||[],s=n.length?n.reduce((y,S)=>y+(S.rating_value||0),0)/n.length:0,o=[5,4,3,2,1].map(y=>({star:y,count:n.filter(S=>S.rating_value===y).length,percentage:n.length?(n.filter(S=>S.rating_value===y).length/n.length*100).toFixed(0):0})),h=n.reduce((y,S)=>(S.price_range&&(y[S.price_range]=(y[S.price_range]||0)+1),y),{}),i=h&&Object.keys(h).length>0?Object.entries(h).sort((y,S)=>S[1]-y[1])[0]:null;return d.jsxs(Nr,{children:[d.jsx(Rn,{children:d.jsx($n,{children:t("restaurant.rating")})}),d.jsxs(Mr,{className:"space-y-6",children:[d.jsxs("div",{className:"flex items-center gap-6",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-5xl font-bold",children:s.toFixed(1)}),d.jsx("div",{className:"flex items-center justify-center mt-2",children:[1,2,3,4,5].map(y=>d.jsx(Al,{className:fr("w-5 h-5",y<=Math.round(s)?"fill-accent text-accent":"text-muted-foreground")},y))}),d.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[n.length," ",t("restaurant.ratingsCount")]}),i&&d.jsxs("div",{className:"flex items-center justify-center gap-1 mt-2 text-sm",children:[d.jsx(qP,{className:"w-4 h-4 text-primary"}),d.jsx("span",{className:"font-semibold text-foreground",children:(m=qPe.find(y=>y.value===i[0]))==null?void 0:m.label})]})]}),d.jsx("div",{className:"flex-1 space-y-2",children:o.map(({star:y,count:S,percentage:b})=>d.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[d.jsxs("span",{className:"w-8",children:[y," "]}),d.jsx("div",{className:"flex-1 h-2 bg-secondary rounded-full overflow-hidden",children:d.jsx("div",{className:"h-full bg-accent transition-all",style:{width:`${b}%`}})}),d.jsx("span",{className:"w-12 text-right text-muted-foreground",children:S})]},y))})]}),d.jsx("div",{className:"pt-4 border-t text-center text-sm text-muted-foreground",children:t("restaurant.signInToRate")})]})]})},hl=V.forwardRef(({className:e,...t},r)=>d.jsx("textarea",{className:fr("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...t}));hl.displayName="Textarea";function L2(e){const t=V.useRef({value:e,previous:e});return V.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var GPe=[" ","Enter","ArrowUp","ArrowDown"],WPe=[" ","Enter"],Ov="Select",[DN,LN,KPe]=_2(Ov),[dw,dst]=Mo(Ov,[KPe,_g]),FN=_g(),[ZPe,Eg]=dw(Ov),[XPe,YPe]=dw(Ov),Jie=e=>{const{__scopeSelect:t,children:r,open:n,defaultOpen:s,onOpenChange:o,value:h,defaultValue:i,onValueChange:m,dir:y,name:S,autoComplete:b,disabled:T,required:A,form:O}=e,P=FN(t),[I,R]=V.useState(null),[M,F]=V.useState(null),[z,$]=V.useState(!1),W=Zv(y),[K,ee]=Zc({prop:n,defaultProp:s??!1,onChange:o,caller:Ov}),[ne,ie]=Zc({prop:h,defaultProp:i,onChange:m,caller:Ov}),re=V.useRef(null),te=I?O||!!I.closest("form"):!0,[ae,ue]=V.useState(new Set),be=Array.from(ae).map(we=>we.props.value).join(";");return d.jsx(oN,{...P,children:d.jsxs(ZPe,{required:A,scope:t,trigger:I,onTriggerChange:R,valueNode:M,onValueNodeChange:F,valueNodeHasChildren:z,onValueNodeHasChildrenChange:$,contentId:_u(),value:ne,onValueChange:ie,open:K,onOpenChange:ee,dir:W,triggerPointerDownPosRef:re,disabled:T,children:[d.jsx(DN.Provider,{scope:t,children:d.jsx(XPe,{scope:e.__scopeSelect,onNativeOptionAdd:V.useCallback(we=>{ue(Ce=>new Set(Ce).add(we))},[]),onNativeOptionRemove:V.useCallback(we=>{ue(Ce=>{const _e=new Set(Ce);return _e.delete(we),_e})},[]),children:r})}),te?d.jsxs(wse,{"aria-hidden":!0,required:A,tabIndex:-1,name:S,autoComplete:b,value:ne,onChange:we=>ie(we.target.value),disabled:T,form:O,children:[ne===void 0?d.jsx("option",{value:""}):null,Array.from(ae)]},be):null]})})};Jie.displayName=Ov;var Qie="SelectTrigger",ese=V.forwardRef((e,t)=>{const{__scopeSelect:r,disabled:n=!1,...s}=e,o=FN(r),h=Eg(Qie,r),i=h.disabled||n,m=Un(t,h.onTriggerChange),y=LN(r),S=V.useRef("touch"),[b,T,A]=Ese(P=>{const I=y().filter(F=>!F.disabled),R=I.find(F=>F.value===h.value),M=Tse(I,P,R);M!==void 0&&h.onValueChange(M.value)}),O=P=>{i||(h.onOpenChange(!0),A()),P&&(h.triggerPointerDownPosRef.current={x:Math.round(P.pageX),y:Math.round(P.pageY)})};return d.jsx(E2,{asChild:!0,...o,children:d.jsx(ln.button,{type:"button",role:"combobox","aria-controls":h.contentId,"aria-expanded":h.open,"aria-required":h.required,"aria-autocomplete":"none",dir:h.dir,"data-state":h.open?"open":"closed",disabled:i,"data-disabled":i?"":void 0,"data-placeholder":Sse(h.value)?"":void 0,...s,ref:m,onClick:Ir(s.onClick,P=>{P.currentTarget.focus(),S.current!=="mouse"&&O(P)}),onPointerDown:Ir(s.onPointerDown,P=>{S.current=P.pointerType;const I=P.target;I.hasPointerCapture(P.pointerId)&&I.releasePointerCapture(P.pointerId),P.button===0&&P.ctrlKey===!1&&P.pointerType==="mouse"&&(O(P),P.preventDefault())}),onKeyDown:Ir(s.onKeyDown,P=>{const I=b.current!=="";!(P.ctrlKey||P.altKey||P.metaKey)&&P.key.length===1&&T(P.key),!(I&&P.key===" ")&&GPe.includes(P.key)&&(O(),P.preventDefault())})})})});ese.displayName=Qie;var tse="SelectValue",rse=V.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:s,children:o,placeholder:h="",...i}=e,m=Eg(tse,r),{onValueNodeHasChildrenChange:y}=m,S=o!==void 0,b=Un(t,m.onValueNodeChange);return io(()=>{y(S)},[y,S]),d.jsx(ln.span,{...i,ref:b,style:{pointerEvents:"none"},children:Sse(m.value)?d.jsx(d.Fragment,{children:h}):o})});rse.displayName=tse;var JPe="SelectIcon",nse=V.forwardRef((e,t)=>{const{__scopeSelect:r,children:n,...s}=e;return d.jsx(ln.span,{"aria-hidden":!0,...s,ref:t,children:n||""})});nse.displayName=JPe;var QPe="SelectPortal",ise=e=>d.jsx(Yb,{asChild:!0,...e});ise.displayName=QPe;var kv="SelectContent",sse=V.forwardRef((e,t)=>{const r=Eg(kv,e.__scopeSelect),[n,s]=V.useState();if(io(()=>{s(new DocumentFragment)},[]),!r.open){const o=n;return o?vg.createPortal(d.jsx(ase,{scope:e.__scopeSelect,children:d.jsx(DN.Slot,{scope:e.__scopeSelect,children:d.jsx("div",{children:e.children})})}),o):null}return d.jsx(ose,{...e,ref:t})});sse.displayName=kv;var Pd=10,[ase,Tg]=dw(kv),eOe="SelectContentImpl",tOe=lg("SelectContent.RemoveScroll"),ose=V.forwardRef((e,t)=>{const{__scopeSelect:r,position:n="item-aligned",onCloseAutoFocus:s,onEscapeKeyDown:o,onPointerDownOutside:h,side:i,sideOffset:m,align:y,alignOffset:S,arrowPadding:b,collisionBoundary:T,collisionPadding:A,sticky:O,hideWhenDetached:P,avoidCollisions:I,...R}=e,M=Eg(kv,r),[F,z]=V.useState(null),[$,W]=V.useState(null),K=Un(t,Be=>z(Be)),[ee,ne]=V.useState(null),[ie,re]=V.useState(null),te=LN(r),[ae,ue]=V.useState(!1),be=V.useRef(!1);V.useEffect(()=>{if(F)return xN(F)},[F]),vN();const we=V.useCallback(Be=>{const[nt,...Me]=te().map(rt=>rt.ref.current),[We]=Me.slice(-1),gt=document.activeElement;for(const rt of Be)if(rt===gt||(rt==null||rt.scrollIntoView({block:"nearest"}),rt===nt&&$&&($.scrollTop=0),rt===We&&$&&($.scrollTop=$.scrollHeight),rt==null||rt.focus(),document.activeElement!==gt))return},[te,$]),Ce=V.useCallback(()=>we([ee,F]),[we,ee,F]);V.useEffect(()=>{ae&&Ce()},[ae,Ce]);const{onOpenChange:_e,triggerPointerDownPosRef:me}=M;V.useEffect(()=>{if(F){let Be={x:0,y:0};const nt=We=>{var gt,rt;Be={x:Math.abs(Math.round(We.pageX)-(((gt=me.current)==null?void 0:gt.x)??0)),y:Math.abs(Math.round(We.pageY)-(((rt=me.current)==null?void 0:rt.y)??0))}},Me=We=>{Be.x<=10&&Be.y<=10?We.preventDefault():F.contains(We.target)||_e(!1),document.removeEventListener("pointermove",nt),me.current=null};return me.current!==null&&(document.addEventListener("pointermove",nt),document.addEventListener("pointerup",Me,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",nt),document.removeEventListener("pointerup",Me,{capture:!0})}}},[F,_e,me]),V.useEffect(()=>{const Be=()=>_e(!1);return window.addEventListener("blur",Be),window.addEventListener("resize",Be),()=>{window.removeEventListener("blur",Be),window.removeEventListener("resize",Be)}},[_e]);const[Ae,ge]=Ese(Be=>{const nt=te().filter(gt=>!gt.disabled),Me=nt.find(gt=>gt.ref.current===document.activeElement),We=Tse(nt,Be,Me);We&&setTimeout(()=>We.ref.current.focus())}),pe=V.useCallback((Be,nt,Me)=>{const We=!be.current&&!Me;(M.value!==void 0&&M.value===nt||We)&&(ne(Be),We&&(be.current=!0))},[M.value]),Oe=V.useCallback(()=>F==null?void 0:F.focus(),[F]),Je=V.useCallback((Be,nt,Me)=>{const We=!be.current&&!Me;(M.value!==void 0&&M.value===nt||We)&&re(Be)},[M.value]),Ze=n==="popper"?EF:lse,Pe=Ze===EF?{side:i,sideOffset:m,align:y,alignOffset:S,arrowPadding:b,collisionBoundary:T,collisionPadding:A,sticky:O,hideWhenDetached:P,avoidCollisions:I}:{};return d.jsx(ase,{scope:r,content:F,viewport:$,onViewportChange:W,itemRefCallback:pe,selectedItem:ee,onItemLeave:Oe,itemTextRefCallback:Je,focusSelectedItem:Ce,selectedItemText:ie,position:n,isPositioned:ae,searchRef:Ae,children:d.jsx(C2,{as:tOe,allowPinchZoom:!0,children:d.jsx(A2,{asChild:!0,trapped:M.open,onMountAutoFocus:Be=>{Be.preventDefault()},onUnmountAutoFocus:Ir(s,Be=>{var nt;(nt=M.trigger)==null||nt.focus({preventScroll:!0}),Be.preventDefault()}),children:d.jsx(Gv,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:o,onPointerDownOutside:h,onFocusOutside:Be=>Be.preventDefault(),onDismiss:()=>M.onOpenChange(!1),children:d.jsx(Ze,{role:"listbox",id:M.contentId,"data-state":M.open?"open":"closed",dir:M.dir,onContextMenu:Be=>Be.preventDefault(),...R,...Pe,onPlaced:()=>ue(!0),ref:K,style:{display:"flex",flexDirection:"column",outline:"none",...R.style},onKeyDown:Ir(R.onKeyDown,Be=>{const nt=Be.ctrlKey||Be.altKey||Be.metaKey;if(Be.key==="Tab"&&Be.preventDefault(),!nt&&Be.key.length===1&&ge(Be.key),["ArrowUp","ArrowDown","Home","End"].includes(Be.key)){let We=te().filter(gt=>!gt.disabled).map(gt=>gt.ref.current);if(["ArrowUp","End"].includes(Be.key)&&(We=We.slice().reverse()),["ArrowUp","ArrowDown"].includes(Be.key)){const gt=Be.target,rt=We.indexOf(gt);We=We.slice(rt+1)}setTimeout(()=>we(We)),Be.preventDefault()}})})})})})})});ose.displayName=eOe;var rOe="SelectItemAlignedPosition",lse=V.forwardRef((e,t)=>{const{__scopeSelect:r,onPlaced:n,...s}=e,o=Eg(kv,r),h=Tg(kv,r),[i,m]=V.useState(null),[y,S]=V.useState(null),b=Un(t,K=>S(K)),T=LN(r),A=V.useRef(!1),O=V.useRef(!0),{viewport:P,selectedItem:I,selectedItemText:R,focusSelectedItem:M}=h,F=V.useCallback(()=>{if(o.trigger&&o.valueNode&&i&&y&&P&&I&&R){const K=o.trigger.getBoundingClientRect(),ee=y.getBoundingClientRect(),ne=o.valueNode.getBoundingClientRect(),ie=R.getBoundingClientRect();if(o.dir!=="rtl"){const gt=ie.left-ee.left,rt=ne.left-gt,Ht=K.left-rt,Lt=K.width+Ht,nr=Math.max(Lt,ee.width),Rr=window.innerWidth-Pd,Dr=vT(rt,[Pd,Math.max(Pd,Rr-nr)]);i.style.minWidth=Lt+"px",i.style.left=Dr+"px"}else{const gt=ee.right-ie.right,rt=window.innerWidth-ne.right-gt,Ht=window.innerWidth-K.right-rt,Lt=K.width+Ht,nr=Math.max(Lt,ee.width),Rr=window.innerWidth-Pd,Dr=vT(rt,[Pd,Math.max(Pd,Rr-nr)]);i.style.minWidth=Lt+"px",i.style.right=Dr+"px"}const re=T(),te=window.innerHeight-Pd*2,ae=P.scrollHeight,ue=window.getComputedStyle(y),be=parseInt(ue.borderTopWidth,10),we=parseInt(ue.paddingTop,10),Ce=parseInt(ue.borderBottomWidth,10),_e=parseInt(ue.paddingBottom,10),me=be+we+ae+_e+Ce,Ae=Math.min(I.offsetHeight*5,me),ge=window.getComputedStyle(P),pe=parseInt(ge.paddingTop,10),Oe=parseInt(ge.paddingBottom,10),Je=K.top+K.height/2-Pd,Ze=te-Je,Pe=I.offsetHeight/2,Be=I.offsetTop+Pe,nt=be+we+Be,Me=me-nt;if(nt<=Je){const gt=re.length>0&&I===re[re.length-1].ref.current;i.style.bottom="0px";const rt=y.clientHeight-P.offsetTop-P.offsetHeight,Ht=Math.max(Ze,Pe+(gt?Oe:0)+rt+Ce),Lt=nt+Ht;i.style.height=Lt+"px"}else{const gt=re.length>0&&I===re[0].ref.current;i.style.top="0px";const Ht=Math.max(Je,be+P.offsetTop+(gt?pe:0)+Pe)+Me;i.style.height=Ht+"px",P.scrollTop=nt-Je+P.offsetTop}i.style.margin=`${Pd}px 0`,i.style.minHeight=Ae+"px",i.style.maxHeight=te+"px",n==null||n(),requestAnimationFrame(()=>A.current=!0)}},[T,o.trigger,o.valueNode,i,y,P,I,R,o.dir,n]);io(()=>F(),[F]);const[z,$]=V.useState();io(()=>{y&&$(window.getComputedStyle(y).zIndex)},[y]);const W=V.useCallback(K=>{K&&O.current===!0&&(F(),M==null||M(),O.current=!1)},[F,M]);return d.jsx(iOe,{scope:r,contentWrapper:i,shouldExpandOnScrollRef:A,onScrollButtonChange:W,children:d.jsx("div",{ref:m,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:z},children:d.jsx(ln.div,{...s,ref:b,style:{boxSizing:"border-box",maxHeight:"100%",...s.style}})})})});lse.displayName=rOe;var nOe="SelectPopperPosition",EF=V.forwardRef((e,t)=>{const{__scopeSelect:r,align:n="start",collisionPadding:s=Pd,...o}=e,h=FN(r);return d.jsx(lN,{...h,...o,ref:t,align:n,collisionPadding:s,style:{boxSizing:"border-box",...o.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});EF.displayName=nOe;var[iOe,M5]=dw(kv,{}),TF="SelectViewport",cse=V.forwardRef((e,t)=>{const{__scopeSelect:r,nonce:n,...s}=e,o=Tg(TF,r),h=M5(TF,r),i=Un(t,o.onViewportChange),m=V.useRef(0);return d.jsxs(d.Fragment,{children:[d.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),d.jsx(DN.Slot,{scope:r,children:d.jsx(ln.div,{"data-radix-select-viewport":"",role:"presentation",...s,ref:i,style:{position:"relative",flex:1,overflow:"hidden auto",...s.style},onScroll:Ir(s.onScroll,y=>{const S=y.currentTarget,{contentWrapper:b,shouldExpandOnScrollRef:T}=h;if(T!=null&&T.current&&b){const A=Math.abs(m.current-S.scrollTop);if(A>0){const O=window.innerHeight-Pd*2,P=parseFloat(b.style.minHeight),I=parseFloat(b.style.height),R=Math.max(P,I);if(R<O){const M=R+A,F=Math.min(O,M),z=M-F;b.style.height=F+"px",b.style.bottom==="0px"&&(S.scrollTop=z>0?z:0,b.style.justifyContent="flex-end")}}}m.current=S.scrollTop})})})]})});cse.displayName=TF;var use="SelectGroup",[sOe,aOe]=dw(use),oOe=V.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,s=_u();return d.jsx(sOe,{scope:r,id:s,children:d.jsx(ln.div,{role:"group","aria-labelledby":s,...n,ref:t})})});oOe.displayName=use;var dse="SelectLabel",hse=V.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,s=aOe(dse,r);return d.jsx(ln.div,{id:s.id,...n,ref:t})});hse.displayName=dse;var gO="SelectItem",[lOe,fse]=dw(gO),pse=V.forwardRef((e,t)=>{const{__scopeSelect:r,value:n,disabled:s=!1,textValue:o,...h}=e,i=Eg(gO,r),m=Tg(gO,r),y=i.value===n,[S,b]=V.useState(o??""),[T,A]=V.useState(!1),O=Un(t,M=>{var F;return(F=m.itemRefCallback)==null?void 0:F.call(m,M,n,s)}),P=_u(),I=V.useRef("touch"),R=()=>{s||(i.onValueChange(n),i.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return d.jsx(lOe,{scope:r,value:n,disabled:s,textId:P,isSelected:y,onItemTextChange:V.useCallback(M=>{b(F=>F||((M==null?void 0:M.textContent)??"").trim())},[]),children:d.jsx(DN.ItemSlot,{scope:r,value:n,disabled:s,textValue:S,children:d.jsx(ln.div,{role:"option","aria-labelledby":P,"data-highlighted":T?"":void 0,"aria-selected":y&&T,"data-state":y?"checked":"unchecked","aria-disabled":s||void 0,"data-disabled":s?"":void 0,tabIndex:s?void 0:-1,...h,ref:O,onFocus:Ir(h.onFocus,()=>A(!0)),onBlur:Ir(h.onBlur,()=>A(!1)),onClick:Ir(h.onClick,()=>{I.current!=="mouse"&&R()}),onPointerUp:Ir(h.onPointerUp,()=>{I.current==="mouse"&&R()}),onPointerDown:Ir(h.onPointerDown,M=>{I.current=M.pointerType}),onPointerMove:Ir(h.onPointerMove,M=>{var F;I.current=M.pointerType,s?(F=m.onItemLeave)==null||F.call(m):I.current==="mouse"&&M.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Ir(h.onPointerLeave,M=>{var F;M.currentTarget===document.activeElement&&((F=m.onItemLeave)==null||F.call(m))}),onKeyDown:Ir(h.onKeyDown,M=>{var z;((z=m.searchRef)==null?void 0:z.current)!==""&&M.key===" "||(WPe.includes(M.key)&&R(),M.key===" "&&M.preventDefault())})})})})});pse.displayName=gO;var pE="SelectItemText",mse=V.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:s,...o}=e,h=Eg(pE,r),i=Tg(pE,r),m=fse(pE,r),y=YPe(pE,r),[S,b]=V.useState(null),T=Un(t,R=>b(R),m.onItemTextChange,R=>{var M;return(M=i.itemTextRefCallback)==null?void 0:M.call(i,R,m.value,m.disabled)}),A=S==null?void 0:S.textContent,O=V.useMemo(()=>d.jsx("option",{value:m.value,disabled:m.disabled,children:A},m.value),[m.disabled,m.value,A]),{onNativeOptionAdd:P,onNativeOptionRemove:I}=y;return io(()=>(P(O),()=>I(O)),[P,I,O]),d.jsxs(d.Fragment,{children:[d.jsx(ln.span,{id:m.textId,...o,ref:T}),m.isSelected&&h.valueNode&&!h.valueNodeHasChildren?vg.createPortal(o.children,h.valueNode):null]})});mse.displayName=pE;var gse="SelectItemIndicator",yse=V.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return fse(gse,r).isSelected?d.jsx(ln.span,{"aria-hidden":!0,...n,ref:t}):null});yse.displayName=gse;var AF="SelectScrollUpButton",vse=V.forwardRef((e,t)=>{const r=Tg(AF,e.__scopeSelect),n=M5(AF,e.__scopeSelect),[s,o]=V.useState(!1),h=Un(t,n.onScrollButtonChange);return io(()=>{if(r.viewport&&r.isPositioned){let i=function(){const y=m.scrollTop>0;o(y)};const m=r.viewport;return i(),m.addEventListener("scroll",i),()=>m.removeEventListener("scroll",i)}},[r.viewport,r.isPositioned]),s?d.jsx(xse,{...e,ref:h,onAutoScroll:()=>{const{viewport:i,selectedItem:m}=r;i&&m&&(i.scrollTop=i.scrollTop-m.offsetHeight)}}):null});vse.displayName=AF;var CF="SelectScrollDownButton",_se=V.forwardRef((e,t)=>{const r=Tg(CF,e.__scopeSelect),n=M5(CF,e.__scopeSelect),[s,o]=V.useState(!1),h=Un(t,n.onScrollButtonChange);return io(()=>{if(r.viewport&&r.isPositioned){let i=function(){const y=m.scrollHeight-m.clientHeight,S=Math.ceil(m.scrollTop)<y;o(S)};const m=r.viewport;return i(),m.addEventListener("scroll",i),()=>m.removeEventListener("scroll",i)}},[r.viewport,r.isPositioned]),s?d.jsx(xse,{...e,ref:h,onAutoScroll:()=>{const{viewport:i,selectedItem:m}=r;i&&m&&(i.scrollTop=i.scrollTop+m.offsetHeight)}}):null});_se.displayName=CF;var xse=V.forwardRef((e,t)=>{const{__scopeSelect:r,onAutoScroll:n,...s}=e,o=Tg("SelectScrollButton",r),h=V.useRef(null),i=LN(r),m=V.useCallback(()=>{h.current!==null&&(window.clearInterval(h.current),h.current=null)},[]);return V.useEffect(()=>()=>m(),[m]),io(()=>{var S;const y=i().find(b=>b.ref.current===document.activeElement);(S=y==null?void 0:y.ref.current)==null||S.scrollIntoView({block:"nearest"})},[i]),d.jsx(ln.div,{"aria-hidden":!0,...s,ref:t,style:{flexShrink:0,...s.style},onPointerDown:Ir(s.onPointerDown,()=>{h.current===null&&(h.current=window.setInterval(n,50))}),onPointerMove:Ir(s.onPointerMove,()=>{var y;(y=o.onItemLeave)==null||y.call(o),h.current===null&&(h.current=window.setInterval(n,50))}),onPointerLeave:Ir(s.onPointerLeave,()=>{m()})})}),cOe="SelectSeparator",bse=V.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return d.jsx(ln.div,{"aria-hidden":!0,...n,ref:t})});bse.displayName=cOe;var jF="SelectArrow",uOe=V.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,s=FN(r),o=Eg(jF,r),h=Tg(jF,r);return o.open&&h.position==="popper"?d.jsx(cN,{...s,...n,ref:t}):null});uOe.displayName=jF;var dOe="SelectBubbleInput",wse=V.forwardRef(({__scopeSelect:e,value:t,...r},n)=>{const s=V.useRef(null),o=Un(n,s),h=L2(t);return V.useEffect(()=>{const i=s.current;if(!i)return;const m=window.HTMLSelectElement.prototype,S=Object.getOwnPropertyDescriptor(m,"value").set;if(h!==t&&S){const b=new Event("change",{bubbles:!0});S.call(i,t),i.dispatchEvent(b)}},[h,t]),d.jsx(ln.select,{...r,style:{...rQ,...r.style},ref:o,defaultValue:t})});wse.displayName=dOe;function Sse(e){return e===""||e===void 0}function Ese(e){const t=no(e),r=V.useRef(""),n=V.useRef(0),s=V.useCallback(h=>{const i=r.current+h;t(i),function m(y){r.current=y,window.clearTimeout(n.current),y!==""&&(n.current=window.setTimeout(()=>m(""),1e3))}(i)},[t]),o=V.useCallback(()=>{r.current="",window.clearTimeout(n.current)},[]);return V.useEffect(()=>()=>window.clearTimeout(n.current),[]),[r,s,o]}function Tse(e,t,r){const s=t.length>1&&Array.from(t).every(y=>y===t[0])?t[0]:t,o=r?e.indexOf(r):-1;let h=hOe(e,Math.max(o,0));s.length===1&&(h=h.filter(y=>y!==r));const m=h.find(y=>y.textValue.toLowerCase().startsWith(s.toLowerCase()));return m!==r?m:void 0}function hOe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var fOe=Jie,Ase=ese,pOe=rse,mOe=nse,gOe=ise,Cse=sse,yOe=cse,jse=hse,Pse=pse,vOe=mse,_Oe=yse,Ose=vse,kse=_se,Nse=bse;const Qs=fOe,ea=pOe,Gs=V.forwardRef(({className:e,children:t,...r},n)=>d.jsxs(Ase,{ref:n,className:fr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...r,children:[t,d.jsx(mOe,{asChild:!0,children:d.jsx(Vf,{className:"h-4 w-4 opacity-50"})})]}));Gs.displayName=Ase.displayName;const Ise=V.forwardRef(({className:e,...t},r)=>d.jsx(Ose,{ref:r,className:fr("flex cursor-default items-center justify-center py-1",e),...t,children:d.jsx(w_e,{className:"h-4 w-4"})}));Ise.displayName=Ose.displayName;const Rse=V.forwardRef(({className:e,...t},r)=>d.jsx(kse,{ref:r,className:fr("flex cursor-default items-center justify-center py-1",e),...t,children:d.jsx(Vf,{className:"h-4 w-4"})}));Rse.displayName=kse.displayName;const Ws=V.forwardRef(({className:e,children:t,position:r="popper",...n},s)=>d.jsx(gOe,{children:d.jsxs(Cse,{ref:s,className:fr("relative z-[100] max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...n,children:[d.jsx(Ise,{}),d.jsx(yOe,{className:fr("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),d.jsx(Rse,{})]})}));Ws.displayName=Cse.displayName;const xOe=V.forwardRef(({className:e,...t},r)=>d.jsx(jse,{ref:r,className:fr("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));xOe.displayName=jse.displayName;const nn=V.forwardRef(({className:e,children:t,...r},n)=>d.jsxs(Pse,{ref:n,className:fr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...r,children:[d.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:d.jsx(_Oe,{children:d.jsx(ip,{className:"h-4 w-4"})})}),d.jsx(vOe,{children:t})]}));nn.displayName=Pse.displayName;const bOe=V.forwardRef(({className:e,...t},r)=>d.jsx(Nse,{ref:r,className:fr("-mx-1 my-1 h-px bg-muted",e),...t}));bOe.displayName=Nse.displayName;var wOe="Label",Mse=V.forwardRef((e,t)=>d.jsx(ln.label,{...e,ref:t,onMouseDown:r=>{var s;r.target.closest("button, input, select, textarea")||((s=e.onMouseDown)==null||s.call(e,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));Mse.displayName=wOe;var Dse=Mse;const SOe=Wv("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),yr=V.forwardRef(({className:e,...t},r)=>d.jsx(Dse,{ref:r,className:fr(SOe(),e),...t}));yr.displayName=Dse.displayName;const fl=i5,tf=s5,EOe=a5,Lse=V.forwardRef(({className:e,...t},r)=>d.jsx(j2,{ref:r,className:fr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));Lse.displayName=j2.displayName;const Jo=V.forwardRef(({className:e,children:t,...r},n)=>d.jsxs(EOe,{children:[d.jsx(Lse,{}),d.jsxs(P2,{ref:n,className:fr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[t,d.jsxs(wN,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[d.jsx(Xc,{className:"h-4 w-4"}),d.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Jo.displayName=P2.displayName;const Qo=({className:e,...t})=>d.jsx("div",{className:fr("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});Qo.displayName="DialogHeader";const Qv=({className:e,...t})=>d.jsx("div",{className:fr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Qv.displayName="DialogFooter";const el=V.forwardRef(({className:e,...t},r)=>d.jsx(O2,{ref:r,className:fr("text-lg font-semibold leading-none tracking-tight",e),...t}));el.displayName=O2.displayName;const Ul=V.forwardRef(({className:e,...t},r)=>d.jsx(k2,{ref:r,className:fr("text-sm text-muted-foreground",e),...t}));Ul.displayName=k2.displayName;var Fse="AlertDialog",[TOe,hst]=Mo(Fse,[gre]),mp=gre(),zse=e=>{const{__scopeAlertDialog:t,...r}=e,n=mp(t);return d.jsx(i5,{...n,...r,modal:!0})};zse.displayName=Fse;var AOe="AlertDialogTrigger",Bse=V.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=mp(r);return d.jsx(s5,{...s,...n,ref:t})});Bse.displayName=AOe;var COe="AlertDialogPortal",$se=e=>{const{__scopeAlertDialog:t,...r}=e,n=mp(t);return d.jsx(a5,{...n,...r})};$se.displayName=COe;var jOe="AlertDialogOverlay",Use=V.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=mp(r);return d.jsx(j2,{...s,...n,ref:t})});Use.displayName=jOe;var I0="AlertDialogContent",[POe,OOe]=TOe(I0),kOe=JJ("AlertDialogContent"),Vse=V.forwardRef((e,t)=>{const{__scopeAlertDialog:r,children:n,...s}=e,o=mp(r),h=V.useRef(null),i=Un(t,h),m=V.useRef(null);return d.jsx(kTe,{contentName:I0,titleName:qse,docsSlug:"alert-dialog",children:d.jsx(POe,{scope:r,cancelRef:m,children:d.jsxs(P2,{role:"alertdialog",...o,...s,ref:i,onOpenAutoFocus:Ir(s.onOpenAutoFocus,y=>{var S;y.preventDefault(),(S=m.current)==null||S.focus({preventScroll:!0})}),onPointerDownOutside:y=>y.preventDefault(),onInteractOutside:y=>y.preventDefault(),children:[d.jsx(kOe,{children:n}),d.jsx(IOe,{contentRef:h})]})})})});Vse.displayName=I0;var qse="AlertDialogTitle",Hse=V.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=mp(r);return d.jsx(O2,{...s,...n,ref:t})});Hse.displayName=qse;var Gse="AlertDialogDescription",Wse=V.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=mp(r);return d.jsx(k2,{...s,...n,ref:t})});Wse.displayName=Gse;var NOe="AlertDialogAction",Kse=V.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,s=mp(r);return d.jsx(wN,{...s,...n,ref:t})});Kse.displayName=NOe;var Zse="AlertDialogCancel",Xse=V.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,{cancelRef:s}=OOe(Zse,r),o=mp(r),h=Un(t,s);return d.jsx(wN,{...o,...n,ref:h})});Xse.displayName=Zse;var IOe=({contentRef:e})=>{const t=`\`${I0}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${I0}\` by passing a \`${Gse}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${I0}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return V.useEffect(()=>{var n;document.getElementById((n=e.current)==null?void 0:n.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},ROe=zse,MOe=Bse,DOe=$se,Yse=Use,Jse=Vse,Qse=Kse,eae=Xse,tae=Hse,rae=Wse;const ko=ROe,gb=MOe,LOe=DOe,nae=V.forwardRef(({className:e,...t},r)=>d.jsx(Yse,{className:fr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));nae.displayName=Yse.displayName;const co=V.forwardRef(({className:e,...t},r)=>d.jsxs(LOe,{children:[d.jsx(nae,{}),d.jsx(Jse,{ref:r,className:fr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));co.displayName=Jse.displayName;const uo=({className:e,...t})=>d.jsx("div",{className:fr("flex flex-col space-y-2 text-center sm:text-left",e),...t});uo.displayName="AlertDialogHeader";const ho=({className:e,...t})=>d.jsx("div",{className:fr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});ho.displayName="AlertDialogFooter";const fo=V.forwardRef(({className:e,...t},r)=>d.jsx(tae,{ref:r,className:fr("text-lg font-semibold",e),...t}));fo.displayName=tae.displayName;const po=V.forwardRef(({className:e,...t},r)=>d.jsx(rae,{ref:r,className:fr("text-sm text-muted-foreground",e),...t}));po.displayName=rae.displayName;const to=V.forwardRef(({className:e,...t},r)=>d.jsx(Qse,{ref:r,className:fr(cb(),e),...t}));to.displayName=Qse.displayName;const mo=V.forwardRef(({className:e,...t},r)=>d.jsx(eae,{ref:r,className:fr(cb({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));mo.displayName=eae.displayName;var FOe=Object.defineProperty,zOe=Object.defineProperties,BOe=Object.getOwnPropertyDescriptors,yO=Object.getOwnPropertySymbols,iae=Object.prototype.hasOwnProperty,sae=Object.prototype.propertyIsEnumerable,EG=(e,t,r)=>t in e?FOe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,$Oe=(e,t)=>{for(var r in t||(t={}))iae.call(t,r)&&EG(e,r,t[r]);if(yO)for(var r of yO(t))sae.call(t,r)&&EG(e,r,t[r]);return e},UOe=(e,t)=>zOe(e,BOe(t)),VOe=(e,t)=>{var r={};for(var n in e)iae.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&yO)for(var n of yO(e))t.indexOf(n)<0&&sae.call(e,n)&&(r[n]=e[n]);return r};function qOe(e){let t=setTimeout(e,0),r=setTimeout(e,10),n=setTimeout(e,50);return[t,r,n]}function HOe(e){let t=V.useRef();return V.useEffect(()=>{t.current=e}),t.current}var GOe=18,aae=40,WOe=`${aae}px`,KOe=["[data-lastpass-icon-root]","com-1password-button","[data-dashlanecreated]",'[style$="2147483647 !important;"]'].join(",");function ZOe({containerRef:e,inputRef:t,pushPasswordManagerStrategy:r,isFocused:n}){let[s,o]=V.useState(!1),[h,i]=V.useState(!1),[m,y]=V.useState(!1),S=V.useMemo(()=>r==="none"?!1:(r==="increase-width"||r==="experimental-no-flickering")&&s&&h,[s,h,r]),b=V.useCallback(()=>{let T=e.current,A=t.current;if(!T||!A||m||r==="none")return;let O=T,P=O.getBoundingClientRect().left+O.offsetWidth,I=O.getBoundingClientRect().top+O.offsetHeight/2,R=P-GOe,M=I;document.querySelectorAll(KOe).length===0&&document.elementFromPoint(R,M)===T||(o(!0),y(!0))},[e,t,m,r]);return V.useEffect(()=>{let T=e.current;if(!T||r==="none")return;function A(){let P=window.innerWidth-T.getBoundingClientRect().right;i(P>=aae)}A();let O=setInterval(A,1e3);return()=>{clearInterval(O)}},[e,r]),V.useEffect(()=>{let T=n||document.activeElement===t.current;if(r==="none"||!T)return;let A=setTimeout(b,0),O=setTimeout(b,2e3),P=setTimeout(b,5e3),I=setTimeout(()=>{y(!0)},6e3);return()=>{clearTimeout(A),clearTimeout(O),clearTimeout(P),clearTimeout(I)}},[t,n,r,b]),{hasPWMBadge:s,willPushPWMBadge:S,PWM_BADGE_SPACE_WIDTH:WOe}}var oae=V.createContext({}),lae=V.forwardRef((e,t)=>{var r=e,{value:n,onChange:s,maxLength:o,textAlign:h="left",pattern:i,placeholder:m,inputMode:y="numeric",onComplete:S,pushPasswordManagerStrategy:b="increase-width",pasteTransformer:T,containerClassName:A,noScriptCSSFallback:O=XOe,render:P,children:I}=r,R=VOe(r,["value","onChange","maxLength","textAlign","pattern","placeholder","inputMode","onComplete","pushPasswordManagerStrategy","pasteTransformer","containerClassName","noScriptCSSFallback","render","children"]),M,F,z,$,W;let[K,ee]=V.useState(typeof R.defaultValue=="string"?R.defaultValue:""),ne=n??K,ie=HOe(ne),re=V.useCallback(Lt=>{s==null||s(Lt),ee(Lt)},[s]),te=V.useMemo(()=>i?typeof i=="string"?new RegExp(i):i:null,[i]),ae=V.useRef(null),ue=V.useRef(null),be=V.useRef({value:ne,onChange:re,isIOS:typeof window<"u"&&((F=(M=window==null?void 0:window.CSS)==null?void 0:M.supports)==null?void 0:F.call(M,"-webkit-touch-callout","none"))}),we=V.useRef({prev:[(z=ae.current)==null?void 0:z.selectionStart,($=ae.current)==null?void 0:$.selectionEnd,(W=ae.current)==null?void 0:W.selectionDirection]});V.useImperativeHandle(t,()=>ae.current,[]),V.useEffect(()=>{let Lt=ae.current,nr=ue.current;if(!Lt||!nr)return;be.current.value!==Lt.value&&be.current.onChange(Lt.value),we.current.prev=[Lt.selectionStart,Lt.selectionEnd,Lt.selectionDirection];function Rr(){if(document.activeElement!==Lt){pe(null),Je(null);return}let wt=Lt.selectionStart,He=Lt.selectionEnd,lt=Lt.selectionDirection,ut=Lt.maxLength,sr=Lt.value,Qt=we.current.prev,er=-1,Cr=-1,dn;if(sr.length!==0&&wt!==null&&He!==null){let Di=wt===He,ka=wt===sr.length&&sr.length<ut;if(Di&&!ka){let xs=wt;if(xs===0)er=0,Cr=1,dn="forward";else if(xs===ut)er=xs-1,Cr=xs,dn="backward";else if(ut>1&&sr.length>1){let mi=0;if(Qt[0]!==null&&Qt[1]!==null){dn=xs<Qt[1]?"backward":"forward";let Ua=Qt[0]===Qt[1]&&Qt[0]<ut;dn==="backward"&&!Ua&&(mi=-1)}er=mi+xs,Cr=mi+xs+1}}er!==-1&&Cr!==-1&&er!==Cr&&ae.current.setSelectionRange(er,Cr,dn)}let fn=er!==-1?er:wt,Zn=Cr!==-1?Cr:He,Gn=dn??lt;pe(fn),Je(Zn),we.current.prev=[fn,Zn,Gn]}if(document.addEventListener("selectionchange",Rr,{capture:!0}),Rr(),document.activeElement===Lt&&Ae(!0),!document.getElementById("input-otp-style")){let wt=document.createElement("style");if(wt.id="input-otp-style",document.head.appendChild(wt),wt.sheet){let He="background: transparent !important; color: transparent !important; border-color: transparent !important; opacity: 0 !important; box-shadow: none !important; -webkit-box-shadow: none !important; -webkit-text-fill-color: transparent !important;";qS(wt.sheet,"[data-input-otp]::selection { background: transparent !important; color: transparent !important; }"),qS(wt.sheet,`[data-input-otp]:autofill { ${He} }`),qS(wt.sheet,`[data-input-otp]:-webkit-autofill { ${He} }`),qS(wt.sheet,"@supports (-webkit-touch-callout: none) { [data-input-otp] { letter-spacing: -.6em !important; font-weight: 100 !important; font-stretch: ultra-condensed; font-optical-sizing: none !important; left: -1px !important; right: 1px !important; } }"),qS(wt.sheet,"[data-input-otp] + * { pointer-events: all !important; }")}}let Dr=()=>{nr&&nr.style.setProperty("--root-height",`${Lt.clientHeight}px`)};Dr();let Pt=new ResizeObserver(Dr);return Pt.observe(Lt),()=>{document.removeEventListener("selectionchange",Rr,{capture:!0}),Pt.disconnect()}},[]);let[Ce,_e]=V.useState(!1),[me,Ae]=V.useState(!1),[ge,pe]=V.useState(null),[Oe,Je]=V.useState(null);V.useEffect(()=>{qOe(()=>{var Lt,nr,Rr,Dr;(Lt=ae.current)==null||Lt.dispatchEvent(new Event("input"));let Pt=(nr=ae.current)==null?void 0:nr.selectionStart,wt=(Rr=ae.current)==null?void 0:Rr.selectionEnd,He=(Dr=ae.current)==null?void 0:Dr.selectionDirection;Pt!==null&&wt!==null&&(pe(Pt),Je(wt),we.current.prev=[Pt,wt,He])})},[ne,me]),V.useEffect(()=>{ie!==void 0&&ne!==ie&&ie.length<o&&ne.length===o&&(S==null||S(ne))},[o,S,ie,ne]);let Ze=ZOe({containerRef:ue,inputRef:ae,pushPasswordManagerStrategy:b,isFocused:me}),Pe=V.useCallback(Lt=>{let nr=Lt.currentTarget.value.slice(0,o);if(nr.length>0&&te&&!te.test(nr)){Lt.preventDefault();return}typeof ie=="string"&&nr.length<ie.length&&document.dispatchEvent(new Event("selectionchange")),re(nr)},[o,re,ie,te]),Be=V.useCallback(()=>{var Lt;if(ae.current){let nr=Math.min(ae.current.value.length,o-1),Rr=ae.current.value.length;(Lt=ae.current)==null||Lt.setSelectionRange(nr,Rr),pe(nr),Je(Rr)}Ae(!0)},[o]),nt=V.useCallback(Lt=>{var nr,Rr;let Dr=ae.current;if(!T&&(!be.current.isIOS||!Lt.clipboardData||!Dr))return;let Pt=Lt.clipboardData.getData("text/plain"),wt=T?T(Pt):Pt;Lt.preventDefault();let He=(nr=ae.current)==null?void 0:nr.selectionStart,lt=(Rr=ae.current)==null?void 0:Rr.selectionEnd,ut=(He!==lt?ne.slice(0,He)+wt+ne.slice(lt):ne.slice(0,He)+wt+ne.slice(He)).slice(0,o);if(ut.length>0&&te&&!te.test(ut))return;Dr.value=ut,re(ut);let sr=Math.min(ut.length,o-1),Qt=ut.length;Dr.setSelectionRange(sr,Qt),pe(sr),Je(Qt)},[o,re,te,ne]),Me=V.useMemo(()=>({position:"relative",cursor:R.disabled?"default":"text",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"none"}),[R.disabled]),We=V.useMemo(()=>({position:"absolute",inset:0,width:Ze.willPushPWMBadge?`calc(100% + ${Ze.PWM_BADGE_SPACE_WIDTH})`:"100%",clipPath:Ze.willPushPWMBadge?`inset(0 ${Ze.PWM_BADGE_SPACE_WIDTH} 0 0)`:void 0,height:"100%",display:"flex",textAlign:h,opacity:"1",color:"transparent",pointerEvents:"all",background:"transparent",caretColor:"transparent",border:"0 solid transparent",outline:"0 solid transparent",boxShadow:"none",lineHeight:"1",letterSpacing:"-.5em",fontSize:"var(--root-height)",fontFamily:"monospace",fontVariantNumeric:"tabular-nums"}),[Ze.PWM_BADGE_SPACE_WIDTH,Ze.willPushPWMBadge,h]),gt=V.useMemo(()=>V.createElement("input",UOe($Oe({autoComplete:R.autoComplete||"one-time-code"},R),{"data-input-otp":!0,"data-input-otp-placeholder-shown":ne.length===0||void 0,"data-input-otp-mss":ge,"data-input-otp-mse":Oe,inputMode:y,pattern:te==null?void 0:te.source,"aria-placeholder":m,style:We,maxLength:o,value:ne,ref:ae,onPaste:Lt=>{var nr;nt(Lt),(nr=R.onPaste)==null||nr.call(R,Lt)},onChange:Pe,onMouseOver:Lt=>{var nr;_e(!0),(nr=R.onMouseOver)==null||nr.call(R,Lt)},onMouseLeave:Lt=>{var nr;_e(!1),(nr=R.onMouseLeave)==null||nr.call(R,Lt)},onFocus:Lt=>{var nr;Be(),(nr=R.onFocus)==null||nr.call(R,Lt)},onBlur:Lt=>{var nr;Ae(!1),(nr=R.onBlur)==null||nr.call(R,Lt)}})),[Pe,Be,nt,y,We,o,Oe,ge,R,te==null?void 0:te.source,ne]),rt=V.useMemo(()=>({slots:Array.from({length:o}).map((Lt,nr)=>{var Rr;let Dr=me&&ge!==null&&Oe!==null&&(ge===Oe&&nr===ge||nr>=ge&&nr<Oe),Pt=ne[nr]!==void 0?ne[nr]:null,wt=ne[0]!==void 0?null:(Rr=m==null?void 0:m[nr])!=null?Rr:null;return{char:Pt,placeholderChar:wt,isActive:Dr,hasFakeCaret:Dr&&Pt===null}}),isFocused:me,isHovering:!R.disabled&&Ce}),[me,Ce,o,Oe,ge,R.disabled,ne]),Ht=V.useMemo(()=>P?P(rt):V.createElement(oae.Provider,{value:rt},I),[I,rt,P]);return V.createElement(V.Fragment,null,O!==null&&V.createElement("noscript",null,V.createElement("style",null,O)),V.createElement("div",{ref:ue,"data-input-otp-container":!0,style:Me,className:A},Ht,V.createElement("div",{style:{position:"absolute",inset:0,pointerEvents:"none"}},gt)))});lae.displayName="Input";function qS(e,t){try{e.insertRule(t)}catch{console.error("input-otp could not insert CSS rule:",t)}}var XOe=`
[data-input-otp] {
  --nojs-bg: white !important;
  --nojs-fg: black !important;

  background-color: var(--nojs-bg) !important;
  color: var(--nojs-fg) !important;
  caret-color: var(--nojs-fg) !important;
  letter-spacing: .25em !important;
  text-align: center !important;
  border: 1px solid var(--nojs-fg) !important;
  border-radius: 4px !important;
  width: 100% !important;
}
@media (prefers-color-scheme: dark) {
  [data-input-otp] {
    --nojs-bg: black !important;
    --nojs-fg: white !important;
  }
}`;const D5=V.forwardRef(({className:e,containerClassName:t,...r},n)=>d.jsx(lae,{ref:n,containerClassName:fr("flex items-center gap-2 has-[:disabled]:opacity-50",t),className:fr("disabled:cursor-not-allowed",e),...r}));D5.displayName="InputOTP";const L5=V.forwardRef(({className:e,...t},r)=>d.jsx("div",{ref:r,className:fr("flex items-center",e),...t}));L5.displayName="InputOTPGroup";const qf=V.forwardRef(({index:e,className:t,...r},n)=>{const s=V.useContext(oae),{char:o,hasFakeCaret:h,isActive:i}=s.slots[e];return d.jsxs("div",{ref:n,className:fr("relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",i&&"z-10 ring-2 ring-ring ring-offset-background",t),...r,children:[o,h&&d.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:d.jsx("div",{className:"animate-caret-blink h-4 w-px bg-foreground duration-1000"})})]})});qf.displayName="InputOTPSlot";const YOe=V.forwardRef(({...e},t)=>d.jsx("div",{ref:t,role:"separator",...e,children:d.jsx(A_e,{})}));YOe.displayName="InputOTPSeparator";const F5=({targetType:e,targetId:t,trigger:r})=>{const{t:n}=ci(),{user:s}=Kn(),[o,h]=V.useState(!1),[i,m]=V.useState(!1),[y,S]=V.useState(!1),[b,T]=V.useState(""),[A,O]=V.useState(""),[P,I]=V.useState((s==null?void 0:s.email)||""),[R,M]=V.useState([""]),[F,z]=V.useState([]),[$,W]=V.useState(!1),[K,ee]=V.useState("form"),[ne,ie]=V.useState(""),[re,te]=V.useState(0),[ae,ue]=V.useState(!1),be=Me=>{h(Me),Me&&(s!=null&&s.email)&&I(s.email),Me||(ee("form"),ie(""),te(0))};V.useEffect(()=>{let Me;return re>0&&(Me=setTimeout(()=>te(re-1),1e3)),()=>clearTimeout(Me)},[re]);const we=["spam","harassment","inappropriate_content","misinformation","copyright","fraud","hate_speech","violence","other"],Ce=()=>{M([...R,""])},_e=Me=>{M(R.filter((We,gt)=>gt!==Me))},me=(Me,We)=>{const gt=[...R];gt[Me]=We,M(gt)},Ae=Me=>{const We=Array.from(Me.target.files||[]);if(We.filter(Lt=>Lt.size>5*1024*1024).length>0){kr.error(n("report.imageTooLarge"));return}const rt=["image/jpeg","image/png","image/webp","image/gif"];if(We.filter(Lt=>!rt.includes(Lt.type)).length>0){kr.error(n("report.invalidImageType"));return}z(Lt=>[...Lt,...We])},ge=Me=>{z(We=>We.filter((gt,rt)=>rt!==Me))},pe=async()=>{if(F.length===0)return[];W(!0);const Me=[];try{for(const We of F){const gt=We.name.split(".").pop(),Ht=`${`${Date.now()}-${Math.random().toString(36).substring(7)}.${gt}`}`,{error:Lt}=await Ct.storage.from("report-evidence").upload(Ht,We);if(Lt)throw Lt;const{data:nr}=Ct.storage.from("report-evidence").getPublicUrl(Ht);Me.push(nr.publicUrl)}return Me}catch(We){throw console.error("Error uploading images:",We),We}finally{W(!1)}},Oe=async()=>{if(!P.trim()){kr.error(n("report.contactRequired"));return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(P)){kr.error(n("report.invalidEmail"));return}ue(!0);try{const{error:Me}=await Ct.functions.invoke("send-verification-code",{body:{email:P}});if(Me){kr.error(n("auth.verificationCodeFailed")),console.error(Me);return}ee("verify"),kr.success(n("auth.verificationCodeSent")),te(30)}catch(Me){kr.error(Me.message||n("error.general"))}finally{ue(!1)}},Je=async()=>{re>0||await Oe()},Ze=async()=>{if(ne.length!==4){kr.error(n("auth.invalidVerificationCode"));return}S(!0);try{const{data:Me,error:We}=await Ct.functions.invoke("verify-email-code",{body:{email:P,code:ne}});if(We||!(Me!=null&&Me.success)){(Me==null?void 0:Me.error)==="This verification code has already been used"?kr.error(n("auth.verificationCodeUsed")):kr.error((Me==null?void 0:Me.error)||n("auth.invalidVerificationCode")),S(!1);return}ee("submitting"),await Be()}catch(Me){kr.error(Me.message||n("error.general")),S(!1)}},Pe=async()=>{if(!b){kr.error(n("report.reasonPlaceholder"));return}if(!A||A.length<20){kr.error(n("report.detailsMin"));return}if(!P.trim()){kr.error(n("report.contactRequired"));return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(P)){kr.error(n("report.invalidEmail"));return}if(R.filter(We=>We.trim()!=="").length===0&&F.length===0){kr.error(n("report.evidenceRequired"));return}s?m(!0):await Oe()},Be=async()=>{S(!0);try{let Me=[];try{Me=await pe()}catch{kr.error(n("report.imageUploadFailed")),S(!1);return}const gt=[...R.filter(Pt=>Pt.trim()!==""),...Me],rt={reporter_id:(s==null?void 0:s.id)||null,target_type:e,target_id:t,reason:b,description:A,evidence_urls:gt,reporter_contact:P};console.log("Attempting to insert report:",rt);const{data:Ht,error:Lt}=await Ct.from("reports").insert(rt).select().single();if(console.log("Insert result:",{report:Ht,error:Lt}),Lt)throw Lt;let nr="Anonymous",Rr=P;if(s){const{data:Pt}=await Ct.from("profiles").select("display_name").eq("id",s.id).single();nr=(Pt==null?void 0:Pt.display_name)||"Unknown",Rr=s.email||P}await Ct.functions.invoke("send-report-email",{body:{reportId:Ht.id,reporterName:nr,reporterEmail:Rr,targetType:e,targetId:t,reason:b,description:A,evidenceUrls:gt.length>0?gt:void 0,reporterContact:P||void 0}});const Dr=Ht.id.substring(0,8).toUpperCase();kr.success(n("report.successDetailed",{reference:Dr}),{description:n("report.successDescription"),duration:8e3}),h(!1),m(!1),T(""),O(""),s||I(""),M([""]),z([]),ee("form"),ie("")}catch(Me){console.error("Error submitting report:",Me),kr.error(n("report.failed"))}finally{S(!1)}},nt=()=>{switch(e){case"comment":return n("report.reportComment");case"restaurant":return n("report.reportRestaurant");case"activity":return n("report.reportActivity");case"user":return n("report.reportUser");default:return n("report.title")}};return d.jsxs(d.Fragment,{children:[d.jsxs(fl,{open:o,onOpenChange:be,children:[d.jsx(tf,{asChild:!0,children:r||d.jsxs(Mt,{variant:"ghost",size:"sm",children:[d.jsx(nN,{className:"w-4 h-4 mr-2"}),n("report.title")]})}),d.jsxs(Jo,{className:"max-w-[90vw] sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[d.jsxs(Qo,{children:[d.jsx(el,{children:nt()}),d.jsx(Ul,{children:n(K==="verify"?"auth.verificationCodeSent":"report.description")})]}),K==="form"?d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"space-y-4 py-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"reason",children:n("report.reason")}),d.jsxs(Qs,{value:b,onValueChange:T,children:[d.jsx(Gs,{children:d.jsx(ea,{placeholder:n("report.reasonPlaceholder")})}),d.jsx(Ws,{children:we.map(Me=>d.jsx(nn,{value:Me,children:n(`report.reasons.${Me}`)},Me))})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"description",children:n("report.detailsLabel")}),d.jsx(hl,{id:"description",value:A,onChange:Me=>O(Me.target.value),placeholder:n("report.detailsPlaceholder"),rows:5,className:"resize-none"}),d.jsxs("p",{className:"text-xs text-muted-foreground",children:[A.length,"/20 ",n("common.characters")]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs(yr,{htmlFor:"contact",children:[n("report.contactLabel"),d.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),d.jsx(cr,{id:"contact",type:"email",value:P,onChange:Me=>I(Me.target.value),placeholder:n("report.contactPlaceholder"),required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs(yr,{children:[n("report.evidenceLabel"),d.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),d.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:n("report.evidenceRequiredNote")}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"image-upload",className:"text-sm font-medium",children:n("report.uploadImages")}),d.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:F.map((Me,We)=>d.jsxs("div",{className:"relative group",children:[d.jsx("img",{src:URL.createObjectURL(Me),alt:`Evidence ${We+1}`,className:"w-20 h-20 object-cover rounded border"}),d.jsx(Mt,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>ge(We),children:d.jsx(Xc,{className:"w-3 h-3"})})]},We))}),d.jsx(cr,{id:"image-upload",type:"file",accept:"image/jpeg,image/png,image/webp,image/gif",multiple:!0,onChange:Ae,className:"cursor-pointer"}),d.jsx("p",{className:"text-xs text-muted-foreground",children:n("report.imageUploadHint")})]}),d.jsxs("div",{className:"space-y-2 pt-2",children:[d.jsx(yr,{className:"text-sm font-medium",children:n("report.evidenceUrls")}),R.map((Me,We)=>d.jsxs("div",{className:"flex gap-2",children:[d.jsx(cr,{value:Me,onChange:gt=>me(We,gt.target.value),placeholder:n("report.evidencePlaceholder")}),R.length>1&&d.jsx(Mt,{variant:"ghost",size:"icon",onClick:()=>_e(We),children:d.jsx(Xc,{className:"w-4 h-4"})})]},We)),d.jsxs(Mt,{variant:"outline",size:"sm",onClick:Ce,className:"w-full",children:[d.jsx(sp,{className:"w-4 h-4 mr-2"}),n("report.addEvidence")]})]})]})]}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Mt,{variant:"outline",onClick:()=>h(!1),children:n("report.cancel")}),d.jsx(Mt,{onClick:Pe,disabled:!b||A.length<20||!P.trim()||R.filter(Me=>Me.trim()!=="").length===0&&F.length===0||$||ae,children:n($?"common.uploading":ae?"auth.sendingCode":"report.submit")})]})]}):K==="submitting"?d.jsx("div",{className:"space-y-4 py-8",children:d.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4",children:[d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"}),d.jsx("p",{className:"text-center text-muted-foreground",children:n("report.submitting")})]})}):d.jsxs("div",{className:"space-y-4 py-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{children:n("auth.verificationCode")}),d.jsx("div",{className:"flex justify-center",children:d.jsx(D5,{maxLength:4,value:ne,onChange:Me=>ie(Me),children:d.jsxs(L5,{children:[d.jsx(qf,{index:0}),d.jsx(qf,{index:1}),d.jsx(qf,{index:2}),d.jsx(qf,{index:3})]})})}),d.jsx("p",{className:"text-xs text-muted-foreground text-center",children:n("auth.verificationCodeHint",{email:P})})]}),d.jsx("div",{className:"flex justify-center",children:d.jsx(Mt,{variant:"link",size:"sm",onClick:Je,disabled:re>0||y,children:re>0?`${n("auth.resendCode")} (${re}s)`:n("auth.resendCode")})}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx(Mt,{variant:"outline",className:"w-full",onClick:()=>{ee("form"),ie("")},disabled:y,children:n("common.back")}),d.jsx(Mt,{className:"w-full",onClick:Ze,disabled:ne.length!==4||y,children:n(y?"auth.verifying":"auth.verify")})]})]})]})]}),d.jsx(ko,{open:i,onOpenChange:m,children:d.jsxs(co,{children:[d.jsxs(uo,{children:[d.jsx(fo,{children:n("report.confirmTitle")}),d.jsx(po,{children:n("report.confirmMessage")})]}),d.jsxs(ho,{children:[d.jsx(mo,{children:n("report.cancel")}),d.jsx(to,{onClick:Be,disabled:y,children:n(y?"report.submitting":"report.submit")})]})]})})]})},TG=[{value:"0-5",label:"0-5"},{value:"5-10",label:"5-10"},{value:"10-15",label:"10-15"},{value:"15-20",label:"15-20"},{value:"20-25",label:"20-25"},{value:"25-30",label:"25-30"},{value:"30-40",label:"30-40"},{value:"40-50",label:"40-50"},{value:"50+",label:"50+"}],cae=({restaurantId:e,targetType:t="restaurant"})=>{var Oe,Je;const{t:r}=ci(),{user:n}=Kn(),{data:s}=CN(),{toast:o}=Ri(),[h,i]=V.useState(""),[m,y]=V.useState(0),[S,b]=V.useState(0),[T,A]=V.useState(""),[O,P]=V.useState(null),[I,R]=V.useState(""),[M,F]=V.useState(null),[z,$]=V.useState(null),[W,K]=V.useState(null),[ee,ne]=V.useState(null),[ie,re]=V.useState(!1),{data:te,isLoading:ae}=R5(e,t),ue=UPe(),be=VPe(),we=V.useCallback(async Ze=>{try{const Pe=Ze.name.split(".").pop(),nt=`${`${n==null?void 0:n.id}-${Date.now()}.${Pe}`}`,{error:Me,data:We}=await Ct.storage.from("comment-images").upload(nt,Ze);if(Me)throw Me;const{data:{publicUrl:gt}}=Ct.storage.from("comment-images").getPublicUrl(nt);return gt}catch(Pe){return console.error("Error uploading image:",Pe),o({title:r("common.error"),description:r("restaurant.imageUploadFailed"),variant:"destructive"}),null}},[n,o,r]),Ce=V.useCallback((Ze,Pe=!1)=>{var nt;const Be=(nt=Ze.target.files)==null?void 0:nt[0];if(Be){if(Be.size>5*1024*1024){o({title:r("common.error"),description:r("restaurant.imageTooLarge"),variant:"destructive"});return}Pe?(K(Be),ne(URL.createObjectURL(Be))):(F(Be),$(URL.createObjectURL(Be)))}},[o,r]),_e=V.useCallback((Ze=!1)=>{Ze?(K(null),ne(null)):(F(null),$(null))},[]),me=V.useCallback(async()=>{if(!h.trim()||!n)return;if(t==="restaurant"&&!m){o({title:r("common.error"),description:r("toast.pleaseSelectRating"),variant:"destructive"});return}re(!0);let Ze;if(M){const Pe=await we(M);Pe&&(Ze=Pe)}await ue.mutateAsync({targetId:e,targetType:t,content:h,ratingValue:t==="restaurant"?m:void 0,priceRange:t==="restaurant"&&T?T:void 0,imageUrl:Ze}),i(""),y(0),A(""),F(null),$(null),re(!1)},[h,n,t,m,o,r,M,we,ue,e,T]),Ae=V.useCallback(async Ze=>{if(!I.trim()||!n)return;re(!0);let Pe;if(W){const Be=await we(W);Be&&(Pe=Be)}await ue.mutateAsync({targetId:e,targetType:t,content:I,parentId:Ze,imageUrl:Pe}),R(""),P(null),K(null),ne(null),re(!1)},[I,n,W,we,ue,e,t]),ge=V.useCallback(async Ze=>{window.confirm(r("restaurant.confirmDelete"))&&await be.mutateAsync(Ze)},[be,r]),pe=V.memo(({comment:Ze,isReply:Pe=!1})=>{var Be,nt,Me,We,gt;return d.jsxs("div",{className:`flex gap-2 sm:gap-3 ${Pe?"ml-8 sm:ml-12 mt-3":""}`,children:[d.jsxs(Ju,{className:"w-8 h-8 sm:w-10 sm:h-10 shrink-0",children:[d.jsx(Qu,{src:(Be=Ze.profiles)==null?void 0:Be.avatar_url}),d.jsx(ed,{className:"text-xs sm:text-sm",children:((Me=(nt=Ze.profiles)==null?void 0:nt.display_name)==null?void 0:Me.charAt(0).toUpperCase())||"U"})]}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[d.jsx("span",{className:"font-semibold text-xs sm:text-sm truncate",children:(We=Ze.profiles)==null?void 0:We.display_name}),d.jsx("span",{className:"text-xs text-muted-foreground shrink-0",children:wg(new Date(Ze.created_at),{addSuffix:!0})}),Ze.edited&&d.jsxs("span",{className:"text-xs text-muted-foreground italic",children:["(",r("restaurant.edited"),")"]})]}),!Pe&&Ze.rating_value&&d.jsxs("div",{className:"flex items-center gap-3 mt-1 mb-2",children:[d.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(rt=>d.jsx(Al,{className:fr("w-4 h-4",rt<=Ze.rating_value?"fill-accent text-accent":"text-muted-foreground")},rt))}),Ze.price_range&&d.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[d.jsx(qP,{className:"w-3 h-3"}),d.jsx("span",{children:(gt=TG.find(rt=>rt.value===Ze.price_range))==null?void 0:gt.label})]})]}),d.jsx("p",{className:"text-xs sm:text-sm mt-1 text-foreground break-words",children:Ze.content}),Ze.image_url&&d.jsx("img",{src:Ze.image_url,alt:"Comment attachment",className:"mt-2 rounded-lg max-w-full sm:max-w-sm w-full"}),d.jsxs("div",{className:"flex gap-2 sm:gap-3 mt-2",children:[!Pe&&n&&d.jsxs(Mt,{variant:"ghost",size:"sm",onClick:()=>P(Ze.id),className:"h-7 text-xs px-2 sm:px-3",children:[d.jsx(z_e,{className:"w-3 h-3 mr-1"}),d.jsx("span",{className:"hidden xs:inline",children:r("restaurant.reply")})]}),(n==null?void 0:n.id)===Ze.user_id&&d.jsxs(Mt,{variant:"ghost",size:"sm",onClick:()=>ge(Ze.id),className:"h-7 text-xs text-destructive hover:text-destructive px-2 sm:px-3",children:[d.jsx(Yh,{className:"w-3 h-3 mr-1"}),d.jsx("span",{className:"hidden xs:inline",children:r("common.delete")})]}),n&&n.id!==Ze.user_id&&d.jsx(F5,{targetType:"comment",targetId:Ze.id,trigger:d.jsxs(Mt,{variant:"ghost",size:"sm",className:"h-7 text-xs px-2 sm:px-3",children:[d.jsx(nN,{className:"w-3 h-3 mr-1"}),d.jsx("span",{className:"hidden xs:inline",children:r("report.title")})]})})]}),O===Ze.id&&d.jsx("div",{className:"mt-3 space-y-2",children:d.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[d.jsxs("div",{className:"flex-1 space-y-2",children:[d.jsx(hl,{value:I,onChange:rt=>R(rt.target.value),placeholder:r("restaurant.writeReply"),className:"min-h-[80px] text-sm"}),ee&&d.jsxs("div",{className:"relative inline-block max-w-full",children:[d.jsx("img",{src:ee,alt:"Preview",className:"max-w-full sm:max-w-xs rounded-lg"}),d.jsx(Mt,{size:"icon",variant:"destructive",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full",onClick:()=>_e(!0),children:d.jsx(Xc,{className:"h-4 w-4"})})]})]}),d.jsxs("div",{className:"flex sm:flex-col gap-2",children:[d.jsx(Mt,{size:"sm",onClick:()=>Ae(Ze.id),disabled:!I.trim()||ie,className:"text-xs",children:r(ie?"common.loading":"restaurant.reply")}),d.jsx(cr,{type:"file",accept:"image/*",onChange:rt=>Ce(rt,!0),className:"hidden",id:`reply-image-${Ze.id}`,disabled:ie}),d.jsxs(Mt,{size:"sm",variant:"outline",onClick:()=>{var rt;return(rt=document.getElementById(`reply-image-${Ze.id}`))==null?void 0:rt.click()},disabled:ie,className:"text-xs sm:px-3",children:[d.jsx(L9,{className:"h-4 w-4 sm:mr-1"}),d.jsx("span",{className:"hidden sm:inline",children:r("restaurant.addImage")})]}),d.jsx(Mt,{size:"sm",variant:"outline",onClick:()=>{P(null),R(""),_e(!0)},className:"text-xs",children:r("common.cancel")})]})]})}),Ze.replies&&Ze.replies.length>0&&d.jsx("div",{className:"mt-3 space-y-3",children:Ze.replies.map(rt=>d.jsx(pe,{comment:rt,isReply:!0},rt.id))})]})]})});return pe.displayName="CommentItem",ae?d.jsx("div",{className:"text-center py-8",children:r("common.loading")}):d.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(GP,{className:"w-4 sm:w-5 h-4 sm:h-5"}),d.jsxs("h2",{className:"text-xl sm:text-2xl font-bold",children:[r("restaurant.reviews")," (",(te==null?void 0:te.length)||0,")"]})]}),n?d.jsx(Nr,{children:d.jsx(Mr,{className:"pt-4 sm:pt-6 px-3 sm:px-6",children:d.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[d.jsxs(Ju,{className:"w-8 h-8 sm:w-10 sm:h-10 shrink-0",children:[d.jsx(Qu,{src:(s==null?void 0:s.avatar_url)||void 0}),d.jsx(ed,{className:"text-xs sm:text-sm",children:((Oe=s==null?void 0:s.display_name)==null?void 0:Oe.charAt(0).toUpperCase())||((Je=n==null?void 0:n.email)==null?void 0:Je.charAt(0).toUpperCase())||"U"})]}),d.jsxs("div",{className:"flex-1 space-y-2 sm:space-y-3 min-w-0",children:[t==="restaurant"&&d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[d.jsx(Al,{className:"w-4 h-4 text-accent"})," ",d.jsx("span",{className:"text-destructive",children:"*"})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[[1,2,3,4,5].map(Ze=>d.jsx("button",{type:"button",onMouseEnter:()=>b(Ze),onMouseLeave:()=>b(0),onClick:()=>y(Ze),className:"transition-transform hover:scale-110",children:d.jsx(Al,{className:fr("w-7 h-7 cursor-pointer transition-colors",Ze<=(S||m)?"fill-accent text-accent":"text-muted-foreground hover:text-accent")})},Ze)),m>0&&d.jsxs("span",{className:"ml-2 text-sm text-muted-foreground",children:["(",m,"/5)"]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[d.jsx(qP,{className:"w-4 h-4"}),r("restaurant.priceRange")]}),d.jsxs(Qs,{value:T,onValueChange:A,children:[d.jsx(Gs,{className:"w-full",children:d.jsx(ea,{placeholder:r("restaurant.selectPriceRange")})}),d.jsx(Ws,{className:"bg-background",children:TG.map(Ze=>d.jsx(nn,{value:Ze.value,children:Ze.label},Ze.value))})]})]})]}),d.jsx(hl,{value:h,onChange:Ze=>i(Ze.target.value),placeholder:r("restaurant.writeComment"),className:"min-h-[80px] sm:min-h-[100px] text-sm"}),z&&d.jsxs("div",{className:"relative inline-block max-w-full",children:[d.jsx("img",{src:z,alt:"Preview",className:"max-w-full sm:max-w-xs rounded-lg"}),d.jsx(Mt,{size:"icon",variant:"destructive",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full",onClick:()=>_e(!1),children:d.jsx(Xc,{className:"h-4 w-4"})})]}),d.jsxs("div",{className:"flex flex-wrap gap-2",children:[d.jsx(cr,{type:"file",accept:"image/*",onChange:Ze=>Ce(Ze,!1),className:"hidden",id:"comment-image",disabled:ie}),d.jsxs(Mt,{variant:"outline",size:"sm",onClick:()=>{var Ze;return(Ze=document.getElementById("comment-image"))==null?void 0:Ze.click()},disabled:ie,className:"text-xs",children:[d.jsx(L9,{className:"h-4 w-4 sm:mr-2"}),d.jsx("span",{className:"hidden sm:inline",children:r("restaurant.addImage")})]}),d.jsx(Mt,{onClick:me,disabled:!h.trim()||ue.isPending||ie,size:"sm",className:"text-xs",children:ie||ue.isPending?r("common.loading"):r("restaurant.postComment")})]})]})]})})}):d.jsx(Nr,{children:d.jsx(Mr,{className:"py-4 sm:py-6 px-3 sm:px-6 text-center text-muted-foreground text-sm",children:r("restaurant.signInToComment")})}),d.jsx("div",{className:"space-y-4 sm:space-y-6",children:te==null?void 0:te.map(Ze=>d.jsx(Nr,{children:d.jsx(Rn,{className:"p-3 sm:p-6",children:d.jsx(pe,{comment:Ze})})},Ze.id))}),(te==null?void 0:te.length)===0&&d.jsx(Nr,{children:d.jsx(Mr,{className:"py-8 sm:py-12 px-3 sm:px-6 text-center text-muted-foreground text-sm",children:r("restaurant.noComments")})})]})},F2=()=>{const{user:e}=Kn();return ei({queryKey:["merchantRestaurants",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ct.from("merchant_restaurants").select(`
          restaurant_id,
          restaurants:restaurant_id (
            id,
            name,
            name_en,
            name_pt,
            address,
            image_url,
            lat,
            lng,
            rating,
            type,
            type_en,
            type_pt,
            phone,
            website_url,
            description,
            description_en,
            description_pt,
            opening_hours,
            show_website_button,
            created_at,
            updated_at
          )
        `).eq("user_id",e.id);if(r)throw r;return(t==null?void 0:t.map(n=>n.restaurants).filter(Boolean))||[]},enabled:!!e})},JOe=e=>{const{user:t}=Kn(),{data:r=[]}=F2();return ei({queryKey:["myParticipatingRestaurants",e,t==null?void 0:t.id],queryFn:async()=>{if(!t||r.length===0)return[];const n=r.map(h=>h.id),{data:s,error:o}=await Ct.from("activity_restaurants").select("restaurant_id").eq("activity_id",e).in("restaurant_id",n);if(o)throw o;return(s==null?void 0:s.map(h=>h.restaurant_id))||[]},enabled:!!t&&!!e&&r.length>0})},QOe=()=>{const{user:e}=Kn(),{toast:t}=Ri(),r=Mi();return Gi({mutationFn:async({activityId:n,restaurantId:s,skipTermsCheck:o=!1})=>{if(!e)throw new Error("User not authenticated");if(!o){const{data:i}=await Ct.from("profiles").select("activity_terms_agreed").eq("id",e.id).single(),{data:m}=await Ct.from("activity_restaurants").select("id").eq("activity_id",n).eq("restaurant_id",s).maybeSingle();if(!m&&!(i!=null&&i.activity_terms_agreed))throw new Error("TERMS_NOT_AGREED")}const{data:h}=await Ct.from("activity_restaurants").select("id").eq("activity_id",n).eq("restaurant_id",s).maybeSingle();if(h){const{error:i}=await Ct.from("activity_restaurants").delete().eq("id",h.id);if(i)throw i;return{action:"removed"}}else{const{error:i}=await Ct.from("activity_restaurants").insert({activity_id:n,restaurant_id:s});if(i)throw i;return{action:"added"}}},onSuccess:n=>{r.invalidateQueries({queryKey:["activityRestaurants"]}),r.invalidateQueries({queryKey:["myParticipatingRestaurants"]}),t({title:Pr.t(n.action==="added"?"toast.restaurantJoined":"toast.restaurantLeft"),description:Pr.t(n.action==="added"?"toast.restaurantJoinedDesc":"toast.restaurantLeftDesc")})},onError:n=>{n.message==="TERMS_NOT_AGREED"?t({title:Pr.t("toast.termsNotAgreed"),description:Pr.t("toast.termsNotAgreedDesc"),variant:"destructive"}):t({title:Pr.t("toast.participationUpdateFailed"),description:Pr.t("toast.participationUpdateFailedDesc"),variant:"destructive"})}})};var z2=e=>e.type==="checkbox",Xy=e=>e instanceof Date,uc=e=>e==null;const uae=e=>typeof e=="object";var _o=e=>!uc(e)&&!Array.isArray(e)&&uae(e)&&!Xy(e),dae=e=>_o(e)&&e.target?z2(e.target)?e.target.checked:e.target.value:e,eke=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,hae=(e,t)=>e.has(eke(t)),tke=e=>{const t=e.constructor&&e.constructor.prototype;return _o(t)&&t.hasOwnProperty("isPrototypeOf")},z5=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Ho(e){let t;const r=Array.isArray(e),n=typeof FileList<"u"?e instanceof FileList:!1;if(e instanceof Date)t=new Date(e);else if(!(z5&&(e instanceof Blob||n))&&(r||_o(e)))if(t=r?[]:{},!r&&!tke(e))t=e;else for(const s in e)e.hasOwnProperty(s)&&(t[s]=Ho(e[s]));else return e;return t}var zN=e=>/^\w*$/.test(e),lo=e=>e===void 0,B5=e=>Array.isArray(e)?e.filter(Boolean):[],$5=e=>B5(e.replace(/["|']|\]/g,"").split(/\.|\[/)),an=(e,t,r)=>{if(!t||!_o(e))return r;const n=(zN(t)?[t]:$5(t)).reduce((s,o)=>uc(s)?s:s[o],e);return lo(n)||n===e?lo(e[t])?r:e[t]:n},du=e=>typeof e=="boolean",$s=(e,t,r)=>{let n=-1;const s=zN(t)?[t]:$5(t),o=s.length,h=o-1;for(;++n<o;){const i=s[n];let m=r;if(n!==h){const y=e[i];m=_o(y)||Array.isArray(y)?y:isNaN(+s[n+1])?{}:[]}if(i==="__proto__"||i==="constructor"||i==="prototype")return;e[i]=m,e=e[i]}};const vO={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},zd={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Of={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},U5=Ue.createContext(null);U5.displayName="HookFormContext";const BN=()=>Ue.useContext(U5),rke=e=>{const{children:t,...r}=e;return Ue.createElement(U5.Provider,{value:r},t)};var fae=(e,t,r,n=!0)=>{const s={defaultValues:t._defaultValues};for(const o in e)Object.defineProperty(s,o,{get:()=>{const h=o;return t._proxyFormState[h]!==zd.all&&(t._proxyFormState[h]=!n||zd.all),r&&(r[h]=!0),e[h]}});return s};const V5=typeof window<"u"?Ue.useLayoutEffect:Ue.useEffect;function nke(e){const t=BN(),{control:r=t.control,disabled:n,name:s,exact:o}=e||{},[h,i]=Ue.useState(r._formState),m=Ue.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return V5(()=>r._subscribe({name:s,formState:m.current,exact:o,callback:y=>{!n&&i({...r._formState,...y})}}),[s,n,o]),Ue.useEffect(()=>{m.current.isValid&&r._setValid(!0)},[r]),Ue.useMemo(()=>fae(h,r,m.current,!1),[h,r])}var Nh=e=>typeof e=="string",pae=(e,t,r,n,s)=>Nh(e)?(n&&t.watch.add(e),an(r,e,s)):Array.isArray(e)?e.map(o=>(n&&t.watch.add(o),an(r,o))):(n&&(t.watchAll=!0),r),PF=e=>uc(e)||!uae(e);function Bf(e,t,r=new WeakSet){if(PF(e)||PF(t))return e===t;if(Xy(e)&&Xy(t))return e.getTime()===t.getTime();const n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;if(r.has(e)||r.has(t))return!0;r.add(e),r.add(t);for(const o of n){const h=e[o];if(!s.includes(o))return!1;if(o!=="ref"){const i=t[o];if(Xy(h)&&Xy(i)||_o(h)&&_o(i)||Array.isArray(h)&&Array.isArray(i)?!Bf(h,i,r):h!==i)return!1}}return!0}function ike(e){const t=BN(),{control:r=t.control,name:n,defaultValue:s,disabled:o,exact:h,compute:i}=e||{},m=Ue.useRef(s),y=Ue.useRef(i),S=Ue.useRef(void 0);y.current=i;const b=Ue.useMemo(()=>r._getWatch(n,m.current),[r,n]),[T,A]=Ue.useState(y.current?y.current(b):b);return V5(()=>r._subscribe({name:n,formState:{values:!0},exact:h,callback:O=>{if(!o){const P=pae(n,r._names,O.values||r._formValues,!1,m.current);if(y.current){const I=y.current(P);Bf(I,S.current)||(A(I),S.current=I)}else A(P)}}}),[r,o,n,h]),Ue.useEffect(()=>r._removeUnmounted()),T}function ske(e){const t=BN(),{name:r,disabled:n,control:s=t.control,shouldUnregister:o,defaultValue:h}=e,i=hae(s._names.array,r),m=Ue.useMemo(()=>an(s._formValues,r,an(s._defaultValues,r,h)),[s,r,h]),y=ike({control:s,name:r,defaultValue:m,exact:!0}),S=nke({control:s,name:r,exact:!0}),b=Ue.useRef(e),T=Ue.useRef(s.register(r,{...e.rules,value:y,...du(e.disabled)?{disabled:e.disabled}:{}}));b.current=e;const A=Ue.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!an(S.errors,r)},isDirty:{enumerable:!0,get:()=>!!an(S.dirtyFields,r)},isTouched:{enumerable:!0,get:()=>!!an(S.touchedFields,r)},isValidating:{enumerable:!0,get:()=>!!an(S.validatingFields,r)},error:{enumerable:!0,get:()=>an(S.errors,r)}}),[S,r]),O=Ue.useCallback(M=>T.current.onChange({target:{value:dae(M),name:r},type:vO.CHANGE}),[r]),P=Ue.useCallback(()=>T.current.onBlur({target:{value:an(s._formValues,r),name:r},type:vO.BLUR}),[r,s._formValues]),I=Ue.useCallback(M=>{const F=an(s._fields,r);F&&M&&(F._f.ref={focus:()=>M.focus&&M.focus(),select:()=>M.select&&M.select(),setCustomValidity:z=>M.setCustomValidity(z),reportValidity:()=>M.reportValidity()})},[s._fields,r]),R=Ue.useMemo(()=>({name:r,value:y,...du(n)||S.disabled?{disabled:S.disabled||n}:{},onChange:O,onBlur:P,ref:I}),[r,n,S.disabled,O,P,I,y]);return Ue.useEffect(()=>{const M=s._options.shouldUnregister||o;s.register(r,{...b.current.rules,...du(b.current.disabled)?{disabled:b.current.disabled}:{}});const F=(z,$)=>{const W=an(s._fields,z);W&&W._f&&(W._f.mount=$)};if(F(r,!0),M){const z=Ho(an(s._options.defaultValues,r));$s(s._defaultValues,r,z),lo(an(s._formValues,r))&&$s(s._formValues,r,z)}return!i&&s.register(r),()=>{(i?M&&!s._state.action:M)?s.unregister(r):F(r,!1)}},[r,s,i,o]),Ue.useEffect(()=>{s._setDisabledField({disabled:n,name:r})},[n,r,s]),Ue.useMemo(()=>({field:R,formState:S,fieldState:A}),[R,S,A])}const ym=e=>e.render(ske(e));var mae=(e,t,r,n,s)=>t?{...r[e],types:{...r[e]&&r[e].types?r[e].types:{},[n]:s||!0}}:{},RE=e=>Array.isArray(e)?e:[e],AG=()=>{let e=[];return{get observers(){return e},next:s=>{for(const o of e)o.next&&o.next(s)},subscribe:s=>(e.push(s),{unsubscribe:()=>{e=e.filter(o=>o!==s)}}),unsubscribe:()=>{e=[]}}},Dc=e=>_o(e)&&!Object.keys(e).length,q5=e=>e.type==="file",Bd=e=>typeof e=="function",_O=e=>{if(!z5)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},gae=e=>e.type==="select-multiple",H5=e=>e.type==="radio",ake=e=>H5(e)||z2(e),XD=e=>_O(e)&&e.isConnected;function oke(e,t){const r=t.slice(0,-1).length;let n=0;for(;n<r;)e=lo(e)?n++:e[t[n++]];return e}function lke(e){for(const t in e)if(e.hasOwnProperty(t)&&!lo(e[t]))return!1;return!0}function Ao(e,t){const r=Array.isArray(t)?t:zN(t)?[t]:$5(t),n=r.length===1?e:oke(e,r),s=r.length-1,o=r[s];return n&&delete n[o],s!==0&&(_o(n)&&Dc(n)||Array.isArray(n)&&lke(n))&&Ao(e,r.slice(0,-1)),e}var yae=e=>{for(const t in e)if(Bd(e[t]))return!0;return!1};function xO(e,t={}){const r=Array.isArray(e);if(_o(e)||r)for(const n in e)Array.isArray(e[n])||_o(e[n])&&!yae(e[n])?(t[n]=Array.isArray(e[n])?[]:{},xO(e[n],t[n])):uc(e[n])||(t[n]=!0);return t}function vae(e,t,r){const n=Array.isArray(e);if(_o(e)||n)for(const s in e)Array.isArray(e[s])||_o(e[s])&&!yae(e[s])?lo(t)||PF(r[s])?r[s]=Array.isArray(e[s])?xO(e[s],[]):{...xO(e[s])}:vae(e[s],uc(t)?{}:t[s],r[s]):r[s]=!Bf(e[s],t[s]);return r}var HS=(e,t)=>vae(e,t,xO(t));const CG={value:!1,isValid:!1},jG={value:!0,isValid:!0};var _ae=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(r=>r&&r.checked&&!r.disabled).map(r=>r.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!lo(e[0].attributes.value)?lo(e[0].value)||e[0].value===""?jG:{value:e[0].value,isValid:!0}:jG:CG}return CG},xae=(e,{valueAsNumber:t,valueAsDate:r,setValueAs:n})=>lo(e)?e:t?e===""?NaN:e&&+e:r&&Nh(e)?new Date(e):n?n(e):e;const PG={isValid:!1,value:null};var bae=e=>Array.isArray(e)?e.reduce((t,r)=>r&&r.checked&&!r.disabled?{isValid:!0,value:r.value}:t,PG):PG;function OG(e){const t=e.ref;return q5(t)?t.files:H5(t)?bae(e.refs).value:gae(t)?[...t.selectedOptions].map(({value:r})=>r):z2(t)?_ae(e.refs).value:xae(lo(t.value)?e.ref.value:t.value,e)}var cke=(e,t,r,n)=>{const s={};for(const o of e){const h=an(t,o);h&&$s(s,o,h._f)}return{criteriaMode:r,names:[...e],fields:s,shouldUseNativeValidation:n}},bO=e=>e instanceof RegExp,GS=e=>lo(e)?e:bO(e)?e.source:_o(e)?bO(e.value)?e.value.source:e.value:e,kG=e=>({isOnSubmit:!e||e===zd.onSubmit,isOnBlur:e===zd.onBlur,isOnChange:e===zd.onChange,isOnAll:e===zd.all,isOnTouch:e===zd.onTouched});const NG="AsyncFunction";var uke=e=>!!e&&!!e.validate&&!!(Bd(e.validate)&&e.validate.constructor.name===NG||_o(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===NG)),dke=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate),IG=(e,t,r)=>!r&&(t.watchAll||t.watch.has(e)||[...t.watch].some(n=>e.startsWith(n)&&/^\.\w+/.test(e.slice(n.length))));const ME=(e,t,r,n)=>{for(const s of r||Object.keys(e)){const o=an(e,s);if(o){const{_f:h,...i}=o;if(h){if(h.refs&&h.refs[0]&&t(h.refs[0],s)&&!n)return!0;if(h.ref&&t(h.ref,h.name)&&!n)return!0;if(ME(i,t))break}else if(_o(i)&&ME(i,t))break}}};function RG(e,t,r){const n=an(e,r);if(n||zN(r))return{error:n,name:r};const s=r.split(".");for(;s.length;){const o=s.join("."),h=an(t,o),i=an(e,o);if(h&&!Array.isArray(h)&&r!==o)return{name:r};if(i&&i.type)return{name:o,error:i};if(i&&i.root&&i.root.type)return{name:`${o}.root`,error:i.root};s.pop()}return{name:r}}var hke=(e,t,r,n)=>{r(e);const{name:s,...o}=e;return Dc(o)||Object.keys(o).length>=Object.keys(t).length||Object.keys(o).find(h=>t[h]===(!n||zd.all))},fke=(e,t,r)=>!e||!t||e===t||RE(e).some(n=>n&&(r?n===t:n.startsWith(t)||t.startsWith(n))),pke=(e,t,r,n,s)=>s.isOnAll?!1:!r&&s.isOnTouch?!(t||e):(r?n.isOnBlur:s.isOnBlur)?!e:(r?n.isOnChange:s.isOnChange)?e:!0,mke=(e,t)=>!B5(an(e,t)).length&&Ao(e,t),gke=(e,t,r)=>{const n=RE(an(e,r));return $s(n,"root",t[r]),$s(e,r,n),e},fP=e=>Nh(e);function MG(e,t,r="validate"){if(fP(e)||Array.isArray(e)&&e.every(fP)||du(e)&&!e)return{type:r,message:fP(e)?e:"",ref:t}}var Ux=e=>_o(e)&&!bO(e)?e:{value:e,message:""},DG=async(e,t,r,n,s,o)=>{const{ref:h,refs:i,required:m,maxLength:y,minLength:S,min:b,max:T,pattern:A,validate:O,name:P,valueAsNumber:I,mount:R}=e._f,M=an(r,P);if(!R||t.has(P))return{};const F=i?i[0]:h,z=te=>{s&&F.reportValidity&&(F.setCustomValidity(du(te)?"":te||""),F.reportValidity())},$={},W=H5(h),K=z2(h),ee=W||K,ne=(I||q5(h))&&lo(h.value)&&lo(M)||_O(h)&&h.value===""||M===""||Array.isArray(M)&&!M.length,ie=mae.bind(null,P,n,$),re=(te,ae,ue,be=Of.maxLength,we=Of.minLength)=>{const Ce=te?ae:ue;$[P]={type:te?be:we,message:Ce,ref:h,...ie(te?be:we,Ce)}};if(o?!Array.isArray(M)||!M.length:m&&(!ee&&(ne||uc(M))||du(M)&&!M||K&&!_ae(i).isValid||W&&!bae(i).isValid)){const{value:te,message:ae}=fP(m)?{value:!!m,message:m}:Ux(m);if(te&&($[P]={type:Of.required,message:ae,ref:F,...ie(Of.required,ae)},!n))return z(ae),$}if(!ne&&(!uc(b)||!uc(T))){let te,ae;const ue=Ux(T),be=Ux(b);if(!uc(M)&&!isNaN(M)){const we=h.valueAsNumber||M&&+M;uc(ue.value)||(te=we>ue.value),uc(be.value)||(ae=we<be.value)}else{const we=h.valueAsDate||new Date(M),Ce=Ae=>new Date(new Date().toDateString()+" "+Ae),_e=h.type=="time",me=h.type=="week";Nh(ue.value)&&M&&(te=_e?Ce(M)>Ce(ue.value):me?M>ue.value:we>new Date(ue.value)),Nh(be.value)&&M&&(ae=_e?Ce(M)<Ce(be.value):me?M<be.value:we<new Date(be.value))}if((te||ae)&&(re(!!te,ue.message,be.message,Of.max,Of.min),!n))return z($[P].message),$}if((y||S)&&!ne&&(Nh(M)||o&&Array.isArray(M))){const te=Ux(y),ae=Ux(S),ue=!uc(te.value)&&M.length>+te.value,be=!uc(ae.value)&&M.length<+ae.value;if((ue||be)&&(re(ue,te.message,ae.message),!n))return z($[P].message),$}if(A&&!ne&&Nh(M)){const{value:te,message:ae}=Ux(A);if(bO(te)&&!M.match(te)&&($[P]={type:Of.pattern,message:ae,ref:h,...ie(Of.pattern,ae)},!n))return z(ae),$}if(O){if(Bd(O)){const te=await O(M,r),ae=MG(te,F);if(ae&&($[P]={...ae,...ie(Of.validate,ae.message)},!n))return z(ae.message),$}else if(_o(O)){let te={};for(const ae in O){if(!Dc(te)&&!n)break;const ue=MG(await O[ae](M,r),F,ae);ue&&(te={...ue,...ie(ae,ue.message)},z(ue.message),n&&($[P]=te))}if(!Dc(te)&&($[P]={ref:F,...te},!n))return $}}return z(!0),$};const yke={mode:zd.onSubmit,reValidateMode:zd.onChange,shouldFocusError:!0};function vke(e={}){let t={...yke,...e},r={submitCount:0,isDirty:!1,isReady:!1,isLoading:Bd(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},n={},s=_o(t.defaultValues)||_o(t.values)?Ho(t.defaultValues||t.values)||{}:{},o=t.shouldUnregister?{}:Ho(s),h={action:!1,mount:!1,watch:!1},i={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},m,y=0;const S={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let b={...S};const T={array:AG(),state:AG()},A=t.criteriaMode===zd.all,O=He=>lt=>{clearTimeout(y),y=setTimeout(He,lt)},P=async He=>{if(!t.disabled&&(S.isValid||b.isValid||He)){const lt=t.resolver?Dc((await K()).errors):await ne(n,!0);lt!==r.isValid&&T.state.next({isValid:lt})}},I=(He,lt)=>{!t.disabled&&(S.isValidating||S.validatingFields||b.isValidating||b.validatingFields)&&((He||Array.from(i.mount)).forEach(ut=>{ut&&(lt?$s(r.validatingFields,ut,lt):Ao(r.validatingFields,ut))}),T.state.next({validatingFields:r.validatingFields,isValidating:!Dc(r.validatingFields)}))},R=(He,lt=[],ut,sr,Qt=!0,er=!0)=>{if(sr&&ut&&!t.disabled){if(h.action=!0,er&&Array.isArray(an(n,He))){const Cr=ut(an(n,He),sr.argA,sr.argB);Qt&&$s(n,He,Cr)}if(er&&Array.isArray(an(r.errors,He))){const Cr=ut(an(r.errors,He),sr.argA,sr.argB);Qt&&$s(r.errors,He,Cr),mke(r.errors,He)}if((S.touchedFields||b.touchedFields)&&er&&Array.isArray(an(r.touchedFields,He))){const Cr=ut(an(r.touchedFields,He),sr.argA,sr.argB);Qt&&$s(r.touchedFields,He,Cr)}(S.dirtyFields||b.dirtyFields)&&(r.dirtyFields=HS(s,o)),T.state.next({name:He,isDirty:re(He,lt),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else $s(o,He,lt)},M=(He,lt)=>{$s(r.errors,He,lt),T.state.next({errors:r.errors})},F=He=>{r.errors=He,T.state.next({errors:r.errors,isValid:!1})},z=(He,lt,ut,sr)=>{const Qt=an(n,He);if(Qt){const er=an(o,He,lo(ut)?an(s,He):ut);lo(er)||sr&&sr.defaultChecked||lt?$s(o,He,lt?er:OG(Qt._f)):ue(He,er),h.mount&&P()}},$=(He,lt,ut,sr,Qt)=>{let er=!1,Cr=!1;const dn={name:He};if(!t.disabled){if(!ut||sr){(S.isDirty||b.isDirty)&&(Cr=r.isDirty,r.isDirty=dn.isDirty=re(),er=Cr!==dn.isDirty);const fn=Bf(an(s,He),lt);Cr=!!an(r.dirtyFields,He),fn?Ao(r.dirtyFields,He):$s(r.dirtyFields,He,!0),dn.dirtyFields=r.dirtyFields,er=er||(S.dirtyFields||b.dirtyFields)&&Cr!==!fn}if(ut){const fn=an(r.touchedFields,He);fn||($s(r.touchedFields,He,ut),dn.touchedFields=r.touchedFields,er=er||(S.touchedFields||b.touchedFields)&&fn!==ut)}er&&Qt&&T.state.next(dn)}return er?dn:{}},W=(He,lt,ut,sr)=>{const Qt=an(r.errors,He),er=(S.isValid||b.isValid)&&du(lt)&&r.isValid!==lt;if(t.delayError&&ut?(m=O(()=>M(He,ut)),m(t.delayError)):(clearTimeout(y),m=null,ut?$s(r.errors,He,ut):Ao(r.errors,He)),(ut?!Bf(Qt,ut):Qt)||!Dc(sr)||er){const Cr={...sr,...er&&du(lt)?{isValid:lt}:{},errors:r.errors,name:He};r={...r,...Cr},T.state.next(Cr)}},K=async He=>{I(He,!0);const lt=await t.resolver(o,t.context,cke(He||i.mount,n,t.criteriaMode,t.shouldUseNativeValidation));return I(He),lt},ee=async He=>{const{errors:lt}=await K(He);if(He)for(const ut of He){const sr=an(lt,ut);sr?$s(r.errors,ut,sr):Ao(r.errors,ut)}else r.errors=lt;return lt},ne=async(He,lt,ut={valid:!0})=>{for(const sr in He){const Qt=He[sr];if(Qt){const{_f:er,...Cr}=Qt;if(er){const dn=i.array.has(er.name),fn=Qt._f&&uke(Qt._f);fn&&S.validatingFields&&I([sr],!0);const Zn=await DG(Qt,i.disabled,o,A,t.shouldUseNativeValidation&&!lt,dn);if(fn&&S.validatingFields&&I([sr]),Zn[er.name]&&(ut.valid=!1,lt))break;!lt&&(an(Zn,er.name)?dn?gke(r.errors,Zn,er.name):$s(r.errors,er.name,Zn[er.name]):Ao(r.errors,er.name))}!Dc(Cr)&&await ne(Cr,lt,ut)}}return ut.valid},ie=()=>{for(const He of i.unMount){const lt=an(n,He);lt&&(lt._f.refs?lt._f.refs.every(ut=>!XD(ut)):!XD(lt._f.ref))&&Be(He)}i.unMount=new Set},re=(He,lt)=>!t.disabled&&(He&&lt&&$s(o,He,lt),!Bf(Ae(),s)),te=(He,lt,ut)=>pae(He,i,{...h.mount?o:lo(lt)?s:Nh(He)?{[He]:lt}:lt},ut,lt),ae=He=>B5(an(h.mount?o:s,He,t.shouldUnregister?an(s,He,[]):[])),ue=(He,lt,ut={})=>{const sr=an(n,He);let Qt=lt;if(sr){const er=sr._f;er&&(!er.disabled&&$s(o,He,xae(lt,er)),Qt=_O(er.ref)&&uc(lt)?"":lt,gae(er.ref)?[...er.ref.options].forEach(Cr=>Cr.selected=Qt.includes(Cr.value)):er.refs?z2(er.ref)?er.refs.forEach(Cr=>{(!Cr.defaultChecked||!Cr.disabled)&&(Array.isArray(Qt)?Cr.checked=!!Qt.find(dn=>dn===Cr.value):Cr.checked=Qt===Cr.value||!!Qt)}):er.refs.forEach(Cr=>Cr.checked=Cr.value===Qt):q5(er.ref)?er.ref.value="":(er.ref.value=Qt,er.ref.type||T.state.next({name:He,values:Ho(o)})))}(ut.shouldDirty||ut.shouldTouch)&&$(He,Qt,ut.shouldTouch,ut.shouldDirty,!0),ut.shouldValidate&&me(He)},be=(He,lt,ut)=>{for(const sr in lt){if(!lt.hasOwnProperty(sr))return;const Qt=lt[sr],er=He+"."+sr,Cr=an(n,er);(i.array.has(He)||_o(Qt)||Cr&&!Cr._f)&&!Xy(Qt)?be(er,Qt,ut):ue(er,Qt,ut)}},we=(He,lt,ut={})=>{const sr=an(n,He),Qt=i.array.has(He),er=Ho(lt);$s(o,He,er),Qt?(T.array.next({name:He,values:Ho(o)}),(S.isDirty||S.dirtyFields||b.isDirty||b.dirtyFields)&&ut.shouldDirty&&T.state.next({name:He,dirtyFields:HS(s,o),isDirty:re(He,er)})):sr&&!sr._f&&!uc(er)?be(He,er,ut):ue(He,er,ut),IG(He,i)&&T.state.next({...r,name:He}),T.state.next({name:h.mount?He:void 0,values:Ho(o)})},Ce=async He=>{h.mount=!0;const lt=He.target;let ut=lt.name,sr=!0;const Qt=an(n,ut),er=fn=>{sr=Number.isNaN(fn)||Xy(fn)&&isNaN(fn.getTime())||Bf(fn,an(o,ut,fn))},Cr=kG(t.mode),dn=kG(t.reValidateMode);if(Qt){let fn,Zn;const Gn=lt.type?OG(Qt._f):dae(He),Di=He.type===vO.BLUR||He.type===vO.FOCUS_OUT,ka=!dke(Qt._f)&&!t.resolver&&!an(r.errors,ut)&&!Qt._f.deps||pke(Di,an(r.touchedFields,ut),r.isSubmitted,dn,Cr),xs=IG(ut,i,Di);$s(o,ut,Gn),Di?(Qt._f.onBlur&&Qt._f.onBlur(He),m&&m(0)):Qt._f.onChange&&Qt._f.onChange(He);const mi=$(ut,Gn,Di),Ua=!Dc(mi)||xs;if(!Di&&T.state.next({name:ut,type:He.type,values:Ho(o)}),ka)return(S.isValid||b.isValid)&&(t.mode==="onBlur"?Di&&P():Di||P()),Ua&&T.state.next({name:ut,...xs?{}:mi});if(!Di&&xs&&T.state.next({...r}),t.resolver){const{errors:Va}=await K([ut]);if(er(Gn),sr){const Lo=RG(r.errors,n,ut),qa=RG(Va,n,Lo.name||ut);fn=qa.error,ut=qa.name,Zn=Dc(Va)}}else I([ut],!0),fn=(await DG(Qt,i.disabled,o,A,t.shouldUseNativeValidation))[ut],I([ut]),er(Gn),sr&&(fn?Zn=!1:(S.isValid||b.isValid)&&(Zn=await ne(n,!0)));sr&&(Qt._f.deps&&me(Qt._f.deps),W(ut,Zn,fn,mi))}},_e=(He,lt)=>{if(an(r.errors,lt)&&He.focus)return He.focus(),1},me=async(He,lt={})=>{let ut,sr;const Qt=RE(He);if(t.resolver){const er=await ee(lo(He)?He:Qt);ut=Dc(er),sr=He?!Qt.some(Cr=>an(er,Cr)):ut}else He?(sr=(await Promise.all(Qt.map(async er=>{const Cr=an(n,er);return await ne(Cr&&Cr._f?{[er]:Cr}:Cr)}))).every(Boolean),!(!sr&&!r.isValid)&&P()):sr=ut=await ne(n);return T.state.next({...!Nh(He)||(S.isValid||b.isValid)&&ut!==r.isValid?{}:{name:He},...t.resolver||!He?{isValid:ut}:{},errors:r.errors}),lt.shouldFocus&&!sr&&ME(n,_e,He?Qt:i.mount),sr},Ae=He=>{const lt={...h.mount?o:s};return lo(He)?lt:Nh(He)?an(lt,He):He.map(ut=>an(lt,ut))},ge=(He,lt)=>({invalid:!!an((lt||r).errors,He),isDirty:!!an((lt||r).dirtyFields,He),error:an((lt||r).errors,He),isValidating:!!an(r.validatingFields,He),isTouched:!!an((lt||r).touchedFields,He)}),pe=He=>{He&&RE(He).forEach(lt=>Ao(r.errors,lt)),T.state.next({errors:He?r.errors:{}})},Oe=(He,lt,ut)=>{const sr=(an(n,He,{_f:{}})._f||{}).ref,Qt=an(r.errors,He)||{},{ref:er,message:Cr,type:dn,...fn}=Qt;$s(r.errors,He,{...fn,...lt,ref:sr}),T.state.next({name:He,errors:r.errors,isValid:!1}),ut&&ut.shouldFocus&&sr&&sr.focus&&sr.focus()},Je=(He,lt)=>Bd(He)?T.state.subscribe({next:ut=>"values"in ut&&He(te(void 0,lt),ut)}):te(He,lt,!0),Ze=He=>T.state.subscribe({next:lt=>{fke(He.name,lt.name,He.exact)&&hke(lt,He.formState||S,Dr,He.reRenderRoot)&&He.callback({values:{...o},...r,...lt,defaultValues:s})}}).unsubscribe,Pe=He=>(h.mount=!0,b={...b,...He.formState},Ze({...He,formState:b})),Be=(He,lt={})=>{for(const ut of He?RE(He):i.mount)i.mount.delete(ut),i.array.delete(ut),lt.keepValue||(Ao(n,ut),Ao(o,ut)),!lt.keepError&&Ao(r.errors,ut),!lt.keepDirty&&Ao(r.dirtyFields,ut),!lt.keepTouched&&Ao(r.touchedFields,ut),!lt.keepIsValidating&&Ao(r.validatingFields,ut),!t.shouldUnregister&&!lt.keepDefaultValue&&Ao(s,ut);T.state.next({values:Ho(o)}),T.state.next({...r,...lt.keepDirty?{isDirty:re()}:{}}),!lt.keepIsValid&&P()},nt=({disabled:He,name:lt})=>{(du(He)&&h.mount||He||i.disabled.has(lt))&&(He?i.disabled.add(lt):i.disabled.delete(lt))},Me=(He,lt={})=>{let ut=an(n,He);const sr=du(lt.disabled)||du(t.disabled);return $s(n,He,{...ut||{},_f:{...ut&&ut._f?ut._f:{ref:{name:He}},name:He,mount:!0,...lt}}),i.mount.add(He),ut?nt({disabled:du(lt.disabled)?lt.disabled:t.disabled,name:He}):z(He,!0,lt.value),{...sr?{disabled:lt.disabled||t.disabled}:{},...t.progressive?{required:!!lt.required,min:GS(lt.min),max:GS(lt.max),minLength:GS(lt.minLength),maxLength:GS(lt.maxLength),pattern:GS(lt.pattern)}:{},name:He,onChange:Ce,onBlur:Ce,ref:Qt=>{if(Qt){Me(He,lt),ut=an(n,He);const er=lo(Qt.value)&&Qt.querySelectorAll&&Qt.querySelectorAll("input,select,textarea")[0]||Qt,Cr=ake(er),dn=ut._f.refs||[];if(Cr?dn.find(fn=>fn===er):er===ut._f.ref)return;$s(n,He,{_f:{...ut._f,...Cr?{refs:[...dn.filter(XD),er,...Array.isArray(an(s,He))?[{}]:[]],ref:{type:er.type,name:He}}:{ref:er}}}),z(He,!1,void 0,er)}else ut=an(n,He,{}),ut._f&&(ut._f.mount=!1),(t.shouldUnregister||lt.shouldUnregister)&&!(hae(i.array,He)&&h.action)&&i.unMount.add(He)}}},We=()=>t.shouldFocusError&&ME(n,_e,i.mount),gt=He=>{du(He)&&(T.state.next({disabled:He}),ME(n,(lt,ut)=>{const sr=an(n,ut);sr&&(lt.disabled=sr._f.disabled||He,Array.isArray(sr._f.refs)&&sr._f.refs.forEach(Qt=>{Qt.disabled=sr._f.disabled||He}))},0,!1))},rt=(He,lt)=>async ut=>{let sr;ut&&(ut.preventDefault&&ut.preventDefault(),ut.persist&&ut.persist());let Qt=Ho(o);if(T.state.next({isSubmitting:!0}),t.resolver){const{errors:er,values:Cr}=await K();r.errors=er,Qt=Ho(Cr)}else await ne(n);if(i.disabled.size)for(const er of i.disabled)Ao(Qt,er);if(Ao(r.errors,"root"),Dc(r.errors)){T.state.next({errors:{}});try{await He(Qt,ut)}catch(er){sr=er}}else lt&&await lt({...r.errors},ut),We(),setTimeout(We);if(T.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Dc(r.errors)&&!sr,submitCount:r.submitCount+1,errors:r.errors}),sr)throw sr},Ht=(He,lt={})=>{an(n,He)&&(lo(lt.defaultValue)?we(He,Ho(an(s,He))):(we(He,lt.defaultValue),$s(s,He,Ho(lt.defaultValue))),lt.keepTouched||Ao(r.touchedFields,He),lt.keepDirty||(Ao(r.dirtyFields,He),r.isDirty=lt.defaultValue?re(He,Ho(an(s,He))):re()),lt.keepError||(Ao(r.errors,He),S.isValid&&P()),T.state.next({...r}))},Lt=(He,lt={})=>{const ut=He?Ho(He):s,sr=Ho(ut),Qt=Dc(He),er=Qt?s:sr;if(lt.keepDefaultValues||(s=ut),!lt.keepValues){if(lt.keepDirtyValues){const Cr=new Set([...i.mount,...Object.keys(HS(s,o))]);for(const dn of Array.from(Cr))an(r.dirtyFields,dn)?$s(er,dn,an(o,dn)):we(dn,an(er,dn))}else{if(z5&&lo(He))for(const Cr of i.mount){const dn=an(n,Cr);if(dn&&dn._f){const fn=Array.isArray(dn._f.refs)?dn._f.refs[0]:dn._f.ref;if(_O(fn)){const Zn=fn.closest("form");if(Zn){Zn.reset();break}}}}if(lt.keepFieldsRef)for(const Cr of i.mount)we(Cr,an(er,Cr));else n={}}o=t.shouldUnregister?lt.keepDefaultValues?Ho(s):{}:Ho(er),T.array.next({values:{...er}}),T.state.next({values:{...er}})}i={mount:lt.keepDirtyValues?i.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},h.mount=!S.isValid||!!lt.keepIsValid||!!lt.keepDirtyValues,h.watch=!!t.shouldUnregister,T.state.next({submitCount:lt.keepSubmitCount?r.submitCount:0,isDirty:Qt?!1:lt.keepDirty?r.isDirty:!!(lt.keepDefaultValues&&!Bf(He,s)),isSubmitted:lt.keepIsSubmitted?r.isSubmitted:!1,dirtyFields:Qt?{}:lt.keepDirtyValues?lt.keepDefaultValues&&o?HS(s,o):r.dirtyFields:lt.keepDefaultValues&&He?HS(s,He):lt.keepDirty?r.dirtyFields:{},touchedFields:lt.keepTouched?r.touchedFields:{},errors:lt.keepErrors?r.errors:{},isSubmitSuccessful:lt.keepIsSubmitSuccessful?r.isSubmitSuccessful:!1,isSubmitting:!1})},nr=(He,lt)=>Lt(Bd(He)?He(o):He,lt),Rr=(He,lt={})=>{const ut=an(n,He),sr=ut&&ut._f;if(sr){const Qt=sr.refs?sr.refs[0]:sr.ref;Qt.focus&&(Qt.focus(),lt.shouldSelect&&Bd(Qt.select)&&Qt.select())}},Dr=He=>{r={...r,...He}},wt={control:{register:Me,unregister:Be,getFieldState:ge,handleSubmit:rt,setError:Oe,_subscribe:Ze,_runSchema:K,_focusError:We,_getWatch:te,_getDirty:re,_setValid:P,_setFieldArray:R,_setDisabledField:nt,_setErrors:F,_getFieldArray:ae,_reset:Lt,_resetDefaultValues:()=>Bd(t.defaultValues)&&t.defaultValues().then(He=>{nr(He,t.resetOptions),T.state.next({isLoading:!1})}),_removeUnmounted:ie,_disableForm:gt,_subjects:T,_proxyFormState:S,get _fields(){return n},get _formValues(){return o},get _state(){return h},set _state(He){h=He},get _defaultValues(){return s},get _names(){return i},set _names(He){i=He},get _formState(){return r},get _options(){return t},set _options(He){t={...t,...He}}},subscribe:Pe,trigger:me,register:Me,handleSubmit:rt,watch:Je,setValue:we,getValues:Ae,reset:nr,resetField:Ht,clearErrors:pe,unregister:Be,setError:Oe,setFocus:Rr,getFieldState:ge};return{...wt,formControl:wt}}function Ah(e={}){const t=Ue.useRef(void 0),r=Ue.useRef(void 0),[n,s]=Ue.useState({isDirty:!1,isValidating:!1,isLoading:Bd(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,isReady:!1,defaultValues:Bd(e.defaultValues)?void 0:e.defaultValues});if(!t.current)if(e.formControl)t.current={...e.formControl,formState:n},e.defaultValues&&!Bd(e.defaultValues)&&e.formControl.reset(e.defaultValues,e.resetOptions);else{const{formControl:h,...i}=vke(e);t.current={...i,formState:n}}const o=t.current.control;return o._options=e,V5(()=>{const h=o._subscribe({formState:o._proxyFormState,callback:()=>s({...o._formState}),reRenderRoot:!0});return s(i=>({...i,isReady:!0})),o._formState.isReady=!0,h},[o]),Ue.useEffect(()=>o._disableForm(e.disabled),[o,e.disabled]),Ue.useEffect(()=>{e.mode&&(o._options.mode=e.mode),e.reValidateMode&&(o._options.reValidateMode=e.reValidateMode)},[o,e.mode,e.reValidateMode]),Ue.useEffect(()=>{e.errors&&(o._setErrors(e.errors),o._focusError())},[o,e.errors]),Ue.useEffect(()=>{e.shouldUnregister&&o._subjects.state.next({values:o._getWatch()})},[o,e.shouldUnregister]),Ue.useEffect(()=>{if(o._proxyFormState.isDirty){const h=o._getDirty();h!==n.isDirty&&o._subjects.state.next({isDirty:h})}},[o,n.isDirty]),Ue.useEffect(()=>{e.values&&!Bf(e.values,r.current)?(o._reset(e.values,{keepFieldsRef:!0,...o._options.resetOptions}),r.current=e.values,s(h=>({...h}))):o._resetDefaultValues()},[o,e.values]),Ue.useEffect(()=>{o._state.mount||(o._setValid(),o._state.mount=!0),o._state.watch&&(o._state.watch=!1,o._subjects.state.next({...o._formState})),o._removeUnmounted()}),t.current.formState=fae(n,o),t.current}const LG=(e,t,r)=>{if(e&&"reportValidity"in e){const n=an(r,t);e.setCustomValidity(n&&n.message||""),e.reportValidity()}},wae=(e,t)=>{for(const r in t.fields){const n=t.fields[r];n&&n.ref&&"reportValidity"in n.ref?LG(n.ref,r,e):n.refs&&n.refs.forEach(s=>LG(s,r,e))}},_ke=(e,t)=>{t.shouldUseNativeValidation&&wae(e,t);const r={};for(const n in e){const s=an(t.fields,n),o=Object.assign(e[n]||{},{ref:s&&s.ref});if(xke(t.names||Object.keys(e),n)){const h=Object.assign({},an(r,n));$s(h,"root",o),$s(r,n,h)}else $s(r,n,o)}return r},xke=(e,t)=>e.some(r=>r.startsWith(t+"."));var bke=function(e,t){for(var r={};e.length;){var n=e[0],s=n.code,o=n.message,h=n.path.join(".");if(!r[h])if("unionErrors"in n){var i=n.unionErrors[0].errors[0];r[h]={message:i.message,type:i.code}}else r[h]={message:o,type:s};if("unionErrors"in n&&n.unionErrors.forEach(function(S){return S.errors.forEach(function(b){return e.push(b)})}),t){var m=r[h].types,y=m&&m[n.code];r[h]=mae(h,t,r,s,y?[].concat(y,n.message):n.message)}e.shift()}return r},Ch=function(e,t,r){return r===void 0&&(r={}),function(n,s,o){try{return Promise.resolve(function(h,i){try{var m=Promise.resolve(e[r.mode==="sync"?"parse":"parseAsync"](n,t)).then(function(y){return o.shouldUseNativeValidation&&wae({},o),{errors:{},values:r.raw?n:y}})}catch(y){return i(y)}return m&&m.then?m.then(void 0,i):m}(0,function(h){if(function(i){return Array.isArray(i==null?void 0:i.errors)}(h))return{values:{},errors:_ke(bke(h.errors,!o.shouldUseNativeValidation&&o.criteriaMode==="all"),o)};throw h}))}catch(h){return Promise.reject(h)}}},Cs;(function(e){e.assertEqual=s=>{};function t(s){}e.assertIs=t;function r(s){throw new Error}e.assertNever=r,e.arrayToEnum=s=>{const o={};for(const h of s)o[h]=h;return o},e.getValidEnumValues=s=>{const o=e.objectKeys(s).filter(i=>typeof s[s[i]]!="number"),h={};for(const i of o)h[i]=s[i];return e.objectValues(h)},e.objectValues=s=>e.objectKeys(s).map(function(o){return s[o]}),e.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const o=[];for(const h in s)Object.prototype.hasOwnProperty.call(s,h)&&o.push(h);return o},e.find=(s,o)=>{for(const h of s)if(o(h))return h},e.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function n(s,o=" | "){return s.map(h=>typeof h=="string"?`'${h}'`:h).join(o)}e.joinValues=n,e.jsonStringifyReplacer=(s,o)=>typeof o=="bigint"?o.toString():o})(Cs||(Cs={}));var FG;(function(e){e.mergeShapes=(t,r)=>({...t,...r})})(FG||(FG={}));const Pn=Cs.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Sm=e=>{switch(typeof e){case"undefined":return Pn.undefined;case"string":return Pn.string;case"number":return Number.isNaN(e)?Pn.nan:Pn.number;case"boolean":return Pn.boolean;case"function":return Pn.function;case"bigint":return Pn.bigint;case"symbol":return Pn.symbol;case"object":return Array.isArray(e)?Pn.array:e===null?Pn.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?Pn.promise:typeof Map<"u"&&e instanceof Map?Pn.map:typeof Set<"u"&&e instanceof Set?Pn.set:typeof Date<"u"&&e instanceof Date?Pn.date:Pn.object;default:return Pn.unknown}},Ur=Cs.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class lp extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}format(t){const r=t||function(o){return o.message},n={_errors:[]},s=o=>{for(const h of o.issues)if(h.code==="invalid_union")h.unionErrors.map(s);else if(h.code==="invalid_return_type")s(h.returnTypeError);else if(h.code==="invalid_arguments")s(h.argumentsError);else if(h.path.length===0)n._errors.push(r(h));else{let i=n,m=0;for(;m<h.path.length;){const y=h.path[m];m===h.path.length-1?(i[y]=i[y]||{_errors:[]},i[y]._errors.push(r(h))):i[y]=i[y]||{_errors:[]},i=i[y],m++}}};return s(this),n}static assert(t){if(!(t instanceof lp))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Cs.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){const r={},n=[];for(const s of this.issues)if(s.path.length>0){const o=s.path[0];r[o]=r[o]||[],r[o].push(t(s))}else n.push(t(s));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}}lp.create=e=>new lp(e);const OF=(e,t)=>{let r;switch(e.code){case Ur.invalid_type:e.received===Pn.undefined?r="Required":r=`Expected ${e.expected}, received ${e.received}`;break;case Ur.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,Cs.jsonStringifyReplacer)}`;break;case Ur.unrecognized_keys:r=`Unrecognized key(s) in object: ${Cs.joinValues(e.keys,", ")}`;break;case Ur.invalid_union:r="Invalid input";break;case Ur.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Cs.joinValues(e.options)}`;break;case Ur.invalid_enum_value:r=`Invalid enum value. Expected ${Cs.joinValues(e.options)}, received '${e.received}'`;break;case Ur.invalid_arguments:r="Invalid function arguments";break;case Ur.invalid_return_type:r="Invalid function return type";break;case Ur.invalid_date:r="Invalid date";break;case Ur.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:Cs.assertNever(e.validation):e.validation!=="regex"?r=`Invalid ${e.validation}`:r="Invalid";break;case Ur.too_small:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?r=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:r="Invalid input";break;case Ur.too_big:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?r=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:r="Invalid input";break;case Ur.custom:r="Invalid input";break;case Ur.invalid_intersection_types:r="Intersection results could not be merged";break;case Ur.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case Ur.not_finite:r="Number must be finite";break;default:r=t.defaultError,Cs.assertNever(e)}return{message:r}};let wke=OF;function Ske(){return wke}const Eke=e=>{const{data:t,path:r,errorMaps:n,issueData:s}=e,o=[...r,...s.path||[]],h={...s,path:o};if(s.message!==void 0)return{...s,path:o,message:s.message};let i="";const m=n.filter(y=>!!y).slice().reverse();for(const y of m)i=y(h,{data:t,defaultError:i}).message;return{...s,path:o,message:i}};function gn(e,t){const r=Ske(),n=Eke({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===OF?void 0:OF].filter(s=>!!s)});e.common.issues.push(n)}class Eu{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,r){const n=[];for(const s of r){if(s.status==="aborted")return Pi;s.status==="dirty"&&t.dirty(),n.push(s.value)}return{status:t.value,value:n}}static async mergeObjectAsync(t,r){const n=[];for(const s of r){const o=await s.key,h=await s.value;n.push({key:o,value:h})}return Eu.mergeObjectSync(t,n)}static mergeObjectSync(t,r){const n={};for(const s of r){const{key:o,value:h}=s;if(o.status==="aborted"||h.status==="aborted")return Pi;o.status==="dirty"&&t.dirty(),h.status==="dirty"&&t.dirty(),o.value!=="__proto__"&&(typeof h.value<"u"||s.alwaysSet)&&(n[o.value]=h.value)}return{status:t.value,value:n}}}const Pi=Object.freeze({status:"aborted"}),mE=e=>({status:"dirty",value:e}),nd=e=>({status:"valid",value:e}),zG=e=>e.status==="aborted",BG=e=>e.status==="dirty",yb=e=>e.status==="valid",wO=e=>typeof Promise<"u"&&e instanceof Promise;var On;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(On||(On={}));class hg{constructor(t,r,n,s){this._cachedPath=[],this.parent=t,this.data=r,this._path=n,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const $G=(e,t)=>{if(yb(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new lp(e.common.issues);return this._error=r,this._error}}};function ns(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:n,description:s}=e;if(t&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:s}:{errorMap:(h,i)=>{const{message:m}=e;return h.code==="invalid_enum_value"?{message:m??i.defaultError}:typeof i.data>"u"?{message:m??n??i.defaultError}:h.code!=="invalid_type"?{message:i.defaultError}:{message:m??r??i.defaultError}},description:s}}class Ts{get description(){return this._def.description}_getType(t){return Sm(t.data)}_getOrReturnCtx(t,r){return r||{common:t.parent.common,data:t.data,parsedType:Sm(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Eu,ctx:{common:t.parent.common,data:t.data,parsedType:Sm(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const r=this._parse(t);if(wO(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(t){const r=this._parse(t);return Promise.resolve(r)}parse(t,r){const n=this.safeParse(t,r);if(n.success)return n.data;throw n.error}safeParse(t,r){const n={common:{issues:[],async:(r==null?void 0:r.async)??!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Sm(t)},s=this._parseSync({data:t,path:n.path,parent:n});return $G(n,s)}"~validate"(t){var n,s;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Sm(t)};if(!this["~standard"].async)try{const o=this._parseSync({data:t,path:[],parent:r});return yb(o)?{value:o.value}:{issues:r.common.issues}}catch(o){(s=(n=o==null?void 0:o.message)==null?void 0:n.toLowerCase())!=null&&s.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:r}).then(o=>yb(o)?{value:o.value}:{issues:r.common.issues})}async parseAsync(t,r){const n=await this.safeParseAsync(t,r);if(n.success)return n.data;throw n.error}async safeParseAsync(t,r){const n={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Sm(t)},s=this._parse({data:t,path:n.path,parent:n}),o=await(wO(s)?s:Promise.resolve(s));return $G(n,o)}refine(t,r){const n=s=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(s):r;return this._refinement((s,o)=>{const h=t(s),i=()=>o.addIssue({code:Ur.custom,...n(s)});return typeof Promise<"u"&&h instanceof Promise?h.then(m=>m?!0:(i(),!1)):h?!0:(i(),!1)})}refinement(t,r){return this._refinement((n,s)=>t(n)?!0:(s.addIssue(typeof r=="function"?r(n,s):r),!1))}_refinement(t){return new xb({schema:this,typeName:Oi.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return ng.create(this,this._def)}nullable(){return bb.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return $h.create(this)}promise(){return AO.create(this,this._def)}or(t){return EO.create([this,t],this._def)}and(t){return TO.create(this,t,this._def)}transform(t){return new xb({...ns(this._def),schema:this,typeName:Oi.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const r=typeof t=="function"?t:()=>t;return new IF({...ns(this._def),innerType:this,defaultValue:r,typeName:Oi.ZodDefault})}brand(){return new Wke({typeName:Oi.ZodBranded,type:this,...ns(this._def)})}catch(t){const r=typeof t=="function"?t:()=>t;return new RF({...ns(this._def),innerType:this,catchValue:r,typeName:Oi.ZodCatch})}describe(t){const r=this.constructor;return new r({...this._def,description:t})}pipe(t){return G5.create(this,t)}readonly(){return MF.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Tke=/^c[^\s-]{8,}$/i,Ake=/^[0-9a-z]+$/,Cke=/^[0-9A-HJKMNP-TV-Z]{26}$/i,jke=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Pke=/^[a-z0-9_-]{21}$/i,Oke=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,kke=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Nke=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Ike="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let YD;const Rke=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Mke=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Dke=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Lke=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Fke=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,zke=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Sae="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Bke=new RegExp(`^${Sae}$`);function Eae(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function $ke(e){return new RegExp(`^${Eae(e)}$`)}function Uke(e){let t=`${Sae}T${Eae(e)}`;const r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}function Vke(e,t){return!!((t==="v4"||!t)&&Rke.test(e)||(t==="v6"||!t)&&Dke.test(e))}function qke(e,t){if(!Oke.test(e))return!1;try{const[r]=e.split(".");if(!r)return!1;const n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||t&&s.alg!==t)}catch{return!1}}function Hke(e,t){return!!((t==="v4"||!t)&&Mke.test(e)||(t==="v6"||!t)&&Lke.test(e))}class Hf extends Ts{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==Pn.string){const o=this._getOrReturnCtx(t);return gn(o,{code:Ur.invalid_type,expected:Pn.string,received:o.parsedType}),Pi}const n=new Eu;let s;for(const o of this._def.checks)if(o.kind==="min")t.data.length<o.value&&(s=this._getOrReturnCtx(t,s),gn(s,{code:Ur.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),n.dirty());else if(o.kind==="max")t.data.length>o.value&&(s=this._getOrReturnCtx(t,s),gn(s,{code:Ur.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),n.dirty());else if(o.kind==="length"){const h=t.data.length>o.value,i=t.data.length<o.value;(h||i)&&(s=this._getOrReturnCtx(t,s),h?gn(s,{code:Ur.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):i&&gn(s,{code:Ur.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),n.dirty())}else if(o.kind==="email")Nke.test(t.data)||(s=this._getOrReturnCtx(t,s),gn(s,{validation:"email",code:Ur.invalid_string,message:o.message}),n.dirty());else if(o.kind==="emoji")YD||(YD=new RegExp(Ike,"u")),YD.test(t.data)||(s=this._getOrReturnCtx(t,s),gn(s,{validation:"emoji",code:Ur.invalid_string,message:o.message}),n.dirty());else if(o.kind==="uuid")jke.test(t.data)||(s=this._getOrReturnCtx(t,s),gn(s,{validation:"uuid",code:Ur.invalid_string,message:o.message}),n.dirty());else if(o.kind==="nanoid")Pke.test(t.data)||(s=this._getOrReturnCtx(t,s),gn(s,{validation:"nanoid",code:Ur.invalid_string,message:o.message}),n.dirty());else if(o.kind==="cuid")Tke.test(t.data)||(s=this._getOrReturnCtx(t,s),gn(s,{validation:"cuid",code:Ur.invalid_string,message:o.message}),n.dirty());else if(o.kind==="cuid2")Ake.test(t.data)||(s=this._getOrReturnCtx(t,s),gn(s,{validation:"cuid2",code:Ur.invalid_string,message:o.message}),n.dirty());else if(o.kind==="ulid")Cke.test(t.data)||(s=this._getOrReturnCtx(t,s),gn(s,{validation:"ulid",code:Ur.invalid_string,message:o.message}),n.dirty());else if(o.kind==="url")try{new URL(t.data)}catch{s=this._getOrReturnCtx(t,s),gn(s,{validation:"url",code:Ur.invalid_string,message:o.message}),n.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(t.data)||(s=this._getOrReturnCtx(t,s),gn(s,{validation:"regex",code:Ur.invalid_string,message:o.message}),n.dirty())):o.kind==="trim"?t.data=t.data.trim():o.kind==="includes"?t.data.includes(o.value,o.position)||(s=this._getOrReturnCtx(t,s),gn(s,{code:Ur.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),n.dirty()):o.kind==="toLowerCase"?t.data=t.data.toLowerCase():o.kind==="toUpperCase"?t.data=t.data.toUpperCase():o.kind==="startsWith"?t.data.startsWith(o.value)||(s=this._getOrReturnCtx(t,s),gn(s,{code:Ur.invalid_string,validation:{startsWith:o.value},message:o.message}),n.dirty()):o.kind==="endsWith"?t.data.endsWith(o.value)||(s=this._getOrReturnCtx(t,s),gn(s,{code:Ur.invalid_string,validation:{endsWith:o.value},message:o.message}),n.dirty()):o.kind==="datetime"?Uke(o).test(t.data)||(s=this._getOrReturnCtx(t,s),gn(s,{code:Ur.invalid_string,validation:"datetime",message:o.message}),n.dirty()):o.kind==="date"?Bke.test(t.data)||(s=this._getOrReturnCtx(t,s),gn(s,{code:Ur.invalid_string,validation:"date",message:o.message}),n.dirty()):o.kind==="time"?$ke(o).test(t.data)||(s=this._getOrReturnCtx(t,s),gn(s,{code:Ur.invalid_string,validation:"time",message:o.message}),n.dirty()):o.kind==="duration"?kke.test(t.data)||(s=this._getOrReturnCtx(t,s),gn(s,{validation:"duration",code:Ur.invalid_string,message:o.message}),n.dirty()):o.kind==="ip"?Vke(t.data,o.version)||(s=this._getOrReturnCtx(t,s),gn(s,{validation:"ip",code:Ur.invalid_string,message:o.message}),n.dirty()):o.kind==="jwt"?qke(t.data,o.alg)||(s=this._getOrReturnCtx(t,s),gn(s,{validation:"jwt",code:Ur.invalid_string,message:o.message}),n.dirty()):o.kind==="cidr"?Hke(t.data,o.version)||(s=this._getOrReturnCtx(t,s),gn(s,{validation:"cidr",code:Ur.invalid_string,message:o.message}),n.dirty()):o.kind==="base64"?Fke.test(t.data)||(s=this._getOrReturnCtx(t,s),gn(s,{validation:"base64",code:Ur.invalid_string,message:o.message}),n.dirty()):o.kind==="base64url"?zke.test(t.data)||(s=this._getOrReturnCtx(t,s),gn(s,{validation:"base64url",code:Ur.invalid_string,message:o.message}),n.dirty()):Cs.assertNever(o);return{status:n.value,value:t.data}}_regex(t,r,n){return this.refinement(s=>t.test(s),{validation:r,code:Ur.invalid_string,...On.errToObj(n)})}_addCheck(t){return new Hf({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...On.errToObj(t)})}url(t){return this._addCheck({kind:"url",...On.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...On.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...On.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...On.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...On.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...On.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...On.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...On.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...On.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...On.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...On.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...On.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...On.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...On.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...On.errToObj(t)})}regex(t,r){return this._addCheck({kind:"regex",regex:t,...On.errToObj(r)})}includes(t,r){return this._addCheck({kind:"includes",value:t,position:r==null?void 0:r.position,...On.errToObj(r==null?void 0:r.message)})}startsWith(t,r){return this._addCheck({kind:"startsWith",value:t,...On.errToObj(r)})}endsWith(t,r){return this._addCheck({kind:"endsWith",value:t,...On.errToObj(r)})}min(t,r){return this._addCheck({kind:"min",value:t,...On.errToObj(r)})}max(t,r){return this._addCheck({kind:"max",value:t,...On.errToObj(r)})}length(t,r){return this._addCheck({kind:"length",value:t,...On.errToObj(r)})}nonempty(t){return this.min(1,On.errToObj(t))}trim(){return new Hf({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Hf({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Hf({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxLength(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}Hf.create=e=>new Hf({checks:[],typeName:Oi.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...ns(e)});function Gke(e,t){const r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,s=r>n?r:n,o=Number.parseInt(e.toFixed(s).replace(".","")),h=Number.parseInt(t.toFixed(s).replace(".",""));return o%h/10**s}class Nv extends Ts{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==Pn.number){const o=this._getOrReturnCtx(t);return gn(o,{code:Ur.invalid_type,expected:Pn.number,received:o.parsedType}),Pi}let n;const s=new Eu;for(const o of this._def.checks)o.kind==="int"?Cs.isInteger(t.data)||(n=this._getOrReturnCtx(t,n),gn(n,{code:Ur.invalid_type,expected:"integer",received:"float",message:o.message}),s.dirty()):o.kind==="min"?(o.inclusive?t.data<o.value:t.data<=o.value)&&(n=this._getOrReturnCtx(t,n),gn(n,{code:Ur.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),s.dirty()):o.kind==="max"?(o.inclusive?t.data>o.value:t.data>=o.value)&&(n=this._getOrReturnCtx(t,n),gn(n,{code:Ur.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),s.dirty()):o.kind==="multipleOf"?Gke(t.data,o.value)!==0&&(n=this._getOrReturnCtx(t,n),gn(n,{code:Ur.not_multiple_of,multipleOf:o.value,message:o.message}),s.dirty()):o.kind==="finite"?Number.isFinite(t.data)||(n=this._getOrReturnCtx(t,n),gn(n,{code:Ur.not_finite,message:o.message}),s.dirty()):Cs.assertNever(o);return{status:s.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,On.toString(r))}gt(t,r){return this.setLimit("min",t,!1,On.toString(r))}lte(t,r){return this.setLimit("max",t,!0,On.toString(r))}lt(t,r){return this.setLimit("max",t,!1,On.toString(r))}setLimit(t,r,n,s){return new Nv({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:On.toString(s)}]})}_addCheck(t){return new Nv({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:On.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:On.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:On.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:On.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:On.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:On.toString(r)})}finite(t){return this._addCheck({kind:"finite",message:On.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:On.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:On.toString(t)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&Cs.isInteger(t.value))}get isFinite(){let t=null,r=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(t===null||n.value<t)&&(t=n.value)}return Number.isFinite(r)&&Number.isFinite(t)}}Nv.create=e=>new Nv({checks:[],typeName:Oi.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...ns(e)});class Iv extends Ts{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==Pn.bigint)return this._getInvalidInput(t);let n;const s=new Eu;for(const o of this._def.checks)o.kind==="min"?(o.inclusive?t.data<o.value:t.data<=o.value)&&(n=this._getOrReturnCtx(t,n),gn(n,{code:Ur.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),s.dirty()):o.kind==="max"?(o.inclusive?t.data>o.value:t.data>=o.value)&&(n=this._getOrReturnCtx(t,n),gn(n,{code:Ur.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),s.dirty()):o.kind==="multipleOf"?t.data%o.value!==BigInt(0)&&(n=this._getOrReturnCtx(t,n),gn(n,{code:Ur.not_multiple_of,multipleOf:o.value,message:o.message}),s.dirty()):Cs.assertNever(o);return{status:s.value,value:t.data}}_getInvalidInput(t){const r=this._getOrReturnCtx(t);return gn(r,{code:Ur.invalid_type,expected:Pn.bigint,received:r.parsedType}),Pi}gte(t,r){return this.setLimit("min",t,!0,On.toString(r))}gt(t,r){return this.setLimit("min",t,!1,On.toString(r))}lte(t,r){return this.setLimit("max",t,!0,On.toString(r))}lt(t,r){return this.setLimit("max",t,!1,On.toString(r))}setLimit(t,r,n,s){return new Iv({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:On.toString(s)}]})}_addCheck(t){return new Iv({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:On.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:On.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:On.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:On.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:On.toString(r)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}Iv.create=e=>new Iv({checks:[],typeName:Oi.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...ns(e)});class SO extends Ts{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==Pn.boolean){const n=this._getOrReturnCtx(t);return gn(n,{code:Ur.invalid_type,expected:Pn.boolean,received:n.parsedType}),Pi}return nd(t.data)}}SO.create=e=>new SO({typeName:Oi.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...ns(e)});class vb extends Ts{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==Pn.date){const o=this._getOrReturnCtx(t);return gn(o,{code:Ur.invalid_type,expected:Pn.date,received:o.parsedType}),Pi}if(Number.isNaN(t.data.getTime())){const o=this._getOrReturnCtx(t);return gn(o,{code:Ur.invalid_date}),Pi}const n=new Eu;let s;for(const o of this._def.checks)o.kind==="min"?t.data.getTime()<o.value&&(s=this._getOrReturnCtx(t,s),gn(s,{code:Ur.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),n.dirty()):o.kind==="max"?t.data.getTime()>o.value&&(s=this._getOrReturnCtx(t,s),gn(s,{code:Ur.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),n.dirty()):Cs.assertNever(o);return{status:n.value,value:new Date(t.data.getTime())}}_addCheck(t){return new vb({...this._def,checks:[...this._def.checks,t]})}min(t,r){return this._addCheck({kind:"min",value:t.getTime(),message:On.toString(r)})}max(t,r){return this._addCheck({kind:"max",value:t.getTime(),message:On.toString(r)})}get minDate(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t!=null?new Date(t):null}}vb.create=e=>new vb({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:Oi.ZodDate,...ns(e)});class UG extends Ts{_parse(t){if(this._getType(t)!==Pn.symbol){const n=this._getOrReturnCtx(t);return gn(n,{code:Ur.invalid_type,expected:Pn.symbol,received:n.parsedType}),Pi}return nd(t.data)}}UG.create=e=>new UG({typeName:Oi.ZodSymbol,...ns(e)});class VG extends Ts{_parse(t){if(this._getType(t)!==Pn.undefined){const n=this._getOrReturnCtx(t);return gn(n,{code:Ur.invalid_type,expected:Pn.undefined,received:n.parsedType}),Pi}return nd(t.data)}}VG.create=e=>new VG({typeName:Oi.ZodUndefined,...ns(e)});class qG extends Ts{_parse(t){if(this._getType(t)!==Pn.null){const n=this._getOrReturnCtx(t);return gn(n,{code:Ur.invalid_type,expected:Pn.null,received:n.parsedType}),Pi}return nd(t.data)}}qG.create=e=>new qG({typeName:Oi.ZodNull,...ns(e)});class HG extends Ts{constructor(){super(...arguments),this._any=!0}_parse(t){return nd(t.data)}}HG.create=e=>new HG({typeName:Oi.ZodAny,...ns(e)});class GG extends Ts{constructor(){super(...arguments),this._unknown=!0}_parse(t){return nd(t.data)}}GG.create=e=>new GG({typeName:Oi.ZodUnknown,...ns(e)});class fg extends Ts{_parse(t){const r=this._getOrReturnCtx(t);return gn(r,{code:Ur.invalid_type,expected:Pn.never,received:r.parsedType}),Pi}}fg.create=e=>new fg({typeName:Oi.ZodNever,...ns(e)});class WG extends Ts{_parse(t){if(this._getType(t)!==Pn.undefined){const n=this._getOrReturnCtx(t);return gn(n,{code:Ur.invalid_type,expected:Pn.void,received:n.parsedType}),Pi}return nd(t.data)}}WG.create=e=>new WG({typeName:Oi.ZodVoid,...ns(e)});class $h extends Ts{_parse(t){const{ctx:r,status:n}=this._processInputParams(t),s=this._def;if(r.parsedType!==Pn.array)return gn(r,{code:Ur.invalid_type,expected:Pn.array,received:r.parsedType}),Pi;if(s.exactLength!==null){const h=r.data.length>s.exactLength.value,i=r.data.length<s.exactLength.value;(h||i)&&(gn(r,{code:h?Ur.too_big:Ur.too_small,minimum:i?s.exactLength.value:void 0,maximum:h?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&r.data.length<s.minLength.value&&(gn(r,{code:Ur.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&r.data.length>s.maxLength.value&&(gn(r,{code:Ur.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((h,i)=>s.type._parseAsync(new hg(r,h,r.path,i)))).then(h=>Eu.mergeArray(n,h));const o=[...r.data].map((h,i)=>s.type._parseSync(new hg(r,h,r.path,i)));return Eu.mergeArray(n,o)}get element(){return this._def.type}min(t,r){return new $h({...this._def,minLength:{value:t,message:On.toString(r)}})}max(t,r){return new $h({...this._def,maxLength:{value:t,message:On.toString(r)}})}length(t,r){return new $h({...this._def,exactLength:{value:t,message:On.toString(r)}})}nonempty(t){return this.min(1,t)}}$h.create=(e,t)=>new $h({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Oi.ZodArray,...ns(t)});function Jx(e){if(e instanceof Qa){const t={};for(const r in e.shape){const n=e.shape[r];t[r]=ng.create(Jx(n))}return new Qa({...e._def,shape:()=>t})}else return e instanceof $h?new $h({...e._def,type:Jx(e.element)}):e instanceof ng?ng.create(Jx(e.unwrap())):e instanceof bb?bb.create(Jx(e.unwrap())):e instanceof Rv?Rv.create(e.items.map(t=>Jx(t))):e}class Qa extends Ts{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),r=Cs.objectKeys(t);return this._cached={shape:t,keys:r},this._cached}_parse(t){if(this._getType(t)!==Pn.object){const y=this._getOrReturnCtx(t);return gn(y,{code:Ur.invalid_type,expected:Pn.object,received:y.parsedType}),Pi}const{status:n,ctx:s}=this._processInputParams(t),{shape:o,keys:h}=this._getCached(),i=[];if(!(this._def.catchall instanceof fg&&this._def.unknownKeys==="strip"))for(const y in s.data)h.includes(y)||i.push(y);const m=[];for(const y of h){const S=o[y],b=s.data[y];m.push({key:{status:"valid",value:y},value:S._parse(new hg(s,b,s.path,y)),alwaysSet:y in s.data})}if(this._def.catchall instanceof fg){const y=this._def.unknownKeys;if(y==="passthrough")for(const S of i)m.push({key:{status:"valid",value:S},value:{status:"valid",value:s.data[S]}});else if(y==="strict")i.length>0&&(gn(s,{code:Ur.unrecognized_keys,keys:i}),n.dirty());else if(y!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const y=this._def.catchall;for(const S of i){const b=s.data[S];m.push({key:{status:"valid",value:S},value:y._parse(new hg(s,b,s.path,S)),alwaysSet:S in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const y=[];for(const S of m){const b=await S.key,T=await S.value;y.push({key:b,value:T,alwaysSet:S.alwaysSet})}return y}).then(y=>Eu.mergeObjectSync(n,y)):Eu.mergeObjectSync(n,m)}get shape(){return this._def.shape()}strict(t){return On.errToObj,new Qa({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(r,n)=>{var o,h;const s=((h=(o=this._def).errorMap)==null?void 0:h.call(o,r,n).message)??n.defaultError;return r.code==="unrecognized_keys"?{message:On.errToObj(t).message??s}:{message:s}}}:{}})}strip(){return new Qa({...this._def,unknownKeys:"strip"})}passthrough(){return new Qa({...this._def,unknownKeys:"passthrough"})}extend(t){return new Qa({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new Qa({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:Oi.ZodObject})}setKey(t,r){return this.augment({[t]:r})}catchall(t){return new Qa({...this._def,catchall:t})}pick(t){const r={};for(const n of Cs.objectKeys(t))t[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new Qa({...this._def,shape:()=>r})}omit(t){const r={};for(const n of Cs.objectKeys(this.shape))t[n]||(r[n]=this.shape[n]);return new Qa({...this._def,shape:()=>r})}deepPartial(){return Jx(this)}partial(t){const r={};for(const n of Cs.objectKeys(this.shape)){const s=this.shape[n];t&&!t[n]?r[n]=s:r[n]=s.optional()}return new Qa({...this._def,shape:()=>r})}required(t){const r={};for(const n of Cs.objectKeys(this.shape))if(t&&!t[n])r[n]=this.shape[n];else{let o=this.shape[n];for(;o instanceof ng;)o=o._def.innerType;r[n]=o}return new Qa({...this._def,shape:()=>r})}keyof(){return Tae(Cs.objectKeys(this.shape))}}Qa.create=(e,t)=>new Qa({shape:()=>e,unknownKeys:"strip",catchall:fg.create(),typeName:Oi.ZodObject,...ns(t)});Qa.strictCreate=(e,t)=>new Qa({shape:()=>e,unknownKeys:"strict",catchall:fg.create(),typeName:Oi.ZodObject,...ns(t)});Qa.lazycreate=(e,t)=>new Qa({shape:e,unknownKeys:"strip",catchall:fg.create(),typeName:Oi.ZodObject,...ns(t)});class EO extends Ts{_parse(t){const{ctx:r}=this._processInputParams(t),n=this._def.options;function s(o){for(const i of o)if(i.result.status==="valid")return i.result;for(const i of o)if(i.result.status==="dirty")return r.common.issues.push(...i.ctx.common.issues),i.result;const h=o.map(i=>new lp(i.ctx.common.issues));return gn(r,{code:Ur.invalid_union,unionErrors:h}),Pi}if(r.common.async)return Promise.all(n.map(async o=>{const h={...r,common:{...r.common,issues:[]},parent:null};return{result:await o._parseAsync({data:r.data,path:r.path,parent:h}),ctx:h}})).then(s);{let o;const h=[];for(const m of n){const y={...r,common:{...r.common,issues:[]},parent:null},S=m._parseSync({data:r.data,path:r.path,parent:y});if(S.status==="valid")return S;S.status==="dirty"&&!o&&(o={result:S,ctx:y}),y.common.issues.length&&h.push(y.common.issues)}if(o)return r.common.issues.push(...o.ctx.common.issues),o.result;const i=h.map(m=>new lp(m));return gn(r,{code:Ur.invalid_union,unionErrors:i}),Pi}}get options(){return this._def.options}}EO.create=(e,t)=>new EO({options:e,typeName:Oi.ZodUnion,...ns(t)});function kF(e,t){const r=Sm(e),n=Sm(t);if(e===t)return{valid:!0,data:e};if(r===Pn.object&&n===Pn.object){const s=Cs.objectKeys(t),o=Cs.objectKeys(e).filter(i=>s.indexOf(i)!==-1),h={...e,...t};for(const i of o){const m=kF(e[i],t[i]);if(!m.valid)return{valid:!1};h[i]=m.data}return{valid:!0,data:h}}else if(r===Pn.array&&n===Pn.array){if(e.length!==t.length)return{valid:!1};const s=[];for(let o=0;o<e.length;o++){const h=e[o],i=t[o],m=kF(h,i);if(!m.valid)return{valid:!1};s.push(m.data)}return{valid:!0,data:s}}else return r===Pn.date&&n===Pn.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class TO extends Ts{_parse(t){const{status:r,ctx:n}=this._processInputParams(t),s=(o,h)=>{if(zG(o)||zG(h))return Pi;const i=kF(o.value,h.value);return i.valid?((BG(o)||BG(h))&&r.dirty(),{status:r.value,value:i.data}):(gn(n,{code:Ur.invalid_intersection_types}),Pi)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([o,h])=>s(o,h)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}TO.create=(e,t,r)=>new TO({left:e,right:t,typeName:Oi.ZodIntersection,...ns(r)});class Rv extends Ts{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==Pn.array)return gn(n,{code:Ur.invalid_type,expected:Pn.array,received:n.parsedType}),Pi;if(n.data.length<this._def.items.length)return gn(n,{code:Ur.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Pi;!this._def.rest&&n.data.length>this._def.items.length&&(gn(n,{code:Ur.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const o=[...n.data].map((h,i)=>{const m=this._def.items[i]||this._def.rest;return m?m._parse(new hg(n,h,n.path,i)):null}).filter(h=>!!h);return n.common.async?Promise.all(o).then(h=>Eu.mergeArray(r,h)):Eu.mergeArray(r,o)}get items(){return this._def.items}rest(t){return new Rv({...this._def,rest:t})}}Rv.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Rv({items:e,typeName:Oi.ZodTuple,rest:null,...ns(t)})};class KG extends Ts{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==Pn.map)return gn(n,{code:Ur.invalid_type,expected:Pn.map,received:n.parsedType}),Pi;const s=this._def.keyType,o=this._def.valueType,h=[...n.data.entries()].map(([i,m],y)=>({key:s._parse(new hg(n,i,n.path,[y,"key"])),value:o._parse(new hg(n,m,n.path,[y,"value"]))}));if(n.common.async){const i=new Map;return Promise.resolve().then(async()=>{for(const m of h){const y=await m.key,S=await m.value;if(y.status==="aborted"||S.status==="aborted")return Pi;(y.status==="dirty"||S.status==="dirty")&&r.dirty(),i.set(y.value,S.value)}return{status:r.value,value:i}})}else{const i=new Map;for(const m of h){const y=m.key,S=m.value;if(y.status==="aborted"||S.status==="aborted")return Pi;(y.status==="dirty"||S.status==="dirty")&&r.dirty(),i.set(y.value,S.value)}return{status:r.value,value:i}}}}KG.create=(e,t,r)=>new KG({valueType:t,keyType:e,typeName:Oi.ZodMap,...ns(r)});class bT extends Ts{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==Pn.set)return gn(n,{code:Ur.invalid_type,expected:Pn.set,received:n.parsedType}),Pi;const s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(gn(n,{code:Ur.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),r.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(gn(n,{code:Ur.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),r.dirty());const o=this._def.valueType;function h(m){const y=new Set;for(const S of m){if(S.status==="aborted")return Pi;S.status==="dirty"&&r.dirty(),y.add(S.value)}return{status:r.value,value:y}}const i=[...n.data.values()].map((m,y)=>o._parse(new hg(n,m,n.path,y)));return n.common.async?Promise.all(i).then(m=>h(m)):h(i)}min(t,r){return new bT({...this._def,minSize:{value:t,message:On.toString(r)}})}max(t,r){return new bT({...this._def,maxSize:{value:t,message:On.toString(r)}})}size(t,r){return this.min(t,r).max(t,r)}nonempty(t){return this.min(1,t)}}bT.create=(e,t)=>new bT({valueType:e,minSize:null,maxSize:null,typeName:Oi.ZodSet,...ns(t)});class ZG extends Ts{get schema(){return this._def.getter()}_parse(t){const{ctx:r}=this._processInputParams(t);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}ZG.create=(e,t)=>new ZG({getter:e,typeName:Oi.ZodLazy,...ns(t)});class NF extends Ts{_parse(t){if(t.data!==this._def.value){const r=this._getOrReturnCtx(t);return gn(r,{received:r.data,code:Ur.invalid_literal,expected:this._def.value}),Pi}return{status:"valid",value:t.data}}get value(){return this._def.value}}NF.create=(e,t)=>new NF({value:e,typeName:Oi.ZodLiteral,...ns(t)});function Tae(e,t){return new _b({values:e,typeName:Oi.ZodEnum,...ns(t)})}class _b extends Ts{_parse(t){if(typeof t.data!="string"){const r=this._getOrReturnCtx(t),n=this._def.values;return gn(r,{expected:Cs.joinValues(n),received:r.parsedType,code:Ur.invalid_type}),Pi}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const r=this._getOrReturnCtx(t),n=this._def.values;return gn(r,{received:r.data,code:Ur.invalid_enum_value,options:n}),Pi}return nd(t.data)}get options(){return this._def.values}get enum(){const t={};for(const r of this._def.values)t[r]=r;return t}get Values(){const t={};for(const r of this._def.values)t[r]=r;return t}get Enum(){const t={};for(const r of this._def.values)t[r]=r;return t}extract(t,r=this._def){return _b.create(t,{...this._def,...r})}exclude(t,r=this._def){return _b.create(this.options.filter(n=>!t.includes(n)),{...this._def,...r})}}_b.create=Tae;class XG extends Ts{_parse(t){const r=Cs.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(t);if(n.parsedType!==Pn.string&&n.parsedType!==Pn.number){const s=Cs.objectValues(r);return gn(n,{expected:Cs.joinValues(s),received:n.parsedType,code:Ur.invalid_type}),Pi}if(this._cache||(this._cache=new Set(Cs.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const s=Cs.objectValues(r);return gn(n,{received:n.data,code:Ur.invalid_enum_value,options:s}),Pi}return nd(t.data)}get enum(){return this._def.values}}XG.create=(e,t)=>new XG({values:e,typeName:Oi.ZodNativeEnum,...ns(t)});class AO extends Ts{unwrap(){return this._def.type}_parse(t){const{ctx:r}=this._processInputParams(t);if(r.parsedType!==Pn.promise&&r.common.async===!1)return gn(r,{code:Ur.invalid_type,expected:Pn.promise,received:r.parsedType}),Pi;const n=r.parsedType===Pn.promise?r.data:Promise.resolve(r.data);return nd(n.then(s=>this._def.type.parseAsync(s,{path:r.path,errorMap:r.common.contextualErrorMap})))}}AO.create=(e,t)=>new AO({type:e,typeName:Oi.ZodPromise,...ns(t)});class xb extends Ts{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Oi.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:r,ctx:n}=this._processInputParams(t),s=this._def.effect||null,o={addIssue:h=>{gn(n,h),h.fatal?r.abort():r.dirty()},get path(){return n.path}};if(o.addIssue=o.addIssue.bind(o),s.type==="preprocess"){const h=s.transform(n.data,o);if(n.common.async)return Promise.resolve(h).then(async i=>{if(r.value==="aborted")return Pi;const m=await this._def.schema._parseAsync({data:i,path:n.path,parent:n});return m.status==="aborted"?Pi:m.status==="dirty"||r.value==="dirty"?mE(m.value):m});{if(r.value==="aborted")return Pi;const i=this._def.schema._parseSync({data:h,path:n.path,parent:n});return i.status==="aborted"?Pi:i.status==="dirty"||r.value==="dirty"?mE(i.value):i}}if(s.type==="refinement"){const h=i=>{const m=s.refinement(i,o);if(n.common.async)return Promise.resolve(m);if(m instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return i};if(n.common.async===!1){const i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?Pi:(i.status==="dirty"&&r.dirty(),h(i.value),{status:r.value,value:i.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>i.status==="aborted"?Pi:(i.status==="dirty"&&r.dirty(),h(i.value).then(()=>({status:r.value,value:i.value}))))}if(s.type==="transform")if(n.common.async===!1){const h=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!yb(h))return Pi;const i=s.transform(h.value,o);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:i}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(h=>yb(h)?Promise.resolve(s.transform(h.value,o)).then(i=>({status:r.value,value:i})):Pi);Cs.assertNever(s)}}xb.create=(e,t,r)=>new xb({schema:e,typeName:Oi.ZodEffects,effect:t,...ns(r)});xb.createWithPreprocess=(e,t,r)=>new xb({schema:t,effect:{type:"preprocess",transform:e},typeName:Oi.ZodEffects,...ns(r)});class ng extends Ts{_parse(t){return this._getType(t)===Pn.undefined?nd(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}ng.create=(e,t)=>new ng({innerType:e,typeName:Oi.ZodOptional,...ns(t)});class bb extends Ts{_parse(t){return this._getType(t)===Pn.null?nd(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}bb.create=(e,t)=>new bb({innerType:e,typeName:Oi.ZodNullable,...ns(t)});class IF extends Ts{_parse(t){const{ctx:r}=this._processInputParams(t);let n=r.data;return r.parsedType===Pn.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}IF.create=(e,t)=>new IF({innerType:e,typeName:Oi.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...ns(t)});class RF extends Ts{_parse(t){const{ctx:r}=this._processInputParams(t),n={...r,common:{...r.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return wO(s)?s.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new lp(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new lp(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}RF.create=(e,t)=>new RF({innerType:e,typeName:Oi.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...ns(t)});class YG extends Ts{_parse(t){if(this._getType(t)!==Pn.nan){const n=this._getOrReturnCtx(t);return gn(n,{code:Ur.invalid_type,expected:Pn.nan,received:n.parsedType}),Pi}return{status:"valid",value:t.data}}}YG.create=e=>new YG({typeName:Oi.ZodNaN,...ns(e)});class Wke extends Ts{_parse(t){const{ctx:r}=this._processInputParams(t),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}}class G5 extends Ts{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.common.async)return(async()=>{const o=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?Pi:o.status==="dirty"?(r.dirty(),mE(o.value)):this._def.out._parseAsync({data:o.value,path:n.path,parent:n})})();{const s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?Pi:s.status==="dirty"?(r.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(t,r){return new G5({in:t,out:r,typeName:Oi.ZodPipeline})}}class MF extends Ts{_parse(t){const r=this._def.innerType._parse(t),n=s=>(yb(s)&&(s.value=Object.freeze(s.value)),s);return wO(r)?r.then(s=>n(s)):n(r)}unwrap(){return this._def.innerType}}MF.create=(e,t)=>new MF({innerType:e,typeName:Oi.ZodReadonly,...ns(t)});Qa.lazycreate;var Oi;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(Oi||(Oi={}));const bn=Hf.create,DF=Nv.create;Iv.create;const wT=SO.create,JG=vb.create;fg.create;const pP=$h.create,jh=Qa.create;Qa.strictCreate;EO.create;TO.create;Rv.create;const Kke=NF.create,ST=_b.create;AO.create;ng.create;bb.create;const JD={string:e=>Hf.create({...e,coerce:!0}),number:e=>Nv.create({...e,coerce:!0}),boolean:e=>SO.create({...e,coerce:!0}),bigint:e=>Iv.create({...e,coerce:!0}),date:e=>vb.create({...e,coerce:!0})};var $N="Checkbox",[Zke,fst]=Mo($N),[Xke,W5]=Zke($N);function Yke(e){const{__scopeCheckbox:t,checked:r,children:n,defaultChecked:s,disabled:o,form:h,name:i,onCheckedChange:m,required:y,value:S="on",internal_do_not_use_render:b}=e,[T,A]=Zc({prop:r,defaultProp:s??!1,onChange:m,caller:$N}),[O,P]=V.useState(null),[I,R]=V.useState(null),M=V.useRef(!1),F=O?!!h||!!O.closest("form"):!0,z={checked:T,disabled:o,setChecked:A,control:O,setControl:P,name:i,form:h,value:S,hasConsumerStoppedPropagationRef:M,required:y,defaultChecked:ig(s)?!1:s,isFormControl:F,bubbleInput:I,setBubbleInput:R};return d.jsx(Xke,{scope:t,...z,children:Jke(b)?b(z):n})}var Aae="CheckboxTrigger",Cae=V.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:r,...n},s)=>{const{control:o,value:h,disabled:i,checked:m,required:y,setControl:S,setChecked:b,hasConsumerStoppedPropagationRef:T,isFormControl:A,bubbleInput:O}=W5(Aae,e),P=Un(s,S),I=V.useRef(m);return V.useEffect(()=>{const R=o==null?void 0:o.form;if(R){const M=()=>b(I.current);return R.addEventListener("reset",M),()=>R.removeEventListener("reset",M)}},[o,b]),d.jsx(ln.button,{type:"button",role:"checkbox","aria-checked":ig(m)?"mixed":m,"aria-required":y,"data-state":Nae(m),"data-disabled":i?"":void 0,disabled:i,value:h,...n,ref:P,onKeyDown:Ir(t,R=>{R.key==="Enter"&&R.preventDefault()}),onClick:Ir(r,R=>{b(M=>ig(M)?!0:!M),O&&A&&(T.current=R.isPropagationStopped(),T.current||R.stopPropagation())})})});Cae.displayName=Aae;var K5=V.forwardRef((e,t)=>{const{__scopeCheckbox:r,name:n,checked:s,defaultChecked:o,required:h,disabled:i,value:m,onCheckedChange:y,form:S,...b}=e;return d.jsx(Yke,{__scopeCheckbox:r,checked:s,defaultChecked:o,disabled:i,required:h,onCheckedChange:y,name:n,form:S,value:m,internal_do_not_use_render:({isFormControl:T})=>d.jsxs(d.Fragment,{children:[d.jsx(Cae,{...b,ref:t,__scopeCheckbox:r}),T&&d.jsx(kae,{__scopeCheckbox:r})]})})});K5.displayName=$N;var jae="CheckboxIndicator",Pae=V.forwardRef((e,t)=>{const{__scopeCheckbox:r,forceMount:n,...s}=e,o=W5(jae,r);return d.jsx(Do,{present:n||ig(o.checked)||o.checked===!0,children:d.jsx(ln.span,{"data-state":Nae(o.checked),"data-disabled":o.disabled?"":void 0,...s,ref:t,style:{pointerEvents:"none",...e.style}})})});Pae.displayName=jae;var Oae="CheckboxBubbleInput",kae=V.forwardRef(({__scopeCheckbox:e,...t},r)=>{const{control:n,hasConsumerStoppedPropagationRef:s,checked:o,defaultChecked:h,required:i,disabled:m,name:y,value:S,form:b,bubbleInput:T,setBubbleInput:A}=W5(Oae,e),O=Un(r,A),P=L2(o),I=S2(n);V.useEffect(()=>{const M=T;if(!M)return;const F=window.HTMLInputElement.prototype,$=Object.getOwnPropertyDescriptor(F,"checked").set,W=!s.current;if(P!==o&&$){const K=new Event("click",{bubbles:W});M.indeterminate=ig(o),$.call(M,ig(o)?!1:o),M.dispatchEvent(K)}},[T,P,o,s]);const R=V.useRef(ig(o)?!1:o);return d.jsx(ln.input,{type:"checkbox","aria-hidden":!0,defaultChecked:h??R.current,required:i,disabled:m,name:y,value:S,form:b,...t,tabIndex:-1,ref:O,style:{...t.style,...I,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});kae.displayName=Oae;function Jke(e){return typeof e=="function"}function ig(e){return e==="indeterminate"}function Nae(e){return ig(e)?"indeterminate":e?"checked":"unchecked"}const Yo=V.forwardRef(({className:e,...t},r)=>d.jsx(K5,{ref:r,className:fr("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:d.jsx(Pae,{className:fr("flex items-center justify-center text-current"),children:d.jsx(ip,{className:"h-4 w-4"})})}));Yo.displayName=K5.displayName;var UN="Tabs",[Qke,pst]=Mo(UN,[ow]),Iae=ow(),[eNe,Z5]=Qke(UN),Rae=V.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,onValueChange:s,defaultValue:o,orientation:h="horizontal",dir:i,activationMode:m="automatic",...y}=e,S=Zv(i),[b,T]=Zc({prop:n,onChange:s,defaultProp:o??"",caller:UN});return d.jsx(eNe,{scope:r,baseId:_u(),value:b,onValueChange:T,orientation:h,dir:S,activationMode:m,children:d.jsx(ln.div,{dir:S,"data-orientation":h,...y,ref:t})})});Rae.displayName=UN;var Mae="TabsList",Dae=V.forwardRef((e,t)=>{const{__scopeTabs:r,loop:n=!0,...s}=e,o=Z5(Mae,r),h=Iae(r);return d.jsx(c5,{asChild:!0,...h,orientation:o.orientation,dir:o.dir,loop:n,children:d.jsx(ln.div,{role:"tablist","aria-orientation":o.orientation,...s,ref:t})})});Dae.displayName=Mae;var Lae="TabsTrigger",Fae=V.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,disabled:s=!1,...o}=e,h=Z5(Lae,r),i=Iae(r),m=$ae(h.baseId,n),y=Uae(h.baseId,n),S=n===h.value;return d.jsx(u5,{asChild:!0,...i,focusable:!s,active:S,children:d.jsx(ln.button,{type:"button",role:"tab","aria-selected":S,"aria-controls":y,"data-state":S?"active":"inactive","data-disabled":s?"":void 0,disabled:s,id:m,...o,ref:t,onMouseDown:Ir(e.onMouseDown,b=>{!s&&b.button===0&&b.ctrlKey===!1?h.onValueChange(n):b.preventDefault()}),onKeyDown:Ir(e.onKeyDown,b=>{[" ","Enter"].includes(b.key)&&h.onValueChange(n)}),onFocus:Ir(e.onFocus,()=>{const b=h.activationMode!=="manual";!S&&!s&&b&&h.onValueChange(n)})})})});Fae.displayName=Lae;var zae="TabsContent",Bae=V.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,forceMount:s,children:o,...h}=e,i=Z5(zae,r),m=$ae(i.baseId,n),y=Uae(i.baseId,n),S=n===i.value,b=V.useRef(S);return V.useEffect(()=>{const T=requestAnimationFrame(()=>b.current=!1);return()=>cancelAnimationFrame(T)},[]),d.jsx(Do,{present:s||S,children:({present:T})=>d.jsx(ln.div,{"data-state":S?"active":"inactive","data-orientation":i.orientation,role:"tabpanel","aria-labelledby":m,hidden:!T,id:y,tabIndex:0,...h,ref:t,style:{...e.style,animationDuration:b.current?"0s":void 0},children:T&&o})})});Bae.displayName=zae;function $ae(e,t){return`${e}-trigger-${t}`}function Uae(e,t){return`${e}-content-${t}`}var tNe=Rae,Vae=Dae,qae=Fae,Hae=Bae;const Mv=tNe,pg=V.forwardRef(({className:e,...t},r)=>d.jsx(Vae,{ref:r,className:fr("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));pg.displayName=Vae.displayName;const Ca=V.forwardRef(({className:e,...t},r)=>d.jsx(qae,{ref:r,className:fr("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",e),...t}));Ca.displayName=qae.displayName;const ja=V.forwardRef(({className:e,...t},r)=>d.jsx(Hae,{ref:r,className:fr("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));ja.displayName=Hae.displayName;const rNe=jh({name:bn().min(1,Pr.t("validation.nameRequired")),name_en:bn().min(1,Pr.t("validation.nameRequired")),name_pt:bn().min(1,Pr.t("validation.nameRequired")),type:pP(bn()).min(1,Pr.t("validation.typeRequired")).max(3,Pr.t("validation.typeMaximum")),type_en:pP(bn()).min(1,Pr.t("validation.typeRequired")).max(3,Pr.t("validation.typeMaximum")),type_pt:pP(bn()).min(1,Pr.t("validation.typeRequired")).max(3,Pr.t("validation.typeMaximum")),description:bn().optional(),description_en:bn().optional(),description_pt:bn().optional(),address:bn().min(1,Pr.t("validation.addressRequired")),lat:DF(),lng:DF(),phone:bn().optional(),website_url:bn().optional(),show_website_button:wT().default(!0)}),QG=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"];function CO({restaurant:e,trigger:t}){const{t:r}=ci(),{toast:n}=Ri(),s=Mi(),[o,h]=V.useState(!1),[i,m]=V.useState(null),[y,S]=V.useState((e==null?void 0:e.image_url)||null),[b,T]=V.useState(!1),A=V.useRef(null),O=V.useRef(null),P=V.useRef(null),[I,R]=V.useState(()=>{const me={};return QG.forEach(Ae=>{me[Ae]={open:"12:00",close:"23:00",closed:!1,splitShift:!1,open2:"19:00",close2:"23:00"}}),e!=null&&e.opening_hours?{...me,...e.opening_hours}:me}),[M,F]=V.useState(()=>e!=null&&e.type&&Array.isArray(e.type)?e.type.map((me,Ae)=>{var ge,pe;return{zh:me,en:((ge=e.type_en)==null?void 0:ge[Ae])||"",pt:((pe=e.type_pt)==null?void 0:pe[Ae])||""}}):[{zh:"",en:"",pt:""}]),{register:z,handleSubmit:$,formState:{errors:W},setValue:K,watch:ee}=Ah({resolver:Ch(rNe),defaultValues:e?{name:e.name,name_en:e.name_en||"",name_pt:e.name_pt||"",type:Array.isArray(e.type)?e.type:[e.type],type_en:Array.isArray(e.type_en)?e.type_en:e.type_en?[e.type_en]:[""],type_pt:Array.isArray(e.type_pt)?e.type_pt:e.type_pt?[e.type_pt]:[""],description:e.description||"",description_en:e.description_en||"",description_pt:e.description_pt||"",address:e.address,lat:typeof e.lat=="number"&&!isNaN(e.lat)?e.lat:38.7223,lng:typeof e.lng=="number"&&!isNaN(e.lng)?e.lng:-9.1393,phone:e.phone||"",website_url:e.website_url||"",show_website_button:e.show_website_button??!0}:{name:"",name_en:"",name_pt:"",type:[""],type_en:[""],type_pt:[""],description:"",description_en:"",description_pt:"",address:"",lat:38.7223,lng:-9.1393,phone:"",website_url:"",show_website_button:!0}}),ne=()=>{M.length<3&&F([...M,{zh:"",en:"",pt:""}])},ie=me=>{M.length>1&&F(M.filter((Ae,ge)=>ge!==me))},re=(me,Ae,ge)=>{const pe=[...M];pe[me][Ae]=ge,F(pe),K("type",pe.map(Oe=>Oe.zh).filter(Boolean)),K("type_en",pe.map(Oe=>Oe.en).filter(Boolean)),K("type_pt",pe.map(Oe=>Oe.pt).filter(Boolean))},te=ee("lat"),ae=ee("lng"),ue=ee("show_website_button"),be=(me,Ae)=>typeof me=="number"&&typeof Ae=="number"&&!isNaN(me)&&!isNaN(Ae)&&isFinite(me)&&isFinite(Ae);V.useEffect(()=>{if(!o){O.current&&(O.current.remove(),O.current=null,P.current=null);return}if(O.current)return;const me="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g",ge=setTimeout(()=>{if(!A.current){console.error("Map container not found");return}try{Oo.accessToken=me;const pe=be(te,ae)?ae:-9.1393,Oe=be(te,ae)?te:38.7223;O.current=new Oo.Map({container:A.current,style:"mapbox://styles/mapbox/light-v11",center:[pe,Oe],zoom:15}),O.current.scrollZoom.disable(),O.current.on("load",()=>{O.current&&(be(te,ae)&&(P.current=new Oo.Marker({draggable:!0}).setLngLat([ae,te]).addTo(O.current)),P.current.on("dragend",()=>{const Ze=P.current.getLngLat();K("lng",Ze.lng),K("lat",Ze.lat)}),setTimeout(()=>{var Ze;(Ze=O.current)==null||Ze.resize()},100))});const Je=Ze=>{var Pe,Be;Ze.ctrlKey||Ze.metaKey?(Pe=O.current)==null||Pe.scrollZoom.enable():(Be=O.current)==null||Be.scrollZoom.disable()};A.current.addEventListener("wheel",Je),O.current.on("click",Ze=>{var nt;const{lng:Pe,lat:Be}=Ze.lngLat;K("lng",Pe),K("lat",Be),(nt=P.current)==null||nt.setLngLat([Pe,Be])}),O.current.on("error",Ze=>{console.error("Map error:",Ze)})}catch(pe){console.error("Failed to initialize map:",pe)}},500);return()=>{clearTimeout(ge)}},[o,te,ae]),V.useEffect(()=>{P.current&&O.current&&be(te,ae)&&(P.current.setLngLat([ae,te]),O.current.setCenter([ae,te]))},[te,ae]);const we=me=>{var ge;const Ae=(ge=me.target.files)==null?void 0:ge[0];if(Ae){m(Ae);const pe=new FileReader;pe.onloadend=()=>{S(pe.result)},pe.readAsDataURL(Ae)}},Ce=async()=>{if(!i)return(e==null?void 0:e.image_url)||null;const me=i.name.split(".").pop(),ge=`${`${Math.random()}.${me}`}`,{error:pe}=await Ct.storage.from("restaurant-images").upload(ge,i);if(pe)throw pe;const{data:{publicUrl:Oe}}=Ct.storage.from("restaurant-images").getPublicUrl(ge);return Oe},_e=async me=>{T(!0);try{const{data:{user:Ae}}=await Ct.auth.getUser();if(!Ae)throw new Error("Not authenticated");const ge=await Ce(),pe={name:me.name,name_en:me.name_en,name_pt:me.name_pt,type:me.type,type_en:me.type_en,type_pt:me.type_pt,description:me.description||null,description_en:me.description_en||null,description_pt:me.description_pt||null,address:me.address,lat:me.lat,lng:me.lng,phone:me.phone||null,website_url:me.website_url||null,show_website_button:me.show_website_button,image_url:ge,opening_hours:I};if(e){const{error:Oe}=await Ct.from("restaurants").update({...pe,updated_by:Ae.id}).eq("id",e.id);if(Oe)throw Oe;n({title:r("common.success"),description:r("admin.restaurantUpdated")})}else{const{error:Oe}=await Ct.from("restaurants").insert([{...pe,created_by:Ae.id}]);if(Oe)throw Oe;n({title:r("common.success"),description:r("admin.restaurantCreated")})}s.invalidateQueries({queryKey:["restaurants"]}),h(!1)}catch(Ae){n({title:r("common.error"),description:Ae.message,variant:"destructive"})}finally{T(!1)}};return d.jsxs(fl,{open:o,onOpenChange:h,children:[d.jsx(tf,{asChild:!0,children:t}),d.jsxs(Jo,{className:"max-w-[95vw] sm:max-w-6xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[d.jsxs(Qo,{className:"px-6 pt-6 pb-4 border-b bg-muted/30",children:[d.jsxs(el,{className:"text-2xl flex items-center gap-2",children:[d.jsx(Io,{className:"w-6 h-6 text-primary"}),r(e?"admin.editRestaurant":"admin.addRestaurant")]}),d.jsx(Ul,{className:"text-base",children:r(e?"admin.editRestaurantDetails":"admin.createRestaurantWithInfo")})]}),d.jsx(jv,{className:"px-6 h-[calc(95vh-220px)]",children:d.jsxs("form",{onSubmit:$(_e),className:"space-y-6 py-6",children:[d.jsx(Nr,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:d.jsxs(Mr,{className:"p-6",children:[d.jsxs(yr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[d.jsx(zh,{className:"w-5 h-5 text-primary"}),r("admin.restaurantImage")]}),d.jsxs("div",{className:"flex items-center gap-6",children:[y&&d.jsxs("div",{className:"relative group",children:[d.jsx("img",{src:y,alt:"Preview",className:"w-40 h-40 object-cover rounded-lg shadow-lg ring-2 ring-primary/20 transition-transform duration-200 group-hover:scale-105"}),d.jsx(Mt,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-8 w-8 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{m(null),S(null)},children:d.jsx(Xc,{className:"h-4 w-4"})})]}),d.jsxs(yr,{htmlFor:"image-upload",className:"cursor-pointer",children:[d.jsxs("div",{className:"flex flex-col items-center gap-3 px-8 py-6 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[d.jsx(zh,{className:"h-8 w-8 text-primary"}),d.jsxs("div",{className:"text-center",children:[d.jsx("p",{className:"font-medium text-sm",children:r("admin.uploadImage")}),d.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r("admin.imageMaxSize")})]})]}),d.jsx(cr,{id:"image-upload",type:"file",accept:"image/*",className:"hidden",onChange:we})]})]})]})}),d.jsx(Nr,{className:"border-primary/20",children:d.jsxs(Mr,{className:"p-6",children:[d.jsxs(yr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[d.jsx(fv,{className:"w-5 h-5 text-primary"}),r("admin.multilingualContent")]}),d.jsxs(Mv,{defaultValue:"zh",className:"w-full",children:[d.jsxs(pg,{className:"grid w-full grid-cols-3 mb-6",children:[d.jsxs(Ca,{value:"zh",className:"gap-2",children:[" ",r("admin.chinese")]}),d.jsxs(Ca,{value:"en",className:"gap-2",children:[" ",r("admin.english")]}),d.jsxs(Ca,{value:"pt",className:"gap-2",children:[" ",r("admin.portuguese")]})]}),d.jsxs(ja,{value:"zh",className:"space-y-4 mt-0",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"name",className:"text-sm font-medium",children:r("admin.restaurantName")}),d.jsx(cr,{id:"name",...z("name"),placeholder:r("admin.enterRestaurantName"),className:"text-base"}),W.name&&d.jsx("p",{className:"text-sm text-destructive",children:W.name.message})]}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx(yr,{className:"text-sm font-medium",children:r("admin.restaurantType")}),M.length<3&&d.jsx(Mt,{type:"button",variant:"outline",size:"sm",onClick:ne,children:r("admin.addType")})]}),M.map((me,Ae)=>d.jsxs("div",{className:"flex gap-2 items-center",children:[d.jsx(cr,{placeholder:r("admin.typeExample"),value:me.zh,onChange:ge=>re(Ae,"zh",ge.target.value)}),d.jsx(Mt,{type:"button",variant:"ghost",size:"icon",onClick:()=>ie(Ae),disabled:M.length===1,children:d.jsx(Xc,{className:"h-4 w-4"})})]},Ae)),W.type&&d.jsx("p",{className:"text-sm text-destructive",children:W.type.message})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"description",className:"text-sm font-medium",children:r("admin.description")}),d.jsx(hl,{id:"description",...z("description"),rows:3,placeholder:"..."})]})]}),d.jsxs(ja,{value:"en",className:"space-y-4 mt-0",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"name_en",className:"text-sm font-medium",children:"Restaurant Name"}),d.jsx(cr,{id:"name_en",...z("name_en"),placeholder:"Enter restaurant name...",className:"text-base"}),W.name_en&&d.jsx("p",{className:"text-sm text-destructive",children:W.name_en.message})]}),d.jsxs("div",{className:"space-y-3",children:[d.jsx(yr,{className:"text-sm font-medium",children:"Restaurant Types (1-3 tags)"}),M.map((me,Ae)=>d.jsx("div",{className:"flex gap-2 items-center",children:d.jsx(cr,{placeholder:"e.g. Cantonese",value:me.en,onChange:ge=>re(Ae,"en",ge.target.value)})},Ae))]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"description_en",className:"text-sm font-medium",children:"Description"}),d.jsx(hl,{id:"description_en",...z("description_en"),rows:3,placeholder:"Enter restaurant description..."})]})]}),d.jsxs(ja,{value:"pt",className:"space-y-4 mt-0",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"name_pt",className:"text-sm font-medium",children:"Nome do Restaurante"}),d.jsx(cr,{id:"name_pt",...z("name_pt"),placeholder:"Digite o nome do restaurante...",className:"text-base"}),W.name_pt&&d.jsx("p",{className:"text-sm text-destructive",children:W.name_pt.message})]}),d.jsxs("div",{className:"space-y-3",children:[d.jsx(yr,{className:"text-sm font-medium",children:"Tipos de Restaurante (1-3 tags)"}),M.map((me,Ae)=>d.jsx("div",{className:"flex gap-2 items-center",children:d.jsx(cr,{placeholder:"ex: Cantonesa",value:me.pt,onChange:ge=>re(Ae,"pt",ge.target.value)})},Ae))]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"description_pt",className:"text-sm font-medium",children:"Descrio"}),d.jsx(hl,{id:"description_pt",...z("description_pt"),rows:3,placeholder:"Digite a descrio do restaurante..."})]})]})]})]})}),d.jsx(Nr,{className:"border-primary/20",children:d.jsxs(Mr,{className:"p-6 space-y-4",children:[d.jsxs(yr,{className:"text-base font-semibold flex items-center gap-2",children:[d.jsx(Pa,{className:"w-5 h-5 text-primary"}),""]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsxs(yr,{htmlFor:"address",className:"text-sm font-medium flex items-center gap-2",children:[d.jsx(Pa,{className:"w-4 h-4"}),r("admin.address")]}),d.jsx(cr,{id:"address",...z("address"),placeholder:"..."}),W.address&&d.jsx("p",{className:"text-sm text-destructive",children:W.address.message})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs(yr,{htmlFor:"phone",className:"text-sm font-medium flex items-center gap-2",children:[d.jsx(Jb,{className:"w-4 h-4"}),r("admin.phone")]}),d.jsx(cr,{id:"phone",...z("phone"),placeholder:"+351..."})]})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsxs(yr,{htmlFor:"website_url",className:"text-sm font-medium flex items-center gap-2",children:[d.jsx(fv,{className:"w-4 h-4"}),r("admin.website")]}),d.jsx(cr,{id:"website_url",...z("website_url"),placeholder:"https://"})]}),d.jsxs("div",{className:"flex items-center space-x-2 pt-8",children:[d.jsx(Yo,{id:"show_website_button",checked:ue,onCheckedChange:me=>K("show_website_button",me)}),d.jsx(yr,{htmlFor:"show_website_button",className:"cursor-pointer text-sm",children:r("admin.showWebsiteButton")})]})]})]})}),d.jsx(Nr,{className:"border-primary/20",children:d.jsxs(Mr,{className:"p-6 space-y-4",children:[d.jsxs(yr,{className:"text-base font-semibold flex items-center gap-2",children:[d.jsx(Pa,{className:"w-5 h-5 text-primary"}),r("admin.location")]}),d.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"lat",className:"text-sm font-medium",children:r("admin.latitude")}),d.jsx(cr,{id:"lat",type:"number",step:"any",...z("lat",{valueAsNumber:!0})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"lng",className:"text-sm font-medium",children:r("admin.longitude")}),d.jsx(cr,{id:"lng",type:"number",step:"any",...z("lng",{valueAsNumber:!0})})]})]}),d.jsx("div",{ref:A,className:"h-96 w-full rounded-lg border-2 border-primary/20 shadow-sm",style:{minHeight:"384px"}}),d.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[d.jsx(Pa,{className:"w-4 h-4"}),r("admin.clickOrDragToSetLocation")]})]})}),d.jsx(Nr,{className:"border-primary/20",children:d.jsxs(Mr,{className:"p-6 space-y-4",children:[d.jsxs(yr,{className:"text-base font-semibold flex items-center gap-2",children:[d.jsx(Kv,{className:"w-5 h-5 text-primary"}),r("admin.openingHours")]}),d.jsx("div",{className:"space-y-3",children:QG.map(me=>d.jsxs("div",{className:"space-y-2 p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[d.jsxs("div",{className:"grid grid-cols-[120px_1fr_auto] gap-4 items-center",children:[d.jsx(yr,{className:"capitalize font-semibold",children:r(`admin.day.${me}`)}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Yo,{id:`split-${me}`,checked:I[me].splitShift,onCheckedChange:Ae=>R({...I,[me]:{...I[me],splitShift:Ae}}),disabled:I[me].closed}),d.jsx(yr,{htmlFor:`split-${me}`,className:"cursor-pointer text-sm",children:""})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx(Yo,{id:`closed-${me}`,checked:I[me].closed,onCheckedChange:Ae=>R({...I,[me]:{...I[me],closed:Ae}})}),d.jsx(yr,{htmlFor:`closed-${me}`,className:"cursor-pointer",children:r("admin.closed")})]})]}),!I[me].closed&&d.jsx("div",{className:"ml-[120px] space-y-2",children:I[me].splitShift?d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-sm text-muted-foreground w-12",children:""}),d.jsx(cr,{type:"time",value:I[me].open,onChange:Ae=>R({...I,[me]:{...I[me],open:Ae.target.value}}),className:"w-32"}),d.jsx("span",{className:"text-muted-foreground",children:"-"}),d.jsx(cr,{type:"time",value:I[me].close,onChange:Ae=>R({...I,[me]:{...I[me],close:Ae.target.value}}),className:"w-32"})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-sm text-muted-foreground w-12",children:""}),d.jsx(cr,{type:"time",value:I[me].open2||"19:00",onChange:Ae=>R({...I,[me]:{...I[me],open2:Ae.target.value}}),className:"w-32"}),d.jsx("span",{className:"text-muted-foreground",children:"-"}),d.jsx(cr,{type:"time",value:I[me].close2||"23:00",onChange:Ae=>R({...I,[me]:{...I[me],close2:Ae.target.value}}),className:"w-32"})]})]}):d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(cr,{type:"time",value:I[me].open,onChange:Ae=>R({...I,[me]:{...I[me],open:Ae.target.value}}),className:"w-32"}),d.jsx("span",{className:"text-muted-foreground",children:"-"}),d.jsx(cr,{type:"time",value:I[me].close,onChange:Ae=>R({...I,[me]:{...I[me],close:Ae.target.value}}),className:"w-32"})]})})]},me))})]})})]})}),d.jsxs("div",{className:"flex justify-end gap-2 px-6 py-4 border-t bg-muted/30",children:[d.jsx(Mt,{type:"button",variant:"outline",onClick:()=>h(!1),children:r("common.cancel")}),d.jsxs(Mt,{type:"submit",disabled:b,onClick:$(_e),className:"gap-2",children:[d.jsx(Io,{className:"w-4 h-4"}),r(b?"common.saving":"common.save")]})]})]})]})}const nNe=e=>(ci(),ei({queryKey:["restaurant-activities",e],queryFn:async()=>{const{data:t,error:r}=await Ct.from("activity_restaurants").select(`
          activity_id,
          activities (
            id,
            title_zh,
            title_en,
            title_pt,
            intro_zh,
            intro_en,
            intro_pt,
            badge_text_zh,
            badge_text_en,
            badge_text_pt,
            badge_color,
            start_date,
            end_date
          )
        `).eq("restaurant_id",e);if(r)throw r;const n=new Date;return t.filter(o=>{const h=o.activities;if(!h)return!1;const i=new Date(h.start_date),m=h.end_date?new Date(h.end_date):null;return i<=n&&(!m||m>=n)}).map(o=>({activity_id:o.activity_id,title_zh:o.activities.title_zh,title_en:o.activities.title_en,title_pt:o.activities.title_pt,intro_zh:o.activities.intro_zh,intro_en:o.activities.intro_en,intro_pt:o.activities.intro_pt,badge_text_zh:o.activities.badge_text_zh,badge_text_en:o.activities.badge_text_en,badge_text_pt:o.activities.badge_text_pt,badge_color:o.activities.badge_color}))},enabled:!!e})),iNe=(e,t)=>t==="zh"?e.title_zh:t==="pt"?e.title_pt:e.title_en,eW=(e,t)=>{let r="";return t==="zh"?r=e.badge_text_zh||e.title_zh:t==="pt"?r=e.badge_text_pt||e.title_pt:r=e.badge_text_en||e.title_en,r},sNe=(e,t)=>t==="zh"?e.intro_zh||"":t==="pt"?e.intro_pt||"":e.intro_en||"",QD=768;function VN(){const[e,t]=V.useState(void 0);return V.useEffect(()=>{const r=window.matchMedia(`(max-width: ${QD-1}px)`),n=()=>{t(window.innerWidth<QD)};return r.addEventListener("change",n),t(window.innerWidth<QD),()=>r.removeEventListener("change",n)},[]),!!e}const aNe=()=>{var Ze,Pe,Be;const{id:e}=GB(),t=Qh(),{t:r,i18n:n}=ci(),{user:s}=Kn(),{localizeRestaurant:o,getLocalizedField:h}=xc(),i=VN(),m=V.useRef(null),y=V.useRef(null),[S,b]=V.useState(null),[T,A]=V.useState(!1),[O,P]=V.useState(!0),[I,R]=V.useState(!1),[M,F]=V.useState(!1),z=(Ze=t.state)==null?void 0:Ze.fromActivity,W=((Pe=t.state)==null?void 0:Pe.from)==="admin"?"/admin/restaurants":z?`/activity/${z}`:"/restaurants",{data:K,isLoading:ee}=CPe(e),{data:ne=[]}=Die(),{data:ie}=R5(e,"restaurant"),re=Lie(),{role:te,isAdmin:ae}=_c(),{data:ue=[]}=F2(),{data:be=[]}=nNe(e),we=K&&ue.some(nt=>nt.id===K.id),Ce=K?o(K):null,_e=K?ne.includes(K.id):!1;V.useMemo(()=>[{value:"",label:" (0-10)"},{value:"",label:" (10-20)"},{value:"",label:" (20+)"}],[]);const me=V.useMemo(()=>ie==null?void 0:ie.reduce((nt,Me)=>(Me.price_range&&(nt[Me.price_range]=(nt[Me.price_range]||0)+1),nt),{}),[ie]),Ae=V.useMemo(()=>{var nt;return me?(nt=Object.entries(me).sort(([,Me],[,We])=>We-Me)[0])==null?void 0:nt[0]:null},[me]);V.useEffect(()=>{K&&IN().then(nt=>{const Me=D2(nt.coords.latitude,nt.coords.longitude,K.lat,K.lng);b(Me)}).catch(()=>{b(null)})},[K]);const ge=V.useCallback(()=>{!s||!K||re.mutate(K.id)},[s,K,re]),pe=V.useCallback(async()=>{try{await navigator.clipboard.writeText(window.location.href),kr.success(r("common.linkCopied"))}catch(nt){console.error("Error copying link:",nt),kr.error(r("common.shareError"))}},[r]),Oe=V.useCallback(async()=>{if(!K||!Ce)return;const nt={title:Ce.name,text:`${Ce.name} - Xiaoxiong Market

${Ce.description||Ce.address}`,url:window.location.href};try{navigator.share&&navigator.canShare&&navigator.canShare(nt)?(await navigator.share(nt),kr.success(r("common.shareSuccess"))):pe()}catch(Me){Me.name!=="AbortError"&&(console.error("Error sharing:",Me),kr.error(r("common.shareError")))}},[K,Ce,pe,r]),Je=V.useCallback(nt=>{if(!K||!Ce)return;const Me=encodeURIComponent(window.location.href),We=encodeURIComponent(Ce.name);let gt="";switch(nt){case"whatsapp":gt=`https://wa.me/?text=${We}%20${Me}`;break;case"facebook":gt=`https://www.facebook.com/sharer/sharer.php?u=${Me}`;break;case"twitter":gt=`https://twitter.com/intent/tweet?text=${We}&url=${Me}`;break;case"telegram":gt=`https://t.me/share/url?url=${Me}&text=${We}`;break;case"wechat":pe(),kr.info(r("common.shareVia")+" WeChat");return;default:return}window.open(gt,"_blank","width=600,height=400")},[K,Ce,pe,r]);return V.useEffect(()=>{if(!m.current||y.current||!K)return;const nt="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";return Oo.accessToken=nt,y.current=new Oo.Map({container:m.current,style:"mapbox://styles/mapbox/light-v11",center:[K.lng,K.lat],zoom:15,cooperativeGestures:!0}),new Oo.Marker({color:"#016450"}).setLngLat([K.lng,K.lat]).addTo(y.current),y.current.addControl(new Oo.NavigationControl),()=>{var Me;(Me=y.current)==null||Me.remove(),y.current=null}},[K]),ee?d.jsx("div",{className:"min-h-screen flex items-center justify-center",children:d.jsx(_a,{className:"w-8 h-8 animate-spin text-primary"})}):!K||!Ce?d.jsx("div",{className:"min-h-screen flex items-center justify-center",children:d.jsxs("div",{className:"text-center",children:[d.jsx("p",{className:"text-xl text-muted-foreground",children:r("error.notFound")}),d.jsx(Mt,{asChild:!0,className:"mt-4",children:d.jsx(ji,{to:W,children:r("common.back")})})]})}):d.jsxs("div",{className:"min-h-screen bg-secondary/20",children:[d.jsxs("div",{className:"relative h-[33vh] overflow-hidden",children:[d.jsx("img",{src:K.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80",alt:Ce.name,className:"w-full h-full object-cover"}),d.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),d.jsx(Mt,{asChild:!0,variant:"secondary",size:"icon",className:"absolute top-4 left-4",children:d.jsx(ji,{to:W,children:d.jsx(Jk,{className:"w-5 h-5"})})}),s&&d.jsx(Mt,{variant:"secondary",size:"icon",className:"absolute top-4 right-4",onClick:ge,children:d.jsx(HP,{className:`w-5 h-5 ${_e?"fill-destructive text-destructive":""}`})}),i&&navigator.share?d.jsx(Mt,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${s?"right-16":"right-4"}`,onClick:Oe,children:d.jsx(Zx,{className:"w-5 h-5"})}):d.jsxs(lw,{children:[d.jsx(cw,{asChild:!0,children:d.jsx(Mt,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${s?"right-16":"right-4"}`,children:d.jsx(Zx,{className:"w-5 h-5"})})}),d.jsxs(Jv,{align:"end",className:"w-48",children:[navigator.share&&d.jsxs(d.Fragment,{children:[d.jsxs(Ta,{onClick:Oe,children:[d.jsx(Zx,{className:"w-4 h-4 mr-2"}),r("common.moreOptions")]}),d.jsx(pv,{})]}),d.jsxs(Ta,{onClick:()=>Je("wechat"),children:[d.jsx(FS,{className:"w-4 h-4 mr-2"}),"WeChat"]}),d.jsxs(Ta,{onClick:()=>Je("whatsapp"),children:[d.jsx(FS,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),d.jsxs(Ta,{onClick:()=>Je("facebook"),children:[d.jsx(Zx,{className:"w-4 h-4 mr-2"}),"Facebook"]}),d.jsxs(Ta,{onClick:()=>Je("twitter"),children:[d.jsx(Zx,{className:"w-4 h-4 mr-2"}),"X (Twitter)"]}),d.jsxs(Ta,{onClick:()=>Je("telegram"),children:[d.jsx(FS,{className:"w-4 h-4 mr-2"}),"Telegram"]}),d.jsx(pv,{}),d.jsxs(Ta,{onClick:pe,children:[d.jsx(O_e,{className:"w-4 h-4 mr-2"}),r("common.copyLink")]})]})]}),(we||ae)&&K&&d.jsx(CO,{restaurant:K,trigger:d.jsx(Mt,{variant:"secondary",size:"icon",className:`absolute top-4 ${s?"right-28":"right-16"}`,children:d.jsx(b2,{className:"w-5 h-5"})})}),K&&d.jsx(F5,{targetType:"restaurant",targetId:K.id,trigger:d.jsx(Mt,{variant:"secondary",size:"icon",className:`absolute top-4 ${we||ae?s?"right-40":"right-28":s?"right-28":"right-16"}`,children:d.jsx(nN,{className:"w-5 h-5"})})})]}),d.jsx("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12",children:d.jsxs(Nr,{className:"shadow-large",children:[d.jsx(Rn,{children:d.jsx("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:d.jsxs("div",{children:[d.jsx("div",{className:"mb-2 flex flex-wrap gap-2",children:Ce.type.slice(0,3).map((nt,Me)=>d.jsx(sn,{variant:"secondary",children:nt},Me))}),d.jsx($n,{className:"text-3xl mb-2",children:Ce.name}),d.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[S!==null&&d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx(Gu,{className:"w-4 h-4 text-primary"}),d.jsxs("span",{className:"font-semibold text-base",children:[S.toFixed(1)," km"]})]}),d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx(Al,{className:"w-5 h-5 fill-accent text-accent"}),d.jsx("span",{className:"font-semibold text-base",children:((Be=K.rating)==null?void 0:Be.toFixed(1))||"0.0"})]}),Ae&&d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx(U_e,{className:"w-4 h-4 text-primary"}),d.jsx("span",{className:"font-semibold text-base",children:Ae})]})]}),Ce.description&&d.jsx("p",{className:"text-muted-foreground",children:Ce.description})]})})}),d.jsxs(Mr,{className:"space-y-6",children:[d.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[be.length>0&&d.jsxs(d0,{open:M,onOpenChange:F,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[d.jsx(Al,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),d.jsxs("div",{className:"flex-1",children:[d.jsx(h0,{className:"w-full",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex flex-col items-start",children:[d.jsx("p",{className:"font-medium text-card-foreground",children:r("activities.title")}),!M&&d.jsx("div",{className:"flex flex-wrap gap-1.5 mt-1",children:be.map((nt,Me)=>d.jsx(sn,{variant:"default",className:"text-white",style:{backgroundColor:nt.badge_color||"#9b87f5"},children:eW(nt,n.language)},`activity-${Me}`))})]}),d.jsx(Vf,{className:`w-5 h-5 text-muted-foreground transition-transform ${M?"rotate-180":""}`})]})}),d.jsx(f0,{className:"mt-3 space-y-2",children:be.map((nt,Me)=>{const We=sNe(nt,n.language);return d.jsxs(ji,{to:`/activity/${nt.activity_id}`,className:"block p-2 rounded-md hover:bg-muted/80 transition-colors",children:[d.jsx(sn,{variant:"default",className:"text-white mr-2",style:{backgroundColor:nt.badge_color||"#9b87f5"},children:eW(nt,n.language)}),d.jsx("span",{className:"text-sm text-muted-foreground",children:We||iNe(nt,n.language)})]},`activity-detail-${Me}`)})})]})]}),d.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[d.jsx(Pa,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),d.jsxs("div",{children:[d.jsx("p",{className:"font-medium text-card-foreground",children:r("restaurant.address")}),d.jsx("p",{className:"text-muted-foreground",children:K.address})]})]}),K.phone&&d.jsxs("a",{href:`tel:${K.phone}`,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors cursor-pointer",children:[d.jsx(Jb,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),d.jsxs("div",{children:[d.jsx("p",{className:"font-medium text-card-foreground",children:r("restaurant.phone")}),d.jsx("p",{className:"text-primary underline",children:K.phone})]})]}),K.opening_hours&&d.jsxs(d0,{open:T,onOpenChange:A,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[d.jsx(Kv,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),d.jsxs("div",{className:"flex-1",children:[d.jsx(h0,{className:"w-full",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex flex-col items-start",children:[d.jsx("p",{className:"font-medium text-card-foreground",children:r("restaurant.hours")}),!T&&d.jsxs("p",{className:"text-sm text-muted-foreground mt-0.5",children:[r("restaurant.today")," ",Vie(K.opening_hours)]})]}),d.jsx(Vf,{className:`w-5 h-5 text-muted-foreground transition-transform ${T?"rotate-180":""}`})]})}),d.jsx(f0,{className:"mt-3",children:d.jsx("div",{className:"space-y-2",children:(()=>{const nt=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],Me={monday:"dayMon",tuesday:"dayTue",wednesday:"dayWed",thursday:"dayThu",friday:"dayFri",saturday:"daySat",sunday:"daySun"},We=nt[new Date().getDay()===0?6:new Date().getDay()-1];return nt.map(gt=>{const rt=K.opening_hours[gt],Ht=gt===We,Lt=r(`restaurant.${Me[gt]}`);let nr="N/A";return rt&&(rt.closed?nr=r("restaurant.closed"):rt.splitShift?nr=`${rt.open} - ${rt.close}, ${rt.open2} - ${rt.close2}`:nr=`${rt.open} - ${rt.close}`),d.jsxs("div",{className:`flex justify-between items-center py-1.5 px-2 rounded ${Ht?"bg-primary/10 border border-primary/20":""}`,children:[d.jsxs("span",{className:`text-sm font-medium ${Ht?"text-primary":"text-foreground"}`,children:[Lt,Ht&&d.jsxs("span",{className:"ml-2 text-xs",children:["(",r("restaurant.today"),")"]})]}),d.jsx("span",{className:`text-sm ${Ht?"text-primary font-semibold":"text-muted-foreground"} ${rt!=null&&rt.closed?"italic":""}`,children:nr})]},gt)})})()})})]})]}),K&&(h(K,"announcement")||K.announcement_zh)&&d.jsxs(d0,{open:I,onOpenChange:R,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[d.jsx(FS,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),d.jsxs("div",{className:"flex-1",children:[d.jsx(h0,{className:"w-full",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("p",{className:"font-medium text-card-foreground",children:r("restaurant.announcement")}),d.jsx(Vf,{className:`w-5 h-5 text-muted-foreground transition-transform ${I?"rotate-180":""}`})]})}),d.jsx(f0,{className:"mt-3",children:d.jsx("div",{className:"p-3 rounded-md bg-primary/5 border border-primary/10",children:d.jsx("p",{className:"text-sm text-foreground whitespace-pre-wrap",children:h(K,"announcement")||K.announcement_zh})})})]})]})]}),d.jsxs("div",{className:"flex flex-col gap-3",children:[d.jsxs(Mt,{variant:"secondary",className:"w-full",onClick:()=>zie(K.lat,K.lng,Ce.name),children:[d.jsx(Gu,{className:"w-4 h-4 mr-2"}),r("restaurant.getDirections")]}),K.show_website_button&&K.website_url&&d.jsxs(Mt,{className:"w-full",onClick:()=>window.open(K.website_url,"_blank"),children:[d.jsx(FS,{className:"w-4 h-4 mr-2"}),r("restaurant.joinPrivate")]})]}),d.jsxs(d0,{open:O,onOpenChange:P,className:"p-4 rounded-lg bg-muted/50",children:[d.jsx(h0,{className:"w-full",children:d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h2",{className:"text-2xl font-bold",children:r("restaurant.address")}),d.jsx(Vf,{className:`w-5 h-5 text-muted-foreground transition-transform ${O?"rotate-180":""}`})]})}),d.jsx(f0,{children:d.jsx("div",{ref:m,className:"h-[350px] rounded-lg overflow-hidden"})})]}),d.jsx(El,{}),d.jsx(HPe,{restaurantId:K.id}),d.jsx(El,{}),d.jsx(cae,{restaurantId:K.id})]})]})})]})},tW=({restaurant:e,language:t})=>{const[r,n]=V.useState(999),s=V.useRef(null),o=e.type.slice(0,3).map((m,y)=>({key:`type-${y}`,label:m,variant:"secondary",color:void 0}));V.useEffect(()=>{const m=()=>{var O;if(!s.current)return;const S=s.current,b=Array.from(S.querySelectorAll(".tag-badge"));if(b.length===0){setTimeout(m,50);return}const T=(O=b[0])==null?void 0:O.offsetTop;let A=b.length;for(let P=0;P<b.length;P++)if(b[P].offsetTop>T){A=P;break}A<b.length&&(A=Math.max(1,A-1)),n(A)};n(999);const y=setTimeout(m,100);return window.addEventListener("resize",m),()=>{clearTimeout(y),window.removeEventListener("resize",m)}},[o.length,e.id]);const h=o.slice(0,r),i=o.length>r;return d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("div",{ref:s,className:"flex gap-1.5 flex-wrap flex-1",children:h.map(m=>d.jsx(sn,{variant:m.variant,className:"text-xs font-medium whitespace-nowrap tag-badge",style:m.color?{backgroundColor:m.color,color:"white"}:void 0,children:m.label},m.key))}),i&&d.jsxs(_T,{children:[d.jsx(xT,{asChild:!0,children:d.jsx(Mt,{variant:"ghost",size:"sm",className:"h-6 px-2 text-muted-foreground hover:text-foreground flex-shrink-0",children:d.jsx(TB,{className:"h-4 w-4"})})}),d.jsx(mb,{className:"w-80",children:d.jsx("div",{className:"flex flex-wrap gap-2",children:o.map(m=>d.jsx(sn,{variant:m.variant,className:"text-xs font-medium",style:m.color?{backgroundColor:m.color,color:"white"}:void 0,children:m.label},m.key))})})]})]})},oNe=()=>{const e=Jc(),{t,i18n:r}=ci(),{toast:n}=Ri(),{localizeRestaurant:s}=xc(),[o,h]=V.useState(""),[i,m]=V.useState([]),[y,S]=V.useState(null),[b,T]=V.useState([]),[A,O]=V.useState(null),[P,I]=V.useState(null),[R,M]=V.useState(!1),[F,z]=V.useState(!1),[$,W]=V.useState(!1),K=V.useRef(null),ee=V.useRef(null),ne=V.useRef({}),[ie,re]=V.useState(null),{data:te,isLoading:ae}=P5(o,i.length>0?i.join(","):void 0),{data:ue=[]}=Fie(),{data:be=[]}=RN(),we=Pe=>{m(Be=>Be.includes(Pe)?Be.filter(nt=>nt!==Pe):[...Be,Pe])},Ce=async()=>{try{const Pe=await IN();I({lat:Pe.coords.latitude,lng:Pe.coords.longitude}),n({title:t("restaurants.locationEnabled"),description:t("restaurants.sortByDistance")})}catch{}},_e=Pe=>{O(Pe),Pe&&!P&&Ce()},me=async Pe=>{if(y===Pe)S(null),T([]);else{S(Pe);const{data:Be,error:nt}=await Ct.from("activity_restaurants").select("restaurant_id").eq("activity_id",Pe);nt?(console.error("Error fetching activity restaurants:",nt),T([])):T(Be.map(Me=>Me.restaurant_id))}},Ae=(te==null?void 0:te.map(Pe=>{const Be=s(Pe);if(P){const nt=D2(P.lat,P.lng,Pe.lat,Pe.lng);return{...Be,distance:nt}}return Be}))||[],ge=y&&b.length>0?Ae.filter(Pe=>b.includes(Pe.id)):Ae,pe=A&&P?ge.filter(Pe=>Pe.distance&&Pe.distance<=A).sort((Pe,Be)=>(Pe.distance||0)-(Be.distance||0)):P?ge.sort((Pe,Be)=>(Pe.distance||0)-(Be.distance||0)):ge,Oe=Pe=>{e(`/restaurant/${Pe.id}`)},Je=Pe=>{re(Pe.id);const Be=ne.current[Pe.id];Be&&Be.scrollIntoView({behavior:"smooth",block:"center"})},Ze=()=>{const Pe=document.getElementById("map-container");if(Pe)if(R)document.exitFullscreen&&document.exitFullscreen();else{if(K.current){const Be=K.current.getCenter(),nt=K.current.getZoom();ee.current={center:[Be.lng,Be.lat],zoom:nt}}Pe.requestFullscreen&&Pe.requestFullscreen()}};return V.useEffect(()=>{const Pe=()=>{const Be=!!document.fullscreenElement;M(Be),!Be&&ee.current&&K.current&&setTimeout(()=>{var nt;(nt=K.current)==null||nt.jumpTo({center:ee.current.center,zoom:ee.current.zoom})},100)};return document.addEventListener("fullscreenchange",Pe),()=>{document.removeEventListener("fullscreenchange",Pe)}},[]),d.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4 animate-fade-in",children:d.jsxs("div",{className:"container mx-auto max-w-7xl lg:h-screen lg:flex lg:flex-col",children:[d.jsxs("div",{className:"mb-6 flex-shrink-0",children:[d.jsx("h1",{className:"text-4xl font-bold mb-2 bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:t("nav.mapView")}),d.jsx("p",{className:"text-muted-foreground",children:t("map.subtitle")})]}),d.jsxs("div",{className:"mb-6 space-y-4 flex-shrink-0",children:[d.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[d.jsx("div",{className:"flex-1 max-w-md",children:d.jsx(cr,{placeholder:t("restaurants.search"),value:o,onChange:Pe=>h(Pe.target.value),className:"h-11 bg-background/60 backdrop-blur-sm border-primary/20 focus:border-primary"})}),d.jsxs(Mt,{variant:P?"default":"outline",onClick:Ce,className:"gap-2 h-11 px-6",children:[d.jsx(Gu,{className:`w-4 h-4 ${P?"animate-pulse":""}`}),t(P?"restaurants.locationEnabled":"restaurants.getLocation")]})]}),d.jsxs("div",{className:"space-y-3 bg-card/50 backdrop-blur-sm rounded-lg p-4 border border-border/50 animate-fade-in",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[d.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[t("restaurants.restaurantTypes"),":"]}),i.length>0&&d.jsx(sn,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5",onClick:()=>m([]),children:t("common.actions.clearFilter")}),ue.length>8&&d.jsx(Mt,{variant:"ghost",size:"sm",className:"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200",onClick:()=>z(!F),children:t(F?"common.showLess":"common.showMore")})]}),d.jsxs("div",{className:"relative overflow-hidden",children:[d.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${F?"animate-expand-height":""}`,children:(F?ue:ue.slice(0,8)).map((Pe,Be)=>d.jsx(sn,{variant:i.includes(Pe)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${i.includes(Pe)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${Be*30}ms`},onClick:()=>we(Pe),children:Pe},Pe))}),d.jsxs("div",{className:"sm:hidden relative -mx-1 px-1",children:[d.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth",children:ue.map((Pe,Be)=>d.jsx(sn,{variant:i.includes(Pe)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${i.includes(Pe)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${Be*30}ms`},onClick:()=>we(Pe),children:Pe},Pe))}),d.jsx("div",{className:"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none"}),d.jsx("div",{className:"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none"})]})]})]}),be.length>0&&d.jsxs("div",{className:"space-y-2 pt-1 border-t border-border/30",children:[d.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[d.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[t("nav.activities"),":"]}),y&&d.jsx(sn,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5",onClick:()=>{S(null),T([])},children:t("common.actions.clearFilter")}),be.length>8&&d.jsx(Mt,{variant:"ghost",size:"sm",className:"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200",onClick:()=>W(!$),children:t($?"common.showLess":"common.showMore")})]}),d.jsxs("div",{className:"relative overflow-hidden",children:[d.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${$?"animate-expand-height":""}`,children:($?be:be.slice(0,8)).map((Pe,Be)=>{const nt=r.language==="zh"?Pe.title_zh:r.language==="pt"?Pe.title_pt:Pe.title_en;return d.jsx(sn,{variant:y===Pe.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${y===Pe.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${Be*30}ms`},onClick:()=>me(Pe.id),children:nt},Pe.id)})}),d.jsxs("div",{className:"sm:hidden relative -mx-1 px-1",children:[d.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth",children:be.map((Pe,Be)=>{const nt=r.language==="zh"?Pe.title_zh:r.language==="pt"?Pe.title_pt:Pe.title_en;return d.jsx(sn,{variant:y===Pe.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${y===Pe.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${Be*30}ms`},onClick:()=>me(Pe.id),children:nt},Pe.id)})}),d.jsx("div",{className:"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none"}),d.jsx("div",{className:"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none"})]})]})]})]}),P&&d.jsxs("div",{className:"flex gap-2 flex-wrap items-center bg-muted/30 backdrop-blur-sm rounded-lg p-3 border border-primary/10",children:[d.jsxs("span",{className:"text-sm font-semibold text-primary",children:[t("restaurants.radius"),":"]}),d.jsx(sn,{variant:A===null?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>_e(null),children:t("restaurants.allRestaurants")}),d.jsx(sn,{variant:A===5?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>_e(5),children:t("restaurants.radius5km")}),d.jsx(sn,{variant:A===10?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>_e(10),children:t("restaurants.radius10km")}),d.jsx(sn,{variant:A===20?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>_e(20),children:t("restaurants.radius20km")})]})]}),!ae&&pe&&d.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 lg:flex-1 lg:min-h-0 lg:overflow-hidden",children:[d.jsx("div",{className:"w-full lg:flex-1 h-[500px] lg:h-full",children:d.jsxs("div",{id:"map-container",className:`${R?"fixed inset-0 z-50 bg-background":"w-full h-full"} rounded-xl overflow-hidden shadow-2xl border border-primary/10 relative group`,children:[d.jsx(Mt,{variant:"secondary",size:"icon",className:"absolute bottom-4 right-4 z-10 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:Ze,children:R?d.jsx(M_e,{className:"w-5 h-5"}):d.jsx(R_e,{className:"w-5 h-5"})}),d.jsx("div",{className:"h-full",children:d.jsx(Uie,{restaurants:pe,onRestaurantClick:Oe,userLocation:P,radiusFilter:A,onMarkerClick:Je,showViewDetailsButton:!0,onMapInit:Pe=>{K.current=Pe}})})]})}),d.jsxs("div",{className:"w-full lg:w-[420px] flex flex-col lg:min-h-0 lg:h-full",children:[d.jsxs("div",{className:"mb-4 pb-4 border-b border-border flex-shrink-0",children:[d.jsxs("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[d.jsx(Pa,{className:"w-6 h-6 text-primary"}),t("restaurants.title"),d.jsx(sn,{variant:"secondary",className:"ml-2",children:pe.length})]}),P&&d.jsxs("p",{className:"text-sm text-muted-foreground mt-2 flex items-center gap-1.5",children:[d.jsx(Gu,{className:"w-4 h-4"}),t("restaurants.sortedByDistance")]})]}),pe.length===0?d.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[d.jsx(Pa,{className:"w-16 h-16 text-muted-foreground/40 mb-4"}),d.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2",children:t("restaurants.noResults")}),d.jsx("p",{className:"text-muted-foreground max-w-xs",children:t("restaurants.noResultsDesc")})]}):d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"lg:hidden space-y-3 pb-4",children:pe.map(Pe=>d.jsx(Nr,{ref:Be=>ne.current[Pe.id]=Be,className:`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${ie===Pe.id?"border-primary ring-2 ring-primary ring-offset-2":"border-transparent"}`,onClick:()=>Oe(Pe),children:d.jsxs("div",{className:"flex flex-col gap-3",children:[d.jsxs("div",{className:"flex items-start justify-between gap-2",children:[d.jsxs("div",{className:"flex flex-col gap-2",children:[d.jsx("h3",{className:"font-bold text-lg text-foreground line-clamp-1 flex-1",children:Pe.name}),Pe.distance!==void 0&&d.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full w-fit",children:[d.jsx(Gu,{className:"w-4 h-4 text-primary"}),d.jsx("span",{className:"font-bold text-sm text-primary",children:Pe.distance<1?`${(Pe.distance*1e3).toFixed(0)} m`:`${Pe.distance.toFixed(1)} km`})]})]}),Pe.rating>0&&d.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full flex-shrink-0",children:[d.jsx(Al,{className:"w-4 h-4",style:{fill:"#016450",color:"#016450"}}),d.jsx("span",{className:"font-bold text-sm text-primary",children:Pe.rating})]})]}),Pe.type&&Pe.type.length>0&&d.jsx(tW,{restaurant:Pe,language:r.language}),d.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[d.jsx(Pa,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60"}),d.jsx("span",{className:"line-clamp-2",children:Pe.address})]})]})},Pe.id))}),d.jsx(jv,{className:"hidden lg:block lg:flex-1 pr-4",children:d.jsx("div",{className:"space-y-3 pb-4",children:pe.map(Pe=>d.jsx(Nr,{ref:Be=>ne.current[Pe.id]=Be,className:`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${ie===Pe.id?"border-primary ring-2 ring-primary ring-offset-2":"border-transparent"}`,onClick:()=>Oe(Pe),children:d.jsxs("div",{className:"flex flex-col gap-3",children:[d.jsxs("div",{className:"flex items-start justify-between gap-2",children:[d.jsxs("div",{className:"flex flex-col gap-2",children:[d.jsx("h3",{className:"font-bold text-lg text-foreground line-clamp-1 flex-1",children:Pe.name}),Pe.distance!==void 0&&d.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full w-fit",children:[d.jsx(Gu,{className:"w-4 h-4 text-primary"}),d.jsx("span",{className:"font-bold text-sm text-primary",children:Pe.distance<1?`${(Pe.distance*1e3).toFixed(0)} m`:`${Pe.distance.toFixed(1)} km`})]})]}),Pe.rating>0&&d.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full flex-shrink-0",children:[d.jsx(Al,{className:"w-4 h-4",style:{fill:"#016450",color:"#016450"}}),d.jsx("span",{className:"font-bold text-sm text-primary",children:Pe.rating})]})]}),Pe.type&&Pe.type.length>0&&d.jsx(tW,{restaurant:Pe,language:r.language}),d.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[d.jsx(Pa,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60"}),d.jsx("span",{className:"line-clamp-2",children:Pe.address})]})]})},Pe.id))})})]})]})]})]})})},ET="/assets/xiaoxiong-logo-v3-D4uDr23w.png",X5=()=>ei({queryKey:["activity-rules"],queryFn:async()=>{const{data:e,error:t}=await Ct.from("activity_rules").select("*").single();if(t)throw t;return e}}),lNe=()=>{const e=Mi();return Gi({mutationFn:async t=>{const{data:r,error:n}=await Ct.from("activity_rules").update({content_zh:t.content_zh,content_en:t.content_en,content_pt:t.content_pt,updated_at:new Date().toISOString()}).eq("id",t.id).select().single();if(n)throw n;return r},onSuccess:()=>{e.invalidateQueries({queryKey:["activity-rules"]})}})},Gae=({children:e})=>{const{t,i18n:r}=ci(),{data:n,isLoading:s}=X5(),o=()=>{if(!n)return"";const h=r.language;return h==="zh"?n.content_zh:h==="pt"?n.content_pt:n.content_en};return d.jsxs(fl,{children:[d.jsx(tf,{asChild:!0,children:e}),d.jsxs(Jo,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[d.jsx(Qo,{children:d.jsx(el,{children:t("activities.rulesTitle")})}),s?d.jsx("div",{className:"flex justify-center py-8",children:d.jsx(_a,{className:"w-6 h-6 animate-spin text-primary"})}):d.jsx("div",{className:`prose prose-sm dark:prose-invert max-w-none\r
              [&_h1]:text-xl [&_h1]:font-bold [&_h1]:mb-4\r
              [&_h2]:text-lg [&_h2]:font-semibold [&_h2]:mb-3\r
              [&_h3]:text-base [&_h3]:font-medium [&_h3]:mb-2\r
              [&_p]:mb-3 [&_p]:text-muted-foreground\r
              [&_ul]:list-disc [&_ul]:ml-4 [&_ul]:mb-3\r
              [&_ol]:list-decimal [&_ol]:ml-4 [&_ol]:mb-3\r
              [&_li]:mb-1`,dangerouslySetInnerHTML:{__html:o()}})]})]})},cNe=e=>{if(!e)return"";const t=Pr.language;return t==="zh"?e.name:t==="pt"?e.name_pt||e.name_en||e.name:e.name_en||e.name},uNe=()=>{const{t:e}=ci(),{user:t}=Kn(),{localizeActivity:r}=xc(),n=Jc(),{data:s,isLoading:o}=RN(),{data:h=[]}=O5(),i=h.map(A=>A.activity_id),m=qie(),{displayedData:y,hasMore:S,loadMore:b}=Hie({data:s,initialItemsPerPage:6,incrementPerPage:6}),T=(A,O)=>{if(O.preventDefault(),O.stopPropagation(),!t){Po({title:e("activities.signInToSubscribe")||"",description:e("activities.signInToSubscribeDesc")||"",variant:"destructive"});return}m.mutate(A)};return d.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4 animate-fade-in",children:d.jsxs("div",{className:"container mx-auto max-w-7xl",children:[d.jsxs("div",{className:"mb-8",children:[d.jsx("h1",{className:"text-4xl font-bold mb-2 text-foreground",children:e("activities.title")}),d.jsxs("p",{className:"text-muted-foreground text-lg",children:[e("activities.description"),d.jsx(Gae,{children:d.jsxs("button",{className:"ml-2 text-primary hover:underline inline-flex items-center gap-1",children:[d.jsx(rb,{className:"w-4 h-4"}),e("activities.rules")]})})]})]}),o&&d.jsx("div",{className:"flex justify-center items-center py-20",children:d.jsx(_a,{className:"w-8 h-8 animate-spin text-primary"})}),!o&&(!s||s.length===0)&&d.jsx("div",{className:"text-center py-20",children:d.jsx("p",{className:"text-xl text-muted-foreground",children:e("activities.noActivities")||"No activities available"})}),!o&&s&&s.length>0&&d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:y.map(A=>{var P,I;const O=r(A);return d.jsx(Nr,{className:"overflow-hidden hover:shadow-large transition-shadow",children:d.jsxs(ji,{to:`/activity/${A.id}`,children:[d.jsxs("div",{className:"relative h-48 overflow-hidden",children:[d.jsx("img",{src:A.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=600&q=80",alt:O.title,className:"w-full h-full object-cover transition-transform hover:scale-105"}),A.pinned&&d.jsx(sn,{className:"absolute top-3 left-3 bg-accent",children:e("activities.pinned")}),A.service_type&&d.jsxs(sn,{className:"absolute bottom-3 left-3 flex items-center gap-1",variant:"secondary",children:[A.service_type==="dine_in"&&d.jsx(nb,{className:"w-3 h-3"}),A.service_type==="takeaway"&&d.jsx(oT,{className:"w-3 h-3"}),A.service_type==="both"&&d.jsxs(d.Fragment,{children:[d.jsx(nb,{className:"w-3 h-3"}),d.jsx(oT,{className:"w-3 h-3"})]}),e(`activities.serviceType.${A.service_type}`)]}),A.end_date&&new Date(A.end_date)<new Date?d.jsx(sn,{className:"absolute top-3 right-3 bg-secondary",children:e("activities.ended")}):A.subscriber_count!==void 0&&d.jsxs(sn,{variant:"secondary",className:"absolute top-3 right-3 flex items-center gap-1.5",children:[d.jsx(Bc,{className:"w-3.5 h-3.5"}),d.jsx("span",{children:A.subscriber_count})]})]}),d.jsx(Rn,{children:d.jsx("h3",{className:"text-xl font-semibold text-card-foreground line-clamp-2",children:O.title})}),d.jsxs(Mr,{className:"space-y-3",children:[d.jsx("div",{className:`text-muted-foreground text-sm line-clamp-3\r
                          [&_h1]:text-base [&_h1]:font-bold [&_h1]:text-foreground\r
                          [&_h2]:text-sm [&_h2]:font-semibold [&_h2]:text-foreground\r
                          [&_h3]:text-sm [&_h3]:font-medium [&_h3]:text-foreground\r
                          [&_strong]:font-semibold [&_strong]:text-foreground\r
                          [&_p]:my-1\r
                          [&_ul]:list-disc [&_ul]:ml-4\r
                          [&_ol]:list-decimal [&_ol]:ml-4`,dangerouslySetInnerHTML:{__html:O.content}}),A.start_date&&d.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[d.jsx(yo,{className:"w-4 h-4"}),d.jsx("span",{children:ps(new Date(A.start_date),"PPP")})]}),A.end_date&&d.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[d.jsx(Kv,{className:"w-4 h-4"}),d.jsxs("span",{children:[e("activities.until")," ",ps(new Date(A.end_date),"PPP")]})]}),d.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[d.jsx(AQ,{className:"w-4 h-4"}),d.jsx("span",{children:e("activities.creatorLabel")}),(P=A.creator)!=null&&P.isAdmin?d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx("img",{src:ET,alt:"Platform",className:"w-4 h-4 rounded-full object-contain"}),d.jsx("span",{className:"font-medium",children:e("activities.createdByPlatform")})]}):(I=A.creator)!=null&&I.restaurant?d.jsxs("div",{className:"flex items-center gap-1 cursor-pointer",onClick:R=>{R.preventDefault(),R.stopPropagation(),n(`/restaurant/${A.creator.restaurant.id}`)},children:[A.creator.avatar_url?d.jsxs(Ju,{className:"w-4 h-4",children:[d.jsx(Qu,{src:A.creator.avatar_url,alt:"Creator"}),d.jsx(ed,{className:"text-[8px]",children:A.creator.restaurant.name.charAt(0)})]}):d.jsx("div",{className:"w-4 h-4 rounded-full bg-muted flex items-center justify-center",children:d.jsx("span",{className:"text-[8px] font-medium",children:A.creator.restaurant.name.charAt(0)})}),d.jsx("span",{className:"text-primary font-medium hover:underline",children:cNe(A.creator.restaurant)})]}):d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx("img",{src:ET,alt:"Platform",className:"w-4 h-4 rounded-full object-contain"}),d.jsx("span",{className:"font-medium",children:e("activities.createdByPlatform")})]})]})]}),d.jsxs(kN,{className:"gap-2",children:[d.jsx(Mt,{asChild:!0,className:"flex-1",children:d.jsx("span",{children:e("activities.viewDetails")})}),d.jsx(Mt,{variant:i.includes(A.id)?"outline":"default",onClick:R=>T(A.id,R),disabled:m.isPending,title:i.includes(A.id)?e("activities.subscribed"):e("activities.subscribe"),children:i.includes(A.id)?d.jsx(m_e,{className:"w-4 h-4"}):d.jsx(TQ,{className:"w-4 h-4"})})]})]})},A.id)})}),S&&d.jsx("div",{className:"flex justify-center mt-8",children:d.jsxs(Mt,{onClick:b,size:"lg",variant:"outline",children:[e("common.loadMore")," (",y.length," / ",s.length,")"]})})]})]})})},Wae=V.memo(({restaurants:e,onMarkerClick:t})=>{const r=V.useRef(null),n=V.useRef(null),s=V.useRef([]),[o,h]=V.useState(!1),i=V.useRef(null);return V.useEffect(()=>{if(!r.current||n.current)return;const m="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";Oo.accessToken=m;const y=e.reduce((b,T)=>b+Number(T.restaurants.lat||0),0)/e.length,S=e.reduce((b,T)=>b+Number(T.restaurants.lng||0),0)/e.length;return n.current=new Oo.Map({container:r.current,style:"mapbox://styles/mapbox/light-v11",center:[S,y],zoom:12,cooperativeGestures:!0,doubleClickZoom:!1}),n.current.addControl(new Oo.NavigationControl,"top-right"),n.current.on("load",()=>{h(!0)}),()=>{var b;s.current.forEach(T=>T.remove()),s.current=[],i.current&&(i.current.remove(),i.current=null),(b=n.current)==null||b.remove(),n.current=null,h(!1)}},[]),V.useEffect(()=>{if(!n.current||!o||e.length===0)return;(()=>{var y;if(s.current.forEach(S=>S.remove()),s.current=[],i.current&&(i.current.remove(),i.current=null),e.forEach(S=>{const b=Number(S.restaurants.lat),T=Number(S.restaurants.lng);if(isNaN(b)||isNaN(T))return;const A=document.createElement("div");A.className="p-3 min-w-[200px]",A.innerHTML=`
          <div class="space-y-2">
            <h3 class="font-bold text-base text-foreground">${S.restaurants.name}</h3>
            <p class="text-xs text-muted-foreground">${S.restaurants.address}</p>
          </div>
        `;const O=new Oo.Popup({offset:25,closeButton:!0,closeOnClick:!1,closeOnMove:!1,maxWidth:"300px"}).setLngLat([T,b]).setDOMContent(A),P=new Oo.Marker({color:"#016450",draggable:!1}).setLngLat([T,b]).addTo(n.current),I=P.getElement();I.style.cursor="pointer";const R=M=>{M.stopPropagation(),M.preventDefault(),i.current&&i.current!==O&&i.current.remove(),O.addTo(n.current),i.current=O,n.current.easeTo({center:[T,b],zoom:17,duration:800}),t&&t(S.restaurant_id)};I.addEventListener("click",R,!0),O.on("close",()=>{i.current===O&&(i.current=null)}),s.current.push(P)}),e.length>1){const S=new Oo.LngLatBounds;e.forEach(b=>{const T=Number(b.restaurants.lat),A=Number(b.restaurants.lng);!isNaN(T)&&!isNaN(A)&&S.extend([A,T])}),(y=n.current)==null||y.fitBounds(S,{padding:50,maxZoom:14})}})()},[e,o,t]),e.length===0?null:d.jsx("div",{ref:r,className:"w-full h-[350px] rounded-lg"})});Wae.displayName="ActivityParticipationMap";const dNe=({open:e,onOpenChange:t,restaurants:r,participatingRestaurantIds:n,onConfirm:s,isPending:o,isParticipating:h})=>{const{t:i}=ci(),{localizeRestaurant:m}=xc(),[y,S]=V.useState([]);V.useEffect(()=>{e&&S(n)},[e,n]);const b=O=>{S(P=>P.includes(O)?P.filter(I=>I!==O):[...P,O])},T=()=>{y.length===r.length?S([]):S(r.map(O=>O.id))},A=()=>{s(y)};return d.jsx(fl,{open:e,onOpenChange:t,children:d.jsxs(Jo,{className:"max-w-[90vw] sm:max-w-[600px] max-h-[90vh] overflow-hidden flex flex-col",children:[d.jsxs(Qo,{children:[d.jsxs(el,{className:"flex items-center gap-2",children:[d.jsx(Io,{className:"w-5 h-5"}),""]}),d.jsx(Ul,{children:""})]}),d.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 py-4",children:[d.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[d.jsx(Yo,{id:"select-all",checked:y.length===r.length,onCheckedChange:T}),d.jsxs(yr,{htmlFor:"select-all",className:"cursor-pointer font-semibold",children:["/ (",y.length,"/",r.length,")"]})]}),d.jsx("div",{className:"space-y-3",children:r.map(O=>{const P=m(O),I=y.includes(O.id),R=n.includes(O.id);return d.jsx(Nr,{className:`transition-all ${I?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,children:d.jsx(Mr,{className:"p-4",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(Yo,{id:O.id,checked:I,onCheckedChange:()=>b(O.id)}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsxs(yr,{htmlFor:O.id,className:"cursor-pointer flex items-center gap-2",children:[d.jsx("span",{className:"font-semibold truncate",children:P.name}),R&&d.jsxs(sn,{variant:"secondary",className:"text-xs",children:[d.jsx(ip,{className:"w-3 h-3 mr-1"}),""]})]}),d.jsx("p",{className:"text-sm text-muted-foreground truncate",children:O.address}),P.type&&P.type.length>0&&d.jsx("div",{className:"flex gap-1 mt-1 flex-wrap",children:P.type.slice(0,2).map((M,F)=>d.jsx(sn,{variant:"outline",className:"text-xs",children:M},F))})]})]})})},O.id)})})]}),d.jsxs(Qv,{children:[d.jsx(Mt,{variant:"outline",onClick:()=>t(!1),disabled:o,children:i("common.cancel")}),d.jsx(Mt,{onClick:A,disabled:o,children:o?d.jsxs(d.Fragment,{children:[d.jsx(_a,{className:"w-4 h-4 mr-2 animate-spin"}),i("common.loading")]}):d.jsxs(d.Fragment,{children:[d.jsx(ip,{className:"w-4 h-4 mr-2"})," (",y.length,")"]})})]})]})})},hNe=()=>ei({queryKey:["couponTemplates"],queryFn:async()=>{const{data:e,error:t}=await Ct.from("coupon_templates").select("*").order("created_at",{ascending:!1});if(t)throw t;return e}}),fNe=()=>{const{user:e}=Kn();return ei({queryKey:["userCoupons",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ct.from("user_coupons").select(`
          *,
          coupon_codes (
            *,
            coupon_templates (*)
          )
        `).eq("user_id",e.id).order("claimed_at",{ascending:!1});if(r)throw r;return t},enabled:!!e})},pNe=e=>ei({queryKey:["activityCouponTemplates",e],queryFn:async()=>{const{data:t,error:r}=await Ct.from("coupon_templates").select("*").eq("activity_id",e).eq("is_active",!0).eq("visible",!0).order("created_at",{ascending:!1});if(r)throw r;return t},enabled:!!e}),mNe=e=>{const{user:t}=Kn();return ei({queryKey:["hasSharedCoupon",e,t==null?void 0:t.id],queryFn:async()=>{if(!t)return!1;const{data:r,error:n}=await Ct.from("user_coupons").select("id").eq("user_id",t.id).eq("activity_id",e).eq("source","share").maybeSingle();if(n)throw n;return!!r},enabled:!!t&&!!e})},gNe=()=>{const{user:e}=Kn(),{toast:t}=Ri(),r=Mi();return Gi({mutationFn:async({templateId:n,activityId:s,source:o="share"})=>{if(!e)throw new Error("User not authenticated");const{data:h,error:i}=await Ct.rpc("generate_coupon_code",{template_id_param:n});if(i)throw i;const m=h,{data:y,error:S}=await Ct.from("coupon_codes").insert({template_id:n,code:m,usage_limit:1,used_count:0,is_active:!0}).select().single();if(S)throw S;const{data:b,error:T}=await Ct.from("user_coupons").insert({user_id:e.id,coupon_code_id:y.id,activity_id:s,source:o}).select().single();if(T)throw T;return{userCoupon:b,couponCode:y}},onSuccess:(n,s)=>{r.invalidateQueries({queryKey:["userCoupons"]}),r.invalidateQueries({queryKey:["hasSharedCoupon",s.activityId]}),t({title:Pr.t("common.success"),description:s.source==="share"?"":""})},onError:n=>{t({title:Pr.t("common.error"),description:n.message||"",variant:"destructive"})}})},yNe=()=>{const{toast:e}=Ri(),t=Mi();return Gi({mutationFn:async r=>{if(r.id){const{id:n,created_at:s,updated_at:o,...h}=r,{data:i,error:m}=await Ct.from("coupon_templates").update(h).eq("id",n).select().single();if(m)throw m;return i}else{const{id:n,created_at:s,updated_at:o,...h}=r,{data:i,error:m}=await Ct.from("coupon_templates").insert(h).select().single();if(m)throw m;return i}},onSuccess:()=>{t.invalidateQueries({queryKey:["couponTemplates"]}),e({title:Pr.t("common.success"),description:""})},onError:r=>{e({title:Pr.t("common.error"),description:r.message,variant:"destructive"})}})},vNe=()=>{const{toast:e}=Ri(),t=Mi();return Gi({mutationFn:async r=>{const{error:n}=await Ct.from("coupon_templates").delete().eq("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["couponTemplates"]}),e({title:Pr.t("common.success"),description:""})},onError:r=>{e({title:Pr.t("common.error"),description:r.message,variant:"destructive"})}})},_Ne=()=>{var Pt;const{id:e}=GB(),t=Qh(),r=Jc(),{t:n}=ci(),{user:s}=Kn(),{isMerchant:o,isSupervisor:h}=_c(),{localizeActivity:i,localizeRestaurant:m,currentLang:y}=xc();VN();const[S,b]=Ue.useState(!1),[T,A]=Ue.useState(!1),[O,P]=Ue.useState(null),[I,R]=Ue.useState(!1),[M,F]=Ue.useState(!1),[z,$]=Ue.useState(!1),{data:W=[]}=pNe(e),{data:K=!1}=mNe(e),ee=gNe(),ne=Ue.useCallback(wt=>{r(`/restaurant/${wt}`,{state:{fromActivity:e}})},[r,e]),ie=((Pt=t.state)==null?void 0:Pt.from)==="admin"?"/admin/activities":"/activities",{data:re,isLoading:te}=PPe(e),{data:ae,isLoading:ue}=OPe(e),{data:be=[]}=O5(),we=be.map(wt=>wt.activity_id),{data:Ce=0}=kPe(e),{data:_e}=NPe(re==null?void 0:re.creator_id),me=qie(),{data:Ae=[]}=F2(),{data:ge=[]}=JOe(e),pe=QOe(),Oe=re?i(re):null,Je=re?we.includes(re.id):!1,Ze=o||h,Pe=V.useCallback(()=>{!s||!re||me.mutate(re.id)},[s,re,me]),Be=Ae.filter(wt=>ge.includes(wt.id)).length,nt=Be>0;Ae.length,Be>0&&Be<Ae.length;const Me=V.useCallback(()=>{if(!(!re||!Ze||Ae.length===0))if(h)$(!0);else if(nt)for(const wt of Ae)ge.includes(wt.id)&&pe.mutate({activityId:re.id,restaurantId:wt.id});else for(const wt of Ae)pe.mutate({activityId:re.id,restaurantId:wt.id})},[re,Ze,Ae,h,nt,ge,pe]),We=V.useCallback(wt=>{if(!re)return;const He=wt.filter(ut=>!ge.includes(ut)),lt=ge.filter(ut=>!wt.includes(ut));He.forEach(ut=>{pe.mutate({activityId:re.id,restaurantId:ut})}),lt.forEach(ut=>{pe.mutate({activityId:re.id,restaurantId:ut})}),$(!1)},[re,ge,pe]),gt=V.useCallback(async()=>{F(!0);try{const wt=await IN();P({lat:wt.coords.latitude,lng:wt.coords.longitude}),R(!0),kr.success(n("map.locationEnabled"))}catch{kr.error(n("map.locationError")),R(!1)}finally{F(!1)}},[n]);V.useCallback(()=>{P(null),R(!1)},[]);const rt=V.useCallback(async()=>{try{await navigator.clipboard.writeText(window.location.href),kr.success(n("common.linkCopied"))}catch(wt){console.error("Error copying link:",wt),kr.error(n("common.shareError"))}},[n]);V.useCallback(async()=>{if(!re||!Oe)return;const wt={title:Oe.title,text:`${Oe.title} - Xiaoxiong Market

${Oe.content.replace(/<[^>]*>/g,"").substring(0,200)}...`,url:window.location.href};try{navigator.share&&typeof navigator.canShare=="function"&&navigator.canShare(wt)?(await navigator.share(wt),kr.success(n("common.shareSuccess"))):rt()}catch(He){He.name!=="AbortError"&&(console.error("Error sharing:",He),kr.error(n("common.shareError")))}},[re,Oe,rt,n]);const Ht=V.useCallback(async()=>{if(!re||!Oe)return;const wt={title:Oe.title,text:`${Oe.title} - Xiaoxiong Market

${Oe.content.replace(/<[^>]*>/g,"").substring(0,200)}...`,url:window.location.href};try{if(navigator.share&&typeof navigator.canShare=="function"&&navigator.canShare(wt))if(await navigator.share(wt),s&&W.length>0&&!K){const He=W[0];try{await ee.mutateAsync({templateId:He.id,activityId:e,source:"share"}),kr.success("")}catch(lt){console.error("Error claiming coupon:",lt),kr.error("")}}else kr.success(n("common.shareSuccess"));else if(await navigator.clipboard.writeText(window.location.href),s&&W.length>0&&!K){const He=W[0];try{await ee.mutateAsync({templateId:He.id,activityId:e,source:"share"}),kr.success("")}catch(lt){console.error("Error claiming coupon:",lt),kr.error("")}}else kr.success(n("common.linkCopied"))}catch(He){He.name!=="AbortError"&&(console.error("Error sharing:",He),kr.error(n("common.shareError")))}},[re,Oe,s,W,K,e,ee,n]);V.useCallback(wt=>{const He=encodeURIComponent(window.location.href);encodeURIComponent((Oe==null?void 0:Oe.title)||re.title_zh);const lt=encodeURIComponent(`${(Oe==null?void 0:Oe.title)||re.title_zh} - Xiaoxiong Market`);let ut="";switch(wt){case"whatsapp":ut=`https://wa.me/?text=${lt}%20${He}`;break;case"facebook":ut=`https://www.facebook.com/sharer/sharer.php?u=${He}`;break;case"twitter":ut=`https://twitter.com/intent/tweet?text=${lt}&url=${He}`;break;case"telegram":ut=`https://t.me/share/url?url=${He}&text=${lt}`;break;case"wechat":rt(),kr.info(n("common.shareVia")+" WeChat");return;default:return}window.open(ut,"_blank","noopener,noreferrer")},[re,Oe,rt,n]);const Lt=V.useMemo(()=>{if(!ae)return[];const wt=ae.map(He=>{if(O){const lt=D2(O.lat,O.lng,Number(He.restaurants.lat),Number(He.restaurants.lng));return{...He,distance:lt}}return{...He,distance:void 0}});return I&&O?wt.sort((He,lt)=>He.distance!==void 0&&lt.distance!==void 0?He.distance-lt.distance:0):wt},[ae,I,O]);if(te)return d.jsx("div",{className:"min-h-screen flex items-center justify-center",children:d.jsx(_a,{className:"w-8 h-8 animate-spin text-primary"})});if(!re||!Oe)return d.jsx("div",{className:"min-h-screen flex items-center justify-center",children:d.jsxs("div",{className:"text-center",children:[d.jsx("p",{className:"text-xl text-muted-foreground",children:n("error.notFound")}),d.jsx(Mt,{asChild:!0,className:"mt-4",children:d.jsx(ji,{to:ie,children:n("common.back")})})]})});const nr=new Date(re.start_date),Rr=re.end_date?new Date(re.end_date):null,Dr=Rr?new Date<=Rr:new Date>=nr;return d.jsxs("div",{className:"min-h-screen bg-secondary/20",children:[d.jsxs("div",{className:"relative h-[33vh] overflow-hidden",children:[d.jsx("img",{src:re.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=1200&q=80",alt:Oe.title,className:"w-full h-full object-cover"}),d.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),d.jsx(Mt,{asChild:!0,variant:"secondary",size:"icon",className:"absolute top-4 left-4",children:d.jsx(ji,{to:ie,children:d.jsx(Jk,{className:"w-5 h-5"})})}),d.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[re.pinned&&d.jsx(sn,{className:"bg-accent",children:n("activities.pinned")}),d.jsx(F5,{targetType:"activity",targetId:re.id,trigger:d.jsx(Mt,{variant:"secondary",size:"icon",className:"shadow-lg",children:d.jsx(nN,{className:"w-5 h-5"})})}),d.jsxs("div",{className:"flex flex-col items-end gap-1",children:[d.jsx(Mt,{variant:"secondary",size:"icon",className:"shadow-lg",onClick:Ht,children:d.jsx(Zx,{className:"w-5 h-5"})}),s&&W.length>0&&!K&&d.jsxs("div",{className:"bg-primary/95 backdrop-blur-sm text-primary-foreground text-xs px-3 py-1.5 rounded-full shadow-lg whitespace-nowrap animate-pulse",children:[d.jsx(C_e,{className:"w-3 h-3 inline mr-1"}),""]})]})]})]}),d.jsx("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12",children:d.jsxs(Nr,{className:"shadow-large",children:[d.jsx(Rn,{children:d.jsxs("div",{className:"flex flex-col gap-4",children:[d.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[d.jsx(sn,{variant:Dr?"default":"secondary",children:n(Dr?"activities.ongoing":"activities.ended")}),re.repeat_mode&&re.repeat_mode!=="none"&&d.jsx(sn,{variant:"outline",children:n(`activities.repeat.${re.repeat_mode}`)}),re.service_type&&d.jsxs(sn,{variant:"outline",className:"flex items-center gap-1.5",children:[re.service_type==="dine_in"&&d.jsx(nb,{className:"w-3.5 h-3.5"}),re.service_type==="takeaway"&&d.jsx(oT,{className:"w-3.5 h-3.5"}),re.service_type==="both"&&d.jsxs(d.Fragment,{children:[d.jsx(nb,{className:"w-3.5 h-3.5"}),d.jsx(oT,{className:"w-3.5 h-3.5"})]}),n(`activities.serviceType.${re.service_type}`)]})]}),d.jsx($n,{className:"text-3xl",children:Oe.title}),d.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 text-sm text-muted-foreground",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(yo,{className:"w-4 h-4"}),d.jsxs("span",{children:[ps(nr,"PPP"),Rr&&` - ${ps(Rr,"PPP")}`]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Bc,{className:"w-4 h-4"}),d.jsxs("span",{children:[Ce," ",n("activities.subscribersCount")]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Io,{className:"w-4 h-4"}),d.jsxs("span",{children:[(ae==null?void 0:ae.length)||0," ",n("activities.restaurantsParticipating")]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(AQ,{className:"w-4 h-4"}),d.jsx("span",{children:n("activities.creatorLabel")}),_e!=null&&_e.isAdmin?d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx("img",{src:ET,alt:"Platform",className:"w-4 h-4 rounded-full object-contain"}),d.jsx("span",{className:"font-medium",children:n("activities.createdByPlatform")})]}):_e!=null&&_e.restaurant?d.jsxs(ji,{to:`/restaurant/${_e.restaurant.id}`,className:"flex items-center gap-1",onClick:wt=>wt.stopPropagation(),children:[_e.avatar_url?d.jsxs(Ju,{className:"w-4 h-4",children:[d.jsx(Qu,{src:_e.avatar_url,alt:"Creator"}),d.jsx(ed,{className:"text-[8px]",children:_e.restaurant.name.charAt(0)})]}):d.jsx("div",{className:"w-4 h-4 rounded-full bg-muted flex items-center justify-center",children:d.jsx("span",{className:"text-[8px] font-medium",children:_e.restaurant.name.charAt(0)})}),d.jsx("span",{className:"text-primary font-medium hover:underline",children:(()=>{const wt=Pr.language;return wt==="zh"?_e.restaurant.name:wt==="pt"?_e.restaurant.name_pt||_e.restaurant.name_en||_e.restaurant.name:_e.restaurant.name_en||_e.restaurant.name})()})]}):d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx("img",{src:ET,alt:"Platform",className:"w-4 h-4 rounded-full object-contain"}),d.jsx("span",{className:"font-medium",children:n("activities.createdByPlatform")})]})]})]}),s&&d.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[Ze&&Ae.length>0&&d.jsx(Mt,{onClick:Me,disabled:pe.isPending,size:"lg",variant:nt?"outline":"default",className:"w-full sm:w-auto",children:h?d.jsxs(d.Fragment,{children:[d.jsx(Io,{className:"w-4 h-4 mr-2"}),""]}):nt?d.jsxs(d.Fragment,{children:[d.jsx(ip,{className:"w-4 h-4 mr-2"}),""]}):d.jsxs(d.Fragment,{children:[d.jsx(Io,{className:"w-4 h-4 mr-2"}),""]})}),d.jsx(Mt,{onClick:Pe,disabled:me.isPending,size:"lg",variant:Je?"outline":"secondary",className:"w-full sm:w-auto",children:Je?d.jsxs(d.Fragment,{children:[d.jsx(ip,{className:"w-4 h-4 mr-2"}),n("activities.subscribed")||""]}):d.jsxs(d.Fragment,{children:[d.jsx(Bc,{className:"w-4 h-4 mr-2"}),n("activities.subscribe")||""]})})]}),!s&&d.jsxs("div",{className:"space-y-2",children:[d.jsx("p",{className:"text-sm text-muted-foreground",children:n("activities.signInToJoin")}),d.jsxs("p",{className:"text-xs text-muted-foreground/80 flex items-center gap-1.5",children:[d.jsx(Bc,{className:"w-3.5 h-3.5"}),n("activities.signInToJoinHint")]})]})]})}),d.jsxs(Mr,{className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("h2",{className:"text-2xl font-bold mb-4",children:n("activities.about")}),d.jsx("div",{className:`prose prose-sm max-w-none text-muted-foreground\r
                  prose-headings:text-foreground prose-headings:font-semibold\r
                  prose-h1:text-2xl prose-h2:text-xl prose-h3:text-lg\r
                  prose-p:leading-relaxed prose-p:my-3\r
                  prose-strong:text-foreground prose-strong:font-semibold\r
                  prose-ul:my-3 prose-ol:my-3\r
                  prose-li:my-1\r
                  prose-a:text-primary prose-a:no-underline hover:prose-a:underline`,dangerouslySetInnerHTML:{__html:Oe.content}})]}),Oe.usage_instructions&&d.jsxs(d.Fragment,{children:[d.jsx(El,{}),d.jsxs("div",{children:[d.jsxs("h2",{className:"text-2xl font-bold mb-4 flex items-center gap-2",children:[d.jsx(g_e,{className:"w-6 h-6 text-primary"}),n("activities.usageInstructions")]}),d.jsx("div",{className:`prose prose-sm max-w-none text-muted-foreground\r
                      prose-headings:text-foreground prose-headings:font-semibold\r
                      prose-h1:text-2xl prose-h2:text-xl prose-h3:text-lg\r
                      prose-p:leading-relaxed prose-p:my-3\r
                      prose-strong:text-foreground prose-strong:font-semibold\r
                      prose-ul:my-3 prose-ol:my-3\r
                      prose-li:my-1\r
                      prose-a:text-primary prose-a:no-underline hover:prose-a:underline`,dangerouslySetInnerHTML:{__html:Oe.usage_instructions}})]})]}),d.jsx(El,{}),ue?d.jsx("div",{className:"flex justify-center py-8",children:d.jsx(_a,{className:"w-6 h-6 animate-spin text-primary"})}):ae&&ae.length>0?d.jsxs("div",{className:"space-y-6",children:[d.jsx(d0,{open:S,onOpenChange:b,children:d.jsxs(Nr,{className:"border-primary/20 shadow-sm hover:shadow-md transition-shadow duration-300 overflow-hidden",children:[d.jsx(Rn,{className:"pb-3",children:d.jsx(h0,{asChild:!0,children:d.jsxs("div",{className:"flex items-center justify-between cursor-pointer group",children:[d.jsxs($n,{className:"text-lg font-semibold flex items-center gap-2 transition-colors duration-200 group-hover:text-primary",children:[d.jsx(Io,{className:"w-5 h-5 transition-transform duration-300 group-hover:scale-110"}),""]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(sn,{variant:"secondary",className:"transition-opacity duration-200",children:S?"":""}),d.jsx("div",{className:"transition-transform duration-300 ease-in-out",style:{transform:S?"rotate(180deg)":"rotate(0deg)"},children:d.jsx(Vf,{className:"w-5 h-5 text-muted-foreground group-hover:text-primary"})})]})]})})}),d.jsx(f0,{className:"overflow-hidden transition-all duration-500 ease-in-out data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",children:d.jsxs(Mr,{className:"pt-0 pb-6 space-y-4",children:[d.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:(T?Lt:Lt.slice(0,6)).map((wt,He)=>{var ut;const lt=m(wt.restaurants);return d.jsx(Nr,{className:"overflow-hidden hover:shadow-lg transition-all duration-300 opacity-0 animate-fade-in h-full flex flex-col",style:{animationDelay:`${He*50}ms`,animationFillMode:"forwards"},children:d.jsxs(ji,{to:`/restaurant/${wt.restaurant_id}`,state:{fromActivity:re.id},className:"flex flex-col h-full",children:[d.jsxs("div",{className:"relative h-40 overflow-hidden flex-shrink-0",children:[d.jsx("img",{src:wt.restaurants.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400&q=80",alt:lt.name,className:"w-full h-full object-cover transition-transform hover:scale-105"}),lt.type&&lt.type.length>0&&d.jsx(sn,{className:"absolute top-2 left-2 bg-primary",children:lt.type[0]})]}),d.jsxs(Mr,{className:"pt-4 pb-4 flex flex-col flex-grow",children:[d.jsx("h3",{className:"font-semibold text-lg mb-2 line-clamp-1",children:lt.name}),d.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-3",children:[d.jsx(Pa,{className:"w-4 h-4 flex-shrink-0"}),d.jsx("span",{className:"line-clamp-1",children:wt.restaurants.address})]}),d.jsxs("div",{className:"flex items-center justify-between mt-auto pt-3 border-t border-border/50",children:[d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx(Al,{className:"w-4 h-4 fill-accent text-accent"}),d.jsx("span",{className:"font-semibold text-sm",children:((ut=wt.restaurants.rating)==null?void 0:ut.toFixed(1))||"0.0"})]}),wt.distance!==void 0&&d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx(Gu,{className:"w-4 h-4 text-primary"}),d.jsxs("span",{className:"font-semibold text-sm text-foreground",children:[wt.distance.toFixed(1)," km"]})]})]})]})]})},wt.id)})}),Lt.length>6&&!T&&d.jsxs(Mt,{variant:"outline",className:"w-full hover:bg-primary hover:text-primary-foreground transition-all duration-200",onClick:()=>A(!0),children:[d.jsx(Vf,{className:"w-4 h-4 mr-2"})," (",Lt.length-6," )"]})]})})]})}),d.jsxs("div",{children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[d.jsx(Pa,{className:"w-6 h-6"}),n("activities.participatingRestaurants")," (",Lt.length,")"]}),I?d.jsxs(sn,{variant:"default",className:"flex items-center gap-1.5",children:[d.jsx(Gu,{className:"w-3.5 h-3.5"}),""]}):d.jsxs(Mt,{variant:"outline",size:"sm",onClick:gt,disabled:M,children:[M?d.jsx(_a,{className:"w-4 h-4 mr-2 animate-spin"}):d.jsx(Gu,{className:"w-4 h-4 mr-2"}),""]})]}),d.jsx(Wae,{restaurants:Lt,onMarkerClick:ne})]})]}):null,d.jsx(El,{}),d.jsx(cae,{restaurantId:re.id,targetType:"activity"})]})]})}),h&&d.jsx(dNe,{open:z,onOpenChange:$,restaurants:Ae,participatingRestaurantIds:ge,onConfirm:We,isPending:pe.isPending,isParticipating:nt})]})},xNe=()=>{const{signIn:e,signUp:t,signInWithGoogle:r,signInWithPhone:n,verifyOTP:s,user:o}=Kn(),h=Jc(),[i,m]=V.useState(!1),[y,S]=V.useState("login"),[b,T]=V.useState("phone");V.useState(""),V.useState("+351");const[A,O]=V.useState("info"),[P,I]=V.useState(""),[R,M]=V.useState(null),[F,z]=V.useState(0),[$,W]=V.useState(null),{t:K}=ci(),ee=jh({email:bn().email(K("auth.invalidEmail")),password:bn().min(6,K("auth.passwordMin"))}),ne=jh({displayName:bn().min(2,K("auth.displayNameMin")),email:bn().email(K("auth.invalidEmail")),password:bn().min(6,K("auth.passwordMin")),confirmPassword:bn()}).refine(ge=>ge.password===ge.confirmPassword,{message:K("auth.passwordsDontMatch"),path:["confirmPassword"]}),ie=jh({phone:bn().min(6,K("auth.phoneMin"))}),re=jh({otp:bn().length(6,K("auth.otpLength"))}),te=jh({code:bn().length(4,"Verification code must be 4 digits")}),ae=Ah({resolver:Ch(ee)}),ue=Ah({resolver:Ch(ne)});Ah({resolver:Ch(ie)}),Ah({resolver:Ch(re)});const be=Ah({resolver:Ch(te)});V.useEffect(()=>{o&&h("/")},[o,h]),V.useEffect(()=>{let ge;return F>0&&(ge=setTimeout(()=>z(F-1),1e3)),()=>clearTimeout(ge)},[F]);const we=ge=>{let pe=0;return ge.length>=6&&pe++,ge.length>=8&&pe++,/[a-z]/.test(ge)&&pe++,/[A-Z]/.test(ge)&&pe++,/[0-9]/.test(ge)&&pe++,/[^a-zA-Z0-9]/.test(ge)&&pe++,pe<=2?"weak":pe<=4?"medium":"strong"},Ce=async ge=>{m(!0);try{const{error:pe}=await e(ge.email,ge.password);if(pe){pe.message.includes("Invalid login credentials")?kr.error(K("auth.invalidCredentials")):kr.error(pe.message);return}kr.success(K("auth.signInSuccess"))}catch(pe){kr.error(pe.message||K("error.general"))}finally{m(!1)}},_e=async ge=>{m(!0);try{M(ge),I(ge.email);const{error:pe}=await Ct.functions.invoke("send-verification-code",{body:{email:ge.email}});if(pe){kr.error(K("auth.verificationCodeFailed")),console.error(pe);return}O("verify"),kr.success(K("auth.verificationCodeSent")),z(30)}catch(pe){kr.error(pe.message||K("error.general"))}finally{m(!1)}},me=async ge=>{if(R){m(!0);try{const{data:pe,error:Oe}=await Ct.functions.invoke("verify-email-code",{body:{email:P,code:ge.code}});if(Oe||!(pe!=null&&pe.success)){kr.error((pe==null?void 0:pe.error)||K("auth.invalidVerificationCode"));return}const{error:Je}=await t(R.email,R.password,R.displayName);if(Je){Je.message.includes("already registered")?kr.error(K("auth.emailExists")):kr.error(Je.message);return}kr.success(K("auth.signUpSuccess")),S("login"),O("info"),ue.reset(),be.reset(),M(null)}catch(pe){kr.error(pe.message||K("error.general"))}finally{m(!1)}}},Ae=async()=>{if(!(F>0)){m(!0);try{const{error:ge}=await Ct.functions.invoke("send-verification-code",{body:{email:P}});if(ge){kr.error(K("toast.resendCodeFailed"));return}kr.success(K("toast.verificationCodeResent")),z(30)}catch(ge){kr.error(ge.message||"Failed to resend code")}finally{m(!1)}}};return d.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-hero p-4",children:d.jsxs(Nr,{className:"w-full max-w-md shadow-large",children:[d.jsxs(Rn,{className:"text-center",children:[d.jsx("div",{className:"flex justify-center mb-4",children:d.jsx("img",{src:ET,alt:"Logo",style:{width:"35px",height:"35px"},className:"object-contain drop-shadow-md"})}),d.jsx($n,{className:"text-2xl",children:K("auth.welcome")}),d.jsx(as,{children:K("auth.subtitle")})]}),d.jsx(Mr,{children:d.jsxs(Mv,{value:y,onValueChange:ge=>{S(ge),T("phone"),O("info")},className:"w-full",children:[d.jsxs(pg,{className:"grid w-full grid-cols-2",children:[d.jsx(Ca,{value:"login",children:K("auth.login")}),d.jsx(Ca,{value:"register",children:K("auth.register")})]}),d.jsx(ja,{value:"login",children:d.jsxs("form",{onSubmit:ae.handleSubmit(Ce),className:"space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"email",children:K("auth.email")}),d.jsx(cr,{id:"email",type:"email",placeholder:"you@example.com",...ae.register("email")}),ae.formState.errors.email&&d.jsx("p",{className:"text-sm text-destructive",children:ae.formState.errors.email.message})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"password",children:K("auth.password")}),d.jsx(cr,{id:"password",type:"password",placeholder:"",...ae.register("password")}),ae.formState.errors.password&&d.jsx("p",{className:"text-sm text-destructive",children:ae.formState.errors.password.message})]}),d.jsx(Mt,{type:"submit",className:"w-full",disabled:i,children:K(i?"auth.signingIn":"auth.signIn")})]})}),d.jsx(ja,{value:"register",children:A==="info"?d.jsxs("form",{onSubmit:ue.handleSubmit(_e),className:"space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"display-name",children:K("auth.displayName")}),d.jsx(cr,{id:"display-name",placeholder:"John Doe",...ue.register("displayName")}),ue.formState.errors.displayName&&d.jsx("p",{className:"text-sm text-destructive",children:ue.formState.errors.displayName.message})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"register-email",children:K("auth.email")}),d.jsx(cr,{id:"register-email",type:"email",placeholder:"you@example.com",...ue.register("email")}),ue.formState.errors.email&&d.jsx("p",{className:"text-sm text-destructive",children:ue.formState.errors.email.message})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"register-password",children:K("auth.password")}),d.jsx(cr,{id:"register-password",type:"password",placeholder:K("auth.passwordPlaceholder"),...ue.register("password"),onChange:ge=>{ue.setValue("password",ge.target.value),ge.target.value?W(we(ge.target.value)):W(null)}}),ue.formState.errors.password&&d.jsx("p",{className:"text-sm text-destructive",children:ue.formState.errors.password.message}),$&&d.jsxs("div",{className:"space-y-1",children:[d.jsxs("div",{className:"flex gap-1",children:[d.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${$==="weak"?"bg-destructive":$==="medium"?"bg-warning":"bg-success"}`}),d.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${$==="medium"||$==="strong"?$==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),d.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${$==="strong"?"bg-success":"bg-muted"}`})]}),d.jsx("p",{className:`text-xs ${$==="weak"?"text-destructive":$==="medium"?"text-warning":"text-success"}`,children:K(`auth.passwordStrength.${$}`)})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"confirm-password",children:K("auth.confirmPassword")}),d.jsx(cr,{id:"confirm-password",type:"password",placeholder:K("auth.passwordPlaceholder"),...ue.register("confirmPassword")}),ue.formState.errors.confirmPassword&&d.jsx("p",{className:"text-sm text-destructive",children:ue.formState.errors.confirmPassword.message})]}),d.jsx(Mt,{type:"submit",className:"w-full",disabled:i,children:i?"Sending code...":"Send Verification Code"})]}):d.jsxs("form",{onSubmit:be.handleSubmit(me),className:"space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"verification-code",children:"Verification Code"}),d.jsxs("p",{className:"text-xs text-muted-foreground mb-2",children:["Enter the 4-digit code sent to ",P]}),d.jsx("div",{className:"flex justify-center",children:d.jsx(D5,{maxLength:4,...be.register("code"),onChange:ge=>be.setValue("code",ge),children:d.jsxs(L5,{children:[d.jsx(qf,{index:0}),d.jsx(qf,{index:1}),d.jsx(qf,{index:2}),d.jsx(qf,{index:3})]})})}),be.formState.errors.code&&d.jsx("p",{className:"text-sm text-destructive text-center",children:be.formState.errors.code.message})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx(Mt,{type:"button",variant:"outline",className:"w-full",onClick:()=>{O("info"),be.reset()},children:K("common.back")}),d.jsx(Mt,{type:"submit",className:"w-full",disabled:i,children:i?K("auth.verifying"):"Verify & Register"})]}),d.jsx(Mt,{type:"button",variant:"ghost",className:"w-full text-sm",onClick:Ae,disabled:i||F>0,children:F>0?`Resend Code (${F}s)`:"Resend Code"})]})})]})}),d.jsx(kN,{children:d.jsx("p",{className:"text-sm text-muted-foreground text-center w-full",children:d.jsx(ji,{to:"/",className:"text-primary hover:underline",children:K("auth.backToHome")})})})]})})};function bNe(e){return Object.prototype.toString.call(e)==="[object Object]"}function rW(e){return bNe(e)||Array.isArray(e)}function wNe(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function Y5(e,t){const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;const s=JSON.stringify(Object.keys(e.breakpoints||{})),o=JSON.stringify(Object.keys(t.breakpoints||{}));return s!==o?!1:r.every(h=>{const i=e[h],m=t[h];return typeof i=="function"?`${i}`==`${m}`:!rW(i)||!rW(m)?i===m:Y5(i,m)})}function nW(e){return e.concat().sort((t,r)=>t.name>r.name?1:-1).map(t=>t.options)}function SNe(e,t){if(e.length!==t.length)return!1;const r=nW(e),n=nW(t);return r.every((s,o)=>{const h=n[o];return Y5(s,h)})}function J5(e){return typeof e=="number"}function LF(e){return typeof e=="string"}function qN(e){return typeof e=="boolean"}function iW(e){return Object.prototype.toString.call(e)==="[object Object]"}function za(e){return Math.abs(e)}function Q5(e){return Math.sign(e)}function DE(e,t){return za(e-t)}function ENe(e,t){if(e===0||t===0||za(e)<=za(t))return 0;const r=DE(za(e),za(t));return za(r/e)}function TNe(e){return Math.round(e*100)/100}function TT(e){return AT(e).map(Number)}function qd(e){return e[B2(e)]}function B2(e){return Math.max(0,e.length-1)}function e$(e,t){return t===B2(e)}function sW(e,t=0){return Array.from(Array(e),(r,n)=>t+n)}function AT(e){return Object.keys(e)}function Kae(e,t){return[e,t].reduce((r,n)=>(AT(n).forEach(s=>{const o=r[s],h=n[s],i=iW(o)&&iW(h);r[s]=i?Kae(o,h):h}),r),{})}function FF(e,t){return typeof t.MouseEvent<"u"&&e instanceof t.MouseEvent}function ANe(e,t){const r={start:n,center:s,end:o};function n(){return 0}function s(m){return o(m)/2}function o(m){return t-m}function h(m,y){return LF(e)?r[e](m):e(t,m,y)}return{measure:h}}function CT(){let e=[];function t(s,o,h,i={passive:!0}){let m;if("addEventListener"in s)s.addEventListener(o,h,i),m=()=>s.removeEventListener(o,h,i);else{const y=s;y.addListener(h),m=()=>y.removeListener(h)}return e.push(m),n}function r(){e=e.filter(s=>s())}const n={add:t,clear:r};return n}function CNe(e,t,r,n){const s=CT(),o=1e3/60;let h=null,i=0,m=0;function y(){s.add(e,"visibilitychange",()=>{e.hidden&&O()})}function S(){A(),s.clear()}function b(I){if(!m)return;h||(h=I,r(),r());const R=I-h;for(h=I,i+=R;i>=o;)r(),i-=o;const M=i/o;n(M),m&&(m=t.requestAnimationFrame(b))}function T(){m||(m=t.requestAnimationFrame(b))}function A(){t.cancelAnimationFrame(m),h=null,i=0,m=0}function O(){h=null,i=0}return{init:y,destroy:S,start:T,stop:A,update:r,render:n}}function jNe(e,t){const r=t==="rtl",n=e==="y",s=n?"y":"x",o=n?"x":"y",h=!n&&r?-1:1,i=S(),m=b();function y(O){const{height:P,width:I}=O;return n?P:I}function S(){return n?"top":r?"right":"left"}function b(){return n?"bottom":r?"left":"right"}function T(O){return O*h}return{scroll:s,cross:o,startEdge:i,endEdge:m,measureSize:y,direction:T}}function Dv(e=0,t=0){const r=za(e-t);function n(y){return y<e}function s(y){return y>t}function o(y){return n(y)||s(y)}function h(y){return o(y)?n(y)?e:t:y}function i(y){return r?y-r*Math.ceil((y-t)/r):y}return{length:r,max:t,min:e,constrain:h,reachedAny:o,reachedMax:s,reachedMin:n,removeOffset:i}}function Zae(e,t,r){const{constrain:n}=Dv(0,e),s=e+1;let o=h(t);function h(T){return r?za((s+T)%s):n(T)}function i(){return o}function m(T){return o=h(T),b}function y(T){return S().set(i()+T)}function S(){return Zae(e,i(),r)}const b={get:i,set:m,add:y,clone:S};return b}function PNe(e,t,r,n,s,o,h,i,m,y,S,b,T,A,O,P,I,R,M){const{cross:F,direction:z}=e,$=["INPUT","SELECT","TEXTAREA"],W={passive:!1},K=CT(),ee=CT(),ne=Dv(50,225).constrain(A.measure(20)),ie={mouse:300,touch:400},re={mouse:500,touch:600},te=O?43:25;let ae=!1,ue=0,be=0,we=!1,Ce=!1,_e=!1,me=!1;function Ae(rt){if(!M)return;function Ht(nr){(qN(M)||M(rt,nr))&&Pe(nr)}const Lt=t;K.add(Lt,"dragstart",nr=>nr.preventDefault(),W).add(Lt,"touchmove",()=>{},W).add(Lt,"touchend",()=>{}).add(Lt,"touchstart",Ht).add(Lt,"mousedown",Ht).add(Lt,"touchcancel",nt).add(Lt,"contextmenu",nt).add(Lt,"click",Me,!0)}function ge(){K.clear(),ee.clear()}function pe(){const rt=me?r:t;ee.add(rt,"touchmove",Be,W).add(rt,"touchend",nt).add(rt,"mousemove",Be,W).add(rt,"mouseup",nt)}function Oe(rt){const Ht=rt.nodeName||"";return $.includes(Ht)}function Je(){return(O?re:ie)[me?"mouse":"touch"]}function Ze(rt,Ht){const Lt=b.add(Q5(rt)*-1),nr=S.byDistance(rt,!O).distance;return O||za(rt)<ne?nr:I&&Ht?nr*.5:S.byIndex(Lt.get(),0).distance}function Pe(rt){const Ht=FF(rt,n);me=Ht,_e=O&&Ht&&!rt.buttons&&ae,ae=DE(s.get(),h.get())>=2,!(Ht&&rt.button!==0)&&(Oe(rt.target)||(we=!0,o.pointerDown(rt),y.useFriction(0).useDuration(0),s.set(h),pe(),ue=o.readPoint(rt),be=o.readPoint(rt,F),T.emit("pointerDown")))}function Be(rt){if(!FF(rt,n)&&rt.touches.length>=2)return nt(rt);const Lt=o.readPoint(rt),nr=o.readPoint(rt,F),Rr=DE(Lt,ue),Dr=DE(nr,be);if(!Ce&&!me&&(!rt.cancelable||(Ce=Rr>Dr,!Ce)))return nt(rt);const Pt=o.pointerMove(rt);Rr>P&&(_e=!0),y.useFriction(.3).useDuration(.75),i.start(),s.add(z(Pt)),rt.preventDefault()}function nt(rt){const Lt=S.byDistance(0,!1).index!==b.get(),nr=o.pointerUp(rt)*Je(),Rr=Ze(z(nr),Lt),Dr=ENe(nr,Rr),Pt=te-10*Dr,wt=R+Dr/50;Ce=!1,we=!1,ee.clear(),y.useDuration(Pt).useFriction(wt),m.distance(Rr,!O),me=!1,T.emit("pointerUp")}function Me(rt){_e&&(rt.stopPropagation(),rt.preventDefault(),_e=!1)}function We(){return we}return{init:Ae,destroy:ge,pointerDown:We}}function ONe(e,t){let n,s;function o(b){return b.timeStamp}function h(b,T){const O=`client${(T||e.scroll)==="x"?"X":"Y"}`;return(FF(b,t)?b:b.touches[0])[O]}function i(b){return n=b,s=b,h(b)}function m(b){const T=h(b)-h(s),A=o(b)-o(n)>170;return s=b,A&&(n=b),T}function y(b){if(!n||!s)return 0;const T=h(s)-h(n),A=o(b)-o(n),O=o(b)-o(s)>170,P=T/A;return A&&!O&&za(P)>.1?P:0}return{pointerDown:i,pointerMove:m,pointerUp:y,readPoint:h}}function kNe(){function e(r){const{offsetTop:n,offsetLeft:s,offsetWidth:o,offsetHeight:h}=r;return{top:n,right:s+o,bottom:n+h,left:s,width:o,height:h}}return{measure:e}}function NNe(e){function t(n){return e*(n/100)}return{measure:t}}function INe(e,t,r,n,s,o,h){const i=[e].concat(n);let m,y,S=[],b=!1;function T(I){return s.measureSize(h.measure(I))}function A(I){if(!o)return;y=T(e),S=n.map(T);function R(M){for(const F of M){if(b)return;const z=F.target===e,$=n.indexOf(F.target),W=z?y:S[$],K=T(z?e:n[$]);if(za(K-W)>=.5){I.reInit(),t.emit("resize");break}}}m=new ResizeObserver(M=>{(qN(o)||o(I,M))&&R(M)}),r.requestAnimationFrame(()=>{i.forEach(M=>m.observe(M))})}function O(){b=!0,m&&m.disconnect()}return{init:A,destroy:O}}function RNe(e,t,r,n,s,o){let h=0,i=0,m=s,y=o,S=e.get(),b=0;function T(){const W=n.get()-e.get(),K=!m;let ee=0;return K?(h=0,r.set(n),e.set(n),ee=W):(r.set(e),h+=W/m,h*=y,S+=h,e.add(h),ee=S-b),i=Q5(ee),b=S,$}function A(){const W=n.get()-t.get();return za(W)<.001}function O(){return m}function P(){return i}function I(){return h}function R(){return F(s)}function M(){return z(o)}function F(W){return m=W,$}function z(W){return y=W,$}const $={direction:P,duration:O,velocity:I,seek:T,settled:A,useBaseFriction:M,useBaseDuration:R,useFriction:z,useDuration:F};return $}function MNe(e,t,r,n,s){const o=s.measure(10),h=s.measure(50),i=Dv(.1,.99);let m=!1;function y(){return!(m||!e.reachedAny(r.get())||!e.reachedAny(t.get()))}function S(A){if(!y())return;const O=e.reachedMin(t.get())?"min":"max",P=za(e[O]-t.get()),I=r.get()-t.get(),R=i.constrain(P/h);r.subtract(I*R),!A&&za(I)<o&&(r.set(e.constrain(r.get())),n.useDuration(25).useBaseFriction())}function b(A){m=!A}return{shouldConstrain:y,constrain:S,toggleActive:b}}function DNe(e,t,r,n,s){const o=Dv(-t+e,0),h=b(),i=S(),m=T();function y(O,P){return DE(O,P)<=1}function S(){const O=h[0],P=qd(h),I=h.lastIndexOf(O),R=h.indexOf(P)+1;return Dv(I,R)}function b(){return r.map((O,P)=>{const{min:I,max:R}=o,M=o.constrain(O),F=!P,z=e$(r,P);return F?R:z||y(I,M)?I:y(R,M)?R:M}).map(O=>parseFloat(O.toFixed(3)))}function T(){if(t<=e+s)return[o.max];if(n==="keepSnaps")return h;const{min:O,max:P}=i;return h.slice(O,P)}return{snapsContained:m,scrollContainLimit:i}}function LNe(e,t,r){const n=t[0],s=r?n-e:qd(t);return{limit:Dv(s,n)}}function FNe(e,t,r,n){const o=t.min+.1,h=t.max+.1,{reachedMin:i,reachedMax:m}=Dv(o,h);function y(T){return T===1?m(r.get()):T===-1?i(r.get()):!1}function S(T){if(!y(T))return;const A=e*(T*-1);n.forEach(O=>O.add(A))}return{loop:S}}function zNe(e){const{max:t,length:r}=e;function n(o){const h=o-t;return r?h/-r:0}return{get:n}}function BNe(e,t,r,n,s){const{startEdge:o,endEdge:h}=e,{groupSlides:i}=s,m=b().map(t.measure),y=T(),S=A();function b(){return i(n).map(P=>qd(P)[h]-P[0][o]).map(za)}function T(){return n.map(P=>r[o]-P[o]).map(P=>-za(P))}function A(){return i(y).map(P=>P[0]).map((P,I)=>P+m[I])}return{snaps:y,snapsAligned:S}}function $Ne(e,t,r,n,s,o){const{groupSlides:h}=s,{min:i,max:m}=n,y=S();function S(){const T=h(o),A=!e||t==="keepSnaps";return r.length===1?[o]:A?T:T.slice(i,m).map((O,P,I)=>{const R=!P,M=e$(I,P);if(R){const F=qd(I[0])+1;return sW(F)}if(M){const F=B2(o)-qd(I)[0]+1;return sW(F,qd(I)[0])}return O})}return{slideRegistry:y}}function UNe(e,t,r,n,s){const{reachedAny:o,removeOffset:h,constrain:i}=n;function m(O){return O.concat().sort((P,I)=>za(P)-za(I))[0]}function y(O){const P=e?h(O):i(O),I=t.map((M,F)=>({diff:S(M-P,0),index:F})).sort((M,F)=>za(M.diff)-za(F.diff)),{index:R}=I[0];return{index:R,distance:P}}function S(O,P){const I=[O,O+r,O-r];if(!e)return O;if(!P)return m(I);const R=I.filter(M=>Q5(M)===P);return R.length?m(R):qd(I)-r}function b(O,P){const I=t[O]-s.get(),R=S(I,P);return{index:O,distance:R}}function T(O,P){const I=s.get()+O,{index:R,distance:M}=y(I),F=!e&&o(I);if(!P||F)return{index:R,distance:O};const z=t[R]-M,$=O+S(z,0);return{index:R,distance:$}}return{byDistance:T,byIndex:b,shortcut:S}}function VNe(e,t,r,n,s,o,h){function i(b){const T=b.distance,A=b.index!==t.get();o.add(T),T&&(n.duration()?e.start():(e.update(),e.render(1),e.update())),A&&(r.set(t.get()),t.set(b.index),h.emit("select"))}function m(b,T){const A=s.byDistance(b,T);i(A)}function y(b,T){const A=t.clone().set(b),O=s.byIndex(A.get(),T);i(O)}return{distance:m,index:y}}function qNe(e,t,r,n,s,o,h,i){const m={passive:!0,capture:!0};let y=0;function S(A){if(!i)return;function O(P){if(new Date().getTime()-y>10)return;h.emit("slideFocusStart"),e.scrollLeft=0;const M=r.findIndex(F=>F.includes(P));J5(M)&&(s.useDuration(0),n.index(M,0),h.emit("slideFocus"))}o.add(document,"keydown",b,!1),t.forEach((P,I)=>{o.add(P,"focus",R=>{(qN(i)||i(A,R))&&O(I)},m)})}function b(A){A.code==="Tab"&&(y=new Date().getTime())}return{init:S}}function gE(e){let t=e;function r(){return t}function n(m){t=h(m)}function s(m){t+=h(m)}function o(m){t-=h(m)}function h(m){return J5(m)?m:m.get()}return{get:r,set:n,add:s,subtract:o}}function Xae(e,t){const r=e.scroll==="x"?h:i,n=t.style;let s=null,o=!1;function h(T){return`translate3d(${T}px,0px,0px)`}function i(T){return`translate3d(0px,${T}px,0px)`}function m(T){if(o)return;const A=TNe(e.direction(T));A!==s&&(n.transform=r(A),s=A)}function y(T){o=!T}function S(){o||(n.transform="",t.getAttribute("style")||t.removeAttribute("style"))}return{clear:S,to:m,toggleActive:y}}function HNe(e,t,r,n,s,o,h,i,m){const S=TT(s),b=TT(s).reverse(),T=R().concat(M());function A(K,ee){return K.reduce((ne,ie)=>ne-s[ie],ee)}function O(K,ee){return K.reduce((ne,ie)=>A(ne,ee)>0?ne.concat([ie]):ne,[])}function P(K){return o.map((ee,ne)=>({start:ee-n[ne]+.5+K,end:ee+t-.5+K}))}function I(K,ee,ne){const ie=P(ee);return K.map(re=>{const te=ne?0:-r,ae=ne?r:0,ue=ne?"end":"start",be=ie[re][ue];return{index:re,loopPoint:be,slideLocation:gE(-1),translate:Xae(e,m[re]),target:()=>i.get()>be?te:ae}})}function R(){const K=h[0],ee=O(b,K);return I(ee,r,!1)}function M(){const K=t-h[0]-1,ee=O(S,K);return I(ee,-r,!0)}function F(){return T.every(({index:K})=>{const ee=S.filter(ne=>ne!==K);return A(ee,t)<=.1})}function z(){T.forEach(K=>{const{target:ee,translate:ne,slideLocation:ie}=K,re=ee();re!==ie.get()&&(ne.to(re),ie.set(re))})}function $(){T.forEach(K=>K.translate.clear())}return{canLoop:F,clear:$,loop:z,loopPoints:T}}function GNe(e,t,r){let n,s=!1;function o(m){if(!r)return;function y(S){for(const b of S)if(b.type==="childList"){m.reInit(),t.emit("slidesChanged");break}}n=new MutationObserver(S=>{s||(qN(r)||r(m,S))&&y(S)}),n.observe(e,{childList:!0})}function h(){n&&n.disconnect(),s=!0}return{init:o,destroy:h}}function WNe(e,t,r,n){const s={};let o=null,h=null,i,m=!1;function y(){i=new IntersectionObserver(O=>{m||(O.forEach(P=>{const I=t.indexOf(P.target);s[I]=P}),o=null,h=null,r.emit("slidesInView"))},{root:e.parentElement,threshold:n}),t.forEach(O=>i.observe(O))}function S(){i&&i.disconnect(),m=!0}function b(O){return AT(s).reduce((P,I)=>{const R=parseInt(I),{isIntersecting:M}=s[R];return(O&&M||!O&&!M)&&P.push(R),P},[])}function T(O=!0){if(O&&o)return o;if(!O&&h)return h;const P=b(O);return O&&(o=P),O||(h=P),P}return{init:y,destroy:S,get:T}}function KNe(e,t,r,n,s,o){const{measureSize:h,startEdge:i,endEdge:m}=e,y=r[0]&&s,S=O(),b=P(),T=r.map(h),A=I();function O(){if(!y)return 0;const M=r[0];return za(t[i]-M[i])}function P(){if(!y)return 0;const M=o.getComputedStyle(qd(n));return parseFloat(M.getPropertyValue(`margin-${m}`))}function I(){return r.map((M,F,z)=>{const $=!F,W=e$(z,F);return $?T[F]+S:W?T[F]+b:z[F+1][i]-M[i]}).map(za)}return{slideSizes:T,slideSizesWithGaps:A,startGap:S,endGap:b}}function ZNe(e,t,r,n,s,o,h,i,m){const{startEdge:y,endEdge:S,direction:b}=e,T=J5(r);function A(R,M){return TT(R).filter(F=>F%M===0).map(F=>R.slice(F,F+M))}function O(R){return R.length?TT(R).reduce((M,F,z)=>{const $=qd(M)||0,W=$===0,K=F===B2(R),ee=s[y]-o[$][y],ne=s[y]-o[F][S],ie=!n&&W?b(h):0,re=!n&&K?b(i):0,te=za(ne-re-(ee+ie));return z&&te>t+m&&M.push(F),K&&M.push(R.length),M},[]).map((M,F,z)=>{const $=Math.max(z[F-1]||0);return R.slice($,M)}):[]}function P(R){return T?A(R,r):O(R)}return{groupSlides:P}}function XNe(e,t,r,n,s,o,h){const{align:i,axis:m,direction:y,startIndex:S,loop:b,duration:T,dragFree:A,dragThreshold:O,inViewThreshold:P,slidesToScroll:I,skipSnaps:R,containScroll:M,watchResize:F,watchSlides:z,watchDrag:$,watchFocus:W}=o,K=2,ee=kNe(),ne=ee.measure(t),ie=r.map(ee.measure),re=jNe(m,y),te=re.measureSize(ne),ae=NNe(te),ue=ANe(i,te),be=!b&&!!M,we=b||!!M,{slideSizes:Ce,slideSizesWithGaps:_e,startGap:me,endGap:Ae}=KNe(re,ne,ie,r,we,s),ge=ZNe(re,te,I,b,ne,ie,me,Ae,K),{snaps:pe,snapsAligned:Oe}=BNe(re,ue,ne,ie,ge),Je=-qd(pe)+qd(_e),{snapsContained:Ze,scrollContainLimit:Pe}=DNe(te,Je,Oe,M,K),Be=be?Ze:Oe,{limit:nt}=LNe(Je,Be,b),Me=Zae(B2(Be),S,b),We=Me.clone(),gt=TT(r),rt=({dragHandler:Gn,scrollBody:Di,scrollBounds:ka,options:{loop:xs}})=>{xs||ka.constrain(Gn.pointerDown()),Di.seek()},Ht=({scrollBody:Gn,translate:Di,location:ka,offsetLocation:xs,previousLocation:mi,scrollLooper:Ua,slideLooper:Va,dragHandler:Lo,animation:qa,eventHandler:Ha,scrollBounds:Fi,options:{loop:Ks}},rl)=>{const xa=Gn.settled(),so=!Fi.shouldConstrain(),Ln=Ks?xa:xa&&so,zi=Ln&&!Lo.pointerDown();zi&&qa.stop();const ms=ka.get()*rl+mi.get()*(1-rl);xs.set(ms),Ks&&(Ua.loop(Gn.direction()),Va.loop()),Di.to(xs.get()),zi&&Ha.emit("settle"),Ln||Ha.emit("scroll")},Lt=CNe(n,s,()=>rt(Zn),Gn=>Ht(Zn,Gn)),nr=.68,Rr=Be[Me.get()],Dr=gE(Rr),Pt=gE(Rr),wt=gE(Rr),He=gE(Rr),lt=RNe(Dr,wt,Pt,He,T,nr),ut=UNe(b,Be,Je,nt,He),sr=VNe(Lt,Me,We,lt,ut,He,h),Qt=zNe(nt),er=CT(),Cr=WNe(t,r,h,P),{slideRegistry:dn}=$Ne(be,M,Be,Pe,ge,gt),fn=qNe(e,r,dn,sr,lt,er,h,W),Zn={ownerDocument:n,ownerWindow:s,eventHandler:h,containerRect:ne,slideRects:ie,animation:Lt,axis:re,dragHandler:PNe(re,e,n,s,He,ONe(re,s),Dr,Lt,sr,lt,ut,Me,h,ae,A,O,R,nr,$),eventStore:er,percentOfView:ae,index:Me,indexPrevious:We,limit:nt,location:Dr,offsetLocation:wt,previousLocation:Pt,options:o,resizeHandler:INe(t,h,s,r,re,F,ee),scrollBody:lt,scrollBounds:MNe(nt,wt,He,lt,ae),scrollLooper:FNe(Je,nt,wt,[Dr,wt,Pt,He]),scrollProgress:Qt,scrollSnapList:Be.map(Qt.get),scrollSnaps:Be,scrollTarget:ut,scrollTo:sr,slideLooper:HNe(re,te,Je,Ce,_e,pe,Be,wt,r),slideFocus:fn,slidesHandler:GNe(t,h,z),slidesInView:Cr,slideIndexes:gt,slideRegistry:dn,slidesToScroll:ge,target:He,translate:Xae(re,t)};return Zn}function YNe(){let e={},t;function r(y){t=y}function n(y){return e[y]||[]}function s(y){return n(y).forEach(S=>S(t,y)),m}function o(y,S){return e[y]=n(y).concat([S]),m}function h(y,S){return e[y]=n(y).filter(b=>b!==S),m}function i(){e={}}const m={init:r,emit:s,off:h,on:o,clear:i};return m}const JNe={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function QNe(e){function t(o,h){return Kae(o,h||{})}function r(o){const h=o.breakpoints||{},i=AT(h).filter(m=>e.matchMedia(m).matches).map(m=>h[m]).reduce((m,y)=>t(m,y),{});return t(o,i)}function n(o){return o.map(h=>AT(h.breakpoints||{})).reduce((h,i)=>h.concat(i),[]).map(e.matchMedia)}return{mergeOptions:t,optionsAtMedia:r,optionsMediaQueries:n}}function eIe(e){let t=[];function r(o,h){return t=h.filter(({options:i})=>e.optionsAtMedia(i).active!==!1),t.forEach(i=>i.init(o,e)),h.reduce((i,m)=>Object.assign(i,{[m.name]:m}),{})}function n(){t=t.filter(o=>o.destroy())}return{init:r,destroy:n}}function jO(e,t,r){const n=e.ownerDocument,s=n.defaultView,o=QNe(s),h=eIe(o),i=CT(),m=YNe(),{mergeOptions:y,optionsAtMedia:S,optionsMediaQueries:b}=o,{on:T,off:A,emit:O}=m,P=re;let I=!1,R,M=y(JNe,jO.globalOptions),F=y(M),z=[],$,W,K;function ee(){const{container:gt,slides:rt}=F;W=(LF(gt)?e.querySelector(gt):gt)||e.children[0];const Lt=LF(rt)?W.querySelectorAll(rt):rt;K=[].slice.call(Lt||W.children)}function ne(gt){const rt=XNe(e,W,K,n,s,gt,m);if(gt.loop&&!rt.slideLooper.canLoop()){const Ht=Object.assign({},gt,{loop:!1});return ne(Ht)}return rt}function ie(gt,rt){I||(M=y(M,gt),F=S(M),z=rt||z,ee(),R=ne(F),b([M,...z.map(({options:Ht})=>Ht)]).forEach(Ht=>i.add(Ht,"change",re)),F.active&&(R.translate.to(R.location.get()),R.animation.init(),R.slidesInView.init(),R.slideFocus.init(We),R.eventHandler.init(We),R.resizeHandler.init(We),R.slidesHandler.init(We),R.options.loop&&R.slideLooper.loop(),W.offsetParent&&K.length&&R.dragHandler.init(We),$=h.init(We,z)))}function re(gt,rt){const Ht=ge();te(),ie(y({startIndex:Ht},gt),rt),m.emit("reInit")}function te(){R.dragHandler.destroy(),R.eventStore.clear(),R.translate.clear(),R.slideLooper.clear(),R.resizeHandler.destroy(),R.slidesHandler.destroy(),R.slidesInView.destroy(),R.animation.destroy(),h.destroy(),i.clear()}function ae(){I||(I=!0,i.clear(),te(),m.emit("destroy"),m.clear())}function ue(gt,rt,Ht){!F.active||I||(R.scrollBody.useBaseFriction().useDuration(rt===!0?0:F.duration),R.scrollTo.index(gt,Ht||0))}function be(gt){const rt=R.index.add(1).get();ue(rt,gt,-1)}function we(gt){const rt=R.index.add(-1).get();ue(rt,gt,1)}function Ce(){return R.index.add(1).get()!==ge()}function _e(){return R.index.add(-1).get()!==ge()}function me(){return R.scrollSnapList}function Ae(){return R.scrollProgress.get(R.offsetLocation.get())}function ge(){return R.index.get()}function pe(){return R.indexPrevious.get()}function Oe(){return R.slidesInView.get()}function Je(){return R.slidesInView.get(!1)}function Ze(){return $}function Pe(){return R}function Be(){return e}function nt(){return W}function Me(){return K}const We={canScrollNext:Ce,canScrollPrev:_e,containerNode:nt,internalEngine:Pe,destroy:ae,off:A,on:T,emit:O,plugins:Ze,previousScrollSnap:pe,reInit:P,rootNode:Be,scrollNext:be,scrollPrev:we,scrollProgress:Ae,scrollSnapList:me,scrollTo:ue,selectedScrollSnap:ge,slideNodes:Me,slidesInView:Oe,slidesNotInView:Je};return ie(t,r),setTimeout(()=>m.emit("init"),0),We}jO.globalOptions=void 0;function t$(e={},t=[]){const r=V.useRef(e),n=V.useRef(t),[s,o]=V.useState(),[h,i]=V.useState(),m=V.useCallback(()=>{s&&s.reInit(r.current,n.current)},[s]);return V.useEffect(()=>{Y5(r.current,e)||(r.current=e,m())},[e,m]),V.useEffect(()=>{SNe(n.current,t)||(n.current=t,m())},[t,m]),V.useEffect(()=>{if(wNe()&&h){jO.globalOptions=t$.globalOptions;const y=jO(h,r.current,n.current);return o(y),()=>y.destroy()}else o(void 0)},[h,o]),[i,s]}t$.globalOptions=void 0;const Yae=V.createContext(null);function HN(){const e=V.useContext(Yae);if(!e)throw new Error("useCarousel must be used within a <Carousel />");return e}const Jae=V.forwardRef(({orientation:e="horizontal",opts:t,setApi:r,plugins:n,className:s,children:o,...h},i)=>{const[m,y]=t$({...t,axis:e==="horizontal"?"x":"y"},n),[S,b]=V.useState(!1),[T,A]=V.useState(!1),O=V.useCallback(M=>{M&&(b(M.canScrollPrev()),A(M.canScrollNext()))},[]),P=V.useCallback(()=>{y==null||y.scrollPrev()},[y]),I=V.useCallback(()=>{y==null||y.scrollNext()},[y]),R=V.useCallback(M=>{M.key==="ArrowLeft"?(M.preventDefault(),P()):M.key==="ArrowRight"&&(M.preventDefault(),I())},[P,I]);return V.useEffect(()=>{!y||!r||r(y)},[y,r]),V.useEffect(()=>{if(y)return O(y),y.on("reInit",O),y.on("select",O),()=>{y==null||y.off("select",O)}},[y,O]),d.jsx(Yae.Provider,{value:{carouselRef:m,api:y,opts:t,orientation:e||((t==null?void 0:t.axis)==="y"?"vertical":"horizontal"),scrollPrev:P,scrollNext:I,canScrollPrev:S,canScrollNext:T},children:d.jsx("div",{ref:i,onKeyDownCapture:R,className:fr("relative",s),role:"region","aria-roledescription":"carousel",...h,children:o})})});Jae.displayName="Carousel";const Qae=V.forwardRef(({className:e,...t},r)=>{const{carouselRef:n,orientation:s}=HN();return d.jsx("div",{ref:n,className:"overflow-hidden",children:d.jsx("div",{ref:r,className:fr("flex",s==="horizontal"?"-ml-4":"-mt-4 flex-col",e),...t})})});Qae.displayName="CarouselContent";const yE=V.forwardRef(({className:e,...t},r)=>{const{orientation:n}=HN();return d.jsx("div",{ref:r,role:"group","aria-roledescription":"slide",className:fr("min-w-0 shrink-0 grow-0 basis-full",n==="horizontal"?"pl-4":"pt-4",e),...t})});yE.displayName="CarouselItem";const tIe=V.forwardRef(({className:e,variant:t="outline",size:r="icon",...n},s)=>{const{orientation:o,scrollPrev:h,canScrollPrev:i}=HN();return d.jsxs(Mt,{ref:s,variant:t,size:r,className:fr("absolute h-8 w-8 rounded-full",o==="horizontal"?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",e),disabled:!i,onClick:h,...n,children:[d.jsx(EB,{className:"h-4 w-4"}),d.jsx("span",{className:"sr-only",children:"Previous slide"})]})});tIe.displayName="CarouselPrevious";const rIe=V.forwardRef(({className:e,variant:t="outline",size:r="icon",...n},s)=>{const{orientation:o,scrollNext:h,canScrollNext:i}=HN();return d.jsxs(Mt,{ref:s,variant:t,size:r,className:fr("absolute h-8 w-8 rounded-full",o==="horizontal"?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",e),disabled:!i,onClick:h,...n,children:[d.jsx(EQ,{className:"h-4 w-4"}),d.jsx("span",{className:"sr-only",children:"Next slide"})]})});rIe.displayName="CarouselNext";const nIe=()=>{const{user:e}=Kn();return ei({queryKey:["favorites",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ct.from("favorites").select("restaurant_id").eq("user_id",e.id);if(r)throw r;if(!t||t.length===0)return[];const n=t.map(h=>h.restaurant_id),{data:s,error:o}=await Ct.from("restaurants").select("*").in("id",n);if(o)throw o;return s||[]},enabled:!!e})},iIe=()=>{const{user:e}=Kn();return ei({queryKey:["user-comments",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ct.from("comments").select("*").eq("user_id",e.id).is("parent_id",null).order("created_at",{ascending:!1});if(r)throw r;if(!t||t.length===0)return[];const n=t.filter(i=>i.target_type==="restaurant").map(i=>i.target_id),s=t.filter(i=>i.target_type==="activity").map(i=>i.target_id),o=new Map;if(n.length>0){const{data:i}=await Ct.from("restaurants").select("id, name, name_en, name_pt").in("id",n);i==null||i.forEach(m=>{o.set(m.id,{name:m.name,name_en:m.name_en||void 0,name_pt:m.name_pt||void 0})})}const h=new Map;if(s.length>0){const{data:i}=await Ct.from("activities").select("id, title_zh, title_en, title_pt").in("id",s);i==null||i.forEach(m=>{h.set(m.id,{title_zh:m.title_zh,title_en:m.title_en,title_pt:m.title_pt})})}return t.map(i=>{if(i.target_type==="restaurant"){const m=o.get(i.target_id);return{...i,target_name:(m==null?void 0:m.name)||"Unknown Restaurant",target_name_en:m==null?void 0:m.name_en,target_name_pt:m==null?void 0:m.name_pt}}else if(i.target_type==="activity"){const m=h.get(i.target_id);return{...i,target_name:(m==null?void 0:m.title_zh)||"Unknown Activity",target_name_en:m==null?void 0:m.title_en,target_name_pt:m==null?void 0:m.title_pt}}return i})},enabled:!!e,staleTime:3e4})},sIe=()=>{const{user:e}=Kn(),{data:t=[]}=F2();return ei({queryKey:["merchantActivities",e==null?void 0:e.id],queryFn:async()=>{if(!e||t.length===0)return[];const r=t.map(y=>y.id),{data:n,error:s}=await Ct.from("activity_restaurants").select("*").in("restaurant_id",r).order("created_at",{ascending:!1});if(s)throw s;if(!n||n.length===0)return[];const{data:o}=await Ct.from("restaurants").select("id, name, name_en, name_pt, address").in("id",r),h=[...new Set(n.map(y=>y.activity_id))],{data:i}=await Ct.from("activities").select("*").in("id",h);return n.map(y=>{const S=o==null?void 0:o.find(T=>T.id===y.restaurant_id),b=i==null?void 0:i.find(T=>T.id===y.activity_id);return{activity_id:y.activity_id,restaurant_id:y.restaurant_id,restaurant_name:(S==null?void 0:S.name)||"",restaurant_name_en:(S==null?void 0:S.name_en)||null,restaurant_name_pt:(S==null?void 0:S.name_pt)||null,restaurant_address:(S==null?void 0:S.address)||"",activity:b||null,created_at:y.created_at}})},enabled:!!e&&t.length>0})},aIe="modulepreload",oIe=function(e){return"/"+e},aW={},lIe=function(t,r,n){let s=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),i=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));s=Promise.allSettled(r.map(m=>{if(m=oIe(m),m in aW)return;aW[m]=!0;const y=m.endsWith(".css"),S=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${S}`))return;const b=document.createElement("link");if(b.rel=y?"stylesheet":aIe,y||(b.as="script"),b.crossOrigin="",b.href=m,i&&b.setAttribute("nonce",i),document.head.appendChild(b),y)return new Promise((T,A)=>{b.addEventListener("load",T),b.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${m}`)))})}))}function o(h){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=h,window.dispatchEvent(i),!i.defaultPrevented)throw h}return s.then(h=>{for(const i of h||[])i.status==="rejected"&&o(i.reason);return t().catch(o)})},eoe=[{code:"+351",country:"Portugal",flag:""},{code:"+34",country:"Spain",flag:""},{code:"+33",country:"France",flag:""},{code:"+49",country:"Germany",flag:""},{code:"+39",country:"Italy",flag:""},{code:"+44",country:"UK",flag:""},{code:"+31",country:"Netherlands",flag:""},{code:"+32",country:"Belgium",flag:""},{code:"+86",country:"China",flag:""},{code:"+1",country:"USA/Canada",flag:""},{code:"+55",country:"Brazil",flag:""}],oW=e=>{if(!e)return{code:"+351",number:""};for(const t of eoe)if(e.startsWith(t.code))return{code:t.code,number:e.slice(t.code.length).trim()};return{code:"+351",number:e}},lW=({profile:e})=>{const{t}=ci(),r=Jc(),{user:n}=Kn(),{isAdmin:s}=_c(),[o,h]=V.useState(!1),[i,m]=V.useState(e.display_name),y=oW(e.phone),[S,b]=V.useState(y.code),[T,A]=V.useState(y.number),[O,P]=V.useState(!1),[I,R]=V.useState(null),[M,F]=V.useState(e.avatar_url||""),[z,$]=V.useState(!1),[W,K]=V.useState(!1),[ee,ne]=V.useState(""),[ie,re]=V.useState(!1),te=V.useRef(!1);V.useEffect(()=>{const st=te.current;if(te.current=o,o&&!st){m(e.display_name);const yn=oW(e.phone);b(yn.code),A(yn.number),F(e.avatar_url||""),R(null),P(!1)}},[o,e.display_name,e.phone,e.avatar_url]);const[ae,ue]=V.useState(!1),[be,we]=V.useState(!1),[Ce,_e]=V.useState(!1),[me,Ae]=V.useState(""),[ge,pe]=V.useState(""),[Oe,Je]=V.useState(""),[Ze,Pe]=V.useState(!1),[Be,nt]=V.useState(!1),[Me,We]=V.useState(!1),[gt,rt]=V.useState(!1),[Ht,Lt]=V.useState(!1),[nr,Rr]=V.useState(""),[Dr,Pt]=V.useState(""),[wt,He]=V.useState(""),[lt,ut]=V.useState(!1),[sr,Qt]=V.useState(""),[er,Cr]=V.useState(!1),[dn,fn]=V.useState(!1),[Zn,Gn]=V.useState(null),Di=V.useRef(null),ka=V.useRef(null),xs=V.useRef(null),mi=Xne(),Ua=lCe();V.useEffect(()=>{Ze&&Di.current&&Di.current.focus()},[Ze]),V.useEffect(()=>{Be&&ka.current&&ka.current.focus()},[Be]),V.useEffect(()=>{er&&xs.current&&xs.current.focus()},[er]);const Va=st=>{var Zs;const yn=(Zs=st.target.files)==null?void 0:Zs[0];if(yn){if(yn.size>2*1024*1024)return;R(yn),F(URL.createObjectURL(yn))}},Lo=async()=>{let st=e.avatar_url;if(I){const Zs=await Ua.mutateAsync(I);Zs&&(st=Zs)}const yn=T?`${S} ${T}`:void 0;await mi.mutateAsync({display_name:i,phone:yn,avatar_url:st||void 0}),P(!1),h(!1)},qa=async()=>{if(!(!n||ee.toLowerCase()!=="delete")){re(!0);try{const{error:st}=await Ct.functions.invoke("delete-account",{body:{userId:n.id}});if(st){kr.error(t("profile.deleteAccountFailed")),console.error(st),re(!1);return}kr.success(t("profile.deleteAccountSuccess")),K(!1),$(!1),ne(""),await new Promise(yn=>setTimeout(yn,1500)),await Ct.auth.signOut(),r("/auth")}catch(st){kr.error(st.message||t("profile.deleteAccountFailed")),re(!1)}finally{re(!1)}}},Ha=async()=>{if(n!=null&&n.email)try{const{error:st}=await Ct.functions.invoke("send-verification-code",{body:{email:n.email}});if(st)throw st;Pe(!0),kr.success(t("profile.codeSentToOldEmail"))}catch(st){kr.error(t("profile.sendCodeFailed")),console.error(st)}},Fi=async()=>{if(!ge){kr.error(t("profile.enterCodePlaceholder"));return}try{const{data:st,error:yn}=await Ct.functions.invoke("verify-email-code",{body:{email:n==null?void 0:n.email,code:ge}});if(yn||!(st!=null&&st.success)){kr.error(t("profile.codeIncorrect"));return}kr.success(t("profile.oldEmailVerified")),ue(!1),we(!0)}catch(st){kr.error(t("profile.verificationFailed")),console.error(st)}},Ks=async()=>{if(!me||!me.includes("@")){kr.error(t("profile.enterValidEmail"));return}try{const{error:st}=await Ct.functions.invoke("send-verification-code",{body:{email:me}});if(st)throw st;kr.success(t("profile.codeSentToNewEmail")),nt(!0)}catch(st){kr.error(t("profile.sendCodeFailed")),console.error(st)}},rl=async()=>{if(!Oe){kr.error(t("profile.enterCodePlaceholder"));return}try{const{data:st,error:yn}=await Ct.functions.invoke("verify-email-code",{body:{email:me,code:Oe}});if(yn||!(st!=null&&st.success)){kr.error(t("profile.codeIncorrect"));return}kr.success(t("profile.newEmailVerified")),we(!1),setTimeout(()=>{_e(!0)},100)}catch(st){kr.error(t("toast.verificationFailed")),console.error(st)}},xa=async()=>{We(!0);try{const{data:{session:st}}=await Ct.auth.getSession();if(!st||!n){kr.error(t("toast.pleaseSignIn")),We(!1);return}const{data:yn,error:Zs}=await Ct.functions.invoke("update-email",{body:{userId:n.id,oldEmail:n.email,oldEmailCode:ge,newEmail:me,newEmailCode:Oe},headers:{Authorization:`Bearer ${st.access_token}`}});if(Zs||!(yn!=null&&yn.success))throw new Error((yn==null?void 0:yn.error)||"Failed to update email");kr.success(t("toast.emailUpdatedSuccess")),_e(!1),h(!1),pe(""),Ae(""),Je(""),Pe(!1),nt(!1),await new Promise(Na=>setTimeout(Na,1500)),await Ct.auth.signOut(),r("/auth")}catch(st){kr.error(st.message||t("toast.emailUpdateError")),console.error(st)}finally{We(!1)}},so=st=>{let yn=0;return st.length>=6&&yn++,st.length>=8&&yn++,/[a-z]/.test(st)&&yn++,/[A-Z]/.test(st)&&yn++,/[0-9]/.test(st)&&yn++,/[^a-zA-Z0-9]/.test(st)&&yn++,yn<=2?"weak":yn<=4?"medium":"strong"},Ln=async st=>{if(st==null||st.preventDefault(),st==null||st.stopPropagation(),!nr){kr.error(t("profile.enterCurrentPassword"));return}try{const{createClient:yn}=await lIe(async()=>{const{createClient:_n}=await Promise.resolve().then(()=>PEe);return{createClient:_n}},void 0),Zs=yn("https://tzdgqhwyzsxkxnncgzap.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",{auth:{persistSession:!1,autoRefreshToken:!1}}),{error:Na}=await Zs.auth.signInWithPassword({email:(n==null?void 0:n.email)||"",password:nr});if(Na){kr.error(t("profile.oldPasswordIncorrect"));return}kr.success(t("profile.oldPasswordVerified")),rt(!1),Lt(!0)}catch(yn){kr.error(t("profile.verificationFailed")),console.error(yn)}},zi=async()=>{if(n!=null&&n.email)try{const{error:st}=await Ct.functions.invoke("send-verification-code",{body:{email:n.email}});if(st)throw st;Cr(!0),kr.success(t("profile.codeSentToOldEmail"))}catch(st){kr.error(t("profile.sendCodeFailed")),console.error(st)}},ms=async st=>{if(st==null||st.preventDefault(),st==null||st.stopPropagation(),!sr){kr.error(t("profile.enterCodePlaceholder"));return}try{const{data:yn,error:Zs}=await Ct.functions.invoke("verify-email-code",{body:{email:n==null?void 0:n.email,code:sr}});if(Zs||!(yn!=null&&yn.success)){kr.error(t("profile.codeIncorrect"));return}kr.success(t("profile.oldEmailVerified")),rt(!1),Lt(!0)}catch(yn){kr.error(t("profile.verificationFailed")),console.error(yn)}},Ga=async st=>{if(st==null||st.preventDefault(),st==null||st.stopPropagation(),!Dr||!wt){kr.error(t("profile.enterNewPassword"));return}if(Dr.length<6){kr.error(t("profile.passwordTooShort"));return}if(Dr!==wt){kr.error(t("profile.passwordsDontMatch"));return}fn(!0);try{const{error:yn}=await Ct.auth.updateUser({password:Dr});if(yn)throw yn;kr.success(t("profile.passwordUpdated")),Lt(!1),h(!1),Rr(""),Pt(""),He(""),ut(!1),Qt(""),Cr(!1)}catch(yn){kr.error(yn.message||t("profile.passwordUpdateFailed")),console.error(yn)}finally{fn(!1)}};return d.jsxs(fl,{open:o,onOpenChange:h,children:[d.jsx(tf,{asChild:!0,children:d.jsxs(Mt,{variant:"outline",children:[d.jsx($_e,{className:"w-4 h-4 mr-2"}),t("profile.editProfile")]})}),d.jsxs(Jo,{className:"max-w-[90vw] sm:max-w-[425px] max-h-[90vh] overflow-y-auto",children:[d.jsxs(Qo,{children:[d.jsx(el,{children:t("profile.editProfile")}),d.jsx(Ul,{children:t("profile.editProfileDescription")})]}),d.jsxs("div",{className:"space-y-3 py-3",children:[d.jsxs("div",{className:"flex flex-col items-center gap-3",children:[d.jsxs(Ju,{className:"w-16 h-16 sm:w-24 sm:h-24",children:[d.jsx(Qu,{src:M}),d.jsx(ed,{children:i==null?void 0:i.charAt(0).toUpperCase()})]}),d.jsxs("div",{children:[d.jsx(cr,{type:"file",accept:"image/*",onChange:Va,className:"hidden",id:"avatar-upload"}),d.jsxs(Mt,{variant:"outline",size:"sm",onClick:()=>{var st;return(st=document.getElementById("avatar-upload"))==null?void 0:st.click()},className:"text-xs sm:text-sm",children:[d.jsx(zh,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),t("profile.uploadAvatar")]})]})]}),d.jsxs("div",{className:"space-y-1.5",children:[d.jsx(yr,{htmlFor:"displayName",className:"text-sm",children:t("profile.displayName")}),d.jsx(cr,{id:"displayName",value:i,onChange:st=>m(st.target.value),placeholder:t("profile.displayName"),className:"h-9"})]}),d.jsxs("div",{className:"space-y-1.5",children:[d.jsx(yr,{htmlFor:"phone",className:"text-sm",children:t("profile.phone")}),!e.phone&&!O?d.jsx(Mt,{variant:"outline",size:"sm",onClick:()=>P(!0),className:"w-full justify-start h-9",children:t("profile.addPhoneNumber")}):O||!e.phone?d.jsxs("div",{className:"flex gap-2",children:[d.jsxs(Qs,{value:S,onValueChange:b,children:[d.jsx(Gs,{className:"w-[110px] h-9",children:d.jsx(ea,{placeholder:"+351"})}),d.jsx(Ws,{children:eoe.map(st=>d.jsx(nn,{value:st.code,children:d.jsxs("span",{className:"flex items-center gap-2",children:[d.jsx("span",{children:st.flag}),d.jsx("span",{children:st.code})]})},st.code))})]}),d.jsx(cr,{id:"phone",className:"flex-1 h-9",value:T,onChange:st=>A(st.target.value),placeholder:t("profile.phonePlaceholder")})]}):d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(cr,{value:`${S} ${T}`,disabled:!0,className:"h-9 flex-1"}),d.jsx(Mt,{variant:"outline",size:"sm",onClick:()=>P(!0),className:"text-xs whitespace-nowrap",children:t("profile.modifyPhoneNumber")})]})]}),!s&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"space-y-1.5 pt-2 border-t",children:[d.jsx(yr,{className:"text-sm",children:""}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(cr,{value:(n==null?void 0:n.email)||"",disabled:!0,className:"h-9 flex-1"}),d.jsxs(Mt,{variant:"outline",size:"sm",onClick:()=>ue(!0),className:"text-xs",children:[d.jsx(OQ,{className:"w-3 h-3 mr-1"}),""]})]})]}),d.jsxs("div",{className:"space-y-1.5",children:[d.jsx(yr,{className:"text-sm",children:t("profile.changePassword")}),d.jsxs(Mt,{variant:"outline",size:"sm",onClick:()=>rt(!0),className:"w-full justify-start h-9",children:[d.jsx(N_e,{className:"w-3 h-3 mr-2"}),t("profile.changePassword")]})]})]})]}),d.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 pt-2 border-t",children:[!s&&d.jsxs(Mt,{variant:"destructive",size:"sm",onClick:()=>$(!0),className:"w-full sm:w-auto text-xs sm:text-sm",children:[d.jsx(Yh,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),t("profile.deleteAccount")]}),d.jsxs("div",{className:`flex gap-2 w-full sm:w-auto ${s?"sm:ml-auto":""}`,children:[d.jsx(Mt,{variant:"outline",size:"sm",onClick:()=>{P(!1),h(!1)},className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:t("common.cancel")}),d.jsx(Mt,{size:"sm",onClick:Lo,disabled:mi.isPending||Ua.isPending,className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:mi.isPending||Ua.isPending?t("common.loading"):t("common.save")})]})]})]}),d.jsx(ko,{open:z,onOpenChange:$,children:d.jsxs(co,{children:[d.jsxs(uo,{children:[d.jsx(fo,{children:t("profile.deleteAccountWarning")}),d.jsx(po,{children:t("profile.deleteAccountDescription")})]}),d.jsxs(ho,{children:[d.jsx(mo,{children:t("common.cancel")}),d.jsx(to,{onClick:()=>{$(!1),K(!0)},className:"bg-destructive hover:bg-destructive/90",children:t("common.continue")})]})]})}),d.jsx(ko,{open:W,onOpenChange:K,children:d.jsxs(co,{children:[d.jsxs(uo,{children:[d.jsx(fo,{children:t("profile.confirmDeleteAccount")}),d.jsxs(po,{className:"space-y-4",children:[d.jsx("p",{children:t("profile.confirmDeleteDescription")}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"confirm-delete",children:t("profile.typeDeleteToConfirm")}),d.jsx(cr,{id:"confirm-delete",value:ee,onChange:st=>ne(st.target.value),placeholder:"DELETE",className:"uppercase"})]})]})]}),d.jsxs(ho,{children:[d.jsx(mo,{onClick:()=>ne(""),children:t("common.cancel")}),d.jsx(to,{onClick:qa,disabled:ee.toLowerCase()!=="delete"||ie,className:"bg-destructive hover:bg-destructive/90",children:t(ie?"common.loading":"profile.deleteAccount")})]})]})}),d.jsx(ko,{open:ae,onOpenChange:ue,children:d.jsxs(co,{className:"max-w-[90vw] sm:max-w-md",children:[d.jsxs(uo,{children:[d.jsx(fo,{children:t("profile.verifyOldEmail")}),d.jsx(po,{children:t("profile.oldEmailStep")})]}),d.jsxs("div",{className:"space-y-4 py-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{children:t("profile.currentEmail")}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx(cr,{value:(n==null?void 0:n.email)||"",disabled:!0,className:"flex-1"}),d.jsx(Mt,{variant:"outline",size:"sm",onClick:Ha,disabled:Ze,children:t(Ze?"profile.codeSent":"profile.sendCode")})]})]}),Ze&&d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{children:t("profile.verificationCode")}),d.jsx(cr,{ref:Di,value:ge,onChange:st=>pe(st.target.value),placeholder:t("profile.enterCode"),maxLength:4})]})]}),d.jsxs(ho,{children:[d.jsx(mo,{onClick:()=>{ue(!1),setTimeout(()=>{pe(""),Pe(!1)},300)},children:t("common.cancel")}),Ze&&d.jsx(to,{onClick:Fi,children:t("profile.verify")})]})]})}),d.jsx(ko,{open:be,onOpenChange:we,children:d.jsxs(co,{className:"max-w-[90vw] sm:max-w-md",children:[d.jsxs(uo,{className:"text-center space-y-3",children:[d.jsx(fo,{className:"text-xl",children:t("profile.verifyNewEmail")}),d.jsx(po,{className:"text-center",children:t("profile.newEmailStep")})]}),d.jsxs("div",{className:"space-y-4 py-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{className:"text-sm font-normal",children:t("profile.newEmail")}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx(cr,{type:"email",value:me,onChange:st=>Ae(st.target.value),placeholder:t("profile.enterNewEmail"),disabled:Be,className:"border-2 focus:border-primary flex-1"}),d.jsx(Mt,{variant:"outline",size:"sm",onClick:Ks,disabled:!me||Be,className:"text-xs whitespace-nowrap px-3",children:t(Be?"profile.codeSent":"profile.sendCode")})]})]}),Be&&d.jsxs("div",{className:"space-y-2 animate-in fade-in slide-in-from-top-2 duration-300",children:[d.jsx(yr,{className:"text-sm font-normal",children:t("profile.verificationCode")}),d.jsx(cr,{ref:ka,value:Oe,onChange:st=>Je(st.target.value),placeholder:t("profile.enterCode"),maxLength:4,className:"border-2 focus:border-primary"})]})]}),d.jsxs(ho,{className:"flex-col sm:flex-col gap-2",children:[Be&&d.jsx(to,{onClick:rl,disabled:!Oe||Oe.length!==4,className:"w-full bg-primary hover:bg-primary/90",children:""}),d.jsx(mo,{onClick:()=>{we(!1),setTimeout(()=>{Ae(""),Je(""),nt(!1)},300)},className:"w-full mt-0",children:""})]})]})}),d.jsx(ko,{open:Ce,onOpenChange:_e,children:d.jsxs(co,{className:"max-w-[90vw] sm:max-w-md",children:[d.jsxs(uo,{children:[d.jsx(fo,{children:""}),d.jsx(po,{children:" 3/3: "})]}),d.jsxs("div",{className:"space-y-4 py-4",children:[d.jsxs("div",{className:"rounded-lg bg-green-50 dark:bg-green-950 p-4 text-sm",children:[d.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:""}),d.jsx("p",{className:"text-green-700 dark:text-green-300 mt-1",children:'""'})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{className:"text-muted-foreground",children:":"}),d.jsx("span",{className:"font-medium",children:n==null?void 0:n.email})]}),d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{className:"text-muted-foreground",children:":"}),d.jsx("span",{className:"font-medium",children:me})]})]})]}),d.jsxs(ho,{children:[d.jsx(mo,{onClick:()=>{_e(!1),setTimeout(()=>{pe(""),Ae(""),Je(""),Pe(!1),nt(!1)},300)},children:""}),d.jsx(to,{onClick:xa,disabled:Me,children:Me?"...":""})]})]})}),d.jsx(ko,{open:gt,onOpenChange:rt,children:d.jsxs(co,{className:"max-w-[90vw] sm:max-w-md",children:[d.jsxs(uo,{children:[d.jsx(fo,{children:t("profile.verifyOldPassword")}),d.jsx(po,{children:t("profile.oldPasswordStep")})]}),d.jsx("div",{className:"space-y-4 py-4",children:lt?d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{children:t("profile.currentEmail")}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx(cr,{value:(n==null?void 0:n.email)||"",disabled:!0,className:"flex-1"}),d.jsx(Mt,{variant:"outline",size:"sm",onClick:zi,disabled:er,children:t(er?"profile.codeSent":"profile.sendCode")})]})]}),er&&d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{children:t("profile.verificationCode")}),d.jsx(cr,{ref:xs,value:sr,onChange:st=>Qt(st.target.value),placeholder:t("profile.enterCode"),maxLength:4})]})]}):d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{children:t("profile.currentPassword")}),d.jsx(cr,{type:"password",value:nr,onChange:st=>Rr(st.target.value),placeholder:t("profile.enterCurrentPassword")})]}),d.jsxs(Mt,{variant:"link",size:"sm",onClick:()=>ut(!0),className:"text-xs p-0 h-auto",children:[t("profile.forgotPassword")," ",t("profile.useEmailVerification")]})]})}),d.jsxs(ho,{children:[d.jsx(mo,{onClick:()=>{rt(!1),setTimeout(()=>{Rr(""),ut(!1),Qt(""),Cr(!1)},300)},children:t("common.cancel")}),lt?er&&d.jsx(to,{onClick:ms,children:t("profile.verify")}):d.jsx(to,{onClick:Ln,children:t("profile.verify")})]})]})}),d.jsx(ko,{open:Ht,onOpenChange:Lt,children:d.jsxs(co,{className:"max-w-[90vw] sm:max-w-md",children:[d.jsxs(uo,{children:[d.jsx(fo,{children:t("profile.setNewPassword")}),d.jsx(po,{children:t("profile.newPasswordStep")})]}),d.jsxs("div",{className:"space-y-4 py-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{children:t("profile.newPassword")}),d.jsx(cr,{type:"password",value:Dr,onChange:st=>{Pt(st.target.value),st.target.value?Gn(so(st.target.value)):Gn(null)},placeholder:t("profile.enterNewPassword")}),Zn&&d.jsxs("div",{className:"space-y-1",children:[d.jsxs("div",{className:"flex gap-1",children:[d.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${Zn==="weak"?"bg-destructive":Zn==="medium"?"bg-warning":"bg-success"}`}),d.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${Zn==="medium"||Zn==="strong"?Zn==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),d.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${Zn==="strong"?"bg-success":"bg-muted"}`})]}),d.jsx("p",{className:`text-xs ${Zn==="weak"?"text-destructive":Zn==="medium"?"text-warning":"text-success"}`,children:t(`auth.passwordStrength.${Zn}`)})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{children:t("profile.confirmNewPassword")}),d.jsx(cr,{type:"password",value:wt,onChange:st=>He(st.target.value),placeholder:t("profile.confirmNewPasswordPlaceholder")})]}),Dr&&wt&&Dr!==wt&&d.jsx("p",{className:"text-sm text-destructive",children:t("profile.passwordsDontMatch")})]}),d.jsxs(ho,{children:[d.jsx(mo,{onClick:()=>{Lt(!1),setTimeout(()=>{Pt(""),He(""),Gn(null)},300)},children:t("common.cancel")}),d.jsx(to,{onClick:Ga,disabled:!Dr||!wt||Dr!==wt||dn,children:t(dn?"common.loading":"profile.updatePassword")})]})]})})]})},cIe=()=>{const{user:e}=Kn();return ei({queryKey:["user-addresses",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ct.from("user_addresses").select("*").eq("user_id",e.id).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(r)throw r;return t},enabled:!!e})},uIe=()=>{const{user:e}=Kn(),{toast:t}=Ri(),r=Mi();return Gi({mutationFn:async n=>{if(!e)throw new Error("User not authenticated");const{data:s,error:o}=await Ct.from("user_addresses").insert({user_id:e.id,label:n.label,street:n.street,district:n.district||null,city:n.city,postal_code:n.postal_code||null,country:n.country,phone:n.phone||null,phone_code:n.phone_code||"+351",is_default:n.is_default||!1}).select().single();if(o)throw o;return s},onSuccess:()=>{r.invalidateQueries({queryKey:["user-addresses"]}),t({title:"Success",description:"Address added successfully"})},onError:()=>{t({title:"Error",description:"Failed to add address",variant:"destructive"})}})},dIe=()=>{const{user:e}=Kn(),{toast:t}=Ri(),r=Mi();return Gi({mutationFn:async({id:n,address:s})=>{if(!e)throw new Error("User not authenticated");const{data:o,error:h}=await Ct.from("user_addresses").update({label:s.label,street:s.street,district:s.district||null,city:s.city,postal_code:s.postal_code||null,country:s.country,phone:s.phone||null,phone_code:s.phone_code||"+351",is_default:s.is_default}).eq("id",n).eq("user_id",e.id).select().single();if(h)throw h;return o},onSuccess:()=>{r.invalidateQueries({queryKey:["user-addresses"]}),t({title:"Success",description:"Address updated successfully"})},onError:()=>{t({title:"Error",description:"Failed to update address",variant:"destructive"})}})},hIe=()=>{const{user:e}=Kn(),{toast:t}=Ri(),r=Mi();return Gi({mutationFn:async n=>{if(!e)throw new Error("User not authenticated");const{error:s}=await Ct.from("user_addresses").delete().eq("id",n).eq("user_id",e.id);if(s)throw s},onSuccess:()=>{r.invalidateQueries({queryKey:["user-addresses"]}),t({title:"Success",description:"Address deleted successfully"})},onError:()=>{t({title:"Error",description:"Failed to delete address",variant:"destructive"})}})},fIe=()=>{const{user:e}=Kn(),{toast:t}=Ri(),r=Mi();return Gi({mutationFn:async n=>{if(!e)throw new Error("User not authenticated");const{data:s,error:o}=await Ct.from("user_addresses").update({is_default:!0}).eq("id",n).eq("user_id",e.id).select().single();if(o)throw o;return s},onSuccess:()=>{r.invalidateQueries({queryKey:["user-addresses"]}),t({title:"Success",description:"Default address updated"})},onError:()=>{t({title:"Error",description:"Failed to set default address",variant:"destructive"})}})},zF=[{value:"Home",icon:jQ,labelKey:"address.labelHome"},{value:"Work",icon:lE,labelKey:"address.labelWork"},{value:"Office",icon:y_e,labelKey:"address.labelOffice"},{value:"Other",icon:Pa,labelKey:"address.labelOther"}],pIe=[{code:"+351",country:"Portugal",flag:""},{code:"+34",country:"Spain",flag:""},{code:"+33",country:"France",flag:""},{code:"+49",country:"Germany",flag:""},{code:"+39",country:"Italy",flag:""},{code:"+44",country:"UK",flag:""},{code:"+31",country:"Netherlands",flag:""},{code:"+32",country:"Belgium",flag:""},{code:"+86",country:"China",flag:""},{code:"+1",country:"USA/Canada",flag:""},{code:"+55",country:"Brazil",flag:""}],mIe=["Portugal","Spain","France","Germany","Italy","United Kingdom","Netherlands","Belgium","China","Other"],cW=({initialData:e,onSubmit:t,onCancel:r,isLoading:n,isEdit:s})=>{const{t:o}=ci(),[h,i]=V.useState({label:(e==null?void 0:e.label)||"Home",street:(e==null?void 0:e.street)||"",district:(e==null?void 0:e.district)||"",city:(e==null?void 0:e.city)||"",postal_code:(e==null?void 0:e.postal_code)||"",country:(e==null?void 0:e.country)||"Portugal",phone:(e==null?void 0:e.phone)||"",phone_code:(e==null?void 0:e.phone_code)||"+351",is_default:(e==null?void 0:e.is_default)||!1}),m=y=>{y.preventDefault(),t(h)};return d.jsxs("form",{onSubmit:m,className:"space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"label",children:o("address.label")}),d.jsxs(Qs,{value:h.label,onValueChange:y=>i({...h,label:y}),children:[d.jsx(Gs,{children:d.jsx(ea,{placeholder:o("address.selectLabel")})}),d.jsx(Ws,{children:zF.map(y=>d.jsx(nn,{value:y.value,children:d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(y.icon,{className:"w-4 h-4"}),o(y.labelKey)]})},y.value))})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs(yr,{htmlFor:"street",children:[o("address.street")," *"]}),d.jsx(cr,{id:"street",value:h.street,onChange:y=>i({...h,street:y.target.value}),placeholder:o("address.streetPlaceholder"),required:!0})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"district",children:o("address.district")}),d.jsx(cr,{id:"district",value:h.district,onChange:y=>i({...h,district:y.target.value}),placeholder:o("address.districtPlaceholder")})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs(yr,{htmlFor:"city",children:[o("address.city")," *"]}),d.jsx(cr,{id:"city",value:h.city,onChange:y=>i({...h,city:y.target.value}),placeholder:o("address.cityPlaceholder"),required:!0})]})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsxs(yr,{htmlFor:"postal_code",children:[o("address.postalCode")," *"]}),d.jsx(cr,{id:"postal_code",value:h.postal_code,onChange:y=>i({...h,postal_code:y.target.value}),placeholder:o("address.postalCodePlaceholder"),required:!0})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs(yr,{htmlFor:"country",children:[o("address.country")," *"]}),d.jsxs(Qs,{value:h.country,onValueChange:y=>i({...h,country:y}),children:[d.jsx(Gs,{children:d.jsx(ea,{placeholder:o("address.selectCountry")})}),d.jsx(Ws,{children:mIe.map(y=>d.jsx(nn,{value:y,children:y},y))})]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs(yr,{htmlFor:"phone",children:[o("address.phone")," *"]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsxs(Qs,{value:h.phone_code,onValueChange:y=>i({...h,phone_code:y}),children:[d.jsx(Gs,{className:"w-[130px]",children:d.jsx(ea,{placeholder:"+351"})}),d.jsx(Ws,{children:pIe.map(y=>d.jsx(nn,{value:y.code,children:d.jsxs("span",{className:"flex items-center gap-2",children:[d.jsx("span",{children:y.flag}),d.jsx("span",{children:y.code})]})},y.code))})]}),d.jsx(cr,{id:"phone",className:"flex-1",value:h.phone,onChange:y=>i({...h,phone:y.target.value}),placeholder:o("address.phonePlaceholder"),required:!0})]})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx(Yo,{id:"is_default",checked:h.is_default,onCheckedChange:y=>i({...h,is_default:y})}),d.jsx(yr,{htmlFor:"is_default",className:"text-sm font-normal cursor-pointer",children:o("address.setAsDefault")})]}),d.jsxs(Qv,{className:"gap-2 sm:gap-0",children:[d.jsx(Mt,{type:"button",variant:"outline",onClick:r,children:o("common.cancel")}),d.jsx(Mt,{type:"submit",disabled:n,children:o(n?"common.saving":s?"common.save":"address.add")})]})]})},gIe=({address:e,onEdit:t,onDelete:r,onSetDefault:n,isDeleting:s,isSettingDefault:o,canDelete:h=!0})=>{const{t:i}=ci(),m=zF.find(S=>S.value===e.label)||zF[3],y=m.icon;return d.jsx("div",{className:`p-4 border rounded-lg hover:shadow-medium transition-shadow relative ${e.is_default?"bg-primary/5 border-primary/20":""}`,children:d.jsxs("div",{className:"flex items-start justify-between gap-4",children:[d.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[d.jsx("div",{className:`p-2 rounded-full ${e.is_default?"bg-primary/20":"bg-primary/10"}`,children:d.jsx(y,{className:"w-5 h-5 text-primary"})}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[d.jsx("span",{className:"font-semibold text-foreground",children:i(m.labelKey)}),e.is_default&&d.jsxs(sn,{variant:"secondary",className:"text-xs",children:[d.jsx(Al,{className:"w-3 h-3 mr-1 fill-current"}),i("address.default")]})]}),d.jsxs("p",{className:"text-sm text-foreground",children:[e.street,e.district&&`, ${e.district}`]}),d.jsx("p",{className:"text-sm text-muted-foreground",children:[e.postal_code,e.city,e.country].filter(Boolean).join(", ")}),e.phone&&d.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[d.jsx(Jb,{className:"w-3 h-3"}),e.phone_code," ",e.phone]})]})]}),d.jsxs("div",{className:"flex items-center gap-1",children:[!e.is_default&&d.jsx(Mt,{variant:"ghost",size:"icon",onClick:()=>n(e.id),disabled:o,title:i("address.setAsDefault"),children:d.jsx(Al,{className:"w-4 h-4"})}),d.jsx(Mt,{variant:"ghost",size:"icon",onClick:()=>t(e),title:i("common.edit"),children:d.jsx(b2,{className:"w-4 h-4"})}),h&&d.jsxs(ko,{children:[d.jsx(gb,{asChild:!0,children:d.jsx(Mt,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",title:i("common.delete"),children:d.jsx(Yh,{className:"w-4 h-4"})})}),d.jsxs(co,{children:[d.jsxs(uo,{children:[d.jsx(fo,{children:i("address.deleteTitle")}),d.jsx(po,{children:i("address.deleteDescription")})]}),d.jsxs(ho,{children:[d.jsx(mo,{children:i("common.cancel")}),d.jsx(to,{onClick:()=>r(e.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:s,children:i(s?"common.deleting":"common.delete")})]})]})]})]})]})})},uW=()=>{const{t:e}=ci(),{data:t,isLoading:r}=cIe(),{data:n}=CN(),s=uIe(),o=dIe(),h=Xne(),i=hIe(),m=fIe(),[y,S]=V.useState(!1),[b,T]=V.useState(null),[A,O]=V.useState(null),[P,I]=V.useState(!1),R=!(n!=null&&n.phone),M=ee=>{if(R&&ee.phone){O(ee),I(!0);return}s.mutate(ee,{onSuccess:()=>S(!1)})},F=()=>{if(!A)return;const ee=`${A.phone_code||"+351"} ${A.phone}`;h.mutate({phone:ee}),s.mutate(A,{onSuccess:()=>{S(!1),O(null),I(!1)}})},z=()=>{O(null),I(!1)},$=ee=>{b&&o.mutate({id:b.id,address:ee},{onSuccess:()=>T(null)})},W=ee=>{i.mutate(ee)},K=ee=>{m.mutate(ee)};return r?d.jsxs(Nr,{children:[d.jsx(Rn,{children:d.jsxs($n,{className:"flex items-center gap-2",children:[d.jsx(Pa,{className:"w-5 h-5"}),e("address.myAddresses")]})}),d.jsx(Mr,{children:d.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e("common.loading")})})]}):d.jsxs(Nr,{children:[d.jsx(Rn,{children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsxs($n,{className:"flex items-center gap-2",children:[d.jsx(Pa,{className:"w-5 h-5"}),e("address.myAddresses")]}),d.jsx(as,{children:e("address.manageDescription")})]}),d.jsxs(fl,{open:y,onOpenChange:S,children:[d.jsx(tf,{asChild:!0,children:d.jsxs(Mt,{size:"sm",children:[d.jsx(sp,{className:"w-4 h-4 mr-2"}),e("address.addNew")]})}),d.jsxs(Jo,{className:"sm:max-w-[500px]",children:[d.jsxs(Qo,{children:[d.jsx(el,{children:e("address.addNew")}),d.jsx(Ul,{children:e("address.addDescription")})]}),d.jsx(cW,{onSubmit:M,onCancel:()=>S(!1),isLoading:s.isPending})]})]})]})}),d.jsx(Mr,{children:t&&t.length>0?d.jsx("div",{className:"space-y-4",children:t.map(ee=>d.jsx(gIe,{address:ee,onEdit:T,onDelete:W,onSetDefault:K,isDeleting:i.isPending,isSettingDefault:m.isPending,canDelete:t.length>1},ee.id))}):d.jsxs("div",{className:"text-center py-8",children:[d.jsx(Pa,{className:"w-12 h-12 mx-auto text-muted-foreground/50 mb-4"}),d.jsx("p",{className:"text-muted-foreground mb-4",children:e("address.noAddresses")}),d.jsxs(Mt,{onClick:()=>S(!0),children:[d.jsx(sp,{className:"w-4 h-4 mr-2"}),e("address.addFirst")]})]})}),d.jsx(fl,{open:!!b,onOpenChange:()=>T(null),children:d.jsxs(Jo,{className:"sm:max-w-[500px]",children:[d.jsxs(Qo,{children:[d.jsx(el,{children:e("address.editAddress")}),d.jsx(Ul,{children:e("address.editDescription")})]}),b&&d.jsx(cW,{initialData:b,onSubmit:$,onCancel:()=>T(null),isLoading:o.isPending,isEdit:!0})]})}),d.jsx(ko,{open:P,onOpenChange:I,children:d.jsxs(co,{children:[d.jsxs(uo,{children:[d.jsx(fo,{children:e("address.phoneConfirmTitle")}),d.jsx(po,{children:e("address.phoneConfirmDescription")})]}),d.jsxs(ho,{children:[d.jsx(mo,{onClick:z,children:e("common.cancel")}),d.jsx(to,{onClick:F,disabled:s.isPending||h.isPending,children:s.isPending||h.isPending?e("common.saving"):e("common.confirm")})]})]})})]})};var GN="Switch",[yIe,mst]=Mo(GN),[vIe,_Ie]=yIe(GN),toe=V.forwardRef((e,t)=>{const{__scopeSwitch:r,name:n,checked:s,defaultChecked:o,required:h,disabled:i,value:m="on",onCheckedChange:y,form:S,...b}=e,[T,A]=V.useState(null),O=Un(t,F=>A(F)),P=V.useRef(!1),I=T?S||!!T.closest("form"):!0,[R,M]=Zc({prop:s,defaultProp:o??!1,onChange:y,caller:GN});return d.jsxs(vIe,{scope:r,checked:R,disabled:i,children:[d.jsx(ln.button,{type:"button",role:"switch","aria-checked":R,"aria-required":h,"data-state":soe(R),"data-disabled":i?"":void 0,disabled:i,value:m,...b,ref:O,onClick:Ir(e.onClick,F=>{M(z=>!z),I&&(P.current=F.isPropagationStopped(),P.current||F.stopPropagation())})}),I&&d.jsx(ioe,{control:T,bubbles:!P.current,name:n,value:m,checked:R,required:h,disabled:i,form:S,style:{transform:"translateX(-100%)"}})]})});toe.displayName=GN;var roe="SwitchThumb",noe=V.forwardRef((e,t)=>{const{__scopeSwitch:r,...n}=e,s=_Ie(roe,r);return d.jsx(ln.span,{"data-state":soe(s.checked),"data-disabled":s.disabled?"":void 0,...n,ref:t})});noe.displayName=roe;var xIe="SwitchBubbleInput",ioe=V.forwardRef(({__scopeSwitch:e,control:t,checked:r,bubbles:n=!0,...s},o)=>{const h=V.useRef(null),i=Un(h,o),m=L2(r),y=S2(t);return V.useEffect(()=>{const S=h.current;if(!S)return;const b=window.HTMLInputElement.prototype,A=Object.getOwnPropertyDescriptor(b,"checked").set;if(m!==r&&A){const O=new Event("click",{bubbles:n});A.call(S,r),S.dispatchEvent(O)}},[m,r,n]),d.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...s,tabIndex:-1,ref:i,style:{...s.style,...y,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});ioe.displayName=xIe;function soe(e){return e?"checked":"unchecked"}var aoe=toe,bIe=noe;const wb=V.forwardRef(({className:e,...t},r)=>d.jsx(aoe,{className:fr("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e),...t,ref:r,children:d.jsx(bIe,{className:fr("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));wb.displayName=aoe.displayName;const dW=({isAgreed:e,agreedAt:t})=>{const{t:r,i18n:n}=ci(),{data:s,isLoading:o}=X5(),h=cCe(),[i,m]=V.useState(null),y=async T=>{m(T);try{await h.mutateAsync(T),Po({title:r("common.success"),description:r(T?"profile.activityTermsAgreed":"profile.activityTermsRevoked")})}catch{Po({title:r("common.error"),description:r("profile.activityTermsUpdateFailed"),variant:"destructive"})}finally{m(null)}},S=()=>{if(!s)return"";const T=n.language;return T==="zh"?s.content_zh:T==="pt"?s.content_pt:s.content_en},b=i!==null?i:e;return d.jsxs(Nr,{children:[d.jsxs(Rn,{className:"pb-3",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(rb,{className:"w-5 h-5 text-primary"}),d.jsx($n,{className:"text-lg",children:r("profile.activityTermsTitle")})]}),e?d.jsxs(sn,{className:"bg-green-500/10 text-green-600 hover:bg-green-500/20",children:[d.jsx(ip,{className:"w-3 h-3 mr-1"}),r("profile.activityTermsAgreedStatus")]}):d.jsxs(sn,{variant:"secondary",className:"bg-amber-500/10 text-amber-600",children:[d.jsx(eN,{className:"w-3 h-3 mr-1"}),r("profile.activityTermsNotAgreed")]})]}),d.jsx(as,{children:r("profile.activityTermsDescription")})]}),d.jsx(Mr,{className:"space-y-4",children:o?d.jsx("div",{className:"flex justify-center py-4",children:d.jsx(_a,{className:"w-5 h-5 animate-spin text-primary"})}):d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"rounded-lg border bg-muted/30 p-4 max-h-48 overflow-y-auto",children:d.jsx("div",{className:`prose prose-sm dark:prose-invert max-w-none text-sm\r
                  [&_h1]:text-base [&_h1]:font-bold [&_h1]:mb-2\r
                  [&_h2]:text-sm [&_h2]:font-semibold [&_h2]:mb-2\r
                  [&_p]:mb-2 [&_p]:text-muted-foreground\r
                  [&_ul]:list-disc [&_ul]:ml-4 [&_ul]:mb-2\r
                  [&_li]:mb-0.5`,dangerouslySetInnerHTML:{__html:S()}})}),d.jsx(Gae,{children:d.jsxs(Mt,{variant:"outline",size:"sm",className:"w-full",children:[d.jsx(rb,{className:"w-4 h-4 mr-2"}),r("profile.viewFullRules")]})}),d.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[d.jsxs("div",{className:"flex-1",children:[d.jsx("p",{className:"font-medium text-sm",children:r("profile.agreeToTerms")}),t&&e&&d.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[r("profile.agreedOn"),": ",wg(new Date(t),{addSuffix:!0})]})]}),d.jsx(wb,{checked:b,onCheckedChange:y,disabled:h.isPending})]})]})})]})},BF=V.memo(({comment:e,getLocalizedField:t})=>d.jsxs(ji,{to:`/${e.target_type}/${e.target_id}`,className:"block p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[d.jsxs("div",{className:"flex items-start justify-between mb-2 gap-2",children:[d.jsx("h3",{className:"font-semibold text-card-foreground text-sm md:text-base line-clamp-1 flex-1",children:t(e,"target_name")}),d.jsx("span",{className:"text-xs md:text-sm text-muted-foreground whitespace-nowrap",children:wg(new Date(e.created_at),{addSuffix:!0})})]}),d.jsx("p",{className:"text-muted-foreground line-clamp-2 text-sm md:text-base",children:e.content}),e.image_url&&d.jsx("img",{src:e.image_url,alt:"Comment",className:"mt-2 rounded-lg max-w-full md:max-w-xs",loading:"lazy"})]}));BF.displayName="CommentItem";const $F=V.memo(({restaurant:e,getLocalizedField:t})=>d.jsxs(ji,{to:`/restaurant/${e.id}`,className:"flex gap-3 md:gap-4 p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[d.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-lg overflow-hidden bg-secondary/30 flex-shrink-0",children:d.jsx("img",{src:e.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80",alt:String(t(e,"name")),className:"w-full h-full object-cover",loading:"lazy",onError:r=>{r.currentTarget.src="https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80"}})}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsx("h3",{className:"font-semibold text-base md:text-lg text-card-foreground line-clamp-1",children:t(e,"name")}),d.jsx("p",{className:"text-muted-foreground text-sm mb-2 line-clamp-1",children:t(e,"type")}),d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx(Al,{className:"w-4 h-4 fill-accent text-accent"}),d.jsx("span",{className:"font-medium",children:e.rating||0})]})]})]}));$F.displayName="FavoriteRestaurantItem";const vE=V.memo(({subscription:e,getLocalizedField:t,t:r,isMobile:n})=>{var s;return d.jsx(ji,{to:`/activity/${e.activity_id}`,className:`block rounded-lg border hover:shadow-medium transition-shadow ${n?"p-3":"p-4"}`,children:d.jsxs("div",{className:`flex items-start ${n?"gap-3":"gap-4"}`,children:[((s=e.activity)==null?void 0:s.image_url)&&d.jsx("img",{src:e.activity.image_url,alt:String(t(e.activity,"title")),className:`rounded-lg object-cover flex-shrink-0 ${n?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${n?"text-sm":""}`,children:t(e.activity,"title")}),d.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none ${n?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:t(e.activity,"content")}}),d.jsxs("p",{className:"text-muted-foreground mt-2 text-xs",children:[r("profile.joinedOn"),":"," ",wg(new Date(e.created_at),{addSuffix:!0})]})]}),d.jsx(yo,{className:`text-primary flex-shrink-0 ${n?"w-4 h-4":"w-5 h-5"}`})]})})});vE.displayName="ActivitySubscriptionItem";const UF=V.memo(({activityGroup:e,getLocalizedField:t,t:r,isMobile:n})=>{const s=e.activity,o=e.restaurants;return d.jsxs("div",{className:`rounded-lg border hover:shadow-medium transition-shadow ${n?"p-3":"p-4"}`,children:[d.jsx(ji,{to:`/activity/${s.id}`,className:n?"block mb-2":"block mb-3",children:d.jsxs("div",{className:`flex items-start ${n?"gap-3":"gap-4"}`,children:[s.image_url&&d.jsx("img",{src:s.image_url,alt:String(t(s,"title")),className:`rounded-lg object-cover flex-shrink-0 ${n?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${n?"text-sm":""}`,children:t(s,"title")}),d.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none mb-2 ${n?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:t(s,"content")}}),d.jsxs("div",{className:"flex items-center gap-2 md:gap-4 text-xs text-muted-foreground flex-wrap",children:[d.jsxs("span",{className:"flex items-center gap-1",children:[d.jsx(yo,{className:"w-3 h-3"}),new Date(s.start_date).toLocaleDateString()]}),s.end_date&&d.jsxs("span",{children:["- ",new Date(s.end_date).toLocaleDateString()]})]})]})]})}),d.jsxs("div",{className:`pt-2 md:pt-3 border-t ${n?"mt-2":"mt-3"}`,children:[d.jsxs("div",{className:`flex items-center gap-2 ${n?"mb-1.5":"mb-2"}`,children:[d.jsx(Io,{className:`text-primary ${n?"w-3.5 h-3.5":"w-4 h-4"}`}),d.jsxs("span",{className:`font-medium text-foreground ${n?"text-xs":"text-sm"}`,children:[r("profile.participatingRestaurants")," (",o.length,")"]})]}),d.jsx("div",{className:`flex flex-wrap ${n?"gap-1.5":"gap-2"}`,children:o.map(h=>d.jsx(sn,{variant:"secondary",className:n?"text-xs px-2 py-0.5":"text-xs",children:t(h,"name")},h.id))})]})]})});UF.displayName="MerchantActivityItem";const VF=V.memo(({coupon:e,getLocalizedField:t,t:r,isMobile:n})=>{var i,m;const s=(i=e.coupon_codes)==null?void 0:i.coupon_templates,o=(m=e.coupon_codes)==null?void 0:m.code,h=!!e.used_at;return d.jsxs("div",{className:`rounded-lg border transition-shadow ${h?"bg-muted/30":"hover:shadow-medium"} ${n?"p-3":"p-4"}`,children:[d.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${n?"text-sm":"text-base"}`,children:t(s,"title")}),d.jsx("p",{className:`text-muted-foreground line-clamp-2 ${n?"text-xs":"text-sm"}`,children:t(s,"description")})]}),d.jsx(sn,{variant:h?"secondary":"default",className:n?"text-xs":"",children:r(h?"profile.coupons.used":"profile.coupons.available")})]}),d.jsxs("div",{className:`flex items-center gap-2 mb-2 ${n?"text-xs":"text-sm"}`,children:[d.jsx("span",{className:"font-mono bg-secondary/50 px-2 py-1 rounded",children:o}),d.jsx("span",{className:"text-muted-foreground",children:(s==null?void 0:s.discount_type)==="percentage"?`${s==null?void 0:s.discount_value}%`:`${s==null?void 0:s.discount_value}`})]}),d.jsx("div",{className:`text-muted-foreground ${n?"text-xs":"text-sm"}`,children:h?d.jsxs("span",{children:[r("profile.coupons.usedOn"),": ",ps(new Date(e.used_at),"yyyy-MM-dd HH:mm")]}):s!=null&&s.valid_until?d.jsxs("span",{children:[r("profile.coupons.validUntil"),": ",ps(new Date(s.valid_until),"yyyy-MM-dd")]}):d.jsx("span",{children:r("profile.coupons.noExpiry")})})]})});VF.displayName="UserCouponItem";const wIe=()=>{var re,te;const{t:e}=ci(),{user:t}=Kn(),r=VN(),{data:n,isLoading:s}=CN(),{data:o,isLoading:h}=nIe(),{data:i,isLoading:m}=iIe(),{data:y,isLoading:S}=O5(),{data:b,isLoading:T}=sIe(),{data:A,isLoading:O}=fNe(),{role:P,isMerchant:I,isSupervisor:R}=_c(),{getLocalizedField:M}=xc(),F=I||R,[z,$]=V.useState("profile"),[W,K]=V.useState(),ee=[{value:"profile",label:e("profile.profile"),icon:T0},{value:"favorites",label:e("profile.favorites"),icon:HP},{value:"comments",label:e("profile.comments"),icon:GP},{value:"activities",label:e("profile.activities"),icon:yo}];V.useEffect(()=>{W&&W.on("select",()=>{const ae=W.selectedScrollSnap();$(ee[ae].value)})},[W]);const ne=ae=>{const ue=ee.findIndex(be=>be.value===ae);ue!==-1&&W&&W.scrollTo(ue),$(ae)};if(!t||s)return d.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4",children:d.jsx("div",{className:"container mx-auto max-w-6xl",children:d.jsx("div",{className:"text-center",children:e("common.loading")})})});const ie=e(P?`profile.role.${P}`:"profile.role.user");return d.jsx("div",{className:`min-h-screen bg-secondary/20 ${r?"pb-20 pt-4":"py-4 md:py-8 px-3 md:px-4"}`,children:d.jsxs("div",{className:`container mx-auto max-w-6xl ${r?"px-3":""}`,children:[!r&&d.jsxs(d.Fragment,{children:[d.jsx(Nr,{className:"mb-6 md:mb-8",children:d.jsx(Mr,{className:"pt-4 md:pt-6 pb-4 md:pb-6",children:d.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-4 md:gap-6",children:[d.jsxs(Ju,{className:"w-24 h-24",children:[d.jsx(Qu,{src:(n==null?void 0:n.avatar_url)||""}),d.jsx(ed,{className:"text-3xl",children:((re=n==null?void 0:n.display_name)==null?void 0:re.charAt(0).toUpperCase())||"U"})]}),d.jsxs("div",{className:"flex-1 text-center md:text-left",children:[d.jsx("h1",{className:"text-3xl font-bold mb-2 text-foreground",children:n==null?void 0:n.display_name}),d.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:t.email}),(n==null?void 0:n.phone)&&d.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:n.phone}),P&&P!=="user"&&d.jsx(sn,{className:"bg-primary capitalize",children:ie})]}),n&&d.jsx(lW,{profile:n})]})})}),F&&d.jsx(dW,{isAgreed:(n==null?void 0:n.activity_terms_agreed)||!1,agreedAt:(n==null?void 0:n.activity_terms_agreed_at)||null})]}),r?d.jsxs(d.Fragment,{children:[d.jsx(Jae,{setApi:K,opts:{align:"start",loop:!1},className:"w-full",children:d.jsxs(Qae,{className:"-ml-0",children:[d.jsx(yE,{className:"pl-0",children:d.jsxs("div",{className:"pb-4 space-y-4",children:[d.jsx(Nr,{children:d.jsx(Mr,{className:"pt-6 pb-6",children:d.jsxs("div",{className:"flex flex-col items-center gap-4",children:[d.jsxs(Ju,{className:"w-20 h-20",children:[d.jsx(Qu,{src:(n==null?void 0:n.avatar_url)||""}),d.jsx(ed,{className:"text-2xl",children:((te=n==null?void 0:n.display_name)==null?void 0:te.charAt(0).toUpperCase())||"U"})]}),d.jsxs("div",{className:"flex-1 text-center w-full",children:[d.jsx("h1",{className:"text-2xl font-bold mb-2 text-foreground",children:n==null?void 0:n.display_name}),d.jsx("p",{className:"text-muted-foreground text-sm mb-2",children:t.email}),(n==null?void 0:n.phone)&&d.jsx("p",{className:"text-muted-foreground text-sm mb-3",children:n.phone}),P&&P!=="user"&&d.jsx(sn,{className:"bg-primary capitalize text-xs mb-4",children:ie}),n&&d.jsx("div",{className:"mt-4",children:d.jsx(lW,{profile:n})})]})]})})}),F&&d.jsx(dW,{isAgreed:(n==null?void 0:n.activity_terms_agreed)||!1,agreedAt:(n==null?void 0:n.activity_terms_agreed_at)||null}),d.jsxs(Nr,{children:[d.jsxs(Rn,{className:"pb-3",children:[d.jsxs($n,{className:"text-lg flex items-center gap-2",children:[d.jsx(wv,{className:"w-5 h-5"}),e("profile.coupons.title")]}),d.jsx(as,{className:"text-xs",children:e("profile.coupons.description")})]}),d.jsx(Mr,{className:"px-3",children:O?d.jsx("div",{className:"text-center py-8 text-sm",children:e("common.loading")}):A&&A.length>0?d.jsx("div",{className:"space-y-3",children:A.map(ae=>d.jsx(VF,{coupon:ae,getLocalizedField:M,t:e,isMobile:!0},ae.id))}):d.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[e("profile.coupons.noCoupons")," ",d.jsx(ji,{to:"/activities",className:"text-primary hover:underline",children:e("profile.coupons.browseActivities")})]})})]}),d.jsx(uW,{})]})}),d.jsx(yE,{className:"pl-0",children:d.jsx("div",{className:"pb-4",children:d.jsxs(Nr,{children:[d.jsxs(Rn,{className:"pb-3",children:[d.jsx($n,{className:"text-lg",children:e("profile.favoriteRestaurants")}),d.jsx(as,{className:"text-xs",children:e("profile.favoritesDesc")})]}),d.jsx(Mr,{className:"px-3",children:h?d.jsx("div",{className:"text-center py-8 text-sm",children:e("common.loading")}):o&&o.length>0?d.jsx("div",{className:"grid gap-3 grid-cols-1",children:o.map(ae=>d.jsx($F,{restaurant:ae,getLocalizedField:M},ae.id))}):d.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:e("profile.noFavorites")})})]})})}),d.jsx(yE,{className:"pl-0",children:d.jsx("div",{className:"pb-4",children:d.jsxs(Nr,{children:[d.jsxs(Rn,{className:"pb-3",children:[d.jsx($n,{className:"text-lg",children:e("profile.myComments")}),d.jsx(as,{className:"text-xs",children:e("profile.commentsDesc")})]}),d.jsx(Mr,{className:"space-y-3 px-3",children:m?d.jsx("div",{className:"text-center py-8 text-sm",children:e("common.loading")}):i&&i.length>0?i.map(ae=>d.jsx(BF,{comment:ae,getLocalizedField:M},ae.id)):d.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:e("profile.noComments")})})]})})}),d.jsx(yE,{className:"pl-0",children:d.jsx("div",{className:"pb-4",children:d.jsxs(Nr,{children:[d.jsxs(Rn,{className:"pb-3",children:[d.jsx($n,{className:"text-lg",children:e(F?"profile.participatedActivities":"profile.joinedActivities")}),d.jsx(as,{className:"text-xs",children:e(F?"profile.participatedActivitiesDesc":"profile.activitiesDesc")})]}),d.jsx(Mr,{className:"px-3",children:F?d.jsxs("div",{className:"space-y-4",children:[S?d.jsx("div",{className:"text-center py-8 text-sm",children:e("common.loading")}):y&&y.length>0?d.jsxs("div",{children:[d.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2 text-base",children:[d.jsx(Bc,{className:"w-4 h-4"}),e("profile.personalActivities")]}),d.jsx("div",{className:"space-y-3",children:y.map(ae=>d.jsx(vE,{subscription:ae,getLocalizedField:M,t:e,isMobile:!0},ae.activity_id))})]}):null,T?d.jsx("div",{className:"text-center py-8 text-sm",children:e("common.loading")}):b&&b.length>0?d.jsxs("div",{children:[d.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2 text-base",children:[d.jsx(Io,{className:"w-4 h-4"}),e("profile.restaurantActivities")]}),d.jsx("div",{className:"space-y-3",children:(()=>{const ae=b.reduce((ue,be)=>{const we=be.activity_id;return ue[we]||(ue[we]={activity:be.activity,restaurants:[],participationDate:be.created_at}),ue[we].restaurants.push({id:be.restaurant_id,name:be.restaurant_name,name_en:be.restaurant_name_en,name_pt:be.restaurant_name_pt}),ue},{});return Object.values(ae).map(ue=>d.jsx(UF,{activityGroup:ue,getLocalizedField:M,t:e,isMobile:!0},ue.activity.id))})()})]}):null,(!y||y.length===0)&&(!b||b.length===0)&&d.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[e("profile.noParticipatedActivities")," ",d.jsx(ji,{to:"/activities",className:"text-primary hover:underline",children:e("profile.browseActivities")})]})]}):S?d.jsx("div",{className:"text-center py-8 text-sm",children:e("common.loading")}):y&&y.length>0?d.jsx("div",{className:"space-y-3",children:y.map(ae=>d.jsx(vE,{subscription:ae,getLocalizedField:M,t:e,isMobile:!0},ae.activity_id))}):d.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[e("profile.noActivities")," ",d.jsx(ji,{to:"/activities",className:"text-primary hover:underline",children:e("profile.upcomingEvents")})]})})]})})})]})}),d.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-background border-t z-50",children:d.jsx("div",{className:"flex justify-around items-center py-2 px-2",children:ee.map(ae=>{const ue=ae.icon;return d.jsxs("button",{onClick:()=>ne(ae.value),className:`flex flex-col items-center gap-1 py-2 px-3 rounded-lg transition-all ${z===ae.value?"text-primary":"text-muted-foreground"}`,children:[d.jsx(ue,{className:`${z===ae.value?"w-6 h-6":"w-5 h-5"}`}),d.jsx("span",{className:"text-xs font-medium",children:ae.label})]},ae.value)})})})]}):d.jsxs(Mv,{defaultValue:"favorites",className:"space-y-4 md:space-y-6",children:[d.jsxs(pg,{className:"grid w-full grid-cols-5",children:[d.jsxs(Ca,{value:"favorites",children:[d.jsx(HP,{className:"w-4 h-4 mr-2"}),e("profile.favorites")]}),d.jsxs(Ca,{value:"comments",children:[d.jsx(GP,{className:"w-4 h-4 mr-2"}),e("profile.comments")]}),d.jsxs(Ca,{value:"activities",children:[d.jsx(yo,{className:"w-4 h-4 mr-2"}),e("profile.activities")]}),d.jsxs(Ca,{value:"coupons",children:[d.jsx(wv,{className:"w-4 h-4 mr-2"}),e("profile.coupons.title")]}),d.jsxs(Ca,{value:"addresses",children:[d.jsx(Pa,{className:"w-4 h-4 mr-2"}),e("address.myAddresses")]})]}),d.jsx(ja,{value:"favorites",className:"space-y-4",children:d.jsxs(Nr,{children:[d.jsxs(Rn,{className:r?"pb-3":"",children:[d.jsx($n,{className:r?"text-lg":"",children:e("profile.favoriteRestaurants")}),d.jsx(as,{className:r?"text-xs":"",children:e("profile.favoritesDesc")})]}),d.jsx(Mr,{className:r?"px-3":"",children:h?d.jsx("div",{className:`text-center py-8 ${r?"text-sm":""}`,children:e("common.loading")}):o&&o.length>0?d.jsx("div",{className:`grid gap-3 md:gap-4 ${r?"grid-cols-1":"md:grid-cols-2"}`,children:o.map(ae=>d.jsx($F,{restaurant:ae,getLocalizedField:M},ae.id))}):d.jsx("p",{className:`text-muted-foreground text-center py-8 ${r?"text-sm":""}`,children:e("profile.noFavorites")})})]})}),d.jsx(ja,{value:"comments",children:d.jsxs(Nr,{children:[d.jsxs(Rn,{className:r?"pb-3":"",children:[d.jsx($n,{className:r?"text-lg":"",children:e("profile.myComments")}),d.jsx(as,{className:r?"text-xs":"",children:e("profile.commentsDesc")})]}),d.jsx(Mr,{className:`space-y-3 md:space-y-4 ${r?"px-3":""}`,children:m?d.jsx("div",{className:`text-center py-8 ${r?"text-sm":""}`,children:e("common.loading")}):i&&i.length>0?i.map(ae=>d.jsx(BF,{comment:ae,getLocalizedField:M},ae.id)):d.jsx("p",{className:`text-muted-foreground text-center py-8 ${r?"text-sm":""}`,children:e("profile.noComments")})})]})}),d.jsx(ja,{value:"activities",children:d.jsxs(Nr,{children:[d.jsxs(Rn,{className:r?"pb-3":"",children:[d.jsx($n,{className:r?"text-lg":"",children:e(F?"profile.participatedActivities":"profile.joinedActivities")}),d.jsx(as,{className:r?"text-xs":"",children:e(F?"profile.participatedActivitiesDesc":"profile.activitiesDesc")})]}),d.jsx(Mr,{className:r?"px-3":"",children:F?d.jsxs("div",{className:r?"space-y-4":"space-y-6",children:[S?d.jsx("div",{className:`text-center py-8 ${r?"text-sm":""}`,children:e("common.loading")}):y&&y.length>0?d.jsxs("div",{children:[d.jsxs("h3",{className:`font-semibold mb-3 md:mb-4 flex items-center gap-2 ${r?"text-base":"text-lg"}`,children:[d.jsx(Bc,{className:r?"w-4 h-4":"w-5 h-5"}),e("profile.personalActivities")]}),d.jsx("div",{className:r?"space-y-3":"space-y-4",children:y.map(ae=>d.jsx(vE,{subscription:ae,getLocalizedField:M,t:e,isMobile:r},ae.activity_id))})]}):null,T?d.jsx("div",{className:`text-center py-8 ${r?"text-sm":""}`,children:e("common.loading")}):b&&b.length>0?d.jsxs("div",{children:[d.jsxs("h3",{className:`font-semibold mb-3 md:mb-4 flex items-center gap-2 ${r?"text-base":"text-lg"}`,children:[d.jsx(Io,{className:r?"w-4 h-4":"w-5 h-5"}),e("profile.restaurantActivities")]}),d.jsx("div",{className:r?"space-y-3":"space-y-4",children:(()=>{const ae=b.reduce((ue,be)=>{const we=be.activity_id;return ue[we]||(ue[we]={activity:be.activity,restaurants:[],participationDate:be.created_at}),ue[we].restaurants.push({id:be.restaurant_id,name:be.restaurant_name,name_en:be.restaurant_name_en,name_pt:be.restaurant_name_pt}),ue},{});return Object.values(ae).map(ue=>d.jsx(UF,{activityGroup:ue,getLocalizedField:M,t:e,isMobile:r},ue.activity.id))})()})]}):null,(!y||y.length===0)&&(!b||b.length===0)&&d.jsxs("p",{className:`text-muted-foreground text-center py-8 ${r?"text-sm":""}`,children:[e("profile.noParticipatedActivities")," ",d.jsx(ji,{to:"/activities",className:"text-primary hover:underline",children:e("profile.browseActivities")})]})]}):S?d.jsx("div",{className:`text-center py-8 ${r?"text-sm":""}`,children:e("common.loading")}):y&&y.length>0?d.jsx("div",{className:r?"space-y-3":"space-y-4",children:y.map(ae=>d.jsx(vE,{subscription:ae,getLocalizedField:M,t:e,isMobile:r},ae.activity_id))}):d.jsxs("p",{className:`text-muted-foreground text-center py-8 ${r?"text-sm":""}`,children:[e("profile.noActivities")," ",d.jsx(ji,{to:"/activities",className:"text-primary hover:underline",children:e("profile.upcomingEvents")})]})})]})}),d.jsx(ja,{value:"coupons",children:d.jsxs(Nr,{children:[d.jsxs(Rn,{className:r?"pb-3":"",children:[d.jsx($n,{className:r?"text-lg":"",children:e("profile.coupons.title")}),d.jsx(as,{className:r?"text-xs":"",children:e("profile.coupons.description")})]}),d.jsx(Mr,{className:r?"px-3":"",children:O?d.jsx("div",{className:`text-center py-8 ${r?"text-sm":""}`,children:e("common.loading")}):A&&A.length>0?d.jsx("div",{className:`grid gap-3 md:gap-4 ${r?"grid-cols-1":"md:grid-cols-2"}`,children:A.map(ae=>d.jsx(VF,{coupon:ae,getLocalizedField:M,t:e,isMobile:r},ae.id))}):d.jsxs("p",{className:`text-muted-foreground text-center py-8 ${r?"text-sm":""}`,children:[e("profile.coupons.noCoupons")," ",d.jsx(ji,{to:"/activities",className:"text-primary hover:underline",children:e("profile.coupons.browseActivities")})]})})]})}),d.jsx(ja,{value:"addresses",children:d.jsx(uW,{})})]})]})})},r$=rke,ooe=V.createContext({}),Ki=({...e})=>d.jsx(ooe.Provider,{value:{name:e.name},children:d.jsx(ym,{...e})}),WN=()=>{const e=V.useContext(ooe),t=V.useContext(loe),{getFieldState:r,formState:n}=BN(),s=r(e.name,n);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:o}=t;return{id:o,name:e.name,formItemId:`${o}-form-item`,formDescriptionId:`${o}-form-item-description`,formMessageId:`${o}-form-item-message`,...s}},loe=V.createContext({}),Hi=V.forwardRef(({className:e,...t},r)=>{const n=V.useId();return d.jsx(loe.Provider,{value:{id:n},children:d.jsx("div",{ref:r,className:fr("space-y-2",e),...t})})});Hi.displayName="FormItem";const Xi=V.forwardRef(({className:e,...t},r)=>{const{error:n,formItemId:s}=WN();return d.jsx(yr,{ref:r,className:fr(n&&"text-destructive",e),htmlFor:s,...t})});Xi.displayName="FormLabel";const Zi=V.forwardRef(({...e},t)=>{const{error:r,formItemId:n,formDescriptionId:s,formMessageId:o}=WN();return d.jsx(Hv,{ref:t,id:n,"aria-describedby":r?`${s} ${o}`:`${s}`,"aria-invalid":!!r,...e})});Zi.displayName="FormControl";const Om=V.forwardRef(({className:e,...t},r)=>{const{formDescriptionId:n}=WN();return d.jsx("p",{ref:r,id:n,className:fr("text-sm text-muted-foreground",e),...t})});Om.displayName="FormDescription";const ss=V.forwardRef(({className:e,children:t,...r},n)=>{const{error:s,formMessageId:o}=WN(),h=s?String(s==null?void 0:s.message):t;return h?d.jsx("p",{ref:n,id:o,className:fr("text-sm font-medium text-destructive",e),...r,children:h}):null});ss.displayName="FormMessage";const hW=["booking","delivery","qrcode"],SIe=()=>{const{t:e}=ci(),[t,r]=V.useState(!1),[n,s]=V.useState(!1),o=V.useMemo(()=>jh({name:bn().min(2,{message:e("joinUs.nameMin")}),email:bn().email({message:e("joinUs.emailInvalid")}),phone:bn().min(6,{message:e("joinUs.phoneMin")}),restaurant_name:bn().min(2,{message:e("joinUs.restaurantNameMin")}),restaurant_address:bn().min(2,{message:e("joinUs.addressMin")}),features_selected:pP(ST(hW)).min(1,{message:e("joinUs.featuresMin")})}),[e]),h=Ah({resolver:Ch(o),defaultValues:{name:"",email:"",phone:"",restaurant_name:"",restaurant_address:"",features_selected:[]}}),i=async m=>{r(!0);try{const{error:y}=await Ct.functions.invoke("send-join-request-email",{body:m});if(y){if(y.message.includes("rate_limit_exceeded"))Po({title:e("joinUs.rateLimitError"),description:e("joinUs.rateLimitErrorDesc"),variant:"destructive"});else throw y;return}s(!0),h.reset(),Po({title:e("joinUs.successTitle"),description:e("joinUs.successDescription")})}catch(y){console.error("Error submitting join request:",y),Po({title:e("common.error"),description:e("joinUs.submitError"),variant:"destructive"})}finally{r(!1)}};return n?d.jsx("div",{className:"min-h-screen pt-20 pb-12 px-4 bg-secondary/20",children:d.jsx("div",{className:"container mx-auto max-w-2xl",children:d.jsx(Nr,{className:"border-primary",children:d.jsxs(Mr,{className:"pt-12 pb-12 text-center",children:[d.jsx(UP,{className:"w-16 h-16 text-primary mx-auto mb-4"}),d.jsx("h2",{className:"text-2xl font-bold text-foreground mb-4",children:e("joinUs.successTitle")}),d.jsx("p",{className:"text-lg font-semibold text-foreground mb-2",children:e("joinUs.successDescription")}),d.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:e("joinUs.successMessage")}),d.jsx(Mt,{onClick:()=>s(!1),children:e("joinUs.submitAnother")})]})})})}):d.jsx("div",{className:"min-h-screen pt-20 pb-12 px-4 bg-secondary/20",children:d.jsx("div",{className:"container mx-auto max-w-3xl",children:d.jsxs(Nr,{children:[d.jsxs(Rn,{className:"text-center space-y-2",children:[d.jsx("div",{className:"flex justify-center mb-4",children:d.jsx(Io,{className:"w-12 h-12 text-primary"})}),d.jsx($n,{className:"text-3xl font-bold",children:e("joinUs.title")}),d.jsx(as,{className:"text-base",children:e("joinUs.description")})]}),d.jsx(Mr,{children:d.jsx(r$,{...h,children:d.jsxs("form",{onSubmit:h.handleSubmit(i),className:"space-y-6",children:[d.jsx(Ki,{control:h.control,name:"name",render:({field:m})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:e("joinUs.name")}),d.jsx(Zi,{children:d.jsx(cr,{placeholder:e("joinUs.namePlaceholder"),...m})}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:h.control,name:"email",render:({field:m})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:e("joinUs.email")}),d.jsx(Zi,{children:d.jsx(cr,{type:"email",placeholder:e("joinUs.emailPlaceholder"),...m})}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:h.control,name:"phone",render:({field:m})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:e("joinUs.phone")}),d.jsx(Zi,{children:d.jsx(cr,{type:"tel",placeholder:e("joinUs.phonePlaceholder"),...m})}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:h.control,name:"restaurant_name",render:({field:m})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:e("joinUs.restaurantName")}),d.jsx(Zi,{children:d.jsx(cr,{placeholder:e("joinUs.restaurantNamePlaceholder"),...m})}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:h.control,name:"restaurant_address",render:({field:m})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:e("joinUs.restaurantAddress")}),d.jsx(Zi,{children:d.jsx(cr,{placeholder:e("joinUs.restaurantAddressPlaceholder"),...m})}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:h.control,name:"features_selected",render:()=>d.jsxs(Hi,{children:[d.jsxs("div",{className:"mb-4",children:[d.jsx(Xi,{children:e("joinUs.featuresNeeded")}),d.jsx(Om,{children:e("joinUs.featuresDescription")})]}),hW.map(m=>d.jsx(Ki,{control:h.control,name:"features_selected",render:({field:y})=>{var S;return d.jsxs(Hi,{className:"flex flex-row items-start space-x-3 space-y-0",children:[d.jsx(Zi,{children:d.jsx(Yo,{checked:(S=y.value)==null?void 0:S.includes(m),onCheckedChange:b=>{var T;return b?y.onChange([...y.value,m]):y.onChange((T=y.value)==null?void 0:T.filter(A=>A!==m))}})}),d.jsx(Xi,{className:"font-normal cursor-pointer",children:e(`joinUs.feature.${m}`)})]},m)}},m)),d.jsx(ss,{})]})}),d.jsx("div",{className:"text-xs text-muted-foreground text-center pb-4",children:e("joinUs.consentText")}),d.jsxs(Mt,{type:"submit",className:"w-full",size:"lg",disabled:t,children:[t&&d.jsx(_a,{className:"mr-2 h-4 w-4 animate-spin"}),e("joinUs.submit")]})]})})})]})})})},EIe=()=>{const e=Qh();return V.useEffect(()=>{},[e.pathname]),d.jsx("div",{className:"flex min-h-screen items-center justify-center bg-muted",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),d.jsx("p",{className:"mb-4 text-xl text-muted-foreground",children:"Oops! Page not found"}),d.jsx("a",{href:"/",className:"text-primary underline hover:text-primary/90",children:"Return to Home"})]})})},$2=async e=>{const{data:t}=await Ct.from("user_roles").select("role").eq("user_id",e).single();return t==null?void 0:t.role},TIe=()=>{const{user:e}=Kn();return ei({queryKey:["admin-users",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ct.from("profiles").select("*").order("created_at",{ascending:!1});if(r)throw r;const n=await Promise.all((t||[]).map(async o=>{const{data:h}=await Ct.from("user_roles").select("role").eq("user_id",o.id).single();return{...o,role:(h==null?void 0:h.role)||"user"}})),{data:s}=await Ct.from("user_roles").select("role").eq("user_id",e.id).single();if((s==null?void 0:s.role)==="supervisor"){const{data:o,error:h}=await Ct.from("merchant_restaurants").select("restaurant_id").eq("user_id",e.id);if(h)throw h;if(!o||o.length===0)return[];const i=o.map(O=>O.restaurant_id),{data:m,error:y}=await Ct.from("merchant_restaurants").select("user_id, restaurant_id").in("restaurant_id",i);if(y)throw y;if(!m||m.length===0)return[];const S=[...new Set(m.map(O=>O.user_id).filter(O=>O!==e.id))];if(S.length===0)return[];const{data:b,error:T}=await Ct.from("user_roles").select("user_id").in("user_id",S).eq("role","merchant");if(T)throw T;const A=(b==null?void 0:b.map(O=>O.user_id))||[];return n.filter(O=>A.includes(O.id))}return n}})},AIe=()=>{const{toast:e}=Ri(),t=Mi();return Gi({mutationFn:async({userId:r,role:n})=>{const{error:s}=await Ct.from("user_roles").upsert({user_id:r,role:n},{onConflict:"user_id"});if(s)throw s},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-users"]}),t.invalidateQueries({queryKey:["user-roles"]}),e({title:Pr.t("common.success"),description:Pr.t("toast.roleChanged")})},onError:r=>{console.error("Role change error:",r),e({title:Pr.t("common.error"),description:r.message||Pr.t("toast.roleChangeFailed"),variant:"destructive"})}})},CIe=()=>{const{user:e}=Kn();return ei({queryKey:["admin-restaurants",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];if(await $2(e.id)==="supervisor"){const{data:n,error:s}=await Ct.from("merchant_restaurants").select("restaurant_id").eq("user_id",e.id);if(s)throw s;const o=(n==null?void 0:n.map(m=>m.restaurant_id))||[];if(o.length===0)return[];const{data:h,error:i}=await Ct.from("restaurants").select("*").in("id",o).order("rating",{ascending:!1});if(i)throw i;return h||[]}else{const{data:n,error:s}=await Ct.from("restaurants").select("*").order("rating",{ascending:!1});if(s)throw s;return n||[]}},enabled:!!e})},jIe=()=>ei({queryKey:["operation-logs"],queryFn:async()=>{const{data:e,error:t}=await Ct.from("operation_logs").select("*").order("created_at",{ascending:!1}).limit(100);if(t)throw t;return await Promise.all((e||[]).map(async n=>{const{data:s}=await Ct.from("profiles").select("display_name").eq("id",n.user_id).single();return{...n,user_name:(s==null?void 0:s.display_name)||"Unknown User"}}))}}),PIe=()=>{const{toast:e}=Ri(),t=Mi();return Gi({mutationFn:async({userId:r,display_name:n,phone:s,avatar_url:o})=>{const{data:h,error:i}=await Ct.from("profiles").update({display_name:n,phone:s,avatar_url:o}).eq("id",r).select().single();if(i)throw i;return h},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-users"]}),e({title:Pr.t("common.success"),description:Pr.t("toast.profileUpdated")})},onError:()=>{e({title:Pr.t("common.error"),description:Pr.t("toast.profileUpdateFailed"),variant:"destructive"})}})},OIe=()=>{const{toast:e}=Ri();return Gi({mutationFn:async({file:t,userId:r})=>{const n=t.name.split(".").pop(),s=`${Date.now()}.${n}`,o=`${r}/${s}`,{error:h}=await Ct.storage.from("avatars").upload(o,t,{upsert:!0});if(h)throw h;const{data:{publicUrl:i}}=Ct.storage.from("avatars").getPublicUrl(o);return i},onError:()=>{e({title:Pr.t("common.error"),description:Pr.t("toast.avatarUploadFailed"),variant:"destructive"})}})},kIe=()=>{const{user:e}=Kn();return ei({queryKey:["admin-stats",e==null?void 0:e.id],queryFn:async()=>{if(!e)return{totalUsers:0,totalRestaurants:0,totalActivities:0,totalComments:0};if(await $2(e.id)==="supervisor"){const{data:i}=await Ct.from("merchant_restaurants").select("restaurant_id, user_id").eq("user_id",e.id),m=(i==null?void 0:i.map(A=>A.restaurant_id))||[],S=(Array.from(new Set(i==null?void 0:i.map(A=>A.user_id)))||[]).length,b=m.length;let T=0;if(m.length>0){const{count:A}=await Ct.from("comments").select("*",{count:"exact",head:!0}).eq("target_type","restaurant").in("target_id",m);T=A||0}return{totalUsers:S,totalRestaurants:b,totalActivities:0,totalComments:T}}const[n,s,o,h]=await Promise.all([Ct.from("profiles").select("*",{count:"exact",head:!0}),Ct.from("restaurants").select("*",{count:"exact",head:!0}),Ct.from("activities").select("*",{count:"exact",head:!0}),Ct.from("comments").select("*",{count:"exact",head:!0})]);return{totalUsers:n.count||0,totalRestaurants:s.count||0,totalActivities:o.count||0,totalComments:h.count||0}}})},NIe=()=>{const{user:e}=Kn();return ei({queryKey:["top-restaurants",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const r=await $2(e.id)==="supervisor";let n=Ct.from("restaurants").select("id, name, rating").order("rating",{ascending:!1,nullsFirst:!1}).limit(10);if(r){const{data:i}=await Ct.from("merchant_restaurants").select("restaurant_id").eq("user_id",e.id),m=(i==null?void 0:i.map(y=>y.restaurant_id))||[];if(m.length===0)return[];n=Ct.from("restaurants").select("id, name, rating").in("id",m).order("rating",{ascending:!1,nullsFirst:!1}).limit(10)}const{data:s,error:o}=await n;if(o)throw o;return await Promise.all((s||[]).map(async i=>{const{count:m}=await Ct.from("comments").select("*",{count:"exact",head:!0}).eq("target_id",i.id).eq("target_type","restaurant");return{name:i.name,rating:i.rating||0,comments:m||0}}))}})},IIe=()=>{const{user:e}=Kn();return ei({queryKey:["restaurant-rating-trends",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const r=await $2(e.id)==="supervisor";let n=[],s={};if(r){const{data:y}=await Ct.from("merchant_restaurants").select("restaurant_id").eq("user_id",e.id);n=(y==null?void 0:y.map(S=>S.restaurant_id))||[]}else{const{data:y}=await Ct.from("restaurants").select("id, name").order("rating",{ascending:!1,nullsFirst:!1}).limit(5);n=(y==null?void 0:y.map(S=>S.id))||[],y==null||y.forEach(S=>{s[S.id]=S.name})}if(n.length===0)return[];const{data:o}=await Ct.from("comments").select("target_id, rating_value, created_at").eq("target_type","restaurant").in("target_id",n).not("rating_value","is",null).order("created_at",{ascending:!0});if(!o||o.length===0)return[];if(Object.keys(s).length===0){const{data:y}=await Ct.from("restaurants").select("id, name").in("id",n);y==null||y.forEach(S=>{s[S.id]=S.name})}const h={};o.forEach(y=>{const S=new Date(y.created_at),b=`${S.getFullYear()}-${String(S.getMonth()+1).padStart(2,"0")}`;h[y.target_id]||(h[y.target_id]={}),h[y.target_id][b]||(h[y.target_id][b]={sum:0,count:0}),h[y.target_id][b].sum+=y.rating_value,h[y.target_id][b].count+=1});const i=new Set;return Object.values(h).forEach(y=>{Object.keys(y).forEach(S=>i.add(S))}),Array.from(i).sort().map(y=>{const S={month:y};return Object.keys(h).forEach(b=>{const T=h[b][y],A=T?(T.sum/T.count).toFixed(1):null;S[s[b]||b]=A}),S})}})},RIe=()=>{const{user:e}=Kn();return ei({queryKey:["restaurant-comment-trends",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const r=await $2(e.id)==="supervisor";let n=[],s={};if(r){const{data:y}=await Ct.from("merchant_restaurants").select("restaurant_id").eq("user_id",e.id);n=(y==null?void 0:y.map(S=>S.restaurant_id))||[]}else{const{data:y}=await Ct.from("restaurants").select("id, name").order("rating",{ascending:!1,nullsFirst:!1}).limit(5);n=(y==null?void 0:y.map(S=>S.id))||[],y==null||y.forEach(S=>{s[S.id]=S.name})}if(n.length===0)return[];const{data:o}=await Ct.from("comments").select("target_id, created_at").eq("target_type","restaurant").in("target_id",n).order("created_at",{ascending:!0});if(!o||o.length===0)return[];if(Object.keys(s).length===0){const{data:y}=await Ct.from("restaurants").select("id, name").in("id",n);y==null||y.forEach(S=>{s[S.id]=S.name})}const h={};o.forEach(y=>{const S=new Date(y.created_at),b=`${S.getFullYear()}-${String(S.getMonth()+1).padStart(2,"0")}`;h[y.target_id]||(h[y.target_id]={}),h[y.target_id][b]=(h[y.target_id][b]||0)+1});const i=new Set;return Object.values(h).forEach(y=>{Object.keys(y).forEach(S=>i.add(S))}),Array.from(i).sort().map(y=>{const S={month:y};return Object.keys(h).forEach(b=>{const T=h[b][y]||0;S[s[b]||b]=T}),S})}})},MIe=()=>ei({queryKey:["activity-engagement"],queryFn:async()=>{const{data:e,error:t}=await Ct.from("activities").select("id, title_en").order("created_at",{ascending:!1}).limit(10);if(t)throw t;return await Promise.all((e||[]).map(async n=>{const[s,o]=await Promise.all([Ct.from("subscriptions").select("*",{count:"exact",head:!0}).eq("activity_id",n.id),Ct.from("comments").select("*",{count:"exact",head:!0}).eq("target_id",n.id).eq("target_type","activity")]);return{name:n.title_en,subscribers:s.count||0,comments:o.count||0}}))}}),DIe=()=>{const{toast:e}=Ri(),t=Mi();return Gi({mutationFn:async r=>{await Ct.from("activity_restaurants").delete().eq("activity_id",r);const{error:n}=await Ct.from("activities").delete().eq("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["activities"]}),e({title:Pr.t("common.success"),description:Pr.t("toast.activityDeleted")})},onError:()=>{e({title:Pr.t("common.error"),description:Pr.t("toast.activityDeleteFailed"),variant:"destructive"})}})},LIe=()=>{const{toast:e}=Ri(),t=Mi();return Gi({mutationFn:async r=>{const{error:n}=await Ct.from("restaurants").delete().eq("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["restaurants"]}),e({title:Pr.t("common.success"),description:Pr.t("toast.restaurantDeleted")})},onError:()=>{e({title:Pr.t("common.error"),description:Pr.t("toast.restaurantDeleteFailed"),variant:"destructive"})}})},FIe=()=>{const{toast:e}=Ri(),t=Mi();return Gi({mutationFn:async r=>{const n=r.map(async s=>{const{error:o}=await Ct.functions.invoke("delete-account",{body:{userId:s}});if(o)throw o});await Promise.all(n)},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-users"]}),e({title:Pr.t("common.success"),description:Pr.t("toast.usersDeleted")})},onError:()=>{e({title:Pr.t("common.error"),description:Pr.t("toast.usersDeleteFailed"),variant:"destructive"})}})},zIe=()=>{const{toast:e}=Ri(),t=Mi();return Gi({mutationFn:async r=>{const{error:n}=await Ct.from("restaurants").delete().in("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["restaurants"]}),e({title:Pr.t("common.success"),description:Pr.t("toast.restaurantsDeleted")})},onError:()=>{e({title:Pr.t("common.error"),description:Pr.t("toast.restaurantsDeleteFailed"),variant:"destructive"})}})},BIe=()=>{const{toast:e}=Ri(),t=Mi();return Gi({mutationFn:async r=>{await Ct.from("activity_restaurants").delete().in("activity_id",r);const{error:n}=await Ct.from("activities").delete().in("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["activities"]}),e({title:Pr.t("common.success"),description:Pr.t("toast.activitiesDeleted")})},onError:()=>{e({title:Pr.t("common.error"),description:Pr.t("toast.activitiesDeleteFailed"),variant:"destructive"})}})},$Ie=()=>{const{toast:e}=Ri(),t=Mi();return Gi({mutationFn:async({userIds:r,role:n})=>{const s=r.map(h=>({user_id:h,role:n})),{error:o}=await Ct.from("user_roles").upsert(s,{onConflict:"user_id"});if(o)throw o},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-users"]}),e({title:Pr.t("common.success"),description:Pr.t("toast.rolesChanged")})},onError:r=>{console.error("Batch role change error:",r),e({title:Pr.t("common.error"),description:r.message||Pr.t("toast.rolesChangeFailed"),variant:"destructive"})}})},UIe=()=>{const{toast:e}=Ri(),t=Mi();return Gi({mutationFn:async({restaurantId:r,visible:n})=>{const{error:s}=await Ct.from("restaurants").update({visible:n}).eq("id",r);if(s)throw s},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-restaurants"]}),t.invalidateQueries({queryKey:["restaurants"]}),e({title:Pr.t("common.success"),description:Pr.t("toast.visibilityUpdated")})},onError:()=>{e({title:Pr.t("common.error"),description:Pr.t("toast.visibilityUpdateFailed"),variant:"destructive"})}})};function fW({className:e,...t}){return d.jsx("div",{className:fr("animate-pulse rounded-md bg-muted",e),...t})}const VIe="sidebar:state",qIe=60*60*24*7,HIe="16rem",GIe="18rem",WIe="3rem",KIe="b",coe=V.createContext(null);function U2(){const e=V.useContext(coe);if(!e)throw new Error("useSidebar must be used within a SidebarProvider.");return e}const uoe=V.forwardRef(({defaultOpen:e=!0,open:t,onOpenChange:r,className:n,style:s,children:o,...h},i)=>{const m=VN(),[y,S]=V.useState(!1),[b,T]=V.useState(e),A=t??b,O=V.useCallback(M=>{const F=typeof M=="function"?M(A):M;r?r(F):T(F),document.cookie=`${VIe}=${F}; path=/; max-age=${qIe}`},[r,A]),P=V.useCallback(()=>m?S(M=>!M):O(M=>!M),[m,O,S]);V.useEffect(()=>{const M=F=>{F.key===KIe&&(F.metaKey||F.ctrlKey)&&(F.preventDefault(),P())};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)},[P]);const I=A?"expanded":"collapsed",R=V.useMemo(()=>({state:I,open:A,setOpen:O,isMobile:m,openMobile:y,setOpenMobile:S,toggleSidebar:P}),[I,A,O,m,y,S,P]);return d.jsx(coe.Provider,{value:R,children:d.jsx(xee,{delayDuration:0,children:d.jsx("div",{style:{"--sidebar-width":HIe,"--sidebar-width-icon":WIe,...s},className:fr("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",n),ref:i,...h,children:o})})})});uoe.displayName="SidebarProvider";const doe=V.forwardRef(({side:e="left",variant:t="sidebar",collapsible:r="offcanvas",className:n,children:s,...o},h)=>{const{isMobile:i,state:m,openMobile:y,setOpenMobile:S}=U2();return r==="none"?d.jsx("div",{className:fr("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",n),ref:h,...o,children:s}):i?d.jsx(Nre,{open:y,onOpenChange:S,...o,children:d.jsx(o5,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":GIe},side:e,children:d.jsx("div",{className:"flex h-full w-full flex-col",children:s})})}):d.jsxs("div",{ref:h,className:"group peer hidden text-sidebar-foreground md:block","data-state":m,"data-collapsible":m==="collapsed"?r:"","data-variant":t,"data-side":e,children:[d.jsx("div",{className:fr("relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",t==="floating"||t==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),d.jsx("div",{className:fr("fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex",e==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",t==="floating"||t==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",n),...o,children:d.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:s})})]})});doe.displayName="Sidebar";const hoe=V.forwardRef(({className:e,onClick:t,...r},n)=>{const{toggleSidebar:s}=U2();return d.jsxs(Mt,{ref:n,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:fr("h-7 w-7",e),onClick:o=>{t==null||t(o),s()},...r,children:[d.jsx(D_e,{}),d.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});hoe.displayName="SidebarTrigger";const ZIe=V.forwardRef(({className:e,...t},r)=>{const{toggleSidebar:n}=U2();return d.jsx("button",{ref:r,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:n,title:"Toggle Sidebar",className:fr("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] group-data-[side=left]:-right-4 group-data-[side=right]:left-0 hover:after:bg-sidebar-border sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",e),...t})});ZIe.displayName="SidebarRail";const XIe=V.forwardRef(({className:e,...t},r)=>d.jsx("main",{ref:r,className:fr("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",e),...t}));XIe.displayName="SidebarInset";const YIe=V.forwardRef(({className:e,...t},r)=>d.jsx(cr,{ref:r,"data-sidebar":"input",className:fr("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",e),...t}));YIe.displayName="SidebarInput";const JIe=V.forwardRef(({className:e,...t},r)=>d.jsx("div",{ref:r,"data-sidebar":"header",className:fr("flex flex-col gap-2 p-2",e),...t}));JIe.displayName="SidebarHeader";const QIe=V.forwardRef(({className:e,...t},r)=>d.jsx("div",{ref:r,"data-sidebar":"footer",className:fr("flex flex-col gap-2 p-2",e),...t}));QIe.displayName="SidebarFooter";const eRe=V.forwardRef(({className:e,...t},r)=>d.jsx(El,{ref:r,"data-sidebar":"separator",className:fr("mx-2 w-auto bg-sidebar-border",e),...t}));eRe.displayName="SidebarSeparator";const foe=V.forwardRef(({className:e,...t},r)=>d.jsx("div",{ref:r,"data-sidebar":"content",className:fr("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",e),...t}));foe.displayName="SidebarContent";const poe=V.forwardRef(({className:e,...t},r)=>d.jsx("div",{ref:r,"data-sidebar":"group",className:fr("relative flex w-full min-w-0 flex-col p-2",e),...t}));poe.displayName="SidebarGroup";const moe=V.forwardRef(({className:e,asChild:t=!1,...r},n)=>{const s=t?Hv:"div";return d.jsx(s,{ref:n,"data-sidebar":"group-label",className:fr("flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",e),...r})});moe.displayName="SidebarGroupLabel";const tRe=V.forwardRef(({className:e,asChild:t=!1,...r},n)=>{const s=t?Hv:"button";return d.jsx(s,{ref:n,"data-sidebar":"group-action",className:fr("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",e),...r})});tRe.displayName="SidebarGroupAction";const goe=V.forwardRef(({className:e,...t},r)=>d.jsx("div",{ref:r,"data-sidebar":"group-content",className:fr("w-full text-sm",e),...t}));goe.displayName="SidebarGroupContent";const yoe=V.forwardRef(({className:e,...t},r)=>d.jsx("ul",{ref:r,"data-sidebar":"menu",className:fr("flex w-full min-w-0 flex-col gap-1",e),...t}));yoe.displayName="SidebarMenu";const voe=V.forwardRef(({className:e,...t},r)=>d.jsx("li",{ref:r,"data-sidebar":"menu-item",className:fr("group/menu-item relative",e),...t}));voe.displayName="SidebarMenuItem";const rRe=Wv("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),_oe=V.forwardRef(({asChild:e=!1,isActive:t=!1,variant:r="default",size:n="default",tooltip:s,className:o,...h},i)=>{const m=e?Hv:"button",{isMobile:y,state:S}=U2(),b=d.jsx(m,{ref:i,"data-sidebar":"menu-button","data-size":n,"data-active":t,className:fr(rRe({variant:r,size:n}),o),...h});return s?(typeof s=="string"&&(s={children:s}),d.jsxs(Ube,{children:[d.jsx(Vbe,{asChild:!0,children:b}),d.jsx(bee,{side:"right",align:"center",hidden:S!=="collapsed"||y,...s})]})):b});_oe.displayName="SidebarMenuButton";const nRe=V.forwardRef(({className:e,asChild:t=!1,showOnHover:r=!1,...n},s)=>{const o=t?Hv:"button";return d.jsx(o,{ref:s,"data-sidebar":"menu-action",className:fr("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform peer-hover/menu-button:text-sidebar-accent-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",r&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",e),...n})});nRe.displayName="SidebarMenuAction";const iRe=V.forwardRef(({className:e,...t},r)=>d.jsx("div",{ref:r,"data-sidebar":"menu-badge",className:fr("pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",e),...t}));iRe.displayName="SidebarMenuBadge";const sRe=V.forwardRef(({className:e,showIcon:t=!1,...r},n)=>{const s=V.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return d.jsxs("div",{ref:n,"data-sidebar":"menu-skeleton",className:fr("flex h-8 items-center gap-2 rounded-md px-2",e),...r,children:[t&&d.jsx(fW,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),d.jsx(fW,{className:"h-4 max-w-[--skeleton-width] flex-1","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":s}})]})});sRe.displayName="SidebarMenuSkeleton";const aRe=V.forwardRef(({className:e,...t},r)=>d.jsx("ul",{ref:r,"data-sidebar":"menu-sub",className:fr("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",e),...t}));aRe.displayName="SidebarMenuSub";const oRe=V.forwardRef(({...e},t)=>d.jsx("li",{ref:t,...e}));oRe.displayName="SidebarMenuSubItem";const lRe=V.forwardRef(({asChild:e=!1,size:t="md",isActive:r,className:n,...s},o)=>{const h=e?Hv:"a";return d.jsx(h,{ref:o,"data-sidebar":"menu-sub-button","data-size":t,"data-active":r,className:fr("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring aria-disabled:pointer-events-none aria-disabled:opacity-50 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",t==="sm"&&"text-xs",t==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",n),...s})});lRe.displayName="SidebarMenuSubButton";const cRe=()=>{const{t:e}=ci(),{state:t}=U2(),{isAdmin:r}=_c(),s=Qh().pathname,h=[{title:e("admin.dashboard"),url:"/admin",icon:P_e,allowedRoles:["admin","supervisor"]},{title:e("admin.users"),url:"/admin/users",icon:Bc,allowedRoles:["admin","supervisor"]},{title:e("admin.restaurants"),url:"/admin/restaurants",icon:nb,allowedRoles:["admin","supervisor"]},{title:e("admin.activities"),url:"/admin/activities",icon:yo,allowedRoles:["admin"]},{title:"",url:"/admin/coupons",icon:wv,allowedRoles:["admin"]},{title:"",url:"/admin/activity-requests",icon:j3,allowedRoles:["admin"]},{title:"",url:"/admin/homepage",icon:jQ,allowedRoles:["admin"]},{title:e("admin.reports"),url:"/admin/reports",icon:nP,allowedRoles:["admin"]},{title:e("joinUs.adminTitle"),url:"/admin/join-requests",icon:Io,allowedRoles:["admin"]},{title:e("admin.logs"),url:"/admin/logs",icon:rb,allowedRoles:["admin"]}].filter(m=>r||m.allowedRoles.includes("supervisor")),i=m=>m==="/admin"?s===m:s.startsWith(m);return d.jsx(doe,{className:t==="collapsed"?"w-14":"w-60",children:d.jsx(foe,{children:d.jsxs(poe,{children:[d.jsx(moe,{className:t==="collapsed"?"text-center":"",children:t==="collapsed"?d.jsx(NQ,{className:"h-4 w-4"}):e("admin.management")}),d.jsx(goe,{children:d.jsx(yoe,{className:"mt-[30px]",children:h.map(m=>d.jsx(voe,{children:d.jsx(_oe,{asChild:!0,isActive:i(m.url),children:d.jsxs(ji,{to:m.url,children:[d.jsx(m.icon,{className:"h-4 w-4"}),t!=="collapsed"&&d.jsx("span",{children:m.title})]})})},m.url))})})]})})})},xo=({children:e})=>{const{t}=ci(),{user:r}=Kn(),{isAdmin:n,isSupervisor:s,isLoading:o}=_c();return o?d.jsx("div",{className:"min-h-screen flex items-center justify-center",children:d.jsx("div",{className:"text-center",children:t("common.loading")})}):!r||!n&&!s?d.jsx(c1e,{to:"/",replace:!0}):d.jsx(uoe,{children:d.jsxs("div",{className:"min-h-screen flex flex-col w-full",children:[d.jsx("header",{className:"h-14 flex items-center border-b bg-background px-4 sticky top-0 z-10",children:d.jsx(hoe,{})}),d.jsxs("div",{className:"flex flex-1 w-full",children:[d.jsx(cRe,{}),d.jsx("main",{className:"flex-1 p-3 md:p-6 bg-secondary/20 overflow-x-hidden",children:d.jsx("div",{className:"max-w-full overflow-x-hidden",children:e})})]})]})})};var uRe=Array.isArray,Qc=uRe,dRe=typeof $c=="object"&&$c&&$c.Object===Object&&$c,xoe=dRe,hRe=xoe,fRe=typeof self=="object"&&self&&self.Object===Object&&self,pRe=hRe||fRe||Function("return this")(),rf=pRe,mRe=rf,gRe=mRe.Symbol,V2=gRe,pW=V2,boe=Object.prototype,yRe=boe.hasOwnProperty,vRe=boe.toString,WS=pW?pW.toStringTag:void 0;function _Re(e){var t=yRe.call(e,WS),r=e[WS];try{e[WS]=void 0;var n=!0}catch{}var s=vRe.call(e);return n&&(t?e[WS]=r:delete e[WS]),s}var xRe=_Re,bRe=Object.prototype,wRe=bRe.toString;function SRe(e){return wRe.call(e)}var ERe=SRe,mW=V2,TRe=xRe,ARe=ERe,CRe="[object Null]",jRe="[object Undefined]",gW=mW?mW.toStringTag:void 0;function PRe(e){return e==null?e===void 0?jRe:CRe:gW&&gW in Object(e)?TRe(e):ARe(e)}var gp=PRe;function ORe(e){return e!=null&&typeof e=="object"}var yp=ORe,kRe=gp,NRe=yp,IRe="[object Symbol]";function RRe(e){return typeof e=="symbol"||NRe(e)&&kRe(e)==IRe}var hw=RRe,MRe=Qc,DRe=hw,LRe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,FRe=/^\w*$/;function zRe(e,t){if(MRe(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||DRe(e)?!0:FRe.test(e)||!LRe.test(e)||t!=null&&e in Object(t)}var n$=zRe;function BRe(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Ag=BRe;const fw=Os(Ag);var $Re=gp,URe=Ag,VRe="[object AsyncFunction]",qRe="[object Function]",HRe="[object GeneratorFunction]",GRe="[object Proxy]";function WRe(e){if(!URe(e))return!1;var t=$Re(e);return t==qRe||t==HRe||t==VRe||t==GRe}var i$=WRe;const vi=Os(i$);var KRe=rf,ZRe=KRe["__core-js_shared__"],XRe=ZRe,eL=XRe,yW=function(){var e=/[^.]+$/.exec(eL&&eL.keys&&eL.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function YRe(e){return!!yW&&yW in e}var JRe=YRe,QRe=Function.prototype,eMe=QRe.toString;function tMe(e){if(e!=null){try{return eMe.call(e)}catch{}try{return e+""}catch{}}return""}var woe=tMe,rMe=i$,nMe=JRe,iMe=Ag,sMe=woe,aMe=/[\\^$.*+?()[\]{}|]/g,oMe=/^\[object .+?Constructor\]$/,lMe=Function.prototype,cMe=Object.prototype,uMe=lMe.toString,dMe=cMe.hasOwnProperty,hMe=RegExp("^"+uMe.call(dMe).replace(aMe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function fMe(e){if(!iMe(e)||nMe(e))return!1;var t=rMe(e)?hMe:oMe;return t.test(sMe(e))}var pMe=fMe;function mMe(e,t){return e==null?void 0:e[t]}var gMe=mMe,yMe=pMe,vMe=gMe;function _Me(e,t){var r=vMe(e,t);return yMe(r)?r:void 0}var e_=_Me,xMe=e_,bMe=xMe(Object,"create"),KN=bMe,vW=KN;function wMe(){this.__data__=vW?vW(null):{},this.size=0}var SMe=wMe;function EMe(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var TMe=EMe,AMe=KN,CMe="__lodash_hash_undefined__",jMe=Object.prototype,PMe=jMe.hasOwnProperty;function OMe(e){var t=this.__data__;if(AMe){var r=t[e];return r===CMe?void 0:r}return PMe.call(t,e)?t[e]:void 0}var kMe=OMe,NMe=KN,IMe=Object.prototype,RMe=IMe.hasOwnProperty;function MMe(e){var t=this.__data__;return NMe?t[e]!==void 0:RMe.call(t,e)}var DMe=MMe,LMe=KN,FMe="__lodash_hash_undefined__";function zMe(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=LMe&&t===void 0?FMe:t,this}var BMe=zMe,$Me=SMe,UMe=TMe,VMe=kMe,qMe=DMe,HMe=BMe;function pw(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}pw.prototype.clear=$Me;pw.prototype.delete=UMe;pw.prototype.get=VMe;pw.prototype.has=qMe;pw.prototype.set=HMe;var GMe=pw;function WMe(){this.__data__=[],this.size=0}var KMe=WMe;function ZMe(e,t){return e===t||e!==e&&t!==t}var s$=ZMe,XMe=s$;function YMe(e,t){for(var r=e.length;r--;)if(XMe(e[r][0],t))return r;return-1}var ZN=YMe,JMe=ZN,QMe=Array.prototype,eDe=QMe.splice;function tDe(e){var t=this.__data__,r=JMe(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():eDe.call(t,r,1),--this.size,!0}var rDe=tDe,nDe=ZN;function iDe(e){var t=this.__data__,r=nDe(t,e);return r<0?void 0:t[r][1]}var sDe=iDe,aDe=ZN;function oDe(e){return aDe(this.__data__,e)>-1}var lDe=oDe,cDe=ZN;function uDe(e,t){var r=this.__data__,n=cDe(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var dDe=uDe,hDe=KMe,fDe=rDe,pDe=sDe,mDe=lDe,gDe=dDe;function mw(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}mw.prototype.clear=hDe;mw.prototype.delete=fDe;mw.prototype.get=pDe;mw.prototype.has=mDe;mw.prototype.set=gDe;var XN=mw,yDe=e_,vDe=rf,_De=yDe(vDe,"Map"),a$=_De,_W=GMe,xDe=XN,bDe=a$;function wDe(){this.size=0,this.__data__={hash:new _W,map:new(bDe||xDe),string:new _W}}var SDe=wDe;function EDe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var TDe=EDe,ADe=TDe;function CDe(e,t){var r=e.__data__;return ADe(t)?r[typeof t=="string"?"string":"hash"]:r.map}var YN=CDe,jDe=YN;function PDe(e){var t=jDe(this,e).delete(e);return this.size-=t?1:0,t}var ODe=PDe,kDe=YN;function NDe(e){return kDe(this,e).get(e)}var IDe=NDe,RDe=YN;function MDe(e){return RDe(this,e).has(e)}var DDe=MDe,LDe=YN;function FDe(e,t){var r=LDe(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var zDe=FDe,BDe=SDe,$De=ODe,UDe=IDe,VDe=DDe,qDe=zDe;function gw(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}gw.prototype.clear=BDe;gw.prototype.delete=$De;gw.prototype.get=UDe;gw.prototype.has=VDe;gw.prototype.set=qDe;var o$=gw,Soe=o$,HDe="Expected a function";function l$(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(HDe);var r=function(){var n=arguments,s=t?t.apply(this,n):n[0],o=r.cache;if(o.has(s))return o.get(s);var h=e.apply(this,n);return r.cache=o.set(s,h)||o,h};return r.cache=new(l$.Cache||Soe),r}l$.Cache=Soe;var Eoe=l$;const GDe=Os(Eoe);var WDe=Eoe,KDe=500;function ZDe(e){var t=WDe(e,function(n){return r.size===KDe&&r.clear(),n}),r=t.cache;return t}var XDe=ZDe,YDe=XDe,JDe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,QDe=/\\(\\)?/g,eLe=YDe(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(JDe,function(r,n,s,o){t.push(s?o.replace(QDe,"$1"):n||r)}),t}),tLe=eLe;function rLe(e,t){for(var r=-1,n=e==null?0:e.length,s=Array(n);++r<n;)s[r]=t(e[r],r,e);return s}var c$=rLe,xW=V2,nLe=c$,iLe=Qc,sLe=hw,aLe=1/0,bW=xW?xW.prototype:void 0,wW=bW?bW.toString:void 0;function Toe(e){if(typeof e=="string")return e;if(iLe(e))return nLe(e,Toe)+"";if(sLe(e))return wW?wW.call(e):"";var t=e+"";return t=="0"&&1/e==-aLe?"-0":t}var oLe=Toe,lLe=oLe;function cLe(e){return e==null?"":lLe(e)}var Aoe=cLe,uLe=Qc,dLe=n$,hLe=tLe,fLe=Aoe;function pLe(e,t){return uLe(e)?e:dLe(e,t)?[e]:hLe(fLe(e))}var Coe=pLe,mLe=hw,gLe=1/0;function yLe(e){if(typeof e=="string"||mLe(e))return e;var t=e+"";return t=="0"&&1/e==-gLe?"-0":t}var JN=yLe,vLe=Coe,_Le=JN;function xLe(e,t){t=vLe(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[_Le(t[r++])];return r&&r==n?e:void 0}var u$=xLe,bLe=u$;function wLe(e,t,r){var n=e==null?void 0:bLe(e,t);return n===void 0?r:n}var joe=wLe;const bu=Os(joe);function SLe(e){return e==null}var ELe=SLe;const ki=Os(ELe);var TLe=gp,ALe=Qc,CLe=yp,jLe="[object String]";function PLe(e){return typeof e=="string"||!ALe(e)&&CLe(e)&&TLe(e)==jLe}var OLe=PLe;const Lv=Os(OLe);var Poe={exports:{}},qs={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var d$=Symbol.for("react.element"),h$=Symbol.for("react.portal"),QN=Symbol.for("react.fragment"),eI=Symbol.for("react.strict_mode"),tI=Symbol.for("react.profiler"),rI=Symbol.for("react.provider"),nI=Symbol.for("react.context"),kLe=Symbol.for("react.server_context"),iI=Symbol.for("react.forward_ref"),sI=Symbol.for("react.suspense"),aI=Symbol.for("react.suspense_list"),oI=Symbol.for("react.memo"),lI=Symbol.for("react.lazy"),NLe=Symbol.for("react.offscreen"),Ooe;Ooe=Symbol.for("react.module.reference");function id(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case d$:switch(e=e.type,e){case QN:case tI:case eI:case sI:case aI:return e;default:switch(e=e&&e.$$typeof,e){case kLe:case nI:case iI:case lI:case oI:case rI:return e;default:return t}}case h$:return t}}}qs.ContextConsumer=nI;qs.ContextProvider=rI;qs.Element=d$;qs.ForwardRef=iI;qs.Fragment=QN;qs.Lazy=lI;qs.Memo=oI;qs.Portal=h$;qs.Profiler=tI;qs.StrictMode=eI;qs.Suspense=sI;qs.SuspenseList=aI;qs.isAsyncMode=function(){return!1};qs.isConcurrentMode=function(){return!1};qs.isContextConsumer=function(e){return id(e)===nI};qs.isContextProvider=function(e){return id(e)===rI};qs.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===d$};qs.isForwardRef=function(e){return id(e)===iI};qs.isFragment=function(e){return id(e)===QN};qs.isLazy=function(e){return id(e)===lI};qs.isMemo=function(e){return id(e)===oI};qs.isPortal=function(e){return id(e)===h$};qs.isProfiler=function(e){return id(e)===tI};qs.isStrictMode=function(e){return id(e)===eI};qs.isSuspense=function(e){return id(e)===sI};qs.isSuspenseList=function(e){return id(e)===aI};qs.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===QN||e===tI||e===eI||e===sI||e===aI||e===NLe||typeof e=="object"&&e!==null&&(e.$$typeof===lI||e.$$typeof===oI||e.$$typeof===rI||e.$$typeof===nI||e.$$typeof===iI||e.$$typeof===Ooe||e.getModuleId!==void 0)};qs.typeOf=id;Poe.exports=qs;var ILe=Poe.exports,RLe=gp,MLe=yp,DLe="[object Number]";function LLe(e){return typeof e=="number"||MLe(e)&&RLe(e)==DLe}var koe=LLe;const FLe=Os(koe);var zLe=koe;function BLe(e){return zLe(e)&&e!=+e}var $Le=BLe;const q2=Os($Le);var hc=function(t){return t===0?0:t>0?1:-1},Yy=function(t){return Lv(t)&&t.indexOf("%")===t.length-1},Gr=function(t){return FLe(t)&&!q2(t)},ULe=function(t){return ki(t)},Xo=function(t){return Gr(t)||Lv(t)},VLe=0,yw=function(t){var r=++VLe;return"".concat(t||"").concat(r)},fc=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!Gr(t)&&!Lv(t))return n;var o;if(Yy(t)){var h=t.indexOf("%");o=r*parseFloat(t.slice(0,h))/100}else o=+t;return q2(o)&&(o=n),s&&o>r&&(o=r),o},km=function(t){if(!t)return null;var r=Object.keys(t);return r&&r.length?t[r[0]]:null},qLe=function(t){if(!Array.isArray(t))return!1;for(var r=t.length,n={},s=0;s<r;s++)if(!n[t[s]])n[t[s]]=!0;else return!0;return!1},fu=function(t,r){return Gr(t)&&Gr(r)?function(n){return t+n*(r-t)}:function(){return r}};function PO(e,t,r){return!e||!e.length?null:e.find(function(n){return n&&(typeof t=="function"?t(n):bu(n,t))===r})}var HLe=function(t,r){return Gr(t)&&Gr(r)?t-r:Lv(t)&&Lv(r)?t.localeCompare(r):t instanceof Date&&r instanceof Date?t.getTime()-r.getTime():String(t).localeCompare(String(r))};function R0(e,t){for(var r in e)if({}.hasOwnProperty.call(e,r)&&(!{}.hasOwnProperty.call(t,r)||e[r]!==t[r]))return!1;for(var n in t)if({}.hasOwnProperty.call(t,n)&&!{}.hasOwnProperty.call(e,n))return!1;return!0}function qF(e){"@babel/helpers - typeof";return qF=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qF(e)}var GLe=["viewBox","children"],WLe=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],SW=["points","pathLength"],tL={svg:GLe,polygon:SW,polyline:SW},f$=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],OO=function(t,r){if(!t||typeof t=="function"||typeof t=="boolean")return null;var n=t;if(V.isValidElement(t)&&(n=t.props),!fw(n))return null;var s={};return Object.keys(n).forEach(function(o){f$.includes(o)&&(s[o]=r||function(h){return n[o](n,h)})}),s},KLe=function(t,r,n){return function(s){return t(r,n,s),null}},Fv=function(t,r,n){if(!fw(t)||qF(t)!=="object")return null;var s=null;return Object.keys(t).forEach(function(o){var h=t[o];f$.includes(o)&&typeof h=="function"&&(s||(s={}),s[o]=KLe(h,r,n))}),s},ZLe=["children"],XLe=["children"];function EW(e,t){if(e==null)return{};var r=YLe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function YLe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function HF(e){"@babel/helpers - typeof";return HF=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},HF(e)}var TW={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},Xf=function(t){return typeof t=="string"?t:t?t.displayName||t.name||"Component":""},AW=null,rL=null,p$=function e(t){if(t===AW&&Array.isArray(rL))return rL;var r=[];return V.Children.forEach(t,function(n){ki(n)||(ILe.isFragment(n)?r=r.concat(e(n.props.children)):r.push(n))}),rL=r,AW=t,r};function wu(e,t){var r=[],n=[];return Array.isArray(t)?n=t.map(function(s){return Xf(s)}):n=[Xf(t)],p$(e).forEach(function(s){var o=bu(s,"type.displayName")||bu(s,"type.name");n.indexOf(o)!==-1&&r.push(s)}),r}function uu(e,t){var r=wu(e,t);return r&&r[0]}var CW=function(t){if(!t||!t.props)return!1;var r=t.props,n=r.width,s=r.height;return!(!Gr(n)||n<=0||!Gr(s)||s<=0)},JLe=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],QLe=function(t){return t&&t.type&&Lv(t.type)&&JLe.indexOf(t.type)>=0},e3e=function(t){return t&&HF(t)==="object"&&"clipDot"in t},t3e=function(t,r,n,s){var o,h=(o=tL==null?void 0:tL[s])!==null&&o!==void 0?o:[];return r.startsWith("data-")||!vi(t)&&(s&&h.includes(r)||WLe.includes(r))||n&&f$.includes(r)},Qn=function(t,r,n){if(!t||typeof t=="function"||typeof t=="boolean")return null;var s=t;if(V.isValidElement(t)&&(s=t.props),!fw(s))return null;var o={};return Object.keys(s).forEach(function(h){var i;t3e((i=s)===null||i===void 0?void 0:i[h],h,r,n)&&(o[h]=s[h])}),o},GF=function e(t,r){if(t===r)return!0;var n=V.Children.count(t);if(n!==V.Children.count(r))return!1;if(n===0)return!0;if(n===1)return jW(Array.isArray(t)?t[0]:t,Array.isArray(r)?r[0]:r);for(var s=0;s<n;s++){var o=t[s],h=r[s];if(Array.isArray(o)||Array.isArray(h)){if(!e(o,h))return!1}else if(!jW(o,h))return!1}return!0},jW=function(t,r){if(ki(t)&&ki(r))return!0;if(!ki(t)&&!ki(r)){var n=t.props||{},s=n.children,o=EW(n,ZLe),h=r.props||{},i=h.children,m=EW(h,XLe);return s&&i?R0(o,m)&&GF(s,i):!s&&!i?R0(o,m):!1}return!1},PW=function(t,r){var n=[],s={};return p$(t).forEach(function(o,h){if(QLe(o))n.push(o);else if(o){var i=Xf(o.type),m=r[i]||{},y=m.handler,S=m.once;if(y&&(!S||!s[i])){var b=y(o,i,h);n.push(b),s[i]=!0}}}),n},r3e=function(t){var r=t&&t.type;return r&&TW[r]?TW[r]:null},n3e=function(t,r){return p$(r).indexOf(t)},i3e=["children","width","height","viewBox","className","style","title","desc"];function WF(){return WF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},WF.apply(this,arguments)}function s3e(e,t){if(e==null)return{};var r=a3e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function a3e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function KF(e){var t=e.children,r=e.width,n=e.height,s=e.viewBox,o=e.className,h=e.style,i=e.title,m=e.desc,y=s3e(e,i3e),S=s||{width:r,height:n,x:0,y:0},b=Ii("recharts-surface",o);return Ue.createElement("svg",WF({},Qn(y,!0,"svg"),{className:b,width:r,height:n,style:h,viewBox:"".concat(S.x," ").concat(S.y," ").concat(S.width," ").concat(S.height)}),Ue.createElement("title",null,i),Ue.createElement("desc",null,m),t)}var o3e=["children","className"];function ZF(){return ZF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ZF.apply(this,arguments)}function l3e(e,t){if(e==null)return{};var r=c3e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function c3e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var js=Ue.forwardRef(function(e,t){var r=e.children,n=e.className,s=l3e(e,o3e),o=Ii("recharts-layer",n);return Ue.createElement("g",ZF({className:o},Qn(s,!0),{ref:t}),r)}),Hd=function(t,r){for(var n=arguments.length,s=new Array(n>2?n-2:0),o=2;o<n;o++)s[o-2]=arguments[o]};function u3e(e,t,r){var n=-1,s=e.length;t<0&&(t=-t>s?0:s+t),r=r>s?s:r,r<0&&(r+=s),s=t>r?0:r-t>>>0,t>>>=0;for(var o=Array(s);++n<s;)o[n]=e[n+t];return o}var d3e=u3e,h3e=d3e;function f3e(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:h3e(e,t,r)}var p3e=f3e,m3e="\\ud800-\\udfff",g3e="\\u0300-\\u036f",y3e="\\ufe20-\\ufe2f",v3e="\\u20d0-\\u20ff",_3e=g3e+y3e+v3e,x3e="\\ufe0e\\ufe0f",b3e="\\u200d",w3e=RegExp("["+b3e+m3e+_3e+x3e+"]");function S3e(e){return w3e.test(e)}var Noe=S3e;function E3e(e){return e.split("")}var T3e=E3e,Ioe="\\ud800-\\udfff",A3e="\\u0300-\\u036f",C3e="\\ufe20-\\ufe2f",j3e="\\u20d0-\\u20ff",P3e=A3e+C3e+j3e,O3e="\\ufe0e\\ufe0f",k3e="["+Ioe+"]",XF="["+P3e+"]",YF="\\ud83c[\\udffb-\\udfff]",N3e="(?:"+XF+"|"+YF+")",Roe="[^"+Ioe+"]",Moe="(?:\\ud83c[\\udde6-\\uddff]){2}",Doe="[\\ud800-\\udbff][\\udc00-\\udfff]",I3e="\\u200d",Loe=N3e+"?",Foe="["+O3e+"]?",R3e="(?:"+I3e+"(?:"+[Roe,Moe,Doe].join("|")+")"+Foe+Loe+")*",M3e=Foe+Loe+R3e,D3e="(?:"+[Roe+XF+"?",XF,Moe,Doe,k3e].join("|")+")",L3e=RegExp(YF+"(?="+YF+")|"+D3e+M3e,"g");function F3e(e){return e.match(L3e)||[]}var z3e=F3e,B3e=T3e,$3e=Noe,U3e=z3e;function V3e(e){return $3e(e)?U3e(e):B3e(e)}var q3e=V3e,H3e=p3e,G3e=Noe,W3e=q3e,K3e=Aoe;function Z3e(e){return function(t){t=K3e(t);var r=G3e(t)?W3e(t):void 0,n=r?r[0]:t.charAt(0),s=r?H3e(r,1).join(""):t.slice(1);return n[e]()+s}}var X3e=Z3e,Y3e=X3e,J3e=Y3e("toUpperCase"),Q3e=J3e;const cI=Os(Q3e);function aa(e){return function(){return e}}const zoe=Math.cos,kO=Math.sin,Jd=Math.sqrt,NO=Math.PI,uI=2*NO,JF=Math.PI,QF=2*JF,By=1e-6,eFe=QF-By;function Boe(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function tFe(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return Boe;const r=10**t;return function(n){this._+=n[0];for(let s=1,o=n.length;s<o;++s)this._+=Math.round(arguments[s]*r)/r+n[s]}}class rFe{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?Boe:tFe(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,s){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+s}`}bezierCurveTo(t,r,n,s,o,h){this._append`C${+t},${+r},${+n},${+s},${this._x1=+o},${this._y1=+h}`}arcTo(t,r,n,s,o){if(t=+t,r=+r,n=+n,s=+s,o=+o,o<0)throw new Error(`negative radius: ${o}`);let h=this._x1,i=this._y1,m=n-t,y=s-r,S=h-t,b=i-r,T=S*S+b*b;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(T>By)if(!(Math.abs(b*m-y*S)>By)||!o)this._append`L${this._x1=t},${this._y1=r}`;else{let A=n-h,O=s-i,P=m*m+y*y,I=A*A+O*O,R=Math.sqrt(P),M=Math.sqrt(T),F=o*Math.tan((JF-Math.acos((P+T-I)/(2*R*M)))/2),z=F/M,$=F/R;Math.abs(z-1)>By&&this._append`L${t+z*S},${r+z*b}`,this._append`A${o},${o},0,0,${+(b*A>S*O)},${this._x1=t+$*m},${this._y1=r+$*y}`}}arc(t,r,n,s,o,h){if(t=+t,r=+r,n=+n,h=!!h,n<0)throw new Error(`negative radius: ${n}`);let i=n*Math.cos(s),m=n*Math.sin(s),y=t+i,S=r+m,b=1^h,T=h?s-o:o-s;this._x1===null?this._append`M${y},${S}`:(Math.abs(this._x1-y)>By||Math.abs(this._y1-S)>By)&&this._append`L${y},${S}`,n&&(T<0&&(T=T%QF+QF),T>eFe?this._append`A${n},${n},0,1,${b},${t-i},${r-m}A${n},${n},0,1,${b},${this._x1=y},${this._y1=S}`:T>By&&this._append`A${n},${n},0,${+(T>=JF)},${b},${this._x1=t+n*Math.cos(o)},${this._y1=r+n*Math.sin(o)}`)}rect(t,r,n,s){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+s}h${-n}Z`}toString(){return this._}}function m$(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new rFe(t)}function g$(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function $oe(e){this._context=e}$oe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function dI(e){return new $oe(e)}function Uoe(e){return e[0]}function Voe(e){return e[1]}function qoe(e,t){var r=aa(!0),n=null,s=dI,o=null,h=m$(i);e=typeof e=="function"?e:e===void 0?Uoe:aa(e),t=typeof t=="function"?t:t===void 0?Voe:aa(t);function i(m){var y,S=(m=g$(m)).length,b,T=!1,A;for(n==null&&(o=s(A=h())),y=0;y<=S;++y)!(y<S&&r(b=m[y],y,m))===T&&((T=!T)?o.lineStart():o.lineEnd()),T&&o.point(+e(b,y,m),+t(b,y,m));if(A)return o=null,A+""||null}return i.x=function(m){return arguments.length?(e=typeof m=="function"?m:aa(+m),i):e},i.y=function(m){return arguments.length?(t=typeof m=="function"?m:aa(+m),i):t},i.defined=function(m){return arguments.length?(r=typeof m=="function"?m:aa(!!m),i):r},i.curve=function(m){return arguments.length?(s=m,n!=null&&(o=s(n)),i):s},i.context=function(m){return arguments.length?(m==null?n=o=null:o=s(n=m),i):n},i}function Pj(e,t,r){var n=null,s=aa(!0),o=null,h=dI,i=null,m=m$(y);e=typeof e=="function"?e:e===void 0?Uoe:aa(+e),t=typeof t=="function"?t:aa(t===void 0?0:+t),r=typeof r=="function"?r:r===void 0?Voe:aa(+r);function y(b){var T,A,O,P=(b=g$(b)).length,I,R=!1,M,F=new Array(P),z=new Array(P);for(o==null&&(i=h(M=m())),T=0;T<=P;++T){if(!(T<P&&s(I=b[T],T,b))===R)if(R=!R)A=T,i.areaStart(),i.lineStart();else{for(i.lineEnd(),i.lineStart(),O=T-1;O>=A;--O)i.point(F[O],z[O]);i.lineEnd(),i.areaEnd()}R&&(F[T]=+e(I,T,b),z[T]=+t(I,T,b),i.point(n?+n(I,T,b):F[T],r?+r(I,T,b):z[T]))}if(M)return i=null,M+""||null}function S(){return qoe().defined(s).curve(h).context(o)}return y.x=function(b){return arguments.length?(e=typeof b=="function"?b:aa(+b),n=null,y):e},y.x0=function(b){return arguments.length?(e=typeof b=="function"?b:aa(+b),y):e},y.x1=function(b){return arguments.length?(n=b==null?null:typeof b=="function"?b:aa(+b),y):n},y.y=function(b){return arguments.length?(t=typeof b=="function"?b:aa(+b),r=null,y):t},y.y0=function(b){return arguments.length?(t=typeof b=="function"?b:aa(+b),y):t},y.y1=function(b){return arguments.length?(r=b==null?null:typeof b=="function"?b:aa(+b),y):r},y.lineX0=y.lineY0=function(){return S().x(e).y(t)},y.lineY1=function(){return S().x(e).y(r)},y.lineX1=function(){return S().x(n).y(t)},y.defined=function(b){return arguments.length?(s=typeof b=="function"?b:aa(!!b),y):s},y.curve=function(b){return arguments.length?(h=b,o!=null&&(i=h(o)),y):h},y.context=function(b){return arguments.length?(b==null?o=i=null:i=h(o=b),y):o},y}class Hoe{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}}function nFe(e){return new Hoe(e,!0)}function iFe(e){return new Hoe(e,!1)}const y$={draw(e,t){const r=Jd(t/NO);e.moveTo(r,0),e.arc(0,0,r,0,uI)}},sFe={draw(e,t){const r=Jd(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},Goe=Jd(1/3),aFe=Goe*2,oFe={draw(e,t){const r=Jd(t/aFe),n=r*Goe;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}},lFe={draw(e,t){const r=Jd(t),n=-r/2;e.rect(n,n,r,r)}},cFe=.8908130915292852,Woe=kO(NO/10)/kO(7*NO/10),uFe=kO(uI/10)*Woe,dFe=-zoe(uI/10)*Woe,hFe={draw(e,t){const r=Jd(t*cFe),n=uFe*r,s=dFe*r;e.moveTo(0,-r),e.lineTo(n,s);for(let o=1;o<5;++o){const h=uI*o/5,i=zoe(h),m=kO(h);e.lineTo(m*r,-i*r),e.lineTo(i*n-m*s,m*n+i*s)}e.closePath()}},nL=Jd(3),fFe={draw(e,t){const r=-Jd(t/(nL*3));e.moveTo(0,r*2),e.lineTo(-nL*r,-r),e.lineTo(nL*r,-r),e.closePath()}},Mu=-.5,Du=Jd(3)/2,ez=1/Jd(12),pFe=(ez/2+1)*3,mFe={draw(e,t){const r=Jd(t/pFe),n=r/2,s=r*ez,o=n,h=r*ez+r,i=-o,m=h;e.moveTo(n,s),e.lineTo(o,h),e.lineTo(i,m),e.lineTo(Mu*n-Du*s,Du*n+Mu*s),e.lineTo(Mu*o-Du*h,Du*o+Mu*h),e.lineTo(Mu*i-Du*m,Du*i+Mu*m),e.lineTo(Mu*n+Du*s,Mu*s-Du*n),e.lineTo(Mu*o+Du*h,Mu*h-Du*o),e.lineTo(Mu*i+Du*m,Mu*m-Du*i),e.closePath()}};function gFe(e,t){let r=null,n=m$(s);e=typeof e=="function"?e:aa(e||y$),t=typeof t=="function"?t:aa(t===void 0?64:+t);function s(){let o;if(r||(r=o=n()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),o)return r=null,o+""||null}return s.type=function(o){return arguments.length?(e=typeof o=="function"?o:aa(o),s):e},s.size=function(o){return arguments.length?(t=typeof o=="function"?o:aa(+o),s):t},s.context=function(o){return arguments.length?(r=o??null,s):r},s}function IO(){}function RO(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function Koe(e){this._context=e}Koe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:RO(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:RO(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function yFe(e){return new Koe(e)}function Zoe(e){this._context=e}Zoe.prototype={areaStart:IO,areaEnd:IO,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:RO(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function vFe(e){return new Zoe(e)}function Xoe(e){this._context=e}Xoe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,n=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:RO(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function _Fe(e){return new Xoe(e)}function Yoe(e){this._context=e}Yoe.prototype={areaStart:IO,areaEnd:IO,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function xFe(e){return new Yoe(e)}function OW(e){return e<0?-1:1}function kW(e,t,r){var n=e._x1-e._x0,s=t-e._x1,o=(e._y1-e._y0)/(n||s<0&&-0),h=(r-e._y1)/(s||n<0&&-0),i=(o*s+h*n)/(n+s);return(OW(o)+OW(h))*Math.min(Math.abs(o),Math.abs(h),.5*Math.abs(i))||0}function NW(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function iL(e,t,r){var n=e._x0,s=e._y0,o=e._x1,h=e._y1,i=(o-n)/3;e._context.bezierCurveTo(n+i,s+i*t,o-i,h-i*r,o,h)}function MO(e){this._context=e}MO.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:iL(this,this._t0,NW(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,iL(this,NW(this,r=kW(this,e,t)),r);break;default:iL(this,this._t0,r=kW(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function Joe(e){this._context=new Qoe(e)}(Joe.prototype=Object.create(MO.prototype)).point=function(e,t){MO.prototype.point.call(this,t,e)};function Qoe(e){this._context=e}Qoe.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,n,s,o){this._context.bezierCurveTo(t,e,n,r,o,s)}};function bFe(e){return new MO(e)}function wFe(e){return new Joe(e)}function ele(e){this._context=e}ele.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var n=IW(e),s=IW(t),o=0,h=1;h<r;++o,++h)this._context.bezierCurveTo(n[0][o],s[0][o],n[1][o],s[1][o],e[h],t[h]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function IW(e){var t,r=e.length-1,n,s=new Array(r),o=new Array(r),h=new Array(r);for(s[0]=0,o[0]=2,h[0]=e[0]+2*e[1],t=1;t<r-1;++t)s[t]=1,o[t]=4,h[t]=4*e[t]+2*e[t+1];for(s[r-1]=2,o[r-1]=7,h[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=s[t]/o[t-1],o[t]-=n,h[t]-=n*h[t-1];for(s[r-1]=h[r-1]/o[r-1],t=r-2;t>=0;--t)s[t]=(h[t]-s[t+1])/o[t];for(o[r-1]=(e[r]+s[r-1])/2,t=0;t<r-1;++t)o[t]=2*e[t+1]-s[t+1];return[s,o]}function SFe(e){return new ele(e)}function hI(e,t){this._context=e,this._t=t}hI.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function EFe(e){return new hI(e,.5)}function TFe(e){return new hI(e,0)}function AFe(e){return new hI(e,1)}function Sb(e,t){if((h=e.length)>1)for(var r=1,n,s,o=e[t[0]],h,i=o.length;r<h;++r)for(s=o,o=e[t[r]],n=0;n<i;++n)o[n][1]+=o[n][0]=isNaN(s[n][1])?s[n][0]:s[n][1]}function tz(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}function CFe(e,t){return e[t]}function jFe(e){const t=[];return t.key=e,t}function PFe(){var e=aa([]),t=tz,r=Sb,n=CFe;function s(o){var h=Array.from(e.apply(this,arguments),jFe),i,m=h.length,y=-1,S;for(const b of o)for(i=0,++y;i<m;++i)(h[i][y]=[0,+n(b,h[i].key,y,o)]).data=b;for(i=0,S=g$(t(h));i<m;++i)h[S[i]].index=i;return r(h,S),h}return s.keys=function(o){return arguments.length?(e=typeof o=="function"?o:aa(Array.from(o)),s):e},s.value=function(o){return arguments.length?(n=typeof o=="function"?o:aa(+o),s):n},s.order=function(o){return arguments.length?(t=o==null?tz:typeof o=="function"?o:aa(Array.from(o)),s):t},s.offset=function(o){return arguments.length?(r=o??Sb,s):r},s}function OFe(e,t){if((n=e.length)>0){for(var r,n,s=0,o=e[0].length,h;s<o;++s){for(h=r=0;r<n;++r)h+=e[r][s][1]||0;if(h)for(r=0;r<n;++r)e[r][s][1]/=h}Sb(e,t)}}function kFe(e,t){if((s=e.length)>0){for(var r=0,n=e[t[0]],s,o=n.length;r<o;++r){for(var h=0,i=0;h<s;++h)i+=e[h][r][1]||0;n[r][1]+=n[r][0]=-i/2}Sb(e,t)}}function NFe(e,t){if(!(!((h=e.length)>0)||!((o=(s=e[t[0]]).length)>0))){for(var r=0,n=1,s,o,h;n<o;++n){for(var i=0,m=0,y=0;i<h;++i){for(var S=e[t[i]],b=S[n][1]||0,T=S[n-1][1]||0,A=(b-T)/2,O=0;O<i;++O){var P=e[t[O]],I=P[n][1]||0,R=P[n-1][1]||0;A+=I-R}m+=b,y+=A*b}s[n-1][1]+=s[n-1][0]=r,m&&(r-=y/m)}s[n-1][1]+=s[n-1][0]=r,Sb(e,t)}}function jT(e){"@babel/helpers - typeof";return jT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jT(e)}var IFe=["type","size","sizeType"];function rz(){return rz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},rz.apply(this,arguments)}function RW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function MW(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?RW(Object(r),!0).forEach(function(n){RFe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):RW(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function RFe(e,t,r){return t=MFe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function MFe(e){var t=DFe(e,"string");return jT(t)=="symbol"?t:t+""}function DFe(e,t){if(jT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(jT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function LFe(e,t){if(e==null)return{};var r=FFe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function FFe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var tle={symbolCircle:y$,symbolCross:sFe,symbolDiamond:oFe,symbolSquare:lFe,symbolStar:hFe,symbolTriangle:fFe,symbolWye:mFe},zFe=Math.PI/180,BFe=function(t){var r="symbol".concat(cI(t));return tle[r]||y$},$Fe=function(t,r,n){if(r==="area")return t;switch(n){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var s=18*zFe;return 1.25*t*t*(Math.tan(s)-Math.tan(s*2)*Math.pow(Math.tan(s),2))}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},UFe=function(t,r){tle["symbol".concat(cI(t))]=r},v$=function(t){var r=t.type,n=r===void 0?"circle":r,s=t.size,o=s===void 0?64:s,h=t.sizeType,i=h===void 0?"area":h,m=LFe(t,IFe),y=MW(MW({},m),{},{type:n,size:o,sizeType:i}),S=function(){var I=BFe(n),R=gFe().type(I).size($Fe(o,i,n));return R()},b=y.className,T=y.cx,A=y.cy,O=Qn(y,!0);return T===+T&&A===+A&&o===+o?Ue.createElement("path",rz({},O,{className:Ii("recharts-symbols",b),transform:"translate(".concat(T,", ").concat(A,")"),d:S()})):null};v$.registerSymbol=UFe;function Eb(e){"@babel/helpers - typeof";return Eb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Eb(e)}function nz(){return nz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},nz.apply(this,arguments)}function DW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function VFe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?DW(Object(r),!0).forEach(function(n){PT(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):DW(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function qFe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function HFe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,nle(n.key),n)}}function GFe(e,t,r){return t&&HFe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function WFe(e,t,r){return t=DO(t),KFe(e,rle()?Reflect.construct(t,r||[],DO(e).constructor):t.apply(e,r))}function KFe(e,t){if(t&&(Eb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ZFe(e)}function ZFe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(rle=function(){return!!e})()}function DO(e){return DO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},DO(e)}function XFe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&iz(e,t)}function iz(e,t){return iz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},iz(e,t)}function PT(e,t,r){return t=nle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nle(e){var t=YFe(e,"string");return Eb(t)=="symbol"?t:t+""}function YFe(e,t){if(Eb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Eb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Lu=32,_$=function(e){function t(){return qFe(this,t),WFe(this,t,arguments)}return XFe(t,e),GFe(t,[{key:"renderIcon",value:function(n){var s=this.props.inactiveColor,o=Lu/2,h=Lu/6,i=Lu/3,m=n.inactive?s:n.color;if(n.type==="plainline")return Ue.createElement("line",{strokeWidth:4,fill:"none",stroke:m,strokeDasharray:n.payload.strokeDasharray,x1:0,y1:o,x2:Lu,y2:o,className:"recharts-legend-icon"});if(n.type==="line")return Ue.createElement("path",{strokeWidth:4,fill:"none",stroke:m,d:"M0,".concat(o,"h").concat(i,`
            A`).concat(h,",").concat(h,",0,1,1,").concat(2*i,",").concat(o,`
            H`).concat(Lu,"M").concat(2*i,",").concat(o,`
            A`).concat(h,",").concat(h,",0,1,1,").concat(i,",").concat(o),className:"recharts-legend-icon"});if(n.type==="rect")return Ue.createElement("path",{stroke:"none",fill:m,d:"M0,".concat(Lu/8,"h").concat(Lu,"v").concat(Lu*3/4,"h").concat(-Lu,"z"),className:"recharts-legend-icon"});if(Ue.isValidElement(n.legendIcon)){var y=VFe({},n);return delete y.legendIcon,Ue.cloneElement(n.legendIcon,y)}return Ue.createElement(v$,{fill:m,cx:o,cy:o,size:Lu,sizeType:"diameter",type:n.type})}},{key:"renderItems",value:function(){var n=this,s=this.props,o=s.payload,h=s.iconSize,i=s.layout,m=s.formatter,y=s.inactiveColor,S={x:0,y:0,width:Lu,height:Lu},b={display:i==="horizontal"?"inline-block":"block",marginRight:10},T={display:"inline-block",verticalAlign:"middle",marginRight:4};return o.map(function(A,O){var P=A.formatter||m,I=Ii(PT(PT({"recharts-legend-item":!0},"legend-item-".concat(O),!0),"inactive",A.inactive));if(A.type==="none")return null;var R=vi(A.value)?null:A.value;Hd(!vi(A.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var M=A.inactive?y:A.color;return Ue.createElement("li",nz({className:I,style:b,key:"legend-item-".concat(O)},Fv(n.props,A,O)),Ue.createElement(KF,{width:h,height:h,viewBox:S,style:T},n.renderIcon(A)),Ue.createElement("span",{className:"recharts-legend-item-text",style:{color:M}},P?P(R,A,O):R))})}},{key:"render",value:function(){var n=this.props,s=n.payload,o=n.layout,h=n.align;if(!s||!s.length)return null;var i={padding:0,margin:0,textAlign:o==="horizontal"?h:"left"};return Ue.createElement("ul",{className:"recharts-default-legend",style:i},this.renderItems())}}])}(V.PureComponent);PT(_$,"displayName","Legend");PT(_$,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var JFe=XN;function QFe(){this.__data__=new JFe,this.size=0}var eze=QFe;function tze(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var rze=tze;function nze(e){return this.__data__.get(e)}var ize=nze;function sze(e){return this.__data__.has(e)}var aze=sze,oze=XN,lze=a$,cze=o$,uze=200;function dze(e,t){var r=this.__data__;if(r instanceof oze){var n=r.__data__;if(!lze||n.length<uze-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new cze(n)}return r.set(e,t),this.size=r.size,this}var hze=dze,fze=XN,pze=eze,mze=rze,gze=ize,yze=aze,vze=hze;function vw(e){var t=this.__data__=new fze(e);this.size=t.size}vw.prototype.clear=pze;vw.prototype.delete=mze;vw.prototype.get=gze;vw.prototype.has=yze;vw.prototype.set=vze;var ile=vw,_ze="__lodash_hash_undefined__";function xze(e){return this.__data__.set(e,_ze),this}var bze=xze;function wze(e){return this.__data__.has(e)}var Sze=wze,Eze=o$,Tze=bze,Aze=Sze;function LO(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new Eze;++t<r;)this.add(e[t])}LO.prototype.add=LO.prototype.push=Tze;LO.prototype.has=Aze;var sle=LO;function Cze(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var ale=Cze;function jze(e,t){return e.has(t)}var ole=jze,Pze=sle,Oze=ale,kze=ole,Nze=1,Ize=2;function Rze(e,t,r,n,s,o){var h=r&Nze,i=e.length,m=t.length;if(i!=m&&!(h&&m>i))return!1;var y=o.get(e),S=o.get(t);if(y&&S)return y==t&&S==e;var b=-1,T=!0,A=r&Ize?new Pze:void 0;for(o.set(e,t),o.set(t,e);++b<i;){var O=e[b],P=t[b];if(n)var I=h?n(P,O,b,t,e,o):n(O,P,b,e,t,o);if(I!==void 0){if(I)continue;T=!1;break}if(A){if(!Oze(t,function(R,M){if(!kze(A,M)&&(O===R||s(O,R,r,n,o)))return A.push(M)})){T=!1;break}}else if(!(O===P||s(O,P,r,n,o))){T=!1;break}}return o.delete(e),o.delete(t),T}var lle=Rze,Mze=rf,Dze=Mze.Uint8Array,Lze=Dze;function Fze(e){var t=-1,r=Array(e.size);return e.forEach(function(n,s){r[++t]=[s,n]}),r}var zze=Fze;function Bze(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var x$=Bze,LW=V2,FW=Lze,$ze=s$,Uze=lle,Vze=zze,qze=x$,Hze=1,Gze=2,Wze="[object Boolean]",Kze="[object Date]",Zze="[object Error]",Xze="[object Map]",Yze="[object Number]",Jze="[object RegExp]",Qze="[object Set]",e4e="[object String]",t4e="[object Symbol]",r4e="[object ArrayBuffer]",n4e="[object DataView]",zW=LW?LW.prototype:void 0,sL=zW?zW.valueOf:void 0;function i4e(e,t,r,n,s,o,h){switch(r){case n4e:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case r4e:return!(e.byteLength!=t.byteLength||!o(new FW(e),new FW(t)));case Wze:case Kze:case Yze:return $ze(+e,+t);case Zze:return e.name==t.name&&e.message==t.message;case Jze:case e4e:return e==t+"";case Xze:var i=Vze;case Qze:var m=n&Hze;if(i||(i=qze),e.size!=t.size&&!m)return!1;var y=h.get(e);if(y)return y==t;n|=Gze,h.set(e,t);var S=Uze(i(e),i(t),n,s,o,h);return h.delete(e),S;case t4e:if(sL)return sL.call(e)==sL.call(t)}return!1}var s4e=i4e;function a4e(e,t){for(var r=-1,n=t.length,s=e.length;++r<n;)e[s+r]=t[r];return e}var cle=a4e,o4e=cle,l4e=Qc;function c4e(e,t,r){var n=t(e);return l4e(e)?n:o4e(n,r(e))}var u4e=c4e;function d4e(e,t){for(var r=-1,n=e==null?0:e.length,s=0,o=[];++r<n;){var h=e[r];t(h,r,e)&&(o[s++]=h)}return o}var h4e=d4e;function f4e(){return[]}var p4e=f4e,m4e=h4e,g4e=p4e,y4e=Object.prototype,v4e=y4e.propertyIsEnumerable,BW=Object.getOwnPropertySymbols,_4e=BW?function(e){return e==null?[]:(e=Object(e),m4e(BW(e),function(t){return v4e.call(e,t)}))}:g4e,x4e=_4e;function b4e(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var w4e=b4e,S4e=gp,E4e=yp,T4e="[object Arguments]";function A4e(e){return E4e(e)&&S4e(e)==T4e}var C4e=A4e,$W=C4e,j4e=yp,ule=Object.prototype,P4e=ule.hasOwnProperty,O4e=ule.propertyIsEnumerable,k4e=$W(function(){return arguments}())?$W:function(e){return j4e(e)&&P4e.call(e,"callee")&&!O4e.call(e,"callee")},b$=k4e,FO={exports:{}};function N4e(){return!1}var I4e=N4e;FO.exports;(function(e,t){var r=rf,n=I4e,s=t&&!t.nodeType&&t,o=s&&!0&&e&&!e.nodeType&&e,h=o&&o.exports===s,i=h?r.Buffer:void 0,m=i?i.isBuffer:void 0,y=m||n;e.exports=y})(FO,FO.exports);var dle=FO.exports,R4e=9007199254740991,M4e=/^(?:0|[1-9]\d*)$/;function D4e(e,t){var r=typeof e;return t=t??R4e,!!t&&(r=="number"||r!="symbol"&&M4e.test(e))&&e>-1&&e%1==0&&e<t}var w$=D4e,L4e=9007199254740991;function F4e(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=L4e}var S$=F4e,z4e=gp,B4e=S$,$4e=yp,U4e="[object Arguments]",V4e="[object Array]",q4e="[object Boolean]",H4e="[object Date]",G4e="[object Error]",W4e="[object Function]",K4e="[object Map]",Z4e="[object Number]",X4e="[object Object]",Y4e="[object RegExp]",J4e="[object Set]",Q4e="[object String]",eBe="[object WeakMap]",tBe="[object ArrayBuffer]",rBe="[object DataView]",nBe="[object Float32Array]",iBe="[object Float64Array]",sBe="[object Int8Array]",aBe="[object Int16Array]",oBe="[object Int32Array]",lBe="[object Uint8Array]",cBe="[object Uint8ClampedArray]",uBe="[object Uint16Array]",dBe="[object Uint32Array]",ga={};ga[nBe]=ga[iBe]=ga[sBe]=ga[aBe]=ga[oBe]=ga[lBe]=ga[cBe]=ga[uBe]=ga[dBe]=!0;ga[U4e]=ga[V4e]=ga[tBe]=ga[q4e]=ga[rBe]=ga[H4e]=ga[G4e]=ga[W4e]=ga[K4e]=ga[Z4e]=ga[X4e]=ga[Y4e]=ga[J4e]=ga[Q4e]=ga[eBe]=!1;function hBe(e){return $4e(e)&&B4e(e.length)&&!!ga[z4e(e)]}var fBe=hBe;function pBe(e){return function(t){return e(t)}}var hle=pBe,zO={exports:{}};zO.exports;(function(e,t){var r=xoe,n=t&&!t.nodeType&&t,s=n&&!0&&e&&!e.nodeType&&e,o=s&&s.exports===n,h=o&&r.process,i=function(){try{var m=s&&s.require&&s.require("util").types;return m||h&&h.binding&&h.binding("util")}catch{}}();e.exports=i})(zO,zO.exports);var mBe=zO.exports,gBe=fBe,yBe=hle,UW=mBe,VW=UW&&UW.isTypedArray,vBe=VW?yBe(VW):gBe,fle=vBe,_Be=w4e,xBe=b$,bBe=Qc,wBe=dle,SBe=w$,EBe=fle,TBe=Object.prototype,ABe=TBe.hasOwnProperty;function CBe(e,t){var r=bBe(e),n=!r&&xBe(e),s=!r&&!n&&wBe(e),o=!r&&!n&&!s&&EBe(e),h=r||n||s||o,i=h?_Be(e.length,String):[],m=i.length;for(var y in e)(t||ABe.call(e,y))&&!(h&&(y=="length"||s&&(y=="offset"||y=="parent")||o&&(y=="buffer"||y=="byteLength"||y=="byteOffset")||SBe(y,m)))&&i.push(y);return i}var jBe=CBe,PBe=Object.prototype;function OBe(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||PBe;return e===r}var kBe=OBe;function NBe(e,t){return function(r){return e(t(r))}}var ple=NBe,IBe=ple,RBe=IBe(Object.keys,Object),MBe=RBe,DBe=kBe,LBe=MBe,FBe=Object.prototype,zBe=FBe.hasOwnProperty;function BBe(e){if(!DBe(e))return LBe(e);var t=[];for(var r in Object(e))zBe.call(e,r)&&r!="constructor"&&t.push(r);return t}var $Be=BBe,UBe=i$,VBe=S$;function qBe(e){return e!=null&&VBe(e.length)&&!UBe(e)}var H2=qBe,HBe=jBe,GBe=$Be,WBe=H2;function KBe(e){return WBe(e)?HBe(e):GBe(e)}var fI=KBe,ZBe=u4e,XBe=x4e,YBe=fI;function JBe(e){return ZBe(e,YBe,XBe)}var QBe=JBe,qW=QBe,e5e=1,t5e=Object.prototype,r5e=t5e.hasOwnProperty;function n5e(e,t,r,n,s,o){var h=r&e5e,i=qW(e),m=i.length,y=qW(t),S=y.length;if(m!=S&&!h)return!1;for(var b=m;b--;){var T=i[b];if(!(h?T in t:r5e.call(t,T)))return!1}var A=o.get(e),O=o.get(t);if(A&&O)return A==t&&O==e;var P=!0;o.set(e,t),o.set(t,e);for(var I=h;++b<m;){T=i[b];var R=e[T],M=t[T];if(n)var F=h?n(M,R,T,t,e,o):n(R,M,T,e,t,o);if(!(F===void 0?R===M||s(R,M,r,n,o):F)){P=!1;break}I||(I=T=="constructor")}if(P&&!I){var z=e.constructor,$=t.constructor;z!=$&&"constructor"in e&&"constructor"in t&&!(typeof z=="function"&&z instanceof z&&typeof $=="function"&&$ instanceof $)&&(P=!1)}return o.delete(e),o.delete(t),P}var i5e=n5e,s5e=e_,a5e=rf,o5e=s5e(a5e,"DataView"),l5e=o5e,c5e=e_,u5e=rf,d5e=c5e(u5e,"Promise"),h5e=d5e,f5e=e_,p5e=rf,m5e=f5e(p5e,"Set"),mle=m5e,g5e=e_,y5e=rf,v5e=g5e(y5e,"WeakMap"),_5e=v5e,sz=l5e,az=a$,oz=h5e,lz=mle,cz=_5e,gle=gp,_w=woe,HW="[object Map]",x5e="[object Object]",GW="[object Promise]",WW="[object Set]",KW="[object WeakMap]",ZW="[object DataView]",b5e=_w(sz),w5e=_w(az),S5e=_w(oz),E5e=_w(lz),T5e=_w(cz),$y=gle;(sz&&$y(new sz(new ArrayBuffer(1)))!=ZW||az&&$y(new az)!=HW||oz&&$y(oz.resolve())!=GW||lz&&$y(new lz)!=WW||cz&&$y(new cz)!=KW)&&($y=function(e){var t=gle(e),r=t==x5e?e.constructor:void 0,n=r?_w(r):"";if(n)switch(n){case b5e:return ZW;case w5e:return HW;case S5e:return GW;case E5e:return WW;case T5e:return KW}return t});var A5e=$y,aL=ile,C5e=lle,j5e=s4e,P5e=i5e,XW=A5e,YW=Qc,JW=dle,O5e=fle,k5e=1,QW="[object Arguments]",e7="[object Array]",Oj="[object Object]",N5e=Object.prototype,t7=N5e.hasOwnProperty;function I5e(e,t,r,n,s,o){var h=YW(e),i=YW(t),m=h?e7:XW(e),y=i?e7:XW(t);m=m==QW?Oj:m,y=y==QW?Oj:y;var S=m==Oj,b=y==Oj,T=m==y;if(T&&JW(e)){if(!JW(t))return!1;h=!0,S=!1}if(T&&!S)return o||(o=new aL),h||O5e(e)?C5e(e,t,r,n,s,o):j5e(e,t,m,r,n,s,o);if(!(r&k5e)){var A=S&&t7.call(e,"__wrapped__"),O=b&&t7.call(t,"__wrapped__");if(A||O){var P=A?e.value():e,I=O?t.value():t;return o||(o=new aL),s(P,I,r,n,o)}}return T?(o||(o=new aL),P5e(e,t,r,n,s,o)):!1}var R5e=I5e,M5e=R5e,r7=yp;function yle(e,t,r,n,s){return e===t?!0:e==null||t==null||!r7(e)&&!r7(t)?e!==e&&t!==t:M5e(e,t,r,n,yle,s)}var E$=yle,D5e=ile,L5e=E$,F5e=1,z5e=2;function B5e(e,t,r,n){var s=r.length,o=s,h=!n;if(e==null)return!o;for(e=Object(e);s--;){var i=r[s];if(h&&i[2]?i[1]!==e[i[0]]:!(i[0]in e))return!1}for(;++s<o;){i=r[s];var m=i[0],y=e[m],S=i[1];if(h&&i[2]){if(y===void 0&&!(m in e))return!1}else{var b=new D5e;if(n)var T=n(y,S,m,e,t,b);if(!(T===void 0?L5e(S,y,F5e|z5e,n,b):T))return!1}}return!0}var $5e=B5e,U5e=Ag;function V5e(e){return e===e&&!U5e(e)}var vle=V5e,q5e=vle,H5e=fI;function G5e(e){for(var t=H5e(e),r=t.length;r--;){var n=t[r],s=e[n];t[r]=[n,s,q5e(s)]}return t}var W5e=G5e;function K5e(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var _le=K5e,Z5e=$5e,X5e=W5e,Y5e=_le;function J5e(e){var t=X5e(e);return t.length==1&&t[0][2]?Y5e(t[0][0],t[0][1]):function(r){return r===e||Z5e(r,e,t)}}var Q5e=J5e;function e$e(e,t){return e!=null&&t in Object(e)}var t$e=e$e,r$e=Coe,n$e=b$,i$e=Qc,s$e=w$,a$e=S$,o$e=JN;function l$e(e,t,r){t=r$e(t,e);for(var n=-1,s=t.length,o=!1;++n<s;){var h=o$e(t[n]);if(!(o=e!=null&&r(e,h)))break;e=e[h]}return o||++n!=s?o:(s=e==null?0:e.length,!!s&&a$e(s)&&s$e(h,s)&&(i$e(e)||n$e(e)))}var c$e=l$e,u$e=t$e,d$e=c$e;function h$e(e,t){return e!=null&&d$e(e,t,u$e)}var f$e=h$e,p$e=E$,m$e=joe,g$e=f$e,y$e=n$,v$e=vle,_$e=_le,x$e=JN,b$e=1,w$e=2;function S$e(e,t){return y$e(e)&&v$e(t)?_$e(x$e(e),t):function(r){var n=m$e(r,e);return n===void 0&&n===t?g$e(r,e):p$e(t,n,b$e|w$e)}}var E$e=S$e;function T$e(e){return e}var xw=T$e;function A$e(e){return function(t){return t==null?void 0:t[e]}}var C$e=A$e,j$e=u$;function P$e(e){return function(t){return j$e(t,e)}}var O$e=P$e,k$e=C$e,N$e=O$e,I$e=n$,R$e=JN;function M$e(e){return I$e(e)?k$e(R$e(e)):N$e(e)}var D$e=M$e,L$e=Q5e,F$e=E$e,z$e=xw,B$e=Qc,$$e=D$e;function U$e(e){return typeof e=="function"?e:e==null?z$e:typeof e=="object"?B$e(e)?F$e(e[0],e[1]):L$e(e):$$e(e)}var nf=U$e;function V$e(e,t,r,n){for(var s=e.length,o=r+(n?1:-1);n?o--:++o<s;)if(t(e[o],o,e))return o;return-1}var xle=V$e;function q$e(e){return e!==e}var H$e=q$e;function G$e(e,t,r){for(var n=r-1,s=e.length;++n<s;)if(e[n]===t)return n;return-1}var W$e=G$e,K$e=xle,Z$e=H$e,X$e=W$e;function Y$e(e,t,r){return t===t?X$e(e,t,r):K$e(e,Z$e,r)}var J$e=Y$e,Q$e=J$e;function eUe(e,t){var r=e==null?0:e.length;return!!r&&Q$e(e,t,0)>-1}var tUe=eUe;function rUe(e,t,r){for(var n=-1,s=e==null?0:e.length;++n<s;)if(r(t,e[n]))return!0;return!1}var nUe=rUe;function iUe(){}var sUe=iUe,oL=mle,aUe=sUe,oUe=x$,lUe=1/0,cUe=oL&&1/oUe(new oL([,-0]))[1]==lUe?function(e){return new oL(e)}:aUe,uUe=cUe,dUe=sle,hUe=tUe,fUe=nUe,pUe=ole,mUe=uUe,gUe=x$,yUe=200;function vUe(e,t,r){var n=-1,s=hUe,o=e.length,h=!0,i=[],m=i;if(r)h=!1,s=fUe;else if(o>=yUe){var y=t?null:mUe(e);if(y)return gUe(y);h=!1,s=pUe,m=new dUe}else m=t?[]:i;e:for(;++n<o;){var S=e[n],b=t?t(S):S;if(S=r||S!==0?S:0,h&&b===b){for(var T=m.length;T--;)if(m[T]===b)continue e;t&&m.push(b),i.push(S)}else s(m,b,r)||(m!==i&&m.push(b),i.push(S))}return i}var _Ue=vUe,xUe=nf,bUe=_Ue;function wUe(e,t){return e&&e.length?bUe(e,xUe(t)):[]}var SUe=wUe;const n7=Os(SUe);function ble(e,t,r){return t===!0?n7(e,r):vi(t)?n7(e,t):e}function Tb(e){"@babel/helpers - typeof";return Tb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tb(e)}var EUe=["ref"];function i7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function kf(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?i7(Object(r),!0).forEach(function(n){pI(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function TUe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Sle(n.key),n)}}function AUe(e,t,r){return t&&s7(e.prototype,t),r&&s7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function CUe(e,t,r){return t=BO(t),jUe(e,wle()?Reflect.construct(t,r||[],BO(e).constructor):t.apply(e,r))}function jUe(e,t){if(t&&(Tb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return PUe(e)}function PUe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(wle=function(){return!!e})()}function BO(e){return BO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},BO(e)}function OUe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&uz(e,t)}function uz(e,t){return uz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},uz(e,t)}function pI(e,t,r){return t=Sle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Sle(e){var t=kUe(e,"string");return Tb(t)=="symbol"?t:t+""}function kUe(e,t){if(Tb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Tb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function NUe(e,t){if(e==null)return{};var r=IUe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function IUe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function RUe(e){return e.value}function MUe(e,t){if(Ue.isValidElement(e))return Ue.cloneElement(e,t);if(typeof e=="function")return Ue.createElement(e,t);t.ref;var r=NUe(t,EUe);return Ue.createElement(_$,r)}var a7=1,Ih=function(e){function t(){var r;TUe(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=CUe(this,t,[].concat(s)),pI(r,"lastBoundingBox",{width:-1,height:-1}),r}return OUe(t,e),AUe(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();return n.height=this.wrapperNode.offsetHeight,n.width=this.wrapperNode.offsetWidth,n}return null}},{key:"updateBBox",value:function(){var n=this.props.onBBoxUpdate,s=this.getBBox();s?(Math.abs(s.width-this.lastBoundingBox.width)>a7||Math.abs(s.height-this.lastBoundingBox.height)>a7)&&(this.lastBoundingBox.width=s.width,this.lastBoundingBox.height=s.height,n&&n(s)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,n&&n(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?kf({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(n){var s=this.props,o=s.layout,h=s.align,i=s.verticalAlign,m=s.margin,y=s.chartWidth,S=s.chartHeight,b,T;if(!n||(n.left===void 0||n.left===null)&&(n.right===void 0||n.right===null))if(h==="center"&&o==="vertical"){var A=this.getBBoxSnapshot();b={left:((y||0)-A.width)/2}}else b=h==="right"?{right:m&&m.right||0}:{left:m&&m.left||0};if(!n||(n.top===void 0||n.top===null)&&(n.bottom===void 0||n.bottom===null))if(i==="middle"){var O=this.getBBoxSnapshot();T={top:((S||0)-O.height)/2}}else T=i==="bottom"?{bottom:m&&m.bottom||0}:{top:m&&m.top||0};return kf(kf({},b),T)}},{key:"render",value:function(){var n=this,s=this.props,o=s.content,h=s.width,i=s.height,m=s.wrapperStyle,y=s.payloadUniqBy,S=s.payload,b=kf(kf({position:"absolute",width:h||"auto",height:i||"auto"},this.getDefaultPosition(m)),m);return Ue.createElement("div",{className:"recharts-legend-wrapper",style:b,ref:function(A){n.wrapperNode=A}},MUe(o,kf(kf({},this.props),{},{payload:ble(S,y,RUe)})))}}],[{key:"getWithHeight",value:function(n,s){var o=kf(kf({},this.defaultProps),n.props),h=o.layout;return h==="vertical"&&Gr(n.props.height)?{height:n.props.height}:h==="horizontal"?{width:n.props.width||s}:null}}])}(V.PureComponent);pI(Ih,"displayName","Legend");pI(Ih,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var o7=V2,DUe=b$,LUe=Qc,l7=o7?o7.isConcatSpreadable:void 0;function FUe(e){return LUe(e)||DUe(e)||!!(l7&&e&&e[l7])}var zUe=FUe,BUe=cle,$Ue=zUe;function Ele(e,t,r,n,s){var o=-1,h=e.length;for(r||(r=$Ue),s||(s=[]);++o<h;){var i=e[o];t>0&&r(i)?t>1?Ele(i,t-1,r,n,s):BUe(s,i):n||(s[s.length]=i)}return s}var Tle=Ele;function UUe(e){return function(t,r,n){for(var s=-1,o=Object(t),h=n(t),i=h.length;i--;){var m=h[e?i:++s];if(r(o[m],m,o)===!1)break}return t}}var VUe=UUe,qUe=VUe,HUe=qUe(),GUe=HUe,WUe=GUe,KUe=fI;function ZUe(e,t){return e&&WUe(e,t,KUe)}var Ale=ZUe,XUe=H2;function YUe(e,t){return function(r,n){if(r==null)return r;if(!XUe(r))return e(r,n);for(var s=r.length,o=t?s:-1,h=Object(r);(t?o--:++o<s)&&n(h[o],o,h)!==!1;);return r}}var JUe=YUe,QUe=Ale,eVe=JUe,tVe=eVe(QUe),T$=tVe,rVe=T$,nVe=H2;function iVe(e,t){var r=-1,n=nVe(e)?Array(e.length):[];return rVe(e,function(s,o,h){n[++r]=t(s,o,h)}),n}var Cle=iVe;function sVe(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}var aVe=sVe,c7=hw;function oVe(e,t){if(e!==t){var r=e!==void 0,n=e===null,s=e===e,o=c7(e),h=t!==void 0,i=t===null,m=t===t,y=c7(t);if(!i&&!y&&!o&&e>t||o&&h&&m&&!i&&!y||n&&h&&m||!r&&m||!s)return 1;if(!n&&!o&&!y&&e<t||y&&r&&s&&!n&&!o||i&&r&&s||!h&&s||!m)return-1}return 0}var lVe=oVe,cVe=lVe;function uVe(e,t,r){for(var n=-1,s=e.criteria,o=t.criteria,h=s.length,i=r.length;++n<h;){var m=cVe(s[n],o[n]);if(m){if(n>=i)return m;var y=r[n];return m*(y=="desc"?-1:1)}}return e.index-t.index}var dVe=uVe,lL=c$,hVe=u$,fVe=nf,pVe=Cle,mVe=aVe,gVe=hle,yVe=dVe,vVe=xw,_Ve=Qc;function xVe(e,t,r){t.length?t=lL(t,function(o){return _Ve(o)?function(h){return hVe(h,o.length===1?o[0]:o)}:o}):t=[vVe];var n=-1;t=lL(t,gVe(fVe));var s=pVe(e,function(o,h,i){var m=lL(t,function(y){return y(o)});return{criteria:m,index:++n,value:o}});return mVe(s,function(o,h){return yVe(o,h,r)})}var bVe=xVe;function wVe(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var SVe=wVe,EVe=SVe,u7=Math.max;function TVe(e,t,r){return t=u7(t===void 0?e.length-1:t,0),function(){for(var n=arguments,s=-1,o=u7(n.length-t,0),h=Array(o);++s<o;)h[s]=n[t+s];s=-1;for(var i=Array(t+1);++s<t;)i[s]=n[s];return i[t]=r(h),EVe(e,this,i)}}var AVe=TVe;function CVe(e){return function(){return e}}var jVe=CVe,PVe=e_,OVe=function(){try{var e=PVe(Object,"defineProperty");return e({},"",{}),e}catch{}}(),jle=OVe,kVe=jVe,d7=jle,NVe=xw,IVe=d7?function(e,t){return d7(e,"toString",{configurable:!0,enumerable:!1,value:kVe(t),writable:!0})}:NVe,RVe=IVe,MVe=800,DVe=16,LVe=Date.now;function FVe(e){var t=0,r=0;return function(){var n=LVe(),s=DVe-(n-r);if(r=n,s>0){if(++t>=MVe)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var zVe=FVe,BVe=RVe,$Ve=zVe,UVe=$Ve(BVe),VVe=UVe,qVe=xw,HVe=AVe,GVe=VVe;function WVe(e,t){return GVe(HVe(e,t,qVe),e+"")}var KVe=WVe,ZVe=s$,XVe=H2,YVe=w$,JVe=Ag;function QVe(e,t,r){if(!JVe(r))return!1;var n=typeof t;return(n=="number"?XVe(r)&&YVe(t,r.length):n=="string"&&t in r)?ZVe(r[t],e):!1}var mI=QVe,e6e=Tle,t6e=bVe,r6e=KVe,h7=mI,n6e=r6e(function(e,t){if(e==null)return[];var r=t.length;return r>1&&h7(e,t[0],t[1])?t=[]:r>2&&h7(t[0],t[1],t[2])&&(t=[t[0]]),t6e(e,e6e(t,1),[])}),i6e=n6e;const A$=Os(i6e);function OT(e){"@babel/helpers - typeof";return OT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},OT(e)}function dz(){return dz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},dz.apply(this,arguments)}function s6e(e,t){return c6e(e)||l6e(e,t)||o6e(e,t)||a6e()}function a6e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function o6e(e,t){if(e){if(typeof e=="string")return f7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f7(e,t)}}function f7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function l6e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,h,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(h=r.return(),Object(h)!==h))return}finally{if(y)throw s}}return i}}function c6e(e){if(Array.isArray(e))return e}function p7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function cL(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?p7(Object(r),!0).forEach(function(n){u6e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function u6e(e,t,r){return t=d6e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function d6e(e){var t=h6e(e,"string");return OT(t)=="symbol"?t:t+""}function h6e(e,t){if(OT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(OT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function f6e(e){return Array.isArray(e)&&Xo(e[0])&&Xo(e[1])?e.join(" ~ "):e}var p6e=function(t){var r=t.separator,n=r===void 0?" : ":r,s=t.contentStyle,o=s===void 0?{}:s,h=t.itemStyle,i=h===void 0?{}:h,m=t.labelStyle,y=m===void 0?{}:m,S=t.payload,b=t.formatter,T=t.itemSorter,A=t.wrapperClassName,O=t.labelClassName,P=t.label,I=t.labelFormatter,R=t.accessibilityLayer,M=R===void 0?!1:R,F=function(){if(S&&S.length){var te={padding:0,margin:0},ae=(T?A$(S,T):S).map(function(ue,be){if(ue.type==="none")return null;var we=cL({display:"block",paddingTop:4,paddingBottom:4,color:ue.color||"#000"},i),Ce=ue.formatter||b||f6e,_e=ue.value,me=ue.name,Ae=_e,ge=me;if(Ce&&Ae!=null&&ge!=null){var pe=Ce(_e,me,ue,be,S);if(Array.isArray(pe)){var Oe=s6e(pe,2);Ae=Oe[0],ge=Oe[1]}else Ae=pe}return Ue.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(be),style:we},Xo(ge)?Ue.createElement("span",{className:"recharts-tooltip-item-name"},ge):null,Xo(ge)?Ue.createElement("span",{className:"recharts-tooltip-item-separator"},n):null,Ue.createElement("span",{className:"recharts-tooltip-item-value"},Ae),Ue.createElement("span",{className:"recharts-tooltip-item-unit"},ue.unit||""))});return Ue.createElement("ul",{className:"recharts-tooltip-item-list",style:te},ae)}return null},z=cL({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},o),$=cL({margin:0},y),W=!ki(P),K=W?P:"",ee=Ii("recharts-default-tooltip",A),ne=Ii("recharts-tooltip-label",O);W&&I&&S!==void 0&&S!==null&&(K=I(P,S));var ie=M?{role:"status","aria-live":"assertive"}:{};return Ue.createElement("div",dz({className:ee,style:z},ie),Ue.createElement("p",{className:ne,style:$},Ue.isValidElement(K)?K:"".concat(K)),F())};function kT(e){"@babel/helpers - typeof";return kT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kT(e)}function kj(e,t,r){return t=m6e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m6e(e){var t=g6e(e,"string");return kT(t)=="symbol"?t:t+""}function g6e(e,t){if(kT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(kT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var KS="recharts-tooltip-wrapper",y6e={visibility:"hidden"};function v6e(e){var t=e.coordinate,r=e.translateX,n=e.translateY;return Ii(KS,kj(kj(kj(kj({},"".concat(KS,"-right"),Gr(r)&&t&&Gr(t.x)&&r>=t.x),"".concat(KS,"-left"),Gr(r)&&t&&Gr(t.x)&&r<t.x),"".concat(KS,"-bottom"),Gr(n)&&t&&Gr(t.y)&&n>=t.y),"".concat(KS,"-top"),Gr(n)&&t&&Gr(t.y)&&n<t.y))}function m7(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.key,s=e.offsetTopLeft,o=e.position,h=e.reverseDirection,i=e.tooltipDimension,m=e.viewBox,y=e.viewBoxDimension;if(o&&Gr(o[n]))return o[n];var S=r[n]-i-s,b=r[n]+s;if(t[n])return h[n]?S:b;if(h[n]){var T=S,A=m[n];return T<A?Math.max(b,m[n]):Math.max(S,m[n])}var O=b+i,P=m[n]+y;return O>P?Math.max(S,m[n]):Math.max(b,m[n])}function _6e(e){var t=e.translateX,r=e.translateY,n=e.useTranslate3d;return{transform:n?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}function x6e(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.offsetTopLeft,s=e.position,o=e.reverseDirection,h=e.tooltipBox,i=e.useTranslate3d,m=e.viewBox,y,S,b;return h.height>0&&h.width>0&&r?(S=m7({allowEscapeViewBox:t,coordinate:r,key:"x",offsetTopLeft:n,position:s,reverseDirection:o,tooltipDimension:h.width,viewBox:m,viewBoxDimension:m.width}),b=m7({allowEscapeViewBox:t,coordinate:r,key:"y",offsetTopLeft:n,position:s,reverseDirection:o,tooltipDimension:h.height,viewBox:m,viewBoxDimension:m.height}),y=_6e({translateX:S,translateY:b,useTranslate3d:i})):y=y6e,{cssProperties:y,cssClasses:v6e({translateX:S,translateY:b,coordinate:r})}}function Ab(e){"@babel/helpers - typeof";return Ab=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ab(e)}function g7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function y7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?g7(Object(r),!0).forEach(function(n){fz(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function b6e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w6e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ole(n.key),n)}}function S6e(e,t,r){return t&&w6e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function E6e(e,t,r){return t=$O(t),T6e(e,Ple()?Reflect.construct(t,r||[],$O(e).constructor):t.apply(e,r))}function T6e(e,t){if(t&&(Ab(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return A6e(e)}function A6e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ple(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ple=function(){return!!e})()}function $O(e){return $O=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},$O(e)}function C6e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&hz(e,t)}function hz(e,t){return hz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},hz(e,t)}function fz(e,t,r){return t=Ole(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ole(e){var t=j6e(e,"string");return Ab(t)=="symbol"?t:t+""}function j6e(e,t){if(Ab(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Ab(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var v7=1,P6e=function(e){function t(){var r;b6e(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=E6e(this,t,[].concat(s)),fz(r,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),fz(r,"handleKeyDown",function(h){if(h.key==="Escape"){var i,m,y,S;r.setState({dismissed:!0,dismissedAtCoordinate:{x:(i=(m=r.props.coordinate)===null||m===void 0?void 0:m.x)!==null&&i!==void 0?i:0,y:(y=(S=r.props.coordinate)===null||S===void 0?void 0:S.y)!==null&&y!==void 0?y:0}})}}),r}return C6e(t,e),S6e(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();(Math.abs(n.width-this.state.lastBoundingBox.width)>v7||Math.abs(n.height-this.state.lastBoundingBox.height)>v7)&&this.setState({lastBoundingBox:{width:n.width,height:n.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var n,s;this.props.active&&this.updateBBox(),this.state.dismissed&&(((n=this.props.coordinate)===null||n===void 0?void 0:n.x)!==this.state.dismissedAtCoordinate.x||((s=this.props.coordinate)===null||s===void 0?void 0:s.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var n=this,s=this.props,o=s.active,h=s.allowEscapeViewBox,i=s.animationDuration,m=s.animationEasing,y=s.children,S=s.coordinate,b=s.hasPayload,T=s.isAnimationActive,A=s.offset,O=s.position,P=s.reverseDirection,I=s.useTranslate3d,R=s.viewBox,M=s.wrapperStyle,F=x6e({allowEscapeViewBox:h,coordinate:S,offsetTopLeft:A,position:O,reverseDirection:P,tooltipBox:this.state.lastBoundingBox,useTranslate3d:I,viewBox:R}),z=F.cssClasses,$=F.cssProperties,W=y7(y7({transition:T&&o?"transform ".concat(i,"ms ").concat(m):void 0},$),{},{pointerEvents:"none",visibility:!this.state.dismissed&&o&&b?"visible":"hidden",position:"absolute",top:0,left:0},M);return Ue.createElement("div",{tabIndex:-1,className:z,style:W,ref:function(ee){n.wrapperNode=ee}},y)}}])}(V.PureComponent),O6e=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},Uh={isSsr:O6e(),get:function(t){return Uh[t]},set:function(t,r){if(typeof t=="string")Uh[t]=r;else{var n=Object.keys(t);n&&n.length&&n.forEach(function(s){Uh[s]=t[s]})}}};function Cb(e){"@babel/helpers - typeof";return Cb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cb(e)}function _7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function x7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_7(Object(r),!0).forEach(function(n){C$(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function k6e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N6e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Nle(n.key),n)}}function I6e(e,t,r){return t&&N6e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function R6e(e,t,r){return t=UO(t),M6e(e,kle()?Reflect.construct(t,r||[],UO(e).constructor):t.apply(e,r))}function M6e(e,t){if(t&&(Cb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return D6e(e)}function D6e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function kle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(kle=function(){return!!e})()}function UO(e){return UO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},UO(e)}function L6e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pz(e,t)}function pz(e,t){return pz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},pz(e,t)}function C$(e,t,r){return t=Nle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Nle(e){var t=F6e(e,"string");return Cb(t)=="symbol"?t:t+""}function F6e(e,t){if(Cb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Cb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function z6e(e){return e.dataKey}function B6e(e,t){return Ue.isValidElement(e)?Ue.cloneElement(e,t):typeof e=="function"?Ue.createElement(e,t):Ue.createElement(p6e,t)}var Sl=function(e){function t(){return k6e(this,t),R6e(this,t,arguments)}return L6e(t,e),I6e(t,[{key:"render",value:function(){var n=this,s=this.props,o=s.active,h=s.allowEscapeViewBox,i=s.animationDuration,m=s.animationEasing,y=s.content,S=s.coordinate,b=s.filterNull,T=s.isAnimationActive,A=s.offset,O=s.payload,P=s.payloadUniqBy,I=s.position,R=s.reverseDirection,M=s.useTranslate3d,F=s.viewBox,z=s.wrapperStyle,$=O??[];b&&$.length&&($=ble(O.filter(function(K){return K.value!=null&&(K.hide!==!0||n.props.includeHidden)}),P,z6e));var W=$.length>0;return Ue.createElement(P6e,{allowEscapeViewBox:h,animationDuration:i,animationEasing:m,isAnimationActive:T,active:o,coordinate:S,hasPayload:W,offset:A,position:I,reverseDirection:R,useTranslate3d:M,viewBox:F,wrapperStyle:z},B6e(y,x7(x7({},this.props),{},{payload:$})))}}])}(V.PureComponent);C$(Sl,"displayName","Tooltip");C$(Sl,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!Uh.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var $6e=rf,U6e=function(){return $6e.Date.now()},V6e=U6e,q6e=/\s/;function H6e(e){for(var t=e.length;t--&&q6e.test(e.charAt(t)););return t}var G6e=H6e,W6e=G6e,K6e=/^\s+/;function Z6e(e){return e&&e.slice(0,W6e(e)+1).replace(K6e,"")}var X6e=Z6e,Y6e=X6e,b7=Ag,J6e=hw,w7=NaN,Q6e=/^[-+]0x[0-9a-f]+$/i,e8e=/^0b[01]+$/i,t8e=/^0o[0-7]+$/i,r8e=parseInt;function n8e(e){if(typeof e=="number")return e;if(J6e(e))return w7;if(b7(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=b7(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Y6e(e);var r=e8e.test(e);return r||t8e.test(e)?r8e(e.slice(2),r?2:8):Q6e.test(e)?w7:+e}var Ile=n8e,i8e=Ag,uL=V6e,S7=Ile,s8e="Expected a function",a8e=Math.max,o8e=Math.min;function l8e(e,t,r){var n,s,o,h,i,m,y=0,S=!1,b=!1,T=!0;if(typeof e!="function")throw new TypeError(s8e);t=S7(t)||0,i8e(r)&&(S=!!r.leading,b="maxWait"in r,o=b?a8e(S7(r.maxWait)||0,t):o,T="trailing"in r?!!r.trailing:T);function A(W){var K=n,ee=s;return n=s=void 0,y=W,h=e.apply(ee,K),h}function O(W){return y=W,i=setTimeout(R,t),S?A(W):h}function P(W){var K=W-m,ee=W-y,ne=t-K;return b?o8e(ne,o-ee):ne}function I(W){var K=W-m,ee=W-y;return m===void 0||K>=t||K<0||b&&ee>=o}function R(){var W=uL();if(I(W))return M(W);i=setTimeout(R,P(W))}function M(W){return i=void 0,T&&n?A(W):(n=s=void 0,h)}function F(){i!==void 0&&clearTimeout(i),y=0,n=m=s=i=void 0}function z(){return i===void 0?h:M(uL())}function $(){var W=uL(),K=I(W);if(n=arguments,s=this,m=W,K){if(i===void 0)return O(m);if(b)return clearTimeout(i),i=setTimeout(R,t),A(m)}return i===void 0&&(i=setTimeout(R,t)),h}return $.cancel=F,$.flush=z,$}var c8e=l8e,u8e=c8e,d8e=Ag,h8e="Expected a function";function f8e(e,t,r){var n=!0,s=!0;if(typeof e!="function")throw new TypeError(h8e);return d8e(r)&&(n="leading"in r?!!r.leading:n,s="trailing"in r?!!r.trailing:s),u8e(e,t,{leading:n,maxWait:t,trailing:s})}var p8e=f8e;const Rle=Os(p8e);function NT(e){"@babel/helpers - typeof";return NT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},NT(e)}function E7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Nj(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?E7(Object(r),!0).forEach(function(n){m8e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function m8e(e,t,r){return t=g8e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function g8e(e){var t=y8e(e,"string");return NT(t)=="symbol"?t:t+""}function y8e(e,t){if(NT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(NT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function v8e(e,t){return w8e(e)||b8e(e,t)||x8e(e,t)||_8e()}function _8e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function x8e(e,t){if(e){if(typeof e=="string")return T7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return T7(e,t)}}function T7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function b8e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,h,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(h=r.return(),Object(h)!==h))return}finally{if(y)throw s}}return i}}function w8e(e){if(Array.isArray(e))return e}var Hm=V.forwardRef(function(e,t){var r=e.aspect,n=e.initialDimension,s=n===void 0?{width:-1,height:-1}:n,o=e.width,h=o===void 0?"100%":o,i=e.height,m=i===void 0?"100%":i,y=e.minWidth,S=y===void 0?0:y,b=e.minHeight,T=e.maxHeight,A=e.children,O=e.debounce,P=O===void 0?0:O,I=e.id,R=e.className,M=e.onResize,F=e.style,z=F===void 0?{}:F,$=V.useRef(null),W=V.useRef();W.current=M,V.useImperativeHandle(t,function(){return Object.defineProperty($.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),$.current},configurable:!0})});var K=V.useState({containerWidth:s.width,containerHeight:s.height}),ee=v8e(K,2),ne=ee[0],ie=ee[1],re=V.useCallback(function(ae,ue){ie(function(be){var we=Math.round(ae),Ce=Math.round(ue);return be.containerWidth===we&&be.containerHeight===Ce?be:{containerWidth:we,containerHeight:Ce}})},[]);V.useEffect(function(){var ae=function(me){var Ae,ge=me[0].contentRect,pe=ge.width,Oe=ge.height;re(pe,Oe),(Ae=W.current)===null||Ae===void 0||Ae.call(W,pe,Oe)};P>0&&(ae=Rle(ae,P,{trailing:!0,leading:!1}));var ue=new ResizeObserver(ae),be=$.current.getBoundingClientRect(),we=be.width,Ce=be.height;return re(we,Ce),ue.observe($.current),function(){ue.disconnect()}},[re,P]);var te=V.useMemo(function(){var ae=ne.containerWidth,ue=ne.containerHeight;if(ae<0||ue<0)return null;Hd(Yy(h)||Yy(m),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,h,m),Hd(!r||r>0,"The aspect(%s) must be greater than zero.",r);var be=Yy(h)?ae:h,we=Yy(m)?ue:m;r&&r>0&&(be?we=be/r:we&&(be=we*r),T&&we>T&&(we=T)),Hd(be>0||we>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,be,we,h,m,S,b,r);var Ce=!Array.isArray(A)&&Xf(A.type).endsWith("Chart");return Ue.Children.map(A,function(_e){return Ue.isValidElement(_e)?V.cloneElement(_e,Nj({width:be,height:we},Ce?{style:Nj({height:"100%",width:"100%",maxHeight:we,maxWidth:be},_e.props.style)}:{})):_e})},[r,A,m,T,b,S,ne,h]);return Ue.createElement("div",{id:I?"".concat(I):void 0,className:Ii("recharts-responsive-container",R),style:Nj(Nj({},z),{},{width:h,height:m,minWidth:S,minHeight:b,maxHeight:T}),ref:$},te)}),IT=function(t){return null};IT.displayName="Cell";function RT(e){"@babel/helpers - typeof";return RT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},RT(e)}function A7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function mz(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?A7(Object(r),!0).forEach(function(n){S8e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function S8e(e,t,r){return t=E8e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function E8e(e){var t=T8e(e,"string");return RT(t)=="symbol"?t:t+""}function T8e(e,t){if(RT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(RT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Vx={widthCache:{},cacheCount:0},A8e=2e3,C8e={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},C7="recharts_measurement_span";function j8e(e){var t=mz({},e);return Object.keys(t).forEach(function(r){t[r]||delete t[r]}),t}var LE=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||Uh.isSsr)return{width:0,height:0};var n=j8e(r),s=JSON.stringify({text:t,copyStyle:n});if(Vx.widthCache[s])return Vx.widthCache[s];try{var o=document.getElementById(C7);o||(o=document.createElement("span"),o.setAttribute("id",C7),o.setAttribute("aria-hidden","true"),document.body.appendChild(o));var h=mz(mz({},C8e),n);Object.assign(o.style,h),o.textContent="".concat(t);var i=o.getBoundingClientRect(),m={width:i.width,height:i.height};return Vx.widthCache[s]=m,++Vx.cacheCount>A8e&&(Vx.cacheCount=0,Vx.widthCache={}),m}catch{return{width:0,height:0}}},P8e=function(t){return{top:t.top+window.scrollY-document.documentElement.clientTop,left:t.left+window.scrollX-document.documentElement.clientLeft}};function MT(e){"@babel/helpers - typeof";return MT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},MT(e)}function VO(e,t){return I8e(e)||N8e(e,t)||k8e(e,t)||O8e()}function O8e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function k8e(e,t){if(e){if(typeof e=="string")return j7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return j7(e,t)}}function j7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function N8e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,h,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;m=!1}else for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(h=r.return(),Object(h)!==h))return}finally{if(y)throw s}}return i}}function I8e(e){if(Array.isArray(e))return e}function R8e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,D8e(n.key),n)}}function M8e(e,t,r){return t&&P7(e.prototype,t),r&&P7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function D8e(e){var t=L8e(e,"string");return MT(t)=="symbol"?t:t+""}function L8e(e,t){if(MT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(MT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var O7=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,k7=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,F8e=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,z8e=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,Mle={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},B8e=Object.keys(Mle),p0="NaN";function $8e(e,t){return e*Mle[t]}var Ij=function(){function e(t,r){R8e(this,e),this.num=t,this.unit=r,this.num=t,this.unit=r,Number.isNaN(t)&&(this.unit=""),r!==""&&!F8e.test(r)&&(this.num=NaN,this.unit=""),B8e.includes(r)&&(this.num=$8e(t,r),this.unit="px")}return M8e(e,[{key:"add",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num+r.num,this.unit)}},{key:"subtract",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num-r.num,this.unit)}},{key:"multiply",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num*r.num,this.unit||r.unit)}},{key:"divide",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num/r.num,this.unit||r.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(r){var n,s=(n=z8e.exec(r))!==null&&n!==void 0?n:[],o=VO(s,3),h=o[1],i=o[2];return new e(parseFloat(h),i??"")}}])}();function Dle(e){if(e.includes(p0))return p0;for(var t=e;t.includes("*")||t.includes("/");){var r,n=(r=O7.exec(t))!==null&&r!==void 0?r:[],s=VO(n,4),o=s[1],h=s[2],i=s[3],m=Ij.parse(o??""),y=Ij.parse(i??""),S=h==="*"?m.multiply(y):m.divide(y);if(S.isNaN())return p0;t=t.replace(O7,S.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var b,T=(b=k7.exec(t))!==null&&b!==void 0?b:[],A=VO(T,4),O=A[1],P=A[2],I=A[3],R=Ij.parse(O??""),M=Ij.parse(I??""),F=P==="+"?R.add(M):R.subtract(M);if(F.isNaN())return p0;t=t.replace(k7,F.toString())}return t}var N7=/\(([^()]*)\)/;function U8e(e){for(var t=e;t.includes("(");){var r=N7.exec(t),n=VO(r,2),s=n[1];t=t.replace(N7,Dle(s))}return t}function V8e(e){var t=e.replace(/\s+/g,"");return t=U8e(t),t=Dle(t),t}function q8e(e){try{return V8e(e)}catch{return p0}}function dL(e){var t=q8e(e.slice(5,-1));return t===p0?"":t}var H8e=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],G8e=["dx","dy","angle","className","breakAll"];function gz(){return gz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},gz.apply(this,arguments)}function I7(e,t){if(e==null)return{};var r=W8e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function W8e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function R7(e,t){return Y8e(e)||X8e(e,t)||Z8e(e,t)||K8e()}function K8e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Z8e(e,t){if(e){if(typeof e=="string")return M7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return M7(e,t)}}function M7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function X8e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,h,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;m=!1}else for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(h=r.return(),Object(h)!==h))return}finally{if(y)throw s}}return i}}function Y8e(e){if(Array.isArray(e))return e}var Lle=/[ \f\n\r\t\v\u2028\u2029]+/,Fle=function(t){var r=t.children,n=t.breakAll,s=t.style;try{var o=[];ki(r)||(n?o=r.toString().split(""):o=r.toString().split(Lle));var h=o.map(function(m){return{word:m,width:LE(m,s).width}}),i=n?0:LE("",s).width;return{wordsWithComputedWidth:h,spaceWidth:i}}catch{return null}},J8e=function(t,r,n,s,o){var h=t.maxLines,i=t.children,m=t.style,y=t.breakAll,S=Gr(h),b=i,T=function(){var be=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return be.reduce(function(we,Ce){var _e=Ce.word,me=Ce.width,Ae=we[we.length-1];if(Ae&&(s==null||o||Ae.width+me+n<Number(s)))Ae.words.push(_e),Ae.width+=me+n;else{var ge={words:[_e],width:me};we.push(ge)}return we},[])},A=T(r),O=function(be){return be.reduce(function(we,Ce){return we.width>Ce.width?we:Ce})};if(!S)return A;for(var P="",I=function(be){var we=b.slice(0,be),Ce=Fle({breakAll:y,style:m,children:we+P}).wordsWithComputedWidth,_e=T(Ce),me=_e.length>h||O(_e).width>Number(s);return[me,_e]},R=0,M=b.length-1,F=0,z;R<=M&&F<=b.length-1;){var $=Math.floor((R+M)/2),W=$-1,K=I(W),ee=R7(K,2),ne=ee[0],ie=ee[1],re=I($),te=R7(re,1),ae=te[0];if(!ne&&!ae&&(R=$+1),ne&&ae&&(M=$-1),!ne&&ae){z=ie;break}F++}return z||A},D7=function(t){var r=ki(t)?[]:t.toString().split(Lle);return[{words:r}]},Q8e=function(t){var r=t.width,n=t.scaleToFit,s=t.children,o=t.style,h=t.breakAll,i=t.maxLines;if((r||n)&&!Uh.isSsr){var m,y,S=Fle({breakAll:h,children:s,style:o});if(S){var b=S.wordsWithComputedWidth,T=S.spaceWidth;m=b,y=T}else return D7(s);return J8e({breakAll:h,children:s,maxLines:i,style:o},m,y,r,n)}return D7(s)},L7="#808080",zv=function(t){var r=t.x,n=r===void 0?0:r,s=t.y,o=s===void 0?0:s,h=t.lineHeight,i=h===void 0?"1em":h,m=t.capHeight,y=m===void 0?"0.71em":m,S=t.scaleToFit,b=S===void 0?!1:S,T=t.textAnchor,A=T===void 0?"start":T,O=t.verticalAnchor,P=O===void 0?"end":O,I=t.fill,R=I===void 0?L7:I,M=I7(t,H8e),F=V.useMemo(function(){return Q8e({breakAll:M.breakAll,children:M.children,maxLines:M.maxLines,scaleToFit:b,style:M.style,width:M.width})},[M.breakAll,M.children,M.maxLines,b,M.style,M.width]),z=M.dx,$=M.dy,W=M.angle,K=M.className,ee=M.breakAll,ne=I7(M,G8e);if(!Xo(n)||!Xo(o))return null;var ie=n+(Gr(z)?z:0),re=o+(Gr($)?$:0),te;switch(P){case"start":te=dL("calc(".concat(y,")"));break;case"middle":te=dL("calc(".concat((F.length-1)/2," * -").concat(i," + (").concat(y," / 2))"));break;default:te=dL("calc(".concat(F.length-1," * -").concat(i,")"));break}var ae=[];if(b){var ue=F[0].width,be=M.width;ae.push("scale(".concat((Gr(be)?be/ue:1)/ue,")"))}return W&&ae.push("rotate(".concat(W,", ").concat(ie,", ").concat(re,")")),ae.length&&(ne.transform=ae.join(" ")),Ue.createElement("text",gz({},Qn(ne,!0),{x:ie,y:re,className:Ii("recharts-text",K),textAnchor:A,fill:R.includes("url")?L7:R}),F.map(function(we,Ce){var _e=we.words.join(ee?"":" ");return Ue.createElement("tspan",{x:ie,dy:Ce===0?te:i,key:"".concat(_e,"-").concat(Ce)},_e)}))};function sg(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function eqe(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function j$(e){let t,r,n;e.length!==2?(t=sg,r=(i,m)=>sg(e(i),m),n=(i,m)=>e(i)-m):(t=e===sg||e===eqe?e:tqe,r=e,n=e);function s(i,m,y=0,S=i.length){if(y<S){if(t(m,m)!==0)return S;do{const b=y+S>>>1;r(i[b],m)<0?y=b+1:S=b}while(y<S)}return y}function o(i,m,y=0,S=i.length){if(y<S){if(t(m,m)!==0)return S;do{const b=y+S>>>1;r(i[b],m)<=0?y=b+1:S=b}while(y<S)}return y}function h(i,m,y=0,S=i.length){const b=s(i,m,y,S-1);return b>y&&n(i[b-1],m)>-n(i[b],m)?b-1:b}return{left:s,center:h,right:o}}function tqe(){return 0}function zle(e){return e===null?NaN:+e}function*rqe(e,t){for(let r of e)r!=null&&(r=+r)>=r&&(yield r)}const nqe=j$(sg),G2=nqe.right;j$(zle).center;class F7 extends Map{constructor(t,r=aqe){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const[n,s]of t)this.set(n,s)}get(t){return super.get(z7(this,t))}has(t){return super.has(z7(this,t))}set(t,r){return super.set(iqe(this,t),r)}delete(t){return super.delete(sqe(this,t))}}function z7({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):r}function iqe({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function sqe({_intern:e,_key:t},r){const n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function aqe(e){return e!==null&&typeof e=="object"?e.valueOf():e}function oqe(e=sg){if(e===sg)return Ble;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{const n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function Ble(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const lqe=Math.sqrt(50),cqe=Math.sqrt(10),uqe=Math.sqrt(2);function qO(e,t,r){const n=(t-e)/Math.max(0,r),s=Math.floor(Math.log10(n)),o=n/Math.pow(10,s),h=o>=lqe?10:o>=cqe?5:o>=uqe?2:1;let i,m,y;return s<0?(y=Math.pow(10,-s)/h,i=Math.round(e*y),m=Math.round(t*y),i/y<e&&++i,m/y>t&&--m,y=-y):(y=Math.pow(10,s)*h,i=Math.round(e/y),m=Math.round(t/y),i*y<e&&++i,m*y>t&&--m),m<i&&.5<=r&&r<2?qO(e,t,r*2):[i,m,y]}function yz(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];const n=t<e,[s,o,h]=n?qO(t,e,r):qO(e,t,r);if(!(o>=s))return[];const i=o-s+1,m=new Array(i);if(n)if(h<0)for(let y=0;y<i;++y)m[y]=(o-y)/-h;else for(let y=0;y<i;++y)m[y]=(o-y)*h;else if(h<0)for(let y=0;y<i;++y)m[y]=(s+y)/-h;else for(let y=0;y<i;++y)m[y]=(s+y)*h;return m}function vz(e,t,r){return t=+t,e=+e,r=+r,qO(e,t,r)[2]}function _z(e,t,r){t=+t,e=+e,r=+r;const n=t<e,s=n?vz(t,e,r):vz(e,t,r);return(n?-1:1)*(s<0?1/-s:s)}function B7(e,t){let r;for(const n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);return r}function $7(e,t){let r;for(const n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);return r}function $le(e,t,r=0,n=1/0,s){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(s=s===void 0?Ble:oqe(s);n>r;){if(n-r>600){const m=n-r+1,y=t-r+1,S=Math.log(m),b=.5*Math.exp(2*S/3),T=.5*Math.sqrt(S*b*(m-b)/m)*(y-m/2<0?-1:1),A=Math.max(r,Math.floor(t-y*b/m+T)),O=Math.min(n,Math.floor(t+(m-y)*b/m+T));$le(e,t,A,O,s)}const o=e[t];let h=r,i=n;for(ZS(e,r,t),s(e[n],o)>0&&ZS(e,r,n);h<i;){for(ZS(e,h,i),++h,--i;s(e[h],o)<0;)++h;for(;s(e[i],o)>0;)--i}s(e[r],o)===0?ZS(e,r,i):(++i,ZS(e,i,n)),i<=t&&(r=i+1),t<=i&&(n=i-1)}return e}function ZS(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function dqe(e,t,r){if(e=Float64Array.from(rqe(e)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return $7(e);if(t>=1)return B7(e);var n,s=(n-1)*t,o=Math.floor(s),h=B7($le(e,o).subarray(0,o+1)),i=$7(e.subarray(o+1));return h+(i-h)*(s-o)}}function hqe(e,t,r=zle){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,s=(n-1)*t,o=Math.floor(s),h=+r(e[o],o,e),i=+r(e[o+1],o+1,e);return h+(i-h)*(s-o)}}function fqe(e,t,r){e=+e,t=+t,r=(s=arguments.length)<2?(t=e,e=0,1):s<3?1:+r;for(var n=-1,s=Math.max(0,Math.ceil((t-e)/r))|0,o=new Array(s);++n<s;)o[n]=e+n*r;return o}function sd(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function vp(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const xz=Symbol("implicit");function P$(){var e=new F7,t=[],r=[],n=xz;function s(o){let h=e.get(o);if(h===void 0){if(n!==xz)return n;e.set(o,h=t.push(o)-1)}return r[h%r.length]}return s.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new F7;for(const h of o)e.has(h)||e.set(h,t.push(h)-1);return s},s.range=function(o){return arguments.length?(r=Array.from(o),s):r.slice()},s.unknown=function(o){return arguments.length?(n=o,s):n},s.copy=function(){return P$(t,r).unknown(n)},sd.apply(s,arguments),s}function DT(){var e=P$().unknown(void 0),t=e.domain,r=e.range,n=0,s=1,o,h,i=!1,m=0,y=0,S=.5;delete e.unknown;function b(){var T=t().length,A=s<n,O=A?s:n,P=A?n:s;o=(P-O)/Math.max(1,T-m+y*2),i&&(o=Math.floor(o)),O+=(P-O-o*(T-m))*S,h=o*(1-m),i&&(O=Math.round(O),h=Math.round(h));var I=fqe(T).map(function(R){return O+o*R});return r(A?I.reverse():I)}return e.domain=function(T){return arguments.length?(t(T),b()):t()},e.range=function(T){return arguments.length?([n,s]=T,n=+n,s=+s,b()):[n,s]},e.rangeRound=function(T){return[n,s]=T,n=+n,s=+s,i=!0,b()},e.bandwidth=function(){return h},e.step=function(){return o},e.round=function(T){return arguments.length?(i=!!T,b()):i},e.padding=function(T){return arguments.length?(m=Math.min(1,y=+T),b()):m},e.paddingInner=function(T){return arguments.length?(m=Math.min(1,T),b()):m},e.paddingOuter=function(T){return arguments.length?(y=+T,b()):y},e.align=function(T){return arguments.length?(S=Math.max(0,Math.min(1,T)),b()):S},e.copy=function(){return DT(t(),[n,s]).round(i).paddingInner(m).paddingOuter(y).align(S)},sd.apply(b(),arguments)}function Ule(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Ule(t())},e}function FE(){return Ule(DT.apply(null,arguments).paddingInner(1))}function O$(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function Vle(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function W2(){}var LT=.7,HO=1/LT,M0="\\s*([+-]?\\d+)\\s*",FT="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Vh="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",pqe=/^#([0-9a-f]{3,8})$/,mqe=new RegExp(`^rgb\\(${M0},${M0},${M0}\\)$`),gqe=new RegExp(`^rgb\\(${Vh},${Vh},${Vh}\\)$`),yqe=new RegExp(`^rgba\\(${M0},${M0},${M0},${FT}\\)$`),vqe=new RegExp(`^rgba\\(${Vh},${Vh},${Vh},${FT}\\)$`),_qe=new RegExp(`^hsl\\(${FT},${Vh},${Vh}\\)$`),xqe=new RegExp(`^hsla\\(${FT},${Vh},${Vh},${FT}\\)$`),U7={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};O$(W2,zT,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:V7,formatHex:V7,formatHex8:bqe,formatHsl:wqe,formatRgb:q7,toString:q7});function V7(){return this.rgb().formatHex()}function bqe(){return this.rgb().formatHex8()}function wqe(){return qle(this).formatHsl()}function q7(){return this.rgb().formatRgb()}function zT(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=pqe.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?H7(t):r===3?new qc(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?Rj(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?Rj(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=mqe.exec(e))?new qc(t[1],t[2],t[3],1):(t=gqe.exec(e))?new qc(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=yqe.exec(e))?Rj(t[1],t[2],t[3],t[4]):(t=vqe.exec(e))?Rj(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=_qe.exec(e))?K7(t[1],t[2]/100,t[3]/100,1):(t=xqe.exec(e))?K7(t[1],t[2]/100,t[3]/100,t[4]):U7.hasOwnProperty(e)?H7(U7[e]):e==="transparent"?new qc(NaN,NaN,NaN,0):null}function H7(e){return new qc(e>>16&255,e>>8&255,e&255,1)}function Rj(e,t,r,n){return n<=0&&(e=t=r=NaN),new qc(e,t,r,n)}function Sqe(e){return e instanceof W2||(e=zT(e)),e?(e=e.rgb(),new qc(e.r,e.g,e.b,e.opacity)):new qc}function bz(e,t,r,n){return arguments.length===1?Sqe(e):new qc(e,t,r,n??1)}function qc(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}O$(qc,bz,Vle(W2,{brighter(e){return e=e==null?HO:Math.pow(HO,e),new qc(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?LT:Math.pow(LT,e),new qc(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new qc(mv(this.r),mv(this.g),mv(this.b),GO(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:G7,formatHex:G7,formatHex8:Eqe,formatRgb:W7,toString:W7}));function G7(){return`#${Jy(this.r)}${Jy(this.g)}${Jy(this.b)}`}function Eqe(){return`#${Jy(this.r)}${Jy(this.g)}${Jy(this.b)}${Jy((isNaN(this.opacity)?1:this.opacity)*255)}`}function W7(){const e=GO(this.opacity);return`${e===1?"rgb(":"rgba("}${mv(this.r)}, ${mv(this.g)}, ${mv(this.b)}${e===1?")":`, ${e})`}`}function GO(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function mv(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Jy(e){return e=mv(e),(e<16?"0":"")+e.toString(16)}function K7(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new $d(e,t,r,n)}function qle(e){if(e instanceof $d)return new $d(e.h,e.s,e.l,e.opacity);if(e instanceof W2||(e=zT(e)),!e)return new $d;if(e instanceof $d)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,s=Math.min(t,r,n),o=Math.max(t,r,n),h=NaN,i=o-s,m=(o+s)/2;return i?(t===o?h=(r-n)/i+(r<n)*6:r===o?h=(n-t)/i+2:h=(t-r)/i+4,i/=m<.5?o+s:2-o-s,h*=60):i=m>0&&m<1?0:h,new $d(h,i,m,e.opacity)}function Tqe(e,t,r,n){return arguments.length===1?qle(e):new $d(e,t,r,n??1)}function $d(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}O$($d,Tqe,Vle(W2,{brighter(e){return e=e==null?HO:Math.pow(HO,e),new $d(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?LT:Math.pow(LT,e),new $d(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,s=2*r-n;return new qc(hL(e>=240?e-240:e+120,s,n),hL(e,s,n),hL(e<120?e+240:e-120,s,n),this.opacity)},clamp(){return new $d(Z7(this.h),Mj(this.s),Mj(this.l),GO(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=GO(this.opacity);return`${e===1?"hsl(":"hsla("}${Z7(this.h)}, ${Mj(this.s)*100}%, ${Mj(this.l)*100}%${e===1?")":`, ${e})`}`}}));function Z7(e){return e=(e||0)%360,e<0?e+360:e}function Mj(e){return Math.max(0,Math.min(1,e||0))}function hL(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const k$=e=>()=>e;function Aqe(e,t){return function(r){return e+r*t}}function Cqe(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function jqe(e){return(e=+e)==1?Hle:function(t,r){return r-t?Cqe(t,r,e):k$(isNaN(t)?r:t)}}function Hle(e,t){var r=t-e;return r?Aqe(e,r):k$(isNaN(e)?t:e)}const X7=function e(t){var r=jqe(t);function n(s,o){var h=r((s=bz(s)).r,(o=bz(o)).r),i=r(s.g,o.g),m=r(s.b,o.b),y=Hle(s.opacity,o.opacity);return function(S){return s.r=h(S),s.g=i(S),s.b=m(S),s.opacity=y(S),s+""}}return n.gamma=e,n}(1);function Pqe(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),s;return function(o){for(s=0;s<r;++s)n[s]=e[s]*(1-o)+t[s]*o;return n}}function Oqe(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function kqe(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,s=new Array(n),o=new Array(r),h;for(h=0;h<n;++h)s[h]=bw(e[h],t[h]);for(;h<r;++h)o[h]=t[h];return function(i){for(h=0;h<n;++h)o[h]=s[h](i);return o}}function Nqe(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function WO(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function Iqe(e,t){var r={},n={},s;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(s in t)s in e?r[s]=bw(e[s],t[s]):n[s]=t[s];return function(o){for(s in r)n[s]=r[s](o);return n}}var wz=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,fL=new RegExp(wz.source,"g");function Rqe(e){return function(){return e}}function Mqe(e){return function(t){return e(t)+""}}function Dqe(e,t){var r=wz.lastIndex=fL.lastIndex=0,n,s,o,h=-1,i=[],m=[];for(e=e+"",t=t+"";(n=wz.exec(e))&&(s=fL.exec(t));)(o=s.index)>r&&(o=t.slice(r,o),i[h]?i[h]+=o:i[++h]=o),(n=n[0])===(s=s[0])?i[h]?i[h]+=s:i[++h]=s:(i[++h]=null,m.push({i:h,x:WO(n,s)})),r=fL.lastIndex;return r<t.length&&(o=t.slice(r),i[h]?i[h]+=o:i[++h]=o),i.length<2?m[0]?Mqe(m[0].x):Rqe(t):(t=m.length,function(y){for(var S=0,b;S<t;++S)i[(b=m[S]).i]=b.x(y);return i.join("")})}function bw(e,t){var r=typeof t,n;return t==null||r==="boolean"?k$(t):(r==="number"?WO:r==="string"?(n=zT(t))?(t=n,X7):Dqe:t instanceof zT?X7:t instanceof Date?Nqe:Oqe(t)?Pqe:Array.isArray(t)?kqe:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Iqe:WO)(e,t)}function N$(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function Lqe(e,t){t===void 0&&(t=e,e=bw);for(var r=0,n=t.length-1,s=t[0],o=new Array(n<0?0:n);r<n;)o[r]=e(s,s=t[++r]);return function(h){var i=Math.max(0,Math.min(n-1,Math.floor(h*=n)));return o[i](h-i)}}function Fqe(e){return function(){return e}}function KO(e){return+e}var Y7=[0,1];function pc(e){return e}function Sz(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:Fqe(isNaN(t)?NaN:.5)}function zqe(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function Bqe(e,t,r){var n=e[0],s=e[1],o=t[0],h=t[1];return s<n?(n=Sz(s,n),o=r(h,o)):(n=Sz(n,s),o=r(o,h)),function(i){return o(n(i))}}function $qe(e,t,r){var n=Math.min(e.length,t.length)-1,s=new Array(n),o=new Array(n),h=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++h<n;)s[h]=Sz(e[h],e[h+1]),o[h]=r(t[h],t[h+1]);return function(i){var m=G2(e,i,1,n)-1;return o[m](s[m](i))}}function K2(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function gI(){var e=Y7,t=Y7,r=bw,n,s,o,h=pc,i,m,y;function S(){var T=Math.min(e.length,t.length);return h!==pc&&(h=zqe(e[0],e[T-1])),i=T>2?$qe:Bqe,m=y=null,b}function b(T){return T==null||isNaN(T=+T)?o:(m||(m=i(e.map(n),t,r)))(n(h(T)))}return b.invert=function(T){return h(s((y||(y=i(t,e.map(n),WO)))(T)))},b.domain=function(T){return arguments.length?(e=Array.from(T,KO),S()):e.slice()},b.range=function(T){return arguments.length?(t=Array.from(T),S()):t.slice()},b.rangeRound=function(T){return t=Array.from(T),r=N$,S()},b.clamp=function(T){return arguments.length?(h=T?!0:pc,S()):h!==pc},b.interpolate=function(T){return arguments.length?(r=T,S()):r},b.unknown=function(T){return arguments.length?(o=T,b):o},function(T,A){return n=T,s=A,S()}}function I$(){return gI()(pc,pc)}function Uqe(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function ZO(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function jb(e){return e=ZO(Math.abs(e)),e?e[1]:NaN}function Vqe(e,t){return function(r,n){for(var s=r.length,o=[],h=0,i=e[0],m=0;s>0&&i>0&&(m+i+1>n&&(i=Math.max(1,n-m)),o.push(r.substring(s-=i,s+i)),!((m+=i+1)>n));)i=e[h=(h+1)%e.length];return o.reverse().join(t)}}function qqe(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var Hqe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function BT(e){if(!(t=Hqe.exec(e)))throw new Error("invalid format: "+e);var t;return new R$({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}BT.prototype=R$.prototype;function R$(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}R$.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Gqe(e){e:for(var t=e.length,r=1,n=-1,s;r<t;++r)switch(e[r]){case".":n=s=r;break;case"0":n===0&&(n=r),s=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(s+1):e}var Gle;function Wqe(e,t){var r=ZO(e,t);if(!r)return e+"";var n=r[0],s=r[1],o=s-(Gle=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,h=n.length;return o===h?n:o>h?n+new Array(o-h+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+ZO(e,Math.max(0,t+o-1))[0]}function J7(e,t){var r=ZO(e,t);if(!r)return e+"";var n=r[0],s=r[1];return s<0?"0."+new Array(-s).join("0")+n:n.length>s+1?n.slice(0,s+1)+"."+n.slice(s+1):n+new Array(s-n.length+2).join("0")}const Q7={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:Uqe,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>J7(e*100,t),r:J7,s:Wqe,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function eK(e){return e}var tK=Array.prototype.map,rK=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Kqe(e){var t=e.grouping===void 0||e.thousands===void 0?eK:Vqe(tK.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",s=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?eK:qqe(tK.call(e.numerals,String)),h=e.percent===void 0?"%":e.percent+"",i=e.minus===void 0?"":e.minus+"",m=e.nan===void 0?"NaN":e.nan+"";function y(b){b=BT(b);var T=b.fill,A=b.align,O=b.sign,P=b.symbol,I=b.zero,R=b.width,M=b.comma,F=b.precision,z=b.trim,$=b.type;$==="n"?(M=!0,$="g"):Q7[$]||(F===void 0&&(F=12),z=!0,$="g"),(I||T==="0"&&A==="=")&&(I=!0,T="0",A="=");var W=P==="$"?r:P==="#"&&/[boxX]/.test($)?"0"+$.toLowerCase():"",K=P==="$"?n:/[%p]/.test($)?h:"",ee=Q7[$],ne=/[defgprs%]/.test($);F=F===void 0?6:/[gprs]/.test($)?Math.max(1,Math.min(21,F)):Math.max(0,Math.min(20,F));function ie(re){var te=W,ae=K,ue,be,we;if($==="c")ae=ee(re)+ae,re="";else{re=+re;var Ce=re<0||1/re<0;if(re=isNaN(re)?m:ee(Math.abs(re),F),z&&(re=Gqe(re)),Ce&&+re==0&&O!=="+"&&(Ce=!1),te=(Ce?O==="("?O:i:O==="-"||O==="("?"":O)+te,ae=($==="s"?rK[8+Gle/3]:"")+ae+(Ce&&O==="("?")":""),ne){for(ue=-1,be=re.length;++ue<be;)if(we=re.charCodeAt(ue),48>we||we>57){ae=(we===46?s+re.slice(ue+1):re.slice(ue))+ae,re=re.slice(0,ue);break}}}M&&!I&&(re=t(re,1/0));var _e=te.length+re.length+ae.length,me=_e<R?new Array(R-_e+1).join(T):"";switch(M&&I&&(re=t(me+re,me.length?R-ae.length:1/0),me=""),A){case"<":re=te+re+ae+me;break;case"=":re=te+me+re+ae;break;case"^":re=me.slice(0,_e=me.length>>1)+te+re+ae+me.slice(_e);break;default:re=me+te+re+ae;break}return o(re)}return ie.toString=function(){return b+""},ie}function S(b,T){var A=y((b=BT(b),b.type="f",b)),O=Math.max(-8,Math.min(8,Math.floor(jb(T)/3)))*3,P=Math.pow(10,-O),I=rK[8+O/3];return function(R){return A(P*R)+I}}return{format:y,formatPrefix:S}}var Dj,M$,Wle;Zqe({thousands:",",grouping:[3],currency:["$",""]});function Zqe(e){return Dj=Kqe(e),M$=Dj.format,Wle=Dj.formatPrefix,Dj}function Xqe(e){return Math.max(0,-jb(Math.abs(e)))}function Yqe(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(jb(t)/3)))*3-jb(Math.abs(e)))}function Jqe(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,jb(t)-jb(e))+1}function Kle(e,t,r,n){var s=_z(e,t,r),o;switch(n=BT(n??",f"),n.type){case"s":{var h=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(o=Yqe(s,h))&&(n.precision=o),Wle(n,h)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=Jqe(s,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=Xqe(s))&&(n.precision=o-(n.type==="%")*2);break}}return M$(n)}function Cg(e){var t=e.domain;return e.ticks=function(r){var n=t();return yz(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var s=t();return Kle(s[0],s[s.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),s=0,o=n.length-1,h=n[s],i=n[o],m,y,S=10;for(i<h&&(y=h,h=i,i=y,y=s,s=o,o=y);S-- >0;){if(y=vz(h,i,r),y===m)return n[s]=h,n[o]=i,t(n);if(y>0)h=Math.floor(h/y)*y,i=Math.ceil(i/y)*y;else if(y<0)h=Math.ceil(h*y)/y,i=Math.floor(i*y)/y;else break;m=y}return e},e}function XO(){var e=I$();return e.copy=function(){return K2(e,XO())},sd.apply(e,arguments),Cg(e)}function Zle(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,KO),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return Zle(e).unknown(t)},e=arguments.length?Array.from(e,KO):[0,1],Cg(r)}function Xle(e,t){e=e.slice();var r=0,n=e.length-1,s=e[r],o=e[n],h;return o<s&&(h=r,r=n,n=h,h=s,s=o,o=h),e[r]=t.floor(s),e[n]=t.ceil(o),e}function nK(e){return Math.log(e)}function iK(e){return Math.exp(e)}function Qqe(e){return-Math.log(-e)}function e9e(e){return-Math.exp(-e)}function t9e(e){return isFinite(e)?+("1e"+e):e<0?0:e}function r9e(e){return e===10?t9e:e===Math.E?Math.exp:t=>Math.pow(e,t)}function n9e(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function sK(e){return(t,r)=>-e(-t,r)}function D$(e){const t=e(nK,iK),r=t.domain;let n=10,s,o;function h(){return s=n9e(n),o=r9e(n),r()[0]<0?(s=sK(s),o=sK(o),e(Qqe,e9e)):e(nK,iK),t}return t.base=function(i){return arguments.length?(n=+i,h()):n},t.domain=function(i){return arguments.length?(r(i),h()):r()},t.ticks=i=>{const m=r();let y=m[0],S=m[m.length-1];const b=S<y;b&&([y,S]=[S,y]);let T=s(y),A=s(S),O,P;const I=i==null?10:+i;let R=[];if(!(n%1)&&A-T<I){if(T=Math.floor(T),A=Math.ceil(A),y>0){for(;T<=A;++T)for(O=1;O<n;++O)if(P=T<0?O/o(-T):O*o(T),!(P<y)){if(P>S)break;R.push(P)}}else for(;T<=A;++T)for(O=n-1;O>=1;--O)if(P=T>0?O/o(-T):O*o(T),!(P<y)){if(P>S)break;R.push(P)}R.length*2<I&&(R=yz(y,S,I))}else R=yz(T,A,Math.min(A-T,I)).map(o);return b?R.reverse():R},t.tickFormat=(i,m)=>{if(i==null&&(i=10),m==null&&(m=n===10?"s":","),typeof m!="function"&&(!(n%1)&&(m=BT(m)).precision==null&&(m.trim=!0),m=M$(m)),i===1/0)return m;const y=Math.max(1,n*i/t.ticks().length);return S=>{let b=S/o(Math.round(s(S)));return b*n<n-.5&&(b*=n),b<=y?m(S):""}},t.nice=()=>r(Xle(r(),{floor:i=>o(Math.floor(s(i))),ceil:i=>o(Math.ceil(s(i)))})),t}function Yle(){const e=D$(gI()).domain([1,10]);return e.copy=()=>K2(e,Yle()).base(e.base()),sd.apply(e,arguments),e}function aK(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function oK(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function L$(e){var t=1,r=e(aK(t),oK(t));return r.constant=function(n){return arguments.length?e(aK(t=+n),oK(t)):t},Cg(r)}function Jle(){var e=L$(gI());return e.copy=function(){return K2(e,Jle()).constant(e.constant())},sd.apply(e,arguments)}function lK(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function i9e(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function s9e(e){return e<0?-e*e:e*e}function F$(e){var t=e(pc,pc),r=1;function n(){return r===1?e(pc,pc):r===.5?e(i9e,s9e):e(lK(r),lK(1/r))}return t.exponent=function(s){return arguments.length?(r=+s,n()):r},Cg(t)}function z$(){var e=F$(gI());return e.copy=function(){return K2(e,z$()).exponent(e.exponent())},sd.apply(e,arguments),e}function a9e(){return z$.apply(null,arguments).exponent(.5)}function cK(e){return Math.sign(e)*e*e}function o9e(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function Qle(){var e=I$(),t=[0,1],r=!1,n;function s(o){var h=o9e(e(o));return isNaN(h)?n:r?Math.round(h):h}return s.invert=function(o){return e.invert(cK(o))},s.domain=function(o){return arguments.length?(e.domain(o),s):e.domain()},s.range=function(o){return arguments.length?(e.range((t=Array.from(o,KO)).map(cK)),s):t.slice()},s.rangeRound=function(o){return s.range(o).round(!0)},s.round=function(o){return arguments.length?(r=!!o,s):r},s.clamp=function(o){return arguments.length?(e.clamp(o),s):e.clamp()},s.unknown=function(o){return arguments.length?(n=o,s):n},s.copy=function(){return Qle(e.domain(),t).round(r).clamp(e.clamp()).unknown(n)},sd.apply(s,arguments),Cg(s)}function ece(){var e=[],t=[],r=[],n;function s(){var h=0,i=Math.max(1,t.length);for(r=new Array(i-1);++h<i;)r[h-1]=hqe(e,h/i);return o}function o(h){return h==null||isNaN(h=+h)?n:t[G2(r,h)]}return o.invertExtent=function(h){var i=t.indexOf(h);return i<0?[NaN,NaN]:[i>0?r[i-1]:e[0],i<r.length?r[i]:e[e.length-1]]},o.domain=function(h){if(!arguments.length)return e.slice();e=[];for(let i of h)i!=null&&!isNaN(i=+i)&&e.push(i);return e.sort(sg),s()},o.range=function(h){return arguments.length?(t=Array.from(h),s()):t.slice()},o.unknown=function(h){return arguments.length?(n=h,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return ece().domain(e).range(t).unknown(n)},sd.apply(o,arguments)}function tce(){var e=0,t=1,r=1,n=[.5],s=[0,1],o;function h(m){return m!=null&&m<=m?s[G2(n,m,0,r)]:o}function i(){var m=-1;for(n=new Array(r);++m<r;)n[m]=((m+1)*t-(m-r)*e)/(r+1);return h}return h.domain=function(m){return arguments.length?([e,t]=m,e=+e,t=+t,i()):[e,t]},h.range=function(m){return arguments.length?(r=(s=Array.from(m)).length-1,i()):s.slice()},h.invertExtent=function(m){var y=s.indexOf(m);return y<0?[NaN,NaN]:y<1?[e,n[0]]:y>=r?[n[r-1],t]:[n[y-1],n[y]]},h.unknown=function(m){return arguments.length&&(o=m),h},h.thresholds=function(){return n.slice()},h.copy=function(){return tce().domain([e,t]).range(s).unknown(o)},sd.apply(Cg(h),arguments)}function rce(){var e=[.5],t=[0,1],r,n=1;function s(o){return o!=null&&o<=o?t[G2(e,o,0,n)]:r}return s.domain=function(o){return arguments.length?(e=Array.from(o),n=Math.min(e.length,t.length-1),s):e.slice()},s.range=function(o){return arguments.length?(t=Array.from(o),n=Math.min(e.length,t.length-1),s):t.slice()},s.invertExtent=function(o){var h=t.indexOf(o);return[e[h-1],e[h]]},s.unknown=function(o){return arguments.length?(r=o,s):r},s.copy=function(){return rce().domain(e).range(t).unknown(r)},sd.apply(s,arguments)}const pL=new Date,mL=new Date;function tl(e,t,r,n){function s(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return s.floor=o=>(e(o=new Date(+o)),o),s.ceil=o=>(e(o=new Date(o-1)),t(o,1),e(o),o),s.round=o=>{const h=s(o),i=s.ceil(o);return o-h<i-o?h:i},s.offset=(o,h)=>(t(o=new Date(+o),h==null?1:Math.floor(h)),o),s.range=(o,h,i)=>{const m=[];if(o=s.ceil(o),i=i==null?1:Math.floor(i),!(o<h)||!(i>0))return m;let y;do m.push(y=new Date(+o)),t(o,i),e(o);while(y<o&&o<h);return m},s.filter=o=>tl(h=>{if(h>=h)for(;e(h),!o(h);)h.setTime(h-1)},(h,i)=>{if(h>=h)if(i<0)for(;++i<=0;)for(;t(h,-1),!o(h););else for(;--i>=0;)for(;t(h,1),!o(h););}),r&&(s.count=(o,h)=>(pL.setTime(+o),mL.setTime(+h),e(pL),e(mL),Math.floor(r(pL,mL))),s.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?s.filter(n?h=>n(h)%o===0:h=>s.count(0,h)%o===0):s)),s}const YO=tl(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);YO.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?tl(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):YO);YO.range;const Gf=1e3,Wu=Gf*60,Wf=Wu*60,cp=Wf*24,B$=cp*7,uK=cp*30,gL=cp*365,Qy=tl(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*Gf)},(e,t)=>(t-e)/Gf,e=>e.getUTCSeconds());Qy.range;const $$=tl(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Gf)},(e,t)=>{e.setTime(+e+t*Wu)},(e,t)=>(t-e)/Wu,e=>e.getMinutes());$$.range;const U$=tl(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Wu)},(e,t)=>(t-e)/Wu,e=>e.getUTCMinutes());U$.range;const V$=tl(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Gf-e.getMinutes()*Wu)},(e,t)=>{e.setTime(+e+t*Wf)},(e,t)=>(t-e)/Wf,e=>e.getHours());V$.range;const q$=tl(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Wf)},(e,t)=>(t-e)/Wf,e=>e.getUTCHours());q$.range;const Z2=tl(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Wu)/cp,e=>e.getDate()-1);Z2.range;const yI=tl(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/cp,e=>e.getUTCDate()-1);yI.range;const nce=tl(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/cp,e=>Math.floor(e/cp));nce.range;function t_(e){return tl(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*Wu)/B$)}const vI=t_(0),JO=t_(1),l9e=t_(2),c9e=t_(3),Pb=t_(4),u9e=t_(5),d9e=t_(6);vI.range;JO.range;l9e.range;c9e.range;Pb.range;u9e.range;d9e.range;function r_(e){return tl(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/B$)}const _I=r_(0),QO=r_(1),h9e=r_(2),f9e=r_(3),Ob=r_(4),p9e=r_(5),m9e=r_(6);_I.range;QO.range;h9e.range;f9e.range;Ob.range;p9e.range;m9e.range;const H$=tl(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());H$.range;const G$=tl(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());G$.range;const up=tl(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());up.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:tl(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});up.range;const dp=tl(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());dp.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:tl(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});dp.range;function ice(e,t,r,n,s,o){const h=[[Qy,1,Gf],[Qy,5,5*Gf],[Qy,15,15*Gf],[Qy,30,30*Gf],[o,1,Wu],[o,5,5*Wu],[o,15,15*Wu],[o,30,30*Wu],[s,1,Wf],[s,3,3*Wf],[s,6,6*Wf],[s,12,12*Wf],[n,1,cp],[n,2,2*cp],[r,1,B$],[t,1,uK],[t,3,3*uK],[e,1,gL]];function i(y,S,b){const T=S<y;T&&([y,S]=[S,y]);const A=b&&typeof b.range=="function"?b:m(y,S,b),O=A?A.range(y,+S+1):[];return T?O.reverse():O}function m(y,S,b){const T=Math.abs(S-y)/b,A=j$(([,,I])=>I).right(h,T);if(A===h.length)return e.every(_z(y/gL,S/gL,b));if(A===0)return YO.every(Math.max(_z(y,S,b),1));const[O,P]=h[T/h[A-1][2]<h[A][2]/T?A-1:A];return O.every(P)}return[i,m]}const[g9e,y9e]=ice(dp,G$,_I,nce,q$,U$),[v9e,_9e]=ice(up,H$,vI,Z2,V$,$$);function yL(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function vL(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function XS(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function x9e(e){var t=e.dateTime,r=e.date,n=e.time,s=e.periods,o=e.days,h=e.shortDays,i=e.months,m=e.shortMonths,y=YS(s),S=JS(s),b=YS(o),T=JS(o),A=YS(h),O=JS(h),P=YS(i),I=JS(i),R=YS(m),M=JS(m),F={a:Ce,A:_e,b:me,B:Ae,c:null,d:gK,e:gK,f:V9e,g:Q9e,G:tHe,H:B9e,I:$9e,j:U9e,L:sce,m:q9e,M:H9e,p:ge,q:pe,Q:_K,s:xK,S:G9e,u:W9e,U:K9e,V:Z9e,w:X9e,W:Y9e,x:null,X:null,y:J9e,Y:eHe,Z:rHe,"%":vK},z={a:Oe,A:Je,b:Ze,B:Pe,c:null,d:yK,e:yK,f:aHe,g:gHe,G:vHe,H:nHe,I:iHe,j:sHe,L:oce,m:oHe,M:lHe,p:Be,q:nt,Q:_K,s:xK,S:cHe,u:uHe,U:dHe,V:hHe,w:fHe,W:pHe,x:null,X:null,y:mHe,Y:yHe,Z:_He,"%":vK},$={a:ie,A:re,b:te,B:ae,c:ue,d:pK,e:pK,f:D9e,g:fK,G:hK,H:mK,I:mK,j:N9e,L:M9e,m:k9e,M:I9e,p:ne,q:O9e,Q:F9e,s:z9e,S:R9e,u:T9e,U:A9e,V:C9e,w:E9e,W:j9e,x:be,X:we,y:fK,Y:hK,Z:P9e,"%":L9e};F.x=W(r,F),F.X=W(n,F),F.c=W(t,F),z.x=W(r,z),z.X=W(n,z),z.c=W(t,z);function W(Me,We){return function(gt){var rt=[],Ht=-1,Lt=0,nr=Me.length,Rr,Dr,Pt;for(gt instanceof Date||(gt=new Date(+gt));++Ht<nr;)Me.charCodeAt(Ht)===37&&(rt.push(Me.slice(Lt,Ht)),(Dr=dK[Rr=Me.charAt(++Ht)])!=null?Rr=Me.charAt(++Ht):Dr=Rr==="e"?" ":"0",(Pt=We[Rr])&&(Rr=Pt(gt,Dr)),rt.push(Rr),Lt=Ht+1);return rt.push(Me.slice(Lt,Ht)),rt.join("")}}function K(Me,We){return function(gt){var rt=XS(1900,void 0,1),Ht=ee(rt,Me,gt+="",0),Lt,nr;if(Ht!=gt.length)return null;if("Q"in rt)return new Date(rt.Q);if("s"in rt)return new Date(rt.s*1e3+("L"in rt?rt.L:0));if(We&&!("Z"in rt)&&(rt.Z=0),"p"in rt&&(rt.H=rt.H%12+rt.p*12),rt.m===void 0&&(rt.m="q"in rt?rt.q:0),"V"in rt){if(rt.V<1||rt.V>53)return null;"w"in rt||(rt.w=1),"Z"in rt?(Lt=vL(XS(rt.y,0,1)),nr=Lt.getUTCDay(),Lt=nr>4||nr===0?QO.ceil(Lt):QO(Lt),Lt=yI.offset(Lt,(rt.V-1)*7),rt.y=Lt.getUTCFullYear(),rt.m=Lt.getUTCMonth(),rt.d=Lt.getUTCDate()+(rt.w+6)%7):(Lt=yL(XS(rt.y,0,1)),nr=Lt.getDay(),Lt=nr>4||nr===0?JO.ceil(Lt):JO(Lt),Lt=Z2.offset(Lt,(rt.V-1)*7),rt.y=Lt.getFullYear(),rt.m=Lt.getMonth(),rt.d=Lt.getDate()+(rt.w+6)%7)}else("W"in rt||"U"in rt)&&("w"in rt||(rt.w="u"in rt?rt.u%7:"W"in rt?1:0),nr="Z"in rt?vL(XS(rt.y,0,1)).getUTCDay():yL(XS(rt.y,0,1)).getDay(),rt.m=0,rt.d="W"in rt?(rt.w+6)%7+rt.W*7-(nr+5)%7:rt.w+rt.U*7-(nr+6)%7);return"Z"in rt?(rt.H+=rt.Z/100|0,rt.M+=rt.Z%100,vL(rt)):yL(rt)}}function ee(Me,We,gt,rt){for(var Ht=0,Lt=We.length,nr=gt.length,Rr,Dr;Ht<Lt;){if(rt>=nr)return-1;if(Rr=We.charCodeAt(Ht++),Rr===37){if(Rr=We.charAt(Ht++),Dr=$[Rr in dK?We.charAt(Ht++):Rr],!Dr||(rt=Dr(Me,gt,rt))<0)return-1}else if(Rr!=gt.charCodeAt(rt++))return-1}return rt}function ne(Me,We,gt){var rt=y.exec(We.slice(gt));return rt?(Me.p=S.get(rt[0].toLowerCase()),gt+rt[0].length):-1}function ie(Me,We,gt){var rt=A.exec(We.slice(gt));return rt?(Me.w=O.get(rt[0].toLowerCase()),gt+rt[0].length):-1}function re(Me,We,gt){var rt=b.exec(We.slice(gt));return rt?(Me.w=T.get(rt[0].toLowerCase()),gt+rt[0].length):-1}function te(Me,We,gt){var rt=R.exec(We.slice(gt));return rt?(Me.m=M.get(rt[0].toLowerCase()),gt+rt[0].length):-1}function ae(Me,We,gt){var rt=P.exec(We.slice(gt));return rt?(Me.m=I.get(rt[0].toLowerCase()),gt+rt[0].length):-1}function ue(Me,We,gt){return ee(Me,t,We,gt)}function be(Me,We,gt){return ee(Me,r,We,gt)}function we(Me,We,gt){return ee(Me,n,We,gt)}function Ce(Me){return h[Me.getDay()]}function _e(Me){return o[Me.getDay()]}function me(Me){return m[Me.getMonth()]}function Ae(Me){return i[Me.getMonth()]}function ge(Me){return s[+(Me.getHours()>=12)]}function pe(Me){return 1+~~(Me.getMonth()/3)}function Oe(Me){return h[Me.getUTCDay()]}function Je(Me){return o[Me.getUTCDay()]}function Ze(Me){return m[Me.getUTCMonth()]}function Pe(Me){return i[Me.getUTCMonth()]}function Be(Me){return s[+(Me.getUTCHours()>=12)]}function nt(Me){return 1+~~(Me.getUTCMonth()/3)}return{format:function(Me){var We=W(Me+="",F);return We.toString=function(){return Me},We},parse:function(Me){var We=K(Me+="",!1);return We.toString=function(){return Me},We},utcFormat:function(Me){var We=W(Me+="",z);return We.toString=function(){return Me},We},utcParse:function(Me){var We=K(Me+="",!0);return We.toString=function(){return Me},We}}}var dK={"-":"",_:" ",0:"0"},pl=/^\s*\d+/,b9e=/^%/,w9e=/[\\^$*+?|[\]().{}]/g;function Ps(e,t,r){var n=e<0?"-":"",s=(n?-e:e)+"",o=s.length;return n+(o<r?new Array(r-o+1).join(t)+s:s)}function S9e(e){return e.replace(w9e,"\\$&")}function YS(e){return new RegExp("^(?:"+e.map(S9e).join("|")+")","i")}function JS(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function E9e(e,t,r){var n=pl.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function T9e(e,t,r){var n=pl.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function A9e(e,t,r){var n=pl.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function C9e(e,t,r){var n=pl.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function j9e(e,t,r){var n=pl.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function hK(e,t,r){var n=pl.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function fK(e,t,r){var n=pl.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function P9e(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function O9e(e,t,r){var n=pl.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function k9e(e,t,r){var n=pl.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function pK(e,t,r){var n=pl.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function N9e(e,t,r){var n=pl.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function mK(e,t,r){var n=pl.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function I9e(e,t,r){var n=pl.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function R9e(e,t,r){var n=pl.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function M9e(e,t,r){var n=pl.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function D9e(e,t,r){var n=pl.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function L9e(e,t,r){var n=b9e.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function F9e(e,t,r){var n=pl.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function z9e(e,t,r){var n=pl.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function gK(e,t){return Ps(e.getDate(),t,2)}function B9e(e,t){return Ps(e.getHours(),t,2)}function $9e(e,t){return Ps(e.getHours()%12||12,t,2)}function U9e(e,t){return Ps(1+Z2.count(up(e),e),t,3)}function sce(e,t){return Ps(e.getMilliseconds(),t,3)}function V9e(e,t){return sce(e,t)+"000"}function q9e(e,t){return Ps(e.getMonth()+1,t,2)}function H9e(e,t){return Ps(e.getMinutes(),t,2)}function G9e(e,t){return Ps(e.getSeconds(),t,2)}function W9e(e){var t=e.getDay();return t===0?7:t}function K9e(e,t){return Ps(vI.count(up(e)-1,e),t,2)}function ace(e){var t=e.getDay();return t>=4||t===0?Pb(e):Pb.ceil(e)}function Z9e(e,t){return e=ace(e),Ps(Pb.count(up(e),e)+(up(e).getDay()===4),t,2)}function X9e(e){return e.getDay()}function Y9e(e,t){return Ps(JO.count(up(e)-1,e),t,2)}function J9e(e,t){return Ps(e.getFullYear()%100,t,2)}function Q9e(e,t){return e=ace(e),Ps(e.getFullYear()%100,t,2)}function eHe(e,t){return Ps(e.getFullYear()%1e4,t,4)}function tHe(e,t){var r=e.getDay();return e=r>=4||r===0?Pb(e):Pb.ceil(e),Ps(e.getFullYear()%1e4,t,4)}function rHe(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Ps(t/60|0,"0",2)+Ps(t%60,"0",2)}function yK(e,t){return Ps(e.getUTCDate(),t,2)}function nHe(e,t){return Ps(e.getUTCHours(),t,2)}function iHe(e,t){return Ps(e.getUTCHours()%12||12,t,2)}function sHe(e,t){return Ps(1+yI.count(dp(e),e),t,3)}function oce(e,t){return Ps(e.getUTCMilliseconds(),t,3)}function aHe(e,t){return oce(e,t)+"000"}function oHe(e,t){return Ps(e.getUTCMonth()+1,t,2)}function lHe(e,t){return Ps(e.getUTCMinutes(),t,2)}function cHe(e,t){return Ps(e.getUTCSeconds(),t,2)}function uHe(e){var t=e.getUTCDay();return t===0?7:t}function dHe(e,t){return Ps(_I.count(dp(e)-1,e),t,2)}function lce(e){var t=e.getUTCDay();return t>=4||t===0?Ob(e):Ob.ceil(e)}function hHe(e,t){return e=lce(e),Ps(Ob.count(dp(e),e)+(dp(e).getUTCDay()===4),t,2)}function fHe(e){return e.getUTCDay()}function pHe(e,t){return Ps(QO.count(dp(e)-1,e),t,2)}function mHe(e,t){return Ps(e.getUTCFullYear()%100,t,2)}function gHe(e,t){return e=lce(e),Ps(e.getUTCFullYear()%100,t,2)}function yHe(e,t){return Ps(e.getUTCFullYear()%1e4,t,4)}function vHe(e,t){var r=e.getUTCDay();return e=r>=4||r===0?Ob(e):Ob.ceil(e),Ps(e.getUTCFullYear()%1e4,t,4)}function _He(){return"+0000"}function vK(){return"%"}function _K(e){return+e}function xK(e){return Math.floor(+e/1e3)}var qx,cce,uce;xHe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function xHe(e){return qx=x9e(e),cce=qx.format,qx.parse,uce=qx.utcFormat,qx.utcParse,qx}function bHe(e){return new Date(e)}function wHe(e){return e instanceof Date?+e:+new Date(+e)}function W$(e,t,r,n,s,o,h,i,m,y){var S=I$(),b=S.invert,T=S.domain,A=y(".%L"),O=y(":%S"),P=y("%I:%M"),I=y("%I %p"),R=y("%a %d"),M=y("%b %d"),F=y("%B"),z=y("%Y");function $(W){return(m(W)<W?A:i(W)<W?O:h(W)<W?P:o(W)<W?I:n(W)<W?s(W)<W?R:M:r(W)<W?F:z)(W)}return S.invert=function(W){return new Date(b(W))},S.domain=function(W){return arguments.length?T(Array.from(W,wHe)):T().map(bHe)},S.ticks=function(W){var K=T();return e(K[0],K[K.length-1],W??10)},S.tickFormat=function(W,K){return K==null?$:y(K)},S.nice=function(W){var K=T();return(!W||typeof W.range!="function")&&(W=t(K[0],K[K.length-1],W??10)),W?T(Xle(K,W)):S},S.copy=function(){return K2(S,W$(e,t,r,n,s,o,h,i,m,y))},S}function SHe(){return sd.apply(W$(v9e,_9e,up,H$,vI,Z2,V$,$$,Qy,cce).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function EHe(){return sd.apply(W$(g9e,y9e,dp,G$,_I,yI,q$,U$,Qy,uce).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function xI(){var e=0,t=1,r,n,s,o,h=pc,i=!1,m;function y(b){return b==null||isNaN(b=+b)?m:h(s===0?.5:(b=(o(b)-r)*s,i?Math.max(0,Math.min(1,b)):b))}y.domain=function(b){return arguments.length?([e,t]=b,r=o(e=+e),n=o(t=+t),s=r===n?0:1/(n-r),y):[e,t]},y.clamp=function(b){return arguments.length?(i=!!b,y):i},y.interpolator=function(b){return arguments.length?(h=b,y):h};function S(b){return function(T){var A,O;return arguments.length?([A,O]=T,h=b(A,O),y):[h(0),h(1)]}}return y.range=S(bw),y.rangeRound=S(N$),y.unknown=function(b){return arguments.length?(m=b,y):m},function(b){return o=b,r=b(e),n=b(t),s=r===n?0:1/(n-r),y}}function jg(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function dce(){var e=Cg(xI()(pc));return e.copy=function(){return jg(e,dce())},vp.apply(e,arguments)}function hce(){var e=D$(xI()).domain([1,10]);return e.copy=function(){return jg(e,hce()).base(e.base())},vp.apply(e,arguments)}function fce(){var e=L$(xI());return e.copy=function(){return jg(e,fce()).constant(e.constant())},vp.apply(e,arguments)}function K$(){var e=F$(xI());return e.copy=function(){return jg(e,K$()).exponent(e.exponent())},vp.apply(e,arguments)}function THe(){return K$.apply(null,arguments).exponent(.5)}function pce(){var e=[],t=pc;function r(n){if(n!=null&&!isNaN(n=+n))return t((G2(e,n,1)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(let s of n)s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(sg),r},r.interpolator=function(n){return arguments.length?(t=n,r):t},r.range=function(){return e.map((n,s)=>t(s/(e.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(s,o)=>dqe(e,o/n))},r.copy=function(){return pce(t).domain(e)},vp.apply(r,arguments)}function bI(){var e=0,t=.5,r=1,n=1,s,o,h,i,m,y=pc,S,b=!1,T;function A(P){return isNaN(P=+P)?T:(P=.5+((P=+S(P))-o)*(n*P<n*o?i:m),y(b?Math.max(0,Math.min(1,P)):P))}A.domain=function(P){return arguments.length?([e,t,r]=P,s=S(e=+e),o=S(t=+t),h=S(r=+r),i=s===o?0:.5/(o-s),m=o===h?0:.5/(h-o),n=o<s?-1:1,A):[e,t,r]},A.clamp=function(P){return arguments.length?(b=!!P,A):b},A.interpolator=function(P){return arguments.length?(y=P,A):y};function O(P){return function(I){var R,M,F;return arguments.length?([R,M,F]=I,y=Lqe(P,[R,M,F]),A):[y(0),y(.5),y(1)]}}return A.range=O(bw),A.rangeRound=O(N$),A.unknown=function(P){return arguments.length?(T=P,A):T},function(P){return S=P,s=P(e),o=P(t),h=P(r),i=s===o?0:.5/(o-s),m=o===h?0:.5/(h-o),n=o<s?-1:1,A}}function mce(){var e=Cg(bI()(pc));return e.copy=function(){return jg(e,mce())},vp.apply(e,arguments)}function gce(){var e=D$(bI()).domain([.1,1,10]);return e.copy=function(){return jg(e,gce()).base(e.base())},vp.apply(e,arguments)}function yce(){var e=L$(bI());return e.copy=function(){return jg(e,yce()).constant(e.constant())},vp.apply(e,arguments)}function Z$(){var e=F$(bI());return e.copy=function(){return jg(e,Z$()).exponent(e.exponent())},vp.apply(e,arguments)}function AHe(){return Z$.apply(null,arguments).exponent(.5)}const bK=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:DT,scaleDiverging:mce,scaleDivergingLog:gce,scaleDivergingPow:Z$,scaleDivergingSqrt:AHe,scaleDivergingSymlog:yce,scaleIdentity:Zle,scaleImplicit:xz,scaleLinear:XO,scaleLog:Yle,scaleOrdinal:P$,scalePoint:FE,scalePow:z$,scaleQuantile:ece,scaleQuantize:tce,scaleRadial:Qle,scaleSequential:dce,scaleSequentialLog:hce,scaleSequentialPow:K$,scaleSequentialQuantile:pce,scaleSequentialSqrt:THe,scaleSequentialSymlog:fce,scaleSqrt:a9e,scaleSymlog:Jle,scaleThreshold:rce,scaleTime:SHe,scaleUtc:EHe,tickFormat:Kle},Symbol.toStringTag,{value:"Module"}));var CHe=hw;function jHe(e,t,r){for(var n=-1,s=e.length;++n<s;){var o=e[n],h=t(o);if(h!=null&&(i===void 0?h===h&&!CHe(h):r(h,i)))var i=h,m=o}return m}var wI=jHe;function PHe(e,t){return e>t}var vce=PHe,OHe=wI,kHe=vce,NHe=xw;function IHe(e){return e&&e.length?OHe(e,NHe,kHe):void 0}var RHe=IHe;const SI=Os(RHe);function MHe(e,t){return e<t}var _ce=MHe,DHe=wI,LHe=_ce,FHe=xw;function zHe(e){return e&&e.length?DHe(e,FHe,LHe):void 0}var BHe=zHe;const EI=Os(BHe);var $He=c$,UHe=nf,VHe=Cle,qHe=Qc;function HHe(e,t){var r=qHe(e)?$He:VHe;return r(e,UHe(t))}var GHe=HHe,WHe=Tle,KHe=GHe;function ZHe(e,t){return WHe(KHe(e,t),1)}var XHe=ZHe;const YHe=Os(XHe);var JHe=E$;function QHe(e,t){return JHe(e,t)}var xce=QHe;const X2=Os(xce);var ww=1e9,eGe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},Y$,Oa=!0,td="[DecimalError] ",gv=td+"Invalid argument: ",X$=td+"Exponent out of range: ",Sw=Math.floor,Uy=Math.pow,tGe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,gu,ll=1e7,ya=7,bce=9007199254740991,ek=Sw(bce/ya),Tn={};Tn.absoluteValue=Tn.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Tn.comparedTo=Tn.cmp=function(e){var t,r,n,s,o=this;if(e=new o.constructor(e),o.s!==e.s)return o.s||-e.s;if(o.e!==e.e)return o.e>e.e^o.s<0?1:-1;for(n=o.d.length,s=e.d.length,t=0,r=n<s?n:s;t<r;++t)if(o.d[t]!==e.d[t])return o.d[t]>e.d[t]^o.s<0?1:-1;return n===s?0:n>s^o.s<0?1:-1};Tn.decimalPlaces=Tn.dp=function(){var e=this,t=e.d.length-1,r=(t-e.e)*ya;if(t=e.d[t],t)for(;t%10==0;t/=10)r--;return r<0?0:r};Tn.dividedBy=Tn.div=function(e){return Yf(this,new this.constructor(e))};Tn.dividedToIntegerBy=Tn.idiv=function(e){var t=this,r=t.constructor;return ta(Yf(t,new r(e),0,1),r.precision)};Tn.equals=Tn.eq=function(e){return!this.cmp(e)};Tn.exponent=function(){return Ro(this)};Tn.greaterThan=Tn.gt=function(e){return this.cmp(e)>0};Tn.greaterThanOrEqualTo=Tn.gte=function(e){return this.cmp(e)>=0};Tn.isInteger=Tn.isint=function(){return this.e>this.d.length-2};Tn.isNegative=Tn.isneg=function(){return this.s<0};Tn.isPositive=Tn.ispos=function(){return this.s>0};Tn.isZero=function(){return this.s===0};Tn.lessThan=Tn.lt=function(e){return this.cmp(e)<0};Tn.lessThanOrEqualTo=Tn.lte=function(e){return this.cmp(e)<1};Tn.logarithm=Tn.log=function(e){var t,r=this,n=r.constructor,s=n.precision,o=s+5;if(e===void 0)e=new n(10);else if(e=new n(e),e.s<1||e.eq(gu))throw Error(td+"NaN");if(r.s<1)throw Error(td+(r.s?"NaN":"-Infinity"));return r.eq(gu)?new n(0):(Oa=!1,t=Yf($T(r,o),$T(e,o),o),Oa=!0,ta(t,s))};Tn.minus=Tn.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?Ece(t,e):wce(t,(e.s=-e.s,e))};Tn.modulo=Tn.mod=function(e){var t,r=this,n=r.constructor,s=n.precision;if(e=new n(e),!e.s)throw Error(td+"NaN");return r.s?(Oa=!1,t=Yf(r,e,0,1).times(e),Oa=!0,r.minus(t)):ta(new n(r),s)};Tn.naturalExponential=Tn.exp=function(){return Sce(this)};Tn.naturalLogarithm=Tn.ln=function(){return $T(this)};Tn.negated=Tn.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Tn.plus=Tn.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?wce(t,e):Ece(t,(e.s=-e.s,e))};Tn.precision=Tn.sd=function(e){var t,r,n,s=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(gv+e);if(t=Ro(s)+1,n=s.d.length-1,r=n*ya+1,n=s.d[n],n){for(;n%10==0;n/=10)r--;for(n=s.d[0];n>=10;n/=10)r++}return e&&t>r?t:r};Tn.squareRoot=Tn.sqrt=function(){var e,t,r,n,s,o,h,i=this,m=i.constructor;if(i.s<1){if(!i.s)return new m(0);throw Error(td+"NaN")}for(e=Ro(i),Oa=!1,s=Math.sqrt(+i),s==0||s==1/0?(t=Rh(i.d),(t.length+e)%2==0&&(t+="0"),s=Math.sqrt(t),e=Sw((e+1)/2)-(e<0||e%2),s==1/0?t="5e"+e:(t=s.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),n=new m(t)):n=new m(s.toString()),r=m.precision,s=h=r+3;;)if(o=n,n=o.plus(Yf(i,o,h+2)).times(.5),Rh(o.d).slice(0,h)===(t=Rh(n.d)).slice(0,h)){if(t=t.slice(h-3,h+1),s==h&&t=="4999"){if(ta(o,r+1,0),o.times(o).eq(i)){n=o;break}}else if(t!="9999")break;h+=4}return Oa=!0,ta(n,r)};Tn.times=Tn.mul=function(e){var t,r,n,s,o,h,i,m,y,S=this,b=S.constructor,T=S.d,A=(e=new b(e)).d;if(!S.s||!e.s)return new b(0);for(e.s*=S.s,r=S.e+e.e,m=T.length,y=A.length,m<y&&(o=T,T=A,A=o,h=m,m=y,y=h),o=[],h=m+y,n=h;n--;)o.push(0);for(n=y;--n>=0;){for(t=0,s=m+n;s>n;)i=o[s]+A[n]*T[s-n-1]+t,o[s--]=i%ll|0,t=i/ll|0;o[s]=(o[s]+t)%ll|0}for(;!o[--h];)o.pop();return t?++r:o.shift(),e.d=o,e.e=r,Oa?ta(e,b.precision):e};Tn.toDecimalPlaces=Tn.todp=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(Wh(e,0,ww),t===void 0?t=n.rounding:Wh(t,0,8),ta(r,e+Ro(r)+1,t))};Tn.toExponential=function(e,t){var r,n=this,s=n.constructor;return e===void 0?r=Bv(n,!0):(Wh(e,0,ww),t===void 0?t=s.rounding:Wh(t,0,8),n=ta(new s(n),e+1,t),r=Bv(n,!0,e+1)),r};Tn.toFixed=function(e,t){var r,n,s=this,o=s.constructor;return e===void 0?Bv(s):(Wh(e,0,ww),t===void 0?t=o.rounding:Wh(t,0,8),n=ta(new o(s),e+Ro(s)+1,t),r=Bv(n.abs(),!1,e+Ro(n)+1),s.isneg()&&!s.isZero()?"-"+r:r)};Tn.toInteger=Tn.toint=function(){var e=this,t=e.constructor;return ta(new t(e),Ro(e)+1,t.rounding)};Tn.toNumber=function(){return+this};Tn.toPower=Tn.pow=function(e){var t,r,n,s,o,h,i=this,m=i.constructor,y=12,S=+(e=new m(e));if(!e.s)return new m(gu);if(i=new m(i),!i.s){if(e.s<1)throw Error(td+"Infinity");return i}if(i.eq(gu))return i;if(n=m.precision,e.eq(gu))return ta(i,n);if(t=e.e,r=e.d.length-1,h=t>=r,o=i.s,h){if((r=S<0?-S:S)<=bce){for(s=new m(gu),t=Math.ceil(n/ya+4),Oa=!1;r%2&&(s=s.times(i),SK(s.d,t)),r=Sw(r/2),r!==0;)i=i.times(i),SK(i.d,t);return Oa=!0,e.s<0?new m(gu).div(s):ta(s,n)}}else if(o<0)throw Error(td+"NaN");return o=o<0&&e.d[Math.max(t,r)]&1?-1:1,i.s=1,Oa=!1,s=e.times($T(i,n+y)),Oa=!0,s=Sce(s),s.s=o,s};Tn.toPrecision=function(e,t){var r,n,s=this,o=s.constructor;return e===void 0?(r=Ro(s),n=Bv(s,r<=o.toExpNeg||r>=o.toExpPos)):(Wh(e,1,ww),t===void 0?t=o.rounding:Wh(t,0,8),s=ta(new o(s),e,t),r=Ro(s),n=Bv(s,e<=r||r<=o.toExpNeg,e)),n};Tn.toSignificantDigits=Tn.tosd=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(Wh(e,1,ww),t===void 0?t=n.rounding:Wh(t,0,8)),ta(new n(r),e,t)};Tn.toString=Tn.valueOf=Tn.val=Tn.toJSON=Tn[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=Ro(e),r=e.constructor;return Bv(e,t<=r.toExpNeg||t>=r.toExpPos)};function wce(e,t){var r,n,s,o,h,i,m,y,S=e.constructor,b=S.precision;if(!e.s||!t.s)return t.s||(t=new S(e)),Oa?ta(t,b):t;if(m=e.d,y=t.d,h=e.e,s=t.e,m=m.slice(),o=h-s,o){for(o<0?(n=m,o=-o,i=y.length):(n=y,s=h,i=m.length),h=Math.ceil(b/ya),i=h>i?h+1:i+1,o>i&&(o=i,n.length=1),n.reverse();o--;)n.push(0);n.reverse()}for(i=m.length,o=y.length,i-o<0&&(o=i,n=y,y=m,m=n),r=0;o;)r=(m[--o]=m[o]+y[o]+r)/ll|0,m[o]%=ll;for(r&&(m.unshift(r),++s),i=m.length;m[--i]==0;)m.pop();return t.d=m,t.e=s,Oa?ta(t,b):t}function Wh(e,t,r){if(e!==~~e||e<t||e>r)throw Error(gv+e)}function Rh(e){var t,r,n,s=e.length-1,o="",h=e[0];if(s>0){for(o+=h,t=1;t<s;t++)n=e[t]+"",r=ya-n.length,r&&(o+=Em(r)),o+=n;h=e[t],n=h+"",r=ya-n.length,r&&(o+=Em(r))}else if(h===0)return"0";for(;h%10===0;)h/=10;return o+h}var Yf=function(){function e(n,s){var o,h=0,i=n.length;for(n=n.slice();i--;)o=n[i]*s+h,n[i]=o%ll|0,h=o/ll|0;return h&&n.unshift(h),n}function t(n,s,o,h){var i,m;if(o!=h)m=o>h?1:-1;else for(i=m=0;i<o;i++)if(n[i]!=s[i]){m=n[i]>s[i]?1:-1;break}return m}function r(n,s,o){for(var h=0;o--;)n[o]-=h,h=n[o]<s[o]?1:0,n[o]=h*ll+n[o]-s[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,s,o,h){var i,m,y,S,b,T,A,O,P,I,R,M,F,z,$,W,K,ee,ne=n.constructor,ie=n.s==s.s?1:-1,re=n.d,te=s.d;if(!n.s)return new ne(n);if(!s.s)throw Error(td+"Division by zero");for(m=n.e-s.e,K=te.length,$=re.length,A=new ne(ie),O=A.d=[],y=0;te[y]==(re[y]||0);)++y;if(te[y]>(re[y]||0)&&--m,o==null?M=o=ne.precision:h?M=o+(Ro(n)-Ro(s))+1:M=o,M<0)return new ne(0);if(M=M/ya+2|0,y=0,K==1)for(S=0,te=te[0],M++;(y<$||S)&&M--;y++)F=S*ll+(re[y]||0),O[y]=F/te|0,S=F%te|0;else{for(S=ll/(te[0]+1)|0,S>1&&(te=e(te,S),re=e(re,S),K=te.length,$=re.length),z=K,P=re.slice(0,K),I=P.length;I<K;)P[I++]=0;ee=te.slice(),ee.unshift(0),W=te[0],te[1]>=ll/2&&++W;do S=0,i=t(te,P,K,I),i<0?(R=P[0],K!=I&&(R=R*ll+(P[1]||0)),S=R/W|0,S>1?(S>=ll&&(S=ll-1),b=e(te,S),T=b.length,I=P.length,i=t(b,P,T,I),i==1&&(S--,r(b,K<T?ee:te,T))):(S==0&&(i=S=1),b=te.slice()),T=b.length,T<I&&b.unshift(0),r(P,b,I),i==-1&&(I=P.length,i=t(te,P,K,I),i<1&&(S++,r(P,K<I?ee:te,I))),I=P.length):i===0&&(S++,P=[0]),O[y++]=S,i&&P[0]?P[I++]=re[z]||0:(P=[re[z]],I=1);while((z++<$||P[0]!==void 0)&&M--)}return O[0]||O.shift(),A.e=m,ta(A,h?o+Ro(A)+1:o)}}();function Sce(e,t){var r,n,s,o,h,i,m=0,y=0,S=e.constructor,b=S.precision;if(Ro(e)>16)throw Error(X$+Ro(e));if(!e.s)return new S(gu);for(t==null?(Oa=!1,i=b):i=t,h=new S(.03125);e.abs().gte(.1);)e=e.times(h),y+=5;for(n=Math.log(Uy(2,y))/Math.LN10*2+5|0,i+=n,r=s=o=new S(gu),S.precision=i;;){if(s=ta(s.times(e),i),r=r.times(++m),h=o.plus(Yf(s,r,i)),Rh(h.d).slice(0,i)===Rh(o.d).slice(0,i)){for(;y--;)o=ta(o.times(o),i);return S.precision=b,t==null?(Oa=!0,ta(o,b)):o}o=h}}function Ro(e){for(var t=e.e*ya,r=e.d[0];r>=10;r/=10)t++;return t}function _L(e,t,r){if(t>e.LN10.sd())throw Oa=!0,r&&(e.precision=r),Error(td+"LN10 precision limit exceeded");return ta(new e(e.LN10),t)}function Em(e){for(var t="";e--;)t+="0";return t}function $T(e,t){var r,n,s,o,h,i,m,y,S,b=1,T=10,A=e,O=A.d,P=A.constructor,I=P.precision;if(A.s<1)throw Error(td+(A.s?"NaN":"-Infinity"));if(A.eq(gu))return new P(0);if(t==null?(Oa=!1,y=I):y=t,A.eq(10))return t==null&&(Oa=!0),_L(P,y);if(y+=T,P.precision=y,r=Rh(O),n=r.charAt(0),o=Ro(A),Math.abs(o)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)A=A.times(e),r=Rh(A.d),n=r.charAt(0),b++;o=Ro(A),n>1?(A=new P("0."+r),o++):A=new P(n+"."+r.slice(1))}else return m=_L(P,y+2,I).times(o+""),A=$T(new P(n+"."+r.slice(1)),y-T).plus(m),P.precision=I,t==null?(Oa=!0,ta(A,I)):A;for(i=h=A=Yf(A.minus(gu),A.plus(gu),y),S=ta(A.times(A),y),s=3;;){if(h=ta(h.times(S),y),m=i.plus(Yf(h,new P(s),y)),Rh(m.d).slice(0,y)===Rh(i.d).slice(0,y))return i=i.times(2),o!==0&&(i=i.plus(_L(P,y+2,I).times(o+""))),i=Yf(i,new P(b),y),P.precision=I,t==null?(Oa=!0,ta(i,I)):i;i=m,s+=2}}function wK(e,t){var r,n,s;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;)++n;for(s=t.length;t.charCodeAt(s-1)===48;)--s;if(t=t.slice(n,s),t){if(s-=n,r=r-n-1,e.e=Sw(r/ya),e.d=[],n=(r+1)%ya,r<0&&(n+=ya),n<s){for(n&&e.d.push(+t.slice(0,n)),s-=ya;n<s;)e.d.push(+t.slice(n,n+=ya));t=t.slice(n),n=ya-t.length}else n-=s;for(;n--;)t+="0";if(e.d.push(+t),Oa&&(e.e>ek||e.e<-ek))throw Error(X$+r)}else e.s=0,e.e=0,e.d=[0];return e}function ta(e,t,r){var n,s,o,h,i,m,y,S,b=e.d;for(h=1,o=b[0];o>=10;o/=10)h++;if(n=t-h,n<0)n+=ya,s=t,y=b[S=0];else{if(S=Math.ceil((n+1)/ya),o=b.length,S>=o)return e;for(y=o=b[S],h=1;o>=10;o/=10)h++;n%=ya,s=n-ya+h}if(r!==void 0&&(o=Uy(10,h-s-1),i=y/o%10|0,m=t<0||b[S+1]!==void 0||y%o,m=r<4?(i||m)&&(r==0||r==(e.s<0?3:2)):i>5||i==5&&(r==4||m||r==6&&(n>0?s>0?y/Uy(10,h-s):0:b[S-1])%10&1||r==(e.s<0?8:7))),t<1||!b[0])return m?(o=Ro(e),b.length=1,t=t-o-1,b[0]=Uy(10,(ya-t%ya)%ya),e.e=Sw(-t/ya)||0):(b.length=1,b[0]=e.e=e.s=0),e;if(n==0?(b.length=S,o=1,S--):(b.length=S+1,o=Uy(10,ya-n),b[S]=s>0?(y/Uy(10,h-s)%Uy(10,s)|0)*o:0),m)for(;;)if(S==0){(b[0]+=o)==ll&&(b[0]=1,++e.e);break}else{if(b[S]+=o,b[S]!=ll)break;b[S--]=0,o=1}for(n=b.length;b[--n]===0;)b.pop();if(Oa&&(e.e>ek||e.e<-ek))throw Error(X$+Ro(e));return e}function Ece(e,t){var r,n,s,o,h,i,m,y,S,b,T=e.constructor,A=T.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new T(e),Oa?ta(t,A):t;if(m=e.d,b=t.d,n=t.e,y=e.e,m=m.slice(),h=y-n,h){for(S=h<0,S?(r=m,h=-h,i=b.length):(r=b,n=y,i=m.length),s=Math.max(Math.ceil(A/ya),i)+2,h>s&&(h=s,r.length=1),r.reverse(),s=h;s--;)r.push(0);r.reverse()}else{for(s=m.length,i=b.length,S=s<i,S&&(i=s),s=0;s<i;s++)if(m[s]!=b[s]){S=m[s]<b[s];break}h=0}for(S&&(r=m,m=b,b=r,t.s=-t.s),i=m.length,s=b.length-i;s>0;--s)m[i++]=0;for(s=b.length;s>h;){if(m[--s]<b[s]){for(o=s;o&&m[--o]===0;)m[o]=ll-1;--m[o],m[s]+=ll}m[s]-=b[s]}for(;m[--i]===0;)m.pop();for(;m[0]===0;m.shift())--n;return m[0]?(t.d=m,t.e=n,Oa?ta(t,A):t):new T(0)}function Bv(e,t,r){var n,s=Ro(e),o=Rh(e.d),h=o.length;return t?(r&&(n=r-h)>0?o=o.charAt(0)+"."+o.slice(1)+Em(n):h>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(s<0?"e":"e+")+s):s<0?(o="0."+Em(-s-1)+o,r&&(n=r-h)>0&&(o+=Em(n))):s>=h?(o+=Em(s+1-h),r&&(n=r-s-1)>0&&(o=o+"."+Em(n))):((n=s+1)<h&&(o=o.slice(0,n)+"."+o.slice(n)),r&&(n=r-h)>0&&(s+1===h&&(o+="."),o+=Em(n))),e.s<0?"-"+o:o}function SK(e,t){if(e.length>t)return e.length=t,!0}function Tce(e){var t,r,n;function s(o){var h=this;if(!(h instanceof s))return new s(o);if(h.constructor=s,o instanceof s){h.s=o.s,h.e=o.e,h.d=(o=o.d)?o.slice():o;return}if(typeof o=="number"){if(o*0!==0)throw Error(gv+o);if(o>0)h.s=1;else if(o<0)o=-o,h.s=-1;else{h.s=0,h.e=0,h.d=[0];return}if(o===~~o&&o<1e7){h.e=0,h.d=[o];return}return wK(h,o.toString())}else if(typeof o!="string")throw Error(gv+o);if(o.charCodeAt(0)===45?(o=o.slice(1),h.s=-1):h.s=1,tGe.test(o))wK(h,o);else throw Error(gv+o)}if(s.prototype=Tn,s.ROUND_UP=0,s.ROUND_DOWN=1,s.ROUND_CEIL=2,s.ROUND_FLOOR=3,s.ROUND_HALF_UP=4,s.ROUND_HALF_DOWN=5,s.ROUND_HALF_EVEN=6,s.ROUND_HALF_CEIL=7,s.ROUND_HALF_FLOOR=8,s.clone=Tce,s.config=s.set=rGe,e===void 0&&(e={}),e)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return s.config(e),s}function rGe(e){if(!e||typeof e!="object")throw Error(td+"Object expected");var t,r,n,s=["precision",1,ww,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<s.length;t+=3)if((n=e[r=s[t]])!==void 0)if(Sw(n)===n&&n>=s[t+1]&&n<=s[t+2])this[r]=n;else throw Error(gv+r+": "+n);if((n=e[r="LN10"])!==void 0)if(n==Math.LN10)this[r]=new this(n);else throw Error(gv+r+": "+n);return this}var Y$=Tce(eGe);gu=new Y$(1);const Hs=Y$;function nGe(e){return oGe(e)||aGe(e)||sGe(e)||iGe()}function iGe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sGe(e,t){if(e){if(typeof e=="string")return Ez(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ez(e,t)}}function aGe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function oGe(e){if(Array.isArray(e))return Ez(e)}function Ez(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var lGe=function(t){return t},Ace={"@@functional/placeholder":!0},Cce=function(t){return t===Ace},EK=function(t){return function r(){return arguments.length===0||arguments.length===1&&Cce(arguments.length<=0?void 0:arguments[0])?r:t.apply(void 0,arguments)}},cGe=function e(t,r){return t===1?r:EK(function(){for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];var h=s.filter(function(i){return i!==Ace}).length;return h>=t?r.apply(void 0,s):e(t-h,EK(function(){for(var i=arguments.length,m=new Array(i),y=0;y<i;y++)m[y]=arguments[y];var S=s.map(function(b){return Cce(b)?m.shift():b});return r.apply(void 0,nGe(S).concat(m))}))})},TI=function(t){return cGe(t.length,t)},Tz=function(t,r){for(var n=[],s=t;s<r;++s)n[s-t]=s;return n},uGe=TI(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(r){return t[r]}).map(e)}),dGe=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(!r.length)return lGe;var s=r.reverse(),o=s[0],h=s.slice(1);return function(){return h.reduce(function(i,m){return m(i)},o.apply(void 0,arguments))}},Az=function(t){return Array.isArray(t)?t.reverse():t.split("").reverse.join("")},jce=function(t){var r=null,n=null;return function(){for(var s=arguments.length,o=new Array(s),h=0;h<s;h++)o[h]=arguments[h];return r&&o.every(function(i,m){return i===r[m]})||(r=o,n=t.apply(void 0,o)),n}};function hGe(e){var t;return e===0?t=1:t=Math.floor(new Hs(e).abs().log(10).toNumber())+1,t}function fGe(e,t,r){for(var n=new Hs(e),s=0,o=[];n.lt(t)&&s<1e5;)o.push(n.toNumber()),n=n.add(r),s++;return o}var pGe=TI(function(e,t,r){var n=+e,s=+t;return n+r*(s-n)}),mGe=TI(function(e,t,r){var n=t-+e;return n=n||1/0,(r-e)/n}),gGe=TI(function(e,t,r){var n=t-+e;return n=n||1/0,Math.max(0,Math.min(1,(r-e)/n))});const AI={rangeStep:fGe,getDigitCount:hGe,interpolateNumber:pGe,uninterpolateNumber:mGe,uninterpolateTruncation:gGe};function Cz(e){return _Ge(e)||vGe(e)||Pce(e)||yGe()}function yGe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vGe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function _Ge(e){if(Array.isArray(e))return jz(e)}function UT(e,t){return wGe(e)||bGe(e,t)||Pce(e,t)||xGe()}function xGe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pce(e,t){if(e){if(typeof e=="string")return jz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jz(e,t)}}function jz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function bGe(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,s=!1,o=void 0;try{for(var h=e[Symbol.iterator](),i;!(n=(i=h.next()).done)&&(r.push(i.value),!(t&&r.length===t));n=!0);}catch(m){s=!0,o=m}finally{try{!n&&h.return!=null&&h.return()}finally{if(s)throw o}}return r}}function wGe(e){if(Array.isArray(e))return e}function Oce(e){var t=UT(e,2),r=t[0],n=t[1],s=r,o=n;return r>n&&(s=n,o=r),[s,o]}function kce(e,t,r){if(e.lte(0))return new Hs(0);var n=AI.getDigitCount(e.toNumber()),s=new Hs(10).pow(n),o=e.div(s),h=n!==1?.05:.1,i=new Hs(Math.ceil(o.div(h).toNumber())).add(r).mul(h),m=i.mul(s);return t?m:new Hs(Math.ceil(m))}function SGe(e,t,r){var n=1,s=new Hs(e);if(!s.isint()&&r){var o=Math.abs(e);o<1?(n=new Hs(10).pow(AI.getDigitCount(e)-1),s=new Hs(Math.floor(s.div(n).toNumber())).mul(n)):o>1&&(s=new Hs(Math.floor(e)))}else e===0?s=new Hs(Math.floor((t-1)/2)):r||(s=new Hs(Math.floor(e)));var h=Math.floor((t-1)/2),i=dGe(uGe(function(m){return s.add(new Hs(m-h).mul(n)).toNumber()}),Tz);return i(0,t)}function Nce(e,t,r,n){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new Hs(0),tickMin:new Hs(0),tickMax:new Hs(0)};var o=kce(new Hs(t).sub(e).div(r-1),n,s),h;e<=0&&t>=0?h=new Hs(0):(h=new Hs(e).add(t).div(2),h=h.sub(new Hs(h).mod(o)));var i=Math.ceil(h.sub(e).div(o).toNumber()),m=Math.ceil(new Hs(t).sub(h).div(o).toNumber()),y=i+m+1;return y>r?Nce(e,t,r,n,s+1):(y<r&&(m=t>0?m+(r-y):m,i=t>0?i:i+(r-y)),{step:o,tickMin:h.sub(new Hs(i).mul(o)),tickMax:h.add(new Hs(m).mul(o))})}function EGe(e){var t=UT(e,2),r=t[0],n=t[1],s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,h=Math.max(s,2),i=Oce([r,n]),m=UT(i,2),y=m[0],S=m[1];if(y===-1/0||S===1/0){var b=S===1/0?[y].concat(Cz(Tz(0,s-1).map(function(){return 1/0}))):[].concat(Cz(Tz(0,s-1).map(function(){return-1/0})),[S]);return r>n?Az(b):b}if(y===S)return SGe(y,s,o);var T=Nce(y,S,h,o),A=T.step,O=T.tickMin,P=T.tickMax,I=AI.rangeStep(O,P.add(new Hs(.1).mul(A)),A);return r>n?Az(I):I}function TGe(e,t){var r=UT(e,2),n=r[0],s=r[1],o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,h=Oce([n,s]),i=UT(h,2),m=i[0],y=i[1];if(m===-1/0||y===1/0)return[n,s];if(m===y)return[m];var S=Math.max(t,2),b=kce(new Hs(y).sub(m).div(S-1),o,0),T=[].concat(Cz(AI.rangeStep(new Hs(m),new Hs(y).sub(new Hs(.99).mul(b)),b)),[y]);return n>s?Az(T):T}var AGe=jce(EGe),CGe=jce(TGe),jGe="Invariant failed";function $v(e,t){throw new Error(jGe)}var PGe=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function kb(e){"@babel/helpers - typeof";return kb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kb(e)}function tk(){return tk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},tk.apply(this,arguments)}function OGe(e,t){return RGe(e)||IGe(e,t)||NGe(e,t)||kGe()}function kGe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function NGe(e,t){if(e){if(typeof e=="string")return TK(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return TK(e,t)}}function TK(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function IGe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,h,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(h=r.return(),Object(h)!==h))return}finally{if(y)throw s}}return i}}function RGe(e){if(Array.isArray(e))return e}function MGe(e,t){if(e==null)return{};var r=DGe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function DGe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function LGe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function FGe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Mce(n.key),n)}}function zGe(e,t,r){return t&&FGe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function BGe(e,t,r){return t=rk(t),$Ge(e,Ice()?Reflect.construct(t,r||[],rk(e).constructor):t.apply(e,r))}function $Ge(e,t){if(t&&(kb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return UGe(e)}function UGe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ice(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ice=function(){return!!e})()}function rk(e){return rk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},rk(e)}function VGe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Pz(e,t)}function Pz(e,t){return Pz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Pz(e,t)}function Rce(e,t,r){return t=Mce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Mce(e){var t=qGe(e,"string");return kb(t)=="symbol"?t:t+""}function qGe(e,t){if(kb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(kb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Y2=function(e){function t(){return LGe(this,t),BGe(this,t,arguments)}return VGe(t,e),zGe(t,[{key:"render",value:function(){var n=this.props,s=n.offset,o=n.layout,h=n.width,i=n.dataKey,m=n.data,y=n.dataPointFormatter,S=n.xAxis,b=n.yAxis,T=MGe(n,PGe),A=Qn(T,!1);this.props.direction==="x"&&S.type!=="number"&&$v();var O=m.map(function(P){var I=y(P,i),R=I.x,M=I.y,F=I.value,z=I.errorVal;if(!z)return null;var $=[],W,K;if(Array.isArray(z)){var ee=OGe(z,2);W=ee[0],K=ee[1]}else W=K=z;if(o==="vertical"){var ne=S.scale,ie=M+s,re=ie+h,te=ie-h,ae=ne(F-W),ue=ne(F+K);$.push({x1:ue,y1:re,x2:ue,y2:te}),$.push({x1:ae,y1:ie,x2:ue,y2:ie}),$.push({x1:ae,y1:re,x2:ae,y2:te})}else if(o==="horizontal"){var be=b.scale,we=R+s,Ce=we-h,_e=we+h,me=be(F-W),Ae=be(F+K);$.push({x1:Ce,y1:Ae,x2:_e,y2:Ae}),$.push({x1:we,y1:me,x2:we,y2:Ae}),$.push({x1:Ce,y1:me,x2:_e,y2:me})}return Ue.createElement(js,tk({className:"recharts-errorBar",key:"bar-".concat($.map(function(ge){return"".concat(ge.x1,"-").concat(ge.x2,"-").concat(ge.y1,"-").concat(ge.y2)}))},A),$.map(function(ge){return Ue.createElement("line",tk({},ge,{key:"line-".concat(ge.x1,"-").concat(ge.x2,"-").concat(ge.y1,"-").concat(ge.y2)}))}))});return Ue.createElement(js,{className:"recharts-errorBars"},O)}}])}(Ue.Component);Rce(Y2,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});Rce(Y2,"displayName","ErrorBar");function VT(e){"@babel/helpers - typeof";return VT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},VT(e)}function AK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function ky(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?AK(Object(r),!0).forEach(function(n){HGe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):AK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function HGe(e,t,r){return t=GGe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function GGe(e){var t=WGe(e,"string");return VT(t)=="symbol"?t:t+""}function WGe(e,t){if(VT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(VT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Dce=function(t){var r=t.children,n=t.formattedGraphicalItems,s=t.legendWidth,o=t.legendContent,h=uu(r,Ih);if(!h)return null;var i=Ih.defaultProps,m=i!==void 0?ky(ky({},i),h.props):{},y;return h.props&&h.props.payload?y=h.props&&h.props.payload:o==="children"?y=(n||[]).reduce(function(S,b){var T=b.item,A=b.props,O=A.sectors||A.data||[];return S.concat(O.map(function(P){return{type:h.props.iconType||T.props.legendType,value:P.name,color:P.fill,payload:P}}))},[]):y=(n||[]).map(function(S){var b=S.item,T=b.type.defaultProps,A=T!==void 0?ky(ky({},T),b.props):{},O=A.dataKey,P=A.name,I=A.legendType,R=A.hide;return{inactive:R,dataKey:O,type:m.iconType||I||"square",color:J$(b),value:P||O,payload:A}}),ky(ky(ky({},m),Ih.getWithHeight(h,s)),{},{payload:y,item:h})};function qT(e){"@babel/helpers - typeof";return qT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qT(e)}function CK(e){return YGe(e)||XGe(e)||ZGe(e)||KGe()}function KGe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ZGe(e,t){if(e){if(typeof e=="string")return Oz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Oz(e,t)}}function XGe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function YGe(e){if(Array.isArray(e))return Oz(e)}function Oz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function jK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function ro(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?jK(Object(r),!0).forEach(function(n){D0(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function D0(e,t,r){return t=JGe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function JGe(e){var t=QGe(e,"string");return qT(t)=="symbol"?t:t+""}function QGe(e,t){if(qT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(qT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Ko(e,t,r){return ki(e)||ki(t)?r:Xo(t)?bu(e,t,r):vi(t)?t(e):r}function zE(e,t,r,n){var s=YHe(e,function(i){return Ko(i,t)});if(r==="number"){var o=s.filter(function(i){return Gr(i)||parseFloat(i)});return o.length?[EI(o),SI(o)]:[1/0,-1/0]}var h=n?s.filter(function(i){return!ki(i)}):s;return h.map(function(i){return Xo(i)||i instanceof Date?i:""})}var eWe=function(t){var r,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],s=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,h=-1,i=(r=n==null?void 0:n.length)!==null&&r!==void 0?r:0;if(i<=1)return 0;if(o&&o.axisType==="angleAxis"&&Math.abs(Math.abs(o.range[1]-o.range[0])-360)<=1e-6)for(var m=o.range,y=0;y<i;y++){var S=y>0?s[y-1].coordinate:s[i-1].coordinate,b=s[y].coordinate,T=y>=i-1?s[0].coordinate:s[y+1].coordinate,A=void 0;if(hc(b-S)!==hc(T-b)){var O=[];if(hc(T-b)===hc(m[1]-m[0])){A=T;var P=b+m[1]-m[0];O[0]=Math.min(P,(P+S)/2),O[1]=Math.max(P,(P+S)/2)}else{A=S;var I=T+m[1]-m[0];O[0]=Math.min(b,(I+b)/2),O[1]=Math.max(b,(I+b)/2)}var R=[Math.min(b,(A+b)/2),Math.max(b,(A+b)/2)];if(t>R[0]&&t<=R[1]||t>=O[0]&&t<=O[1]){h=s[y].index;break}}else{var M=Math.min(S,T),F=Math.max(S,T);if(t>(M+b)/2&&t<=(F+b)/2){h=s[y].index;break}}}else for(var z=0;z<i;z++)if(z===0&&t<=(n[z].coordinate+n[z+1].coordinate)/2||z>0&&z<i-1&&t>(n[z].coordinate+n[z-1].coordinate)/2&&t<=(n[z].coordinate+n[z+1].coordinate)/2||z===i-1&&t>(n[z].coordinate+n[z-1].coordinate)/2){h=n[z].index;break}return h},J$=function(t){var r,n=t,s=n.type.displayName,o=(r=t.type)!==null&&r!==void 0&&r.defaultProps?ro(ro({},t.type.defaultProps),t.props):t.props,h=o.stroke,i=o.fill,m;switch(s){case"Line":m=h;break;case"Area":case"Radar":m=h&&h!=="none"?h:i;break;default:m=i;break}return m},tWe=function(t){var r=t.barSize,n=t.totalSize,s=t.stackGroups,o=s===void 0?{}:s;if(!o)return{};for(var h={},i=Object.keys(o),m=0,y=i.length;m<y;m++)for(var S=o[i[m]].stackGroups,b=Object.keys(S),T=0,A=b.length;T<A;T++){var O=S[b[T]],P=O.items,I=O.cateAxisId,R=P.filter(function(K){return Xf(K.type).indexOf("Bar")>=0});if(R&&R.length){var M=R[0].type.defaultProps,F=M!==void 0?ro(ro({},M),R[0].props):R[0].props,z=F.barSize,$=F[I];h[$]||(h[$]=[]);var W=ki(z)?r:z;h[$].push({item:R[0],stackList:R.slice(1),barSize:ki(W)?void 0:fc(W,n,0)})}}return h},rWe=function(t){var r=t.barGap,n=t.barCategoryGap,s=t.bandSize,o=t.sizeList,h=o===void 0?[]:o,i=t.maxBarSize,m=h.length;if(m<1)return null;var y=fc(r,s,0,!0),S,b=[];if(h[0].barSize===+h[0].barSize){var T=!1,A=s/m,O=h.reduce(function(z,$){return z+$.barSize||0},0);O+=(m-1)*y,O>=s&&(O-=(m-1)*y,y=0),O>=s&&A>0&&(T=!0,A*=.9,O=m*A);var P=(s-O)/2>>0,I={offset:P-y,size:0};S=h.reduce(function(z,$){var W={item:$.item,position:{offset:I.offset+I.size+y,size:T?A:$.barSize}},K=[].concat(CK(z),[W]);return I=K[K.length-1].position,$.stackList&&$.stackList.length&&$.stackList.forEach(function(ee){K.push({item:ee,position:I})}),K},b)}else{var R=fc(n,s,0,!0);s-2*R-(m-1)*y<=0&&(y=0);var M=(s-2*R-(m-1)*y)/m;M>1&&(M>>=0);var F=i===+i?Math.min(M,i):M;S=h.reduce(function(z,$,W){var K=[].concat(CK(z),[{item:$.item,position:{offset:R+(M+y)*W+(M-F)/2,size:F}}]);return $.stackList&&$.stackList.length&&$.stackList.forEach(function(ee){K.push({item:ee,position:K[K.length-1].position})}),K},b)}return S},nWe=function(t,r,n,s){var o=n.children,h=n.width,i=n.margin,m=h-(i.left||0)-(i.right||0),y=Dce({children:o,legendWidth:m});if(y){var S=s||{},b=S.width,T=S.height,A=y.align,O=y.verticalAlign,P=y.layout;if((P==="vertical"||P==="horizontal"&&O==="middle")&&A!=="center"&&Gr(t[A]))return ro(ro({},t),{},D0({},A,t[A]+(b||0)));if((P==="horizontal"||P==="vertical"&&A==="center")&&O!=="middle"&&Gr(t[O]))return ro(ro({},t),{},D0({},O,t[O]+(T||0)))}return t},iWe=function(t,r,n){return ki(r)?!0:t==="horizontal"?r==="yAxis":t==="vertical"||n==="x"?r==="xAxis":n==="y"?r==="yAxis":!0},Lce=function(t,r,n,s,o){var h=r.props.children,i=wu(h,Y2).filter(function(y){return iWe(s,o,y.props.direction)});if(i&&i.length){var m=i.map(function(y){return y.props.dataKey});return t.reduce(function(y,S){var b=Ko(S,n);if(ki(b))return y;var T=Array.isArray(b)?[EI(b),SI(b)]:[b,b],A=m.reduce(function(O,P){var I=Ko(S,P,0),R=T[0]-Math.abs(Array.isArray(I)?I[0]:I),M=T[1]+Math.abs(Array.isArray(I)?I[1]:I);return[Math.min(R,O[0]),Math.max(M,O[1])]},[1/0,-1/0]);return[Math.min(A[0],y[0]),Math.max(A[1],y[1])]},[1/0,-1/0])}return null},sWe=function(t,r,n,s,o){var h=r.map(function(i){return Lce(t,i,n,o,s)}).filter(function(i){return!ki(i)});return h&&h.length?h.reduce(function(i,m){return[Math.min(i[0],m[0]),Math.max(i[1],m[1])]},[1/0,-1/0]):null},Fce=function(t,r,n,s,o){var h=r.map(function(m){var y=m.props.dataKey;return n==="number"&&y&&Lce(t,m,y,s)||zE(t,y,n,o)});if(n==="number")return h.reduce(function(m,y){return[Math.min(m[0],y[0]),Math.max(m[1],y[1])]},[1/0,-1/0]);var i={};return h.reduce(function(m,y){for(var S=0,b=y.length;S<b;S++)i[y[S]]||(i[y[S]]=!0,m.push(y[S]));return m},[])},zce=function(t,r){return t==="horizontal"&&r==="xAxis"||t==="vertical"&&r==="yAxis"||t==="centric"&&r==="angleAxis"||t==="radial"&&r==="radiusAxis"},Bce=function(t,r,n,s){if(s)return t.map(function(m){return m.coordinate});var o,h,i=t.map(function(m){return m.coordinate===r&&(o=!0),m.coordinate===n&&(h=!0),m.coordinate});return o||i.push(r),h||i.push(n),i},Kf=function(t,r,n){if(!t)return null;var s=t.scale,o=t.duplicateDomain,h=t.type,i=t.range,m=t.realScaleType==="scaleBand"?s.bandwidth()/2:2,y=(r||n)&&h==="category"&&s.bandwidth?s.bandwidth()/m:0;if(y=t.axisType==="angleAxis"&&(i==null?void 0:i.length)>=2?hc(i[0]-i[1])*2*y:y,r&&(t.ticks||t.niceTicks)){var S=(t.ticks||t.niceTicks).map(function(b){var T=o?o.indexOf(b):b;return{coordinate:s(T)+y,value:b,offset:y}});return S.filter(function(b){return!q2(b.coordinate)})}return t.isCategorical&&t.categoricalDomain?t.categoricalDomain.map(function(b,T){return{coordinate:s(b)+y,value:b,index:T,offset:y}}):s.ticks&&!n?s.ticks(t.tickCount).map(function(b){return{coordinate:s(b)+y,value:b,offset:y}}):s.domain().map(function(b,T){return{coordinate:s(b)+y,value:o?o[b]:b,index:T,offset:y}})},xL=new WeakMap,Lj=function(t,r){if(typeof r!="function")return t;xL.has(t)||xL.set(t,new WeakMap);var n=xL.get(t);if(n.has(r))return n.get(r);var s=function(){t.apply(void 0,arguments),r.apply(void 0,arguments)};return n.set(r,s),s},$ce=function(t,r,n){var s=t.scale,o=t.type,h=t.layout,i=t.axisType;if(s==="auto")return h==="radial"&&i==="radiusAxis"?{scale:DT(),realScaleType:"band"}:h==="radial"&&i==="angleAxis"?{scale:XO(),realScaleType:"linear"}:o==="category"&&r&&(r.indexOf("LineChart")>=0||r.indexOf("AreaChart")>=0||r.indexOf("ComposedChart")>=0&&!n)?{scale:FE(),realScaleType:"point"}:o==="category"?{scale:DT(),realScaleType:"band"}:{scale:XO(),realScaleType:"linear"};if(Lv(s)){var m="scale".concat(cI(s));return{scale:(bK[m]||FE)(),realScaleType:bK[m]?m:"point"}}return vi(s)?{scale:s}:{scale:FE(),realScaleType:"point"}},PK=1e-4,Uce=function(t){var r=t.domain();if(!(!r||r.length<=2)){var n=r.length,s=t.range(),o=Math.min(s[0],s[1])-PK,h=Math.max(s[0],s[1])+PK,i=t(r[0]),m=t(r[n-1]);(i<o||i>h||m<o||m>h)&&t.domain([r[0],r[n-1]])}},aWe=function(t,r){if(!t)return null;for(var n=0,s=t.length;n<s;n++)if(t[n].item===r)return t[n].position;return null},oWe=function(t,r){if(!r||r.length!==2||!Gr(r[0])||!Gr(r[1]))return t;var n=Math.min(r[0],r[1]),s=Math.max(r[0],r[1]),o=[t[0],t[1]];return(!Gr(t[0])||t[0]<n)&&(o[0]=n),(!Gr(t[1])||t[1]>s)&&(o[1]=s),o[0]>s&&(o[0]=s),o[1]<n&&(o[1]=n),o},lWe=function(t){var r=t.length;if(!(r<=0))for(var n=0,s=t[0].length;n<s;++n)for(var o=0,h=0,i=0;i<r;++i){var m=q2(t[i][n][1])?t[i][n][0]:t[i][n][1];m>=0?(t[i][n][0]=o,t[i][n][1]=o+m,o=t[i][n][1]):(t[i][n][0]=h,t[i][n][1]=h+m,h=t[i][n][1])}},cWe=function(t){var r=t.length;if(!(r<=0))for(var n=0,s=t[0].length;n<s;++n)for(var o=0,h=0;h<r;++h){var i=q2(t[h][n][1])?t[h][n][0]:t[h][n][1];i>=0?(t[h][n][0]=o,t[h][n][1]=o+i,o=t[h][n][1]):(t[h][n][0]=0,t[h][n][1]=0)}},uWe={sign:lWe,expand:OFe,none:Sb,silhouette:kFe,wiggle:NFe,positive:cWe},dWe=function(t,r,n){var s=r.map(function(i){return i.props.dataKey}),o=uWe[n],h=PFe().keys(s).value(function(i,m){return+Ko(i,m,0)}).order(tz).offset(o);return h(t)},hWe=function(t,r,n,s,o,h){if(!t)return null;var i=h?r.reverse():r,m={},y=i.reduce(function(b,T){var A,O=(A=T.type)!==null&&A!==void 0&&A.defaultProps?ro(ro({},T.type.defaultProps),T.props):T.props,P=O.stackId,I=O.hide;if(I)return b;var R=O[n],M=b[R]||{hasStack:!1,stackGroups:{}};if(Xo(P)){var F=M.stackGroups[P]||{numericAxisId:n,cateAxisId:s,items:[]};F.items.push(T),M.hasStack=!0,M.stackGroups[P]=F}else M.stackGroups[yw("_stackId_")]={numericAxisId:n,cateAxisId:s,items:[T]};return ro(ro({},b),{},D0({},R,M))},m),S={};return Object.keys(y).reduce(function(b,T){var A=y[T];if(A.hasStack){var O={};A.stackGroups=Object.keys(A.stackGroups).reduce(function(P,I){var R=A.stackGroups[I];return ro(ro({},P),{},D0({},I,{numericAxisId:n,cateAxisId:s,items:R.items,stackedData:dWe(t,R.items,o)}))},O)}return ro(ro({},b),{},D0({},T,A))},S)},Vce=function(t,r){var n=r.realScaleType,s=r.type,o=r.tickCount,h=r.originalDomain,i=r.allowDecimals,m=n||r.scale;if(m!=="auto"&&m!=="linear")return null;if(o&&s==="number"&&h&&(h[0]==="auto"||h[1]==="auto")){var y=t.domain();if(!y.length)return null;var S=AGe(y,o,i);return t.domain([EI(S),SI(S)]),{niceTicks:S}}if(o&&s==="number"){var b=t.domain(),T=CGe(b,o,i);return{niceTicks:T}}return null};function OK(e){var t=e.axis,r=e.ticks,n=e.bandSize,s=e.entry,o=e.index,h=e.dataKey;if(t.type==="category"){if(!t.allowDuplicatedCategory&&t.dataKey&&!ki(s[t.dataKey])){var i=PO(r,"value",s[t.dataKey]);if(i)return i.coordinate+n/2}return r[o]?r[o].coordinate+n/2:null}var m=Ko(s,ki(h)?t.dataKey:h);return ki(m)?null:t.scale(m)}var kK=function(t){var r=t.axis,n=t.ticks,s=t.offset,o=t.bandSize,h=t.entry,i=t.index;if(r.type==="category")return n[i]?n[i].coordinate+s:null;var m=Ko(h,r.dataKey,r.domain[i]);return ki(m)?null:r.scale(m)-o/2+s},fWe=function(t){var r=t.numericAxis,n=r.scale.domain();if(r.type==="number"){var s=Math.min(n[0],n[1]),o=Math.max(n[0],n[1]);return s<=0&&o>=0?0:o<0?o:s}return n[0]},pWe=function(t,r){var n,s=(n=t.type)!==null&&n!==void 0&&n.defaultProps?ro(ro({},t.type.defaultProps),t.props):t.props,o=s.stackId;if(Xo(o)){var h=r[o];if(h){var i=h.items.indexOf(t);return i>=0?h.stackedData[i]:null}}return null},mWe=function(t){return t.reduce(function(r,n){return[EI(n.concat([r[0]]).filter(Gr)),SI(n.concat([r[1]]).filter(Gr))]},[1/0,-1/0])},qce=function(t,r,n){return Object.keys(t).reduce(function(s,o){var h=t[o],i=h.stackedData,m=i.reduce(function(y,S){var b=mWe(S.slice(r,n+1));return[Math.min(y[0],b[0]),Math.max(y[1],b[1])]},[1/0,-1/0]);return[Math.min(m[0],s[0]),Math.max(m[1],s[1])]},[1/0,-1/0]).map(function(s){return s===1/0||s===-1/0?0:s})},NK=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,IK=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,kz=function(t,r,n){if(vi(t))return t(r,n);if(!Array.isArray(t))return r;var s=[];if(Gr(t[0]))s[0]=n?t[0]:Math.min(t[0],r[0]);else if(NK.test(t[0])){var o=+NK.exec(t[0])[1];s[0]=r[0]-o}else vi(t[0])?s[0]=t[0](r[0]):s[0]=r[0];if(Gr(t[1]))s[1]=n?t[1]:Math.max(t[1],r[1]);else if(IK.test(t[1])){var h=+IK.exec(t[1])[1];s[1]=r[1]+h}else vi(t[1])?s[1]=t[1](r[1]):s[1]=r[1];return s},nk=function(t,r,n){if(t&&t.scale&&t.scale.bandwidth){var s=t.scale.bandwidth();if(!n||s>0)return s}if(t&&r&&r.length>=2){for(var o=A$(r,function(b){return b.coordinate}),h=1/0,i=1,m=o.length;i<m;i++){var y=o[i],S=o[i-1];h=Math.min((y.coordinate||0)-(S.coordinate||0),h)}return h===1/0?0:h}return n?void 0:0},RK=function(t,r,n){return!t||!t.length||X2(t,bu(n,"type.defaultProps.domain"))?r:t},Hce=function(t,r){var n=t.type.defaultProps?ro(ro({},t.type.defaultProps),t.props):t.props,s=n.dataKey,o=n.name,h=n.unit,i=n.formatter,m=n.tooltipType,y=n.chartType,S=n.hide;return ro(ro({},Qn(t,!1)),{},{dataKey:s,unit:h,formatter:i,name:o||s,color:J$(t),value:Ko(r,s),type:m,payload:r,chartType:y,hide:S})};function HT(e){"@babel/helpers - typeof";return HT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},HT(e)}function MK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Mf(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?MK(Object(r),!0).forEach(function(n){Gce(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):MK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Gce(e,t,r){return t=gWe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gWe(e){var t=yWe(e,"string");return HT(t)=="symbol"?t:t+""}function yWe(e,t){if(HT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(HT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function vWe(e,t){return wWe(e)||bWe(e,t)||xWe(e,t)||_We()}function _We(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xWe(e,t){if(e){if(typeof e=="string")return DK(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return DK(e,t)}}function DK(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function bWe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,h,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(h=r.return(),Object(h)!==h))return}finally{if(y)throw s}}return i}}function wWe(e){if(Array.isArray(e))return e}var ik=Math.PI/180,SWe=function(t){return t*180/Math.PI},la=function(t,r,n,s){return{x:t+Math.cos(-ik*s)*n,y:r+Math.sin(-ik*s)*n}},Wce=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(t-(n.left||0)-(n.right||0)),Math.abs(r-(n.top||0)-(n.bottom||0)))/2},EWe=function(t,r,n,s,o){var h=t.width,i=t.height,m=t.startAngle,y=t.endAngle,S=fc(t.cx,h,h/2),b=fc(t.cy,i,i/2),T=Wce(h,i,n),A=fc(t.innerRadius,T,0),O=fc(t.outerRadius,T,T*.8),P=Object.keys(r);return P.reduce(function(I,R){var M=r[R],F=M.domain,z=M.reversed,$;if(ki(M.range))s==="angleAxis"?$=[m,y]:s==="radiusAxis"&&($=[A,O]),z&&($=[$[1],$[0]]);else{$=M.range;var W=$,K=vWe(W,2);m=K[0],y=K[1]}var ee=$ce(M,o),ne=ee.realScaleType,ie=ee.scale;ie.domain(F).range($),Uce(ie);var re=Vce(ie,Mf(Mf({},M),{},{realScaleType:ne})),te=Mf(Mf(Mf({},M),re),{},{range:$,radius:O,realScaleType:ne,scale:ie,cx:S,cy:b,innerRadius:A,outerRadius:O,startAngle:m,endAngle:y});return Mf(Mf({},I),{},Gce({},R,te))},{})},TWe=function(t,r){var n=t.x,s=t.y,o=r.x,h=r.y;return Math.sqrt(Math.pow(n-o,2)+Math.pow(s-h,2))},AWe=function(t,r){var n=t.x,s=t.y,o=r.cx,h=r.cy,i=TWe({x:n,y:s},{x:o,y:h});if(i<=0)return{radius:i};var m=(n-o)/i,y=Math.acos(m);return s>h&&(y=2*Math.PI-y),{radius:i,angle:SWe(y),angleInRadian:y}},CWe=function(t){var r=t.startAngle,n=t.endAngle,s=Math.floor(r/360),o=Math.floor(n/360),h=Math.min(s,o);return{startAngle:r-h*360,endAngle:n-h*360}},jWe=function(t,r){var n=r.startAngle,s=r.endAngle,o=Math.floor(n/360),h=Math.floor(s/360),i=Math.min(o,h);return t+i*360},LK=function(t,r){var n=t.x,s=t.y,o=AWe({x:n,y:s},r),h=o.radius,i=o.angle,m=r.innerRadius,y=r.outerRadius;if(h<m||h>y)return!1;if(h===0)return!0;var S=CWe(r),b=S.startAngle,T=S.endAngle,A=i,O;if(b<=T){for(;A>T;)A-=360;for(;A<b;)A+=360;O=A>=b&&A<=T}else{for(;A>b;)A-=360;for(;A<T;)A+=360;O=A>=T&&A<=b}return O?Mf(Mf({},r),{},{radius:h,angle:jWe(A,r)}):null},Kce=function(t){return!V.isValidElement(t)&&!vi(t)&&typeof t!="boolean"?t.className:""};function GT(e){"@babel/helpers - typeof";return GT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},GT(e)}var PWe=["offset"];function OWe(e){return RWe(e)||IWe(e)||NWe(e)||kWe()}function kWe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function NWe(e,t){if(e){if(typeof e=="string")return Nz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Nz(e,t)}}function IWe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function RWe(e){if(Array.isArray(e))return Nz(e)}function Nz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function MWe(e,t){if(e==null)return{};var r=DWe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function DWe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function FK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Vo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?FK(Object(r),!0).forEach(function(n){LWe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):FK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function LWe(e,t,r){return t=FWe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function FWe(e){var t=zWe(e,"string");return GT(t)=="symbol"?t:t+""}function zWe(e,t){if(GT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(GT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function WT(){return WT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},WT.apply(this,arguments)}var BWe=function(t){var r=t.value,n=t.formatter,s=ki(t.children)?r:t.children;return vi(n)?n(s):s},$We=function(t,r){var n=hc(r-t),s=Math.min(Math.abs(r-t),360);return n*s},UWe=function(t,r,n){var s=t.position,o=t.viewBox,h=t.offset,i=t.className,m=o,y=m.cx,S=m.cy,b=m.innerRadius,T=m.outerRadius,A=m.startAngle,O=m.endAngle,P=m.clockWise,I=(b+T)/2,R=$We(A,O),M=R>=0?1:-1,F,z;s==="insideStart"?(F=A+M*h,z=P):s==="insideEnd"?(F=O-M*h,z=!P):s==="end"&&(F=O+M*h,z=P),z=R<=0?z:!z;var $=la(y,S,I,F),W=la(y,S,I,F+(z?1:-1)*359),K="M".concat($.x,",").concat($.y,`
    A`).concat(I,",").concat(I,",0,1,").concat(z?0:1,`,
    `).concat(W.x,",").concat(W.y),ee=ki(t.id)?yw("recharts-radial-line-"):t.id;return Ue.createElement("text",WT({},n,{dominantBaseline:"central",className:Ii("recharts-radial-bar-label",i)}),Ue.createElement("defs",null,Ue.createElement("path",{id:ee,d:K})),Ue.createElement("textPath",{xlinkHref:"#".concat(ee)},r))},VWe=function(t){var r=t.viewBox,n=t.offset,s=t.position,o=r,h=o.cx,i=o.cy,m=o.innerRadius,y=o.outerRadius,S=o.startAngle,b=o.endAngle,T=(S+b)/2;if(s==="outside"){var A=la(h,i,y+n,T),O=A.x,P=A.y;return{x:O,y:P,textAnchor:O>=h?"start":"end",verticalAnchor:"middle"}}if(s==="center")return{x:h,y:i,textAnchor:"middle",verticalAnchor:"middle"};if(s==="centerTop")return{x:h,y:i,textAnchor:"middle",verticalAnchor:"start"};if(s==="centerBottom")return{x:h,y:i,textAnchor:"middle",verticalAnchor:"end"};var I=(m+y)/2,R=la(h,i,I,T),M=R.x,F=R.y;return{x:M,y:F,textAnchor:"middle",verticalAnchor:"middle"}},qWe=function(t){var r=t.viewBox,n=t.parentViewBox,s=t.offset,o=t.position,h=r,i=h.x,m=h.y,y=h.width,S=h.height,b=S>=0?1:-1,T=b*s,A=b>0?"end":"start",O=b>0?"start":"end",P=y>=0?1:-1,I=P*s,R=P>0?"end":"start",M=P>0?"start":"end";if(o==="top"){var F={x:i+y/2,y:m-b*s,textAnchor:"middle",verticalAnchor:A};return Vo(Vo({},F),n?{height:Math.max(m-n.y,0),width:y}:{})}if(o==="bottom"){var z={x:i+y/2,y:m+S+T,textAnchor:"middle",verticalAnchor:O};return Vo(Vo({},z),n?{height:Math.max(n.y+n.height-(m+S),0),width:y}:{})}if(o==="left"){var $={x:i-I,y:m+S/2,textAnchor:R,verticalAnchor:"middle"};return Vo(Vo({},$),n?{width:Math.max($.x-n.x,0),height:S}:{})}if(o==="right"){var W={x:i+y+I,y:m+S/2,textAnchor:M,verticalAnchor:"middle"};return Vo(Vo({},W),n?{width:Math.max(n.x+n.width-W.x,0),height:S}:{})}var K=n?{width:y,height:S}:{};return o==="insideLeft"?Vo({x:i+I,y:m+S/2,textAnchor:M,verticalAnchor:"middle"},K):o==="insideRight"?Vo({x:i+y-I,y:m+S/2,textAnchor:R,verticalAnchor:"middle"},K):o==="insideTop"?Vo({x:i+y/2,y:m+T,textAnchor:"middle",verticalAnchor:O},K):o==="insideBottom"?Vo({x:i+y/2,y:m+S-T,textAnchor:"middle",verticalAnchor:A},K):o==="insideTopLeft"?Vo({x:i+I,y:m+T,textAnchor:M,verticalAnchor:O},K):o==="insideTopRight"?Vo({x:i+y-I,y:m+T,textAnchor:R,verticalAnchor:O},K):o==="insideBottomLeft"?Vo({x:i+I,y:m+S-T,textAnchor:M,verticalAnchor:A},K):o==="insideBottomRight"?Vo({x:i+y-I,y:m+S-T,textAnchor:R,verticalAnchor:A},K):fw(o)&&(Gr(o.x)||Yy(o.x))&&(Gr(o.y)||Yy(o.y))?Vo({x:i+fc(o.x,y),y:m+fc(o.y,S),textAnchor:"end",verticalAnchor:"end"},K):Vo({x:i+y/2,y:m+S/2,textAnchor:"middle",verticalAnchor:"middle"},K)},HWe=function(t){return"cx"in t&&Gr(t.cx)};function ul(e){var t=e.offset,r=t===void 0?5:t,n=MWe(e,PWe),s=Vo({offset:r},n),o=s.viewBox,h=s.position,i=s.value,m=s.children,y=s.content,S=s.className,b=S===void 0?"":S,T=s.textBreakAll;if(!o||ki(i)&&ki(m)&&!V.isValidElement(y)&&!vi(y))return null;if(V.isValidElement(y))return V.cloneElement(y,s);var A;if(vi(y)){if(A=V.createElement(y,s),V.isValidElement(A))return A}else A=BWe(s);var O=HWe(o),P=Qn(s,!0);if(O&&(h==="insideStart"||h==="insideEnd"||h==="end"))return UWe(s,A,P);var I=O?VWe(s):qWe(s);return Ue.createElement(zv,WT({className:Ii("recharts-label",b)},P,I,{breakAll:T}),A)}ul.displayName="Label";var Zce=function(t){var r=t.cx,n=t.cy,s=t.angle,o=t.startAngle,h=t.endAngle,i=t.r,m=t.radius,y=t.innerRadius,S=t.outerRadius,b=t.x,T=t.y,A=t.top,O=t.left,P=t.width,I=t.height,R=t.clockWise,M=t.labelViewBox;if(M)return M;if(Gr(P)&&Gr(I)){if(Gr(b)&&Gr(T))return{x:b,y:T,width:P,height:I};if(Gr(A)&&Gr(O))return{x:A,y:O,width:P,height:I}}return Gr(b)&&Gr(T)?{x:b,y:T,width:0,height:0}:Gr(r)&&Gr(n)?{cx:r,cy:n,startAngle:o||s||0,endAngle:h||s||0,innerRadius:y||0,outerRadius:S||m||i||0,clockWise:R}:t.viewBox?t.viewBox:{}},GWe=function(t,r){return t?t===!0?Ue.createElement(ul,{key:"label-implicit",viewBox:r}):Xo(t)?Ue.createElement(ul,{key:"label-implicit",viewBox:r,value:t}):V.isValidElement(t)?t.type===ul?V.cloneElement(t,{key:"label-implicit",viewBox:r}):Ue.createElement(ul,{key:"label-implicit",content:t,viewBox:r}):vi(t)?Ue.createElement(ul,{key:"label-implicit",content:t,viewBox:r}):fw(t)?Ue.createElement(ul,WT({viewBox:r},t,{key:"label-implicit"})):null:null},WWe=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&n&&!t.label)return null;var s=t.children,o=Zce(t),h=wu(s,ul).map(function(m,y){return V.cloneElement(m,{viewBox:r||o,key:"label-".concat(y)})});if(!n)return h;var i=GWe(t.label,r||o);return[i].concat(OWe(h))};ul.parseViewBox=Zce;ul.renderCallByParent=WWe;function KWe(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var ZWe=KWe;const XWe=Os(ZWe);function KT(e){"@babel/helpers - typeof";return KT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},KT(e)}var YWe=["valueAccessor"],JWe=["data","dataKey","clockWise","id","textBreakAll"];function QWe(e){return n7e(e)||r7e(e)||t7e(e)||e7e()}function e7e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function t7e(e,t){if(e){if(typeof e=="string")return Iz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Iz(e,t)}}function r7e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function n7e(e){if(Array.isArray(e))return Iz(e)}function Iz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function sk(){return sk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},sk.apply(this,arguments)}function zK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function BK(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?zK(Object(r),!0).forEach(function(n){i7e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function i7e(e,t,r){return t=s7e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s7e(e){var t=a7e(e,"string");return KT(t)=="symbol"?t:t+""}function a7e(e,t){if(KT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(KT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function $K(e,t){if(e==null)return{};var r=o7e(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function o7e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var l7e=function(t){return Array.isArray(t.value)?XWe(t.value):t.value};function Jf(e){var t=e.valueAccessor,r=t===void 0?l7e:t,n=$K(e,YWe),s=n.data,o=n.dataKey,h=n.clockWise,i=n.id,m=n.textBreakAll,y=$K(n,JWe);return!s||!s.length?null:Ue.createElement(js,{className:"recharts-label-list"},s.map(function(S,b){var T=ki(o)?r(S,b):Ko(S&&S.payload,o),A=ki(i)?{}:{id:"".concat(i,"-").concat(b)};return Ue.createElement(ul,sk({},Qn(S,!0),y,A,{parentViewBox:S.parentViewBox,value:T,textBreakAll:m,viewBox:ul.parseViewBox(ki(h)?S:BK(BK({},S),{},{clockWise:h})),key:"label-".concat(b),index:b}))}))}Jf.displayName="LabelList";function c7e(e,t){return e?e===!0?Ue.createElement(Jf,{key:"labelList-implicit",data:t}):Ue.isValidElement(e)||vi(e)?Ue.createElement(Jf,{key:"labelList-implicit",data:t,content:e}):fw(e)?Ue.createElement(Jf,sk({data:t},e,{key:"labelList-implicit"})):null:null}function u7e(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var n=e.children,s=wu(n,Jf).map(function(h,i){return V.cloneElement(h,{data:t,key:"labelList-".concat(i)})});if(!r)return s;var o=c7e(e.label,t);return[o].concat(QWe(s))}Jf.renderCallByParent=u7e;function ZT(e){"@babel/helpers - typeof";return ZT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ZT(e)}function Rz(){return Rz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Rz.apply(this,arguments)}function UK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function VK(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?UK(Object(r),!0).forEach(function(n){d7e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):UK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function d7e(e,t,r){return t=h7e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h7e(e){var t=f7e(e,"string");return ZT(t)=="symbol"?t:t+""}function f7e(e,t){if(ZT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ZT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var p7e=function(t,r){var n=hc(r-t),s=Math.min(Math.abs(r-t),359.999);return n*s},Fj=function(t){var r=t.cx,n=t.cy,s=t.radius,o=t.angle,h=t.sign,i=t.isExternal,m=t.cornerRadius,y=t.cornerIsExternal,S=m*(i?1:-1)+s,b=Math.asin(m/S)/ik,T=y?o:o+h*b,A=la(r,n,S,T),O=la(r,n,s,T),P=y?o-h*b:o,I=la(r,n,S*Math.cos(b*ik),P);return{center:A,circleTangency:O,lineTangency:I,theta:b}},Xce=function(t){var r=t.cx,n=t.cy,s=t.innerRadius,o=t.outerRadius,h=t.startAngle,i=t.endAngle,m=p7e(h,i),y=h+m,S=la(r,n,o,h),b=la(r,n,o,y),T="M ".concat(S.x,",").concat(S.y,`
    A `).concat(o,",").concat(o,`,0,
    `).concat(+(Math.abs(m)>180),",").concat(+(h>y),`,
    `).concat(b.x,",").concat(b.y,`
  `);if(s>0){var A=la(r,n,s,h),O=la(r,n,s,y);T+="L ".concat(O.x,",").concat(O.y,`
            A `).concat(s,",").concat(s,`,0,
            `).concat(+(Math.abs(m)>180),",").concat(+(h<=y),`,
            `).concat(A.x,",").concat(A.y," Z")}else T+="L ".concat(r,",").concat(n," Z");return T},m7e=function(t){var r=t.cx,n=t.cy,s=t.innerRadius,o=t.outerRadius,h=t.cornerRadius,i=t.forceCornerRadius,m=t.cornerIsExternal,y=t.startAngle,S=t.endAngle,b=hc(S-y),T=Fj({cx:r,cy:n,radius:o,angle:y,sign:b,cornerRadius:h,cornerIsExternal:m}),A=T.circleTangency,O=T.lineTangency,P=T.theta,I=Fj({cx:r,cy:n,radius:o,angle:S,sign:-b,cornerRadius:h,cornerIsExternal:m}),R=I.circleTangency,M=I.lineTangency,F=I.theta,z=m?Math.abs(y-S):Math.abs(y-S)-P-F;if(z<0)return i?"M ".concat(O.x,",").concat(O.y,`
        a`).concat(h,",").concat(h,",0,0,1,").concat(h*2,`,0
        a`).concat(h,",").concat(h,",0,0,1,").concat(-h*2,`,0
      `):Xce({cx:r,cy:n,innerRadius:s,outerRadius:o,startAngle:y,endAngle:S});var $="M ".concat(O.x,",").concat(O.y,`
    A`).concat(h,",").concat(h,",0,0,").concat(+(b<0),",").concat(A.x,",").concat(A.y,`
    A`).concat(o,",").concat(o,",0,").concat(+(z>180),",").concat(+(b<0),",").concat(R.x,",").concat(R.y,`
    A`).concat(h,",").concat(h,",0,0,").concat(+(b<0),",").concat(M.x,",").concat(M.y,`
  `);if(s>0){var W=Fj({cx:r,cy:n,radius:s,angle:y,sign:b,isExternal:!0,cornerRadius:h,cornerIsExternal:m}),K=W.circleTangency,ee=W.lineTangency,ne=W.theta,ie=Fj({cx:r,cy:n,radius:s,angle:S,sign:-b,isExternal:!0,cornerRadius:h,cornerIsExternal:m}),re=ie.circleTangency,te=ie.lineTangency,ae=ie.theta,ue=m?Math.abs(y-S):Math.abs(y-S)-ne-ae;if(ue<0&&h===0)return"".concat($,"L").concat(r,",").concat(n,"Z");$+="L".concat(te.x,",").concat(te.y,`
      A`).concat(h,",").concat(h,",0,0,").concat(+(b<0),",").concat(re.x,",").concat(re.y,`
      A`).concat(s,",").concat(s,",0,").concat(+(ue>180),",").concat(+(b>0),",").concat(K.x,",").concat(K.y,`
      A`).concat(h,",").concat(h,",0,0,").concat(+(b<0),",").concat(ee.x,",").concat(ee.y,"Z")}else $+="L".concat(r,",").concat(n,"Z");return $},g7e={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},Yce=function(t){var r=VK(VK({},g7e),t),n=r.cx,s=r.cy,o=r.innerRadius,h=r.outerRadius,i=r.cornerRadius,m=r.forceCornerRadius,y=r.cornerIsExternal,S=r.startAngle,b=r.endAngle,T=r.className;if(h<o||S===b)return null;var A=Ii("recharts-sector",T),O=h-o,P=fc(i,O,0,!0),I;return P>0&&Math.abs(S-b)<360?I=m7e({cx:n,cy:s,innerRadius:o,outerRadius:h,cornerRadius:Math.min(P,O/2),forceCornerRadius:m,cornerIsExternal:y,startAngle:S,endAngle:b}):I=Xce({cx:n,cy:s,innerRadius:o,outerRadius:h,startAngle:S,endAngle:b}),Ue.createElement("path",Rz({},Qn(r,!0),{className:A,d:I,role:"img"}))};function XT(e){"@babel/helpers - typeof";return XT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},XT(e)}function Mz(){return Mz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Mz.apply(this,arguments)}function qK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function HK(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?qK(Object(r),!0).forEach(function(n){y7e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function y7e(e,t,r){return t=v7e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function v7e(e){var t=_7e(e,"string");return XT(t)=="symbol"?t:t+""}function _7e(e,t){if(XT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(XT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var GK={curveBasisClosed:vFe,curveBasisOpen:_Fe,curveBasis:yFe,curveBumpX:nFe,curveBumpY:iFe,curveLinearClosed:xFe,curveLinear:dI,curveMonotoneX:bFe,curveMonotoneY:wFe,curveNatural:SFe,curveStep:EFe,curveStepAfter:AFe,curveStepBefore:TFe},zj=function(t){return t.x===+t.x&&t.y===+t.y},QS=function(t){return t.x},eE=function(t){return t.y},x7e=function(t,r){if(vi(t))return t;var n="curve".concat(cI(t));return(n==="curveMonotone"||n==="curveBump")&&r?GK["".concat(n).concat(r==="vertical"?"Y":"X")]:GK[n]||dI},b7e=function(t){var r=t.type,n=r===void 0?"linear":r,s=t.points,o=s===void 0?[]:s,h=t.baseLine,i=t.layout,m=t.connectNulls,y=m===void 0?!1:m,S=x7e(n,i),b=y?o.filter(function(P){return zj(P)}):o,T;if(Array.isArray(h)){var A=y?h.filter(function(P){return zj(P)}):h,O=b.map(function(P,I){return HK(HK({},P),{},{base:A[I]})});return i==="vertical"?T=Pj().y(eE).x1(QS).x0(function(P){return P.base.x}):T=Pj().x(QS).y1(eE).y0(function(P){return P.base.y}),T.defined(zj).curve(S),T(O)}return i==="vertical"&&Gr(h)?T=Pj().y(eE).x1(QS).x0(h):Gr(h)?T=Pj().x(QS).y1(eE).y0(h):T=qoe().x(QS).y(eE),T.defined(zj).curve(S),T(b)},ak=function(t){var r=t.className,n=t.points,s=t.path,o=t.pathRef;if((!n||!n.length)&&!s)return null;var h=n&&n.length?b7e(t):s;return V.createElement("path",Mz({},Qn(t,!1),OO(t),{className:Ii("recharts-curve",r),d:h,ref:o}))},Jce={exports:{}},w7e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",S7e=w7e,E7e=S7e;function Qce(){}function eue(){}eue.resetWarningCache=Qce;var T7e=function(){function e(n,s,o,h,i,m){if(m!==E7e){var y=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw y.name="Invariant Violation",y}}e.isRequired=e;function t(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:eue,resetWarningCache:Qce};return r.PropTypes=r,r};Jce.exports=T7e();var A7e=Jce.exports;const Fs=Os(A7e);var C7e=Object.getOwnPropertyNames,j7e=Object.getOwnPropertySymbols,P7e=Object.prototype.hasOwnProperty;function WK(e,t){return function(n,s,o){return e(n,s,o)&&t(n,s,o)}}function Bj(e){return function(r,n,s){if(!r||!n||typeof r!="object"||typeof n!="object")return e(r,n,s);var o=s.cache,h=o.get(r),i=o.get(n);if(h&&i)return h===n&&i===r;o.set(r,n),o.set(n,r);var m=e(r,n,s);return o.delete(r),o.delete(n),m}}function KK(e){return C7e(e).concat(j7e(e))}var O7e=Object.hasOwn||function(e,t){return P7e.call(e,t)};function n_(e,t){return e===t||!e&&!t&&e!==e&&t!==t}var k7e="__v",N7e="__o",I7e="_owner",ZK=Object.getOwnPropertyDescriptor,XK=Object.keys;function R7e(e,t,r){var n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(!r.equals(e[n],t[n],n,n,e,t,r))return!1;return!0}function M7e(e,t){return n_(e.getTime(),t.getTime())}function D7e(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function L7e(e,t){return e===t}function YK(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var s=new Array(n),o=e.entries(),h,i,m=0;(h=o.next())&&!h.done;){for(var y=t.entries(),S=!1,b=0;(i=y.next())&&!i.done;){if(s[b]){b++;continue}var T=h.value,A=i.value;if(r.equals(T[0],A[0],m,b,e,t,r)&&r.equals(T[1],A[1],T[0],A[0],e,t,r)){S=s[b]=!0;break}b++}if(!S)return!1;m++}return!0}var F7e=n_;function z7e(e,t,r){var n=XK(e),s=n.length;if(XK(t).length!==s)return!1;for(;s-- >0;)if(!tue(e,t,r,n[s]))return!1;return!0}function tE(e,t,r){var n=KK(e),s=n.length;if(KK(t).length!==s)return!1;for(var o,h,i;s-- >0;)if(o=n[s],!tue(e,t,r,o)||(h=ZK(e,o),i=ZK(t,o),(h||i)&&(!h||!i||h.configurable!==i.configurable||h.enumerable!==i.enumerable||h.writable!==i.writable)))return!1;return!0}function B7e(e,t){return n_(e.valueOf(),t.valueOf())}function $7e(e,t){return e.source===t.source&&e.flags===t.flags}function JK(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var s=new Array(n),o=e.values(),h,i;(h=o.next())&&!h.done;){for(var m=t.values(),y=!1,S=0;(i=m.next())&&!i.done;){if(!s[S]&&r.equals(h.value,i.value,h.value,i.value,e,t,r)){y=s[S]=!0;break}S++}if(!y)return!1}return!0}function U7e(e,t){var r=e.length;if(t.length!==r)return!1;for(;r-- >0;)if(e[r]!==t[r])return!1;return!0}function V7e(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function tue(e,t,r,n){return(n===I7e||n===N7e||n===k7e)&&(e.$$typeof||t.$$typeof)?!0:O7e(t,n)&&r.equals(e[n],t[n],n,n,e,t,r)}var q7e="[object Arguments]",H7e="[object Boolean]",G7e="[object Date]",W7e="[object Error]",K7e="[object Map]",Z7e="[object Number]",X7e="[object Object]",Y7e="[object RegExp]",J7e="[object Set]",Q7e="[object String]",eKe="[object URL]",tKe=Array.isArray,QK=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,eZ=Object.assign,rKe=Object.prototype.toString.call.bind(Object.prototype.toString);function nKe(e){var t=e.areArraysEqual,r=e.areDatesEqual,n=e.areErrorsEqual,s=e.areFunctionsEqual,o=e.areMapsEqual,h=e.areNumbersEqual,i=e.areObjectsEqual,m=e.arePrimitiveWrappersEqual,y=e.areRegExpsEqual,S=e.areSetsEqual,b=e.areTypedArraysEqual,T=e.areUrlsEqual;return function(O,P,I){if(O===P)return!0;if(O==null||P==null)return!1;var R=typeof O;if(R!==typeof P)return!1;if(R!=="object")return R==="number"?h(O,P,I):R==="function"?s(O,P,I):!1;var M=O.constructor;if(M!==P.constructor)return!1;if(M===Object)return i(O,P,I);if(tKe(O))return t(O,P,I);if(QK!=null&&QK(O))return b(O,P,I);if(M===Date)return r(O,P,I);if(M===RegExp)return y(O,P,I);if(M===Map)return o(O,P,I);if(M===Set)return S(O,P,I);var F=rKe(O);return F===G7e?r(O,P,I):F===Y7e?y(O,P,I):F===K7e?o(O,P,I):F===J7e?S(O,P,I):F===X7e?typeof O.then!="function"&&typeof P.then!="function"&&i(O,P,I):F===eKe?T(O,P,I):F===W7e?n(O,P,I):F===q7e?i(O,P,I):F===H7e||F===Z7e||F===Q7e?m(O,P,I):!1}}function iKe(e){var t=e.circular,r=e.createCustomConfig,n=e.strict,s={areArraysEqual:n?tE:R7e,areDatesEqual:M7e,areErrorsEqual:D7e,areFunctionsEqual:L7e,areMapsEqual:n?WK(YK,tE):YK,areNumbersEqual:F7e,areObjectsEqual:n?tE:z7e,arePrimitiveWrappersEqual:B7e,areRegExpsEqual:$7e,areSetsEqual:n?WK(JK,tE):JK,areTypedArraysEqual:n?tE:U7e,areUrlsEqual:V7e};if(r&&(s=eZ({},s,r(s))),t){var o=Bj(s.areArraysEqual),h=Bj(s.areMapsEqual),i=Bj(s.areObjectsEqual),m=Bj(s.areSetsEqual);s=eZ({},s,{areArraysEqual:o,areMapsEqual:h,areObjectsEqual:i,areSetsEqual:m})}return s}function sKe(e){return function(t,r,n,s,o,h,i){return e(t,r,i)}}function aKe(e){var t=e.circular,r=e.comparator,n=e.createState,s=e.equals,o=e.strict;if(n)return function(m,y){var S=n(),b=S.cache,T=b===void 0?t?new WeakMap:void 0:b,A=S.meta;return r(m,y,{cache:T,equals:s,meta:A,strict:o})};if(t)return function(m,y){return r(m,y,{cache:new WeakMap,equals:s,meta:void 0,strict:o})};var h={cache:void 0,equals:s,meta:void 0,strict:o};return function(m,y){return r(m,y,h)}}var oKe=Pg();Pg({strict:!0});Pg({circular:!0});Pg({circular:!0,strict:!0});Pg({createInternalComparator:function(){return n_}});Pg({strict:!0,createInternalComparator:function(){return n_}});Pg({circular:!0,createInternalComparator:function(){return n_}});Pg({circular:!0,createInternalComparator:function(){return n_},strict:!0});function Pg(e){e===void 0&&(e={});var t=e.circular,r=t===void 0?!1:t,n=e.createInternalComparator,s=e.createState,o=e.strict,h=o===void 0?!1:o,i=iKe(e),m=nKe(i),y=n?n(m):sKe(m);return aKe({circular:r,comparator:m,createState:s,equals:y,strict:h})}function lKe(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function tZ(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=-1,n=function s(o){r<0&&(r=o),o-r>t?(e(o),r=-1):lKe(s)};requestAnimationFrame(n)}function Dz(e){"@babel/helpers - typeof";return Dz=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dz(e)}function cKe(e){return fKe(e)||hKe(e)||dKe(e)||uKe()}function uKe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dKe(e,t){if(e){if(typeof e=="string")return rZ(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rZ(e,t)}}function rZ(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function hKe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function fKe(e){if(Array.isArray(e))return e}function pKe(){var e={},t=function(){return null},r=!1,n=function s(o){if(!r){if(Array.isArray(o)){if(!o.length)return;var h=o,i=cKe(h),m=i[0],y=i.slice(1);if(typeof m=="number"){tZ(s.bind(null,y),m);return}s(m),tZ(s.bind(null,y));return}Dz(o)==="object"&&(e=o,t(e)),typeof o=="function"&&o()}};return{stop:function(){r=!0},start:function(o){r=!1,n(o)},subscribe:function(o){return t=o,function(){t=function(){return null}}}}}function YT(e){"@babel/helpers - typeof";return YT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},YT(e)}function nZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function iZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?nZ(Object(r),!0).forEach(function(n){rue(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function rue(e,t,r){return t=mKe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mKe(e){var t=gKe(e,"string");return YT(t)==="symbol"?t:String(t)}function gKe(e,t){if(YT(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(YT(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var yKe=function(t,r){return[Object.keys(t),Object.keys(r)].reduce(function(n,s){return n.filter(function(o){return s.includes(o)})})},vKe=function(t){return t},_Ke=function(t){return t.replace(/([A-Z])/g,function(r){return"-".concat(r.toLowerCase())})},BE=function(t,r){return Object.keys(r).reduce(function(n,s){return iZ(iZ({},n),{},rue({},s,t(s,r[s])))},{})},sZ=function(t,r,n){return t.map(function(s){return"".concat(_Ke(s)," ").concat(r,"ms ").concat(n)}).join(",")};function xKe(e,t){return SKe(e)||wKe(e,t)||nue(e,t)||bKe()}function bKe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wKe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,h,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(h=r.return(),Object(h)!==h))return}finally{if(y)throw s}}return i}}function SKe(e){if(Array.isArray(e))return e}function EKe(e){return CKe(e)||AKe(e)||nue(e)||TKe()}function TKe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nue(e,t){if(e){if(typeof e=="string")return Lz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Lz(e,t)}}function AKe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function CKe(e){if(Array.isArray(e))return Lz(e)}function Lz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var ok=1e-4,iue=function(t,r){return[0,3*t,3*r-6*t,3*t-3*r+1]},sue=function(t,r){return t.map(function(n,s){return n*Math.pow(r,s)}).reduce(function(n,s){return n+s})},aZ=function(t,r){return function(n){var s=iue(t,r);return sue(s,n)}},jKe=function(t,r){return function(n){var s=iue(t,r),o=[].concat(EKe(s.map(function(h,i){return h*i}).slice(1)),[0]);return sue(o,n)}},oZ=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var s=r[0],o=r[1],h=r[2],i=r[3];if(r.length===1)switch(r[0]){case"linear":s=0,o=0,h=1,i=1;break;case"ease":s=.25,o=.1,h=.25,i=1;break;case"ease-in":s=.42,o=0,h=1,i=1;break;case"ease-out":s=.42,o=0,h=.58,i=1;break;case"ease-in-out":s=0,o=0,h=.58,i=1;break;default:{var m=r[0].split("(");if(m[0]==="cubic-bezier"&&m[1].split(")")[0].split(",").length===4){var y=m[1].split(")")[0].split(",").map(function(I){return parseFloat(I)}),S=xKe(y,4);s=S[0],o=S[1],h=S[2],i=S[3]}}}var b=aZ(s,h),T=aZ(o,i),A=jKe(s,h),O=function(R){return R>1?1:R<0?0:R},P=function(R){for(var M=R>1?1:R,F=M,z=0;z<8;++z){var $=b(F)-M,W=A(F);if(Math.abs($-M)<ok||W<ok)return T(F);F=O(F-$/W)}return T(F)};return P.isStepper=!1,P},PKe=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.stiff,n=r===void 0?100:r,s=t.damping,o=s===void 0?8:s,h=t.dt,i=h===void 0?17:h,m=function(S,b,T){var A=-(S-b)*n,O=T*o,P=T+(A-O)*i/1e3,I=T*i/1e3+S;return Math.abs(I-b)<ok&&Math.abs(P)<ok?[b,0]:[I,P]};return m.isStepper=!0,m.dt=i,m},OKe=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var s=r[0];if(typeof s=="string")switch(s){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return oZ(s);case"spring":return PKe();default:if(s.split("(")[0]==="cubic-bezier")return oZ(s)}return typeof s=="function"?s:null};function JT(e){"@babel/helpers - typeof";return JT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},JT(e)}function lZ(e){return IKe(e)||NKe(e)||aue(e)||kKe()}function kKe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function NKe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function IKe(e){if(Array.isArray(e))return zz(e)}function cZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function bl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?cZ(Object(r),!0).forEach(function(n){Fz(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Fz(e,t,r){return t=RKe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function RKe(e){var t=MKe(e,"string");return JT(t)==="symbol"?t:String(t)}function MKe(e,t){if(JT(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(JT(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function DKe(e,t){return zKe(e)||FKe(e,t)||aue(e,t)||LKe()}function LKe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aue(e,t){if(e){if(typeof e=="string")return zz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zz(e,t)}}function zz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function FKe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,h,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(h=r.return(),Object(h)!==h))return}finally{if(y)throw s}}return i}}function zKe(e){if(Array.isArray(e))return e}var lk=function(t,r,n){return t+(r-t)*n},Bz=function(t){var r=t.from,n=t.to;return r!==n},BKe=function e(t,r,n){var s=BE(function(o,h){if(Bz(h)){var i=t(h.from,h.to,h.velocity),m=DKe(i,2),y=m[0],S=m[1];return bl(bl({},h),{},{from:y,velocity:S})}return h},r);return n<1?BE(function(o,h){return Bz(h)?bl(bl({},h),{},{velocity:lk(h.velocity,s[o].velocity,n),from:lk(h.from,s[o].from,n)}):h},r):e(t,s,n-1)};const $Ke=function(e,t,r,n,s){var o=yKe(e,t),h=o.reduce(function(I,R){return bl(bl({},I),{},Fz({},R,[e[R],t[R]]))},{}),i=o.reduce(function(I,R){return bl(bl({},I),{},Fz({},R,{from:e[R],velocity:0,to:t[R]}))},{}),m=-1,y,S,b=function(){return null},T=function(){return BE(function(R,M){return M.from},i)},A=function(){return!Object.values(i).filter(Bz).length},O=function(R){y||(y=R);var M=R-y,F=M/r.dt;i=BKe(r,i,F),s(bl(bl(bl({},e),t),T())),y=R,A()||(m=requestAnimationFrame(b))},P=function(R){S||(S=R);var M=(R-S)/n,F=BE(function($,W){return lk.apply(void 0,lZ(W).concat([r(M)]))},h);if(s(bl(bl(bl({},e),t),F)),M<1)m=requestAnimationFrame(b);else{var z=BE(function($,W){return lk.apply(void 0,lZ(W).concat([r(1)]))},h);s(bl(bl(bl({},e),t),z))}};return b=r.isStepper?O:P,function(){return requestAnimationFrame(b),function(){cancelAnimationFrame(m)}}};function Nb(e){"@babel/helpers - typeof";return Nb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nb(e)}var UKe=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function VKe(e,t){if(e==null)return{};var r=qKe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function qKe(e,t){if(e==null)return{};var r={},n=Object.keys(e),s,o;for(o=0;o<n.length;o++)s=n[o],!(t.indexOf(s)>=0)&&(r[s]=e[s]);return r}function bL(e){return KKe(e)||WKe(e)||GKe(e)||HKe()}function HKe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GKe(e,t){if(e){if(typeof e=="string")return $z(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $z(e,t)}}function WKe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function KKe(e){if(Array.isArray(e))return $z(e)}function $z(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function uZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Ad(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?uZ(Object(r),!0).forEach(function(n){_E(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _E(e,t,r){return t=oue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ZKe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function XKe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,oue(n.key),n)}}function YKe(e,t,r){return t&&XKe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function oue(e){var t=JKe(e,"string");return Nb(t)==="symbol"?t:String(t)}function JKe(e,t){if(Nb(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Nb(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function QKe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Uz(e,t)}function Uz(e,t){return Uz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Uz(e,t)}function eZe(e){var t=tZe();return function(){var n=ck(e),s;if(t){var o=ck(this).constructor;s=Reflect.construct(n,arguments,o)}else s=n.apply(this,arguments);return Vz(this,s)}}function Vz(e,t){if(t&&(Nb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return qz(e)}function qz(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tZe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ck(e){return ck=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},ck(e)}var Kh=function(e){QKe(r,e);var t=eZe(r);function r(n,s){var o;ZKe(this,r),o=t.call(this,n,s);var h=o.props,i=h.isActive,m=h.attributeName,y=h.from,S=h.to,b=h.steps,T=h.children,A=h.duration;if(o.handleStyleChange=o.handleStyleChange.bind(qz(o)),o.changeStyle=o.changeStyle.bind(qz(o)),!i||A<=0)return o.state={style:{}},typeof T=="function"&&(o.state={style:S}),Vz(o);if(b&&b.length)o.state={style:b[0].style};else if(y){if(typeof T=="function")return o.state={style:y},Vz(o);o.state={style:m?_E({},m,y):y}}else o.state={style:{}};return o}return YKe(r,[{key:"componentDidMount",value:function(){var s=this.props,o=s.isActive,h=s.canBegin;this.mounted=!0,!(!o||!h)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(s){var o=this.props,h=o.isActive,i=o.canBegin,m=o.attributeName,y=o.shouldReAnimate,S=o.to,b=o.from,T=this.state.style;if(i){if(!h){var A={style:m?_E({},m,S):S};this.state&&T&&(m&&T[m]!==S||!m&&T!==S)&&this.setState(A);return}if(!(oKe(s.to,S)&&s.canBegin&&s.isActive)){var O=!s.canBegin||!s.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var P=O||y?b:s.to;if(this.state&&T){var I={style:m?_E({},m,P):P};(m&&T[m]!==P||!m&&T!==P)&&this.setState(I)}this.runAnimation(Ad(Ad({},this.props),{},{from:P,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var s=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),s&&s()}},{key:"handleStyleChange",value:function(s){this.changeStyle(s)}},{key:"changeStyle",value:function(s){this.mounted&&this.setState({style:s})}},{key:"runJSAnimation",value:function(s){var o=this,h=s.from,i=s.to,m=s.duration,y=s.easing,S=s.begin,b=s.onAnimationEnd,T=s.onAnimationStart,A=$Ke(h,i,OKe(y),m,this.changeStyle),O=function(){o.stopJSAnimation=A()};this.manager.start([T,S,O,m,b])}},{key:"runStepAnimation",value:function(s){var o=this,h=s.steps,i=s.begin,m=s.onAnimationStart,y=h[0],S=y.style,b=y.duration,T=b===void 0?0:b,A=function(P,I,R){if(R===0)return P;var M=I.duration,F=I.easing,z=F===void 0?"ease":F,$=I.style,W=I.properties,K=I.onAnimationEnd,ee=R>0?h[R-1]:I,ne=W||Object.keys($);if(typeof z=="function"||z==="spring")return[].concat(bL(P),[o.runJSAnimation.bind(o,{from:ee.style,to:$,duration:M,easing:z}),M]);var ie=sZ(ne,M,z),re=Ad(Ad(Ad({},ee.style),$),{},{transition:ie});return[].concat(bL(P),[re,M,K]).filter(vKe)};return this.manager.start([m].concat(bL(h.reduce(A,[S,Math.max(T,i)])),[s.onAnimationEnd]))}},{key:"runAnimation",value:function(s){this.manager||(this.manager=pKe());var o=s.begin,h=s.duration,i=s.attributeName,m=s.to,y=s.easing,S=s.onAnimationStart,b=s.onAnimationEnd,T=s.steps,A=s.children,O=this.manager;if(this.unSubscribe=O.subscribe(this.handleStyleChange),typeof y=="function"||typeof A=="function"||y==="spring"){this.runJSAnimation(s);return}if(T.length>1){this.runStepAnimation(s);return}var P=i?_E({},i,m):m,I=sZ(Object.keys(P),h,y);O.start([S,o,Ad(Ad({},P),{},{transition:I}),h,b])}},{key:"render",value:function(){var s=this.props,o=s.children;s.begin;var h=s.duration;s.attributeName,s.easing;var i=s.isActive;s.steps,s.from,s.to,s.canBegin,s.onAnimationEnd,s.shouldReAnimate,s.onAnimationReStart;var m=VKe(s,UKe),y=V.Children.count(o),S=this.state.style;if(typeof o=="function")return o(S);if(!i||y===0||h<=0)return o;var b=function(A){var O=A.props,P=O.style,I=P===void 0?{}:P,R=O.className,M=V.cloneElement(A,Ad(Ad({},m),{},{style:Ad(Ad({},I),S),className:R}));return M};return y===1?b(V.Children.only(o)):Ue.createElement("div",null,V.Children.map(o,function(T){return b(T)}))}}]),r}(V.PureComponent);Kh.displayName="Animate";Kh.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};Kh.propTypes={from:Fs.oneOfType([Fs.object,Fs.string]),to:Fs.oneOfType([Fs.object,Fs.string]),attributeName:Fs.string,duration:Fs.number,begin:Fs.number,easing:Fs.oneOfType([Fs.string,Fs.func]),steps:Fs.arrayOf(Fs.shape({duration:Fs.number.isRequired,style:Fs.object.isRequired,easing:Fs.oneOfType([Fs.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),Fs.func]),properties:Fs.arrayOf("string"),onAnimationEnd:Fs.func})),children:Fs.oneOfType([Fs.node,Fs.func]),isActive:Fs.bool,canBegin:Fs.bool,onAnimationEnd:Fs.func,shouldReAnimate:Fs.bool,onAnimationStart:Fs.func,onAnimationReStart:Fs.func};function QT(e){"@babel/helpers - typeof";return QT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},QT(e)}function uk(){return uk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},uk.apply(this,arguments)}function rZe(e,t){return aZe(e)||sZe(e,t)||iZe(e,t)||nZe()}function nZe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iZe(e,t){if(e){if(typeof e=="string")return dZ(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return dZ(e,t)}}function dZ(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function sZe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,h,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(h=r.return(),Object(h)!==h))return}finally{if(y)throw s}}return i}}function aZe(e){if(Array.isArray(e))return e}function hZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function fZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?hZ(Object(r),!0).forEach(function(n){oZe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function oZe(e,t,r){return t=lZe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function lZe(e){var t=cZe(e,"string");return QT(t)=="symbol"?t:t+""}function cZe(e,t){if(QT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(QT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var pZ=function(t,r,n,s,o){var h=Math.min(Math.abs(n)/2,Math.abs(s)/2),i=s>=0?1:-1,m=n>=0?1:-1,y=s>=0&&n>=0||s<0&&n<0?1:0,S;if(h>0&&o instanceof Array){for(var b=[0,0,0,0],T=0,A=4;T<A;T++)b[T]=o[T]>h?h:o[T];S="M".concat(t,",").concat(r+i*b[0]),b[0]>0&&(S+="A ".concat(b[0],",").concat(b[0],",0,0,").concat(y,",").concat(t+m*b[0],",").concat(r)),S+="L ".concat(t+n-m*b[1],",").concat(r),b[1]>0&&(S+="A ".concat(b[1],",").concat(b[1],",0,0,").concat(y,`,
        `).concat(t+n,",").concat(r+i*b[1])),S+="L ".concat(t+n,",").concat(r+s-i*b[2]),b[2]>0&&(S+="A ".concat(b[2],",").concat(b[2],",0,0,").concat(y,`,
        `).concat(t+n-m*b[2],",").concat(r+s)),S+="L ".concat(t+m*b[3],",").concat(r+s),b[3]>0&&(S+="A ".concat(b[3],",").concat(b[3],",0,0,").concat(y,`,
        `).concat(t,",").concat(r+s-i*b[3])),S+="Z"}else if(h>0&&o===+o&&o>0){var O=Math.min(h,o);S="M ".concat(t,",").concat(r+i*O,`
            A `).concat(O,",").concat(O,",0,0,").concat(y,",").concat(t+m*O,",").concat(r,`
            L `).concat(t+n-m*O,",").concat(r,`
            A `).concat(O,",").concat(O,",0,0,").concat(y,",").concat(t+n,",").concat(r+i*O,`
            L `).concat(t+n,",").concat(r+s-i*O,`
            A `).concat(O,",").concat(O,",0,0,").concat(y,",").concat(t+n-m*O,",").concat(r+s,`
            L `).concat(t+m*O,",").concat(r+s,`
            A `).concat(O,",").concat(O,",0,0,").concat(y,",").concat(t,",").concat(r+s-i*O," Z")}else S="M ".concat(t,",").concat(r," h ").concat(n," v ").concat(s," h ").concat(-n," Z");return S},uZe=function(t,r){if(!t||!r)return!1;var n=t.x,s=t.y,o=r.x,h=r.y,i=r.width,m=r.height;if(Math.abs(i)>0&&Math.abs(m)>0){var y=Math.min(o,o+i),S=Math.max(o,o+i),b=Math.min(h,h+m),T=Math.max(h,h+m);return n>=y&&n<=S&&s>=b&&s<=T}return!1},dZe={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},Q$=function(t){var r=fZ(fZ({},dZe),t),n=V.useRef(),s=V.useState(-1),o=rZe(s,2),h=o[0],i=o[1];V.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var z=n.current.getTotalLength();z&&i(z)}catch{}},[]);var m=r.x,y=r.y,S=r.width,b=r.height,T=r.radius,A=r.className,O=r.animationEasing,P=r.animationDuration,I=r.animationBegin,R=r.isAnimationActive,M=r.isUpdateAnimationActive;if(m!==+m||y!==+y||S!==+S||b!==+b||S===0||b===0)return null;var F=Ii("recharts-rectangle",A);return M?Ue.createElement(Kh,{canBegin:h>0,from:{width:S,height:b,x:m,y},to:{width:S,height:b,x:m,y},duration:P,animationEasing:O,isActive:M},function(z){var $=z.width,W=z.height,K=z.x,ee=z.y;return Ue.createElement(Kh,{canBegin:h>0,from:"0px ".concat(h===-1?1:h,"px"),to:"".concat(h,"px 0px"),attributeName:"strokeDasharray",begin:I,duration:P,isActive:R,easing:O},Ue.createElement("path",uk({},Qn(r,!0),{className:F,d:pZ(K,ee,$,W,T),ref:n})))}):Ue.createElement("path",uk({},Qn(r,!0),{className:F,d:pZ(m,y,S,b,T)}))},hZe=["points","className","baseLinePoints","connectNulls"];function m0(){return m0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},m0.apply(this,arguments)}function fZe(e,t){if(e==null)return{};var r=pZe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function pZe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function mZ(e){return vZe(e)||yZe(e)||gZe(e)||mZe()}function mZe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gZe(e,t){if(e){if(typeof e=="string")return Hz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Hz(e,t)}}function yZe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function vZe(e){if(Array.isArray(e))return Hz(e)}function Hz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var gZ=function(t){return t&&t.x===+t.x&&t.y===+t.y},_Ze=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=[[]];return t.forEach(function(n){gZ(n)?r[r.length-1].push(n):r[r.length-1].length>0&&r.push([])}),gZ(t[0])&&r[r.length-1].push(t[0]),r[r.length-1].length<=0&&(r=r.slice(0,-1)),r},$E=function(t,r){var n=_Ze(t);r&&(n=[n.reduce(function(o,h){return[].concat(mZ(o),mZ(h))},[])]);var s=n.map(function(o){return o.reduce(function(h,i,m){return"".concat(h).concat(m===0?"M":"L").concat(i.x,",").concat(i.y)},"")}).join("");return n.length===1?"".concat(s,"Z"):s},xZe=function(t,r,n){var s=$E(t,n);return"".concat(s.slice(-1)==="Z"?s.slice(0,-1):s,"L").concat($E(r.reverse(),n).slice(1))},bZe=function(t){var r=t.points,n=t.className,s=t.baseLinePoints,o=t.connectNulls,h=fZe(t,hZe);if(!r||!r.length)return null;var i=Ii("recharts-polygon",n);if(s&&s.length){var m=h.stroke&&h.stroke!=="none",y=xZe(r,s,o);return Ue.createElement("g",{className:i},Ue.createElement("path",m0({},Qn(h,!0),{fill:y.slice(-1)==="Z"?h.fill:"none",stroke:"none",d:y})),m?Ue.createElement("path",m0({},Qn(h,!0),{fill:"none",d:$E(r,o)})):null,m?Ue.createElement("path",m0({},Qn(h,!0),{fill:"none",d:$E(s,o)})):null)}var S=$E(r,o);return Ue.createElement("path",m0({},Qn(h,!0),{fill:S.slice(-1)==="Z"?h.fill:"none",className:i,d:S}))};function Gz(){return Gz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Gz.apply(this,arguments)}var CI=function(t){var r=t.cx,n=t.cy,s=t.r,o=t.className,h=Ii("recharts-dot",o);return r===+r&&n===+n&&s===+s?V.createElement("circle",Gz({},Qn(t,!1),OO(t),{className:h,cx:r,cy:n,r:s})):null};function e2(e){"@babel/helpers - typeof";return e2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e2(e)}var wZe=["x","y","top","left","width","height","className"];function Wz(){return Wz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Wz.apply(this,arguments)}function yZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function SZe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yZ(Object(r),!0).forEach(function(n){EZe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function EZe(e,t,r){return t=TZe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function TZe(e){var t=AZe(e,"string");return e2(t)=="symbol"?t:t+""}function AZe(e,t){if(e2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(e2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function CZe(e,t){if(e==null)return{};var r=jZe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function jZe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var PZe=function(t,r,n,s,o,h){return"M".concat(t,",").concat(o,"v").concat(s,"M").concat(h,",").concat(r,"h").concat(n)},OZe=function(t){var r=t.x,n=r===void 0?0:r,s=t.y,o=s===void 0?0:s,h=t.top,i=h===void 0?0:h,m=t.left,y=m===void 0?0:m,S=t.width,b=S===void 0?0:S,T=t.height,A=T===void 0?0:T,O=t.className,P=CZe(t,wZe),I=SZe({x:n,y:o,top:i,left:y,width:b,height:A},P);return!Gr(n)||!Gr(o)||!Gr(b)||!Gr(A)||!Gr(i)||!Gr(y)?null:Ue.createElement("path",Wz({},Qn(I,!0),{className:Ii("recharts-cross",O),d:PZe(n,o,b,A,i,y)}))},kZe=wI,NZe=vce,IZe=nf;function RZe(e,t){return e&&e.length?kZe(e,IZe(t),NZe):void 0}var MZe=RZe;const DZe=Os(MZe);var LZe=wI,FZe=nf,zZe=_ce;function BZe(e,t){return e&&e.length?LZe(e,FZe(t),zZe):void 0}var $Ze=BZe;const UZe=Os($Ze);var VZe=["cx","cy","angle","ticks","axisLine"],qZe=["ticks","tick","angle","tickFormatter","stroke"];function Ib(e){"@babel/helpers - typeof";return Ib=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ib(e)}function UE(){return UE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},UE.apply(this,arguments)}function vZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Ny(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?vZ(Object(r),!0).forEach(function(n){jI(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _Z(e,t){if(e==null)return{};var r=HZe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function HZe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function GZe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xZ(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,cue(n.key),n)}}function WZe(e,t,r){return t&&xZ(e.prototype,t),r&&xZ(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function KZe(e,t,r){return t=dk(t),ZZe(e,lue()?Reflect.construct(t,r||[],dk(e).constructor):t.apply(e,r))}function ZZe(e,t){if(t&&(Ib(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return XZe(e)}function XZe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function lue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(lue=function(){return!!e})()}function dk(e){return dk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},dk(e)}function YZe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Kz(e,t)}function Kz(e,t){return Kz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Kz(e,t)}function jI(e,t,r){return t=cue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cue(e){var t=JZe(e,"string");return Ib(t)=="symbol"?t:t+""}function JZe(e,t){if(Ib(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Ib(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var PI=function(e){function t(){return GZe(this,t),KZe(this,t,arguments)}return YZe(t,e),WZe(t,[{key:"getTickValueCoord",value:function(n){var s=n.coordinate,o=this.props,h=o.angle,i=o.cx,m=o.cy;return la(i,m,s,h)}},{key:"getTickTextAnchor",value:function(){var n=this.props.orientation,s;switch(n){case"left":s="end";break;case"right":s="start";break;default:s="middle";break}return s}},{key:"getViewBox",value:function(){var n=this.props,s=n.cx,o=n.cy,h=n.angle,i=n.ticks,m=DZe(i,function(S){return S.coordinate||0}),y=UZe(i,function(S){return S.coordinate||0});return{cx:s,cy:o,startAngle:h,endAngle:h,innerRadius:y.coordinate||0,outerRadius:m.coordinate||0}}},{key:"renderAxisLine",value:function(){var n=this.props,s=n.cx,o=n.cy,h=n.angle,i=n.ticks,m=n.axisLine,y=_Z(n,VZe),S=i.reduce(function(O,P){return[Math.min(O[0],P.coordinate),Math.max(O[1],P.coordinate)]},[1/0,-1/0]),b=la(s,o,S[0],h),T=la(s,o,S[1],h),A=Ny(Ny(Ny({},Qn(y,!1)),{},{fill:"none"},Qn(m,!1)),{},{x1:b.x,y1:b.y,x2:T.x,y2:T.y});return Ue.createElement("line",UE({className:"recharts-polar-radius-axis-line"},A))}},{key:"renderTicks",value:function(){var n=this,s=this.props,o=s.ticks,h=s.tick,i=s.angle,m=s.tickFormatter,y=s.stroke,S=_Z(s,qZe),b=this.getTickTextAnchor(),T=Qn(S,!1),A=Qn(h,!1),O=o.map(function(P,I){var R=n.getTickValueCoord(P),M=Ny(Ny(Ny(Ny({textAnchor:b,transform:"rotate(".concat(90-i,", ").concat(R.x,", ").concat(R.y,")")},T),{},{stroke:"none",fill:y},A),{},{index:I},R),{},{payload:P});return Ue.createElement(js,UE({className:Ii("recharts-polar-radius-axis-tick",Kce(h)),key:"tick-".concat(P.coordinate)},Fv(n.props,P,I)),t.renderTickItem(h,M,m?m(P.value,I):P.value))});return Ue.createElement(js,{className:"recharts-polar-radius-axis-ticks"},O)}},{key:"render",value:function(){var n=this.props,s=n.ticks,o=n.axisLine,h=n.tick;return!s||!s.length?null:Ue.createElement(js,{className:Ii("recharts-polar-radius-axis",this.props.className)},o&&this.renderAxisLine(),h&&this.renderTicks(),ul.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(n,s,o){var h;return Ue.isValidElement(n)?h=Ue.cloneElement(n,s):vi(n)?h=n(s):h=Ue.createElement(zv,UE({},s,{className:"recharts-polar-radius-axis-tick-value"}),o),h}}])}(V.PureComponent);jI(PI,"displayName","PolarRadiusAxis");jI(PI,"axisType","radiusAxis");jI(PI,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function Rb(e){"@babel/helpers - typeof";return Rb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rb(e)}function Hy(){return Hy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Hy.apply(this,arguments)}function bZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Iy(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?bZ(Object(r),!0).forEach(function(n){OI(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function QZe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function wZ(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,due(n.key),n)}}function eXe(e,t,r){return t&&wZ(e.prototype,t),r&&wZ(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function tXe(e,t,r){return t=hk(t),rXe(e,uue()?Reflect.construct(t,r||[],hk(e).constructor):t.apply(e,r))}function rXe(e,t){if(t&&(Rb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return nXe(e)}function nXe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function uue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(uue=function(){return!!e})()}function hk(e){return hk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},hk(e)}function iXe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Zz(e,t)}function Zz(e,t){return Zz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Zz(e,t)}function OI(e,t,r){return t=due(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function due(e){var t=sXe(e,"string");return Rb(t)=="symbol"?t:t+""}function sXe(e,t){if(Rb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Rb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var aXe=Math.PI/180,SZ=1e-5,kI=function(e){function t(){return QZe(this,t),tXe(this,t,arguments)}return iXe(t,e),eXe(t,[{key:"getTickLineCoord",value:function(n){var s=this.props,o=s.cx,h=s.cy,i=s.radius,m=s.orientation,y=s.tickSize,S=y||8,b=la(o,h,i,n.coordinate),T=la(o,h,i+(m==="inner"?-1:1)*S,n.coordinate);return{x1:b.x,y1:b.y,x2:T.x,y2:T.y}}},{key:"getTickTextAnchor",value:function(n){var s=this.props.orientation,o=Math.cos(-n.coordinate*aXe),h;return o>SZ?h=s==="outer"?"start":"end":o<-SZ?h=s==="outer"?"end":"start":h="middle",h}},{key:"renderAxisLine",value:function(){var n=this.props,s=n.cx,o=n.cy,h=n.radius,i=n.axisLine,m=n.axisLineType,y=Iy(Iy({},Qn(this.props,!1)),{},{fill:"none"},Qn(i,!1));if(m==="circle")return Ue.createElement(CI,Hy({className:"recharts-polar-angle-axis-line"},y,{cx:s,cy:o,r:h}));var S=this.props.ticks,b=S.map(function(T){return la(s,o,h,T.coordinate)});return Ue.createElement(bZe,Hy({className:"recharts-polar-angle-axis-line"},y,{points:b}))}},{key:"renderTicks",value:function(){var n=this,s=this.props,o=s.ticks,h=s.tick,i=s.tickLine,m=s.tickFormatter,y=s.stroke,S=Qn(this.props,!1),b=Qn(h,!1),T=Iy(Iy({},S),{},{fill:"none"},Qn(i,!1)),A=o.map(function(O,P){var I=n.getTickLineCoord(O),R=n.getTickTextAnchor(O),M=Iy(Iy(Iy({textAnchor:R},S),{},{stroke:"none",fill:y},b),{},{index:P,payload:O,x:I.x2,y:I.y2});return Ue.createElement(js,Hy({className:Ii("recharts-polar-angle-axis-tick",Kce(h)),key:"tick-".concat(O.coordinate)},Fv(n.props,O,P)),i&&Ue.createElement("line",Hy({className:"recharts-polar-angle-axis-tick-line"},T,I)),h&&t.renderTickItem(h,M,m?m(O.value,P):O.value))});return Ue.createElement(js,{className:"recharts-polar-angle-axis-ticks"},A)}},{key:"render",value:function(){var n=this.props,s=n.ticks,o=n.radius,h=n.axisLine;return o<=0||!s||!s.length?null:Ue.createElement(js,{className:Ii("recharts-polar-angle-axis",this.props.className)},h&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(n,s,o){var h;return Ue.isValidElement(n)?h=Ue.cloneElement(n,s):vi(n)?h=n(s):h=Ue.createElement(zv,Hy({},s,{className:"recharts-polar-angle-axis-tick-value"}),o),h}}])}(V.PureComponent);OI(kI,"displayName","PolarAngleAxis");OI(kI,"axisType","angleAxis");OI(kI,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var oXe=ple,lXe=oXe(Object.getPrototypeOf,Object),cXe=lXe,uXe=gp,dXe=cXe,hXe=yp,fXe="[object Object]",pXe=Function.prototype,mXe=Object.prototype,hue=pXe.toString,gXe=mXe.hasOwnProperty,yXe=hue.call(Object);function vXe(e){if(!hXe(e)||uXe(e)!=fXe)return!1;var t=dXe(e);if(t===null)return!0;var r=gXe.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&hue.call(r)==yXe}var _Xe=vXe;const xXe=Os(_Xe);var bXe=gp,wXe=yp,SXe="[object Boolean]";function EXe(e){return e===!0||e===!1||wXe(e)&&bXe(e)==SXe}var TXe=EXe;const AXe=Os(TXe);function t2(e){"@babel/helpers - typeof";return t2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t2(e)}function fk(){return fk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},fk.apply(this,arguments)}function CXe(e,t){return kXe(e)||OXe(e,t)||PXe(e,t)||jXe()}function jXe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function PXe(e,t){if(e){if(typeof e=="string")return EZ(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return EZ(e,t)}}function EZ(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function OXe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,h,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(h=r.return(),Object(h)!==h))return}finally{if(y)throw s}}return i}}function kXe(e){if(Array.isArray(e))return e}function TZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function AZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?TZ(Object(r),!0).forEach(function(n){NXe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):TZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function NXe(e,t,r){return t=IXe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function IXe(e){var t=RXe(e,"string");return t2(t)=="symbol"?t:t+""}function RXe(e,t){if(t2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(t2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var CZ=function(t,r,n,s,o){var h=n-s,i;return i="M ".concat(t,",").concat(r),i+="L ".concat(t+n,",").concat(r),i+="L ".concat(t+n-h/2,",").concat(r+o),i+="L ".concat(t+n-h/2-s,",").concat(r+o),i+="L ".concat(t,",").concat(r," Z"),i},MXe={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},DXe=function(t){var r=AZ(AZ({},MXe),t),n=V.useRef(),s=V.useState(-1),o=CXe(s,2),h=o[0],i=o[1];V.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var F=n.current.getTotalLength();F&&i(F)}catch{}},[]);var m=r.x,y=r.y,S=r.upperWidth,b=r.lowerWidth,T=r.height,A=r.className,O=r.animationEasing,P=r.animationDuration,I=r.animationBegin,R=r.isUpdateAnimationActive;if(m!==+m||y!==+y||S!==+S||b!==+b||T!==+T||S===0&&b===0||T===0)return null;var M=Ii("recharts-trapezoid",A);return R?Ue.createElement(Kh,{canBegin:h>0,from:{upperWidth:0,lowerWidth:0,height:T,x:m,y},to:{upperWidth:S,lowerWidth:b,height:T,x:m,y},duration:P,animationEasing:O,isActive:R},function(F){var z=F.upperWidth,$=F.lowerWidth,W=F.height,K=F.x,ee=F.y;return Ue.createElement(Kh,{canBegin:h>0,from:"0px ".concat(h===-1?1:h,"px"),to:"".concat(h,"px 0px"),attributeName:"strokeDasharray",begin:I,duration:P,easing:O},Ue.createElement("path",fk({},Qn(r,!0),{className:M,d:CZ(K,ee,z,$,W),ref:n})))}):Ue.createElement("g",null,Ue.createElement("path",fk({},Qn(r,!0),{className:M,d:CZ(m,y,S,b,T)})))},LXe=["option","shapeType","propTransformer","activeClassName","isActive"];function r2(e){"@babel/helpers - typeof";return r2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r2(e)}function FXe(e,t){if(e==null)return{};var r=zXe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function zXe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function jZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function pk(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?jZ(Object(r),!0).forEach(function(n){BXe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function BXe(e,t,r){return t=$Xe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $Xe(e){var t=UXe(e,"string");return r2(t)=="symbol"?t:t+""}function UXe(e,t){if(r2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(r2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function VXe(e,t){return pk(pk({},t),e)}function qXe(e,t){return e==="symbols"}function PZ(e){var t=e.shapeType,r=e.elementProps;switch(t){case"rectangle":return Ue.createElement(Q$,r);case"trapezoid":return Ue.createElement(DXe,r);case"sector":return Ue.createElement(Yce,r);case"symbols":if(qXe(t))return Ue.createElement(v$,r);break;default:return null}}function HXe(e){return V.isValidElement(e)?e.props:e}function fue(e){var t=e.option,r=e.shapeType,n=e.propTransformer,s=n===void 0?VXe:n,o=e.activeClassName,h=o===void 0?"recharts-active-shape":o,i=e.isActive,m=FXe(e,LXe),y;if(V.isValidElement(t))y=V.cloneElement(t,pk(pk({},m),HXe(t)));else if(vi(t))y=t(m);else if(xXe(t)&&!AXe(t)){var S=s(t,m);y=Ue.createElement(PZ,{shapeType:r,elementProps:S})}else{var b=m;y=Ue.createElement(PZ,{shapeType:r,elementProps:b})}return i?Ue.createElement(js,{className:h},y):y}function NI(e,t){return t!=null&&"trapezoids"in e.props}function II(e,t){return t!=null&&"sectors"in e.props}function n2(e,t){return t!=null&&"points"in e.props}function GXe(e,t){var r,n,s=e.x===(t==null||(r=t.labelViewBox)===null||r===void 0?void 0:r.x)||e.x===t.x,o=e.y===(t==null||(n=t.labelViewBox)===null||n===void 0?void 0:n.y)||e.y===t.y;return s&&o}function WXe(e,t){var r=e.endAngle===t.endAngle,n=e.startAngle===t.startAngle;return r&&n}function KXe(e,t){var r=e.x===t.x,n=e.y===t.y,s=e.z===t.z;return r&&n&&s}function ZXe(e,t){var r;return NI(e,t)?r=GXe:II(e,t)?r=WXe:n2(e,t)&&(r=KXe),r}function XXe(e,t){var r;return NI(e,t)?r="trapezoids":II(e,t)?r="sectors":n2(e,t)&&(r="points"),r}function YXe(e,t){if(NI(e,t)){var r;return(r=t.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}if(II(e,t)){var n;return(n=t.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}return n2(e,t)?t.payload:{}}function JXe(e){var t=e.activeTooltipItem,r=e.graphicalItem,n=e.itemData,s=XXe(r,t),o=YXe(r,t),h=n.filter(function(m,y){var S=X2(o,m),b=r.props[s].filter(function(O){var P=ZXe(r,t);return P(O,t)}),T=r.props[s].indexOf(b[b.length-1]),A=y===T;return S&&A}),i=n.indexOf(h[h.length-1]);return i}var mP;function Mb(e){"@babel/helpers - typeof";return Mb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mb(e)}function g0(){return g0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},g0.apply(this,arguments)}function OZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function sa(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?OZ(Object(r),!0).forEach(function(n){Vu(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):OZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function QXe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function kZ(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,mue(n.key),n)}}function eYe(e,t,r){return t&&kZ(e.prototype,t),r&&kZ(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function tYe(e,t,r){return t=mk(t),rYe(e,pue()?Reflect.construct(t,r||[],mk(e).constructor):t.apply(e,r))}function rYe(e,t){if(t&&(Mb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return nYe(e)}function nYe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(pue=function(){return!!e})()}function mk(e){return mk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},mk(e)}function iYe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Xz(e,t)}function Xz(e,t){return Xz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Xz(e,t)}function Vu(e,t,r){return t=mue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mue(e){var t=sYe(e,"string");return Mb(t)=="symbol"?t:t+""}function sYe(e,t){if(Mb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Mb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Zh=function(e){function t(r){var n;return QXe(this,t),n=tYe(this,t,[r]),Vu(n,"pieRef",null),Vu(n,"sectorRefs",[]),Vu(n,"id",yw("recharts-pie-")),Vu(n,"handleAnimationEnd",function(){var s=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),vi(s)&&s()}),Vu(n,"handleAnimationStart",function(){var s=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),vi(s)&&s()}),n.state={isAnimationFinished:!r.isAnimationActive,prevIsAnimationActive:r.isAnimationActive,prevAnimationId:r.animationId,sectorToFocus:0},n}return iYe(t,e),eYe(t,[{key:"isActiveIndex",value:function(n){var s=this.props.activeIndex;return Array.isArray(s)?s.indexOf(n)!==-1:n===s}},{key:"hasActiveIndex",value:function(){var n=this.props.activeIndex;return Array.isArray(n)?n.length!==0:n||n===0}},{key:"renderLabels",value:function(n){var s=this.props.isAnimationActive;if(s&&!this.state.isAnimationFinished)return null;var o=this.props,h=o.label,i=o.labelLine,m=o.dataKey,y=o.valueKey,S=Qn(this.props,!1),b=Qn(h,!1),T=Qn(i,!1),A=h&&h.offsetRadius||20,O=n.map(function(P,I){var R=(P.startAngle+P.endAngle)/2,M=la(P.cx,P.cy,P.outerRadius+A,R),F=sa(sa(sa(sa({},S),P),{},{stroke:"none"},b),{},{index:I,textAnchor:t.getTextAnchor(M.x,P.cx)},M),z=sa(sa(sa(sa({},S),P),{},{fill:"none",stroke:P.fill},T),{},{index:I,points:[la(P.cx,P.cy,P.outerRadius,R),M]}),$=m;return ki(m)&&ki(y)?$="value":ki(m)&&($=y),Ue.createElement(js,{key:"label-".concat(P.startAngle,"-").concat(P.endAngle,"-").concat(P.midAngle,"-").concat(I)},i&&t.renderLabelLineItem(i,z,"line"),t.renderLabelItem(h,F,Ko(P,$)))});return Ue.createElement(js,{className:"recharts-pie-labels"},O)}},{key:"renderSectorsStatically",value:function(n){var s=this,o=this.props,h=o.activeShape,i=o.blendStroke,m=o.inactiveShape;return n.map(function(y,S){if((y==null?void 0:y.startAngle)===0&&(y==null?void 0:y.endAngle)===0&&n.length!==1)return null;var b=s.isActiveIndex(S),T=m&&s.hasActiveIndex()?m:null,A=b?h:T,O=sa(sa({},y),{},{stroke:i?y.fill:y.stroke,tabIndex:-1});return Ue.createElement(js,g0({ref:function(I){I&&!s.sectorRefs.includes(I)&&s.sectorRefs.push(I)},tabIndex:-1,className:"recharts-pie-sector"},Fv(s.props,y,S),{key:"sector-".concat(y==null?void 0:y.startAngle,"-").concat(y==null?void 0:y.endAngle,"-").concat(y.midAngle,"-").concat(S)}),Ue.createElement(fue,g0({option:A,isActive:b,shapeType:"sector"},O)))})}},{key:"renderSectorsWithAnimation",value:function(){var n=this,s=this.props,o=s.sectors,h=s.isAnimationActive,i=s.animationBegin,m=s.animationDuration,y=s.animationEasing,S=s.animationId,b=this.state,T=b.prevSectors,A=b.prevIsAnimationActive;return Ue.createElement(Kh,{begin:i,duration:m,isActive:h,easing:y,from:{t:0},to:{t:1},key:"pie-".concat(S,"-").concat(A),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(O){var P=O.t,I=[],R=o&&o[0],M=R.startAngle;return o.forEach(function(F,z){var $=T&&T[z],W=z>0?bu(F,"paddingAngle",0):0;if($){var K=fu($.endAngle-$.startAngle,F.endAngle-F.startAngle),ee=sa(sa({},F),{},{startAngle:M+W,endAngle:M+K(P)+W});I.push(ee),M=ee.endAngle}else{var ne=F.endAngle,ie=F.startAngle,re=fu(0,ne-ie),te=re(P),ae=sa(sa({},F),{},{startAngle:M+W,endAngle:M+te+W});I.push(ae),M=ae.endAngle}}),Ue.createElement(js,null,n.renderSectorsStatically(I))})}},{key:"attachKeyboardHandlers",value:function(n){var s=this;n.onkeydown=function(o){if(!o.altKey)switch(o.key){case"ArrowLeft":{var h=++s.state.sectorToFocus%s.sectorRefs.length;s.sectorRefs[h].focus(),s.setState({sectorToFocus:h});break}case"ArrowRight":{var i=--s.state.sectorToFocus<0?s.sectorRefs.length-1:s.state.sectorToFocus%s.sectorRefs.length;s.sectorRefs[i].focus(),s.setState({sectorToFocus:i});break}case"Escape":{s.sectorRefs[s.state.sectorToFocus].blur(),s.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var n=this.props,s=n.sectors,o=n.isAnimationActive,h=this.state.prevSectors;return o&&s&&s.length&&(!h||!X2(h,s))?this.renderSectorsWithAnimation():this.renderSectorsStatically(s)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var n=this,s=this.props,o=s.hide,h=s.sectors,i=s.className,m=s.label,y=s.cx,S=s.cy,b=s.innerRadius,T=s.outerRadius,A=s.isAnimationActive,O=this.state.isAnimationFinished;if(o||!h||!h.length||!Gr(y)||!Gr(S)||!Gr(b)||!Gr(T))return null;var P=Ii("recharts-pie",i);return Ue.createElement(js,{tabIndex:this.props.rootTabIndex,className:P,ref:function(R){n.pieRef=R}},this.renderSectors(),m&&this.renderLabels(h),ul.renderCallByParent(this.props,null,!1),(!A||O)&&Jf.renderCallByParent(this.props,h,!1))}}],[{key:"getDerivedStateFromProps",value:function(n,s){return s.prevIsAnimationActive!==n.isAnimationActive?{prevIsAnimationActive:n.isAnimationActive,prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:[],isAnimationFinished:!0}:n.isAnimationActive&&n.animationId!==s.prevAnimationId?{prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:s.curSectors,isAnimationFinished:!0}:n.sectors!==s.curSectors?{curSectors:n.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(n,s){return n>s?"start":n<s?"end":"middle"}},{key:"renderLabelLineItem",value:function(n,s,o){if(Ue.isValidElement(n))return Ue.cloneElement(n,s);if(vi(n))return n(s);var h=Ii("recharts-pie-label-line",typeof n!="boolean"?n.className:"");return Ue.createElement(ak,g0({},s,{key:o,type:"linear",className:h}))}},{key:"renderLabelItem",value:function(n,s,o){if(Ue.isValidElement(n))return Ue.cloneElement(n,s);var h=o;if(vi(n)&&(h=n(s),Ue.isValidElement(h)))return h;var i=Ii("recharts-pie-label-text",typeof n!="boolean"&&!vi(n)?n.className:"");return Ue.createElement(zv,g0({},s,{alignmentBaseline:"middle",className:i}),h)}}])}(V.PureComponent);mP=Zh;Vu(Zh,"displayName","Pie");Vu(Zh,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!Uh.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});Vu(Zh,"parseDeltaAngle",function(e,t){var r=hc(t-e),n=Math.min(Math.abs(t-e),360);return r*n});Vu(Zh,"getRealPieData",function(e){var t=e.data,r=e.children,n=Qn(e,!1),s=wu(r,IT);return t&&t.length?t.map(function(o,h){return sa(sa(sa({payload:o},n),o),s&&s[h]&&s[h].props)}):s&&s.length?s.map(function(o){return sa(sa({},n),o.props)}):[]});Vu(Zh,"parseCoordinateOfPie",function(e,t){var r=t.top,n=t.left,s=t.width,o=t.height,h=Wce(s,o),i=n+fc(e.cx,s,s/2),m=r+fc(e.cy,o,o/2),y=fc(e.innerRadius,h,0),S=fc(e.outerRadius,h,h*.8),b=e.maxRadius||Math.sqrt(s*s+o*o)/2;return{cx:i,cy:m,innerRadius:y,outerRadius:S,maxRadius:b}});Vu(Zh,"getComposedData",function(e){var t=e.item,r=e.offset,n=t.type.defaultProps!==void 0?sa(sa({},t.type.defaultProps),t.props):t.props,s=mP.getRealPieData(n);if(!s||!s.length)return null;var o=n.cornerRadius,h=n.startAngle,i=n.endAngle,m=n.paddingAngle,y=n.dataKey,S=n.nameKey,b=n.valueKey,T=n.tooltipType,A=Math.abs(n.minAngle),O=mP.parseCoordinateOfPie(n,r),P=mP.parseDeltaAngle(h,i),I=Math.abs(P),R=y;ki(y)&&ki(b)?(Hd(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),R="value"):ki(y)&&(Hd(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),R=b);var M=s.filter(function(ee){return Ko(ee,R,0)!==0}).length,F=(I>=360?M:M-1)*m,z=I-M*A-F,$=s.reduce(function(ee,ne){var ie=Ko(ne,R,0);return ee+(Gr(ie)?ie:0)},0),W;if($>0){var K;W=s.map(function(ee,ne){var ie=Ko(ee,R,0),re=Ko(ee,S,ne),te=(Gr(ie)?ie:0)/$,ae;ne?ae=K.endAngle+hc(P)*m*(ie!==0?1:0):ae=h;var ue=ae+hc(P)*((ie!==0?A:0)+te*z),be=(ae+ue)/2,we=(O.innerRadius+O.outerRadius)/2,Ce=[{name:re,value:ie,payload:ee,dataKey:R,type:T}],_e=la(O.cx,O.cy,we,be);return K=sa(sa(sa({percent:te,cornerRadius:o,name:re,tooltipPayload:Ce,midAngle:be,middleRadius:we,tooltipPosition:_e},ee),O),{},{value:Ko(ee,R),startAngle:ae,endAngle:ue,payload:ee,paddingAngle:hc(P)*m}),K})}return sa(sa({},O),{},{sectors:W,data:s})});var aYe=Math.ceil,oYe=Math.max;function lYe(e,t,r,n){for(var s=-1,o=oYe(aYe((t-e)/(r||1)),0),h=Array(o);o--;)h[n?o:++s]=e,e+=r;return h}var cYe=lYe,uYe=Ile,NZ=1/0,dYe=17976931348623157e292;function hYe(e){if(!e)return e===0?e:0;if(e=uYe(e),e===NZ||e===-NZ){var t=e<0?-1:1;return t*dYe}return e===e?e:0}var gue=hYe,fYe=cYe,pYe=mI,wL=gue;function mYe(e){return function(t,r,n){return n&&typeof n!="number"&&pYe(t,r,n)&&(r=n=void 0),t=wL(t),r===void 0?(r=t,t=0):r=wL(r),n=n===void 0?t<r?1:-1:wL(n),fYe(t,r,n,e)}}var gYe=mYe,yYe=gYe,vYe=yYe(),_Ye=vYe;const gk=Os(_Ye);function i2(e){"@babel/helpers - typeof";return i2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i2(e)}function IZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function RZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?IZ(Object(r),!0).forEach(function(n){yue(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):IZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yue(e,t,r){return t=xYe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xYe(e){var t=bYe(e,"string");return i2(t)=="symbol"?t:t+""}function bYe(e,t){if(i2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(i2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var wYe=["Webkit","Moz","O","ms"],SYe=function(t,r){var n=t.replace(/(\w)/,function(o){return o.toUpperCase()}),s=wYe.reduce(function(o,h){return RZ(RZ({},o),{},yue({},h+n,r))},{});return s[t]=r,s};function Db(e){"@babel/helpers - typeof";return Db=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Db(e)}function yk(){return yk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},yk.apply(this,arguments)}function MZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function SL(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?MZ(Object(r),!0).forEach(function(n){lu(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):MZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function EYe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function DZ(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_ue(n.key),n)}}function TYe(e,t,r){return t&&DZ(e.prototype,t),r&&DZ(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function AYe(e,t,r){return t=vk(t),CYe(e,vue()?Reflect.construct(t,r||[],vk(e).constructor):t.apply(e,r))}function CYe(e,t){if(t&&(Db(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return jYe(e)}function jYe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vue=function(){return!!e})()}function vk(e){return vk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},vk(e)}function PYe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Yz(e,t)}function Yz(e,t){return Yz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Yz(e,t)}function lu(e,t,r){return t=_ue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ue(e){var t=OYe(e,"string");return Db(t)=="symbol"?t:t+""}function OYe(e,t){if(Db(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Db(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var kYe=function(t){var r=t.data,n=t.startIndex,s=t.endIndex,o=t.x,h=t.width,i=t.travellerWidth;if(!r||!r.length)return{};var m=r.length,y=FE().domain(gk(0,m)).range([o,o+h-i]),S=y.domain().map(function(b){return y(b)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:y(n),endX:y(s),scale:y,scaleValues:S}},LZ=function(t){return t.changedTouches&&!!t.changedTouches.length},Lb=function(e){function t(r){var n;return EYe(this,t),n=AYe(this,t,[r]),lu(n,"handleDrag",function(s){n.leaveTimer&&(clearTimeout(n.leaveTimer),n.leaveTimer=null),n.state.isTravellerMoving?n.handleTravellerMove(s):n.state.isSlideMoving&&n.handleSlideDrag(s)}),lu(n,"handleTouchMove",function(s){s.changedTouches!=null&&s.changedTouches.length>0&&n.handleDrag(s.changedTouches[0])}),lu(n,"handleDragEnd",function(){n.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var s=n.props,o=s.endIndex,h=s.onDragEnd,i=s.startIndex;h==null||h({endIndex:o,startIndex:i})}),n.detachDragEndListener()}),lu(n,"handleLeaveWrapper",function(){(n.state.isTravellerMoving||n.state.isSlideMoving)&&(n.leaveTimer=window.setTimeout(n.handleDragEnd,n.props.leaveTimeOut))}),lu(n,"handleEnterSlideOrTraveller",function(){n.setState({isTextActive:!0})}),lu(n,"handleLeaveSlideOrTraveller",function(){n.setState({isTextActive:!1})}),lu(n,"handleSlideDragStart",function(s){var o=LZ(s)?s.changedTouches[0]:s;n.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:o.pageX}),n.attachDragEndListener()}),n.travellerDragStartHandlers={startX:n.handleTravellerDragStart.bind(n,"startX"),endX:n.handleTravellerDragStart.bind(n,"endX")},n.state={},n}return PYe(t,e),TYe(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(n){var s=n.startX,o=n.endX,h=this.state.scaleValues,i=this.props,m=i.gap,y=i.data,S=y.length-1,b=Math.min(s,o),T=Math.max(s,o),A=t.getIndexInRange(h,b),O=t.getIndexInRange(h,T);return{startIndex:A-A%m,endIndex:O===S?S:O-O%m}}},{key:"getTextOfTick",value:function(n){var s=this.props,o=s.data,h=s.tickFormatter,i=s.dataKey,m=Ko(o[n],i,n);return vi(h)?h(m,n):m}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(n){var s=this.state,o=s.slideMoveStartX,h=s.startX,i=s.endX,m=this.props,y=m.x,S=m.width,b=m.travellerWidth,T=m.startIndex,A=m.endIndex,O=m.onChange,P=n.pageX-o;P>0?P=Math.min(P,y+S-b-i,y+S-b-h):P<0&&(P=Math.max(P,y-h,y-i));var I=this.getIndex({startX:h+P,endX:i+P});(I.startIndex!==T||I.endIndex!==A)&&O&&O(I),this.setState({startX:h+P,endX:i+P,slideMoveStartX:n.pageX})}},{key:"handleTravellerDragStart",value:function(n,s){var o=LZ(s)?s.changedTouches[0]:s;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:n,brushMoveStartX:o.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(n){var s=this.state,o=s.brushMoveStartX,h=s.movingTravellerId,i=s.endX,m=s.startX,y=this.state[h],S=this.props,b=S.x,T=S.width,A=S.travellerWidth,O=S.onChange,P=S.gap,I=S.data,R={startX:this.state.startX,endX:this.state.endX},M=n.pageX-o;M>0?M=Math.min(M,b+T-A-y):M<0&&(M=Math.max(M,b-y)),R[h]=y+M;var F=this.getIndex(R),z=F.startIndex,$=F.endIndex,W=function(){var ee=I.length-1;return h==="startX"&&(i>m?z%P===0:$%P===0)||i<m&&$===ee||h==="endX"&&(i>m?$%P===0:z%P===0)||i>m&&$===ee};this.setState(lu(lu({},h,y+M),"brushMoveStartX",n.pageX),function(){O&&W()&&O(F)})}},{key:"handleTravellerMoveKeyboard",value:function(n,s){var o=this,h=this.state,i=h.scaleValues,m=h.startX,y=h.endX,S=this.state[s],b=i.indexOf(S);if(b!==-1){var T=b+n;if(!(T===-1||T>=i.length)){var A=i[T];s==="startX"&&A>=y||s==="endX"&&A<=m||this.setState(lu({},s,A),function(){o.props.onChange(o.getIndex({startX:o.state.startX,endX:o.state.endX}))})}}}},{key:"renderBackground",value:function(){var n=this.props,s=n.x,o=n.y,h=n.width,i=n.height,m=n.fill,y=n.stroke;return Ue.createElement("rect",{stroke:y,fill:m,x:s,y:o,width:h,height:i})}},{key:"renderPanorama",value:function(){var n=this.props,s=n.x,o=n.y,h=n.width,i=n.height,m=n.data,y=n.children,S=n.padding,b=V.Children.only(y);return b?Ue.cloneElement(b,{x:s,y:o,width:h,height:i,margin:S,compact:!0,data:m}):null}},{key:"renderTravellerLayer",value:function(n,s){var o,h,i=this,m=this.props,y=m.y,S=m.travellerWidth,b=m.height,T=m.traveller,A=m.ariaLabel,O=m.data,P=m.startIndex,I=m.endIndex,R=Math.max(n,this.props.x),M=SL(SL({},Qn(this.props,!1)),{},{x:R,y,width:S,height:b}),F=A||"Min value: ".concat((o=O[P])===null||o===void 0?void 0:o.name,", Max value: ").concat((h=O[I])===null||h===void 0?void 0:h.name);return Ue.createElement(js,{tabIndex:0,role:"slider","aria-label":F,"aria-valuenow":n,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[s],onTouchStart:this.travellerDragStartHandlers[s],onKeyDown:function($){["ArrowLeft","ArrowRight"].includes($.key)&&($.preventDefault(),$.stopPropagation(),i.handleTravellerMoveKeyboard($.key==="ArrowRight"?1:-1,s))},onFocus:function(){i.setState({isTravellerFocused:!0})},onBlur:function(){i.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(T,M))}},{key:"renderSlide",value:function(n,s){var o=this.props,h=o.y,i=o.height,m=o.stroke,y=o.travellerWidth,S=Math.min(n,s)+y,b=Math.max(Math.abs(s-n)-y,0);return Ue.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:m,fillOpacity:.2,x:S,y:h,width:b,height:i})}},{key:"renderText",value:function(){var n=this.props,s=n.startIndex,o=n.endIndex,h=n.y,i=n.height,m=n.travellerWidth,y=n.stroke,S=this.state,b=S.startX,T=S.endX,A=5,O={pointerEvents:"none",fill:y};return Ue.createElement(js,{className:"recharts-brush-texts"},Ue.createElement(zv,yk({textAnchor:"end",verticalAnchor:"middle",x:Math.min(b,T)-A,y:h+i/2},O),this.getTextOfTick(s)),Ue.createElement(zv,yk({textAnchor:"start",verticalAnchor:"middle",x:Math.max(b,T)+m+A,y:h+i/2},O),this.getTextOfTick(o)))}},{key:"render",value:function(){var n=this.props,s=n.data,o=n.className,h=n.children,i=n.x,m=n.y,y=n.width,S=n.height,b=n.alwaysShowText,T=this.state,A=T.startX,O=T.endX,P=T.isTextActive,I=T.isSlideMoving,R=T.isTravellerMoving,M=T.isTravellerFocused;if(!s||!s.length||!Gr(i)||!Gr(m)||!Gr(y)||!Gr(S)||y<=0||S<=0)return null;var F=Ii("recharts-brush",o),z=Ue.Children.count(h)===1,$=SYe("userSelect","none");return Ue.createElement(js,{className:F,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:$},this.renderBackground(),z&&this.renderPanorama(),this.renderSlide(A,O),this.renderTravellerLayer(A,"startX"),this.renderTravellerLayer(O,"endX"),(P||I||R||M||b)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(n){var s=n.x,o=n.y,h=n.width,i=n.height,m=n.stroke,y=Math.floor(o+i/2)-1;return Ue.createElement(Ue.Fragment,null,Ue.createElement("rect",{x:s,y:o,width:h,height:i,fill:m,stroke:"none"}),Ue.createElement("line",{x1:s+1,y1:y,x2:s+h-1,y2:y,fill:"none",stroke:"#fff"}),Ue.createElement("line",{x1:s+1,y1:y+2,x2:s+h-1,y2:y+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(n,s){var o;return Ue.isValidElement(n)?o=Ue.cloneElement(n,s):vi(n)?o=n(s):o=t.renderDefaultTraveller(s),o}},{key:"getDerivedStateFromProps",value:function(n,s){var o=n.data,h=n.width,i=n.x,m=n.travellerWidth,y=n.updateId,S=n.startIndex,b=n.endIndex;if(o!==s.prevData||y!==s.prevUpdateId)return SL({prevData:o,prevTravellerWidth:m,prevUpdateId:y,prevX:i,prevWidth:h},o&&o.length?kYe({data:o,width:h,x:i,travellerWidth:m,startIndex:S,endIndex:b}):{scale:null,scaleValues:null});if(s.scale&&(h!==s.prevWidth||i!==s.prevX||m!==s.prevTravellerWidth)){s.scale.range([i,i+h-m]);var T=s.scale.domain().map(function(A){return s.scale(A)});return{prevData:o,prevTravellerWidth:m,prevUpdateId:y,prevX:i,prevWidth:h,startX:s.scale(n.startIndex),endX:s.scale(n.endIndex),scaleValues:T}}return null}},{key:"getIndexInRange",value:function(n,s){for(var o=n.length,h=0,i=o-1;i-h>1;){var m=Math.floor((h+i)/2);n[m]>s?i=m:h=m}return s>=n[i]?i:h}}])}(V.PureComponent);lu(Lb,"displayName","Brush");lu(Lb,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var NYe=T$;function IYe(e,t){var r;return NYe(e,function(n,s,o){return r=t(n,s,o),!r}),!!r}var RYe=IYe,MYe=ale,DYe=nf,LYe=RYe,FYe=Qc,zYe=mI;function BYe(e,t,r){var n=FYe(e)?MYe:LYe;return r&&zYe(e,t,r)&&(t=void 0),n(e,DYe(t))}var $Ye=BYe;const UYe=Os($Ye);var qh=function(t,r){var n=t.alwaysShow,s=t.ifOverflow;return n&&(s="extendDomain"),s===r},FZ=jle;function VYe(e,t,r){t=="__proto__"&&FZ?FZ(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var qYe=VYe,HYe=qYe,GYe=Ale,WYe=nf;function KYe(e,t){var r={};return t=WYe(t),GYe(e,function(n,s,o){HYe(r,s,t(n,s,o))}),r}var ZYe=KYe;const XYe=Os(ZYe);function YYe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}var JYe=YYe,QYe=T$;function eJe(e,t){var r=!0;return QYe(e,function(n,s,o){return r=!!t(n,s,o),r}),r}var tJe=eJe,rJe=JYe,nJe=tJe,iJe=nf,sJe=Qc,aJe=mI;function oJe(e,t,r){var n=sJe(e)?rJe:nJe;return r&&aJe(e,t,r)&&(t=void 0),n(e,iJe(t))}var lJe=oJe;const xue=Os(lJe);var cJe=["x","y"];function s2(e){"@babel/helpers - typeof";return s2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s2(e)}function Jz(){return Jz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Jz.apply(this,arguments)}function zZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function rE(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?zZ(Object(r),!0).forEach(function(n){uJe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function uJe(e,t,r){return t=dJe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dJe(e){var t=hJe(e,"string");return s2(t)=="symbol"?t:t+""}function hJe(e,t){if(s2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(s2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function fJe(e,t){if(e==null)return{};var r=pJe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function pJe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function mJe(e,t){var r=e.x,n=e.y,s=fJe(e,cJe),o="".concat(r),h=parseInt(o,10),i="".concat(n),m=parseInt(i,10),y="".concat(t.height||s.height),S=parseInt(y,10),b="".concat(t.width||s.width),T=parseInt(b,10);return rE(rE(rE(rE(rE({},t),s),h?{x:h}:{}),m?{y:m}:{}),{},{height:S,width:T,name:t.name,radius:t.radius})}function BZ(e){return Ue.createElement(fue,Jz({shapeType:"rectangle",propTransformer:mJe,activeClassName:"recharts-active-bar"},e))}var gJe=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(n,s){if(typeof t=="number")return t;var o=Gr(n)||ULe(n);return o?t(n,s):(o||$v(),r)}},yJe=["value","background"],bue;function Fb(e){"@babel/helpers - typeof";return Fb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fb(e)}function vJe(e,t){if(e==null)return{};var r=_Je(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function _Je(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function _k(){return _k=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_k.apply(this,arguments)}function $Z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Co(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$Z(Object(r),!0).forEach(function(n){Gm(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$Z(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xJe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function UZ(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Sue(n.key),n)}}function bJe(e,t,r){return t&&UZ(e.prototype,t),r&&UZ(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function wJe(e,t,r){return t=xk(t),SJe(e,wue()?Reflect.construct(t,r||[],xk(e).constructor):t.apply(e,r))}function SJe(e,t){if(t&&(Fb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return EJe(e)}function EJe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(wue=function(){return!!e})()}function xk(e){return xk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},xk(e)}function TJe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Qz(e,t)}function Qz(e,t){return Qz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Qz(e,t)}function Gm(e,t,r){return t=Sue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Sue(e){var t=AJe(e,"string");return Fb(t)=="symbol"?t:t+""}function AJe(e,t){if(Fb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Fb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var qu=function(e){function t(){var r;xJe(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=wJe(this,t,[].concat(s)),Gm(r,"state",{isAnimationFinished:!1}),Gm(r,"id",yw("recharts-bar-")),Gm(r,"handleAnimationEnd",function(){var h=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),h&&h()}),Gm(r,"handleAnimationStart",function(){var h=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),h&&h()}),r}return TJe(t,e),bJe(t,[{key:"renderRectanglesStatically",value:function(n){var s=this,o=this.props,h=o.shape,i=o.dataKey,m=o.activeIndex,y=o.activeBar,S=Qn(this.props,!1);return n&&n.map(function(b,T){var A=T===m,O=A?y:h,P=Co(Co(Co({},S),b),{},{isActive:A,option:O,index:T,dataKey:i,onAnimationStart:s.handleAnimationStart,onAnimationEnd:s.handleAnimationEnd});return Ue.createElement(js,_k({className:"recharts-bar-rectangle"},Fv(s.props,b,T),{key:"rectangle-".concat(b==null?void 0:b.x,"-").concat(b==null?void 0:b.y,"-").concat(b==null?void 0:b.value,"-").concat(T)}),Ue.createElement(BZ,P))})}},{key:"renderRectanglesWithAnimation",value:function(){var n=this,s=this.props,o=s.data,h=s.layout,i=s.isAnimationActive,m=s.animationBegin,y=s.animationDuration,S=s.animationEasing,b=s.animationId,T=this.state.prevData;return Ue.createElement(Kh,{begin:m,duration:y,isActive:i,easing:S,from:{t:0},to:{t:1},key:"bar-".concat(b),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(A){var O=A.t,P=o.map(function(I,R){var M=T&&T[R];if(M){var F=fu(M.x,I.x),z=fu(M.y,I.y),$=fu(M.width,I.width),W=fu(M.height,I.height);return Co(Co({},I),{},{x:F(O),y:z(O),width:$(O),height:W(O)})}if(h==="horizontal"){var K=fu(0,I.height),ee=K(O);return Co(Co({},I),{},{y:I.y+I.height-ee,height:ee})}var ne=fu(0,I.width),ie=ne(O);return Co(Co({},I),{},{width:ie})});return Ue.createElement(js,null,n.renderRectanglesStatically(P))})}},{key:"renderRectangles",value:function(){var n=this.props,s=n.data,o=n.isAnimationActive,h=this.state.prevData;return o&&s&&s.length&&(!h||!X2(h,s))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(s)}},{key:"renderBackground",value:function(){var n=this,s=this.props,o=s.data,h=s.dataKey,i=s.activeIndex,m=Qn(this.props.background,!1);return o.map(function(y,S){y.value;var b=y.background,T=vJe(y,yJe);if(!b)return null;var A=Co(Co(Co(Co(Co({},T),{},{fill:"#eee"},b),m),Fv(n.props,y,S)),{},{onAnimationStart:n.handleAnimationStart,onAnimationEnd:n.handleAnimationEnd,dataKey:h,index:S,className:"recharts-bar-background-rectangle"});return Ue.createElement(BZ,_k({key:"background-bar-".concat(S),option:n.props.background,isActive:S===i},A))})}},{key:"renderErrorBar",value:function(n,s){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,h=o.data,i=o.xAxis,m=o.yAxis,y=o.layout,S=o.children,b=wu(S,Y2);if(!b)return null;var T=y==="vertical"?h[0].height/2:h[0].width/2,A=function(I,R){var M=Array.isArray(I.value)?I.value[1]:I.value;return{x:I.x,y:I.y,value:M,errorVal:Ko(I,R)}},O={clipPath:n?"url(#clipPath-".concat(s,")"):null};return Ue.createElement(js,O,b.map(function(P){return Ue.cloneElement(P,{key:"error-bar-".concat(s,"-").concat(P.props.dataKey),data:h,xAxis:i,yAxis:m,layout:y,offset:T,dataPointFormatter:A})}))}},{key:"render",value:function(){var n=this.props,s=n.hide,o=n.data,h=n.className,i=n.xAxis,m=n.yAxis,y=n.left,S=n.top,b=n.width,T=n.height,A=n.isAnimationActive,O=n.background,P=n.id;if(s||!o||!o.length)return null;var I=this.state.isAnimationFinished,R=Ii("recharts-bar",h),M=i&&i.allowDataOverflow,F=m&&m.allowDataOverflow,z=M||F,$=ki(P)?this.id:P;return Ue.createElement(js,{className:R},M||F?Ue.createElement("defs",null,Ue.createElement("clipPath",{id:"clipPath-".concat($)},Ue.createElement("rect",{x:M?y:y-b/2,y:F?S:S-T/2,width:M?b:b*2,height:F?T:T*2}))):null,Ue.createElement(js,{className:"recharts-bar-rectangles",clipPath:z?"url(#clipPath-".concat($,")"):null},O?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(z,$),(!A||I)&&Jf.renderCallByParent(this.props,o))}}],[{key:"getDerivedStateFromProps",value:function(n,s){return n.animationId!==s.prevAnimationId?{prevAnimationId:n.animationId,curData:n.data,prevData:s.curData}:n.data!==s.curData?{curData:n.data}:null}}])}(V.PureComponent);bue=qu;Gm(qu,"displayName","Bar");Gm(qu,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!Uh.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});Gm(qu,"getComposedData",function(e){var t=e.props,r=e.item,n=e.barPosition,s=e.bandSize,o=e.xAxis,h=e.yAxis,i=e.xAxisTicks,m=e.yAxisTicks,y=e.stackedData,S=e.dataStartIndex,b=e.displayedData,T=e.offset,A=aWe(n,r);if(!A)return null;var O=t.layout,P=r.type.defaultProps,I=P!==void 0?Co(Co({},P),r.props):r.props,R=I.dataKey,M=I.children,F=I.minPointSize,z=O==="horizontal"?h:o,$=y?z.scale.domain():null,W=fWe({numericAxis:z}),K=wu(M,IT),ee=b.map(function(ne,ie){var re,te,ae,ue,be,we;y?re=oWe(y[S+ie],$):(re=Ko(ne,R),Array.isArray(re)||(re=[W,re]));var Ce=gJe(F,bue.defaultProps.minPointSize)(re[1],ie);if(O==="horizontal"){var _e,me=[h.scale(re[0]),h.scale(re[1])],Ae=me[0],ge=me[1];te=kK({axis:o,ticks:i,bandSize:s,offset:A.offset,entry:ne,index:ie}),ae=(_e=ge??Ae)!==null&&_e!==void 0?_e:void 0,ue=A.size;var pe=Ae-ge;if(be=Number.isNaN(pe)?0:pe,we={x:te,y:h.y,width:ue,height:h.height},Math.abs(Ce)>0&&Math.abs(be)<Math.abs(Ce)){var Oe=hc(be||Ce)*(Math.abs(Ce)-Math.abs(be));ae-=Oe,be+=Oe}}else{var Je=[o.scale(re[0]),o.scale(re[1])],Ze=Je[0],Pe=Je[1];if(te=Ze,ae=kK({axis:h,ticks:m,bandSize:s,offset:A.offset,entry:ne,index:ie}),ue=Pe-Ze,be=A.size,we={x:o.x,y:ae,width:o.width,height:be},Math.abs(Ce)>0&&Math.abs(ue)<Math.abs(Ce)){var Be=hc(ue||Ce)*(Math.abs(Ce)-Math.abs(ue));ue+=Be}}return Co(Co(Co({},ne),{},{x:te,y:ae,width:ue,height:be,value:y?re:re[1],payload:ne,background:we},K&&K[ie]&&K[ie].props),{},{tooltipPayload:[Hce(r,ne)],tooltipPosition:{x:te+ue/2,y:ae+be/2}})});return Co({data:ee,layout:O},T)});function a2(e){"@babel/helpers - typeof";return a2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a2(e)}function CJe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function VZ(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Eue(n.key),n)}}function jJe(e,t,r){return t&&VZ(e.prototype,t),r&&VZ(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function qZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Dd(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?qZ(Object(r),!0).forEach(function(n){RI(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function RI(e,t,r){return t=Eue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Eue(e){var t=PJe(e,"string");return a2(t)=="symbol"?t:t+""}function PJe(e,t){if(a2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(a2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Tue=function(t,r,n,s,o){var h=t.width,i=t.height,m=t.layout,y=t.children,S=Object.keys(r),b={left:n.left,leftMirror:n.left,right:h-n.right,rightMirror:h-n.right,top:n.top,topMirror:n.top,bottom:i-n.bottom,bottomMirror:i-n.bottom},T=!!uu(y,qu);return S.reduce(function(A,O){var P=r[O],I=P.orientation,R=P.domain,M=P.padding,F=M===void 0?{}:M,z=P.mirror,$=P.reversed,W="".concat(I).concat(z?"Mirror":""),K,ee,ne,ie,re;if(P.type==="number"&&(P.padding==="gap"||P.padding==="no-gap")){var te=R[1]-R[0],ae=1/0,ue=P.categoricalDomain.sort(HLe);if(ue.forEach(function(Je,Ze){Ze>0&&(ae=Math.min((Je||0)-(ue[Ze-1]||0),ae))}),Number.isFinite(ae)){var be=ae/te,we=P.layout==="vertical"?n.height:n.width;if(P.padding==="gap"&&(K=be*we/2),P.padding==="no-gap"){var Ce=fc(t.barCategoryGap,be*we),_e=be*we/2;K=_e-Ce-(_e-Ce)/we*Ce}}}s==="xAxis"?ee=[n.left+(F.left||0)+(K||0),n.left+n.width-(F.right||0)-(K||0)]:s==="yAxis"?ee=m==="horizontal"?[n.top+n.height-(F.bottom||0),n.top+(F.top||0)]:[n.top+(F.top||0)+(K||0),n.top+n.height-(F.bottom||0)-(K||0)]:ee=P.range,$&&(ee=[ee[1],ee[0]]);var me=$ce(P,o,T),Ae=me.scale,ge=me.realScaleType;Ae.domain(R).range(ee),Uce(Ae);var pe=Vce(Ae,Dd(Dd({},P),{},{realScaleType:ge}));s==="xAxis"?(re=I==="top"&&!z||I==="bottom"&&z,ne=n.left,ie=b[W]-re*P.height):s==="yAxis"&&(re=I==="left"&&!z||I==="right"&&z,ne=b[W]-re*P.width,ie=n.top);var Oe=Dd(Dd(Dd({},P),pe),{},{realScaleType:ge,x:ne,y:ie,scale:Ae,width:s==="xAxis"?n.width:P.width,height:s==="yAxis"?n.height:P.height});return Oe.bandSize=nk(Oe,pe),!P.hide&&s==="xAxis"?b[W]+=(re?-1:1)*Oe.height:P.hide||(b[W]+=(re?-1:1)*Oe.width),Dd(Dd({},A),{},RI({},O,Oe))},{})},Aue=function(t,r){var n=t.x,s=t.y,o=r.x,h=r.y;return{x:Math.min(n,o),y:Math.min(s,h),width:Math.abs(o-n),height:Math.abs(h-s)}},OJe=function(t){var r=t.x1,n=t.y1,s=t.x2,o=t.y2;return Aue({x:r,y:n},{x:s,y:o})},Cue=function(){function e(t){CJe(this,e),this.scale=t}return jJe(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=n.bandAware,o=n.position;if(r!==void 0){if(o)switch(o){case"start":return this.scale(r);case"middle":{var h=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+h}case"end":{var i=this.bandwidth?this.bandwidth():0;return this.scale(r)+i}default:return this.scale(r)}if(s){var m=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+m}return this.scale(r)}}},{key:"isInRange",value:function(r){var n=this.range(),s=n[0],o=n[n.length-1];return s<=o?r>=s&&r<=o:r>=o&&r<=s}}],[{key:"create",value:function(r){return new e(r)}}])}();RI(Cue,"EPS",1e-4);var eU=function(t){var r=Object.keys(t).reduce(function(n,s){return Dd(Dd({},n),{},RI({},s,Cue.create(t[s])))},{});return Dd(Dd({},r),{},{apply:function(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},h=o.bandAware,i=o.position;return XYe(s,function(m,y){return r[y].apply(m,{bandAware:h,position:i})})},isInRange:function(s){return xue(s,function(o,h){return r[h].isInRange(o)})}})};function kJe(e){return(e%180+180)%180}var NJe=function(t){var r=t.width,n=t.height,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=kJe(s),h=o*Math.PI/180,i=Math.atan(n/r),m=h>i&&h<Math.PI-i?n/Math.sin(h):r/Math.cos(h);return Math.abs(m)},IJe=nf,RJe=H2,MJe=fI;function DJe(e){return function(t,r,n){var s=Object(t);if(!RJe(t)){var o=IJe(r);t=MJe(t),r=function(i){return o(s[i],i,s)}}var h=e(t,r,n);return h>-1?s[o?t[h]:h]:void 0}}var LJe=DJe,FJe=gue;function zJe(e){var t=FJe(e),r=t%1;return t===t?r?t-r:t:0}var BJe=zJe,$Je=xle,UJe=nf,VJe=BJe,qJe=Math.max;function HJe(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var s=r==null?0:VJe(r);return s<0&&(s=qJe(n+s,0)),$Je(e,UJe(t),s)}var GJe=HJe,WJe=LJe,KJe=GJe,ZJe=WJe(KJe),XJe=ZJe;const YJe=Os(XJe);var JJe=GDe(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),tU=V.createContext(void 0),rU=V.createContext(void 0),jue=V.createContext(void 0),Pue=V.createContext({}),Oue=V.createContext(void 0),kue=V.createContext(0),Nue=V.createContext(0),HZ=function(t){var r=t.state,n=r.xAxisMap,s=r.yAxisMap,o=r.offset,h=t.clipPathId,i=t.children,m=t.width,y=t.height,S=JJe(o);return Ue.createElement(tU.Provider,{value:n},Ue.createElement(rU.Provider,{value:s},Ue.createElement(Pue.Provider,{value:o},Ue.createElement(jue.Provider,{value:S},Ue.createElement(Oue.Provider,{value:h},Ue.createElement(kue.Provider,{value:y},Ue.createElement(Nue.Provider,{value:m},i)))))))},QJe=function(){return V.useContext(Oue)},Iue=function(t){var r=V.useContext(tU);r==null&&$v();var n=r[t];return n==null&&$v(),n},eQe=function(){var t=V.useContext(tU);return km(t)},tQe=function(){var t=V.useContext(rU),r=YJe(t,function(n){return xue(n.domain,Number.isFinite)});return r||km(t)},Rue=function(t){var r=V.useContext(rU);r==null&&$v();var n=r[t];return n==null&&$v(),n},rQe=function(){var t=V.useContext(jue);return t},nQe=function(){return V.useContext(Pue)},nU=function(){return V.useContext(Nue)},iU=function(){return V.useContext(kue)};function zb(e){"@babel/helpers - typeof";return zb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zb(e)}function iQe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function sQe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Due(n.key),n)}}function aQe(e,t,r){return t&&sQe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function oQe(e,t,r){return t=bk(t),lQe(e,Mue()?Reflect.construct(t,r||[],bk(e).constructor):t.apply(e,r))}function lQe(e,t){if(t&&(zb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return cQe(e)}function cQe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Mue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Mue=function(){return!!e})()}function bk(e){return bk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},bk(e)}function uQe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&e4(e,t)}function e4(e,t){return e4=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},e4(e,t)}function GZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function WZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?GZ(Object(r),!0).forEach(function(n){sU(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):GZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function sU(e,t,r){return t=Due(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Due(e){var t=dQe(e,"string");return zb(t)=="symbol"?t:t+""}function dQe(e,t){if(zb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(zb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function hQe(e,t){return gQe(e)||mQe(e,t)||pQe(e,t)||fQe()}function fQe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pQe(e,t){if(e){if(typeof e=="string")return KZ(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return KZ(e,t)}}function KZ(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function mQe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,h,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(h=r.return(),Object(h)!==h))return}finally{if(y)throw s}}return i}}function gQe(e){if(Array.isArray(e))return e}function t4(){return t4=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},t4.apply(this,arguments)}var yQe=function(t,r){var n;return Ue.isValidElement(t)?n=Ue.cloneElement(t,r):vi(t)?n=t(r):n=Ue.createElement("line",t4({},r,{className:"recharts-reference-line-line"})),n},vQe=function(t,r,n,s,o,h,i,m,y){var S=o.x,b=o.y,T=o.width,A=o.height;if(n){var O=y.y,P=t.y.apply(O,{position:h});if(qh(y,"discard")&&!t.y.isInRange(P))return null;var I=[{x:S+T,y:P},{x:S,y:P}];return m==="left"?I.reverse():I}if(r){var R=y.x,M=t.x.apply(R,{position:h});if(qh(y,"discard")&&!t.x.isInRange(M))return null;var F=[{x:M,y:b+A},{x:M,y:b}];return i==="top"?F.reverse():F}if(s){var z=y.segment,$=z.map(function(W){return t.apply(W,{position:h})});return qh(y,"discard")&&UYe($,function(W){return!t.isInRange(W)})?null:$}return null};function _Qe(e){var t=e.x,r=e.y,n=e.segment,s=e.xAxisId,o=e.yAxisId,h=e.shape,i=e.className,m=e.alwaysShow,y=QJe(),S=Iue(s),b=Rue(o),T=rQe();if(!y||!T)return null;Hd(m===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var A=eU({x:S.scale,y:b.scale}),O=Xo(t),P=Xo(r),I=n&&n.length===2,R=vQe(A,O,P,I,T,e.position,S.orientation,b.orientation,e);if(!R)return null;var M=hQe(R,2),F=M[0],z=F.x,$=F.y,W=M[1],K=W.x,ee=W.y,ne=qh(e,"hidden")?"url(#".concat(y,")"):void 0,ie=WZ(WZ({clipPath:ne},Qn(e,!0)),{},{x1:z,y1:$,x2:K,y2:ee});return Ue.createElement(js,{className:Ii("recharts-reference-line",i)},yQe(h,ie),ul.renderCallByParent(e,OJe({x1:z,y1:$,x2:K,y2:ee})))}var aU=function(e){function t(){return iQe(this,t),oQe(this,t,arguments)}return uQe(t,e),aQe(t,[{key:"render",value:function(){return Ue.createElement(_Qe,this.props)}}])}(Ue.Component);sU(aU,"displayName","ReferenceLine");sU(aU,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function r4(){return r4=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},r4.apply(this,arguments)}function Bb(e){"@babel/helpers - typeof";return Bb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bb(e)}function ZZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function XZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ZZ(Object(r),!0).forEach(function(n){MI(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ZZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xQe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bQe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Fue(n.key),n)}}function wQe(e,t,r){return t&&bQe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function SQe(e,t,r){return t=wk(t),EQe(e,Lue()?Reflect.construct(t,r||[],wk(e).constructor):t.apply(e,r))}function EQe(e,t){if(t&&(Bb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return TQe(e)}function TQe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Lue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Lue=function(){return!!e})()}function wk(e){return wk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},wk(e)}function AQe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&n4(e,t)}function n4(e,t){return n4=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},n4(e,t)}function MI(e,t,r){return t=Fue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Fue(e){var t=CQe(e,"string");return Bb(t)=="symbol"?t:t+""}function CQe(e,t){if(Bb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Bb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var jQe=function(t){var r=t.x,n=t.y,s=t.xAxis,o=t.yAxis,h=eU({x:s.scale,y:o.scale}),i=h.apply({x:r,y:n},{bandAware:!0});return qh(t,"discard")&&!h.isInRange(i)?null:i},DI=function(e){function t(){return xQe(this,t),SQe(this,t,arguments)}return AQe(t,e),wQe(t,[{key:"render",value:function(){var n=this.props,s=n.x,o=n.y,h=n.r,i=n.alwaysShow,m=n.clipPathId,y=Xo(s),S=Xo(o);if(Hd(i===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!y||!S)return null;var b=jQe(this.props);if(!b)return null;var T=b.x,A=b.y,O=this.props,P=O.shape,I=O.className,R=qh(this.props,"hidden")?"url(#".concat(m,")"):void 0,M=XZ(XZ({clipPath:R},Qn(this.props,!0)),{},{cx:T,cy:A});return Ue.createElement(js,{className:Ii("recharts-reference-dot",I)},t.renderDot(P,M),ul.renderCallByParent(this.props,{x:T-h,y:A-h,width:2*h,height:2*h}))}}])}(Ue.Component);MI(DI,"displayName","ReferenceDot");MI(DI,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});MI(DI,"renderDot",function(e,t){var r;return Ue.isValidElement(e)?r=Ue.cloneElement(e,t):vi(e)?r=e(t):r=Ue.createElement(CI,r4({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),r});function i4(){return i4=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i4.apply(this,arguments)}function $b(e){"@babel/helpers - typeof";return $b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$b(e)}function YZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function JZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?YZ(Object(r),!0).forEach(function(n){LI(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):YZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function PQe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function OQe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Bue(n.key),n)}}function kQe(e,t,r){return t&&OQe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function NQe(e,t,r){return t=Sk(t),IQe(e,zue()?Reflect.construct(t,r||[],Sk(e).constructor):t.apply(e,r))}function IQe(e,t){if(t&&($b(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return RQe(e)}function RQe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(zue=function(){return!!e})()}function Sk(e){return Sk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Sk(e)}function MQe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&s4(e,t)}function s4(e,t){return s4=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},s4(e,t)}function LI(e,t,r){return t=Bue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Bue(e){var t=DQe(e,"string");return $b(t)=="symbol"?t:t+""}function DQe(e,t){if($b(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if($b(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var LQe=function(t,r,n,s,o){var h=o.x1,i=o.x2,m=o.y1,y=o.y2,S=o.xAxis,b=o.yAxis;if(!S||!b)return null;var T=eU({x:S.scale,y:b.scale}),A={x:t?T.x.apply(h,{position:"start"}):T.x.rangeMin,y:n?T.y.apply(m,{position:"start"}):T.y.rangeMin},O={x:r?T.x.apply(i,{position:"end"}):T.x.rangeMax,y:s?T.y.apply(y,{position:"end"}):T.y.rangeMax};return qh(o,"discard")&&(!T.isInRange(A)||!T.isInRange(O))?null:Aue(A,O)},FI=function(e){function t(){return PQe(this,t),NQe(this,t,arguments)}return MQe(t,e),kQe(t,[{key:"render",value:function(){var n=this.props,s=n.x1,o=n.x2,h=n.y1,i=n.y2,m=n.className,y=n.alwaysShow,S=n.clipPathId;Hd(y===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var b=Xo(s),T=Xo(o),A=Xo(h),O=Xo(i),P=this.props.shape;if(!b&&!T&&!A&&!O&&!P)return null;var I=LQe(b,T,A,O,this.props);if(!I&&!P)return null;var R=qh(this.props,"hidden")?"url(#".concat(S,")"):void 0;return Ue.createElement(js,{className:Ii("recharts-reference-area",m)},t.renderRect(P,JZ(JZ({clipPath:R},Qn(this.props,!0)),I)),ul.renderCallByParent(this.props,I))}}])}(Ue.Component);LI(FI,"displayName","ReferenceArea");LI(FI,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});LI(FI,"renderRect",function(e,t){var r;return Ue.isValidElement(e)?r=Ue.cloneElement(e,t):vi(e)?r=e(t):r=Ue.createElement(Q$,i4({},t,{className:"recharts-reference-area-rect"})),r});function $ue(e,t,r){if(t<1)return[];if(t===1&&r===void 0)return e;for(var n=[],s=0;s<e.length;s+=t)n.push(e[s]);return n}function FQe(e,t,r){var n={width:e.width+t.width,height:e.height+t.height};return NJe(n,r)}function zQe(e,t,r){var n=r==="width",s=e.x,o=e.y,h=e.width,i=e.height;return t===1?{start:n?s:o,end:n?s+h:o+i}:{start:n?s+h:o+i,end:n?s:o}}function Ek(e,t,r,n,s){if(e*t<e*n||e*t>e*s)return!1;var o=r();return e*(t-e*o/2-n)>=0&&e*(t+e*o/2-s)<=0}function BQe(e,t){return $ue(e,t+1)}function $Qe(e,t,r,n,s){for(var o=(n||[]).slice(),h=t.start,i=t.end,m=0,y=1,S=h,b=function(){var O=n==null?void 0:n[m];if(O===void 0)return{v:$ue(n,y)};var P=m,I,R=function(){return I===void 0&&(I=r(O,P)),I},M=O.coordinate,F=m===0||Ek(e,M,R,S,i);F||(m=0,S=h,y+=1),F&&(S=M+e*(R()/2+s),m+=y)},T;y<=o.length;)if(T=b(),T)return T.v;return[]}function o2(e){"@babel/helpers - typeof";return o2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o2(e)}function QZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Fl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?QZ(Object(r),!0).forEach(function(n){UQe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):QZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function UQe(e,t,r){return t=VQe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function VQe(e){var t=qQe(e,"string");return o2(t)=="symbol"?t:t+""}function qQe(e,t){if(o2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(o2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function HQe(e,t,r,n,s){for(var o=(n||[]).slice(),h=o.length,i=t.start,m=t.end,y=function(T){var A=o[T],O,P=function(){return O===void 0&&(O=r(A,T)),O};if(T===h-1){var I=e*(A.coordinate+e*P()/2-m);o[T]=A=Fl(Fl({},A),{},{tickCoord:I>0?A.coordinate-I*e:A.coordinate})}else o[T]=A=Fl(Fl({},A),{},{tickCoord:A.coordinate});var R=Ek(e,A.tickCoord,P,i,m);R&&(m=A.tickCoord-e*(P()/2+s),o[T]=Fl(Fl({},A),{},{isShow:!0}))},S=h-1;S>=0;S--)y(S);return o}function GQe(e,t,r,n,s,o){var h=(n||[]).slice(),i=h.length,m=t.start,y=t.end;if(o){var S=n[i-1],b=r(S,i-1),T=e*(S.coordinate+e*b/2-y);h[i-1]=S=Fl(Fl({},S),{},{tickCoord:T>0?S.coordinate-T*e:S.coordinate});var A=Ek(e,S.tickCoord,function(){return b},m,y);A&&(y=S.tickCoord-e*(b/2+s),h[i-1]=Fl(Fl({},S),{},{isShow:!0}))}for(var O=o?i-1:i,P=function(M){var F=h[M],z,$=function(){return z===void 0&&(z=r(F,M)),z};if(M===0){var W=e*(F.coordinate-e*$()/2-m);h[M]=F=Fl(Fl({},F),{},{tickCoord:W<0?F.coordinate-W*e:F.coordinate})}else h[M]=F=Fl(Fl({},F),{},{tickCoord:F.coordinate});var K=Ek(e,F.tickCoord,$,m,y);K&&(m=F.tickCoord+e*($()/2+s),h[M]=Fl(Fl({},F),{},{isShow:!0}))},I=0;I<O;I++)P(I);return h}function oU(e,t,r){var n=e.tick,s=e.ticks,o=e.viewBox,h=e.minTickGap,i=e.orientation,m=e.interval,y=e.tickFormatter,S=e.unit,b=e.angle;if(!s||!s.length||!n)return[];if(Gr(m)||Uh.isSsr)return BQe(s,typeof m=="number"&&Gr(m)?m:0);var T=[],A=i==="top"||i==="bottom"?"width":"height",O=S&&A==="width"?LE(S,{fontSize:t,letterSpacing:r}):{width:0,height:0},P=function(F,z){var $=vi(y)?y(F.value,z):F.value;return A==="width"?FQe(LE($,{fontSize:t,letterSpacing:r}),O,b):LE($,{fontSize:t,letterSpacing:r})[A]},I=s.length>=2?hc(s[1].coordinate-s[0].coordinate):1,R=zQe(o,I,A);return m==="equidistantPreserveStart"?$Qe(I,R,P,s,h):(m==="preserveStart"||m==="preserveStartEnd"?T=GQe(I,R,P,s,h,m==="preserveStartEnd"):T=HQe(I,R,P,s,h),T.filter(function(M){return M.isShow}))}var WQe=["viewBox"],KQe=["viewBox"],ZQe=["ticks"];function Ub(e){"@babel/helpers - typeof";return Ub=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ub(e)}function y0(){return y0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},y0.apply(this,arguments)}function eX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Uo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?eX(Object(r),!0).forEach(function(n){lU(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function EL(e,t){if(e==null)return{};var r=XQe(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function XQe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function YQe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tX(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Vue(n.key),n)}}function JQe(e,t,r){return t&&tX(e.prototype,t),r&&tX(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function QQe(e,t,r){return t=Tk(t),eet(e,Uue()?Reflect.construct(t,r||[],Tk(e).constructor):t.apply(e,r))}function eet(e,t){if(t&&(Ub(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return tet(e)}function tet(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Uue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Uue=function(){return!!e})()}function Tk(e){return Tk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Tk(e)}function ret(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a4(e,t)}function a4(e,t){return a4=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},a4(e,t)}function lU(e,t,r){return t=Vue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Vue(e){var t=net(e,"string");return Ub(t)=="symbol"?t:t+""}function net(e,t){if(Ub(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Ub(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Ew=function(e){function t(r){var n;return YQe(this,t),n=QQe(this,t,[r]),n.state={fontSize:"",letterSpacing:""},n}return ret(t,e),JQe(t,[{key:"shouldComponentUpdate",value:function(n,s){var o=n.viewBox,h=EL(n,WQe),i=this.props,m=i.viewBox,y=EL(i,KQe);return!R0(o,m)||!R0(h,y)||!R0(s,this.state)}},{key:"componentDidMount",value:function(){var n=this.layerReference;if(n){var s=n.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];s&&this.setState({fontSize:window.getComputedStyle(s).fontSize,letterSpacing:window.getComputedStyle(s).letterSpacing})}}},{key:"getTickLineCoord",value:function(n){var s=this.props,o=s.x,h=s.y,i=s.width,m=s.height,y=s.orientation,S=s.tickSize,b=s.mirror,T=s.tickMargin,A,O,P,I,R,M,F=b?-1:1,z=n.tickSize||S,$=Gr(n.tickCoord)?n.tickCoord:n.coordinate;switch(y){case"top":A=O=n.coordinate,I=h+ +!b*m,P=I-F*z,M=P-F*T,R=$;break;case"left":P=I=n.coordinate,O=o+ +!b*i,A=O-F*z,R=A-F*T,M=$;break;case"right":P=I=n.coordinate,O=o+ +b*i,A=O+F*z,R=A+F*T,M=$;break;default:A=O=n.coordinate,I=h+ +b*m,P=I+F*z,M=P+F*T,R=$;break}return{line:{x1:A,y1:P,x2:O,y2:I},tick:{x:R,y:M}}}},{key:"getTickTextAnchor",value:function(){var n=this.props,s=n.orientation,o=n.mirror,h;switch(s){case"left":h=o?"start":"end";break;case"right":h=o?"end":"start";break;default:h="middle";break}return h}},{key:"getTickVerticalAnchor",value:function(){var n=this.props,s=n.orientation,o=n.mirror,h="end";switch(s){case"left":case"right":h="middle";break;case"top":h=o?"start":"end";break;default:h=o?"end":"start";break}return h}},{key:"renderAxisLine",value:function(){var n=this.props,s=n.x,o=n.y,h=n.width,i=n.height,m=n.orientation,y=n.mirror,S=n.axisLine,b=Uo(Uo(Uo({},Qn(this.props,!1)),Qn(S,!1)),{},{fill:"none"});if(m==="top"||m==="bottom"){var T=+(m==="top"&&!y||m==="bottom"&&y);b=Uo(Uo({},b),{},{x1:s,y1:o+T*i,x2:s+h,y2:o+T*i})}else{var A=+(m==="left"&&!y||m==="right"&&y);b=Uo(Uo({},b),{},{x1:s+A*h,y1:o,x2:s+A*h,y2:o+i})}return Ue.createElement("line",y0({},b,{className:Ii("recharts-cartesian-axis-line",bu(S,"className"))}))}},{key:"renderTicks",value:function(n,s,o){var h=this,i=this.props,m=i.tickLine,y=i.stroke,S=i.tick,b=i.tickFormatter,T=i.unit,A=oU(Uo(Uo({},this.props),{},{ticks:n}),s,o),O=this.getTickTextAnchor(),P=this.getTickVerticalAnchor(),I=Qn(this.props,!1),R=Qn(S,!1),M=Uo(Uo({},I),{},{fill:"none"},Qn(m,!1)),F=A.map(function(z,$){var W=h.getTickLineCoord(z),K=W.line,ee=W.tick,ne=Uo(Uo(Uo(Uo({textAnchor:O,verticalAnchor:P},I),{},{stroke:"none",fill:y},R),ee),{},{index:$,payload:z,visibleTicksCount:A.length,tickFormatter:b});return Ue.createElement(js,y0({className:"recharts-cartesian-axis-tick",key:"tick-".concat(z.value,"-").concat(z.coordinate,"-").concat(z.tickCoord)},Fv(h.props,z,$)),m&&Ue.createElement("line",y0({},M,K,{className:Ii("recharts-cartesian-axis-tick-line",bu(m,"className"))})),S&&t.renderTickItem(S,ne,"".concat(vi(b)?b(z.value,$):z.value).concat(T||"")))});return Ue.createElement("g",{className:"recharts-cartesian-axis-ticks"},F)}},{key:"render",value:function(){var n=this,s=this.props,o=s.axisLine,h=s.width,i=s.height,m=s.ticksGenerator,y=s.className,S=s.hide;if(S)return null;var b=this.props,T=b.ticks,A=EL(b,ZQe),O=T;return vi(m)&&(O=T&&T.length>0?m(this.props):m(A)),h<=0||i<=0||!O||!O.length?null:Ue.createElement(js,{className:Ii("recharts-cartesian-axis",y),ref:function(I){n.layerReference=I}},o&&this.renderAxisLine(),this.renderTicks(O,this.state.fontSize,this.state.letterSpacing),ul.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(n,s,o){var h,i=Ii(s.className,"recharts-cartesian-axis-tick-value");return Ue.isValidElement(n)?h=Ue.cloneElement(n,Uo(Uo({},s),{},{className:i})):vi(n)?h=n(Uo(Uo({},s),{},{className:i})):h=Ue.createElement(zv,y0({},s,{className:"recharts-cartesian-axis-tick-value"}),o),h}}])}(V.Component);lU(Ew,"displayName","CartesianAxis");lU(Ew,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var iet=["x1","y1","x2","y2","key"],set=["offset"];function Uv(e){"@babel/helpers - typeof";return Uv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Uv(e)}function rX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Bl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rX(Object(r),!0).forEach(function(n){aet(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function aet(e,t,r){return t=oet(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function oet(e){var t=cet(e,"string");return Uv(t)=="symbol"?t:t+""}function cet(e,t){if(Uv(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Uv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ev(){return ev=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ev.apply(this,arguments)}function nX(e,t){if(e==null)return{};var r=uet(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function uet(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var det=function(t){var r=t.fill;if(!r||r==="none")return null;var n=t.fillOpacity,s=t.x,o=t.y,h=t.width,i=t.height,m=t.ry;return Ue.createElement("rect",{x:s,y:o,ry:m,width:h,height:i,stroke:"none",fill:r,fillOpacity:n,className:"recharts-cartesian-grid-bg"})};function que(e,t){var r;if(Ue.isValidElement(e))r=Ue.cloneElement(e,t);else if(vi(e))r=e(t);else{var n=t.x1,s=t.y1,o=t.x2,h=t.y2,i=t.key,m=nX(t,iet),y=Qn(m,!1);y.offset;var S=nX(y,set);r=Ue.createElement("line",ev({},S,{x1:n,y1:s,x2:o,y2:h,fill:"none",key:i}))}return r}function het(e){var t=e.x,r=e.width,n=e.horizontal,s=n===void 0?!0:n,o=e.horizontalPoints;if(!s||!o||!o.length)return null;var h=o.map(function(i,m){var y=Bl(Bl({},e),{},{x1:t,y1:i,x2:t+r,y2:i,key:"line-".concat(m),index:m});return que(s,y)});return Ue.createElement("g",{className:"recharts-cartesian-grid-horizontal"},h)}function fet(e){var t=e.y,r=e.height,n=e.vertical,s=n===void 0?!0:n,o=e.verticalPoints;if(!s||!o||!o.length)return null;var h=o.map(function(i,m){var y=Bl(Bl({},e),{},{x1:i,y1:t,x2:i,y2:t+r,key:"line-".concat(m),index:m});return que(s,y)});return Ue.createElement("g",{className:"recharts-cartesian-grid-vertical"},h)}function pet(e){var t=e.horizontalFill,r=e.fillOpacity,n=e.x,s=e.y,o=e.width,h=e.height,i=e.horizontalPoints,m=e.horizontal,y=m===void 0?!0:m;if(!y||!t||!t.length)return null;var S=i.map(function(T){return Math.round(T+s-s)}).sort(function(T,A){return T-A});s!==S[0]&&S.unshift(0);var b=S.map(function(T,A){var O=!S[A+1],P=O?s+h-T:S[A+1]-T;if(P<=0)return null;var I=A%t.length;return Ue.createElement("rect",{key:"react-".concat(A),y:T,x:n,height:P,width:o,stroke:"none",fill:t[I],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return Ue.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},b)}function met(e){var t=e.vertical,r=t===void 0?!0:t,n=e.verticalFill,s=e.fillOpacity,o=e.x,h=e.y,i=e.width,m=e.height,y=e.verticalPoints;if(!r||!n||!n.length)return null;var S=y.map(function(T){return Math.round(T+o-o)}).sort(function(T,A){return T-A});o!==S[0]&&S.unshift(0);var b=S.map(function(T,A){var O=!S[A+1],P=O?o+i-T:S[A+1]-T;if(P<=0)return null;var I=A%n.length;return Ue.createElement("rect",{key:"react-".concat(A),x:T,y:h,width:P,height:m,stroke:"none",fill:n[I],fillOpacity:s,className:"recharts-cartesian-grid-bg"})});return Ue.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},b)}var get=function(t,r){var n=t.xAxis,s=t.width,o=t.height,h=t.offset;return Bce(oU(Bl(Bl(Bl({},Ew.defaultProps),n),{},{ticks:Kf(n,!0),viewBox:{x:0,y:0,width:s,height:o}})),h.left,h.left+h.width,r)},yet=function(t,r){var n=t.yAxis,s=t.width,o=t.height,h=t.offset;return Bce(oU(Bl(Bl(Bl({},Ew.defaultProps),n),{},{ticks:Kf(n,!0),viewBox:{x:0,y:0,width:s,height:o}})),h.top,h.top+h.height,r)},Hx={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function tv(e){var t,r,n,s,o,h,i=nU(),m=iU(),y=nQe(),S=Bl(Bl({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:Hx.stroke,fill:(r=e.fill)!==null&&r!==void 0?r:Hx.fill,horizontal:(n=e.horizontal)!==null&&n!==void 0?n:Hx.horizontal,horizontalFill:(s=e.horizontalFill)!==null&&s!==void 0?s:Hx.horizontalFill,vertical:(o=e.vertical)!==null&&o!==void 0?o:Hx.vertical,verticalFill:(h=e.verticalFill)!==null&&h!==void 0?h:Hx.verticalFill,x:Gr(e.x)?e.x:y.left,y:Gr(e.y)?e.y:y.top,width:Gr(e.width)?e.width:y.width,height:Gr(e.height)?e.height:y.height}),b=S.x,T=S.y,A=S.width,O=S.height,P=S.syncWithTicks,I=S.horizontalValues,R=S.verticalValues,M=eQe(),F=tQe();if(!Gr(A)||A<=0||!Gr(O)||O<=0||!Gr(b)||b!==+b||!Gr(T)||T!==+T)return null;var z=S.verticalCoordinatesGenerator||get,$=S.horizontalCoordinatesGenerator||yet,W=S.horizontalPoints,K=S.verticalPoints;if((!W||!W.length)&&vi($)){var ee=I&&I.length,ne=$({yAxis:F?Bl(Bl({},F),{},{ticks:ee?I:F.ticks}):void 0,width:i,height:m,offset:y},ee?!0:P);Hd(Array.isArray(ne),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(Uv(ne),"]")),Array.isArray(ne)&&(W=ne)}if((!K||!K.length)&&vi(z)){var ie=R&&R.length,re=z({xAxis:M?Bl(Bl({},M),{},{ticks:ie?R:M.ticks}):void 0,width:i,height:m,offset:y},ie?!0:P);Hd(Array.isArray(re),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(Uv(re),"]")),Array.isArray(re)&&(K=re)}return Ue.createElement("g",{className:"recharts-cartesian-grid"},Ue.createElement(det,{fill:S.fill,fillOpacity:S.fillOpacity,x:S.x,y:S.y,width:S.width,height:S.height,ry:S.ry}),Ue.createElement(het,ev({},S,{offset:y,horizontalPoints:W,xAxis:M,yAxis:F})),Ue.createElement(fet,ev({},S,{offset:y,verticalPoints:K,xAxis:M,yAxis:F})),Ue.createElement(pet,ev({},S,{horizontalPoints:W})),Ue.createElement(met,ev({},S,{verticalPoints:K})))}tv.displayName="CartesianGrid";var vet=["type","layout","connectNulls","ref"],_et=["key"];function Vb(e){"@babel/helpers - typeof";return Vb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vb(e)}function iX(e,t){if(e==null)return{};var r=xet(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function xet(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function VE(){return VE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},VE.apply(this,arguments)}function sX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function ou(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?sX(Object(r),!0).forEach(function(n){Ld(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Gx(e){return Tet(e)||Eet(e)||wet(e)||bet()}function bet(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wet(e,t){if(e){if(typeof e=="string")return o4(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o4(e,t)}}function Eet(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Tet(e){if(Array.isArray(e))return o4(e)}function o4(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Aet(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function aX(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Gue(n.key),n)}}function Cet(e,t,r){return t&&aX(e.prototype,t),r&&aX(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function jet(e,t,r){return t=Ak(t),Pet(e,Hue()?Reflect.construct(t,r||[],Ak(e).constructor):t.apply(e,r))}function Pet(e,t){if(t&&(Vb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Oet(e)}function Oet(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Hue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Hue=function(){return!!e})()}function Ak(e){return Ak=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Ak(e)}function ket(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l4(e,t)}function l4(e,t){return l4=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},l4(e,t)}function Ld(e,t,r){return t=Gue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Gue(e){var t=Net(e,"string");return Vb(t)=="symbol"?t:t+""}function Net(e,t){if(Vb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Vb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Tw=function(e){function t(){var r;Aet(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return r=jet(this,t,[].concat(s)),Ld(r,"state",{isAnimationFinished:!0,totalLength:0}),Ld(r,"generateSimpleStrokeDasharray",function(h,i){return"".concat(i,"px ").concat(h-i,"px")}),Ld(r,"getStrokeDasharray",function(h,i,m){var y=m.reduce(function(R,M){return R+M});if(!y)return r.generateSimpleStrokeDasharray(i,h);for(var S=Math.floor(h/y),b=h%y,T=i-h,A=[],O=0,P=0;O<m.length;P+=m[O],++O)if(P+m[O]>b){A=[].concat(Gx(m.slice(0,O)),[b-P]);break}var I=A.length%2===0?[0,T]:[T];return[].concat(Gx(t.repeat(m,S)),Gx(A),I).map(function(R){return"".concat(R,"px")}).join(", ")}),Ld(r,"id",yw("recharts-line-")),Ld(r,"pathRef",function(h){r.mainCurve=h}),Ld(r,"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0}),r.props.onAnimationEnd&&r.props.onAnimationEnd()}),Ld(r,"handleAnimationStart",function(){r.setState({isAnimationFinished:!1}),r.props.onAnimationStart&&r.props.onAnimationStart()}),r}return ket(t,e),Cet(t,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();this.setState({totalLength:n})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();n!==this.state.totalLength&&this.setState({totalLength:n})}}},{key:"getTotalLength",value:function(){var n=this.mainCurve;try{return n&&n.getTotalLength&&n.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(n,s){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,h=o.points,i=o.xAxis,m=o.yAxis,y=o.layout,S=o.children,b=wu(S,Y2);if(!b)return null;var T=function(P,I){return{x:P.x,y:P.y,value:P.value,errorVal:Ko(P.payload,I)}},A={clipPath:n?"url(#clipPath-".concat(s,")"):null};return Ue.createElement(js,A,b.map(function(O){return Ue.cloneElement(O,{key:"bar-".concat(O.props.dataKey),data:h,xAxis:i,yAxis:m,layout:y,dataPointFormatter:T})}))}},{key:"renderDots",value:function(n,s,o){var h=this.props.isAnimationActive;if(h&&!this.state.isAnimationFinished)return null;var i=this.props,m=i.dot,y=i.points,S=i.dataKey,b=Qn(this.props,!1),T=Qn(m,!0),A=y.map(function(P,I){var R=ou(ou(ou({key:"dot-".concat(I),r:3},b),T),{},{index:I,cx:P.x,cy:P.y,value:P.value,dataKey:S,payload:P.payload,points:y});return t.renderDotItem(m,R)}),O={clipPath:n?"url(#clipPath-".concat(s?"":"dots-").concat(o,")"):null};return Ue.createElement(js,VE({className:"recharts-line-dots",key:"dots"},O),A)}},{key:"renderCurveStatically",value:function(n,s,o,h){var i=this.props,m=i.type,y=i.layout,S=i.connectNulls;i.ref;var b=iX(i,vet),T=ou(ou(ou({},Qn(b,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:s?"url(#clipPath-".concat(o,")"):null,points:n},h),{},{type:m,layout:y,connectNulls:S});return Ue.createElement(ak,VE({},T,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(n,s){var o=this,h=this.props,i=h.points,m=h.strokeDasharray,y=h.isAnimationActive,S=h.animationBegin,b=h.animationDuration,T=h.animationEasing,A=h.animationId,O=h.animateNewValues,P=h.width,I=h.height,R=this.state,M=R.prevPoints,F=R.totalLength;return Ue.createElement(Kh,{begin:S,duration:b,isActive:y,easing:T,from:{t:0},to:{t:1},key:"line-".concat(A),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(z){var $=z.t;if(M){var W=M.length/i.length,K=i.map(function(te,ae){var ue=Math.floor(ae*W);if(M[ue]){var be=M[ue],we=fu(be.x,te.x),Ce=fu(be.y,te.y);return ou(ou({},te),{},{x:we($),y:Ce($)})}if(O){var _e=fu(P*2,te.x),me=fu(I/2,te.y);return ou(ou({},te),{},{x:_e($),y:me($)})}return ou(ou({},te),{},{x:te.x,y:te.y})});return o.renderCurveStatically(K,n,s)}var ee=fu(0,F),ne=ee($),ie;if(m){var re="".concat(m).split(/[,\s]+/gim).map(function(te){return parseFloat(te)});ie=o.getStrokeDasharray(ne,F,re)}else ie=o.generateSimpleStrokeDasharray(F,ne);return o.renderCurveStatically(i,n,s,{strokeDasharray:ie})})}},{key:"renderCurve",value:function(n,s){var o=this.props,h=o.points,i=o.isAnimationActive,m=this.state,y=m.prevPoints,S=m.totalLength;return i&&h&&h.length&&(!y&&S>0||!X2(y,h))?this.renderCurveWithAnimation(n,s):this.renderCurveStatically(h,n,s)}},{key:"render",value:function(){var n,s=this.props,o=s.hide,h=s.dot,i=s.points,m=s.className,y=s.xAxis,S=s.yAxis,b=s.top,T=s.left,A=s.width,O=s.height,P=s.isAnimationActive,I=s.id;if(o||!i||!i.length)return null;var R=this.state.isAnimationFinished,M=i.length===1,F=Ii("recharts-line",m),z=y&&y.allowDataOverflow,$=S&&S.allowDataOverflow,W=z||$,K=ki(I)?this.id:I,ee=(n=Qn(h,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},ne=ee.r,ie=ne===void 0?3:ne,re=ee.strokeWidth,te=re===void 0?2:re,ae=e3e(h)?h:{},ue=ae.clipDot,be=ue===void 0?!0:ue,we=ie*2+te;return Ue.createElement(js,{className:F},z||$?Ue.createElement("defs",null,Ue.createElement("clipPath",{id:"clipPath-".concat(K)},Ue.createElement("rect",{x:z?T:T-A/2,y:$?b:b-O/2,width:z?A:A*2,height:$?O:O*2})),!be&&Ue.createElement("clipPath",{id:"clipPath-dots-".concat(K)},Ue.createElement("rect",{x:T-we/2,y:b-we/2,width:A+we,height:O+we}))):null,!M&&this.renderCurve(W,K),this.renderErrorBar(W,K),(M||h)&&this.renderDots(W,be,K),(!P||R)&&Jf.renderCallByParent(this.props,i))}}],[{key:"getDerivedStateFromProps",value:function(n,s){return n.animationId!==s.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:s.curPoints}:n.points!==s.curPoints?{curPoints:n.points}:null}},{key:"repeat",value:function(n,s){for(var o=n.length%2!==0?[].concat(Gx(n),[0]):n,h=[],i=0;i<s;++i)h=[].concat(Gx(h),Gx(o));return h}},{key:"renderDotItem",value:function(n,s){var o;if(Ue.isValidElement(n))o=Ue.cloneElement(n,s);else if(vi(n))o=n(s);else{var h=s.key,i=iX(s,_et),m=Ii("recharts-line-dot",typeof n!="boolean"?n.className:"");o=Ue.createElement(CI,VE({key:h},i,{className:m}))}return o}}])}(V.PureComponent);Ld(Tw,"displayName","Line");Ld(Tw,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Uh.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});Ld(Tw,"getComposedData",function(e){var t=e.props,r=e.xAxis,n=e.yAxis,s=e.xAxisTicks,o=e.yAxisTicks,h=e.dataKey,i=e.bandSize,m=e.displayedData,y=e.offset,S=t.layout,b=m.map(function(T,A){var O=Ko(T,h);return S==="horizontal"?{x:OK({axis:r,ticks:s,bandSize:i,entry:T,index:A}),y:ki(O)?null:n.scale(O),value:O,payload:T}:{x:ki(O)?null:r.scale(O),y:OK({axis:n,ticks:o,bandSize:i,entry:T,index:A}),value:O,payload:T}});return ou({points:b,layout:S},y)});function qb(e){"@babel/helpers - typeof";return qb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qb(e)}function Iet(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ret(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Zue(n.key),n)}}function Met(e,t,r){return t&&Ret(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Det(e,t,r){return t=Ck(t),Let(e,Wue()?Reflect.construct(t,r||[],Ck(e).constructor):t.apply(e,r))}function Let(e,t){if(t&&(qb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Fet(e)}function Fet(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Wue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Wue=function(){return!!e})()}function Ck(e){return Ck=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Ck(e)}function zet(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c4(e,t)}function c4(e,t){return c4=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},c4(e,t)}function Kue(e,t,r){return t=Zue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Zue(e){var t=Bet(e,"string");return qb(t)=="symbol"?t:t+""}function Bet(e,t){if(qb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(qb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function u4(){return u4=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u4.apply(this,arguments)}function $et(e){var t=e.xAxisId,r=nU(),n=iU(),s=Iue(t);return s==null?null:V.createElement(Ew,u4({},s,{className:Ii("recharts-".concat(s.axisType," ").concat(s.axisType),s.className),viewBox:{x:0,y:0,width:r,height:n},ticksGenerator:function(h){return Kf(h,!0)}}))}var Mh=function(e){function t(){return Iet(this,t),Det(this,t,arguments)}return zet(t,e),Met(t,[{key:"render",value:function(){return V.createElement($et,this.props)}}])}(V.Component);Kue(Mh,"displayName","XAxis");Kue(Mh,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function Hb(e){"@babel/helpers - typeof";return Hb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hb(e)}function Uet(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Vet(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Jue(n.key),n)}}function qet(e,t,r){return t&&Vet(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Het(e,t,r){return t=jk(t),Get(e,Xue()?Reflect.construct(t,r||[],jk(e).constructor):t.apply(e,r))}function Get(e,t){if(t&&(Hb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Wet(e)}function Wet(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Xue=function(){return!!e})()}function jk(e){return jk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},jk(e)}function Ket(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d4(e,t)}function d4(e,t){return d4=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},d4(e,t)}function Yue(e,t,r){return t=Jue(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Jue(e){var t=Zet(e,"string");return Hb(t)=="symbol"?t:t+""}function Zet(e,t){if(Hb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Hb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function h4(){return h4=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},h4.apply(this,arguments)}var Xet=function(t){var r=t.yAxisId,n=nU(),s=iU(),o=Rue(r);return o==null?null:V.createElement(Ew,h4({},o,{className:Ii("recharts-".concat(o.axisType," ").concat(o.axisType),o.className),viewBox:{x:0,y:0,width:n,height:s},ticksGenerator:function(i){return Kf(i,!0)}}))},Dh=function(e){function t(){return Uet(this,t),Het(this,t,arguments)}return Ket(t,e),qet(t,[{key:"render",value:function(){return V.createElement(Xet,this.props)}}])}(V.Component);Yue(Dh,"displayName","YAxis");Yue(Dh,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function oX(e){return ett(e)||Qet(e)||Jet(e)||Yet()}function Yet(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Jet(e,t){if(e){if(typeof e=="string")return f4(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f4(e,t)}}function Qet(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function ett(e){if(Array.isArray(e))return f4(e)}function f4(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var p4=function(t,r,n,s,o){var h=wu(t,aU),i=wu(t,DI),m=[].concat(oX(h),oX(i)),y=wu(t,FI),S="".concat(s,"Id"),b=s[0],T=r;if(m.length&&(T=m.reduce(function(P,I){if(I.props[S]===n&&qh(I.props,"extendDomain")&&Gr(I.props[b])){var R=I.props[b];return[Math.min(P[0],R),Math.max(P[1],R)]}return P},T)),y.length){var A="".concat(b,"1"),O="".concat(b,"2");T=y.reduce(function(P,I){if(I.props[S]===n&&qh(I.props,"extendDomain")&&Gr(I.props[A])&&Gr(I.props[O])){var R=I.props[A],M=I.props[O];return[Math.min(P[0],R,M),Math.max(P[1],R,M)]}return P},T)}return o&&o.length&&(T=o.reduce(function(P,I){return Gr(I)?[Math.min(P[0],I),Math.max(P[1],I)]:P},T)),T},Que={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function s(m,y,S){this.fn=m,this.context=y,this.once=S||!1}function o(m,y,S,b,T){if(typeof S!="function")throw new TypeError("The listener must be a function");var A=new s(S,b||m,T),O=r?r+y:y;return m._events[O]?m._events[O].fn?m._events[O]=[m._events[O],A]:m._events[O].push(A):(m._events[O]=A,m._eventsCount++),m}function h(m,y){--m._eventsCount===0?m._events=new n:delete m._events[y]}function i(){this._events=new n,this._eventsCount=0}i.prototype.eventNames=function(){var y=[],S,b;if(this._eventsCount===0)return y;for(b in S=this._events)t.call(S,b)&&y.push(r?b.slice(1):b);return Object.getOwnPropertySymbols?y.concat(Object.getOwnPropertySymbols(S)):y},i.prototype.listeners=function(y){var S=r?r+y:y,b=this._events[S];if(!b)return[];if(b.fn)return[b.fn];for(var T=0,A=b.length,O=new Array(A);T<A;T++)O[T]=b[T].fn;return O},i.prototype.listenerCount=function(y){var S=r?r+y:y,b=this._events[S];return b?b.fn?1:b.length:0},i.prototype.emit=function(y,S,b,T,A,O){var P=r?r+y:y;if(!this._events[P])return!1;var I=this._events[P],R=arguments.length,M,F;if(I.fn){switch(I.once&&this.removeListener(y,I.fn,void 0,!0),R){case 1:return I.fn.call(I.context),!0;case 2:return I.fn.call(I.context,S),!0;case 3:return I.fn.call(I.context,S,b),!0;case 4:return I.fn.call(I.context,S,b,T),!0;case 5:return I.fn.call(I.context,S,b,T,A),!0;case 6:return I.fn.call(I.context,S,b,T,A,O),!0}for(F=1,M=new Array(R-1);F<R;F++)M[F-1]=arguments[F];I.fn.apply(I.context,M)}else{var z=I.length,$;for(F=0;F<z;F++)switch(I[F].once&&this.removeListener(y,I[F].fn,void 0,!0),R){case 1:I[F].fn.call(I[F].context);break;case 2:I[F].fn.call(I[F].context,S);break;case 3:I[F].fn.call(I[F].context,S,b);break;case 4:I[F].fn.call(I[F].context,S,b,T);break;default:if(!M)for($=1,M=new Array(R-1);$<R;$++)M[$-1]=arguments[$];I[F].fn.apply(I[F].context,M)}}return!0},i.prototype.on=function(y,S,b){return o(this,y,S,b,!1)},i.prototype.once=function(y,S,b){return o(this,y,S,b,!0)},i.prototype.removeListener=function(y,S,b,T){var A=r?r+y:y;if(!this._events[A])return this;if(!S)return h(this,A),this;var O=this._events[A];if(O.fn)O.fn===S&&(!T||O.once)&&(!b||O.context===b)&&h(this,A);else{for(var P=0,I=[],R=O.length;P<R;P++)(O[P].fn!==S||T&&!O[P].once||b&&O[P].context!==b)&&I.push(O[P]);I.length?this._events[A]=I.length===1?I[0]:I:h(this,A)}return this},i.prototype.removeAllListeners=function(y){var S;return y?(S=r?r+y:y,this._events[S]&&h(this,S)):(this._events=new n,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=r,i.EventEmitter=i,e.exports=i})(Que);var ttt=Que.exports;const rtt=Os(ttt);var TL=new rtt,AL="recharts.syncMouseEvents";function l2(e){"@babel/helpers - typeof";return l2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l2(e)}function ntt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function itt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ede(n.key),n)}}function stt(e,t,r){return t&&itt(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function CL(e,t,r){return t=ede(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ede(e){var t=att(e,"string");return l2(t)=="symbol"?t:t+""}function att(e,t){if(l2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(l2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var ott=function(){function e(){ntt(this,e),CL(this,"activeIndex",0),CL(this,"coordinateList",[]),CL(this,"layout","horizontal")}return stt(e,[{key:"setDetails",value:function(r){var n,s=r.coordinateList,o=s===void 0?null:s,h=r.container,i=h===void 0?null:h,m=r.layout,y=m===void 0?null:m,S=r.offset,b=S===void 0?null:S,T=r.mouseHandlerCallback,A=T===void 0?null:T;this.coordinateList=(n=o??this.coordinateList)!==null&&n!==void 0?n:[],this.container=i??this.container,this.layout=y??this.layout,this.offset=b??this.offset,this.mouseHandlerCallback=A??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(r){if(this.coordinateList.length!==0)switch(r.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(r){this.activeIndex=r}},{key:"spoofMouse",value:function(){var r,n;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var s=this.container.getBoundingClientRect(),o=s.x,h=s.y,i=s.height,m=this.coordinateList[this.activeIndex].coordinate,y=((r=window)===null||r===void 0?void 0:r.scrollX)||0,S=((n=window)===null||n===void 0?void 0:n.scrollY)||0,b=o+m+y,T=h+this.offset.top+i/2+S;this.mouseHandlerCallback({pageX:b,pageY:T})}}}])}();function ltt(e,t,r){if(r==="number"&&t===!0&&Array.isArray(e)){var n=e==null?void 0:e[0],s=e==null?void 0:e[1];if(n&&s&&Gr(n)&&Gr(s))return!0}return!1}function ctt(e,t,r,n){var s=n/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-s:r.left+.5,y:e==="horizontal"?r.top+.5:t.y-s,width:e==="horizontal"?n:r.width-1,height:e==="horizontal"?r.height-1:n}}function tde(e){var t=e.cx,r=e.cy,n=e.radius,s=e.startAngle,o=e.endAngle,h=la(t,r,n,s),i=la(t,r,n,o);return{points:[h,i],cx:t,cy:r,radius:n,startAngle:s,endAngle:o}}function utt(e,t,r){var n,s,o,h;if(e==="horizontal")n=t.x,o=n,s=r.top,h=r.top+r.height;else if(e==="vertical")s=t.y,h=s,n=r.left,o=r.left+r.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var i=t.cx,m=t.cy,y=t.innerRadius,S=t.outerRadius,b=t.angle,T=la(i,m,y,b),A=la(i,m,S,b);n=T.x,s=T.y,o=A.x,h=A.y}else return tde(t);return[{x:n,y:s},{x:o,y:h}]}function c2(e){"@babel/helpers - typeof";return c2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c2(e)}function lX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function $j(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?lX(Object(r),!0).forEach(function(n){dtt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function dtt(e,t,r){return t=htt(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function htt(e){var t=ftt(e,"string");return c2(t)=="symbol"?t:t+""}function ftt(e,t){if(c2(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(c2(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ptt(e){var t,r,n=e.element,s=e.tooltipEventType,o=e.isActive,h=e.activeCoordinate,i=e.activePayload,m=e.offset,y=e.activeTooltipIndex,S=e.tooltipAxisBandSize,b=e.layout,T=e.chartName,A=(t=n.props.cursor)!==null&&t!==void 0?t:(r=n.type.defaultProps)===null||r===void 0?void 0:r.cursor;if(!n||!A||!o||!h||T!=="ScatterChart"&&s!=="axis")return null;var O,P=ak;if(T==="ScatterChart")O=h,P=OZe;else if(T==="BarChart")O=ctt(b,h,m,S),P=Q$;else if(b==="radial"){var I=tde(h),R=I.cx,M=I.cy,F=I.radius,z=I.startAngle,$=I.endAngle;O={cx:R,cy:M,startAngle:z,endAngle:$,innerRadius:F,outerRadius:F},P=Yce}else O={points:utt(b,h,m)},P=ak;var W=$j($j($j($j({stroke:"#ccc",pointerEvents:"none"},m),O),Qn(A,!1)),{},{payload:i,payloadIndex:y,className:Ii("recharts-tooltip-cursor",A.className)});return V.isValidElement(A)?V.cloneElement(A,W):V.createElement(P,W)}var mtt=["item"],gtt=["children","className","width","height","style","compact","title","desc"];function Gb(e){"@babel/helpers - typeof";return Gb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gb(e)}function v0(){return v0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},v0.apply(this,arguments)}function cX(e,t){return _tt(e)||vtt(e,t)||nde(e,t)||ytt()}function ytt(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vtt(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,s,o,h,i=[],m=!0,y=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(m=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);m=!0);}catch(S){y=!0,s=S}finally{try{if(!m&&r.return!=null&&(h=r.return(),Object(h)!==h))return}finally{if(y)throw s}}return i}}function _tt(e){if(Array.isArray(e))return e}function uX(e,t){if(e==null)return{};var r=xtt(e,t),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function xtt(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function btt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function wtt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ide(n.key),n)}}function Stt(e,t,r){return t&&wtt(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ett(e,t,r){return t=Pk(t),Ttt(e,rde()?Reflect.construct(t,r||[],Pk(e).constructor):t.apply(e,r))}function Ttt(e,t){if(t&&(Gb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Att(e)}function Att(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rde(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(rde=function(){return!!e})()}function Pk(e){return Pk=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Pk(e)}function Ctt(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&m4(e,t)}function m4(e,t){return m4=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},m4(e,t)}function Wb(e){return Ott(e)||Ptt(e)||nde(e)||jtt()}function jtt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nde(e,t){if(e){if(typeof e=="string")return g4(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return g4(e,t)}}function Ptt(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Ott(e){if(Array.isArray(e))return g4(e)}function g4(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function dX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function vr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?dX(Object(r),!0).forEach(function(n){oi(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function oi(e,t,r){return t=ide(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ide(e){var t=ktt(e,"string");return Gb(t)=="symbol"?t:t+""}function ktt(e,t){if(Gb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Gb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Ntt={xAxis:["bottom","top"],yAxis:["left","right"]},Itt={width:"100%",height:"100%"},sde={x:0,y:0};function Uj(e){return e}var Rtt=function(t,r){return r==="horizontal"?t.x:r==="vertical"?t.y:r==="centric"?t.angle:t.radius},Mtt=function(t,r,n,s){var o=r.find(function(S){return S&&S.index===n});if(o){if(t==="horizontal")return{x:o.coordinate,y:s.y};if(t==="vertical")return{x:s.x,y:o.coordinate};if(t==="centric"){var h=o.coordinate,i=s.radius;return vr(vr(vr({},s),la(s.cx,s.cy,i,h)),{},{angle:h,radius:i})}var m=o.coordinate,y=s.angle;return vr(vr(vr({},s),la(s.cx,s.cy,m,y)),{},{angle:y,radius:m})}return sde},zI=function(t,r){var n=r.graphicalItems,s=r.dataStartIndex,o=r.dataEndIndex,h=(n??[]).reduce(function(i,m){var y=m.props.data;return y&&y.length?[].concat(Wb(i),Wb(y)):i},[]);return h.length>0?h:t&&t.length&&Gr(s)&&Gr(o)?t.slice(s,o+1):[]};function ade(e){return e==="number"?[0,"auto"]:void 0}var y4=function(t,r,n,s){var o=t.graphicalItems,h=t.tooltipAxis,i=zI(r,t);return n<0||!o||!o.length||n>=i.length?null:o.reduce(function(m,y){var S,b=(S=y.props.data)!==null&&S!==void 0?S:r;b&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=n&&(b=b.slice(t.dataStartIndex,t.dataEndIndex+1));var T;if(h.dataKey&&!h.allowDuplicatedCategory){var A=b===void 0?i:b;T=PO(A,h.dataKey,s)}else T=b&&b[n]||i[n];return T?[].concat(Wb(m),[Hce(y,T)]):m},[])},hX=function(t,r,n,s){var o=s||{x:t.chartX,y:t.chartY},h=Rtt(o,n),i=t.orderedTooltipTicks,m=t.tooltipAxis,y=t.tooltipTicks,S=eWe(h,i,y,m);if(S>=0&&y){var b=y[S]&&y[S].value,T=y4(t,r,S,b),A=Mtt(n,i,S,o);return{activeTooltipIndex:S,activeLabel:b,activePayload:T,activeCoordinate:A}}return null},Dtt=function(t,r){var n=r.axes,s=r.graphicalItems,o=r.axisType,h=r.axisIdKey,i=r.stackGroups,m=r.dataStartIndex,y=r.dataEndIndex,S=t.layout,b=t.children,T=t.stackOffset,A=zce(S,o);return n.reduce(function(O,P){var I,R=P.type.defaultProps!==void 0?vr(vr({},P.type.defaultProps),P.props):P.props,M=R.type,F=R.dataKey,z=R.allowDataOverflow,$=R.allowDuplicatedCategory,W=R.scale,K=R.ticks,ee=R.includeHidden,ne=R[h];if(O[ne])return O;var ie=zI(t.data,{graphicalItems:s.filter(function(pe){var Oe,Je=h in pe.props?pe.props[h]:(Oe=pe.type.defaultProps)===null||Oe===void 0?void 0:Oe[h];return Je===ne}),dataStartIndex:m,dataEndIndex:y}),re=ie.length,te,ae,ue;ltt(R.domain,z,M)&&(te=kz(R.domain,null,z),A&&(M==="number"||W!=="auto")&&(ue=zE(ie,F,"category")));var be=ade(M);if(!te||te.length===0){var we,Ce=(we=R.domain)!==null&&we!==void 0?we:be;if(F){if(te=zE(ie,F,M),M==="category"&&A){var _e=qLe(te);$&&_e?(ae=te,te=gk(0,re)):$||(te=RK(Ce,te,P).reduce(function(pe,Oe){return pe.indexOf(Oe)>=0?pe:[].concat(Wb(pe),[Oe])},[]))}else if(M==="category")$?te=te.filter(function(pe){return pe!==""&&!ki(pe)}):te=RK(Ce,te,P).reduce(function(pe,Oe){return pe.indexOf(Oe)>=0||Oe===""||ki(Oe)?pe:[].concat(Wb(pe),[Oe])},[]);else if(M==="number"){var me=sWe(ie,s.filter(function(pe){var Oe,Je,Ze=h in pe.props?pe.props[h]:(Oe=pe.type.defaultProps)===null||Oe===void 0?void 0:Oe[h],Pe="hide"in pe.props?pe.props.hide:(Je=pe.type.defaultProps)===null||Je===void 0?void 0:Je.hide;return Ze===ne&&(ee||!Pe)}),F,o,S);me&&(te=me)}A&&(M==="number"||W!=="auto")&&(ue=zE(ie,F,"category"))}else A?te=gk(0,re):i&&i[ne]&&i[ne].hasStack&&M==="number"?te=T==="expand"?[0,1]:qce(i[ne].stackGroups,m,y):te=Fce(ie,s.filter(function(pe){var Oe=h in pe.props?pe.props[h]:pe.type.defaultProps[h],Je="hide"in pe.props?pe.props.hide:pe.type.defaultProps.hide;return Oe===ne&&(ee||!Je)}),M,S,!0);if(M==="number")te=p4(b,te,ne,o,K),Ce&&(te=kz(Ce,te,z));else if(M==="category"&&Ce){var Ae=Ce,ge=te.every(function(pe){return Ae.indexOf(pe)>=0});ge&&(te=Ae)}}return vr(vr({},O),{},oi({},ne,vr(vr({},R),{},{axisType:o,domain:te,categoricalDomain:ue,duplicateDomain:ae,originalDomain:(I=R.domain)!==null&&I!==void 0?I:be,isCategorical:A,layout:S})))},{})},Ltt=function(t,r){var n=r.graphicalItems,s=r.Axis,o=r.axisType,h=r.axisIdKey,i=r.stackGroups,m=r.dataStartIndex,y=r.dataEndIndex,S=t.layout,b=t.children,T=zI(t.data,{graphicalItems:n,dataStartIndex:m,dataEndIndex:y}),A=T.length,O=zce(S,o),P=-1;return n.reduce(function(I,R){var M=R.type.defaultProps!==void 0?vr(vr({},R.type.defaultProps),R.props):R.props,F=M[h],z=ade("number");if(!I[F]){P++;var $;return O?$=gk(0,A):i&&i[F]&&i[F].hasStack?($=qce(i[F].stackGroups,m,y),$=p4(b,$,F,o)):($=kz(z,Fce(T,n.filter(function(W){var K,ee,ne=h in W.props?W.props[h]:(K=W.type.defaultProps)===null||K===void 0?void 0:K[h],ie="hide"in W.props?W.props.hide:(ee=W.type.defaultProps)===null||ee===void 0?void 0:ee.hide;return ne===F&&!ie}),"number",S),s.defaultProps.allowDataOverflow),$=p4(b,$,F,o)),vr(vr({},I),{},oi({},F,vr(vr({axisType:o},s.defaultProps),{},{hide:!0,orientation:bu(Ntt,"".concat(o,".").concat(P%2),null),domain:$,originalDomain:z,isCategorical:O,layout:S})))}return I},{})},Ftt=function(t,r){var n=r.axisType,s=n===void 0?"xAxis":n,o=r.AxisComp,h=r.graphicalItems,i=r.stackGroups,m=r.dataStartIndex,y=r.dataEndIndex,S=t.children,b="".concat(s,"Id"),T=wu(S,o),A={};return T&&T.length?A=Dtt(t,{axes:T,graphicalItems:h,axisType:s,axisIdKey:b,stackGroups:i,dataStartIndex:m,dataEndIndex:y}):h&&h.length&&(A=Ltt(t,{Axis:o,graphicalItems:h,axisType:s,axisIdKey:b,stackGroups:i,dataStartIndex:m,dataEndIndex:y})),A},ztt=function(t){var r=km(t),n=Kf(r,!1,!0);return{tooltipTicks:n,orderedTooltipTicks:A$(n,function(s){return s.coordinate}),tooltipAxis:r,tooltipAxisBandSize:nk(r,n)}},fX=function(t){var r=t.children,n=t.defaultShowTooltip,s=uu(r,Lb),o=0,h=0;return t.data&&t.data.length!==0&&(h=t.data.length-1),s&&s.props&&(s.props.startIndex>=0&&(o=s.props.startIndex),s.props.endIndex>=0&&(h=s.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:o,dataEndIndex:h,activeTooltipIndex:-1,isTooltipActive:!!n}},Btt=function(t){return!t||!t.length?!1:t.some(function(r){var n=Xf(r&&r.type);return n&&n.indexOf("Bar")>=0})},pX=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},$tt=function(t,r){var n=t.props,s=t.graphicalItems,o=t.xAxisMap,h=o===void 0?{}:o,i=t.yAxisMap,m=i===void 0?{}:i,y=n.width,S=n.height,b=n.children,T=n.margin||{},A=uu(b,Lb),O=uu(b,Ih),P=Object.keys(m).reduce(function($,W){var K=m[W],ee=K.orientation;return!K.mirror&&!K.hide?vr(vr({},$),{},oi({},ee,$[ee]+K.width)):$},{left:T.left||0,right:T.right||0}),I=Object.keys(h).reduce(function($,W){var K=h[W],ee=K.orientation;return!K.mirror&&!K.hide?vr(vr({},$),{},oi({},ee,bu($,"".concat(ee))+K.height)):$},{top:T.top||0,bottom:T.bottom||0}),R=vr(vr({},I),P),M=R.bottom;A&&(R.bottom+=A.props.height||Lb.defaultProps.height),O&&r&&(R=nWe(R,s,n,r));var F=y-R.left-R.right,z=S-R.top-R.bottom;return vr(vr({brushBottom:M},R),{},{width:Math.max(F,0),height:Math.max(z,0)})},Utt=function(t,r){if(r==="xAxis")return t[r].width;if(r==="yAxis")return t[r].height},cU=function(t){var r=t.chartName,n=t.GraphicalChild,s=t.defaultTooltipEventType,o=s===void 0?"axis":s,h=t.validateTooltipEventTypes,i=h===void 0?["axis"]:h,m=t.axisComponents,y=t.legendContent,S=t.formatAxisMap,b=t.defaultProps,T=function(R,M){var F=M.graphicalItems,z=M.stackGroups,$=M.offset,W=M.updateId,K=M.dataStartIndex,ee=M.dataEndIndex,ne=R.barSize,ie=R.layout,re=R.barGap,te=R.barCategoryGap,ae=R.maxBarSize,ue=pX(ie),be=ue.numericAxisName,we=ue.cateAxisName,Ce=Btt(F),_e=[];return F.forEach(function(me,Ae){var ge=zI(R.data,{graphicalItems:[me],dataStartIndex:K,dataEndIndex:ee}),pe=me.type.defaultProps!==void 0?vr(vr({},me.type.defaultProps),me.props):me.props,Oe=pe.dataKey,Je=pe.maxBarSize,Ze=pe["".concat(be,"Id")],Pe=pe["".concat(we,"Id")],Be={},nt=m.reduce(function(lt,ut){var sr=M["".concat(ut.axisType,"Map")],Qt=pe["".concat(ut.axisType,"Id")];sr&&sr[Qt]||ut.axisType==="zAxis"||$v();var er=sr[Qt];return vr(vr({},lt),{},oi(oi({},ut.axisType,er),"".concat(ut.axisType,"Ticks"),Kf(er)))},Be),Me=nt[we],We=nt["".concat(we,"Ticks")],gt=z&&z[Ze]&&z[Ze].hasStack&&pWe(me,z[Ze].stackGroups),rt=Xf(me.type).indexOf("Bar")>=0,Ht=nk(Me,We),Lt=[],nr=Ce&&tWe({barSize:ne,stackGroups:z,totalSize:Utt(nt,we)});if(rt){var Rr,Dr,Pt=ki(Je)?ae:Je,wt=(Rr=(Dr=nk(Me,We,!0))!==null&&Dr!==void 0?Dr:Pt)!==null&&Rr!==void 0?Rr:0;Lt=rWe({barGap:re,barCategoryGap:te,bandSize:wt!==Ht?wt:Ht,sizeList:nr[Pe],maxBarSize:Pt}),wt!==Ht&&(Lt=Lt.map(function(lt){return vr(vr({},lt),{},{position:vr(vr({},lt.position),{},{offset:lt.position.offset-wt/2})})}))}var He=me&&me.type&&me.type.getComposedData;He&&_e.push({props:vr(vr({},He(vr(vr({},nt),{},{displayedData:ge,props:R,dataKey:Oe,item:me,bandSize:Ht,barPosition:Lt,offset:$,stackedData:gt,layout:ie,dataStartIndex:K,dataEndIndex:ee}))),{},oi(oi(oi({key:me.key||"item-".concat(Ae)},be,nt[be]),we,nt[we]),"animationId",W)),childIndex:n3e(me,R.children),item:me})}),_e},A=function(R,M){var F=R.props,z=R.dataStartIndex,$=R.dataEndIndex,W=R.updateId;if(!CW({props:F}))return null;var K=F.children,ee=F.layout,ne=F.stackOffset,ie=F.data,re=F.reverseStackOrder,te=pX(ee),ae=te.numericAxisName,ue=te.cateAxisName,be=wu(K,n),we=hWe(ie,be,"".concat(ae,"Id"),"".concat(ue,"Id"),ne,re),Ce=m.reduce(function(pe,Oe){var Je="".concat(Oe.axisType,"Map");return vr(vr({},pe),{},oi({},Je,Ftt(F,vr(vr({},Oe),{},{graphicalItems:be,stackGroups:Oe.axisType===ae&&we,dataStartIndex:z,dataEndIndex:$}))))},{}),_e=$tt(vr(vr({},Ce),{},{props:F,graphicalItems:be}),M==null?void 0:M.legendBBox);Object.keys(Ce).forEach(function(pe){Ce[pe]=S(F,Ce[pe],_e,pe.replace("Map",""),r)});var me=Ce["".concat(ue,"Map")],Ae=ztt(me),ge=T(F,vr(vr({},Ce),{},{dataStartIndex:z,dataEndIndex:$,updateId:W,graphicalItems:be,stackGroups:we,offset:_e}));return vr(vr({formattedGraphicalItems:ge,graphicalItems:be,offset:_e,stackGroups:we},Ae),Ce)},O=function(I){function R(M){var F,z,$;return btt(this,R),$=Ett(this,R,[M]),oi($,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),oi($,"accessibilityManager",new ott),oi($,"handleLegendBBoxUpdate",function(W){if(W){var K=$.state,ee=K.dataStartIndex,ne=K.dataEndIndex,ie=K.updateId;$.setState(vr({legendBBox:W},A({props:$.props,dataStartIndex:ee,dataEndIndex:ne,updateId:ie},vr(vr({},$.state),{},{legendBBox:W}))))}}),oi($,"handleReceiveSyncEvent",function(W,K,ee){if($.props.syncId===W){if(ee===$.eventEmitterSymbol&&typeof $.props.syncMethod!="function")return;$.applySyncEvent(K)}}),oi($,"handleBrushChange",function(W){var K=W.startIndex,ee=W.endIndex;if(K!==$.state.dataStartIndex||ee!==$.state.dataEndIndex){var ne=$.state.updateId;$.setState(function(){return vr({dataStartIndex:K,dataEndIndex:ee},A({props:$.props,dataStartIndex:K,dataEndIndex:ee,updateId:ne},$.state))}),$.triggerSyncEvent({dataStartIndex:K,dataEndIndex:ee})}}),oi($,"handleMouseEnter",function(W){var K=$.getMouseInfo(W);if(K){var ee=vr(vr({},K),{},{isTooltipActive:!0});$.setState(ee),$.triggerSyncEvent(ee);var ne=$.props.onMouseEnter;vi(ne)&&ne(ee,W)}}),oi($,"triggeredAfterMouseMove",function(W){var K=$.getMouseInfo(W),ee=K?vr(vr({},K),{},{isTooltipActive:!0}):{isTooltipActive:!1};$.setState(ee),$.triggerSyncEvent(ee);var ne=$.props.onMouseMove;vi(ne)&&ne(ee,W)}),oi($,"handleItemMouseEnter",function(W){$.setState(function(){return{isTooltipActive:!0,activeItem:W,activePayload:W.tooltipPayload,activeCoordinate:W.tooltipPosition||{x:W.cx,y:W.cy}}})}),oi($,"handleItemMouseLeave",function(){$.setState(function(){return{isTooltipActive:!1}})}),oi($,"handleMouseMove",function(W){W.persist(),$.throttleTriggeredAfterMouseMove(W)}),oi($,"handleMouseLeave",function(W){$.throttleTriggeredAfterMouseMove.cancel();var K={isTooltipActive:!1};$.setState(K),$.triggerSyncEvent(K);var ee=$.props.onMouseLeave;vi(ee)&&ee(K,W)}),oi($,"handleOuterEvent",function(W){var K=r3e(W),ee=bu($.props,"".concat(K));if(K&&vi(ee)){var ne,ie;/.*touch.*/i.test(K)?ie=$.getMouseInfo(W.changedTouches[0]):ie=$.getMouseInfo(W),ee((ne=ie)!==null&&ne!==void 0?ne:{},W)}}),oi($,"handleClick",function(W){var K=$.getMouseInfo(W);if(K){var ee=vr(vr({},K),{},{isTooltipActive:!0});$.setState(ee),$.triggerSyncEvent(ee);var ne=$.props.onClick;vi(ne)&&ne(ee,W)}}),oi($,"handleMouseDown",function(W){var K=$.props.onMouseDown;if(vi(K)){var ee=$.getMouseInfo(W);K(ee,W)}}),oi($,"handleMouseUp",function(W){var K=$.props.onMouseUp;if(vi(K)){var ee=$.getMouseInfo(W);K(ee,W)}}),oi($,"handleTouchMove",function(W){W.changedTouches!=null&&W.changedTouches.length>0&&$.throttleTriggeredAfterMouseMove(W.changedTouches[0])}),oi($,"handleTouchStart",function(W){W.changedTouches!=null&&W.changedTouches.length>0&&$.handleMouseDown(W.changedTouches[0])}),oi($,"handleTouchEnd",function(W){W.changedTouches!=null&&W.changedTouches.length>0&&$.handleMouseUp(W.changedTouches[0])}),oi($,"handleDoubleClick",function(W){var K=$.props.onDoubleClick;if(vi(K)){var ee=$.getMouseInfo(W);K(ee,W)}}),oi($,"handleContextMenu",function(W){var K=$.props.onContextMenu;if(vi(K)){var ee=$.getMouseInfo(W);K(ee,W)}}),oi($,"triggerSyncEvent",function(W){$.props.syncId!==void 0&&TL.emit(AL,$.props.syncId,W,$.eventEmitterSymbol)}),oi($,"applySyncEvent",function(W){var K=$.props,ee=K.layout,ne=K.syncMethod,ie=$.state.updateId,re=W.dataStartIndex,te=W.dataEndIndex;if(W.dataStartIndex!==void 0||W.dataEndIndex!==void 0)$.setState(vr({dataStartIndex:re,dataEndIndex:te},A({props:$.props,dataStartIndex:re,dataEndIndex:te,updateId:ie},$.state)));else if(W.activeTooltipIndex!==void 0){var ae=W.chartX,ue=W.chartY,be=W.activeTooltipIndex,we=$.state,Ce=we.offset,_e=we.tooltipTicks;if(!Ce)return;if(typeof ne=="function")be=ne(_e,W);else if(ne==="value"){be=-1;for(var me=0;me<_e.length;me++)if(_e[me].value===W.activeLabel){be=me;break}}var Ae=vr(vr({},Ce),{},{x:Ce.left,y:Ce.top}),ge=Math.min(ae,Ae.x+Ae.width),pe=Math.min(ue,Ae.y+Ae.height),Oe=_e[be]&&_e[be].value,Je=y4($.state,$.props.data,be),Ze=_e[be]?{x:ee==="horizontal"?_e[be].coordinate:ge,y:ee==="horizontal"?pe:_e[be].coordinate}:sde;$.setState(vr(vr({},W),{},{activeLabel:Oe,activeCoordinate:Ze,activePayload:Je,activeTooltipIndex:be}))}else $.setState(W)}),oi($,"renderCursor",function(W){var K,ee=$.state,ne=ee.isTooltipActive,ie=ee.activeCoordinate,re=ee.activePayload,te=ee.offset,ae=ee.activeTooltipIndex,ue=ee.tooltipAxisBandSize,be=$.getTooltipEventType(),we=(K=W.props.active)!==null&&K!==void 0?K:ne,Ce=$.props.layout,_e=W.key||"_recharts-cursor";return Ue.createElement(ptt,{key:_e,activeCoordinate:ie,activePayload:re,activeTooltipIndex:ae,chartName:r,element:W,isActive:we,layout:Ce,offset:te,tooltipAxisBandSize:ue,tooltipEventType:be})}),oi($,"renderPolarAxis",function(W,K,ee){var ne=bu(W,"type.axisType"),ie=bu($.state,"".concat(ne,"Map")),re=W.type.defaultProps,te=re!==void 0?vr(vr({},re),W.props):W.props,ae=ie&&ie[te["".concat(ne,"Id")]];return V.cloneElement(W,vr(vr({},ae),{},{className:Ii(ne,ae.className),key:W.key||"".concat(K,"-").concat(ee),ticks:Kf(ae,!0)}))}),oi($,"renderPolarGrid",function(W){var K=W.props,ee=K.radialLines,ne=K.polarAngles,ie=K.polarRadius,re=$.state,te=re.radiusAxisMap,ae=re.angleAxisMap,ue=km(te),be=km(ae),we=be.cx,Ce=be.cy,_e=be.innerRadius,me=be.outerRadius;return V.cloneElement(W,{polarAngles:Array.isArray(ne)?ne:Kf(be,!0).map(function(Ae){return Ae.coordinate}),polarRadius:Array.isArray(ie)?ie:Kf(ue,!0).map(function(Ae){return Ae.coordinate}),cx:we,cy:Ce,innerRadius:_e,outerRadius:me,key:W.key||"polar-grid",radialLines:ee})}),oi($,"renderLegend",function(){var W=$.state.formattedGraphicalItems,K=$.props,ee=K.children,ne=K.width,ie=K.height,re=$.props.margin||{},te=ne-(re.left||0)-(re.right||0),ae=Dce({children:ee,formattedGraphicalItems:W,legendWidth:te,legendContent:y});if(!ae)return null;var ue=ae.item,be=uX(ae,mtt);return V.cloneElement(ue,vr(vr({},be),{},{chartWidth:ne,chartHeight:ie,margin:re,onBBoxUpdate:$.handleLegendBBoxUpdate}))}),oi($,"renderTooltip",function(){var W,K=$.props,ee=K.children,ne=K.accessibilityLayer,ie=uu(ee,Sl);if(!ie)return null;var re=$.state,te=re.isTooltipActive,ae=re.activeCoordinate,ue=re.activePayload,be=re.activeLabel,we=re.offset,Ce=(W=ie.props.active)!==null&&W!==void 0?W:te;return V.cloneElement(ie,{viewBox:vr(vr({},we),{},{x:we.left,y:we.top}),active:Ce,label:be,payload:Ce?ue:[],coordinate:ae,accessibilityLayer:ne})}),oi($,"renderBrush",function(W){var K=$.props,ee=K.margin,ne=K.data,ie=$.state,re=ie.offset,te=ie.dataStartIndex,ae=ie.dataEndIndex,ue=ie.updateId;return V.cloneElement(W,{key:W.key||"_recharts-brush",onChange:Lj($.handleBrushChange,W.props.onChange),data:ne,x:Gr(W.props.x)?W.props.x:re.left,y:Gr(W.props.y)?W.props.y:re.top+re.height+re.brushBottom-(ee.bottom||0),width:Gr(W.props.width)?W.props.width:re.width,startIndex:te,endIndex:ae,updateId:"brush-".concat(ue)})}),oi($,"renderReferenceElement",function(W,K,ee){if(!W)return null;var ne=$,ie=ne.clipPathId,re=$.state,te=re.xAxisMap,ae=re.yAxisMap,ue=re.offset,be=W.type.defaultProps||{},we=W.props,Ce=we.xAxisId,_e=Ce===void 0?be.xAxisId:Ce,me=we.yAxisId,Ae=me===void 0?be.yAxisId:me;return V.cloneElement(W,{key:W.key||"".concat(K,"-").concat(ee),xAxis:te[_e],yAxis:ae[Ae],viewBox:{x:ue.left,y:ue.top,width:ue.width,height:ue.height},clipPathId:ie})}),oi($,"renderActivePoints",function(W){var K=W.item,ee=W.activePoint,ne=W.basePoint,ie=W.childIndex,re=W.isRange,te=[],ae=K.props.key,ue=K.item.type.defaultProps!==void 0?vr(vr({},K.item.type.defaultProps),K.item.props):K.item.props,be=ue.activeDot,we=ue.dataKey,Ce=vr(vr({index:ie,dataKey:we,cx:ee.x,cy:ee.y,r:4,fill:J$(K.item),strokeWidth:2,stroke:"#fff",payload:ee.payload,value:ee.value},Qn(be,!1)),OO(be));return te.push(R.renderActiveDot(be,Ce,"".concat(ae,"-activePoint-").concat(ie))),ne?te.push(R.renderActiveDot(be,vr(vr({},Ce),{},{cx:ne.x,cy:ne.y}),"".concat(ae,"-basePoint-").concat(ie))):re&&te.push(null),te}),oi($,"renderGraphicChild",function(W,K,ee){var ne=$.filterFormatItem(W,K,ee);if(!ne)return null;var ie=$.getTooltipEventType(),re=$.state,te=re.isTooltipActive,ae=re.tooltipAxis,ue=re.activeTooltipIndex,be=re.activeLabel,we=$.props.children,Ce=uu(we,Sl),_e=ne.props,me=_e.points,Ae=_e.isRange,ge=_e.baseLine,pe=ne.item.type.defaultProps!==void 0?vr(vr({},ne.item.type.defaultProps),ne.item.props):ne.item.props,Oe=pe.activeDot,Je=pe.hide,Ze=pe.activeBar,Pe=pe.activeShape,Be=!!(!Je&&te&&Ce&&(Oe||Ze||Pe)),nt={};ie!=="axis"&&Ce&&Ce.props.trigger==="click"?nt={onClick:Lj($.handleItemMouseEnter,W.props.onClick)}:ie!=="axis"&&(nt={onMouseLeave:Lj($.handleItemMouseLeave,W.props.onMouseLeave),onMouseEnter:Lj($.handleItemMouseEnter,W.props.onMouseEnter)});var Me=V.cloneElement(W,vr(vr({},ne.props),nt));function We(ut){return typeof ae.dataKey=="function"?ae.dataKey(ut.payload):null}if(Be)if(ue>=0){var gt,rt;if(ae.dataKey&&!ae.allowDuplicatedCategory){var Ht=typeof ae.dataKey=="function"?We:"payload.".concat(ae.dataKey.toString());gt=PO(me,Ht,be),rt=Ae&&ge&&PO(ge,Ht,be)}else gt=me==null?void 0:me[ue],rt=Ae&&ge&&ge[ue];if(Pe||Ze){var Lt=W.props.activeIndex!==void 0?W.props.activeIndex:ue;return[V.cloneElement(W,vr(vr(vr({},ne.props),nt),{},{activeIndex:Lt})),null,null]}if(!ki(gt))return[Me].concat(Wb($.renderActivePoints({item:ne,activePoint:gt,basePoint:rt,childIndex:ue,isRange:Ae})))}else{var nr,Rr=(nr=$.getItemByXY($.state.activeCoordinate))!==null&&nr!==void 0?nr:{graphicalItem:Me},Dr=Rr.graphicalItem,Pt=Dr.item,wt=Pt===void 0?W:Pt,He=Dr.childIndex,lt=vr(vr(vr({},ne.props),nt),{},{activeIndex:He});return[V.cloneElement(wt,lt),null,null]}return Ae?[Me,null,null]:[Me,null]}),oi($,"renderCustomized",function(W,K,ee){return V.cloneElement(W,vr(vr({key:"recharts-customized-".concat(ee)},$.props),$.state))}),oi($,"renderMap",{CartesianGrid:{handler:Uj,once:!0},ReferenceArea:{handler:$.renderReferenceElement},ReferenceLine:{handler:Uj},ReferenceDot:{handler:$.renderReferenceElement},XAxis:{handler:Uj},YAxis:{handler:Uj},Brush:{handler:$.renderBrush,once:!0},Bar:{handler:$.renderGraphicChild},Line:{handler:$.renderGraphicChild},Area:{handler:$.renderGraphicChild},Radar:{handler:$.renderGraphicChild},RadialBar:{handler:$.renderGraphicChild},Scatter:{handler:$.renderGraphicChild},Pie:{handler:$.renderGraphicChild},Funnel:{handler:$.renderGraphicChild},Tooltip:{handler:$.renderCursor,once:!0},PolarGrid:{handler:$.renderPolarGrid,once:!0},PolarAngleAxis:{handler:$.renderPolarAxis},PolarRadiusAxis:{handler:$.renderPolarAxis},Customized:{handler:$.renderCustomized}}),$.clipPathId="".concat((F=M.id)!==null&&F!==void 0?F:yw("recharts"),"-clip"),$.throttleTriggeredAfterMouseMove=Rle($.triggeredAfterMouseMove,(z=M.throttleDelay)!==null&&z!==void 0?z:1e3/60),$.state={},$}return Ctt(R,I),Stt(R,[{key:"componentDidMount",value:function(){var F,z;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(F=this.props.margin.left)!==null&&F!==void 0?F:0,top:(z=this.props.margin.top)!==null&&z!==void 0?z:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var F=this.props,z=F.children,$=F.data,W=F.height,K=F.layout,ee=uu(z,Sl);if(ee){var ne=ee.props.defaultIndex;if(!(typeof ne!="number"||ne<0||ne>this.state.tooltipTicks.length-1)){var ie=this.state.tooltipTicks[ne]&&this.state.tooltipTicks[ne].value,re=y4(this.state,$,ne,ie),te=this.state.tooltipTicks[ne].coordinate,ae=(this.state.offset.top+W)/2,ue=K==="horizontal",be=ue?{x:te,y:ae}:{y:te,x:ae},we=this.state.formattedGraphicalItems.find(function(_e){var me=_e.item;return me.type.name==="Scatter"});we&&(be=vr(vr({},be),we.props.points[ne].tooltipPosition),re=we.props.points[ne].tooltipPayload);var Ce={activeTooltipIndex:ne,isTooltipActive:!0,activeLabel:ie,activePayload:re,activeCoordinate:be};this.setState(Ce),this.renderCursor(ee),this.accessibilityManager.setIndex(ne)}}}},{key:"getSnapshotBeforeUpdate",value:function(F,z){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==z.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==F.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==F.margin){var $,W;this.accessibilityManager.setDetails({offset:{left:($=this.props.margin.left)!==null&&$!==void 0?$:0,top:(W=this.props.margin.top)!==null&&W!==void 0?W:0}})}return null}},{key:"componentDidUpdate",value:function(F){GF([uu(F.children,Sl)],[uu(this.props.children,Sl)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var F=uu(this.props.children,Sl);if(F&&typeof F.props.shared=="boolean"){var z=F.props.shared?"axis":"item";return i.indexOf(z)>=0?z:o}return o}},{key:"getMouseInfo",value:function(F){if(!this.container)return null;var z=this.container,$=z.getBoundingClientRect(),W=P8e($),K={chartX:Math.round(F.pageX-W.left),chartY:Math.round(F.pageY-W.top)},ee=$.width/z.offsetWidth||1,ne=this.inRange(K.chartX,K.chartY,ee);if(!ne)return null;var ie=this.state,re=ie.xAxisMap,te=ie.yAxisMap,ae=this.getTooltipEventType(),ue=hX(this.state,this.props.data,this.props.layout,ne);if(ae!=="axis"&&re&&te){var be=km(re).scale,we=km(te).scale,Ce=be&&be.invert?be.invert(K.chartX):null,_e=we&&we.invert?we.invert(K.chartY):null;return vr(vr({},K),{},{xValue:Ce,yValue:_e},ue)}return ue?vr(vr({},K),ue):null}},{key:"inRange",value:function(F,z){var $=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,W=this.props.layout,K=F/$,ee=z/$;if(W==="horizontal"||W==="vertical"){var ne=this.state.offset,ie=K>=ne.left&&K<=ne.left+ne.width&&ee>=ne.top&&ee<=ne.top+ne.height;return ie?{x:K,y:ee}:null}var re=this.state,te=re.angleAxisMap,ae=re.radiusAxisMap;if(te&&ae){var ue=km(te);return LK({x:K,y:ee},ue)}return null}},{key:"parseEventsOfWrapper",value:function(){var F=this.props.children,z=this.getTooltipEventType(),$=uu(F,Sl),W={};$&&z==="axis"&&($.props.trigger==="click"?W={onClick:this.handleClick}:W={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var K=OO(this.props,this.handleOuterEvent);return vr(vr({},K),W)}},{key:"addListener",value:function(){TL.on(AL,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){TL.removeListener(AL,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(F,z,$){for(var W=this.state.formattedGraphicalItems,K=0,ee=W.length;K<ee;K++){var ne=W[K];if(ne.item===F||ne.props.key===F.key||z===Xf(ne.item.type)&&$===ne.childIndex)return ne}return null}},{key:"renderClipPath",value:function(){var F=this.clipPathId,z=this.state.offset,$=z.left,W=z.top,K=z.height,ee=z.width;return Ue.createElement("defs",null,Ue.createElement("clipPath",{id:F},Ue.createElement("rect",{x:$,y:W,height:K,width:ee})))}},{key:"getXScales",value:function(){var F=this.state.xAxisMap;return F?Object.entries(F).reduce(function(z,$){var W=cX($,2),K=W[0],ee=W[1];return vr(vr({},z),{},oi({},K,ee.scale))},{}):null}},{key:"getYScales",value:function(){var F=this.state.yAxisMap;return F?Object.entries(F).reduce(function(z,$){var W=cX($,2),K=W[0],ee=W[1];return vr(vr({},z),{},oi({},K,ee.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(F){var z;return(z=this.state.xAxisMap)===null||z===void 0||(z=z[F])===null||z===void 0?void 0:z.scale}},{key:"getYScaleByAxisId",value:function(F){var z;return(z=this.state.yAxisMap)===null||z===void 0||(z=z[F])===null||z===void 0?void 0:z.scale}},{key:"getItemByXY",value:function(F){var z=this.state,$=z.formattedGraphicalItems,W=z.activeItem;if($&&$.length)for(var K=0,ee=$.length;K<ee;K++){var ne=$[K],ie=ne.props,re=ne.item,te=re.type.defaultProps!==void 0?vr(vr({},re.type.defaultProps),re.props):re.props,ae=Xf(re.type);if(ae==="Bar"){var ue=(ie.data||[]).find(function(_e){return uZe(F,_e)});if(ue)return{graphicalItem:ne,payload:ue}}else if(ae==="RadialBar"){var be=(ie.data||[]).find(function(_e){return LK(F,_e)});if(be)return{graphicalItem:ne,payload:be}}else if(NI(ne,W)||II(ne,W)||n2(ne,W)){var we=JXe({graphicalItem:ne,activeTooltipItem:W,itemData:te.data}),Ce=te.activeIndex===void 0?we:te.activeIndex;return{graphicalItem:vr(vr({},ne),{},{childIndex:Ce}),payload:n2(ne,W)?te.data[we]:ne.props.data[we]}}}return null}},{key:"render",value:function(){var F=this;if(!CW(this))return null;var z=this.props,$=z.children,W=z.className,K=z.width,ee=z.height,ne=z.style,ie=z.compact,re=z.title,te=z.desc,ae=uX(z,gtt),ue=Qn(ae,!1);if(ie)return Ue.createElement(HZ,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Ue.createElement(KF,v0({},ue,{width:K,height:ee,title:re,desc:te}),this.renderClipPath(),PW($,this.renderMap)));if(this.props.accessibilityLayer){var be,we;ue.tabIndex=(be=this.props.tabIndex)!==null&&be!==void 0?be:0,ue.role=(we=this.props.role)!==null&&we!==void 0?we:"application",ue.onKeyDown=function(_e){F.accessibilityManager.keyboardEvent(_e)},ue.onFocus=function(){F.accessibilityManager.focus()}}var Ce=this.parseEventsOfWrapper();return Ue.createElement(HZ,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Ue.createElement("div",v0({className:Ii("recharts-wrapper",W),style:vr({position:"relative",cursor:"default",width:K,height:ee},ne)},Ce,{ref:function(me){F.container=me}}),Ue.createElement(KF,v0({},ue,{width:K,height:ee,title:re,desc:te,style:Itt}),this.renderClipPath(),PW($,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(V.Component);oi(O,"displayName",r),oi(O,"defaultProps",vr({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},b)),oi(O,"getDerivedStateFromProps",function(I,R){var M=I.dataKey,F=I.data,z=I.children,$=I.width,W=I.height,K=I.layout,ee=I.stackOffset,ne=I.margin,ie=R.dataStartIndex,re=R.dataEndIndex;if(R.updateId===void 0){var te=fX(I);return vr(vr(vr({},te),{},{updateId:0},A(vr(vr({props:I},te),{},{updateId:0}),R)),{},{prevDataKey:M,prevData:F,prevWidth:$,prevHeight:W,prevLayout:K,prevStackOffset:ee,prevMargin:ne,prevChildren:z})}if(M!==R.prevDataKey||F!==R.prevData||$!==R.prevWidth||W!==R.prevHeight||K!==R.prevLayout||ee!==R.prevStackOffset||!R0(ne,R.prevMargin)){var ae=fX(I),ue={chartX:R.chartX,chartY:R.chartY,isTooltipActive:R.isTooltipActive},be=vr(vr({},hX(R,F,K)),{},{updateId:R.updateId+1}),we=vr(vr(vr({},ae),ue),be);return vr(vr(vr({},we),A(vr({props:I},we),R)),{},{prevDataKey:M,prevData:F,prevWidth:$,prevHeight:W,prevLayout:K,prevStackOffset:ee,prevMargin:ne,prevChildren:z})}if(!GF(z,R.prevChildren)){var Ce,_e,me,Ae,ge=uu(z,Lb),pe=ge&&(Ce=(_e=ge.props)===null||_e===void 0?void 0:_e.startIndex)!==null&&Ce!==void 0?Ce:ie,Oe=ge&&(me=(Ae=ge.props)===null||Ae===void 0?void 0:Ae.endIndex)!==null&&me!==void 0?me:re,Je=pe!==ie||Oe!==re,Ze=!ki(F),Pe=Ze&&!Je?R.updateId:R.updateId+1;return vr(vr({updateId:Pe},A(vr(vr({props:I},R),{},{updateId:Pe,dataStartIndex:pe,dataEndIndex:Oe}),R)),{},{prevChildren:z,dataStartIndex:pe,dataEndIndex:Oe})}return null}),oi(O,"renderActiveDot",function(I,R,M){var F;return V.isValidElement(I)?F=V.cloneElement(I,R):vi(I)?F=I(R):F=Ue.createElement(CI,R),Ue.createElement(js,{className:"recharts-active-dot",key:M},F)});var P=V.forwardRef(function(R,M){return Ue.createElement(O,v0({},R,{ref:M}))});return P.displayName=O.displayName,P},ode=cU({chartName:"LineChart",GraphicalChild:Tw,axisComponents:[{axisType:"xAxis",AxisComp:Mh},{axisType:"yAxis",AxisComp:Dh}],formatAxisMap:Tue}),gP=cU({chartName:"BarChart",GraphicalChild:qu,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:Mh},{axisType:"yAxis",AxisComp:Dh}],formatAxisMap:Tue}),mX=cU({chartName:"PieChart",GraphicalChild:Zh,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:kI},{axisType:"radiusAxis",AxisComp:PI}],formatAxisMap:EWe,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const Vtt=()=>{const{t:e}=ci(),{isSupervisor:t}=_c(),{data:r,isLoading:n}=kIe(),{data:s}=NIe(),{data:o}=MIe(),{data:h}=IIe(),{data:i}=RIe();return n?d.jsx(xo,{children:d.jsx("div",{className:"text-center",children:e("common.loading")})}):d.jsx(xo,{children:d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold mb-2",children:e("admin.dashboard")}),d.jsx("p",{className:"text-muted-foreground",children:e("admin.dashboardDescription")})]}),d.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[d.jsxs(Nr,{children:[d.jsxs(Rn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[d.jsx($n,{className:"text-sm font-medium",children:t?"":e("admin.totalUsers")}),d.jsx(Bc,{className:"h-4 w-4 text-muted-foreground"})]}),d.jsxs(Mr,{children:[d.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.totalUsers)||0}),d.jsx("p",{className:"text-xs text-muted-foreground",children:t?"":e("admin.registeredUsers")})]})]}),d.jsxs(Nr,{children:[d.jsxs(Rn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[d.jsx($n,{className:"text-sm font-medium",children:t?"":e("admin.totalRestaurants")}),d.jsx(Io,{className:"h-4 w-4 text-muted-foreground"})]}),d.jsxs(Mr,{children:[d.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.totalRestaurants)||0}),d.jsx("p",{className:"text-xs text-muted-foreground",children:t?"":e("admin.listedRestaurants")})]})]}),!t&&d.jsxs(Nr,{children:[d.jsxs(Rn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[d.jsx($n,{className:"text-sm font-medium",children:e("admin.totalActivities")}),d.jsx(yo,{className:"h-4 w-4 text-muted-foreground"})]}),d.jsxs(Mr,{children:[d.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.totalActivities)||0}),d.jsx("p",{className:"text-xs text-muted-foreground",children:e("admin.activeEvents")})]})]}),d.jsxs(Nr,{children:[d.jsxs(Rn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[d.jsx($n,{className:"text-sm font-medium",children:t?"":e("admin.totalComments")}),d.jsx(GP,{className:"h-4 w-4 text-muted-foreground"})]}),d.jsxs(Mr,{children:[d.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.totalComments)||0}),d.jsx("p",{className:"text-xs text-muted-foreground",children:t?"":e("admin.userReviews")})]})]})]}),d.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[d.jsxs(Nr,{children:[d.jsxs(Rn,{children:[d.jsxs($n,{className:"flex items-center gap-2",children:[d.jsx(IQ,{className:"h-5 w-5"}),""]}),d.jsx(as,{children:t?"":"Top 5 "})]}),d.jsx(Mr,{children:h&&h.length>0?d.jsx(Hm,{width:"100%",height:300,children:d.jsxs(ode,{data:h,children:[d.jsx(tv,{strokeDasharray:"3 3"}),d.jsx(Mh,{dataKey:"month"}),d.jsx(Dh,{domain:[0,5]}),d.jsx(Sl,{}),d.jsx(Ih,{}),Object.keys(h[0]).filter(m=>m!=="month").map((m,y)=>d.jsx(Tw,{type:"monotone",dataKey:m,stroke:`hsl(${y*360/5}, 70%, 50%)`,strokeWidth:2},m))]})}):d.jsx("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:""})})]}),d.jsxs(Nr,{children:[d.jsxs(Rn,{children:[d.jsxs($n,{className:"flex items-center gap-2",children:[d.jsx(__e,{className:"h-5 w-5"}),""]}),d.jsx(as,{children:t?"":"Top 5 "})]}),d.jsx(Mr,{children:i&&i.length>0?d.jsx(Hm,{width:"100%",height:300,children:d.jsxs(gP,{data:i,children:[d.jsx(tv,{strokeDasharray:"3 3"}),d.jsx(Mh,{dataKey:"month"}),d.jsx(Dh,{}),d.jsx(Sl,{}),d.jsx(Ih,{}),Object.keys(i[0]).filter(m=>m!=="month").map((m,y)=>d.jsx(qu,{dataKey:m,fill:`hsl(${y*360/5}, 70%, 50%)`},m))]})}):d.jsx("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:""})})]}),!t&&o&&o.length>0&&d.jsxs(Nr,{children:[d.jsxs(Rn,{children:[d.jsxs($n,{className:"flex items-center gap-2",children:[d.jsx(kE,{className:"h-5 w-5"}),e("admin.activityEngagement")]}),d.jsx(as,{children:e("admin.activityEngagementDescription")})]}),d.jsx(Mr,{children:d.jsx(Hm,{width:"100%",height:300,children:d.jsxs(gP,{data:o,children:[d.jsx(tv,{strokeDasharray:"3 3"}),d.jsx(Mh,{dataKey:"name",angle:-45,textAnchor:"end",height:100}),d.jsx(Dh,{}),d.jsx(Sl,{}),d.jsx(Ih,{}),d.jsx(qu,{dataKey:"subscribers",name:e("admin.subscribers"),fill:"hsl(var(--primary))"}),d.jsx(qu,{dataKey:"comments",name:e("admin.comments"),fill:"hsl(var(--accent))"})]})})})]})]}),d.jsxs(Nr,{children:[d.jsxs(Rn,{children:[d.jsxs($n,{className:"flex items-center gap-2",children:[d.jsx(Al,{className:"h-5 w-5"}),t?"":e("admin.topRestaurants")]}),d.jsx(as,{children:t?"":e("admin.topRestaurantsDescription")})]}),d.jsx(Mr,{children:s&&s.length>0?d.jsx(Hm,{width:"100%",height:400,children:d.jsxs(gP,{data:s,layout:"horizontal",children:[d.jsx(tv,{strokeDasharray:"3 3"}),d.jsx(Mh,{type:"number"}),d.jsx(Dh,{dataKey:"name",type:"category",width:150}),d.jsx(Sl,{}),d.jsx(Ih,{}),d.jsx(qu,{dataKey:"rating",name:e("admin.rating"),fill:"hsl(var(--primary))"}),d.jsx(qu,{dataKey:"comments",name:e("admin.comments"),fill:"hsl(var(--accent))"})]})}):d.jsx("div",{className:"h-[400px] flex items-center justify-center text-muted-foreground",children:t?"":e("admin.noData")})})]})]})})},qtt=({trigger:e})=>{const{t}=ci(),{toast:r}=Ri(),n=Mi(),{isSupervisor:s}=_c(),[o,h]=V.useState(!1),[i,m]=V.useState(!1),[y,S]=V.useState({email:"",password:"",displayName:"",phone:"",role:"merchant"}),b=async T=>{T.preventDefault(),m(!0);try{const{data:{session:A}}=await Ct.auth.getSession(),O=await fetch("https://tzdgqhwyzsxkxnncgzap.supabase.co/functions/v1/admin-create-user",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${A==null?void 0:A.access_token}`},body:JSON.stringify({email:y.email,password:y.password,displayName:y.displayName,phone:y.phone,role:y.role})}),P=await O.json();if(!O.ok)throw new Error(P.error||"Failed to create user");r({title:t("common.success"),description:t("admin.userCreated")}),h(!1),S({email:"",password:"",displayName:"",phone:"",role:"merchant"}),n.invalidateQueries({queryKey:["admin-users"]})}catch(A){console.error("Error creating user:",A),r({title:t("common.error"),description:A.message||t("admin.createUserError"),variant:"destructive"})}finally{m(!1)}};return d.jsxs(fl,{open:o,onOpenChange:h,children:[d.jsx(tf,{asChild:!0,children:e||d.jsxs(Mt,{children:[d.jsx(kE,{className:"mr-2 h-4 w-4"}),t("admin.createUser")]})}),d.jsx(Jo,{className:"max-w-[90vw] sm:max-w-[500px]",children:d.jsxs("form",{onSubmit:b,children:[d.jsxs(Qo,{children:[d.jsx(el,{children:t("admin.createNewUser")}),d.jsx(Ul,{children:t("admin.createUserDescription")})]}),d.jsxs("div",{className:"grid gap-4 py-4",children:[d.jsxs("div",{className:"grid gap-2",children:[d.jsx(yr,{htmlFor:"email",children:t("auth.email")}),d.jsx(cr,{id:"email",type:"email",required:!0,value:y.email,onChange:T=>S({...y,email:T.target.value}),placeholder:"user@example.com"})]}),d.jsxs("div",{className:"grid gap-2",children:[d.jsx(yr,{htmlFor:"password",children:t("auth.password")}),d.jsx(cr,{id:"password",type:"password",required:!0,value:y.password,onChange:T=>S({...y,password:T.target.value}),placeholder:"",minLength:6})]}),d.jsxs("div",{className:"grid gap-2",children:[d.jsx(yr,{htmlFor:"displayName",children:t("profile.displayName")}),d.jsx(cr,{id:"displayName",required:!0,value:y.displayName,onChange:T=>S({...y,displayName:T.target.value}),placeholder:t("profile.displayName")})]}),d.jsxs("div",{className:"grid gap-2",children:[d.jsx(yr,{htmlFor:"phone",children:t("profile.phone")}),d.jsx(cr,{id:"phone",type:"tel",value:y.phone,onChange:T=>S({...y,phone:T.target.value}),placeholder:"+351 XXX XXX XXX"})]}),d.jsxs("div",{className:"grid gap-2",children:[d.jsx(yr,{htmlFor:"role",children:t("admin.role")}),s?d.jsx(cr,{id:"role",value:t("admin.merchant"),disabled:!0,className:"bg-muted"}):d.jsxs(Qs,{value:y.role,onValueChange:T=>S({...y,role:T}),children:[d.jsx(Gs,{children:d.jsx(ea,{})}),d.jsxs(Ws,{children:[d.jsx(nn,{value:"merchant",children:t("admin.merchant")}),d.jsx(nn,{value:"supervisor",children:t("admin.supervisor")})]})]})]})]}),d.jsxs(Qv,{children:[d.jsx(Mt,{type:"button",variant:"outline",onClick:()=>h(!1),disabled:i,children:t("common.cancel")}),d.jsxs(Mt,{type:"submit",disabled:i,children:[i&&d.jsx(_a,{className:"mr-2 h-4 w-4 animate-spin"}),t("admin.create")]})]})]})})]})},Htt=({open:e,onOpenChange:t,merchantId:r,merchantName:n,userRole:s})=>{const{t:o}=ci(),{toast:h}=Ri(),i=Mi(),{localizeRestaurant:m}=xc(),{user:y}=Kn(),{isSupervisor:S}=_c(),[b,T]=V.useState([]),[A,O]=V.useState(""),{data:P}=ei({queryKey:["supervisorRestaurants",y==null?void 0:y.id],queryFn:async()=>{if(!y||!S)return null;const{data:ne,error:ie}=await Ct.from("merchant_restaurants").select("restaurant_id").eq("user_id",y.id);if(ie)throw ie;return(ne==null?void 0:ne.map(re=>re.restaurant_id))||[]},enabled:e&&S&&!!y}),{data:I,isLoading:R}=ei({queryKey:["allRestaurants",P],queryFn:async()=>{let ne=Ct.from("restaurants").select("*").order("name");S&&P&&P.length>0&&(ne=ne.in("id",P));const{data:ie,error:re}=await ne;if(re)throw re;return ie},enabled:!S||S&&P!==void 0}),{data:M,isLoading:F}=ei({queryKey:["merchantRestaurants",r],queryFn:async()=>{const{data:ne,error:ie}=await Ct.from("merchant_restaurants").select("restaurant_id").eq("user_id",r);if(ie)throw ie;return(ne==null?void 0:ne.map(re=>re.restaurant_id))||[]},enabled:e});V.useEffect(()=>{M&&T(M)},[M]);const z=Gi({mutationFn:async()=>{const{error:ne}=await Ct.from("merchant_restaurants").delete().eq("user_id",r);if(ne)throw ne;if(b.length>0){const{error:ie}=await Ct.from("merchant_restaurants").insert(b.map(re=>({user_id:r,restaurant_id:re})));if(ie)throw ie}},onSuccess:()=>{h({title:o("toast.merchantRestaurantsSaved"),description:o("toast.merchantRestaurantsDescription")}),i.invalidateQueries({queryKey:["merchantRestaurants"]}),i.invalidateQueries({queryKey:["adminUsers"]}),t(!1)},onError:ne=>{console.error("Error saving merchant restaurants:",ne),h({title:o("toast.merchantRestaurantsSaveFailed"),description:o("toast.merchantRestaurantsDescriptionFailed"),variant:"destructive"})}}),$=ne=>{T(s==="merchant"?[ne]:ie=>ie.includes(ne)?ie.filter(re=>re!==ne):[...ie,ne])},W=()=>{z.mutate()},K=R||F,ee=I==null?void 0:I.filter(ne=>A.trim()?m(ne).name.toLowerCase().includes(A.toLowerCase())||ne.address.toLowerCase().includes(A.toLowerCase()):!0);return d.jsx(fl,{open:e,onOpenChange:t,children:d.jsxs(Jo,{className:"max-w-2xl max-h-[80vh]",children:[d.jsxs(Qo,{children:[d.jsxs(el,{className:"flex items-center gap-2",children:[d.jsx(Io,{className:"w-5 h-5"}),o(s==="merchant"?"merchant.manageRestaurants":"merchant.manageSupervisorRestaurants")]}),d.jsxs(Ul,{children:[o("merchant.assignRestaurantsTo",{name:n}),s==="merchant"&&d.jsx("span",{className:"block mt-1 text-amber-600 dark:text-amber-500 font-medium",children:o("merchant.merchantOnlyOne")}),d.jsx("span",{className:"block mt-1 text-muted-foreground text-xs",children:o("merchant.saveReminder")})]})]}),K?d.jsx("div",{className:"flex justify-center py-8",children:d.jsx(_a,{className:"w-6 h-6 animate-spin text-primary"})}):d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"relative mb-4",children:[d.jsx(Xh,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),d.jsx(cr,{placeholder:o("merchant.searchRestaurants"),value:A,onChange:ne=>O(ne.target.value),className:"pl-9"})]}),d.jsx(jv,{className:"h-[400px] pr-4",children:d.jsx("div",{className:"space-y-3",children:ee==null?void 0:ee.map(ne=>{const ie=b.includes(ne.id),re=m(ne);return d.jsxs("div",{className:"flex items-start space-x-3 p-4 rounded-lg border hover:bg-accent/50 transition-all cursor-pointer",onClick:()=>$(ne.id),children:[s==="supervisor"?d.jsx(Yo,{checked:ie,className:"mt-1"}):d.jsx("input",{type:"radio",checked:ie,onChange:()=>{},className:"mt-1 h-4 w-4 text-primary focus:ring-primary"}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[d.jsx("p",{className:"text-sm font-medium leading-none",children:re.name}),ie&&d.jsx(sn,{variant:"secondary",className:"text-xs",children:o("merchant.selected")})]}),d.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[d.jsx(Pa,{className:"w-3 h-3"}),d.jsx("span",{className:"line-clamp-1",children:ne.address})]}),ne.type&&ne.type.length>0&&d.jsx("div",{className:"flex gap-1 mt-2",children:ne.type.slice(0,2).map((te,ae)=>d.jsx(sn,{variant:"outline",className:"text-xs",children:te},ae))})]})]},ne.id)})})}),d.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[d.jsx("div",{className:"text-sm text-muted-foreground",children:s==="merchant"?o("merchant.selectedCountOne",{count:b.length}):o("merchant.selectedCountMulti",{count:b.length})}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx(Mt,{variant:"outline",onClick:()=>t(!1),disabled:z.isPending,children:o("common.cancel")}),d.jsxs(Mt,{onClick:W,disabled:z.isPending,children:[z.isPending&&d.jsx(_a,{className:"w-4 h-4 mr-2 animate-spin"}),o("common.save")]})]})]})]})]})})},Gtt=({merchantId:e,merchantName:t,trigger:r})=>{ci();const{toast:n}=Ri(),s=Mi(),[o,h]=V.useState(!1),[i,m]=V.useState(""),{data:y=[],isLoading:S}=ei({queryKey:["supervisors"],queryFn:async()=>{const{data:R,error:M}=await Ct.from("user_roles").select("user_id").eq("role","supervisor");if(M)throw M;const F=R.map(W=>W.user_id);if(F.length===0)return[];const{data:z,error:$}=await Ct.from("profiles").select("id, display_name").in("id",F);if($)throw $;return z},enabled:o}),{data:b=[]}=ei({queryKey:["merchant-restaurants",e],queryFn:async()=>{const{data:R,error:M}=await Ct.from("merchant_restaurants").select("restaurant_id").eq("user_id",e);if(M)throw M;return R.map(F=>F.restaurant_id)},enabled:o}),{data:T=[]}=ei({queryKey:["merchant-supervisors",e],queryFn:async()=>{if(b.length===0)return[];const{data:R,error:M}=await Ct.from("merchant_restaurants").select("user_id, restaurant_id").in("restaurant_id",b).neq("user_id",e);if(M)throw M;const F=[...new Set(R.map(ne=>ne.user_id))];if(F.length===0)return[];const{data:z,error:$}=await Ct.from("user_roles").select("user_id").in("user_id",F).eq("role","supervisor");if($)throw $;const W=z.map(ne=>ne.user_id);if(W.length===0)return[];const{data:K,error:ee}=await Ct.from("profiles").select("id, display_name").in("id",W);if(ee)throw ee;return K},enabled:o&&b.length>0}),A=Gi({mutationFn:async R=>{if(b.length===0)throw new Error("");const M=b.map(z=>({user_id:R,restaurant_id:z})),{error:F}=await Ct.from("merchant_restaurants").upsert(M,{onConflict:"user_id,restaurant_id"});if(F)throw F},onSuccess:()=>{n({title:"",description:""}),s.invalidateQueries({queryKey:["merchant-supervisors"]}),m(""),h(!1)},onError:R=>{n({title:"",description:R.message,variant:"destructive"})}}),O=Gi({mutationFn:async R=>{const{error:M}=await Ct.from("merchant_restaurants").delete().eq("user_id",R).in("restaurant_id",b);if(M)throw M},onSuccess:()=>{n({title:"",description:""}),s.invalidateQueries({queryKey:["merchant-supervisors"]})},onError:R=>{n({title:"",description:R.message,variant:"destructive"})}}),P=()=>{i&&A.mutate(i)},I=R=>{O.mutate(R)};return d.jsxs(fl,{open:o,onOpenChange:h,children:[d.jsx(tf,{asChild:!0,children:r||d.jsxs(Mt,{variant:"outline",size:"sm",children:[d.jsx(RQ,{className:"w-4 h-4 mr-2"}),""]})}),d.jsxs(Jo,{className:"max-w-md",children:[d.jsxs(Qo,{children:[d.jsxs(el,{className:"flex items-center gap-2",children:[d.jsx(Lc,{className:"w-5 h-5"}),""]}),d.jsxs(Ul,{children:[" ",d.jsx("strong",{children:t})," "]})]}),d.jsxs("div",{className:"space-y-4",children:[T.length>0&&d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm font-medium",children:""}),d.jsx("div",{className:"space-y-2",children:T.map(R=>d.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-lg",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Lc,{className:"w-4 h-4 text-blue-500"}),d.jsx("span",{className:"text-sm",children:R.display_name})]}),d.jsx(Mt,{variant:"ghost",size:"sm",onClick:()=>I(R.id),disabled:O.isPending,children:""})]},R.id))})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm font-medium",children:""}),d.jsxs(Qs,{value:i,onValueChange:m,children:[d.jsx(Gs,{children:d.jsx(ea,{placeholder:""})}),d.jsx(Ws,{children:S?d.jsx("div",{className:"p-2 text-center",children:d.jsx(_a,{className:"w-4 h-4 animate-spin mx-auto"})}):y.length===0?d.jsx("div",{className:"p-2 text-center text-sm text-muted-foreground",children:""}):y.filter(R=>!T.find(M=>M.id===R.id)).map(R=>d.jsx(nn,{value:R.id,children:d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Lc,{className:"w-4 h-4 text-blue-500"}),R.display_name]})},R.id))})]})]}),b.length===0&&d.jsx(sn,{variant:"secondary",className:"w-full justify-center",children:""}),d.jsxs("div",{className:"flex gap-2 justify-end",children:[d.jsx(Mt,{variant:"outline",onClick:()=>h(!1),children:""}),d.jsx(Mt,{onClick:P,disabled:!i||A.isPending||b.length===0,children:A.isPending?d.jsxs(d.Fragment,{children:[d.jsx(_a,{className:"w-4 h-4 mr-2 animate-spin"}),"..."]}):""})]})]})]})]})},Wtt=({merchant:e,trigger:t})=>{const{t:r}=ci(),[n,s]=V.useState(!1),[o,h]=V.useState(e.display_name),[i,m]=V.useState(e.phone||""),[y,S]=V.useState(null),[b,T]=V.useState(e.avatar_url||""),A=PIe(),O=OIe(),P=R=>{var F;const M=(F=R.target.files)==null?void 0:F[0];if(M){if(M.size>2*1024*1024)return;S(M),T(URL.createObjectURL(M))}},I=async()=>{let R=e.avatar_url;if(y){const M=await O.mutateAsync({file:y,userId:e.id});M&&(R=M)}await A.mutateAsync({userId:e.id,display_name:o,phone:i||void 0,avatar_url:R||void 0}),s(!1)};return d.jsxs(fl,{open:n,onOpenChange:s,children:[d.jsx(tf,{asChild:!0,children:t||d.jsxs(Mt,{variant:"outline",size:"sm",children:[d.jsx(b2,{className:"w-4 h-4 mr-2"}),""]})}),d.jsxs(Jo,{className:"max-w-[90vw] sm:max-w-[425px]",children:[d.jsxs(Qo,{children:[d.jsx(el,{children:""}),d.jsx(Ul,{children:""})]}),d.jsxs("div",{className:"space-y-4 py-4",children:[d.jsxs("div",{className:"flex flex-col items-center gap-4",children:[d.jsxs(Ju,{className:"w-24 h-24",children:[d.jsx(Qu,{src:b}),d.jsx(ed,{children:o==null?void 0:o.charAt(0).toUpperCase()})]}),d.jsxs("div",{children:[d.jsx(cr,{type:"file",accept:"image/*",onChange:P,className:"hidden",id:"avatar-upload"}),d.jsxs(Mt,{variant:"outline",size:"sm",onClick:()=>{var R;return(R=document.getElementById("avatar-upload"))==null?void 0:R.click()},children:[d.jsx(zh,{className:"w-4 h-4 mr-2"}),r("profile.uploadAvatar")]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"displayName",children:r("profile.displayName")}),d.jsx(cr,{id:"displayName",value:o,onChange:R=>h(R.target.value),placeholder:r("profile.displayName")})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"phone",children:r("profile.phone")}),d.jsx(cr,{id:"phone",value:i,onChange:R=>m(R.target.value),placeholder:r("profile.phone")})]})]}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Mt,{variant:"outline",onClick:()=>s(!1),children:r("common.cancel")}),d.jsx(Mt,{onClick:I,disabled:A.isPending||O.isPending,children:A.isPending||O.isPending?d.jsxs(d.Fragment,{children:[d.jsx(_a,{className:"w-4 h-4 mr-2 animate-spin"}),r("common.loading")]}):r("common.save")})]})]})]})};function uU(e,t){if(!e||e.length===0)return t.join(",");const r=[];r.push(t.join(","));for(const n of e){const s=t.map(o=>{const h=n[o];if(h==null)return"";if(Array.isArray(h))return`"${h.join(", ")}"`;if(typeof h=="object")return`"${JSON.stringify(h)}"`;const i=String(h);return i.includes(",")||i.includes('"')||i.includes(`
`)?`"${i.replace(/"/g,'""')}"`:i});r.push(s.join(","))}return r.join(`
`)}function dU(e,t){const r="\uFEFF",n=new Blob([r+e],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");if(s.download!==void 0){const o=URL.createObjectURL(n);s.setAttribute("href",o),s.setAttribute("download",t),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)}}function Ktt(e){const t=["id","display_name","phone","created_at","roles"],r=e.map(o=>{var h;return{id:o.id,display_name:o.display_name,phone:o.phone||"",created_at:new Date(o.created_at).toLocaleDateString(),roles:((h=o.roles)==null?void 0:h.join(", "))||"user"}}),n=uU(r,t),s=`users_export_${new Date().toISOString().split("T")[0]}.csv`;dU(n,s)}function Ztt(e){const t=["id","name","name_en","name_pt","type","type_en","type_pt","address","phone","website_url","rating","lat","lng","created_at"],r=e.map(o=>({id:o.id,name:o.name,name_en:o.name_en||"",name_pt:o.name_pt||"",type:o.type,type_en:o.type_en||"",type_pt:o.type_pt||"",address:o.address,phone:o.phone||"",website_url:o.website_url||"",rating:o.rating||0,lat:o.lat,lng:o.lng,created_at:new Date(o.created_at).toLocaleDateString()})),n=uU(r,t),s=`restaurants_export_${new Date().toISOString().split("T")[0]}.csv`;dU(n,s)}function Xtt(e){const t=["id","title_en","title_zh","title_pt","start_date","end_date","repeat_mode","pinned","sort_order","created_at"],r=e.map(o=>({id:o.id,title_en:o.title_en,title_zh:o.title_zh,title_pt:o.title_pt,start_date:new Date(o.start_date).toLocaleDateString(),end_date:o.end_date?new Date(o.end_date).toLocaleDateString():"",repeat_mode:o.repeat_mode||"none",pinned:o.pinned?"Yes":"No",sort_order:o.sort_order||0,created_at:new Date(o.created_at).toLocaleDateString()})),n=uU(r,t),s=`activities_export_${new Date().toISOString().split("T")[0]}.csv`;dU(n,s)}const Ytt=()=>{const{t:e}=ci(),{toast:t}=Ri(),{isSupervisor:r,isAdmin:n}=_c(),{data:s,isLoading:o}=TIe(),h=AIe(),i=FIe(),m=$Ie(),[y,S]=V.useState(null),[b,T]=V.useState(""),[A,O]=V.useState([]),[P,I]=V.useState("user"),[R,M]=V.useState(""),[F,z]=V.useState("all"),[$,W]=V.useState({open:!1,userId:"",userName:"",currentRole:"",newRole:""}),[K,ee]=V.useState({open:!1,merchantId:"",merchantName:"",userRole:"merchant"}),ne=["user","merchant","supervisor","admin"],ie=r?ne.filter(pe=>pe==="user"||pe==="merchant"):ne,re=V.useMemo(()=>s?{total:s.length,admins:s.filter(pe=>pe.role==="admin").length,supervisors:s.filter(pe=>pe.role==="supervisor").length,merchants:s.filter(pe=>pe.role==="merchant").length,regularUsers:s.filter(pe=>pe.role==="user").length}:{total:0,admins:0,supervisors:0,merchants:0,regularUsers:0},[s]),te=V.useMemo(()=>s?s.filter(pe=>{var Ze;const Oe=R===""||pe.display_name.toLowerCase().includes(R.toLowerCase())||((Ze=pe.phone)==null?void 0:Ze.toLowerCase().includes(R.toLowerCase())),Je=F==="all"||pe.role===F;return Oe&&Je}):[],[s,R,F]),ae=()=>{if(!s||s.length===0){t({title:e("common.error"),description:e("admin.noDataToExport"),variant:"destructive"});return}Ktt(s),t({title:e("common.success"),description:e("admin.exportSuccess")})},ue=pe=>{O(Oe=>Oe.includes(pe)?Oe.filter(Je=>Je!==pe):[...Oe,pe])},be=()=>{A.length===(te==null?void 0:te.length)?O([]):O((te==null?void 0:te.map(pe=>pe.id))||[])},we=()=>{A.length!==0&&(i.mutate(A),O([]))},Ce=()=>{A.length!==0&&(m.mutate({userIds:A,role:P}),O([]))},_e=()=>{$.userId&&$.newRole&&h.mutate({userId:$.userId,role:$.newRole},{onSuccess:()=>{W({open:!1,userId:"",userName:"",currentRole:"",newRole:""}),S(null),T("")}})},me=(pe,Oe,Je,Ze)=>{W({open:!0,userId:pe,userName:Oe,currentRole:Je,newRole:Ze})},Ae=pe=>{switch(pe){case"admin":return"bg-primary text-primary-foreground hover:bg-primary/90";case"supervisor":return"bg-blue-500 text-white hover:bg-blue-600";case"merchant":return"bg-emerald-500 text-white hover:bg-emerald-600";default:return"bg-muted text-muted-foreground hover:bg-muted/80"}},ge=pe=>{switch(pe){case"admin":return d.jsx(Lc,{className:"h-3.5 w-3.5"});case"supervisor":return d.jsx(Lc,{className:"h-3.5 w-3.5"});case"merchant":return d.jsx(lE,{className:"h-3.5 w-3.5"});default:return d.jsx(Bc,{className:"h-3.5 w-3.5"})}};return o?d.jsx(xo,{children:d.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:d.jsxs("div",{className:"text-center space-y-3",children:[d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),d.jsx("p",{className:"text-muted-foreground",children:e("common.loading")})]})})}):d.jsx(xo,{children:d.jsxs("div",{className:"space-y-6",children:[d.jsx("div",{children:d.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[d.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:d.jsx(RQ,{className:"h-6 w-6 text-primary"})}),d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:e("admin.userManagement")}),d.jsx("p",{className:"text-muted-foreground",children:e("admin.manageUserRoles")})]})]})}),r?d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:d.jsx(Nr,{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 border-emerald-200 dark:from-emerald-950/20 dark:to-emerald-900/20 dark:border-emerald-900/30",children:d.jsx(Mr,{className:"pt-6",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),d.jsx("p",{className:"text-2xl font-bold",children:re.merchants})]}),d.jsx(lE,{className:"h-8 w-8 text-emerald-500"})]})})})}):d.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[d.jsx(Nr,{className:"bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20",children:d.jsx(Mr,{className:"pt-6",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),d.jsx("p",{className:"text-2xl font-bold",children:re.total})]}),d.jsx(Bc,{className:"h-8 w-8 text-primary/60"})]})})}),d.jsx(Nr,{className:"bg-gradient-to-br from-red-50 to-red-100 border-red-200 dark:from-red-950/20 dark:to-red-900/20 dark:border-red-900/30",children:d.jsx(Mr,{className:"pt-6",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),d.jsx("p",{className:"text-2xl font-bold",children:re.admins})]}),d.jsx(Lc,{className:"h-8 w-8 text-red-500"})]})})}),d.jsx(Nr,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200 dark:from-blue-950/20 dark:to-blue-900/20 dark:border-blue-900/30",children:d.jsx(Mr,{className:"pt-6",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),d.jsx("p",{className:"text-2xl font-bold",children:re.supervisors})]}),d.jsx(Lc,{className:"h-8 w-8 text-blue-500"})]})})}),d.jsx(Nr,{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 border-emerald-200 dark:from-emerald-950/20 dark:to-emerald-900/20 dark:border-emerald-900/30",children:d.jsx(Mr,{className:"pt-6",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),d.jsx("p",{className:"text-2xl font-bold",children:re.merchants})]}),d.jsx(lE,{className:"h-8 w-8 text-emerald-500"})]})})}),d.jsx(Nr,{className:"bg-gradient-to-br from-gray-50 to-gray-100 border-gray-200 dark:from-gray-950/20 dark:to-gray-900/20 dark:border-gray-900/30",children:d.jsx(Mr,{className:"pt-6",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),d.jsx("p",{className:"text-2xl font-bold",children:re.regularUsers})]}),d.jsx(Bc,{className:"h-8 w-8 text-gray-500"})]})})})]}),d.jsx(Nr,{children:d.jsx(Mr,{className:"pt-6",children:d.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[d.jsx("div",{className:"flex-1",children:d.jsxs("div",{className:"relative",children:[d.jsx(Xh,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),d.jsx(cr,{placeholder:"...",value:R,onChange:pe=>M(pe.target.value),className:"pl-10 pr-10"}),R&&d.jsx(Mt,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-7 w-7 p-0",onClick:()=>M(""),children:d.jsx(Xc,{className:"h-4 w-4"})})]})}),!r&&d.jsxs(Qs,{value:F,onValueChange:z,children:[d.jsxs(Gs,{className:"w-full md:w-[200px]",children:[d.jsx(rN,{className:"h-4 w-4 mr-2"}),d.jsx(ea,{placeholder:""})]}),d.jsxs(Ws,{children:[d.jsx(nn,{value:"all",children:d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Bc,{className:"h-4 w-4"}),""]})}),d.jsx(nn,{value:"admin",children:d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Lc,{className:"h-4 w-4 text-red-500"}),""]})}),d.jsx(nn,{value:"supervisor",children:d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Lc,{className:"h-4 w-4 text-blue-500"}),""]})}),d.jsx(nn,{value:"merchant",children:d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(lE,{className:"h-4 w-4 text-emerald-500"}),""]})}),d.jsx(nn,{value:"user",children:d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Bc,{className:"h-4 w-4 text-gray-500"}),""]})})]})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx(qtt,{trigger:d.jsxs(Mt,{variant:"default",size:"default",children:[d.jsx(kE,{className:"mr-2 h-4 w-4"}),d.jsx("span",{className:"hidden sm:inline",children:e("admin.createUser")}),d.jsx("span",{className:"sm:hidden",children:e("admin.create")})]})}),d.jsxs(Mt,{variant:"outline",onClick:ae,children:[d.jsx(tN,{className:"h-4 w-4 md:mr-2"}),d.jsx("span",{className:"hidden md:inline",children:""})]})]})]})})}),A.length>0&&d.jsx(Nr,{className:"border-primary/50 bg-primary/5",children:d.jsx(Mr,{className:"pt-6",children:d.jsxs("div",{className:"flex flex-col gap-4",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Yo,{checked:!0,onCheckedChange:()=>O([])}),d.jsxs("span",{className:"font-semibold",children:[" ",A.length," "]})]}),d.jsxs(Mt,{variant:"ghost",size:"sm",onClick:()=>O([]),children:[d.jsx(Xc,{className:"h-4 w-4 mr-1"}),""]})]}),d.jsx(El,{}),d.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[d.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[d.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:""}),d.jsxs(Qs,{value:P,onValueChange:pe=>I(pe),children:[d.jsx(Gs,{className:"w-full sm:w-[160px]",children:d.jsx(ea,{})}),d.jsx(Ws,{children:ie.map(pe=>d.jsx(nn,{value:pe,children:d.jsxs("div",{className:"flex items-center gap-2",children:[ge(pe),d.jsx("span",{className:"capitalize",children:pe})]})},pe))})]}),d.jsxs(Mt,{onClick:Ce,size:"default",children:[d.jsx(kE,{className:"mr-2 h-4 w-4"}),""]})]}),d.jsxs(ko,{children:[d.jsx(gb,{asChild:!0,children:d.jsxs(Mt,{variant:"destructive",size:"default",children:[d.jsx(Yh,{className:"mr-2 h-4 w-4"}),""]})}),d.jsxs(co,{className:"max-w-[90vw] sm:max-w-[425px]",children:[d.jsxs(uo,{children:[d.jsx(fo,{children:""}),d.jsxs(po,{children:[" ",A.length," "]})]}),d.jsxs(ho,{children:[d.jsx(mo,{children:""}),d.jsx(to,{onClick:we,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:""})]})]})]})]})]})})}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(Yo,{checked:A.length===(te==null?void 0:te.length)&&te.length>0,onCheckedChange:be}),d.jsx("span",{className:"font-semibold",children:""})]}),d.jsxs(sn,{variant:"secondary",className:"text-sm font-normal",children:[" ",te==null?void 0:te.length," / ",(s==null?void 0:s.length)||0," "]})]}),te&&te.length>0?d.jsx("div",{className:"grid gap-4",children:te.map(pe=>{var Oe;return d.jsx(Nr,{className:"hover:shadow-lg transition-all duration-200 border-l-4 border-l-transparent hover:border-l-primary",children:d.jsx(Mr,{className:"pt-6",children:d.jsxs("div",{className:"flex flex-col gap-4",children:[d.jsxs("div",{className:"flex items-start sm:items-center justify-between gap-4",children:[d.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[d.jsx(Yo,{checked:A.includes(pe.id),onCheckedChange:()=>ue(pe.id)}),d.jsxs(Ju,{className:"h-16 w-16 border-2 border-border",children:[d.jsx(Qu,{src:pe.avatar_url||""}),d.jsx(ed,{className:"text-lg font-semibold bg-primary/10 text-primary",children:((Oe=pe.display_name)==null?void 0:Oe.charAt(0).toUpperCase())||"U"})]}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsx("h3",{className:"font-bold text-lg truncate",children:pe.display_name}),d.jsx("p",{className:"text-sm text-muted-foreground truncate",children:pe.phone||""})]})]}),d.jsxs(sn,{className:`${Ae(pe.role)} px-3 py-1.5 font-medium`,children:[ge(pe.role),d.jsx("span",{className:"ml-1.5 capitalize",children:pe.role})]})]}),d.jsx(El,{}),d.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[d.jsxs("div",{className:"flex-1",children:[d.jsx("label",{className:"text-sm font-medium text-muted-foreground mb-2 block",children:""}),d.jsxs(Qs,{value:y===pe.id?b:"",onValueChange:Je=>{S(pe.id),T(Je)},children:[d.jsx(Gs,{className:"w-full",children:d.jsx(ea,{placeholder:"..."})}),d.jsx(Ws,{children:ie.filter(Je=>Je!==pe.role).map(Je=>d.jsx(nn,{value:Je,children:d.jsxs("div",{className:"flex items-center gap-2",children:[ge(Je),d.jsx("span",{className:"capitalize",children:Je})]})},Je))})]})]}),d.jsx("div",{className:"flex items-end",children:d.jsxs(Mt,{onClick:()=>{y===pe.id&&b&&me(pe.id,pe.display_name,pe.role,b)},disabled:y!==pe.id||!b,className:"w-full sm:w-auto",size:"default",children:[d.jsx(kE,{className:"mr-2 h-4 w-4"}),""]})})]}),r&&pe.role==="merchant"&&d.jsxs(d.Fragment,{children:[d.jsx(El,{}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("label",{className:"text-sm font-medium text-muted-foreground block",children:""}),d.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:""})]}),d.jsx(Wtt,{merchant:{id:pe.id,display_name:pe.display_name,phone:pe.phone,avatar_url:pe.avatar_url}})]})]}),(pe.role==="merchant"||pe.role==="supervisor")&&d.jsxs(d.Fragment,{children:[d.jsx(El,{}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("label",{className:"text-sm font-medium text-muted-foreground block",children:""}),d.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:pe.role==="merchant"?"1":""})]}),d.jsxs(Mt,{variant:"outline",size:"default",onClick:()=>ee({open:!0,merchantId:pe.id,merchantName:pe.display_name,userRole:pe.role}),children:[d.jsx(Io,{className:"mr-2 h-4 w-4"}),""]})]}),n&&pe.role==="merchant"&&d.jsxs(d.Fragment,{children:[d.jsx(El,{}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("label",{className:"text-sm font-medium text-muted-foreground block",children:""}),d.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:""})]}),d.jsx(Gtt,{merchantId:pe.id,merchantName:pe.display_name})]})]})]})]})]})})},pe.id)})}):d.jsx(Nr,{children:d.jsx(Mr,{className:"pt-12 pb-12",children:d.jsxs("div",{className:"text-center space-y-3",children:[d.jsx(Bc,{className:"h-16 w-16 text-muted-foreground/50 mx-auto"}),d.jsx("h3",{className:"text-lg font-semibold",children:""}),d.jsx("p",{className:"text-muted-foreground",children:R||F!=="all"?"":""})]})})})]}),d.jsx(ko,{open:$.open,onOpenChange:pe=>{pe||W({open:!1,userId:"",userName:"",currentRole:"",newRole:""})},children:d.jsxs(co,{className:"max-w-[90vw] sm:max-w-[500px]",children:[d.jsxs(uo,{children:[d.jsxs(fo,{className:"flex items-center gap-2",children:[d.jsx(Lc,{className:"h-5 w-5 text-primary"}),""]}),d.jsxs(po,{className:"space-y-4 pt-4",children:[d.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg space-y-3",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:""}),d.jsx("span",{className:"font-semibold text-foreground",children:$.userName})]}),d.jsx(El,{}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:""}),d.jsxs(sn,{className:Ae($.currentRole),children:[ge($.currentRole),d.jsx("span",{className:"ml-1.5 capitalize",children:$.currentRole})]})]}),d.jsx("div",{className:"flex items-center justify-center",children:d.jsx("div",{className:"text-2xl text-primary",children:""})}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:""}),d.jsxs(sn,{className:Ae($.newRole),children:[ge($.newRole),d.jsx("span",{className:"ml-1.5 capitalize",children:$.newRole})]})]})]}),$.newRole==="admin"&&d.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 p-4 rounded-lg flex gap-3",children:[d.jsx(Lc,{className:"h-5 w-5 text-destructive flex-shrink-0 mt-0.5"}),d.jsxs("div",{className:"space-y-1",children:[d.jsx("p",{className:"font-semibold text-destructive text-sm",children:" "}),d.jsx("p",{className:"text-sm text-muted-foreground",children:""})]})]}),$.currentRole==="admin"&&d.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 p-4 rounded-lg flex gap-3",children:[d.jsx(Lc,{className:"h-5 w-5 text-destructive flex-shrink-0 mt-0.5"}),d.jsxs("div",{className:"space-y-1",children:[d.jsx("p",{className:"font-semibold text-destructive text-sm",children:" "}),d.jsx("p",{className:"text-sm text-muted-foreground",children:""})]})]}),d.jsx("p",{className:"text-sm text-center text-muted-foreground",children:""})]})]}),d.jsxs(ho,{children:[d.jsx(mo,{children:""}),d.jsx(to,{onClick:_e,className:"bg-primary",children:""})]})]})}),d.jsx(Htt,{open:K.open,onOpenChange:pe=>ee({...K,open:pe}),merchantId:K.merchantId,merchantName:K.merchantName,userRole:K.userRole})]})})},lde=({className:e,...t})=>d.jsx("nav",{role:"navigation","aria-label":"pagination",className:fr("mx-auto flex w-full justify-center",e),...t});lde.displayName="Pagination";const cde=V.forwardRef(({className:e,...t},r)=>d.jsx("ul",{ref:r,className:fr("flex flex-row items-center gap-1",e),...t}));cde.displayName="PaginationContent";const xE=V.forwardRef(({className:e,...t},r)=>d.jsx("li",{ref:r,className:fr("",e),...t}));xE.displayName="PaginationItem";const BI=({className:e,isActive:t,size:r="icon",...n})=>d.jsx("a",{"aria-current":t?"page":void 0,className:fr(cb({variant:t?"outline":"ghost",size:r}),e),...n});BI.displayName="PaginationLink";const ude=({className:e,...t})=>d.jsxs(BI,{"aria-label":"Go to previous page",size:"default",className:fr("gap-1 pl-2.5",e),...t,children:[d.jsx(Jk,{className:"h-4 w-4"}),d.jsx("span",{children:"Previous"})]});ude.displayName="PaginationPrevious";const dde=({className:e,...t})=>d.jsxs(BI,{"aria-label":"Go to next page",size:"default",className:fr("gap-1 pr-2.5",e),...t,children:[d.jsx("span",{children:"Next"}),d.jsx(Qk,{className:"h-4 w-4"})]});dde.displayName="PaginationNext";const hde=({className:e,...t})=>d.jsxs("span",{"aria-hidden":!0,className:fr("flex h-9 w-9 items-center justify-center",e),...t,children:[d.jsx(TB,{className:"h-4 w-4"}),d.jsx("span",{className:"sr-only",children:"More pages"})]});hde.displayName="PaginationEllipsis";function Jtt({data:e,itemsPerPage:t=10}){const[r,n]=V.useState(1),s=(e==null?void 0:e.length)||0,o=Math.ceil(s/t),h=V.useMemo(()=>{if(!e)return[];const O=(r-1)*t,P=O+t;return e.slice(O,P)},[e,r,t]),i=O=>{const P=Math.max(1,Math.min(O,o));n(P),window.scrollTo({top:0,behavior:"smooth"})},m=()=>i(r+1),y=()=>i(r-1),S=r<o,b=r>1,T=s===0?0:(r-1)*t+1,A=Math.min(r*t,s);return{currentPage:r,totalPages:o,paginatedData:h,goToPage:i,nextPage:m,previousPage:y,canGoNext:S,canGoPrevious:b,startIndex:T,endIndex:A,totalItems:s}}const Qtt=()=>{const{t:e}=ci(),{toast:t}=Ri(),{isSupervisor:r}=_c(),{data:n,isLoading:s}=CIe(),{getLocalizedField:o}=xc(),h=LIe(),i=zIe(),m=UIe(),[y,S]=V.useState([]),[b,T]=V.useState(""),[A,O]=V.useState("all"),P=V.useMemo(()=>{if(!n)return[];const we=new Set;return n.forEach(Ce=>{const _e=o(Ce,"type");Array.isArray(_e)?_e.forEach(me=>we.add(me)):_e&&we.add(_e)}),Array.from(we)},[n,o]),I=V.useMemo(()=>n?n.filter(we=>{const Ce=b===""||o(we,"name").toString().toLowerCase().includes(b.toLowerCase())||we.address.toLowerCase().includes(b.toLowerCase()),_e=o(we,"type"),me=A==="all"||(Array.isArray(_e)?_e.includes(A):_e===A);return Ce&&me}):[],[n,b,A,o]),{currentPage:R,totalPages:M,paginatedData:F,goToPage:z,nextPage:$,previousPage:W,canGoNext:K,canGoPrevious:ee,startIndex:ne,endIndex:ie,totalItems:re}=Jtt({data:I,itemsPerPage:10}),te=()=>{if(!n||n.length===0){t({title:e("common.error"),description:e("admin.noDataToExport"),variant:"destructive"});return}Ztt(n),t({title:e("common.success"),description:e("admin.exportSuccess")})},ae=we=>{S(Ce=>Ce.includes(we)?Ce.filter(_e=>_e!==we):[...Ce,we])},ue=()=>{y.length===(F==null?void 0:F.length)?S([]):S((F==null?void 0:F.map(we=>we.id))||[])},be=()=>{y.length!==0&&(i.mutate(y),S([]))};return s?d.jsx(xo,{children:d.jsx("div",{className:"text-center",children:e("common.loading")})}):d.jsx(xo,{children:d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:e("admin.restaurantManagement")}),d.jsx("p",{className:"text-muted-foreground",children:e("admin.manageRestaurants")})]}),d.jsxs("div",{className:"flex gap-2 flex-wrap",children:[d.jsxs(Mt,{variant:"outline",onClick:te,className:"flex-1 sm:flex-initial",children:[d.jsx(tN,{className:"mr-2 h-4 w-4"}),d.jsx("span",{className:"hidden sm:inline",children:e("admin.exportCSV")})]}),d.jsx(CO,{trigger:d.jsxs(Mt,{className:"flex-1 sm:flex-initial",children:[d.jsx(sp,{className:"mr-2 h-4 w-4"}),e("admin.addRestaurant")]})})]})]}),d.jsx(Nr,{children:d.jsx(Mr,{className:"pt-6",children:d.jsxs("div",{className:"flex gap-4 flex-wrap",children:[d.jsx("div",{className:"flex-1 min-w-[200px]",children:d.jsxs("div",{className:"relative",children:[d.jsx(Xh,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),d.jsx(cr,{placeholder:e("admin.searchRestaurants"),value:b,onChange:we=>T(we.target.value),className:"pl-9"})]})}),d.jsxs(Qs,{value:A,onValueChange:O,children:[d.jsx(Gs,{className:"w-[180px]",children:d.jsx(ea,{placeholder:e("admin.filterByType")})}),d.jsxs(Ws,{children:[d.jsx(nn,{value:"all",children:e("admin.allTypes")}),P.map(we=>d.jsx(nn,{value:we,children:we},we))]})]})]})})}),!r&&y.length>0&&d.jsx(Nr,{className:"bg-muted/50",children:d.jsx(Mr,{className:"pt-6",children:d.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[d.jsx("span",{className:"font-medium",children:e("admin.selectedCount",{count:y.length})}),d.jsxs("div",{className:"flex gap-2 flex-wrap w-full sm:w-auto",children:[d.jsxs(ko,{children:[d.jsx(gb,{asChild:!0,children:d.jsxs(Mt,{variant:"destructive",size:"sm",className:"flex-1 sm:flex-initial",children:[d.jsx(Yh,{className:"mr-2 h-4 w-4"}),e("admin.batchDelete")]})}),d.jsxs(co,{className:"max-w-[90vw] sm:max-w-[425px]",children:[d.jsxs(uo,{children:[d.jsx(fo,{children:e("admin.confirmBatchDelete")}),d.jsx(po,{children:e("admin.batchDeleteWarning",{count:y.length})})]}),d.jsxs(ho,{children:[d.jsx(mo,{children:e("common.cancel")}),d.jsx(to,{onClick:be,children:e("common.delete")})]})]})]}),d.jsx(Mt,{variant:"outline",size:"sm",onClick:()=>S([]),className:"flex-1 sm:flex-initial",children:e("admin.clearSelection")})]})]})})}),d.jsxs("div",{className:"flex items-center justify-between pb-2 border-b",children:[d.jsx("div",{className:"flex items-center gap-2",children:!r&&d.jsxs(d.Fragment,{children:[d.jsx(Yo,{checked:y.length===(F==null?void 0:F.length)&&F.length>0,onCheckedChange:ue}),d.jsx("span",{className:"font-medium",children:e("admin.selectAll")})]})}),d.jsxs("span",{className:"text-sm text-muted-foreground",children:[e("admin.showing")," ",ne,"-",ie," ",e("admin.of")," ",re]})]}),d.jsx("div",{className:"grid gap-4",children:F==null?void 0:F.map(we=>d.jsx(Nr,{children:d.jsxs("div",{className:"flex flex-col md:flex-row",children:[d.jsx("div",{className:"p-4 flex items-start",children:!r&&d.jsx(Yo,{checked:y.includes(we.id),onCheckedChange:()=>ae(we.id),className:"mt-1"})}),we.image_url&&d.jsx("div",{className:"w-full md:w-48 h-48 flex items-center justify-center overflow-hidden",children:d.jsx("img",{src:we.image_url,alt:String(o(we,"name")),className:"object-cover object-center w-full h-full"})}),d.jsxs("div",{className:"flex-1",children:[d.jsxs(Rn,{children:[d.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[d.jsx($n,{className:"text-lg md:text-xl",children:o(we,"name")}),d.jsx("div",{className:"flex items-center gap-2",children:d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx(Al,{className:"h-4 w-4 fill-accent text-accent"}),d.jsx("span",{className:"font-medium",children:we.rating||0})]})})]}),d.jsx(as,{children:d.jsxs("div",{className:"flex flex-col gap-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Pa,{className:"h-3 w-3 flex-shrink-0"}),d.jsx("span",{className:"text-xs sm:text-sm",children:we.address})]}),o(we,"description")&&d.jsx("div",{className:`prose prose-sm max-w-none line-clamp-2\r
                              [&_p]:inline [&_p]:m-0\r
                              [&_strong]:font-semibold [&_strong]:text-foreground\r
                              [&_em]:italic\r
                              [&_h1]:text-base [&_h2]:text-base [&_h3]:text-base\r
                              [&_*]:text-muted-foreground`,dangerouslySetInnerHTML:{__html:o(we,"description")}})]})})]}),d.jsxs(Mr,{children:[d.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:(Array.isArray(o(we,"type"))?o(we,"type"):[o(we,"type")]).map((Ce,_e)=>d.jsx(sn,{children:Ce},_e))}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[d.jsxs("div",{className:"space-y-0.5",children:[d.jsx(yr,{htmlFor:`visible-${we.id}`,className:"text-sm font-medium",children:""}),d.jsx("div",{className:"text-xs text-muted-foreground",children:we.visible?"":""})]}),d.jsx(wb,{id:`visible-${we.id}`,checked:we.visible??!0,onCheckedChange:Ce=>m.mutate({restaurantId:we.id,visible:Ce})})]}),d.jsxs("div",{className:"flex gap-2 flex-wrap",children:[d.jsx(Mt,{variant:"outline",size:"sm",asChild:!0,className:"flex-1 sm:flex-initial",children:d.jsx(ji,{to:`/restaurant/${we.id}`,state:{from:"admin"},children:e("admin.view")})}),d.jsx(CO,{restaurant:we,trigger:d.jsx(Mt,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:e("common.edit")})}),!r&&d.jsxs(ko,{children:[d.jsx(gb,{asChild:!0,children:d.jsx(Mt,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:e("common.delete")})}),d.jsxs(co,{className:"max-w-[90vw] sm:max-w-[425px]",children:[d.jsxs(uo,{children:[d.jsx(fo,{children:e("admin.confirmDelete")}),d.jsx(po,{children:e("admin.deleteRestaurantWarning")})]}),d.jsxs(ho,{children:[d.jsx(mo,{children:e("common.cancel")}),d.jsx(to,{onClick:()=>h.mutate(we.id),children:e("common.delete")})]})]})]})]})]})]})]})]})},we.id))}),M>1&&d.jsx(lde,{className:"mt-6",children:d.jsxs(cde,{children:[d.jsx(xE,{children:d.jsx(ude,{onClick:W,className:ee?"cursor-pointer":"pointer-events-none opacity-50"})}),Array.from({length:M},(we,Ce)=>Ce+1).map(we=>we===1||we===M||we>=R-1&&we<=R+1?d.jsx(xE,{children:d.jsx(BI,{onClick:()=>z(we),isActive:R===we,className:"cursor-pointer",children:we})},we):we===R-2||we===R+2?d.jsx(xE,{children:d.jsx(hde,{})},we):null),d.jsx(xE,{children:d.jsx(dde,{onClick:$,className:K?"cursor-pointer":"pointer-events-none opacity-50"})})]})})]})})};var pi=function(){return pi=Object.assign||function(t){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},pi.apply(this,arguments)};function ert(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r}function fde(e,t,r){for(var n=0,s=t.length,o;n<s;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}function J2(e){return e.mode==="multiple"}function Q2(e){return e.mode==="range"}function $I(e){return e.mode==="single"}var trt={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function rrt(e,t){return ps(e,"LLLL y",t)}function nrt(e,t){return ps(e,"d",t)}function irt(e,t){return ps(e,"LLLL",t)}function srt(e){return"".concat(e)}function art(e,t){return ps(e,"cccccc",t)}function ort(e,t){return ps(e,"yyyy",t)}var lrt=Object.freeze({__proto__:null,formatCaption:rrt,formatDay:nrt,formatMonthCaption:irt,formatWeekNumber:srt,formatWeekdayName:art,formatYearCaption:ort}),crt=function(e,t,r){return ps(e,"do MMMM (EEEE)",r)},urt=function(){return"Month: "},drt=function(){return"Go to next month"},hrt=function(){return"Go to previous month"},frt=function(e,t){return ps(e,"cccc",t)},prt=function(e){return"Week n. ".concat(e)},mrt=function(){return"Year: "},grt=Object.freeze({__proto__:null,labelDay:crt,labelMonthDropdown:urt,labelNext:drt,labelPrevious:hrt,labelWeekNumber:prt,labelWeekday:frt,labelYearDropdown:mrt});function yrt(){var e="buttons",t=trt,r=A5,n={},s={},o=1,h={},i=new Date;return{captionLayout:e,classNames:t,formatters:lrt,labels:grt,locale:r,modifiersClassNames:n,modifiers:s,numberOfMonths:o,styles:h,today:i,mode:"default"}}function vrt(e){var t=e.fromYear,r=e.toYear,n=e.fromMonth,s=e.toMonth,o=e.fromDate,h=e.toDate;return n?o=Kc(n):t&&(o=new Date(t,0,1)),s?h=ON(s):r&&(h=new Date(r,11,31)),{fromDate:o?dg(o):void 0,toDate:h?dg(h):void 0}}var pde=V.createContext(void 0);function _rt(e){var t,r=e.initialProps,n=yrt(),s=vrt(r),o=s.fromDate,h=s.toDate,i=(t=r.captionLayout)!==null&&t!==void 0?t:n.captionLayout;i!=="buttons"&&(!o||!h)&&(i="buttons");var m;($I(r)||J2(r)||Q2(r))&&(m=r.onSelect);var y=pi(pi(pi({},n),r),{captionLayout:i,classNames:pi(pi({},n.classNames),r.classNames),components:pi({},r.components),formatters:pi(pi({},n.formatters),r.formatters),fromDate:o,labels:pi(pi({},n.labels),r.labels),mode:r.mode||n.mode,modifiers:pi(pi({},n.modifiers),r.modifiers),modifiersClassNames:pi(pi({},n.modifiersClassNames),r.modifiersClassNames),onSelect:m,styles:pi(pi({},n.styles),r.styles),toDate:h});return d.jsx(pde.Provider,{value:y,children:e.children})}function ca(){var e=V.useContext(pde);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function mde(e){var t=ca(),r=t.locale,n=t.classNames,s=t.styles,o=t.formatters.formatCaption;return d.jsx("div",{className:n.caption_label,style:s.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:o(e.displayMonth,{locale:r})})}function xrt(e){return d.jsx("svg",pi({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:d.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function gde(e){var t,r,n=e.onChange,s=e.value,o=e.children,h=e.caption,i=e.className,m=e.style,y=ca(),S=(r=(t=y.components)===null||t===void 0?void 0:t.IconDropdown)!==null&&r!==void 0?r:xrt;return d.jsxs("div",{className:i,style:m,children:[d.jsx("span",{className:y.classNames.vhidden,children:e["aria-label"]}),d.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:y.classNames.dropdown,style:y.styles.dropdown,value:s,onChange:n,children:o}),d.jsxs("div",{className:y.classNames.caption_label,style:y.styles.caption_label,"aria-hidden":"true",children:[h,d.jsx(S,{className:y.classNames.dropdown_icon,style:y.styles.dropdown_icon})]})]})}function brt(e){var t,r=ca(),n=r.fromDate,s=r.toDate,o=r.styles,h=r.locale,i=r.formatters.formatMonthCaption,m=r.classNames,y=r.components,S=r.labels.labelMonthDropdown;if(!n)return d.jsx(d.Fragment,{});if(!s)return d.jsx(d.Fragment,{});var b=[];if(aPe(n,s))for(var T=Kc(n),A=n.getMonth();A<=s.getMonth();A++)b.push(ZD(T,A));else for(var T=Kc(new Date),A=0;A<=11;A++)b.push(ZD(T,A));var O=function(I){var R=Number(I.target.value),M=ZD(Kc(e.displayMonth),R);e.onChange(M)},P=(t=y==null?void 0:y.Dropdown)!==null&&t!==void 0?t:gde;return d.jsx(P,{name:"months","aria-label":S(),className:m.dropdown_month,style:o.dropdown_month,onChange:O,value:e.displayMonth.getMonth(),caption:i(e.displayMonth,{locale:h}),children:b.map(function(I){return d.jsx("option",{value:I.getMonth(),children:i(I,{locale:h})},I.getMonth())})})}function wrt(e){var t,r=e.displayMonth,n=ca(),s=n.fromDate,o=n.toDate,h=n.locale,i=n.styles,m=n.classNames,y=n.components,S=n.formatters.formatYearCaption,b=n.labels.labelYearDropdown,T=[];if(!s)return d.jsx(d.Fragment,{});if(!o)return d.jsx(d.Fragment,{});for(var A=s.getFullYear(),O=o.getFullYear(),P=A;P<=O;P++)T.push(bG(mie(new Date),P));var I=function(M){var F=bG(Kc(r),Number(M.target.value));e.onChange(F)},R=(t=y==null?void 0:y.Dropdown)!==null&&t!==void 0?t:gde;return d.jsx(R,{name:"years","aria-label":b(),className:m.dropdown_year,style:i.dropdown_year,onChange:I,value:r.getFullYear(),caption:S(r,{locale:h}),children:T.map(function(M){return d.jsx("option",{value:M.getFullYear(),children:S(M,{locale:h})},M.getFullYear())})})}function Srt(e,t){var r=V.useState(e),n=r[0],s=r[1],o=t===void 0?n:t;return[o,s]}function Ert(e){var t=e.month,r=e.defaultMonth,n=e.today,s=t||r||n||new Date,o=e.toDate,h=e.fromDate,i=e.numberOfMonths,m=i===void 0?1:i;if(o&&fb(o,s)<0){var y=-1*(m-1);s=Zd(o,y)}return h&&fb(s,h)<0&&(s=h),Kc(s)}function Trt(){var e=ca(),t=Ert(e),r=Srt(t,e.month),n=r[0],s=r[1],o=function(h){var i;if(!e.disableNavigation){var m=Kc(h);s(m),(i=e.onMonthChange)===null||i===void 0||i.call(e,m)}};return[n,o]}function Art(e,t){for(var r=t.reverseMonths,n=t.numberOfMonths,s=Kc(e),o=Kc(Zd(s,n)),h=fb(o,s),i=[],m=0;m<h;m++){var y=Zd(s,m);i.push(y)}return r&&(i=i.reverse()),i}function Crt(e,t){if(!t.disableNavigation){var r=t.toDate,n=t.pagedNavigation,s=t.numberOfMonths,o=s===void 0?1:s,h=n?o:1,i=Kc(e);if(!r)return Zd(i,h);var m=fb(r,e);if(!(m<o))return Zd(i,h)}}function jrt(e,t){if(!t.disableNavigation){var r=t.fromDate,n=t.pagedNavigation,s=t.numberOfMonths,o=s===void 0?1:s,h=n?o:1,i=Kc(e);if(!r)return Zd(i,-h);var m=fb(i,r);if(!(m<=0))return Zd(i,-h)}}var yde=V.createContext(void 0);function Prt(e){var t=ca(),r=Trt(),n=r[0],s=r[1],o=Art(n,t),h=Crt(n,t),i=jrt(n,t),m=function(b){return o.some(function(T){return C5(b,T)})},y=function(b,T){m(b)||(T&&bie(b,T)?s(Zd(b,1+t.numberOfMonths*-1)):s(b))},S={currentMonth:n,displayMonths:o,goToMonth:s,goToDate:y,previousMonth:i,nextMonth:h,isDateDisplayed:m};return d.jsx(yde.Provider,{value:S,children:e.children})}function eA(){var e=V.useContext(yde);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function gX(e){var t,r=ca(),n=r.classNames,s=r.styles,o=r.components,h=eA().goToMonth,i=function(S){h(Zd(S,e.displayIndex?-e.displayIndex:0))},m=(t=o==null?void 0:o.CaptionLabel)!==null&&t!==void 0?t:mde,y=d.jsx(m,{id:e.id,displayMonth:e.displayMonth});return d.jsxs("div",{className:n.caption_dropdowns,style:s.caption_dropdowns,children:[d.jsx("div",{className:n.vhidden,children:y}),d.jsx(brt,{onChange:i,displayMonth:e.displayMonth}),d.jsx(wrt,{onChange:i,displayMonth:e.displayMonth})]})}function Ort(e){return d.jsx("svg",pi({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:d.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function krt(e){return d.jsx("svg",pi({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:d.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var Ok=V.forwardRef(function(e,t){var r=ca(),n=r.classNames,s=r.styles,o=[n.button_reset,n.button];e.className&&o.push(e.className);var h=o.join(" "),i=pi(pi({},s.button_reset),s.button);return e.style&&Object.assign(i,e.style),d.jsx("button",pi({},e,{ref:t,type:"button",className:h,style:i}))});function Nrt(e){var t,r,n=ca(),s=n.dir,o=n.locale,h=n.classNames,i=n.styles,m=n.labels,y=m.labelPrevious,S=m.labelNext,b=n.components;if(!e.nextMonth&&!e.previousMonth)return d.jsx(d.Fragment,{});var T=y(e.previousMonth,{locale:o}),A=[h.nav_button,h.nav_button_previous].join(" "),O=S(e.nextMonth,{locale:o}),P=[h.nav_button,h.nav_button_next].join(" "),I=(t=b==null?void 0:b.IconRight)!==null&&t!==void 0?t:krt,R=(r=b==null?void 0:b.IconLeft)!==null&&r!==void 0?r:Ort;return d.jsxs("div",{className:h.nav,style:i.nav,children:[!e.hidePrevious&&d.jsx(Ok,{name:"previous-month","aria-label":T,className:A,style:i.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:s==="rtl"?d.jsx(I,{className:h.nav_icon,style:i.nav_icon}):d.jsx(R,{className:h.nav_icon,style:i.nav_icon})}),!e.hideNext&&d.jsx(Ok,{name:"next-month","aria-label":O,className:P,style:i.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:s==="rtl"?d.jsx(R,{className:h.nav_icon,style:i.nav_icon}):d.jsx(I,{className:h.nav_icon,style:i.nav_icon})})]})}function yX(e){var t=ca().numberOfMonths,r=eA(),n=r.previousMonth,s=r.nextMonth,o=r.goToMonth,h=r.displayMonths,i=h.findIndex(function(O){return C5(e.displayMonth,O)}),m=i===0,y=i===h.length-1,S=t>1&&(m||!y),b=t>1&&(y||!m),T=function(){n&&o(n)},A=function(){s&&o(s)};return d.jsx(Nrt,{displayMonth:e.displayMonth,hideNext:S,hidePrevious:b,nextMonth:s,previousMonth:n,onPreviousClick:T,onNextClick:A})}function Irt(e){var t,r=ca(),n=r.classNames,s=r.disableNavigation,o=r.styles,h=r.captionLayout,i=r.components,m=(t=i==null?void 0:i.CaptionLabel)!==null&&t!==void 0?t:mde,y;return s?y=d.jsx(m,{id:e.id,displayMonth:e.displayMonth}):h==="dropdown"?y=d.jsx(gX,{displayMonth:e.displayMonth,id:e.id}):h==="dropdown-buttons"?y=d.jsxs(d.Fragment,{children:[d.jsx(gX,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),d.jsx(yX,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):y=d.jsxs(d.Fragment,{children:[d.jsx(m,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),d.jsx(yX,{displayMonth:e.displayMonth,id:e.id})]}),d.jsx("div",{className:n.caption,style:o.caption,children:y})}function Rrt(e){var t=ca(),r=t.footer,n=t.styles,s=t.classNames.tfoot;return r?d.jsx("tfoot",{className:s,style:n.tfoot,children:d.jsx("tr",{children:d.jsx("td",{colSpan:8,children:r})})}):d.jsx(d.Fragment,{})}function Mrt(e,t,r){for(var n=r?Pv(new Date):Gh(new Date,{locale:e,weekStartsOn:t}),s=[],o=0;o<7;o++){var h=cc(n,o);s.push(h)}return s}function Drt(){var e=ca(),t=e.classNames,r=e.styles,n=e.showWeekNumber,s=e.locale,o=e.weekStartsOn,h=e.ISOWeek,i=e.formatters.formatWeekdayName,m=e.labels.labelWeekday,y=Mrt(s,o,h);return d.jsxs("tr",{style:r.head_row,className:t.head_row,children:[n&&d.jsx("td",{style:r.head_cell,className:t.head_cell}),y.map(function(S,b){return d.jsx("th",{scope:"col",className:t.head_cell,style:r.head_cell,"aria-label":m(S,{locale:s}),children:i(S,{locale:s})},b)})]})}function Lrt(){var e,t=ca(),r=t.classNames,n=t.styles,s=t.components,o=(e=s==null?void 0:s.HeadRow)!==null&&e!==void 0?e:Drt;return d.jsx("thead",{style:n.head,className:r.head,children:d.jsx(o,{})})}function Frt(e){var t=ca(),r=t.locale,n=t.formatters.formatDay;return d.jsx(d.Fragment,{children:n(e.date,{locale:r})})}var hU=V.createContext(void 0);function zrt(e){if(!J2(e.initialProps)){var t={selected:void 0,modifiers:{disabled:[]}};return d.jsx(hU.Provider,{value:t,children:e.children})}return d.jsx(Brt,{initialProps:e.initialProps,children:e.children})}function Brt(e){var t=e.initialProps,r=e.children,n=t.selected,s=t.min,o=t.max,h=function(y,S,b){var T,A;(T=t.onDayClick)===null||T===void 0||T.call(t,y,S,b);var O=!!(S.selected&&s&&(n==null?void 0:n.length)===s);if(!O){var P=!!(!S.selected&&o&&(n==null?void 0:n.length)===o);if(!P){var I=n?fde([],n):[];if(S.selected){var R=I.findIndex(function(M){return Vc(y,M)});I.splice(R,1)}else I.push(y);(A=t.onSelect)===null||A===void 0||A.call(t,I,y,S,b)}}},i={disabled:[]};n&&i.disabled.push(function(y){var S=o&&n.length>o-1,b=n.some(function(T){return Vc(T,y)});return!!(S&&!b)});var m={selected:n,onDayClick:h,modifiers:i};return d.jsx(hU.Provider,{value:m,children:r})}function fU(){var e=V.useContext(hU);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}function $rt(e,t){var r=t||{},n=r.from,s=r.to;return n&&s?Vc(s,e)&&Vc(n,e)?void 0:Vc(s,e)?{from:s,to:void 0}:Vc(n,e)?void 0:SF(n,e)?{from:e,to:s}:{from:n,to:e}:s?SF(e,s)?{from:s,to:e}:{from:e,to:s}:n?bie(e,n)?{from:e,to:n}:{from:n,to:e}:{from:e,to:void 0}}var pU=V.createContext(void 0);function Urt(e){if(!Q2(e.initialProps)){var t={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return d.jsx(pU.Provider,{value:t,children:e.children})}return d.jsx(Vrt,{initialProps:e.initialProps,children:e.children})}function Vrt(e){var t=e.initialProps,r=e.children,n=t.selected,s=n||{},o=s.from,h=s.to,i=t.min,m=t.max,y=function(A,O,P){var I,R;(I=t.onDayClick)===null||I===void 0||I.call(t,A,O,P);var M=$rt(A,n);(R=t.onSelect)===null||R===void 0||R.call(t,M,A,O,P)},S={range_start:[],range_end:[],range_middle:[],disabled:[]};if(o?(S.range_start=[o],h?(S.range_end=[h],Vc(o,h)||(S.range_middle=[{after:o,before:h}])):S.range_end=[o]):h&&(S.range_start=[h],S.range_end=[h]),i&&(o&&!h&&S.disabled.push({after:dP(o,i-1),before:cc(o,i-1)}),o&&h&&S.disabled.push({after:o,before:cc(o,i-1)}),!o&&h&&S.disabled.push({after:dP(h,i-1),before:cc(h,i-1)})),m){if(o&&!h&&(S.disabled.push({before:cc(o,-m+1)}),S.disabled.push({after:cc(o,m-1)})),o&&h){var b=kh(h,o)+1,T=m-b;S.disabled.push({before:dP(o,T)}),S.disabled.push({after:cc(h,T)})}!o&&h&&(S.disabled.push({before:cc(h,-m+1)}),S.disabled.push({after:cc(h,m-1)}))}return d.jsx(pU.Provider,{value:{selected:n,onDayClick:y,modifiers:S},children:r})}function mU(){var e=V.useContext(pU);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function yP(e){return Array.isArray(e)?fde([],e):e!==void 0?[e]:[]}function qrt(e){var t={};return Object.entries(e).forEach(function(r){var n=r[0],s=r[1];t[n]=yP(s)}),t}var Xd;(function(e){e.Outside="outside",e.Disabled="disabled",e.Selected="selected",e.Hidden="hidden",e.Today="today",e.RangeStart="range_start",e.RangeEnd="range_end",e.RangeMiddle="range_middle"})(Xd||(Xd={}));var Hrt=Xd.Selected,Nf=Xd.Disabled,Grt=Xd.Hidden,Wrt=Xd.Today,jL=Xd.RangeEnd,PL=Xd.RangeMiddle,OL=Xd.RangeStart,Krt=Xd.Outside;function Zrt(e,t,r){var n,s=(n={},n[Hrt]=yP(e.selected),n[Nf]=yP(e.disabled),n[Grt]=yP(e.hidden),n[Wrt]=[e.today],n[jL]=[],n[PL]=[],n[OL]=[],n[Krt]=[],n);return e.fromDate&&s[Nf].push({before:e.fromDate}),e.toDate&&s[Nf].push({after:e.toDate}),J2(e)?s[Nf]=s[Nf].concat(t.modifiers[Nf]):Q2(e)&&(s[Nf]=s[Nf].concat(r.modifiers[Nf]),s[OL]=r.modifiers[OL],s[PL]=r.modifiers[PL],s[jL]=r.modifiers[jL]),s}var vde=V.createContext(void 0);function Xrt(e){var t=ca(),r=fU(),n=mU(),s=Zrt(t,r,n),o=qrt(t.modifiers),h=pi(pi({},s),o);return d.jsx(vde.Provider,{value:h,children:e.children})}function _de(){var e=V.useContext(vde);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function Yrt(e){return!!(e&&typeof e=="object"&&"before"in e&&"after"in e)}function Jrt(e){return!!(e&&typeof e=="object"&&"from"in e)}function Qrt(e){return!!(e&&typeof e=="object"&&"after"in e)}function ent(e){return!!(e&&typeof e=="object"&&"before"in e)}function tnt(e){return!!(e&&typeof e=="object"&&"dayOfWeek"in e)}function rnt(e,t){var r,n=t.from,s=t.to;if(n&&s){var o=kh(s,n)<0;o&&(r=[s,n],n=r[0],s=r[1]);var h=kh(e,n)>=0&&kh(s,e)>=0;return h}return s?Vc(s,e):n?Vc(n,e):!1}function nnt(e){return E5(e)}function int(e){return Array.isArray(e)&&e.every(E5)}function snt(e,t){return t.some(function(r){if(typeof r=="boolean")return r;if(nnt(r))return Vc(e,r);if(int(r))return r.includes(e);if(Jrt(r))return rnt(e,r);if(tnt(r))return r.dayOfWeek.includes(e.getDay());if(Yrt(r)){var n=kh(r.before,e),s=kh(r.after,e),o=n>0,h=s<0,i=SF(r.before,r.after);return i?h&&o:o||h}return Qrt(r)?kh(e,r.after)>0:ent(r)?kh(r.before,e)>0:typeof r=="function"?r(e):!1})}function gU(e,t,r){var n=Object.keys(t).reduce(function(o,h){var i=t[h];return snt(e,i)&&o.push(h),o},[]),s={};return n.forEach(function(o){return s[o]=!0}),r&&!C5(e,r)&&(s.outside=!0),s}function ant(e,t){for(var r=Kc(e[0]),n=ON(e[e.length-1]),s,o,h=r;h<=n;){var i=gU(h,t),m=!i.disabled&&!i.hidden;if(!m){h=cc(h,1);continue}if(i.selected)return h;i.today&&!o&&(o=h),s||(s=h),h=cc(h,1)}return o||s}var ont=365;function xde(e,t){var r=t.moveBy,n=t.direction,s=t.context,o=t.modifiers,h=t.retry,i=h===void 0?{count:0,lastFocused:e}:h,m=s.weekStartsOn,y=s.fromDate,S=s.toDate,b=s.locale,T={day:cc,week:wF,month:Zd,year:KCe,startOfWeek:function(I){return s.ISOWeek?Pv(I):Gh(I,{locale:b,weekStartsOn:m})},endOfWeek:function(I){return s.ISOWeek?gie(I):T5(I,{locale:b,weekStartsOn:m})}},A=T[r](e,n==="after"?1:-1);n==="before"&&y?A=ZCe([y,A]):n==="after"&&S&&(A=XCe([S,A]));var O=!0;if(o){var P=gU(A,o);O=!P.disabled&&!P.hidden}return O?A:i.count>ont?i.lastFocused:xde(A,{moveBy:r,direction:n,context:s,modifiers:o,retry:pi(pi({},i),{count:i.count+1})})}var bde=V.createContext(void 0);function lnt(e){var t=eA(),r=_de(),n=V.useState(),s=n[0],o=n[1],h=V.useState(),i=h[0],m=h[1],y=ant(t.displayMonths,r),S=s??(i&&t.isDateDisplayed(i))?i:y,b=function(){m(s),o(void 0)},T=function(I){o(I)},A=ca(),O=function(I,R){if(s){var M=xde(s,{moveBy:I,direction:R,context:A,modifiers:r});Vc(s,M)||(t.goToDate(M,s),T(M))}},P={focusedDay:s,focusTarget:S,blur:b,focus:T,focusDayAfter:function(){return O("day","after")},focusDayBefore:function(){return O("day","before")},focusWeekAfter:function(){return O("week","after")},focusWeekBefore:function(){return O("week","before")},focusMonthBefore:function(){return O("month","before")},focusMonthAfter:function(){return O("month","after")},focusYearBefore:function(){return O("year","before")},focusYearAfter:function(){return O("year","after")},focusStartOfWeek:function(){return O("startOfWeek","before")},focusEndOfWeek:function(){return O("endOfWeek","after")}};return d.jsx(bde.Provider,{value:P,children:e.children})}function yU(){var e=V.useContext(bde);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}function cnt(e,t){var r=_de(),n=gU(e,r,t);return n}var vU=V.createContext(void 0);function unt(e){if(!$I(e.initialProps)){var t={selected:void 0};return d.jsx(vU.Provider,{value:t,children:e.children})}return d.jsx(dnt,{initialProps:e.initialProps,children:e.children})}function dnt(e){var t=e.initialProps,r=e.children,n=function(o,h,i){var m,y,S;if((m=t.onDayClick)===null||m===void 0||m.call(t,o,h,i),h.selected&&!t.required){(y=t.onSelect)===null||y===void 0||y.call(t,void 0,o,h,i);return}(S=t.onSelect)===null||S===void 0||S.call(t,o,o,h,i)},s={selected:t.selected,onDayClick:n};return d.jsx(vU.Provider,{value:s,children:r})}function wde(){var e=V.useContext(vU);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function hnt(e,t){var r=ca(),n=wde(),s=fU(),o=mU(),h=yU(),i=h.focusDayAfter,m=h.focusDayBefore,y=h.focusWeekAfter,S=h.focusWeekBefore,b=h.blur,T=h.focus,A=h.focusMonthBefore,O=h.focusMonthAfter,P=h.focusYearBefore,I=h.focusYearAfter,R=h.focusStartOfWeek,M=h.focusEndOfWeek,F=function(Ce){var _e,me,Ae,ge;$I(r)?(_e=n.onDayClick)===null||_e===void 0||_e.call(n,e,t,Ce):J2(r)?(me=s.onDayClick)===null||me===void 0||me.call(s,e,t,Ce):Q2(r)?(Ae=o.onDayClick)===null||Ae===void 0||Ae.call(o,e,t,Ce):(ge=r.onDayClick)===null||ge===void 0||ge.call(r,e,t,Ce)},z=function(Ce){var _e;T(e),(_e=r.onDayFocus)===null||_e===void 0||_e.call(r,e,t,Ce)},$=function(Ce){var _e;b(),(_e=r.onDayBlur)===null||_e===void 0||_e.call(r,e,t,Ce)},W=function(Ce){var _e;(_e=r.onDayMouseEnter)===null||_e===void 0||_e.call(r,e,t,Ce)},K=function(Ce){var _e;(_e=r.onDayMouseLeave)===null||_e===void 0||_e.call(r,e,t,Ce)},ee=function(Ce){var _e;(_e=r.onDayPointerEnter)===null||_e===void 0||_e.call(r,e,t,Ce)},ne=function(Ce){var _e;(_e=r.onDayPointerLeave)===null||_e===void 0||_e.call(r,e,t,Ce)},ie=function(Ce){var _e;(_e=r.onDayTouchCancel)===null||_e===void 0||_e.call(r,e,t,Ce)},re=function(Ce){var _e;(_e=r.onDayTouchEnd)===null||_e===void 0||_e.call(r,e,t,Ce)},te=function(Ce){var _e;(_e=r.onDayTouchMove)===null||_e===void 0||_e.call(r,e,t,Ce)},ae=function(Ce){var _e;(_e=r.onDayTouchStart)===null||_e===void 0||_e.call(r,e,t,Ce)},ue=function(Ce){var _e;(_e=r.onDayKeyUp)===null||_e===void 0||_e.call(r,e,t,Ce)},be=function(Ce){var _e;switch(Ce.key){case"ArrowLeft":Ce.preventDefault(),Ce.stopPropagation(),r.dir==="rtl"?i():m();break;case"ArrowRight":Ce.preventDefault(),Ce.stopPropagation(),r.dir==="rtl"?m():i();break;case"ArrowDown":Ce.preventDefault(),Ce.stopPropagation(),y();break;case"ArrowUp":Ce.preventDefault(),Ce.stopPropagation(),S();break;case"PageUp":Ce.preventDefault(),Ce.stopPropagation(),Ce.shiftKey?P():A();break;case"PageDown":Ce.preventDefault(),Ce.stopPropagation(),Ce.shiftKey?I():O();break;case"Home":Ce.preventDefault(),Ce.stopPropagation(),R();break;case"End":Ce.preventDefault(),Ce.stopPropagation(),M();break}(_e=r.onDayKeyDown)===null||_e===void 0||_e.call(r,e,t,Ce)},we={onClick:F,onFocus:z,onBlur:$,onKeyDown:be,onKeyUp:ue,onMouseEnter:W,onMouseLeave:K,onPointerEnter:ee,onPointerLeave:ne,onTouchCancel:ie,onTouchEnd:re,onTouchMove:te,onTouchStart:ae};return we}function fnt(){var e=ca(),t=wde(),r=fU(),n=mU(),s=$I(e)?t.selected:J2(e)?r.selected:Q2(e)?n.selected:void 0;return s}function pnt(e){return Object.values(Xd).includes(e)}function mnt(e,t){var r=[e.classNames.day];return Object.keys(t).forEach(function(n){var s=e.modifiersClassNames[n];if(s)r.push(s);else if(pnt(n)){var o=e.classNames["day_".concat(n)];o&&r.push(o)}}),r}function gnt(e,t){var r=pi({},e.styles.day);return Object.keys(t).forEach(function(n){var s;r=pi(pi({},r),(s=e.modifiersStyles)===null||s===void 0?void 0:s[n])}),r}function ynt(e,t,r){var n,s,o,h=ca(),i=yU(),m=cnt(e,t),y=hnt(e,m),S=fnt(),b=!!(h.onDayClick||h.mode!=="default");V.useEffect(function(){var W;m.outside||i.focusedDay&&b&&Vc(i.focusedDay,e)&&((W=r.current)===null||W===void 0||W.focus())},[i.focusedDay,e,r,b,m.outside]);var T=mnt(h,m).join(" "),A=gnt(h,m),O=!!(m.outside&&!h.showOutsideDays||m.hidden),P=(o=(s=h.components)===null||s===void 0?void 0:s.DayContent)!==null&&o!==void 0?o:Frt,I=d.jsx(P,{date:e,displayMonth:t,activeModifiers:m}),R={style:A,className:T,children:I,role:"gridcell"},M=i.focusTarget&&Vc(i.focusTarget,e)&&!m.outside,F=i.focusedDay&&Vc(i.focusedDay,e),z=pi(pi(pi({},R),(n={disabled:m.disabled,role:"gridcell"},n["aria-selected"]=m.selected,n.tabIndex=F||M?0:-1,n)),y),$={isButton:b,isHidden:O,activeModifiers:m,selectedDays:S,buttonProps:z,divProps:R};return $}function vnt(e){var t=V.useRef(null),r=ynt(e.date,e.displayMonth,t);return r.isHidden?d.jsx("div",{role:"gridcell"}):r.isButton?d.jsx(Ok,pi({name:"day",ref:t},r.buttonProps)):d.jsx("div",pi({},r.divProps))}function _nt(e){var t=e.number,r=e.dates,n=ca(),s=n.onWeekNumberClick,o=n.styles,h=n.classNames,i=n.locale,m=n.labels.labelWeekNumber,y=n.formatters.formatWeekNumber,S=y(Number(t),{locale:i});if(!s)return d.jsx("span",{className:h.weeknumber,style:o.weeknumber,children:S});var b=m(Number(t),{locale:i}),T=function(A){s(t,r,A)};return d.jsx(Ok,{name:"week-number","aria-label":b,className:h.weeknumber,style:o.weeknumber,onClick:T,children:S})}function xnt(e){var t,r,n=ca(),s=n.styles,o=n.classNames,h=n.showWeekNumber,i=n.components,m=(t=i==null?void 0:i.Day)!==null&&t!==void 0?t:vnt,y=(r=i==null?void 0:i.WeekNumber)!==null&&r!==void 0?r:_nt,S;return h&&(S=d.jsx("td",{className:o.cell,style:s.cell,children:d.jsx(y,{number:e.weekNumber,dates:e.dates})})),d.jsxs("tr",{className:o.row,style:s.row,children:[S,e.dates.map(function(b){return d.jsx("td",{className:o.cell,style:s.cell,role:"presentation",children:d.jsx(m,{displayMonth:e.displayMonth,date:b})},nPe(b))})]})}function vX(e,t,r){for(var n=r!=null&&r.ISOWeek?gie(t):T5(t,r),s=r!=null&&r.ISOWeek?Pv(e):Gh(e,r),o=kh(n,s),h=[],i=0;i<=o;i++)h.push(cc(s,i));var m=h.reduce(function(y,S){var b=r!=null&&r.ISOWeek?yie(S):_ie(S,r),T=y.find(function(A){return A.weekNumber===b});return T?(T.dates.push(S),y):(y.push({weekNumber:b,dates:[S]}),y)},[]);return m}function bnt(e,t){var r=vX(Kc(e),ON(e),t);if(t!=null&&t.useFixedWeeks){var n=sPe(e,t);if(n<6){var s=r[r.length-1],o=s.dates[s.dates.length-1],h=wF(o,6-n),i=vX(wF(o,1),h,t);r.push.apply(r,i)}}return r}function wnt(e){var t,r,n,s=ca(),o=s.locale,h=s.classNames,i=s.styles,m=s.hideHead,y=s.fixedWeeks,S=s.components,b=s.weekStartsOn,T=s.firstWeekContainsDate,A=s.ISOWeek,O=bnt(e.displayMonth,{useFixedWeeks:!!y,ISOWeek:A,locale:o,weekStartsOn:b,firstWeekContainsDate:T}),P=(t=S==null?void 0:S.Head)!==null&&t!==void 0?t:Lrt,I=(r=S==null?void 0:S.Row)!==null&&r!==void 0?r:xnt,R=(n=S==null?void 0:S.Footer)!==null&&n!==void 0?n:Rrt;return d.jsxs("table",{id:e.id,className:h.table,style:i.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!m&&d.jsx(P,{}),d.jsx("tbody",{className:h.tbody,style:i.tbody,children:O.map(function(M){return d.jsx(I,{displayMonth:e.displayMonth,dates:M.dates,weekNumber:M.weekNumber},M.weekNumber)})}),d.jsx(R,{displayMonth:e.displayMonth})]})}function Snt(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var Ent=Snt()?V.useLayoutEffect:V.useEffect,kL=!1,Tnt=0;function _X(){return"react-day-picker-".concat(++Tnt)}function Ant(e){var t,r=e??(kL?_X():null),n=V.useState(r),s=n[0],o=n[1];return Ent(function(){s===null&&o(_X())},[]),V.useEffect(function(){kL===!1&&(kL=!0)},[]),(t=e??s)!==null&&t!==void 0?t:void 0}function Cnt(e){var t,r,n=ca(),s=n.dir,o=n.classNames,h=n.styles,i=n.components,m=eA().displayMonths,y=Ant(n.id?"".concat(n.id,"-").concat(e.displayIndex):void 0),S=n.id?"".concat(n.id,"-grid-").concat(e.displayIndex):void 0,b=[o.month],T=h.month,A=e.displayIndex===0,O=e.displayIndex===m.length-1,P=!A&&!O;s==="rtl"&&(t=[A,O],O=t[0],A=t[1]),A&&(b.push(o.caption_start),T=pi(pi({},T),h.caption_start)),O&&(b.push(o.caption_end),T=pi(pi({},T),h.caption_end)),P&&(b.push(o.caption_between),T=pi(pi({},T),h.caption_between));var I=(r=i==null?void 0:i.Caption)!==null&&r!==void 0?r:Irt;return d.jsxs("div",{className:b.join(" "),style:T,children:[d.jsx(I,{id:y,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),d.jsx(wnt,{id:S,"aria-labelledby":y,displayMonth:e.displayMonth})]},e.displayIndex)}function jnt(e){var t=ca(),r=t.classNames,n=t.styles;return d.jsx("div",{className:r.months,style:n.months,children:e.children})}function Pnt(e){var t,r,n=e.initialProps,s=ca(),o=yU(),h=eA(),i=V.useState(!1),m=i[0],y=i[1];V.useEffect(function(){s.initialFocus&&o.focusTarget&&(m||(o.focus(o.focusTarget),y(!0)))},[s.initialFocus,m,o.focus,o.focusTarget,o]);var S=[s.classNames.root,s.className];s.numberOfMonths>1&&S.push(s.classNames.multiple_months),s.showWeekNumber&&S.push(s.classNames.with_weeknumber);var b=pi(pi({},s.styles.root),s.style),T=Object.keys(n).filter(function(O){return O.startsWith("data-")}).reduce(function(O,P){var I;return pi(pi({},O),(I={},I[P]=n[P],I))},{}),A=(r=(t=n.components)===null||t===void 0?void 0:t.Months)!==null&&r!==void 0?r:jnt;return d.jsx("div",pi({className:S.join(" "),style:b,dir:s.dir,id:s.id,nonce:n.nonce,title:n.title,lang:n.lang},T,{children:d.jsx(A,{children:h.displayMonths.map(function(O,P){return d.jsx(Cnt,{displayIndex:P,displayMonth:O},P)})})}))}function Ont(e){var t=e.children,r=ert(e,["children"]);return d.jsx(_rt,{initialProps:r,children:d.jsx(Prt,{children:d.jsx(unt,{initialProps:r,children:d.jsx(zrt,{initialProps:r,children:d.jsx(Urt,{initialProps:r,children:d.jsx(Xrt,{children:d.jsx(lnt,{children:t})})})})})})})}function knt(e){return d.jsx(Ont,pi({},e,{children:d.jsx(Pnt,{initialProps:e})}))}function v4({className:e,classNames:t,showOutsideDays:r=!0,...n}){return d.jsx(knt,{showOutsideDays:r,className:fr("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:fr(cb({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:fr(cb({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...s})=>d.jsx(Jk,{className:"h-4 w-4"}),IconRight:({...s})=>d.jsx(Qk,{className:"h-4 w-4"})},...n})}v4.displayName="Calendar";var Sde={exports:{}};/*!
 * Quill Editor v1.3.7
 * https://quilljs.com/
 * Copyright (c) 2014, Jason Chen
 * Copyright (c) 2013, salesforce.com
 */(function(e,t){(function(n,s){e.exports=s()})(typeof self<"u"?self:$c,function(){return function(r){var n={};function s(o){if(n[o])return n[o].exports;var h=n[o]={i:o,l:!1,exports:{}};return r[o].call(h.exports,h,h.exports,s),h.l=!0,h.exports}return s.m=r,s.c=n,s.d=function(o,h,i){s.o(o,h)||Object.defineProperty(o,h,{configurable:!1,enumerable:!0,get:i})},s.n=function(o){var h=o&&o.__esModule?function(){return o.default}:function(){return o};return s.d(h,"a",h),h},s.o=function(o,h){return Object.prototype.hasOwnProperty.call(o,h)},s.p="",s(s.s=109)}([function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(17),h=s(18),i=s(19),m=s(45),y=s(46),S=s(47),b=s(48),T=s(49),A=s(12),O=s(32),P=s(33),I=s(31),R=s(1),M={Scope:R.Scope,create:R.create,find:R.find,query:R.query,register:R.register,Container:o.default,Format:h.default,Leaf:i.default,Embed:b.default,Scroll:m.default,Block:S.default,Inline:y.default,Text:T.default,Attributor:{Attribute:A.default,Class:O.default,Style:P.default,Store:I.default}};n.default=M},function(r,n,s){var o=this&&this.__extends||function(){var I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,M){R.__proto__=M}||function(R,M){for(var F in M)M.hasOwnProperty(F)&&(R[F]=M[F])};return function(R,M){I(R,M);function F(){this.constructor=R}R.prototype=M===null?Object.create(M):(F.prototype=M.prototype,new F)}}();Object.defineProperty(n,"__esModule",{value:!0});var h=function(I){o(R,I);function R(M){var F=this;return M="[Parchment] "+M,F=I.call(this,M)||this,F.message=M,F.name=F.constructor.name,F}return R}(Error);n.ParchmentError=h;var i={},m={},y={},S={};n.DATA_KEY="__blot";var b;(function(I){I[I.TYPE=3]="TYPE",I[I.LEVEL=12]="LEVEL",I[I.ATTRIBUTE=13]="ATTRIBUTE",I[I.BLOT=14]="BLOT",I[I.INLINE=7]="INLINE",I[I.BLOCK=11]="BLOCK",I[I.BLOCK_BLOT=10]="BLOCK_BLOT",I[I.INLINE_BLOT=6]="INLINE_BLOT",I[I.BLOCK_ATTRIBUTE=9]="BLOCK_ATTRIBUTE",I[I.INLINE_ATTRIBUTE=5]="INLINE_ATTRIBUTE",I[I.ANY=15]="ANY"})(b=n.Scope||(n.Scope={}));function T(I,R){var M=O(I);if(M==null)throw new h("Unable to create "+I+" blot");var F=M,z=I instanceof Node||I.nodeType===Node.TEXT_NODE?I:F.create(R);return new F(z,R)}n.create=T;function A(I,R){return R===void 0&&(R=!1),I==null?null:I[n.DATA_KEY]!=null?I[n.DATA_KEY].blot:R?A(I.parentNode,R):null}n.find=A;function O(I,R){R===void 0&&(R=b.ANY);var M;if(typeof I=="string")M=S[I]||i[I];else if(I instanceof Text||I.nodeType===Node.TEXT_NODE)M=S.text;else if(typeof I=="number")I&b.LEVEL&b.BLOCK?M=S.block:I&b.LEVEL&b.INLINE&&(M=S.inline);else if(I instanceof HTMLElement){var F=(I.getAttribute("class")||"").split(/\s+/);for(var z in F)if(M=m[F[z]],M)break;M=M||y[I.tagName]}return M==null?null:R&b.LEVEL&M.scope&&R&b.TYPE&M.scope?M:null}n.query=O;function P(){for(var I=[],R=0;R<arguments.length;R++)I[R]=arguments[R];if(I.length>1)return I.map(function(z){return P(z)});var M=I[0];if(typeof M.blotName!="string"&&typeof M.attrName!="string")throw new h("Invalid definition");if(M.blotName==="abstract")throw new h("Cannot register abstract class");if(S[M.blotName||M.attrName]=M,typeof M.keyName=="string")i[M.keyName]=M;else if(M.className!=null&&(m[M.className]=M),M.tagName!=null){Array.isArray(M.tagName)?M.tagName=M.tagName.map(function(z){return z.toUpperCase()}):M.tagName=M.tagName.toUpperCase();var F=Array.isArray(M.tagName)?M.tagName:[M.tagName];F.forEach(function(z){(y[z]==null||M.className==null)&&(y[z]=M)})}return M}n.register=P},function(r,n,s){var o=s(51),h=s(11),i=s(3),m=s(20),y="\0",S=function(b){Array.isArray(b)?this.ops=b:b!=null&&Array.isArray(b.ops)?this.ops=b.ops:this.ops=[]};S.prototype.insert=function(b,T){var A={};return b.length===0?this:(A.insert=b,T!=null&&typeof T=="object"&&Object.keys(T).length>0&&(A.attributes=T),this.push(A))},S.prototype.delete=function(b){return b<=0?this:this.push({delete:b})},S.prototype.retain=function(b,T){if(b<=0)return this;var A={retain:b};return T!=null&&typeof T=="object"&&Object.keys(T).length>0&&(A.attributes=T),this.push(A)},S.prototype.push=function(b){var T=this.ops.length,A=this.ops[T-1];if(b=i(!0,{},b),typeof A=="object"){if(typeof b.delete=="number"&&typeof A.delete=="number")return this.ops[T-1]={delete:A.delete+b.delete},this;if(typeof A.delete=="number"&&b.insert!=null&&(T-=1,A=this.ops[T-1],typeof A!="object"))return this.ops.unshift(b),this;if(h(b.attributes,A.attributes)){if(typeof b.insert=="string"&&typeof A.insert=="string")return this.ops[T-1]={insert:A.insert+b.insert},typeof b.attributes=="object"&&(this.ops[T-1].attributes=b.attributes),this;if(typeof b.retain=="number"&&typeof A.retain=="number")return this.ops[T-1]={retain:A.retain+b.retain},typeof b.attributes=="object"&&(this.ops[T-1].attributes=b.attributes),this}}return T===this.ops.length?this.ops.push(b):this.ops.splice(T,0,b),this},S.prototype.chop=function(){var b=this.ops[this.ops.length-1];return b&&b.retain&&!b.attributes&&this.ops.pop(),this},S.prototype.filter=function(b){return this.ops.filter(b)},S.prototype.forEach=function(b){this.ops.forEach(b)},S.prototype.map=function(b){return this.ops.map(b)},S.prototype.partition=function(b){var T=[],A=[];return this.forEach(function(O){var P=b(O)?T:A;P.push(O)}),[T,A]},S.prototype.reduce=function(b,T){return this.ops.reduce(b,T)},S.prototype.changeLength=function(){return this.reduce(function(b,T){return T.insert?b+m.length(T):T.delete?b-T.delete:b},0)},S.prototype.length=function(){return this.reduce(function(b,T){return b+m.length(T)},0)},S.prototype.slice=function(b,T){b=b||0,typeof T!="number"&&(T=1/0);for(var A=[],O=m.iterator(this.ops),P=0;P<T&&O.hasNext();){var I;P<b?I=O.next(b-P):(I=O.next(T-P),A.push(I)),P+=m.length(I)}return new S(A)},S.prototype.compose=function(b){var T=m.iterator(this.ops),A=m.iterator(b.ops),O=[],P=A.peek();if(P!=null&&typeof P.retain=="number"&&P.attributes==null){for(var I=P.retain;T.peekType()==="insert"&&T.peekLength()<=I;)I-=T.peekLength(),O.push(T.next());P.retain-I>0&&A.next(P.retain-I)}for(var R=new S(O);T.hasNext()||A.hasNext();)if(A.peekType()==="insert")R.push(A.next());else if(T.peekType()==="delete")R.push(T.next());else{var M=Math.min(T.peekLength(),A.peekLength()),F=T.next(M),z=A.next(M);if(typeof z.retain=="number"){var $={};typeof F.retain=="number"?$.retain=M:$.insert=F.insert;var W=m.attributes.compose(F.attributes,z.attributes,typeof F.retain=="number");if(W&&($.attributes=W),R.push($),!A.hasNext()&&h(R.ops[R.ops.length-1],$)){var K=new S(T.rest());return R.concat(K).chop()}}else typeof z.delete=="number"&&typeof F.retain=="number"&&R.push(z)}return R.chop()},S.prototype.concat=function(b){var T=new S(this.ops.slice());return b.ops.length>0&&(T.push(b.ops[0]),T.ops=T.ops.concat(b.ops.slice(1))),T},S.prototype.diff=function(b,T){if(this.ops===b.ops)return new S;var A=[this,b].map(function(M){return M.map(function(F){if(F.insert!=null)return typeof F.insert=="string"?F.insert:y;var z=M===b?"on":"with";throw new Error("diff() called "+z+" non-document")}).join("")}),O=new S,P=o(A[0],A[1],T),I=m.iterator(this.ops),R=m.iterator(b.ops);return P.forEach(function(M){for(var F=M[1].length;F>0;){var z=0;switch(M[0]){case o.INSERT:z=Math.min(R.peekLength(),F),O.push(R.next(z));break;case o.DELETE:z=Math.min(F,I.peekLength()),I.next(z),O.delete(z);break;case o.EQUAL:z=Math.min(I.peekLength(),R.peekLength(),F);var $=I.next(z),W=R.next(z);h($.insert,W.insert)?O.retain(z,m.attributes.diff($.attributes,W.attributes)):O.push(W).delete(z);break}F-=z}}),O.chop()},S.prototype.eachLine=function(b,T){T=T||`
`;for(var A=m.iterator(this.ops),O=new S,P=0;A.hasNext();){if(A.peekType()!=="insert")return;var I=A.peek(),R=m.length(I)-A.peekLength(),M=typeof I.insert=="string"?I.insert.indexOf(T,R)-R:-1;if(M<0)O.push(A.next());else if(M>0)O.push(A.next(M));else{if(b(O,A.next(1).attributes||{},P)===!1)return;P+=1,O=new S}}O.length()>0&&b(O,{},P)},S.prototype.transform=function(b,T){if(T=!!T,typeof b=="number")return this.transformPosition(b,T);for(var A=m.iterator(this.ops),O=m.iterator(b.ops),P=new S;A.hasNext()||O.hasNext();)if(A.peekType()==="insert"&&(T||O.peekType()!=="insert"))P.retain(m.length(A.next()));else if(O.peekType()==="insert")P.push(O.next());else{var I=Math.min(A.peekLength(),O.peekLength()),R=A.next(I),M=O.next(I);if(R.delete)continue;M.delete?P.push(M):P.retain(I,m.attributes.transform(R.attributes,M.attributes,T))}return P.chop()},S.prototype.transformPosition=function(b,T){T=!!T;for(var A=m.iterator(this.ops),O=0;A.hasNext()&&O<=b;){var P=A.peekLength(),I=A.peekType();if(A.next(),I==="delete"){b-=Math.min(P,b-O);continue}else I==="insert"&&(O<b||!T)&&(b+=P);O+=P}return b},r.exports=S},function(r,n){var s=Object.prototype.hasOwnProperty,o=Object.prototype.toString,h=Object.defineProperty,i=Object.getOwnPropertyDescriptor,m=function(A){return typeof Array.isArray=="function"?Array.isArray(A):o.call(A)==="[object Array]"},y=function(A){if(!A||o.call(A)!=="[object Object]")return!1;var O=s.call(A,"constructor"),P=A.constructor&&A.constructor.prototype&&s.call(A.constructor.prototype,"isPrototypeOf");if(A.constructor&&!O&&!P)return!1;var I;for(I in A);return typeof I>"u"||s.call(A,I)},S=function(A,O){h&&O.name==="__proto__"?h(A,O.name,{enumerable:!0,configurable:!0,value:O.newValue,writable:!0}):A[O.name]=O.newValue},b=function(A,O){if(O==="__proto__")if(s.call(A,O)){if(i)return i(A,O).value}else return;return A[O]};r.exports=function T(){var A,O,P,I,R,M,F=arguments[0],z=1,$=arguments.length,W=!1;for(typeof F=="boolean"&&(W=F,F=arguments[1]||{},z=2),(F==null||typeof F!="object"&&typeof F!="function")&&(F={});z<$;++z)if(A=arguments[z],A!=null)for(O in A)P=b(F,O),I=b(A,O),F!==I&&(W&&I&&(y(I)||(R=m(I)))?(R?(R=!1,M=P&&m(P)?P:[]):M=P&&y(P)?P:{},S(F,{name:O,newValue:T(W,M,I)})):typeof I<"u"&&S(F,{name:O,newValue:I}));return F}},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.BlockEmbed=n.bubbleFormats=void 0;var o=function(){function re(te,ae){for(var ue=0;ue<ae.length;ue++){var be=ae[ue];be.enumerable=be.enumerable||!1,be.configurable=!0,"value"in be&&(be.writable=!0),Object.defineProperty(te,be.key,be)}}return function(te,ae,ue){return ae&&re(te.prototype,ae),ue&&re(te,ue),te}}(),h=function re(te,ae,ue){te===null&&(te=Function.prototype);var be=Object.getOwnPropertyDescriptor(te,ae);if(be===void 0){var we=Object.getPrototypeOf(te);return we===null?void 0:re(we,ae,ue)}else{if("value"in be)return be.value;var Ce=be.get;return Ce===void 0?void 0:Ce.call(ue)}},i=s(3),m=F(i),y=s(2),S=F(y),b=s(0),T=F(b),A=s(16),O=F(A),P=s(6),I=F(P),R=s(7),M=F(R);function F(re){return re&&re.__esModule?re:{default:re}}function z(re,te){if(!(re instanceof te))throw new TypeError("Cannot call a class as a function")}function $(re,te){if(!re)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return te&&(typeof te=="object"||typeof te=="function")?te:re}function W(re,te){if(typeof te!="function"&&te!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof te);re.prototype=Object.create(te&&te.prototype,{constructor:{value:re,enumerable:!1,writable:!0,configurable:!0}}),te&&(Object.setPrototypeOf?Object.setPrototypeOf(re,te):re.__proto__=te)}var K=1,ee=function(re){W(te,re);function te(){return z(this,te),$(this,(te.__proto__||Object.getPrototypeOf(te)).apply(this,arguments))}return o(te,[{key:"attach",value:function(){h(te.prototype.__proto__||Object.getPrototypeOf(te.prototype),"attach",this).call(this),this.attributes=new T.default.Attributor.Store(this.domNode)}},{key:"delta",value:function(){return new S.default().insert(this.value(),(0,m.default)(this.formats(),this.attributes.values()))}},{key:"format",value:function(ue,be){var we=T.default.query(ue,T.default.Scope.BLOCK_ATTRIBUTE);we!=null&&this.attributes.attribute(we,be)}},{key:"formatAt",value:function(ue,be,we,Ce){this.format(we,Ce)}},{key:"insertAt",value:function(ue,be,we){if(typeof be=="string"&&be.endsWith(`
`)){var Ce=T.default.create(ne.blotName);this.parent.insertBefore(Ce,ue===0?this:this.next),Ce.insertAt(0,be.slice(0,-1))}else h(te.prototype.__proto__||Object.getPrototypeOf(te.prototype),"insertAt",this).call(this,ue,be,we)}}]),te}(T.default.Embed);ee.scope=T.default.Scope.BLOCK_BLOT;var ne=function(re){W(te,re);function te(ae){z(this,te);var ue=$(this,(te.__proto__||Object.getPrototypeOf(te)).call(this,ae));return ue.cache={},ue}return o(te,[{key:"delta",value:function(){return this.cache.delta==null&&(this.cache.delta=this.descendants(T.default.Leaf).reduce(function(ue,be){return be.length()===0?ue:ue.insert(be.value(),ie(be))},new S.default).insert(`
`,ie(this))),this.cache.delta}},{key:"deleteAt",value:function(ue,be){h(te.prototype.__proto__||Object.getPrototypeOf(te.prototype),"deleteAt",this).call(this,ue,be),this.cache={}}},{key:"formatAt",value:function(ue,be,we,Ce){be<=0||(T.default.query(we,T.default.Scope.BLOCK)?ue+be===this.length()&&this.format(we,Ce):h(te.prototype.__proto__||Object.getPrototypeOf(te.prototype),"formatAt",this).call(this,ue,Math.min(be,this.length()-ue-1),we,Ce),this.cache={})}},{key:"insertAt",value:function(ue,be,we){if(we!=null)return h(te.prototype.__proto__||Object.getPrototypeOf(te.prototype),"insertAt",this).call(this,ue,be,we);if(be.length!==0){var Ce=be.split(`
`),_e=Ce.shift();_e.length>0&&(ue<this.length()-1||this.children.tail==null?h(te.prototype.__proto__||Object.getPrototypeOf(te.prototype),"insertAt",this).call(this,Math.min(ue,this.length()-1),_e):this.children.tail.insertAt(this.children.tail.length(),_e),this.cache={});var me=this;Ce.reduce(function(Ae,ge){return me=me.split(Ae,!0),me.insertAt(0,ge),ge.length},ue+_e.length)}}},{key:"insertBefore",value:function(ue,be){var we=this.children.head;h(te.prototype.__proto__||Object.getPrototypeOf(te.prototype),"insertBefore",this).call(this,ue,be),we instanceof O.default&&we.remove(),this.cache={}}},{key:"length",value:function(){return this.cache.length==null&&(this.cache.length=h(te.prototype.__proto__||Object.getPrototypeOf(te.prototype),"length",this).call(this)+K),this.cache.length}},{key:"moveChildren",value:function(ue,be){h(te.prototype.__proto__||Object.getPrototypeOf(te.prototype),"moveChildren",this).call(this,ue,be),this.cache={}}},{key:"optimize",value:function(ue){h(te.prototype.__proto__||Object.getPrototypeOf(te.prototype),"optimize",this).call(this,ue),this.cache={}}},{key:"path",value:function(ue){return h(te.prototype.__proto__||Object.getPrototypeOf(te.prototype),"path",this).call(this,ue,!0)}},{key:"removeChild",value:function(ue){h(te.prototype.__proto__||Object.getPrototypeOf(te.prototype),"removeChild",this).call(this,ue),this.cache={}}},{key:"split",value:function(ue){var be=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(be&&(ue===0||ue>=this.length()-K)){var we=this.clone();return ue===0?(this.parent.insertBefore(we,this),this):(this.parent.insertBefore(we,this.next),we)}else{var Ce=h(te.prototype.__proto__||Object.getPrototypeOf(te.prototype),"split",this).call(this,ue,be);return this.cache={},Ce}}}]),te}(T.default.Block);ne.blotName="block",ne.tagName="P",ne.defaultChild="break",ne.allowedChildren=[I.default,T.default.Embed,M.default];function ie(re){var te=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return re==null||(typeof re.formats=="function"&&(te=(0,m.default)(te,re.formats())),re.parent==null||re.parent.blotName=="scroll"||re.parent.statics.scope!==re.statics.scope)?te:ie(re.parent,te)}n.bubbleFormats=ie,n.BlockEmbed=ee,n.default=ne},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.overload=n.expandConfig=void 0;var o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(me){return typeof me}:function(me){return me&&typeof Symbol=="function"&&me.constructor===Symbol&&me!==Symbol.prototype?"symbol":typeof me},h=function(){function me(Ae,ge){var pe=[],Oe=!0,Je=!1,Ze=void 0;try{for(var Pe=Ae[Symbol.iterator](),Be;!(Oe=(Be=Pe.next()).done)&&(pe.push(Be.value),!(ge&&pe.length===ge));Oe=!0);}catch(nt){Je=!0,Ze=nt}finally{try{!Oe&&Pe.return&&Pe.return()}finally{if(Je)throw Ze}}return pe}return function(Ae,ge){if(Array.isArray(Ae))return Ae;if(Symbol.iterator in Object(Ae))return me(Ae,ge);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function me(Ae,ge){for(var pe=0;pe<ge.length;pe++){var Oe=ge[pe];Oe.enumerable=Oe.enumerable||!1,Oe.configurable=!0,"value"in Oe&&(Oe.writable=!0),Object.defineProperty(Ae,Oe.key,Oe)}}return function(Ae,ge,pe){return ge&&me(Ae.prototype,ge),pe&&me(Ae,pe),Ae}}();s(50);var m=s(2),y=ie(m),S=s(14),b=ie(S),T=s(8),A=ie(T),O=s(9),P=ie(O),I=s(0),R=ie(I),M=s(15),F=ie(M),z=s(3),$=ie(z),W=s(10),K=ie(W),ee=s(34),ne=ie(ee);function ie(me){return me&&me.__esModule?me:{default:me}}function re(me,Ae,ge){return Ae in me?Object.defineProperty(me,Ae,{value:ge,enumerable:!0,configurable:!0,writable:!0}):me[Ae]=ge,me}function te(me,Ae){if(!(me instanceof Ae))throw new TypeError("Cannot call a class as a function")}var ae=(0,K.default)("quill"),ue=function(){i(me,null,[{key:"debug",value:function(ge){ge===!0&&(ge="log"),K.default.level(ge)}},{key:"find",value:function(ge){return ge.__quill||R.default.find(ge)}},{key:"import",value:function(ge){return this.imports[ge]==null&&ae.error("Cannot import "+ge+". Are you sure it was registered?"),this.imports[ge]}},{key:"register",value:function(ge,pe){var Oe=this,Je=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(typeof ge!="string"){var Ze=ge.attrName||ge.blotName;typeof Ze=="string"?this.register("formats/"+Ze,ge,pe):Object.keys(ge).forEach(function(Pe){Oe.register(Pe,ge[Pe],pe)})}else this.imports[ge]!=null&&!Je&&ae.warn("Overwriting "+ge+" with",pe),this.imports[ge]=pe,(ge.startsWith("blots/")||ge.startsWith("formats/"))&&pe.blotName!=="abstract"?R.default.register(pe):ge.startsWith("modules")&&typeof pe.register=="function"&&pe.register()}}]);function me(Ae){var ge=this,pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(te(this,me),this.options=be(Ae,pe),this.container=this.options.container,this.container==null)return ae.error("Invalid Quill container",Ae);this.options.debug&&me.debug(this.options.debug);var Oe=this.container.innerHTML.trim();this.container.classList.add("ql-container"),this.container.innerHTML="",this.container.__quill=this,this.root=this.addContainer("ql-editor"),this.root.classList.add("ql-blank"),this.root.setAttribute("data-gramm",!1),this.scrollingContainer=this.options.scrollingContainer||this.root,this.emitter=new A.default,this.scroll=R.default.create(this.root,{emitter:this.emitter,whitelist:this.options.formats}),this.editor=new b.default(this.scroll),this.selection=new F.default(this.scroll,this.emitter),this.theme=new this.options.theme(this,this.options),this.keyboard=this.theme.addModule("keyboard"),this.clipboard=this.theme.addModule("clipboard"),this.history=this.theme.addModule("history"),this.theme.init(),this.emitter.on(A.default.events.EDITOR_CHANGE,function(Ze){Ze===A.default.events.TEXT_CHANGE&&ge.root.classList.toggle("ql-blank",ge.editor.isBlank())}),this.emitter.on(A.default.events.SCROLL_UPDATE,function(Ze,Pe){var Be=ge.selection.lastRange,nt=Be&&Be.length===0?Be.index:void 0;we.call(ge,function(){return ge.editor.update(null,Pe,nt)},Ze)});var Je=this.clipboard.convert(`<div class='ql-editor' style="white-space: normal;">`+Oe+"<p><br></p></div>");this.setContents(Je),this.history.clear(),this.options.placeholder&&this.root.setAttribute("data-placeholder",this.options.placeholder),this.options.readOnly&&this.disable()}return i(me,[{key:"addContainer",value:function(ge){var pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(typeof ge=="string"){var Oe=ge;ge=document.createElement("div"),ge.classList.add(Oe)}return this.container.insertBefore(ge,pe),ge}},{key:"blur",value:function(){this.selection.setRange(null)}},{key:"deleteText",value:function(ge,pe,Oe){var Je=this,Ze=Ce(ge,pe,Oe),Pe=h(Ze,4);return ge=Pe[0],pe=Pe[1],Oe=Pe[3],we.call(this,function(){return Je.editor.deleteText(ge,pe)},Oe,ge,-1*pe)}},{key:"disable",value:function(){this.enable(!1)}},{key:"enable",value:function(){var ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.scroll.enable(ge),this.container.classList.toggle("ql-disabled",!ge)}},{key:"focus",value:function(){var ge=this.scrollingContainer.scrollTop;this.selection.focus(),this.scrollingContainer.scrollTop=ge,this.scrollIntoView()}},{key:"format",value:function(ge,pe){var Oe=this,Je=arguments.length>2&&arguments[2]!==void 0?arguments[2]:A.default.sources.API;return we.call(this,function(){var Ze=Oe.getSelection(!0),Pe=new y.default;if(Ze==null)return Pe;if(R.default.query(ge,R.default.Scope.BLOCK))Pe=Oe.editor.formatLine(Ze.index,Ze.length,re({},ge,pe));else{if(Ze.length===0)return Oe.selection.format(ge,pe),Pe;Pe=Oe.editor.formatText(Ze.index,Ze.length,re({},ge,pe))}return Oe.setSelection(Ze,A.default.sources.SILENT),Pe},Je)}},{key:"formatLine",value:function(ge,pe,Oe,Je,Ze){var Pe=this,Be=void 0,nt=Ce(ge,pe,Oe,Je,Ze),Me=h(nt,4);return ge=Me[0],pe=Me[1],Be=Me[2],Ze=Me[3],we.call(this,function(){return Pe.editor.formatLine(ge,pe,Be)},Ze,ge,0)}},{key:"formatText",value:function(ge,pe,Oe,Je,Ze){var Pe=this,Be=void 0,nt=Ce(ge,pe,Oe,Je,Ze),Me=h(nt,4);return ge=Me[0],pe=Me[1],Be=Me[2],Ze=Me[3],we.call(this,function(){return Pe.editor.formatText(ge,pe,Be)},Ze,ge,0)}},{key:"getBounds",value:function(ge){var pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,Oe=void 0;typeof ge=="number"?Oe=this.selection.getBounds(ge,pe):Oe=this.selection.getBounds(ge.index,ge.length);var Je=this.container.getBoundingClientRect();return{bottom:Oe.bottom-Je.top,height:Oe.height,left:Oe.left-Je.left,right:Oe.right-Je.left,top:Oe.top-Je.top,width:Oe.width}}},{key:"getContents",value:function(){var ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-ge,Oe=Ce(ge,pe),Je=h(Oe,2);return ge=Je[0],pe=Je[1],this.editor.getContents(ge,pe)}},{key:"getFormat",value:function(){var ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.getSelection(!0),pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return typeof ge=="number"?this.editor.getFormat(ge,pe):this.editor.getFormat(ge.index,ge.length)}},{key:"getIndex",value:function(ge){return ge.offset(this.scroll)}},{key:"getLength",value:function(){return this.scroll.length()}},{key:"getLeaf",value:function(ge){return this.scroll.leaf(ge)}},{key:"getLine",value:function(ge){return this.scroll.line(ge)}},{key:"getLines",value:function(){var ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;return typeof ge!="number"?this.scroll.lines(ge.index,ge.length):this.scroll.lines(ge,pe)}},{key:"getModule",value:function(ge){return this.theme.modules[ge]}},{key:"getSelection",value:function(){var ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return ge&&this.focus(),this.update(),this.selection.getRange()[0]}},{key:"getText",value:function(){var ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-ge,Oe=Ce(ge,pe),Je=h(Oe,2);return ge=Je[0],pe=Je[1],this.editor.getText(ge,pe)}},{key:"hasFocus",value:function(){return this.selection.hasFocus()}},{key:"insertEmbed",value:function(ge,pe,Oe){var Je=this,Ze=arguments.length>3&&arguments[3]!==void 0?arguments[3]:me.sources.API;return we.call(this,function(){return Je.editor.insertEmbed(ge,pe,Oe)},Ze,ge)}},{key:"insertText",value:function(ge,pe,Oe,Je,Ze){var Pe=this,Be=void 0,nt=Ce(ge,0,Oe,Je,Ze),Me=h(nt,4);return ge=Me[0],Be=Me[2],Ze=Me[3],we.call(this,function(){return Pe.editor.insertText(ge,pe,Be)},Ze,ge,pe.length)}},{key:"isEnabled",value:function(){return!this.container.classList.contains("ql-disabled")}},{key:"off",value:function(){return this.emitter.off.apply(this.emitter,arguments)}},{key:"on",value:function(){return this.emitter.on.apply(this.emitter,arguments)}},{key:"once",value:function(){return this.emitter.once.apply(this.emitter,arguments)}},{key:"pasteHTML",value:function(ge,pe,Oe){this.clipboard.dangerouslyPasteHTML(ge,pe,Oe)}},{key:"removeFormat",value:function(ge,pe,Oe){var Je=this,Ze=Ce(ge,pe,Oe),Pe=h(Ze,4);return ge=Pe[0],pe=Pe[1],Oe=Pe[3],we.call(this,function(){return Je.editor.removeFormat(ge,pe)},Oe,ge)}},{key:"scrollIntoView",value:function(){this.selection.scrollIntoView(this.scrollingContainer)}},{key:"setContents",value:function(ge){var pe=this,Oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:A.default.sources.API;return we.call(this,function(){ge=new y.default(ge);var Je=pe.getLength(),Ze=pe.editor.deleteText(0,Je),Pe=pe.editor.applyDelta(ge),Be=Pe.ops[Pe.ops.length-1];Be!=null&&typeof Be.insert=="string"&&Be.insert[Be.insert.length-1]===`
`&&(pe.editor.deleteText(pe.getLength()-1,1),Pe.delete(1));var nt=Ze.compose(Pe);return nt},Oe)}},{key:"setSelection",value:function(ge,pe,Oe){if(ge==null)this.selection.setRange(null,pe||me.sources.API);else{var Je=Ce(ge,pe,Oe),Ze=h(Je,4);ge=Ze[0],pe=Ze[1],Oe=Ze[3],this.selection.setRange(new M.Range(ge,pe),Oe),Oe!==A.default.sources.SILENT&&this.selection.scrollIntoView(this.scrollingContainer)}}},{key:"setText",value:function(ge){var pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:A.default.sources.API,Oe=new y.default().insert(ge);return this.setContents(Oe,pe)}},{key:"update",value:function(){var ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:A.default.sources.USER,pe=this.scroll.update(ge);return this.selection.update(ge),pe}},{key:"updateContents",value:function(ge){var pe=this,Oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:A.default.sources.API;return we.call(this,function(){return ge=new y.default(ge),pe.editor.applyDelta(ge,Oe)},Oe,!0)}}]),me}();ue.DEFAULTS={bounds:null,formats:null,modules:{},placeholder:"",readOnly:!1,scrollingContainer:null,strict:!0,theme:"default"},ue.events=A.default.events,ue.sources=A.default.sources,ue.version="1.3.7",ue.imports={delta:y.default,parchment:R.default,"core/module":P.default,"core/theme":ne.default};function be(me,Ae){if(Ae=(0,$.default)(!0,{container:me,modules:{clipboard:!0,keyboard:!0,history:!0}},Ae),!Ae.theme||Ae.theme===ue.DEFAULTS.theme)Ae.theme=ne.default;else if(Ae.theme=ue.import("themes/"+Ae.theme),Ae.theme==null)throw new Error("Invalid theme "+Ae.theme+". Did you register it?");var ge=(0,$.default)(!0,{},Ae.theme.DEFAULTS);[ge,Ae].forEach(function(Je){Je.modules=Je.modules||{},Object.keys(Je.modules).forEach(function(Ze){Je.modules[Ze]===!0&&(Je.modules[Ze]={})})});var pe=Object.keys(ge.modules).concat(Object.keys(Ae.modules)),Oe=pe.reduce(function(Je,Ze){var Pe=ue.import("modules/"+Ze);return Pe==null?ae.error("Cannot load "+Ze+" module. Are you sure you registered it?"):Je[Ze]=Pe.DEFAULTS||{},Je},{});return Ae.modules!=null&&Ae.modules.toolbar&&Ae.modules.toolbar.constructor!==Object&&(Ae.modules.toolbar={container:Ae.modules.toolbar}),Ae=(0,$.default)(!0,{},ue.DEFAULTS,{modules:Oe},ge,Ae),["bounds","container","scrollingContainer"].forEach(function(Je){typeof Ae[Je]=="string"&&(Ae[Je]=document.querySelector(Ae[Je]))}),Ae.modules=Object.keys(Ae.modules).reduce(function(Je,Ze){return Ae.modules[Ze]&&(Je[Ze]=Ae.modules[Ze]),Je},{}),Ae}function we(me,Ae,ge,pe){if(this.options.strict&&!this.isEnabled()&&Ae===A.default.sources.USER)return new y.default;var Oe=ge==null?null:this.getSelection(),Je=this.editor.delta,Ze=me();if(Oe!=null&&(ge===!0&&(ge=Oe.index),pe==null?Oe=_e(Oe,Ze,Ae):pe!==0&&(Oe=_e(Oe,ge,pe,Ae)),this.setSelection(Oe,A.default.sources.SILENT)),Ze.length()>0){var Pe,Be=[A.default.events.TEXT_CHANGE,Ze,Je,Ae];if((Pe=this.emitter).emit.apply(Pe,[A.default.events.EDITOR_CHANGE].concat(Be)),Ae!==A.default.sources.SILENT){var nt;(nt=this.emitter).emit.apply(nt,Be)}}return Ze}function Ce(me,Ae,ge,pe,Oe){var Je={};return typeof me.index=="number"&&typeof me.length=="number"?typeof Ae!="number"?(Oe=pe,pe=ge,ge=Ae,Ae=me.length,me=me.index):(Ae=me.length,me=me.index):typeof Ae!="number"&&(Oe=pe,pe=ge,ge=Ae,Ae=0),(typeof ge>"u"?"undefined":o(ge))==="object"?(Je=ge,Oe=pe):typeof ge=="string"&&(pe!=null?Je[ge]=pe:Oe=ge),Oe=Oe||A.default.sources.API,[me,Ae,Je,Oe]}function _e(me,Ae,ge,pe){if(me==null)return null;var Oe=void 0,Je=void 0;if(Ae instanceof y.default){var Ze=[me.index,me.index+me.length].map(function(Me){return Ae.transformPosition(Me,pe!==A.default.sources.USER)}),Pe=h(Ze,2);Oe=Pe[0],Je=Pe[1]}else{var Be=[me.index,me.index+me.length].map(function(Me){return Me<Ae||Me===Ae&&pe===A.default.sources.USER?Me:ge>=0?Me+ge:Math.max(Ae,Me+ge)}),nt=h(Be,2);Oe=nt[0],Je=nt[1]}return new M.Range(Oe,Je-Oe)}n.expandConfig=be,n.overload=Ce,n.default=ue},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function I(R,M){for(var F=0;F<M.length;F++){var z=M[F];z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z&&(z.writable=!0),Object.defineProperty(R,z.key,z)}}return function(R,M,F){return M&&I(R.prototype,M),F&&I(R,F),R}}(),h=function I(R,M,F){R===null&&(R=Function.prototype);var z=Object.getOwnPropertyDescriptor(R,M);if(z===void 0){var $=Object.getPrototypeOf(R);return $===null?void 0:I($,M,F)}else{if("value"in z)return z.value;var W=z.get;return W===void 0?void 0:W.call(F)}},i=s(7),m=b(i),y=s(0),S=b(y);function b(I){return I&&I.__esModule?I:{default:I}}function T(I,R){if(!(I instanceof R))throw new TypeError("Cannot call a class as a function")}function A(I,R){if(!I)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R&&(typeof R=="object"||typeof R=="function")?R:I}function O(I,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof R);I.prototype=Object.create(R&&R.prototype,{constructor:{value:I,enumerable:!1,writable:!0,configurable:!0}}),R&&(Object.setPrototypeOf?Object.setPrototypeOf(I,R):I.__proto__=R)}var P=function(I){O(R,I);function R(){return T(this,R),A(this,(R.__proto__||Object.getPrototypeOf(R)).apply(this,arguments))}return o(R,[{key:"formatAt",value:function(F,z,$,W){if(R.compare(this.statics.blotName,$)<0&&S.default.query($,S.default.Scope.BLOT)){var K=this.isolate(F,z);W&&K.wrap($,W)}else h(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"formatAt",this).call(this,F,z,$,W)}},{key:"optimize",value:function(F){if(h(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"optimize",this).call(this,F),this.parent instanceof R&&R.compare(this.statics.blotName,this.parent.statics.blotName)>0){var z=this.parent.isolate(this.offset(),this.length());this.moveChildren(z),z.wrap(this)}}}],[{key:"compare",value:function(F,z){var $=R.order.indexOf(F),W=R.order.indexOf(z);return $>=0||W>=0?$-W:F===z?0:F<z?-1:1}}]),R}(S.default.Inline);P.allowedChildren=[P,S.default.Embed,m.default],P.order=["cursor","inline","underline","strike","italic","bold","script","link","code"],n.default=P},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(0),h=i(o);function i(T){return T&&T.__esModule?T:{default:T}}function m(T,A){if(!(T instanceof A))throw new TypeError("Cannot call a class as a function")}function y(T,A){if(!T)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A&&(typeof A=="object"||typeof A=="function")?A:T}function S(T,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof A);T.prototype=Object.create(A&&A.prototype,{constructor:{value:T,enumerable:!1,writable:!0,configurable:!0}}),A&&(Object.setPrototypeOf?Object.setPrototypeOf(T,A):T.__proto__=A)}var b=function(T){S(A,T);function A(){return m(this,A),y(this,(A.__proto__||Object.getPrototypeOf(A)).apply(this,arguments))}return A}(h.default.Text);n.default=b},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function M(F,z){for(var $=0;$<z.length;$++){var W=z[$];W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(F,W.key,W)}}return function(F,z,$){return z&&M(F.prototype,z),$&&M(F,$),F}}(),h=function M(F,z,$){F===null&&(F=Function.prototype);var W=Object.getOwnPropertyDescriptor(F,z);if(W===void 0){var K=Object.getPrototypeOf(F);return K===null?void 0:M(K,z,$)}else{if("value"in W)return W.value;var ee=W.get;return ee===void 0?void 0:ee.call($)}},i=s(54),m=b(i),y=s(10),S=b(y);function b(M){return M&&M.__esModule?M:{default:M}}function T(M,F){if(!(M instanceof F))throw new TypeError("Cannot call a class as a function")}function A(M,F){if(!M)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return F&&(typeof F=="object"||typeof F=="function")?F:M}function O(M,F){if(typeof F!="function"&&F!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof F);M.prototype=Object.create(F&&F.prototype,{constructor:{value:M,enumerable:!1,writable:!0,configurable:!0}}),F&&(Object.setPrototypeOf?Object.setPrototypeOf(M,F):M.__proto__=F)}var P=(0,S.default)("quill:events"),I=["selectionchange","mousedown","mouseup","click"];I.forEach(function(M){document.addEventListener(M,function(){for(var F=arguments.length,z=Array(F),$=0;$<F;$++)z[$]=arguments[$];[].slice.call(document.querySelectorAll(".ql-container")).forEach(function(W){if(W.__quill&&W.__quill.emitter){var K;(K=W.__quill.emitter).handleDOM.apply(K,z)}})})});var R=function(M){O(F,M);function F(){T(this,F);var z=A(this,(F.__proto__||Object.getPrototypeOf(F)).call(this));return z.listeners={},z.on("error",P.error),z}return o(F,[{key:"emit",value:function(){P.log.apply(P,arguments),h(F.prototype.__proto__||Object.getPrototypeOf(F.prototype),"emit",this).apply(this,arguments)}},{key:"handleDOM",value:function($){for(var W=arguments.length,K=Array(W>1?W-1:0),ee=1;ee<W;ee++)K[ee-1]=arguments[ee];(this.listeners[$.type]||[]).forEach(function(ne){var ie=ne.node,re=ne.handler;($.target===ie||ie.contains($.target))&&re.apply(void 0,[$].concat(K))})}},{key:"listenDOM",value:function($,W,K){this.listeners[$]||(this.listeners[$]=[]),this.listeners[$].push({node:W,handler:K})}}]),F}(m.default);R.events={EDITOR_CHANGE:"editor-change",SCROLL_BEFORE_UPDATE:"scroll-before-update",SCROLL_OPTIMIZE:"scroll-optimize",SCROLL_UPDATE:"scroll-update",SELECTION_CHANGE:"selection-change",TEXT_CHANGE:"text-change"},R.sources={API:"api",SILENT:"silent",USER:"user"},n.default=R},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});function o(i,m){if(!(i instanceof m))throw new TypeError("Cannot call a class as a function")}var h=function i(m){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};o(this,i),this.quill=m,this.options=y};h.DEFAULTS={},n.default=h},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=["error","warn","log","info"],h="warn";function i(y){if(o.indexOf(y)<=o.indexOf(h)){for(var S,b=arguments.length,T=Array(b>1?b-1:0),A=1;A<b;A++)T[A-1]=arguments[A];(S=console)[y].apply(S,T)}}function m(y){return o.reduce(function(S,b){return S[b]=i.bind(console,b,y),S},{})}i.level=m.level=function(y){h=y},n.default=m},function(r,n,s){var o=Array.prototype.slice,h=s(52),i=s(53),m=r.exports=function(T,A,O){return O||(O={}),T===A?!0:T instanceof Date&&A instanceof Date?T.getTime()===A.getTime():!T||!A||typeof T!="object"&&typeof A!="object"?O.strict?T===A:T==A:b(T,A,O)};function y(T){return T==null}function S(T){return!(!T||typeof T!="object"||typeof T.length!="number"||typeof T.copy!="function"||typeof T.slice!="function"||T.length>0&&typeof T[0]!="number")}function b(T,A,O){var P,I;if(y(T)||y(A)||T.prototype!==A.prototype)return!1;if(i(T))return i(A)?(T=o.call(T),A=o.call(A),m(T,A,O)):!1;if(S(T)){if(!S(A)||T.length!==A.length)return!1;for(P=0;P<T.length;P++)if(T[P]!==A[P])return!1;return!0}try{var R=h(T),M=h(A)}catch{return!1}if(R.length!=M.length)return!1;for(R.sort(),M.sort(),P=R.length-1;P>=0;P--)if(R[P]!=M[P])return!1;for(P=R.length-1;P>=0;P--)if(I=R[P],!m(T[I],A[I],O))return!1;return typeof T==typeof A}},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(1),h=function(){function i(m,y,S){S===void 0&&(S={}),this.attrName=m,this.keyName=y;var b=o.Scope.TYPE&o.Scope.ATTRIBUTE;S.scope!=null?this.scope=S.scope&o.Scope.LEVEL|b:this.scope=o.Scope.ATTRIBUTE,S.whitelist!=null&&(this.whitelist=S.whitelist)}return i.keys=function(m){return[].map.call(m.attributes,function(y){return y.name})},i.prototype.add=function(m,y){return this.canAdd(m,y)?(m.setAttribute(this.keyName,y),!0):!1},i.prototype.canAdd=function(m,y){var S=o.query(m,o.Scope.BLOT&(this.scope|o.Scope.TYPE));return S==null?!1:this.whitelist==null?!0:typeof y=="string"?this.whitelist.indexOf(y.replace(/["']/g,""))>-1:this.whitelist.indexOf(y)>-1},i.prototype.remove=function(m){m.removeAttribute(this.keyName)},i.prototype.value=function(m){var y=m.getAttribute(this.keyName);return this.canAdd(m,y)&&y?y:""},i}();n.default=h},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.Code=void 0;var o=function(){function ee(ne,ie){var re=[],te=!0,ae=!1,ue=void 0;try{for(var be=ne[Symbol.iterator](),we;!(te=(we=be.next()).done)&&(re.push(we.value),!(ie&&re.length===ie));te=!0);}catch(Ce){ae=!0,ue=Ce}finally{try{!te&&be.return&&be.return()}finally{if(ae)throw ue}}return re}return function(ne,ie){if(Array.isArray(ne))return ne;if(Symbol.iterator in Object(ne))return ee(ne,ie);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function(){function ee(ne,ie){for(var re=0;re<ie.length;re++){var te=ie[re];te.enumerable=te.enumerable||!1,te.configurable=!0,"value"in te&&(te.writable=!0),Object.defineProperty(ne,te.key,te)}}return function(ne,ie,re){return ie&&ee(ne.prototype,ie),re&&ee(ne,re),ne}}(),i=function ee(ne,ie,re){ne===null&&(ne=Function.prototype);var te=Object.getOwnPropertyDescriptor(ne,ie);if(te===void 0){var ae=Object.getPrototypeOf(ne);return ae===null?void 0:ee(ae,ie,re)}else{if("value"in te)return te.value;var ue=te.get;return ue===void 0?void 0:ue.call(re)}},m=s(2),y=M(m),S=s(0),b=M(S),T=s(4),A=M(T),O=s(6),P=M(O),I=s(7),R=M(I);function M(ee){return ee&&ee.__esModule?ee:{default:ee}}function F(ee,ne){if(!(ee instanceof ne))throw new TypeError("Cannot call a class as a function")}function z(ee,ne){if(!ee)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ne&&(typeof ne=="object"||typeof ne=="function")?ne:ee}function $(ee,ne){if(typeof ne!="function"&&ne!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof ne);ee.prototype=Object.create(ne&&ne.prototype,{constructor:{value:ee,enumerable:!1,writable:!0,configurable:!0}}),ne&&(Object.setPrototypeOf?Object.setPrototypeOf(ee,ne):ee.__proto__=ne)}var W=function(ee){$(ne,ee);function ne(){return F(this,ne),z(this,(ne.__proto__||Object.getPrototypeOf(ne)).apply(this,arguments))}return ne}(P.default);W.blotName="code",W.tagName="CODE";var K=function(ee){$(ne,ee);function ne(){return F(this,ne),z(this,(ne.__proto__||Object.getPrototypeOf(ne)).apply(this,arguments))}return h(ne,[{key:"delta",value:function(){var re=this,te=this.domNode.textContent;return te.endsWith(`
`)&&(te=te.slice(0,-1)),te.split(`
`).reduce(function(ae,ue){return ae.insert(ue).insert(`
`,re.formats())},new y.default)}},{key:"format",value:function(re,te){if(!(re===this.statics.blotName&&te)){var ae=this.descendant(R.default,this.length()-1),ue=o(ae,1),be=ue[0];be!=null&&be.deleteAt(be.length()-1,1),i(ne.prototype.__proto__||Object.getPrototypeOf(ne.prototype),"format",this).call(this,re,te)}}},{key:"formatAt",value:function(re,te,ae,ue){if(te!==0&&!(b.default.query(ae,b.default.Scope.BLOCK)==null||ae===this.statics.blotName&&ue===this.statics.formats(this.domNode))){var be=this.newlineIndex(re);if(!(be<0||be>=re+te)){var we=this.newlineIndex(re,!0)+1,Ce=be-we+1,_e=this.isolate(we,Ce),me=_e.next;_e.format(ae,ue),me instanceof ne&&me.formatAt(0,re-we+te-Ce,ae,ue)}}}},{key:"insertAt",value:function(re,te,ae){if(ae==null){var ue=this.descendant(R.default,re),be=o(ue,2),we=be[0],Ce=be[1];we.insertAt(Ce,te)}}},{key:"length",value:function(){var re=this.domNode.textContent.length;return this.domNode.textContent.endsWith(`
`)?re:re+1}},{key:"newlineIndex",value:function(re){var te=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(te)return this.domNode.textContent.slice(0,re).lastIndexOf(`
`);var ae=this.domNode.textContent.slice(re).indexOf(`
`);return ae>-1?re+ae:-1}},{key:"optimize",value:function(re){this.domNode.textContent.endsWith(`
`)||this.appendChild(b.default.create("text",`
`)),i(ne.prototype.__proto__||Object.getPrototypeOf(ne.prototype),"optimize",this).call(this,re);var te=this.next;te!=null&&te.prev===this&&te.statics.blotName===this.statics.blotName&&this.statics.formats(this.domNode)===te.statics.formats(te.domNode)&&(te.optimize(re),te.moveChildren(this),te.remove())}},{key:"replace",value:function(re){i(ne.prototype.__proto__||Object.getPrototypeOf(ne.prototype),"replace",this).call(this,re),[].slice.call(this.domNode.querySelectorAll("*")).forEach(function(te){var ae=b.default.find(te);ae==null?te.parentNode.removeChild(te):ae instanceof b.default.Embed?ae.remove():ae.unwrap()})}}],[{key:"create",value:function(re){var te=i(ne.__proto__||Object.getPrototypeOf(ne),"create",this).call(this,re);return te.setAttribute("spellcheck",!1),te}},{key:"formats",value:function(){return!0}}]),ne}(A.default);K.blotName="code-block",K.tagName="PRE",K.TAB="  ",n.Code=W,n.default=K},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(me){return typeof me}:function(me){return me&&typeof Symbol=="function"&&me.constructor===Symbol&&me!==Symbol.prototype?"symbol":typeof me},h=function(){function me(Ae,ge){var pe=[],Oe=!0,Je=!1,Ze=void 0;try{for(var Pe=Ae[Symbol.iterator](),Be;!(Oe=(Be=Pe.next()).done)&&(pe.push(Be.value),!(ge&&pe.length===ge));Oe=!0);}catch(nt){Je=!0,Ze=nt}finally{try{!Oe&&Pe.return&&Pe.return()}finally{if(Je)throw Ze}}return pe}return function(Ae,ge){if(Array.isArray(Ae))return Ae;if(Symbol.iterator in Object(Ae))return me(Ae,ge);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function me(Ae,ge){for(var pe=0;pe<ge.length;pe++){var Oe=ge[pe];Oe.enumerable=Oe.enumerable||!1,Oe.configurable=!0,"value"in Oe&&(Oe.writable=!0),Object.defineProperty(Ae,Oe.key,Oe)}}return function(Ae,ge,pe){return ge&&me(Ae.prototype,ge),pe&&me(Ae,pe),Ae}}(),m=s(2),y=te(m),S=s(20),b=te(S),T=s(0),A=te(T),O=s(13),P=te(O),I=s(24),R=te(I),M=s(4),F=te(M),z=s(16),$=te(z),W=s(21),K=te(W),ee=s(11),ne=te(ee),ie=s(3),re=te(ie);function te(me){return me&&me.__esModule?me:{default:me}}function ae(me,Ae,ge){return Ae in me?Object.defineProperty(me,Ae,{value:ge,enumerable:!0,configurable:!0,writable:!0}):me[Ae]=ge,me}function ue(me,Ae){if(!(me instanceof Ae))throw new TypeError("Cannot call a class as a function")}var be=/^[ -~]*$/,we=function(){function me(Ae){ue(this,me),this.scroll=Ae,this.delta=this.getDelta()}return i(me,[{key:"applyDelta",value:function(ge){var pe=this,Oe=!1;this.scroll.update();var Je=this.scroll.length();return this.scroll.batchStart(),ge=_e(ge),ge.reduce(function(Ze,Pe){var Be=Pe.retain||Pe.delete||Pe.insert.length||1,nt=Pe.attributes||{};if(Pe.insert!=null){if(typeof Pe.insert=="string"){var Me=Pe.insert;Me.endsWith(`
`)&&Oe&&(Oe=!1,Me=Me.slice(0,-1)),Ze>=Je&&!Me.endsWith(`
`)&&(Oe=!0),pe.scroll.insertAt(Ze,Me);var We=pe.scroll.line(Ze),gt=h(We,2),rt=gt[0],Ht=gt[1],Lt=(0,re.default)({},(0,M.bubbleFormats)(rt));if(rt instanceof F.default){var nr=rt.descendant(A.default.Leaf,Ht),Rr=h(nr,1),Dr=Rr[0];Lt=(0,re.default)(Lt,(0,M.bubbleFormats)(Dr))}nt=b.default.attributes.diff(Lt,nt)||{}}else if(o(Pe.insert)==="object"){var Pt=Object.keys(Pe.insert)[0];if(Pt==null)return Ze;pe.scroll.insertAt(Ze,Pt,Pe.insert[Pt])}Je+=Be}return Object.keys(nt).forEach(function(wt){pe.scroll.formatAt(Ze,Be,wt,nt[wt])}),Ze+Be},0),ge.reduce(function(Ze,Pe){return typeof Pe.delete=="number"?(pe.scroll.deleteAt(Ze,Pe.delete),Ze):Ze+(Pe.retain||Pe.insert.length||1)},0),this.scroll.batchEnd(),this.update(ge)}},{key:"deleteText",value:function(ge,pe){return this.scroll.deleteAt(ge,pe),this.update(new y.default().retain(ge).delete(pe))}},{key:"formatLine",value:function(ge,pe){var Oe=this,Je=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.scroll.update(),Object.keys(Je).forEach(function(Ze){if(!(Oe.scroll.whitelist!=null&&!Oe.scroll.whitelist[Ze])){var Pe=Oe.scroll.lines(ge,Math.max(pe,1)),Be=pe;Pe.forEach(function(nt){var Me=nt.length();if(!(nt instanceof P.default))nt.format(Ze,Je[Ze]);else{var We=ge-nt.offset(Oe.scroll),gt=nt.newlineIndex(We+Be)-We+1;nt.formatAt(We,gt,Ze,Je[Ze])}Be-=Me})}}),this.scroll.optimize(),this.update(new y.default().retain(ge).retain(pe,(0,K.default)(Je)))}},{key:"formatText",value:function(ge,pe){var Oe=this,Je=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Object.keys(Je).forEach(function(Ze){Oe.scroll.formatAt(ge,pe,Ze,Je[Ze])}),this.update(new y.default().retain(ge).retain(pe,(0,K.default)(Je)))}},{key:"getContents",value:function(ge,pe){return this.delta.slice(ge,ge+pe)}},{key:"getDelta",value:function(){return this.scroll.lines().reduce(function(ge,pe){return ge.concat(pe.delta())},new y.default)}},{key:"getFormat",value:function(ge){var pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,Oe=[],Je=[];pe===0?this.scroll.path(ge).forEach(function(Pe){var Be=h(Pe,1),nt=Be[0];nt instanceof F.default?Oe.push(nt):nt instanceof A.default.Leaf&&Je.push(nt)}):(Oe=this.scroll.lines(ge,pe),Je=this.scroll.descendants(A.default.Leaf,ge,pe));var Ze=[Oe,Je].map(function(Pe){if(Pe.length===0)return{};for(var Be=(0,M.bubbleFormats)(Pe.shift());Object.keys(Be).length>0;){var nt=Pe.shift();if(nt==null)return Be;Be=Ce((0,M.bubbleFormats)(nt),Be)}return Be});return re.default.apply(re.default,Ze)}},{key:"getText",value:function(ge,pe){return this.getContents(ge,pe).filter(function(Oe){return typeof Oe.insert=="string"}).map(function(Oe){return Oe.insert}).join("")}},{key:"insertEmbed",value:function(ge,pe,Oe){return this.scroll.insertAt(ge,pe,Oe),this.update(new y.default().retain(ge).insert(ae({},pe,Oe)))}},{key:"insertText",value:function(ge,pe){var Oe=this,Je=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return pe=pe.replace(/\r\n/g,`
`).replace(/\r/g,`
`),this.scroll.insertAt(ge,pe),Object.keys(Je).forEach(function(Ze){Oe.scroll.formatAt(ge,pe.length,Ze,Je[Ze])}),this.update(new y.default().retain(ge).insert(pe,(0,K.default)(Je)))}},{key:"isBlank",value:function(){if(this.scroll.children.length==0)return!0;if(this.scroll.children.length>1)return!1;var ge=this.scroll.children.head;return ge.statics.blotName!==F.default.blotName||ge.children.length>1?!1:ge.children.head instanceof $.default}},{key:"removeFormat",value:function(ge,pe){var Oe=this.getText(ge,pe),Je=this.scroll.line(ge+pe),Ze=h(Je,2),Pe=Ze[0],Be=Ze[1],nt=0,Me=new y.default;Pe!=null&&(Pe instanceof P.default?nt=Pe.newlineIndex(Be)-Be+1:nt=Pe.length()-Be,Me=Pe.delta().slice(Be,Be+nt-1).insert(`
`));var We=this.getContents(ge,pe+nt),gt=We.diff(new y.default().insert(Oe).concat(Me)),rt=new y.default().retain(ge).concat(gt);return this.applyDelta(rt)}},{key:"update",value:function(ge){var pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],Oe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,Je=this.delta;if(pe.length===1&&pe[0].type==="characterData"&&pe[0].target.data.match(be)&&A.default.find(pe[0].target)){var Ze=A.default.find(pe[0].target),Pe=(0,M.bubbleFormats)(Ze),Be=Ze.offset(this.scroll),nt=pe[0].oldValue.replace(R.default.CONTENTS,""),Me=new y.default().insert(nt),We=new y.default().insert(Ze.value()),gt=new y.default().retain(Be).concat(Me.diff(We,Oe));ge=gt.reduce(function(rt,Ht){return Ht.insert?rt.insert(Ht.insert,Pe):rt.push(Ht)},new y.default),this.delta=Je.compose(ge)}else this.delta=this.getDelta(),(!ge||!(0,ne.default)(Je.compose(ge),this.delta))&&(ge=Je.diff(this.delta,Oe));return ge}}]),me}();function Ce(me,Ae){return Object.keys(Ae).reduce(function(ge,pe){return me[pe]==null||(Ae[pe]===me[pe]?ge[pe]=Ae[pe]:Array.isArray(Ae[pe])?Ae[pe].indexOf(me[pe])<0&&(ge[pe]=Ae[pe].concat([me[pe]])):ge[pe]=[Ae[pe],me[pe]]),ge},{})}function _e(me){return me.reduce(function(Ae,ge){if(ge.insert===1){var pe=(0,K.default)(ge.attributes);return delete pe.image,Ae.insert({image:ge.attributes.image},pe)}if(ge.attributes!=null&&(ge.attributes.list===!0||ge.attributes.bullet===!0)&&(ge=(0,K.default)(ge),ge.attributes.list?ge.attributes.list="ordered":(ge.attributes.list="bullet",delete ge.attributes.bullet)),typeof ge.insert=="string"){var Oe=ge.insert.replace(/\r\n/g,`
`).replace(/\r/g,`
`);return Ae.insert(Oe,ge.attributes)}return Ae.push(ge)},new y.default)}n.default=we},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.Range=void 0;var o=function(){function ee(ne,ie){var re=[],te=!0,ae=!1,ue=void 0;try{for(var be=ne[Symbol.iterator](),we;!(te=(we=be.next()).done)&&(re.push(we.value),!(ie&&re.length===ie));te=!0);}catch(Ce){ae=!0,ue=Ce}finally{try{!te&&be.return&&be.return()}finally{if(ae)throw ue}}return re}return function(ne,ie){if(Array.isArray(ne))return ne;if(Symbol.iterator in Object(ne))return ee(ne,ie);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function(){function ee(ne,ie){for(var re=0;re<ie.length;re++){var te=ie[re];te.enumerable=te.enumerable||!1,te.configurable=!0,"value"in te&&(te.writable=!0),Object.defineProperty(ne,te.key,te)}}return function(ne,ie,re){return ie&&ee(ne.prototype,ie),re&&ee(ne,re),ne}}(),i=s(0),m=R(i),y=s(21),S=R(y),b=s(11),T=R(b),A=s(8),O=R(A),P=s(10),I=R(P);function R(ee){return ee&&ee.__esModule?ee:{default:ee}}function M(ee){if(Array.isArray(ee)){for(var ne=0,ie=Array(ee.length);ne<ee.length;ne++)ie[ne]=ee[ne];return ie}else return Array.from(ee)}function F(ee,ne){if(!(ee instanceof ne))throw new TypeError("Cannot call a class as a function")}var z=(0,I.default)("quill:selection"),$=function ee(ne){var ie=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;F(this,ee),this.index=ne,this.length=ie},W=function(){function ee(ne,ie){var re=this;F(this,ee),this.emitter=ie,this.scroll=ne,this.composing=!1,this.mouseDown=!1,this.root=this.scroll.domNode,this.cursor=m.default.create("cursor",this),this.lastRange=this.savedRange=new $(0,0),this.handleComposition(),this.handleDragging(),this.emitter.listenDOM("selectionchange",document,function(){re.mouseDown||setTimeout(re.update.bind(re,O.default.sources.USER),1)}),this.emitter.on(O.default.events.EDITOR_CHANGE,function(te,ae){te===O.default.events.TEXT_CHANGE&&ae.length()>0&&re.update(O.default.sources.SILENT)}),this.emitter.on(O.default.events.SCROLL_BEFORE_UPDATE,function(){if(re.hasFocus()){var te=re.getNativeRange();te!=null&&te.start.node!==re.cursor.textNode&&re.emitter.once(O.default.events.SCROLL_UPDATE,function(){try{re.setNativeRange(te.start.node,te.start.offset,te.end.node,te.end.offset)}catch{}})}}),this.emitter.on(O.default.events.SCROLL_OPTIMIZE,function(te,ae){if(ae.range){var ue=ae.range,be=ue.startNode,we=ue.startOffset,Ce=ue.endNode,_e=ue.endOffset;re.setNativeRange(be,we,Ce,_e)}}),this.update(O.default.sources.SILENT)}return h(ee,[{key:"handleComposition",value:function(){var ie=this;this.root.addEventListener("compositionstart",function(){ie.composing=!0}),this.root.addEventListener("compositionend",function(){if(ie.composing=!1,ie.cursor.parent){var re=ie.cursor.restore();if(!re)return;setTimeout(function(){ie.setNativeRange(re.startNode,re.startOffset,re.endNode,re.endOffset)},1)}})}},{key:"handleDragging",value:function(){var ie=this;this.emitter.listenDOM("mousedown",document.body,function(){ie.mouseDown=!0}),this.emitter.listenDOM("mouseup",document.body,function(){ie.mouseDown=!1,ie.update(O.default.sources.USER)})}},{key:"focus",value:function(){this.hasFocus()||(this.root.focus(),this.setRange(this.savedRange))}},{key:"format",value:function(ie,re){if(!(this.scroll.whitelist!=null&&!this.scroll.whitelist[ie])){this.scroll.update();var te=this.getNativeRange();if(!(te==null||!te.native.collapsed||m.default.query(ie,m.default.Scope.BLOCK))){if(te.start.node!==this.cursor.textNode){var ae=m.default.find(te.start.node,!1);if(ae==null)return;if(ae instanceof m.default.Leaf){var ue=ae.split(te.start.offset);ae.parent.insertBefore(this.cursor,ue)}else ae.insertBefore(this.cursor,te.start.node);this.cursor.attach()}this.cursor.format(ie,re),this.scroll.optimize(),this.setNativeRange(this.cursor.textNode,this.cursor.textNode.data.length),this.update()}}}},{key:"getBounds",value:function(ie){var re=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,te=this.scroll.length();ie=Math.min(ie,te-1),re=Math.min(ie+re,te-1)-ie;var ae=void 0,ue=this.scroll.leaf(ie),be=o(ue,2),we=be[0],Ce=be[1];if(we==null)return null;var _e=we.position(Ce,!0),me=o(_e,2);ae=me[0],Ce=me[1];var Ae=document.createRange();if(re>0){Ae.setStart(ae,Ce);var ge=this.scroll.leaf(ie+re),pe=o(ge,2);if(we=pe[0],Ce=pe[1],we==null)return null;var Oe=we.position(Ce,!0),Je=o(Oe,2);return ae=Je[0],Ce=Je[1],Ae.setEnd(ae,Ce),Ae.getBoundingClientRect()}else{var Ze="left",Pe=void 0;return ae instanceof Text?(Ce<ae.data.length?(Ae.setStart(ae,Ce),Ae.setEnd(ae,Ce+1)):(Ae.setStart(ae,Ce-1),Ae.setEnd(ae,Ce),Ze="right"),Pe=Ae.getBoundingClientRect()):(Pe=we.domNode.getBoundingClientRect(),Ce>0&&(Ze="right")),{bottom:Pe.top+Pe.height,height:Pe.height,left:Pe[Ze],right:Pe[Ze],top:Pe.top,width:0}}}},{key:"getNativeRange",value:function(){var ie=document.getSelection();if(ie==null||ie.rangeCount<=0)return null;var re=ie.getRangeAt(0);if(re==null)return null;var te=this.normalizeNative(re);return z.info("getNativeRange",te),te}},{key:"getRange",value:function(){var ie=this.getNativeRange();if(ie==null)return[null,null];var re=this.normalizedToRange(ie);return[re,ie]}},{key:"hasFocus",value:function(){return document.activeElement===this.root}},{key:"normalizedToRange",value:function(ie){var re=this,te=[[ie.start.node,ie.start.offset]];ie.native.collapsed||te.push([ie.end.node,ie.end.offset]);var ae=te.map(function(we){var Ce=o(we,2),_e=Ce[0],me=Ce[1],Ae=m.default.find(_e,!0),ge=Ae.offset(re.scroll);return me===0?ge:Ae instanceof m.default.Container?ge+Ae.length():ge+Ae.index(_e,me)}),ue=Math.min(Math.max.apply(Math,M(ae)),this.scroll.length()-1),be=Math.min.apply(Math,[ue].concat(M(ae)));return new $(be,ue-be)}},{key:"normalizeNative",value:function(ie){if(!K(this.root,ie.startContainer)||!ie.collapsed&&!K(this.root,ie.endContainer))return null;var re={start:{node:ie.startContainer,offset:ie.startOffset},end:{node:ie.endContainer,offset:ie.endOffset},native:ie};return[re.start,re.end].forEach(function(te){for(var ae=te.node,ue=te.offset;!(ae instanceof Text)&&ae.childNodes.length>0;)if(ae.childNodes.length>ue)ae=ae.childNodes[ue],ue=0;else if(ae.childNodes.length===ue)ae=ae.lastChild,ue=ae instanceof Text?ae.data.length:ae.childNodes.length+1;else break;te.node=ae,te.offset=ue}),re}},{key:"rangeToNative",value:function(ie){var re=this,te=ie.collapsed?[ie.index]:[ie.index,ie.index+ie.length],ae=[],ue=this.scroll.length();return te.forEach(function(be,we){be=Math.min(ue-1,be);var Ce=void 0,_e=re.scroll.leaf(be),me=o(_e,2),Ae=me[0],ge=me[1],pe=Ae.position(ge,we!==0),Oe=o(pe,2);Ce=Oe[0],ge=Oe[1],ae.push(Ce,ge)}),ae.length<2&&(ae=ae.concat(ae)),ae}},{key:"scrollIntoView",value:function(ie){var re=this.lastRange;if(re!=null){var te=this.getBounds(re.index,re.length);if(te!=null){var ae=this.scroll.length()-1,ue=this.scroll.line(Math.min(re.index,ae)),be=o(ue,1),we=be[0],Ce=we;if(re.length>0){var _e=this.scroll.line(Math.min(re.index+re.length,ae)),me=o(_e,1);Ce=me[0]}if(!(we==null||Ce==null)){var Ae=ie.getBoundingClientRect();te.top<Ae.top?ie.scrollTop-=Ae.top-te.top:te.bottom>Ae.bottom&&(ie.scrollTop+=te.bottom-Ae.bottom)}}}}},{key:"setNativeRange",value:function(ie,re){var te=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ie,ae=arguments.length>3&&arguments[3]!==void 0?arguments[3]:re,ue=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(z.info("setNativeRange",ie,re,te,ae),!(ie!=null&&(this.root.parentNode==null||ie.parentNode==null||te.parentNode==null))){var be=document.getSelection();if(be!=null)if(ie!=null){this.hasFocus()||this.root.focus();var we=(this.getNativeRange()||{}).native;if(we==null||ue||ie!==we.startContainer||re!==we.startOffset||te!==we.endContainer||ae!==we.endOffset){ie.tagName=="BR"&&(re=[].indexOf.call(ie.parentNode.childNodes,ie),ie=ie.parentNode),te.tagName=="BR"&&(ae=[].indexOf.call(te.parentNode.childNodes,te),te=te.parentNode);var Ce=document.createRange();Ce.setStart(ie,re),Ce.setEnd(te,ae),be.removeAllRanges(),be.addRange(Ce)}}else be.removeAllRanges(),this.root.blur(),document.body.focus()}}},{key:"setRange",value:function(ie){var re=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,te=arguments.length>2&&arguments[2]!==void 0?arguments[2]:O.default.sources.API;if(typeof re=="string"&&(te=re,re=!1),z.info("setRange",ie),ie!=null){var ae=this.rangeToNative(ie);this.setNativeRange.apply(this,M(ae).concat([re]))}else this.setNativeRange(null);this.update(te)}},{key:"update",value:function(){var ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:O.default.sources.USER,re=this.lastRange,te=this.getRange(),ae=o(te,2),ue=ae[0],be=ae[1];if(this.lastRange=ue,this.lastRange!=null&&(this.savedRange=this.lastRange),!(0,T.default)(re,this.lastRange)){var we;!this.composing&&be!=null&&be.native.collapsed&&be.start.node!==this.cursor.textNode&&this.cursor.restore();var Ce=[O.default.events.SELECTION_CHANGE,(0,S.default)(this.lastRange),(0,S.default)(re),ie];if((we=this.emitter).emit.apply(we,[O.default.events.EDITOR_CHANGE].concat(Ce)),ie!==O.default.sources.SILENT){var _e;(_e=this.emitter).emit.apply(_e,Ce)}}}}]),ee}();function K(ee,ne){try{ne.parentNode}catch{return!1}return ne instanceof Text&&(ne=ne.parentNode),ee.contains(ne)}n.Range=$,n.default=W},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function O(P,I){for(var R=0;R<I.length;R++){var M=I[R];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(P,M.key,M)}}return function(P,I,R){return I&&O(P.prototype,I),R&&O(P,R),P}}(),h=function O(P,I,R){P===null&&(P=Function.prototype);var M=Object.getOwnPropertyDescriptor(P,I);if(M===void 0){var F=Object.getPrototypeOf(P);return F===null?void 0:O(F,I,R)}else{if("value"in M)return M.value;var z=M.get;return z===void 0?void 0:z.call(R)}},i=s(0),m=y(i);function y(O){return O&&O.__esModule?O:{default:O}}function S(O,P){if(!(O instanceof P))throw new TypeError("Cannot call a class as a function")}function b(O,P){if(!O)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return P&&(typeof P=="object"||typeof P=="function")?P:O}function T(O,P){if(typeof P!="function"&&P!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof P);O.prototype=Object.create(P&&P.prototype,{constructor:{value:O,enumerable:!1,writable:!0,configurable:!0}}),P&&(Object.setPrototypeOf?Object.setPrototypeOf(O,P):O.__proto__=P)}var A=function(O){T(P,O);function P(){return S(this,P),b(this,(P.__proto__||Object.getPrototypeOf(P)).apply(this,arguments))}return o(P,[{key:"insertInto",value:function(R,M){R.children.length===0?h(P.prototype.__proto__||Object.getPrototypeOf(P.prototype),"insertInto",this).call(this,R,M):this.remove()}},{key:"length",value:function(){return 0}},{key:"value",value:function(){return""}}],[{key:"value",value:function(){}}]),P}(m.default.Embed);A.blotName="break",A.tagName="BR",n.default=A},function(r,n,s){var o=this&&this.__extends||function(){var b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,A){T.__proto__=A}||function(T,A){for(var O in A)A.hasOwnProperty(O)&&(T[O]=A[O])};return function(T,A){b(T,A);function O(){this.constructor=T}T.prototype=A===null?Object.create(A):(O.prototype=A.prototype,new O)}}();Object.defineProperty(n,"__esModule",{value:!0});var h=s(44),i=s(30),m=s(1),y=function(b){o(T,b);function T(A){var O=b.call(this,A)||this;return O.build(),O}return T.prototype.appendChild=function(A){this.insertBefore(A)},T.prototype.attach=function(){b.prototype.attach.call(this),this.children.forEach(function(A){A.attach()})},T.prototype.build=function(){var A=this;this.children=new h.default,[].slice.call(this.domNode.childNodes).reverse().forEach(function(O){try{var P=S(O);A.insertBefore(P,A.children.head||void 0)}catch(I){if(I instanceof m.ParchmentError)return;throw I}})},T.prototype.deleteAt=function(A,O){if(A===0&&O===this.length())return this.remove();this.children.forEachAt(A,O,function(P,I,R){P.deleteAt(I,R)})},T.prototype.descendant=function(A,O){var P=this.children.find(O),I=P[0],R=P[1];return A.blotName==null&&A(I)||A.blotName!=null&&I instanceof A?[I,R]:I instanceof T?I.descendant(A,R):[null,-1]},T.prototype.descendants=function(A,O,P){O===void 0&&(O=0),P===void 0&&(P=Number.MAX_VALUE);var I=[],R=P;return this.children.forEachAt(O,P,function(M,F,z){(A.blotName==null&&A(M)||A.blotName!=null&&M instanceof A)&&I.push(M),M instanceof T&&(I=I.concat(M.descendants(A,F,R))),R-=z}),I},T.prototype.detach=function(){this.children.forEach(function(A){A.detach()}),b.prototype.detach.call(this)},T.prototype.formatAt=function(A,O,P,I){this.children.forEachAt(A,O,function(R,M,F){R.formatAt(M,F,P,I)})},T.prototype.insertAt=function(A,O,P){var I=this.children.find(A),R=I[0],M=I[1];if(R)R.insertAt(M,O,P);else{var F=P==null?m.create("text",O):m.create(O,P);this.appendChild(F)}},T.prototype.insertBefore=function(A,O){if(this.statics.allowedChildren!=null&&!this.statics.allowedChildren.some(function(P){return A instanceof P}))throw new m.ParchmentError("Cannot insert "+A.statics.blotName+" into "+this.statics.blotName);A.insertInto(this,O)},T.prototype.length=function(){return this.children.reduce(function(A,O){return A+O.length()},0)},T.prototype.moveChildren=function(A,O){this.children.forEach(function(P){A.insertBefore(P,O)})},T.prototype.optimize=function(A){if(b.prototype.optimize.call(this,A),this.children.length===0)if(this.statics.defaultChild!=null){var O=m.create(this.statics.defaultChild);this.appendChild(O),O.optimize(A)}else this.remove()},T.prototype.path=function(A,O){O===void 0&&(O=!1);var P=this.children.find(A,O),I=P[0],R=P[1],M=[[this,A]];return I instanceof T?M.concat(I.path(R,O)):(I!=null&&M.push([I,R]),M)},T.prototype.removeChild=function(A){this.children.remove(A)},T.prototype.replace=function(A){A instanceof T&&A.moveChildren(this),b.prototype.replace.call(this,A)},T.prototype.split=function(A,O){if(O===void 0&&(O=!1),!O){if(A===0)return this;if(A===this.length())return this.next}var P=this.clone();return this.parent.insertBefore(P,this.next),this.children.forEachAt(A,this.length(),function(I,R,M){I=I.split(R,O),P.appendChild(I)}),P},T.prototype.unwrap=function(){this.moveChildren(this.parent,this.next),this.remove()},T.prototype.update=function(A,O){var P=this,I=[],R=[];A.forEach(function(M){M.target===P.domNode&&M.type==="childList"&&(I.push.apply(I,M.addedNodes),R.push.apply(R,M.removedNodes))}),R.forEach(function(M){if(!(M.parentNode!=null&&M.tagName!=="IFRAME"&&document.body.compareDocumentPosition(M)&Node.DOCUMENT_POSITION_CONTAINED_BY)){var F=m.find(M);F!=null&&(F.domNode.parentNode==null||F.domNode.parentNode===P.domNode)&&F.detach()}}),I.filter(function(M){return M.parentNode==P.domNode}).sort(function(M,F){return M===F?0:M.compareDocumentPosition(F)&Node.DOCUMENT_POSITION_FOLLOWING?1:-1}).forEach(function(M){var F=null;M.nextSibling!=null&&(F=m.find(M.nextSibling));var z=S(M);(z.next!=F||z.next==null)&&(z.parent!=null&&z.parent.removeChild(P),P.insertBefore(z,F||void 0))})},T}(i.default);function S(b){var T=m.find(b);if(T==null)try{T=m.create(b)}catch{T=m.create(m.Scope.INLINE),[].slice.call(b.childNodes).forEach(function(O){T.domNode.appendChild(O)}),b.parentNode&&b.parentNode.replaceChild(T.domNode,b),T.attach()}return T}n.default=y},function(r,n,s){var o=this&&this.__extends||function(){var b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,A){T.__proto__=A}||function(T,A){for(var O in A)A.hasOwnProperty(O)&&(T[O]=A[O])};return function(T,A){b(T,A);function O(){this.constructor=T}T.prototype=A===null?Object.create(A):(O.prototype=A.prototype,new O)}}();Object.defineProperty(n,"__esModule",{value:!0});var h=s(12),i=s(31),m=s(17),y=s(1),S=function(b){o(T,b);function T(A){var O=b.call(this,A)||this;return O.attributes=new i.default(O.domNode),O}return T.formats=function(A){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return A.tagName.toLowerCase()},T.prototype.format=function(A,O){var P=y.query(A);P instanceof h.default?this.attributes.attribute(P,O):O&&P!=null&&(A!==this.statics.blotName||this.formats()[A]!==O)&&this.replaceWith(A,O)},T.prototype.formats=function(){var A=this.attributes.values(),O=this.statics.formats(this.domNode);return O!=null&&(A[this.statics.blotName]=O),A},T.prototype.replaceWith=function(A,O){var P=b.prototype.replaceWith.call(this,A,O);return this.attributes.copy(P),P},T.prototype.update=function(A,O){var P=this;b.prototype.update.call(this,A,O),A.some(function(I){return I.target===P.domNode&&I.type==="attributes"})&&this.attributes.build()},T.prototype.wrap=function(A,O){var P=b.prototype.wrap.call(this,A,O);return P instanceof T&&P.statics.scope===this.statics.scope&&this.attributes.move(P),P},T}(m.default);n.default=S},function(r,n,s){var o=this&&this.__extends||function(){var y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,b){S.__proto__=b}||function(S,b){for(var T in b)b.hasOwnProperty(T)&&(S[T]=b[T])};return function(S,b){y(S,b);function T(){this.constructor=S}S.prototype=b===null?Object.create(b):(T.prototype=b.prototype,new T)}}();Object.defineProperty(n,"__esModule",{value:!0});var h=s(30),i=s(1),m=function(y){o(S,y);function S(){return y!==null&&y.apply(this,arguments)||this}return S.value=function(b){return!0},S.prototype.index=function(b,T){return this.domNode===b||this.domNode.compareDocumentPosition(b)&Node.DOCUMENT_POSITION_CONTAINED_BY?Math.min(T,1):-1},S.prototype.position=function(b,T){var A=[].indexOf.call(this.parent.domNode.childNodes,this.domNode);return b>0&&(A+=1),[this.parent.domNode,A]},S.prototype.value=function(){var b;return b={},b[this.statics.blotName]=this.statics.value(this.domNode)||!0,b},S.scope=i.Scope.INLINE_BLOT,S}(h.default);n.default=m},function(r,n,s){var o=s(11),h=s(3),i={attributes:{compose:function(y,S,b){typeof y!="object"&&(y={}),typeof S!="object"&&(S={});var T=h(!0,{},S);b||(T=Object.keys(T).reduce(function(O,P){return T[P]!=null&&(O[P]=T[P]),O},{}));for(var A in y)y[A]!==void 0&&S[A]===void 0&&(T[A]=y[A]);return Object.keys(T).length>0?T:void 0},diff:function(y,S){typeof y!="object"&&(y={}),typeof S!="object"&&(S={});var b=Object.keys(y).concat(Object.keys(S)).reduce(function(T,A){return o(y[A],S[A])||(T[A]=S[A]===void 0?null:S[A]),T},{});return Object.keys(b).length>0?b:void 0},transform:function(y,S,b){if(typeof y!="object")return S;if(typeof S=="object"){if(!b)return S;var T=Object.keys(S).reduce(function(A,O){return y[O]===void 0&&(A[O]=S[O]),A},{});return Object.keys(T).length>0?T:void 0}}},iterator:function(y){return new m(y)},length:function(y){return typeof y.delete=="number"?y.delete:typeof y.retain=="number"?y.retain:typeof y.insert=="string"?y.insert.length:1}};function m(y){this.ops=y,this.index=0,this.offset=0}m.prototype.hasNext=function(){return this.peekLength()<1/0},m.prototype.next=function(y){y||(y=1/0);var S=this.ops[this.index];if(S){var b=this.offset,T=i.length(S);if(y>=T-b?(y=T-b,this.index+=1,this.offset=0):this.offset+=y,typeof S.delete=="number")return{delete:y};var A={};return S.attributes&&(A.attributes=S.attributes),typeof S.retain=="number"?A.retain=y:typeof S.insert=="string"?A.insert=S.insert.substr(b,y):A.insert=S.insert,A}else return{retain:1/0}},m.prototype.peek=function(){return this.ops[this.index]},m.prototype.peekLength=function(){return this.ops[this.index]?i.length(this.ops[this.index])-this.offset:1/0},m.prototype.peekType=function(){return this.ops[this.index]?typeof this.ops[this.index].delete=="number"?"delete":typeof this.ops[this.index].retain=="number"?"retain":"insert":"retain"},m.prototype.rest=function(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);var y=this.offset,S=this.index,b=this.next(),T=this.ops.slice(this.index);return this.offset=y,this.index=S,[b].concat(T)}else return[]},r.exports=i},function(r,n){var s=function(){function o(P,I){return I!=null&&P instanceof I}var h;try{h=Map}catch{h=function(){}}var i;try{i=Set}catch{i=function(){}}var m;try{m=Promise}catch{m=function(){}}function y(P,I,R,M,F){typeof I=="object"&&(R=I.depth,M=I.prototype,F=I.includeNonEnumerable,I=I.circular);var z=[],$=[],W=typeof Buffer<"u";typeof I>"u"&&(I=!0),typeof R>"u"&&(R=1/0);function K(ee,ne){if(ee===null)return null;if(ne===0)return ee;var ie,re;if(typeof ee!="object")return ee;if(o(ee,h))ie=new h;else if(o(ee,i))ie=new i;else if(o(ee,m))ie=new m(function(Ae,ge){ee.then(function(pe){Ae(K(pe,ne-1))},function(pe){ge(K(pe,ne-1))})});else if(y.__isArray(ee))ie=[];else if(y.__isRegExp(ee))ie=new RegExp(ee.source,O(ee)),ee.lastIndex&&(ie.lastIndex=ee.lastIndex);else if(y.__isDate(ee))ie=new Date(ee.getTime());else{if(W&&Buffer.isBuffer(ee))return Buffer.allocUnsafe?ie=Buffer.allocUnsafe(ee.length):ie=new Buffer(ee.length),ee.copy(ie),ie;o(ee,Error)?ie=Object.create(ee):typeof M>"u"?(re=Object.getPrototypeOf(ee),ie=Object.create(re)):(ie=Object.create(M),re=M)}if(I){var te=z.indexOf(ee);if(te!=-1)return $[te];z.push(ee),$.push(ie)}o(ee,h)&&ee.forEach(function(Ae,ge){var pe=K(ge,ne-1),Oe=K(Ae,ne-1);ie.set(pe,Oe)}),o(ee,i)&&ee.forEach(function(Ae){var ge=K(Ae,ne-1);ie.add(ge)});for(var ae in ee){var ue;re&&(ue=Object.getOwnPropertyDescriptor(re,ae)),!(ue&&ue.set==null)&&(ie[ae]=K(ee[ae],ne-1))}if(Object.getOwnPropertySymbols)for(var be=Object.getOwnPropertySymbols(ee),ae=0;ae<be.length;ae++){var we=be[ae],Ce=Object.getOwnPropertyDescriptor(ee,we);Ce&&!Ce.enumerable&&!F||(ie[we]=K(ee[we],ne-1),Ce.enumerable||Object.defineProperty(ie,we,{enumerable:!1}))}if(F)for(var _e=Object.getOwnPropertyNames(ee),ae=0;ae<_e.length;ae++){var me=_e[ae],Ce=Object.getOwnPropertyDescriptor(ee,me);Ce&&Ce.enumerable||(ie[me]=K(ee[me],ne-1),Object.defineProperty(ie,me,{enumerable:!1}))}return ie}return K(P,R)}y.clonePrototype=function(I){if(I===null)return null;var R=function(){};return R.prototype=I,new R};function S(P){return Object.prototype.toString.call(P)}y.__objToStr=S;function b(P){return typeof P=="object"&&S(P)==="[object Date]"}y.__isDate=b;function T(P){return typeof P=="object"&&S(P)==="[object Array]"}y.__isArray=T;function A(P){return typeof P=="object"&&S(P)==="[object RegExp]"}y.__isRegExp=A;function O(P){var I="";return P.global&&(I+="g"),P.ignoreCase&&(I+="i"),P.multiline&&(I+="m"),I}return y.__getRegExpFlags=O,y}();typeof r=="object"&&r.exports&&(r.exports=s)},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function ie(re,te){var ae=[],ue=!0,be=!1,we=void 0;try{for(var Ce=re[Symbol.iterator](),_e;!(ue=(_e=Ce.next()).done)&&(ae.push(_e.value),!(te&&ae.length===te));ue=!0);}catch(me){be=!0,we=me}finally{try{!ue&&Ce.return&&Ce.return()}finally{if(be)throw we}}return ae}return function(re,te){if(Array.isArray(re))return re;if(Symbol.iterator in Object(re))return ie(re,te);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function(){function ie(re,te){for(var ae=0;ae<te.length;ae++){var ue=te[ae];ue.enumerable=ue.enumerable||!1,ue.configurable=!0,"value"in ue&&(ue.writable=!0),Object.defineProperty(re,ue.key,ue)}}return function(re,te,ae){return te&&ie(re.prototype,te),ae&&ie(re,ae),re}}(),i=function ie(re,te,ae){re===null&&(re=Function.prototype);var ue=Object.getOwnPropertyDescriptor(re,te);if(ue===void 0){var be=Object.getPrototypeOf(re);return be===null?void 0:ie(be,te,ae)}else{if("value"in ue)return ue.value;var we=ue.get;return we===void 0?void 0:we.call(ae)}},m=s(0),y=z(m),S=s(8),b=z(S),T=s(4),A=z(T),O=s(16),P=z(O),I=s(13),R=z(I),M=s(25),F=z(M);function z(ie){return ie&&ie.__esModule?ie:{default:ie}}function $(ie,re){if(!(ie instanceof re))throw new TypeError("Cannot call a class as a function")}function W(ie,re){if(!ie)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return re&&(typeof re=="object"||typeof re=="function")?re:ie}function K(ie,re){if(typeof re!="function"&&re!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof re);ie.prototype=Object.create(re&&re.prototype,{constructor:{value:ie,enumerable:!1,writable:!0,configurable:!0}}),re&&(Object.setPrototypeOf?Object.setPrototypeOf(ie,re):ie.__proto__=re)}function ee(ie){return ie instanceof A.default||ie instanceof T.BlockEmbed}var ne=function(ie){K(re,ie);function re(te,ae){$(this,re);var ue=W(this,(re.__proto__||Object.getPrototypeOf(re)).call(this,te));return ue.emitter=ae.emitter,Array.isArray(ae.whitelist)&&(ue.whitelist=ae.whitelist.reduce(function(be,we){return be[we]=!0,be},{})),ue.domNode.addEventListener("DOMNodeInserted",function(){}),ue.optimize(),ue.enable(),ue}return h(re,[{key:"batchStart",value:function(){this.batch=!0}},{key:"batchEnd",value:function(){this.batch=!1,this.optimize()}},{key:"deleteAt",value:function(ae,ue){var be=this.line(ae),we=o(be,2),Ce=we[0],_e=we[1],me=this.line(ae+ue),Ae=o(me,1),ge=Ae[0];if(i(re.prototype.__proto__||Object.getPrototypeOf(re.prototype),"deleteAt",this).call(this,ae,ue),ge!=null&&Ce!==ge&&_e>0){if(Ce instanceof T.BlockEmbed||ge instanceof T.BlockEmbed){this.optimize();return}if(Ce instanceof R.default){var pe=Ce.newlineIndex(Ce.length(),!0);if(pe>-1&&(Ce=Ce.split(pe+1),Ce===ge)){this.optimize();return}}else if(ge instanceof R.default){var Oe=ge.newlineIndex(0);Oe>-1&&ge.split(Oe+1)}var Je=ge.children.head instanceof P.default?null:ge.children.head;Ce.moveChildren(ge,Je),Ce.remove()}this.optimize()}},{key:"enable",value:function(){var ae=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.domNode.setAttribute("contenteditable",ae)}},{key:"formatAt",value:function(ae,ue,be,we){this.whitelist!=null&&!this.whitelist[be]||(i(re.prototype.__proto__||Object.getPrototypeOf(re.prototype),"formatAt",this).call(this,ae,ue,be,we),this.optimize())}},{key:"insertAt",value:function(ae,ue,be){if(!(be!=null&&this.whitelist!=null&&!this.whitelist[ue])){if(ae>=this.length())if(be==null||y.default.query(ue,y.default.Scope.BLOCK)==null){var we=y.default.create(this.statics.defaultChild);this.appendChild(we),be==null&&ue.endsWith(`
`)&&(ue=ue.slice(0,-1)),we.insertAt(0,ue,be)}else{var Ce=y.default.create(ue,be);this.appendChild(Ce)}else i(re.prototype.__proto__||Object.getPrototypeOf(re.prototype),"insertAt",this).call(this,ae,ue,be);this.optimize()}}},{key:"insertBefore",value:function(ae,ue){if(ae.statics.scope===y.default.Scope.INLINE_BLOT){var be=y.default.create(this.statics.defaultChild);be.appendChild(ae),ae=be}i(re.prototype.__proto__||Object.getPrototypeOf(re.prototype),"insertBefore",this).call(this,ae,ue)}},{key:"leaf",value:function(ae){return this.path(ae).pop()||[null,-1]}},{key:"line",value:function(ae){return ae===this.length()?this.line(ae-1):this.descendant(ee,ae)}},{key:"lines",value:function(){var ae=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,ue=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE,be=function we(Ce,_e,me){var Ae=[],ge=me;return Ce.children.forEachAt(_e,me,function(pe,Oe,Je){ee(pe)?Ae.push(pe):pe instanceof y.default.Container&&(Ae=Ae.concat(we(pe,Oe,ge))),ge-=Je}),Ae};return be(this,ae,ue)}},{key:"optimize",value:function(){var ae=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],ue=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.batch!==!0&&(i(re.prototype.__proto__||Object.getPrototypeOf(re.prototype),"optimize",this).call(this,ae,ue),ae.length>0&&this.emitter.emit(b.default.events.SCROLL_OPTIMIZE,ae,ue))}},{key:"path",value:function(ae){return i(re.prototype.__proto__||Object.getPrototypeOf(re.prototype),"path",this).call(this,ae).slice(1)}},{key:"update",value:function(ae){if(this.batch!==!0){var ue=b.default.sources.USER;typeof ae=="string"&&(ue=ae),Array.isArray(ae)||(ae=this.observer.takeRecords()),ae.length>0&&this.emitter.emit(b.default.events.SCROLL_BEFORE_UPDATE,ue,ae),i(re.prototype.__proto__||Object.getPrototypeOf(re.prototype),"update",this).call(this,ae.concat([])),ae.length>0&&this.emitter.emit(b.default.events.SCROLL_UPDATE,ue,ae)}}}]),re}(y.default.Scroll);ne.blotName="scroll",ne.className="ql-editor",ne.tagName="DIV",ne.defaultChild="block",ne.allowedChildren=[A.default,T.BlockEmbed,F.default],n.default=ne},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.SHORTKEY=n.default=void 0;var o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Pe){return typeof Pe}:function(Pe){return Pe&&typeof Symbol=="function"&&Pe.constructor===Symbol&&Pe!==Symbol.prototype?"symbol":typeof Pe},h=function(){function Pe(Be,nt){var Me=[],We=!0,gt=!1,rt=void 0;try{for(var Ht=Be[Symbol.iterator](),Lt;!(We=(Lt=Ht.next()).done)&&(Me.push(Lt.value),!(nt&&Me.length===nt));We=!0);}catch(nr){gt=!0,rt=nr}finally{try{!We&&Ht.return&&Ht.return()}finally{if(gt)throw rt}}return Me}return function(Be,nt){if(Array.isArray(Be))return Be;if(Symbol.iterator in Object(Be))return Pe(Be,nt);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function Pe(Be,nt){for(var Me=0;Me<nt.length;Me++){var We=nt[Me];We.enumerable=We.enumerable||!1,We.configurable=!0,"value"in We&&(We.writable=!0),Object.defineProperty(Be,We.key,We)}}return function(Be,nt,Me){return nt&&Pe(Be.prototype,nt),Me&&Pe(Be,Me),Be}}(),m=s(21),y=ie(m),S=s(11),b=ie(S),T=s(3),A=ie(T),O=s(2),P=ie(O),I=s(20),R=ie(I),M=s(0),F=ie(M),z=s(5),$=ie(z),W=s(10),K=ie(W),ee=s(9),ne=ie(ee);function ie(Pe){return Pe&&Pe.__esModule?Pe:{default:Pe}}function re(Pe,Be,nt){return Be in Pe?Object.defineProperty(Pe,Be,{value:nt,enumerable:!0,configurable:!0,writable:!0}):Pe[Be]=nt,Pe}function te(Pe,Be){if(!(Pe instanceof Be))throw new TypeError("Cannot call a class as a function")}function ae(Pe,Be){if(!Pe)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Be&&(typeof Be=="object"||typeof Be=="function")?Be:Pe}function ue(Pe,Be){if(typeof Be!="function"&&Be!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof Be);Pe.prototype=Object.create(Be&&Be.prototype,{constructor:{value:Pe,enumerable:!1,writable:!0,configurable:!0}}),Be&&(Object.setPrototypeOf?Object.setPrototypeOf(Pe,Be):Pe.__proto__=Be)}var be=(0,K.default)("quill:keyboard"),we=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey",Ce=function(Pe){ue(Be,Pe),i(Be,null,[{key:"match",value:function(Me,We){return We=Ze(We),["altKey","ctrlKey","metaKey","shiftKey"].some(function(gt){return!!We[gt]!==Me[gt]&&We[gt]!==null})?!1:We.key===(Me.which||Me.keyCode)}}]);function Be(nt,Me){te(this,Be);var We=ae(this,(Be.__proto__||Object.getPrototypeOf(Be)).call(this,nt,Me));return We.bindings={},Object.keys(We.options.bindings).forEach(function(gt){gt==="list autofill"&&nt.scroll.whitelist!=null&&!nt.scroll.whitelist.list||We.options.bindings[gt]&&We.addBinding(We.options.bindings[gt])}),We.addBinding({key:Be.keys.ENTER,shiftKey:null},pe),We.addBinding({key:Be.keys.ENTER,metaKey:null,ctrlKey:null,altKey:null},function(){}),/Firefox/i.test(navigator.userAgent)?(We.addBinding({key:Be.keys.BACKSPACE},{collapsed:!0},me),We.addBinding({key:Be.keys.DELETE},{collapsed:!0},Ae)):(We.addBinding({key:Be.keys.BACKSPACE},{collapsed:!0,prefix:/^.?$/},me),We.addBinding({key:Be.keys.DELETE},{collapsed:!0,suffix:/^.?$/},Ae)),We.addBinding({key:Be.keys.BACKSPACE},{collapsed:!1},ge),We.addBinding({key:Be.keys.DELETE},{collapsed:!1},ge),We.addBinding({key:Be.keys.BACKSPACE,altKey:null,ctrlKey:null,metaKey:null,shiftKey:null},{collapsed:!0,offset:0},me),We.listen(),We}return i(Be,[{key:"addBinding",value:function(Me){var We=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},gt=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},rt=Ze(Me);if(rt==null||rt.key==null)return be.warn("Attempted to add invalid keyboard binding",rt);typeof We=="function"&&(We={handler:We}),typeof gt=="function"&&(gt={handler:gt}),rt=(0,A.default)(rt,We,gt),this.bindings[rt.key]=this.bindings[rt.key]||[],this.bindings[rt.key].push(rt)}},{key:"listen",value:function(){var Me=this;this.quill.root.addEventListener("keydown",function(We){if(!We.defaultPrevented){var gt=We.which||We.keyCode,rt=(Me.bindings[gt]||[]).filter(function(Gn){return Be.match(We,Gn)});if(rt.length!==0){var Ht=Me.quill.getSelection();if(!(Ht==null||!Me.quill.hasFocus())){var Lt=Me.quill.getLine(Ht.index),nr=h(Lt,2),Rr=nr[0],Dr=nr[1],Pt=Me.quill.getLeaf(Ht.index),wt=h(Pt,2),He=wt[0],lt=wt[1],ut=Ht.length===0?[He,lt]:Me.quill.getLeaf(Ht.index+Ht.length),sr=h(ut,2),Qt=sr[0],er=sr[1],Cr=He instanceof F.default.Text?He.value().slice(0,lt):"",dn=Qt instanceof F.default.Text?Qt.value().slice(er):"",fn={collapsed:Ht.length===0,empty:Ht.length===0&&Rr.length()<=1,format:Me.quill.getFormat(Ht),offset:Dr,prefix:Cr,suffix:dn},Zn=rt.some(function(Gn){if(Gn.collapsed!=null&&Gn.collapsed!==fn.collapsed||Gn.empty!=null&&Gn.empty!==fn.empty||Gn.offset!=null&&Gn.offset!==fn.offset)return!1;if(Array.isArray(Gn.format)){if(Gn.format.every(function(Di){return fn.format[Di]==null}))return!1}else if(o(Gn.format)==="object"&&!Object.keys(Gn.format).every(function(Di){return Gn.format[Di]===!0?fn.format[Di]!=null:Gn.format[Di]===!1?fn.format[Di]==null:(0,b.default)(Gn.format[Di],fn.format[Di])}))return!1;return Gn.prefix!=null&&!Gn.prefix.test(fn.prefix)||Gn.suffix!=null&&!Gn.suffix.test(fn.suffix)?!1:Gn.handler.call(Me,Ht,fn)!==!0});Zn&&We.preventDefault()}}}})}}]),Be}(ne.default);Ce.keys={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46},Ce.DEFAULTS={bindings:{bold:Je("bold"),italic:Je("italic"),underline:Je("underline"),indent:{key:Ce.keys.TAB,format:["blockquote","indent","list"],handler:function(Be,nt){if(nt.collapsed&&nt.offset!==0)return!0;this.quill.format("indent","+1",$.default.sources.USER)}},outdent:{key:Ce.keys.TAB,shiftKey:!0,format:["blockquote","indent","list"],handler:function(Be,nt){if(nt.collapsed&&nt.offset!==0)return!0;this.quill.format("indent","-1",$.default.sources.USER)}},"outdent backspace":{key:Ce.keys.BACKSPACE,collapsed:!0,shiftKey:null,metaKey:null,ctrlKey:null,altKey:null,format:["indent","list"],offset:0,handler:function(Be,nt){nt.format.indent!=null?this.quill.format("indent","-1",$.default.sources.USER):nt.format.list!=null&&this.quill.format("list",!1,$.default.sources.USER)}},"indent code-block":Oe(!0),"outdent code-block":Oe(!1),"remove tab":{key:Ce.keys.TAB,shiftKey:!0,collapsed:!0,prefix:/\t$/,handler:function(Be){this.quill.deleteText(Be.index-1,1,$.default.sources.USER)}},tab:{key:Ce.keys.TAB,handler:function(Be){this.quill.history.cutoff();var nt=new P.default().retain(Be.index).delete(Be.length).insert("	");this.quill.updateContents(nt,$.default.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(Be.index+1,$.default.sources.SILENT)}},"list empty enter":{key:Ce.keys.ENTER,collapsed:!0,format:["list"],empty:!0,handler:function(Be,nt){this.quill.format("list",!1,$.default.sources.USER),nt.format.indent&&this.quill.format("indent",!1,$.default.sources.USER)}},"checklist enter":{key:Ce.keys.ENTER,collapsed:!0,format:{list:"checked"},handler:function(Be){var nt=this.quill.getLine(Be.index),Me=h(nt,2),We=Me[0],gt=Me[1],rt=(0,A.default)({},We.formats(),{list:"checked"}),Ht=new P.default().retain(Be.index).insert(`
`,rt).retain(We.length()-gt-1).retain(1,{list:"unchecked"});this.quill.updateContents(Ht,$.default.sources.USER),this.quill.setSelection(Be.index+1,$.default.sources.SILENT),this.quill.scrollIntoView()}},"header enter":{key:Ce.keys.ENTER,collapsed:!0,format:["header"],suffix:/^$/,handler:function(Be,nt){var Me=this.quill.getLine(Be.index),We=h(Me,2),gt=We[0],rt=We[1],Ht=new P.default().retain(Be.index).insert(`
`,nt.format).retain(gt.length()-rt-1).retain(1,{header:null});this.quill.updateContents(Ht,$.default.sources.USER),this.quill.setSelection(Be.index+1,$.default.sources.SILENT),this.quill.scrollIntoView()}},"list autofill":{key:" ",collapsed:!0,format:{list:!1},prefix:/^\s*?(\d+\.|-|\*|\[ ?\]|\[x\])$/,handler:function(Be,nt){var Me=nt.prefix.length,We=this.quill.getLine(Be.index),gt=h(We,2),rt=gt[0],Ht=gt[1];if(Ht>Me)return!0;var Lt=void 0;switch(nt.prefix.trim()){case"[]":case"[ ]":Lt="unchecked";break;case"[x]":Lt="checked";break;case"-":case"*":Lt="bullet";break;default:Lt="ordered"}this.quill.insertText(Be.index," ",$.default.sources.USER),this.quill.history.cutoff();var nr=new P.default().retain(Be.index-Ht).delete(Me+1).retain(rt.length()-2-Ht).retain(1,{list:Lt});this.quill.updateContents(nr,$.default.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(Be.index-Me,$.default.sources.SILENT)}},"code exit":{key:Ce.keys.ENTER,collapsed:!0,format:["code-block"],prefix:/\n\n$/,suffix:/^\s+$/,handler:function(Be){var nt=this.quill.getLine(Be.index),Me=h(nt,2),We=Me[0],gt=Me[1],rt=new P.default().retain(Be.index+We.length()-gt-2).retain(1,{"code-block":null}).delete(1);this.quill.updateContents(rt,$.default.sources.USER)}},"embed left":_e(Ce.keys.LEFT,!1),"embed left shift":_e(Ce.keys.LEFT,!0),"embed right":_e(Ce.keys.RIGHT,!1),"embed right shift":_e(Ce.keys.RIGHT,!0)}};function _e(Pe,Be){var nt,Me=Pe===Ce.keys.LEFT?"prefix":"suffix";return nt={key:Pe,shiftKey:Be,altKey:null},re(nt,Me,/^$/),re(nt,"handler",function(gt){var rt=gt.index;Pe===Ce.keys.RIGHT&&(rt+=gt.length+1);var Ht=this.quill.getLeaf(rt),Lt=h(Ht,1),nr=Lt[0];return nr instanceof F.default.Embed?(Pe===Ce.keys.LEFT?Be?this.quill.setSelection(gt.index-1,gt.length+1,$.default.sources.USER):this.quill.setSelection(gt.index-1,$.default.sources.USER):Be?this.quill.setSelection(gt.index,gt.length+1,$.default.sources.USER):this.quill.setSelection(gt.index+gt.length+1,$.default.sources.USER),!1):!0}),nt}function me(Pe,Be){if(!(Pe.index===0||this.quill.getLength()<=1)){var nt=this.quill.getLine(Pe.index),Me=h(nt,1),We=Me[0],gt={};if(Be.offset===0){var rt=this.quill.getLine(Pe.index-1),Ht=h(rt,1),Lt=Ht[0];if(Lt!=null&&Lt.length()>1){var nr=We.formats(),Rr=this.quill.getFormat(Pe.index-1,1);gt=R.default.attributes.diff(nr,Rr)||{}}}var Dr=/[\uD800-\uDBFF][\uDC00-\uDFFF]$/.test(Be.prefix)?2:1;this.quill.deleteText(Pe.index-Dr,Dr,$.default.sources.USER),Object.keys(gt).length>0&&this.quill.formatLine(Pe.index-Dr,Dr,gt,$.default.sources.USER),this.quill.focus()}}function Ae(Pe,Be){var nt=/^[\uD800-\uDBFF][\uDC00-\uDFFF]/.test(Be.suffix)?2:1;if(!(Pe.index>=this.quill.getLength()-nt)){var Me={},We=0,gt=this.quill.getLine(Pe.index),rt=h(gt,1),Ht=rt[0];if(Be.offset>=Ht.length()-1){var Lt=this.quill.getLine(Pe.index+1),nr=h(Lt,1),Rr=nr[0];if(Rr){var Dr=Ht.formats(),Pt=this.quill.getFormat(Pe.index,1);Me=R.default.attributes.diff(Dr,Pt)||{},We=Rr.length()}}this.quill.deleteText(Pe.index,nt,$.default.sources.USER),Object.keys(Me).length>0&&this.quill.formatLine(Pe.index+We-1,nt,Me,$.default.sources.USER)}}function ge(Pe){var Be=this.quill.getLines(Pe),nt={};if(Be.length>1){var Me=Be[0].formats(),We=Be[Be.length-1].formats();nt=R.default.attributes.diff(We,Me)||{}}this.quill.deleteText(Pe,$.default.sources.USER),Object.keys(nt).length>0&&this.quill.formatLine(Pe.index,1,nt,$.default.sources.USER),this.quill.setSelection(Pe.index,$.default.sources.SILENT),this.quill.focus()}function pe(Pe,Be){var nt=this;Pe.length>0&&this.quill.scroll.deleteAt(Pe.index,Pe.length);var Me=Object.keys(Be.format).reduce(function(We,gt){return F.default.query(gt,F.default.Scope.BLOCK)&&!Array.isArray(Be.format[gt])&&(We[gt]=Be.format[gt]),We},{});this.quill.insertText(Pe.index,`
`,Me,$.default.sources.USER),this.quill.setSelection(Pe.index+1,$.default.sources.SILENT),this.quill.focus(),Object.keys(Be.format).forEach(function(We){Me[We]==null&&(Array.isArray(Be.format[We])||We!=="link"&&nt.quill.format(We,Be.format[We],$.default.sources.USER))})}function Oe(Pe){return{key:Ce.keys.TAB,shiftKey:!Pe,format:{"code-block":!0},handler:function(nt){var Me=F.default.query("code-block"),We=nt.index,gt=nt.length,rt=this.quill.scroll.descendant(Me,We),Ht=h(rt,2),Lt=Ht[0],nr=Ht[1];if(Lt!=null){var Rr=this.quill.getIndex(Lt),Dr=Lt.newlineIndex(nr,!0)+1,Pt=Lt.newlineIndex(Rr+nr+gt),wt=Lt.domNode.textContent.slice(Dr,Pt).split(`
`);nr=0,wt.forEach(function(He,lt){Pe?(Lt.insertAt(Dr+nr,Me.TAB),nr+=Me.TAB.length,lt===0?We+=Me.TAB.length:gt+=Me.TAB.length):He.startsWith(Me.TAB)&&(Lt.deleteAt(Dr+nr,Me.TAB.length),nr-=Me.TAB.length,lt===0?We-=Me.TAB.length:gt-=Me.TAB.length),nr+=He.length+1}),this.quill.update($.default.sources.USER),this.quill.setSelection(We,gt,$.default.sources.SILENT)}}}}function Je(Pe){return{key:Pe[0].toUpperCase(),shortKey:!0,handler:function(nt,Me){this.quill.format(Pe,!Me.format[Pe],$.default.sources.USER)}}}function Ze(Pe){if(typeof Pe=="string"||typeof Pe=="number")return Ze({key:Pe});if((typeof Pe>"u"?"undefined":o(Pe))==="object"&&(Pe=(0,y.default)(Pe,!1)),typeof Pe.key=="string")if(Ce.keys[Pe.key.toUpperCase()]!=null)Pe.key=Ce.keys[Pe.key.toUpperCase()];else if(Pe.key.length===1)Pe.key=Pe.key.toUpperCase().charCodeAt(0);else return null;return Pe.shortKey&&(Pe[we]=Pe.shortKey,delete Pe.shortKey),Pe}n.default=Ce,n.SHORTKEY=we},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function R(M,F){var z=[],$=!0,W=!1,K=void 0;try{for(var ee=M[Symbol.iterator](),ne;!($=(ne=ee.next()).done)&&(z.push(ne.value),!(F&&z.length===F));$=!0);}catch(ie){W=!0,K=ie}finally{try{!$&&ee.return&&ee.return()}finally{if(W)throw K}}return z}return function(M,F){if(Array.isArray(M))return M;if(Symbol.iterator in Object(M))return R(M,F);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function R(M,F,z){M===null&&(M=Function.prototype);var $=Object.getOwnPropertyDescriptor(M,F);if($===void 0){var W=Object.getPrototypeOf(M);return W===null?void 0:R(W,F,z)}else{if("value"in $)return $.value;var K=$.get;return K===void 0?void 0:K.call(z)}},i=function(){function R(M,F){for(var z=0;z<F.length;z++){var $=F[z];$.enumerable=$.enumerable||!1,$.configurable=!0,"value"in $&&($.writable=!0),Object.defineProperty(M,$.key,$)}}return function(M,F,z){return F&&R(M.prototype,F),z&&R(M,z),M}}(),m=s(0),y=T(m),S=s(7),b=T(S);function T(R){return R&&R.__esModule?R:{default:R}}function A(R,M){if(!(R instanceof M))throw new TypeError("Cannot call a class as a function")}function O(R,M){if(!R)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return M&&(typeof M=="object"||typeof M=="function")?M:R}function P(R,M){if(typeof M!="function"&&M!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof M);R.prototype=Object.create(M&&M.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),M&&(Object.setPrototypeOf?Object.setPrototypeOf(R,M):R.__proto__=M)}var I=function(R){P(M,R),i(M,null,[{key:"value",value:function(){}}]);function M(F,z){A(this,M);var $=O(this,(M.__proto__||Object.getPrototypeOf(M)).call(this,F));return $.selection=z,$.textNode=document.createTextNode(M.CONTENTS),$.domNode.appendChild($.textNode),$._length=0,$}return i(M,[{key:"detach",value:function(){this.parent!=null&&this.parent.removeChild(this)}},{key:"format",value:function(z,$){if(this._length!==0)return h(M.prototype.__proto__||Object.getPrototypeOf(M.prototype),"format",this).call(this,z,$);for(var W=this,K=0;W!=null&&W.statics.scope!==y.default.Scope.BLOCK_BLOT;)K+=W.offset(W.parent),W=W.parent;W!=null&&(this._length=M.CONTENTS.length,W.optimize(),W.formatAt(K,M.CONTENTS.length,z,$),this._length=0)}},{key:"index",value:function(z,$){return z===this.textNode?0:h(M.prototype.__proto__||Object.getPrototypeOf(M.prototype),"index",this).call(this,z,$)}},{key:"length",value:function(){return this._length}},{key:"position",value:function(){return[this.textNode,this.textNode.data.length]}},{key:"remove",value:function(){h(M.prototype.__proto__||Object.getPrototypeOf(M.prototype),"remove",this).call(this),this.parent=null}},{key:"restore",value:function(){if(!(this.selection.composing||this.parent==null)){var z=this.textNode,$=this.selection.getNativeRange(),W=void 0,K=void 0,ee=void 0;if($!=null&&$.start.node===z&&$.end.node===z){var ne=[z,$.start.offset,$.end.offset];W=ne[0],K=ne[1],ee=ne[2]}for(;this.domNode.lastChild!=null&&this.domNode.lastChild!==this.textNode;)this.domNode.parentNode.insertBefore(this.domNode.lastChild,this.domNode);if(this.textNode.data!==M.CONTENTS){var ie=this.textNode.data.split(M.CONTENTS).join("");this.next instanceof b.default?(W=this.next.domNode,this.next.insertAt(0,ie),this.textNode.data=M.CONTENTS):(this.textNode.data=ie,this.parent.insertBefore(y.default.create(this.textNode),this),this.textNode=document.createTextNode(M.CONTENTS),this.domNode.appendChild(this.textNode))}if(this.remove(),K!=null){var re=[K,ee].map(function(ae){return Math.max(0,Math.min(W.data.length,ae-1))}),te=o(re,2);return K=te[0],ee=te[1],{startNode:W,startOffset:K,endNode:W,endOffset:ee}}}}},{key:"update",value:function(z,$){var W=this;if(z.some(function(ee){return ee.type==="characterData"&&ee.target===W.textNode})){var K=this.restore();K&&($.range=K)}}},{key:"value",value:function(){return""}}]),M}(y.default.Embed);I.blotName="cursor",I.className="ql-cursor",I.tagName="span",I.CONTENTS="\uFEFF",n.default=I},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(0),h=y(o),i=s(4),m=y(i);function y(O){return O&&O.__esModule?O:{default:O}}function S(O,P){if(!(O instanceof P))throw new TypeError("Cannot call a class as a function")}function b(O,P){if(!O)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return P&&(typeof P=="object"||typeof P=="function")?P:O}function T(O,P){if(typeof P!="function"&&P!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof P);O.prototype=Object.create(P&&P.prototype,{constructor:{value:O,enumerable:!1,writable:!0,configurable:!0}}),P&&(Object.setPrototypeOf?Object.setPrototypeOf(O,P):O.__proto__=P)}var A=function(O){T(P,O);function P(){return S(this,P),b(this,(P.__proto__||Object.getPrototypeOf(P)).apply(this,arguments))}return P}(h.default.Container);A.allowedChildren=[m.default,i.BlockEmbed,A],n.default=A},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.ColorStyle=n.ColorClass=n.ColorAttributor=void 0;var o=function(){function I(R,M){for(var F=0;F<M.length;F++){var z=M[F];z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z&&(z.writable=!0),Object.defineProperty(R,z.key,z)}}return function(R,M,F){return M&&I(R.prototype,M),F&&I(R,F),R}}(),h=function I(R,M,F){R===null&&(R=Function.prototype);var z=Object.getOwnPropertyDescriptor(R,M);if(z===void 0){var $=Object.getPrototypeOf(R);return $===null?void 0:I($,M,F)}else{if("value"in z)return z.value;var W=z.get;return W===void 0?void 0:W.call(F)}},i=s(0),m=y(i);function y(I){return I&&I.__esModule?I:{default:I}}function S(I,R){if(!(I instanceof R))throw new TypeError("Cannot call a class as a function")}function b(I,R){if(!I)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R&&(typeof R=="object"||typeof R=="function")?R:I}function T(I,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof R);I.prototype=Object.create(R&&R.prototype,{constructor:{value:I,enumerable:!1,writable:!0,configurable:!0}}),R&&(Object.setPrototypeOf?Object.setPrototypeOf(I,R):I.__proto__=R)}var A=function(I){T(R,I);function R(){return S(this,R),b(this,(R.__proto__||Object.getPrototypeOf(R)).apply(this,arguments))}return o(R,[{key:"value",value:function(F){var z=h(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"value",this).call(this,F);return z.startsWith("rgb(")?(z=z.replace(/^[^\d]+/,"").replace(/[^\d]+$/,""),"#"+z.split(",").map(function($){return("00"+parseInt($).toString(16)).slice(-2)}).join("")):z}}]),R}(m.default.Attributor.Style),O=new m.default.Attributor.Class("color","ql-color",{scope:m.default.Scope.INLINE}),P=new A("color","color",{scope:m.default.Scope.INLINE});n.ColorAttributor=A,n.ColorClass=O,n.ColorStyle=P},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.sanitize=n.default=void 0;var o=function(){function P(I,R){for(var M=0;M<R.length;M++){var F=R[M];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(I,F.key,F)}}return function(I,R,M){return R&&P(I.prototype,R),M&&P(I,M),I}}(),h=function P(I,R,M){I===null&&(I=Function.prototype);var F=Object.getOwnPropertyDescriptor(I,R);if(F===void 0){var z=Object.getPrototypeOf(I);return z===null?void 0:P(z,R,M)}else{if("value"in F)return F.value;var $=F.get;return $===void 0?void 0:$.call(M)}},i=s(6),m=y(i);function y(P){return P&&P.__esModule?P:{default:P}}function S(P,I){if(!(P instanceof I))throw new TypeError("Cannot call a class as a function")}function b(P,I){if(!P)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I&&(typeof I=="object"||typeof I=="function")?I:P}function T(P,I){if(typeof I!="function"&&I!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof I);P.prototype=Object.create(I&&I.prototype,{constructor:{value:P,enumerable:!1,writable:!0,configurable:!0}}),I&&(Object.setPrototypeOf?Object.setPrototypeOf(P,I):P.__proto__=I)}var A=function(P){T(I,P);function I(){return S(this,I),b(this,(I.__proto__||Object.getPrototypeOf(I)).apply(this,arguments))}return o(I,[{key:"format",value:function(M,F){if(M!==this.statics.blotName||!F)return h(I.prototype.__proto__||Object.getPrototypeOf(I.prototype),"format",this).call(this,M,F);F=this.constructor.sanitize(F),this.domNode.setAttribute("href",F)}}],[{key:"create",value:function(M){var F=h(I.__proto__||Object.getPrototypeOf(I),"create",this).call(this,M);return M=this.sanitize(M),F.setAttribute("href",M),F.setAttribute("rel","noopener noreferrer"),F.setAttribute("target","_blank"),F}},{key:"formats",value:function(M){return M.getAttribute("href")}},{key:"sanitize",value:function(M){return O(M,this.PROTOCOL_WHITELIST)?M:this.SANITIZED_URL}}]),I}(m.default);A.blotName="link",A.tagName="A",A.SANITIZED_URL="about:blank",A.PROTOCOL_WHITELIST=["http","https","mailto","tel"];function O(P,I){var R=document.createElement("a");R.href=P;var M=R.href.slice(0,R.href.indexOf(":"));return I.indexOf(M)>-1}n.default=A,n.sanitize=O},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},h=function(){function I(R,M){for(var F=0;F<M.length;F++){var z=M[F];z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z&&(z.writable=!0),Object.defineProperty(R,z.key,z)}}return function(R,M,F){return M&&I(R.prototype,M),F&&I(R,F),R}}(),i=s(23),m=b(i),y=s(107),S=b(y);function b(I){return I&&I.__esModule?I:{default:I}}function T(I,R){if(!(I instanceof R))throw new TypeError("Cannot call a class as a function")}var A=0;function O(I,R){I.setAttribute(R,I.getAttribute(R)!=="true")}var P=function(){function I(R){var M=this;T(this,I),this.select=R,this.container=document.createElement("span"),this.buildPicker(),this.select.style.display="none",this.select.parentNode.insertBefore(this.container,this.select),this.label.addEventListener("mousedown",function(){M.togglePicker()}),this.label.addEventListener("keydown",function(F){switch(F.keyCode){case m.default.keys.ENTER:M.togglePicker();break;case m.default.keys.ESCAPE:M.escape(),F.preventDefault();break}}),this.select.addEventListener("change",this.update.bind(this))}return h(I,[{key:"togglePicker",value:function(){this.container.classList.toggle("ql-expanded"),O(this.label,"aria-expanded"),O(this.options,"aria-hidden")}},{key:"buildItem",value:function(M){var F=this,z=document.createElement("span");return z.tabIndex="0",z.setAttribute("role","button"),z.classList.add("ql-picker-item"),M.hasAttribute("value")&&z.setAttribute("data-value",M.getAttribute("value")),M.textContent&&z.setAttribute("data-label",M.textContent),z.addEventListener("click",function(){F.selectItem(z,!0)}),z.addEventListener("keydown",function($){switch($.keyCode){case m.default.keys.ENTER:F.selectItem(z,!0),$.preventDefault();break;case m.default.keys.ESCAPE:F.escape(),$.preventDefault();break}}),z}},{key:"buildLabel",value:function(){var M=document.createElement("span");return M.classList.add("ql-picker-label"),M.innerHTML=S.default,M.tabIndex="0",M.setAttribute("role","button"),M.setAttribute("aria-expanded","false"),this.container.appendChild(M),M}},{key:"buildOptions",value:function(){var M=this,F=document.createElement("span");F.classList.add("ql-picker-options"),F.setAttribute("aria-hidden","true"),F.tabIndex="-1",F.id="ql-picker-options-"+A,A+=1,this.label.setAttribute("aria-controls",F.id),this.options=F,[].slice.call(this.select.options).forEach(function(z){var $=M.buildItem(z);F.appendChild($),z.selected===!0&&M.selectItem($)}),this.container.appendChild(F)}},{key:"buildPicker",value:function(){var M=this;[].slice.call(this.select.attributes).forEach(function(F){M.container.setAttribute(F.name,F.value)}),this.container.classList.add("ql-picker"),this.label=this.buildLabel(),this.buildOptions()}},{key:"escape",value:function(){var M=this;this.close(),setTimeout(function(){return M.label.focus()},1)}},{key:"close",value:function(){this.container.classList.remove("ql-expanded"),this.label.setAttribute("aria-expanded","false"),this.options.setAttribute("aria-hidden","true")}},{key:"selectItem",value:function(M){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,z=this.container.querySelector(".ql-selected");if(M!==z&&(z!=null&&z.classList.remove("ql-selected"),M!=null&&(M.classList.add("ql-selected"),this.select.selectedIndex=[].indexOf.call(M.parentNode.children,M),M.hasAttribute("data-value")?this.label.setAttribute("data-value",M.getAttribute("data-value")):this.label.removeAttribute("data-value"),M.hasAttribute("data-label")?this.label.setAttribute("data-label",M.getAttribute("data-label")):this.label.removeAttribute("data-label"),F))){if(typeof Event=="function")this.select.dispatchEvent(new Event("change"));else if((typeof Event>"u"?"undefined":o(Event))==="object"){var $=document.createEvent("Event");$.initEvent("change",!0,!0),this.select.dispatchEvent($)}this.close()}}},{key:"update",value:function(){var M=void 0;if(this.select.selectedIndex>-1){var F=this.container.querySelector(".ql-picker-options").children[this.select.selectedIndex];M=this.select.options[this.select.selectedIndex],this.selectItem(F)}else this.selectItem(null);var z=M!=null&&M!==this.select.querySelector("option[selected]");this.label.classList.toggle("ql-active",z)}}]),I}();n.default=P},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(0),h=be(o),i=s(5),m=be(i),y=s(4),S=be(y),b=s(16),T=be(b),A=s(25),O=be(A),P=s(24),I=be(P),R=s(35),M=be(R),F=s(6),z=be(F),$=s(22),W=be($),K=s(7),ee=be(K),ne=s(55),ie=be(ne),re=s(42),te=be(re),ae=s(23),ue=be(ae);function be(we){return we&&we.__esModule?we:{default:we}}m.default.register({"blots/block":S.default,"blots/block/embed":y.BlockEmbed,"blots/break":T.default,"blots/container":O.default,"blots/cursor":I.default,"blots/embed":M.default,"blots/inline":z.default,"blots/scroll":W.default,"blots/text":ee.default,"modules/clipboard":ie.default,"modules/history":te.default,"modules/keyboard":ue.default}),h.default.register(S.default,T.default,I.default,z.default,W.default,ee.default),n.default=m.default},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(1),h=function(){function i(m){this.domNode=m,this.domNode[o.DATA_KEY]={blot:this}}return Object.defineProperty(i.prototype,"statics",{get:function(){return this.constructor},enumerable:!0,configurable:!0}),i.create=function(m){if(this.tagName==null)throw new o.ParchmentError("Blot definition missing tagName");var y;return Array.isArray(this.tagName)?(typeof m=="string"&&(m=m.toUpperCase(),parseInt(m).toString()===m&&(m=parseInt(m))),typeof m=="number"?y=document.createElement(this.tagName[m-1]):this.tagName.indexOf(m)>-1?y=document.createElement(m):y=document.createElement(this.tagName[0])):y=document.createElement(this.tagName),this.className&&y.classList.add(this.className),y},i.prototype.attach=function(){this.parent!=null&&(this.scroll=this.parent.scroll)},i.prototype.clone=function(){var m=this.domNode.cloneNode(!1);return o.create(m)},i.prototype.detach=function(){this.parent!=null&&this.parent.removeChild(this),delete this.domNode[o.DATA_KEY]},i.prototype.deleteAt=function(m,y){var S=this.isolate(m,y);S.remove()},i.prototype.formatAt=function(m,y,S,b){var T=this.isolate(m,y);if(o.query(S,o.Scope.BLOT)!=null&&b)T.wrap(S,b);else if(o.query(S,o.Scope.ATTRIBUTE)!=null){var A=o.create(this.statics.scope);T.wrap(A),A.format(S,b)}},i.prototype.insertAt=function(m,y,S){var b=S==null?o.create("text",y):o.create(y,S),T=this.split(m);this.parent.insertBefore(b,T)},i.prototype.insertInto=function(m,y){y===void 0&&(y=null),this.parent!=null&&this.parent.children.remove(this);var S=null;m.children.insertBefore(this,y),y!=null&&(S=y.domNode),(this.domNode.parentNode!=m.domNode||this.domNode.nextSibling!=S)&&m.domNode.insertBefore(this.domNode,S),this.parent=m,this.attach()},i.prototype.isolate=function(m,y){var S=this.split(m);return S.split(y),S},i.prototype.length=function(){return 1},i.prototype.offset=function(m){return m===void 0&&(m=this.parent),this.parent==null||this==m?0:this.parent.children.offset(this)+this.parent.offset(m)},i.prototype.optimize=function(m){this.domNode[o.DATA_KEY]!=null&&delete this.domNode[o.DATA_KEY].mutations},i.prototype.remove=function(){this.domNode.parentNode!=null&&this.domNode.parentNode.removeChild(this.domNode),this.detach()},i.prototype.replace=function(m){m.parent!=null&&(m.parent.insertBefore(this,m.next),m.remove())},i.prototype.replaceWith=function(m,y){var S=typeof m=="string"?o.create(m,y):m;return S.replace(this),S},i.prototype.split=function(m,y){return m===0?this:this.next},i.prototype.update=function(m,y){},i.prototype.wrap=function(m,y){var S=typeof m=="string"?o.create(m,y):m;return this.parent!=null&&this.parent.insertBefore(S,this.next),S.appendChild(this),S},i.blotName="abstract",i}();n.default=h},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(12),h=s(32),i=s(33),m=s(1),y=function(){function S(b){this.attributes={},this.domNode=b,this.build()}return S.prototype.attribute=function(b,T){T?b.add(this.domNode,T)&&(b.value(this.domNode)!=null?this.attributes[b.attrName]=b:delete this.attributes[b.attrName]):(b.remove(this.domNode),delete this.attributes[b.attrName])},S.prototype.build=function(){var b=this;this.attributes={};var T=o.default.keys(this.domNode),A=h.default.keys(this.domNode),O=i.default.keys(this.domNode);T.concat(A).concat(O).forEach(function(P){var I=m.query(P,m.Scope.ATTRIBUTE);I instanceof o.default&&(b.attributes[I.attrName]=I)})},S.prototype.copy=function(b){var T=this;Object.keys(this.attributes).forEach(function(A){var O=T.attributes[A].value(T.domNode);b.format(A,O)})},S.prototype.move=function(b){var T=this;this.copy(b),Object.keys(this.attributes).forEach(function(A){T.attributes[A].remove(T.domNode)}),this.attributes={}},S.prototype.values=function(){var b=this;return Object.keys(this.attributes).reduce(function(T,A){return T[A]=b.attributes[A].value(b.domNode),T},{})},S}();n.default=y},function(r,n,s){var o=this&&this.__extends||function(){var y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,b){S.__proto__=b}||function(S,b){for(var T in b)b.hasOwnProperty(T)&&(S[T]=b[T])};return function(S,b){y(S,b);function T(){this.constructor=S}S.prototype=b===null?Object.create(b):(T.prototype=b.prototype,new T)}}();Object.defineProperty(n,"__esModule",{value:!0});var h=s(12);function i(y,S){var b=y.getAttribute("class")||"";return b.split(/\s+/).filter(function(T){return T.indexOf(S+"-")===0})}var m=function(y){o(S,y);function S(){return y!==null&&y.apply(this,arguments)||this}return S.keys=function(b){return(b.getAttribute("class")||"").split(/\s+/).map(function(T){return T.split("-").slice(0,-1).join("-")})},S.prototype.add=function(b,T){return this.canAdd(b,T)?(this.remove(b),b.classList.add(this.keyName+"-"+T),!0):!1},S.prototype.remove=function(b){var T=i(b,this.keyName);T.forEach(function(A){b.classList.remove(A)}),b.classList.length===0&&b.removeAttribute("class")},S.prototype.value=function(b){var T=i(b,this.keyName)[0]||"",A=T.slice(this.keyName.length+1);return this.canAdd(b,A)?A:""},S}(h.default);n.default=m},function(r,n,s){var o=this&&this.__extends||function(){var y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,b){S.__proto__=b}||function(S,b){for(var T in b)b.hasOwnProperty(T)&&(S[T]=b[T])};return function(S,b){y(S,b);function T(){this.constructor=S}S.prototype=b===null?Object.create(b):(T.prototype=b.prototype,new T)}}();Object.defineProperty(n,"__esModule",{value:!0});var h=s(12);function i(y){var S=y.split("-"),b=S.slice(1).map(function(T){return T[0].toUpperCase()+T.slice(1)}).join("");return S[0]+b}var m=function(y){o(S,y);function S(){return y!==null&&y.apply(this,arguments)||this}return S.keys=function(b){return(b.getAttribute("style")||"").split(";").map(function(T){var A=T.split(":");return A[0].trim()})},S.prototype.add=function(b,T){return this.canAdd(b,T)?(b.style[i(this.keyName)]=T,!0):!1},S.prototype.remove=function(b){b.style[i(this.keyName)]="",b.getAttribute("style")||b.removeAttribute("style")},S.prototype.value=function(b){var T=b.style[i(this.keyName)];return this.canAdd(b,T)?T:""},S}(h.default);n.default=m},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function m(y,S){for(var b=0;b<S.length;b++){var T=S[b];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(y,T.key,T)}}return function(y,S,b){return S&&m(y.prototype,S),b&&m(y,b),y}}();function h(m,y){if(!(m instanceof y))throw new TypeError("Cannot call a class as a function")}var i=function(){function m(y,S){h(this,m),this.quill=y,this.options=S,this.modules={}}return o(m,[{key:"init",value:function(){var S=this;Object.keys(this.options.modules).forEach(function(b){S.modules[b]==null&&S.addModule(b)})}},{key:"addModule",value:function(S){var b=this.quill.constructor.import("modules/"+S);return this.modules[S]=new b(this.quill,this.options.modules[S]||{}),this.modules[S]}}]),m}();i.DEFAULTS={modules:{}},i.themes={default:i},n.default=i},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function R(M,F){for(var z=0;z<F.length;z++){var $=F[z];$.enumerable=$.enumerable||!1,$.configurable=!0,"value"in $&&($.writable=!0),Object.defineProperty(M,$.key,$)}}return function(M,F,z){return F&&R(M.prototype,F),z&&R(M,z),M}}(),h=function R(M,F,z){M===null&&(M=Function.prototype);var $=Object.getOwnPropertyDescriptor(M,F);if($===void 0){var W=Object.getPrototypeOf(M);return W===null?void 0:R(W,F,z)}else{if("value"in $)return $.value;var K=$.get;return K===void 0?void 0:K.call(z)}},i=s(0),m=b(i),y=s(7),S=b(y);function b(R){return R&&R.__esModule?R:{default:R}}function T(R,M){if(!(R instanceof M))throw new TypeError("Cannot call a class as a function")}function A(R,M){if(!R)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return M&&(typeof M=="object"||typeof M=="function")?M:R}function O(R,M){if(typeof M!="function"&&M!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof M);R.prototype=Object.create(M&&M.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),M&&(Object.setPrototypeOf?Object.setPrototypeOf(R,M):R.__proto__=M)}var P="\uFEFF",I=function(R){O(M,R);function M(F){T(this,M);var z=A(this,(M.__proto__||Object.getPrototypeOf(M)).call(this,F));return z.contentNode=document.createElement("span"),z.contentNode.setAttribute("contenteditable",!1),[].slice.call(z.domNode.childNodes).forEach(function($){z.contentNode.appendChild($)}),z.leftGuard=document.createTextNode(P),z.rightGuard=document.createTextNode(P),z.domNode.appendChild(z.leftGuard),z.domNode.appendChild(z.contentNode),z.domNode.appendChild(z.rightGuard),z}return o(M,[{key:"index",value:function(z,$){return z===this.leftGuard?0:z===this.rightGuard?1:h(M.prototype.__proto__||Object.getPrototypeOf(M.prototype),"index",this).call(this,z,$)}},{key:"restore",value:function(z){var $=void 0,W=void 0,K=z.data.split(P).join("");if(z===this.leftGuard)if(this.prev instanceof S.default){var ee=this.prev.length();this.prev.insertAt(ee,K),$={startNode:this.prev.domNode,startOffset:ee+K.length}}else W=document.createTextNode(K),this.parent.insertBefore(m.default.create(W),this),$={startNode:W,startOffset:K.length};else z===this.rightGuard&&(this.next instanceof S.default?(this.next.insertAt(0,K),$={startNode:this.next.domNode,startOffset:K.length}):(W=document.createTextNode(K),this.parent.insertBefore(m.default.create(W),this.next),$={startNode:W,startOffset:K.length}));return z.data=P,$}},{key:"update",value:function(z,$){var W=this;z.forEach(function(K){if(K.type==="characterData"&&(K.target===W.leftGuard||K.target===W.rightGuard)){var ee=W.restore(K.target);ee&&($.range=ee)}})}}]),M}(m.default.Embed);n.default=I},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.AlignStyle=n.AlignClass=n.AlignAttribute=void 0;var o=s(0),h=i(o);function i(T){return T&&T.__esModule?T:{default:T}}var m={scope:h.default.Scope.BLOCK,whitelist:["right","center","justify"]},y=new h.default.Attributor.Attribute("align","align",m),S=new h.default.Attributor.Class("align","ql-align",m),b=new h.default.Attributor.Style("align","text-align",m);n.AlignAttribute=y,n.AlignClass=S,n.AlignStyle=b},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.BackgroundStyle=n.BackgroundClass=void 0;var o=s(0),h=m(o),i=s(26);function m(b){return b&&b.__esModule?b:{default:b}}var y=new h.default.Attributor.Class("background","ql-bg",{scope:h.default.Scope.INLINE}),S=new i.ColorAttributor("background","background-color",{scope:h.default.Scope.INLINE});n.BackgroundClass=y,n.BackgroundStyle=S},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.DirectionStyle=n.DirectionClass=n.DirectionAttribute=void 0;var o=s(0),h=i(o);function i(T){return T&&T.__esModule?T:{default:T}}var m={scope:h.default.Scope.BLOCK,whitelist:["rtl"]},y=new h.default.Attributor.Attribute("direction","dir",m),S=new h.default.Attributor.Class("direction","ql-direction",m),b=new h.default.Attributor.Style("direction","direction",m);n.DirectionAttribute=y,n.DirectionClass=S,n.DirectionStyle=b},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.FontClass=n.FontStyle=void 0;var o=function(){function R(M,F){for(var z=0;z<F.length;z++){var $=F[z];$.enumerable=$.enumerable||!1,$.configurable=!0,"value"in $&&($.writable=!0),Object.defineProperty(M,$.key,$)}}return function(M,F,z){return F&&R(M.prototype,F),z&&R(M,z),M}}(),h=function R(M,F,z){M===null&&(M=Function.prototype);var $=Object.getOwnPropertyDescriptor(M,F);if($===void 0){var W=Object.getPrototypeOf(M);return W===null?void 0:R(W,F,z)}else{if("value"in $)return $.value;var K=$.get;return K===void 0?void 0:K.call(z)}},i=s(0),m=y(i);function y(R){return R&&R.__esModule?R:{default:R}}function S(R,M){if(!(R instanceof M))throw new TypeError("Cannot call a class as a function")}function b(R,M){if(!R)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return M&&(typeof M=="object"||typeof M=="function")?M:R}function T(R,M){if(typeof M!="function"&&M!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof M);R.prototype=Object.create(M&&M.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),M&&(Object.setPrototypeOf?Object.setPrototypeOf(R,M):R.__proto__=M)}var A={scope:m.default.Scope.INLINE,whitelist:["serif","monospace"]},O=new m.default.Attributor.Class("font","ql-font",A),P=function(R){T(M,R);function M(){return S(this,M),b(this,(M.__proto__||Object.getPrototypeOf(M)).apply(this,arguments))}return o(M,[{key:"value",value:function(z){return h(M.prototype.__proto__||Object.getPrototypeOf(M.prototype),"value",this).call(this,z).replace(/["']/g,"")}}]),M}(m.default.Attributor.Style),I=new P("font","font-family",A);n.FontStyle=I,n.FontClass=O},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.SizeStyle=n.SizeClass=void 0;var o=s(0),h=i(o);function i(S){return S&&S.__esModule?S:{default:S}}var m=new h.default.Attributor.Class("size","ql-size",{scope:h.default.Scope.INLINE,whitelist:["small","large","huge"]}),y=new h.default.Attributor.Style("size","font-size",{scope:h.default.Scope.INLINE,whitelist:["10px","18px","32px"]});n.SizeClass=m,n.SizeStyle=y},function(r,n,s){r.exports={align:{"":s(76),center:s(77),right:s(78),justify:s(79)},background:s(80),blockquote:s(81),bold:s(82),clean:s(83),code:s(58),"code-block":s(58),color:s(84),direction:{"":s(85),rtl:s(86)},float:{center:s(87),full:s(88),left:s(89),right:s(90)},formula:s(91),header:{1:s(92),2:s(93)},italic:s(94),image:s(95),indent:{"+1":s(96),"-1":s(97)},link:s(98),list:{ordered:s(99),bullet:s(100),check:s(101)},script:{sub:s(102),super:s(103)},strike:s(104),underline:s(105),video:s(106)}},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.getLastChangeIndex=n.default=void 0;var o=function(){function F(z,$){for(var W=0;W<$.length;W++){var K=$[W];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(z,K.key,K)}}return function(z,$,W){return $&&F(z.prototype,$),W&&F(z,W),z}}(),h=s(0),i=T(h),m=s(5),y=T(m),S=s(9),b=T(S);function T(F){return F&&F.__esModule?F:{default:F}}function A(F,z){if(!(F instanceof z))throw new TypeError("Cannot call a class as a function")}function O(F,z){if(!F)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return z&&(typeof z=="object"||typeof z=="function")?z:F}function P(F,z){if(typeof z!="function"&&z!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof z);F.prototype=Object.create(z&&z.prototype,{constructor:{value:F,enumerable:!1,writable:!0,configurable:!0}}),z&&(Object.setPrototypeOf?Object.setPrototypeOf(F,z):F.__proto__=z)}var I=function(F){P(z,F);function z($,W){A(this,z);var K=O(this,(z.__proto__||Object.getPrototypeOf(z)).call(this,$,W));return K.lastRecorded=0,K.ignoreChange=!1,K.clear(),K.quill.on(y.default.events.EDITOR_CHANGE,function(ee,ne,ie,re){ee!==y.default.events.TEXT_CHANGE||K.ignoreChange||(!K.options.userOnly||re===y.default.sources.USER?K.record(ne,ie):K.transform(ne))}),K.quill.keyboard.addBinding({key:"Z",shortKey:!0},K.undo.bind(K)),K.quill.keyboard.addBinding({key:"Z",shortKey:!0,shiftKey:!0},K.redo.bind(K)),/Win/i.test(navigator.platform)&&K.quill.keyboard.addBinding({key:"Y",shortKey:!0},K.redo.bind(K)),K}return o(z,[{key:"change",value:function(W,K){if(this.stack[W].length!==0){var ee=this.stack[W].pop();this.stack[K].push(ee),this.lastRecorded=0,this.ignoreChange=!0,this.quill.updateContents(ee[W],y.default.sources.USER),this.ignoreChange=!1;var ne=M(ee[W]);this.quill.setSelection(ne)}}},{key:"clear",value:function(){this.stack={undo:[],redo:[]}}},{key:"cutoff",value:function(){this.lastRecorded=0}},{key:"record",value:function(W,K){if(W.ops.length!==0){this.stack.redo=[];var ee=this.quill.getContents().diff(K),ne=Date.now();if(this.lastRecorded+this.options.delay>ne&&this.stack.undo.length>0){var ie=this.stack.undo.pop();ee=ee.compose(ie.undo),W=ie.redo.compose(W)}else this.lastRecorded=ne;this.stack.undo.push({redo:W,undo:ee}),this.stack.undo.length>this.options.maxStack&&this.stack.undo.shift()}}},{key:"redo",value:function(){this.change("redo","undo")}},{key:"transform",value:function(W){this.stack.undo.forEach(function(K){K.undo=W.transform(K.undo,!0),K.redo=W.transform(K.redo,!0)}),this.stack.redo.forEach(function(K){K.undo=W.transform(K.undo,!0),K.redo=W.transform(K.redo,!0)})}},{key:"undo",value:function(){this.change("undo","redo")}}]),z}(b.default);I.DEFAULTS={delay:1e3,maxStack:100,userOnly:!1};function R(F){var z=F.ops[F.ops.length-1];return z==null?!1:z.insert!=null?typeof z.insert=="string"&&z.insert.endsWith(`
`):z.attributes!=null?Object.keys(z.attributes).some(function($){return i.default.query($,i.default.Scope.BLOCK)!=null}):!1}function M(F){var z=F.reduce(function(W,K){return W+=K.delete||0,W},0),$=F.length()-z;return R(F)&&($-=1),$}n.default=I,n.getLastChangeIndex=M},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.BaseTooltip=void 0;var o=function(){function pe(Oe,Je){for(var Ze=0;Ze<Je.length;Ze++){var Pe=Je[Ze];Pe.enumerable=Pe.enumerable||!1,Pe.configurable=!0,"value"in Pe&&(Pe.writable=!0),Object.defineProperty(Oe,Pe.key,Pe)}}return function(Oe,Je,Ze){return Je&&pe(Oe.prototype,Je),Ze&&pe(Oe,Ze),Oe}}(),h=function pe(Oe,Je,Ze){Oe===null&&(Oe=Function.prototype);var Pe=Object.getOwnPropertyDescriptor(Oe,Je);if(Pe===void 0){var Be=Object.getPrototypeOf(Oe);return Be===null?void 0:pe(Be,Je,Ze)}else{if("value"in Pe)return Pe.value;var nt=Pe.get;return nt===void 0?void 0:nt.call(Ze)}},i=s(3),m=ne(i),y=s(2),S=ne(y),b=s(8),T=ne(b),A=s(23),O=ne(A),P=s(34),I=ne(P),R=s(59),M=ne(R),F=s(60),z=ne(F),$=s(28),W=ne($),K=s(61),ee=ne(K);function ne(pe){return pe&&pe.__esModule?pe:{default:pe}}function ie(pe,Oe){if(!(pe instanceof Oe))throw new TypeError("Cannot call a class as a function")}function re(pe,Oe){if(!pe)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Oe&&(typeof Oe=="object"||typeof Oe=="function")?Oe:pe}function te(pe,Oe){if(typeof Oe!="function"&&Oe!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof Oe);pe.prototype=Object.create(Oe&&Oe.prototype,{constructor:{value:pe,enumerable:!1,writable:!0,configurable:!0}}),Oe&&(Object.setPrototypeOf?Object.setPrototypeOf(pe,Oe):pe.__proto__=Oe)}var ae=[!1,"center","right","justify"],ue=["#000000","#e60000","#ff9900","#ffff00","#008a00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466"],be=[!1,"serif","monospace"],we=["1","2","3",!1],Ce=["small",!1,"large","huge"],_e=function(pe){te(Oe,pe);function Oe(Je,Ze){ie(this,Oe);var Pe=re(this,(Oe.__proto__||Object.getPrototypeOf(Oe)).call(this,Je,Ze)),Be=function nt(Me){if(!document.body.contains(Je.root))return document.body.removeEventListener("click",nt);Pe.tooltip!=null&&!Pe.tooltip.root.contains(Me.target)&&document.activeElement!==Pe.tooltip.textbox&&!Pe.quill.hasFocus()&&Pe.tooltip.hide(),Pe.pickers!=null&&Pe.pickers.forEach(function(We){We.container.contains(Me.target)||We.close()})};return Je.emitter.listenDOM("click",document.body,Be),Pe}return o(Oe,[{key:"addModule",value:function(Ze){var Pe=h(Oe.prototype.__proto__||Object.getPrototypeOf(Oe.prototype),"addModule",this).call(this,Ze);return Ze==="toolbar"&&this.extendToolbar(Pe),Pe}},{key:"buildButtons",value:function(Ze,Pe){Ze.forEach(function(Be){var nt=Be.getAttribute("class")||"";nt.split(/\s+/).forEach(function(Me){if(Me.startsWith("ql-")&&(Me=Me.slice(3),Pe[Me]!=null))if(Me==="direction")Be.innerHTML=Pe[Me][""]+Pe[Me].rtl;else if(typeof Pe[Me]=="string")Be.innerHTML=Pe[Me];else{var We=Be.value||"";We!=null&&Pe[Me][We]&&(Be.innerHTML=Pe[Me][We])}})})}},{key:"buildPickers",value:function(Ze,Pe){var Be=this;this.pickers=Ze.map(function(Me){if(Me.classList.contains("ql-align"))return Me.querySelector("option")==null&&ge(Me,ae),new z.default(Me,Pe.align);if(Me.classList.contains("ql-background")||Me.classList.contains("ql-color")){var We=Me.classList.contains("ql-background")?"background":"color";return Me.querySelector("option")==null&&ge(Me,ue,We==="background"?"#ffffff":"#000000"),new M.default(Me,Pe[We])}else return Me.querySelector("option")==null&&(Me.classList.contains("ql-font")?ge(Me,be):Me.classList.contains("ql-header")?ge(Me,we):Me.classList.contains("ql-size")&&ge(Me,Ce)),new W.default(Me)});var nt=function(){Be.pickers.forEach(function(We){We.update()})};this.quill.on(T.default.events.EDITOR_CHANGE,nt)}}]),Oe}(I.default);_e.DEFAULTS=(0,m.default)(!0,{},I.default.DEFAULTS,{modules:{toolbar:{handlers:{formula:function(){this.quill.theme.tooltip.edit("formula")},image:function(){var Oe=this,Je=this.container.querySelector("input.ql-image[type=file]");Je==null&&(Je=document.createElement("input"),Je.setAttribute("type","file"),Je.setAttribute("accept","image/png, image/gif, image/jpeg, image/bmp, image/x-icon"),Je.classList.add("ql-image"),Je.addEventListener("change",function(){if(Je.files!=null&&Je.files[0]!=null){var Ze=new FileReader;Ze.onload=function(Pe){var Be=Oe.quill.getSelection(!0);Oe.quill.updateContents(new S.default().retain(Be.index).delete(Be.length).insert({image:Pe.target.result}),T.default.sources.USER),Oe.quill.setSelection(Be.index+1,T.default.sources.SILENT),Je.value=""},Ze.readAsDataURL(Je.files[0])}}),this.container.appendChild(Je)),Je.click()},video:function(){this.quill.theme.tooltip.edit("video")}}}}});var me=function(pe){te(Oe,pe);function Oe(Je,Ze){ie(this,Oe);var Pe=re(this,(Oe.__proto__||Object.getPrototypeOf(Oe)).call(this,Je,Ze));return Pe.textbox=Pe.root.querySelector('input[type="text"]'),Pe.listen(),Pe}return o(Oe,[{key:"listen",value:function(){var Ze=this;this.textbox.addEventListener("keydown",function(Pe){O.default.match(Pe,"enter")?(Ze.save(),Pe.preventDefault()):O.default.match(Pe,"escape")&&(Ze.cancel(),Pe.preventDefault())})}},{key:"cancel",value:function(){this.hide()}},{key:"edit",value:function(){var Ze=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"link",Pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;this.root.classList.remove("ql-hidden"),this.root.classList.add("ql-editing"),Pe!=null?this.textbox.value=Pe:Ze!==this.root.getAttribute("data-mode")&&(this.textbox.value=""),this.position(this.quill.getBounds(this.quill.selection.savedRange)),this.textbox.select(),this.textbox.setAttribute("placeholder",this.textbox.getAttribute("data-"+Ze)||""),this.root.setAttribute("data-mode",Ze)}},{key:"restoreFocus",value:function(){var Ze=this.quill.scrollingContainer.scrollTop;this.quill.focus(),this.quill.scrollingContainer.scrollTop=Ze}},{key:"save",value:function(){var Ze=this.textbox.value;switch(this.root.getAttribute("data-mode")){case"link":{var Pe=this.quill.root.scrollTop;this.linkRange?(this.quill.formatText(this.linkRange,"link",Ze,T.default.sources.USER),delete this.linkRange):(this.restoreFocus(),this.quill.format("link",Ze,T.default.sources.USER)),this.quill.root.scrollTop=Pe;break}case"video":Ze=Ae(Ze);case"formula":{if(!Ze)break;var Be=this.quill.getSelection(!0);if(Be!=null){var nt=Be.index+Be.length;this.quill.insertEmbed(nt,this.root.getAttribute("data-mode"),Ze,T.default.sources.USER),this.root.getAttribute("data-mode")==="formula"&&this.quill.insertText(nt+1," ",T.default.sources.USER),this.quill.setSelection(nt+2,T.default.sources.USER)}break}}this.textbox.value="",this.hide()}}]),Oe}(ee.default);function Ae(pe){var Oe=pe.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/)||pe.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtu\.be\/([a-zA-Z0-9_-]+)/);return Oe?(Oe[1]||"https")+"://www.youtube.com/embed/"+Oe[2]+"?showinfo=0":(Oe=pe.match(/^(?:(https?):\/\/)?(?:www\.)?vimeo\.com\/(\d+)/))?(Oe[1]||"https")+"://player.vimeo.com/video/"+Oe[2]+"/":pe}function ge(pe,Oe){var Je=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;Oe.forEach(function(Ze){var Pe=document.createElement("option");Ze===Je?Pe.setAttribute("selected","selected"):Pe.setAttribute("value",Ze),pe.appendChild(Pe)})}n.BaseTooltip=me,n.default=_e},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function h(){this.head=this.tail=null,this.length=0}return h.prototype.append=function(){for(var i=[],m=0;m<arguments.length;m++)i[m]=arguments[m];this.insertBefore(i[0],null),i.length>1&&this.append.apply(this,i.slice(1))},h.prototype.contains=function(i){for(var m,y=this.iterator();m=y();)if(m===i)return!0;return!1},h.prototype.insertBefore=function(i,m){i&&(i.next=m,m!=null?(i.prev=m.prev,m.prev!=null&&(m.prev.next=i),m.prev=i,m===this.head&&(this.head=i)):this.tail!=null?(this.tail.next=i,i.prev=this.tail,this.tail=i):(i.prev=null,this.head=this.tail=i),this.length+=1)},h.prototype.offset=function(i){for(var m=0,y=this.head;y!=null;){if(y===i)return m;m+=y.length(),y=y.next}return-1},h.prototype.remove=function(i){this.contains(i)&&(i.prev!=null&&(i.prev.next=i.next),i.next!=null&&(i.next.prev=i.prev),i===this.head&&(this.head=i.next),i===this.tail&&(this.tail=i.prev),this.length-=1)},h.prototype.iterator=function(i){return i===void 0&&(i=this.head),function(){var m=i;return i!=null&&(i=i.next),m}},h.prototype.find=function(i,m){m===void 0&&(m=!1);for(var y,S=this.iterator();y=S();){var b=y.length();if(i<b||m&&i===b&&(y.next==null||y.next.length()!==0))return[y,i];i-=b}return[null,0]},h.prototype.forEach=function(i){for(var m,y=this.iterator();m=y();)i(m)},h.prototype.forEachAt=function(i,m,y){if(!(m<=0))for(var S=this.find(i),b=S[0],T=S[1],A,O=i-T,P=this.iterator(b);(A=P())&&O<i+m;){var I=A.length();i>O?y(A,i-O,Math.min(m,O+I-i)):y(A,0,Math.min(I,i+m-O)),O+=I}},h.prototype.map=function(i){return this.reduce(function(m,y){return m.push(i(y)),m},[])},h.prototype.reduce=function(i,m){for(var y,S=this.iterator();y=S();)m=i(m,y);return m},h}();n.default=o},function(r,n,s){var o=this&&this.__extends||function(){var b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,A){T.__proto__=A}||function(T,A){for(var O in A)A.hasOwnProperty(O)&&(T[O]=A[O])};return function(T,A){b(T,A);function O(){this.constructor=T}T.prototype=A===null?Object.create(A):(O.prototype=A.prototype,new O)}}();Object.defineProperty(n,"__esModule",{value:!0});var h=s(17),i=s(1),m={attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0},y=100,S=function(b){o(T,b);function T(A){var O=b.call(this,A)||this;return O.scroll=O,O.observer=new MutationObserver(function(P){O.update(P)}),O.observer.observe(O.domNode,m),O.attach(),O}return T.prototype.detach=function(){b.prototype.detach.call(this),this.observer.disconnect()},T.prototype.deleteAt=function(A,O){this.update(),A===0&&O===this.length()?this.children.forEach(function(P){P.remove()}):b.prototype.deleteAt.call(this,A,O)},T.prototype.formatAt=function(A,O,P,I){this.update(),b.prototype.formatAt.call(this,A,O,P,I)},T.prototype.insertAt=function(A,O,P){this.update(),b.prototype.insertAt.call(this,A,O,P)},T.prototype.optimize=function(A,O){var P=this;A===void 0&&(A=[]),O===void 0&&(O={}),b.prototype.optimize.call(this,O);for(var I=[].slice.call(this.observer.takeRecords());I.length>0;)A.push(I.pop());for(var R=function($,W){W===void 0&&(W=!0),!($==null||$===P)&&$.domNode.parentNode!=null&&($.domNode[i.DATA_KEY].mutations==null&&($.domNode[i.DATA_KEY].mutations=[]),W&&R($.parent))},M=function($){$.domNode[i.DATA_KEY]==null||$.domNode[i.DATA_KEY].mutations==null||($ instanceof h.default&&$.children.forEach(M),$.optimize(O))},F=A,z=0;F.length>0;z+=1){if(z>=y)throw new Error("[Parchment] Maximum optimize iterations reached");for(F.forEach(function($){var W=i.find($.target,!0);W!=null&&(W.domNode===$.target&&($.type==="childList"?(R(i.find($.previousSibling,!1)),[].forEach.call($.addedNodes,function(K){var ee=i.find(K,!1);R(ee,!1),ee instanceof h.default&&ee.children.forEach(function(ne){R(ne,!1)})})):$.type==="attributes"&&R(W.prev)),R(W))}),this.children.forEach(M),F=[].slice.call(this.observer.takeRecords()),I=F.slice();I.length>0;)A.push(I.pop())}},T.prototype.update=function(A,O){var P=this;O===void 0&&(O={}),A=A||this.observer.takeRecords(),A.map(function(I){var R=i.find(I.target,!0);return R==null?null:R.domNode[i.DATA_KEY].mutations==null?(R.domNode[i.DATA_KEY].mutations=[I],R):(R.domNode[i.DATA_KEY].mutations.push(I),null)}).forEach(function(I){I==null||I===P||I.domNode[i.DATA_KEY]==null||I.update(I.domNode[i.DATA_KEY].mutations||[],O)}),this.domNode[i.DATA_KEY].mutations!=null&&b.prototype.update.call(this,this.domNode[i.DATA_KEY].mutations,O),this.optimize(A,O)},T.blotName="scroll",T.defaultChild="block",T.scope=i.Scope.BLOCK_BLOT,T.tagName="DIV",T}(h.default);n.default=S},function(r,n,s){var o=this&&this.__extends||function(){var S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,T){b.__proto__=T}||function(b,T){for(var A in T)T.hasOwnProperty(A)&&(b[A]=T[A])};return function(b,T){S(b,T);function A(){this.constructor=b}b.prototype=T===null?Object.create(T):(A.prototype=T.prototype,new A)}}();Object.defineProperty(n,"__esModule",{value:!0});var h=s(18),i=s(1);function m(S,b){if(Object.keys(S).length!==Object.keys(b).length)return!1;for(var T in S)if(S[T]!==b[T])return!1;return!0}var y=function(S){o(b,S);function b(){return S!==null&&S.apply(this,arguments)||this}return b.formats=function(T){if(T.tagName!==b.tagName)return S.formats.call(this,T)},b.prototype.format=function(T,A){var O=this;T===this.statics.blotName&&!A?(this.children.forEach(function(P){P instanceof h.default||(P=P.wrap(b.blotName,!0)),O.attributes.copy(P)}),this.unwrap()):S.prototype.format.call(this,T,A)},b.prototype.formatAt=function(T,A,O,P){if(this.formats()[O]!=null||i.query(O,i.Scope.ATTRIBUTE)){var I=this.isolate(T,A);I.format(O,P)}else S.prototype.formatAt.call(this,T,A,O,P)},b.prototype.optimize=function(T){S.prototype.optimize.call(this,T);var A=this.formats();if(Object.keys(A).length===0)return this.unwrap();var O=this.next;O instanceof b&&O.prev===this&&m(A,O.formats())&&(O.moveChildren(this),O.remove())},b.blotName="inline",b.scope=i.Scope.INLINE_BLOT,b.tagName="SPAN",b}(h.default);n.default=y},function(r,n,s){var o=this&&this.__extends||function(){var y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,b){S.__proto__=b}||function(S,b){for(var T in b)b.hasOwnProperty(T)&&(S[T]=b[T])};return function(S,b){y(S,b);function T(){this.constructor=S}S.prototype=b===null?Object.create(b):(T.prototype=b.prototype,new T)}}();Object.defineProperty(n,"__esModule",{value:!0});var h=s(18),i=s(1),m=function(y){o(S,y);function S(){return y!==null&&y.apply(this,arguments)||this}return S.formats=function(b){var T=i.query(S.blotName).tagName;if(b.tagName!==T)return y.formats.call(this,b)},S.prototype.format=function(b,T){i.query(b,i.Scope.BLOCK)!=null&&(b===this.statics.blotName&&!T?this.replaceWith(S.blotName):y.prototype.format.call(this,b,T))},S.prototype.formatAt=function(b,T,A,O){i.query(A,i.Scope.BLOCK)!=null?this.format(A,O):y.prototype.formatAt.call(this,b,T,A,O)},S.prototype.insertAt=function(b,T,A){if(A==null||i.query(T,i.Scope.INLINE)!=null)y.prototype.insertAt.call(this,b,T,A);else{var O=this.split(b),P=i.create(T,A);O.parent.insertBefore(P,O)}},S.prototype.update=function(b,T){navigator.userAgent.match(/Trident/)?this.build():y.prototype.update.call(this,b,T)},S.blotName="block",S.scope=i.Scope.BLOCK_BLOT,S.tagName="P",S}(h.default);n.default=m},function(r,n,s){var o=this&&this.__extends||function(){var m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,S){y.__proto__=S}||function(y,S){for(var b in S)S.hasOwnProperty(b)&&(y[b]=S[b])};return function(y,S){m(y,S);function b(){this.constructor=y}y.prototype=S===null?Object.create(S):(b.prototype=S.prototype,new b)}}();Object.defineProperty(n,"__esModule",{value:!0});var h=s(19),i=function(m){o(y,m);function y(){return m!==null&&m.apply(this,arguments)||this}return y.formats=function(S){},y.prototype.format=function(S,b){m.prototype.formatAt.call(this,0,this.length(),S,b)},y.prototype.formatAt=function(S,b,T,A){S===0&&b===this.length()?this.format(T,A):m.prototype.formatAt.call(this,S,b,T,A)},y.prototype.formats=function(){return this.statics.formats(this.domNode)},y}(h.default);n.default=i},function(r,n,s){var o=this&&this.__extends||function(){var y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,b){S.__proto__=b}||function(S,b){for(var T in b)b.hasOwnProperty(T)&&(S[T]=b[T])};return function(S,b){y(S,b);function T(){this.constructor=S}S.prototype=b===null?Object.create(b):(T.prototype=b.prototype,new T)}}();Object.defineProperty(n,"__esModule",{value:!0});var h=s(19),i=s(1),m=function(y){o(S,y);function S(b){var T=y.call(this,b)||this;return T.text=T.statics.value(T.domNode),T}return S.create=function(b){return document.createTextNode(b)},S.value=function(b){var T=b.data;return T.normalize&&(T=T.normalize()),T},S.prototype.deleteAt=function(b,T){this.domNode.data=this.text=this.text.slice(0,b)+this.text.slice(b+T)},S.prototype.index=function(b,T){return this.domNode===b?T:-1},S.prototype.insertAt=function(b,T,A){A==null?(this.text=this.text.slice(0,b)+T+this.text.slice(b),this.domNode.data=this.text):y.prototype.insertAt.call(this,b,T,A)},S.prototype.length=function(){return this.text.length},S.prototype.optimize=function(b){y.prototype.optimize.call(this,b),this.text=this.statics.value(this.domNode),this.text.length===0?this.remove():this.next instanceof S&&this.next.prev===this&&(this.insertAt(this.length(),this.next.value()),this.next.remove())},S.prototype.position=function(b,T){return[this.domNode,b]},S.prototype.split=function(b,T){if(T===void 0&&(T=!1),!T){if(b===0)return this;if(b===this.length())return this.next}var A=i.create(this.domNode.splitText(b));return this.parent.insertBefore(A,this.next),this.text=this.statics.value(this.domNode),A},S.prototype.update=function(b,T){var A=this;b.some(function(O){return O.type==="characterData"&&O.target===A.domNode})&&(this.text=this.statics.value(this.domNode))},S.prototype.value=function(){return this.text},S.blotName="text",S.scope=i.Scope.INLINE_BLOT,S}(h.default);n.default=m},function(r,n,s){var o=document.createElement("div");if(o.classList.toggle("test-class",!1),o.classList.contains("test-class")){var h=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(i,m){return arguments.length>1&&!this.contains(i)==!m?m:h.call(this,i)}}String.prototype.startsWith||(String.prototype.startsWith=function(i,m){return m=m||0,this.substr(m,i.length)===i}),String.prototype.endsWith||(String.prototype.endsWith=function(i,m){var y=this.toString();(typeof m!="number"||!isFinite(m)||Math.floor(m)!==m||m>y.length)&&(m=y.length),m-=i.length;var S=y.indexOf(i,m);return S!==-1&&S===m}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(m){if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof m!="function")throw new TypeError("predicate must be a function");for(var y=Object(this),S=y.length>>>0,b=arguments[1],T,A=0;A<S;A++)if(T=y[A],m.call(b,T,A,y))return T}}),document.addEventListener("DOMContentLoaded",function(){document.execCommand("enableObjectResizing",!1,!1),document.execCommand("autoUrlDetect",!1,!1)})},function(r,n){var s=-1,o=1,h=0;function i(z,$,W){if(z==$)return z?[[h,z]]:[];(W<0||z.length<W)&&(W=null);var K=b(z,$),ee=z.substring(0,K);z=z.substring(K),$=$.substring(K),K=T(z,$);var ne=z.substring(z.length-K);z=z.substring(0,z.length-K),$=$.substring(0,$.length-K);var ie=m(z,$);return ee&&ie.unshift([h,ee]),ne&&ie.push([h,ne]),O(ie),W!=null&&(ie=R(ie,W)),ie=M(ie),ie}function m(z,$){var W;if(!z)return[[o,$]];if(!$)return[[s,z]];var K=z.length>$.length?z:$,ee=z.length>$.length?$:z,ne=K.indexOf(ee);if(ne!=-1)return W=[[o,K.substring(0,ne)],[h,ee],[o,K.substring(ne+ee.length)]],z.length>$.length&&(W[0][0]=W[2][0]=s),W;if(ee.length==1)return[[s,z],[o,$]];var ie=A(z,$);if(ie){var re=ie[0],te=ie[1],ae=ie[2],ue=ie[3],be=ie[4],we=i(re,ae),Ce=i(te,ue);return we.concat([[h,be]],Ce)}return y(z,$)}function y(z,$){for(var W=z.length,K=$.length,ee=Math.ceil((W+K)/2),ne=ee,ie=2*ee,re=new Array(ie),te=new Array(ie),ae=0;ae<ie;ae++)re[ae]=-1,te[ae]=-1;re[ne+1]=0,te[ne+1]=0;for(var ue=W-K,be=ue%2!=0,we=0,Ce=0,_e=0,me=0,Ae=0;Ae<ee;Ae++){for(var ge=-Ae+we;ge<=Ae-Ce;ge+=2){var pe=ne+ge,Oe;ge==-Ae||ge!=Ae&&re[pe-1]<re[pe+1]?Oe=re[pe+1]:Oe=re[pe-1]+1;for(var Je=Oe-ge;Oe<W&&Je<K&&z.charAt(Oe)==$.charAt(Je);)Oe++,Je++;if(re[pe]=Oe,Oe>W)Ce+=2;else if(Je>K)we+=2;else if(be){var Ze=ne+ue-ge;if(Ze>=0&&Ze<ie&&te[Ze]!=-1){var Pe=W-te[Ze];if(Oe>=Pe)return S(z,$,Oe,Je)}}}for(var Be=-Ae+_e;Be<=Ae-me;Be+=2){var Ze=ne+Be,Pe;Be==-Ae||Be!=Ae&&te[Ze-1]<te[Ze+1]?Pe=te[Ze+1]:Pe=te[Ze-1]+1;for(var nt=Pe-Be;Pe<W&&nt<K&&z.charAt(W-Pe-1)==$.charAt(K-nt-1);)Pe++,nt++;if(te[Ze]=Pe,Pe>W)me+=2;else if(nt>K)_e+=2;else if(!be){var pe=ne+ue-Be;if(pe>=0&&pe<ie&&re[pe]!=-1){var Oe=re[pe],Je=ne+Oe-pe;if(Pe=W-Pe,Oe>=Pe)return S(z,$,Oe,Je)}}}}return[[s,z],[o,$]]}function S(z,$,W,K){var ee=z.substring(0,W),ne=$.substring(0,K),ie=z.substring(W),re=$.substring(K),te=i(ee,ne),ae=i(ie,re);return te.concat(ae)}function b(z,$){if(!z||!$||z.charAt(0)!=$.charAt(0))return 0;for(var W=0,K=Math.min(z.length,$.length),ee=K,ne=0;W<ee;)z.substring(ne,ee)==$.substring(ne,ee)?(W=ee,ne=W):K=ee,ee=Math.floor((K-W)/2+W);return ee}function T(z,$){if(!z||!$||z.charAt(z.length-1)!=$.charAt($.length-1))return 0;for(var W=0,K=Math.min(z.length,$.length),ee=K,ne=0;W<ee;)z.substring(z.length-ee,z.length-ne)==$.substring($.length-ee,$.length-ne)?(W=ee,ne=W):K=ee,ee=Math.floor((K-W)/2+W);return ee}function A(z,$){var W=z.length>$.length?z:$,K=z.length>$.length?$:z;if(W.length<4||K.length*2<W.length)return null;function ee(Ce,_e,me){for(var Ae=Ce.substring(me,me+Math.floor(Ce.length/4)),ge=-1,pe="",Oe,Je,Ze,Pe;(ge=_e.indexOf(Ae,ge+1))!=-1;){var Be=b(Ce.substring(me),_e.substring(ge)),nt=T(Ce.substring(0,me),_e.substring(0,ge));pe.length<nt+Be&&(pe=_e.substring(ge-nt,ge)+_e.substring(ge,ge+Be),Oe=Ce.substring(0,me-nt),Je=Ce.substring(me+Be),Ze=_e.substring(0,ge-nt),Pe=_e.substring(ge+Be))}return pe.length*2>=Ce.length?[Oe,Je,Ze,Pe,pe]:null}var ne=ee(W,K,Math.ceil(W.length/4)),ie=ee(W,K,Math.ceil(W.length/2)),re;if(!ne&&!ie)return null;ie?ne?re=ne[4].length>ie[4].length?ne:ie:re=ie:re=ne;var te,ae,ue,be;z.length>$.length?(te=re[0],ae=re[1],ue=re[2],be=re[3]):(ue=re[0],be=re[1],te=re[2],ae=re[3]);var we=re[4];return[te,ae,ue,be,we]}function O(z){z.push([h,""]);for(var $=0,W=0,K=0,ee="",ne="",ie;$<z.length;)switch(z[$][0]){case o:K++,ne+=z[$][1],$++;break;case s:W++,ee+=z[$][1],$++;break;case h:W+K>1?(W!==0&&K!==0&&(ie=b(ne,ee),ie!==0&&($-W-K>0&&z[$-W-K-1][0]==h?z[$-W-K-1][1]+=ne.substring(0,ie):(z.splice(0,0,[h,ne.substring(0,ie)]),$++),ne=ne.substring(ie),ee=ee.substring(ie)),ie=T(ne,ee),ie!==0&&(z[$][1]=ne.substring(ne.length-ie)+z[$][1],ne=ne.substring(0,ne.length-ie),ee=ee.substring(0,ee.length-ie))),W===0?z.splice($-K,W+K,[o,ne]):K===0?z.splice($-W,W+K,[s,ee]):z.splice($-W-K,W+K,[s,ee],[o,ne]),$=$-W-K+(W?1:0)+(K?1:0)+1):$!==0&&z[$-1][0]==h?(z[$-1][1]+=z[$][1],z.splice($,1)):$++,K=0,W=0,ee="",ne="";break}z[z.length-1][1]===""&&z.pop();var re=!1;for($=1;$<z.length-1;)z[$-1][0]==h&&z[$+1][0]==h&&(z[$][1].substring(z[$][1].length-z[$-1][1].length)==z[$-1][1]?(z[$][1]=z[$-1][1]+z[$][1].substring(0,z[$][1].length-z[$-1][1].length),z[$+1][1]=z[$-1][1]+z[$+1][1],z.splice($-1,1),re=!0):z[$][1].substring(0,z[$+1][1].length)==z[$+1][1]&&(z[$-1][1]+=z[$+1][1],z[$][1]=z[$][1].substring(z[$+1][1].length)+z[$+1][1],z.splice($+1,1),re=!0)),$++;re&&O(z)}var P=i;P.INSERT=o,P.DELETE=s,P.EQUAL=h,r.exports=P;function I(z,$){if($===0)return[h,z];for(var W=0,K=0;K<z.length;K++){var ee=z[K];if(ee[0]===s||ee[0]===h){var ne=W+ee[1].length;if($===ne)return[K+1,z];if($<ne){z=z.slice();var ie=$-W,re=[ee[0],ee[1].slice(0,ie)],te=[ee[0],ee[1].slice(ie)];return z.splice(K,1,re,te),[K+1,z]}else W=ne}}throw new Error("cursor_pos is out of bounds!")}function R(z,$){var W=I(z,$),K=W[1],ee=W[0],ne=K[ee],ie=K[ee+1];if(ne==null)return z;if(ne[0]!==h)return z;if(ie!=null&&ne[1]+ie[1]===ie[1]+ne[1])return K.splice(ee,2,ie,ne),F(K,ee,2);if(ie!=null&&ie[1].indexOf(ne[1])===0){K.splice(ee,2,[ie[0],ne[1]],[0,ne[1]]);var re=ie[1].slice(ne[1].length);return re.length>0&&K.splice(ee+2,0,[ie[0],re]),F(K,ee,3)}else return z}function M(z){for(var $=!1,W=function(ie){return ie.charCodeAt(0)>=56320&&ie.charCodeAt(0)<=57343},K=function(ie){return ie.charCodeAt(ie.length-1)>=55296&&ie.charCodeAt(ie.length-1)<=56319},ee=2;ee<z.length;ee+=1)z[ee-2][0]===h&&K(z[ee-2][1])&&z[ee-1][0]===s&&W(z[ee-1][1])&&z[ee][0]===o&&W(z[ee][1])&&($=!0,z[ee-1][1]=z[ee-2][1].slice(-1)+z[ee-1][1],z[ee][1]=z[ee-2][1].slice(-1)+z[ee][1],z[ee-2][1]=z[ee-2][1].slice(0,-1));if(!$)return z;for(var ne=[],ee=0;ee<z.length;ee+=1)z[ee][1].length>0&&ne.push(z[ee]);return ne}function F(z,$,W){for(var K=$+W-1;K>=0&&K>=$-1;K--)if(K+1<z.length){var ee=z[K],ne=z[K+1];ee[0]===ne[1]&&z.splice(K,2,[ee[0],ee[1]+ne[1]])}return z}},function(r,n){n=r.exports=typeof Object.keys=="function"?Object.keys:s,n.shim=s;function s(o){var h=[];for(var i in o)h.push(i);return h}},function(r,n){var s=function(){return Object.prototype.toString.call(arguments)}()=="[object Arguments]";n=r.exports=s?o:h,n.supported=o;function o(i){return Object.prototype.toString.call(i)=="[object Arguments]"}n.unsupported=h;function h(i){return i&&typeof i=="object"&&typeof i.length=="number"&&Object.prototype.hasOwnProperty.call(i,"callee")&&!Object.prototype.propertyIsEnumerable.call(i,"callee")||!1}},function(r,n){var s=Object.prototype.hasOwnProperty,o="~";function h(){}Object.create&&(h.prototype=Object.create(null),new h().__proto__||(o=!1));function i(y,S,b){this.fn=y,this.context=S,this.once=b||!1}function m(){this._events=new h,this._eventsCount=0}m.prototype.eventNames=function(){var S=[],b,T;if(this._eventsCount===0)return S;for(T in b=this._events)s.call(b,T)&&S.push(o?T.slice(1):T);return Object.getOwnPropertySymbols?S.concat(Object.getOwnPropertySymbols(b)):S},m.prototype.listeners=function(S,b){var T=o?o+S:S,A=this._events[T];if(b)return!!A;if(!A)return[];if(A.fn)return[A.fn];for(var O=0,P=A.length,I=new Array(P);O<P;O++)I[O]=A[O].fn;return I},m.prototype.emit=function(S,b,T,A,O,P){var I=o?o+S:S;if(!this._events[I])return!1;var R=this._events[I],M=arguments.length,F,z;if(R.fn){switch(R.once&&this.removeListener(S,R.fn,void 0,!0),M){case 1:return R.fn.call(R.context),!0;case 2:return R.fn.call(R.context,b),!0;case 3:return R.fn.call(R.context,b,T),!0;case 4:return R.fn.call(R.context,b,T,A),!0;case 5:return R.fn.call(R.context,b,T,A,O),!0;case 6:return R.fn.call(R.context,b,T,A,O,P),!0}for(z=1,F=new Array(M-1);z<M;z++)F[z-1]=arguments[z];R.fn.apply(R.context,F)}else{var $=R.length,W;for(z=0;z<$;z++)switch(R[z].once&&this.removeListener(S,R[z].fn,void 0,!0),M){case 1:R[z].fn.call(R[z].context);break;case 2:R[z].fn.call(R[z].context,b);break;case 3:R[z].fn.call(R[z].context,b,T);break;case 4:R[z].fn.call(R[z].context,b,T,A);break;default:if(!F)for(W=1,F=new Array(M-1);W<M;W++)F[W-1]=arguments[W];R[z].fn.apply(R[z].context,F)}}return!0},m.prototype.on=function(S,b,T){var A=new i(b,T||this),O=o?o+S:S;return this._events[O]?this._events[O].fn?this._events[O]=[this._events[O],A]:this._events[O].push(A):(this._events[O]=A,this._eventsCount++),this},m.prototype.once=function(S,b,T){var A=new i(b,T||this,!0),O=o?o+S:S;return this._events[O]?this._events[O].fn?this._events[O]=[this._events[O],A]:this._events[O].push(A):(this._events[O]=A,this._eventsCount++),this},m.prototype.removeListener=function(S,b,T,A){var O=o?o+S:S;if(!this._events[O])return this;if(!b)return--this._eventsCount===0?this._events=new h:delete this._events[O],this;var P=this._events[O];if(P.fn)P.fn===b&&(!A||P.once)&&(!T||P.context===T)&&(--this._eventsCount===0?this._events=new h:delete this._events[O]);else{for(var I=0,R=[],M=P.length;I<M;I++)(P[I].fn!==b||A&&!P[I].once||T&&P[I].context!==T)&&R.push(P[I]);R.length?this._events[O]=R.length===1?R[0]:R:--this._eventsCount===0?this._events=new h:delete this._events[O]}return this},m.prototype.removeAllListeners=function(S){var b;return S?(b=o?o+S:S,this._events[b]&&(--this._eventsCount===0?this._events=new h:delete this._events[b])):(this._events=new h,this._eventsCount=0),this},m.prototype.off=m.prototype.removeListener,m.prototype.addListener=m.prototype.on,m.prototype.setMaxListeners=function(){return this},m.prefixed=o,m.EventEmitter=m,typeof r<"u"&&(r.exports=m)},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.matchText=n.matchSpacing=n.matchNewline=n.matchBlot=n.matchAttributor=n.default=void 0;var o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Pt){return typeof Pt}:function(Pt){return Pt&&typeof Symbol=="function"&&Pt.constructor===Symbol&&Pt!==Symbol.prototype?"symbol":typeof Pt},h=function(){function Pt(wt,He){var lt=[],ut=!0,sr=!1,Qt=void 0;try{for(var er=wt[Symbol.iterator](),Cr;!(ut=(Cr=er.next()).done)&&(lt.push(Cr.value),!(He&&lt.length===He));ut=!0);}catch(dn){sr=!0,Qt=dn}finally{try{!ut&&er.return&&er.return()}finally{if(sr)throw Qt}}return lt}return function(wt,He){if(Array.isArray(wt))return wt;if(Symbol.iterator in Object(wt))return Pt(wt,He);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function Pt(wt,He){for(var lt=0;lt<He.length;lt++){var ut=He[lt];ut.enumerable=ut.enumerable||!1,ut.configurable=!0,"value"in ut&&(ut.writable=!0),Object.defineProperty(wt,ut.key,ut)}}return function(wt,He,lt){return He&&Pt(wt.prototype,He),lt&&Pt(wt,lt),wt}}(),m=s(3),y=te(m),S=s(2),b=te(S),T=s(0),A=te(T),O=s(5),P=te(O),I=s(10),R=te(I),M=s(9),F=te(M),z=s(36),$=s(37),W=s(13),K=te(W),ee=s(26),ne=s(38),ie=s(39),re=s(40);function te(Pt){return Pt&&Pt.__esModule?Pt:{default:Pt}}function ae(Pt,wt,He){return wt in Pt?Object.defineProperty(Pt,wt,{value:He,enumerable:!0,configurable:!0,writable:!0}):Pt[wt]=He,Pt}function ue(Pt,wt){if(!(Pt instanceof wt))throw new TypeError("Cannot call a class as a function")}function be(Pt,wt){if(!Pt)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return wt&&(typeof wt=="object"||typeof wt=="function")?wt:Pt}function we(Pt,wt){if(typeof wt!="function"&&wt!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof wt);Pt.prototype=Object.create(wt&&wt.prototype,{constructor:{value:Pt,enumerable:!1,writable:!0,configurable:!0}}),wt&&(Object.setPrototypeOf?Object.setPrototypeOf(Pt,wt):Pt.__proto__=wt)}var Ce=(0,R.default)("quill:clipboard"),_e="__ql-matcher",me=[[Node.TEXT_NODE,Dr],[Node.TEXT_NODE,Lt],["br",gt],[Node.ELEMENT_NODE,Lt],[Node.ELEMENT_NODE,We],[Node.ELEMENT_NODE,nr],[Node.ELEMENT_NODE,Me],[Node.ELEMENT_NODE,Rr],["li",Ht],["b",nt.bind(nt,"bold")],["i",nt.bind(nt,"italic")],["style",rt]],Ae=[z.AlignAttribute,ne.DirectionAttribute].reduce(function(Pt,wt){return Pt[wt.keyName]=wt,Pt},{}),ge=[z.AlignStyle,$.BackgroundStyle,ee.ColorStyle,ne.DirectionStyle,ie.FontStyle,re.SizeStyle].reduce(function(Pt,wt){return Pt[wt.keyName]=wt,Pt},{}),pe=function(Pt){we(wt,Pt);function wt(He,lt){ue(this,wt);var ut=be(this,(wt.__proto__||Object.getPrototypeOf(wt)).call(this,He,lt));return ut.quill.root.addEventListener("paste",ut.onPaste.bind(ut)),ut.container=ut.quill.addContainer("ql-clipboard"),ut.container.setAttribute("contenteditable",!0),ut.container.setAttribute("tabindex",-1),ut.matchers=[],me.concat(ut.options.matchers).forEach(function(sr){var Qt=h(sr,2),er=Qt[0],Cr=Qt[1];!lt.matchVisual&&Cr===nr||ut.addMatcher(er,Cr)}),ut}return i(wt,[{key:"addMatcher",value:function(lt,ut){this.matchers.push([lt,ut])}},{key:"convert",value:function(lt){if(typeof lt=="string")return this.container.innerHTML=lt.replace(/\>\r?\n +\</g,"><"),this.convert();var ut=this.quill.getFormat(this.quill.selection.savedRange.index);if(ut[K.default.blotName]){var sr=this.container.innerText;return this.container.innerHTML="",new b.default().insert(sr,ae({},K.default.blotName,ut[K.default.blotName]))}var Qt=this.prepareMatching(),er=h(Qt,2),Cr=er[0],dn=er[1],fn=Be(this.container,Cr,dn);return Ze(fn,`
`)&&fn.ops[fn.ops.length-1].attributes==null&&(fn=fn.compose(new b.default().retain(fn.length()-1).delete(1))),Ce.log("convert",this.container.innerHTML,fn),this.container.innerHTML="",fn}},{key:"dangerouslyPasteHTML",value:function(lt,ut){var sr=arguments.length>2&&arguments[2]!==void 0?arguments[2]:P.default.sources.API;if(typeof lt=="string")this.quill.setContents(this.convert(lt),ut),this.quill.setSelection(0,P.default.sources.SILENT);else{var Qt=this.convert(ut);this.quill.updateContents(new b.default().retain(lt).concat(Qt),sr),this.quill.setSelection(lt+Qt.length(),P.default.sources.SILENT)}}},{key:"onPaste",value:function(lt){var ut=this;if(!(lt.defaultPrevented||!this.quill.isEnabled())){var sr=this.quill.getSelection(),Qt=new b.default().retain(sr.index),er=this.quill.scrollingContainer.scrollTop;this.container.focus(),this.quill.selection.update(P.default.sources.SILENT),setTimeout(function(){Qt=Qt.concat(ut.convert()).delete(sr.length),ut.quill.updateContents(Qt,P.default.sources.USER),ut.quill.setSelection(Qt.length()-sr.length,P.default.sources.SILENT),ut.quill.scrollingContainer.scrollTop=er,ut.quill.focus()},1)}}},{key:"prepareMatching",value:function(){var lt=this,ut=[],sr=[];return this.matchers.forEach(function(Qt){var er=h(Qt,2),Cr=er[0],dn=er[1];switch(Cr){case Node.TEXT_NODE:sr.push(dn);break;case Node.ELEMENT_NODE:ut.push(dn);break;default:[].forEach.call(lt.container.querySelectorAll(Cr),function(fn){fn[_e]=fn[_e]||[],fn[_e].push(dn)});break}}),[ut,sr]}}]),wt}(F.default);pe.DEFAULTS={matchers:[],matchVisual:!0};function Oe(Pt,wt,He){return(typeof wt>"u"?"undefined":o(wt))==="object"?Object.keys(wt).reduce(function(lt,ut){return Oe(lt,ut,wt[ut])},Pt):Pt.reduce(function(lt,ut){return ut.attributes&&ut.attributes[wt]?lt.push(ut):lt.insert(ut.insert,(0,y.default)({},ae({},wt,He),ut.attributes))},new b.default)}function Je(Pt){if(Pt.nodeType!==Node.ELEMENT_NODE)return{};var wt="__ql-computed-style";return Pt[wt]||(Pt[wt]=window.getComputedStyle(Pt))}function Ze(Pt,wt){for(var He="",lt=Pt.ops.length-1;lt>=0&&He.length<wt.length;--lt){var ut=Pt.ops[lt];if(typeof ut.insert!="string")break;He=ut.insert+He}return He.slice(-1*wt.length)===wt}function Pe(Pt){if(Pt.childNodes.length===0)return!1;var wt=Je(Pt);return["block","list-item"].indexOf(wt.display)>-1}function Be(Pt,wt,He){return Pt.nodeType===Pt.TEXT_NODE?He.reduce(function(lt,ut){return ut(Pt,lt)},new b.default):Pt.nodeType===Pt.ELEMENT_NODE?[].reduce.call(Pt.childNodes||[],function(lt,ut){var sr=Be(ut,wt,He);return ut.nodeType===Pt.ELEMENT_NODE&&(sr=wt.reduce(function(Qt,er){return er(ut,Qt)},sr),sr=(ut[_e]||[]).reduce(function(Qt,er){return er(ut,Qt)},sr)),lt.concat(sr)},new b.default):new b.default}function nt(Pt,wt,He){return Oe(He,Pt,!0)}function Me(Pt,wt){var He=A.default.Attributor.Attribute.keys(Pt),lt=A.default.Attributor.Class.keys(Pt),ut=A.default.Attributor.Style.keys(Pt),sr={};return He.concat(lt).concat(ut).forEach(function(Qt){var er=A.default.query(Qt,A.default.Scope.ATTRIBUTE);er!=null&&(sr[er.attrName]=er.value(Pt),sr[er.attrName])||(er=Ae[Qt],er!=null&&(er.attrName===Qt||er.keyName===Qt)&&(sr[er.attrName]=er.value(Pt)||void 0),er=ge[Qt],er!=null&&(er.attrName===Qt||er.keyName===Qt)&&(er=ge[Qt],sr[er.attrName]=er.value(Pt)||void 0))}),Object.keys(sr).length>0&&(wt=Oe(wt,sr)),wt}function We(Pt,wt){var He=A.default.query(Pt);if(He==null)return wt;if(He.prototype instanceof A.default.Embed){var lt={},ut=He.value(Pt);ut!=null&&(lt[He.blotName]=ut,wt=new b.default().insert(lt,He.formats(Pt)))}else typeof He.formats=="function"&&(wt=Oe(wt,He.blotName,He.formats(Pt)));return wt}function gt(Pt,wt){return Ze(wt,`
`)||wt.insert(`
`),wt}function rt(){return new b.default}function Ht(Pt,wt){var He=A.default.query(Pt);if(He==null||He.blotName!=="list-item"||!Ze(wt,`
`))return wt;for(var lt=-1,ut=Pt.parentNode;!ut.classList.contains("ql-clipboard");)(A.default.query(ut)||{}).blotName==="list"&&(lt+=1),ut=ut.parentNode;return lt<=0?wt:wt.compose(new b.default().retain(wt.length()-1).retain(1,{indent:lt}))}function Lt(Pt,wt){return Ze(wt,`
`)||(Pe(Pt)||wt.length()>0&&Pt.nextSibling&&Pe(Pt.nextSibling))&&wt.insert(`
`),wt}function nr(Pt,wt){if(Pe(Pt)&&Pt.nextElementSibling!=null&&!Ze(wt,`

`)){var He=Pt.offsetHeight+parseFloat(Je(Pt).marginTop)+parseFloat(Je(Pt).marginBottom);Pt.nextElementSibling.offsetTop>Pt.offsetTop+He*1.5&&wt.insert(`
`)}return wt}function Rr(Pt,wt){var He={},lt=Pt.style||{};return lt.fontStyle&&Je(Pt).fontStyle==="italic"&&(He.italic=!0),lt.fontWeight&&(Je(Pt).fontWeight.startsWith("bold")||parseInt(Je(Pt).fontWeight)>=700)&&(He.bold=!0),Object.keys(He).length>0&&(wt=Oe(wt,He)),parseFloat(lt.textIndent||0)>0&&(wt=new b.default().insert("	").concat(wt)),wt}function Dr(Pt,wt){var He=Pt.data;if(Pt.parentNode.tagName==="O:P")return wt.insert(He.trim());if(He.trim().length===0&&Pt.parentNode.classList.contains("ql-clipboard"))return wt;if(!Je(Pt.parentNode).whiteSpace.startsWith("pre")){var lt=function(sr,Qt){return Qt=Qt.replace(/[^\u00a0]/g,""),Qt.length<1&&sr?" ":Qt};He=He.replace(/\r\n/g," ").replace(/\n/g," "),He=He.replace(/\s\s+/g,lt.bind(lt,!0)),(Pt.previousSibling==null&&Pe(Pt.parentNode)||Pt.previousSibling!=null&&Pe(Pt.previousSibling))&&(He=He.replace(/^\s+/,lt.bind(lt,!1))),(Pt.nextSibling==null&&Pe(Pt.parentNode)||Pt.nextSibling!=null&&Pe(Pt.nextSibling))&&(He=He.replace(/\s+$/,lt.bind(lt,!1)))}return wt.insert(He)}n.default=pe,n.matchAttributor=Me,n.matchBlot=We,n.matchNewline=Lt,n.matchSpacing=nr,n.matchText=Dr},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function O(P,I){for(var R=0;R<I.length;R++){var M=I[R];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(P,M.key,M)}}return function(P,I,R){return I&&O(P.prototype,I),R&&O(P,R),P}}(),h=function O(P,I,R){P===null&&(P=Function.prototype);var M=Object.getOwnPropertyDescriptor(P,I);if(M===void 0){var F=Object.getPrototypeOf(P);return F===null?void 0:O(F,I,R)}else{if("value"in M)return M.value;var z=M.get;return z===void 0?void 0:z.call(R)}},i=s(6),m=y(i);function y(O){return O&&O.__esModule?O:{default:O}}function S(O,P){if(!(O instanceof P))throw new TypeError("Cannot call a class as a function")}function b(O,P){if(!O)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return P&&(typeof P=="object"||typeof P=="function")?P:O}function T(O,P){if(typeof P!="function"&&P!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof P);O.prototype=Object.create(P&&P.prototype,{constructor:{value:O,enumerable:!1,writable:!0,configurable:!0}}),P&&(Object.setPrototypeOf?Object.setPrototypeOf(O,P):O.__proto__=P)}var A=function(O){T(P,O);function P(){return S(this,P),b(this,(P.__proto__||Object.getPrototypeOf(P)).apply(this,arguments))}return o(P,[{key:"optimize",value:function(R){h(P.prototype.__proto__||Object.getPrototypeOf(P.prototype),"optimize",this).call(this,R),this.domNode.tagName!==this.statics.tagName[0]&&this.replaceWith(this.statics.blotName)}}],[{key:"create",value:function(){return h(P.__proto__||Object.getPrototypeOf(P),"create",this).call(this)}},{key:"formats",value:function(){return!0}}]),P}(m.default);A.blotName="bold",A.tagName=["STRONG","B"],n.default=A},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.addControls=n.default=void 0;var o=function(){function re(te,ae){var ue=[],be=!0,we=!1,Ce=void 0;try{for(var _e=te[Symbol.iterator](),me;!(be=(me=_e.next()).done)&&(ue.push(me.value),!(ae&&ue.length===ae));be=!0);}catch(Ae){we=!0,Ce=Ae}finally{try{!be&&_e.return&&_e.return()}finally{if(we)throw Ce}}return ue}return function(te,ae){if(Array.isArray(te))return te;if(Symbol.iterator in Object(te))return re(te,ae);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function(){function re(te,ae){for(var ue=0;ue<ae.length;ue++){var be=ae[ue];be.enumerable=be.enumerable||!1,be.configurable=!0,"value"in be&&(be.writable=!0),Object.defineProperty(te,be.key,be)}}return function(te,ae,ue){return ae&&re(te.prototype,ae),ue&&re(te,ue),te}}(),i=s(2),m=R(i),y=s(0),S=R(y),b=s(5),T=R(b),A=s(10),O=R(A),P=s(9),I=R(P);function R(re){return re&&re.__esModule?re:{default:re}}function M(re,te,ae){return te in re?Object.defineProperty(re,te,{value:ae,enumerable:!0,configurable:!0,writable:!0}):re[te]=ae,re}function F(re,te){if(!(re instanceof te))throw new TypeError("Cannot call a class as a function")}function z(re,te){if(!re)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return te&&(typeof te=="object"||typeof te=="function")?te:re}function $(re,te){if(typeof te!="function"&&te!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof te);re.prototype=Object.create(te&&te.prototype,{constructor:{value:re,enumerable:!1,writable:!0,configurable:!0}}),te&&(Object.setPrototypeOf?Object.setPrototypeOf(re,te):re.__proto__=te)}var W=(0,O.default)("quill:toolbar"),K=function(re){$(te,re);function te(ae,ue){F(this,te);var be=z(this,(te.__proto__||Object.getPrototypeOf(te)).call(this,ae,ue));if(Array.isArray(be.options.container)){var we=document.createElement("div");ne(we,be.options.container),ae.container.parentNode.insertBefore(we,ae.container),be.container=we}else typeof be.options.container=="string"?be.container=document.querySelector(be.options.container):be.container=be.options.container;if(!(be.container instanceof HTMLElement)){var Ce;return Ce=W.error("Container required for toolbar",be.options),z(be,Ce)}return be.container.classList.add("ql-toolbar"),be.controls=[],be.handlers={},Object.keys(be.options.handlers).forEach(function(_e){be.addHandler(_e,be.options.handlers[_e])}),[].forEach.call(be.container.querySelectorAll("button, select"),function(_e){be.attach(_e)}),be.quill.on(T.default.events.EDITOR_CHANGE,function(_e,me){_e===T.default.events.SELECTION_CHANGE&&be.update(me)}),be.quill.on(T.default.events.SCROLL_OPTIMIZE,function(){var _e=be.quill.selection.getRange(),me=o(_e,1),Ae=me[0];be.update(Ae)}),be}return h(te,[{key:"addHandler",value:function(ue,be){this.handlers[ue]=be}},{key:"attach",value:function(ue){var be=this,we=[].find.call(ue.classList,function(_e){return _e.indexOf("ql-")===0});if(we){if(we=we.slice(3),ue.tagName==="BUTTON"&&ue.setAttribute("type","button"),this.handlers[we]==null){if(this.quill.scroll.whitelist!=null&&this.quill.scroll.whitelist[we]==null){W.warn("ignoring attaching to disabled format",we,ue);return}if(S.default.query(we)==null){W.warn("ignoring attaching to nonexistent format",we,ue);return}}var Ce=ue.tagName==="SELECT"?"change":"click";ue.addEventListener(Ce,function(_e){var me=void 0;if(ue.tagName==="SELECT"){if(ue.selectedIndex<0)return;var Ae=ue.options[ue.selectedIndex];Ae.hasAttribute("selected")?me=!1:me=Ae.value||!1}else ue.classList.contains("ql-active")?me=!1:me=ue.value||!ue.hasAttribute("value"),_e.preventDefault();be.quill.focus();var ge=be.quill.selection.getRange(),pe=o(ge,1),Oe=pe[0];if(be.handlers[we]!=null)be.handlers[we].call(be,me);else if(S.default.query(we).prototype instanceof S.default.Embed){if(me=prompt("Enter "+we),!me)return;be.quill.updateContents(new m.default().retain(Oe.index).delete(Oe.length).insert(M({},we,me)),T.default.sources.USER)}else be.quill.format(we,me,T.default.sources.USER);be.update(Oe)}),this.controls.push([we,ue])}}},{key:"update",value:function(ue){var be=ue==null?{}:this.quill.getFormat(ue);this.controls.forEach(function(we){var Ce=o(we,2),_e=Ce[0],me=Ce[1];if(me.tagName==="SELECT"){var Ae=void 0;if(ue==null)Ae=null;else if(be[_e]==null)Ae=me.querySelector("option[selected]");else if(!Array.isArray(be[_e])){var ge=be[_e];typeof ge=="string"&&(ge=ge.replace(/\"/g,'\\"')),Ae=me.querySelector('option[value="'+ge+'"]')}Ae==null?(me.value="",me.selectedIndex=-1):Ae.selected=!0}else if(ue==null)me.classList.remove("ql-active");else if(me.hasAttribute("value")){var pe=be[_e]===me.getAttribute("value")||be[_e]!=null&&be[_e].toString()===me.getAttribute("value")||be[_e]==null&&!me.getAttribute("value");me.classList.toggle("ql-active",pe)}else me.classList.toggle("ql-active",be[_e]!=null)})}}]),te}(I.default);K.DEFAULTS={};function ee(re,te,ae){var ue=document.createElement("button");ue.setAttribute("type","button"),ue.classList.add("ql-"+te),ae!=null&&(ue.value=ae),re.appendChild(ue)}function ne(re,te){Array.isArray(te[0])||(te=[te]),te.forEach(function(ae){var ue=document.createElement("span");ue.classList.add("ql-formats"),ae.forEach(function(be){if(typeof be=="string")ee(ue,be);else{var we=Object.keys(be)[0],Ce=be[we];Array.isArray(Ce)?ie(ue,we,Ce):ee(ue,we,Ce)}}),re.appendChild(ue)})}function ie(re,te,ae){var ue=document.createElement("select");ue.classList.add("ql-"+te),ae.forEach(function(be){var we=document.createElement("option");be!==!1?we.setAttribute("value",be):we.setAttribute("selected","selected"),ue.appendChild(we)}),re.appendChild(ue)}K.DEFAULTS={container:null,handlers:{clean:function(){var te=this,ae=this.quill.getSelection();if(ae!=null)if(ae.length==0){var ue=this.quill.getFormat();Object.keys(ue).forEach(function(be){S.default.query(be,S.default.Scope.INLINE)!=null&&te.quill.format(be,!1)})}else this.quill.removeFormat(ae,T.default.sources.USER)},direction:function(te){var ae=this.quill.getFormat().align;te==="rtl"&&ae==null?this.quill.format("align","right",T.default.sources.USER):!te&&ae==="right"&&this.quill.format("align",!1,T.default.sources.USER),this.quill.format("direction",te,T.default.sources.USER)},indent:function(te){var ae=this.quill.getSelection(),ue=this.quill.getFormat(ae),be=parseInt(ue.indent||0);if(te==="+1"||te==="-1"){var we=te==="+1"?1:-1;ue.direction==="rtl"&&(we*=-1),this.quill.format("indent",be+we,T.default.sources.USER)}},link:function(te){te===!0&&(te=prompt("Enter link URL:")),this.quill.format("link",te,T.default.sources.USER)},list:function(te){var ae=this.quill.getSelection(),ue=this.quill.getFormat(ae);te==="check"?ue.list==="checked"||ue.list==="unchecked"?this.quill.format("list",!1,T.default.sources.USER):this.quill.format("list","unchecked",T.default.sources.USER):this.quill.format("list",te,T.default.sources.USER)}}},n.default=K,n.addControls=ne},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <polyline class="ql-even ql-stroke" points="5 7 3 9 5 11"></polyline> <polyline class="ql-even ql-stroke" points="13 7 15 9 13 11"></polyline> <line class=ql-stroke x1=10 x2=8 y1=5 y2=13></line> </svg>'},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function O(P,I){for(var R=0;R<I.length;R++){var M=I[R];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(P,M.key,M)}}return function(P,I,R){return I&&O(P.prototype,I),R&&O(P,R),P}}(),h=function O(P,I,R){P===null&&(P=Function.prototype);var M=Object.getOwnPropertyDescriptor(P,I);if(M===void 0){var F=Object.getPrototypeOf(P);return F===null?void 0:O(F,I,R)}else{if("value"in M)return M.value;var z=M.get;return z===void 0?void 0:z.call(R)}},i=s(28),m=y(i);function y(O){return O&&O.__esModule?O:{default:O}}function S(O,P){if(!(O instanceof P))throw new TypeError("Cannot call a class as a function")}function b(O,P){if(!O)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return P&&(typeof P=="object"||typeof P=="function")?P:O}function T(O,P){if(typeof P!="function"&&P!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof P);O.prototype=Object.create(P&&P.prototype,{constructor:{value:O,enumerable:!1,writable:!0,configurable:!0}}),P&&(Object.setPrototypeOf?Object.setPrototypeOf(O,P):O.__proto__=P)}var A=function(O){T(P,O);function P(I,R){S(this,P);var M=b(this,(P.__proto__||Object.getPrototypeOf(P)).call(this,I));return M.label.innerHTML=R,M.container.classList.add("ql-color-picker"),[].slice.call(M.container.querySelectorAll(".ql-picker-item"),0,7).forEach(function(F){F.classList.add("ql-primary")}),M}return o(P,[{key:"buildItem",value:function(R){var M=h(P.prototype.__proto__||Object.getPrototypeOf(P.prototype),"buildItem",this).call(this,R);return M.style.backgroundColor=R.getAttribute("value")||"",M}},{key:"selectItem",value:function(R,M){h(P.prototype.__proto__||Object.getPrototypeOf(P.prototype),"selectItem",this).call(this,R,M);var F=this.label.querySelector(".ql-color-label"),z=R&&R.getAttribute("data-value")||"";F&&(F.tagName==="line"?F.style.stroke=z:F.style.fill=z)}}]),P}(m.default);n.default=A},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function O(P,I){for(var R=0;R<I.length;R++){var M=I[R];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(P,M.key,M)}}return function(P,I,R){return I&&O(P.prototype,I),R&&O(P,R),P}}(),h=function O(P,I,R){P===null&&(P=Function.prototype);var M=Object.getOwnPropertyDescriptor(P,I);if(M===void 0){var F=Object.getPrototypeOf(P);return F===null?void 0:O(F,I,R)}else{if("value"in M)return M.value;var z=M.get;return z===void 0?void 0:z.call(R)}},i=s(28),m=y(i);function y(O){return O&&O.__esModule?O:{default:O}}function S(O,P){if(!(O instanceof P))throw new TypeError("Cannot call a class as a function")}function b(O,P){if(!O)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return P&&(typeof P=="object"||typeof P=="function")?P:O}function T(O,P){if(typeof P!="function"&&P!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof P);O.prototype=Object.create(P&&P.prototype,{constructor:{value:O,enumerable:!1,writable:!0,configurable:!0}}),P&&(Object.setPrototypeOf?Object.setPrototypeOf(O,P):O.__proto__=P)}var A=function(O){T(P,O);function P(I,R){S(this,P);var M=b(this,(P.__proto__||Object.getPrototypeOf(P)).call(this,I));return M.container.classList.add("ql-icon-picker"),[].forEach.call(M.container.querySelectorAll(".ql-picker-item"),function(F){F.innerHTML=R[F.getAttribute("data-value")||""]}),M.defaultItem=M.container.querySelector(".ql-selected"),M.selectItem(M.defaultItem),M}return o(P,[{key:"selectItem",value:function(R,M){h(P.prototype.__proto__||Object.getPrototypeOf(P.prototype),"selectItem",this).call(this,R,M),R=R||this.defaultItem,this.label.innerHTML=R.innerHTML}}]),P}(m.default);n.default=A},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function m(y,S){for(var b=0;b<S.length;b++){var T=S[b];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(y,T.key,T)}}return function(y,S,b){return S&&m(y.prototype,S),b&&m(y,b),y}}();function h(m,y){if(!(m instanceof y))throw new TypeError("Cannot call a class as a function")}var i=function(){function m(y,S){var b=this;h(this,m),this.quill=y,this.boundsContainer=S||document.body,this.root=y.addContainer("ql-tooltip"),this.root.innerHTML=this.constructor.TEMPLATE,this.quill.root===this.quill.scrollingContainer&&this.quill.root.addEventListener("scroll",function(){b.root.style.marginTop=-1*b.quill.root.scrollTop+"px"}),this.hide()}return o(m,[{key:"hide",value:function(){this.root.classList.add("ql-hidden")}},{key:"position",value:function(S){var b=S.left+S.width/2-this.root.offsetWidth/2,T=S.bottom+this.quill.root.scrollTop;this.root.style.left=b+"px",this.root.style.top=T+"px",this.root.classList.remove("ql-flip");var A=this.boundsContainer.getBoundingClientRect(),O=this.root.getBoundingClientRect(),P=0;if(O.right>A.right&&(P=A.right-O.right,this.root.style.left=b+P+"px"),O.left<A.left&&(P=A.left-O.left,this.root.style.left=b+P+"px"),O.bottom>A.bottom){var I=O.bottom-O.top,R=S.bottom-S.top+I;this.root.style.top=T-R+"px",this.root.classList.add("ql-flip")}return P}},{key:"show",value:function(){this.root.classList.remove("ql-editing"),this.root.classList.remove("ql-hidden")}}]),m}();n.default=i},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function ie(re,te){var ae=[],ue=!0,be=!1,we=void 0;try{for(var Ce=re[Symbol.iterator](),_e;!(ue=(_e=Ce.next()).done)&&(ae.push(_e.value),!(te&&ae.length===te));ue=!0);}catch(me){be=!0,we=me}finally{try{!ue&&Ce.return&&Ce.return()}finally{if(be)throw we}}return ae}return function(re,te){if(Array.isArray(re))return re;if(Symbol.iterator in Object(re))return ie(re,te);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function ie(re,te,ae){re===null&&(re=Function.prototype);var ue=Object.getOwnPropertyDescriptor(re,te);if(ue===void 0){var be=Object.getPrototypeOf(re);return be===null?void 0:ie(be,te,ae)}else{if("value"in ue)return ue.value;var we=ue.get;return we===void 0?void 0:we.call(ae)}},i=function(){function ie(re,te){for(var ae=0;ae<te.length;ae++){var ue=te[ae];ue.enumerable=ue.enumerable||!1,ue.configurable=!0,"value"in ue&&(ue.writable=!0),Object.defineProperty(re,ue.key,ue)}}return function(re,te,ae){return te&&ie(re.prototype,te),ae&&ie(re,ae),re}}(),m=s(3),y=F(m),S=s(8),b=F(S),T=s(43),A=F(T),O=s(27),P=F(O),I=s(15),R=s(41),M=F(R);function F(ie){return ie&&ie.__esModule?ie:{default:ie}}function z(ie,re){if(!(ie instanceof re))throw new TypeError("Cannot call a class as a function")}function $(ie,re){if(!ie)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return re&&(typeof re=="object"||typeof re=="function")?re:ie}function W(ie,re){if(typeof re!="function"&&re!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof re);ie.prototype=Object.create(re&&re.prototype,{constructor:{value:ie,enumerable:!1,writable:!0,configurable:!0}}),re&&(Object.setPrototypeOf?Object.setPrototypeOf(ie,re):ie.__proto__=re)}var K=[[{header:["1","2","3",!1]}],["bold","italic","underline","link"],[{list:"ordered"},{list:"bullet"}],["clean"]],ee=function(ie){W(re,ie);function re(te,ae){z(this,re),ae.modules.toolbar!=null&&ae.modules.toolbar.container==null&&(ae.modules.toolbar.container=K);var ue=$(this,(re.__proto__||Object.getPrototypeOf(re)).call(this,te,ae));return ue.quill.container.classList.add("ql-snow"),ue}return i(re,[{key:"extendToolbar",value:function(ae){ae.container.classList.add("ql-snow"),this.buildButtons([].slice.call(ae.container.querySelectorAll("button")),M.default),this.buildPickers([].slice.call(ae.container.querySelectorAll("select")),M.default),this.tooltip=new ne(this.quill,this.options.bounds),ae.container.querySelector(".ql-link")&&this.quill.keyboard.addBinding({key:"K",shortKey:!0},function(ue,be){ae.handlers.link.call(ae,!be.format.link)})}}]),re}(A.default);ee.DEFAULTS=(0,y.default)(!0,{},A.default.DEFAULTS,{modules:{toolbar:{handlers:{link:function(re){if(re){var te=this.quill.getSelection();if(te==null||te.length==0)return;var ae=this.quill.getText(te);/^\S+@\S+\.\S+$/.test(ae)&&ae.indexOf("mailto:")!==0&&(ae="mailto:"+ae);var ue=this.quill.theme.tooltip;ue.edit("link",ae)}else this.quill.format("link",!1)}}}}});var ne=function(ie){W(re,ie);function re(te,ae){z(this,re);var ue=$(this,(re.__proto__||Object.getPrototypeOf(re)).call(this,te,ae));return ue.preview=ue.root.querySelector("a.ql-preview"),ue}return i(re,[{key:"listen",value:function(){var ae=this;h(re.prototype.__proto__||Object.getPrototypeOf(re.prototype),"listen",this).call(this),this.root.querySelector("a.ql-action").addEventListener("click",function(ue){ae.root.classList.contains("ql-editing")?ae.save():ae.edit("link",ae.preview.textContent),ue.preventDefault()}),this.root.querySelector("a.ql-remove").addEventListener("click",function(ue){if(ae.linkRange!=null){var be=ae.linkRange;ae.restoreFocus(),ae.quill.formatText(be,"link",!1,b.default.sources.USER),delete ae.linkRange}ue.preventDefault(),ae.hide()}),this.quill.on(b.default.events.SELECTION_CHANGE,function(ue,be,we){if(ue!=null){if(ue.length===0&&we===b.default.sources.USER){var Ce=ae.quill.scroll.descendant(P.default,ue.index),_e=o(Ce,2),me=_e[0],Ae=_e[1];if(me!=null){ae.linkRange=new I.Range(ue.index-Ae,me.length());var ge=P.default.formats(me.domNode);ae.preview.textContent=ge,ae.preview.setAttribute("href",ge),ae.show(),ae.position(ae.quill.getBounds(ae.linkRange));return}}else delete ae.linkRange;ae.hide()}})}},{key:"show",value:function(){h(re.prototype.__proto__||Object.getPrototypeOf(re.prototype),"show",this).call(this),this.root.removeAttribute("data-mode")}}]),re}(T.BaseTooltip);ne.TEMPLATE=['<a class="ql-preview" rel="noopener noreferrer" target="_blank" href="about:blank"></a>','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-action"></a>','<a class="ql-remove"></a>'].join(""),n.default=ee},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(29),h=ut(o),i=s(36),m=s(38),y=s(64),S=s(65),b=ut(S),T=s(66),A=ut(T),O=s(67),P=ut(O),I=s(37),R=s(26),M=s(39),F=s(40),z=s(56),$=ut(z),W=s(68),K=ut(W),ee=s(27),ne=ut(ee),ie=s(69),re=ut(ie),te=s(70),ae=ut(te),ue=s(71),be=ut(ue),we=s(72),Ce=ut(we),_e=s(73),me=ut(_e),Ae=s(13),ge=ut(Ae),pe=s(74),Oe=ut(pe),Je=s(75),Ze=ut(Je),Pe=s(57),Be=ut(Pe),nt=s(41),Me=ut(nt),We=s(28),gt=ut(We),rt=s(59),Ht=ut(rt),Lt=s(60),nr=ut(Lt),Rr=s(61),Dr=ut(Rr),Pt=s(108),wt=ut(Pt),He=s(62),lt=ut(He);function ut(sr){return sr&&sr.__esModule?sr:{default:sr}}h.default.register({"attributors/attribute/direction":m.DirectionAttribute,"attributors/class/align":i.AlignClass,"attributors/class/background":I.BackgroundClass,"attributors/class/color":R.ColorClass,"attributors/class/direction":m.DirectionClass,"attributors/class/font":M.FontClass,"attributors/class/size":F.SizeClass,"attributors/style/align":i.AlignStyle,"attributors/style/background":I.BackgroundStyle,"attributors/style/color":R.ColorStyle,"attributors/style/direction":m.DirectionStyle,"attributors/style/font":M.FontStyle,"attributors/style/size":F.SizeStyle},!0),h.default.register({"formats/align":i.AlignClass,"formats/direction":m.DirectionClass,"formats/indent":y.IndentClass,"formats/background":I.BackgroundStyle,"formats/color":R.ColorStyle,"formats/font":M.FontClass,"formats/size":F.SizeClass,"formats/blockquote":b.default,"formats/code-block":ge.default,"formats/header":A.default,"formats/list":P.default,"formats/bold":$.default,"formats/code":Ae.Code,"formats/italic":K.default,"formats/link":ne.default,"formats/script":re.default,"formats/strike":ae.default,"formats/underline":be.default,"formats/image":Ce.default,"formats/video":me.default,"formats/list/item":O.ListItem,"modules/formula":Oe.default,"modules/syntax":Ze.default,"modules/toolbar":Be.default,"themes/bubble":wt.default,"themes/snow":lt.default,"ui/icons":Me.default,"ui/picker":gt.default,"ui/icon-picker":nr.default,"ui/color-picker":Ht.default,"ui/tooltip":Dr.default},!0),n.default=h.default},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.IndentClass=void 0;var o=function(){function P(I,R){for(var M=0;M<R.length;M++){var F=R[M];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(I,F.key,F)}}return function(I,R,M){return R&&P(I.prototype,R),M&&P(I,M),I}}(),h=function P(I,R,M){I===null&&(I=Function.prototype);var F=Object.getOwnPropertyDescriptor(I,R);if(F===void 0){var z=Object.getPrototypeOf(I);return z===null?void 0:P(z,R,M)}else{if("value"in F)return F.value;var $=F.get;return $===void 0?void 0:$.call(M)}},i=s(0),m=y(i);function y(P){return P&&P.__esModule?P:{default:P}}function S(P,I){if(!(P instanceof I))throw new TypeError("Cannot call a class as a function")}function b(P,I){if(!P)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I&&(typeof I=="object"||typeof I=="function")?I:P}function T(P,I){if(typeof I!="function"&&I!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof I);P.prototype=Object.create(I&&I.prototype,{constructor:{value:P,enumerable:!1,writable:!0,configurable:!0}}),I&&(Object.setPrototypeOf?Object.setPrototypeOf(P,I):P.__proto__=I)}var A=function(P){T(I,P);function I(){return S(this,I),b(this,(I.__proto__||Object.getPrototypeOf(I)).apply(this,arguments))}return o(I,[{key:"add",value:function(M,F){if(F==="+1"||F==="-1"){var z=this.value(M)||0;F=F==="+1"?z+1:z-1}return F===0?(this.remove(M),!0):h(I.prototype.__proto__||Object.getPrototypeOf(I.prototype),"add",this).call(this,M,F)}},{key:"canAdd",value:function(M,F){return h(I.prototype.__proto__||Object.getPrototypeOf(I.prototype),"canAdd",this).call(this,M,F)||h(I.prototype.__proto__||Object.getPrototypeOf(I.prototype),"canAdd",this).call(this,M,parseInt(F))}},{key:"value",value:function(M){return parseInt(h(I.prototype.__proto__||Object.getPrototypeOf(I.prototype),"value",this).call(this,M))||void 0}}]),I}(m.default.Attributor.Class),O=new A("indent","ql-indent",{scope:m.default.Scope.BLOCK,whitelist:[1,2,3,4,5,6,7,8]});n.IndentClass=O},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(4),h=i(o);function i(T){return T&&T.__esModule?T:{default:T}}function m(T,A){if(!(T instanceof A))throw new TypeError("Cannot call a class as a function")}function y(T,A){if(!T)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A&&(typeof A=="object"||typeof A=="function")?A:T}function S(T,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof A);T.prototype=Object.create(A&&A.prototype,{constructor:{value:T,enumerable:!1,writable:!0,configurable:!0}}),A&&(Object.setPrototypeOf?Object.setPrototypeOf(T,A):T.__proto__=A)}var b=function(T){S(A,T);function A(){return m(this,A),y(this,(A.__proto__||Object.getPrototypeOf(A)).apply(this,arguments))}return A}(h.default);b.blotName="blockquote",b.tagName="blockquote",n.default=b},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function A(O,P){for(var I=0;I<P.length;I++){var R=P[I];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(O,R.key,R)}}return function(O,P,I){return P&&A(O.prototype,P),I&&A(O,I),O}}(),h=s(4),i=m(h);function m(A){return A&&A.__esModule?A:{default:A}}function y(A,O){if(!(A instanceof O))throw new TypeError("Cannot call a class as a function")}function S(A,O){if(!A)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return O&&(typeof O=="object"||typeof O=="function")?O:A}function b(A,O){if(typeof O!="function"&&O!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof O);A.prototype=Object.create(O&&O.prototype,{constructor:{value:A,enumerable:!1,writable:!0,configurable:!0}}),O&&(Object.setPrototypeOf?Object.setPrototypeOf(A,O):A.__proto__=O)}var T=function(A){b(O,A);function O(){return y(this,O),S(this,(O.__proto__||Object.getPrototypeOf(O)).apply(this,arguments))}return o(O,null,[{key:"formats",value:function(I){return this.tagName.indexOf(I.tagName)+1}}]),O}(i.default);T.blotName="header",T.tagName=["H1","H2","H3","H4","H5","H6"],n.default=T},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.ListItem=void 0;var o=function(){function z($,W){for(var K=0;K<W.length;K++){var ee=W[K];ee.enumerable=ee.enumerable||!1,ee.configurable=!0,"value"in ee&&(ee.writable=!0),Object.defineProperty($,ee.key,ee)}}return function($,W,K){return W&&z($.prototype,W),K&&z($,K),$}}(),h=function z($,W,K){$===null&&($=Function.prototype);var ee=Object.getOwnPropertyDescriptor($,W);if(ee===void 0){var ne=Object.getPrototypeOf($);return ne===null?void 0:z(ne,W,K)}else{if("value"in ee)return ee.value;var ie=ee.get;return ie===void 0?void 0:ie.call(K)}},i=s(0),m=A(i),y=s(4),S=A(y),b=s(25),T=A(b);function A(z){return z&&z.__esModule?z:{default:z}}function O(z,$,W){return $ in z?Object.defineProperty(z,$,{value:W,enumerable:!0,configurable:!0,writable:!0}):z[$]=W,z}function P(z,$){if(!(z instanceof $))throw new TypeError("Cannot call a class as a function")}function I(z,$){if(!z)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return $&&(typeof $=="object"||typeof $=="function")?$:z}function R(z,$){if(typeof $!="function"&&$!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof $);z.prototype=Object.create($&&$.prototype,{constructor:{value:z,enumerable:!1,writable:!0,configurable:!0}}),$&&(Object.setPrototypeOf?Object.setPrototypeOf(z,$):z.__proto__=$)}var M=function(z){R($,z);function $(){return P(this,$),I(this,($.__proto__||Object.getPrototypeOf($)).apply(this,arguments))}return o($,[{key:"format",value:function(K,ee){K===F.blotName&&!ee?this.replaceWith(m.default.create(this.statics.scope)):h($.prototype.__proto__||Object.getPrototypeOf($.prototype),"format",this).call(this,K,ee)}},{key:"remove",value:function(){this.prev==null&&this.next==null?this.parent.remove():h($.prototype.__proto__||Object.getPrototypeOf($.prototype),"remove",this).call(this)}},{key:"replaceWith",value:function(K,ee){return this.parent.isolate(this.offset(this.parent),this.length()),K===this.parent.statics.blotName?(this.parent.replaceWith(K,ee),this):(this.parent.unwrap(),h($.prototype.__proto__||Object.getPrototypeOf($.prototype),"replaceWith",this).call(this,K,ee))}}],[{key:"formats",value:function(K){return K.tagName===this.tagName?void 0:h($.__proto__||Object.getPrototypeOf($),"formats",this).call(this,K)}}]),$}(S.default);M.blotName="list-item",M.tagName="LI";var F=function(z){R($,z),o($,null,[{key:"create",value:function(K){var ee=K==="ordered"?"OL":"UL",ne=h($.__proto__||Object.getPrototypeOf($),"create",this).call(this,ee);return(K==="checked"||K==="unchecked")&&ne.setAttribute("data-checked",K==="checked"),ne}},{key:"formats",value:function(K){if(K.tagName==="OL")return"ordered";if(K.tagName==="UL")return K.hasAttribute("data-checked")?K.getAttribute("data-checked")==="true"?"checked":"unchecked":"bullet"}}]);function $(W){P(this,$);var K=I(this,($.__proto__||Object.getPrototypeOf($)).call(this,W)),ee=function(ie){if(ie.target.parentNode===W){var re=K.statics.formats(W),te=m.default.find(ie.target);re==="checked"?te.format("list","unchecked"):re==="unchecked"&&te.format("list","checked")}};return W.addEventListener("touchstart",ee),W.addEventListener("mousedown",ee),K}return o($,[{key:"format",value:function(K,ee){this.children.length>0&&this.children.tail.format(K,ee)}},{key:"formats",value:function(){return O({},this.statics.blotName,this.statics.formats(this.domNode))}},{key:"insertBefore",value:function(K,ee){if(K instanceof M)h($.prototype.__proto__||Object.getPrototypeOf($.prototype),"insertBefore",this).call(this,K,ee);else{var ne=ee==null?this.length():ee.offset(this),ie=this.split(ne);ie.parent.insertBefore(K,ie)}}},{key:"optimize",value:function(K){h($.prototype.__proto__||Object.getPrototypeOf($.prototype),"optimize",this).call(this,K);var ee=this.next;ee!=null&&ee.prev===this&&ee.statics.blotName===this.statics.blotName&&ee.domNode.tagName===this.domNode.tagName&&ee.domNode.getAttribute("data-checked")===this.domNode.getAttribute("data-checked")&&(ee.moveChildren(this),ee.remove())}},{key:"replace",value:function(K){if(K.statics.blotName!==this.statics.blotName){var ee=m.default.create(this.statics.defaultChild);K.moveChildren(ee),this.appendChild(ee)}h($.prototype.__proto__||Object.getPrototypeOf($.prototype),"replace",this).call(this,K)}}]),$}(T.default);F.blotName="list",F.scope=m.default.Scope.BLOCK_BLOT,F.tagName=["OL","UL"],F.defaultChild="list-item",F.allowedChildren=[M],n.ListItem=M,n.default=F},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(56),h=i(o);function i(T){return T&&T.__esModule?T:{default:T}}function m(T,A){if(!(T instanceof A))throw new TypeError("Cannot call a class as a function")}function y(T,A){if(!T)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A&&(typeof A=="object"||typeof A=="function")?A:T}function S(T,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof A);T.prototype=Object.create(A&&A.prototype,{constructor:{value:T,enumerable:!1,writable:!0,configurable:!0}}),A&&(Object.setPrototypeOf?Object.setPrototypeOf(T,A):T.__proto__=A)}var b=function(T){S(A,T);function A(){return m(this,A),y(this,(A.__proto__||Object.getPrototypeOf(A)).apply(this,arguments))}return A}(h.default);b.blotName="italic",b.tagName=["EM","I"],n.default=b},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function O(P,I){for(var R=0;R<I.length;R++){var M=I[R];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(P,M.key,M)}}return function(P,I,R){return I&&O(P.prototype,I),R&&O(P,R),P}}(),h=function O(P,I,R){P===null&&(P=Function.prototype);var M=Object.getOwnPropertyDescriptor(P,I);if(M===void 0){var F=Object.getPrototypeOf(P);return F===null?void 0:O(F,I,R)}else{if("value"in M)return M.value;var z=M.get;return z===void 0?void 0:z.call(R)}},i=s(6),m=y(i);function y(O){return O&&O.__esModule?O:{default:O}}function S(O,P){if(!(O instanceof P))throw new TypeError("Cannot call a class as a function")}function b(O,P){if(!O)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return P&&(typeof P=="object"||typeof P=="function")?P:O}function T(O,P){if(typeof P!="function"&&P!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof P);O.prototype=Object.create(P&&P.prototype,{constructor:{value:O,enumerable:!1,writable:!0,configurable:!0}}),P&&(Object.setPrototypeOf?Object.setPrototypeOf(O,P):O.__proto__=P)}var A=function(O){T(P,O);function P(){return S(this,P),b(this,(P.__proto__||Object.getPrototypeOf(P)).apply(this,arguments))}return o(P,null,[{key:"create",value:function(R){return R==="super"?document.createElement("sup"):R==="sub"?document.createElement("sub"):h(P.__proto__||Object.getPrototypeOf(P),"create",this).call(this,R)}},{key:"formats",value:function(R){if(R.tagName==="SUB")return"sub";if(R.tagName==="SUP")return"super"}}]),P}(m.default);A.blotName="script",A.tagName=["SUB","SUP"],n.default=A},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(6),h=i(o);function i(T){return T&&T.__esModule?T:{default:T}}function m(T,A){if(!(T instanceof A))throw new TypeError("Cannot call a class as a function")}function y(T,A){if(!T)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A&&(typeof A=="object"||typeof A=="function")?A:T}function S(T,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof A);T.prototype=Object.create(A&&A.prototype,{constructor:{value:T,enumerable:!1,writable:!0,configurable:!0}}),A&&(Object.setPrototypeOf?Object.setPrototypeOf(T,A):T.__proto__=A)}var b=function(T){S(A,T);function A(){return m(this,A),y(this,(A.__proto__||Object.getPrototypeOf(A)).apply(this,arguments))}return A}(h.default);b.blotName="strike",b.tagName="S",n.default=b},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=s(6),h=i(o);function i(T){return T&&T.__esModule?T:{default:T}}function m(T,A){if(!(T instanceof A))throw new TypeError("Cannot call a class as a function")}function y(T,A){if(!T)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A&&(typeof A=="object"||typeof A=="function")?A:T}function S(T,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof A);T.prototype=Object.create(A&&A.prototype,{constructor:{value:T,enumerable:!1,writable:!0,configurable:!0}}),A&&(Object.setPrototypeOf?Object.setPrototypeOf(T,A):T.__proto__=A)}var b=function(T){S(A,T);function A(){return m(this,A),y(this,(A.__proto__||Object.getPrototypeOf(A)).apply(this,arguments))}return A}(h.default);b.blotName="underline",b.tagName="U",n.default=b},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function I(R,M){for(var F=0;F<M.length;F++){var z=M[F];z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z&&(z.writable=!0),Object.defineProperty(R,z.key,z)}}return function(R,M,F){return M&&I(R.prototype,M),F&&I(R,F),R}}(),h=function I(R,M,F){R===null&&(R=Function.prototype);var z=Object.getOwnPropertyDescriptor(R,M);if(z===void 0){var $=Object.getPrototypeOf(R);return $===null?void 0:I($,M,F)}else{if("value"in z)return z.value;var W=z.get;return W===void 0?void 0:W.call(F)}},i=s(0),m=S(i),y=s(27);function S(I){return I&&I.__esModule?I:{default:I}}function b(I,R){if(!(I instanceof R))throw new TypeError("Cannot call a class as a function")}function T(I,R){if(!I)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R&&(typeof R=="object"||typeof R=="function")?R:I}function A(I,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof R);I.prototype=Object.create(R&&R.prototype,{constructor:{value:I,enumerable:!1,writable:!0,configurable:!0}}),R&&(Object.setPrototypeOf?Object.setPrototypeOf(I,R):I.__proto__=R)}var O=["alt","height","width"],P=function(I){A(R,I);function R(){return b(this,R),T(this,(R.__proto__||Object.getPrototypeOf(R)).apply(this,arguments))}return o(R,[{key:"format",value:function(F,z){O.indexOf(F)>-1?z?this.domNode.setAttribute(F,z):this.domNode.removeAttribute(F):h(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"format",this).call(this,F,z)}}],[{key:"create",value:function(F){var z=h(R.__proto__||Object.getPrototypeOf(R),"create",this).call(this,F);return typeof F=="string"&&z.setAttribute("src",this.sanitize(F)),z}},{key:"formats",value:function(F){return O.reduce(function(z,$){return F.hasAttribute($)&&(z[$]=F.getAttribute($)),z},{})}},{key:"match",value:function(F){return/\.(jpe?g|gif|png)$/.test(F)||/^data:image\/.+;base64/.test(F)}},{key:"sanitize",value:function(F){return(0,y.sanitize)(F,["http","https","data"])?F:"//:0"}},{key:"value",value:function(F){return F.getAttribute("src")}}]),R}(m.default.Embed);P.blotName="image",P.tagName="IMG",n.default=P},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function I(R,M){for(var F=0;F<M.length;F++){var z=M[F];z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z&&(z.writable=!0),Object.defineProperty(R,z.key,z)}}return function(R,M,F){return M&&I(R.prototype,M),F&&I(R,F),R}}(),h=function I(R,M,F){R===null&&(R=Function.prototype);var z=Object.getOwnPropertyDescriptor(R,M);if(z===void 0){var $=Object.getPrototypeOf(R);return $===null?void 0:I($,M,F)}else{if("value"in z)return z.value;var W=z.get;return W===void 0?void 0:W.call(F)}},i=s(4),m=s(27),y=S(m);function S(I){return I&&I.__esModule?I:{default:I}}function b(I,R){if(!(I instanceof R))throw new TypeError("Cannot call a class as a function")}function T(I,R){if(!I)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R&&(typeof R=="object"||typeof R=="function")?R:I}function A(I,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof R);I.prototype=Object.create(R&&R.prototype,{constructor:{value:I,enumerable:!1,writable:!0,configurable:!0}}),R&&(Object.setPrototypeOf?Object.setPrototypeOf(I,R):I.__proto__=R)}var O=["height","width"],P=function(I){A(R,I);function R(){return b(this,R),T(this,(R.__proto__||Object.getPrototypeOf(R)).apply(this,arguments))}return o(R,[{key:"format",value:function(F,z){O.indexOf(F)>-1?z?this.domNode.setAttribute(F,z):this.domNode.removeAttribute(F):h(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"format",this).call(this,F,z)}}],[{key:"create",value:function(F){var z=h(R.__proto__||Object.getPrototypeOf(R),"create",this).call(this,F);return z.setAttribute("frameborder","0"),z.setAttribute("allowfullscreen",!0),z.setAttribute("src",this.sanitize(F)),z}},{key:"formats",value:function(F){return O.reduce(function(z,$){return F.hasAttribute($)&&(z[$]=F.getAttribute($)),z},{})}},{key:"sanitize",value:function(F){return y.default.sanitize(F)}},{key:"value",value:function(F){return F.getAttribute("src")}}]),R}(i.BlockEmbed);P.blotName="video",P.className="ql-video",P.tagName="IFRAME",n.default=P},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.FormulaBlot=void 0;var o=function(){function F(z,$){for(var W=0;W<$.length;W++){var K=$[W];K.enumerable=K.enumerable||!1,K.configurable=!0,"value"in K&&(K.writable=!0),Object.defineProperty(z,K.key,K)}}return function(z,$,W){return $&&F(z.prototype,$),W&&F(z,W),z}}(),h=function F(z,$,W){z===null&&(z=Function.prototype);var K=Object.getOwnPropertyDescriptor(z,$);if(K===void 0){var ee=Object.getPrototypeOf(z);return ee===null?void 0:F(ee,$,W)}else{if("value"in K)return K.value;var ne=K.get;return ne===void 0?void 0:ne.call(W)}},i=s(35),m=A(i),y=s(5),S=A(y),b=s(9),T=A(b);function A(F){return F&&F.__esModule?F:{default:F}}function O(F,z){if(!(F instanceof z))throw new TypeError("Cannot call a class as a function")}function P(F,z){if(!F)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return z&&(typeof z=="object"||typeof z=="function")?z:F}function I(F,z){if(typeof z!="function"&&z!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof z);F.prototype=Object.create(z&&z.prototype,{constructor:{value:F,enumerable:!1,writable:!0,configurable:!0}}),z&&(Object.setPrototypeOf?Object.setPrototypeOf(F,z):F.__proto__=z)}var R=function(F){I(z,F);function z(){return O(this,z),P(this,(z.__proto__||Object.getPrototypeOf(z)).apply(this,arguments))}return o(z,null,[{key:"create",value:function(W){var K=h(z.__proto__||Object.getPrototypeOf(z),"create",this).call(this,W);return typeof W=="string"&&(window.katex.render(W,K,{throwOnError:!1,errorColor:"#f00"}),K.setAttribute("data-value",W)),K}},{key:"value",value:function(W){return W.getAttribute("data-value")}}]),z}(m.default);R.blotName="formula",R.className="ql-formula",R.tagName="SPAN";var M=function(F){I(z,F),o(z,null,[{key:"register",value:function(){S.default.register(R,!0)}}]);function z(){O(this,z);var $=P(this,(z.__proto__||Object.getPrototypeOf(z)).call(this));if(window.katex==null)throw new Error("Formula module requires KaTeX.");return $}return z}(T.default);n.FormulaBlot=R,n.default=M},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.CodeToken=n.CodeBlock=void 0;var o=function(){function W(K,ee){for(var ne=0;ne<ee.length;ne++){var ie=ee[ne];ie.enumerable=ie.enumerable||!1,ie.configurable=!0,"value"in ie&&(ie.writable=!0),Object.defineProperty(K,ie.key,ie)}}return function(K,ee,ne){return ee&&W(K.prototype,ee),ne&&W(K,ne),K}}(),h=function W(K,ee,ne){K===null&&(K=Function.prototype);var ie=Object.getOwnPropertyDescriptor(K,ee);if(ie===void 0){var re=Object.getPrototypeOf(K);return re===null?void 0:W(re,ee,ne)}else{if("value"in ie)return ie.value;var te=ie.get;return te===void 0?void 0:te.call(ne)}},i=s(0),m=P(i),y=s(5),S=P(y),b=s(9),T=P(b),A=s(13),O=P(A);function P(W){return W&&W.__esModule?W:{default:W}}function I(W,K){if(!(W instanceof K))throw new TypeError("Cannot call a class as a function")}function R(W,K){if(!W)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return K&&(typeof K=="object"||typeof K=="function")?K:W}function M(W,K){if(typeof K!="function"&&K!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof K);W.prototype=Object.create(K&&K.prototype,{constructor:{value:W,enumerable:!1,writable:!0,configurable:!0}}),K&&(Object.setPrototypeOf?Object.setPrototypeOf(W,K):W.__proto__=K)}var F=function(W){M(K,W);function K(){return I(this,K),R(this,(K.__proto__||Object.getPrototypeOf(K)).apply(this,arguments))}return o(K,[{key:"replaceWith",value:function(ne){this.domNode.textContent=this.domNode.textContent,this.attach(),h(K.prototype.__proto__||Object.getPrototypeOf(K.prototype),"replaceWith",this).call(this,ne)}},{key:"highlight",value:function(ne){var ie=this.domNode.textContent;this.cachedText!==ie&&((ie.trim().length>0||this.cachedText==null)&&(this.domNode.innerHTML=ne(ie),this.domNode.normalize(),this.attach()),this.cachedText=ie)}}]),K}(O.default);F.className="ql-syntax";var z=new m.default.Attributor.Class("token","hljs",{scope:m.default.Scope.INLINE}),$=function(W){M(K,W),o(K,null,[{key:"register",value:function(){S.default.register(z,!0),S.default.register(F,!0)}}]);function K(ee,ne){I(this,K);var ie=R(this,(K.__proto__||Object.getPrototypeOf(K)).call(this,ee,ne));if(typeof ie.options.highlight!="function")throw new Error("Syntax module requires highlight.js. Please include the library on the page before Quill.");var re=null;return ie.quill.on(S.default.events.SCROLL_OPTIMIZE,function(){clearTimeout(re),re=setTimeout(function(){ie.highlight(),re=null},ie.options.interval)}),ie.highlight(),ie}return o(K,[{key:"highlight",value:function(){var ne=this;if(!this.quill.selection.composing){this.quill.update(S.default.sources.USER);var ie=this.quill.getSelection();this.quill.scroll.descendants(F).forEach(function(re){re.highlight(ne.options.highlight)}),this.quill.update(S.default.sources.SILENT),ie!=null&&this.quill.setSelection(ie,S.default.sources.SILENT)}}}]),K}(T.default);$.DEFAULTS={highlight:function(){return window.hljs==null?null:function(W){var K=window.hljs.highlightAuto(W);return K.value}}(),interval:1e3},n.CodeBlock=F,n.CodeToken=z,n.default=$},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=3 x2=13 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=9 y1=4 y2=4></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=14 x2=4 y1=14 y2=14></line> <line class=ql-stroke x1=12 x2=6 y1=4 y2=4></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=15 x2=5 y1=14 y2=14></line> <line class=ql-stroke x1=15 x2=9 y1=4 y2=4></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=15 x2=3 y1=14 y2=14></line> <line class=ql-stroke x1=15 x2=3 y1=4 y2=4></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <g class="ql-fill ql-color-label"> <polygon points="6 6.868 6 6 5 6 5 7 5.942 7 6 6.868"></polygon> <rect height=1 width=1 x=4 y=4></rect> <polygon points="6.817 5 6 5 6 6 6.38 6 6.817 5"></polygon> <rect height=1 width=1 x=2 y=6></rect> <rect height=1 width=1 x=3 y=5></rect> <rect height=1 width=1 x=4 y=7></rect> <polygon points="4 11.439 4 11 3 11 3 12 3.755 12 4 11.439"></polygon> <rect height=1 width=1 x=2 y=12></rect> <rect height=1 width=1 x=2 y=9></rect> <rect height=1 width=1 x=2 y=15></rect> <polygon points="4.63 10 4 10 4 11 4.192 11 4.63 10"></polygon> <rect height=1 width=1 x=3 y=8></rect> <path d=M10.832,4.2L11,4.582V4H10.708A1.948,1.948,0,0,1,10.832,4.2Z></path> <path d=M7,4.582L7.168,4.2A1.929,1.929,0,0,1,7.292,4H7V4.582Z></path> <path d=M8,13H7.683l-0.351.8a1.933,1.933,0,0,1-.124.2H8V13Z></path> <rect height=1 width=1 x=12 y=2></rect> <rect height=1 width=1 x=11 y=3></rect> <path d=M9,3H8V3.282A1.985,1.985,0,0,1,9,3Z></path> <rect height=1 width=1 x=2 y=3></rect> <rect height=1 width=1 x=6 y=2></rect> <rect height=1 width=1 x=3 y=2></rect> <rect height=1 width=1 x=5 y=3></rect> <rect height=1 width=1 x=9 y=2></rect> <rect height=1 width=1 x=15 y=14></rect> <polygon points="13.447 10.174 13.469 10.225 13.472 10.232 13.808 11 14 11 14 10 13.37 10 13.447 10.174"></polygon> <rect height=1 width=1 x=13 y=7></rect> <rect height=1 width=1 x=15 y=5></rect> <rect height=1 width=1 x=14 y=6></rect> <rect height=1 width=1 x=15 y=8></rect> <rect height=1 width=1 x=14 y=9></rect> <path d=M3.775,14H3v1H4V14.314A1.97,1.97,0,0,1,3.775,14Z></path> <rect height=1 width=1 x=14 y=3></rect> <polygon points="12 6.868 12 6 11.62 6 12 6.868"></polygon> <rect height=1 width=1 x=15 y=2></rect> <rect height=1 width=1 x=12 y=5></rect> <rect height=1 width=1 x=13 y=4></rect> <polygon points="12.933 9 13 9 13 8 12.495 8 12.933 9"></polygon> <rect height=1 width=1 x=9 y=14></rect> <rect height=1 width=1 x=8 y=15></rect> <path d=M6,14.926V15H7V14.316A1.993,1.993,0,0,1,6,14.926Z></path> <rect height=1 width=1 x=5 y=15></rect> <path d=M10.668,13.8L10.317,13H10v1h0.792A1.947,1.947,0,0,1,10.668,13.8Z></path> <rect height=1 width=1 x=11 y=15></rect> <path d=M14.332,12.2a1.99,1.99,0,0,1,.166.8H15V12H14.245Z></path> <rect height=1 width=1 x=14 y=15></rect> <rect height=1 width=1 x=15 y=11></rect> </g> <polyline class=ql-stroke points="5.5 13 9 5 12.5 13"></polyline> <line class=ql-stroke x1=11.63 x2=6.38 y1=11 y2=11></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <rect class="ql-fill ql-stroke" height=3 width=3 x=4 y=5></rect> <rect class="ql-fill ql-stroke" height=3 width=3 x=11 y=5></rect> <path class="ql-even ql-fill ql-stroke" d=M7,8c0,4.031-3,5-3,5></path> <path class="ql-even ql-fill ql-stroke" d=M14,8c0,4.031-3,5-3,5></path> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-stroke d=M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z></path> <path class=ql-stroke d=M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z></path> </svg>'},function(r,n){r.exports='<svg class="" viewbox="0 0 18 18"> <line class=ql-stroke x1=5 x2=13 y1=3 y2=3></line> <line class=ql-stroke x1=6 x2=9.35 y1=12 y2=3></line> <line class=ql-stroke x1=11 x2=15 y1=11 y2=15></line> <line class=ql-stroke x1=15 x2=11 y1=11 y2=15></line> <rect class=ql-fill height=1 rx=0.5 ry=0.5 width=7 x=2 y=14></rect> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class="ql-color-label ql-stroke ql-transparent" x1=3 x2=15 y1=15 y2=15></line> <polyline class=ql-stroke points="5.5 11 9 3 12.5 11"></polyline> <line class=ql-stroke x1=11.63 x2=6.38 y1=9 y2=9></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <polygon class="ql-stroke ql-fill" points="3 11 5 9 3 7 3 11"></polygon> <line class="ql-stroke ql-fill" x1=15 x2=11 y1=4 y2=4></line> <path class=ql-fill d=M11,3a3,3,0,0,0,0,6h1V3H11Z></path> <rect class=ql-fill height=11 width=1 x=11 y=4></rect> <rect class=ql-fill height=11 width=1 x=13 y=4></rect> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <polygon class="ql-stroke ql-fill" points="15 12 13 10 15 8 15 12"></polygon> <line class="ql-stroke ql-fill" x1=9 x2=5 y1=4 y2=4></line> <path class=ql-fill d=M5,3A3,3,0,0,0,5,9H6V3H5Z></path> <rect class=ql-fill height=11 width=1 x=5 y=4></rect> <rect class=ql-fill height=11 width=1 x=7 y=4></rect> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M14,16H4a1,1,0,0,1,0-2H14A1,1,0,0,1,14,16Z /> <path class=ql-fill d=M14,4H4A1,1,0,0,1,4,2H14A1,1,0,0,1,14,4Z /> <rect class=ql-fill x=3 y=6 width=12 height=6 rx=1 ry=1 /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M13,16H5a1,1,0,0,1,0-2h8A1,1,0,0,1,13,16Z /> <path class=ql-fill d=M13,4H5A1,1,0,0,1,5,2h8A1,1,0,0,1,13,4Z /> <rect class=ql-fill x=2 y=6 width=14 height=6 rx=1 ry=1 /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15,8H13a1,1,0,0,1,0-2h2A1,1,0,0,1,15,8Z /> <path class=ql-fill d=M15,12H13a1,1,0,0,1,0-2h2A1,1,0,0,1,15,12Z /> <path class=ql-fill d=M15,16H5a1,1,0,0,1,0-2H15A1,1,0,0,1,15,16Z /> <path class=ql-fill d=M15,4H5A1,1,0,0,1,5,2H15A1,1,0,0,1,15,4Z /> <rect class=ql-fill x=2 y=6 width=8 height=6 rx=1 ry=1 /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M5,8H3A1,1,0,0,1,3,6H5A1,1,0,0,1,5,8Z /> <path class=ql-fill d=M5,12H3a1,1,0,0,1,0-2H5A1,1,0,0,1,5,12Z /> <path class=ql-fill d=M13,16H3a1,1,0,0,1,0-2H13A1,1,0,0,1,13,16Z /> <path class=ql-fill d=M13,4H3A1,1,0,0,1,3,2H13A1,1,0,0,1,13,4Z /> <rect class=ql-fill x=8 y=6 width=8 height=6 rx=1 ry=1 transform="translate(24 18) rotate(-180)"/> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M11.759,2.482a2.561,2.561,0,0,0-3.53.607A7.656,7.656,0,0,0,6.8,6.2C6.109,9.188,5.275,14.677,4.15,14.927a1.545,1.545,0,0,0-1.3-.933A0.922,0.922,0,0,0,2,15.036S1.954,16,4.119,16s3.091-2.691,3.7-5.553c0.177-.826.36-1.726,0.554-2.6L8.775,6.2c0.381-1.421.807-2.521,1.306-2.676a1.014,1.014,0,0,0,1.02.56A0.966,0.966,0,0,0,11.759,2.482Z></path> <rect class=ql-fill height=1.6 rx=0.8 ry=0.8 width=5 x=5.15 y=6.2></rect> <path class=ql-fill d=M13.663,12.027a1.662,1.662,0,0,1,.266-0.276q0.193,0.069.456,0.138a2.1,2.1,0,0,0,.535.069,1.075,1.075,0,0,0,.767-0.3,1.044,1.044,0,0,0,.314-0.8,0.84,0.84,0,0,0-.238-0.619,0.8,0.8,0,0,0-.594-0.239,1.154,1.154,0,0,0-.781.3,4.607,4.607,0,0,0-.781,1q-0.091.15-.218,0.346l-0.246.38c-0.068-.288-0.137-0.582-0.212-0.885-0.459-1.847-2.494-.984-2.941-0.8-0.482.2-.353,0.647-0.094,0.529a0.869,0.869,0,0,1,1.281.585c0.217,0.751.377,1.436,0.527,2.038a5.688,5.688,0,0,1-.362.467,2.69,2.69,0,0,1-.264.271q-0.221-.08-0.471-0.147a2.029,2.029,0,0,0-.522-0.066,1.079,1.079,0,0,0-.768.3A1.058,1.058,0,0,0,9,15.131a0.82,0.82,0,0,0,.832.852,1.134,1.134,0,0,0,.787-0.3,5.11,5.11,0,0,0,.776-0.993q0.141-.219.215-0.34c0.046-.076.122-0.194,0.223-0.346a2.786,2.786,0,0,0,.918,1.726,2.582,2.582,0,0,0,2.376-.185c0.317-.181.212-0.565,0-0.494A0.807,0.807,0,0,1,14.176,15a5.159,5.159,0,0,1-.913-2.446l0,0Q13.487,12.24,13.663,12.027Z></path> </svg>'},function(r,n){r.exports='<svg viewBox="0 0 18 18"> <path class=ql-fill d=M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm6.06787,9.209H14.98975V7.59863a.54085.54085,0,0,0-.605-.60547h-.62744a1.01119,1.01119,0,0,0-.748.29688L11.645,8.56641a.5435.5435,0,0,0-.022.8584l.28613.30762a.53861.53861,0,0,0,.84717.0332l.09912-.08789a1.2137,1.2137,0,0,0,.2417-.35254h.02246s-.01123.30859-.01123.60547V13.209H12.041a.54085.54085,0,0,0-.605.60547v.43945a.54085.54085,0,0,0,.605.60547h4.02686a.54085.54085,0,0,0,.605-.60547v-.43945A.54085.54085,0,0,0,16.06787,13.209Z /> </svg>'},function(r,n){r.exports='<svg viewBox="0 0 18 18"> <path class=ql-fill d=M16.73975,13.81445v.43945a.54085.54085,0,0,1-.605.60547H11.855a.58392.58392,0,0,1-.64893-.60547V14.0127c0-2.90527,3.39941-3.42187,3.39941-4.55469a.77675.77675,0,0,0-.84717-.78125,1.17684,1.17684,0,0,0-.83594.38477c-.2749.26367-.561.374-.85791.13184l-.4292-.34082c-.30811-.24219-.38525-.51758-.1543-.81445a2.97155,2.97155,0,0,1,2.45361-1.17676,2.45393,2.45393,0,0,1,2.68408,2.40918c0,2.45312-3.1792,2.92676-3.27832,3.93848h2.79443A.54085.54085,0,0,1,16.73975,13.81445ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=13 y1=4 y2=4></line> <line class=ql-stroke x1=5 x2=11 y1=14 y2=14></line> <line class=ql-stroke x1=8 x2=10 y1=14 y2=4></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <rect class=ql-stroke height=10 width=12 x=3 y=4></rect> <circle class=ql-fill cx=6 cy=7 r=1></circle> <polyline class="ql-even ql-fill" points="5 12 5 11 7 9 8 10 11 7 13 9 13 12 5 12"></polyline> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class="ql-fill ql-stroke" points="3 7 3 11 5 9 3 7"></polyline> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class=ql-stroke points="5 7 5 11 3 9 5 7"></polyline> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=11 y1=7 y2=11></line> <path class="ql-even ql-stroke" d=M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z></path> <path class="ql-even ql-stroke" d=M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z></path> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=7 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=7 x2=15 y1=14 y2=14></line> <line class="ql-stroke ql-thin" x1=2.5 x2=4.5 y1=5.5 y2=5.5></line> <path class=ql-fill d=M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z></path> <path class="ql-stroke ql-thin" d=M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156></path> <path class="ql-stroke ql-thin" d=M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109></path> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=6 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=6 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=6 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=3 y1=4 y2=4></line> <line class=ql-stroke x1=3 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=3 x2=3 y1=14 y2=14></line> </svg>'},function(r,n){r.exports='<svg class="" viewbox="0 0 18 18"> <line class=ql-stroke x1=9 x2=15 y1=4 y2=4></line> <polyline class=ql-stroke points="3 4 4 5 6 3"></polyline> <line class=ql-stroke x1=9 x2=15 y1=14 y2=14></line> <polyline class=ql-stroke points="3 14 4 15 6 13"></polyline> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class=ql-stroke points="3 9 4 10 6 8"></polyline> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15.5,15H13.861a3.858,3.858,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.921,1.921,0,0,0,12.021,11.7a0.50013,0.50013,0,1,0,.957.291h0a0.914,0.914,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.076-1.16971,1.86982-1.93971,2.43082A1.45639,1.45639,0,0,0,12,15.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,15Z /> <path class=ql-fill d=M9.65,5.241a1,1,0,0,0-1.409.108L6,7.964,3.759,5.349A1,1,0,0,0,2.192,6.59178Q2.21541,6.6213,2.241,6.649L4.684,9.5,2.241,12.35A1,1,0,0,0,3.71,13.70722q0.02557-.02768.049-0.05722L6,11.036,8.241,13.65a1,1,0,1,0,1.567-1.24277Q9.78459,12.3777,9.759,12.35L7.316,9.5,9.759,6.651A1,1,0,0,0,9.65,5.241Z /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15.5,7H13.861a4.015,4.015,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.922,1.922,0,0,0,12.021,3.7a0.5,0.5,0,1,0,.957.291,0.917,0.917,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.077-1.164,1.925-1.934,2.486A1.423,1.423,0,0,0,12,7.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,7Z /> <path class=ql-fill d=M9.651,5.241a1,1,0,0,0-1.41.108L6,7.964,3.759,5.349a1,1,0,1,0-1.519,1.3L4.683,9.5,2.241,12.35a1,1,0,1,0,1.519,1.3L6,11.036,8.241,13.65a1,1,0,0,0,1.519-1.3L7.317,9.5,9.759,6.651A1,1,0,0,0,9.651,5.241Z /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class="ql-stroke ql-thin" x1=15.5 x2=2.5 y1=8.5 y2=9.5></line> <path class=ql-fill d=M9.007,8C6.542,7.791,6,7.519,6,6.5,6,5.792,7.283,5,9,5c1.571,0,2.765.679,2.969,1.309a1,1,0,0,0,1.9-.617C13.356,4.106,11.354,3,9,3,6.2,3,4,4.538,4,6.5a3.2,3.2,0,0,0,.5,1.843Z></path> <path class=ql-fill d=M8.984,10C11.457,10.208,12,10.479,12,11.5c0,0.708-1.283,1.5-3,1.5-1.571,0-2.765-.679-2.969-1.309a1,1,0,1,0-1.9.617C4.644,13.894,6.646,15,9,15c2.8,0,5-1.538,5-3.5a3.2,3.2,0,0,0-.5-1.843Z></path> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-stroke d=M5,3V9a4.012,4.012,0,0,0,4,4H9a4.012,4.012,0,0,0,4-4V3></path> <rect class=ql-fill height=1 rx=0.5 ry=0.5 width=12 x=3 y=15></rect> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <rect class=ql-stroke height=12 width=12 x=3 y=3></rect> <rect class=ql-fill height=12 width=1 x=5 y=3></rect> <rect class=ql-fill height=12 width=1 x=12 y=3></rect> <rect class=ql-fill height=2 width=8 x=5 y=8></rect> <rect class=ql-fill height=1 width=3 x=3 y=5></rect> <rect class=ql-fill height=1 width=3 x=3 y=7></rect> <rect class=ql-fill height=1 width=3 x=3 y=10></rect> <rect class=ql-fill height=1 width=3 x=3 y=12></rect> <rect class=ql-fill height=1 width=3 x=12 y=5></rect> <rect class=ql-fill height=1 width=3 x=12 y=7></rect> <rect class=ql-fill height=1 width=3 x=12 y=10></rect> <rect class=ql-fill height=1 width=3 x=12 y=12></rect> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <polygon class=ql-stroke points="7 11 9 13 11 11 7 11"></polygon> <polygon class=ql-stroke points="7 7 9 5 11 7 7 7"></polygon> </svg>'},function(r,n,s){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.BubbleTooltip=void 0;var o=function K(ee,ne,ie){ee===null&&(ee=Function.prototype);var re=Object.getOwnPropertyDescriptor(ee,ne);if(re===void 0){var te=Object.getPrototypeOf(ee);return te===null?void 0:K(te,ne,ie)}else{if("value"in re)return re.value;var ae=re.get;return ae===void 0?void 0:ae.call(ie)}},h=function(){function K(ee,ne){for(var ie=0;ie<ne.length;ie++){var re=ne[ie];re.enumerable=re.enumerable||!1,re.configurable=!0,"value"in re&&(re.writable=!0),Object.defineProperty(ee,re.key,re)}}return function(ee,ne,ie){return ne&&K(ee.prototype,ne),ie&&K(ee,ie),ee}}(),i=s(3),m=I(i),y=s(8),S=I(y),b=s(43),T=I(b),A=s(15),O=s(41),P=I(O);function I(K){return K&&K.__esModule?K:{default:K}}function R(K,ee){if(!(K instanceof ee))throw new TypeError("Cannot call a class as a function")}function M(K,ee){if(!K)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ee&&(typeof ee=="object"||typeof ee=="function")?ee:K}function F(K,ee){if(typeof ee!="function"&&ee!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof ee);K.prototype=Object.create(ee&&ee.prototype,{constructor:{value:K,enumerable:!1,writable:!0,configurable:!0}}),ee&&(Object.setPrototypeOf?Object.setPrototypeOf(K,ee):K.__proto__=ee)}var z=[["bold","italic","link"],[{header:1},{header:2},"blockquote"]],$=function(K){F(ee,K);function ee(ne,ie){R(this,ee),ie.modules.toolbar!=null&&ie.modules.toolbar.container==null&&(ie.modules.toolbar.container=z);var re=M(this,(ee.__proto__||Object.getPrototypeOf(ee)).call(this,ne,ie));return re.quill.container.classList.add("ql-bubble"),re}return h(ee,[{key:"extendToolbar",value:function(ie){this.tooltip=new W(this.quill,this.options.bounds),this.tooltip.root.appendChild(ie.container),this.buildButtons([].slice.call(ie.container.querySelectorAll("button")),P.default),this.buildPickers([].slice.call(ie.container.querySelectorAll("select")),P.default)}}]),ee}(T.default);$.DEFAULTS=(0,m.default)(!0,{},T.default.DEFAULTS,{modules:{toolbar:{handlers:{link:function(ee){ee?this.quill.theme.tooltip.edit():this.quill.format("link",!1)}}}}});var W=function(K){F(ee,K);function ee(ne,ie){R(this,ee);var re=M(this,(ee.__proto__||Object.getPrototypeOf(ee)).call(this,ne,ie));return re.quill.on(S.default.events.EDITOR_CHANGE,function(te,ae,ue,be){if(te===S.default.events.SELECTION_CHANGE)if(ae!=null&&ae.length>0&&be===S.default.sources.USER){re.show(),re.root.style.left="0px",re.root.style.width="",re.root.style.width=re.root.offsetWidth+"px";var we=re.quill.getLines(ae.index,ae.length);if(we.length===1)re.position(re.quill.getBounds(ae));else{var Ce=we[we.length-1],_e=re.quill.getIndex(Ce),me=Math.min(Ce.length()-1,ae.index+ae.length-_e),Ae=re.quill.getBounds(new A.Range(_e,me));re.position(Ae)}}else document.activeElement!==re.textbox&&re.quill.hasFocus()&&re.hide()}),re}return h(ee,[{key:"listen",value:function(){var ie=this;o(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"listen",this).call(this),this.root.querySelector(".ql-close").addEventListener("click",function(){ie.root.classList.remove("ql-editing")}),this.quill.on(S.default.events.SCROLL_OPTIMIZE,function(){setTimeout(function(){if(!ie.root.classList.contains("ql-hidden")){var re=ie.quill.getSelection();re!=null&&ie.position(ie.quill.getBounds(re))}},1)})}},{key:"cancel",value:function(){this.show()}},{key:"position",value:function(ie){var re=o(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"position",this).call(this,ie),te=this.root.querySelector(".ql-tooltip-arrow");if(te.style.marginLeft="",re===0)return re;te.style.marginLeft=-1*re-te.offsetWidth/2+"px"}}]),ee}(b.BaseTooltip);W.TEMPLATE=['<span class="ql-tooltip-arrow"></span>','<div class="ql-tooltip-editor">','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-close"></a>',"</div>"].join(""),n.BubbleTooltip=W,n.default=$},function(r,n,s){r.exports=s(63)}]).default})})(Sde);var Nnt=Sde.exports,Int=$c&&$c.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var o in s)s.hasOwnProperty(o)&&(n[o]=s[o])},e(t,r)};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),kk=$c&&$c.__assign||function(){return kk=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},kk.apply(this,arguments)},Rnt=$c&&$c.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),s=0,t=0;t<r;t++)for(var o=arguments[t],h=0,i=o.length;h<i;h++,s++)n[s]=o[h];return n},UI=$c&&$c.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},vh=UI(V),Mnt=UI(vg),nE=UI(xce),xX=UI(Nnt),Dnt=function(e){Int(t,e);function t(r){var n=e.call(this,r)||this;n.dirtyProps=["modules","formats","bounds","theme","children"],n.cleanProps=["id","className","style","placeholder","tabIndex","onChange","onChangeSelection","onFocus","onBlur","onKeyPress","onKeyDown","onKeyUp"],n.state={generation:0},n.selection=null,n.onEditorChange=function(o,h,i,m){var y,S,b,T;o==="text-change"?(S=(y=n).onEditorChangeText)===null||S===void 0||S.call(y,n.editor.root.innerHTML,h,m,n.unprivilegedEditor):o==="selection-change"&&((T=(b=n).onEditorChangeSelection)===null||T===void 0||T.call(b,h,m,n.unprivilegedEditor))};var s=n.isControlled()?r.value:r.defaultValue;return n.value=s??"",n}return t.prototype.validateProps=function(r){var n;if(vh.default.Children.count(r.children)>1)throw new Error("The Quill editing area can only be composed of a single React element.");if(vh.default.Children.count(r.children)){var s=vh.default.Children.only(r.children);if(((n=s)===null||n===void 0?void 0:n.type)==="textarea")throw new Error("Quill does not support editing on a <textarea>. Use a <div> instead.")}if(this.lastDeltaChangeSet&&r.value===this.lastDeltaChangeSet)throw new Error("You are passing the `delta` object from the `onChange` event back as `value`. You most probably want `editor.getContents()` instead. See: https://github.com/zenoamaro/react-quill#using-deltas")},t.prototype.shouldComponentUpdate=function(r,n){var s=this,o;if(this.validateProps(r),!this.editor||this.state.generation!==n.generation)return!0;if("value"in r){var h=this.getEditorContents(),i=(o=r.value,o??"");this.isEqualValue(i,h)||this.setEditorContents(this.editor,i)}return r.readOnly!==this.props.readOnly&&this.setEditorReadOnly(this.editor,r.readOnly),Rnt(this.cleanProps,this.dirtyProps).some(function(m){return!nE.default(r[m],s.props[m])})},t.prototype.shouldComponentRegenerate=function(r){var n=this;return this.dirtyProps.some(function(s){return!nE.default(r[s],n.props[s])})},t.prototype.componentDidMount=function(){this.instantiateEditor(),this.setEditorContents(this.editor,this.getEditorContents())},t.prototype.componentWillUnmount=function(){this.destroyEditor()},t.prototype.componentDidUpdate=function(r,n){var s=this;if(this.editor&&this.shouldComponentRegenerate(r)){var o=this.editor.getContents(),h=this.editor.getSelection();this.regenerationSnapshot={delta:o,selection:h},this.setState({generation:this.state.generation+1}),this.destroyEditor()}if(this.state.generation!==n.generation){var i=this.regenerationSnapshot,o=i.delta,m=i.selection;delete this.regenerationSnapshot,this.instantiateEditor();var y=this.editor;y.setContents(o),bX(function(){return s.setEditorSelection(y,m)})}},t.prototype.instantiateEditor=function(){this.editor?this.hookEditor(this.editor):this.editor=this.createEditor(this.getEditingArea(),this.getEditorConfig())},t.prototype.destroyEditor=function(){this.editor&&this.unhookEditor(this.editor)},t.prototype.isControlled=function(){return"value"in this.props},t.prototype.getEditorConfig=function(){return{bounds:this.props.bounds,formats:this.props.formats,modules:this.props.modules,placeholder:this.props.placeholder,readOnly:this.props.readOnly,scrollingContainer:this.props.scrollingContainer,tabIndex:this.props.tabIndex,theme:this.props.theme}},t.prototype.getEditor=function(){if(!this.editor)throw new Error("Accessing non-instantiated editor");return this.editor},t.prototype.createEditor=function(r,n){var s=new xX.default(r,n);return n.tabIndex!=null&&this.setEditorTabIndex(s,n.tabIndex),this.hookEditor(s),s},t.prototype.hookEditor=function(r){this.unprivilegedEditor=this.makeUnprivilegedEditor(r),r.on("editor-change",this.onEditorChange)},t.prototype.unhookEditor=function(r){r.off("editor-change",this.onEditorChange)},t.prototype.getEditorContents=function(){return this.value},t.prototype.getEditorSelection=function(){return this.selection},t.prototype.isDelta=function(r){return r&&r.ops},t.prototype.isEqualValue=function(r,n){return this.isDelta(r)&&this.isDelta(n)?nE.default(r.ops,n.ops):nE.default(r,n)},t.prototype.setEditorContents=function(r,n){var s=this;this.value=n;var o=this.getEditorSelection();typeof n=="string"?r.setContents(r.clipboard.convert(n)):r.setContents(n),bX(function(){return s.setEditorSelection(r,o)})},t.prototype.setEditorSelection=function(r,n){if(this.selection=n,n){var s=r.getLength();n.index=Math.max(0,Math.min(n.index,s-1)),n.length=Math.max(0,Math.min(n.length,s-1-n.index)),r.setSelection(n)}},t.prototype.setEditorTabIndex=function(r,n){var s,o;!((o=(s=r)===null||s===void 0?void 0:s.scroll)===null||o===void 0)&&o.domNode&&(r.scroll.domNode.tabIndex=n)},t.prototype.setEditorReadOnly=function(r,n){n?r.disable():r.enable()},t.prototype.makeUnprivilegedEditor=function(r){var n=r;return{getHTML:function(){return n.root.innerHTML},getLength:n.getLength.bind(n),getText:n.getText.bind(n),getContents:n.getContents.bind(n),getSelection:n.getSelection.bind(n),getBounds:n.getBounds.bind(n)}},t.prototype.getEditingArea=function(){if(!this.editingArea)throw new Error("Instantiating on missing editing area");var r=Mnt.default.findDOMNode(this.editingArea);if(!r)throw new Error("Cannot find element for editing area");if(r.nodeType===3)throw new Error("Editing area cannot be a text node");return r},t.prototype.renderEditingArea=function(){var r=this,n=this.props,s=n.children,o=n.preserveWhitespace,h=this.state.generation,i={key:h,ref:function(m){r.editingArea=m}};return vh.default.Children.count(s)?vh.default.cloneElement(vh.default.Children.only(s),i):o?vh.default.createElement("pre",kk({},i)):vh.default.createElement("div",kk({},i))},t.prototype.render=function(){var r;return vh.default.createElement("div",{id:this.props.id,style:this.props.style,key:this.state.generation,className:"quill "+(r=this.props.className,r??""),onKeyPress:this.props.onKeyPress,onKeyDown:this.props.onKeyDown,onKeyUp:this.props.onKeyUp},this.renderEditingArea())},t.prototype.onEditorChangeText=function(r,n,s,o){var h,i;if(this.editor){var m=this.isDelta(this.value)?o.getContents():o.getHTML();m!==this.getEditorContents()&&(this.lastDeltaChangeSet=n,this.value=m,(i=(h=this.props).onChange)===null||i===void 0||i.call(h,r,n,s,o))}},t.prototype.onEditorChangeSelection=function(r,n,s){var o,h,i,m,y,S;if(this.editor){var b=this.getEditorSelection(),T=!b&&r,A=b&&!r;nE.default(r,b)||(this.selection=r,(h=(o=this.props).onChangeSelection)===null||h===void 0||h.call(o,r,n,s),T?(m=(i=this.props).onFocus)===null||m===void 0||m.call(i,r,n,s):A&&((S=(y=this.props).onBlur)===null||S===void 0||S.call(y,b,n,s)))}},t.prototype.focus=function(){this.editor&&this.editor.focus()},t.prototype.blur=function(){this.editor&&(this.selection=null,this.editor.blur())},t.displayName="React Quill",t.Quill=xX.default,t.defaultProps={theme:"snow",modules:{},readOnly:!1},t}(vh.default.Component);function bX(e){Promise.resolve().then(e)}var Lnt=Dnt;const Fnt=Os(Lnt);function Lf({value:e,onChange:t,placeholder:r,className:n}){const s=V.useMemo(()=>({toolbar:[[{header:[1,2,3,!1]}],[{size:["small",!1,"large","huge"]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["link"],["clean"]]}),[]),o=["header","size","bold","italic","underline","strike","color","background","list","bullet","align","link"];return d.jsxs("div",{className:fr("rich-text-editor",n),children:[d.jsx("style",{dangerouslySetInnerHTML:{__html:`
          .rich-text-editor .ql-container {
            min-height: 200px;
            font-family: inherit;
            border-bottom-left-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
          }
          
          .rich-text-editor .ql-toolbar {
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
            background: hsl(var(--muted));
            border-color: hsl(var(--border));
          }
          
          .rich-text-editor .ql-container {
            border-color: hsl(var(--border));
          }
          
          .rich-text-editor .ql-editor {
            min-height: 200px;
            color: hsl(var(--foreground));
          }
          
          .rich-text-editor .ql-editor.ql-blank::before {
            color: hsl(var(--muted-foreground));
            font-style: normal;
          }
          
          .rich-text-editor .ql-stroke {
            stroke: hsl(var(--foreground));
          }
          
          .rich-text-editor .ql-fill {
            fill: hsl(var(--foreground));
          }
          
          .rich-text-editor .ql-picker-label {
            color: hsl(var(--foreground));
          }
          
          .rich-text-editor .ql-toolbar button:hover,
          .rich-text-editor .ql-toolbar button:focus,
          .rich-text-editor .ql-toolbar button.ql-active {
            color: hsl(var(--primary));
          }
          
          .rich-text-editor .ql-toolbar button:hover .ql-stroke,
          .rich-text-editor .ql-toolbar button:focus .ql-stroke,
          .rich-text-editor .ql-toolbar button.ql-active .ql-stroke {
            stroke: hsl(var(--primary));
          }
          
          .rich-text-editor .ql-toolbar button:hover .ql-fill,
          .rich-text-editor .ql-toolbar button:focus .ql-fill,
          .rich-text-editor .ql-toolbar button.ql-active .ql-fill {
            fill: hsl(var(--primary));
          }
          
          .rich-text-editor .ql-picker-options {
            background: hsl(var(--background));
            border-color: hsl(var(--border));
          }
          
          .rich-text-editor .ql-picker-item:hover {
            color: hsl(var(--primary));
          }
        `}}),d.jsx(Fnt,{theme:"snow",value:e,onChange:t,modules:s,formats:o,placeholder:r,className:"bg-background"})]})}var znt=Object.defineProperty,Bnt=(e,t,r)=>t in e?znt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ea=(e,t,r)=>Bnt(e,typeof t!="symbol"?t+"":t,r);const Nk={x:0,y:0,width:0,height:0,unit:"px"},Wx=(e,t,r)=>Math.min(Math.max(e,t),r),$nt=(...e)=>e.filter(t=>t&&typeof t=="string").join(" "),wX=(e,t)=>e===t||e.width===t.width&&e.height===t.height&&e.x===t.x&&e.y===t.y&&e.unit===t.unit;function Unt(e,t,r,n){const s=xh(e,r,n);return e.width&&(s.height=s.width/t),e.height&&(s.width=s.height*t),s.y+s.height>n&&(s.height=n-s.y,s.width=s.height*t),s.x+s.width>r&&(s.width=r-s.x,s.height=s.width/t),e.unit==="%"?Tm(s,r,n):s}function Vnt(e,t,r){const n=xh(e,t,r);return n.x=(t-n.width)/2,n.y=(r-n.height)/2,e.unit==="%"?Tm(n,t,r):n}function Tm(e,t,r){return e.unit==="%"?{...Nk,...e,unit:"%"}:{unit:"%",x:e.x?e.x/t*100:0,y:e.y?e.y/r*100:0,width:e.width?e.width/t*100:0,height:e.height?e.height/r*100:0}}function xh(e,t,r){return e.unit?e.unit==="px"?{...Nk,...e,unit:"px"}:{unit:"px",x:e.x?e.x*t/100:0,y:e.y?e.y*r/100:0,width:e.width?e.width*t/100:0,height:e.height?e.height*r/100:0}:{...Nk,...e,unit:"px"}}function SX(e,t,r,n,s,o=0,h=0,i=n,m=s){const y={...e};let S=Math.min(o,n),b=Math.min(h,s),T=Math.min(i,n),A=Math.min(m,s);t&&(t>1?(S=h?h*t:S,b=S/t,T=i*t):(b=o?o/t:b,S=b*t,A=m/t)),y.y<0&&(y.height=Math.max(y.height+y.y,b),y.y=0),y.x<0&&(y.width=Math.max(y.width+y.x,S),y.x=0);const O=n-(y.x+y.width);O<0&&(y.x=Math.min(y.x,n-S),y.width+=O);const P=s-(y.y+y.height);if(P<0&&(y.y=Math.min(y.y,s-b),y.height+=P),y.width<S&&((r==="sw"||r=="nw")&&(y.x-=S-y.width),y.width=S),y.height<b&&((r==="nw"||r=="ne")&&(y.y-=b-y.height),y.height=b),y.width>T&&((r==="sw"||r=="nw")&&(y.x-=T-y.width),y.width=T),y.height>A&&((r==="nw"||r=="ne")&&(y.y-=A-y.height),y.height=A),t){const I=y.width/y.height;if(I<t){const R=Math.max(y.width/t,b);(r==="nw"||r=="ne")&&(y.y-=R-y.height),y.height=R}else if(I>t){const R=Math.max(y.height*t,S);(r==="sw"||r=="nw")&&(y.x-=R-y.width),y.width=R}}return y}function qnt(e,t,r,n){const s={...e};return t==="ArrowLeft"?n==="nw"?(s.x-=r,s.y-=r,s.width+=r,s.height+=r):n==="w"?(s.x-=r,s.width+=r):n==="sw"?(s.x-=r,s.width+=r,s.height+=r):n==="ne"?(s.y+=r,s.width-=r,s.height-=r):n==="e"?s.width-=r:n==="se"&&(s.width-=r,s.height-=r):t==="ArrowRight"&&(n==="nw"?(s.x+=r,s.y+=r,s.width-=r,s.height-=r):n==="w"?(s.x+=r,s.width-=r):n==="sw"?(s.x+=r,s.width-=r,s.height-=r):n==="ne"?(s.y-=r,s.width+=r,s.height+=r):n==="e"?s.width+=r:n==="se"&&(s.width+=r,s.height+=r)),t==="ArrowUp"?n==="nw"?(s.x-=r,s.y-=r,s.width+=r,s.height+=r):n==="n"?(s.y-=r,s.height+=r):n==="ne"?(s.y-=r,s.width+=r,s.height+=r):n==="sw"?(s.x+=r,s.width-=r,s.height-=r):n==="s"?s.height-=r:n==="se"&&(s.width-=r,s.height-=r):t==="ArrowDown"&&(n==="nw"?(s.x+=r,s.y+=r,s.width-=r,s.height-=r):n==="n"?(s.y+=r,s.height-=r):n==="ne"?(s.y+=r,s.width-=r,s.height-=r):n==="sw"?(s.x-=r,s.width+=r,s.height+=r):n==="s"?s.height+=r:n==="se"&&(s.width+=r,s.height+=r)),s}const Kx={capture:!0,passive:!1};let Hnt=0;const vm=class jd extends V.PureComponent{constructor(){super(...arguments),Ea(this,"docMoveBound",!1),Ea(this,"mouseDownOnCrop",!1),Ea(this,"dragStarted",!1),Ea(this,"evData",{startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0}),Ea(this,"componentRef",V.createRef()),Ea(this,"mediaRef",V.createRef()),Ea(this,"resizeObserver"),Ea(this,"initChangeCalled",!1),Ea(this,"instanceId",`rc-${Hnt++}`),Ea(this,"state",{cropIsActive:!1,newCropIsBeingDrawn:!1}),Ea(this,"onCropPointerDown",t=>{const{crop:r,disabled:n}=this.props,s=this.getBox();if(!r)return;const o=xh(r,s.width,s.height);if(n)return;t.cancelable&&t.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const h=t.target.dataset.ord,i=!!h;let m=t.clientX,y=t.clientY,S=o.x,b=o.y;if(h){const T=t.clientX-s.x,A=t.clientY-s.y;let O=0,P=0;h==="ne"||h=="e"?(O=T-(o.x+o.width),P=A-o.y,S=o.x,b=o.y+o.height):h==="se"||h==="s"?(O=T-(o.x+o.width),P=A-(o.y+o.height),S=o.x,b=o.y):h==="sw"||h=="w"?(O=T-o.x,P=A-(o.y+o.height),S=o.x+o.width,b=o.y):(h==="nw"||h=="n")&&(O=T-o.x,P=A-o.y,S=o.x+o.width,b=o.y+o.height),m=S+s.x+O,y=b+s.y+P}this.evData={startClientX:m,startClientY:y,startCropX:S,startCropY:b,clientX:t.clientX,clientY:t.clientY,isResize:i,ord:h},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})}),Ea(this,"onComponentPointerDown",t=>{const{crop:r,disabled:n,locked:s,keepSelection:o,onChange:h}=this.props,i=this.getBox();if(n||s||o&&r)return;t.cancelable&&t.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const m=t.clientX-i.x,y=t.clientY-i.y,S={unit:"px",x:m,y,width:0,height:0};this.evData={startClientX:t.clientX,startClientY:t.clientY,startCropX:m,startCropY:y,clientX:t.clientX,clientY:t.clientY,isResize:!0},this.mouseDownOnCrop=!0,h(xh(S,i.width,i.height),Tm(S,i.width,i.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})}),Ea(this,"onDocPointerMove",t=>{const{crop:r,disabled:n,onChange:s,onDragStart:o}=this.props,h=this.getBox();if(n||!r||!this.mouseDownOnCrop)return;t.cancelable&&t.preventDefault(),this.dragStarted||(this.dragStarted=!0,o&&o(t));const{evData:i}=this;i.clientX=t.clientX,i.clientY=t.clientY;let m;i.isResize?m=this.resizeCrop():m=this.dragCrop(),wX(r,m)||s(xh(m,h.width,h.height),Tm(m,h.width,h.height))}),Ea(this,"onComponentKeyDown",t=>{const{crop:r,disabled:n,onChange:s,onComplete:o}=this.props;if(n)return;const h=t.key;let i=!1;if(!r)return;const m=this.getBox(),y=this.makePixelCrop(m),S=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?jd.nudgeStepLarge:t.shiftKey?jd.nudgeStepMedium:jd.nudgeStep;if(h==="ArrowLeft"?(y.x-=S,i=!0):h==="ArrowRight"?(y.x+=S,i=!0):h==="ArrowUp"?(y.y-=S,i=!0):h==="ArrowDown"&&(y.y+=S,i=!0),i){t.cancelable&&t.preventDefault(),y.x=Wx(y.x,0,m.width-y.width),y.y=Wx(y.y,0,m.height-y.height);const b=xh(y,m.width,m.height),T=Tm(y,m.width,m.height);s(b,T),o&&o(b,T)}}),Ea(this,"onHandlerKeyDown",(t,r)=>{const{aspect:n=0,crop:s,disabled:o,minWidth:h=0,minHeight:i=0,maxWidth:m,maxHeight:y,onChange:S,onComplete:b}=this.props,T=this.getBox();if(o||!s)return;if(t.key==="ArrowUp"||t.key==="ArrowDown"||t.key==="ArrowLeft"||t.key==="ArrowRight")t.stopPropagation(),t.preventDefault();else return;const A=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?jd.nudgeStepLarge:t.shiftKey?jd.nudgeStepMedium:jd.nudgeStep,O=xh(s,T.width,T.height),P=qnt(O,t.key,A,r),I=SX(P,n,r,T.width,T.height,h,i,m,y);if(!wX(s,I)){const R=Tm(I,T.width,T.height);S(I,R),b&&b(I,R)}}),Ea(this,"onDocPointerDone",t=>{const{crop:r,disabled:n,onComplete:s,onDragEnd:o}=this.props,h=this.getBox();this.unbindDocMove(),!(n||!r)&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,o&&o(t),s&&s(xh(r,h.width,h.height),Tm(r,h.width,h.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))}),Ea(this,"onDragFocus",()=>{var t;(t=this.componentRef.current)==null||t.scrollTo(0,0)})}get document(){return document}getBox(){const t=this.mediaRef.current;if(!t)return{x:0,y:0,width:0,height:0};const{x:r,y:n,width:s,height:o}=t.getBoundingClientRect();return{x:r,y:n,width:s,height:o}}componentDidUpdate(t){const{crop:r,onComplete:n}=this.props;if(n&&!t.crop&&r){const{width:s,height:o}=this.getBox();s&&o&&n(xh(r,s,o),Tm(r,s,o))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect(),this.unbindDocMove()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,Kx),this.document.addEventListener("pointerup",this.onDocPointerDone,Kx),this.document.addEventListener("pointercancel",this.onDocPointerDone,Kx),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,Kx),this.document.removeEventListener("pointerup",this.onDocPointerDone,Kx),this.document.removeEventListener("pointercancel",this.onDocPointerDone,Kx),this.docMoveBound=!1)}getCropStyle(){const{crop:t}=this.props;if(t)return{top:`${t.y}${t.unit}`,left:`${t.x}${t.unit}`,width:`${t.width}${t.unit}`,height:`${t.height}${t.unit}`}}dragCrop(){const{evData:t}=this,r=this.getBox(),n=this.makePixelCrop(r),s=t.clientX-t.startClientX,o=t.clientY-t.startClientY;return n.x=Wx(t.startCropX+s,0,r.width-n.width),n.y=Wx(t.startCropY+o,0,r.height-n.height),n}getPointRegion(t,r,n,s){const{evData:o}=this,h=o.clientX-t.x,i=o.clientY-t.y;let m;s&&r?m=r==="nw"||r==="n"||r==="ne":m=i<o.startCropY;let y;return n&&r?y=r==="nw"||r==="w"||r==="sw":y=h<o.startCropX,y?m?"nw":"sw":m?"ne":"se"}resolveMinDimensions(t,r,n=0,s=0){const o=Math.min(n,t.width),h=Math.min(s,t.height);return!r||!o&&!h?[o,h]:r>1?o?[o,o/r]:[h*r,h]:h?[h*r,h]:[o,o/r]}resizeCrop(){const{evData:t}=this,{aspect:r=0,maxWidth:n,maxHeight:s}=this.props,o=this.getBox(),[h,i]=this.resolveMinDimensions(o,r,this.props.minWidth,this.props.minHeight);let m=this.makePixelCrop(o);const y=this.getPointRegion(o,t.ord,h,i),S=t.ord||y;let b=t.clientX-t.startClientX,T=t.clientY-t.startClientY;(h&&S==="nw"||S==="w"||S==="sw")&&(b=Math.min(b,-h)),(i&&S==="nw"||S==="n"||S==="ne")&&(T=Math.min(T,-i));const A={unit:"px",x:0,y:0,width:0,height:0};y==="ne"?(A.x=t.startCropX,A.width=b,r?(A.height=A.width/r,A.y=t.startCropY-A.height):(A.height=Math.abs(T),A.y=t.startCropY-A.height)):y==="se"?(A.x=t.startCropX,A.y=t.startCropY,A.width=b,r?A.height=A.width/r:A.height=T):y==="sw"?(A.x=t.startCropX+b,A.y=t.startCropY,A.width=Math.abs(b),r?A.height=A.width/r:A.height=T):y==="nw"&&(A.x=t.startCropX+b,A.width=Math.abs(b),r?(A.height=A.width/r,A.y=t.startCropY-A.height):(A.height=Math.abs(T),A.y=t.startCropY+T));const O=SX(A,r,y,o.width,o.height,h,i,n,s);return r||jd.xyOrds.indexOf(S)>-1?m=O:jd.xOrds.indexOf(S)>-1?(m.x=O.x,m.width=O.width):jd.yOrds.indexOf(S)>-1&&(m.y=O.y,m.height=O.height),m.x=Wx(m.x,0,o.width-m.width),m.y=Wx(m.y,0,o.height-m.height),m}renderCropSelection(){const{ariaLabels:t=jd.defaultProps.ariaLabels,disabled:r,locked:n,renderSelectionAddon:s,ruleOfThirds:o,crop:h}=this.props,i=this.getCropStyle();if(h)return Ue.createElement("div",{style:i,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":t.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group"},!r&&!n&&Ue.createElement("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus},Ue.createElement("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),Ue.createElement("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),Ue.createElement("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),Ue.createElement("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),Ue.createElement("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":t.nwDragHandle,onKeyDown:m=>this.onHandlerKeyDown(m,"nw"),role:"button"}),Ue.createElement("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":t.nDragHandle,onKeyDown:m=>this.onHandlerKeyDown(m,"n"),role:"button"}),Ue.createElement("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":t.neDragHandle,onKeyDown:m=>this.onHandlerKeyDown(m,"ne"),role:"button"}),Ue.createElement("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":t.eDragHandle,onKeyDown:m=>this.onHandlerKeyDown(m,"e"),role:"button"}),Ue.createElement("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":t.seDragHandle,onKeyDown:m=>this.onHandlerKeyDown(m,"se"),role:"button"}),Ue.createElement("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":t.sDragHandle,onKeyDown:m=>this.onHandlerKeyDown(m,"s"),role:"button"}),Ue.createElement("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":t.swDragHandle,onKeyDown:m=>this.onHandlerKeyDown(m,"sw"),role:"button"}),Ue.createElement("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":t.wDragHandle,onKeyDown:m=>this.onHandlerKeyDown(m,"w"),role:"button"})),s&&Ue.createElement("div",{className:"ReactCrop__selection-addon",onPointerDown:m=>m.stopPropagation()},s(this.state)),o&&Ue.createElement(Ue.Fragment,null,Ue.createElement("div",{className:"ReactCrop__rule-of-thirds-hz"}),Ue.createElement("div",{className:"ReactCrop__rule-of-thirds-vt"})))}makePixelCrop(t){const r={...Nk,...this.props.crop||{}};return xh(r,t.width,t.height)}render(){const{aspect:t,children:r,circularCrop:n,className:s,crop:o,disabled:h,locked:i,style:m,ruleOfThirds:y}=this.props,{cropIsActive:S,newCropIsBeingDrawn:b}=this.state,T=o?this.renderCropSelection():null,A=$nt("ReactCrop",s,S&&"ReactCrop--active",h&&"ReactCrop--disabled",i&&"ReactCrop--locked",b&&"ReactCrop--new-crop",o&&t&&"ReactCrop--fixed-aspect",o&&n&&"ReactCrop--circular-crop",o&&y&&"ReactCrop--rule-of-thirds",!this.dragStarted&&o&&!o.width&&!o.height&&"ReactCrop--invisible-crop",n&&"ReactCrop--no-animate");return Ue.createElement("div",{ref:this.componentRef,className:A,style:m},Ue.createElement("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown},r),o?Ue.createElement("svg",{className:"ReactCrop__crop-mask",width:"100%",height:"100%"},Ue.createElement("defs",null,Ue.createElement("mask",{id:`hole-${this.instanceId}`},Ue.createElement("rect",{width:"100%",height:"100%",fill:"white"}),n?Ue.createElement("ellipse",{cx:`${o.x+o.width/2}${o.unit}`,cy:`${o.y+o.height/2}${o.unit}`,rx:`${o.width/2}${o.unit}`,ry:`${o.height/2}${o.unit}`,fill:"black"}):Ue.createElement("rect",{x:`${o.x}${o.unit}`,y:`${o.y}${o.unit}`,width:`${o.width}${o.unit}`,height:`${o.height}${o.unit}`,fill:"black"}))),Ue.createElement("rect",{fill:"black",fillOpacity:.5,width:"100%",height:"100%",mask:`url(#hole-${this.instanceId})`})):void 0,T)}};Ea(vm,"xOrds",["e","w"]),Ea(vm,"yOrds",["n","s"]),Ea(vm,"xyOrds",["nw","ne","se","sw"]),Ea(vm,"nudgeStep",1),Ea(vm,"nudgeStepMedium",10),Ea(vm,"nudgeStepLarge",100),Ea(vm,"defaultProps",{ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}});let Gnt=vm;const Wnt=Wv("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Ede=V.forwardRef(({className:e,variant:t,...r},n)=>d.jsx("div",{ref:n,role:"alert",className:fr(Wnt({variant:t}),e),...r}));Ede.displayName="Alert";const Knt=V.forwardRef(({className:e,...t},r)=>d.jsx("h5",{ref:r,className:fr("mb-1 font-medium leading-none tracking-tight",e),...t}));Knt.displayName="AlertTitle";const Tde=V.forwardRef(({className:e,...t},r)=>d.jsx("div",{ref:r,className:fr("text-sm [&_p]:leading-relaxed",e),...t}));Tde.displayName="AlertDescription";const Ade=1200,Cde=630,EX=Ade/Cde;function Znt(e,t,r){return Vnt(Unt({unit:"%",width:90},r,e,t),e,t)}function Xnt({open:e,onOpenChange:t,imageFile:r,onCropComplete:n}){const{t:s}=ci(),[o,h]=V.useState(""),[i,m]=V.useState(),[y,S]=V.useState(),b=V.useRef(null),[T,A]=V.useState(!1);V.useEffect(()=>{if(e&&r){const R=new FileReader;R.addEventListener("load",()=>{var M;h(((M=R.result)==null?void 0:M.toString())||"")}),R.readAsDataURL(r)}},[e,r]);const O=V.useCallback(R=>{const{width:M,height:F}=R.currentTarget;m(Znt(M,F,EX))},[]),P=V.useCallback(async(R,M)=>{const F=document.createElement("canvas"),z=F.getContext("2d");if(!z)throw new Error("No 2d context");const $=R.naturalWidth/R.width,W=R.naturalHeight/R.height;return F.width=M.width*$,F.height=M.height*W,z.imageSmoothingQuality="high",z.drawImage(R,M.x*$,M.y*W,M.width*$,M.height*W,0,0,F.width,F.height),new Promise((K,ee)=>{F.toBlob(ne=>{if(!ne){ee(new Error("Canvas is empty"));return}K(ne)},"image/jpeg",.95)})},[]),I=V.useCallback(async()=>{if(!(!y||!b.current)){A(!0);try{const R=await P(b.current,y),M=new File([R],r.name,{type:"image/jpeg"}),F=URL.createObjectURL(R);n(M,F),t(!1)}catch(R){console.error("Error cropping image:",R)}finally{A(!1)}}},[y,r,n,t,P]);return d.jsx(fl,{open:e,onOpenChange:t,children:d.jsxs(Jo,{className:"max-w-[95vw] sm:max-w-4xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[d.jsxs(Qo,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-4 border-b",children:[d.jsxs(el,{className:"text-lg sm:text-xl flex items-center gap-2",children:[d.jsx(T_e,{className:"w-5 h-5 text-primary"}),s("admin.cropImage")]}),d.jsx(Ul,{className:"text-xs sm:text-sm",children:s("admin.cropImageDescription")})]}),d.jsxs("div",{className:"px-4 sm:px-6 py-4 space-y-4 overflow-y-auto",children:[d.jsxs(Ede,{className:"border-primary/20 bg-primary/5",children:[d.jsx(j_e,{className:"h-4 w-4"}),d.jsxs(Tde,{className:"text-xs sm:text-sm",children:[d.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[d.jsxs("span",{className:"font-medium",children:[s("admin.recommendedSize"),":"]}),d.jsxs(sn,{variant:"secondary",className:"w-fit",children:[d.jsx(I_e,{className:"w-3 h-3 mr-1"}),Ade,"  ",Cde," px"]})]}),d.jsx("p",{className:"mt-2 text-muted-foreground text-xs",children:s("admin.imageSizeHint")})]})]}),d.jsx("div",{className:"relative w-full overflow-hidden rounded-lg border",children:o&&d.jsx(Gnt,{crop:i,onChange:R=>m(R),onComplete:R=>S(R),aspect:EX,className:"max-h-[50vh] sm:max-h-[60vh]",children:d.jsx("img",{ref:b,src:o,alt:"Crop preview",onLoad:O,className:"max-w-full h-auto"})})})]}),d.jsxs(Qv,{className:"px-4 sm:px-6 pb-4 sm:pb-6 pt-4 border-t gap-2 sm:gap-0",children:[d.jsx(Mt,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:T,className:"w-full sm:w-auto",children:s("common.cancel")}),d.jsx(Mt,{type:"button",onClick:I,disabled:!y||T,className:"w-full sm:w-auto",children:s(T?"common.processing":"admin.confirmCrop")})]})]})})}const Ynt=jh({title_en:bn().min(1,Pr.t("validation.titleRequired")),title_zh:bn().min(1,Pr.t("validation.titleRequired")),title_pt:bn().min(1,Pr.t("validation.titleRequired")),intro_zh:bn().optional(),intro_en:bn().optional(),intro_pt:bn().optional(),content_en:bn().min(1,Pr.t("validation.contentRequired")),content_zh:bn().min(1,Pr.t("validation.contentRequired")),content_pt:bn().min(1,Pr.t("validation.contentRequired")),usage_instructions_zh:bn().optional(),usage_instructions_en:bn().optional(),usage_instructions_pt:bn().optional(),start_date:JG(),end_date:JG().optional(),repeat_mode:ST(["none","daily","weekly","monthly","yearly"]),service_type:ST(["dine_in","takeaway","both"]),pinned:wT().default(!1),visible:wT().default(!0),sort_order:DF().default(0),badge_text_zh:bn().min(1,""),badge_text_en:bn().min(1,"Badge text (English) is required"),badge_text_pt:bn().min(1,"Texto do emblema (Portugus)  obrigatrio"),badge_color:bn().optional()});function TX({activity:e,trigger:t}){const{t:r}=ci(),{toast:n}=Ri(),s=Mi(),[o,h]=V.useState(!1),[i,m]=V.useState(null),[y,S]=V.useState((e==null?void 0:e.image_url)||null),[b,T]=V.useState([]),[A,O]=V.useState(!1),[P,I]=V.useState(!1),[R,M]=V.useState(null),{data:F}=P5(),{register:z,handleSubmit:$,formState:{errors:W},setValue:K,watch:ee,control:ne}=Ah({resolver:Ch(Ynt),defaultValues:e?{title_en:e.title_en,title_zh:e.title_zh,title_pt:e.title_pt,intro_zh:e.intro_zh||"",intro_en:e.intro_en||"",intro_pt:e.intro_pt||"",content_en:e.content_en,content_zh:e.content_zh,content_pt:e.content_pt,usage_instructions_zh:e.usage_instructions_zh||"",usage_instructions_en:e.usage_instructions_en||"",usage_instructions_pt:e.usage_instructions_pt||"",start_date:new Date(e.start_date),end_date:e.end_date?new Date(e.end_date):void 0,repeat_mode:e.repeat_mode||"none",service_type:e.service_type||"both",pinned:e.pinned||!1,visible:e.visible!==void 0?e.visible:!0,sort_order:e.sort_order||0,badge_text_zh:e.badge_text_zh||e.title_zh,badge_text_en:e.badge_text_en||e.title_en,badge_text_pt:e.badge_text_pt||e.title_pt,badge_color:e.badge_color||"#9b87f5"}:{repeat_mode:"none",service_type:"both",pinned:!1,visible:!0,sort_order:0,badge_color:"#9b87f5"}}),ie=ee("start_date"),re=ee("end_date"),te=ee("pinned"),ae=ee("visible");V.useEffect(()=>{(async()=>{if(e!=null&&e.id){const{data:me}=await Ct.from("activity_restaurants").select("restaurant_id").eq("activity_id",e.id);me&&T(me.map(Ae=>Ae.restaurant_id))}})()},[e==null?void 0:e.id]);const ue=_e=>{var Ae;const me=(Ae=_e.target.files)==null?void 0:Ae[0];if(me){if(me.size>10*1024*1024){n({title:r("common.error"),description:r("admin.imageTooBig"),variant:"destructive"});return}M(me),I(!0)}_e.target.value=""},be=(_e,me)=>{m(_e),S(me)},we=async()=>{if(!i)return(e==null?void 0:e.image_url)||null;const _e=i.name.split(".").pop(),Ae=`${`${Math.random()}.${_e}`}`,{error:ge}=await Ct.storage.from("activity-images").upload(Ae,i);if(ge)throw ge;const{data:{publicUrl:pe}}=Ct.storage.from("activity-images").getPublicUrl(Ae);return pe},Ce=async _e=>{var me;O(!0);try{const{data:{user:Ae}}=await Ct.auth.getUser();if(!Ae)throw new Error("Not authenticated");const ge=await we(),pe={title_en:_e.title_en,title_zh:_e.title_zh,title_pt:_e.title_pt,intro_zh:_e.intro_zh||null,intro_en:_e.intro_en||null,intro_pt:_e.intro_pt||null,content_en:_e.content_en,content_zh:_e.content_zh,content_pt:_e.content_pt,usage_instructions_zh:_e.usage_instructions_zh||null,usage_instructions_en:_e.usage_instructions_en||null,usage_instructions_pt:_e.usage_instructions_pt||null,repeat_mode:_e.repeat_mode,service_type:_e.service_type,pinned:_e.pinned,visible:_e.visible,sort_order:_e.sort_order,image_url:ge,creator_id:Ae.id,start_date:_e.start_date.toISOString(),end_date:((me=_e.end_date)==null?void 0:me.toISOString())||null,badge_text_zh:_e.badge_text_zh||null,badge_text_en:_e.badge_text_en||null,badge_text_pt:_e.badge_text_pt||null,badge_color:_e.badge_color||"#9b87f5"};if(e){const{error:Oe}=await Ct.from("activities").update(pe).eq("id",e.id);if(Oe)throw Oe;if(await Ct.from("activity_restaurants").delete().eq("activity_id",e.id),b.length>0){const Je=b.map(Pe=>({activity_id:e.id,restaurant_id:Pe})),{error:Ze}=await Ct.from("activity_restaurants").insert(Je);if(Ze)throw Ze}n({title:r("common.success"),description:r("admin.activityUpdated")})}else{const{data:Oe,error:Je}=await Ct.from("activities").insert([pe]).select().single();if(Je)throw Je;if(b.length>0){const Ze=b.map(Be=>({activity_id:Oe.id,restaurant_id:Be})),{error:Pe}=await Ct.from("activity_restaurants").insert(Ze);if(Pe)throw Pe}n({title:r("common.success"),description:r("admin.activityCreated")})}s.invalidateQueries({queryKey:["activities"]}),h(!1)}catch(Ae){n({title:r("common.error"),description:Ae.message,variant:"destructive"})}finally{O(!1)}};return d.jsxs(fl,{open:o,onOpenChange:h,children:[d.jsx(tf,{asChild:!0,children:t}),d.jsxs(Jo,{className:"max-w-[95vw] sm:max-w-6xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[d.jsxs(Qo,{className:"px-6 pt-6 pb-4 border-b bg-muted/30",children:[d.jsxs(el,{className:"text-2xl flex items-center gap-2",children:[d.jsx(fv,{className:"w-6 h-6 text-primary"}),r(e?"admin.editActivity":"admin.addActivity")]}),d.jsx(Ul,{className:"text-base",children:r(e?"admin.editActivityDetails":"admin.createActivityWithContent")})]}),d.jsx(jv,{className:"px-6 h-[calc(95vh-220px)]",children:d.jsxs("form",{onSubmit:$(Ce),className:"space-y-6 py-6",children:[d.jsx(Nr,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:d.jsxs(Mr,{className:"p-6",children:[d.jsxs(yr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[d.jsx(zh,{className:"w-5 h-5 text-primary"}),r("admin.activityImage")]}),d.jsxs("div",{className:"flex items-center gap-6",children:[y&&d.jsxs("div",{className:"relative group",children:[d.jsx("img",{src:y,alt:"Preview",className:"w-40 h-40 object-cover rounded-lg shadow-lg ring-2 ring-primary/20 transition-transform duration-200 group-hover:scale-105"}),d.jsx(Mt,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-8 w-8 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{m(null),S(null)},children:d.jsx(Xc,{className:"h-4 w-4"})})]}),d.jsxs(yr,{htmlFor:"image-upload",className:"cursor-pointer",children:[d.jsxs("div",{className:"flex flex-col items-center gap-3 px-8 py-6 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[d.jsx(zh,{className:"h-8 w-8 text-primary"}),d.jsxs("div",{className:"text-center",children:[d.jsx("p",{className:"font-medium text-sm",children:r("admin.uploadImage")}),d.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r("admin.imageMaxSize")})]})]}),d.jsx(cr,{id:"image-upload",type:"file",accept:"image/*",className:"hidden",onChange:ue})]})]})]})}),d.jsx(Nr,{className:"border-primary/20",children:d.jsxs(Mr,{className:"p-6",children:[d.jsxs(yr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[d.jsx(fv,{className:"w-5 h-5 text-primary"}),r("admin.multilingualContent")]}),d.jsxs(Mv,{defaultValue:"zh",className:"w-full",children:[d.jsxs(pg,{className:"grid w-full grid-cols-3 mb-6",children:[d.jsxs(Ca,{value:"zh",className:"gap-2",children:[" ",r("admin.chinese")]}),d.jsxs(Ca,{value:"en",className:"gap-2",children:[" ",r("admin.english")]}),d.jsxs(Ca,{value:"pt",className:"gap-2",children:[" ",r("admin.portuguese")]})]}),d.jsxs(ja,{value:"zh",className:"space-y-4 mt-0",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"title_zh",className:"text-sm font-medium",children:r("admin.title")}),d.jsx(cr,{id:"title_zh",...z("title_zh"),placeholder:r("admin.enterTitle"),className:"text-base"}),W.title_zh&&d.jsx("p",{className:"text-sm text-destructive",children:W.title_zh.message})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"intro_zh",className:"text-sm font-medium",children:""}),d.jsx(cr,{id:"intro_zh",...z("intro_zh"),placeholder:"",className:"text-base"}),d.jsx("p",{className:"text-xs text-muted-foreground",children:""})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"content_zh",className:"text-sm font-medium",children:r("admin.content")}),d.jsx(ym,{name:"content_zh",control:ne,render:({field:_e})=>d.jsx(Lf,{value:_e.value,onChange:_e.onChange,placeholder:r("admin.enterContent")})}),W.content_zh&&d.jsx("p",{className:"text-sm text-destructive",children:W.content_zh.message})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"usage_instructions_zh",className:"text-sm font-medium",children:""}),d.jsx(ym,{name:"usage_instructions_zh",control:ne,render:({field:_e})=>d.jsx(Lf,{value:_e.value||"",onChange:_e.onChange,placeholder:""})}),d.jsx("p",{className:"text-xs text-muted-foreground",children:""})]})]}),d.jsxs(ja,{value:"en",className:"space-y-4 mt-0",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"title_en",className:"text-sm font-medium",children:r("admin.title")}),d.jsx(cr,{id:"title_en",...z("title_en"),placeholder:r("admin.enterTitle"),className:"text-base"}),W.title_en&&d.jsx("p",{className:"text-sm text-destructive",children:W.title_en.message})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"intro_en",className:"text-sm font-medium",children:"Activity Brief"}),d.jsx(cr,{id:"intro_en",...z("intro_en"),placeholder:"Short description (shown on restaurant details)",className:"text-base"}),d.jsx("p",{className:"text-xs text-muted-foreground",children:"Brief description shown after activity badge on restaurant page"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"content_en",className:"text-sm font-medium",children:r("admin.content")}),d.jsx(ym,{name:"content_en",control:ne,render:({field:_e})=>d.jsx(Lf,{value:_e.value,onChange:_e.onChange,placeholder:r("admin.enterContent")})}),W.content_en&&d.jsx("p",{className:"text-sm text-destructive",children:W.content_en.message})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"usage_instructions_en",className:"text-sm font-medium",children:"Usage Instructions"}),d.jsx(ym,{name:"usage_instructions_en",control:ne,render:({field:_e})=>d.jsx(Lf,{value:_e.value||"",onChange:_e.onChange,placeholder:"Describe how to use this activity (optional)"})}),d.jsx("p",{className:"text-xs text-muted-foreground",children:"Explain to users how to participate and use this activity"})]})]}),d.jsxs(ja,{value:"pt",className:"space-y-4 mt-0",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"title_pt",className:"text-sm font-medium",children:r("admin.title")}),d.jsx(cr,{id:"title_pt",...z("title_pt"),placeholder:r("admin.enterTitle"),className:"text-base"}),W.title_pt&&d.jsx("p",{className:"text-sm text-destructive",children:W.title_pt.message})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"intro_pt",className:"text-sm font-medium",children:"Resumo da Atividade"}),d.jsx(cr,{id:"intro_pt",...z("intro_pt"),placeholder:"Descrio curta (exibida nos detalhes do restaurante)",className:"text-base"}),d.jsx("p",{className:"text-xs text-muted-foreground",children:"Breve descrio exibida aps o distintivo da atividade na pgina do restaurante"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"content_pt",className:"text-sm font-medium",children:r("admin.content")}),d.jsx(ym,{name:"content_pt",control:ne,render:({field:_e})=>d.jsx(Lf,{value:_e.value,onChange:_e.onChange,placeholder:r("admin.enterContent")})}),W.content_pt&&d.jsx("p",{className:"text-sm text-destructive",children:W.content_pt.message})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"usage_instructions_pt",className:"text-sm font-medium",children:"Instrues de Uso"}),d.jsx(ym,{name:"usage_instructions_pt",control:ne,render:({field:_e})=>d.jsx(Lf,{value:_e.value||"",onChange:_e.onChange,placeholder:"Descreva como usar esta atividade (opcional)"})}),d.jsx("p",{className:"text-xs text-muted-foreground",children:"Explique aos usurios como participar e usar esta atividade"})]})]})]})]})}),d.jsx(Nr,{className:"border-primary/20",children:d.jsxs(Mr,{className:"p-6 space-y-6",children:[d.jsxs("div",{children:[d.jsxs(yr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[d.jsx(yo,{className:"w-5 h-5 text-primary"}),r("admin.dateSettings")]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{className:"text-sm font-medium",children:r("admin.startDate")}),d.jsxs(_T,{children:[d.jsx(xT,{asChild:!0,children:d.jsxs(Mt,{variant:"outline",className:fr("w-full justify-start text-left font-normal h-11",!ie&&"text-muted-foreground"),children:[d.jsx(yo,{className:"mr-2 h-4 w-4"}),ie?ps(ie,"PPP"):d.jsx("span",{children:r("admin.selectDate")})]})}),d.jsx(mb,{className:"w-auto p-0 z-[100]",align:"start",children:d.jsx(v4,{mode:"single",selected:ie,onSelect:_e=>K("start_date",_e),initialFocus:!0,className:"pointer-events-auto"})})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{className:"text-sm font-medium",children:r("admin.endDate")}),d.jsxs(_T,{children:[d.jsx(xT,{asChild:!0,children:d.jsxs(Mt,{variant:"outline",className:fr("w-full justify-start text-left font-normal h-11",!re&&"text-muted-foreground"),children:[d.jsx(yo,{className:"mr-2 h-4 w-4"}),re?ps(re,"PPP"):d.jsxs("span",{children:[r("admin.selectDate")," (",r("admin.optional"),")"]})]})}),d.jsx(mb,{className:"w-auto p-0 z-[100]",align:"start",children:d.jsx(v4,{mode:"single",selected:re,onSelect:_e=>K("end_date",_e),initialFocus:!0,className:"pointer-events-auto"})})]})]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"repeat_mode",className:"text-sm font-medium",children:r("admin.repeatMode")}),d.jsxs(Qs,{onValueChange:_e=>K("repeat_mode",_e),defaultValue:ee("repeat_mode"),children:[d.jsx(Gs,{className:"h-11",children:d.jsx(ea,{placeholder:r("admin.selectRepeatMode")})}),d.jsxs(Ws,{children:[d.jsx(nn,{value:"none",children:r("admin.repeatNone")}),d.jsx(nn,{value:"daily",children:r("admin.repeatDaily")}),d.jsx(nn,{value:"weekly",children:r("admin.repeatWeekly")}),d.jsx(nn,{value:"monthly",children:r("admin.repeatMonthly")}),d.jsx(nn,{value:"yearly",children:r("admin.repeatYearly")})]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{htmlFor:"service_type",className:"text-sm font-medium",children:r("admin.serviceType")}),d.jsxs(Qs,{onValueChange:_e=>K("service_type",_e),defaultValue:ee("service_type"),children:[d.jsx(Gs,{className:"h-11",children:d.jsx(ea,{placeholder:r("admin.selectServiceType")})}),d.jsxs(Ws,{children:[d.jsx(nn,{value:"dine_in",children:r("activities.serviceType.dine_in")}),d.jsx(nn,{value:"takeaway",children:r("activities.serviceType.takeaway")}),d.jsx(nn,{value:"both",children:r("activities.serviceType.both")})]})]})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[d.jsxs("div",{className:"flex items-center space-x-3 p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[d.jsx(Yo,{id:"pinned",checked:te,onCheckedChange:_e=>K("pinned",_e),className:"data-[state=checked]:bg-primary"}),d.jsxs(yr,{htmlFor:"pinned",className:"cursor-pointer flex items-center gap-2 text-sm font-medium",children:[d.jsx(F_e,{className:"w-4 h-4 text-primary"}),r("admin.pinToTop")]})]}),d.jsxs("div",{className:"flex items-center space-x-3 p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[d.jsx(Yo,{id:"visible",checked:ae,onCheckedChange:_e=>K("visible",_e),className:"data-[state=checked]:bg-primary"}),d.jsxs(yr,{htmlFor:"visible",className:"cursor-pointer flex items-center gap-2 text-sm font-medium",children:[d.jsx(fv,{className:"w-4 h-4 text-primary"}),""]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs(yr,{htmlFor:"sort_order",className:"text-sm font-medium flex items-center gap-2",children:[d.jsx(p_e,{className:"w-4 h-4 text-primary"}),r("admin.sortOrder")]}),d.jsx(cr,{id:"sort_order",type:"number",...z("sort_order",{valueAsNumber:!0}),className:"h-11",placeholder:"0"})]})]})]})}),d.jsx(Nr,{className:"border-primary/20",children:d.jsxs(Mr,{className:"p-6",children:[d.jsxs(yr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[d.jsx(sn,{className:"w-5 h-5 text-primary"}),""]}),d.jsxs(Mv,{defaultValue:"zh",className:"w-full",children:[d.jsxs(pg,{className:"grid w-full grid-cols-3 mb-4",children:[d.jsx(Ca,{value:"zh",children:" "}),d.jsx(Ca,{value:"en",children:" English"}),d.jsx(Ca,{value:"pt",children:" Portugus"})]}),d.jsx(ja,{value:"zh",className:"space-y-3",children:d.jsxs("div",{className:"space-y-2",children:[d.jsxs(yr,{htmlFor:"badge_text_zh",className:"text-sm",children:[" () ",d.jsx("span",{className:"text-destructive",children:"*"})]}),d.jsx(cr,{id:"badge_text_zh",...z("badge_text_zh"),placeholder:": "}),W.badge_text_zh&&d.jsx("p",{className:"text-sm text-destructive",children:W.badge_text_zh.message}),d.jsx("p",{className:"text-xs text-muted-foreground",children:""})]})}),d.jsx(ja,{value:"en",className:"space-y-3",children:d.jsxs("div",{className:"space-y-2",children:[d.jsxs(yr,{htmlFor:"badge_text_en",className:"text-sm",children:["Badge Text (English) ",d.jsx("span",{className:"text-destructive",children:"*"})]}),d.jsx(cr,{id:"badge_text_en",...z("badge_text_en"),placeholder:"e.g. Fan Festival"}),W.badge_text_en&&d.jsx("p",{className:"text-sm text-destructive",children:W.badge_text_en.message}),d.jsx("p",{className:"text-xs text-muted-foreground",children:"Badge text shown on restaurant details and activity list, keep it concise"})]})}),d.jsx(ja,{value:"pt",className:"space-y-3",children:d.jsxs("div",{className:"space-y-2",children:[d.jsxs(yr,{htmlFor:"badge_text_pt",className:"text-sm",children:["Texto do Distintivo (Portugus) ",d.jsx("span",{className:"text-destructive",children:"*"})]}),d.jsx(cr,{id:"badge_text_pt",...z("badge_text_pt"),placeholder:"ex: Festival dos Fs"}),W.badge_text_pt&&d.jsx("p",{className:"text-sm text-destructive",children:W.badge_text_pt.message}),d.jsx("p",{className:"text-xs text-muted-foreground",children:"Texto do emblema exibido nos detalhes do restaurante e na lista de atividades, mantenha-o conciso"})]})})]}),d.jsxs("div",{className:"space-y-2 mt-4",children:[d.jsx(yr,{htmlFor:"badge_color",className:"text-sm",children:" / Badge Color"}),d.jsx(ym,{name:"badge_color",control:ne,render:({field:_e})=>d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(cr,{id:"badge_color",type:"color",value:_e.value||"#9b87f5",onChange:me=>_e.onChange(me.target.value),className:"w-20 h-11 cursor-pointer"}),d.jsx(cr,{value:_e.value||"#9b87f5",onChange:me=>_e.onChange(me.target.value),placeholder:"#9b87f5",className:"flex-1"})]})}),d.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[d.jsx("span",{className:"text-xs text-muted-foreground",children:" / Preview:"}),d.jsx(sn,{style:{backgroundColor:ee("badge_color")||"#9b87f5"},className:"text-white",children:ee("badge_text_zh")||ee("title_zh")||""})]})]})]})}),d.jsx(Nr,{className:"border-primary/20",children:d.jsxs(Mr,{className:"p-6",children:[d.jsxs(yr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[d.jsx(Io,{className:"w-5 h-5 text-primary"}),r("admin.associatedRestaurants")]}),d.jsx(jv,{className:"h-64 border rounded-lg p-4 bg-muted/20",children:d.jsx("div",{className:"space-y-2",children:F==null?void 0:F.map(_e=>d.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-md hover:bg-background transition-colors border border-transparent hover:border-primary/30",children:[d.jsx(Yo,{id:_e.id,checked:b.includes(_e.id),onCheckedChange:me=>{T(me?[...b,_e.id]:b.filter(Ae=>Ae!==_e.id))},className:"data-[state=checked]:bg-primary"}),d.jsx(yr,{htmlFor:_e.id,className:"cursor-pointer flex-1 font-normal",children:_e.name}),b.includes(_e.id)&&d.jsx(sn,{variant:"secondary",className:"text-xs",children:""})]},_e.id))})}),d.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[" ",b.length," "]})]})}),d.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t sticky bottom-0 bg-background pb-[16px]",children:[d.jsx(Mt,{type:"button",variant:"outline",onClick:()=>h(!1),className:"min-w-[100px]",children:r("common.cancel")}),d.jsx(Mt,{type:"submit",disabled:A,className:"min-w-[100px] bg-primary hover:bg-primary/90",children:A?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"..."]}):r("common.save")})]})]})}),R&&d.jsx(Xnt,{open:P,onOpenChange:I,imageFile:R,onCropComplete:be})]})]})}const Jnt=({children:e})=>{const{t}=ci(),{data:r,isLoading:n}=X5(),s=lNe(),[o,h]=V.useState(!1),[i,m]=V.useState("zh"),[y,S]=V.useState(""),[b,T]=V.useState(""),[A,O]=V.useState("");V.useEffect(()=>{r&&(S(r.content_zh),T(r.content_en),O(r.content_pt))},[r]);const P=async()=>{if(r)try{await s.mutateAsync({id:r.id,content_zh:y,content_en:b,content_pt:A}),Po({title:t("common.success"),description:""}),h(!1)}catch{Po({title:t("common.error"),description:"",variant:"destructive"})}};return d.jsxs(fl,{open:o,onOpenChange:h,children:[d.jsx(tf,{asChild:!0,children:e}),d.jsxs(Jo,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[d.jsx(Qo,{children:d.jsxs(el,{className:"flex items-center gap-2",children:[d.jsx(rb,{className:"w-5 h-5"}),""]})}),n?d.jsx("div",{className:"flex justify-center py-8",children:d.jsx(_a,{className:"w-6 h-6 animate-spin text-primary"})}):d.jsx("div",{className:"space-y-4",children:d.jsxs(Mv,{value:i,onValueChange:m,children:[d.jsxs(pg,{className:"grid w-full grid-cols-3",children:[d.jsx(Ca,{value:"zh",children:""}),d.jsx(Ca,{value:"en",children:"English"}),d.jsx(Ca,{value:"pt",children:"Portugus"})]}),d.jsx(ja,{value:"zh",className:"mt-4",children:d.jsx(Lf,{value:y,onChange:S,placeholder:"..."})}),d.jsx(ja,{value:"en",className:"mt-4",children:d.jsx(Lf,{value:b,onChange:T,placeholder:"Enter English activity rules..."})}),d.jsx(ja,{value:"pt",className:"mt-4",children:d.jsx(Lf,{value:A,onChange:O,placeholder:"Digite as regras da atividade em portugus..."})})]})}),d.jsxs(Qv,{children:[d.jsx(Mt,{variant:"outline",onClick:()=>h(!1),children:t("common.cancel")}),d.jsxs(Mt,{onClick:P,disabled:s.isPending,children:[s.isPending?d.jsx(_a,{className:"w-4 h-4 mr-2 animate-spin"}):d.jsx(P3,{className:"w-4 h-4 mr-2"}),t("common.save")]})]})]})]})},Qnt=()=>{const{t:e}=ci(),{toast:t}=Ri(),{data:r,isLoading:n}=RN(),{getLocalizedField:s}=xc(),o=DIe(),h=BIe(),[i,m]=V.useState([]),[y,S]=V.useState(""),[b,T]=V.useState("all"),[A,O]=V.useState({}),[P,I]=V.useState(""),R=V.useMemo(()=>r?r.filter(W=>{const K=String(s(W,"title")||""),ee=String(s(W,"content")||""),ne=y===""||K.toLowerCase().includes(y.toLowerCase())||ee.toLowerCase().includes(y.toLowerCase()),ie=new Date,re=new Date(W.start_date),te=W.end_date?new Date(W.end_date):null,ae=te?te<ie:!1,ue=!ae&&re<=ie,be=b==="all"||b==="active"&&ue||b==="ended"&&ae||b==="pinned"&&W.pinned;return ne&&be}):[],[r,y,b,s]),M=()=>{if(!r||r.length===0){t({title:e("common.error"),description:e("admin.noDataToExport"),variant:"destructive"});return}Xtt(r),t({title:e("common.success"),description:e("admin.exportSuccess")})},F=W=>{m(K=>K.includes(W)?K.filter(ee=>ee!==W):[...K,W])},z=()=>{i.length===(R==null?void 0:R.length)?m([]):m((R==null?void 0:R.map(W=>W.id))||[])},$=()=>{i.length!==0&&(h.mutate(i),m([]))};return n?d.jsx(xo,{children:d.jsx("div",{className:"text-center",children:e("common.loading")})}):d.jsx(xo,{children:d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:e("admin.activityManagement")}),d.jsx("p",{className:"text-muted-foreground",children:e("admin.manageActivities")})]}),d.jsxs("div",{className:"flex gap-2 flex-wrap",children:[d.jsx(Jnt,{children:d.jsxs(Mt,{variant:"outline",className:"flex-1 sm:flex-initial",children:[d.jsx(rb,{className:"mr-2 h-4 w-4"}),d.jsx("span",{className:"hidden sm:inline",children:""})]})}),d.jsxs(Mt,{variant:"outline",onClick:M,className:"flex-1 sm:flex-initial",children:[d.jsx(tN,{className:"mr-2 h-4 w-4"}),d.jsx("span",{className:"hidden sm:inline",children:e("admin.exportCSV")})]}),d.jsx(TX,{trigger:d.jsxs(Mt,{className:"flex-1 sm:flex-initial",children:[d.jsx(sp,{className:"mr-2 h-4 w-4"}),e("admin.addActivity")]})})]})]}),d.jsx(Nr,{children:d.jsx(Mr,{className:"pt-6",children:d.jsxs("div",{className:"flex gap-4 flex-wrap",children:[d.jsx("div",{className:"flex-1 min-w-[200px]",children:d.jsxs("div",{className:"relative",children:[d.jsx(Xh,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),d.jsx(cr,{placeholder:e("admin.searchActivities"),value:y,onChange:W=>S(W.target.value),className:"pl-9"})]})}),d.jsxs(Qs,{value:b,onValueChange:T,children:[d.jsx(Gs,{className:"w-[180px]",children:d.jsx(ea,{placeholder:e("admin.filterByStatus")})}),d.jsxs(Ws,{children:[d.jsx(nn,{value:"all",children:e("admin.allStatus")}),d.jsx(nn,{value:"active",children:e("admin.statusActive")}),d.jsx(nn,{value:"ended",children:e("admin.statusEnded")}),d.jsx(nn,{value:"pinned",children:e("admin.statusPinned")})]})]})]})})}),i.length>0&&d.jsx(Nr,{className:"bg-muted/50",children:d.jsx(Mr,{className:"pt-6",children:d.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[d.jsx("span",{className:"font-medium",children:e("admin.selectedCount",{count:i.length})}),d.jsxs("div",{className:"flex gap-2 flex-wrap w-full sm:w-auto",children:[d.jsxs(ko,{children:[d.jsx(gb,{asChild:!0,children:d.jsxs(Mt,{variant:"destructive",size:"sm",className:"flex-1 sm:flex-initial",children:[d.jsx(Yh,{className:"mr-2 h-4 w-4"}),e("admin.batchDelete")]})}),d.jsxs(co,{className:"max-w-[90vw] sm:max-w-[425px]",children:[d.jsxs(uo,{children:[d.jsx(fo,{children:e("admin.confirmBatchDelete")}),d.jsxs(po,{className:"space-y-3",children:[d.jsx("p",{children:e("admin.batchDeleteWarning",{count:i.length})}),d.jsxs("p",{className:"font-semibold text-destructive",children:[" ",i.length," "]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("p",{className:"text-sm",children:[" ",d.jsx("span",{className:"font-mono font-bold text-destructive",children:"DELETE"})," "]}),d.jsx(cr,{value:P,onChange:W=>I(W.target.value),placeholder:"DELETE",className:"font-mono"})]})]})]}),d.jsxs(ho,{children:[d.jsx(mo,{onClick:()=>I(""),children:e("common.cancel")}),d.jsx(to,{disabled:P!=="DELETE",onClick:()=>{$(),I("")},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:e("common.delete")})]})]})]}),d.jsx(Mt,{variant:"outline",size:"sm",onClick:()=>m([]),className:"flex-1 sm:flex-initial",children:e("admin.clearSelection")})]})]})})}),d.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[d.jsx(Yo,{checked:i.length===(R==null?void 0:R.length)&&R.length>0,onCheckedChange:z}),d.jsx("span",{className:"font-medium",children:e("admin.selectAll")}),d.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:["(",R==null?void 0:R.length," ",e("admin.results"),")"]})]}),d.jsx("div",{className:"grid gap-4",children:R==null?void 0:R.map(W=>d.jsx(Nr,{children:d.jsxs("div",{className:"flex flex-col md:flex-row",children:[d.jsx("div",{className:"p-4 flex items-start",children:d.jsx(Yo,{checked:i.includes(W.id),onCheckedChange:()=>F(W.id),className:"mt-1"})}),W.image_url&&d.jsx("div",{className:"w-full md:w-48 h-48",children:d.jsx("img",{src:W.image_url,alt:String(s(W,"title")),className:"object-cover w-full h-full"})}),d.jsxs("div",{className:"flex-1",children:[d.jsxs(Rn,{children:[d.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[d.jsx($n,{className:"text-lg md:text-xl",children:s(W,"title")}),d.jsxs("div",{className:"flex gap-2 flex-wrap",children:[!W.visible&&d.jsx(sn,{variant:"secondary",children:""}),W.pinned&&d.jsx(sn,{children:e("activities.pinned")}),(()=>{const K=new Date,ee=new Date(W.start_date),ne=W.end_date?new Date(W.end_date):null,ie=ne?ne<K:!1,re=!ie&&ee<=K;return ie?d.jsx(sn,{variant:"secondary",children:e("activities.ended")}):re?d.jsx(sn,{children:e("activities.ongoing")}):null})()]})]}),d.jsx(as,{className:"line-clamp-2",children:d.jsx("div",{className:`prose prose-sm max-w-none\r
                          [&_p]:inline [&_p]:m-0\r
                          [&_strong]:font-semibold [&_strong]:text-foreground\r
                          [&_em]:italic\r
                          [&_h1]:text-base [&_h2]:text-base [&_h3]:text-base\r
                          [&_*]:text-muted-foreground`,dangerouslySetInnerHTML:{__html:s(W,"content")}})})]}),d.jsxs(Mr,{children:[d.jsx("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-4 overflow-x-auto",children:d.jsxs("div",{className:"flex items-center gap-1 whitespace-nowrap",children:[d.jsx(yo,{className:"h-4 w-4 flex-shrink-0"}),d.jsxs("span",{className:"text-xs sm:text-sm",children:[ps(new Date(W.start_date),"PPP"),W.end_date&&` - ${ps(new Date(W.end_date),"PPP")}`]})]})}),d.jsxs("div",{className:"flex gap-2 flex-wrap",children:[d.jsx(Mt,{variant:"outline",size:"sm",asChild:!0,className:"flex-1 sm:flex-initial",children:d.jsx(ji,{to:`/activity/${W.id}`,state:{from:"admin"},children:e("admin.view")})}),d.jsx(TX,{activity:W,trigger:d.jsx(Mt,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:e("common.edit")})}),d.jsxs(ko,{children:[d.jsx(gb,{asChild:!0,children:d.jsx(Mt,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:e("common.delete")})}),d.jsxs(co,{className:"max-w-[90vw] sm:max-w-[425px]",children:[d.jsxs(uo,{children:[d.jsx(fo,{children:e("admin.confirmDelete")}),d.jsxs(po,{className:"space-y-3",children:[d.jsx("p",{children:e("admin.deleteActivityWarning")}),d.jsx("p",{className:"font-semibold text-foreground",children:s(W,"title")}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("p",{className:"text-sm",children:[" ",d.jsx("span",{className:"font-mono font-bold text-destructive",children:"DELETE"})," "]}),d.jsx(cr,{value:A[W.id]||"",onChange:K=>O({...A,[W.id]:K.target.value}),placeholder:"DELETE",className:"font-mono"})]})]})]}),d.jsxs(ho,{children:[d.jsx(mo,{onClick:()=>O({...A,[W.id]:""}),children:e("common.cancel")}),d.jsx(to,{disabled:A[W.id]!=="DELETE",onClick:()=>{o.mutate(W.id),O({...A,[W.id]:""})},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:e("common.delete")})]})]})]})]})]})]})]})},W.id))})]})})},eit=()=>{const{t:e}=ci(),{data:t,isLoading:r}=jIe(),[n,s]=V.useState(new Set),o=i=>{s(m=>{const y=new Set(m);return y.has(i)?y.delete(i):y.add(i),y})};if(r)return d.jsx(xo,{children:d.jsx("div",{className:"text-center",children:e("common.loading")})});const h=i=>({INSERT:"default",UPDATE:"secondary",DELETE:"destructive"})[i]||"secondary";return d.jsx(xo,{children:d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold mb-2",children:e("admin.operationLogs")}),d.jsx("p",{className:"text-muted-foreground",children:e("admin.viewSystemLogs")})]}),t&&t.length>0?d.jsx("div",{className:"space-y-4",children:t.map(i=>{const m=n.has(i.id),y=i.old_data||i.new_data;return d.jsxs(Nr,{children:[d.jsx(Rn,{className:"pb-3",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs($n,{className:"text-base",children:[i.user_name," - ",i.table_name]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(sn,{variant:h(i.action),children:i.action}),d.jsx("span",{className:"text-xs text-muted-foreground",children:wg(new Date(i.created_at),{addSuffix:!0})})]})]})}),y&&d.jsx(Mr,{className:"pt-0",children:d.jsxs(d0,{open:m,onOpenChange:()=>o(i.id),children:[d.jsx(h0,{asChild:!0,children:d.jsxs(Mt,{variant:"ghost",size:"sm",className:"w-full justify-start gap-2 text-muted-foreground hover:text-foreground",children:[m?d.jsx(Vf,{className:"h-4 w-4"}):d.jsx(Qk,{className:"h-4 w-4"}),e(m?"common.hideDetails":"common.showDetails")]})}),d.jsx(f0,{className:"mt-3",children:d.jsxs("div",{className:"grid gap-3 text-sm",children:[i.old_data&&d.jsxs("div",{children:[d.jsxs("span",{className:"font-semibold text-destructive",children:[e("admin.oldData"),":"]}),d.jsx("pre",{className:"mt-1 p-3 bg-destructive/10 border border-destructive/20 rounded text-xs overflow-auto max-h-64",children:JSON.stringify(i.old_data,null,2)})]}),i.new_data&&d.jsxs("div",{children:[d.jsxs("span",{className:"font-semibold text-primary",children:[e("admin.newData"),":"]}),d.jsx("pre",{className:"mt-1 p-3 bg-primary/10 border border-primary/20 rounded text-xs overflow-auto max-h-64",children:JSON.stringify(i.new_data,null,2)})]})]})})]})})]},i.id)})}):d.jsx(Nr,{children:d.jsx(Mr,{className:"py-12 text-center text-muted-foreground",children:e("admin.noLogs")})})]})})};var jde=["PageUp","PageDown"],Pde=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Ode={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Aw="Slider",[_4,tit,rit]=_2(Aw),[kde,gst]=Mo(Aw,[rit]),[nit,VI]=kde(Aw),Nde=V.forwardRef((e,t)=>{const{name:r,min:n=0,max:s=100,step:o=1,orientation:h="horizontal",disabled:i=!1,minStepsBetweenThumbs:m=0,defaultValue:y=[n],value:S,onValueChange:b=()=>{},onValueCommit:T=()=>{},inverted:A=!1,form:O,...P}=e,I=V.useRef(new Set),R=V.useRef(0),F=h==="horizontal"?iit:sit,[z=[],$]=Zc({prop:S,defaultProp:y,onChange:re=>{var ae;(ae=[...I.current][R.current])==null||ae.focus(),b(re)}}),W=V.useRef(z);function K(re){const te=uit(z,re);ie(re,te)}function ee(re){ie(re,R.current)}function ne(){const re=W.current[R.current];z[R.current]!==re&&T(z)}function ie(re,te,{commit:ae}={commit:!1}){const ue=pit(o),be=mit(Math.round((re-n)/o)*o+n,ue),we=vT(be,[n,s]);$((Ce=[])=>{const _e=lit(Ce,we,te);if(fit(_e,m*o)){R.current=_e.indexOf(we);const me=String(_e)!==String(Ce);return me&&ae&&T(_e),me?_e:Ce}else return Ce})}return d.jsx(nit,{scope:e.__scopeSlider,name:r,disabled:i,min:n,max:s,valueIndexToChangeRef:R,thumbs:I.current,values:z,orientation:h,form:O,children:d.jsx(_4.Provider,{scope:e.__scopeSlider,children:d.jsx(_4.Slot,{scope:e.__scopeSlider,children:d.jsx(F,{"aria-disabled":i,"data-disabled":i?"":void 0,...P,ref:t,onPointerDown:Ir(P.onPointerDown,()=>{i||(W.current=z)}),min:n,max:s,inverted:A,onSlideStart:i?void 0:K,onSlideMove:i?void 0:ee,onSlideEnd:i?void 0:ne,onHomeKeyDown:()=>!i&&ie(n,0,{commit:!0}),onEndKeyDown:()=>!i&&ie(s,z.length-1,{commit:!0}),onStepKeyDown:({event:re,direction:te})=>{if(!i){const be=jde.includes(re.key)||re.shiftKey&&Pde.includes(re.key)?10:1,we=R.current,Ce=z[we],_e=o*be*te;ie(Ce+_e,we,{commit:!0})}}})})})})});Nde.displayName=Aw;var[Ide,Rde]=kde(Aw,{startEdge:"left",endEdge:"right",size:"width",direction:1}),iit=V.forwardRef((e,t)=>{const{min:r,max:n,dir:s,inverted:o,onSlideStart:h,onSlideMove:i,onSlideEnd:m,onStepKeyDown:y,...S}=e,[b,T]=V.useState(null),A=Un(t,F=>T(F)),O=V.useRef(void 0),P=Zv(s),I=P==="ltr",R=I&&!o||!I&&o;function M(F){const z=O.current||b.getBoundingClientRect(),$=[0,z.width],K=_U($,R?[r,n]:[n,r]);return O.current=z,K(F-z.left)}return d.jsx(Ide,{scope:e.__scopeSlider,startEdge:R?"left":"right",endEdge:R?"right":"left",direction:R?1:-1,size:"width",children:d.jsx(Mde,{dir:P,"data-orientation":"horizontal",...S,ref:A,style:{...S.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:F=>{const z=M(F.clientX);h==null||h(z)},onSlideMove:F=>{const z=M(F.clientX);i==null||i(z)},onSlideEnd:()=>{O.current=void 0,m==null||m()},onStepKeyDown:F=>{const $=Ode[R?"from-left":"from-right"].includes(F.key);y==null||y({event:F,direction:$?-1:1})}})})}),sit=V.forwardRef((e,t)=>{const{min:r,max:n,inverted:s,onSlideStart:o,onSlideMove:h,onSlideEnd:i,onStepKeyDown:m,...y}=e,S=V.useRef(null),b=Un(t,S),T=V.useRef(void 0),A=!s;function O(P){const I=T.current||S.current.getBoundingClientRect(),R=[0,I.height],F=_U(R,A?[n,r]:[r,n]);return T.current=I,F(P-I.top)}return d.jsx(Ide,{scope:e.__scopeSlider,startEdge:A?"bottom":"top",endEdge:A?"top":"bottom",size:"height",direction:A?1:-1,children:d.jsx(Mde,{"data-orientation":"vertical",...y,ref:b,style:{...y.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:P=>{const I=O(P.clientY);o==null||o(I)},onSlideMove:P=>{const I=O(P.clientY);h==null||h(I)},onSlideEnd:()=>{T.current=void 0,i==null||i()},onStepKeyDown:P=>{const R=Ode[A?"from-bottom":"from-top"].includes(P.key);m==null||m({event:P,direction:R?-1:1})}})})}),Mde=V.forwardRef((e,t)=>{const{__scopeSlider:r,onSlideStart:n,onSlideMove:s,onSlideEnd:o,onHomeKeyDown:h,onEndKeyDown:i,onStepKeyDown:m,...y}=e,S=VI(Aw,r);return d.jsx(ln.span,{...y,ref:t,onKeyDown:Ir(e.onKeyDown,b=>{b.key==="Home"?(h(b),b.preventDefault()):b.key==="End"?(i(b),b.preventDefault()):jde.concat(Pde).includes(b.key)&&(m(b),b.preventDefault())}),onPointerDown:Ir(e.onPointerDown,b=>{const T=b.target;T.setPointerCapture(b.pointerId),b.preventDefault(),S.thumbs.has(T)?T.focus():n(b)}),onPointerMove:Ir(e.onPointerMove,b=>{b.target.hasPointerCapture(b.pointerId)&&s(b)}),onPointerUp:Ir(e.onPointerUp,b=>{const T=b.target;T.hasPointerCapture(b.pointerId)&&(T.releasePointerCapture(b.pointerId),o(b))})})}),Dde="SliderTrack",Lde=V.forwardRef((e,t)=>{const{__scopeSlider:r,...n}=e,s=VI(Dde,r);return d.jsx(ln.span,{"data-disabled":s.disabled?"":void 0,"data-orientation":s.orientation,...n,ref:t})});Lde.displayName=Dde;var x4="SliderRange",Fde=V.forwardRef((e,t)=>{const{__scopeSlider:r,...n}=e,s=VI(x4,r),o=Rde(x4,r),h=V.useRef(null),i=Un(t,h),m=s.values.length,y=s.values.map(T=>$de(T,s.min,s.max)),S=m>1?Math.min(...y):0,b=100-Math.max(...y);return d.jsx(ln.span,{"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,...n,ref:i,style:{...e.style,[o.startEdge]:S+"%",[o.endEdge]:b+"%"}})});Fde.displayName=x4;var b4="SliderThumb",zde=V.forwardRef((e,t)=>{const r=tit(e.__scopeSlider),[n,s]=V.useState(null),o=Un(t,i=>s(i)),h=V.useMemo(()=>n?r().findIndex(i=>i.ref.current===n):-1,[r,n]);return d.jsx(ait,{...e,ref:o,index:h})}),ait=V.forwardRef((e,t)=>{const{__scopeSlider:r,index:n,name:s,...o}=e,h=VI(b4,r),i=Rde(b4,r),[m,y]=V.useState(null),S=Un(t,M=>y(M)),b=m?h.form||!!m.closest("form"):!0,T=S2(m),A=h.values[n],O=A===void 0?0:$de(A,h.min,h.max),P=cit(n,h.values.length),I=T==null?void 0:T[i.size],R=I?dit(I,O,i.direction):0;return V.useEffect(()=>{if(m)return h.thumbs.add(m),()=>{h.thumbs.delete(m)}},[m,h.thumbs]),d.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[i.startEdge]:`calc(${O}% + ${R}px)`},children:[d.jsx(_4.ItemSlot,{scope:e.__scopeSlider,children:d.jsx(ln.span,{role:"slider","aria-label":e["aria-label"]||P,"aria-valuemin":h.min,"aria-valuenow":A,"aria-valuemax":h.max,"aria-orientation":h.orientation,"data-orientation":h.orientation,"data-disabled":h.disabled?"":void 0,tabIndex:h.disabled?void 0:0,...o,ref:S,style:A===void 0?{display:"none"}:e.style,onFocus:Ir(e.onFocus,()=>{h.valueIndexToChangeRef.current=n})})}),b&&d.jsx(Bde,{name:s??(h.name?h.name+(h.values.length>1?"[]":""):void 0),form:h.form,value:A},n)]})});zde.displayName=b4;var oit="RadioBubbleInput",Bde=V.forwardRef(({__scopeSlider:e,value:t,...r},n)=>{const s=V.useRef(null),o=Un(s,n),h=L2(t);return V.useEffect(()=>{const i=s.current;if(!i)return;const m=window.HTMLInputElement.prototype,S=Object.getOwnPropertyDescriptor(m,"value").set;if(h!==t&&S){const b=new Event("input",{bubbles:!0});S.call(i,t),i.dispatchEvent(b)}},[h,t]),d.jsx(ln.input,{style:{display:"none"},...r,ref:o,defaultValue:t})});Bde.displayName=oit;function lit(e=[],t,r){const n=[...e];return n[r]=t,n.sort((s,o)=>s-o)}function $de(e,t,r){const o=100/(r-t)*(e-t);return vT(o,[0,100])}function cit(e,t){return t>2?`Value ${e+1} of ${t}`:t===2?["Minimum","Maximum"][e]:void 0}function uit(e,t){if(e.length===1)return 0;const r=e.map(s=>Math.abs(s-t)),n=Math.min(...r);return r.indexOf(n)}function dit(e,t,r){const n=e/2,o=_U([0,50],[0,n]);return(n-o(t)*r)*r}function hit(e){return e.slice(0,-1).map((t,r)=>e[r+1]-t)}function fit(e,t){if(t>0){const r=hit(e);return Math.min(...r)>=t}return!0}function _U(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const n=(t[1]-t[0])/(e[1]-e[0]);return t[0]+n*(r-e[0])}}function pit(e){return(String(e).split(".")[1]||"").length}function mit(e,t){const r=Math.pow(10,t);return Math.round(e*r)/r}var Ude=Nde,git=Lde,yit=Fde,vit=zde;const w4=V.forwardRef(({className:e,...t},r)=>d.jsxs(Ude,{ref:r,className:fr("relative flex w-full touch-none select-none items-center",e),...t,children:[d.jsx(git,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:d.jsx(yit,{className:"absolute h-full bg-primary"})}),d.jsx(vit,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));w4.displayName=Ude.displayName;const _it=()=>{ci();const{data:e,isLoading:t}=Sie(),r=dPe(),n=hPe(),[s,o]=V.useState("images"),[h,i]=V.useState(null),[m,y]=V.useState(!1);V.useEffect(()=>{e&&!h&&i(e)},[e,h]);const S=async(O,P)=>{var R;const I=(R=O.target.files)==null?void 0:R[0];if(I){if(!I.type.startsWith("image/")){kr.error("");return}try{const M=await n.mutateAsync({file:I,type:P});i(F=>({...F,[`${P}_image_url`]:M.url})),y(!0),kr.success("")}catch(M){console.error("Upload failed:",M)}}},b=(O,P)=>{i(I=>({...I,[O]:P})),y(!0)},T=async()=>{try{await r.mutateAsync(h),y(!1),kr.success("")}catch(O){console.error("Save failed:",O),kr.error("")}},A=()=>{e&&(i(e),y(!1),kr.info(""))};return t||!h?d.jsx(xo,{children:d.jsx("div",{className:"flex items-center justify-center h-64",children:d.jsx(_a,{className:"w-8 h-8 animate-spin"})})}):d.jsx(xo,{children:d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold",children:""}),d.jsx("p",{className:"text-muted-foreground mt-2",children:""})]}),d.jsxs("div",{className:"flex gap-2",children:[m&&d.jsxs(Mt,{variant:"outline",onClick:A,children:[d.jsx(B_e,{className:"w-4 h-4 mr-2"}),""]}),d.jsxs(Mt,{onClick:T,disabled:!m||r.isPending,children:[r.isPending?d.jsx(_a,{className:"w-4 h-4 mr-2 animate-spin"}):d.jsx(P3,{className:"w-4 h-4 mr-2"}),""]})]})]}),m&&d.jsx("div",{className:"bg-amber-50 dark:bg-amber-950/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4",children:d.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:'""'})}),d.jsxs(Mv,{value:s,onValueChange:o,children:[d.jsxs(pg,{className:"grid w-full grid-cols-4",children:[d.jsx(Ca,{value:"images",children:""}),d.jsx(Ca,{value:"overlay",children:""}),d.jsx(Ca,{value:"content",children:""}),d.jsx(Ca,{value:"buttons",children:""})]}),d.jsx(ja,{value:"images",className:"space-y-6",children:d.jsxs(Nr,{children:[d.jsxs(Rn,{children:[d.jsx($n,{children:""}),d.jsx(as,{children:""})]}),d.jsxs(Mr,{className:"space-y-6",children:[d.jsxs("div",{className:"space-y-4",children:[d.jsx(yr,{children:""}),d.jsxs("div",{className:"flex items-center gap-4",children:[h.desktop_image_url&&d.jsx("div",{className:"relative w-40 h-24 rounded-lg overflow-hidden border",children:d.jsx("img",{src:h.desktop_image_url,alt:"Desktop",className:"w-full h-full object-cover"})}),d.jsxs("div",{children:[d.jsx(cr,{type:"file",accept:"image/*",onChange:O=>S(O,"desktop"),className:"hidden",id:"desktop-upload"}),d.jsx(yr,{htmlFor:"desktop-upload",children:d.jsx(Mt,{variant:"outline",className:"cursor-pointer",asChild:!0,children:d.jsxs("span",{children:[d.jsx(zh,{className:"w-4 h-4 mr-2"}),""]})})}),d.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:": 1920x1080px"})]})]})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsx(yr,{children:""}),d.jsxs("div",{className:"flex items-center gap-4",children:[h.tablet_image_url&&d.jsx("div",{className:"relative w-40 h-24 rounded-lg overflow-hidden border",children:d.jsx("img",{src:h.tablet_image_url,alt:"Tablet",className:"w-full h-full object-cover"})}),d.jsxs("div",{children:[d.jsx(cr,{type:"file",accept:"image/*",onChange:O=>S(O,"tablet"),className:"hidden",id:"tablet-upload"}),d.jsx(yr,{htmlFor:"tablet-upload",children:d.jsx(Mt,{variant:"outline",className:"cursor-pointer",asChild:!0,children:d.jsxs("span",{children:[d.jsx(zh,{className:"w-4 h-4 mr-2"}),""]})})}),d.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:": 1024x768px"})]})]})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsx(yr,{children:""}),d.jsxs("div",{className:"flex items-center gap-4",children:[h.mobile_image_url&&d.jsx("div",{className:"relative w-40 h-24 rounded-lg overflow-hidden border",children:d.jsx("img",{src:h.mobile_image_url,alt:"Mobile",className:"w-full h-full object-cover"})}),d.jsxs("div",{children:[d.jsx(cr,{type:"file",accept:"image/*",onChange:O=>S(O,"mobile"),className:"hidden",id:"mobile-upload"}),d.jsx(yr,{htmlFor:"mobile-upload",children:d.jsx(Mt,{variant:"outline",className:"cursor-pointer",asChild:!0,children:d.jsxs("span",{children:[d.jsx(zh,{className:"w-4 h-4 mr-2"}),""]})})}),d.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:": 750x1334px"})]})]})]})]})]})}),d.jsx(ja,{value:"overlay",className:"space-y-6",children:d.jsxs(Nr,{children:[d.jsxs(Rn,{children:[d.jsx($n,{children:""}),d.jsx(as,{children:""})]}),d.jsxs(Mr,{className:"space-y-6",children:[d.jsxs("div",{className:"space-y-4",children:[d.jsx(yr,{children:""}),d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx(w4,{value:[h.overlay_opacity||0],onValueChange:([O])=>b("overlay_opacity",O),max:100,step:1,className:"flex-1"}),d.jsxs("div",{className:"flex items-center gap-2 w-24",children:[d.jsx(cr,{type:"number",min:"0",max:"100",value:h.overlay_opacity||0,onChange:O=>b("overlay_opacity",parseInt(O.target.value)||0),className:"w-16"}),d.jsx("span",{className:"text-sm",children:"%"})]})]})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsx(yr,{children:""}),d.jsxs(Qs,{value:h.overlay_gradient_direction,onValueChange:O=>b("overlay_gradient_direction",O),children:[d.jsx(Gs,{children:d.jsx(ea,{})}),d.jsxs(Ws,{children:[d.jsx(nn,{value:"to-b",children:""}),d.jsx(nn,{value:"to-t",children:""}),d.jsx(nn,{value:"to-r",children:""}),d.jsx(nn,{value:"to-l",children:""}),d.jsx(nn,{value:"to-br",children:""}),d.jsx(nn,{value:"to-tr",children:""})]})]})]}),d.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{children:""}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(cr,{type:"number",min:"0",max:"100",value:h.overlay_gradient_from_opacity||0,onChange:O=>b("overlay_gradient_from_opacity",parseInt(O.target.value)||0)}),d.jsx("span",{className:"text-sm",children:"%"})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{children:""}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(cr,{type:"number",min:"0",max:"100",value:h.overlay_gradient_via_opacity||0,onChange:O=>b("overlay_gradient_via_opacity",parseInt(O.target.value)||0)}),d.jsx("span",{className:"text-sm",children:"%"})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{children:""}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(cr,{type:"number",min:"0",max:"100",value:h.overlay_gradient_to_opacity||0,onChange:O=>b("overlay_gradient_to_opacity",parseInt(O.target.value)||0)}),d.jsx("span",{className:"text-sm",children:"%"})]})]})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsx(yr,{children:""}),d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx(w4,{value:[h.background_blur||0],onValueChange:([O])=>b("background_blur",O),max:50,step:1,className:"flex-1"}),d.jsxs("div",{className:"flex items-center gap-2 w-24",children:[d.jsx(cr,{type:"number",min:"0",max:"50",value:h.background_blur||0,onChange:O=>b("background_blur",parseInt(O.target.value)||0),className:"w-16"}),d.jsx("span",{className:"text-sm",children:"px"})]})]})]}),d.jsxs("div",{className:"border-t pt-6 space-y-4",children:[d.jsx("h3",{className:"font-semibold",children:""}),d.jsx("p",{className:"text-sm text-muted-foreground",children:""}),d.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{children:""}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(cr,{type:"number",min:"0",max:"100",value:h.desktop_overlay_opacity??"",placeholder:"",onChange:O=>b("desktop_overlay_opacity",O.target.value?parseInt(O.target.value):null)}),d.jsx("span",{className:"text-sm",children:"%"})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{children:""}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(cr,{type:"number",min:"0",max:"100",value:h.tablet_overlay_opacity??"",placeholder:"",onChange:O=>b("tablet_overlay_opacity",O.target.value?parseInt(O.target.value):null)}),d.jsx("span",{className:"text-sm",children:"%"})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx(yr,{children:""}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(cr,{type:"number",min:"0",max:"100",value:h.mobile_overlay_opacity??"",placeholder:"",onChange:O=>b("mobile_overlay_opacity",O.target.value?parseInt(O.target.value):null)}),d.jsx("span",{className:"text-sm",children:"%"})]})]})]})]})]})]})}),d.jsx(ja,{value:"content",className:"space-y-6",children:d.jsxs(Nr,{children:[d.jsxs(Rn,{children:[d.jsx($n,{children:""}),d.jsx(as,{children:""})]}),d.jsxs(Mr,{className:"space-y-6",children:[d.jsxs("div",{className:"space-y-4",children:[d.jsx(yr,{children:""}),d.jsxs("div",{className:"space-y-3",children:[d.jsx(cr,{placeholder:"",value:h.title_zh||"",onChange:O=>b("title_zh",O.target.value)}),d.jsx(cr,{placeholder:"English Title",value:h.title_en||"",onChange:O=>b("title_en",O.target.value)}),d.jsx(cr,{placeholder:"Ttulo em Portugus",value:h.title_pt||"",onChange:O=>b("title_pt",O.target.value)})]})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsx(yr,{children:""}),d.jsxs("div",{className:"space-y-3",children:[d.jsx(hl,{placeholder:"",value:h.description_zh||"",onChange:O=>b("description_zh",O.target.value),rows:3}),d.jsx(hl,{placeholder:"English Description",value:h.description_en||"",onChange:O=>b("description_en",O.target.value),rows:3}),d.jsx(hl,{placeholder:"Descrio em Portugus",value:h.description_pt||"",onChange:O=>b("description_pt",O.target.value),rows:3})]})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"space-y-0.5",children:[d.jsx(yr,{children:""}),d.jsx("p",{className:"text-sm text-muted-foreground",children:""})]}),d.jsx(wb,{checked:h.show_stats,onCheckedChange:O=>b("show_stats",O)})]})]})]})}),d.jsx(ja,{value:"buttons",className:"space-y-6",children:d.jsxs(Nr,{children:[d.jsxs(Rn,{children:[d.jsx($n,{children:""}),d.jsx(as,{children:""})]}),d.jsxs(Mr,{className:"space-y-6",children:[d.jsxs("div",{className:"space-y-4",children:[d.jsx(yr,{children:""}),d.jsxs("div",{className:"space-y-3",children:[d.jsx(cr,{placeholder:"",value:h.subtitle_button_text_zh||"",onChange:O=>b("subtitle_button_text_zh",O.target.value)}),d.jsx(cr,{placeholder:"English Text",value:h.subtitle_button_text_en||"",onChange:O=>b("subtitle_button_text_en",O.target.value)}),d.jsx(cr,{placeholder:"Texto em Portugus",value:h.subtitle_button_text_pt||"",onChange:O=>b("subtitle_button_text_pt",O.target.value)}),d.jsxs(Qs,{value:h.subtitle_button_link||"",onValueChange:O=>b("subtitle_button_link",O),children:[d.jsx(Gs,{children:d.jsx(ea,{placeholder:""})}),d.jsxs(Ws,{children:[d.jsx(nn,{value:"/",children:""}),d.jsx(nn,{value:"/restaurants",children:""}),d.jsx(nn,{value:"/activities",children:""}),d.jsx(nn,{value:"/map",children:""}),d.jsx(nn,{value:"/join-us",children:""})]})]})]})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsx(yr,{children:""}),d.jsxs("div",{className:"space-y-3",children:[d.jsx(cr,{placeholder:"",value:h.primary_button_text_zh||"",onChange:O=>b("primary_button_text_zh",O.target.value)}),d.jsx(cr,{placeholder:"English Text",value:h.primary_button_text_en||"",onChange:O=>b("primary_button_text_en",O.target.value)}),d.jsx(cr,{placeholder:"Texto em Portugus",value:h.primary_button_text_pt||"",onChange:O=>b("primary_button_text_pt",O.target.value)}),d.jsxs(Qs,{value:h.primary_button_link||"",onValueChange:O=>b("primary_button_link",O),children:[d.jsx(Gs,{children:d.jsx(ea,{placeholder:""})}),d.jsxs(Ws,{children:[d.jsx(nn,{value:"/",children:""}),d.jsx(nn,{value:"/restaurants",children:""}),d.jsx(nn,{value:"/activities",children:""}),d.jsx(nn,{value:"/map",children:""}),d.jsx(nn,{value:"/join-us",children:""})]})]})]})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsx(yr,{children:""}),d.jsxs("div",{className:"space-y-3",children:[d.jsx(cr,{placeholder:"",value:h.secondary_button_text_zh||"",onChange:O=>b("secondary_button_text_zh",O.target.value)}),d.jsx(cr,{placeholder:"English Text",value:h.secondary_button_text_en||"",onChange:O=>b("secondary_button_text_en",O.target.value)}),d.jsx(cr,{placeholder:"Texto em Portugus",value:h.secondary_button_text_pt||"",onChange:O=>b("secondary_button_text_pt",O.target.value)}),d.jsxs(Qs,{value:h.secondary_button_link||"",onValueChange:O=>b("secondary_button_link",O),children:[d.jsx(Gs,{children:d.jsx(ea,{placeholder:""})}),d.jsxs(Ws,{children:[d.jsx(nn,{value:"/",children:""}),d.jsx(nn,{value:"/restaurants",children:""}),d.jsx(nn,{value:"/activities",children:""}),d.jsx(nn,{value:"/map",children:""}),d.jsx(nn,{value:"/join-us",children:""})]})]})]})]})]})]})})]}),m&&d.jsx("div",{className:"fixed bottom-4 right-4 z-50 md:hidden",children:d.jsxs(Mt,{onClick:T,size:"lg",disabled:r.isPending,children:[r.isPending?d.jsx(_a,{className:"w-4 h-4 mr-2 animate-spin"}):d.jsx(P3,{className:"w-4 h-4 mr-2"}),""]})})]})})},Vde=V.forwardRef(({className:e,...t},r)=>d.jsx("div",{className:"relative w-full overflow-auto",children:d.jsx("table",{ref:r,className:fr("w-full caption-bottom text-sm",e),...t})}));Vde.displayName="Table";const qde=V.forwardRef(({className:e,...t},r)=>d.jsx("thead",{ref:r,className:fr("[&_tr]:border-b",e),...t}));qde.displayName="TableHeader";const Hde=V.forwardRef(({className:e,...t},r)=>d.jsx("tbody",{ref:r,className:fr("[&_tr:last-child]:border-0",e),...t}));Hde.displayName="TableBody";const xit=V.forwardRef(({className:e,...t},r)=>d.jsx("tfoot",{ref:r,className:fr("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}));xit.displayName="TableFooter";const S4=V.forwardRef(({className:e,...t},r)=>d.jsx("tr",{ref:r,className:fr("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",e),...t}));S4.displayName="TableRow";const _m=V.forwardRef(({className:e,...t},r)=>d.jsx("th",{ref:r,className:fr("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));_m.displayName="TableHead";const xm=V.forwardRef(({className:e,...t},r)=>d.jsx("td",{ref:r,className:fr("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));xm.displayName="TableCell";const bit=V.forwardRef(({className:e,...t},r)=>d.jsx("caption",{ref:r,className:fr("mt-4 text-sm text-muted-foreground",e),...t}));bit.displayName="TableCaption";const wit=()=>{const{t:e}=ci(),[t,r]=V.useState(""),[n,s]=V.useState("all"),[o,h]=V.useState(null),i=Mi(),{data:m,isLoading:y}=ei({queryKey:["joinRequests"],queryFn:async()=>{const{data:R,error:M}=await Ct.from("join_requests").select("*").order("created_at",{ascending:!1});if(M)throw M;return R}}),{data:S}=ei({queryKey:["emailConfig","join_request"],queryFn:async()=>{const{data:R,error:M}=await Ct.from("email_config").select("*").eq("type","join_request").single();if(M)throw M;return R}}),b=m==null?void 0:m.filter(R=>{const M=t.toLowerCase(),F=R.name.toLowerCase().includes(M)||R.email.toLowerCase().includes(M)||R.restaurant_name.toLowerCase().includes(M)||R.phone.toLowerCase().includes(M),z=n==="all"||R.status===n;return F&&z}),T=async()=>{const R=prompt(e("joinUs.enterNewEmail"),S==null?void 0:S.recipient_email);if(R)try{const{error:M}=await Ct.from("email_config").update({recipient_email:R}).eq("id",S==null?void 0:S.id);if(M)throw M;Po({title:e("common.success"),description:e("joinUs.emailUpdated")})}catch(M){console.error("Error updating email:",M),Po({title:e("common.error"),description:e("joinUs.emailUpdateError"),variant:"destructive"})}},A=Gi({mutationFn:async({id:R,status:M})=>{const{error:F}=await Ct.from("join_requests").update({status:M}).eq("id",R);if(F)throw F},onSuccess:()=>{i.invalidateQueries({queryKey:["joinRequests"]}),Po({title:e("common.success"),description:e("joinUs.statusUpdated")})},onError:R=>{console.error("Error updating status:",R),Po({title:e("common.error"),description:e("joinUs.statusUpdateError"),variant:"destructive"})}}),O=Gi({mutationFn:async R=>{const{error:M}=await Ct.from("join_requests").delete().eq("id",R);if(M)throw M},onSuccess:()=>{i.invalidateQueries({queryKey:["joinRequests"]}),Po({title:e("common.success"),description:e("joinUs.requestDeleted")}),h(null)},onError:R=>{console.error("Error deleting request:",R),Po({title:e("common.error"),description:e("joinUs.deleteError"),variant:"destructive"})}}),P=()=>{if(!b||b.length===0){Po({title:e("admin.noDataToExport"),variant:"destructive"});return}const R=[["Name","Email","Phone","Restaurant Name","Restaurant Address","Features","Status","Submitted Date"],...b.map($=>[$.name,$.email,$.phone,$.restaurant_name,$.restaurant_address||"",Array.isArray($.features_selected)?$.features_selected.join(", "):"",$.status||"pending",new Date($.created_at).toLocaleString()])].map($=>$.map(W=>`"${W}"`).join(",")).join(`
`),M=new Blob([R],{type:"text/csv;charset=utf-8;"}),F=document.createElement("a"),z=URL.createObjectURL(M);F.setAttribute("href",z),F.setAttribute("download",`join_requests_${new Date().toISOString()}.csv`),F.click(),URL.revokeObjectURL(z),Po({title:e("admin.exportSuccess")})},I=R=>{switch(R){case"completed":return"default";case"rejected":return"destructive";default:return"secondary"}};return d.jsxs(xo,{children:[d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("h2",{className:"text-3xl font-bold",children:e("joinUs.adminTitle")}),d.jsx("p",{className:"text-muted-foreground mt-2",children:e("joinUs.adminDescription")})]}),d.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[d.jsxs(Nr,{children:[d.jsxs(Rn,{children:[d.jsx($n,{children:e("joinUs.recipientEmail")}),d.jsx(as,{children:e("joinUs.recipientEmailDesc")})]}),d.jsx(Mr,{children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx(cr,{value:(S==null?void 0:S.recipient_email)||"",readOnly:!0}),d.jsx(Mt,{onClick:T,children:e("common.edit")})]})})]}),d.jsxs(Nr,{children:[d.jsxs(Rn,{children:[d.jsx($n,{children:e("joinUs.totalRequests")}),d.jsx(as,{children:e("joinUs.totalRequestsDesc")})]}),d.jsx(Mr,{children:d.jsx("div",{className:"text-3xl font-bold",children:(m==null?void 0:m.length)||0})})]})]}),d.jsxs(Nr,{children:[d.jsxs(Rn,{children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx($n,{children:e("joinUs.allRequests")}),d.jsx(as,{children:e("joinUs.allRequestsDesc")})]}),d.jsxs(Mt,{onClick:P,variant:"outline",children:[d.jsx(tN,{className:"w-4 h-4 mr-2"}),e("admin.exportCSV")]})]}),d.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[d.jsxs("div",{className:"relative flex-1",children:[d.jsx(Xh,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),d.jsx(cr,{placeholder:e("joinUs.searchPlaceholder"),value:t,onChange:R=>r(R.target.value),className:"pl-10"})]}),d.jsxs(lw,{children:[d.jsx(cw,{asChild:!0,children:d.jsxs(Mt,{variant:"outline",className:"gap-2",children:[d.jsx(rN,{className:"w-4 h-4"}),e(n==="all"?"admin.allStatus":`joinUs.status.${n}`)]})}),d.jsxs(Jv,{align:"end",className:"bg-background",children:[d.jsx(Ta,{onClick:()=>s("all"),children:e("admin.allStatus")}),d.jsx(Ta,{onClick:()=>s("pending"),children:e("joinUs.status.pending")}),d.jsx(Ta,{onClick:()=>s("completed"),children:e("joinUs.status.completed")}),d.jsx(Ta,{onClick:()=>s("rejected"),children:e("joinUs.status.rejected")})]})]})]})]}),d.jsx(Mr,{children:y?d.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e("common.loading")}):b&&b.length>0?d.jsx("div",{className:"overflow-x-auto",children:d.jsxs(Vde,{children:[d.jsx(qde,{children:d.jsxs(S4,{children:[d.jsx(_m,{children:e("joinUs.name")}),d.jsx(_m,{children:e("joinUs.contact")}),d.jsx(_m,{children:e("joinUs.restaurant")}),d.jsx(_m,{children:e("joinUs.featuresNeeded")}),d.jsx(_m,{children:e("joinUs.status")}),d.jsx(_m,{children:e("joinUs.submittedAt")}),d.jsx(_m,{className:"text-right",children:e("common.actions")})]})}),d.jsx(Hde,{children:b.map(R=>d.jsxs(S4,{children:[d.jsx(xm,{className:"font-medium",children:R.name}),d.jsx(xm,{children:d.jsxs("div",{className:"space-y-1",children:[d.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[d.jsx(OQ,{className:"w-3 h-3 text-muted-foreground"}),d.jsx("a",{href:`mailto:${R.email}`,className:"hover:underline",children:R.email})]}),d.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[d.jsx(Jb,{className:"w-3 h-3 text-muted-foreground"}),d.jsx("a",{href:`tel:${R.phone}`,className:"hover:underline",children:R.phone})]})]})}),d.jsx(xm,{children:d.jsxs("div",{className:"space-y-1",children:[d.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[d.jsx(Io,{className:"w-3 h-3 text-muted-foreground"}),R.restaurant_name]}),R.restaurant_address&&d.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[d.jsx(Pa,{className:"w-3 h-3"}),R.restaurant_address]})]})}),d.jsx(xm,{children:d.jsx("div",{className:"flex flex-wrap gap-1",children:Array.isArray(R.features_selected)&&R.features_selected.map((M,F)=>d.jsx(sn,{variant:"secondary",children:e(`joinUs.feature.${M}`)},F))})}),d.jsx(xm,{children:d.jsx(sn,{variant:I(R.status||"pending"),children:e(`joinUs.status.${R.status||"pending"}`)})}),d.jsx(xm,{className:"text-sm text-muted-foreground",children:wg(new Date(R.created_at),{addSuffix:!0})}),d.jsx(xm,{children:d.jsxs("div",{className:"flex items-center justify-end gap-2",children:[R.status!=="completed"&&d.jsx(Mt,{size:"sm",variant:"outline",onClick:()=>A.mutate({id:R.id,status:"completed"}),disabled:A.isPending,children:d.jsx(ip,{className:"w-4 h-4"})}),d.jsx(Mt,{size:"sm",variant:"destructive",onClick:()=>h(R.id),disabled:O.isPending,children:d.jsx(Yh,{className:"w-4 h-4"})})]})})]},R.id))})]})}):d.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e("joinUs.noRequests")})})]})]}),d.jsx(ko,{open:o!==null,onOpenChange:R=>!R&&h(null),children:d.jsxs(co,{children:[d.jsxs(uo,{children:[d.jsx(fo,{children:e("joinUs.confirmDelete")}),d.jsx(po,{children:e("joinUs.confirmDeleteDescription")})]}),d.jsxs(ho,{children:[d.jsx(mo,{children:e("common.cancel")}),d.jsx(to,{onClick:()=>o&&O.mutate(o),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:e("common.delete")})]})]})})]})},Sit=()=>{var re;const{t:e}=ci(),t=Mi(),[r,n]=V.useState(null),[s,o]=V.useState(""),[h,i]=V.useState(""),[m,y]=V.useState(""),[S,b]=V.useState("all"),{data:T,isLoading:A}=ei({queryKey:["admin-reports"],queryFn:async()=>{const{data:te,error:ae}=await Ct.from("reports").select(`
          *,
          reporter:profiles(display_name, avatar_url)
        `).order("created_at",{ascending:!1});if(ae)throw ae;return te}}),{data:O}=ei({queryKey:["emailConfig","report"],queryFn:async()=>{const{data:te,error:ae}=await Ct.from("email_config").select("*").eq("type","report").single();if(ae)throw ae;return te}}),P=T==null?void 0:T.filter(te=>{var we,Ce;const ae=m.toLowerCase(),ue=te.description.toLowerCase().includes(ae)||((Ce=(we=te.reporter)==null?void 0:we.display_name)==null?void 0:Ce.toLowerCase().includes(ae))||te.reason.toLowerCase().includes(ae),be=S==="all"||te.status===S;return ue&&be}),I={total:(T==null?void 0:T.length)||0,pending:(T==null?void 0:T.filter(te=>te.status==="pending").length)||0,reviewing:(T==null?void 0:T.filter(te=>te.status==="reviewing").length)||0,resolved:(T==null?void 0:T.filter(te=>te.status==="resolved").length)||0,dismissed:(T==null?void 0:T.filter(te=>te.status==="dismissed").length)||0},R=Array.from({length:7},(te,ae)=>{const ue=dg(dP(new Date,6-ae)),be=ps(ue,"yyyy-MM-dd"),we=(T==null?void 0:T.filter(Ce=>ps(dg(new Date(Ce.created_at)),"yyyy-MM-dd")===be).length)||0;return{date:ps(ue,"MM/dd"),count:we}}),M=["spam","harassment","inappropriate_content","misinformation","copyright","fraud","hate_speech","violence","other"].map(te=>({name:e(`report.reasons.${te}`),value:(T==null?void 0:T.filter(ae=>ae.reason===te).length)||0})).filter(te=>te.value>0),F=["comment","restaurant","activity","user"].map(te=>({name:e(`admin.reportType.${te}`),value:(T==null?void 0:T.filter(ae=>ae.target_type===te).length)||0})).filter(te=>te.value>0),z=["#016450","#018a6f","#4CAF50","#81C784","#FFA726","#FF7043","#EF5350","#EC407A","#AB47BC"],$=async()=>{const te=prompt(e("joinUs.enterNewEmail"),O==null?void 0:O.recipient_email);if(te)try{const{error:ae}=await Ct.from("email_config").update({recipient_email:te}).eq("id",O==null?void 0:O.id);if(ae)throw ae;t.invalidateQueries({queryKey:["emailConfig"]}),kr.success(e("joinUs.emailUpdated"))}catch(ae){console.error("Error updating email:",ae),kr.error(e("joinUs.emailUpdateError"))}},W=Gi({mutationFn:async({id:te,status:ae,notes:ue})=>{const be={updated_at:new Date().toISOString()};ae&&(be.status=ae),ue!==void 0&&(be.admin_notes=ue);const{error:we}=await Ct.from("reports").update(be).eq("id",te);if(we)throw we},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-reports"]}),kr.success(e("toast.reportUpdatedSuccess")),n(null)},onError:te=>{kr.error(te.message||e("toast.reportUpdateFailed"))}}),K=te=>{const ae={pending:"default",reviewing:"secondary",resolved:"default",dismissed:"destructive"};return d.jsx(sn,{variant:ae[te]||"default",children:e(`admin.reportStatus.${te}`)})},ee=(te,ae)=>{switch(te){case"restaurant":return`/restaurant/${ae}`;case"activity":return`/activity/${ae}`;case"comment":return"#";case"user":return"/profile";default:return"#"}},ne=te=>{n(te),o(te.admin_notes||""),i(te.status)},ie=()=>{r&&W.mutate({id:r.id,status:h,notes:s})};return A?d.jsx(xo,{children:d.jsx("div",{className:"flex items-center justify-center h-64",children:d.jsx(_a,{className:"w-8 h-8 animate-spin"})})}):d.jsxs(xo,{children:[d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("h2",{className:"text-3xl font-bold",children:e("admin.reports")}),d.jsx("p",{className:"text-muted-foreground mt-2",children:e("admin.reportsDescription")})]}),d.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[d.jsxs(Nr,{children:[d.jsxs(Rn,{children:[d.jsx($n,{children:e("joinUs.recipientEmail")}),d.jsx(as,{children:e("joinUs.recipientEmailDesc")})]}),d.jsx(Mr,{children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx(cr,{value:(O==null?void 0:O.recipient_email)||"",readOnly:!0}),d.jsx(Mt,{onClick:$,children:e("common.edit")})]})})]}),d.jsxs(Nr,{children:[d.jsxs(Rn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[d.jsx($n,{className:"text-sm font-medium",children:e("admin.totalReports")}),d.jsx(nP,{className:"h-4 w-4 text-muted-foreground"})]}),d.jsxs(Mr,{children:[d.jsx("div",{className:"text-2xl font-bold",children:I.total}),d.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e("admin.allReportsCount")})]})]}),d.jsxs(Nr,{children:[d.jsxs(Rn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[d.jsx($n,{className:"text-sm font-medium",children:e("admin.reportStatus.pending")}),d.jsx(Kv,{className:"h-4 w-4 text-yellow-500"})]}),d.jsxs(Mr,{children:[d.jsx("div",{className:"text-2xl font-bold",children:I.pending}),d.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e("admin.awaitingReview")})]})]}),d.jsxs(Nr,{children:[d.jsxs(Rn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[d.jsx($n,{className:"text-sm font-medium",children:e("admin.reportStatus.reviewing")}),d.jsx(eN,{className:"h-4 w-4 text-blue-500"})]}),d.jsxs(Mr,{children:[d.jsx("div",{className:"text-2xl font-bold",children:I.reviewing}),d.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e("admin.underReview")})]})]}),d.jsxs(Nr,{children:[d.jsxs(Rn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[d.jsx($n,{className:"text-sm font-medium",children:e("admin.reportStatus.resolved")}),d.jsx(S_e,{className:"h-4 w-4 text-green-500"})]}),d.jsxs(Mr,{children:[d.jsx("div",{className:"text-2xl font-bold",children:I.resolved}),d.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e("admin.resolvedReports")})]})]}),d.jsxs(Nr,{children:[d.jsxs(Rn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[d.jsx($n,{className:"text-sm font-medium",children:e("admin.reportStatus.dismissed")}),d.jsx(VP,{className:"h-4 w-4 text-red-500"})]}),d.jsxs(Mr,{children:[d.jsx("div",{className:"text-2xl font-bold",children:I.dismissed}),d.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e("admin.dismissedReports")})]})]})]}),d.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[d.jsxs(Nr,{children:[d.jsxs(Rn,{children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(IQ,{className:"w-5 h-5 text-primary"}),d.jsx($n,{children:e("admin.reportsTrend")})]}),d.jsx(as,{children:e("admin.reportsTrendDesc")})]}),d.jsx(Mr,{children:d.jsx(Hm,{width:"100%",height:300,children:d.jsxs(ode,{data:R,children:[d.jsx(tv,{strokeDasharray:"3 3"}),d.jsx(Mh,{dataKey:"date"}),d.jsx(Dh,{}),d.jsx(Sl,{}),d.jsx(Tw,{type:"monotone",dataKey:"count",stroke:"hsl(var(--primary))",strokeWidth:2,name:e("admin.reportsCount")})]})})})]}),d.jsxs(Nr,{children:[d.jsxs(Rn,{children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(x_e,{className:"w-5 h-5 text-primary"}),d.jsx($n,{children:e("admin.reportsReasonDist")})]}),d.jsx(as,{children:e("admin.reportsReasonDistDesc")})]}),d.jsx(Mr,{children:d.jsx(Hm,{width:"100%",height:300,children:d.jsxs(mX,{children:[d.jsx(Zh,{data:M,cx:"50%",cy:"50%",labelLine:!1,label:({name:te,percent:ae})=>`${te}: ${(ae*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:M.map((te,ae)=>d.jsx(IT,{fill:z[ae%z.length]},`cell-${ae}`))}),d.jsx(Sl,{})]})})})]}),d.jsxs(Nr,{children:[d.jsxs(Rn,{children:[d.jsx($n,{children:e("admin.reportsTypeDist")}),d.jsx(as,{children:e("admin.reportsTypeDistDesc")})]}),d.jsx(Mr,{children:d.jsx(Hm,{width:"100%",height:300,children:d.jsxs(gP,{data:F,children:[d.jsx(tv,{strokeDasharray:"3 3"}),d.jsx(Mh,{dataKey:"name"}),d.jsx(Dh,{}),d.jsx(Sl,{}),d.jsx(qu,{dataKey:"value",fill:"hsl(var(--primary))",name:e("admin.reportsCount")})]})})})]}),d.jsxs(Nr,{children:[d.jsxs(Rn,{children:[d.jsx($n,{children:e("admin.reportsStatusDist")}),d.jsx(as,{children:e("admin.reportsStatusDistDesc")})]}),d.jsx(Mr,{children:d.jsx(Hm,{width:"100%",height:300,children:d.jsxs(mX,{children:[d.jsx(Zh,{data:[{name:e("admin.reportStatus.pending"),value:I.pending},{name:e("admin.reportStatus.reviewing"),value:I.reviewing},{name:e("admin.reportStatus.resolved"),value:I.resolved},{name:e("admin.reportStatus.dismissed"),value:I.dismissed}].filter(te=>te.value>0),cx:"50%",cy:"50%",labelLine:!1,label:({name:te,percent:ae})=>`${te}: ${(ae*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:[{color:"#FFA726"},{color:"#42A5F5"},{color:"#66BB6A"},{color:"#EF5350"}].map((te,ae)=>d.jsx(IT,{fill:te.color},`cell-${ae}`))}),d.jsx(Sl,{})]})})})]})]}),d.jsxs(Nr,{children:[d.jsxs(Rn,{children:[d.jsx("div",{className:"flex items-center justify-between",children:d.jsxs("div",{children:[d.jsx($n,{children:e("admin.allReports")}),d.jsx(as,{children:e("admin.manageReportsDesc")})]})}),d.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[d.jsxs("div",{className:"relative flex-1",children:[d.jsx(Xh,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),d.jsx(cr,{placeholder:e("admin.searchReports"),value:m,onChange:te=>y(te.target.value),className:"pl-10"})]}),d.jsxs(lw,{children:[d.jsx(cw,{asChild:!0,children:d.jsxs(Mt,{variant:"outline",className:"gap-2",children:[d.jsx(rN,{className:"w-4 h-4"}),e(S==="all"?"admin.allStatus":`admin.reportStatus.${S}`)]})}),d.jsxs(Jv,{align:"end",className:"bg-background",children:[d.jsx(Ta,{onClick:()=>b("all"),children:e("admin.allStatus")}),d.jsx(Ta,{onClick:()=>b("pending"),children:e("admin.reportStatus.pending")}),d.jsx(Ta,{onClick:()=>b("reviewing"),children:e("admin.reportStatus.reviewing")}),d.jsx(Ta,{onClick:()=>b("resolved"),children:e("admin.reportStatus.resolved")}),d.jsx(Ta,{onClick:()=>b("dismissed"),children:e("admin.reportStatus.dismissed")})]})]})]})]}),d.jsx(Mr,{children:d.jsxs("div",{className:"grid gap-4",children:[P==null?void 0:P.map(te=>{var ae;return d.jsx(Nr,{className:"p-4",children:d.jsxs("div",{className:"flex items-start justify-between gap-4",children:[d.jsxs("div",{className:"flex-1 space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[d.jsx(nP,{className:"w-4 h-4"}),d.jsx("span",{className:"font-medium",children:e(`admin.reportType.${te.target_type}`)}),K(te.status),d.jsx(sn,{variant:"outline",children:e(`report.reasons.${te.reason}`)})]}),d.jsxs("p",{className:"text-sm text-muted-foreground",children:[te.description.substring(0,150),te.description.length>150&&"..."]}),d.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[d.jsxs("span",{children:[e("admin.reportedBy"),": ",(ae=te.reporter)==null?void 0:ae.display_name]}),d.jsxs("span",{children:[e("admin.reportedAt"),":"," ",wg(new Date(te.created_at),{addSuffix:!0})]})]})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx(Mt,{variant:"outline",size:"sm",onClick:()=>ne(te),children:e("admin.viewReport")}),d.jsx(Mt,{variant:"ghost",size:"sm",onClick:()=>window.open(ee(te.target_type,te.target_id),"_blank"),children:d.jsx(D9,{className:"w-4 h-4"})})]})]})},te.id)}),(P==null?void 0:P.length)===0&&d.jsxs("div",{className:"text-center py-12",children:[d.jsx(nP,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),d.jsx("p",{className:"text-muted-foreground",children:e("admin.noReports")})]})]})})]})]}),d.jsx(fl,{open:!!r,onOpenChange:()=>n(null),children:d.jsxs(Jo,{className:"max-w-[90vw] sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[d.jsxs(Qo,{children:[d.jsxs(el,{children:[e("admin.viewReport")," - ",r==null?void 0:r.id]}),d.jsx(Ul,{children:e(`admin.reportType.${r==null?void 0:r.target_type}`)})]}),r&&d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[d.jsxs("div",{children:[d.jsxs("span",{className:"font-medium",children:[e("admin.reportedBy"),":"]})," ",(re=r.reporter)==null?void 0:re.display_name]}),d.jsxs("div",{children:[d.jsxs("span",{className:"font-medium",children:[e("admin.reportedAt"),":"]})," ",new Date(r.created_at).toLocaleString()]}),d.jsxs("div",{children:[d.jsxs("span",{className:"font-medium",children:[e("report.reason"),":"]})," ",e(`report.reasons.${r.reason}`)]}),d.jsxs("div",{children:[d.jsx("span",{className:"font-medium",children:"Status:"})," ",K(r.status)]})]}),d.jsxs("div",{children:[d.jsx("h4",{className:"font-medium mb-2",children:e("report.detailsLabel")}),d.jsx("p",{className:"text-sm whitespace-pre-wrap",children:r.description})]}),r.reporter_contact&&d.jsxs("div",{children:[d.jsx("h4",{className:"font-medium mb-2",children:e("report.contactLabel")}),d.jsx("p",{className:"text-sm",children:r.reporter_contact})]}),r.evidence_urls&&r.evidence_urls.length>0&&d.jsxs("div",{children:[d.jsx("h4",{className:"font-medium mb-2",children:e("report.evidenceLabel")}),d.jsx("ul",{className:"space-y-1",children:r.evidence_urls.map((te,ae)=>d.jsx("li",{children:d.jsxs("a",{href:te,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline flex items-center gap-1",children:[d.jsx(D9,{className:"w-3 h-3"}),te]})},ae))})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm font-medium",children:e("admin.updateStatus")}),d.jsxs(Qs,{value:h,onValueChange:i,children:[d.jsx(Gs,{children:d.jsx(ea,{})}),d.jsxs(Ws,{children:[d.jsx(nn,{value:"pending",children:e("admin.reportStatus.pending")}),d.jsx(nn,{value:"reviewing",children:e("admin.reportStatus.reviewing")}),d.jsx(nn,{value:"resolved",children:e("admin.reportStatus.resolved")}),d.jsx(nn,{value:"dismissed",children:e("admin.reportStatus.dismissed")})]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm font-medium",children:e("admin.adminNotes")}),d.jsx(hl,{value:s,onChange:te=>o(te.target.value),placeholder:"Add internal notes...",rows:4})]}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Mt,{variant:"outline",onClick:()=>n(null),children:e("common.cancel")}),d.jsx(Mt,{onClick:ie,disabled:W.isPending,children:W.isPending?d.jsxs(d.Fragment,{children:[d.jsx(_a,{className:"w-4 h-4 mr-2 animate-spin"}),e("common.loading")]}):e("admin.saveNotes")})]})]})]})})]})},Eit=jh({activity_id:bn().min(1,""),title_zh:bn().min(1,""),title_en:bn().min(1,""),title_pt:bn().min(1,""),description_zh:bn().optional(),description_en:bn().optional(),description_pt:bn().optional(),discount_type:ST(["percentage","fixed_amount"]).default("percentage"),discount_value:JD.number().min(0,""),min_order_amount:JD.number().min(0).optional(),max_discount_amount:JD.number().min(0).optional(),valid_from:bn().min(1,""),valid_until:bn().optional(),is_active:wT().default(!0),visible:wT().default(!0)});function Tit({open:e,onOpenChange:t,template:r}){const{t:n}=ci(),{toast:s}=Ri(),o=yNe();console.log("CouponFormDialog opened:",{open:e,hasTemplate:!!r});const{data:h,isLoading:i,error:m}=ei({queryKey:["activities"],queryFn:async()=>{console.log("Fetching activities...");try{const{data:b,error:T}=await Ct.from("activities").select("id, title_zh, title_en, title_pt").eq("visible",!0).order("created_at",{ascending:!1});if(T)throw console.error("Error fetching activities:",T),T;return console.log("Activities fetched:",b==null?void 0:b.length,b),b||[]}catch(b){throw console.error("Exception in activities query:",b),b}},enabled:e});V.useEffect(()=>{m&&(console.error("Activities query error in useEffect:",m),s({title:"",description:"",variant:"destructive"}))},[m,s]);const y=Ah({resolver:Ch(Eit),defaultValues:{activity_id:"",title_zh:"",title_en:"",title_pt:"",description_zh:"",description_en:"",description_pt:"",discount_type:"percentage",discount_value:0,min_order_amount:void 0,max_discount_amount:void 0,valid_from:new Date().toISOString().split("T")[0],valid_until:"",is_active:!0,visible:!0}});V.useEffect(()=>{var b;r?(console.log("Setting form for edit mode:",r.id),y.reset({activity_id:r.activity_id,title_zh:r.title_zh,title_en:r.title_en,title_pt:r.title_pt,description_zh:r.description_zh||"",description_en:r.description_en||"",description_pt:r.description_pt||"",discount_type:r.discount_type,discount_value:Number(r.discount_value),min_order_amount:r.min_order_amount?Number(r.min_order_amount):void 0,max_discount_amount:r.max_discount_amount?Number(r.max_discount_amount):void 0,valid_from:r.valid_from.split("T")[0],valid_until:((b=r.valid_until)==null?void 0:b.split("T")[0])||"",is_active:r.is_active,visible:r.visible})):e&&!r&&(console.log("Setting form for create mode"),y.reset({activity_id:"",title_zh:"",title_en:"",title_pt:"",description_zh:"",description_en:"",description_pt:"",discount_type:"percentage",discount_value:0,min_order_amount:void 0,max_discount_amount:void 0,valid_from:new Date().toISOString().split("T")[0],valid_until:"",is_active:!0,visible:!0}))},[r,e]);const S=async b=>{try{console.log("Form submitted:",b);const T={...b,min_order_amount:b.min_order_amount||null,max_discount_amount:b.max_discount_amount||null,valid_until:b.valid_until||null,description_zh:b.description_zh||null,description_en:b.description_en||null,description_pt:b.description_pt||null};r!=null&&r.id&&(T.id=r.id),console.log("Saving template data:",T),o.mutate(T,{onSuccess:()=>{console.log("Save successful"),s({title:"",description:""}),t(!1),y.reset()},onError:A=>{console.error("Error saving coupon template:",A),s({title:"",description:A.message||"",variant:"destructive"})}})}catch(T){console.error("Exception in onSubmit:",T),s({title:"",description:"",variant:"destructive"})}};return d.jsx(fl,{open:e,onOpenChange:t,children:d.jsxs(Jo,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[d.jsxs(Qo,{children:[d.jsx(el,{children:r?"":""}),d.jsx(Ul,{children:r?"":""})]}),m?d.jsxs("div",{className:"p-6 text-center",children:[d.jsx("p",{className:"text-destructive mb-4",children:""}),d.jsx(Mt,{onClick:()=>window.location.reload(),children:""})]}):d.jsx(r$,{...y,children:d.jsxs("form",{onSubmit:y.handleSubmit(S),className:"space-y-6",children:[d.jsx(Ki,{control:y.control,name:"activity_id",render:({field:b})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:" *"}),d.jsxs(Qs,{onValueChange:T=>{console.log("Activity selected:",T),b.onChange(T)},value:b.value,disabled:i,children:[d.jsx(Zi,{children:d.jsx(Gs,{children:d.jsx(ea,{placeholder:i?"...":""})})}),d.jsx(Ws,{children:i?d.jsx(nn,{value:"loading",disabled:!0,children:"..."}):h&&h.length>0?h.map(T=>d.jsx(nn,{value:T.id,children:T.title_zh},T.id)):d.jsx(nn,{value:"no-activities",disabled:!0,children:""})})]}),d.jsx(Om,{children:""}),d.jsx(ss,{})]})}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[d.jsx(Ki,{control:y.control,name:"title_zh",render:({field:b})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:" *"}),d.jsx(Zi,{children:d.jsx(cr,{placeholder:"",...b})}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:y.control,name:"title_en",render:({field:b})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:" *"}),d.jsx(Zi,{children:d.jsx(cr,{placeholder:"New User Exclusive",...b})}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:y.control,name:"title_pt",render:({field:b})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:" *"}),d.jsx(Zi,{children:d.jsx(cr,{placeholder:"Exclusivo Novo Usurio",...b})}),d.jsx(ss,{})]})})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[d.jsx(Ki,{control:y.control,name:"description_zh",render:({field:b})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:""}),d.jsx(Zi,{children:d.jsx(hl,{placeholder:"",...b})}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:y.control,name:"description_en",render:({field:b})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:""}),d.jsx(Zi,{children:d.jsx(hl,{placeholder:"Coupon description",...b})}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:y.control,name:"description_pt",render:({field:b})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:""}),d.jsx(Zi,{children:d.jsx(hl,{placeholder:"Descrio do cupom",...b})}),d.jsx(ss,{})]})})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsx(Ki,{control:y.control,name:"discount_type",render:({field:b})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:" *"}),d.jsxs(Qs,{onValueChange:b.onChange,value:b.value,children:[d.jsx(Zi,{children:d.jsx(Gs,{children:d.jsx(ea,{placeholder:""})})}),d.jsxs(Ws,{children:[d.jsx(nn,{value:"percentage",children:" (%)"}),d.jsx(nn,{value:"fixed_amount",children:" ()"})]})]}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:y.control,name:"discount_value",render:({field:b})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:" *"}),d.jsx(Zi,{children:d.jsx(cr,{type:"number",min:"0",step:"0.01",placeholder:y.watch("discount_type")==="percentage"?": 10 10%":": 5 5",...b})}),d.jsx(Om,{children:y.watch("discount_type")==="percentage"?" (0-100)":" ()"}),d.jsx(ss,{})]})})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsx(Ki,{control:y.control,name:"min_order_amount",render:({field:b})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:" ()"}),d.jsx(Zi,{children:d.jsx(cr,{type:"number",min:"0",step:"0.01",placeholder:": 20",...b,value:b.value||""})}),d.jsx(Om,{children:""}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:y.control,name:"max_discount_amount",render:({field:b})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:" ()"}),d.jsx(Zi,{children:d.jsx(cr,{type:"number",min:"0",step:"0.01",placeholder:": 10",...b,value:b.value||""})}),d.jsx(Om,{children:""}),d.jsx(ss,{})]})})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsx(Ki,{control:y.control,name:"valid_from",render:({field:b})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:" *"}),d.jsx(Zi,{children:d.jsx(cr,{type:"date",...b})}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:y.control,name:"valid_until",render:({field:b})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:""}),d.jsx(Zi,{children:d.jsx(cr,{type:"date",...b})}),d.jsx(Om,{children:""}),d.jsx(ss,{})]})})]}),d.jsxs("div",{className:"flex gap-6",children:[d.jsx(Ki,{control:y.control,name:"is_active",render:({field:b})=>d.jsxs(Hi,{className:"flex items-center space-x-2 space-y-0",children:[d.jsx(Zi,{children:d.jsx(wb,{checked:b.value,onCheckedChange:b.onChange})}),d.jsx(Xi,{className:"!mt-0",children:""})]})}),d.jsx(Ki,{control:y.control,name:"visible",render:({field:b})=>d.jsxs(Hi,{className:"flex items-center space-x-2 space-y-0",children:[d.jsx(Zi,{children:d.jsx(wb,{checked:b.value,onCheckedChange:b.onChange})}),d.jsx(Xi,{className:"!mt-0",children:""})]})})]}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Mt,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:o.isPending,children:n("common.cancel")}),d.jsx(Mt,{type:"submit",disabled:o.isPending,children:o.isPending?"...":""})]})]})})]})})}const Ait=()=>{ci(),Ri();const e=Jc(),{data:t,isLoading:r}=hNe(),n=vNe(),{getLocalizedField:s}=xc(),[o,h]=V.useState(""),[i,m]=V.useState(!1),[y,S]=V.useState(!1),[b,T]=V.useState(null),A=t==null?void 0:t.filter(P=>{const I=String(s(P,"title")||""),R=o.toLowerCase();return I.toLowerCase().includes(R)}),O=()=>{b&&n.mutate(b.id,{onSuccess:()=>{S(!1),T(null)}})};return d.jsx(xo,{children:d.jsxs("div",{className:"container mx-auto px-4 py-8",children:[d.jsxs(Nr,{children:[d.jsx(Rn,{children:d.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[d.jsxs("div",{children:[d.jsxs($n,{className:"flex items-center gap-2",children:[d.jsx(wv,{className:"w-6 h-6"}),""]}),d.jsx(as,{children:""})]}),d.jsxs(Mt,{onClick:()=>{T(null),m(!0)},children:[d.jsx(sp,{className:"w-4 h-4 mr-2"}),""]})]})}),d.jsxs(Mr,{children:[d.jsx("div",{className:"mb-6",children:d.jsxs("div",{className:"relative",children:[d.jsx(Xh,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),d.jsx(cr,{placeholder:"...",value:o,onChange:P=>h(P.target.value),className:"pl-10"})]})}),r?d.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"..."}):A&&A.length>0?d.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:A.map(P=>d.jsxs(Nr,{className:"hover:shadow-lg transition-shadow",children:[d.jsx(Rn,{children:d.jsxs("div",{className:"flex justify-between items-start",children:[d.jsxs("div",{className:"flex-1",children:[d.jsx($n,{className:"text-lg mb-1",children:s(P,"title")}),d.jsx(as,{className:"text-sm",children:s(P,"description")})]}),d.jsx("div",{className:"flex items-center gap-1 ml-2",children:d.jsx(sn,{variant:P.is_active?"default":"secondary",children:P.is_active?"":""})})]})}),d.jsx(Mr,{children:d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm text-muted-foreground",children:""}),d.jsx("div",{className:"flex items-center gap-1",children:P.discount_type==="percentage"?d.jsxs(d.Fragment,{children:[d.jsx(L_e,{className:"w-4 h-4"}),d.jsxs("span",{className:"font-semibold",children:[P.discount_value,"%"]})]}):d.jsxs(d.Fragment,{children:[d.jsx(qP,{className:"w-4 h-4"}),d.jsxs("span",{className:"font-semibold",children:["",P.discount_value]})]})})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm text-muted-foreground",children:""}),d.jsxs("span",{className:"text-sm",children:[ps(new Date(P.valid_from),"yyyy-MM-dd"),P.valid_until&&`  ${ps(new Date(P.valid_until),"yyyy-MM-dd")}`]})]}),d.jsxs("div",{className:"flex gap-2 pt-3 border-t",children:[d.jsxs(Mt,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>e(`/admin/coupons/${P.id}`),children:[d.jsx(AB,{className:"w-4 h-4 mr-1"}),""]}),d.jsxs(Mt,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>{T(P),m(!0)},children:[d.jsx(b2,{className:"w-4 h-4 mr-1"}),""]}),d.jsx(Mt,{variant:"destructive",size:"sm",onClick:()=>{T(P),S(!0)},children:d.jsx(Yh,{className:"w-4 h-4"})})]})]})})]},P.id))}):d.jsxs("div",{className:"text-center py-12",children:[d.jsx(wv,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),d.jsx("p",{className:"text-muted-foreground mb-4",children:o?"":""}),d.jsxs(Mt,{onClick:()=>m(!0),children:[d.jsx(sp,{className:"w-4 h-4 mr-2"}),""]})]})]})]}),d.jsx(Tit,{open:i,onOpenChange:P=>{m(P),P||T(null)},template:b},(b==null?void 0:b.id)||"new"),d.jsx(ko,{open:y,onOpenChange:S,children:d.jsxs(co,{children:[d.jsxs(uo,{children:[d.jsx(fo,{children:""}),d.jsxs(po,{children:[' "',b&&s(b,"title"),'"  ']})]}),d.jsxs(ho,{children:[d.jsx(mo,{children:""}),d.jsx(to,{onClick:O,children:""})]})]})})]})})},Cit=()=>{const{id:e}=GB(),t=Jc();ci();const{getLocalizedField:r}=xc(),[n,s]=V.useState(""),[o,h]=V.useState("all"),[i,m]=V.useState("all"),[y,S]=V.useState("all"),{data:b,isLoading:T}=ei({queryKey:["couponTemplate",e],queryFn:async()=>{const{data:z,error:$}=await Ct.from("coupon_templates").select("*").eq("id",e).single();if($)throw $;return z},enabled:!!e}),{data:A}=ei({queryKey:["activity",b==null?void 0:b.activity_id],queryFn:async()=>{const{data:z,error:$}=await Ct.from("activities").select("id, title_zh, title_en, title_pt").eq("id",b.activity_id).single();if($)throw $;return z},enabled:!!(b!=null&&b.activity_id)}),{data:O,isLoading:P}=ei({queryKey:["templateCouponCodes",e],queryFn:async()=>{const{data:z,error:$}=await Ct.from("coupon_codes").select(`
          *,
          user_coupons(
            id,
            user_id,
            claimed_at,
            used_at,
            source
          )
        `).eq("template_id",e).order("created_at",{ascending:!1});if($)throw $;return await Promise.all((z||[]).map(async K=>{const ee=await Promise.all((K.user_coupons||[]).map(async ne=>{const{data:ie}=await Ct.from("profiles").select("id, display_name, avatar_url").eq("id",ne.user_id).single();return{...ne,profiles:ie||{id:ne.user_id,display_name:"Unknown",avatar_url:null}}}));return{...K,user_coupons:ee}}))},enabled:!!e});if(T)return d.jsx(xo,{children:d.jsx("div",{className:"container mx-auto px-4 py-8",children:d.jsx("div",{className:"text-center py-12",children:"..."})})});if(!b)return d.jsx(xo,{children:d.jsx("div",{className:"container mx-auto px-4 py-8",children:d.jsxs("div",{className:"text-center py-12",children:[d.jsx("p",{className:"text-muted-foreground mb-4",children:""}),d.jsx(Mt,{onClick:()=>t("/admin/coupons"),children:""})]})})});const I=V.useMemo(()=>O?O.filter(z=>{const $=n.toLowerCase(),W=n===""||z.code.toLowerCase().includes($)||z.user_coupons.some(ie=>ie.profiles.display_name.toLowerCase().includes($)),K=o==="all"||o==="active"&&z.is_active||o==="inactive"&&!z.is_active,ee=i==="all"||i==="unclaimed"&&z.user_coupons.length===0||i==="claimed"&&z.user_coupons.length>0&&z.user_coupons.every(ie=>!ie.used_at)||i==="used"&&z.user_coupons.some(ie=>ie.used_at),ne=y==="all"||y==="share"&&z.user_coupons.some(ie=>ie.source==="share")||y==="other"&&z.user_coupons.some(ie=>ie.source!=="share");return W&&K&&ee&&ne}):[],[O,n,o,i,y]),R=(O==null?void 0:O.length)||0,M=(O==null?void 0:O.reduce((z,$)=>z+$.used_count,0))||0,F=(O==null?void 0:O.reduce((z,$)=>z+$.user_coupons.length,0))||0;return d.jsx(xo,{children:d.jsxs("div",{className:"container mx-auto px-4 py-8",children:[d.jsxs("div",{className:"mb-6",children:[d.jsxs(Mt,{variant:"ghost",onClick:()=>t("/admin/coupons"),className:"mb-4",children:[d.jsx(EB,{className:"w-4 h-4 mr-2"}),""]}),d.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[d.jsx(wv,{className:"w-8 h-8"}),""]})]}),d.jsxs("div",{className:"space-y-6",children:[d.jsxs(Nr,{children:[d.jsx(Rn,{children:d.jsx($n,{className:"text-lg",children:""})}),d.jsxs(Mr,{className:"space-y-4",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:""}),d.jsx("p",{className:"font-medium",children:A?d.jsx(ji,{to:`/activity/${A.id}`,className:"text-primary hover:underline",children:r(A,"title")}):"..."})]}),d.jsxs("div",{className:"flex gap-2",children:[!b.visible&&d.jsx(sn,{variant:"secondary",children:""}),!b.is_active&&d.jsx(sn,{variant:"secondary",children:""}),b.is_active&&d.jsx(sn,{children:""})]})]}),d.jsx(El,{}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:""}),d.jsxs("div",{className:"space-y-1",children:[d.jsxs("p",{children:[d.jsx("span",{className:"text-xs text-muted-foreground",children:""}),b.title_zh]}),d.jsxs("p",{children:[d.jsx("span",{className:"text-xs text-muted-foreground",children:"English"}),b.title_en]}),d.jsxs("p",{children:[d.jsx("span",{className:"text-xs text-muted-foreground",children:"Portugus"}),b.title_pt]})]})]}),(b.description_zh||b.description_en||b.description_pt)&&d.jsxs(d.Fragment,{children:[d.jsx(El,{}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:""}),d.jsxs("div",{className:"space-y-1 text-sm",children:[b.description_zh&&d.jsxs("p",{children:[d.jsx("span",{className:"text-xs text-muted-foreground",children:""}),b.description_zh]}),b.description_en&&d.jsxs("p",{children:[d.jsx("span",{className:"text-xs text-muted-foreground",children:"English"}),b.description_en]}),b.description_pt&&d.jsxs("p",{children:[d.jsx("span",{className:"text-xs text-muted-foreground",children:"Portugus"}),b.description_pt]})]})]})]}),d.jsx(El,{}),d.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-muted-foreground",children:""}),d.jsx("p",{className:"font-medium",children:b.discount_type==="percentage"?"":""})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-muted-foreground",children:""}),d.jsx("p",{className:"font-medium text-primary text-lg",children:b.discount_type==="percentage"?`${b.discount_value}%`:`${b.discount_value}`})]}),b.min_order_amount&&b.min_order_amount>0&&d.jsxs("div",{children:[d.jsx("p",{className:"text-muted-foreground",children:""}),d.jsxs("p",{className:"font-medium",children:["",b.min_order_amount]})]}),b.max_discount_amount&&b.max_discount_amount>0&&d.jsxs("div",{children:[d.jsx("p",{className:"text-muted-foreground",children:""}),d.jsxs("p",{className:"font-medium",children:["",b.max_discount_amount]})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-muted-foreground",children:""}),d.jsxs("p",{className:"font-medium",children:[R," "]})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-muted-foreground",children:""}),d.jsxs("p",{className:"font-medium",children:[F," "]})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-muted-foreground",children:""}),d.jsxs("p",{className:"font-medium",children:[M," "]})]})]}),d.jsx(El,{}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(yo,{className:"h-4 w-4 text-muted-foreground"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-muted-foreground",children:""}),d.jsxs("p",{className:"font-medium",children:[ps(new Date(b.valid_from),"yyyy-MM-dd"),b.valid_until?` - ${ps(new Date(b.valid_until),"yyyy-MM-dd")}`:" - "]})]})]})})]})]}),d.jsxs(Nr,{children:[d.jsx(Rn,{children:d.jsxs("div",{className:"space-y-4",children:[d.jsxs($n,{className:"text-lg flex items-center gap-2",children:[d.jsx(E_e,{className:"h-4 w-4"})," (",R,")"]}),O&&O.length>0&&d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[d.jsxs("div",{className:"relative",children:[d.jsx(Xh,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),d.jsx(cr,{placeholder:"",value:n,onChange:z=>s(z.target.value),className:"pl-9"})]}),d.jsxs(Qs,{value:o,onValueChange:z=>h(z),children:[d.jsx(Gs,{children:d.jsx(ea,{placeholder:""})}),d.jsxs(Ws,{children:[d.jsx(nn,{value:"all",children:""}),d.jsx(nn,{value:"active",children:""}),d.jsx(nn,{value:"inactive",children:""})]})]}),d.jsxs(Qs,{value:i,onValueChange:z=>m(z),children:[d.jsx(Gs,{children:d.jsx(ea,{placeholder:""})}),d.jsxs(Ws,{children:[d.jsx(nn,{value:"all",children:""}),d.jsx(nn,{value:"unclaimed",children:""}),d.jsx(nn,{value:"claimed",children:""}),d.jsx(nn,{value:"used",children:""})]})]}),d.jsxs(Qs,{value:y,onValueChange:z=>S(z),children:[d.jsx(Gs,{children:d.jsx(ea,{placeholder:""})}),d.jsxs(Ws,{children:[d.jsx(nn,{value:"all",children:""}),d.jsx(nn,{value:"share",children:""}),d.jsx(nn,{value:"other",children:""})]})]})]})]})}),d.jsx(Mr,{children:P?d.jsx("p",{className:"text-sm text-muted-foreground",children:"..."}):!O||O.length===0?d.jsx("p",{className:"text-sm text-muted-foreground",children:""}):I.length===0?d.jsx("p",{className:"text-sm text-muted-foreground",children:""}):d.jsxs("div",{className:"space-y-4",children:[d.jsxs("p",{className:"text-sm text-muted-foreground",children:[" ",I.length," / ",R," "]}),I.map(z=>d.jsxs("div",{className:"rounded-lg border bg-card p-4",children:[d.jsx("div",{className:"flex items-start justify-between mb-4",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-12 h-12 rounded bg-primary/10 flex items-center justify-center",children:d.jsx(wv,{className:"h-6 w-6 text-primary"})}),d.jsxs("div",{children:[d.jsx("code",{className:"font-mono font-semibold text-base",children:z.code}),d.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["",ps(new Date(z.created_at),"yyyy-MM-dd HH:mm")]}),d.jsxs("div",{className:"flex items-center gap-4 mt-1",children:[d.jsxs("p",{className:"text-xs text-muted-foreground",children:["",z.used_count," / ",z.usage_limit]}),d.jsx(sn,{variant:z.is_active?"default":"secondary",children:z.is_active?"":""})]})]})]})}),z.user_coupons.length>0?d.jsxs("div",{className:"space-y-2 pt-3 border-t",children:[d.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:""}),z.user_coupons.map($=>d.jsxs("div",{className:"flex items-center justify-between p-3 rounded-md bg-secondary/20",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsxs(Ju,{className:"h-10 w-10",children:[d.jsx(Qu,{src:$.profiles.avatar_url||void 0}),d.jsx(ed,{children:d.jsx(T0,{className:"h-5 w-5"})})]}),d.jsxs("div",{children:[d.jsx("p",{className:"font-medium",children:$.profiles.display_name}),d.jsxs("p",{className:"text-xs text-muted-foreground",children:["",ps(new Date($.claimed_at),"yyyy-MM-dd HH:mm")]}),$.source&&d.jsxs("p",{className:"text-xs text-muted-foreground",children:["",$.source==="share"?"":$.source]})]})]}),d.jsx(sn,{variant:$.used_at?"default":"secondary",children:$.used_at?` ${ps(new Date($.used_at),"MM-dd HH:mm")}`:""})]},$.id))]}):d.jsx("p",{className:"text-sm text-muted-foreground pt-3 border-t",children:""})]},z.id))]})})]})]})]})})},jit=()=>{const{user:e}=Kn();return ei({queryKey:["myActivityRequests",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ct.from("activity_requests").select("*").eq("requester_id",e.id).order("created_at",{ascending:!1});if(r)throw r;return t},enabled:!!e})},Pit=()=>ei({queryKey:["allActivityRequests"],queryFn:async()=>{const{data:e,error:t}=await Ct.from("activity_requests").select("*, profiles:requester_id(display_name, avatar_url)").order("created_at",{ascending:!1});if(t)throw t;return e}}),Oit=()=>{const{user:e}=Kn(),{toast:t}=Ri(),r=Mi();return Gi({mutationFn:async n=>{if(!e)throw new Error("User not authenticated");const{data:s,error:o}=await Ct.from("activity_requests").insert([{...n,requester_id:e.id}]).select().single();if(o)throw o;return s},onSuccess:()=>{r.invalidateQueries({queryKey:["myActivityRequests"]}),t({title:Pr.t("common.success"),description:""})},onError:n=>{t({title:Pr.t("common.error"),description:n.message||"",variant:"destructive"})}})},kit=()=>{const{user:e}=Kn(),{toast:t}=Ri(),r=Mi();return Gi({mutationFn:async({requestId:n,status:s,adminNotes:o})=>{if(!e)throw new Error("User not authenticated");const{data:h,error:i}=await Ct.from("activity_requests").select("*").eq("id",n).single();if(i)throw i;let m=null;if(s==="approved"){const{data:S,error:b}=await Ct.from("activities").insert([{creator_id:h.requester_id,title_zh:h.title_zh,title_en:h.title_en,title_pt:h.title_pt,intro_zh:h.intro_zh,intro_en:h.intro_en,intro_pt:h.intro_pt,content_zh:h.content_zh,content_en:h.content_en,content_pt:h.content_pt,image_url:h.image_url,start_date:h.start_date,end_date:h.end_date,service_type:h.service_type,badge_text_zh:h.badge_text_zh,badge_text_en:h.badge_text_en,badge_text_pt:h.badge_text_pt,badge_color:h.badge_color,visible:!0}]).select().single();if(b)throw b;m=S.id}const{error:y}=await Ct.from("activity_requests").update({status:s,admin_notes:o||null,reviewed_by:e.id,reviewed_at:new Date().toISOString(),created_activity_id:m}).eq("id",n);if(y)throw y;return{status:s,createdActivityId:m}},onSuccess:n=>{r.invalidateQueries({queryKey:["allActivityRequests"]}),r.invalidateQueries({queryKey:["activities"]}),t({title:Pr.t("common.success"),description:n.status==="approved"?"":""})},onError:n=>{t({title:Pr.t("common.error"),description:n.message,variant:"destructive"})}})},Gde=()=>{const{toast:e}=Ri(),t=Mi();return Gi({mutationFn:async r=>{const{error:n}=await Ct.from("activity_requests").delete().eq("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["myActivityRequests"]}),t.invalidateQueries({queryKey:["allActivityRequests"]}),e({title:Pr.t("common.success"),description:""})},onError:r=>{e({title:Pr.t("common.error"),description:r.message,variant:"destructive"})}})},Nit=()=>{const{t:e}=ci(),{data:t,isLoading:r}=Pit(),{getLocalizedField:n}=xc(),s=kit(),o=Gde(),[h,i]=V.useState(""),[m,y]=V.useState("all"),[S,b]=V.useState(!1),[T,A]=V.useState(!1),[O,P]=V.useState(!1),[I,R]=V.useState(null),[M,F]=V.useState("approved"),[z,$]=V.useState(""),W=t==null?void 0:t.filter(ne=>{const re=String(n(ne,"title")||"").toLowerCase().includes(h.toLowerCase()),te=m==="all"||ne.status===m;return re&&te}),K=ne=>{switch(ne){case"pending":return d.jsxs(sn,{variant:"secondary",className:"gap-1",children:[d.jsx(Kv,{className:"h-3 w-3"}),""]});case"approved":return d.jsxs(sn,{className:"gap-1 bg-green-500",children:[d.jsx(UP,{className:"h-3 w-3"}),""]});case"rejected":return d.jsxs(sn,{variant:"destructive",className:"gap-1",children:[d.jsx(VP,{className:"h-3 w-3"}),""]});default:return null}},ee=()=>{I&&(s.mutate({requestId:I.id,status:M,adminNotes:z||void 0}),b(!1),R(null),$(""))};return r?d.jsx(xo,{children:d.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:d.jsx("p",{className:"text-muted-foreground",children:e("common.loading")})})}):d.jsx(xo,{children:d.jsxs("div",{className:"space-y-6",children:[d.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:""}),d.jsx("p",{className:"text-muted-foreground mt-2",children:""})]})}),d.jsx(Nr,{children:d.jsx(Mr,{className:"pt-6",children:d.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[d.jsxs("div",{className:"relative flex-1",children:[d.jsx(Xh,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),d.jsx(cr,{placeholder:"...",value:h,onChange:ne=>i(ne.target.value),className:"pl-10"})]}),d.jsxs(Qs,{value:m,onValueChange:y,children:[d.jsx(Gs,{className:"w-[180px]",children:d.jsx(ea,{placeholder:""})}),d.jsxs(Ws,{children:[d.jsx(nn,{value:"all",children:""}),d.jsx(nn,{value:"pending",children:""}),d.jsx(nn,{value:"approved",children:""}),d.jsx(nn,{value:"rejected",children:""})]})]})]})})}),d.jsx("div",{className:"grid gap-4",children:!W||W.length===0?d.jsx(Nr,{children:d.jsxs(Mr,{className:"flex flex-col items-center justify-center py-12",children:[d.jsx(yo,{className:"h-12 w-12 text-muted-foreground mb-4"}),d.jsx("p",{className:"text-lg font-medium",children:""})]})}):W.map(ne=>{var ie;return d.jsxs(Nr,{children:[d.jsx(Rn,{children:d.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[d.jsxs("div",{className:"flex-1",children:[d.jsxs($n,{className:"text-lg md:text-xl flex items-center gap-2",children:[d.jsx(yo,{className:"h-5 w-5"}),n(ne,"title")]}),d.jsxs(as,{className:"mt-2 flex items-center gap-2",children:[d.jsx(T0,{className:"h-3 w-3"}),((ie=ne.profiles)==null?void 0:ie.display_name)||"",d.jsx("span",{children:""}),ps(new Date(ne.created_at),"yyyy-MM-dd HH:mm")]})]}),K(ne.status)]})}),d.jsx(Mr,{children:d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"text-sm text-muted-foreground",children:["",ps(new Date(ne.start_date),"yyyy-MM-dd"),ne.end_date?` - ${ps(new Date(ne.end_date),"yyyy-MM-dd")}`:" - "]}),n(ne,"intro")&&d.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:n(ne,"intro")}),ne.admin_notes&&d.jsxs("div",{className:"p-3 rounded-lg bg-muted",children:[d.jsx("p",{className:"text-sm font-medium mb-1",children:""}),d.jsx("p",{className:"text-sm text-muted-foreground",children:ne.admin_notes})]}),d.jsxs("div",{className:"flex gap-2 flex-wrap",children:[d.jsxs(Mt,{variant:"outline",size:"sm",onClick:()=>{R(ne),A(!0)},children:[d.jsx(AB,{className:"mr-2 h-3 w-3"}),""]}),ne.status==="pending"&&d.jsxs(d.Fragment,{children:[d.jsxs(Mt,{size:"sm",onClick:()=>{R(ne),F("approved"),b(!0)},children:[d.jsx(UP,{className:"mr-2 h-3 w-3"}),""]}),d.jsxs(Mt,{variant:"destructive",size:"sm",onClick:()=>{R(ne),F("rejected"),b(!0)},children:[d.jsx(VP,{className:"mr-2 h-3 w-3"}),""]})]}),d.jsxs(Mt,{variant:"outline",size:"sm",onClick:()=>{R(ne),P(!0)},children:[d.jsx(Yh,{className:"mr-2 h-3 w-3"}),""]})]})]})})]},ne.id)})}),d.jsx(fl,{open:S,onOpenChange:b,children:d.jsxs(Jo,{children:[d.jsxs(Qo,{children:[d.jsx(el,{children:M==="approved"?"":""}),d.jsx(Ul,{children:M==="approved"?"":""})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium mb-2",children:""}),d.jsx("p",{className:"text-sm text-muted-foreground",children:I&&n(I,"title")})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium mb-2",children:""}),d.jsx(hl,{placeholder:M==="approved"?"...":"...",value:z,onChange:ne=>$(ne.target.value)})]})]}),d.jsxs(Qv,{children:[d.jsx(Mt,{variant:"outline",onClick:()=>{b(!1),R(null),$("")},children:""}),d.jsx(Mt,{variant:M==="approved"?"default":"destructive",onClick:ee,disabled:s.isPending,children:s.isPending?"...":M==="approved"?"":""})]})]})}),d.jsx(fl,{open:T,onOpenChange:A,children:d.jsxs(Jo,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[d.jsx(Qo,{children:d.jsx(el,{children:""})}),I&&d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium mb-1",children:""}),d.jsx("p",{className:"text-sm text-muted-foreground",children:I.title_zh})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium mb-1",children:""}),d.jsx("p",{className:"text-sm text-muted-foreground",children:I.title_en})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium mb-1",children:""}),d.jsx("p",{className:"text-sm text-muted-foreground",children:I.title_pt})]})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium mb-1",children:""}),d.jsx("p",{className:"text-sm text-muted-foreground",children:I.intro_zh||"-"})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium mb-1",children:""}),d.jsx("p",{className:"text-sm text-muted-foreground",children:I.intro_en||"-"})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium mb-1",children:""}),d.jsx("p",{className:"text-sm text-muted-foreground",children:I.intro_pt||"-"})]})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium mb-1",children:""}),d.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:I.content_zh})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium mb-1",children:""}),d.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:I.content_en})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium mb-1",children:""}),d.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:I.content_pt})]})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium mb-1",children:""}),d.jsx("p",{className:"text-sm text-muted-foreground",children:ps(new Date(I.start_date),"yyyy-MM-dd")})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium mb-1",children:""}),d.jsx("p",{className:"text-sm text-muted-foreground",children:I.end_date?ps(new Date(I.end_date),"yyyy-MM-dd"):""})]})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium mb-1",children:""}),d.jsx("p",{className:"text-sm text-muted-foreground",children:I.service_type==="dine_in"?"":I.service_type==="takeaway"?"":"+"})]}),I.image_url&&d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium mb-1",children:""}),d.jsx("img",{src:I.image_url,alt:"",className:"rounded-lg max-w-full h-auto max-h-48 object-cover"})]})]})]})}),d.jsx(ko,{open:O,onOpenChange:P,children:d.jsxs(co,{children:[d.jsxs(uo,{children:[d.jsx(fo,{children:""}),d.jsx(po,{children:""})]}),d.jsxs(ho,{children:[d.jsx(mo,{onClick:()=>R(null),children:""}),d.jsx(to,{onClick:()=>{I&&(o.mutate(I.id),P(!1),R(null))},children:""})]})]})})]})})},Iit=()=>{Kn();const e=Jc(),{t}=ci(),{isMerchant:r,isSupervisor:n,isLoading:s}=_c(),{data:o=[],isLoading:h}=F2(),{localizeRestaurant:i}=xc();return!s&&!r&&!n?(e("/"),null):h||s?d.jsx("div",{className:"container mx-auto px-4 py-8 flex justify-center items-center min-h-[50vh]",children:d.jsx(_a,{className:"w-8 h-8 animate-spin text-primary"})}):d.jsxs("div",{className:"container mx-auto px-4 py-8",children:[d.jsxs("div",{className:"mb-8",children:[d.jsx("h1",{className:"text-3xl font-bold mb-2",children:t("merchant.myRestaurants")}),d.jsx("p",{className:"text-muted-foreground",children:t(n?"merchant.supervisorDescription":"merchant.merchantDescription")})]}),o.length===0?d.jsx(Nr,{children:d.jsx(Mr,{className:"py-12 text-center",children:d.jsx("p",{className:"text-muted-foreground mb-4",children:t("merchant.noRestaurants")})})}):d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(m=>{const y=i(m);return d.jsxs(Nr,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[d.jsx("div",{className:"relative h-48 overflow-hidden",children:d.jsx("img",{src:m.image_url||"/placeholder.svg",alt:y.name,className:"w-full h-full object-cover"})}),d.jsx(Rn,{children:d.jsxs($n,{className:"flex items-start justify-between gap-2",children:[d.jsx("span",{className:"line-clamp-1",children:y.name}),m.rating&&d.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[d.jsx(Al,{className:"w-4 h-4 fill-primary text-primary"}),d.jsx("span",{children:m.rating})]})]})}),d.jsxs(Mr,{className:"space-y-3",children:[m.type&&m.type.length>0&&d.jsx("div",{className:"flex flex-wrap gap-1",children:y.type.slice(0,3).map((S,b)=>d.jsx("span",{className:"text-xs px-2 py-1 bg-secondary text-secondary-foreground rounded",children:S},b))}),m.address&&d.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[d.jsx(Pa,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),d.jsx("span",{className:"line-clamp-2",children:m.address})]}),m.phone&&d.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[d.jsx(Jb,{className:"w-4 h-4 flex-shrink-0"}),d.jsx("span",{children:m.phone})]}),m.website_url&&d.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[d.jsx(fv,{className:"w-4 h-4 flex-shrink-0"}),d.jsx("a",{href:m.website_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline line-clamp-1",children:t("restaurant.visitWebsite")})]}),d.jsxs("div",{className:"flex gap-2 pt-2",children:[d.jsx(Mt,{asChild:!0,variant:"outline",size:"sm",className:"flex-1",children:d.jsx(ji,{to:`/restaurant/${m.id}`,children:t("restaurants.viewDetails")})}),d.jsx(CO,{restaurant:m,trigger:d.jsxs(Mt,{variant:"default",size:"sm",className:"flex-1",children:[d.jsx(b2,{className:"w-4 h-4 mr-1"}),t("common.edit")]})})]})]})]},m.id)})})]})},Rit=()=>{const{t:e}=ci(),t=Jc(),{user:r}=Kn(),{isMerchant:n,isSupervisor:s}=_c(),{data:o,isLoading:h}=jit(),{getLocalizedField:i}=xc(),m=Gde(),[y,S]=V.useState(!1),[b,T]=V.useState(null);if(!r||!n&&!s)return d.jsxs("div",{className:"min-h-screen bg-background",children:[d.jsx(N0,{}),d.jsx("div",{className:"container mx-auto px-4 py-8",children:d.jsx(Nr,{children:d.jsxs(Mr,{className:"flex flex-col items-center justify-center py-12",children:[d.jsx(eN,{className:"h-12 w-12 text-muted-foreground mb-4"}),d.jsx("p",{className:"text-lg font-medium",children:""}),d.jsx("p",{className:"text-sm text-muted-foreground",children:""})]})})})]});const A=O=>{switch(O){case"pending":return d.jsxs(sn,{variant:"secondary",className:"gap-1",children:[d.jsx(Kv,{className:"h-3 w-3"}),""]});case"approved":return d.jsxs(sn,{className:"gap-1 bg-green-500",children:[d.jsx(UP,{className:"h-3 w-3"}),""]});case"rejected":return d.jsxs(sn,{variant:"destructive",className:"gap-1",children:[d.jsx(VP,{className:"h-3 w-3"}),""]});default:return null}};return h?d.jsxs("div",{className:"min-h-screen bg-background",children:[d.jsx(N0,{}),d.jsx("div",{className:"container mx-auto px-4 py-8",children:d.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:d.jsx("p",{className:"text-muted-foreground",children:e("common.loading")})})})]}):d.jsxs("div",{className:"min-h-screen bg-background",children:[d.jsx(N0,{}),d.jsxs("div",{className:"container mx-auto px-4 py-8",children:[d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:""}),d.jsx("p",{className:"text-muted-foreground mt-2",children:""})]}),d.jsxs(Mt,{onClick:()=>t("/merchant/activity-requests/new"),children:[d.jsx(sp,{className:"mr-2 h-4 w-4"}),""]})]}),d.jsx("div",{className:"grid gap-4",children:!o||o.length===0?d.jsx(Nr,{children:d.jsxs(Mr,{className:"flex flex-col items-center justify-center py-12",children:[d.jsx(yo,{className:"h-12 w-12 text-muted-foreground mb-4"}),d.jsx("p",{className:"text-lg font-medium",children:""}),d.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:""}),d.jsxs(Mt,{onClick:()=>t("/merchant/activity-requests/new"),children:[d.jsx(sp,{className:"mr-2 h-4 w-4"}),""]})]})}):o.map(O=>d.jsxs(Nr,{children:[d.jsx(Rn,{children:d.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[d.jsxs("div",{className:"flex-1",children:[d.jsxs($n,{className:"text-lg md:text-xl flex items-center gap-2",children:[d.jsx(yo,{className:"h-5 w-5"}),i(O,"title")]}),d.jsxs(as,{className:"mt-2",children:["",ps(new Date(O.created_at),"yyyy-MM-dd HH:mm")]})]}),A(O.status)]})}),d.jsx(Mr,{children:d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"text-sm text-muted-foreground",children:["",ps(new Date(O.start_date),"yyyy-MM-dd"),O.end_date?` - ${ps(new Date(O.end_date),"yyyy-MM-dd")}`:" - "]}),O.admin_notes&&d.jsxs("div",{className:"p-3 rounded-lg bg-muted",children:[d.jsx("p",{className:"text-sm font-medium mb-1",children:""}),d.jsx("p",{className:"text-sm text-muted-foreground",children:O.admin_notes})]}),d.jsxs("div",{className:"flex gap-2 flex-wrap",children:[O.status==="approved"&&O.created_activity_id&&d.jsxs(Mt,{variant:"outline",size:"sm",onClick:()=>t(`/activity/${O.created_activity_id}`),children:[d.jsx(AB,{className:"mr-2 h-3 w-3"}),""]}),O.status==="pending"&&d.jsxs(Mt,{variant:"outline",size:"sm",onClick:()=>{T(O),S(!0)},children:[d.jsx(Yh,{className:"mr-2 h-3 w-3"}),""]})]})]})})]},O.id))})]}),d.jsx(ko,{open:y,onOpenChange:S,children:d.jsxs(co,{children:[d.jsxs(uo,{children:[d.jsx(fo,{children:""}),d.jsx(po,{children:""})]}),d.jsxs(ho,{children:[d.jsx(mo,{onClick:()=>T(null),children:""}),d.jsx(to,{onClick:()=>{b&&(m.mutate(b.id),S(!1),T(null))},children:""})]})]})})]})]})};var xU="Radio",[Mit,Wde]=Mo(xU),[Dit,Lit]=Mit(xU),Kde=V.forwardRef((e,t)=>{const{__scopeRadio:r,name:n,checked:s=!1,required:o,disabled:h,value:i="on",onCheck:m,form:y,...S}=e,[b,T]=V.useState(null),A=Un(t,I=>T(I)),O=V.useRef(!1),P=b?y||!!b.closest("form"):!0;return d.jsxs(Dit,{scope:r,checked:s,disabled:h,children:[d.jsx(ln.button,{type:"button",role:"radio","aria-checked":s,"data-state":Jde(s),"data-disabled":h?"":void 0,disabled:h,value:i,...S,ref:A,onClick:Ir(e.onClick,I=>{s||m==null||m(),P&&(O.current=I.isPropagationStopped(),O.current||I.stopPropagation())})}),P&&d.jsx(Yde,{control:b,bubbles:!O.current,name:n,value:i,checked:s,required:o,disabled:h,form:y,style:{transform:"translateX(-100%)"}})]})});Kde.displayName=xU;var Zde="RadioIndicator",Xde=V.forwardRef((e,t)=>{const{__scopeRadio:r,forceMount:n,...s}=e,o=Lit(Zde,r);return d.jsx(Do,{present:n||o.checked,children:d.jsx(ln.span,{"data-state":Jde(o.checked),"data-disabled":o.disabled?"":void 0,...s,ref:t})})});Xde.displayName=Zde;var Fit="RadioBubbleInput",Yde=V.forwardRef(({__scopeRadio:e,control:t,checked:r,bubbles:n=!0,...s},o)=>{const h=V.useRef(null),i=Un(h,o),m=L2(r),y=S2(t);return V.useEffect(()=>{const S=h.current;if(!S)return;const b=window.HTMLInputElement.prototype,A=Object.getOwnPropertyDescriptor(b,"checked").set;if(m!==r&&A){const O=new Event("click",{bubbles:n});A.call(S,r),S.dispatchEvent(O)}},[m,r,n]),d.jsx(ln.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...s,tabIndex:-1,ref:i,style:{...s.style,...y,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Yde.displayName=Fit;function Jde(e){return e?"checked":"unchecked"}var zit=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],qI="RadioGroup",[Bit,yst]=Mo(qI,[ow,Wde]),Qde=ow(),ehe=Wde(),[$it,Uit]=Bit(qI),the=V.forwardRef((e,t)=>{const{__scopeRadioGroup:r,name:n,defaultValue:s,value:o,required:h=!1,disabled:i=!1,orientation:m,dir:y,loop:S=!0,onValueChange:b,...T}=e,A=Qde(r),O=Zv(y),[P,I]=Zc({prop:o,defaultProp:s??null,onChange:b,caller:qI});return d.jsx($it,{scope:r,name:n,required:h,disabled:i,value:P,onValueChange:I,children:d.jsx(c5,{asChild:!0,...A,orientation:m,dir:O,loop:S,children:d.jsx(ln.div,{role:"radiogroup","aria-required":h,"aria-orientation":m,"data-disabled":i?"":void 0,dir:O,...T,ref:t})})})});the.displayName=qI;var rhe="RadioGroupItem",nhe=V.forwardRef((e,t)=>{const{__scopeRadioGroup:r,disabled:n,...s}=e,o=Uit(rhe,r),h=o.disabled||n,i=Qde(r),m=ehe(r),y=V.useRef(null),S=Un(t,y),b=o.value===s.value,T=V.useRef(!1);return V.useEffect(()=>{const A=P=>{zit.includes(P.key)&&(T.current=!0)},O=()=>T.current=!1;return document.addEventListener("keydown",A),document.addEventListener("keyup",O),()=>{document.removeEventListener("keydown",A),document.removeEventListener("keyup",O)}},[]),d.jsx(u5,{asChild:!0,...i,focusable:!h,active:b,children:d.jsx(Kde,{disabled:h,required:o.required,checked:b,...m,...s,name:o.name,ref:S,onCheck:()=>o.onValueChange(s.value),onKeyDown:Ir(A=>{A.key==="Enter"&&A.preventDefault()}),onFocus:Ir(s.onFocus,()=>{var A;T.current&&((A=y.current)==null||A.click())})})})});nhe.displayName=rhe;var Vit="RadioGroupIndicator",ihe=V.forwardRef((e,t)=>{const{__scopeRadioGroup:r,...n}=e,s=ehe(r);return d.jsx(Xde,{...s,...n,ref:t})});ihe.displayName=Vit;var she=the,ahe=nhe,qit=ihe;const ohe=V.forwardRef(({className:e,...t},r)=>d.jsx(she,{className:fr("grid gap-2",e),...t,ref:r}));ohe.displayName=she.displayName;const E4=V.forwardRef(({className:e,...t},r)=>d.jsx(ahe,{ref:r,className:fr("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:d.jsx(qit,{className:"flex items-center justify-center",children:d.jsx(CQ,{className:"h-2.5 w-2.5 fill-current text-current"})})}));E4.displayName=ahe.displayName;const Hit=jh({title_zh:bn().min(1,""),title_en:bn().min(1,""),title_pt:bn().min(1,""),intro_zh:bn().optional(),intro_en:bn().optional(),intro_pt:bn().optional(),content_zh:bn().min(1,""),content_en:bn().min(1,""),content_pt:bn().min(1,""),image_url:bn().url().optional().or(Kke("")),start_date:bn().min(1,""),end_date:bn().optional(),service_type:ST(["dine_in","takeaway","both"]),badge_text_zh:bn().optional(),badge_text_en:bn().optional(),badge_text_pt:bn().optional(),badge_color:bn().optional()}),Git=()=>{ci();const e=Jc(),{user:t}=Kn(),{isMerchant:r,isSupervisor:n}=_c(),s=Oit(),[o,h]=V.useState(!1),[i,m]=V.useState("upload"),[y,S]=V.useState(""),[b,T]=V.useState(!1),[A,O]=V.useState(""),P=V.useRef(null),I=async $=>{if(t){if($.size>5*1024*1024){Po({title:"",description:"5MB",variant:"destructive"});return}T(!0);try{const W=$.name.split(".").pop(),ee=`activity-requests/${`${t.id}-${Date.now()}.${W}`}`,{error:ne}=await Ct.storage.from("activity-images").upload(ee,$);if(ne)throw ne;const{data:{publicUrl:ie}}=Ct.storage.from("activity-images").getPublicUrl(ee);S(ie),O(ie),Po({title:"",description:""})}catch(W){console.error("Upload error:",W),Po({title:"",description:"",variant:"destructive"})}finally{T(!1)}}},R=$=>{var K;const W=(K=$.target.files)==null?void 0:K[0];W&&I(W)},M=()=>{S(""),O(""),P.current&&(P.current.value="")},F=Ah({resolver:Ch(Hit),defaultValues:{title_zh:"",title_en:"",title_pt:"",intro_zh:"",intro_en:"",intro_pt:"",content_zh:"",content_en:"",content_pt:"",image_url:"",start_date:new Date().toISOString().split("T")[0],end_date:"",service_type:"both",badge_text_zh:"",badge_text_en:"",badge_text_pt:"",badge_color:"#9b87f5"}});if(!t||!r&&!n)return d.jsxs("div",{className:"min-h-screen bg-background",children:[d.jsx(N0,{}),d.jsx("div",{className:"container mx-auto px-4 py-8",children:d.jsx(Nr,{children:d.jsxs(Mr,{className:"flex flex-col items-center justify-center py-12",children:[d.jsx(eN,{className:"h-12 w-12 text-muted-foreground mb-4"}),d.jsx("p",{className:"text-lg font-medium",children:""}),d.jsx("p",{className:"text-sm text-muted-foreground",children:""})]})})})]});const z=async $=>{h(!0);try{const W=i==="upload"?y:$.image_url;await s.mutateAsync({title_zh:$.title_zh,title_en:$.title_en,title_pt:$.title_pt,intro_zh:$.intro_zh||null,intro_en:$.intro_en||null,intro_pt:$.intro_pt||null,content_zh:$.content_zh,content_en:$.content_en,content_pt:$.content_pt,image_url:W||null,start_date:$.start_date,end_date:$.end_date||null,service_type:$.service_type,badge_text_zh:$.badge_text_zh||null,badge_text_en:$.badge_text_en||null,badge_text_pt:$.badge_text_pt||null,badge_color:$.badge_color||"#9b87f5"}),e("/merchant/activity-requests")}finally{h(!1)}};return d.jsxs("div",{className:"min-h-screen bg-background",children:[d.jsx(N0,{}),d.jsx("div",{className:"container mx-auto px-4 py-8",children:d.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx(Mt,{variant:"ghost",size:"icon",onClick:()=>e("/merchant/activity-requests"),children:d.jsx(EB,{className:"h-4 w-4"})}),d.jsxs("div",{children:[d.jsx("h1",{className:"text-2xl font-bold",children:""}),d.jsx("p",{className:"text-muted-foreground",children:""})]})]}),d.jsxs(Nr,{children:[d.jsxs(Rn,{children:[d.jsxs($n,{className:"flex items-center gap-2",children:[d.jsx(yo,{className:"h-5 w-5"}),""]}),d.jsx(as,{children:""})]}),d.jsx(Mr,{children:d.jsx(r$,{...F,children:d.jsxs("form",{onSubmit:F.handleSubmit(z),className:"space-y-6",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[d.jsx(Ki,{control:F.control,name:"title_zh",render:({field:$})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:" *"}),d.jsx(Zi,{children:d.jsx(cr,{placeholder:"",...$})}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:F.control,name:"title_en",render:({field:$})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:" *"}),d.jsx(Zi,{children:d.jsx(cr,{placeholder:"Activity Title",...$})}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:F.control,name:"title_pt",render:({field:$})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:" *"}),d.jsx(Zi,{children:d.jsx(cr,{placeholder:"Ttulo da Atividade",...$})}),d.jsx(ss,{})]})})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[d.jsx(Ki,{control:F.control,name:"intro_zh",render:({field:$})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:""}),d.jsx(Zi,{children:d.jsx(cr,{placeholder:"",...$})}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:F.control,name:"intro_en",render:({field:$})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:""}),d.jsx(Zi,{children:d.jsx(cr,{placeholder:"Brief description",...$})}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:F.control,name:"intro_pt",render:({field:$})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:""}),d.jsx(Zi,{children:d.jsx(cr,{placeholder:"Descrio breve",...$})}),d.jsx(ss,{})]})})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[d.jsx(Ki,{control:F.control,name:"content_zh",render:({field:$})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:" *"}),d.jsx(Zi,{children:d.jsx(hl,{placeholder:"",rows:5,...$})}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:F.control,name:"content_en",render:({field:$})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:" *"}),d.jsx(Zi,{children:d.jsx(hl,{placeholder:"Detailed description",rows:5,...$})}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:F.control,name:"content_pt",render:({field:$})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:" *"}),d.jsx(Zi,{children:d.jsx(hl,{placeholder:"Descrio detalhada",rows:5,...$})}),d.jsx(ss,{})]})})]}),d.jsx("div",{className:"space-y-4",children:d.jsxs("div",{className:"space-y-3",children:[d.jsx(yr,{children:""}),d.jsxs(ohe,{value:i,onValueChange:$=>{m($),$==="url"?M():(F.setValue("image_url",""),O(""))},className:"flex gap-4",children:[d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx(E4,{value:"upload",id:"upload"}),d.jsxs(yr,{htmlFor:"upload",className:"flex items-center gap-1 cursor-pointer",children:[d.jsx(zh,{className:"h-4 w-4"}),""]})]}),d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx(E4,{value:"url",id:"url"}),d.jsxs(yr,{htmlFor:"url",className:"flex items-center gap-1 cursor-pointer",children:[d.jsx(k_e,{className:"h-4 w-4"}),"URL"]})]})]}),i==="upload"?d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(cr,{ref:P,type:"file",accept:"image/*",onChange:R,disabled:b,className:"flex-1"}),b&&d.jsx(_a,{className:"h-4 w-4 animate-spin"})]}),A&&d.jsxs("div",{className:"relative inline-block",children:[d.jsx("img",{src:A,alt:"Preview",className:"max-h-32 rounded-md border"}),d.jsx(Mt,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6",onClick:M,children:d.jsx(Xc,{className:"h-3 w-3"})})]}),d.jsx("p",{className:"text-xs text-muted-foreground",children:" JPGPNGWebP  5MB"})]}):d.jsx(Ki,{control:F.control,name:"image_url",render:({field:$})=>d.jsxs(Hi,{children:[d.jsx(Zi,{children:d.jsx(cr,{placeholder:"https://example.com/image.jpg",...$,onChange:W=>{$.onChange(W),O(W.target.value)}})}),A&&d.jsx("div",{className:"mt-2",children:d.jsx("img",{src:A,alt:"Preview",className:"max-h-32 rounded-md border",onError:()=>O("")})}),d.jsx(ss,{})]})})]})}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsx("div",{})," ",d.jsx(Ki,{control:F.control,name:"service_type",render:({field:$})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:" *"}),d.jsxs(Qs,{onValueChange:$.onChange,defaultValue:$.value,children:[d.jsx(Zi,{children:d.jsx(Gs,{children:d.jsx(ea,{placeholder:""})})}),d.jsxs(Ws,{children:[d.jsx(nn,{value:"dine_in",children:""}),d.jsx(nn,{value:"takeaway",children:""}),d.jsx(nn,{value:"both",children:"+"})]})]}),d.jsx(ss,{})]})})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsx(Ki,{control:F.control,name:"start_date",render:({field:$})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:" *"}),d.jsx(Zi,{children:d.jsx(cr,{type:"date",...$})}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:F.control,name:"end_date",render:({field:$})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:""}),d.jsx(Zi,{children:d.jsx(cr,{type:"date",...$})}),d.jsx(Om,{children:""}),d.jsx(ss,{})]})})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[d.jsx(Ki,{control:F.control,name:"badge_text_zh",render:({field:$})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:""}),d.jsx(Zi,{children:d.jsx(cr,{placeholder:"",...$})}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:F.control,name:"badge_text_en",render:({field:$})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:""}),d.jsx(Zi,{children:d.jsx(cr,{placeholder:"New",...$})}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:F.control,name:"badge_text_pt",render:({field:$})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:""}),d.jsx(Zi,{children:d.jsx(cr,{placeholder:"Novo",...$})}),d.jsx(ss,{})]})}),d.jsx(Ki,{control:F.control,name:"badge_color",render:({field:$})=>d.jsxs(Hi,{children:[d.jsx(Xi,{children:""}),d.jsx(Zi,{children:d.jsx(cr,{type:"color",...$})}),d.jsx(ss,{})]})})]}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Mt,{type:"button",variant:"outline",onClick:()=>e("/merchant/activity-requests"),disabled:o,children:""}),d.jsx(Mt,{type:"submit",disabled:o,children:o?"...":""})]})]})})})]})]})})]})},Wit=new swe,Kit=()=>d.jsx(uwe,{client:Wit,children:d.jsxs(xee,{children:[d.jsx(Exe,{}),d.jsx(r0e,{}),d.jsx(v1e,{children:d.jsxs(NEe,{children:[d.jsx(lPe,{}),d.jsx(N0,{}),d.jsx("div",{className:"pt-14 sm:pt-16",children:d.jsxs(d1e,{children:[d.jsx(ma,{path:"/",element:d.jsx(fPe,{})}),d.jsx(ma,{path:"/restaurants",element:d.jsx(RPe,{})}),d.jsx(ma,{path:"/restaurant/:id",element:d.jsx(aNe,{})}),d.jsx(ma,{path:"/map",element:d.jsx(oNe,{})}),d.jsx(ma,{path:"/activities",element:d.jsx(uNe,{})}),d.jsx(ma,{path:"/activity/:id",element:d.jsx(_Ne,{})}),d.jsx(ma,{path:"/auth",element:d.jsx(xNe,{})}),d.jsx(ma,{path:"/profile",element:d.jsx(wIe,{})}),d.jsx(ma,{path:"/join-us",element:d.jsx(SIe,{})}),d.jsx(ma,{path:"/merchant-restaurants",element:d.jsx(Iit,{})}),d.jsx(ma,{path:"/merchant/activity-requests",element:d.jsx(Rit,{})}),d.jsx(ma,{path:"/merchant/activity-requests/new",element:d.jsx(Git,{})}),d.jsx(ma,{path:"/admin",element:d.jsx(Vtt,{})}),d.jsx(ma,{path:"/admin/users",element:d.jsx(Ytt,{})}),d.jsx(ma,{path:"/admin/restaurants",element:d.jsx(Qtt,{})}),d.jsx(ma,{path:"/admin/activities",element:d.jsx(Qnt,{})}),d.jsx(ma,{path:"/admin/coupons",element:d.jsx(Ait,{})}),d.jsx(ma,{path:"/admin/coupons/:id",element:d.jsx(Cit,{})}),d.jsx(ma,{path:"/admin/activity-requests",element:d.jsx(Nit,{})}),d.jsx(ma,{path:"/admin/logs",element:d.jsx(eit,{})}),d.jsx(ma,{path:"/admin/homepage",element:d.jsx(_it,{})}),d.jsx(ma,{path:"/admin/join-requests",element:d.jsx(wit,{})}),d.jsx(ma,{path:"/admin/reports",element:d.jsx(Sit,{})}),d.jsx(ma,{path:"*",element:d.jsx(EIe,{})})]})})]})})]})});XJ(document.getElementById("root")).render(d.jsx(Kit,{}));
