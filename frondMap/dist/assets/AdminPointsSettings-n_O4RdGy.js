import{p as X,r as d,j as e,bH as Y,al as ee,bT as B,bf as se,c7 as M,aZ as te,am as ne,w as i}from"./vendor-react-uNsGwLc7.js";import{h as _,C as w,m as C,E as k,$ as A,n as R,U as g,I as v,s as N}from"./index-CD9lV4AA.js";import{c as ie,d as ae}from"./usePoints-DGGdW3Dd.js";import{A as oe,a as re}from"./alert-CMWbWbRF.js";import{S as de}from"./switch-Dfi28Zc2.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-utils-vwQGbBim.js";import"./vendor-supabase-Db1-Oe2_.js";const fe=()=>{const{t:s}=X(),{data:r,isLoading:V}=ie(),p=ae(),[h,b]=d.useState(""),[x,L]=d.useState(""),[S,F]=d.useState(""),[f,q]=d.useState(""),[j,I]=d.useState(""),[G,H]=d.useState(!1),[P,U]=d.useState(""),[T,E]=d.useState(!1),[$,O]=d.useState(!1),[Z,z]=d.useState(!1),[c,u]=d.useState(null);if(d.useState(()=>{if(r){const t=r.find(n=>n.key==="comment_points"),o=r.find(n=>n.key==="min_comment_length"),a=r.find(n=>n.key==="post_points"),l=r.find(n=>n.key==="min_post_length"),m=r.find(n=>n.key==="post_require_media");t&&b(t.value),o&&L(o.value),a&&F(a.value),l&&q(l.value),m&&I(m.value)}}),r&&!h&&!x&&!S&&!f&&!j){const t=r.find(n=>n.key==="comment_points"),o=r.find(n=>n.key==="min_comment_length"),a=r.find(n=>n.key==="post_points"),l=r.find(n=>n.key==="min_post_length"),m=r.find(n=>n.key==="post_require_media");t&&!h&&b(t.value),o&&!x&&L(o.value),a&&!S&&F(a.value),l&&!f&&q(l.value),m&&!j&&I(m.value)}const J=async()=>{try{await Promise.all([p.mutateAsync({key:"comment_points",value:h}),p.mutateAsync({key:"min_comment_length",value:x}),p.mutateAsync({key:"post_points",value:S}),p.mutateAsync({key:"min_post_length",value:f}),p.mutateAsync({key:"post_require_media",value:j})]),i.success(s("admin.pointsSettings.saveSuccess")),H(!1)}catch{i.error(s("admin.pointsSettings.saveFailed"))}},y=(t,o)=>{t(o),H(!0)},K=async()=>{if(!P.trim()){i.error(s("admin.pointsSettings.enterEmailOrId"));return}z(!0),u(null);try{const t=P.trim();if(t.includes("@")){const{data:a,error:l}=await N.functions.invoke("get-user-emails");if(l)throw l;const m=a?.emails||{},n=Object.keys(m).find(D=>m[D]?.toLowerCase()===t.toLowerCase());if(n){const{data:D}=await N.from("profiles").select("display_name").eq("id",n).single();u({id:n,email:m[n],display_name:D?.display_name||s("common.unknownUser","Unknown User")}),i.success(s("admin.pointsSettings.userFound"))}else i.error(s("admin.pointsSettings.userNotFound"))}else{const{data:a,error:l}=await N.from("profiles").select("id, display_name").eq("id",t).single();if(l||!a){i.error(s("admin.pointsSettings.userNotFound"));return}u({id:a.id,email:s("admin.pointsSettings.foundById","(Found by ID)"),display_name:a.display_name||s("common.unknownUser","Unknown User")}),i.success(s("admin.pointsSettings.userFound"))}}catch(t){console.error("Search error:",t),i.error(s("admin.pointsSettings.searchFailed"))}finally{z(!1)}},Q=async()=>{if(!c){i.error(s("admin.pointsSettings.searchUserFirst"));return}E(!0);try{const t=new Date().toISOString().split("T")[0],{error:o,count:a}=await N.from("points_transactions").delete().eq("user_id",c.id).eq("type","comment").gte("created_at",t).lt("created_at",`${t}T23:59:59.999Z`);if(o)throw o;a===0?i.info(s("admin.pointsSettings.noRecordFound")):i.success(s("admin.pointsSettings.resetSuccess")),U(""),u(null)}catch(t){console.error("Reset error:",t),i.error(s("admin.pointsSettings.resetFailed"))}finally{E(!1)}},W=async()=>{if(!c){i.error(s("admin.pointsSettings.searchUserFirst"));return}O(!0);try{const t=new Date().toISOString().split("T")[0],{error:o,count:a}=await N.from("points_transactions").delete().eq("user_id",c.id).eq("type","post").gte("created_at",t).lt("created_at",`${t}T23:59:59.999Z`);if(o)throw o;a===0?i.info(s("admin.pointsSettings.noPostRecordFound")):i.success(s("admin.pointsSettings.resetPostSuccess")),U(""),u(null)}catch(t){console.error("Reset post error:",t),i.error(s("admin.pointsSettings.resetFailed"))}finally{O(!1)}};return V?e.jsx("div",{className:"p-6",children:s("common.loading")}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:s("admin.pointsSettings.title")}),e.jsx("p",{className:"text-muted-foreground",children:s("admin.pointsSettings.description")})]}),e.jsxs(_,{onClick:J,disabled:!G||p.isPending,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),s("common.save")]})]}),e.jsxs(oe,{children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx(re,{children:s("admin.pointsSettings.info")})]}),e.jsxs(w,{children:[e.jsxs(C,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5"}),s("admin.pointsSettings.commentSettings")]}),e.jsx(A,{children:s("admin.pointsSettings.commentSettingsDesc")})]}),e.jsx(R,{className:"space-y-6",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"commentPoints",children:s("admin.pointsSettings.commentPoints")}),e.jsx(v,{id:"commentPoints",type:"number",min:"0",value:h,onChange:t=>y(b,t.target.value),placeholder:"5"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("admin.pointsSettings.commentPointsHelp")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"minCommentLength",children:s("admin.pointsSettings.minCommentLength")}),e.jsx(v,{id:"minCommentLength",type:"number",min:"0",value:x,onChange:t=>y(L,t.target.value),placeholder:"10"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("admin.pointsSettings.minCommentLengthHelp")})]})]})})]}),e.jsxs(w,{children:[e.jsxs(C,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5"}),s("admin.pointsSettings.postSettings")]}),e.jsx(A,{children:s("admin.pointsSettings.postSettingsDesc")})]}),e.jsxs(R,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"postPoints",children:s("admin.pointsSettings.postPoints")}),e.jsx(v,{id:"postPoints",type:"number",min:"0",value:S,onChange:t=>y(F,t.target.value),placeholder:"5"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("admin.pointsSettings.postPointsHelp")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"minPostLength",children:s("admin.pointsSettings.minPostLength")}),e.jsx(v,{id:"minPostLength",type:"number",min:"0",value:f,onChange:t=>y(q,t.target.value),placeholder:"10"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("admin.pointsSettings.minPostLengthHelp")})]})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(g,{htmlFor:"postRequireMedia",className:"font-medium",children:s("admin.pointsSettings.postRequireMedia")})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("admin.pointsSettings.postRequireMediaHelp")})]}),e.jsx(de,{id:"postRequireMedia",checked:j==="true",onCheckedChange:t=>y(I,t?"true":"false")})]})]})]}),e.jsxs(w,{children:[e.jsx(C,{children:e.jsx(k,{children:s("admin.pointsSettings.rulesPreview")})}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:s("admin.pointsSettings.commentSettings")}),e.jsxs("p",{children:["• ",s("admin.pointsSettings.rule1")," ",e.jsx("strong",{children:x||"10"})," ",s("admin.pointsSettings.characters")]}),e.jsxs("p",{children:["• ",s("admin.pointsSettings.rule2")," ",e.jsx("strong",{children:h||"5"})," ",s("admin.pointsSettings.points")]}),e.jsxs("p",{children:["• ",s("admin.pointsSettings.rule3")]}),e.jsx("p",{className:"font-medium text-muted-foreground pt-2",children:s("admin.pointsSettings.postSettings")}),e.jsxs("p",{children:["• ",s("admin.pointsSettings.postRule2")," ",e.jsx("strong",{children:f||"10"})," ",s("admin.pointsSettings.characters")]}),j==="true"&&e.jsxs("p",{children:["• ",s("admin.pointsSettings.postRule3")]}),e.jsxs("p",{children:["• ",s("admin.pointsSettings.postRule")," ",e.jsx("strong",{children:S||"5"})," ",s("admin.pointsSettings.points")]}),e.jsxs("p",{children:["• ",s("admin.pointsSettings.rule4")]})]})})]}),e.jsxs(w,{children:[e.jsxs(C,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),s("admin.pointsSettings.testTools")]}),e.jsx(A,{children:s("admin.pointsSettings.testToolsDesc")})]}),e.jsx(R,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(g,{children:s("admin.pointsSettings.resetDailyComment")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{value:P,onChange:t=>{U(t.target.value),u(null)},placeholder:s("admin.pointsSettings.emailOrIdPlaceholder"),className:"flex-1"}),e.jsxs(_,{onClick:K,disabled:Z||!P.trim(),variant:"outline",children:[e.jsx(te,{className:`h-4 w-4 mr-2 ${Z?"animate-spin":""}`}),s("admin.pointsSettings.search")]})]}),c&&e.jsxs("div",{className:"p-3 bg-muted rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:c.display_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c.email}),e.jsx("p",{className:"text-xs text-muted-foreground font-mono",children:c.id})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(_,{onClick:Q,disabled:T,variant:"destructive",size:"sm",children:[e.jsx(M,{className:`h-4 w-4 mr-2 ${T?"animate-spin":""}`}),s("admin.pointsSettings.reset")]}),e.jsxs(_,{onClick:W,disabled:$,variant:"destructive",size:"sm",children:[e.jsx(M,{className:`h-4 w-4 mr-2 ${$?"animate-spin":""}`}),s("admin.pointsSettings.resetPost")]})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("admin.pointsSettings.resetHelp")})]})})]})]})};export{fe as default};
//# sourceMappingURL=AdminPointsSettings-n_O4RdGy.js.map
