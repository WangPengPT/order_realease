const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RestaurantComments-BCnKbwCW.js","assets/vendor-react-Dngtq_Sc.js","assets/vendor-i18n-jtdHZIRR.js","assets/vendor-editor-B1vH4T8i.js","assets/vendor-utils-vwQGbBim.js","assets/vendor-react-CG6K1Se3.css","assets/index-C6vDgFXl.js","assets/vendor-supabase-xpVHVj_9.js","assets/index--dNp9fp2.css","assets/ReportDialog-BqoJXIgw.js","assets/input-otp-CCEzO9RV.js","assets/useSensitiveWords-DUMGQcl4.js","assets/TranslateButton-C5Ow7ocY.js","assets/ImagePreviewModal-BU4Gx0lX.js"])))=>i.map(i=>d[i]);
import{S as j,C as E,m as J,n as H,E as Ve,g as He,s as We,a as Ie,h as y,F as Vt,G as Gt,J as Ut,K as Wt,L as Kt,M as Xt,j as Qt,B as W,_ as jt,u as Yt,N as Zt,O as it,i as Jt,A as se,q as ae,r as re,t as ne,v as le,w as ie,y as oe,o as Ce,x as ce,P as es,Q as ts,R as ss,T as de,U as ot}from"./index-C6vDgFXl.js";import{j as e,p as M,ba as ve,be as as,s as bt,r as a,bf as rs,bg as ns,b5 as ls,aw as Q,bh as Ye,W as wt,bi as vt,bj as Ze,H as is,I as os,z as cs,B as ds,ar as ms,F as xs,X as us,bk as me,bl as hs,bm as ps,bn as gs,bo as fs,bp as js,aM as fe,bq as ct,L as Ne,b0 as bs,br as ge,b9 as Nt,bs as yt,bt as _t,bu as ws,bv as vs,aW as Ns,bw as ys,bb as Ke,b4 as Te,y as kt,aY as ze,bx as _s,aO as ks,u as Cs,q as Ss,w as Fe,by as dt,bz as mt,bA as Ue,bB as Ts,bC as zs,bc as Is,a$ as Ps}from"./vendor-react-Dngtq_Sc.js";import{f as qe,a as Be}from"./textFormatting-B3QXZQ1a.js";import{S as Xe}from"./separator-DlMpzV6o.js";import{C as je,a as be,b as we}from"./collapsible-DPysomxU.js";import{d as Rs,a as Ds,c as Ls}from"./useRestaurants-Dr4venu3.js";import{u as Ct,R as xt}from"./ReportDialog-BqoJXIgw.js";import{u as Je}from"./useLocalizedContent-Dr5YHAdJ.js";import{f as Ms}from"./timeUtils-pgRxO0UB.js";import{g as Os,c as Es,o as ut}from"./geolocation-YPf7LJYy.js";import{m as Se}from"./vendor-map-CvE3ASYw.js";import{m as $s}from"./map-icon-DR07RZr_.js";import{P as As}from"./PullToRefresh-mbfFzvYW.js";import{u as Fs}from"./usePageView-DOHaNQcL.js";import{u as Hs}from"./ShareDrawer-D8pkWv2R.js";import{u as qs}from"./useActivityParticipation-BfqJZ-OG.js";import{u as St,R as ht}from"./RestaurantFormDialog-CghgUNAA.js";import{C as Tt,a as zt,b as It,c as Pt,d as Rt}from"./carousel-Cn7FaZFj.js";import{I as Dt}from"./ImagePreviewModal-BU4Gx0lX.js";import{P as Bs}from"./PostGridCard-DoVlRdv4.js";import{u as Lt}from"./useBrands-tbjjfPXp.js";import"./vendor-supabase-xpVHVj_9.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-utils-vwQGbBim.js";import"./input-otp-CCEzO9RV.js";import"./drawer-MrJIdRQG.js";import"./checkbox-B6D7EAiu.js";import"./switch-BGliSoEW.js";import"./radio-group-Ycphb8ee.js";import"./tabs-BdAQ6vZp.js";import"./RichTextEditor-C5aKPgVM.js";import"./useCommunityPosts-D6dTGMvy.js";import"./EditRecipeDialog-BCb0bHN6.js";import"./popover-BDvTLMgl.js";import"./useActivities-Cni4_d8i.js";import"./progress-D-hgNqRK.js";const Vs=()=>e.jsxs("div",{className:"min-h-screen bg-background pb-8",children:[e.jsxs("div",{className:"relative h-[30vh] sm:h-[35vh] overflow-hidden",children:[e.jsx(j,{className:"w-full h-full rounded-none"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/80 to-transparent"}),e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx(j,{className:"h-10 w-10 rounded-md"})}),e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[e.jsx(j,{className:"h-10 w-10 rounded-md"}),e.jsx(j,{className:"h-10 w-10 rounded-md"})]})]}),e.jsxs("div",{className:"container mx-auto px-4 -mt-16 relative z-10",children:[e.jsxs(E,{className:"shadow-large",children:[e.jsx(J,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-3 flex flex-wrap gap-2",children:[e.jsx(j,{className:"h-6 w-16 rounded-full"}),e.jsx(j,{className:"h-6 w-20 rounded-full"}),e.jsx(j,{className:"h-6 w-14 rounded-full"})]}),e.jsx(j,{className:"h-9 w-64 mb-3"}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx(j,{className:"h-5 w-20"}),e.jsx(j,{className:"h-5 w-24"}),e.jsx(j,{className:"h-5 w-16"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{className:"h-10 w-28 rounded-md"}),e.jsx(j,{className:"h-10 w-10 rounded-md"})]})]})}),e.jsxs(H,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{className:"h-5 w-24"}),e.jsx(j,{className:"h-16 w-full rounded-md"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{className:"h-5 w-32"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{className:"h-8 w-24 rounded-full"}),e.jsx(j,{className:"h-8 w-28 rounded-full"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(j,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(j,{className:"h-5 w-full"}),e.jsx(j,{className:"h-5 w-3/4"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{className:"h-5 w-5 flex-shrink-0"}),e.jsx(j,{className:"h-5 w-32"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(j,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(j,{className:"h-5 w-40"}),e.jsx(j,{className:"h-5 w-48"})]})]})]})]})]}),e.jsxs(E,{className:"mt-6 shadow-large",children:[e.jsx(J,{children:e.jsx(j,{className:"h-6 w-20"})}),e.jsx(H,{children:e.jsx(j,{className:"h-[200px] w-full rounded-lg"})})]}),e.jsxs(E,{className:"mt-6 shadow-large",children:[e.jsx(J,{children:e.jsx(j,{className:"h-6 w-24"})}),e.jsx(H,{children:e.jsx("div",{className:"flex gap-3 overflow-hidden",children:[1,2,3,4].map(t=>e.jsx(j,{className:"h-24 w-24 rounded-lg flex-shrink-0"},t))})})]}),e.jsxs(E,{className:"mt-6 shadow-large",children:[e.jsxs(J,{className:"flex flex-row items-center justify-between",children:[e.jsx(j,{className:"h-6 w-32"}),e.jsx(j,{className:"h-9 w-24 rounded-md"})]}),e.jsx(H,{className:"space-y-4",children:[1,2,3].map(t=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx(j,{className:"h-10 w-10 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-24"}),e.jsx(j,{className:"h-4 w-16"})]}),e.jsx(j,{className:"h-4 w-full"}),e.jsx(j,{className:"h-4 w-3/4"})]})]},t))})]})]})]}),Gs=[{value:"0-5",label:"0-5€"},{value:"5-10",label:"5-10€"},{value:"10-15",label:"10-15€"},{value:"15-20",label:"15-20€"},{value:"20-25",label:"20-25€"},{value:"25-30",label:"25-30€"},{value:"30-40",label:"30-40€"},{value:"40-50",label:"40-50€"},{value:"50+",label:"50€+"}],Mt=({restaurantId:t})=>{const{t:o}=M(),{data:s}=Ct(t,"restaurant"),l=s?.filter(r=>r.rating_value)||[],c=l.length?l.reduce((r,h)=>r+(h.rating_value||0),0)/l.length:0,d=[5,4,3,2,1].map(r=>({star:r,count:l.filter(h=>h.rating_value===r).length,percentage:l.length?(l.filter(h=>h.rating_value===r).length/l.length*100).toFixed(0):0})),m=l.reduce((r,h)=>(h.price_range&&(r[h.price_range]=(r[h.price_range]||0)+1),r),{}),u=m&&Object.keys(m).length>0?Object.entries(m).sort((r,h)=>h[1]-r[1])[0]:null;return e.jsxs(E,{children:[e.jsx(J,{children:e.jsx(Ve,{children:o("restaurant.rating")})}),e.jsxs(H,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-5xl font-bold",children:c.toFixed(1)}),e.jsx("div",{className:"flex items-center justify-center mt-2",children:[1,2,3,4,5].map(r=>e.jsx(ve,{className:He("w-5 h-5",r<=Math.round(c)?"fill-accent text-accent":"text-muted-foreground")},r))}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[l.length," ",o("restaurant.ratingsCount")]}),u&&e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-2 text-sm",children:[e.jsx(as,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-foreground",children:Gs.find(r=>r.value===u[0])?.label})]})]}),e.jsx("div",{className:"flex-1 space-y-2",children:d.map(({star:r,count:h,percentage:b})=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs("span",{className:"w-8",children:[r," ★"]}),e.jsx("div",{className:"flex-1 h-2 bg-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-accent transition-all",style:{width:`${b}%`}})}),e.jsx("span",{className:"w-12 text-right text-muted-foreground",children:h})]},r))})]}),e.jsx("div",{className:"pt-4 border-t text-center text-sm text-muted-foreground",children:o("restaurant.signInToRate")})]})]})},Us=t=>(M(),bt({queryKey:["restaurant-activities",t],queryFn:async()=>{const{data:o,error:s}=await We.from("activity_restaurants").select(`
          activity_id,
          activities (
            id,
            title_zh,
            title_en,
            title_pt,
            intro_zh,
            intro_en,
            intro_pt,
            badge_text_zh,
            badge_text_en,
            badge_text_pt,
            badge_color,
            start_date,
            end_date
          )
        `).eq("restaurant_id",t);if(s)throw s;const l=new Date;return o.filter(d=>{const m=d.activities;if(!m)return!1;const u=new Date(m.start_date),r=m.end_date?new Date(m.end_date):null;return u<=l&&(!r||r>=l)}).map(d=>({activity_id:d.activity_id,title_zh:d.activities.title_zh,title_en:d.activities.title_en,title_pt:d.activities.title_pt,intro_zh:d.activities.intro_zh,intro_en:d.activities.intro_en,intro_pt:d.activities.intro_pt,badge_text_zh:d.activities.badge_text_zh,badge_text_en:d.activities.badge_text_en,badge_text_pt:d.activities.badge_text_pt,badge_color:d.activities.badge_color}))},enabled:!!t})),Ot=(t,o)=>o==="zh"?t.title_zh:o==="pt"?t.title_pt:t.title_en,Qe=(t,o)=>{let s="";return o==="zh"?s=t.badge_text_zh||t.title_zh:o==="pt"?s=t.badge_text_pt||t.title_pt:s=t.badge_text_en||t.title_en,s},Et=(t,o)=>o==="zh"?t.intro_zh||"":o==="pt"?t.intro_pt||"":t.intro_en||"",pt="dish-gallery-view-mode";function $t({restaurantId:t,showGallery:o=!0}){const{t:s}=M(),{data:l=[],isLoading:c}=St(t),[d,m]=a.useState(!1),[u,r]=a.useState(0),[h,b]=a.useState(!1),g=Ie(),[k,N]=a.useState(()=>{if(typeof window<"u"){const f=localStorage.getItem(pt);return f==="single"||f==="multi"?f:"multi"}return"multi"});a.useEffect(()=>{localStorage.setItem(pt,k)},[k]);const S=a.useCallback(f=>{r(f),m(!0)},[]),z=a.useCallback(()=>{m(!1)},[]),I=a.useCallback(()=>{r(f=>f===0?l.length-1:f-1)},[l.length]),$=a.useCallback(()=>{r(f=>f===l.length-1?0:f+1)},[l.length]);if(a.useCallback(f=>{f.key==="ArrowLeft"&&I(),f.key==="ArrowRight"&&$(),f.key==="Escape"&&z()},[I,$,z]),c||!o||!l.length)return null;const q=()=>g&&k==="single"?"pl-2 basis-full":"pl-2 md:pl-4 basis-1/2 md:basis-1/3 lg:basis-1/4";return e.jsxs(e.Fragment,{children:[e.jsx(E,{children:e.jsxs(je,{open:!h,onOpenChange:f=>b(!f),children:[e.jsx(J,{className:"pb-3",children:e.jsx(be,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Ve,{className:"text-lg flex items-center gap-2",children:[e.jsx(rs,{className:"w-5 h-5"}),s("restaurant.photoGallery"),e.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["(",l.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[g&&e.jsxs("div",{className:"flex items-center gap-1 bg-muted rounded-md p-0.5",onClick:f=>f.stopPropagation(),children:[e.jsx(y,{variant:k==="single"?"default":"ghost",size:"icon",className:"h-7 w-7",onClick:f=>{f.stopPropagation(),N("single")},title:s("dishImages.singleView"),children:e.jsx(ns,{className:"h-4 w-4"})}),e.jsx(y,{variant:k==="multi"?"default":"ghost",size:"icon",className:"h-7 w-7",onClick:f=>{f.stopPropagation(),N("multi")},title:s("dishImages.multiView"),children:e.jsx(ls,{className:"h-4 w-4"})})]}),e.jsx(Q,{className:`w-5 h-5 text-muted-foreground transition-transform ${h?"":"rotate-180"}`})]})]})})}),e.jsx(we,{children:e.jsxs(H,{children:[e.jsxs(Tt,{className:"w-full",children:[e.jsx(zt,{className:"-ml-2 md:-ml-4",children:l.map((f,_)=>e.jsx(It,{className:q(),children:e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>S(_),children:e.jsx("img",{src:f.image_url,alt:`Dish ${_+1}`,className:"w-full h-full object-cover",loading:"lazy"})})},f.id))}),l.length>(g&&k==="single"?1:2)&&e.jsxs(e.Fragment,{children:[e.jsx(Pt,{className:"-left-3 md:-left-4"}),e.jsx(Rt,{className:"-right-3 md:-right-4"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2 text-center",children:s("dishImages.clickToEnlarge")})]})})]})}),d&&e.jsxs(e.Fragment,{children:[e.jsx(Dt,{imageUrl:l[u]?.image_url||"",isOpen:d,onClose:z}),l.length>1&&e.jsxs("div",{className:"fixed inset-0 z-[101] pointer-events-none",children:[e.jsx(y,{variant:"ghost",size:"icon",className:"absolute left-2 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 pointer-events-auto",onClick:f=>{f.stopPropagation(),I()},children:e.jsx(Ye,{className:"w-8 h-8"})}),e.jsx(y,{variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 pointer-events-auto",onClick:f=>{f.stopPropagation(),$()},children:e.jsx(wt,{className:"w-8 h-8"})}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-white bg-black/50 px-3 py-1 rounded-full text-sm pointer-events-auto",children:[u+1," / ",l.length]})]})]})]})}const Ws=({ownerBio:t,ownerName:o,ownerAvatarUrl:s,avatarFallback:l})=>{const{t:c}=M();return e.jsxs(Vt,{children:[e.jsx(Gt,{asChild:!0,children:e.jsxs(y,{variant:"ghost",size:"sm",className:"text-primary hover:text-primary/80 p-0 h-auto font-medium gap-1",children:[c("common.viewAll","查看全部"),e.jsx(wt,{className:"w-4 h-4"})]})}),e.jsxs(Ut,{side:"bottom",className:"max-h-[85vh] rounded-t-[10px] p-0",onPointerDownOutside:d=>d.preventDefault(),children:[e.jsx(Wt,{className:"p-4 pb-2",children:e.jsxs(Kt,{className:"flex items-center gap-2 text-lg",children:[e.jsx(vt,{className:"w-5 h-5 text-primary"}),c("restaurants.ownerStory","主理人")]})}),e.jsx(Xt,{className:"flex-1 px-4 pb-8 max-h-[calc(85vh-80px)]",children:e.jsxs("div",{className:"relative max-w-2xl mx-auto",children:[e.jsx(Ze,{className:"absolute -top-4 -left-2 w-12 h-12 text-primary/10 rotate-180"}),e.jsx("div",{className:"relative z-10 pt-6 space-y-4",children:e.jsx("p",{className:"text-base md:text-lg text-foreground leading-relaxed whitespace-pre-wrap first-letter:text-4xl first-letter:font-bold first-letter:text-primary first-letter:float-left first-letter:mr-2 first-letter:mt-1",children:t})}),e.jsxs("div",{className:"mt-8 flex items-center gap-3 pt-6 border-t",children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gradient-to-br from-primary to-accent flex items-center justify-center text-primary-foreground font-bold text-lg shadow-lg",children:s?e.jsx("img",{src:s,alt:o,className:"w-full h-full object-cover"}):l}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-foreground",children:o}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c("restaurants.chef","大厨")})]})]})]})})]})]})},At=({open:t,onOpenChange:o,videoUrl:s,posterUrl:l,title:c})=>{const{t:d}=M(),m=a.useRef(null),u=a.useRef(null),[r,h]=a.useState(!1),[b,g]=a.useState(!1),[k,N]=a.useState(!1),[S,z]=a.useState(0),[I,$]=a.useState(0),[q,f]=a.useState(!0),_=a.useRef(null),A=i=>{const F=Math.floor(i/60),K=Math.floor(i%60);return`${F}:${K.toString().padStart(2,"0")}`},D=a.useCallback(()=>{m.current&&(r?m.current.pause():m.current.play())},[r]),ee=a.useCallback(()=>{m.current&&(m.current.muted=!b,g(!b))},[b]),P=a.useCallback(async()=>{try{document.fullscreenElement?(await document.exitFullscreen(),N(!1)):(await m.current?.requestFullscreen(),N(!0))}catch(i){console.log("Fullscreen not supported:",i)}},[]),ye=a.useCallback(i=>{if(!m.current||!u.current)return;const F=u.current.getBoundingClientRect(),R=(i.clientX-F.left)/F.width;m.current.currentTime=R*I},[I]),G=a.useCallback(()=>{f(!0),_.current&&clearTimeout(_.current),_.current=setTimeout(()=>{r&&f(!1)},3e3)},[r]),L=a.useCallback(i=>{if(!m.current||!u.current)return;i.preventDefault(),i.stopPropagation();const F=u.current.getBoundingClientRect(),K=i.touches[0].clientX-F.left,R=Math.max(0,Math.min(1,K/F.width));m.current.currentTime=R*I},[I]);a.useEffect(()=>(t&&m.current?(m.current.currentTime=0,z(0),f(!0),m.current.play().catch(()=>{h(!1)})):!t&&m.current&&(m.current.pause(),m.current.currentTime=0,h(!1),z(0),f(!0)),()=>{_.current&&clearTimeout(_.current)}),[t]);const Y=a.useCallback(()=>h(!0),[]),B=a.useCallback(()=>h(!1),[]),xe=a.useCallback(()=>{m.current&&z(m.current.currentTime)},[]),U=a.useCallback(()=>{m.current&&$(m.current.duration)},[]),ue=a.useCallback(()=>{h(!1),f(!0)},[]),V=I>0?S/I*100:0;return e.jsx(is,{open:t,onOpenChange:o,children:e.jsxs(os,{children:[e.jsx(cs,{className:"fixed inset-0 z-[49] bg-black/90 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",style:{pointerEvents:"none"}}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{touchAction:"none"},onClick:i=>{i.target===i.currentTarget&&o(!1)},onTouchEnd:i=>{i.target===i.currentTarget&&o(!1)},children:e.jsxs(ds,{className:"relative w-full max-w-4xl bg-black rounded-lg overflow-hidden outline-none",style:{touchAction:"auto"},"aria-describedby":void 0,onMouseMove:G,onTouchStart:i=>{i.stopPropagation(),G()},onTouchMove:i=>{i.stopPropagation(),G()},onClick:i=>i.stopPropagation(),children:[e.jsx(ms,{children:e.jsx(xs,{children:c||d("restaurants.videoPlayer","Video Player")})}),e.jsx(y,{type:"button",variant:"ghost",size:"icon",className:He("absolute top-3 right-3 z-[60] bg-black/50 hover:bg-black/70 text-white h-10 w-10 rounded-full transition-opacity duration-300",q?"opacity-100":"opacity-0 pointer-events-none"),onClick:i=>{i.stopPropagation(),o(!1)},children:e.jsx(us,{className:"h-5 w-5"})}),c&&e.jsx("div",{className:He("absolute top-3 left-3 z-[60] transition-opacity duration-300 pointer-events-none",q?"opacity-100":"opacity-0"),children:e.jsx("h3",{className:"text-white font-semibold text-lg drop-shadow-lg",children:c})}),e.jsxs("div",{className:"relative aspect-video bg-black select-none",children:[e.jsx("video",{ref:m,src:s,poster:l,className:"w-full h-full object-contain cursor-pointer",playsInline:!0,preload:"metadata",onPlay:Y,onPause:B,onTimeUpdate:xe,onLoadedMetadata:U,onEnded:ue,onCanPlay:()=>{m.current&&!I&&$(m.current.duration)},onClick:i=>{i.stopPropagation(),D()},onTouchEnd:i=>{i.target===m.current&&(i.preventDefault(),D())}}),!r&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center cursor-pointer bg-black/30",style:{zIndex:5},onClick:i=>{i.stopPropagation(),D()},onTouchEnd:i=>{i.preventDefault(),i.stopPropagation(),D()},children:e.jsx("div",{className:"w-16 h-16 md:w-20 md:h-20 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center hover:bg-white/30 transition-colors",children:e.jsx(me,{className:"w-8 h-8 md:w-10 md:h-10 text-white ml-1",fill:"white"})})}),e.jsxs("div",{className:He("absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent px-4 py-3 transition-opacity duration-300",q?"opacity-100":"opacity-0"),style:{zIndex:30,pointerEvents:q?"auto":"none"},onClick:i=>i.stopPropagation(),onTouchStart:i=>i.stopPropagation(),onTouchMove:i=>i.stopPropagation(),children:[e.jsx("div",{ref:u,className:"w-full py-2 cursor-pointer mb-2 group",style:{touchAction:"none"},onClick:i=>{i.stopPropagation(),ye(i)},onTouchStart:i=>{i.stopPropagation(),L(i)},onTouchMove:i=>{i.stopPropagation(),L(i)},onTouchEnd:i=>{i.stopPropagation()},children:e.jsx("div",{className:"w-full h-2 bg-white/30 rounded-full relative",children:e.jsx("div",{className:"h-full bg-primary rounded-full relative transition-all",style:{width:`${V}%`},children:e.jsx("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 w-5 h-5 bg-white rounded-full shadow-md -mr-2.5"})})})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{type:"button",variant:"ghost",size:"icon",className:"h-10 w-10 text-white hover:bg-white/20 active:scale-95",onClick:i=>{i.stopPropagation(),D()},onTouchEnd:i=>{i.preventDefault(),i.stopPropagation(),D()},children:r?e.jsx(hs,{className:"h-6 w-6"}):e.jsx(me,{className:"h-6 w-6"})}),e.jsx(y,{type:"button",variant:"ghost",size:"icon",className:"h-10 w-10 text-white hover:bg-white/20 active:scale-95",onClick:i=>{i.stopPropagation(),ee()},onTouchEnd:i=>{i.preventDefault(),i.stopPropagation(),ee()},children:b?e.jsx(ps,{className:"h-6 w-6"}):e.jsx(gs,{className:"h-6 w-6"})}),e.jsxs("span",{className:"text-white text-sm font-medium select-none",children:[A(S)," / ",A(I)]})]}),e.jsx(y,{type:"button",variant:"ghost",size:"icon",className:"h-10 w-10 text-white hover:bg-white/20 active:scale-95",onClick:i=>{i.stopPropagation(),P()},onTouchEnd:i=>{i.preventDefault(),i.stopPropagation(),P()},children:k?e.jsx(fs,{className:"h-6 w-6"}):e.jsx(js,{className:"h-6 w-6"})})]})]})]})]})})]})})},Ks=t=>bt({queryKey:["restaurant-posts",t],queryFn:async()=>{const{data:o}=await We.from("merchant_restaurants").select("user_id").eq("restaurant_id",t),s=o?.map(d=>d.user_id)||[];if(s.length===0)return[];const{data:l,error:c}=await We.from("community_posts").select(`
          *,
          author:profiles!community_posts_author_id_fkey(id, display_name, avatar_url),
          post_likes(user_id)
        `).in("author_id",s).eq("status","approved").order("created_at",{ascending:!1}).limit(6);if(c)throw c;return(l||[]).map(d=>({...d,likes_count:d.likes_count||0,user_liked:!1}))},enabled:!!t}),Ft=a.memo(({restaurantId:t})=>{const{t:o}=M(),{data:s=[],isLoading:l}=Ks(t);return l?e.jsx("section",{className:"py-8 md:py-12 lg:py-16",children:e.jsx("div",{className:"container mx-auto max-w-6xl px-4",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(fe,{className:"w-6 h-6 animate-spin text-primary"})})})}):s.length===0?e.jsxs("div",{className:"mt-5 md:mt-6 space-y-2 md:space-y-3 bg-muted/50 rounded-xl p-4 md:p-5 border border-border/30",children:[e.jsxs("h3",{className:"text-base md:text-lg font-semibold text-foreground flex items-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4 md:w-5 md:h-5 text-primary"}),o("restaurants.recentPosts","最近帖子")]}),e.jsx("p",{className:"text-sm text-muted-foreground py-4 text-center",children:o("restaurants.noRecentPosts","最近没有帖子")})]}):e.jsxs("div",{className:"mt-5 md:mt-6 space-y-2 md:space-y-3 bg-muted/50 rounded-xl p-4 md:p-5 border border-border/30",children:[e.jsxs("h3",{className:"text-base md:text-lg font-semibold text-foreground flex items-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4 md:w-5 md:h-5 text-primary"}),o("restaurants.recentPosts","最近帖子")]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 md:gap-3",children:s.map(c=>e.jsx(Bs,{post:c},c.id))}),s.length>=6&&e.jsx("div",{className:"text-center pt-1",children:e.jsxs(Ne,{to:"/community",className:"inline-flex items-center gap-1.5 text-xs text-primary hover:text-primary/80 font-medium transition-colors",children:[o("common.viewMore","查看更多"),e.jsx(bs,{className:"w-3.5 h-3.5"})]})})]})});Ft.displayName="GhostRestaurantRecentPosts";const gt=240,Xs=({foodDescription:t,cleanFoodDesc:o})=>{const{t:s}=M(),[l,c]=a.useState(!1),[d,m]=a.useState(!1),u=a.useRef(null),r=a.useCallback(()=>{u.current&&m(u.current.scrollHeight>gt)},[]);return a.useEffect(()=>(r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)),[r,t]),e.jsxs("div",{className:"space-y-2 md:space-y-3 bg-muted/50 rounded-xl p-4 md:p-5 lg:p-6 border border-border/30",children:[e.jsxs("h3",{className:"text-base md:text-lg font-semibold text-foreground flex items-center gap-2",children:[e.jsx(Ze,{className:"w-4 h-4 md:w-5 md:h-5 text-primary rotate-180"}),s("restaurants.foodPhilosophy","美食哲学")]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{ref:u,className:"text-sm md:text-base text-muted-foreground leading-relaxed prose prose-sm dark:prose-invert max-w-none [&_*]:!text-muted-foreground [&_a]:!text-primary [&_a]:underline [&_p]:my-2 overflow-hidden transition-all duration-300",style:d&&!l?{maxHeight:`${gt}px`}:void 0,dangerouslySetInnerHTML:{__html:t}}),d&&!l&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-muted/50 to-transparent"})]}),d&&e.jsxs("button",{onClick:()=>c(!l),className:"flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition-colors font-medium",children:[l?s("common.collapse","收起"):s("common.expand","展开"),e.jsx(Q,{className:`w-3.5 h-3.5 transition-transform ${l?"rotate-180":""}`})]})]})},Qs=({restaurant:t,localizedRestaurant:o,backUrl:s,user:l,isFavorite:c,onToggleFavorite:d,onShare:m,showEditButton:u,editButton:r,reportButton:h})=>{const{t:b}=M(),{getLocalizedField:g}=Je();Qt();const[k,N]=a.useState(!1),[S,z]=a.useState(!1),[I,$]=a.useState(!1),[q,f]=a.useState(!1),_=a.useRef(null),A=g(t,"owner_bio")||t.owner_bio,D=o.description,ee=o.name?.charAt(0)?.toUpperCase()||"主",P=t.banner_media_type==="video"&&t.promo_video_url,ye=t.banner_url||t.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80",G=t.promo_video_poster||ye,[L,Y]=a.useState(!1),B=3,xe=v=>v?.replace(/<[^>]*>/g,"")||"",U=A&&A.length>100?A.substring(0,100)+"...":A,ue=A&&A.length>100,V=xe(D),i=V&&V.length>120?V.substring(0,120)+"...":V,F=a.useRef(null),K=a.useCallback(v=>{!_.current||!P||L||(v?_.current.play().catch(()=>{}):_.current.pause())},[P,L]),R=a.useCallback(async v=>{try{return v.muted=!0,v.volume=0,await v.play(),!0}catch(X){return console.warn("Video autoplay attempt failed:",X),!1}},[]);a.useEffect(()=>{if(!P||!_.current)return;const v=_.current;let X=0,te,Z=!0;const _e=async()=>{if(!Z||X>=B){Z&&X>=B&&(Y(!0),$(!0));return}X++,await R(v)&&Z?($(!0),Y(!1)):Z&&X<B?te=setTimeout(_e,500):Z&&(Y(!0),$(!0))},he=()=>{_e()},n=()=>{Z&&f(!0)};return v.readyState>=2?_e():v.addEventListener("loadeddata",he),v.addEventListener("error",n),()=>{Z=!1,clearTimeout(te),v.removeEventListener("loadeddata",he),v.removeEventListener("error",n)}},[P,R]),a.useEffect(()=>{if(!P||L||!F.current)return;const v=new IntersectionObserver(X=>{X.forEach(te=>{K(te.isIntersecting)})},{threshold:.1});return v.observe(F.current),()=>{v.disconnect()}},[P,L,K]);const Pe=()=>{if(P&&t.promo_video_url)if(L&&_.current){const v=_.current;v.muted=!0,v.play().then(()=>{Y(!1),$(!0)}).catch(()=>{N(!0)})}else N(!0)};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{ref:F,className:"relative h-[33vh] md:h-[40vh] overflow-hidden bg-muted cursor-pointer group",onClick:Pe,children:[P&&!q?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:G,alt:o.name,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-500 ${I&&!L?"opacity-0":"opacity-100"}`,loading:"eager"}),e.jsx("video",{ref:_,src:t.promo_video_url,poster:G,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-500 ${I&&!L?"opacity-100":"opacity-0"}`,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,"webkit-playsinline":"true","x5-playsinline":"true","x5-video-player-type":"h5"})]}):e.jsx("img",{src:ye,alt:o.name,className:"w-full h-full object-cover",loading:"eager"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 via-background/20 to-transparent"}),P&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:`w-16 h-16 md:w-20 md:h-20 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center border border-white/30 transition-opacity duration-300 pointer-events-auto cursor-pointer ${L?"opacity-100":"opacity-0 group-hover:opacity-100"}`,children:e.jsx(me,{className:"w-8 h-8 md:w-10 md:h-10 text-white ml-1",fill:"white"})})}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 flex justify-between items-center z-40 p-3 md:p-4",onClick:v=>v.stopPropagation(),children:[e.jsx(y,{asChild:!0,variant:"secondary",size:"icon",className:"h-9 w-9 md:h-10 md:w-10 shadow-lg",children:e.jsx(Ne,{to:s,children:e.jsx(Ye,{className:"w-4 h-4 md:w-5 md:h-5"})})}),e.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2",children:[h,r,e.jsx(y,{variant:"secondary",size:"icon",className:"h-9 w-9 md:h-10 md:w-10 shadow-lg",onClick:v=>{v.stopPropagation(),m()},children:e.jsx(ge,{className:"w-4 h-4 md:w-5 md:h-5"})}),l&&e.jsx(y,{variant:"secondary",size:"icon",className:"h-9 w-9 md:h-10 md:w-10 shadow-lg",onClick:v=>{v.stopPropagation(),d()},children:e.jsx(Nt,{className:`w-4 h-4 md:w-5 md:h-5 ${c?"fill-destructive text-destructive":""}`})})]})]})]}),e.jsxs("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-8",children:[P&&e.jsx("div",{className:"flex justify-center mb-3",children:e.jsxs(y,{variant:"secondary",size:"sm",className:"gap-2 bg-primary/5 hover:bg-primary/10 text-primary/70 border border-primary/10 backdrop-blur-md",onClick:()=>{_.current&&_.current.pause(),N(!0)},children:[e.jsx(me,{className:"w-4 h-4"}),b("restaurants.clickWatchFullVideo","点击观看完整视频")]})}),e.jsxs(E,{className:"shadow-xl border-border/50",children:[e.jsxs(J,{className:"pb-4 md:pb-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-1.5 md:mb-2",children:[e.jsxs(W,{variant:"secondary",className:"text-[10px] md:text-xs gap-1 bg-primary/10 text-primary border-primary/20",children:[b("admin.templateGhost","Virtual Kitchen"),e.jsx(yt,{className:"w-3 h-3"})]}),o.type&&o.type.length>0&&e.jsx(W,{variant:"secondary",className:"text-[10px] md:text-xs bg-primary/10 text-primary border-primary/20",children:o.type.join(" · ")}),e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.15em] md:tracking-[0.2em] uppercase text-primary",children:b("restaurants.exclusiveInterview","专属故事")})]}),e.jsx(Ve,{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-foreground leading-tight",children:qe(o.name)})]}),e.jsx(H,{className:"pt-0",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-5 md:gap-6 lg:gap-8",children:[e.jsxs("div",{className:"md:col-span-3 space-y-5 md:space-y-6",children:[e.jsxs("div",{className:"relative aspect-square md:aspect-square w-full max-w-md mx-auto overflow-hidden rounded-xl shadow-lg group",children:[e.jsx("img",{src:t.cover_image_url||t.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=800&q=80",alt:o.name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 via-transparent to-transparent"})]}),(i||D)&&e.jsx(Xs,{foodDescription:D,cleanFoodDesc:V})]}),e.jsxs("div",{className:"md:col-span-2 space-y-5 md:space-y-6",children:[e.jsxs("div",{className:"bg-muted/30 rounded-2xl border border-border/30 overflow-hidden",children:[e.jsx("div",{className:"relative pt-6 md:pt-8 pb-4 md:pb-6 px-4 md:px-6 bg-gradient-to-b from-primary/5 to-transparent",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`w-20 h-20 sm:w-24 sm:h-24 md:w-28 md:h-28 rounded-full overflow-hidden border-4 border-background shadow-xl ring-4 ring-primary/10 ${t.owner_avatar_url?"cursor-pointer":""}`,onClick:()=>{t.owner_avatar_url&&z(!0)},children:t.owner_avatar_url?e.jsx("img",{src:t.owner_avatar_url,alt:o.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-primary/30 via-accent/20 to-muted flex items-center justify-center",children:e.jsx("span",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-primary/70",children:ee})})}),e.jsxs(W,{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 bg-primary text-primary-foreground border-0 px-2 md:px-3 py-0.5 md:py-1 text-[10px] md:text-xs font-medium shadow-lg whitespace-nowrap",children:[e.jsx(vt,{className:"w-2.5 h-2.5 md:w-3 md:h-3 mr-0.5 md:mr-1"}),b("restaurants.ownerStory","主理人")]})]})})}),e.jsxs("div",{className:"px-4 md:px-6 py-3 md:py-4 text-center border-b border-border/30",children:[e.jsx("h3",{className:"text-lg md:text-xl font-bold text-foreground",children:qe(g(t,"owner_name")||o.name)}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground font-medium tracking-wider uppercase mt-0.5 md:mt-1",children:b("restaurants.chef","大厨")})]}),e.jsxs("div",{className:"p-4 md:p-6 space-y-3 md:space-y-4",children:[e.jsxs("h4",{className:"text-xs md:text-sm font-semibold text-foreground flex items-center gap-1.5 md:gap-2",children:[e.jsx(Ze,{className:"w-3 h-3 md:w-4 md:h-4 text-primary rotate-180"}),b("restaurants.ownerWords","主理人故事")]}),A?e.jsxs("div",{className:"space-y-2 md:space-y-3",children:[e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground leading-relaxed",children:U}),ue&&e.jsx(Ws,{ownerBio:A,ownerName:o.name,ownerAvatarUrl:t.owner_avatar_url,avatarFallback:ee})]}):e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground/60 italic",children:b("restaurants.noBioYet","暂无简介")})]}),e.jsx("div",{className:"h-1.5 md:h-2 bg-gradient-to-r from-primary/20 via-primary/40 to-primary/20"})]}),e.jsx(Ft,{restaurantId:t.id})]})]})})]})]}),P&&e.jsx(At,{open:k,onOpenChange:N,videoUrl:t.promo_video_url,posterUrl:G,title:o.name}),t.owner_avatar_url&&e.jsx(Dt,{imageUrl:t.owner_avatar_url,isOpen:S,onClose:()=>z(!1),disableLongImage:!0})]})},Ys=({text:t})=>{const{t:o}=M(),s=Ie(),[l,c]=a.useState(!1),[d,m]=a.useState(!1),u=a.useRef(null),r=s?120:240,h=a.useCallback(()=>{u.current&&m(u.current.scrollHeight>r)},[]);return a.useEffect(()=>(h(),window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)),[h,t]),e.jsxs("div",{children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{ref:u,className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline overflow-hidden transition-all duration-300",style:d&&!l?{maxHeight:`${r}px`}:void 0,dangerouslySetInnerHTML:{__html:Be(t)}}),d&&!l&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-card to-transparent"})]}),d&&e.jsxs("button",{onClick:()=>c(!l),className:"flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition-colors font-medium mt-2",children:[l?o("common.collapse","收起"):o("common.expand","展开"),e.jsx(Q,{className:`w-3.5 h-3.5 transition-transform ${l?"rotate-180":""}`})]})]})},Zs=({blocks:t,getLocalizedBlockContent:o})=>{const{t:s}=M(),l=Ie(),[c,d]=a.useState(!1),[m,u]=a.useState(!1),r=a.useRef(null),h=l?160:320,b=a.useCallback(()=>{r.current&&u(r.current.scrollHeight>h)},[]);return a.useEffect(()=>(b(),window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)),[b,t]),e.jsxs("div",{children:[e.jsxs("div",{ref:r,className:"relative space-y-4 overflow-hidden transition-all duration-300",style:m&&!c?{maxHeight:`${h}px`}:void 0,children:[t.map((g,k)=>{const N=o(g),S=g.type==="image"&&k===0,z=g.type==="image"&&k===t.length-1;return e.jsxs("div",{children:[g.type==="text"&&N&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline",dangerouslySetInnerHTML:{__html:Be(N)}}),g.type==="image"&&g.url&&e.jsx("div",{className:"flex justify-start",children:e.jsx("img",{src:g.url,alt:g.alt||"",className:S?"w-16 h-16 object-contain rounded-lg":z?"h-12 w-auto object-contain opacity-80":"max-w-[120px] max-h-24 object-contain rounded-lg"})})]},g.id)}),m&&!c&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-10 bg-gradient-to-t from-card to-transparent"})]}),m&&e.jsxs("button",{onClick:()=>d(!c),className:"flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition-colors font-medium mt-2",children:[c?s("common.collapse","收起"):s("common.expand","展开"),e.jsx(Q,{className:`w-3.5 h-3.5 transition-transform ${c?"rotate-180":""}`})]})]})},Js=({brandId:t})=>{const{t:o,i18n:s}=M(),{data:l,isLoading:c}=Lt(t);if(c||!l)return null;const d=g=>{switch(s.language){case"zh":return g.content_zh;case"pt":return g.content_pt;default:return g.content_en||g.content_zh}},m=()=>{switch(s.language){case"zh":return l.name;case"pt":return l.name_pt||l.name;default:return l.name_en||l.name}},u=l.content_blocks&&l.content_blocks.length>0,r=!!l.logo_url,b=(()=>{switch(s.language){case"zh":return l.intro_zh;case"pt":return l.intro_pt;default:return l.intro_en||l.intro_zh}})();return!r&&!u&&!b?null:e.jsx("section",{className:"py-8 md:py-12 lg:py-16 bg-muted/30",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:o("brand.story","品牌故事")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground inline-flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(_t,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary flex-shrink-0"}),e.jsx("span",{children:qe(m())})]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(E,{className:"border-0 shadow-lg md:shadow-xl overflow-hidden",children:e.jsx(H,{className:"p-4 md:p-6 lg:p-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 md:gap-8",children:[r&&e.jsx("div",{className:"flex-shrink-0 flex flex-col items-center md:items-start gap-4",children:e.jsx("img",{src:l.logo_url,alt:m(),className:"w-52 h-52 md:w-60 md:h-60 object-contain rounded-xl"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[u&&e.jsx(Zs,{blocks:l.content_blocks,getLocalizedBlockContent:d}),b&&!u&&e.jsx(Ys,{text:b})]})]})})})]})})},ea=ws,ta=t=>{if(!t)return"";const o=Math.floor(t/60),s=Math.floor(t%60);return`${o}:${s.toString().padStart(2,"0")}`},ft=({video:t,onClick:o,language:s})=>{const c=(()=>{switch(s){case"en":return t.title_en||t.title_zh||"";case"pt":return t.title_pt||t.title_en||t.title_zh||"";default:return t.title_zh||t.title_en||""}})();return e.jsxs(E,{className:"group cursor-pointer overflow-hidden border-border/50 hover:border-primary/30 transition-all hover:shadow-lg",onClick:o,children:[e.jsxs("div",{className:"relative",children:[e.jsx(ea,{ratio:16/9,children:t.poster_url?e.jsx("img",{src:t.poster_url,alt:c,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",loading:"lazy"}):e.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-primary/20 via-primary/10 to-muted flex items-center justify-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/20 backdrop-blur-sm flex items-center justify-center border border-primary/30",children:e.jsx(me,{className:"w-8 h-8 text-primary ml-1",fill:"currentColor"})}),e.jsx(vs,{className:"absolute bottom-3 left-3 w-5 h-5 text-primary/40"})]})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none md:opacity-0 md:group-hover:opacity-100 transition-opacity",children:e.jsx("div",{className:"w-12 h-12 md:w-14 md:h-14 rounded-full bg-black/50 md:bg-white/20 backdrop-blur-sm flex items-center justify-center border border-white/30 md:group-hover:scale-110 transition-transform",children:e.jsx(me,{className:"w-6 h-6 md:w-7 md:h-7 text-white ml-0.5",fill:"white"})})}),t.duration&&e.jsx(W,{variant:"secondary",className:"absolute bottom-2 right-2 bg-black/70 text-white text-xs border-0",children:ta(t.duration)})]}),c&&e.jsx("div",{className:"p-3",children:e.jsx("p",{className:"text-sm font-medium text-foreground line-clamp-2",children:c})})]})},sa=({videos:t})=>{const{t:o,i18n:s}=M(),l=Ie(),[c,d]=a.useState(null);if(!t||t.length===0)return null;const m=u=>{switch(s.language){case"en":return u.title_en||u.title_zh||"";case"pt":return u.title_pt||u.title_en||u.title_zh||"";default:return u.title_zh||u.title_en||""}};return e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"py-8 md:py-12 lg:py-16 bg-muted/30",children:e.jsxs("div",{className:"container mx-auto max-w-6xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:"BEHIND THE KITCHEN"}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(me,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),o("restaurants.videoSection","美食视界")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),l?e.jsxs(Tt,{opts:{align:"start",loop:t.length>2},className:"w-full",children:[e.jsx(zt,{className:"-ml-2",children:t.map((u,r)=>e.jsx(It,{className:"pl-2 basis-4/5 sm:basis-1/2",children:e.jsx(ft,{video:u,onClick:()=>d(u),language:s.language})},r))}),t.length>2&&e.jsxs(e.Fragment,{children:[e.jsx(Pt,{className:"hidden sm:flex -left-4"}),e.jsx(Rt,{className:"hidden sm:flex -right-4"})]})]}):e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:t.map((u,r)=>e.jsx(ft,{video:u,onClick:()=>d(u),language:s.language},r))})]})}),e.jsx(At,{open:!!c,onOpenChange:u=>!u&&d(null),videoUrl:c?.url||"",posterUrl:c?.poster_url,title:c?m(c):void 0})]})},aa=a.lazy(()=>jt(()=>import("./RestaurantComments-BCnKbwCW.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]))),ra=({restaurant:t,localizedRestaurant:o,restaurantActivities:s,ratingCount:l,averageRating:c,onTakeawayClick:d,onNavigationClick:m,brandId:u})=>{const{t:r,i18n:h}=M();Je();const{data:b=[]}=St(t.id),g=b.length>0&&t.show_dish_gallery!==!1,k=a.useRef(null);return e.jsxs("div",{className:"relative bg-background",children:[t.website_url&&t.show_takeaway_button&&e.jsx("section",{className:"py-6 md:py-8 bg-gradient-to-b from-muted/50 to-background",children:e.jsxs("div",{className:"container mx-auto max-w-2xl px-4",children:[e.jsxs("div",{className:"text-center mb-4 md:mb-5",children:[e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mb-1",children:r("restaurants.readyToOrder")}),e.jsx("p",{className:"text-sm md:text-base font-medium text-foreground",children:r("restaurants.orderNowHint")})]}),e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs(y,{className:"w-full h-11 md:h-12 text-sm md:text-base shadow-md hover:shadow-lg transition-shadow",size:"lg",onClick:d,children:[e.jsx(Ns,{className:"w-4 h-4 md:w-5 md:h-5 mr-2"}),r("restaurant.takeawayOrder")]})}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-4 md:mt-5",children:[e.jsx("div",{className:"h-px w-12 md:w-16 bg-border"}),e.jsx("span",{className:"text-[10px] md:text-xs text-muted-foreground uppercase tracking-wider",children:r("restaurants.orBrowse")}),e.jsx("div",{className:"h-px w-12 md:w-16 bg-border"})]})]})}),g&&e.jsx("section",{className:"py-8 md:py-12 lg:py-16",children:e.jsxs("div",{className:"container mx-auto max-w-6xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:r("restaurants.gallery","美食图鉴")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(ys,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),r("restaurants.photoWall","照片墙")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx($t,{restaurantId:t.id,showGallery:t.show_dish_gallery!==!1})]})}),t.videos&&Array.isArray(t.videos)&&t.videos.length>0&&e.jsx(sa,{videos:t.videos}),u&&e.jsx(Js,{brandId:u}),s.length>0&&e.jsx("section",{className:"py-8 md:py-12 lg:py-16",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:r("restaurants.participating","参与中")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(ve,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),r("activities.title")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx("div",{className:"grid gap-3 md:gap-4",children:s.map((N,S)=>{const z=Et(N,h.language);return e.jsx(Ne,{to:`/activity/${N.activity_id}`,className:"block",children:e.jsx(E,{className:"border-0 shadow-md hover:shadow-lg transition-shadow overflow-hidden",children:e.jsxs(H,{className:"p-4 md:p-5 flex items-center gap-3 md:gap-4",children:[e.jsx(W,{variant:"default",className:"text-white text-xs md:text-sm shrink-0",style:{backgroundColor:N.badge_color||"hsl(var(--primary))"},children:Qe(N,h.language)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-semibold text-sm md:text-base text-card-foreground truncate",children:Ot(N,h.language)}),z&&e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground line-clamp-1 mt-0.5",children:z})]}),e.jsx(Q,{className:"w-4 h-4 text-muted-foreground -rotate-90 shrink-0"})]})})},`activity-card-${S}`)})})]})}),e.jsx("section",{className:"py-8 md:py-12 lg:py-16 bg-muted/30",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:r("restaurants.info","详情")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(Ke,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),r("restaurants.contactInfo","联系信息")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(E,{className:"border-0 shadow-lg md:shadow-xl overflow-hidden",children:e.jsxs(H,{className:"p-4 md:p-6 lg:p-8 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:gap-3",children:[e.jsxs(W,{variant:"secondary",className:"gap-1 text-xs md:text-sm bg-primary/10 text-primary border-primary/20",children:[r("admin.templateGhost","Virtual Kitchen"),e.jsx(yt,{className:"w-3 h-3"})]}),o.type.slice(0,3).map((N,S)=>e.jsx(W,{variant:"secondary",className:"text-xs md:text-sm",children:N},S)),l>0&&e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx(ve,{className:"w-4 h-4 md:w-5 md:h-5 fill-accent text-accent"}),e.jsxs("span",{className:"font-bold text-base md:text-lg",children:[c.toFixed(1),e.jsxs("span",{className:"text-muted-foreground font-normal text-xs md:text-sm ml-1",children:["(",l,")"]})]})]})]}),e.jsx(Xe,{}),e.jsxs("div",{className:"grid gap-3 md:gap-4",children:[e.jsxs("div",{className:"flex items-start gap-2 md:gap-3 p-3 md:p-4 rounded-lg md:rounded-xl bg-muted/50 hover:bg-muted/70 transition-colors",children:[e.jsx(Ke,{className:"w-4 h-4 md:w-5 md:h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-semibold text-sm md:text-base text-card-foreground",children:r("restaurants.kitchenAddress")}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mt-0.5 md:mt-1 break-words",children:t.address})]})]}),m&&e.jsxs(y,{variant:"secondary",className:"w-full",onClick:m,children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),r("restaurant.getDirections")]}),t.phone&&e.jsxs("a",{href:`tel:${t.phone}`,className:"flex items-start gap-2 md:gap-3 p-3 md:p-4 rounded-lg md:rounded-xl bg-muted/50 hover:bg-primary/10 transition-colors cursor-pointer group",children:[e.jsx(kt,{className:"w-4 h-4 md:w-5 md:h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm md:text-base text-card-foreground",children:r("restaurant.phone")}),e.jsx("p",{className:"text-sm md:text-base text-primary group-hover:underline mt-0.5 md:mt-1",children:t.phone})]})]})]})]})})]})}),e.jsx("section",{className:"py-8 md:py-12 lg:py-16",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:r("restaurants.rating","评分")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(ve,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),r("restaurants.rateUs","给我们评分")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(E,{className:"border-0 shadow-lg md:shadow-xl overflow-hidden",children:e.jsx(H,{className:"p-4 md:p-6 lg:p-8",children:e.jsx(Mt,{restaurantId:t.id})})})]})}),e.jsx("section",{className:"py-8 md:py-12 lg:py-16 bg-muted/30",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:r("restaurants.reviews","评价")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(ze,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),r("restaurants.customerReviews","用户评价")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(E,{className:"border-0 shadow-lg md:shadow-xl overflow-hidden",children:e.jsx(H,{className:"p-4 md:p-6 lg:p-8",ref:k,children:e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center py-8 md:py-12",children:e.jsx(fe,{className:"w-6 h-6 md:w-8 md:h-8 animate-spin text-primary"})}),children:e.jsx(aa,{restaurantId:t.id})})})})]})})]})};function na({brandId:t}){const{t:o,i18n:s}=M(),[l,c]=a.useState(!1),{data:d,isLoading:m}=Lt(t);if(m||!d)return null;const u=()=>{switch(s.language){case"zh":return d.intro_zh;case"pt":return d.intro_pt;default:return d.intro_en||d.intro_zh}},r=g=>{switch(s.language){case"zh":return g.content_zh;case"pt":return g.content_pt;default:return g.content_en||g.content_zh}},h=u(),b=d.content_blocks&&d.content_blocks.length>0;return!h&&!b?null:e.jsxs(je,{open:l,onOpenChange:c,className:"mt-4",children:[e.jsx(be,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_t,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"font-medium",children:o("brand.aboutUs")})]}),e.jsx(Q,{className:`w-5 h-5 text-muted-foreground transition-transform ${l?"rotate-180":""}`})]})}),e.jsx(we,{children:e.jsxs("div",{className:"p-4 mt-2 rounded-lg bg-muted/30",children:[e.jsx("div",{className:"space-y-4",children:b&&d.content_blocks.map((g,k)=>{const N=r(g),S=g.type==="image"&&k===0,z=g.type==="image"&&k===d.content_blocks.length-1;return e.jsxs("div",{children:[g.type==="text"&&N&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline",dangerouslySetInnerHTML:{__html:Be(N)}}),g.type==="image"&&g.url&&e.jsx("div",{className:"flex justify-start",children:e.jsx("img",{src:g.url,alt:g.alt||"",className:S?"w-16 h-16 object-contain rounded-lg":z?"h-12 w-auto object-contain opacity-80":"max-w-[120px] max-h-24 object-contain rounded-lg"})})]},g.id)})}),h&&!b&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline",dangerouslySetInnerHTML:{__html:Be(h)}})]})})]})}const la=a.lazy(()=>jt(()=>import("./RestaurantComments-BCnKbwCW.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]))),Ua=()=>{const{id:t}=_s(),o=ks(),{t:s,i18n:l}=M(),{user:c}=Yt(),{localizeRestaurant:d,getLocalizedField:m}=Je(),u=Ie(),r=a.useRef(null),h=a.useRef(null),[b,g]=a.useState(null),[k,N]=a.useState(!1),[S,z]=a.useState(!0),[I,$]=a.useState(!1),[q,f]=a.useState(!1),[_,A]=a.useState(!0),[D,ee]=a.useState(!0),[P,ye]=a.useState(!1),G=a.useRef(null),L=a.useRef(null),[Y,B]=a.useState(!1),[xe,U]=a.useState(!1),[ue,V]=a.useState(!1),[i,F]=a.useState(!1),K=Cs(),R=Ss(),{share:Pe,DrawerComponent:v}=Hs(),X=a.useCallback(async()=>{R.removeQueries({queryKey:["restaurant",t]}),R.removeQueries({queryKey:["comments",t]}),R.removeQueries({queryKey:["restaurant-activities",t]}),R.removeQueries({queryKey:["dish-images",t]}),await Promise.all([R.invalidateQueries({queryKey:["restaurant",t]}),R.invalidateQueries({queryKey:["comments",t]}),R.invalidateQueries({queryKey:["restaurant-activities",t]}),R.invalidateQueries({queryKey:["dish-images",t]})])},[R,t]);Fs({pageType:"restaurant",targetId:t});const te=o.state?.fromActivity,Z=o.state?.from==="admin",_e=o.state?.from==="profile",he=Z?"/admin/restaurants":_e?"/profile":te?`/activity/${te}`:"/restaurants",{data:n,isLoading:et}=Rs(t),{data:Ht=[]}=Ds(),{data:Re}=Ct(t,"restaurant",{enabled:D}),tt=Ls(),{role:ia,isAdmin:De}=Zt(),{data:qt=[]}=qs(),{data:Le=[]}=Us(t),Me=n&&qt.some(x=>x.id===n.id),C=n?d(n):null,st=n?Ht.includes(n.id):!1;a.useMemo(()=>[{value:"€",label:"€ (0-10€)"},{value:"€€",label:"€€ (10-20€)"},{value:"€€€",label:"€€€ (20€+)"}],[]);const pe=a.useMemo(()=>{const x={};return Re?.forEach(p=>{p.price_range&&(x[p.price_range]||(x[p.price_range]={count:0,latestDate:p.created_at}),x[p.price_range].count+=1,p.created_at>x[p.price_range].latestDate&&(x[p.price_range].latestDate=p.created_at))}),x},[Re]),at=a.useMemo(()=>pe?Object.values(pe).reduce((x,p)=>x+p.count,0):0,[pe]),rt=a.useMemo(()=>!pe||at<10?null:Object.entries(pe).sort(([,p],[,T])=>T.count!==p.count?T.count-p.count:T.latestDate.localeCompare(p.latestDate))[0]?.[0]||null,[pe,at]),{ratingCount:Oe,averageRating:nt}=a.useMemo(()=>{const x=Re?.filter(w=>w.rating_value)||[],p=x.length,T=p>0?x.reduce((w,O)=>w+(O.rating_value||0),0)/p:0;return{ratingCount:p,averageRating:T}},[Re]);a.useEffect(()=>{n&&Os().then(x=>{const p=Es(x.coords.latitude,x.coords.longitude,n.lat,n.lng);g(p)}).catch(()=>{g(null)})},[n]);const lt=a.useCallback(()=>{!c||!n||tt.mutate(n.id)},[c,n,tt]),Ee=a.useCallback(async()=>{try{await navigator.clipboard.writeText(window.location.href),Fe.success(s("common.linkCopied"))}catch(x){console.error("Error copying link:",x),Fe.error(s("common.shareError"))}},[s]),Ge=a.useCallback(async()=>{!n||!C||Pe({title:C.name,text:`${C.name} - Xiaoxiong Market

${C.description||C.address}`,url:window.location.href},()=>{Fe.success(s("common.shareSuccess"))})},[n,C,Pe,s]),ke=a.useCallback(x=>{if(!n||!C)return;const p=encodeURIComponent(window.location.href),T=encodeURIComponent(C.name);let w="";switch(x){case"whatsapp":w=`https://wa.me/?text=${T}%20${p}`;break;case"facebook":w=`https://www.facebook.com/sharer/sharer.php?u=${p}`;break;case"twitter":w=`https://twitter.com/intent/tweet?text=${T}&url=${p}`;break;case"telegram":w=`https://t.me/share/url?url=${p}&text=${T}`;break;case"wechat":Ee(),Fe.info(s("common.shareVia")+" WeChat");return;default:return}it()?window.location.href=w:window.open(w,"_blank","width=600,height=400")},[n,C,Ee,s]);return a.useEffect(()=>{const x=new IntersectionObserver(T=>{T.forEach(w=>{w.isIntersecting&&!_&&A(!0)})},{rootMargin:"100px"}),p=new IntersectionObserver(T=>{T.forEach(w=>{w.isIntersecting&&!D&&ee(!0)})},{rootMargin:"200px"});return G.current&&x.observe(G.current),L.current&&p.observe(L.current),()=>{x.disconnect(),p.disconnect()}},[_,D]),a.useEffect(()=>{if(!r.current||!n||!_||!S||h.current)return;const x="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";if(!Se.supported()){console.warn("[RestaurantDetail Map] WebGL not supported",{isIOSDevice:Jt(),isIOSWebView:it(),userAgent:navigator.userAgent});return}const p=()=>{if(!r.current)return;const T=r.current.getBoundingClientRect();if(T.width===0||T.height===0){setTimeout(p,100);return}try{Se.accessToken=x,h.current=new Se.Map({container:r.current,style:"mapbox://styles/mapbox/light-v11",center:[n.lng,n.lat],zoom:15,cooperativeGestures:!0}),h.current.on("error",O=>{console.error("[RestaurantDetail Map] Map error:",O)});const w=document.createElement("div");w.style.backgroundImage=`url(${$s})`,w.style.width="40px",w.style.height="40px",w.style.backgroundSize="contain",w.style.backgroundRepeat="no-repeat",w.style.backgroundPosition="center",w.style.cursor="pointer",new Se.Marker({element:w}).setLngLat([n.lng,n.lat]).addTo(h.current),h.current.addControl(new Se.NavigationControl)}catch(w){console.error("[RestaurantDetail Map] Failed to initialize map:",w)}};return setTimeout(p,50),()=>{h.current?.remove(),h.current=null}},[n,_,S]),a.useEffect(()=>{if(S&&h.current){const x=setTimeout(()=>{h.current?.resize(),n&&h.current?.setCenter([n.lng,n.lat])},350);return()=>clearTimeout(x)}},[S,n]),et?e.jsx(Vs,{}):!n||!C?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl text-muted-foreground",children:s("error.notFound")}),e.jsx(y,{asChild:!0,className:"mt-4",children:e.jsx(Ne,{to:he,children:s("common.back")})})]})}):n.template==="ghost"?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Qs,{restaurant:n,localizedRestaurant:C,backUrl:he,user:c,isFavorite:st,onToggleFavorite:lt,onShare:()=>{if(!c){U(!0);return}u&&navigator.share?Ge():Ee()},onReport:()=>{},showEditButton:Me||De,editButton:(Me||De)&&n?e.jsx(ht,{restaurant:n,trigger:e.jsx(y,{variant:"secondary",size:"icon",className:"backdrop-blur-sm bg-background/60",children:e.jsx(dt,{className:"w-5 h-5"})})}):null,reportButton:n?e.jsx(xt,{targetType:"restaurant",targetId:n.id,onLoginRequired:()=>U(!0),trigger:e.jsx(y,{variant:"secondary",size:"icon",className:"backdrop-blur-sm bg-background/60",children:e.jsx(mt,{className:"w-5 h-5"})})}):null}),e.jsx(ra,{restaurant:n,localizedRestaurant:C,restaurantActivities:Le,ratingCount:Oe,averageRating:nt,onTakeawayClick:()=>V(!0),onNavigationClick:()=>B(!0),brandId:n.brand_id}),e.jsx(se,{open:ue,onOpenChange:V,children:e.jsxs(ae,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(re,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(Ue,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(ne,{className:"text-base font-semibold tracking-tight text-foreground",children:s("restaurant.orderOrBookTitle","外卖/订台")}),e.jsx(le,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:s("restaurant.orderOrBookDescription","即将为您打开餐厅私域页面")})]})]}),e.jsxs(ie,{className:"relative flex-col gap-2 pt-4 mt-1",children:[e.jsx(oe,{onClick:()=>{try{let x=n.website_url;if(c){const p=new URL(n.website_url);p.searchParams.set("user_id",c.id),x=p.toString()}Ce(x)}catch{Ce(n.website_url)}},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:s("common.continue","继续")}),e.jsx(ce,{className:"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:s("common.cancel")})]})]})}),e.jsx(se,{open:xe,onOpenChange:U,children:e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsx(ne,{children:s("activities.loginRequired")}),e.jsx(le,{children:s("activities.loginRequiredMessage")})]}),e.jsxs(ie,{children:[e.jsx(ce,{children:s("common.cancel")}),e.jsx(oe,{onClick:()=>K("/auth"),children:s("activities.goToLogin")})]})]})}),e.jsx(se,{open:Y,onOpenChange:B,children:e.jsxs(ae,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(re,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(Te,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(ne,{className:"text-base font-semibold tracking-tight text-foreground",children:s("navigation.confirmTitle")}),e.jsx(le,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:s("navigation.confirmDescriptionSimple",{destination:C.name})})]})]}),e.jsxs(ie,{className:"relative flex-col gap-2 pt-4 mt-1",children:[e.jsx(oe,{onClick:()=>{ut(n.lat,n.lng,C.name),B(!1)},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:s("navigation.openNavigation","获取路线")}),e.jsx(ce,{className:"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:s("common.cancel")})]})]})})]}):e.jsx(As,{onRefresh:X,children:e.jsxs("div",{className:"min-h-screen bg-secondary/20",children:[e.jsxs("div",{className:"relative h-[33vh] overflow-hidden bg-muted",children:[e.jsx("img",{src:n.cover_image_url||n.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80",alt:C.name,className:"w-full h-full object-cover",loading:"eager"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),e.jsx(y,{asChild:!0,variant:"secondary",size:"icon",className:"absolute top-4 left-4",children:e.jsx(Ne,{to:he,children:e.jsx(Ye,{className:"w-5 h-5"})})}),c&&e.jsx(y,{variant:"secondary",size:"icon",className:"absolute top-4 right-4",onClick:lt,children:e.jsx(Nt,{className:`w-5 h-5 ${st?"fill-destructive text-destructive":""}`})}),u&&navigator.share?e.jsx(y,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${c?"right-16":"right-4"}`,onClick:()=>{if(!c){U(!0);return}Ge()},children:e.jsx(ge,{className:"w-5 h-5"})}):e.jsxs(es,{children:[e.jsx(ts,{asChild:!0,children:e.jsx(y,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${c?"right-16":"right-4"}`,onClick:x=>{c||(x.preventDefault(),U(!0))},children:e.jsx(ge,{className:"w-5 h-5"})})}),e.jsxs(ss,{align:"end",className:"w-48",children:[navigator.share&&e.jsxs(e.Fragment,{children:[e.jsxs(de,{onClick:Ge,children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),s("common.moreOptions")]}),e.jsx(ot,{})]}),e.jsxs(de,{onClick:()=>ke("wechat"),children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),"WeChat"]}),e.jsxs(de,{onClick:()=>ke("whatsapp"),children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),e.jsxs(de,{onClick:()=>ke("facebook"),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Facebook"]}),e.jsxs(de,{onClick:()=>ke("twitter"),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"X (Twitter)"]}),e.jsxs(de,{onClick:()=>ke("telegram"),children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),"Telegram"]}),e.jsx(ot,{}),e.jsxs(de,{onClick:Ee,children:[e.jsx(Ts,{className:"w-4 h-4 mr-2"}),s("common.copyLink")]})]})]}),(Me||De)&&n&&e.jsx(ht,{restaurant:n,trigger:e.jsx(y,{variant:"secondary",size:"icon",className:`absolute top-4 ${c?"right-28":"right-16"}`,children:e.jsx(dt,{className:"w-5 h-5"})})}),n&&e.jsx(xt,{targetType:"restaurant",targetId:n.id,onLoginRequired:()=>U(!0),trigger:e.jsx(y,{variant:"secondary",size:"icon",className:`absolute top-4 ${Me||De?c?"right-40":"right-28":c?"right-28":"right-16"}`,children:e.jsx(mt,{className:"w-5 h-5"})})})]}),e.jsx("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12",children:e.jsxs(E,{className:"shadow-large",children:[e.jsx(J,{children:e.jsx("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 flex flex-wrap gap-2",children:C.type.slice(0,3).map((x,p)=>e.jsx(W,{variant:"secondary",children:x},p))}),e.jsx(Ve,{className:"text-3xl mb-2",children:qe(C.name)}),e.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[b!==null&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Te,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"font-semibold text-base",children:[b.toFixed(1)," km"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:`w-5 h-5 ${Oe>0?"fill-accent text-accent":"text-muted-foreground"}`}),Oe>0?e.jsxs("span",{className:"font-semibold text-base",children:[nt.toFixed(1),e.jsxs("span",{className:"text-muted-foreground font-normal text-sm ml-1",children:["(",Oe,")"]})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:s("restaurant.noRatingWithHint")})]}),rt&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(zs,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-base",children:rt})]})]}),n.brand_id&&e.jsx(na,{brandId:n.brand_id}),C.description&&C.description.replace(/<[^>]*>/g,"").trim()!==""&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline mt-3",dangerouslySetInnerHTML:{__html:C.description}})]})})}),e.jsxs(H,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[Le.length>0&&e.jsxs(je,{open:q,onOpenChange:f,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(ve,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(be,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("activities.title")}),!q&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-1",children:Le.map((x,p)=>e.jsx(W,{variant:"default",className:"text-white",style:{backgroundColor:x.badge_color||"#9b87f5"},children:Qe(x,l.language)},`activity-${p}`))})]}),e.jsx(Q,{className:`w-5 h-5 text-muted-foreground transition-transform ${q?"rotate-180":""}`})]})}),e.jsx(we,{className:"mt-3 space-y-2",children:Le.map((x,p)=>{const T=Et(x,l.language);return e.jsxs(Ne,{to:`/activity/${x.activity_id}`,className:"block p-2 rounded-md hover:bg-muted/80 transition-colors",children:[e.jsx(W,{variant:"default",className:"text-white mr-2",style:{backgroundColor:x.badge_color||"#9b87f5"},children:Qe(x,l.language)}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[T||Ot(x,l.language)," ... →"]})]},`activity-detail-${p}`)})})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(Ke,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.address")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-muted-foreground",children:n.address}),n.template==="ghost"&&e.jsx(W,{variant:"secondary",className:"text-xs",children:s("restaurants.ghostKitchen")})]})]})]}),n.phone&&e.jsxs("a",{href:`tel:${n.phone}`,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors cursor-pointer",children:[e.jsx(kt,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.phone")}),e.jsx("p",{className:"text-primary underline",children:n.phone})]})]}),n.opening_hours&&n.template!=="ghost"&&e.jsxs(je,{open:k,onOpenChange:N,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(Is,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(be,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.hours")}),!k&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-0.5",children:[s("restaurant.today")," ",Ms(n.opening_hours)]})]}),e.jsx(Q,{className:`w-5 h-5 text-muted-foreground transition-transform ${k?"rotate-180":""}`})]})}),e.jsx(we,{className:"mt-3",children:e.jsx("div",{className:"space-y-2",children:(()=>{const x=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],p={monday:"dayMon",tuesday:"dayTue",wednesday:"dayWed",thursday:"dayThu",friday:"dayFri",saturday:"daySat",sunday:"daySun"},T=x[new Date().getDay()===0?6:new Date().getDay()-1];return x.map(w=>{const O=n.opening_hours[w],$e=w===T,Bt=s(`restaurant.${p[w]}`);let Ae="N/A";return O&&(O.closed?Ae=s("restaurant.closed"):O.splitShift?Ae=`${O.open} - ${O.close}, ${O.open2} - ${O.close2}`:Ae=`${O.open} - ${O.close}`),e.jsxs("div",{className:`flex justify-between items-center py-1.5 px-2 rounded ${$e?"bg-primary/10 border border-primary/20":""}`,children:[e.jsxs("span",{className:`text-sm font-medium ${$e?"text-primary":"text-foreground"}`,children:[Bt,$e&&e.jsxs("span",{className:"ml-2 text-xs",children:["(",s("restaurant.today"),")"]})]}),e.jsx("span",{className:`text-sm ${$e?"text-primary font-semibold":"text-muted-foreground"} ${O?.closed?"italic":""}`,children:Ae})]},w)})})()})})]})]}),n&&(m(n,"announcement")||n.announcement_zh)&&e.jsxs(je,{open:I,onOpenChange:$,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(ze,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(be,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.announcement")}),e.jsx(Q,{className:`w-5 h-5 text-muted-foreground transition-transform ${I?"rotate-180":""}`})]})}),e.jsx(we,{className:"mt-3",children:e.jsx("div",{className:"p-3 rounded-md bg-primary/5 border border-primary/10",children:e.jsx("p",{className:"text-sm text-foreground whitespace-pre-wrap",children:m(n,"announcement")||n.announcement_zh})})})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[n.template!=="ghost"&&e.jsxs(y,{variant:"secondary",className:"w-full",onClick:()=>B(!0),children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),s("restaurant.getDirections")]}),n.website_url&&(n.show_takeaway_button||n.show_booking_button&&n.template!=="ghost")&&e.jsxs(y,{className:"w-full",onClick:()=>V(!0),children:[e.jsx(Ps,{className:"w-4 h-4 mr-2"}),s("restaurant.orderOrBook","外卖/订台")]})]}),e.jsx(se,{open:Y,onOpenChange:B,children:e.jsxs(ae,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(re,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(Te,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(ne,{className:"text-base font-semibold tracking-tight text-foreground",children:s("navigation.confirmTitle")}),e.jsx(le,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:s("navigation.confirmDescriptionSimple",{destination:C.name})})]})]}),e.jsxs(ie,{className:"relative flex-col gap-2 pt-4 mt-1",children:[e.jsx(oe,{onClick:()=>{ut(n.lat,n.lng,C.name),B(!1)},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:s("navigation.openNavigation","获取路线")}),e.jsx(ce,{className:"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:s("common.cancel")})]})]})}),e.jsx(se,{open:i,onOpenChange:F,children:e.jsxs(ae,{className:"max-w-xs w-[calc(100%-3rem)] mx-auto border-0 bg-white/70 dark:bg-gray-900/70 backdrop-blur-xl shadow-2xl rounded-3xl overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 rounded-3xl bg-gradient-to-b from-white/30 via-transparent to-transparent pointer-events-none"}),e.jsxs(re,{className:"relative text-center pb-2",children:[e.jsx("div",{className:"mx-auto mb-4 w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/20 to-primary/10 flex items-center justify-center shadow-inner shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(Ue,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:2})}),e.jsx(ne,{className:"text-lg font-semibold text-foreground",children:s("restaurant.joinPrivateTitle")}),e.jsx(le,{className:"text-center text-sm text-muted-foreground mt-2 leading-relaxed",children:s("restaurant.joinPrivateDescription")})]}),e.jsxs(ie,{className:"relative flex-col gap-2 pt-4",children:[e.jsxs(oe,{onClick:()=>{const x=new URL(n.website_url);c&&x.searchParams.set("user_id",c.id);const p=x.toString();Ce(p)},className:"w-full rounded-xl py-3 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/20 transition-all duration-200",children:[P?e.jsx(fe,{className:"w-4 h-4 mr-2 animate-spin"}):null,s("restaurant.joinPrivateConfirm")]}),e.jsx(ce,{className:"w-full rounded-xl py-3 bg-white/50 dark:bg-white/10 hover:bg-white/70 dark:hover:bg-white/20 border-0 text-muted-foreground font-medium transition-all duration-200",children:s("common.cancel")})]})]})}),e.jsx(se,{open:ue,onOpenChange:V,children:e.jsxs(ae,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(re,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(Ue,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(ne,{className:"text-base font-semibold tracking-tight text-foreground",children:s("restaurant.orderOrBookTitle","外卖/订台")}),e.jsx(le,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:s("restaurant.orderOrBookDescription","即将为您打开餐厅私域页面")})]})]}),e.jsxs(ie,{className:"relative flex-col gap-2 pt-4 mt-1",children:[e.jsx(oe,{onClick:()=>{try{let x=n.website_url;if(c){const p=new URL(n.website_url);p.searchParams.set("user_id",c.id),x=p.toString()}Ce(x)}catch{Ce(n.website_url)}},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:s("common.continue","继续")}),e.jsx(ce,{className:"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:s("common.cancel")})]})]})}),e.jsx($t,{restaurantId:n.id,showGallery:n.show_dish_gallery!==!1}),n.template!=="ghost"&&e.jsx("div",{ref:G,children:e.jsxs(je,{open:S,onOpenChange:z,className:"p-4 rounded-lg bg-muted/50",children:[e.jsx(be,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:s("restaurant.map")}),e.jsx(Q,{className:`w-5 h-5 text-muted-foreground transition-transform ${S?"rotate-180":""}`})]})}),e.jsx(we,{children:_?e.jsx("div",{ref:r,className:"h-[350px] rounded-lg overflow-hidden bg-muted"}):e.jsx("div",{className:"h-[350px] rounded-lg bg-muted flex items-center justify-center",children:e.jsx(fe,{className:"w-6 h-6 animate-spin text-muted-foreground"})})})]})}),e.jsx(Xe,{}),e.jsx(Mt,{restaurantId:n.id}),e.jsx(Xe,{}),e.jsx("div",{ref:L,children:D?e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(fe,{className:"w-8 h-8 animate-spin text-primary"})}),children:e.jsx(la,{restaurantId:n.id})}):e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(fe,{className:"w-8 h-8 animate-spin text-muted-foreground"})})})]})]})}),e.jsx(se,{open:xe,onOpenChange:U,children:e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsx(ne,{children:s("activities.loginRequired")}),e.jsx(le,{children:s("activities.loginRequiredMessage")})]}),e.jsxs(ie,{children:[e.jsx(ce,{children:s("common.cancel")}),e.jsx(oe,{onClick:()=>K("/auth"),children:s("activities.goToLogin")})]})]})}),v]})})};export{Ua as default};
//# sourceMappingURL=RestaurantDetail-b-tzi6t1.js.map
