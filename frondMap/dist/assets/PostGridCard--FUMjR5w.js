import{r as n,p as U,u as V,j as e,bi as q,c$ as B,ak as H,cC as v,b5 as W,cx as J,bh as K,bG as Q,b9 as X,b1 as Y,b6 as Z}from"./vendor-react-DImbKuZP.js";import{u as ee,T as se,U as ae,V as te,W as C,B as l,r as re,t as ie,v as le,A as ne,f as ce,h as oe,i as de,j as me,k as ue,l as xe,m as he}from"./index-_G3CuCzp.js";import{a as ge,b as fe}from"./useCommunityPosts-CIwfJkFk.js";import{u as pe}from"./useLocalizedContent-B2SRIfSp.js";import{u as je}from"./useLoginRequired-DynG1Vvm.js";import{E as ve,a as be}from"./EditRecipeDialog-C_ulThZR.js";const ye=({post:s,showAssociations:D=!1})=>{const{t}=U(),{user:_}=ee(),c=V(),{getLocalizedField:u}=pe(),{requireLogin:A}=je(),P=ge(),E=fe(),[$,T]=n.useState(!1),[I,x]=n.useState(!1),[b,h]=n.useState(!1),r=s,i=r.post_type==="recipe",y=_?.id===s.author_id,L=a=>{a.preventDefault(),a.stopPropagation(),A()&&P.mutate({postId:s.id,liked:s.user_liked||!1})},R=()=>c(`/community/${s.id}`),S=(a,j)=>{a.preventDefault(),a.stopPropagation(),c(`/restaurant/${j}`)},M=a=>{a.preventDefault(),a.stopPropagation(),s.activity?.id&&c(`/activity/${s.activity.id}`)},z=()=>{E.mutate(s.id),x(!1)},O=a=>a.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/\[\[NOTE\]\]/g,"").replace(/\[\[INTRO\]\]/g,"").trim(),N=u(s,"content"),o=n.useMemo(()=>O(N),[N]),w=s.image_urls&&s.image_urls.length>0,d=!!s.video_url,g=w||d,k=s.image_urls?.length||0,m=[...s.restaurants||[],...s.restaurant&&!s.restaurants?.find(a=>a.id===s.restaurant?.id)?[s.restaurant]:[]],f=s.activity?u(s.activity,"title"):null,p=2,F=a=>{switch(a){case"easy":return"bg-green-500/20 text-green-700 dark:text-green-400";case"medium":return"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400";case"hard":return"bg-red-500/20 text-red-700 dark:text-red-400";default:return"bg-muted text-muted-foreground"}},G=a=>{switch(a){case"easy":return t("recipe.difficulty.easy","简单");case"medium":return t("recipe.difficulty.medium","中等");case"hard":return t("recipe.difficulty.hard","困难");default:return a}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"group cursor-pointer rounded-lg overflow-hidden bg-card border border-border/50 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 relative",onClick:R,children:[y&&e.jsx("div",{className:"absolute top-2 right-2 z-20",onClick:a=>a.stopPropagation(),children:e.jsxs(se,{children:[e.jsx(ae,{asChild:!0,children:e.jsx("button",{className:"h-7 w-7 rounded-full bg-black/40 backdrop-blur-sm flex items-center justify-center hover:bg-black/60 transition-colors",children:e.jsx(q,{className:"h-4 w-4 text-white"})})}),e.jsxs(te,{align:"end",className:"min-w-[120px]",children:[e.jsxs(C,{onClick:()=>h(!0),children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),t("common.edit","编辑")]}),e.jsxs(C,{className:"text-destructive focus:text-destructive",onClick:()=>x(!0),children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),t("common.delete","删除")]})]})]})}),g&&e.jsxs("div",{className:`relative ${i?"aspect-[4/3]":"aspect-[4/5]"} overflow-hidden`,children:[w?$?e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-muted-foreground",children:t("common.imageLoadError","图片加载失败")})}):e.jsx("img",{src:s.image_urls[0],alt:"",loading:"lazy",className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500",onError:()=>T(!0)}):d?e.jsx("video",{src:s.video_url,className:"w-full h-full object-cover",preload:"metadata",muted:!0,playsInline:!0}):null,i&&e.jsxs(l,{className:"absolute top-2 left-2 bg-primary text-primary-foreground gap-1",children:[e.jsx(v,{className:"h-3 w-3"}),t("recipe.badge","食谱")]}),d&&!i&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-black/50 backdrop-blur-sm flex items-center justify-center",children:e.jsx(W,{className:"h-5 w-5 text-white fill-white ml-0.5"})})}),!d&&k>1&&!i&&e.jsxs("div",{className:`absolute top-2 ${y?"right-11":"right-2"} bg-black/60 text-white text-xs px-2 py-0.5 rounded-full z-10 flex items-center gap-1`,children:[e.jsx(J,{className:"h-3 w-3"}),e.jsx("span",{children:k})]})]}),!g&&i&&e.jsxs("div",{className:"relative aspect-[4/3] overflow-hidden bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center",children:[e.jsx(v,{className:"h-12 w-12 text-primary/40"}),e.jsxs(l,{className:"absolute top-2 left-2 bg-primary text-primary-foreground gap-1",children:[e.jsx(v,{className:"h-3 w-3"}),t("recipe.badge","食谱")]})]}),e.jsxs("div",{className:"p-3",children:[i&&e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground mb-2",children:[r.cook_time&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(K,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[r.cook_time,t("recipe.min","分")]})]}),r.servings&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[r.servings,t("recipe.servingsShort","人")]})]}),r.difficulty&&e.jsx(l,{variant:"secondary",className:`text-xs px-1.5 py-0 h-5 ${F(r.difficulty)}`,children:G(r.difficulty)})]}),D&&(m.length>0||f)&&e.jsxs("div",{className:"flex flex-wrap gap-1.5 mb-2",children:[m.slice(0,p).map(a=>e.jsxs(l,{variant:"secondary",className:"text-xs cursor-pointer hover:bg-secondary/80 gap-1",onClick:j=>S(j,a.id),children:[e.jsx(X,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate max-w-[120px]",children:u(a,"name")})]},a.id)),m.length>p&&e.jsxs(l,{variant:"secondary",className:"text-xs gap-1",children:["+",m.length-p]}),f&&e.jsxs(l,{variant:"secondary",className:"text-xs cursor-pointer hover:bg-secondary/80 gap-1",onClick:M,children:[e.jsx(Y,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate max-w-[120px]",children:f})]})]}),e.jsx("p",{className:`text-sm font-medium line-clamp-2 leading-relaxed ${g?"":"min-h-[60px]"}`,children:i?r.recipe_name:o}),i&&o&&!o.includes("主要配料：")&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-3 leading-relaxed mt-1",children:o}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1 cursor-pointer",onClick:a=>{a.preventDefault(),a.stopPropagation(),s.author?.id&&c(`/user/${s.author.id}`)},children:[e.jsxs(re,{className:"h-5 w-5 flex-shrink-0 hover:ring-2 hover:ring-primary/50 transition-all",children:[e.jsx(ie,{src:s.author?.avatar_url||void 0}),e.jsx(le,{className:"text-[10px]",children:s.author?.display_name?.charAt(0)||"?"})]}),e.jsx("span",{className:"text-xs text-muted-foreground truncate hover:text-foreground transition-colors",children:s.author?.display_name})]}),e.jsxs("button",{className:`flex items-center gap-1 text-xs ${s.user_liked?"text-red-500":"text-muted-foreground"} hover:text-red-500 transition-colors`,onClick:L,children:[e.jsx(Z,{className:`h-4 w-4 ${s.user_liked?"fill-current":""}`}),e.jsx("span",{children:s.likes_count||0})]})]})]})]}),e.jsx(ne,{open:I,onOpenChange:x,children:e.jsxs(ce,{children:[e.jsxs(oe,{children:[e.jsx(de,{children:t("community.deleteConfirmTitle","确认删除")}),e.jsx(me,{children:t("community.deleteConfirmDesc","删除后将无法恢复，确定要删除这篇帖子吗？")})]}),e.jsxs(ue,{children:[e.jsx(xe,{children:t("common.cancel","取消")}),e.jsx(he,{onClick:z,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:t("common.delete","删除")})]})]})}),i?e.jsx(ve,{post:s,open:b,onOpenChange:h}):e.jsx(be,{post:s,open:b,onOpenChange:h})]})},Ae=n.memo(ye);export{Ae as P};
//# sourceMappingURL=PostGridCard--FUMjR5w.js.map
