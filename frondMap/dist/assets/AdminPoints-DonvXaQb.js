import{p as I,bQ as Z,bU as W,j as e,bY as q,ee as L,cd as $,w as p,r as u,bG as X,cb as w,a_ as S}from"./vendor-react-DImbKuZP.js";import{D as ee,c as se,d as ae,e as ne,Z as te,J as Q,ae as re,q as j,C,E as P,K as D,F as _,s as ie,B as ce}from"./index-_G3CuCzp.js";import{T as F,a as R,b as y,c as i,d as H,e as c}from"./table-Bio9GwFz.js";import{T as oe,a as le,b as A,c as G}from"./tabs-Dk5peax5.js";import{a as de,b as me}from"./usePoints-AkMaCQUC.js";import{F as he,a as U,b as k,c as E,d as M,e as B}from"./form-BxiX7v56.js";import{N as xe,T as ue,O as pe,D as je}from"./vendor-utils-vwQGbBim.js";import"./vendor-i18n-AOdgFpXS.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-CRxszhSs.js";const ge=a=>xe({amount:ue().min(1,a("admin.points.amountRequired")),reason:pe().min(1,a("admin.points.reasonRequired"))}),fe=({open:a,onOpenChange:l,user:d,type:t})=>{const{t:n}=I(),m=de(),N=ge(n),o=Z({resolver:W(N),defaultValues:{amount:10,reason:""}}),g=async r=>{if(!d)return;const h=t==="deduct"?-r.amount:r.amount;try{const x=await m.mutateAsync({userId:d.id,amount:h,reason:r.reason});x.success?(p.success(n(t==="grant"?"admin.points.grantSuccess":"admin.points.deductSuccess")),o.reset(),l(!1)):p.error(x.error||n("common.error"))}catch(x){console.error("Error modifying points:",x),p.error(n("common.error"))}};return d?e.jsx(ee,{open:a,onOpenChange:l,children:e.jsxs(se,{children:[e.jsxs(ae,{children:[e.jsx(ne,{className:"flex items-center gap-2",children:t==="grant"?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-5 w-5 text-green-500"}),n("admin.points.grantPoints")]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-5 w-5 text-red-500"}),n("admin.points.deductPoints")]})}),e.jsxs(te,{children:[n("admin.points.targetUser"),": ",e.jsx("strong",{children:d.display_name}),e.jsx("br",{}),n("admin.points.currentPoints"),": ",e.jsx("strong",{children:d.points})]})]}),e.jsx(he,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(g),className:"space-y-4",children:[e.jsx(U,{control:o.control,name:"amount",render:({field:r})=>e.jsxs(k,{children:[e.jsx(E,{children:n("admin.points.amount")}),e.jsx(M,{children:e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Q,{type:"number",className:"pl-10",min:1,...r,onChange:h=>r.onChange(parseInt(h.target.value)||0)})]})}),e.jsx(B,{})]})}),e.jsx(U,{control:o.control,name:"reason",render:({field:r})=>e.jsxs(k,{children:[e.jsxs(E,{children:[n("admin.points.reason")," *"]}),e.jsx(M,{children:e.jsx(re,{...r,placeholder:n(t==="grant"?"admin.points.grantReasonPlaceholder":"admin.points.deductReasonPlaceholder"),rows:3})}),e.jsx(B,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>l(!1),children:n("common.cancel")}),e.jsx(j,{type:"submit",disabled:m.isPending,variant:t==="deduct"?"destructive":"default",children:m.isPending?n("common.processing"):n(t==="grant"?"admin.points.confirmGrant":"admin.points.confirmDeduct")})]})]})})]})}):null},_e=()=>{const{t:a}=I(),{data:l,isLoading:d}=me(),[t,n]=u.useState(""),[m,N]=u.useState([]),[o,g]=u.useState(!1),[r,h]=u.useState(!1),[x,b]=u.useState(null),[z,v]=u.useState("grant"),T=async()=>{if(!t.trim()){p.error(a("admin.points.enterSearchTerm"));return}g(!0);try{const{data:s,error:f}=await ie.from("profiles").select("id, display_name, avatar_url, points").or(`display_name.ilike.%${t}%,id.eq.${t.match(/^[0-9a-f-]{36}$/i)?t:"00000000-0000-0000-0000-000000000000"}`).limit(20);if(f)throw f;N(s||[])}catch(s){console.error("Search error:",s),p.error(a("common.error"))}finally{g(!1)}},K=s=>{b(s),v("grant"),h(!0)},O=s=>{b(s),v("deduct"),h(!0)},V=s=>{switch(s){case"comment":return a("admin.points.typeComment");case"admin_grant":return a("admin.points.typeAdminGrant");case"admin_deduct":return a("admin.points.typeAdminDeduct");case"purchase":return a("admin.points.typePurchase");case"refund":return a("admin.points.typeRefund");case"expire":return a("admin.points.typeExpire");default:return s}},J=(s,f)=>{const Y=f>0;return e.jsx(ce,{variant:Y?"default":"secondary",children:V(s)})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:a("admin.points.title")}),e.jsx("p",{className:"text-muted-foreground",children:a("admin.points.description")})]}),e.jsxs(oe,{defaultValue:"users",className:"space-y-4",children:[e.jsxs(le,{children:[e.jsxs(A,{value:"users",className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),a("admin.points.userManagement")]}),e.jsxs(A,{value:"history",className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),a("admin.points.transactionHistory")]})]}),e.jsx(G,{value:"users",className:"space-y-4",children:e.jsxs(C,{children:[e.jsx(P,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5"}),a("admin.points.searchUser")]})}),e.jsxs(_,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Q,{placeholder:a("admin.points.searchPlaceholder"),value:t,onChange:s=>n(s.target.value),onKeyDown:s=>s.key==="Enter"&&T()}),e.jsxs(j,{onClick:T,disabled:o,children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),a("common.search")]})]}),m.length>0&&e.jsx("div",{className:"mt-4",children:e.jsxs(F,{children:[e.jsx(R,{children:e.jsxs(y,{children:[e.jsx(i,{children:a("admin.points.user")}),e.jsx(i,{children:a("admin.points.currentPoints")}),e.jsx(i,{className:"text-right",children:a("common.actions")})]})}),e.jsx(H,{children:m.map(s=>e.jsxs(y,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:s.display_name,className:"w-8 h-8 rounded-full object-cover"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-muted flex items-center justify-center",children:s.display_name?.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.display_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.id})]})]})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"font-semibold",children:s.points})]})}),e.jsx(c,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>K(s),children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),a("admin.points.grant")]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>O(s),children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),a("admin.points.deduct")]})]})})]},s.id))})]})}),m.length===0&&t&&!o&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:a("admin.points.noResults")})]})]})}),e.jsx(G,{value:"history",children:e.jsxs(C,{children:[e.jsx(P,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5"}),a("admin.points.recentTransactions")]})}),e.jsx(_,{children:d?e.jsx("div",{className:"text-center py-8",children:a("common.loading")}):l&&l.length>0?e.jsxs(F,{children:[e.jsx(R,{children:e.jsxs(y,{children:[e.jsx(i,{children:a("admin.points.time")}),e.jsx(i,{children:a("admin.points.user")}),e.jsx(i,{children:a("admin.points.type")}),e.jsx(i,{children:a("admin.points.amount")}),e.jsx(i,{children:a("admin.points.balance")}),e.jsx(i,{children:a("admin.points.reason")})]})}),e.jsx(H,{children:l.map(s=>e.jsxs(y,{children:[e.jsx(c,{className:"text-sm",children:je(new Date(s.created_at),"yyyy-MM-dd HH:mm")}),e.jsx(c,{children:e.jsx("div",{className:"font-medium",children:s.profiles?.display_name||s.user_id})}),e.jsx(c,{children:J(s.type,s.amount)}),e.jsx(c,{children:e.jsxs("span",{className:s.amount>0?"text-green-600":"text-red-600",children:[s.amount>0?"+":"",s.amount]})}),e.jsx(c,{children:s.balance_after}),e.jsx(c,{className:"text-sm text-muted-foreground max-w-[200px] truncate",children:s.reason||"-"})]},s.id))})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:a("admin.points.noTransactions")})})]})})]}),e.jsx(fe,{open:r,onOpenChange:h,user:x,type:z})]})};export{_e as default};
//# sourceMappingURL=AdminPoints-DonvXaQb.js.map
