const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-supabase-CRxszhSs.js","assets/vendor-react-DImbKuZP.js","assets/vendor-i18n-AOdgFpXS.js","assets/vendor-editor-B1vH4T8i.js","assets/vendor-utils-vwQGbBim.js","assets/vendor-react-CG6K1Se3.css"])))=>i.map(i=>d[i]);
import{p as Q,j as e,b6 as Ve,s as Ge,u as ha,r as x,bV as Oa,bW as $a,M as Ta,bX as Ra,ak as ps,w as v,bg as Ce,bY as Vs,bf as Ds,y as Ua,aW as za,bZ as qa,b_ as La,b$ as Ha,an as Je,c0 as Ba,c1 as Ka,c2 as Ze,bh as fe,b1 as me,L as F,c3 as Js,b9 as xe,bG as Bs,c4 as Ma,bQ as Qa,bU as Va,aM as Ps,c5 as Ja,bL as Is,bM as Ga,c6 as Es,c7 as He,c8 as ze,c9 as Gs,a4 as Xa,ca as Ya,cb as Za,aw as Wa,bn as et,b4 as st,cc as at,am as Xs,aK as Be,q as tt,a$ as We,cd as Ys,aX as Zs,ba as Ws,bu as ea,ce as sa}from"./vendor-react-DImbKuZP.js";import{D as Se,c as ke,d as Ae,e as De,B as j,u as Pe,s as A,Q as ua,a6 as fa,a7 as rt,a1 as ja,q as g,Z as hs,r as Fs,t as Os,v as $s,J as _,$ as k,a8 as ls,a9 as cs,aa as os,ab as ds,ac as ms,A as re,f as ie,h as ne,i as le,j as ce,k as oe,l as de,m as ee,_ as it,a4 as ga,C as P,E as z,K as B,F as I,a5 as M,a0 as nt,ad as lt,Y as ct,ae as ot,S as xs,a2 as dt,a as mt,x as xt,b as pt}from"./index-_G3CuCzp.js";import{T as Ke,a as Me,b as $,c as T}from"./tabs-Dk5peax5.js";import{C as ht,a as ut,b as es}from"./carousel-DSvpUTGO.js";import{a as ft}from"./useActivities-B-dkIh_c.js";import{u as fs}from"./useLocalizedContent-B2SRIfSp.js";import{u as jt}from"./useActivityParticipation-DhsksXqN.js";import{d as gt}from"./useCoupons-CNcgtS4u.js";import{u as vt}from"./useCommunityPosts-CIwfJkFk.js";import{P as aa}from"./PostGridCard--FUMjR5w.js";import{u as Nt,a as yt,b as wt,c as bt,d as _t,P as ta}from"./PointsHistoryDialog-CiD-aG5o.js";import{C as Ct}from"./checkbox-DvE0llcT.js";import{A as ra}from"./ActivityTermsAgreement-nfGD1UJb.js";import{S as Ts}from"./separator-8wE-3N0K.js";import{D as ue,N as St,O as ss,H as us,p as kt,I as At,J as Dt}from"./vendor-utils-vwQGbBim.js";import{P as Pt}from"./PullToRefresh-BimBuYXa.js";import{C as It,a as Et,b as Ft}from"./collapsible-dyuDlGDF.js";import{u as Ot,a as $t,b as Tt,c as Rt}from"./useInvitationCodes-DGmL0Fzn.js";import{F as Ut,a as as,b as ts,c as rs,d as is,e as ns}from"./form-BxiX7v56.js";import{u as zt}from"./useSavedRecipes-BgAf4HJl.js";import{g as qt,c as Lt}from"./geolocation-YPf7LJYy.js";import"./vendor-i18n-AOdgFpXS.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-CRxszhSs.js";import"./useLoginRequired-DynG1Vvm.js";import"./EditRecipeDialog-C_ulThZR.js";import"./drawer-CK8DetMs.js";import"./popover-CLT125d5.js";import"./useRestaurants-DXIIBXS_.js";import"./progress-Bi_ViBYA.js";import"./usePoints-AkMaCQUC.js";import"./useActivityRules-BHraIJKQ.js";function Ht({open:s,onOpenChange:a,activity:i}){const{t}=Q();return e.jsx(Se,{open:s,onOpenChange:a,children:e.jsxs(ke,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsx(Ae,{children:e.jsx(De,{className:"text-lg font-semibold line-clamp-2",children:i.title})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(j,{variant:"secondary",className:"flex items-center gap-1.5 w-fit",children:[e.jsx(Ve,{className:"w-3.5 h-3.5 fill-primary text-primary"}),t("profile.activityFavorited")]}),i.image_url&&e.jsx("div",{className:"w-full aspect-video rounded-lg overflow-hidden bg-secondary/30",children:e.jsx("img",{src:i.image_url,alt:i.title,className:"w-full h-full object-cover"})}),e.jsx("div",{className:`text-muted-foreground text-sm prose prose-sm max-w-none line-clamp-4\r
              [&_span[style*='color']]:!text-inherit`,dangerouslySetInnerHTML:{__html:i.content}})]})]})})}const Bt=()=>{const{user:s}=Pe();return Ge({queryKey:["favorites-restaurants",s?.id],queryFn:async()=>{if(!s)return[];const{data:a,error:i}=await A.from("favorites").select("restaurant_id").eq("user_id",s.id);if(i)throw console.error("Error fetching favorites:",i),i;if(!a||a.length===0)return[];const t=a.map(o=>o.restaurant_id),{data:c,error:r}=await A.from("restaurants").select("*").in("id",t).eq("visible",!0);if(r)throw console.error("Error fetching favorite restaurants:",r),r;return c||[]},enabled:!!s})},Kt=()=>{const{user:s}=Pe();return Ge({queryKey:["user-comments",s?.id],queryFn:async()=>{if(!s)return[];const{data:a,error:i}=await A.from("comments").select("*").eq("user_id",s.id).is("parent_id",null).order("created_at",{ascending:!1});if(i)throw i;if(!a||a.length===0)return[];const t=a.filter(n=>n.target_type==="restaurant").map(n=>n.target_id),c=a.filter(n=>n.target_type==="activity").map(n=>n.target_id),r=new Map;if(t.length>0){const{data:n}=await A.from("restaurants").select("id, name, name_en, name_pt").in("id",t);n?.forEach(p=>{r.set(p.id,{name:p.name,name_en:p.name_en||void 0,name_pt:p.name_pt||void 0})})}const o=new Map;if(c.length>0){const{data:n}=await A.from("activities").select("id, title_zh, title_en, title_pt").in("id",c);n?.forEach(p=>{o.set(p.id,{title_zh:p.title_zh,title_en:p.title_en,title_pt:p.title_pt})})}return a.map(n=>{if(n.target_type==="restaurant"){const p=r.get(n.target_id);return{...n,target_name:p?.name||"Unknown Restaurant",target_name_en:p?.name_en,target_name_pt:p?.name_pt}}else if(n.target_type==="activity"){const p=o.get(n.target_id);return{...n,target_name:p?.title_zh||"Unknown Activity",target_name_en:p?.title_en,target_name_pt:p?.title_pt}}return n})},enabled:!!s,staleTime:3e4})},Mt=()=>{const{user:s}=Pe(),{data:a=[]}=jt();return Ge({queryKey:["merchantActivities",s?.id],queryFn:async()=>{if(!s||a.length===0)return[];const i=a.map(m=>m.id),{data:t,error:c}=await A.from("activity_restaurants").select("*").in("restaurant_id",i).order("created_at",{ascending:!1});if(c)throw c;if(!t||t.length===0)return[];const{data:r}=await A.from("restaurants").select("id, name, name_en, name_pt, address").in("id",i),o=[...new Set(t.map(m=>m.activity_id))],{data:n}=await A.from("activities").select("*").in("id",o).eq("status","published");return t.map(m=>{const h=r?.find(b=>b.id===m.restaurant_id),E=n?.find(b=>b.id===m.activity_id);return{activity_id:m.activity_id,restaurant_id:m.restaurant_id,restaurant_name:h?.name||"",restaurant_name_en:h?.name_en||null,restaurant_name_pt:h?.name_pt||null,restaurant_address:h?.address||"",activity:E||null,created_at:m.created_at}}).filter(m=>m.activity!==null)},enabled:!!s&&a.length>0})},va=[{code:"+351",country:"Portugal",flag:"ðŸ‡µðŸ‡¹"},{code:"+34",country:"Spain",flag:"ðŸ‡ªðŸ‡¸"},{code:"+33",country:"France",flag:"ðŸ‡«ðŸ‡·"},{code:"+49",country:"Germany",flag:"ðŸ‡©ðŸ‡ª"},{code:"+39",country:"Italy",flag:"ðŸ‡®ðŸ‡¹"},{code:"+44",country:"UK",flag:"ðŸ‡¬ðŸ‡§"},{code:"+31",country:"Netherlands",flag:"ðŸ‡³ðŸ‡±"},{code:"+32",country:"Belgium",flag:"ðŸ‡§ðŸ‡ª"},{code:"+86",country:"China",flag:"ðŸ‡¨ðŸ‡³"},{code:"+1",country:"USA/Canada",flag:"ðŸ‡ºðŸ‡¸"},{code:"+55",country:"Brazil",flag:"ðŸ‡§ðŸ‡·"}],ia=s=>{if(!s)return{code:"+351",number:""};for(const a of va)if(s.startsWith(a.code))return{code:a.code,number:s.slice(a.code.length).trim()};return{code:"+351",number:s}},na=({profile:s})=>{const{t:a}=Q(),i=ha(),{user:t}=Pe(),{isAdmin:c}=ua(),[r,o]=x.useState(!1),[n,p]=x.useState(s.display_name),m=ia(s.phone),[h,E]=x.useState(m.code),[b,K]=x.useState(m.number),[R,U]=x.useState(!1),[C,q]=x.useState(null),[w,pe]=x.useState(s.avatar_url||""),[Ie,L]=x.useState(!1),[qe,je]=x.useState(!1),[se,y]=x.useState(""),[Le,ge]=x.useState(!1),X=x.useRef(!1);x.useEffect(()=>{const d=X.current;if(X.current=r,r&&!d){p(s.display_name);const f=ia(s.phone);E(f.code),K(f.number),pe(s.avatar_url||""),q(null),U(!1)}},[r,s.display_name,s.phone,s.avatar_url]);const[Y,ve]=x.useState(!1),[ae,Ee]=x.useState(!1),[Xe,Fe]=x.useState(!1),[V,Oe]=x.useState(""),[J,Ne]=x.useState(""),[O,ye]=x.useState(""),[H,we]=x.useState(!1),[Z,G]=x.useState(!1),[$e,Te]=x.useState(!1),[Ye,be]=x.useState(!1),[S,_e]=x.useState(!1),[Re,l]=x.useState(""),[u,N]=x.useState(""),[D,te]=x.useState(""),[Ks,js]=x.useState(!1),[gs,vs]=x.useState(""),[Ue,Ns]=x.useState(!1),[Ms,Qs]=x.useState(!1),[W,ys]=x.useState(null),ws=x.useRef(null),bs=x.useRef(null),_s=x.useRef(null),Cs=fa(),Ss=rt();x.useEffect(()=>{H&&ws.current&&ws.current.focus()},[H]),x.useEffect(()=>{Z&&bs.current&&bs.current.focus()},[Z]),x.useEffect(()=>{Ue&&_s.current&&_s.current.focus()},[Ue]);const Na=d=>{const f=d.target.files?.[0];if(f){if(f.size>2*1024*1024)return;q(f),pe(URL.createObjectURL(f))}},ya=async()=>{let d=s.avatar_url;if(C){const he=await Ss.mutateAsync(C);he&&(d=he)}const f=b?`${h} ${b}`:void 0;await Cs.mutateAsync({display_name:n,phone:f,avatar_url:d||void 0}),U(!1),o(!1)},wa=async()=>{if(!(!t||se.toLowerCase()!=="delete")){ge(!0);try{const{error:d}=await A.functions.invoke("delete-account",{body:{userId:t.id}});if(d){v.error(a("profile.deleteAccountFailed")),console.error(d),ge(!1);return}v.success(a("profile.deleteAccountSuccess")),je(!1),L(!1),y(""),await new Promise(f=>setTimeout(f,1500)),await A.auth.signOut(),i("/auth")}catch(d){v.error(d.message||a("profile.deleteAccountFailed")),ge(!1)}finally{ge(!1)}}},ba=async()=>{if(t?.email)try{const{error:d}=await A.functions.invoke("send-verification-code",{body:{email:t.email}});if(d)throw d;we(!0),v.success(a("profile.codeSentToOldEmail"))}catch(d){v.error(a("profile.sendCodeFailed")),console.error(d)}},_a=async()=>{if(!J){v.error(a("profile.enterCodePlaceholder"));return}try{const{data:d,error:f}=await A.functions.invoke("verify-email-code",{body:{email:t?.email,code:J}});if(f||!d?.success){v.error(a("profile.codeIncorrect"));return}v.success(a("profile.oldEmailVerified")),ve(!1),Ee(!0)}catch(d){v.error(a("profile.verificationFailed")),console.error(d)}},Ca=async()=>{if(!V||!V.includes("@")){v.error(a("profile.enterValidEmail"));return}try{const{error:d}=await A.functions.invoke("send-verification-code",{body:{email:V}});if(d)throw d;v.success(a("profile.codeSentToNewEmail")),G(!0)}catch(d){v.error(a("profile.sendCodeFailed")),console.error(d)}},Sa=async()=>{if(!O){v.error(a("profile.enterCodePlaceholder"));return}try{const{data:d,error:f}=await A.functions.invoke("verify-email-code",{body:{email:V,code:O}});if(f||!d?.success){v.error(a("profile.codeIncorrect"));return}v.success(a("profile.newEmailVerified")),Ee(!1),setTimeout(()=>{Fe(!0)},100)}catch(d){v.error(a("toast.verificationFailed")),console.error(d)}},ka=async()=>{Te(!0);try{const{data:{session:d}}=await A.auth.getSession();if(!d||!t){v.error(a("toast.pleaseSignIn")),Te(!1);return}const{data:f,error:he}=await A.functions.invoke("update-email",{body:{userId:t.id,oldEmail:t.email,oldEmailCode:J,newEmail:V,newEmailCode:O},headers:{Authorization:`Bearer ${d.access_token}`}});if(he||!f?.success)throw new Error(f?.error||"Failed to update email");v.success(a("toast.emailUpdatedSuccess")),Fe(!1),o(!1),Ne(""),Oe(""),ye(""),we(!1),G(!1),await new Promise(ks=>setTimeout(ks,1500)),await A.auth.signOut(),i("/auth")}catch(d){v.error(d.message||a("toast.emailUpdateError")),console.error(d)}finally{Te(!1)}},Aa=d=>{let f=0;return d.length>=6&&f++,d.length>=8&&f++,/[a-z]/.test(d)&&f++,/[A-Z]/.test(d)&&f++,/[0-9]/.test(d)&&f++,/[^a-zA-Z0-9]/.test(d)&&f++,f<=2?"weak":f<=4?"medium":"strong"},Da=async d=>{if(d?.preventDefault(),d?.stopPropagation(),!Re){v.error(a("profile.enterCurrentPassword"));return}try{const{createClient:f}=await it(async()=>{const{createClient:Fa}=await import("./vendor-supabase-CRxszhSs.js");return{createClient:Fa}},__vite__mapDeps([0,1,2,3,4,5])),he=f("https://tzdgqhwyzsxkxnncgzap.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",{auth:{persistSession:!1,autoRefreshToken:!1}}),{error:ks}=await he.auth.signInWithPassword({email:t?.email||"",password:Re});if(ks){v.error(a("profile.oldPasswordIncorrect"));return}v.success(a("profile.oldPasswordVerified")),be(!1),_e(!0)}catch(f){v.error(a("profile.verificationFailed")),console.error(f)}},Pa=async()=>{if(t?.email)try{const{error:d}=await A.functions.invoke("send-verification-code",{body:{email:t.email}});if(d)throw d;Ns(!0),v.success(a("profile.codeSentToOldEmail"))}catch(d){v.error(a("profile.sendCodeFailed")),console.error(d)}},Ia=async d=>{if(d?.preventDefault(),d?.stopPropagation(),!gs){v.error(a("profile.enterCodePlaceholder"));return}try{const{data:f,error:he}=await A.functions.invoke("verify-email-code",{body:{email:t?.email,code:gs}});if(he||!f?.success){v.error(a("profile.codeIncorrect"));return}v.success(a("profile.oldEmailVerified")),be(!1),_e(!0)}catch(f){v.error(a("profile.verificationFailed")),console.error(f)}},Ea=async d=>{if(d?.preventDefault(),d?.stopPropagation(),!u||!D){v.error(a("profile.enterNewPassword"));return}if(u.length<6){v.error(a("profile.passwordTooShort"));return}if(u!==D){v.error(a("profile.passwordsDontMatch"));return}Qs(!0);try{const{error:f}=await A.auth.updateUser({password:u});if(f)throw f;v.success(a("profile.passwordUpdated")),_e(!1),o(!1),l(""),N(""),te(""),js(!1),vs(""),Ns(!1)}catch(f){v.error(f.message||a("profile.passwordUpdateFailed")),console.error(f)}finally{Qs(!1)}};return e.jsxs(Se,{open:r,onOpenChange:o,children:[e.jsx(ja,{asChild:!0,children:e.jsxs(g,{variant:"outline",children:[e.jsx(Oa,{className:"w-4 h-4 mr-2"}),a("profile.editProfile")]})}),e.jsxs(ke,{className:"max-w-[90vw] sm:max-w-[425px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ae,{children:[e.jsx(De,{children:a("profile.editProfile")}),e.jsx(hs,{children:a("profile.editProfileDescription")})]}),e.jsxs("div",{className:"space-y-3 py-3",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs(Fs,{className:"w-16 h-16 sm:w-24 sm:h-24",children:[e.jsx(Os,{src:w}),e.jsx($s,{children:n?.charAt(0).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx(_,{type:"file",accept:"image/*",onChange:Na,className:"hidden",id:"avatar-upload"}),e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>document.getElementById("avatar-upload")?.click(),className:"text-xs sm:text-sm",children:[e.jsx($a,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),a("profile.uploadAvatar")]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(k,{htmlFor:"displayName",className:"text-sm",children:a("profile.displayName")}),e.jsx(_,{id:"displayName",value:n,onChange:d=>p(d.target.value),placeholder:a("profile.displayName"),className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(k,{htmlFor:"phone",className:"text-sm",children:a("profile.phone")}),!s.phone&&!R?e.jsx(g,{variant:"outline",size:"sm",onClick:()=>U(!0),className:"w-full justify-start h-9",children:a("profile.addPhoneNumber")}):R||!s.phone?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ls,{value:h,onValueChange:E,children:[e.jsx(cs,{className:"w-[110px] h-9",children:e.jsx(os,{placeholder:"+351"})}),e.jsx(ds,{children:va.map(d=>e.jsx(ms,{value:d.code,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:d.flag}),e.jsx("span",{children:d.code})]})},d.code))})]}),e.jsx(_,{id:"phone",className:"flex-1 h-9",value:b,onChange:d=>K(d.target.value),placeholder:a("profile.phonePlaceholder")})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{value:`${h} ${b}`,disabled:!0,className:"h-9 flex-1"}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>U(!0),className:"text-xs whitespace-nowrap",children:a("profile.modifyPhoneNumber")})]})]}),!c&&e.jsxs("div",{className:"space-y-1.5 pt-2 border-t",children:[e.jsx(k,{className:"text-sm",children:a("profile.email")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{value:t?.email||"",disabled:!0,className:"h-9 flex-1"}),e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>ve(!0),className:"text-xs",children:[e.jsx(Ta,{className:"w-3 h-3 mr-1"}),a("profile.modify")]})]})]}),e.jsxs("div",{className:`space-y-1.5 ${c?"pt-2 border-t":""}`,children:[e.jsx(k,{className:"text-sm",children:a("profile.changePassword")}),e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>be(!0),className:"w-full justify-start h-9",children:[e.jsx(Ra,{className:"w-3 h-3 mr-2"}),a("profile.changePassword")]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 pt-2 border-t",children:[!c&&e.jsxs(g,{variant:"destructive",size:"sm",onClick:()=>L(!0),className:"w-full sm:w-auto text-xs sm:text-sm",children:[e.jsx(ps,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),a("profile.deleteAccount")]}),e.jsxs("div",{className:`flex gap-2 w-full sm:w-auto ${c?"sm:ml-auto":""}`,children:[e.jsx(g,{variant:"outline",size:"sm",onClick:()=>{U(!1),o(!1)},className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:a("common.cancel")}),e.jsx(g,{size:"sm",onClick:ya,disabled:Cs.isPending||Ss.isPending,className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:Cs.isPending||Ss.isPending?a("common.loading"):a("common.save")})]})]})]}),e.jsx(re,{open:Ie,onOpenChange:L,children:e.jsxs(ie,{children:[e.jsxs(ne,{children:[e.jsx(le,{children:a("profile.deleteAccountWarning")}),e.jsx(ce,{children:a("profile.deleteAccountDescription")})]}),e.jsxs(oe,{children:[e.jsx(de,{children:a("common.cancel")}),e.jsx(ee,{onClick:()=>{L(!1),je(!0)},className:"bg-destructive hover:bg-destructive/90",children:a("common.continue")})]})]})}),e.jsx(re,{open:qe,onOpenChange:je,children:e.jsxs(ie,{children:[e.jsxs(ne,{children:[e.jsx(le,{children:a("profile.confirmDeleteAccount")}),e.jsxs(ce,{className:"space-y-4",children:[e.jsx("p",{children:a("profile.confirmDeleteDescription")}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"confirm-delete",children:a("profile.typeDeleteToConfirm")}),e.jsx(_,{id:"confirm-delete",value:se,onChange:d=>y(d.target.value),placeholder:"DELETE",className:"uppercase"})]})]})]}),e.jsxs(oe,{children:[e.jsx(de,{onClick:()=>y(""),children:a("common.cancel")}),e.jsx(ee,{onClick:wa,disabled:se.toLowerCase()!=="delete"||Le,className:"bg-destructive hover:bg-destructive/90",children:a(Le?"common.loading":"profile.deleteAccount")})]})]})}),e.jsx(re,{open:Y,onOpenChange:ve,children:e.jsxs(ie,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(ne,{children:[e.jsx(le,{children:a("profile.verifyOldEmail")}),e.jsx(ce,{children:a("profile.oldEmailStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:a("profile.currentEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{value:t?.email||"",disabled:!0,className:"flex-1"}),e.jsx(g,{variant:"outline",size:"sm",onClick:ba,disabled:H,children:a(H?"profile.codeSent":"profile.sendCode")})]})]}),H&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:a("profile.verificationCode")}),e.jsx(_,{ref:ws,value:J,onChange:d=>Ne(d.target.value),placeholder:a("profile.enterCode"),maxLength:4})]})]}),e.jsxs(oe,{children:[e.jsx(de,{onClick:()=>{ve(!1),setTimeout(()=>{Ne(""),we(!1)},300)},children:a("common.cancel")}),H&&e.jsx(ee,{onClick:_a,children:a("profile.verify")})]})]})}),e.jsx(re,{open:ae,onOpenChange:Ee,children:e.jsxs(ie,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(ne,{className:"text-center space-y-3",children:[e.jsx(le,{className:"text-xl",children:a("profile.verifyNewEmail")}),e.jsx(ce,{className:"text-center",children:a("profile.newEmailStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{className:"text-sm font-normal",children:a("profile.newEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{type:"email",value:V,onChange:d=>Oe(d.target.value),placeholder:a("profile.enterNewEmail"),disabled:Z,className:"border-2 focus:border-primary flex-1"}),e.jsx(g,{variant:"outline",size:"sm",onClick:Ca,disabled:!V||Z,className:"text-xs whitespace-nowrap px-3",children:a(Z?"profile.codeSent":"profile.sendCode")})]})]}),Z&&e.jsxs("div",{className:"space-y-2 animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsx(k,{className:"text-sm font-normal",children:a("profile.verificationCode")}),e.jsx(_,{ref:bs,value:O,onChange:d=>ye(d.target.value),placeholder:a("profile.enterCode"),maxLength:4,className:"border-2 focus:border-primary"})]})]}),e.jsxs(oe,{className:"flex-col sm:flex-col gap-2",children:[Z&&e.jsx(ee,{onClick:Sa,disabled:!O||O.length!==4,className:"w-full bg-primary hover:bg-primary/90",children:"ç¡®è®¤éªŒè¯ç "}),e.jsx(de,{onClick:()=>{Ee(!1),setTimeout(()=>{Oe(""),ye(""),G(!1)},300)},className:"w-full mt-0",children:"å–æ¶ˆ"})]})]})}),e.jsx(re,{open:Xe,onOpenChange:Fe,children:e.jsxs(ie,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(ne,{children:[e.jsx(le,{children:"ç¡®è®¤ä¿®æ”¹é‚®ç®±"}),e.jsx(ce,{children:"æ­¥éª¤ 3/3: æ‰€æœ‰éªŒè¯å·²å®Œæˆ"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"rounded-lg bg-green-50 dark:bg-green-950 p-4 text-sm",children:[e.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:"éªŒè¯å®Œæˆï¼"}),e.jsx("p",{className:"text-green-700 dark:text-green-300 mt-1",children:'æ—§é‚®ç®±å’Œæ–°é‚®ç®±éƒ½å·²éªŒè¯æˆåŠŸï¼Œç‚¹å‡»"ç¡®è®¤ä¿®æ”¹"å®Œæˆé‚®ç®±æ›´æ–°ã€‚'})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"å½“å‰é‚®ç®±:"}),e.jsx("span",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"æ–°é‚®ç®±:"}),e.jsx("span",{className:"font-medium",children:V})]})]})]}),e.jsxs(oe,{children:[e.jsx(de,{onClick:()=>{Fe(!1),setTimeout(()=>{Ne(""),Oe(""),ye(""),we(!1),G(!1)},300)},children:"å–æ¶ˆ"}),e.jsx(ee,{onClick:ka,disabled:$e,children:$e?"æ›´æ–°ä¸­...":"ç¡®è®¤ä¿®æ”¹"})]})]})}),e.jsx(re,{open:Ye,onOpenChange:be,children:e.jsxs(ie,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(ne,{children:[e.jsx(le,{children:a("profile.verifyOldPassword")}),e.jsx(ce,{children:a("profile.oldPasswordStep")})]}),e.jsx("div",{className:"space-y-4 py-4",children:Ks?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:a("profile.currentEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{value:t?.email||"",disabled:!0,className:"flex-1"}),e.jsx(g,{variant:"outline",size:"sm",onClick:Pa,disabled:Ue,children:a(Ue?"profile.codeSent":"profile.sendCode")})]})]}),Ue&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:a("profile.verificationCode")}),e.jsx(_,{ref:_s,value:gs,onChange:d=>vs(d.target.value),placeholder:a("profile.enterCode"),maxLength:4})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:a("profile.currentPassword")}),e.jsx(_,{type:"password",value:Re,onChange:d=>l(d.target.value),placeholder:a("profile.enterCurrentPassword")})]}),e.jsxs(g,{variant:"link",size:"sm",onClick:()=>js(!0),className:"text-xs p-0 h-auto",children:[a("profile.forgotPassword")," ",a("profile.useEmailVerification")]})]})}),e.jsxs(oe,{children:[e.jsx(de,{onClick:()=>{be(!1),setTimeout(()=>{l(""),js(!1),vs(""),Ns(!1)},300)},children:a("common.cancel")}),Ks?Ue&&e.jsx(ee,{onClick:Ia,children:a("profile.verify")}):e.jsx(ee,{onClick:Da,children:a("profile.verify")})]})]})}),e.jsx(re,{open:S,onOpenChange:_e,children:e.jsxs(ie,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(ne,{children:[e.jsx(le,{children:a("profile.setNewPassword")}),e.jsx(ce,{children:a("profile.newPasswordStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:a("profile.newPassword")}),e.jsx(_,{type:"password",value:u,onChange:d=>{N(d.target.value),d.target.value?ys(Aa(d.target.value)):ys(null)},placeholder:a("profile.enterNewPassword")}),W&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${W==="weak"?"bg-destructive":W==="medium"?"bg-warning":"bg-success"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${W==="medium"||W==="strong"?W==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${W==="strong"?"bg-success":"bg-muted"}`})]}),e.jsx("p",{className:`text-xs ${W==="weak"?"text-destructive":W==="medium"?"text-warning":"text-success"}`,children:a(`auth.passwordStrength.${W}`)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:a("profile.confirmNewPassword")}),e.jsx(_,{type:"password",value:D,onChange:d=>te(d.target.value),placeholder:a("profile.confirmNewPasswordPlaceholder")})]}),u&&D&&u!==D&&e.jsx("p",{className:"text-sm text-destructive",children:a("profile.passwordsDontMatch")})]}),e.jsxs(oe,{children:[e.jsx(de,{onClick:()=>{_e(!1),setTimeout(()=>{N(""),te(""),ys(null)},300)},children:a("common.cancel")}),e.jsx(ee,{onClick:Ea,disabled:!u||!D||u!==D||Ms,children:a(Ms?"common.loading":"profile.updatePassword")})]})]})})]})},Rs=[{value:"Home",icon:qa,labelKey:"address.labelHome"},{value:"Work",icon:La,labelKey:"address.labelWork"},{value:"Office",icon:Ha,labelKey:"address.labelOffice"},{value:"Other",icon:Ce,labelKey:"address.labelOther"}],Qt=[{code:"+351",country:"Portugal",flag:"ðŸ‡µðŸ‡¹"},{code:"+34",country:"Spain",flag:"ðŸ‡ªðŸ‡¸"},{code:"+33",country:"France",flag:"ðŸ‡«ðŸ‡·"},{code:"+49",country:"Germany",flag:"ðŸ‡©ðŸ‡ª"},{code:"+39",country:"Italy",flag:"ðŸ‡®ðŸ‡¹"},{code:"+44",country:"UK",flag:"ðŸ‡¬ðŸ‡§"},{code:"+31",country:"Netherlands",flag:"ðŸ‡³ðŸ‡±"},{code:"+32",country:"Belgium",flag:"ðŸ‡§ðŸ‡ª"},{code:"+86",country:"China",flag:"ðŸ‡¨ðŸ‡³"},{code:"+1",country:"USA/Canada",flag:"ðŸ‡ºðŸ‡¸"},{code:"+55",country:"Brazil",flag:"ðŸ‡§ðŸ‡·"}],Vt=["Portugal","Spain","France","Germany","Italy","United Kingdom","Netherlands","Belgium","China","Other"],la=({initialData:s,onSubmit:a,onCancel:i,isLoading:t,isEdit:c})=>{const{t:r}=Q(),[o,n]=x.useState({label:s?.label||"Home",street:s?.street||"",district:s?.district||"",city:s?.city||"",postal_code:s?.postal_code||"",country:s?.country||"Portugal",phone:s?.phone||"",phone_code:s?.phone_code||"+351",is_default:s?.is_default||!1}),p=m=>{m.preventDefault(),a(o)};return e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"label",children:r("address.label")}),e.jsxs(ls,{value:o.label,onValueChange:m=>n({...o,label:m}),children:[e.jsx(cs,{children:e.jsx(os,{placeholder:r("address.selectLabel")})}),e.jsx(ds,{children:Rs.map(m=>e.jsx(ms,{value:m.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m.icon,{className:"w-4 h-4"}),r(m.labelKey)]})},m.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{htmlFor:"street",children:[r("address.street")," *"]}),e.jsx(_,{id:"street",value:o.street,onChange:m=>n({...o,street:m.target.value}),placeholder:r("address.streetPlaceholder"),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"district",children:r("address.district")}),e.jsx(_,{id:"district",value:o.district,onChange:m=>n({...o,district:m.target.value}),placeholder:r("address.districtPlaceholder")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{htmlFor:"city",children:[r("address.city")," *"]}),e.jsx(_,{id:"city",value:o.city,onChange:m=>n({...o,city:m.target.value}),placeholder:r("address.cityPlaceholder"),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{htmlFor:"postal_code",children:[r("address.postalCode")," *"]}),e.jsx(_,{id:"postal_code",value:o.postal_code,onChange:m=>n({...o,postal_code:m.target.value}),placeholder:r("address.postalCodePlaceholder"),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{htmlFor:"country",children:[r("address.country")," *"]}),e.jsxs(ls,{value:o.country,onValueChange:m=>n({...o,country:m}),children:[e.jsx(cs,{children:e.jsx(os,{placeholder:r("address.selectCountry")})}),e.jsx(ds,{children:Vt.map(m=>e.jsx(ms,{value:m,children:m},m))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{htmlFor:"phone",children:[r("address.phone")," *"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ls,{value:o.phone_code,onValueChange:m=>n({...o,phone_code:m}),children:[e.jsx(cs,{className:"w-[130px]",children:e.jsx(os,{placeholder:"+351"})}),e.jsx(ds,{children:Qt.map(m=>e.jsx(ms,{value:m.code,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:m.flag}),e.jsx("span",{children:m.code})]})},m.code))})]}),e.jsx(_,{id:"phone",className:"flex-1",value:o.phone,onChange:m=>n({...o,phone:m.target.value}),placeholder:r("address.phonePlaceholder"),required:!0})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ct,{id:"is_default",checked:o.is_default,onCheckedChange:m=>n({...o,is_default:m})}),e.jsx(k,{htmlFor:"is_default",className:"text-sm font-normal cursor-pointer",children:r("address.setAsDefault")})]}),e.jsxs(nt,{className:"gap-2 sm:gap-0",children:[e.jsx(g,{type:"button",variant:"outline",onClick:i,children:r("common.cancel")}),e.jsx(g,{type:"submit",disabled:t,children:r(t?"common.saving":c?"common.save":"address.add")})]})]})},Jt=({address:s,onEdit:a,onDelete:i,onSetDefault:t,isDeleting:c,isSettingDefault:r,canDelete:o=!0})=>{const{t:n}=Q(),p=Rs.find(h=>h.value===s.label)||Rs[3],m=p.icon;return e.jsx("div",{className:`p-4 border rounded-lg hover:shadow-medium transition-shadow relative ${s.is_default?"bg-primary/5 border-primary/20":""}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`p-2 rounded-full ${s.is_default?"bg-primary/20":"bg-primary/10"}`,children:e.jsx(m,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-foreground",children:n(p.labelKey)}),s.is_default&&e.jsxs(j,{variant:"secondary",className:"text-xs",children:[e.jsx(Ds,{className:"w-3 h-3 mr-1 fill-current"}),n("address.default")]})]}),e.jsxs("p",{className:"text-sm text-foreground",children:[s.street,s.district&&`, ${s.district}`]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:[s.postal_code,s.city,s.country].filter(Boolean).join(", ")}),s.phone&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(Ua,{className:"w-3 h-3"}),s.phone_code," ",s.phone]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[!s.is_default&&e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>t(s.id),disabled:r,title:n("address.setAsDefault"),children:e.jsx(Ds,{className:"w-4 h-4"})}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>a(s),title:n("common.edit"),children:e.jsx(za,{className:"w-4 h-4"})}),o&&e.jsxs(re,{children:[e.jsx(lt,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",title:n("common.delete"),children:e.jsx(ps,{className:"w-4 h-4"})})}),e.jsxs(ie,{children:[e.jsxs(ne,{children:[e.jsx(le,{children:n("address.deleteTitle")}),e.jsx(ce,{children:n("address.deleteDescription")})]}),e.jsxs(oe,{children:[e.jsx(de,{children:n("common.cancel")}),e.jsx(ee,{onClick:()=>i(s.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:c,children:n(c?"common.deleting":"common.delete")})]})]})]})]})]})})},ca=()=>{const{t:s}=Q(),{data:a,isLoading:i}=Nt(),{data:t}=ga(),c=yt(),r=wt(),o=fa(),n=bt(),p=_t(),[m,h]=x.useState(!1),[E,b]=x.useState(null),[K,R]=x.useState(null),[U,C]=x.useState(!1),q=!t?.phone,w=y=>{if(q&&y.phone){R(y),C(!0);return}c.mutate(y,{onSuccess:()=>h(!1)})},pe=()=>{if(!K)return;const y=`${K.phone_code||"+351"} ${K.phone}`;o.mutate({phone:y}),c.mutate(K,{onSuccess:()=>{h(!1),R(null),C(!1)}})},Ie=()=>{R(null),C(!1)},L=y=>{E&&r.mutate({id:E.id,address:y},{onSuccess:()=>b(null)})},qe=y=>{n.mutate(y)},je=y=>{p.mutate(y)};if(i)return e.jsxs(P,{children:[e.jsx(z,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5"}),s("address.myAddresses")]})}),e.jsx(I,{children:e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:s("common.loading")})})]});const se=a&&a.length>0;return e.jsxs(P,{children:[e.jsx(z,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1.5 min-w-0 flex-1",children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 flex-shrink-0"}),s("address.myAddresses")]}),e.jsx(M,{className:"text-xs text-primary",children:s("address.manageDescription")})]}),se&&e.jsxs(Se,{open:m,onOpenChange:h,children:[e.jsx(ja,{asChild:!0,children:e.jsxs(g,{size:"sm",className:"w-full sm:w-auto flex-shrink-0",children:[e.jsx(Vs,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"truncate",children:s("address.addNew")})]})}),e.jsxs(ke,{className:"sm:max-w-[500px]",children:[e.jsxs(Ae,{children:[e.jsx(De,{children:s("address.addNew")}),e.jsx(hs,{children:s("address.addDescription")})]}),e.jsx(la,{onSubmit:w,onCancel:()=>h(!1),isLoading:c.isPending})]})]})]})}),e.jsx(I,{children:se?e.jsx("div",{className:"space-y-4",children:a.map(y=>e.jsx(Jt,{address:y,onEdit:b,onDelete:qe,onSetDefault:je,isDeleting:n.isPending,isSettingDefault:p.isPending,canDelete:a.length>1},y.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ce,{className:"w-12 h-12 mx-auto text-muted-foreground/50 mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:s("address.noAddresses")}),e.jsxs(g,{onClick:()=>h(!0),children:[e.jsx(Vs,{className:"w-4 h-4 mr-2"}),s("address.addFirst")]})]})}),e.jsx(Se,{open:!!E,onOpenChange:()=>b(null),children:e.jsxs(ke,{className:"sm:max-w-[500px]",children:[e.jsxs(Ae,{children:[e.jsx(De,{children:s("address.editAddress")}),e.jsx(hs,{children:s("address.editDescription")})]}),E&&e.jsx(la,{initialData:E,onSubmit:L,onCancel:()=>b(null),isLoading:r.isPending,isEdit:!0})]})}),e.jsx(re,{open:U,onOpenChange:C,children:e.jsxs(ie,{children:[e.jsxs(ne,{children:[e.jsx(le,{children:s("address.phoneConfirmTitle")}),e.jsx(ce,{children:s("address.phoneConfirmDescription")})]}),e.jsxs(oe,{children:[e.jsx(de,{onClick:Ie,children:s("common.cancel")}),e.jsx(ee,{onClick:pe,disabled:c.isPending||o.isPending,children:c.isPending||o.isPending?s("common.saving"):s("common.confirm")})]})]})})]})},Gt=({open:s,onOpenChange:a,coupon:i})=>{const{t}=Q(),{getLocalizedField:c}=fs(),[r,o]=x.useState(!1),n=i.coupon_codes?.coupon_templates,p=i.coupon_codes?.code,m=!!i.used_at;return e.jsx(Se,{open:s,onOpenChange:h=>{a(h),h||o(!1)},children:e.jsxs(ke,{className:"max-w-lg max-h-[90vh]",children:[e.jsx(Ae,{children:e.jsxs(De,{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5 text-primary"}),t("profile.coupons.details")]})}),e.jsx(ct,{className:"max-h-[70vh] pr-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-foreground",children:c(n,"title")}),e.jsx(j,{variant:m?"secondary":"default",children:t(m?"profile.coupons.used":"profile.coupons.available")})]}),n?.description_zh||n?.description_en||n?.description_pt?e.jsx("p",{className:"text-muted-foreground text-sm",children:c(n,"description")}):null]}),e.jsx(Ts,{}),e.jsx("div",{className:"bg-secondary/30 p-4 rounded-lg cursor-pointer hover:bg-secondary/50 transition-colors",onClick:()=>o(!r),children:e.jsx("div",{className:"flex flex-col items-center gap-3",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white p-3 rounded-lg",children:e.jsx(Ba,{value:p||"",size:140,level:"M",includeMargin:!1})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("profile.coupons.tapToHideQr")})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-2xl font-mono font-bold tracking-wider",children:p}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Ka,{className:"w-4 h-4"}),e.jsx("p",{className:"text-xs",children:t("profile.coupons.tapToShowQr")})]})]})})}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-primary/10 rounded-lg",children:[e.jsx(Ze,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.discount")}),e.jsx("p",{className:"text-xl font-bold text-primary",children:n?.discount_type==="percentage"?`${n?.discount_value}% OFF`:`â‚¬${n?.discount_value}`})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(fe,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.claimedAt")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:ue(new Date(i.claimed_at),"yyyy-MM-dd HH:mm")})]})]}),m&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(me,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.usedOn")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:ue(new Date(i.used_at),"yyyy-MM-dd HH:mm")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(me,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.validity")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n?.valid_until?`${ue(new Date(n.valid_from),"yyyy-MM-dd")} - ${ue(new Date(n.valid_until),"yyyy-MM-dd")}`:t("profile.coupons.noExpiry")})]})]}),n?.min_order_amount&&n.min_order_amount>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ze,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.minOrder")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["â‚¬",n.min_order_amount]})]})]}),n?.max_discount_amount&&n.max_discount_amount>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ze,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.maxDiscount")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["â‚¬",n.max_discount_amount]})]})]}),e.jsx(Ts,{}),i.activity_id&&i.source==="share"&&e.jsxs(F,{to:`/activity/${i.activity_id}`,className:"flex items-center justify-center gap-2 p-3 rounded-lg border hover:shadow-md transition-all hover:border-primary",children:[e.jsx(Ze,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"text-sm font-medium text-foreground",children:[t("profile.coupons.source"),": ",t("profile.coupons.fromSharing")]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",t("profile.coupons.viewActivity"),")"]})]})]})})]})})},Xt=()=>{const{user:s}=Pe();return Ge({queryKey:["bookingRecords",s?.email],queryFn:async()=>{if(!s?.email)return[];const{data:a,error:i}=await A.from("booking_records").select(`
          *,
          restaurants (
            name,
            name_en,
            name_pt,
            image_url
          )
        `).order("booking_date",{ascending:!1});if(i)throw i;return a},enabled:!!s?.email})},Yt=()=>{const{user:s}=Pe();return Ge({queryKey:["deliveryRecords",s?.email],queryFn:async()=>{if(!s?.email)return[];const{data:a,error:i}=await A.from("delivery_records").select(`
          *,
          restaurants (
            name,
            name_en,
            name_pt,
            image_url
          )
        `).order("order_date",{ascending:!1});if(i)throw i;return a},enabled:!!s?.email})},oa=()=>{const{t:s}=Q(),{data:a,isLoading:i}=Xt(),{getLocalizedField:t}=fs(),c=r=>{switch(r){case"confirmed":return e.jsx(j,{className:"bg-green-500",children:s("booking.status.confirmed")});case"pending":return e.jsx(j,{variant:"secondary",children:s("booking.status.pending")});case"cancelled":return e.jsx(j,{variant:"destructive",children:s("booking.status.cancelled")});case"completed":return e.jsx(j,{className:"bg-blue-500",children:s("booking.status.completed")});default:return e.jsx(j,{variant:"outline",children:r})}};return e.jsxs(P,{children:[e.jsxs(z,{className:"pb-3",children:[e.jsxs(B,{className:"text-lg flex items-center gap-2",children:[e.jsx(Js,{className:"w-5 h-5"}),s("profile.bookingRecords.title")]}),e.jsx(M,{className:"text-xs",children:s("profile.bookingRecords.description")})]}),e.jsx(I,{className:"px-3",children:i?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):a&&a.length>0?e.jsx("div",{className:"space-y-3",children:a.map(r=>{const o=r.restaurants?t(r.restaurants,"name"):r.restaurant_name;return e.jsxs("div",{className:"p-3 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:r.restaurant_id?e.jsxs(F,{to:`/restaurant/${r.restaurant_id}`,className:"font-semibold text-sm hover:text-primary transition-colors",children:[e.jsx(xe,{className:"w-4 h-4 inline mr-1"}),o]}):e.jsxs("span",{className:"font-semibold text-sm",children:[e.jsx(xe,{className:"w-4 h-4 inline mr-1"}),o]})}),c(r.status)]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Js,{className:"w-3 h-3"}),ue(new Date(r.booking_date),"yyyy-MM-dd")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"w-3 h-3"}),r.booking_time.slice(0,5)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Bs,{className:"w-3 h-3"}),r.party_size," ",s("booking.people")]})]}),r.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2 line-clamp-2",children:r.notes})]},r.id)})}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.bookingRecords.noRecords")})})]})},da=()=>{const{t:s}=Q(),{data:a,isLoading:i}=Yt(),{getLocalizedField:t}=fs(),c=r=>{switch(r){case"completed":return e.jsx(j,{className:"bg-green-500",children:s("delivery.status.completed")});case"pending":return e.jsx(j,{variant:"secondary",children:s("delivery.status.pending")});case"cancelled":return e.jsx(j,{variant:"destructive",children:s("delivery.status.cancelled")});case"delivering":return e.jsx(j,{className:"bg-blue-500",children:s("delivery.status.delivering")});default:return e.jsx(j,{variant:"outline",children:r})}};return e.jsxs(P,{children:[e.jsxs(z,{className:"pb-3",children:[e.jsxs(B,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ma,{className:"w-5 h-5"}),s("profile.deliveryRecords.title")]}),e.jsx(M,{className:"text-xs",children:s("profile.deliveryRecords.description")})]}),e.jsx(I,{className:"px-3",children:i?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):a&&a.length>0?e.jsx("div",{className:"space-y-3",children:a.map(r=>{const o=r.restaurants?t(r.restaurants,"name"):r.restaurant_name;return e.jsxs("div",{className:"p-3 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:r.restaurant_id?e.jsxs(F,{to:`/restaurant/${r.restaurant_id}`,className:"font-semibold text-sm hover:text-primary transition-colors",children:[e.jsx(xe,{className:"w-4 h-4 inline mr-1"}),o]}):e.jsxs("span",{className:"font-semibold text-sm",children:[e.jsx(xe,{className:"w-4 h-4 inline mr-1"}),o]})}),c(r.status)]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground mb-2",children:[e.jsx("span",{children:ue(new Date(r.order_date),"yyyy-MM-dd HH:mm")}),r.total_amount&&e.jsxs("span",{className:"font-medium text-foreground",children:["â‚¬",r.total_amount.toFixed(2)]})]}),r.delivery_address&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-start gap-1",children:[e.jsx(Ce,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:r.delivery_address})]}),r.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2 line-clamp-2",children:r.notes})]},r.id)})}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.deliveryRecords.noRecords")})})]})},Zt=St({full_name:ss().min(2,"å§“åè‡³å°‘2ä¸ªå­—ç¬¦"),nif:ss().min(9,"NIFè‡³å°‘9ä½").max(15,"NIFæœ€å¤š15ä½"),contact:ss().min(5,"è”ç³»æ–¹å¼è‡³å°‘5ä¸ªå­—ç¬¦"),address:ss().min(5,"åœ°å€è‡³å°‘5ä¸ªå­—ç¬¦")}),As=({open:s,onOpenChange:a,mode:i,existingData:t})=>{const{t:c}=Q(),r=Ot(),o=$t(),n=Qa({resolver:Va(Zt),defaultValues:{full_name:t?.full_name||"",nif:t?.nif||"",contact:t?.contact||"",address:t?.address||""}});x.useEffect(()=>{s&&t?n.reset({full_name:t.full_name||"",nif:t.nif||"",contact:t.contact||"",address:t.address||""}):s&&!t&&n.reset({full_name:"",nif:"",contact:"",address:""})},[s,t,n]);const p=async h=>{try{const E={full_name:h.full_name,nif:h.nif,contact:h.contact,address:h.address};i==="reapply"&&t?.id?await o.mutateAsync({id:t.id,data:E}):await r.mutateAsync(E),a(!1),n.reset()}catch{}},m=r.isPending||o.isPending;return e.jsx(Se,{open:s,onOpenChange:a,children:e.jsxs(ke,{className:"sm:max-w-md",children:[e.jsxs(Ae,{children:[e.jsxs(De,{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5 text-primary"}),i==="apply"?c("profile.invitationCode.applyTitle","ç”³è¯·é‚€è¯·ç "):c("profile.invitationCode.reapplyTitle","é‡æ–°ç”³è¯·é‚€è¯·ç ")]}),e.jsx(hs,{children:c("profile.invitationCode.applyDesc","è¯·å¡«å†™ä»¥ä¸‹ä¿¡æ¯ä»¥ç”³è¯·ä¸“å±žé‚€è¯·ç ")})]}),e.jsx(Ut,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(p),className:"space-y-4",children:[e.jsx(as,{control:n.control,name:"full_name",render:({field:h})=>e.jsxs(ts,{children:[e.jsx(rs,{children:c("profile.invitationCode.fullName","å…¨å")}),e.jsx(is,{children:e.jsx(_,{placeholder:c("profile.invitationCode.fullNamePlaceholder","è¯·è¾“å…¥æ‚¨çš„å…¨å"),...h})}),e.jsx(ns,{})]})}),e.jsx(as,{control:n.control,name:"nif",render:({field:h})=>e.jsxs(ts,{children:[e.jsx(rs,{children:c("profile.invitationCode.nif","NIF (ç¨ŽåŠ¡è¯†åˆ«å·)")}),e.jsx(is,{children:e.jsx(_,{placeholder:c("profile.invitationCode.nifPlaceholder","è¯·è¾“å…¥æ‚¨çš„NIF"),...h})}),e.jsx(ns,{})]})}),e.jsx(as,{control:n.control,name:"contact",render:({field:h})=>e.jsxs(ts,{children:[e.jsx(rs,{children:c("profile.invitationCode.contact","è”ç³»æ–¹å¼")}),e.jsx(is,{children:e.jsx(_,{placeholder:c("profile.invitationCode.contactPlaceholder","è¯·è¾“å…¥æ‚¨çš„è”ç³»æ–¹å¼ï¼ˆç”µè¯/å¾®ä¿¡ç­‰ï¼‰"),...h})}),e.jsx(ns,{})]})}),e.jsx(as,{control:n.control,name:"address",render:({field:h})=>e.jsxs(ts,{children:[e.jsx(rs,{children:c("profile.invitationCode.address","åœ°å€")}),e.jsx(is,{children:e.jsx(ot,{placeholder:c("profile.invitationCode.addressPlaceholder","è¯·è¾“å…¥æ‚¨çš„åœ°å€"),className:"resize-none",rows:3,...h})}),e.jsx(ns,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>a(!1),children:c("common.cancel","å–æ¶ˆ")}),e.jsxs(g,{type:"submit",disabled:m,children:[m&&e.jsx(Ps,{className:"w-4 h-4 mr-2 animate-spin"}),i==="apply"?c("profile.invitationCode.submit","æäº¤ç”³è¯·"):c("profile.invitationCode.resubmit","é‡æ–°æäº¤")]})]})]})})]})})},Qe=({open:s,onOpenChange:a})=>{const{t:i}=Q();return e.jsx(Se,{open:s,onOpenChange:a,children:e.jsxs(ke,{className:"sm:max-w-md",children:[e.jsx(Ae,{children:e.jsx(De,{className:"flex items-center gap-2",children:i("profile.invitationCode.helpTitle","é‚€è¯·ç ä½¿ç”¨è¯´æ˜Ž")})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-medium",children:[e.jsx(Ja,{className:"h-4 w-4"}),e.jsx("span",{children:i("profile.invitationCode.helpRequirements","ç”³è¯·è¦æ±‚")})]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:i("profile.invitationCode.helpRequirementsDesc","ç”³è¯·é‚€è¯·ç éœ€æä¾›ï¼šå…¨åã€NIFï¼ˆç¨ŽåŠ¡è¯†åˆ«å·ï¼‰ã€è”ç³»æ–¹å¼ã€åœ°å€")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-medium",children:[e.jsx(Is,{className:"h-4 w-4"}),e.jsx("span",{children:i("profile.invitationCode.helpUsage","ä½¿ç”¨æ¡ä»¶")})]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:i("profile.invitationCode.helpUsageDesc",'é‚€è¯·ç åªèƒ½åœ¨"åŠ å…¥æˆ‘ä»¬"ç”³è¯·ä¸­ä½¿ç”¨ï¼Œä¸”ä»…åœ¨å‹¾é€‰"æ‰«ç ç‚¹é¤"åŠŸèƒ½åŽæ‰èƒ½å¡«å†™')})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-medium",children:[e.jsx(Ga,{className:"h-4 w-4"}),e.jsx("span",{children:i("profile.invitationCode.helpBenefit","ç¦åˆ©è¯´æ˜Ž")})]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:i("profile.invitationCode.helpBenefitDesc","æˆåŠŸé‚€è¯·å•†å®¶åŽï¼Œè¢«é‚€è¯·äººå¯èŽ·å¾—ä»·å€¼99æ¬§å…ƒçš„é¢å¤–å…è´¹æœˆã€‚é‚€è¯·åŒæ–¹å¯è‡ªç”±åå•†ç¦åˆ©åˆ†é…æ–¹å¼ã€‚")})]}),e.jsx(Ts,{}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:i("profile.invitationCode.copyright","Â© 2026 å°ç†Šå¸‚åœº. ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚æœ€ç»ˆè§£é‡Šæƒå½’å°ç†Šå¸‚åœºæ‰€æœ‰ã€‚")})]})]})})},ma=s=>{switch(s){case"zh":return Dt;case"pt":return At;default:return kt}},xa=({isMobile:s})=>{const{t:a,i18n:i}=Q(),{data:t,isLoading:c}=Tt(),{data:r=[]}=Rt(),[o,n]=x.useState(!1),[p,m]=x.useState(!1),[h,E]=x.useState(!1),[b,K]=x.useState(!1),R=async()=>{t?.code&&(await navigator.clipboard.writeText(t.code),E(!0),dt({title:a("profile.invitationCode.copied","å·²å¤åˆ¶"),description:a("profile.invitationCode.copiedDesc","é‚€è¯·ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}),setTimeout(()=>E(!1),2e3))},U=r.filter(w=>!(t?.status==="approved"&&w.id===t.id||w.id===t?.id)),C=(w,pe)=>{switch(w){case"pending":return e.jsxs(j,{variant:"outline",className:"text-yellow-600 border-yellow-500",children:[e.jsx(fe,{className:"w-3 h-3 mr-1"}),a("profile.invitationCode.pending","å®¡æ ¸ä¸­")]});case"approved":return e.jsxs(j,{variant:"outline",className:"text-primary border-primary",children:[e.jsx(Is,{className:"w-3 h-3 mr-1"}),a("profile.invitationCode.approved","å·²é€šè¿‡")]});case"rejected":return e.jsxs(j,{variant:"destructive",children:[e.jsx(ze,{className:"w-3 h-3 mr-1"}),a("profile.invitationCode.rejected","å·²æ‹’ç»")]});case"revoked":return e.jsxs(j,{variant:"outline",className:"text-orange-600 border-orange-500 bg-orange-100 dark:bg-orange-900/50",children:[e.jsx(ze,{className:"w-3 h-3 mr-1"}),a("profile.invitationCode.revoked","å·²æ”¶å›ž")]});default:return null}},q=()=>U.length===0?null:e.jsxs(It,{open:b,onOpenChange:K,className:"mt-4",children:[e.jsx(Et,{asChild:!0,children:e.jsxs(g,{variant:"ghost",size:"sm",className:"w-full justify-between text-muted-foreground hover:text-foreground",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Za,{className:"w-4 h-4"}),a("profile.invitationCode.history","åŽ†å²è®°å½•")," (",U.length,")"]}),e.jsx(Wa,{className:`w-4 h-4 transition-transform ${b?"rotate-180":""}`})]})}),e.jsx(Ft,{className:"mt-2 space-y-2",children:U.map(w=>e.jsxs("div",{className:"p-3 rounded-lg border bg-muted/30 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-mono font-medium",children:w.code}),C(w.status)]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:[a("profile.invitationCode.appliedAt","ç”³è¯·æ—¶é—´"),": ",us(new Date(w.created_at),{addSuffix:!0,locale:ma(i.language)})]}),w.reviewed_at&&e.jsxs("p",{children:[a("profile.invitationCode.reviewedAt","å®¡æ ¸æ—¶é—´"),": ",us(new Date(w.reviewed_at),{addSuffix:!0,locale:ma(i.language)})]}),w.rejection_reason&&e.jsxs("p",{className:"text-destructive",children:[a("profile.invitationCode.reason","åŽŸå› "),": ",w.rejection_reason]}),w.status==="approved"&&e.jsxs("p",{children:[a("profile.invitationCode.usageCount","å·²é‚€è¯·"),": ",w.usage_count," ",a("profile.invitationCode.people","äºº")]})]})]},w.id))})]});return c?e.jsxs(P,{children:[e.jsxs(z,{className:s?"p-4":"",children:[e.jsx(xs,{className:"h-6 w-32"}),e.jsx(xs,{className:"h-4 w-48 mt-2"})]}),e.jsx(I,{className:s?"px-4 pb-4":"",children:e.jsx(xs,{className:"h-20 w-full"})})]}):t?t.status==="pending"?e.jsxs(P,{className:"border-yellow-500/30",children:[e.jsxs(z,{className:s?"p-4":"",children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-yellow-500"}),a("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(g,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>m(!0),children:e.jsx(He,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(M,{children:a("profile.invitationCode.pendingDesc","æ‚¨çš„ç”³è¯·æ­£åœ¨å®¡æ ¸ä¸­")})]}),e.jsxs(I,{className:s?"px-4 pb-4":"",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-950/30 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs(j,{variant:"outline",className:"text-yellow-600 border-yellow-500",children:[e.jsx(fe,{className:"w-3 h-3 mr-1"}),a("profile.invitationCode.pending","å®¡æ ¸ä¸­")]})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a("profile.invitationCode.pendingMessage","ç®¡ç†å‘˜æ­£åœ¨å®¡æ ¸æ‚¨çš„ç”³è¯·ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚å®¡æ ¸é€šè¿‡åŽæ‚¨å°†æ”¶åˆ°é€šçŸ¥ã€‚")})]}),q()]}),e.jsx(Qe,{open:p,onOpenChange:m})]}):t.status==="rejected"?e.jsxs(e.Fragment,{children:[e.jsxs(P,{className:"border-destructive/30",children:[e.jsxs(z,{className:s?"p-4":"",children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-5 h-5 text-destructive"}),a("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(g,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>m(!0),children:e.jsx(He,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(M,{children:a("profile.invitationCode.rejectedDesc","æ‚¨çš„ç”³è¯·æœªé€šè¿‡å®¡æ ¸")})]}),e.jsxs(I,{className:s?"px-4 pb-4":"",children:[e.jsxs("div",{className:"bg-destructive/10 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs(j,{variant:"destructive",children:[e.jsx(ze,{className:"w-3 h-3 mr-1"}),a("profile.invitationCode.rejected","å·²æ‹’ç»")]})}),t.rejection_reason&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsxs("span",{className:"font-medium",children:[a("profile.invitationCode.reason","åŽŸå› "),":"]})," ",t.rejection_reason]})]}),e.jsxs(g,{onClick:()=>n(!0),variant:"outline",className:"w-full",children:[e.jsx(Gs,{className:"w-4 h-4 mr-2"}),a("profile.invitationCode.reapply","é‡æ–°ç”³è¯·")]}),q()]})]}),e.jsx(As,{open:o,onOpenChange:n,mode:"reapply",existingData:{id:t.id,full_name:t.full_name,nif:t.nif,contact:t.contact||"",address:t.address}}),e.jsx(Qe,{open:p,onOpenChange:m})]}):t.status==="revoked"?e.jsxs(e.Fragment,{children:[e.jsxs(P,{className:"border-orange-500/30",children:[e.jsxs(z,{className:s?"p-4":"",children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-5 h-5 text-orange-500"}),a("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(g,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>m(!0),children:e.jsx(He,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(M,{children:a("profile.invitationCode.revokedDesc","æ‚¨çš„é‚€è¯·ç å·²è¢«æ”¶å›ž")})]}),e.jsxs(I,{className:s?"px-4 pb-4":"",children:[e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-950/30 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs(j,{variant:"outline",className:"text-orange-600 border-orange-500 bg-orange-100 dark:bg-orange-900/50",children:[e.jsx(ze,{className:"w-3 h-3 mr-1"}),a("profile.invitationCode.revoked","å·²æ”¶å›ž")]})}),t.rejection_reason&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsxs("span",{className:"font-medium",children:[a("profile.invitationCode.reason","åŽŸå› "),":"]})," ",t.rejection_reason]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:a("profile.invitationCode.revokedMessage","æ‚¨çš„é‚€è¯·ç å·²è¢«ç®¡ç†å‘˜æ”¶å›žï¼Œå¦‚éœ€ç»§ç»­ä½¿ç”¨è¯·é‡æ–°ç”³è¯·ã€‚")})]}),e.jsxs(g,{onClick:()=>n(!0),variant:"outline",className:"w-full",children:[e.jsx(Gs,{className:"w-4 h-4 mr-2"}),a("profile.invitationCode.reapply","é‡æ–°ç”³è¯·")]}),q()]})]}),e.jsx(As,{open:o,onOpenChange:n,mode:"reapply",existingData:{id:t.id,full_name:t.full_name,nif:t.nif,contact:t.contact||"",address:t.address}}),e.jsx(Qe,{open:p,onOpenChange:m})]}):e.jsxs(e.Fragment,{children:[e.jsxs(P,{className:"border-primary/30",children:[e.jsxs(z,{className:s?"p-4":"",children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Is,{className:"w-5 h-5 text-primary"}),a("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(g,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>m(!0),children:e.jsx(He,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(M,{children:a("profile.invitationCode.approvedDesc","åˆ†äº«æ‚¨çš„é‚€è¯·ç ç»™æ–°å•†å®¶")})]}),e.jsxs(I,{className:s?"px-4 pb-4":"",children:[e.jsx("div",{className:"bg-primary/10 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:a("profile.invitationCode.yourCode","æ‚¨çš„é‚€è¯·ç ")}),e.jsx("p",{className:"text-2xl font-mono font-bold text-primary tracking-wider",children:t.code})]}),e.jsx(g,{variant:"outline",size:"icon",onClick:R,className:"flex-shrink-0",children:h?e.jsx(Xa,{className:"w-4 h-4 text-primary"}):e.jsx(Ya,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Bs,{className:"w-4 h-4"}),e.jsxs("span",{children:[a("profile.invitationCode.usageCount","å·²é‚€è¯·"),": ",t.usage_count," ",a("profile.invitationCode.people","äºº")]})]}),q()]})]}),e.jsx(Qe,{open:p,onOpenChange:m})]}):e.jsxs(e.Fragment,{children:[e.jsxs(P,{children:[e.jsxs(z,{className:s?"p-4":"",children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"w-5 h-5 text-primary"}),a("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(g,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>m(!0),children:e.jsx(He,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(M,{children:a("profile.invitationCode.noCodeDesc","ç”³è¯·ä¸“å±žé‚€è¯·ç ï¼Œé‚€è¯·æ–°å•†å®¶åŠ å…¥å¹³å°")})]}),e.jsxs(I,{className:s?"px-4 pb-4":"",children:[e.jsxs(g,{onClick:()=>n(!0),className:"w-full",children:[e.jsx(Es,{className:"w-4 h-4 mr-2"}),a("profile.invitationCode.apply","ç”³è¯·é‚€è¯·ç ")]}),q()]})]}),e.jsx(As,{open:o,onOpenChange:n,mode:"apply"}),e.jsx(Qe,{open:p,onOpenChange:m})]})},Wt="https://tzdgqhwyzsxkxnncgzap.supabase.co/functions/v1/ai-recipe/generate-images",pa=({recipe:s,className:a=""})=>{const i=s.recipe_data,[t,c]=x.useState(i.image_url??null),[r,o]=x.useState(!i.image_url),n=x.useRef(!1);return x.useEffect(()=>{if(i.image_url){c(i.image_url),o(!1);return}n.current||(n.current=!0,o(!0),fetch(Wt,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw"},body:JSON.stringify({recipes:[{recipe_name:i.recipe_name,recipe_name_en:i.recipe_name_en}]})}).then(p=>p.json()).then(p=>{c(p.images?.[0]?.image_url??null)}).catch(()=>c(null)).finally(()=>o(!1)))},[i.image_url,i.recipe_name,i.recipe_name_en]),e.jsx("div",{className:`relative bg-muted overflow-hidden ${a}`,children:r?e.jsxs(e.Fragment,{children:[e.jsx(xs,{className:"absolute inset-0 w-full h-full rounded-none"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-1 z-10",children:[e.jsx(et,{className:"h-3 w-3 text-primary animate-pulse"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"AI ç”Ÿæˆä¸­..."})]})]}):t?e.jsx("img",{src:t,alt:i.recipe_name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(st,{className:"h-6 w-6 text-muted-foreground/30"})})})},Us=x.memo(({comment:s,getLocalizedField:a,t:i})=>{const t=s.moderation_status==="flagged",c=s.moderation_status==="pending",r=()=>{if(!s.risk_reasons||!Array.isArray(s.risk_reasons))return null;const o={spam:i("riskReason.spam"),offensive:i("riskReason.offensive"),harassment:i("riskReason.harassment"),fake_review:i("riskReason.fakeReview"),flooding:i("riskReason.flooding"),irrelevant:i("riskReason.irrelevant"),sensitive_word_detected:i("riskReason.sensitiveWord"),parse_error:i("riskReason.parseError")};return s.risk_reasons.map(n=>o[n]||n).join(", ")};return e.jsxs("div",{className:"block p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs(F,{to:`/${s.target_type}/${s.target_id}`,className:"block",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2 gap-2",children:[e.jsx("h3",{className:"font-semibold text-card-foreground text-sm md:text-base line-clamp-1 flex-1",children:a(s,"target_name")}),e.jsx("span",{className:"text-xs md:text-sm text-muted-foreground whitespace-nowrap",children:us(new Date(s.created_at),{addSuffix:!0})})]}),e.jsx("p",{className:"text-muted-foreground line-clamp-2 text-sm md:text-base",children:s.content}),s.image_url&&e.jsx("img",{src:s.image_url,alt:"Comment",className:"mt-2 rounded-lg max-w-full md:max-w-xs",loading:"lazy"})]}),c&&e.jsx("div",{className:"mt-2 flex items-center gap-2",children:e.jsxs(j,{variant:"outline",className:"text-yellow-600 border-yellow-500 bg-yellow-50 dark:bg-yellow-950/30 text-xs",children:[e.jsx(fe,{className:"w-3 h-3 mr-1"}),i("restaurant.commentPending")]})}),t&&e.jsxs("div",{className:"mt-2 space-y-1.5",children:[e.jsxs(j,{variant:"outline",className:"text-destructive border-destructive bg-destructive/10 text-xs",children:[e.jsx(at,{className:"w-3 h-3 mr-1"}),i("restaurant.commentFailed")]}),r()&&e.jsxs("p",{className:"text-xs text-destructive/80 pl-0.5",children:[i("restaurant.failReason"),": ",r()]})]})]})});Us.displayName="CommentItem";const zs=x.memo(({restaurant:s,getLocalizedField:a,t:i,distance:t})=>{if(!s||!s.id)return null;const c=a(s,"name")||s.name||"",r=a(s,"type"),o=Array.isArray(r)?r.join(" Â· "):r||"";return e.jsxs(F,{to:`/restaurant/${s.id}`,state:{from:"profile"},className:"flex gap-3 md:gap-4 p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-lg overflow-hidden bg-secondary/30 flex-shrink-0",children:e.jsx("img",{src:s.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80",alt:String(c),className:"w-full h-full object-cover",loading:"lazy",onError:n=>{n.currentTarget.src="https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-base md:text-lg text-card-foreground line-clamp-1",children:c}),e.jsx("p",{className:"text-muted-foreground text-sm mb-2 line-clamp-1",children:o}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ds,{className:`w-4 h-4 ${s.rating?"fill-accent text-accent":"text-muted-foreground"}`}),s.rating?e.jsx("span",{className:"font-medium",children:s.rating.toFixed(1)}):e.jsxs("span",{className:"text-xs text-muted-foreground text-center whitespace-nowrap",children:[i("restaurant.noRatingLine1"),e.jsx("br",{}),i("restaurant.noRatingLine2")]})]}),t!==void 0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-primary",children:[e.jsx(Ce,{className:"w-3 h-3"}),e.jsx("span",{children:t<1?`${Math.round(t*1e3)} m`:`${t.toFixed(1)} km`})]})]})]})]})});zs.displayName="FavoriteRestaurantItem";const qs=x.memo(({subscription:s,getLocalizedField:a,t:i,isMobile:t})=>{const[c,r]=x.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:()=>r(!0),className:`block rounded-lg border hover:shadow-medium transition-shadow cursor-pointer ${t?"p-3":"p-4"}`,children:e.jsxs("div",{className:`flex items-start ${t?"gap-3":"gap-4"}`,children:[s.activity?.image_url&&e.jsx("img",{src:s.activity.image_url,alt:String(a(s.activity,"title")),className:`rounded-lg object-cover flex-shrink-0 ${t?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${t?"text-sm":""}`,children:a(s.activity,"title")}),e.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none ${t?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:a(s.activity,"content")}}),e.jsxs("p",{className:"text-muted-foreground mt-2 text-xs",children:[i("profile.joinedOn"),":"," ",us(new Date(s.created_at),{addSuffix:!0})]})]}),e.jsx(Ve,{className:`text-primary fill-primary flex-shrink-0 ${t?"w-4 h-4":"w-5 h-5"}`})]})}),e.jsx(Ht,{open:c,onOpenChange:r,activity:{title:String(a(s.activity,"title")),image_url:s.activity?.image_url,content:String(a(s.activity,"content"))}})]})});qs.displayName="ActivitySubscriptionItem";const Ls=x.memo(({activityGroup:s,getLocalizedField:a,t:i,isMobile:t})=>{const c=s.activity,r=s.restaurants;return e.jsxs("div",{className:`rounded-lg border hover:shadow-medium transition-shadow ${t?"p-3":"p-4"}`,children:[e.jsx(F,{to:`/activity/${c.id}`,className:t?"block mb-2":"block mb-3",children:e.jsxs("div",{className:`flex items-start ${t?"gap-3":"gap-4"}`,children:[c.image_url&&e.jsx("img",{src:c.image_url,alt:String(a(c,"title")),className:`rounded-lg object-cover flex-shrink-0 ${t?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${t?"text-sm":""}`,children:a(c,"title")}),e.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none mb-2 ${t?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:a(c,"content")}}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4 text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"w-3 h-3"}),new Date(c.start_date).toLocaleDateString()]}),c.end_date&&e.jsxs("span",{children:["- ",new Date(c.end_date).toLocaleDateString()]})]})]})]})}),e.jsxs("div",{className:`pt-2 md:pt-3 border-t ${t?"mt-2":"mt-3"}`,children:[e.jsxs("div",{className:`flex items-center gap-2 ${t?"mb-1.5":"mb-2"}`,children:[e.jsx(xe,{className:`text-primary ${t?"w-3.5 h-3.5":"w-4 h-4"}`}),e.jsxs("span",{className:`font-medium text-foreground ${t?"text-xs":"text-sm"}`,children:[i("profile.participatingRestaurants")," (",r.length,")"]})]}),e.jsx("div",{className:`flex flex-wrap ${t?"gap-1.5":"gap-2"}`,children:r.map(o=>e.jsx(j,{variant:"secondary",className:t?"text-xs px-2 py-0.5":"text-xs",children:a(o,"name")},o.id))})]})]})});Ls.displayName="MerchantActivityItem";const Hs=x.memo(({coupon:s,getLocalizedField:a,t:i,isMobile:t})=>{const[c,r]=x.useState(!1),o=s.coupon_codes?.coupon_templates,n=s.coupon_codes?.code,p=!!s.used_at;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`rounded-lg border transition-shadow cursor-pointer ${p?"bg-muted/30":"hover:shadow-medium"} ${t?"p-3":"p-4"}`,onClick:()=>r(!0),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${t?"text-sm":"text-base"}`,children:a(o,"title")}),e.jsx("p",{className:`text-muted-foreground line-clamp-2 ${t?"text-xs":"text-sm"}`,children:a(o,"description")})]}),e.jsx(j,{variant:p?"secondary":"default",className:t?"text-xs":"",children:i(p?"profile.coupons.used":"profile.coupons.available")})]}),e.jsxs("div",{className:`flex items-center gap-2 mb-2 ${t?"text-xs":"text-sm"}`,children:[e.jsx("span",{className:"font-mono bg-secondary/50 px-2 py-1 rounded",children:n}),e.jsx("span",{className:"text-muted-foreground",children:o?.discount_type==="percentage"?`${o?.discount_value}%`:`â‚¬${o?.discount_value}`})]}),e.jsx("div",{className:`text-muted-foreground ${t?"text-xs":"text-sm"}`,children:p?e.jsxs("span",{children:[i("profile.coupons.usedOn"),": ",ue(new Date(s.used_at),"yyyy-MM-dd HH:mm")]}):o?.valid_until?e.jsxs("span",{children:[i("profile.coupons.validUntil"),": ",ue(new Date(o.valid_until),"yyyy-MM-dd")]}):e.jsx("span",{children:i("profile.coupons.noExpiry")})})]}),e.jsx(Gt,{open:c,onOpenChange:r,coupon:s})]})});Hs.displayName="UserCouponItem";const Er=()=>{const{t:s,i18n:a}=Q(),{user:i}=Pe(),t=mt();xt();const{data:c,isLoading:r}=ga(),{data:o,isLoading:n}=Bt(),{data:p,isLoading:m}=Kt(),{data:h,isLoading:E}=ft(),{data:b,isLoading:K}=Mt(),{data:R,isLoading:U}=gt(),{data:C,isLoading:q}=vt({authorId:i?.id}),{savedRecipes:w,isLoading:pe,deleteRecipe:Ie}=zt(),{role:L,isMerchant:qe,isSupervisor:je,isAdmin:se}=ua(),{getLocalizedField:y}=fs(),{settings:Le}=pt(),ge=ha(),X=qe||je,[Y,ve]=x.useState("profile"),[ae,Ee]=x.useState(),[Xe,Fe]=x.useState({}),[V,Oe]=x.useState(new Set(["profile"])),[J,Ne]=x.useState(!1),[O,ye]=x.useState(null),[H,we]=x.useState({}),Z=x.useCallback(async()=>{if(O){ye(null),we({});return}Ne(!0);try{const l=await qt(),{latitude:u,longitude:N}=l.coords;if(ye({lat:u,lng:N}),o){const D={};o.forEach(te=>{te.lat&&te.lng&&(D[te.id]=Lt(u,N,te.lat,te.lng))}),we(D)}}catch{}finally{Ne(!1)}},[O,o]),G=x.useMemo(()=>o?!O||Object.keys(H).length===0?o:[...o].sort((l,u)=>{const N=H[l.id]??1/0,D=H[u.id]??1/0;return N-D}):[],[o,O,H]),$e=X?[{value:"profile",label:s("profile.profile"),icon:Xs},{value:"favorites",label:s("profile.favorites"),icon:Ve},{value:"comments",label:s("profile.comments"),icon:Be},{value:"activities",label:s("profile.participatedActivities"),icon:me}]:[{value:"profile",label:s("profile.profile"),icon:Xs},{value:"favorites",label:s("profile.favorites"),icon:Ve},{value:"comments",label:s("profile.comments"),icon:Be}],Te=l=>{Fe(u=>({...u,[l]:window.scrollY}))},Ye=l=>{if(V.has(l)){const u=Xe[l]||0;requestAnimationFrame(()=>{requestAnimationFrame(()=>{window.scrollTo({top:u,behavior:"instant"})})})}else requestAnimationFrame(()=>{requestAnimationFrame(()=>{window.scrollTo({top:0,behavior:"instant"})})}),Oe(u=>new Set([...u,l]))};x.useEffect(()=>{if(!ae)return;const l=()=>{const u=ae.selectedScrollSnap(),N=$e[u].value;N!==Y&&(Te(Y),Ye(N),ve(N))};return ae.on("select",l),()=>{ae.off("select",l)}},[ae,Y,Xe,V]);const be=l=>{if(l===Y)return;Te(Y);const u=$e.findIndex(N=>N.value===l);u!==-1&&ae&&ae.scrollTo(u),Ye(l),ve(l)},S=tt(),_e=x.useCallback(async()=>{S.removeQueries({queryKey:["profile"]}),S.removeQueries({queryKey:["favorites"]}),S.removeQueries({queryKey:["favorites-restaurants"]}),S.removeQueries({queryKey:["user-comments"]}),S.removeQueries({queryKey:["subscriptions"]}),S.removeQueries({queryKey:["user-coupons"]}),S.removeQueries({queryKey:["merchant-activities"]}),S.removeQueries({queryKey:["user-points"]}),S.removeQueries({queryKey:["community-posts"]}),S.removeQueries({queryKey:["saved-recipes"]}),await Promise.all([S.invalidateQueries({queryKey:["profile"]}),S.invalidateQueries({queryKey:["favorites"]}),S.invalidateQueries({queryKey:["favorites-restaurants"]}),S.invalidateQueries({queryKey:["user-comments"]}),S.invalidateQueries({queryKey:["subscriptions"]}),S.invalidateQueries({queryKey:["user-coupons"]}),S.invalidateQueries({queryKey:["merchant-activities"]}),S.invalidateQueries({queryKey:["user-points"]}),S.invalidateQueries({queryKey:["community-posts"]})])},[S]);if(!i||r)return e.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4",children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsx("div",{className:"text-center",children:s("common.loading")})})});const Re=s(L?`profile.role.${L}`:"profile.role.user");return e.jsx(e.Fragment,{children:e.jsx(Pt,{onRefresh:_e,children:e.jsx("div",{className:`min-h-screen bg-secondary/20 ${t?"pb-20 pt-4":"py-4 md:py-8 px-3 md:px-4"}`,children:e.jsxs("div",{className:`container mx-auto max-w-6xl ${t?"px-3":""}`,children:[!t&&e.jsx(e.Fragment,{children:e.jsx(P,{className:"mb-6 md:mb-8",children:e.jsx(I,{className:"pt-4 md:pt-6 pb-4 md:pb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-4 md:gap-6",children:[e.jsxs(Fs,{className:"w-24 h-24",children:[e.jsx(Os,{src:c?.avatar_url||""}),e.jsx($s,{className:"text-3xl",children:c?.display_name?.charAt(0).toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-foreground",children:c?.display_name}),e.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:i.email}),c?.phone&&e.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:c.phone}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[L&&L!=="user"&&e.jsx(j,{className:"bg-primary capitalize",children:Re}),c?.has_published_recipe&&e.jsxs(j,{className:"gap-1 border font-semibold",style:{background:"linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 50%, #a8a8a8 100%)",borderColor:"#b0b0b0",color:"#3a3a3a",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"},children:[e.jsx(We,{className:"w-3 h-3"}),s("profile.recipeExpert")]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(Ys,{className:"h-5 w-5 text-amber-500"}),e.jsx("span",{className:"font-semibold text-lg",children:c?.points||0}),e.jsx("span",{className:"text-muted-foreground",children:s("profile.points")}),e.jsx(ta,{}),(Le?.shop_enabled!==!1||se)&&e.jsxs(F,{to:"/shop",className:"ml-2 inline-flex items-center gap-1 text-sm text-primary hover:underline",children:[e.jsx(Zs,{className:"h-4 w-4"}),s("profile.pointsShop")]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-start",children:[c&&e.jsx(na,{profile:c}),X&&c&&e.jsx(ra,{isAgreed:c?.activity_terms_agreed||!1,agreedAt:c?.activity_terms_agreed_at||null})]})]})})})}),t?e.jsx(e.Fragment,{children:e.jsx(ht,{setApi:Ee,opts:{align:"start",loop:!1},className:"w-full",children:e.jsxs(ut,{className:"-ml-0",children:[e.jsx(es,{className:"pl-0",children:e.jsxs("div",{className:"pb-4 space-y-4",children:[e.jsx(P,{children:e.jsx(I,{className:"pt-6 pb-6",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs(Fs,{className:"w-20 h-20",children:[e.jsx(Os,{src:c?.avatar_url||""}),e.jsx($s,{className:"text-2xl",children:c?.display_name?.charAt(0).toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1 text-center w-full",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2 text-foreground",children:c?.display_name}),e.jsx("p",{className:"text-muted-foreground text-sm mb-2",children:i.email}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(Ys,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"font-semibold",children:c?.points||0}),e.jsx("span",{className:"text-muted-foreground text-sm",children:s("profile.points")}),e.jsx(ta,{})]}),(Le?.shop_enabled!==!1||se)&&e.jsxs(F,{to:"/shop",className:"inline-flex items-center justify-center gap-1 text-xs text-primary hover:underline mb-2",children:[e.jsx(Zs,{className:"h-3 w-3"}),s("profile.pointsShop")]}),c?.phone&&e.jsx("p",{className:"text-muted-foreground text-sm mb-3",children:c.phone}),e.jsxs("div",{className:"flex items-center justify-center gap-2 flex-wrap mb-4",children:[L&&L!=="user"&&e.jsx(j,{className:"bg-primary capitalize text-xs",children:Re}),c?.has_published_recipe&&e.jsxs(j,{className:"gap-1 border font-semibold text-xs",style:{background:"linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 50%, #a8a8a8 100%)",borderColor:"#b0b0b0",color:"#3a3a3a",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"},children:[e.jsx(We,{className:"w-3 h-3"}),s("profile.recipeExpert")]})]}),c&&e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-2 w-full",children:[e.jsx(na,{profile:c}),X&&e.jsx(ra,{isAgreed:c?.activity_terms_agreed||!1,agreedAt:c?.activity_terms_agreed_at||null})]})]})]})})}),e.jsx(xa,{isMobile:!0}),e.jsxs(P,{children:[e.jsxs(z,{className:"pb-3",children:[e.jsxs(B,{className:"text-lg flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5"}),s("profile.coupons.title")]}),e.jsx(M,{className:"text-xs",children:s("profile.coupons.description")})]}),e.jsx(I,{className:"px-3",children:U?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):R&&R.length>0?e.jsx("div",{className:"space-y-3",children:R.map(l=>e.jsx(Hs,{coupon:l,getLocalizedField:y,t:s,isMobile:!0},l.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.coupons.noCoupons")," ",e.jsx(F,{to:"/activities",className:"text-primary hover:underline",children:s("profile.coupons.browseActivities")})]})})]}),e.jsx(ca,{}),e.jsx(oa,{}),e.jsx(da,{})]})}),e.jsx(es,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsx(P,{children:e.jsx(I,{className:"pt-4",children:e.jsxs(Ke,{defaultValue:"restaurants",className:"w-full",children:[e.jsxs(Me,{className:"grid w-full grid-cols-2 mb-4",children:[e.jsxs($,{value:"restaurants",className:"flex items-center gap-2 text-xs",children:[e.jsx(xe,{className:"w-4 h-4"}),s("profile.restaurantFavorites"),o&&o.length>0&&e.jsx(j,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:o.length})]}),e.jsxs($,{value:"activities",className:"flex items-center gap-2 text-xs",children:[e.jsx(me,{className:"w-4 h-4"}),s("profile.activityFavorites"),h&&h.length>0&&e.jsx(j,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:h.length})]})]}),e.jsxs(T,{value:"restaurants",children:[o&&o.length>0&&e.jsx("div",{className:"flex items-center gap-2 mb-3 flex-wrap",children:e.jsxs(g,{variant:O?"default":"outline",size:"sm",onClick:Z,disabled:J,className:"h-7 text-xs gap-1",children:[J?e.jsx(Ps,{className:"w-3 h-3 animate-spin"}):e.jsx(Ws,{className:"w-3 h-3"}),s(J?"profile.sortingByDistance":O?"profile.sortedByDistance":"profile.sortByDistance")]})}),n?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):G&&G.length>0?e.jsx("div",{className:"grid gap-3 grid-cols-1",children:G.map(l=>e.jsx(zs,{restaurant:l,getLocalizedField:y,t:s,distance:O?H[l.id]:void 0},l.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.noFavorites")})]}),e.jsx(T,{value:"activities",children:E?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):h&&h.length>0?e.jsx("div",{className:"space-y-3",children:h.map(l=>e.jsx(qs,{subscription:l,getLocalizedField:y,t:s,isMobile:!0},l.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.noActivityFavorites")," ",e.jsx(F,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})]})})})})}),e.jsx(es,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsx(P,{children:e.jsx(I,{className:"pt-4",children:e.jsxs(Ke,{defaultValue:"comments",className:"w-full",children:[e.jsxs(Me,{className:"grid w-full grid-cols-3 mb-4",children:[e.jsxs($,{value:"comments",className:"flex items-center gap-2 text-xs",children:[e.jsx(Be,{className:"w-4 h-4"}),s("profile.myComments"),p&&p.length>0&&e.jsx(j,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:p.length})]}),e.jsxs($,{value:"posts",className:"flex items-center gap-2 text-xs",children:[e.jsx(ea,{className:"w-4 h-4"}),s("profile.myPosts"),C&&C.length>0&&e.jsx(j,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:C.length})]}),e.jsxs($,{value:"saved-recipes",className:"flex items-center gap-2 text-xs",children:[e.jsx(sa,{className:"w-4 h-4"}),s("profile.savedRecipes","æˆ‘çš„é£Ÿè°±"),w.length>0&&e.jsx(j,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:w.length})]})]}),e.jsx(T,{value:"comments",children:m?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):p&&p.length>0?e.jsx("div",{className:"space-y-3",children:p.map(l=>e.jsx(Us,{comment:l,getLocalizedField:y,t:s},l.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.noComments")})}),e.jsx(T,{value:"posts",children:q?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):C&&C.length>0?e.jsx("div",{className:"space-y-3",children:C.map(l=>e.jsx(aa,{post:l,showAssociations:!0},l.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.noPosts")," ",e.jsx(F,{to:"/community",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})}),e.jsx(T,{value:"saved-recipes",children:pe?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):w.length>0?e.jsx("div",{className:"space-y-3",children:w.map(l=>e.jsxs("div",{className:"rounded-lg border hover:shadow-medium transition-shadow overflow-hidden cursor-pointer",onClick:()=>ge(`/saved-recipe/${l.id}`),children:[e.jsx(pa,{recipe:l,className:"w-full aspect-[16/9]"}),e.jsxs("div",{className:"p-3 flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm line-clamp-1",children:a.language==="en"&&l.recipe_data.recipe_name_en?l.recipe_data.recipe_name_en:a.language==="pt"&&l.recipe_data.recipe_name_pt?l.recipe_data.recipe_name_pt:l.recipe_name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-muted-foreground",children:[l.recipe_data.cook_time&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"w-3 h-3"}),l.recipe_data.cook_time,s("recipe.minutes","åˆ†é’Ÿ")]}),l.recipe_data.difficulty&&e.jsxs(j,{variant:"outline",className:"text-xs px-1.5 py-0",children:[e.jsx(We,{className:"w-3 h-3 mr-0.5"}),s(`recipe.difficulty.${l.recipe_data.difficulty}`)]}),l.recipe_data.servings&&e.jsxs("span",{children:[l.recipe_data.servings,s("recipe.servingsUnit","äººä»½")]})]})]}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive shrink-0",onClick:u=>{u.stopPropagation(),Ie(l.id)},children:e.jsx(ps,{className:"h-4 w-4"})})]})]},l.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.noSavedRecipes","è¿˜æ²¡æœ‰ä¿å­˜çš„é£Ÿè°±")," ",e.jsx(F,{to:"/ai-recipe",className:"text-primary hover:underline",children:s("profile.tryAIRecipe","è¯•è¯• AI é£Ÿè°±")})]})})]})})})})}),X&&e.jsx(es,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsxs(P,{children:[e.jsxs(z,{className:"pb-3",children:[e.jsxs(B,{className:"text-lg flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5"}),s("profile.participatedActivities")]}),e.jsx(M,{className:"text-xs",children:s("profile.participatedActivitiesDesc")})]}),e.jsx(I,{className:"px-3",children:e.jsx("div",{className:"space-y-4",children:K?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):b&&b.length>0?e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2 text-base",children:[e.jsx(xe,{className:"w-4 h-4"}),s("profile.restaurantActivities")]}),e.jsx("div",{className:"space-y-3",children:(()=>{const l=b.reduce((u,N)=>{const D=N.activity_id;return u[D]||(u[D]={activity:N.activity,restaurants:[],participationDate:N.created_at}),u[D].restaurants.push({id:N.restaurant_id,name:N.restaurant_name,name_en:N.restaurant_name_en,name_pt:N.restaurant_name_pt}),u},{});return Object.values(l).map(u=>e.jsx(Ls,{activityGroup:u,getLocalizedField:y,t:s,isMobile:!0},u.activity.id))})()})]}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.noParticipatedActivities")," ",e.jsx(F,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})})]})})})]})})}):e.jsxs(Ke,{defaultValue:"favorites",className:"space-y-4 md:space-y-6",children:[e.jsxs(Me,{className:`grid w-full ${X?"grid-cols-7":"grid-cols-6"} bg-card border rounded-lg shadow-sm h-auto p-1`,children:[e.jsxs($,{value:"favorites",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),s("profile.favorites")]}),e.jsxs($,{value:"coupons",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),s("profile.coupons.title")]}),e.jsxs($,{value:"comments",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),s("profile.comments")]}),X&&e.jsxs($,{value:"activities",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),s("profile.participatedActivities")]}),e.jsxs($,{value:"invitation-code",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Es,{className:"w-4 h-4 mr-2"}),s("profile.invitationCode.title")]}),e.jsxs($,{value:"addresses",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),s("address.myAddresses")]}),e.jsxs($,{value:"orders",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Bs,{className:"w-4 h-4 mr-2"}),s("profile.orderRecords")]})]}),e.jsx(T,{value:"favorites",children:e.jsx(P,{children:e.jsx(I,{className:"pt-6",children:e.jsxs(Ke,{defaultValue:"restaurants",className:"w-full",children:[e.jsxs(Me,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs($,{value:"restaurants",className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),s("profile.restaurantFavorites"),o&&o.length>0&&e.jsx(j,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:o.length})]}),e.jsxs($,{value:"activities",className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4"}),s("profile.activityFavorites"),h&&h.length>0&&e.jsx(j,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:h.length})]})]}),e.jsxs(T,{value:"restaurants",children:[o&&o.length>0&&e.jsx("div",{className:"flex items-center gap-2 mb-4 flex-wrap",children:e.jsxs(g,{variant:O?"default":"outline",size:"sm",onClick:Z,disabled:J,className:"h-8 text-sm gap-1.5",children:[J?e.jsx(Ps,{className:"w-4 h-4 animate-spin"}):e.jsx(Ws,{className:"w-4 h-4"}),s(J?"profile.sortingByDistance":O?"profile.sortedByDistance":"profile.sortByDistance")]})}),n?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):G&&G.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:G.map(l=>e.jsx(zs,{restaurant:l,getLocalizedField:y,t:s,distance:O?H[l.id]:void 0},l.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:s("profile.noFavorites")})]}),e.jsx(T,{value:"activities",children:E?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):h&&h.length>0?e.jsx("div",{className:"space-y-4",children:h.map(l=>e.jsx(qs,{subscription:l,getLocalizedField:y,t:s,isMobile:t},l.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8",children:[s("profile.noActivityFavorites")," ",e.jsx(F,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})]})})})}),e.jsx(T,{value:"comments",children:e.jsx(P,{children:e.jsx(I,{className:"pt-6",children:e.jsxs(Ke,{defaultValue:"comments",className:"w-full",children:[e.jsxs(Me,{className:"grid w-full grid-cols-3 mb-6",children:[e.jsxs($,{value:"comments",className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4"}),s("profile.myComments"),p&&p.length>0&&e.jsx(j,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:p.length})]}),e.jsxs($,{value:"posts",className:"flex items-center gap-2",children:[e.jsx(ea,{className:"w-4 h-4"}),s("profile.myPosts"),C&&C.length>0&&e.jsx(j,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:C.length})]}),e.jsxs($,{value:"saved-recipes",className:"flex items-center gap-2",children:[e.jsx(sa,{className:"w-4 h-4"}),s("profile.savedRecipes","æˆ‘çš„é£Ÿè°±"),w.length>0&&e.jsx(j,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:w.length})]})]}),e.jsx(T,{value:"comments",children:m?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):p&&p.length>0?e.jsx("div",{className:"space-y-4",children:p.map(l=>e.jsx(Us,{comment:l,getLocalizedField:y,t:s},l.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:s("profile.noComments")})}),e.jsx(T,{value:"posts",children:q?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):C&&C.length>0?e.jsx("div",{className:"columns-2 gap-4 md:columns-3",children:C.map(l=>e.jsx("div",{className:"break-inside-avoid mb-4",children:e.jsx(aa,{post:l})},l.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8",children:[s("profile.noPosts")," ",e.jsx(F,{to:"/community",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})}),e.jsx(T,{value:"saved-recipes",children:pe?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):w.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:w.map(l=>e.jsxs("div",{className:"rounded-lg border hover:shadow-medium transition-shadow overflow-hidden cursor-pointer",onClick:()=>ge(`/saved-recipe/${l.id}`),children:[e.jsx(pa,{recipe:l,className:"w-full aspect-[16/9]"}),e.jsxs("div",{className:"p-4 flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold line-clamp-1",children:a.language==="en"&&l.recipe_data.recipe_name_en?l.recipe_data.recipe_name_en:a.language==="pt"&&l.recipe_data.recipe_name_pt?l.recipe_data.recipe_name_pt:l.recipe_name}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-sm text-muted-foreground",children:[l.recipe_data.cook_time&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"w-3.5 h-3.5"}),l.recipe_data.cook_time,s("recipe.minutes","åˆ†é’Ÿ")]}),l.recipe_data.difficulty&&e.jsxs(j,{variant:"outline",className:"text-xs",children:[e.jsx(We,{className:"w-3 h-3 mr-1"}),s(`recipe.difficulty.${l.recipe_data.difficulty}`)]}),l.recipe_data.servings&&e.jsxs("span",{children:[l.recipe_data.servings,s("recipe.servingsUnit","äººä»½")]})]})]}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive shrink-0",onClick:u=>{u.stopPropagation(),Ie(l.id)},children:e.jsx(ps,{className:"h-4 w-4"})})]})]},l.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8",children:[s("profile.noSavedRecipes","è¿˜æ²¡æœ‰ä¿å­˜çš„é£Ÿè°±")," ",e.jsx(F,{to:"/ai-recipe",className:"text-primary hover:underline",children:s("profile.tryAIRecipe","è¯•è¯• AI é£Ÿè°±")})]})})]})})})}),X&&e.jsx(T,{value:"activities",children:e.jsxs(P,{children:[e.jsxs(z,{className:t?"pb-3":"",children:[e.jsxs(B,{className:`flex items-center gap-2 ${t?"text-lg":""}`,children:[e.jsx(me,{className:"w-5 h-5"}),s("profile.participatedActivities")]}),e.jsx(M,{className:t?"text-xs":"",children:s("profile.participatedActivitiesDesc")})]}),e.jsx(I,{className:t?"px-3":"",children:e.jsx("div",{className:t?"space-y-4":"space-y-6",children:K?e.jsx("div",{className:`text-center py-8 ${t?"text-sm":""}`,children:s("common.loading")}):b&&b.length>0?e.jsxs("div",{children:[e.jsxs("h3",{className:`font-semibold mb-3 md:mb-4 flex items-center gap-2 ${t?"text-base":"text-lg"}`,children:[e.jsx(xe,{className:t?"w-4 h-4":"w-5 h-5"}),s("profile.restaurantActivities")]}),e.jsx("div",{className:t?"space-y-3":"space-y-4",children:(()=>{const l=b.reduce((u,N)=>{const D=N.activity_id;return u[D]||(u[D]={activity:N.activity,restaurants:[],participationDate:N.created_at}),u[D].restaurants.push({id:N.restaurant_id,name:N.restaurant_name,name_en:N.restaurant_name_en,name_pt:N.restaurant_name_pt}),u},{});return Object.values(l).map(u=>e.jsx(Ls,{activityGroup:u,getLocalizedField:y,t:s,isMobile:t},u.activity.id))})()})]}):e.jsxs("p",{className:`text-muted-foreground text-center py-8 ${t?"text-sm":""}`,children:[s("profile.noParticipatedActivities")," ",e.jsx(F,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})})]})}),e.jsx(T,{value:"invitation-code",children:e.jsx(xa,{})}),e.jsx(T,{value:"coupons",children:e.jsxs(P,{children:[e.jsxs(z,{className:t?"pb-3":"",children:[e.jsxs(B,{className:`flex items-center gap-2 ${t?"text-lg":""}`,children:[e.jsx(Je,{className:"w-5 h-5"}),s("profile.coupons.title")]}),e.jsx(M,{className:t?"text-xs":"",children:s("profile.coupons.description")})]}),e.jsx(I,{className:t?"px-3":"",children:U?e.jsx("div",{className:`text-center py-8 ${t?"text-sm":""}`,children:s("common.loading")}):R&&R.length>0?e.jsx("div",{className:`grid gap-3 md:gap-4 ${t?"grid-cols-1":"md:grid-cols-2"}`,children:R.map(l=>e.jsx(Hs,{coupon:l,getLocalizedField:y,t:s,isMobile:t},l.id))}):e.jsxs("p",{className:`text-muted-foreground text-center py-8 ${t?"text-sm":""}`,children:[s("profile.coupons.noCoupons")," ",e.jsx(F,{to:"/activities",className:"text-primary hover:underline",children:s("profile.coupons.browseActivities")})]})})]})}),e.jsx(T,{value:"addresses",children:e.jsx(ca,{})}),e.jsx(T,{value:"orders",children:e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx(oa,{}),e.jsx(da,{})]})})]}),t&&e.jsxs("div",{className:"fixed left-4 right-4 z-40 bg-white/20 dark:bg-black/25 backdrop-blur-sm border border-white/40 dark:border-white/30 shadow-[0_2px_20px_rgba(0,0,0,0.08)] rounded-[28px] overflow-hidden",style:{contain:"layout style paint",isolation:"isolate",backfaceVisibility:"hidden",transform:"translateZ(0)",bottom:"max(1rem, calc(env(safe-area-inset-bottom) + 0.25rem))"},children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-white/10 via-transparent to-transparent pointer-events-none"}),e.jsx("div",{className:"relative flex justify-around items-center h-16 px-4",children:$e.map(l=>{const u=l.icon;return e.jsxs("button",{onClick:()=>be(l.value),className:`relative flex flex-col items-center justify-center flex-1 h-12 py-1.5 px-2 mx-0.5 transition-all duration-200 rounded-2xl ${Y===l.value?"text-primary dark:text-white bg-primary/15 dark:bg-white/15":"text-gray-700 dark:text-white/80 active:bg-black/5 dark:active:bg-white/5"}`,children:[e.jsx(u,{className:`h-5 w-5 mb-0.5 transition-all duration-200 ${Y===l.value?"scale-110 drop-shadow-[0_0_6px_rgba(34,197,94,0.6)] dark:drop-shadow-[0_0_6px_rgba(255,255,255,0.6)]":""}`}),e.jsx("span",{className:`text-xs text-center leading-tight ${Y===l.value?"font-semibold":"font-normal"}`,children:l.label})]},l.value)})})]})]})})})})};export{Er as default};
//# sourceMappingURL=Profile-CKp5NdiH.js.map
