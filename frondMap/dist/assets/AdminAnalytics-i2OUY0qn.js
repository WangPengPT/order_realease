import{j as e}from"./vendor-ui-DAmPMpEA.js";import{r as v}from"./vendor-react-iAJ0IrSD.js";import{s as C,y as xe,D as he,a3 as ue,B as U,a as fe,b as pe,c as ye,al as se,S as ge,Y as je,Z as we,_ as ve,q,ai as Ne,M as le,aD as be,aJ as _e,aK as De,h as Se,C as b,i as _,t as D,j as S,g as ke,f as Ce,au as X}from"./index-BcrfGQEh.js";import{a as ae}from"./vendor-query-BlSVl3IQ.js";import{s as re}from"./startOfDay-CJ0Nm-E7.js";import{s as Me}from"./subDays-DEpdoBC8.js";import{f as F}from"./format-C1rHoFdk.js";import{u as ce}from"./vendor-i18n-DxKeo2S1.js";import{U as te}from"./users-B1UqT5l5.js";import{R as oe}from"./refresh-cw-BI_CDHcK.js";import{E as Ee}from"./eye-CrXJhp4G.js";import{T as Z}from"./trending-up-DjOVe_c3.js";import{R,L as J,C as I,X as $,Y as P,T as K,b as Y,P as Le,e as Ve,f as Te,B as Q,d as ee,a as ne}from"./vendor-charts-Bz7hPIBd.js";import{C as Ae}from"./chart-column-CF-gauMi.js";import{L as Oe}from"./link-2-gMUYL1jG.js";import{B as Ue}from"./building-hfhXup05.js";import"./vendor-supabase-KNAP0qdW.js";const Fe=t=>{if(!t)return"direct";try{return new URL(t).hostname.replace("www.","")}catch{return"unknown"}},ze=(t=30)=>ae({queryKey:["analytics",t],queryFn:async()=>{let o=null;t===1?o=re(new Date).toISOString():t>1&&(o=re(Me(new Date,t-1)).toISOString());const y=1e3;let k=[],p=0,M=!0;for(;M;){let s=C.from("page_views").select("*").order("created_at",{ascending:!1}).range(p*y,(p+1)*y-1);o&&(s=s.gte("created_at",o));const{data:a,error:n}=await s;if(n)throw n;a&&a.length>0?(k=k.concat(a),M=a.length===y,p++):M=!1}const d=k,g=d.length,E=new Set(d.map(s=>s.visitor_id)).size,L={};d.forEach(s=>{L[s.page_type]=(L[s.page_type]||0)+1});const V=new Map;d.forEach(s=>{const a=F(new Date(s.created_at),"yyyy-MM-dd");V.has(a)||V.set(a,{views:0,visitors:new Set});const n=V.get(a);n.views++,n.visitors.add(s.visitor_id)});const m=Array.from(V.entries()).map(([s,a])=>({date:s,views:a.views,uniqueVisitors:a.visitors.size})).sort((s,a)=>s.date.localeCompare(a.date)),l=new Map;d.forEach(s=>{const a=Fe(s.referer);l.set(a,(l.get(a)||0)+1)});const f=Array.from(l.entries()).map(([s,a])=>({domain:s,count:a,percentage:g>0?a/g*100:0})).sort((s,a)=>a.count-s.count),h=new Map;d.forEach(s=>{const a=s.country||"unknown";h.set(a,(h.get(a)||0)+1)});const w=Array.from(h.entries()).map(([s,a])=>({location:s,count:a,percentage:g>0?a/g*100:0})).sort((s,a)=>a.count-s.count),r=new Map;d.forEach(s=>{const a=s.city||"unknown";r.set(a,(r.get(a)||0)+1)});const x=Array.from(r.entries()).map(([s,a])=>({location:s,count:a,percentage:g>0?a/g*100:0})).sort((s,a)=>a.count-s.count),T=new Map;d.forEach(s=>{const a=F(new Date(s.created_at),"yyyy-MM-dd"),n=s.country||"unknown";T.has(n)||T.set(n,new Map);const j=T.get(n);j.set(a,(j.get(a)||0)+1)});const c=[];T.forEach((s,a)=>{s.forEach((n,j)=>{c.push({date:j,location:a,views:n})})}),c.sort((s,a)=>s.date.localeCompare(a.date));const O=new Map;d.forEach(s=>{const a=F(new Date(s.created_at),"yyyy-MM-dd"),n=s.city||"unknown";O.has(n)||O.set(n,new Map);const j=O.get(n);j.set(a,(j.get(a)||0)+1)});const u=[];O.forEach((s,a)=>{s.forEach((n,j)=>{u.push({date:j,location:a,views:n})})}),u.sort((s,a)=>s.date.localeCompare(a.date));const N=new Map;d.filter(s=>s.page_type==="restaurant"&&s.target_id).forEach(s=>{N.set(s.target_id,(N.get(s.target_id)||0)+1)});const A=Array.from(N.entries()).sort((s,a)=>a[1]-s[1]).slice(0,10);let H=[];if(A.length>0){const{data:s}=await C.from("restaurants").select("id, name").in("id",A.map(a=>a[0]));H=A.map(([a,n])=>({id:a,name:s?.find(j=>j.id===a)?.name||"Unknown",views:n}))}const B=new Map;d.filter(s=>s.page_type==="activity"&&s.target_id).forEach(s=>{B.set(s.target_id,(B.get(s.target_id)||0)+1)});const W=Array.from(B.entries()).sort((s,a)=>a[1]-s[1]).slice(0,10);let G=[];if(W.length>0){const{data:s}=await C.from("activities").select("id, title_zh, title_en, title_pt").in("id",W.map(a=>a[0]));G=W.map(([a,n])=>{const j=s?.find(me=>me.id===a);return{id:a,title:j?.title_zh||j?.title_en||"Unknown",views:n}})}return{totalViews:g,uniqueVisitors:E,viewsByPage:L,dailyViews:m,topRestaurants:H,topActivities:G,refererStats:f,countryStats:w,cityStats:x,countryDailyViews:c,cityDailyViews:u}}}),de=()=>{const[t,o]=v.useState(new Set),[y,k]=v.useState(null);v.useEffect(()=>{console.log("Initializing online users observer...");const m=C.channel("online-users");return m.on("presence",{event:"sync"},()=>{const l=m.presenceState(),f=new Set;Object.keys(l).forEach(h=>{f.add(h)}),o(f),console.log("Presence sync - online users:",Array.from(f))}).on("presence",{event:"join"},({key:l,newPresences:f})=>{console.log("User joined:",l,f),o(h=>new Set([...h,l]))}).on("presence",{event:"leave"},({key:l,leftPresences:f})=>{console.log("User left:",l,f),o(h=>{const w=new Set(h);return w.delete(l),w})}).subscribe(l=>{console.log("Presence channel status:",l)}),k(m),()=>{console.log("Cleaning up online users observer..."),C.removeChannel(m)}},[]);const{data:p,isLoading:M,refetch:d}=ae({queryKey:["online-users-details",Array.from(t).sort().join(",")],queryFn:async()=>{if(t.size===0)return[];const m=Array.from(t);console.log("Fetching details for online users:",m);const{data:l,error:f}=await C.from("user_presence").select("*").in("user_id",m);f&&console.error("Error fetching presence:",f);const{data:h,error:w}=await C.rpc("get_public_profiles",{user_ids:m});w&&console.error("Error fetching profiles:",w);const{data:r,error:x}=await C.from("user_roles").select("user_id, role").in("user_id",m);x&&console.error("Error fetching roles:",x);const T=new Map((l||[]).map(u=>[u.user_id,u])),c=new Map((h||[]).map(u=>[u.id,u])),O=new Map((r||[]).map(u=>[u.user_id,u.role]));return m.map(u=>{const N=T.get(u),A=c.get(u);return{user_id:u,is_online:!0,last_seen:N?.last_seen||new Date().toISOString(),ip_address:N?.ip_address,city:N?.city,country:N?.country,profile:A?{display_name:A.display_name,avatar_url:A.avatar_url}:void 0,role:O.get(u)}})},enabled:t.size>0,staleTime:1e4}),{data:g,refetch:i}=ae({queryKey:["online-users-db-fallback"],queryFn:async()=>{const m=new Date(Date.now()-12e4).toISOString(),{data:l,error:f}=await C.from("user_presence").select("*").gte("last_seen",m).order("last_seen",{ascending:!1});if(f)return console.error("Error fetching DB presence:",f),[];if(!l||l.length===0)return[];const h=l.map(c=>c.user_id),{data:w}=await C.rpc("get_public_profiles",{user_ids:h}),{data:r}=await C.from("user_roles").select("user_id, role").in("user_id",h),x=new Map((w||[]).map(c=>[c.id,c])),T=new Map((r||[]).map(c=>[c.user_id,c.role]));return l.map(c=>({user_id:c.user_id,is_online:c.is_online,last_seen:c.last_seen,ip_address:c.ip_address,city:c.city,country:c.country,profile:x.get(c.user_id)?{display_name:x.get(c.user_id).display_name,avatar_url:x.get(c.user_id).avatar_url}:void 0,role:T.get(c.user_id)}))},refetchInterval:3e4}),E=(()=>{const m=new Map;return(g||[]).forEach(l=>{m.set(l.user_id,l)}),(p||[]).forEach(l=>{m.set(l.user_id,{...l,is_online:!0})}),t.forEach(l=>{m.has(l)||m.set(l,{user_id:l,is_online:!0,last_seen:new Date().toISOString()})}),Array.from(m.values())})(),L=E.length;return{onlineUsers:E,onlineCount:L,isLoading:M,refetch:async()=>{await Promise.all([d(),i()])}}},Re=({trigger:t})=>{const{t:o,i18n:y}=ce(),[k,p]=v.useState(!1),[M,d]=v.useState(!1),{onlineUsers:g,onlineCount:i,isLoading:E,refetch:L}=de(),V=v.useCallback(async()=>{d(!0);try{await L(),xe.success(o("common.refreshed","已刷新"))}finally{d(!1)}},[L,o]),m=()=>{switch(y.language){case"zh":return De;case"pt":return _e;default:return be}},l=r=>{switch(r){case"admin":return"destructive";case"supervisor":return"default";case"merchant":return"secondary";default:return"outline"}},f=r=>{switch(r){case"admin":return o("admin.role.admin","管理员");case"supervisor":return o("admin.role.supervisor","主管");case"merchant":return o("admin.role.merchant","商家");default:return o("admin.role.user","用户")}},h=(r,x)=>r&&x?`${r}, ${x}`:r||x||null,w=r=>r.city||r.country||r.ip_address;return e.jsxs(he,{open:k,onOpenChange:p,children:[e.jsx(ue,{asChild:!0,children:t||e.jsxs(U,{variant:"outline",size:"sm",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),o("admin.onlineUsers.viewOnline","查看在线用户")]})}),e.jsxs(fe,{className:"max-w-md",children:[e.jsx(pe,{children:e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-3 h-3 fill-green-500 text-green-500"}),o("admin.onlineUsers.title","在线用户")," (",i,")"]})}),e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs(U,{variant:"ghost",size:"sm",onClick:V,disabled:E||M,children:[e.jsx(oe,{className:`w-4 h-4 mr-1 ${E||M?"animate-spin":""}`}),o("common.refresh","刷新")]})}),e.jsx(ge,{className:"h-[400px] pr-4",children:E?e.jsx("div",{className:"flex items-center justify-center h-32 text-muted-foreground",children:o("common.loading","加载中...")}):g.length===0?e.jsx("div",{className:"flex items-center justify-center h-32 text-muted-foreground",children:o("admin.onlineUsers.noOnline","暂无在线用户")}):e.jsx("div",{className:"space-y-3",children:g.map(r=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(je,{className:"h-10 w-10",children:[e.jsx(we,{src:r.profile?.avatar_url||void 0}),e.jsx(ve,{children:r.profile?.display_name?.charAt(0)||"?"})]}),e.jsx(se,{className:`absolute -bottom-0.5 -right-0.5 w-3 h-3 ${r.is_online?"fill-green-500 text-green-500":"fill-yellow-500 text-yellow-500"}`})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium truncate",children:r.profile?.display_name||o("common.anonymous","匿名用户")}),e.jsx(q,{variant:l(r.role),className:"text-xs",children:f(r.role)})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.is_online?o("admin.onlineUsers.online","在线中"):o("admin.onlineUsers.lastSeen","最后活跃 {{time}}",{time:Ne(new Date(r.last_seen),{addSuffix:!0,locale:m()})})}),w(r)&&e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-xs text-muted-foreground",children:[e.jsx(le,{className:"w-3 h-3"}),e.jsxs("span",{className:"truncate",children:[h(r.city,r.country)&&e.jsx("span",{children:h(r.city,r.country)}),r.ip_address&&e.jsxs(e.Fragment,{children:[h(r.city,r.country)&&e.jsx("span",{className:"mx-1",children:"·"}),e.jsx("span",{className:"font-mono text-[10px]",children:r.ip_address})]})]})]})]})]},r.user_id))})})]})]})},ie=["hsl(var(--primary))","hsl(var(--chart-2))","hsl(var(--chart-3))","hsl(var(--chart-4))","hsl(var(--chart-5))","hsl(var(--muted-foreground))"],z=["hsl(var(--primary))","hsl(var(--chart-2))","hsl(var(--chart-3))","hsl(var(--chart-4))","hsl(var(--chart-5))"],ts=()=>{const{t,i18n:o}=ce(),[y,k]=v.useState(30),[p,M]=v.useState([]),[d,g]=v.useState([]),{data:i,isLoading:E,refetch:L,isRefetching:V}=ze(y),{onlineCount:m,isLoading:l}=de(),f={home:t("analytics.pageTypes.home","首页"),restaurant:t("analytics.pageTypes.restaurant","餐厅详情"),activity:t("analytics.pageTypes.activity","活动详情"),restaurants:t("analytics.pageTypes.restaurants","餐厅列表"),activities:t("analytics.pageTypes.activities","活动列表"),map:t("analytics.pageTypes.map","地图"),profile:t("analytics.pageTypes.profile","个人资料"),auth:t("analytics.pageTypes.auth","登录/注册"),"join-us":t("analytics.pageTypes.joinUs","加入我们"),other:t("analytics.pageTypes.other","其他")},h={direct:t("analytics.referer.direct","直接访问"),unknown:t("analytics.referer.unknown","未知来源")},w={unknown:t("analytics.location.unknown","未知地区")},r=s=>h[s]||s,x=s=>w[s]||s,T=v.useMemo(()=>i?.countryStats?.slice(0,10).map(s=>s.location)||[],[i?.countryStats]),c=v.useMemo(()=>i?.cityStats?.slice(0,10).map(s=>s.location)||[],[i?.cityStats]),O=v.useMemo(()=>{if(!i?.countryDailyViews||p.length===0)return[];const s=new Map;return i.countryDailyViews.filter(a=>p.includes(a.location)).forEach(a=>{s.has(a.date)||s.set(a.date,{}),s.get(a.date)[a.location]=a.views}),Array.from(s.entries()).map(([a,n])=>({date:a,...n})).sort((a,n)=>a.date.localeCompare(n.date))},[i?.countryDailyViews,p]),u=v.useMemo(()=>{if(!i?.cityDailyViews||d.length===0)return[];const s=new Map;return i.cityDailyViews.filter(a=>d.includes(a.location)).forEach(a=>{s.has(a.date)||s.set(a.date,{}),s.get(a.date)[a.location]=a.views}),Array.from(s.entries()).map(([a,n])=>({date:a,...n})).sort((a,n)=>a.date.localeCompare(n.date))},[i?.cityDailyViews,d]),N=i?.viewsByPage?Object.entries(i.viewsByPage).map(([s,a])=>({name:f[s]||s,value:a})):[],A=i?.refererStats?.slice(0,10).map(s=>({name:r(s.domain),value:s.count,percentage:s.percentage.toFixed(1)}))||[],H=i?.countryStats?.slice(0,10).map(s=>({name:x(s.location),value:s.count,percentage:s.percentage.toFixed(1)}))||[],B=i?.cityStats?.slice(0,10).map(s=>({name:x(s.location),value:s.count,percentage:s.percentage.toFixed(1)}))||[],W=s=>{M(a=>a.includes(s)?a.filter(n=>n!==s):a.length<5?[...a,s]:a)},G=s=>{g(a=>a.includes(s)?a.filter(n=>n!==s):a.length<5?[...a,s]:a)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:t("analytics.title","访问统计")}),e.jsx("p",{className:"text-muted-foreground",children:t("analytics.description","网站访问数据分析")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[e.jsx(U,{variant:y===1?"default":"outline",size:"sm",onClick:()=>k(1),children:t("analytics.today","今日")}),[7,30,90].map(s=>e.jsxs(U,{variant:y===s?"default":"outline",size:"sm",onClick:()=>k(s),children:[s,t("analytics.days","天")]},s)),e.jsx(U,{variant:y===0?"default":"outline",size:"sm",onClick:()=>k(0),children:t("analytics.all","所有")})]}),e.jsxs(U,{variant:"outline",size:"sm",onClick:()=>L(),disabled:V,children:[e.jsx(oe,{className:`w-4 h-4 mr-1 ${V?"animate-spin":""}`}),t("common.refresh","刷新")]})]})]}),E?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map((s,a)=>e.jsx(Se,{className:"h-32"},a))}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs(b,{className:"border-green-500/50 bg-green-500/5",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs(D,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(se,{className:"h-3 w-3 fill-green-500 text-green-500"}),t("analytics.onlineUsers","在线用户")]}),e.jsx(te,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(S,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:l?"-":m}),e.jsx("div",{className:"mt-2",children:e.jsx(Re,{trigger:e.jsxs(U,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-green-600 dark:text-green-400 hover:text-green-700",children:[t("analytics.viewOnlineUsers","查看在线用户")," →"]})})})]})]}),e.jsxs(b,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(D,{className:"text-sm font-medium",children:t("analytics.totalViews","总访问量")}),e.jsx(Ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(S,{children:[e.jsx("div",{className:"text-2xl font-bold",children:i?.totalViews.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:y===0?t("analytics.allTime","所有时间"):y===1?t("analytics.today","今日"):t("analytics.lastNDays","最近{{days}}天",{days:y})})]})]}),e.jsxs(b,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(D,{className:"text-sm font-medium",children:t("analytics.uniqueVisitors","独立访客")}),e.jsx(te,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(S,{children:[e.jsx("div",{className:"text-2xl font-bold",children:i?.uniqueVisitors.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("analytics.uniqueVisitorDesc","基于访客ID")})]})]}),e.jsxs(b,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(D,{className:"text-sm font-medium",children:t("analytics.restaurantViews","餐厅浏览")}),e.jsx(ke,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(S,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(i?.viewsByPage?.restaurant||0).toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("analytics.restaurantViewsDesc","餐厅详情页访问")})]})]}),e.jsxs(b,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(D,{className:"text-sm font-medium",children:t("analytics.activityViews","活动浏览")}),e.jsx(Ce,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(S,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(i?.viewsByPage?.activity||0).toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("analytics.activityViewsDesc","活动详情页访问")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(b,{children:[e.jsx(_,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5"}),t("analytics.dailyTrend","每日访问趋势")]})}),e.jsx(S,{children:e.jsx("div",{className:"h-[300px]",children:i?.dailyViews&&i.dailyViews.length>0?e.jsx(R,{width:"100%",height:"100%",children:e.jsxs(J,{data:i.dailyViews,children:[e.jsx(I,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx($,{dataKey:"date",tickFormatter:s=>F(new Date(s),"MM/dd"),className:"text-xs"}),e.jsx(P,{className:"text-xs"}),e.jsx(K,{labelFormatter:s=>F(new Date(s),"yyyy-MM-dd"),contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(Y,{type:"monotone",dataKey:"views",stroke:"hsl(var(--primary))",strokeWidth:2,name:t("analytics.views","访问量")}),e.jsx(Y,{type:"monotone",dataKey:"uniqueVisitors",stroke:"hsl(var(--chart-2))",strokeWidth:2,name:t("analytics.uniqueVisitors","独立访客")})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:t("analytics.noData","暂无数据")})})})]}),e.jsxs(b,{children:[e.jsx(_,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5"}),t("analytics.pageDistribution","页面访问分布")]})}),e.jsx(S,{children:e.jsx("div",{className:"h-[300px]",children:N.length>0?e.jsx(R,{width:"100%",height:"100%",children:e.jsxs(Le,{children:[e.jsx(Ve,{data:N,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,percent:a})=>`${s} ${(a*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:N.map((s,a)=>e.jsx(Te,{fill:ie[a%ie.length]},`cell-${a}`))}),e.jsx(K,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:t("analytics.noData","暂无数据")})})})]})]}),e.jsxs(b,{children:[e.jsx(_,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5"}),t("analytics.refererStats","访问来源统计")]})}),e.jsx(S,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-[300px]",children:A.length>0?e.jsx(R,{width:"100%",height:"100%",children:e.jsxs(Q,{data:A,layout:"vertical",children:[e.jsx(I,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx($,{type:"number",className:"text-xs"}),e.jsx(P,{dataKey:"name",type:"category",width:120,className:"text-xs",tick:{fontSize:11}}),e.jsx(K,{formatter:(s,a,n)=>[`${s} (${n.payload.percentage}%)`,t("analytics.views","访问量")],contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(ee,{dataKey:"value",fill:"hsl(var(--primary))",radius:[0,4,4,0]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:t("analytics.noData","暂无数据")})}),e.jsx("div",{className:"space-y-3 max-h-[300px] overflow-y-auto",children:i?.refererStats&&i.refererStats.length>0?i.refererStats.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{variant:a<3?"default":"secondary",className:"w-6 h-6 p-0 justify-center",children:a+1}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm truncate max-w-[150px]",children:r(s.domain)})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium",children:s.count}),e.jsxs(q,{variant:"outline",className:"text-xs",children:[s.percentage.toFixed(1),"%"]})]})]},s.domain)):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:t("analytics.noData","暂无数据")})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(b,{children:[e.jsx(_,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5"}),t("analytics.countryStats","国家/地区统计")]})}),e.jsx(S,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[200px]",children:H.length>0?e.jsx(R,{width:"100%",height:"100%",children:e.jsxs(Q,{data:H,layout:"vertical",children:[e.jsx(I,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx($,{type:"number",className:"text-xs"}),e.jsx(P,{dataKey:"name",type:"category",width:100,className:"text-xs",tick:{fontSize:11}}),e.jsx(K,{formatter:(s,a,n)=>[`${s} (${n.payload.percentage}%)`,t("analytics.views","访问量")],contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(ee,{dataKey:"value",fill:"hsl(var(--chart-2))",radius:[0,4,4,0]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:t("analytics.noData","暂无数据")})}),e.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto",children:i?.countryStats&&i.countryStats.length>0?i.countryStats.slice(0,10).map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{variant:a<3?"default":"secondary",className:"w-6 h-6 p-0 justify-center",children:a+1}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm truncate max-w-[120px]",children:x(s.location)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:s.count}),e.jsxs(q,{variant:"outline",className:"text-xs",children:[s.percentage.toFixed(1),"%"]})]})]},s.location)):e.jsx("p",{className:"text-muted-foreground text-center py-4",children:t("analytics.noData","暂无数据")})})]})})]}),e.jsxs(b,{children:[e.jsx(_,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5"}),t("analytics.cityStats","城市统计")]})}),e.jsx(S,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[200px]",children:B.length>0?e.jsx(R,{width:"100%",height:"100%",children:e.jsxs(Q,{data:B,layout:"vertical",children:[e.jsx(I,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx($,{type:"number",className:"text-xs"}),e.jsx(P,{dataKey:"name",type:"category",width:100,className:"text-xs",tick:{fontSize:11}}),e.jsx(K,{formatter:(s,a,n)=>[`${s} (${n.payload.percentage}%)`,t("analytics.views","访问量")],contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(ee,{dataKey:"value",fill:"hsl(var(--chart-3))",radius:[0,4,4,0]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:t("analytics.noData","暂无数据")})}),e.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto",children:i?.cityStats&&i.cityStats.length>0?i.cityStats.slice(0,10).map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{variant:a<3?"default":"secondary",className:"w-6 h-6 p-0 justify-center",children:a+1}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm truncate max-w-[120px]",children:x(s.location)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:s.count}),e.jsxs(q,{variant:"outline",className:"text-xs",children:[s.percentage.toFixed(1),"%"]})]})]},s.location)):e.jsx("p",{className:"text-muted-foreground text-center py-4",children:t("analytics.noData","暂无数据")})})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(b,{children:[e.jsx(_,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5"}),t("analytics.countryTrend","国家/地区访问趋势")]})}),e.jsx(S,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:T.map((s,a)=>e.jsx(U,{variant:p.includes(s)?"default":"outline",size:"sm",onClick:()=>W(s),className:"text-xs",style:p.includes(s)?{backgroundColor:z[p.indexOf(s)%z.length]}:{},children:x(s)},s))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("analytics.selectLocationsHint","选择最多5个地区查看趋势（点击选择/取消）")}),e.jsx("div",{className:"h-[250px]",children:O.length>0?e.jsx(R,{width:"100%",height:"100%",children:e.jsxs(J,{data:O,children:[e.jsx(I,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx($,{dataKey:"date",tickFormatter:s=>F(new Date(s),"MM/dd"),className:"text-xs"}),e.jsx(P,{className:"text-xs"}),e.jsx(K,{labelFormatter:s=>F(new Date(s),"yyyy-MM-dd"),contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(ne,{}),p.map((s,a)=>e.jsx(Y,{type:"monotone",dataKey:s,stroke:z[a%z.length],strokeWidth:2,name:x(s),dot:!1},s))]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:p.length===0?t("analytics.selectLocations","请选择地区查看趋势"):t("analytics.noData","暂无数据")})})]})})]}),e.jsxs(b,{children:[e.jsx(_,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5"}),t("analytics.cityTrend","城市访问趋势")]})}),e.jsx(S,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map((s,a)=>e.jsx(U,{variant:d.includes(s)?"default":"outline",size:"sm",onClick:()=>G(s),className:"text-xs",style:d.includes(s)?{backgroundColor:z[d.indexOf(s)%z.length]}:{},children:x(s)},s))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("analytics.selectLocationsHint","选择最多5个地区查看趋势（点击选择/取消）")}),e.jsx("div",{className:"h-[250px]",children:u.length>0?e.jsx(R,{width:"100%",height:"100%",children:e.jsxs(J,{data:u,children:[e.jsx(I,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx($,{dataKey:"date",tickFormatter:s=>F(new Date(s),"MM/dd"),className:"text-xs"}),e.jsx(P,{className:"text-xs"}),e.jsx(K,{labelFormatter:s=>F(new Date(s),"yyyy-MM-dd"),contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(ne,{}),d.map((s,a)=>e.jsx(Y,{type:"monotone",dataKey:s,stroke:z[a%z.length],strokeWidth:2,name:x(s),dot:!1},s))]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:d.length===0?t("analytics.selectLocations","请选择地区查看趋势"):t("analytics.noData","暂无数据")})})]})})]})]})]})]})};export{ts as default};
//# sourceMappingURL=AdminAnalytics-i2OUY0qn.js.map
