import{p as O,r as m,j as e,bz as Ne,aM as X,X as me,bY as $e,bi as Le,et as hs,a4 as Z,eu as ps,ak as gs,a_ as ue,bG as be,b1 as Be,aK as fs,ev as xe,al as js,bl as ee,ab as we,be as ye,bJ as Ns,c$ as vs,c9 as bs,cb as ws,aw as He,ay as ys,el as De,b8 as _s,e3 as ks,ce as oe,u as Cs,aO as Ss,bT as Rs,w as K}from"./vendor-react-87iFmKFJ.js";import{h as w,I as Y,B as A,ad as Ge,C as de,m as _e,n as ke,D as Is,c as Ds,d as Ps,e as As,Y as Ts,$ as Ms,A as Pe,q as Ae,r as Te,t as Me,v as ze,w as Ue,x as Ee,y as re}from"./index-BrOhGy48.js";import{P as zs}from"./progress-BadpfeCy.js";import{C as Us,u as Es,R as Fs,P as Os}from"./PublishConfirmStep-B6rYaGg8.js";import{u as $s}from"./useCreateRecipe-BuEYr6mx.js";import{u as Ls}from"./useSavedRecipes-C7aQsABw.js";import{u as Bs}from"./useLoginRequired-Dp0yFRaH.js";import{C as Hs,a as Gs,b as Vs}from"./collapsible-DE4DVYv9.js";import{S as ve}from"./separator-BpIhbv8t.js";import{R as Qs}from"./RecipeCookingMode-C-vJ1lr_.js";import{I as Ws}from"./ImagePreviewModal-BV6JKbFL.js";import"./vendor-i18n-AOdgFpXS.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-utils-vwQGbBim.js";import"./vendor-supabase-CQWbleDe.js";import"./TranslateButton-4661lXfE.js";const ce=5,qs=({onPhotosUploaded:t,onSkipToManual:f,uploadImage:h,isUploading:x,initialImageUrls:N,onRequireLogin:u})=>{const{t:o}=O(),[i,n]=m.useState(()=>N&&N.length>0?N.map((s,c)=>({id:`restored-${c}`,preview:s,url:s,uploading:!1})):[]),[j,d]=m.useState(!1),g=m.useRef(null),y=i.filter(s=>s.uploading).length,S=i.length>0&&i.every(s=>s.url!==null),R=async s=>{if(u&&!u())return;const c=Array.from(s),v=ce-i.length,P=c.slice(0,v).filter(p=>p.size<=10*1024*1024);if(P.length===0)return;const E=P.map(p=>({id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,preview:URL.createObjectURL(p),url:null,uploading:!0}));n(p=>[...p,...E]),await Promise.all(P.map(async(p,b)=>{const $=await h(p,"ai-recipe-ingredients");n($?L=>L.map(U=>U.id===E[b].id?{...U,url:$,uploading:!1}:U):L=>L.filter(U=>U.id!==E[b].id))}))},D=s=>{d(!1),R([s])},I=()=>{u&&!u()||d(!0)},r=s=>{n(c=>c.filter(v=>v.id!==s))},a=()=>{if(u&&!u())return;const s=i.map(c=>c.url).filter(Boolean);s.length>0&&t(s)};return e.jsxs(e.Fragment,{children:[j&&e.jsx(Us,{onCapture:D,onClose:()=>d(!1)}),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-6 py-8",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-primary/10 flex items-center justify-center mx-auto",children:e.jsx(Ne,{className:"h-10 w-10 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold",children:o("aiRecipe.photoTitle","æ‹æ‘„æ‚¨çš„é£Ÿæ")}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-xs",children:o("aiRecipe.photoDescMulti","æ‹ç…§æˆ–ä¸Šä¼ é£Ÿæç…§ç‰‡ï¼ˆæœ€å¤š5å¼ ï¼‰ï¼ŒAI å°†è‡ªåŠ¨è¯†åˆ«é£Ÿæ")})]}),i.length>0&&e.jsxs("div",{className:"w-full max-w-sm grid grid-cols-3 gap-2",children:[i.map(s=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden border bg-muted",children:[e.jsx("img",{src:s.preview,alt:"Preview",className:"w-full h-full object-cover"}),s.uploading&&e.jsx("div",{className:"absolute inset-0 bg-background/60 flex items-center justify-center",children:e.jsx(X,{className:"h-5 w-5 animate-spin text-primary"})}),e.jsx("button",{onClick:()=>r(s.id),className:"absolute top-1 right-1 w-5 h-5 rounded-full bg-black/60 text-white flex items-center justify-center",children:e.jsx(me,{className:"h-3 w-3"})})]},s.id)),i.length<ce&&e.jsxs("button",{onClick:()=>g.current?.click(),className:"aspect-square rounded-lg border-2 border-dashed border-muted-foreground/30 flex flex-col items-center justify-center gap-1 text-muted-foreground hover:border-primary/50 hover:text-primary transition-colors",disabled:y>0,children:[e.jsx($e,{className:"h-5 w-5"}),e.jsxs("span",{className:"text-xs",children:[i.length,"/",ce]})]})]}),i.length===0?e.jsxs("div",{className:"flex gap-3 w-full max-w-sm",children:[e.jsxs(w,{variant:"default",className:"flex-1 gap-2",onClick:I,children:[e.jsx(Ne,{className:"h-4 w-4"}),o("aiRecipe.takePhoto","æ‹ç…§")]}),e.jsxs(w,{variant:"outline",className:"flex-1 gap-2",onClick:()=>g.current?.click(),children:[e.jsx(Le,{className:"h-4 w-4"}),o("aiRecipe.uploadPhoto","ç›¸å†Œ")]})]}):e.jsxs("div",{className:"flex gap-3 w-full max-w-sm",children:[e.jsxs(w,{variant:"outline",className:"flex-1 gap-2",onClick:I,disabled:i.length>=ce||y>0,children:[e.jsx(Ne,{className:"h-4 w-4"}),o("aiRecipe.addMore","ç»§ç»­æ‹ç…§")]}),e.jsx(w,{className:"flex-1 gap-2",onClick:a,disabled:!S||y>0,children:y>0?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-4 w-4 animate-spin"}),o("common.uploading","ä¸Šä¼ ä¸­...")]}):o("aiRecipe.startIdentify","å¼€å§‹è¯†åˆ«")})]}),e.jsxs(w,{variant:"ghost",className:"gap-2 text-muted-foreground",onClick:f,disabled:y>0,children:[e.jsx(hs,{className:"h-4 w-4"}),o("aiRecipe.skipToManual","è·³è¿‡ï¼Œæ‰‹åŠ¨è¾“å…¥é£Ÿæ")]}),e.jsx("input",{ref:g,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:s=>{const c=s.target.files;c?.length&&R(c),s.target.value=""}})]})]})},Js=({ingredients:t,onChange:f})=>{const{t:h}=O(),[x,N]=m.useState(null),[u,o]=m.useState(""),[i,n]=m.useState(""),[j,d]=m.useState(""),[g,y]=m.useState(""),S=r=>{N(r),o(t[r].name),n(t[r].estimated_amount||""),d(t[r].unit||"")},R=()=>{if(x===null||!u.trim())return;const r=[...t];r[x]={...r[x],name:u.trim(),estimated_amount:i.trim(),unit:j.trim()},f(r),N(null)},D=r=>{f(t.filter((a,s)=>s!==r))},I=()=>{g.trim()&&(f([...t,{name:g.trim(),estimated_amount:"",unit:""}]),y(""))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center space-y-1 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:h("aiRecipe.confirmIngredients","ç¡®è®¤é£Ÿæ")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:h("aiRecipe.confirmIngredientsDesc","ç¡®è®¤ AI è¯†åˆ«çš„é£Ÿæï¼Œæ‚¨å¯ä»¥æ·»åŠ ã€ç¼–è¾‘æˆ–åˆ é™¤")})]}),e.jsx("div",{className:"space-y-2",children:t.map((r,a)=>e.jsx("div",{className:"flex items-center gap-2 p-3 rounded-lg border bg-card",children:x===a?e.jsxs(e.Fragment,{children:[e.jsx(Y,{value:u,onChange:s=>o(s.target.value),placeholder:h("aiRecipe.ingredientName","é£Ÿæåç§°"),className:"flex-1 h-8",autoFocus:!0}),e.jsx(Y,{value:i,onChange:s=>n(s.target.value),placeholder:h("aiRecipe.amount","æ•°é‡"),className:"w-16 h-8"}),e.jsx(Y,{value:j,onChange:s=>d(s.target.value),placeholder:h("aiRecipe.unit","å•ä½"),className:"w-14 h-8"}),e.jsx(w,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:R,children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx(w,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>N(null),children:e.jsx(me,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"flex-1 text-sm font-medium",children:r.name}),r.estimated_amount&&e.jsxs(A,{variant:"outline",className:"text-xs",children:[r.estimated_amount,r.unit||""]}),e.jsx(w,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>S(a),children:e.jsx(ps,{className:"h-3.5 w-3.5"})}),e.jsx(w,{size:"icon",variant:"ghost",className:"h-8 w-8 text-destructive",onClick:()=>D(a),children:e.jsx(gs,{className:"h-3.5 w-3.5"})})]})},a))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Y,{value:g,onChange:r=>y(r.target.value),placeholder:h("aiRecipe.addIngredientPlaceholder","æ·»åŠ é£Ÿæ..."),className:"flex-1",onKeyDown:r=>r.key==="Enter"&&I()}),e.jsx(w,{onClick:I,disabled:!g.trim(),size:"icon",children:e.jsx($e,{className:"h-4 w-4"})})]})]})},Fe=[1,2,3,4,6],Ks=[1,2,3,4,5,6],Ys=({onConfirm:t,onSkip:f,initialValues:h})=>{const{t:x}=O(),[N,u]=m.useState(h?.difficulty),[o,i]=m.useState(h?.servings),[n,j]=m.useState(h?.dishCount),[d,g]=m.useState(h?.notes||""),y=h?.servings!=null&&!Fe.includes(h.servings),[S,R]=m.useState(y),[D,I]=m.useState(y?String(h?.servings):""),r=[{value:"easy",label:x("recipe.difficulty.easy","ç®€å•"),desc:x("aiRecipe.diffEasyDesc","é€‚åˆé›¶åŸºç¡€æ–°æ‰‹")},{value:"medium",label:x("recipe.difficulty.medium","ä¸­ç­‰"),desc:x("aiRecipe.diffMediumDesc","æœ‰ä¸€ç‚¹çƒ¹é¥ªç»éªŒ")},{value:"hard",label:x("recipe.difficulty.hard","å›°éš¾"),desc:x("aiRecipe.diffHardDesc","æŒ‘æˆ˜é«˜éš¾åº¦èœè‚´")}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("h3",{className:"text-lg font-semibold",children:x("aiRecipe.preferences","çƒ¹é¥ªåå¥½")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x("aiRecipe.preferencesDesc","è®¾ç½®æ‚¨çš„åå¥½ï¼ŒAI ä¼šæ®æ­¤æ¨èæ›´åˆé€‚çš„èœè°±")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ue,{className:"h-4 w-4"}),x("aiRecipe.preferredDifficulty","æœŸæœ›éš¾åº¦")]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:r.map(a=>e.jsxs("button",{onClick:()=>u(N===a.value?void 0:a.value),className:`p-3 rounded-lg border text-center transition-all ${N===a.value?"border-primary bg-primary/10 ring-1 ring-primary":"hover:border-primary/50"}`,children:[e.jsx("div",{className:"text-sm font-medium",children:a.label}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0.5",children:a.desc})]},a.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(be,{className:"h-4 w-4"}),x("aiRecipe.preferredServings","ç”¨é¤äººæ•°")]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[Fe.map(a=>e.jsxs(A,{variant:o===a&&!S?"default":"outline",className:"cursor-pointer px-4 py-2 text-sm",onClick:()=>{i(a),R(!1),I("")},children:[a," ",x("recipe.servingsUnit","äººä»½")]},a)),e.jsx(A,{variant:S?"default":"outline",className:"cursor-pointer px-4 py-2 text-sm",onClick:()=>{R(!0),i(void 0)},children:x("aiRecipe.customServings","è‡ªå®šä¹‰")})]}),S&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(Y,{type:"number",min:1,max:99,placeholder:x("aiRecipe.enterServings","è¾“å…¥äººæ•°"),value:D,onChange:a=>{I(a.target.value);const s=parseInt(a.target.value);i(s>0?s:void 0)},className:"w-28"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:x("recipe.servingsUnit","äººä»½")})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Be,{className:"h-4 w-4"}),x("aiRecipe.dishCount","èœå“æ•°é‡")]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:x("aiRecipe.dishCountDesc","ä¸æŒ‡å®šæ—¶ AI ä¼šæ ¹æ®äººæ•°å’Œé£Ÿæè‡ªåŠ¨åˆ¤æ–­")}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(A,{variant:n===void 0?"default":"outline",className:"cursor-pointer px-4 py-2 text-sm",onClick:()=>j(void 0),children:x("aiRecipe.autoDecide","è‡ªåŠ¨")}),Ks.map(a=>e.jsxs(A,{variant:n===a?"default":"outline",className:"cursor-pointer px-4 py-2 text-sm",onClick:()=>j(a),children:[a," ",x("aiRecipe.dishUnit","é“èœ")]},a))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(fs,{className:"h-4 w-4"}),x("aiRecipe.cookingNotes","å¤‡æ³¨")]}),e.jsx(Ge,{value:d,onChange:a=>g(a.target.value),placeholder:x("aiRecipe.cookingNotesPlaceholder","å¦‚ï¼šä¸è¦å¤ªè¾£ã€æƒ³åšä¸€æ¡Œå¹´å¤œé¥­ã€åæ¸…æ·¡å£å‘³ç­‰..."),rows:3,className:"resize-none"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsxs(w,{variant:"outline",className:"flex-1 gap-1",onClick:f,children:[e.jsx(xe,{className:"h-4 w-4"}),x("aiRecipe.skipPreferences","è·³è¿‡")]}),e.jsx(w,{className:"flex-1",onClick:()=>t({difficulty:N,servings:o,dishCount:n,notes:d.trim()||void 0}),children:x("aiRecipe.confirmPreferences","ç¡®è®¤å¹¶ç”Ÿæˆ")})]})]})},Xs=({recipes:t,recipeHistory:f=[],onSelectHistoryMeal:h,onConfirmMeal:x,onRegenerate:N,isRegenerating:u,preferences:o})=>{const{t:i,i18n:n}=O(),[j,d]=m.useState(!1),[g,y]=m.useState(o?.notes||""),[S,R]=m.useState(!1),D=s=>n.language==="en"&&s.recipe_name_en?s.recipe_name_en:n.language==="pt"&&s.recipe_name_pt?s.recipe_name_pt:s.recipe_name,I=s=>n.language==="en"&&s.subtitle_en?s.subtitle_en:n.language==="pt"&&s.subtitle_pt?s.subtitle_pt:s.subtitle,r=s=>{switch(s){case"easy":return i("recipe.difficulty.easy","ç®€å•");case"medium":return i("recipe.difficulty.medium","ä¸­ç­‰");case"hard":return i("recipe.difficulty.hard","å›°éš¾");default:return s}},a=t.reduce((s,c)=>s+(c.cook_time||0),0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center space-y-2 mb-4",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-primary/10 rounded-full",children:[e.jsx(Be,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-primary",children:i("aiRecipe.mealPlan","å®Œæ•´èœå•")})]}),e.jsx("h3",{className:"text-lg font-semibold",children:i("aiRecipe.mealPlanTitle","AI ä¸ºæ‚¨è®¾è®¡äº†ä¸€æ¡Œèœ")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i("aiRecipe.mealPlanDesc","å…± {{count}} é“èœï¼Œæ€»è®¡çº¦ {{time}} åˆ†é’Ÿ",{count:t.length,time:a})}),o&&e.jsxs("div",{className:"inline-flex items-start gap-1.5 text-xs text-muted-foreground bg-muted/50 rounded-lg px-3 py-2 mt-1 text-left max-w-sm mx-auto",children:[e.jsx(js,{className:"h-3.5 w-3.5 mt-0.5 shrink-0"}),e.jsx("span",{children:o.dishCount?i("aiRecipe.dishCountExplain","æŒ‰ç…§æ‚¨æŒ‡å®šçš„ {{count}} é“èœç”Ÿæˆ",{count:o.dishCount}):o.notes?i("aiRecipe.dishCountFromNotes","æ ¹æ®æ‚¨çš„å¤‡æ³¨ã€Œ{{notes}}ã€ï¼ŒAI ä¸ºæ‚¨è§„åˆ’äº† {{count}} é“èœ",{notes:o.notes.length>20?o.notes.slice(0,20)+"â€¦":o.notes,count:t.length}):i("aiRecipe.dishCountAuto","AI æ ¹æ® {{servings}} äººä»½çš„é£Ÿæè‡ªåŠ¨è§„åˆ’äº† {{count}} é“èœ",{servings:o.servings||t[0]?.servings||"?",count:t.length})})]})]}),e.jsx("div",{className:"space-y-3",children:t.map((s,c)=>e.jsxs(de,{className:"overflow-hidden",children:[s.image_url?e.jsxs("div",{className:"relative w-full aspect-[16/9] bg-muted",children:[e.jsx("img",{src:s.image_url,alt:D(s),className:"w-full h-full object-cover",loading:"lazy"}),e.jsx(A,{variant:"secondary",className:"absolute top-2 left-2 text-xs font-bold",children:i("aiRecipe.dishNumber","ç¬¬ {{n}} é“",{n:c+1})}),e.jsx(A,{variant:"secondary",className:"absolute bottom-2 right-2 text-[10px] gap-1 opacity-80",children:s.image_source==="ai"?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-2.5 w-2.5"}),i("aiRecipe.imageSourceAI","AI ç”Ÿæˆ")]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"h-2.5 w-2.5"}),i("aiRecipe.imageSourceWeb","æ¥è‡ªç½‘ç»œ")]})})]}):e.jsxs("div",{className:"w-full aspect-[16/9] bg-muted flex items-center justify-center relative",children:[e.jsx(Le,{className:"h-8 w-8 text-muted-foreground/40"}),e.jsx(A,{variant:"secondary",className:"absolute top-2 left-2 text-xs font-bold",children:i("aiRecipe.dishNumber","ç¬¬ {{n}} é“",{n:c+1})})]}),e.jsxs(_e,{className:"pb-2",children:[e.jsx("h4",{className:"font-semibold",children:D(s)}),I(s)&&e.jsx("p",{className:"text-xs text-muted-foreground italic",children:I(s)})]}),e.jsxs(ke,{className:"pt-0",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(A,{variant:"outline",className:"gap-1 text-xs",children:[e.jsx(ye,{className:"h-3 w-3"}),s.cook_time," ",i("recipe.minutes","åˆ†é’Ÿ")]}),e.jsxs(A,{variant:"outline",className:"gap-1 text-xs",children:[e.jsx(ue,{className:"h-3 w-3"}),r(s.difficulty)]}),e.jsxs(A,{variant:"outline",className:"gap-1 text-xs",children:[e.jsx(be,{className:"h-3 w-3"}),s.servings," ",i("recipe.servingsUnit","äººä»½")]})]}),s.missing_ingredients&&s.missing_ingredients.length>0&&e.jsxs("div",{className:"mt-2 flex items-start gap-1.5 text-xs text-destructive",children:[e.jsx(Ns,{className:"h-3.5 w-3.5 mt-0.5 shrink-0"}),e.jsxs("span",{children:[i("aiRecipe.missingIngredients","éœ€è¦é¢å¤–é£Ÿæï¼š"),(()=>{const v=n.language;return(v==="en"?s.missing_ingredients_en||s.missing_ingredients:v==="pt"&&s.missing_ingredients_pt||s.missing_ingredients).join(v==="zh"?"ã€":", ")})()]})]})]})]},c))}),e.jsx("div",{className:"space-y-2",children:j?e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:i("aiRecipe.editNotes","ç¼–è¾‘å¤‡æ³¨ï¼ˆä¿®æ”¹åç‚¹å‡»æ¢ä¸€æ‰¹å³å¯é‡æ–°ç”Ÿæˆï¼‰")}),e.jsx(Ge,{value:g,onChange:s=>y(s.target.value),placeholder:i("aiRecipe.notesPlaceholder","ä¾‹å¦‚ï¼šä¸¤èœä¸€æ±¤ã€æ¸…æ·¡ä¸ºä¸»..."),className:"min-h-[60px] text-sm"}),e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>d(!1),children:i("common.done","å®Œæˆ")})]}):e.jsxs("button",{onClick:()=>d(!0),className:"inline-flex items-center gap-1.5 text-xs text-muted-foreground hover:text-primary transition-colors",children:[e.jsx(vs,{className:"h-3 w-3"}),g?i("aiRecipe.currentNotes","å¤‡æ³¨ï¼š{{notes}}",{notes:g.length>30?g.slice(0,30)+"â€¦":g}):i("aiRecipe.addNotes","æ·»åŠ å¤‡æ³¨ï¼ˆå¦‚ï¼šä¸¤èœä¸€æ±¤ï¼‰")]})}),e.jsxs("div",{className:"flex gap-3 pt-2 sticky bottom-4",children:[N&&e.jsxs(w,{variant:"outline",className:"flex-1 gap-1.5",onClick:()=>N(g||void 0),disabled:u,children:[e.jsx(bs,{className:`h-4 w-4 ${u?"animate-spin":""}`}),u?i("aiRecipe.regenerating","é‡æ–°ç”Ÿæˆä¸­..."):i("aiRecipe.regenerateRecipes","æ¢ä¸€æ‰¹")]}),e.jsxs(w,{className:"flex-1 gap-1.5",onClick:x,children:[e.jsx(Z,{className:"h-4 w-4"}),i("aiRecipe.confirmMeal","ç¡®è®¤èœå•")]})]}),f.length>0&&h&&e.jsxs("div",{className:"border rounded-xl overflow-hidden",children:[e.jsxs("button",{className:"w-full flex items-center justify-between px-4 py-3 text-sm font-medium hover:bg-muted/50 transition-colors",onClick:()=>R(s=>!s),children:[e.jsxs("span",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(ws,{className:"h-4 w-4"}),i("aiRecipe.historyMeals","å†å²èœå•"),e.jsx(A,{variant:"secondary",className:"text-xs",children:f.length})]}),e.jsx(He,{className:`h-4 w-4 text-muted-foreground transition-transform ${S?"rotate-180":""}`})]}),S&&e.jsx("div",{className:"divide-y",children:f.map((s,c)=>e.jsxs("div",{className:"px-4 py-3 space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:i("aiRecipe.historyEntry","ç¬¬ {{n}} æ¬¡ç”Ÿæˆ",{n:f.length-c})}),e.jsxs(w,{size:"sm",variant:"ghost",className:"h-7 text-xs gap-1 text-primary",onClick:()=>{h(s),R(!1)},children:[e.jsx(Z,{className:"h-3 w-3"}),i("aiRecipe.useThisMeal","é€‰è¿™æ¡Œ")]})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.map((v,P)=>e.jsx("span",{className:"text-xs bg-muted rounded-full px-2.5 py-0.5",children:n.language==="en"&&v.recipe_name_en?v.recipe_name_en:n.language==="pt"&&v.recipe_name_pt?v.recipe_name_pt:v.recipe_name},P))})]},c))})]})]})},Zs=({recipes:t})=>{const{t:f,i18n:h}=O(),[x,N]=m.useState(0),u=n=>h.language==="en"&&n.recipe_name_en?n.recipe_name_en:h.language==="pt"&&n.recipe_name_pt?n.recipe_name_pt:n.recipe_name,o=n=>h.language==="en"&&n.subtitle_en?n.subtitle_en:h.language==="pt"&&n.subtitle_pt?n.subtitle_pt:n.subtitle,i=n=>{switch(n){case"easy":return f("recipe.difficulty.easy","ç®€å•");case"medium":return f("recipe.difficulty.medium","ä¸­ç­‰");case"hard":return f("recipe.difficulty.hard","å›°éš¾");default:return n}};return e.jsx("div",{className:"space-y-3",children:t.map((n,j)=>e.jsx(Hs,{open:x===j,onOpenChange:d=>N(d?j:-1),children:e.jsxs(de,{className:"overflow-hidden",children:[n.image_url&&e.jsxs("div",{className:"relative w-full aspect-[16/9] bg-muted",children:[e.jsx("img",{src:n.image_url,alt:u(n),className:"w-full h-full object-cover",loading:"lazy"}),e.jsx("div",{className:"absolute bottom-2 right-2",children:e.jsx("span",{className:"inline-flex items-center gap-1 text-[10px] bg-black/50 text-white px-2 py-0.5 rounded-full",children:n.image_source==="ai"?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-2.5 w-2.5"}),"AI ç”Ÿæˆ"]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"h-2.5 w-2.5"}),"æ¥è‡ªç½‘ç»œ"]})})})]}),e.jsx(Gs,{className:"w-full text-left",children:e.jsxs(_e,{className:"pb-2 flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{variant:"secondary",className:"text-xs shrink-0",children:f("aiRecipe.dishNumber","ç¬¬ {{n}} é“",{n:j+1})}),e.jsx("h4",{className:"font-semibold truncate",children:u(n)})]}),o(n)&&e.jsx("p",{className:"text-xs text-muted-foreground italic mt-1",children:o(n)}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsxs(A,{variant:"outline",className:"gap-1 text-xs",children:[e.jsx(ye,{className:"h-3 w-3"}),n.cook_time,f("recipe.minutes","åˆ†é’Ÿ")]}),e.jsxs(A,{variant:"outline",className:"gap-1 text-xs",children:[e.jsx(ue,{className:"h-3 w-3"}),i(n.difficulty)]})]})]}),x===j?e.jsx(ys,{className:"h-5 w-5 text-muted-foreground shrink-0 ml-2"}):e.jsx(He,{className:"h-5 w-5 text-muted-foreground shrink-0 ml-2"})]})}),e.jsx(Vs,{children:e.jsxs(ke,{className:"pt-0 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-sm mb-2",children:f("recipe.step.ingredients","é…æ–™")}),e.jsx("div",{className:"space-y-1",children:n.ingredients.map((d,g)=>{const y=h.language==="en"&&d.name_en?d.name_en:h.language==="pt"&&d.name_pt?d.name_pt:d.name;return e.jsxs("div",{className:"flex justify-between text-sm py-1 border-b border-dashed last:border-0",children:[e.jsx("span",{children:y}),e.jsxs("span",{className:"text-muted-foreground",children:[d.amount," ",h.language==="en"&&d.unit_en?d.unit_en:h.language==="pt"&&d.unit_pt?d.unit_pt:d.unit]})]},g)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-sm mb-2",children:f("recipe.step.steps","æ­¥éª¤")}),e.jsx("div",{className:"space-y-3",children:n.steps.map((d,g)=>{const y=h.language==="en"&&d.description_en?d.description_en:h.language==="pt"&&d.description_pt?d.description_pt:d.description;return e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center shrink-0 mt-0.5",children:e.jsx("span",{className:"text-xs font-bold text-primary",children:d.order||g+1})}),e.jsx("p",{className:"text-sm leading-relaxed",children:y})]},g)})})]})]})})]})},j))})},et=({recipe:t,ingredientImageUrl:f,onComplete:h,onBack:x,onSkip:N})=>{const{t:u,i18n:o}=O(),[i,n]=m.useState("guided"),[j,d]=m.useState(!1),[g,y]=m.useState(null),S=()=>o.language==="en"&&t.recipe_name_en?t.recipe_name_en:o.language==="pt"&&t.recipe_name_pt?t.recipe_name_pt:t.recipe_name,R=s=>{switch(s){case"easy":return u("recipe.difficulty.easy","ç®€å•");case"medium":return u("recipe.difficulty.medium","ä¸­ç­‰");case"hard":return u("recipe.difficulty.hard","å›°éš¾");default:return s}},D=s=>{switch(s){case"easy":return"bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30";case"medium":return"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30";case"hard":return"bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30";default:return"bg-muted text-muted-foreground"}},I=t.steps.map((s,c)=>({...s,order:s.order||c+1}));if(i==="guided"&&j)return e.jsx(de,{className:"overflow-hidden",children:e.jsx(Qs,{steps:I,onExit:()=>d(!1),onComplete:h})});const r=()=>e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"inline-flex h-9 items-center rounded-md bg-muted p-1 text-muted-foreground",children:[e.jsxs("button",{onClick:()=>{n("guided"),d(!1)},className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 ${i==="guided"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(De,{className:"h-4 w-4"}),u("recipe.guidedMode","æµç¨‹æ¨¡å¼")]}),e.jsxs("button",{onClick:()=>n("full"),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 ${i==="full"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(_s,{className:"h-4 w-4"}),u("recipe.fullMode","å®Œæ•´æ¨¡å¼")]})]})}),a=()=>e.jsxs(de,{className:"overflow-hidden",children:[t.image_url&&e.jsxs("div",{className:"relative w-full aspect-[16/9] bg-muted",children:[e.jsx("img",{src:t.image_url,alt:S(),className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute bottom-2 right-2",children:e.jsx("span",{className:"inline-flex items-center gap-1 text-[10px] bg-black/50 text-white px-2 py-0.5 rounded-full",children:t.image_source==="ai"?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-2.5 w-2.5"}),"AI ç”Ÿæˆ"]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"h-2.5 w-2.5"}),"æ¥è‡ªç½‘ç»œ"]})})})]}),e.jsxs(_e,{className:"pb-3",children:[e.jsx("h2",{className:"text-xl font-bold",children:S()}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[t.cook_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsxs("span",{children:[t.cook_time," ",u("recipe.minutes","åˆ†é’Ÿ")]})]}),t.servings&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsxs("span",{children:[t.servings," ",u("recipe.servingsUnit","äººä»½")]})]}),t.difficulty&&e.jsxs(A,{variant:"outline",className:D(t.difficulty),children:[e.jsx(ue,{className:"h-3 w-3 mr-1"}),R(t.difficulty)]})]})]}),e.jsxs(ke,{className:"space-y-6",children:[(()=>{const s=o.language==="en"&&t.introduction_en?t.introduction_en:o.language==="pt"&&t.introduction_pt?t.introduction_pt:t.introduction;return s&&e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:s})})(),e.jsx(ve,{}),t.ingredients.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[u("recipe.ingredients","é£Ÿæ")," (",t.ingredients.length,")"]}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground font-medium px-2 py-1.5 bg-muted/50 rounded-t-md border border-border/50",children:[e.jsx("span",{className:"flex-1",children:u("recipe.ingredientName","åç§°")}),e.jsx("span",{className:"w-24 text-right",children:u("recipe.amount","ç”¨é‡")})]}),e.jsx("ul",{className:"border border-t-0 border-border/50 rounded-b-md divide-y divide-border/50",children:t.ingredients.map((s,c)=>{const v=o.language==="en"&&s.name_en?s.name_en:o.language==="pt"&&s.name_pt?s.name_pt:s.name;return e.jsxs("li",{className:"flex items-center text-sm px-2 py-2",children:[e.jsx("span",{className:"flex-1 min-w-0 truncate",children:v}),e.jsxs("span",{className:"w-24 text-right text-muted-foreground shrink-0",children:[s.amount," ",o.language==="en"&&s.unit_en?s.unit_en:o.language==="pt"&&s.unit_pt?s.unit_pt:s.unit]})]},c)})})]}),i==="guided"&&e.jsxs(e.Fragment,{children:[e.jsx(ve,{}),e.jsxs(w,{size:"lg",className:"w-full gap-2 h-14 text-lg",onClick:()=>d(!0),children:[e.jsx(De,{className:"h-6 w-6"}),u("recipe.startCooking","å¼€å§‹çƒ¹é¥ª"),e.jsxs(A,{variant:"secondary",className:"ml-2",children:[I.length," ",u("recipe.stepsCount","æ­¥")]})]}),N&&e.jsxs(w,{variant:"ghost",className:"w-full gap-2 text-muted-foreground",onClick:N,children:[e.jsx(xe,{className:"h-4 w-4"}),u("aiRecipe.skipDish","è·³è¿‡è¿™é“èœ")]})]}),i==="full"&&e.jsxs(e.Fragment,{children:[e.jsx(ve,{}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[u("recipe.step.steps","æ­¥éª¤")," (",I.length,")"]}),e.jsx("ol",{className:"space-y-4",children:I.map((s,c)=>{const v=o.language==="en"&&s.description_en?s.description_en:o.language==="pt"&&s.description_pt?s.description_pt:s.description;return e.jsxs("li",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold",children:s.order}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("p",{className:"text-sm",children:v}),(()=>{const P=s.image_urls&&s.image_urls.length>0?s.image_urls:s.image_url?[s.image_url]:[];return P.length>0&&e.jsx("div",{className:`flex gap-2 ${P.length===1?"":"flex-wrap"}`,children:P.map((E,p)=>e.jsx("img",{src:E,alt:`Step ${s.order} - ${p+1}`,className:`rounded-lg max-h-48 object-cover cursor-pointer ${P.length===1?"w-full":"w-[calc(50%-0.25rem)]"}`,onClick:()=>y(E)},p))})})()]})]},c)})})]})]}),i==="full"&&e.jsx(w,{size:"lg",variant:"outline",className:"w-full gap-2",onClick:h,children:u("recipe.completeCooking","å®Œæˆçƒ¹é¥ª")})]})]});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{}),e.jsx(a,{}),e.jsx(Ws,{imageUrl:g||"",isOpen:!!g,onClose:()=>y(null)})]})},st=({recipes:t,ingredientImageUrl:f,onComplete:h,onBack:x})=>{const{t:N,i18n:u}=O(),[o,i]=m.useState(0),[n,j]=m.useState(new Set),[d,g]=m.useState(new Set),y=r=>u.language==="en"&&r.recipe_name_en?r.recipe_name_en:u.language==="pt"&&r.recipe_name_pt?r.recipe_name_pt:r.recipe_name,S=(r,a)=>r.size+a.size===t.length,R=(r,a,s)=>{if(S(r,a)){h(Array.from(a));return}for(let c=s+1;c<t.length;c++)if(!r.has(c)&&!a.has(c)){i(c);return}for(let c=0;c<s;c++)if(!r.has(c)&&!a.has(c)){i(c);return}h(Array.from(a))},D=()=>{const r=new Set(n);r.add(o),j(r),R(r,d,o)},I=()=>{const r=new Set(d);r.add(o),g(r),R(n,r,o)};return n.size+d.size,e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto pb-1 scrollbar-hide",children:t.map((r,a)=>e.jsxs("button",{onClick:()=>i(a),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-all border shrink-0 ${o===a?"bg-primary text-primary-foreground border-primary":n.has(a)?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 border-green-300 dark:border-green-700":d.has(a)?"bg-muted text-muted-foreground/50 border-border line-through":"bg-muted text-muted-foreground border-border hover:border-primary/50"}`,children:[n.has(a)&&e.jsx(Z,{className:"h-3 w-3"}),d.has(a)&&e.jsx(xe,{className:"h-3 w-3"}),y(r)]},a))}),e.jsxs("div",{className:"text-center text-xs text-muted-foreground",children:[N("aiRecipe.cookingProgress","å·²å®Œæˆ {{done}}/{{total}} é“èœ",{done:n.size,total:t.length}),d.size>0&&e.jsxs("span",{className:"ml-1 opacity-60",children:["(",N("aiRecipe.skippedCount","å·²è·³è¿‡ {{n}} é“",{n:d.size}),")"]})]}),e.jsx(et,{recipe:t[o],ingredientImageUrl:f,onComplete:D,onBack:x,onSkip:t.length>1&&!d.has(o)?I:void 0},o)]})},tt=({recipes:t,skippedIndices:f=[],onShare:h,onSkip:x,onSaveRecipe:N,onUnsaveRecipe:u,isSaving:o})=>{const{t:i,i18n:n}=O(),[j,d]=m.useState(new Set(t.map((a,s)=>s).filter(a=>!f.includes(a)))),[g,y]=m.useState(new Map),[S,R]=m.useState(null),D=async(a,s)=>{if(s.stopPropagation(),!!N)if(g.has(a)){const c=g.get(a);if(c&&u){R(a);try{await u(c),y(v=>{const P=new Map(v);return P.delete(a),P})}finally{R(null)}}}else{R(a);try{const c=await N(t[a]);y(v=>new Map(v).set(a,c?.id||"saved"))}finally{R(null)}}},I=a=>n.language==="en"&&a.recipe_name_en?a.recipe_name_en:n.language==="pt"&&a.recipe_name_pt?a.recipe_name_pt:a.recipe_name,r=a=>{const s=new Set(j);s.has(a)?s.delete(a):s.add(a),d(s)};return e.jsxs("div",{className:"flex flex-col items-center gap-5 py-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(ks,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{className:"text-center space-y-1.5",children:[e.jsx("h3",{className:"text-xl font-bold",children:i("aiRecipe.cookingDone","çƒ¹é¥ªå®Œæˆï¼ğŸ‰")}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-xs mx-auto",children:i("aiRecipe.shareSelectDesc","é€‰æ‹©æ‚¨æƒ³è¦åˆ†äº«åˆ°ç¤¾åŒºçš„èœå“ï¼Œæ¯é“èœéœ€è¦æ‹æ‘„æˆå“ç…§ç‰‡")})]}),e.jsx("div",{className:"w-full max-w-sm space-y-2",children:t.map((a,s)=>{const c=f.includes(s),v=g.has(s);return e.jsxs("button",{onClick:()=>!c&&r(s),className:`w-full flex items-center gap-3 p-3 rounded-xl border transition-all text-left ${c?"border-border bg-muted/20 opacity-40 cursor-not-allowed":j.has(s)?"border-primary bg-primary/5 ring-1 ring-primary/20":"border-border bg-muted/30 opacity-60"}`,children:[e.jsx("div",{className:"w-14 h-14 rounded-lg overflow-hidden bg-muted shrink-0",children:a.image_url?e.jsx("img",{src:a.image_url,alt:a.recipe_name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground text-lg",children:"ğŸ½ï¸"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:I(a)}),a.subtitle&&e.jsx("p",{className:"text-xs text-muted-foreground italic truncate mt-0.5",children:a.subtitle}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1",children:[e.jsxs(A,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[a.cook_time,i("recipe.minuteShort","åˆ†é’Ÿ")]}),c&&e.jsx(A,{variant:"outline",className:"text-[10px] px-1.5 py-0 text-muted-foreground",children:i("aiRecipe.skipped","å·²è·³è¿‡")})]})]}),N&&!c&&e.jsx("button",{onClick:P=>D(s,P),disabled:S===s,className:`p-1.5 rounded-lg shrink-0 transition-colors ${v?"text-primary":"text-muted-foreground hover:text-primary hover:bg-primary/10"}`,children:S===s?e.jsx(X,{className:"h-4 w-4 animate-spin"}):e.jsx(oe,{className:`h-4 w-4 ${v?"fill-primary":""}`})}),!c&&e.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center shrink-0 transition-colors ${j.has(s)?"bg-primary border-primary text-primary-foreground":"border-muted-foreground/30"}`,children:j.has(s)&&e.jsx(Z,{className:"h-3.5 w-3.5"})})]},s)})}),e.jsxs("div",{className:"w-full max-w-sm space-y-3",children:[e.jsx(w,{className:"w-full gap-2 h-12",onClick:()=>h(Array.from(j).sort()),disabled:j.size===0,children:j.size>0?i("aiRecipe.shareSelected","åˆ†äº« {{count}} é“èœåˆ°ç¤¾åŒº",{count:j.size}):i("aiRecipe.shareToComm","åˆ†äº«åˆ°ç¤¾åŒº")}),e.jsxs(w,{variant:"outline",className:"w-full gap-2",onClick:x,children:[e.jsx(me,{className:"h-4 w-4"}),i("aiRecipe.noThanks","æš‚æ—¶ä¸åˆ†äº«")]})]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center max-w-xs",children:i("aiRecipe.shareNote","åˆ†äº«éœ€è¦æ‹æ‘„æˆå“ç…§ç‰‡è¿›è¡ŒéªŒè¯ï¼Œä»¥ç¡®ä¿å†…å®¹çœŸå®å¯é ")})]})},Oe=["photo","confirm","preferences","generating","select","detail","cooking","share-prompt","result","publish"],V="ai-recipe-session",at=()=>{try{const t=sessionStorage.getItem(V);if(t)return JSON.parse(t)}catch{}return{}},bt=()=>{const{t}=O(),f=Cs(),x=Ss().state?.from||"/ai-recipe",{requireLogin:N}=Bs(),{identifyIngredients:u,generateRecipes:o,verifyResultPhoto:i,uploadImage:n,isIdentifying:j,isGenerating:d,isVerifying:g}=Es(),[y,S]=m.useState(!1),R=$s(),{saveRecipe:D,deleteRecipe:I,isSaving:r}=Ls(),[a]=m.useState(()=>at()),s=!!(a.step&&a.step!=="photo"&&a.step!=="generating"&&(a.ingredients?.length||a.recipes?.length)),[c,v]=m.useState(s),[P,E]=m.useState(!s),[p,b]=m.useState("photo"),[$,L]=m.useState([]),[U,se]=m.useState([]),[B,te]=m.useState({}),[T,he]=m.useState([]),ae=m.useRef([]),[Ve,Ce]=m.useState([]),[Se,Q]=m.useState(0),[z,ie]=m.useState([]),[H,ne]=m.useState(""),[pe,le]=m.useState(!1),[Re,ge]=m.useState(""),[Qe,We]=m.useState([]),qe=()=>{b(a.step&&a.step!=="generating"?a.step:"photo"),L(a.ingredientImageUrls||[]),se(a.ingredients||[]),te(a.preferences||{});const l=a.recipes||[];ae.current=l,he(l),Q(a.publishingDishIndex||0),ie(a.publishQueue||[]),ne(a.resultImageUrl||""),le(a.photoVerified||!1),E(!0),v(!1)};m.useEffect(()=>{ae.current=T},[T]);const Je=()=>{sessionStorage.removeItem(V),E(!0),v(!1)},Ke=(Oe.indexOf(p)+1)/Oe.length*100;m.useEffect(()=>{if(P)try{const l=T.map(C=>({...C,image_url:C.image_url&&C.image_url.startsWith("data:")?void 0:C.image_url})),k={step:p,ingredientImageUrls:$,ingredients:U,preferences:B,recipes:l,publishingDishIndex:Se,publishQueue:z,resultImageUrl:H,photoVerified:pe};sessionStorage.setItem(V,JSON.stringify(k))}catch(l){console.warn("Session save failed (quota):",l)}},[P,p,$,U,B,T,Se,z,H,pe]),m.useEffect(()=>{window.scrollTo({top:0,behavior:"instant"})},[p]);const _=z.length>0?T[z[0]]:null,fe=z.length>0?1:0,Ye=async l=>{if(!N())return;L(l);const k=[],C=new Set;for(const M of l){const F=await u(M);if(F)for(const G of F)C.has(G.name)||(C.add(G.name),k.push(G))}k.length>0&&(se(k),b("confirm"))},Xe=()=>{N()&&(se([]),b("confirm"))},Ze=()=>{if(U.length===0){K.error(t("aiRecipe.noIngredients","è¯·è‡³å°‘ä¿ç•™ä¸€ç§é£Ÿæ"));return}b("preferences")},es=async l=>{te(l),await je(l)},ss=async()=>{te({}),await je({})},je=async(l,k)=>{b("generating");const C=ae.current.slice(),M=await o(U,l.difficulty,l.servings,l.dishCount,l.notes,k);M&&M.length>0?(C.length>0&&Ce(F=>F.length>0&&F[0].length===C.length&&F[0][0]?.recipe_name===C[0]?.recipe_name?F:[C,...F].slice(0,5)),he(M),b("select")):b("preferences")},ts=()=>{b("detail")},as=async()=>{for(const l of T)await D(l)},is=()=>{b("cooking")},ns=l=>{We(l),b("share-prompt")},[W,q]=m.useState(null),ls=l=>{ie(l),q("share")},J=()=>{sessionStorage.removeItem(V),K.success(t("aiRecipe.cookingComplete","å¤ªæ£’äº†ï¼çƒ¹é¥ªå®Œæˆï¼")),f("/community")},rs=async l=>{for(const k of T)await D(k);q(null),l==="share"?(Q(z[0]||0),b("result")):J()},cs=l=>{q(null),l==="share"?(Q(z[0]||0),b("result")):J()},os=(l,k,C)=>{ne(l),le(k),C&&ge(C),k&&b("publish")},ds=async l=>{if(!(!_||!H))try{await R.mutateAsync({recipe_name:_.recipe_name,recipe_name_en:_.recipe_name_en,recipe_name_pt:_.recipe_name_pt,subtitle:_.subtitle,subtitle_en:_.subtitle_en,subtitle_pt:_.subtitle_pt,cook_time:_.cook_time,difficulty:_.difficulty,servings:_.servings,ingredients:_.ingredients,steps:_.steps.map((C,M)=>({...C,order:M+1})),cover_image:H,introduction:_.introduction||"",introduction_en:_.introduction_en,introduction_pt:_.introduction_pt,cooking_note:l?.trim()||Re||void 0,ai_recipe_source:{source:"ai_recipe",ingredient_images:$,identified_ingredients:U,selected_recipe_index:z[0],all_recipes:T.map(C=>C.recipe_name),result_image:H,photo_verified:pe}});const k=z.slice(1);ie(k),k.length>0?(K.success(t("aiRecipe.dishPublished","ç¬¬ {{n}} é“èœå·²å‘å¸ƒï¼ç»§ç»­ä¸‹ä¸€é“",{n:fe})),Q(k[0]),ne(""),le(!1),ge(""),b("result")):(sessionStorage.removeItem(V),K.success(t("aiRecipe.allPublished","æ‰€æœ‰èœè°±å·²å‘å¸ƒåˆ°ç¤¾åŒºï¼")),f("/community"))}catch{}},Ie=()=>{const l=z.slice(1);ie(l),l.length>0?(Q(l[0]),ne(""),le(!1),ge(""),b("result")):(sessionStorage.removeItem(V),K.success(t("aiRecipe.publishDone","å‘å¸ƒå®Œæˆï¼")),f("/community"))},ms=()=>{switch(p){case"confirm":b("photo");break;case"preferences":b("confirm");break;case"select":b("preferences");break;case"detail":b("select");break;case"cooking":b("detail");break;case"share-prompt":b("cooking");break;case"result":b("share-prompt");break;case"publish":b("result");break;default:f("/ai-recipe",{replace:!0,state:{from:x}});break}},us=()=>{switch(p){case"photo":return t("aiRecipe.stepPhoto","æ‹æ‘„é£Ÿæ");case"confirm":return t("aiRecipe.stepConfirm","ç¡®è®¤é£Ÿæ");case"preferences":return t("aiRecipe.stepPreferences","çƒ¹é¥ªåå¥½");case"generating":return t("aiRecipe.stepGenerating","ç”Ÿæˆèœè°±");case"select":return t("aiRecipe.stepMealPlan","å®Œæ•´èœå•");case"detail":return t("aiRecipe.stepDetail","èœè°±è¯¦æƒ…");case"cooking":return t("aiRecipe.stepCooking","çƒ¹é¥ªä¸­");case"share-prompt":return t("aiRecipe.stepShare","åˆ†äº«");case"result":return _?t("aiRecipe.stepResultDish","æ‹æ‘„æˆå“ ({{n}}/{{total}})",{n:fe,total:z.length+fe-1}):t("aiRecipe.stepResult","æ‹æ‘„æˆå“");case"publish":return t("aiRecipe.stepPublish","å‘å¸ƒ")}},xs=()=>{const l=a.step;return l==="select"||l==="detail"?t("aiRecipe.resumeAtSelect","å·²ç”Ÿæˆèœå•"):l==="cooking"?t("aiRecipe.resumeAtCooking","çƒ¹é¥ªä¸­"):l==="confirm"?t("aiRecipe.resumeAtConfirm","é£Ÿæç¡®è®¤"):l==="preferences"?t("aiRecipe.resumeAtPrefs","çƒ¹é¥ªåå¥½"):l==="share-prompt"||l==="result"||l==="publish"?t("aiRecipe.resumeAtShare","åˆ†äº«/å‘å¸ƒ"):""};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[c?e.jsx(Is,{open:c,onOpenChange:l=>{l||(v(!1),f("/community",{state:{openCreatePost:!0}}))},children:e.jsxs(Ds,{children:[e.jsxs(Ps,{children:[e.jsxs(As,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-primary"}),t("aiRecipe.resumeTitle","æ£€æµ‹åˆ°æœªå®Œæˆçš„é£Ÿè°±")]}),e.jsxs(Ts,{className:"space-y-2",children:[e.jsx("span",{children:t("aiRecipe.resumeDesc","æ‚¨æœ‰ä¸€ä¸ªæœªå®Œæˆçš„ AI é£Ÿè°±æµç¨‹ï¼Œæ˜¯å¦è¦ç»§ç»­ï¼Ÿ")}),a.recipes&&a.recipes.length>0&&e.jsx("span",{className:"block text-xs mt-2 bg-muted rounded-lg px-3 py-2",children:a.recipes.map(l=>l.recipe_name).join("ã€")}),e.jsx("span",{className:"block text-xs text-muted-foreground",children:t("aiRecipe.resumeProgress","è¿›åº¦ï¼š{{step}}",{step:xs()})})]})]}),e.jsxs(Ms,{className:"flex-col sm:flex-row gap-2",children:[e.jsx(w,{variant:"outline",onClick:Je,children:t("aiRecipe.startNew","é‡æ–°å¼€å§‹")}),e.jsx(w,{onClick:qe,children:t("aiRecipe.resumeContinue","ç»§ç»­ä¸Šæ¬¡")})]})]})}):null,!c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 py-3 border-b bg-background shrink-0 sticky top-14 z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("button",{onClick:p==="publish"||p==="share-prompt"?()=>S(!0):ms,className:"p-1 -ml-1 hover:bg-muted rounded-md",children:p==="publish"||p==="share-prompt"?e.jsx(me,{className:"h-5 w-5"}):e.jsx(Rs,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4 text-primary"}),e.jsx("h2",{className:"font-medium",children:us()})]}),e.jsx("div",{className:"w-6"})]}),e.jsx(zs,{value:Ke,className:"h-1"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 max-w-lg mx-auto w-full",children:[p==="photo"&&e.jsx(qs,{onPhotosUploaded:Ye,onSkipToManual:Xe,uploadImage:n,isUploading:j,initialImageUrls:$,onRequireLogin:N}),j&&e.jsxs("div",{className:"flex flex-col items-center gap-3 py-12",children:[e.jsx(X,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("aiRecipe.identifying","AI æ­£åœ¨è¯†åˆ«é£Ÿæ...")})]}),p==="confirm"&&!j&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(Js,{ingredients:U,onChange:se}),e.jsx(w,{className:"w-full",onClick:Ze,children:t("aiRecipe.nextStep","ä¸‹ä¸€æ­¥")})]}),p==="preferences"&&e.jsx(Ys,{onConfirm:es,onSkip:ss,initialValues:B}),p==="generating"&&e.jsxs("div",{className:"flex flex-col items-center gap-3 py-12",children:[e.jsx(X,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("aiRecipe.generatingMeal","AI æ­£åœ¨ä¸ºæ‚¨è®¾è®¡ä¸€æ¡Œèœ...")})]}),p==="select"&&e.jsx(Xs,{recipes:T,recipeHistory:Ve,onSelectHistoryMeal:l=>{const k=ae.current.slice();Ce(C=>{const M=C.filter(G=>G!==l);return k.length===0||M.length>0&&M[0][0]?.recipe_name===k[0]?.recipe_name&&M[0].length===k.length?M:[k,...M].slice(0,5)}),he(l)},onConfirmMeal:ts,onRegenerate:l=>{const k=T.map(M=>M.recipe_name),C={...B,notes:l!==void 0?l:B.notes};te(C),je(C,k)},isRegenerating:d,preferences:B}),p==="detail"&&T.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(Zs,{recipes:T}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(w,{variant:"outline",className:"flex-1",onClick:()=>b("select"),children:t("aiRecipe.changeMeal","æ¢ä¸€æ¡Œ")}),e.jsxs(w,{variant:"outline",className:"gap-1",onClick:as,disabled:r,children:[e.jsx(oe,{className:"h-4 w-4"}),t("aiRecipe.saveAll","å…¨éƒ¨ä¿å­˜")]}),e.jsx(w,{className:"flex-1",onClick:is,children:t("aiRecipe.startCooking","å¼€å§‹çƒ¹é¥ª")})]})]}),p==="cooking"&&T.length>0&&e.jsx(st,{recipes:T,ingredientImageUrl:$[0]||"",onComplete:ns,onBack:()=>b("detail")}),p==="share-prompt"&&T.length>0&&e.jsx("div",{className:"space-y-4",children:e.jsx(tt,{recipes:T,skippedIndices:Qe,onShare:ls,onSkip:()=>q("skip"),onSaveRecipe:D,onUnsaveRecipe:I,isSaving:r})}),e.jsx(Pe,{open:!!W,onOpenChange:l=>!l&&q(null),children:e.jsxs(Ae,{children:[e.jsxs(Te,{children:[e.jsx(Me,{children:t("aiRecipe.saveBeforeTitle","ä¿å­˜é£Ÿè°±ï¼Ÿ")}),e.jsx(ze,{children:t("aiRecipe.saveBeforeDescMeal","æ˜¯å¦å°†è¿™æ¡Œèœçš„æ‰€æœ‰é£Ÿè°±ä¿å­˜åˆ°æ‚¨çš„æ”¶è—ä¸­ï¼Ÿ")})]}),e.jsxs(Ue,{className:"flex-col sm:flex-row gap-2",children:[e.jsx(Ee,{onClick:()=>W&&cs(W),children:t("aiRecipe.noSave","ä¸ä¿å­˜")}),e.jsxs(re,{onClick:()=>W&&rs(W),disabled:r,children:[e.jsx(oe,{className:"h-4 w-4 mr-1"}),t("aiRecipe.saveAllRecipes","ä¿å­˜å…¨éƒ¨é£Ÿè°±")]})]})]})}),p==="result"&&_&&e.jsxs("div",{className:"space-y-4",children:[z.length>0&&e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl border bg-muted/30",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden bg-muted shrink-0",children:_.image_url?e.jsx("img",{src:_.image_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-lg",children:"ğŸ½ï¸"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:_.recipe_name}),_.subtitle&&e.jsx("p",{className:"text-xs text-muted-foreground italic truncate",children:_.subtitle})]}),z.length>1&&e.jsxs(w,{variant:"ghost",size:"sm",className:"text-xs shrink-0",onClick:Ie,children:[e.jsx(xe,{className:"h-3.5 w-3.5 mr-1"}),t("aiRecipe.skipThisDish","è·³è¿‡")]})]}),e.jsx(Fs,{onPhotoVerified:os,uploadImage:n,verifyPhoto:i,recipeName:_.recipe_name,isVerifying:g})]}),p==="publish"&&_&&e.jsx(Os,{resultImageUrl:H,recipeName:_.recipe_name,initialNote:Re,onPublish:ds,onSkip:Ie,isPublishing:R.isPending}),e.jsx(Pe,{open:y,onOpenChange:S,children:e.jsxs(Ae,{children:[e.jsxs(Te,{children:[e.jsx(Me,{children:p==="share-prompt"?t("aiRecipe.exitShareTitle","ç¡®è®¤é€€å‡ºï¼Ÿ"):t("aiRecipe.closeConfirmTitle","ç¡®è®¤ç¦»å¼€ï¼Ÿ")}),e.jsx(ze,{children:p==="share-prompt"?t("aiRecipe.exitShareDesc","æ‚¨è¿˜æ²¡æœ‰ä¿å­˜é£Ÿè°±ï¼Œé€€å‡ºåé£Ÿè°±å°†ä¸¢å¤±ã€‚æ˜¯å¦å…ˆä¿å­˜ï¼Ÿ"):t("aiRecipe.closeConfirmDesc","ç¦»å¼€åå°†æ”¾å¼ƒå‘å¸ƒï¼Œæ‚¨çš„æˆå“ç…§ç‰‡å’Œé£Ÿè°±å°†ä¸ä¼šä¿å­˜åˆ°ç¤¾åŒºã€‚")})]}),e.jsxs(Ue,{className:"flex-col sm:flex-row gap-2",children:[e.jsx(Ee,{children:t("common.cancel","å–æ¶ˆ")}),p==="share-prompt"?e.jsxs(e.Fragment,{children:[e.jsxs(re,{onClick:async()=>{for(const l of T)await D(l);S(!1),J()},disabled:r,children:[e.jsx(oe,{className:"h-4 w-4 mr-1"}),t("aiRecipe.saveAndExit","ä¿å­˜å¹¶é€€å‡º")]}),e.jsx(re,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:()=>{S(!1),J()},children:t("aiRecipe.exitWithoutSave","ä¸ä¿å­˜ï¼Œç›´æ¥é€€å‡º")})]}):e.jsx(re,{onClick:J,children:t("aiRecipe.confirmLeave","ç¡®è®¤ç¦»å¼€")})]})]})})]})]})]})};export{bt as default};
//# sourceMappingURL=AIRecipe-DHz0p3F1.js.map
