import{r as i}from"./vendor-react-87iFmKFJ.js";import{u as l,s as a,g as u}from"./index-C3xfGQgV.js";const s="location_cache",g=()=>{const e="visitor_id";let t=localStorage.getItem(e);return t||(t=u(),localStorage.setItem(e,t)),t},y=()=>{try{const e=sessionStorage.getItem(s);if(e)return JSON.parse(e)}catch{}return null},f=e=>{try{sessionStorage.setItem(s,JSON.stringify(e))}catch{}},d=async()=>{const e=y();if(e)return e;try{const{data:t,error:o}=await a.functions.invoke("get-location");if(o)return console.error("Failed to fetch location:",o),{country:null,city:null,region:null};const r={country:t?.country||null,city:t?.city||null,region:t?.region||null,ip:t?.ip||null};return(r.country||r.city)&&f(r),r}catch(t){return console.error("Failed to fetch location data:",t),{country:null,city:null,region:null}}},_=({pageType:e,targetId:t})=>{const{user:o}=l(),r=i.useRef(!1);i.useEffect(()=>{if(r.current)return;r.current=!0,(async()=>{try{const n=g(),c=await d();await a.from("page_views").insert({page_type:e,target_id:t||null,visitor_id:n,user_id:o?.id||null,user_agent:navigator.userAgent,referer:document.referrer||null,country:c.country,city:c.city,region:c.region})}catch(n){console.error("Failed to track page view:",n)}})()},[e,t,o?.id])};export{_ as u};
//# sourceMappingURL=usePageView-BZdkQiaO.js.map
