import{p as k,r as d,j as e,e9 as J,bh as K,ay as Y,cZ as ee,aw as ae,dB as P,bO as I,ak as O,w as U,bp as F,ab as se,X as te,bQ as le,b4 as ne,br as re}from"./vendor-react-Dd_5Sawp.js";import{U as S,B as c,C as N,q as v,I as f,s as T,f as ie,D as oe,W as ce,c as de,d as me,e as ue,T as he,S as xe,p as ge,F as pe,$ as je,A as fe,a7 as Ne,t as ve,v as be,w as we,x as ye,y as Ce,z as _e,E as De}from"./index-BTawsUvj.js";import{b as Be,c as ze,a as Se,d as Te}from"./useBrands-bDJwP4VY.js";import{T as V,a as W,b as C,c as _}from"./tabs-Bn7q7SHF.js";import{u as Ae}from"./useLocalizedContent-N57tkM8u.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-utils-vwQGbBim.js";import"./vendor-supabase-BnZwaL-Z.js";const Le=()=>Math.random().toString(36).substring(2,9),E={toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}],["link"],["clean"]]},Pe=({blocks:s,onChange:x})=>{const{t:a,i18n:D}=k(),[b,u]=d.useState(null),h=t=>{const r={id:Le(),type:t,...t==="text"?{content_zh:"",content_en:"",content_pt:""}:{url:"",alt:""}};x([...s,r])},g=t=>{x(s.filter(r=>r.id!==t))},l=(t,r)=>{const n=[...s],i=r==="up"?t-1:t+1;i<0||i>=s.length||([n[t],n[i]]=[n[i],n[t]],x(n))},p=(t,r)=>{x(s.map(n=>n.id===t?{...n,...r}:n))},w=async(t,r)=>{if(!r.type.startsWith("image/")){U.error(a("admin.brand.invalidImageType"));return}u(t);try{const n=r.name.split(".").pop(),i=`brand-content-${Date.now()}.${n}`,{error:y}=await T.storage.from("restaurant-images").upload(i,r);if(y)throw y;const{data:{publicUrl:B}}=T.storage.from("restaurant-images").getPublicUrl(i);p(t,{url:B}),U.success(a("admin.brand.imageUploaded"))}catch(n){console.error("Upload error:",n),U.error(n.message||a("admin.brand.uploadError"))}finally{u(null)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(S,{children:a("admin.brand.contentBlocks")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{type:"button",variant:"outline",size:"sm",onClick:()=>h("text"),children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),a("admin.brand.addText")]}),e.jsxs(c,{type:"button",variant:"outline",size:"sm",onClick:()=>h("image"),children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),a("admin.brand.addImage")]})]})]}),s.length===0&&e.jsx(N,{className:"border-dashed",children:e.jsxs(v,{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{children:a("admin.brand.noBlocks")}),e.jsx("p",{className:"text-sm mt-1",children:a("admin.brand.addBlockHint")})]})}),e.jsx("div",{className:"space-y-3",children:s.map((t,r)=>e.jsx(N,{className:"relative",children:e.jsx(v,{className:"pt-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-1 pt-2",children:[e.jsx(c,{type:"button",variant:"ghost",size:"icon",className:"h-6 w-6",disabled:r===0,onClick:()=>l(r,"up"),children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex items-center justify-center h-6 w-6 text-muted-foreground",children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsx(c,{type:"button",variant:"ghost",size:"icon",className:"h-6 w-6",disabled:r===s.length-1,onClick:()=>l(r,"down"),children:e.jsx(ae,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex-1 min-w-0",children:t.type==="text"?e.jsxs(V,{defaultValue:"zh",className:"w-full",children:[e.jsxs(W,{className:"mb-2",children:[e.jsx(C,{value:"zh",children:a("admin.chinese")}),e.jsx(C,{value:"en",children:a("admin.english")}),e.jsx(C,{value:"pt",children:a("admin.portuguese")})]}),e.jsx(_,{value:"zh",children:e.jsx(P,{theme:"snow",value:t.content_zh||"",onChange:n=>p(t.id,{content_zh:n}),modules:E,placeholder:a("admin.brand.textPlaceholder")})}),e.jsx(_,{value:"en",children:e.jsx(P,{theme:"snow",value:t.content_en||"",onChange:n=>p(t.id,{content_en:n}),modules:E,placeholder:a("admin.brand.textPlaceholder")})}),e.jsx(_,{value:"pt",children:e.jsx(P,{theme:"snow",value:t.content_pt||"",onChange:n=>p(t.id,{content_pt:n}),modules:E,placeholder:a("admin.brand.textPlaceholder")})})]}):e.jsxs("div",{className:"space-y-3",children:[t.url?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t.url,alt:t.alt||"",className:"w-full max-h-48 object-contain rounded-lg bg-muted"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center rounded-lg",children:e.jsxs("label",{className:"cursor-pointer",children:[e.jsx(f,{type:"file",accept:"image/*",className:"hidden",onChange:n=>{const i=n.target.files?.[0];i&&w(t.id,i)}}),e.jsx(c,{type:"button",variant:"secondary",size:"sm",children:a("common.replace")})]})})]}):e.jsxs("label",{className:"cursor-pointer",children:[e.jsx(f,{type:"file",accept:"image/*",className:"hidden",onChange:n=>{const i=n.target.files?.[0];i&&w(t.id,i)}}),e.jsx("div",{className:"border-2 border-dashed rounded-lg p-8 text-center hover:border-primary transition-colors",children:b===t.id?e.jsxs("div",{className:"animate-pulse text-muted-foreground",children:[a("common.uploading"),"..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-8 w-8 mx-auto text-muted-foreground mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a("admin.brand.clickToUpload")})]})})]}),e.jsx(f,{placeholder:a("admin.brand.imageAlt"),value:t.alt||"",onChange:n=>p(t.id,{alt:n.target.value})})]})}),e.jsx(c,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>g(t.id),children:e.jsx(O,{className:"h-4 w-4"})})]})})},t.id))})]})};function Q({brand:s,trigger:x}){const{t:a}=k(),{toast:D}=ie(),b=Be(),u=ze(),[h,g]=d.useState(!1),[l,p]=d.useState(!1),[w,t]=d.useState(s?.name||""),[r,n]=d.useState(s?.name_en||""),[i,y]=d.useState(s?.name_pt||""),[B,A]=d.useState([]),[$,L]=d.useState(null),[H,z]=d.useState(s?.logo_url||null);d.useEffect(()=>{if(h&&s){t(s.name||""),n(s.name_en||""),y(s.name_pt||""),z(s.logo_url||null);const o=s.content_blocks||[];A(o)}else h&&!s&&(t(""),n(""),y(""),z(null),L(null),A([]))},[h,s]);const G=o=>{const m=o.target.files?.[0];if(m){L(m);const j=new FileReader;j.onloadend=()=>{z(j.result)},j.readAsDataURL(m)}},X=async(o,m)=>{const j=o.name.split(".").pop(),q=`${m}_${Math.random()}.${j}`,{error:M}=await T.storage.from("restaurant-images").upload(q,o);if(M)throw M;const{data:{publicUrl:Z}}=T.storage.from("restaurant-images").getPublicUrl(q);return Z},R=async o=>{if(o.preventDefault(),!w.trim()){D({title:a("common.error"),description:a("admin.brand.nameRequired"),variant:"destructive"});return}p(!0);try{let m=s?.logo_url||null;$&&(m=await X($,"brand_logo"));const j={name:w,name_en:r||null,name_pt:i||null,logo_url:m,content_blocks:B};s?await u.mutateAsync({id:s.id,...j}):await b.mutateAsync(j),g(!1)}catch(m){D({title:a("common.error"),description:m.message,variant:"destructive"})}finally{p(!1)}};return e.jsxs(oe,{open:h,onOpenChange:g,children:[e.jsx(ce,{asChild:!0,children:x}),e.jsxs(de,{className:"max-w-[95vw] sm:max-w-4xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[e.jsxs(me,{className:"px-6 pt-6 pb-4 border-b bg-muted/30",children:[e.jsxs(ue,{className:"text-2xl flex items-center gap-2",children:[e.jsx(F,{className:"w-6 h-6 text-primary"}),a(s?"admin.brand.edit":"admin.brand.create")]}),e.jsx(he,{className:"text-base",children:a(s?"admin.brand.editDesc":"admin.brand.createDesc")})]}),e.jsx(xe,{className:"px-6 h-[calc(95vh-220px)]",children:e.jsxs("form",{onSubmit:R,className:"space-y-6 py-6",children:[e.jsx(N,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:e.jsxs(v,{className:"p-6",children:[e.jsxs(S,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(se,{className:"w-5 h-5 text-primary"}),a("admin.brand.name")]}),e.jsxs(V,{defaultValue:"zh",className:"w-full",children:[e.jsxs(W,{className:"grid w-full grid-cols-3",children:[e.jsx(C,{value:"zh",children:a("admin.chinese")}),e.jsx(C,{value:"en",children:a("admin.english")}),e.jsx(C,{value:"pt",children:a("admin.portuguese")})]}),e.jsx(_,{value:"zh",className:"mt-4",children:e.jsx(f,{value:w,onChange:o=>t(o.target.value),placeholder:a("admin.brand.namePlaceholder")})}),e.jsx(_,{value:"en",className:"mt-4",children:e.jsx(f,{value:r,onChange:o=>n(o.target.value),placeholder:a("admin.brand.namePlaceholderEn")})}),e.jsx(_,{value:"pt",className:"mt-4",children:e.jsx(f,{value:i,onChange:o=>y(o.target.value),placeholder:a("admin.brand.namePlaceholderPt")})})]})]})}),e.jsx(N,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:e.jsxs(v,{className:"p-6",children:[e.jsxs(S,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(I,{className:"w-5 h-5 text-primary"}),a("admin.brand.logo")]}),e.jsxs("div",{className:"flex items-center gap-4",children:[H&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:H,alt:"Logo Preview",className:"w-24 h-24 object-contain rounded-lg shadow-lg ring-2 ring-primary/20 bg-muted"}),e.jsx(c,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{L(null),z(null)},children:e.jsx(te,{className:"h-3 w-3"})})]}),e.jsxs(S,{htmlFor:"logo-upload",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2 px-6 py-4 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[e.jsx(I,{className:"h-6 w-6 text-primary"}),e.jsx("p",{className:"font-medium text-xs",children:a("admin.uploadImage")})]}),e.jsx(f,{id:"logo-upload",type:"file",accept:"image/*",className:"hidden",onChange:G})]})]})]})}),e.jsx(N,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:e.jsx(v,{className:"p-6",children:e.jsx(Pe,{blocks:B,onChange:A})})})]})}),e.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t bg-muted/30",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>g(!1),children:a("common.cancel")}),e.jsx(c,{onClick:R,disabled:l,children:a(l?"common.saving":s?"common.save":"common.create")})]})]})]})}const Me=()=>{const{t:s}=k(),{data:x,isLoading:a}=Se(),D=Te(),{getLocalizedField:b}=Ae(),[u,h]=d.useState(""),g=x?.filter(l=>l.name.toLowerCase().includes(u.toLowerCase())||l.name_en?.toLowerCase().includes(u.toLowerCase())||l.name_pt?.toLowerCase().includes(u.toLowerCase()));return a?e.jsx("div",{className:"text-center",children:s("common.loading")}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:s("admin.brand.title")}),e.jsx("p",{className:"text-muted-foreground",children:s("admin.brand.subtitle")})]}),e.jsx(Q,{trigger:e.jsxs(c,{children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),s("admin.brand.create")]})})]}),e.jsx(N,{children:e.jsx(v,{className:"pt-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(f,{placeholder:s("admin.brand.search"),value:u,onChange:l=>h(l.target.value),className:"pl-9"})]})})}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:g?.map(l=>e.jsxs(N,{className:"overflow-hidden",children:[l.image_url&&e.jsx("div",{className:"aspect-video overflow-hidden",children:e.jsx("img",{src:l.image_url,alt:l.name,className:"w-full h-full object-cover"})}),e.jsx(ge,{className:"pb-2",children:e.jsx("div",{className:"flex items-start justify-between gap-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[l.logo_url?e.jsx("img",{src:l.logo_url,alt:`${l.name} logo`,className:"w-10 h-10 object-contain rounded-lg bg-muted p-1"}):e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(F,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx(pe,{className:"text-lg",children:b(l,"name")}),e.jsx(je,{className:"text-xs",children:l.name!==l.name_en&&l.name_en&&e.jsx("span",{className:"mr-2",children:l.name_en})})]})]})})}),e.jsxs(v,{className:"pt-0",children:[(l.intro_zh||l.intro_en||l.intro_pt)&&e.jsx("div",{className:`text-sm text-muted-foreground line-clamp-2 mb-4 prose prose-sm max-w-none\r
                    [&_p]:m-0 [&_*]:text-muted-foreground`,dangerouslySetInnerHTML:{__html:b(l,"intro")||""}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Q,{brand:l,trigger:e.jsxs(c,{variant:"outline",size:"sm",className:"flex-1",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),s("common.edit")]})}),e.jsxs(fe,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx(c,{variant:"outline",size:"sm",children:e.jsx(O,{className:"h-4 w-4"})})}),e.jsxs(ve,{children:[e.jsxs(be,{children:[e.jsx(we,{children:s("admin.brand.deleteConfirm")}),e.jsx(ye,{children:s("admin.brand.deleteWarning")})]}),e.jsxs(Ce,{children:[e.jsx(_e,{children:s("common.cancel")}),e.jsx(De,{onClick:()=>D.mutate(l.id),children:s("common.delete")})]})]})]})]})]})]},l.id))}),g?.length===0&&e.jsx(N,{children:e.jsxs(v,{className:"py-12 text-center",children:[e.jsx(F,{className:"mx-auto h-12 w-12 text-muted-foreground/50 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:s("admin.brand.empty")})]})})]})};export{Me as default};
//# sourceMappingURL=AdminBrands-CK5KSTYy.js.map
