import{j as e,p as X,aW as L,u as ye,q as ke,r as n,bb as Ce,bc as Re,aX as Ae,X as D,bd as Te,a$ as Se,a_ as ze,y as De,be as Le,L as Me,b0 as Pe}from"./vendor-react-C7F4V4j9.js";import{C as G,j as l,p as U,q as J,r as Y,A as _e,t as Fe,v as $e,w as qe,x as Ee,y as Be,z as Ie,E as Ve,f as We,u as Qe,I as Oe,B as i,g as w,s as He}from"./index-BgP4kwZT.js";import{P as Z,a as ee,b as se}from"./popover-CaDYrdFL.js";import{u as Ke,b as Xe,a as Ge,c as Ue}from"./useRestaurants-m4gzxDml.js";import{c as Je,o as Ye,g as Ze}from"./geolocation-DRm3QMsJ.js";import{u as es,R as ss,l as as}from"./xiaoxiong-logo-clean-Bh8Yycs0.js";import{u as ts}from"./useLocalizedContent-3klwqvfj.js";import{f as ls}from"./timeUtils-pgRxO0UB.js";import{u as rs}from"./useActivities-u-__FM0F.js";import{u as ns}from"./useInfiniteScroll-C8BeFBxs.js";import{L as is}from"./LocationPermissionDialog-LAxMUquE.js";import{P as os}from"./PullToRefresh-c_6IG858.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-utils-Z4kpnli5.js";import"./vendor-supabase-FBUBU9il.js";import"./vendor-map-CvE3ASYw.js";const cs=({count:u=6})=>e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:u}).map((h,a)=>e.jsxs(G,{className:"overflow-hidden flex flex-col h-full",style:{animationDelay:`${a*100}ms`},children:[e.jsxs("div",{className:"relative h-48 overflow-hidden",children:[e.jsx(l,{className:"w-full h-full rounded-none"}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx(l,{className:"h-9 w-9 rounded-md"})})]}),e.jsx(U,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(l,{className:"h-6 w-40"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(l,{className:"h-4 w-4 rounded-full"}),e.jsx(l,{className:"h-4 w-16"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(l,{className:"h-5 w-5 rounded-full"}),e.jsx(l,{className:"h-5 w-8"})]})]})}),e.jsxs(J,{className:"space-y-3 flex-grow",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(l,{className:"h-5 w-16 rounded-full"}),e.jsx(l,{className:"h-5 w-20 rounded-full"}),e.jsx(l,{className:"h-5 w-14 rounded-full"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{className:"h-4 w-4 rounded-full flex-shrink-0"}),e.jsx(l,{className:"h-4 w-full"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{className:"h-4 w-4 rounded-full flex-shrink-0"}),e.jsx(l,{className:"h-4 w-32"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{className:"h-4 w-4 rounded-full flex-shrink-0"}),e.jsx(l,{className:"h-4 w-40"})]})]}),e.jsxs(Y,{className:"gap-2 mt-auto",children:[e.jsx(l,{className:"h-10 flex-1 rounded-md"}),e.jsx(l,{className:"h-10 w-10 rounded-md"})]})]},a))}),ds=()=>e.jsxs("div",{className:"relative flex-1 min-h-[300px] sm:min-h-[400px] lg:mx-4 lg:mb-4 lg:rounded-lg overflow-hidden lg:shadow-lg bg-muted",children:[e.jsx(l,{className:"absolute inset-0 w-full h-full rounded-none"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:e.jsx(l,{className:"h-8 w-8 rounded-full"})}),e.jsx("div",{className:"absolute top-1/4 left-1/3",children:e.jsx(l,{className:"h-6 w-6 rounded-full"})}),e.jsx("div",{className:"absolute top-1/3 right-1/4",children:e.jsx(l,{className:"h-6 w-6 rounded-full"})}),e.jsx("div",{className:"absolute bottom-1/3 left-1/4",children:e.jsx(l,{className:"h-6 w-6 rounded-full"})}),e.jsx("div",{className:"absolute bottom-1/4 right-1/3",children:e.jsx(l,{className:"h-6 w-6 rounded-full"})})]})}),e.jsx("div",{className:"absolute bottom-4 left-4 z-10",children:e.jsx(l,{className:"h-10 w-36 rounded-full"})}),e.jsxs("div",{className:"absolute top-4 right-4 z-10 flex flex-col gap-2",children:[e.jsx(l,{className:"h-8 w-8 rounded-md"}),e.jsx(l,{className:"h-8 w-8 rounded-md"})]})]}),ms=()=>{const u=/iPad|iPhone|iPod/.test(navigator.userAgent),h=/Android/.test(navigator.userAgent);return u?"Apple Maps":"Google Maps"},xs=({open:u,onOpenChange:h,onConfirm:a,destinationName:f})=>{const{t:g}=X(),k=ms();return e.jsx(_e,{open:u,onOpenChange:h,children:e.jsxs(Fe,{className:"max-w-md",children:[e.jsxs($e,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-full bg-primary/10",children:e.jsx(L,{className:"w-5 h-5 text-primary"})}),e.jsx(qe,{children:g("navigation.confirmTitle")})]}),e.jsx(Ee,{className:"text-left",children:g("navigation.confirmDescription",{appName:k,destination:f})})]}),e.jsxs(Be,{className:"flex-col sm:flex-row gap-2",children:[e.jsx(Ie,{className:"w-full sm:w-auto",children:g("common.cancel")}),e.jsx(Ve,{onClick:a,className:"w-full sm:w-auto",children:g("navigation.openApp",{appName:k})})]})]})})},us=({restaurant:u,language:h})=>{const[a,f]=n.useState(999),g=n.useRef(null),N=u.type.map((t,j)=>({key:`type-${j}`,label:t,variant:"secondary",color:void 0}));n.useEffect(()=>{const t=()=>{if(!g.current)return;const T=g.current,o=Array.from(T.querySelectorAll(".tag-badge"));if(o.length===0){setTimeout(t,50);return}const d=o[0]?.offsetTop;let v=o.length;for(let p=0;p<o.length;p++)if(o[p].offsetTop>d){v=p;break}if(v===o.length){f(o.length);return}const m=T.offsetWidth,R=40;let x=0,S=v;for(let p=0;p<v;p++)x+=o[p].offsetWidth+8;x+R>m&&(S=Math.max(1,v-1)),f(S)};f(999);const j=setTimeout(t,100);return window.addEventListener("resize",t),()=>{clearTimeout(j),window.removeEventListener("resize",t)}},[N.length,u.id]);const M=N.slice(0,a),c=N.slice(a),C=c.length>0;return e.jsxs("div",{className:"flex items-center gap-2 -mt-1",children:[e.jsx("div",{ref:g,className:"flex gap-2 flex-wrap flex-1",children:M.map(t=>e.jsx(w,{variant:t.variant,className:"text-xs whitespace-nowrap tag-badge",style:t.color?{backgroundColor:t.color,color:"white"}:void 0,children:t.label},t.key))}),C&&e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"sm",className:"h-6 px-2 text-muted-foreground hover:text-foreground flex-shrink-0",children:e.jsx(Pe,{className:"h-4 w-4"})})}),e.jsx(se,{className:"w-auto max-w-80",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(t=>e.jsx(w,{variant:t.variant,className:"text-xs",style:t.color?{backgroundColor:t.color,color:"white"}:void 0,children:t.label},t.key))})})]})]})},Ds=()=>{const u=ye(),h=ke(),{t:a,i18n:f}=X(),{toast:g}=We(),{localizeRestaurant:k}=ts(),[N,M]=n.useState(""),[c,C]=n.useState([]),[t,j]=n.useState(null),[T,o]=n.useState([]),[d,v]=n.useState("list"),[m,R]=n.useState(null),[x,S]=n.useState(null),[p,ae]=n.useState(!1),[P,te]=n.useState(!1),[_,le]=n.useState(!1),[re,F]=n.useState(!1),[ne,$]=n.useState(!1),[A,ie]=n.useState(null),{user:E}=Qe(),{data:B,isLoading:oe}=Ke(N,c.length>0?c.join(","):void 0),{data:ce=[]}=Xe(),{data:q=[]}=Ge(),{data:de=[]}=rs(),{data:me={}}=es(),xe=n.useCallback(async()=>{await Promise.all([h.invalidateQueries({queryKey:["restaurants"]}),h.invalidateQueries({queryKey:["activities"]}),h.invalidateQueries({queryKey:["restaurantTypes"]})])},[h]),z=de.filter(s=>(me[s.id]||0)>0),ue=Ue(),he=(s,r)=>{r.preventDefault(),r.stopPropagation(),E&&ue.mutate(s)},fe=s=>{C(r=>r.includes(s)?r.filter(y=>y!==s):[...r,s])},ge=()=>{$(!0)},I=async()=>{$(!1);try{const s=await Ze();S({lat:s.coords.latitude,lng:s.coords.longitude}),ae(!0),g({title:a("restaurants.locationEnabled"),description:a("restaurants.sortByDistance")})}catch(s){console.error("Location error:",s)}},pe=s=>{R(s),s&&!x&&I()},je=async s=>{if(t===s)j(null),o([]);else{j(s);const{data:r,error:y}=await He.from("activity_restaurants").select("restaurant_id").eq("activity_id",s);y?(console.error("Error fetching activity restaurants:",y),o([])):o(r.map(be=>be.restaurant_id))}},V=B?.map(s=>{const r=k(s);if(x){const y=Je(x.lat,x.lng,s.lat,s.lng);return{...r,distance:y}}return r})||[],W=t?V.filter(s=>T.includes(s.id)):V,Q=m&&x?W.filter(s=>s.distance&&s.distance<=m):W,b=x?[...Q].sort((s,r)=>(s.distance||0)-(r.distance||0)):[...Q].sort((s,r)=>(r.rating||0)-(s.rating||0)),{displayedData:O,hasMore:ve,loadMore:Ne,reset:H}=ns({data:b,initialItemsPerPage:12,incrementPerPage:12});n.useEffect(()=>{H()},[N,c,t,m,p,H]);const we=s=>{u(`/restaurant/${s.id}`)},K=e.jsx("div",{className:`bg-secondary/20 animate-fade-in ${d==="map"?"h-screen flex flex-col overflow-hidden":"min-h-screen py-8 px-4"}`,children:e.jsxs("div",{className:`${d==="map"?"flex flex-col h-full":"container mx-auto max-w-7xl"}`,children:[e.jsxs("div",{className:`${d==="map"?"px-4 pt-4 pb-2 flex-shrink-0":"mb-8"}`,children:[e.jsx("h1",{className:`text-3xl sm:text-4xl font-medium text-primary ${d==="map"?"hidden md:block md:mb-4":"mb-4"}`,children:a("restaurants.title")}),e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 md:items-center",children:[e.jsx(Oe,{placeholder:a("restaurants.search"),value:N,onChange:s=>M(s.target.value),className:"w-full md:max-w-md"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(i,{variant:x?"default":"outline",onClick:ge,title:a("restaurants.getLocation"),className:"flex-shrink-0",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),a("restaurants.getLocation")]}),e.jsx(i,{variant:d==="list"?"default":"outline",size:"icon",onClick:()=>v("list"),title:a("restaurants.listView"),className:"flex-shrink-0",children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsx(i,{variant:d==="map"?"default":"outline",size:"icon",onClick:()=>v("map"),title:a("restaurants.mapView"),className:"flex-shrink-0",children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsxs(i,{variant:c.length>0||t||m?"default":"outline",size:"icon",className:"flex-shrink-0 relative",title:a("restaurants.filter"),children:[e.jsx(Ae,{className:"w-4 h-4"}),(c.length>0||t||m)&&e.jsx(w,{variant:"secondary",className:"absolute -top-1 -right-1 h-5 w-5 p-0 flex items-center justify-center text-xs",children:(c.length>0?1:0)+(t?1:0)+(m?1:0)})]})}),e.jsx(se,{className:"w-[90vw] max-w-sm p-0",align:"start",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border/50 bg-muted/30",children:[e.jsx("span",{className:"font-semibold text-foreground text-base",children:a("restaurants.filter")}),(c.length>0||t||m)&&e.jsxs(i,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>{C([]),j(null),o([]),R(null)},children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),a("common.actions.clearFilter")]})]}),e.jsxs("div",{className:"p-4 space-y-5",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:a("restaurants.restaurantTypes")}),e.jsxs("div",{className:"flex items-center gap-2",children:[c.length>0&&e.jsxs(i,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>C([]),children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),a("common.actions.clear")]}),q.length>8&&e.jsx(i,{variant:"link",size:"sm",className:"h-auto p-0 text-xs text-primary hover:text-primary/80",onClick:()=>te(!P),children:a(P?"common.showLess":"common.showMore")})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap max-h-36 overflow-y-auto pr-1",children:(P?q:q.slice(0,8)).map(s=>e.jsx(w,{variant:c.includes(s)?"default":"outline",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs font-normal whitespace-nowrap hover:bg-primary/10 ${c.includes(s)?"bg-primary text-primary-foreground shadow-sm":"bg-background hover:border-primary/50"}`,onClick:()=>fe(s),children:s},s))})]}),z.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:a("nav.activities")}),e.jsxs("div",{className:"flex items-center gap-2",children:[t&&e.jsxs(i,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>{j(null),o([])},children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),a("common.actions.clear")]}),z.length>8&&e.jsx(i,{variant:"link",size:"sm",className:"h-auto p-0 text-xs text-primary hover:text-primary/80",onClick:()=>le(!_),children:a(_?"common.showLess":"common.showMore")})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap max-h-36 overflow-y-auto pr-1",children:(_?z:z.slice(0,8)).map(s=>{const r=f.language==="zh"?s.badge_text_zh||s.title_zh:f.language==="pt"?s.badge_text_pt||s.title_pt:s.badge_text_en||s.title_en;return e.jsx(w,{variant:t===s.id?"default":"outline",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs font-normal whitespace-nowrap hover:bg-primary/10 ${t===s.id?"bg-primary text-primary-foreground shadow-sm":"bg-background hover:border-primary/50"}`,onClick:()=>je(s.id),children:r},s.id)})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:a("restaurants.radius")}),m&&e.jsxs(i,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>R(null),children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),a("common.actions.clear")]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:[{value:null,label:a("restaurants.allRestaurants")},{value:5,label:a("restaurants.radius5km")},{value:10,label:a("restaurants.radius10km")},{value:20,label:a("restaurants.radius20km")}].map(s=>e.jsx(w,{variant:m===s.value?"default":"outline",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs font-normal whitespace-nowrap hover:bg-primary/10 ${m===s.value?"bg-primary text-primary-foreground shadow-sm":"bg-background hover:border-primary/50"}`,onClick:()=>pe(s.value),children:s.label},s.value??"all"))})]})]})]})})]})]})]})})]}),oe||!B?d==="map"?e.jsx(ds,{}):e.jsx(cs,{count:6}):b.length===0?e.jsxs("div",{className:`text-center ${d==="map"?"flex-1 flex flex-col justify-center px-4":"py-20"}`,children:[e.jsx("p",{className:"text-xl text-muted-foreground",children:a("restaurants.noResults")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:a("restaurants.noResultsDesc")})]}):e.jsxs(e.Fragment,{children:[d==="map"&&b.length>0&&e.jsxs("div",{className:"relative flex-1 min-h-[300px] sm:min-h-[400px] lg:mx-4 lg:mb-4 lg:rounded-lg overflow-hidden lg:shadow-lg",children:[e.jsx(ss,{restaurants:b,onRestaurantClick:we,userLocation:x,radiusFilter:m,showViewDetailsButton:!0}),e.jsxs("div",{className:"absolute bottom-4 left-4 z-10 pointer-events-none flex items-center gap-2 bg-background/80 backdrop-blur-sm px-3 py-2 rounded-full shadow-lg",children:[e.jsx("img",{src:as,alt:"Xiaoxiong Market Logo",className:"h-6 w-6 object-contain"}),e.jsx("span",{className:"text-sm font-semibold text-foreground whitespace-nowrap",children:f.language==="zh"?"小熊市场":"Xiaoxiong Market"})]})]}),d==="list"&&b.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:O.map(s=>e.jsxs(G,{className:"overflow-hidden hover:shadow-large transition-shadow flex flex-col h-full",children:[e.jsxs("div",{className:"relative h-48 overflow-hidden",children:[e.jsx("img",{src:s.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=600&q=80",alt:s.name,className:"w-full h-full object-cover transition-transform hover:scale-105"}),E&&e.jsx(i,{size:"icon",variant:"secondary",className:"absolute top-3 right-3",onClick:r=>he(s.id,r),children:e.jsx(Te,{className:`w-5 h-5 ${ce.includes(s.id)?"fill-destructive text-destructive":""}`})})]}),e.jsx(U,{className:"mb-px pb-[15px]",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"text-xl font-semibold text-card-foreground",children:s.name}),s.distance!==void 0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"font-semibold text-sm text-foreground",children:[s.distance.toFixed(1)," km"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Se,{className:`w-5 h-5 ${s.rating?"fill-accent text-accent":"text-muted-foreground"}`}),s.rating?e.jsx("span",{className:"font-semibold text-card-foreground",children:s.rating.toFixed(1)}):e.jsxs("span",{className:"text-xs text-muted-foreground text-center whitespace-nowrap",children:[a("restaurant.noRatingLine1"),e.jsx("br",{}),a("restaurant.noRatingLine2")]})]})]})}),e.jsxs(J,{className:"space-y-2 flex-grow",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(us,{restaurant:s,language:f.language}),s.template==="ghost"&&e.jsx(w,{variant:"outline",className:"text-xs",children:a("restaurants.ghostKitchen")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[e.jsx(ze,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:s.address})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[e.jsx(De,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:s.phone})]}),s.opening_hours&&e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[e.jsx(Le,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:ls(s.opening_hours)})]})]}),e.jsxs(Y,{className:"gap-2 mt-auto",children:[e.jsx(i,{asChild:!0,className:"flex-1",children:e.jsx(Me,{to:`/restaurant/${s.id}`,children:a("restaurants.viewDetails")})}),x&&e.jsx(i,{variant:"outline",size:"icon",onClick:()=>{ie({lat:s.lat,lng:s.lng,name:s.name}),F(!0)},title:a("restaurants.directions"),children:e.jsx(L,{className:"w-4 h-4"})})]})]},s.id))}),ve&&e.jsx("div",{className:"flex justify-center mt-8",children:e.jsxs(i,{onClick:Ne,size:"lg",variant:"outline",children:[a("common.loadMore")," (",O.length," / ",b.length,")"]})})]})]}),e.jsx(xs,{open:re,onOpenChange:F,onConfirm:()=>{A&&Ye(A.lat,A.lng,A.name),F(!1)},destinationName:A?.name||""}),e.jsx(is,{open:ne,onOpenChange:$,onConfirm:I})]})});return d==="list"?e.jsx(os,{onRefresh:xe,children:K}):K};export{Ds as default};
//# sourceMappingURL=Restaurants-BKEaOd7K.js.map
