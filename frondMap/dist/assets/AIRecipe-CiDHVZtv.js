import{p as H,r as d,j as e,bA as Se,aM as X,X as Ne,bY as Qe,b4 as ks,ev as Ss,a4 as re,ew as Rs,ak as Cs,a$ as ve,bG as Ce,b2 as qe,aK as Is,al as Ds,bn as q,ab as Ie,bh as De,bJ as Ps,c$ as As,c9 as Ts,cb as Us,aw as Xe,ay as zs,el as Fe,bc as Ms,cw as Es,ex as Pe,e3 as Fs,ce as fe,u as Os,aO as Vs,bT as $s,w as ie}from"./vendor-react-DImbKuZP.js";import{u as Ye}from"./useRecipeVideo-CWGjMCP6.js";import{A as Oe}from"./AnimatedLoadingText-MyZIogK1.js";import{q as _,J as ne,B as A,ae as Ze,C as je,S as Ls,E as Ae,F as Te,D as Bs,c as Gs,d as Hs,e as Ws,Z as Ks,a0 as Js,A as Ve,f as $e,h as Le,i as Be,j as Ge,k as He,l as We,m as he}from"./index-_G3CuCzp.js";import{P as Qs}from"./progress-Bi_ViBYA.js";import{C as qs,u as Xs,R as Ys,P as Zs}from"./PublishConfirmStep-CGHgxQDO.js";import{u as et}from"./useCreateRecipe-D3-oJXV2.js";import{u as st}from"./useSavedRecipes-BgAf4HJl.js";import{u as tt}from"./useLoginRequired-DynG1Vvm.js";import{C as at,a as it,b as nt}from"./collapsible-dyuDlGDF.js";import{S as Re}from"./separator-8wE-3N0K.js";import{R as rt}from"./RecipeCookingMode-B5DymqUo.js";import{I as lt}from"./ImagePreviewModal-CyiB2E01.js";import{u as ct}from"./useWatermarkedVideo-V-xLJRQT.js";import{l as ot}from"./xiaoxiong-logo-clean-D2n3VLi4.js";import"./vendor-i18n-AOdgFpXS.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-utils-vwQGbBim.js";import"./vendor-supabase-CRxszhSs.js";import"./TranslateButton-P5tJRjUf.js";const ge=5,dt=({onPhotosUploaded:s,onSkipToManual:j,uploadImage:x,isUploading:h,initialImageUrls:b,onRequireLogin:m})=>{const{t:o}=H(),[u,a]=d.useState(()=>b&&b.length>0?b.map((n,i)=>({id:`restored-${i}`,preview:n,url:n,uploading:!1})):[]),[g,c]=d.useState(!1),y=d.useRef(null),f=u.filter(n=>n.uploading).length,T=u.length>0&&u.every(n=>n.url!==null),I=async n=>{if(m&&!m())return;const i=Array.from(n),C=ge-u.length,D=i.slice(0,C).filter(F=>F.size<=10*1024*1024);if(D.length===0)return;const B=D.map(F=>({id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,preview:URL.createObjectURL(F),url:null,uploading:!0}));a(F=>[...F,...B]),await Promise.all(D.map(async(F,k)=>{const J=await x(F,"ai-recipe-ingredients");a(J?V=>V.map(L=>L.id===B[k].id?{...L,url:J,uploading:!1}:L):V=>V.filter(L=>L.id!==B[k].id))}))},U=n=>{c(!1),I([n])},P=()=>{m&&!m()||c(!0)},l=n=>{a(i=>i.filter(C=>C.id!==n))},t=()=>{if(m&&!m())return;const n=u.map(i=>i.url).filter(Boolean);n.length>0&&s(n)};return e.jsxs(e.Fragment,{children:[g&&e.jsx(qs,{onCapture:U,onClose:()=>c(!1)}),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-6 py-8",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-primary/10 flex items-center justify-center mx-auto",children:e.jsx(Se,{className:"h-10 w-10 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold",children:o("aiRecipe.photoTitle","æ‹æ‘„æ‚¨çš„é£Ÿæ")}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-xs",children:o("aiRecipe.photoDescMulti","æ‹ç…§æˆ–ä¸Šä¼ é£Ÿæç…§ç‰‡ï¼ˆæœ€å¤š5å¼ ï¼‰ï¼ŒAI å°†è‡ªåŠ¨è¯†åˆ«é£Ÿæ")})]}),u.length>0&&e.jsxs("div",{className:"w-full max-w-sm grid grid-cols-3 gap-2",children:[u.map(n=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden border bg-muted",children:[e.jsx("img",{src:n.preview,alt:"Preview",className:"w-full h-full object-cover"}),n.uploading&&e.jsx("div",{className:"absolute inset-0 bg-background/60 flex items-center justify-center",children:e.jsx(X,{className:"h-5 w-5 animate-spin text-primary"})}),e.jsx("button",{onClick:()=>l(n.id),className:"absolute top-1 right-1 w-5 h-5 rounded-full bg-black/60 text-white flex items-center justify-center",children:e.jsx(Ne,{className:"h-3 w-3"})})]},n.id)),u.length<ge&&e.jsxs("button",{onClick:()=>y.current?.click(),className:"aspect-square rounded-lg border-2 border-dashed border-muted-foreground/30 flex flex-col items-center justify-center gap-1 text-muted-foreground hover:border-primary/50 hover:text-primary transition-colors",disabled:f>0,children:[e.jsx(Qe,{className:"h-5 w-5"}),e.jsxs("span",{className:"text-xs",children:[u.length,"/",ge]})]})]}),u.length===0?e.jsxs("div",{className:"flex gap-3 w-full max-w-sm",children:[e.jsxs(_,{variant:"default",className:"flex-1 gap-2",onClick:P,children:[e.jsx(Se,{className:"h-4 w-4"}),o("aiRecipe.takePhoto","æ‹ç…§")]}),e.jsxs(_,{variant:"outline",className:"flex-1 gap-2",onClick:()=>y.current?.click(),children:[e.jsx(ks,{className:"h-4 w-4"}),o("aiRecipe.uploadPhoto","ç›¸å†Œ")]})]}):e.jsxs("div",{className:"flex gap-3 w-full max-w-sm",children:[e.jsxs(_,{variant:"outline",className:"flex-1 gap-2",onClick:P,disabled:u.length>=ge||f>0,children:[e.jsx(Se,{className:"h-4 w-4"}),o("aiRecipe.addMore","ç»§ç»­æ‹ç…§")]}),e.jsx(_,{className:"flex-1 gap-2",onClick:t,disabled:!T||f>0,children:f>0?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-4 w-4 animate-spin"}),o("common.uploading","ä¸Šä¼ ä¸­...")]}):o("aiRecipe.startIdentify","å¼€å§‹è¯†åˆ«")})]}),e.jsxs(_,{variant:"ghost",className:"gap-2 text-muted-foreground",onClick:j,disabled:f>0,children:[e.jsx(Ss,{className:"h-4 w-4"}),o("aiRecipe.skipToManual","è·³è¿‡ï¼Œæ‰‹åŠ¨è¾“å…¥é£Ÿæ")]}),e.jsx("input",{ref:y,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:n=>{const i=n.target.files;i?.length&&I(i),n.target.value=""}})]})]})},mt=({ingredients:s,onChange:j})=>{const{t:x}=H(),[h,b]=d.useState(null),[m,o]=d.useState(""),[u,a]=d.useState(""),[g,c]=d.useState(""),[y,f]=d.useState(""),T=l=>{b(l),o(s[l].name),a(s[l].estimated_amount||""),c(s[l].unit||"")},I=()=>{if(h===null||!m.trim())return;const l=[...s];l[h]={...l[h],name:m.trim(),estimated_amount:u.trim(),unit:g.trim()},j(l),b(null)},U=l=>{j(s.filter((t,n)=>n!==l))},P=()=>{if(!y.trim())return;const l=y.split(/[ï¼Œ,\s]+/).map(t=>t.trim()).filter(Boolean);l.length!==0&&(j([...s,...l.map(t=>({name:t,estimated_amount:"",unit:""}))]),f(""))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center space-y-1 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:x("aiRecipe.confirmIngredients","ç¡®è®¤é£Ÿæ")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x("aiRecipe.confirmIngredientsDesc","ç¡®è®¤ AI è¯†åˆ«çš„é£Ÿæï¼Œæ‚¨å¯ä»¥æ·»åŠ ã€ç¼–è¾‘æˆ–åˆ é™¤")})]}),e.jsx("div",{className:"space-y-2",children:s.map((l,t)=>e.jsx("div",{className:"flex items-center gap-2 p-3 rounded-lg border bg-card",children:h===t?e.jsxs(e.Fragment,{children:[e.jsx(ne,{value:m,onChange:n=>o(n.target.value),placeholder:x("aiRecipe.ingredientName","é£Ÿæåç§°"),className:"flex-1 h-8",autoFocus:!0}),e.jsx(ne,{value:u,onChange:n=>a(n.target.value),placeholder:x("aiRecipe.amount","æ•°é‡"),className:"w-16 h-8"}),e.jsx(ne,{value:g,onChange:n=>c(n.target.value),placeholder:x("aiRecipe.unit","å•ä½"),className:"w-14 h-8"}),e.jsx(_,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:I,children:e.jsx(re,{className:"h-4 w-4"})}),e.jsx(_,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>b(null),children:e.jsx(Ne,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"flex-1 text-sm font-medium",children:l.name}),l.estimated_amount&&e.jsxs(A,{variant:"outline",className:"text-xs",children:[l.estimated_amount,l.unit||""]}),e.jsx(_,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>T(t),children:e.jsx(Rs,{className:"h-3.5 w-3.5"})}),e.jsx(_,{size:"icon",variant:"ghost",className:"h-8 w-8 text-destructive",onClick:()=>U(t),children:e.jsx(Cs,{className:"h-3.5 w-3.5"})})]})},t))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ne,{value:y,onChange:l=>f(l.target.value),placeholder:x("aiRecipe.addIngredientPlaceholder","æ·»åŠ é£Ÿæ..."),className:"flex-1",onKeyDown:l=>l.key==="Enter"&&P()}),e.jsx(_,{onClick:P,disabled:!y.trim(),size:"icon",children:e.jsx(Qe,{className:"h-4 w-4"})})]})]})},Ke=[1,2,3,4,6],ut=[1,2,3,4,5,6],pt=({onConfirm:s,onSkip:j,initialValues:x})=>{const{t:h}=H(),[b,m]=d.useState(x?.difficulty),[o,u]=d.useState(x?.servings??2),[a,g]=d.useState(x?.dishCount),[c,y]=d.useState(x?.notes||""),f=x?.servings!=null&&!Ke.includes(x.servings),[T,I]=d.useState(f),[U,P]=d.useState(f?String(x?.servings):""),l=[{value:"easy",label:h("recipe.difficulty.easy","ç®€å•"),desc:h("aiRecipe.diffEasyDesc","é€‚åˆé›¶åŸºç¡€æ–°æ‰‹")},{value:"medium",label:h("recipe.difficulty.medium","ä¸­ç­‰"),desc:h("aiRecipe.diffMediumDesc","æœ‰ä¸€ç‚¹çƒ¹é¥ªç»éªŒ")},{value:"hard",label:h("recipe.difficulty.hard","å›°éš¾"),desc:h("aiRecipe.diffHardDesc","æŒ‘æˆ˜é«˜éš¾åº¦èœè‚´")}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("h3",{className:"text-lg font-semibold",children:h("aiRecipe.preferences","çƒ¹é¥ªåå¥½")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:h("aiRecipe.preferencesDesc","è®¾ç½®æ‚¨çš„åå¥½ï¼ŒAI ä¼šæ®æ­¤æ¨èæ›´åˆé€‚çš„èœè°±")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ve,{className:"h-4 w-4"}),h("aiRecipe.preferredDifficulty","æœŸæœ›éš¾åº¦")]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:l.map(t=>e.jsxs("button",{onClick:()=>m(b===t.value?void 0:t.value),className:`p-3 rounded-lg border text-center transition-all ${b===t.value?"border-primary bg-primary/10 ring-1 ring-primary":"hover:border-primary/50"}`,children:[e.jsx("div",{className:"text-sm font-medium",children:t.label}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0.5",children:t.desc})]},t.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Ce,{className:"h-4 w-4"}),h("aiRecipe.preferredServings","ç”¨é¤äººæ•°")]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[Ke.map(t=>e.jsxs(A,{variant:o===t&&!T?"default":"outline",className:"cursor-pointer px-4 py-2 text-sm",onClick:()=>{u(t),I(!1),P("")},children:[t," ",h("recipe.servingsUnit","äººä»½")]},t)),e.jsx(A,{variant:T?"default":"outline",className:"cursor-pointer px-4 py-2 text-sm",onClick:()=>{I(!0),u(void 0)},children:h("aiRecipe.customServings","è‡ªå®šä¹‰")})]}),T&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(ne,{type:"number",min:1,max:99,placeholder:h("aiRecipe.enterServings","è¾“å…¥äººæ•°"),value:U,onChange:t=>{P(t.target.value);const n=parseInt(t.target.value);u(n>0?n:void 0)},className:"w-28"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:h("recipe.servingsUnit","äººä»½")})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(qe,{className:"h-4 w-4"}),h("aiRecipe.dishCount","èœå“æ•°é‡")]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:h("aiRecipe.dishCountDesc","ä¸æŒ‡å®šæ—¶ AI ä¼šæ ¹æ®äººæ•°å’Œé£Ÿæè‡ªåŠ¨åˆ¤æ–­")}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(A,{variant:a===void 0?"default":"outline",className:"cursor-pointer px-4 py-2 text-sm",onClick:()=>g(void 0),children:h("aiRecipe.autoDecide","è‡ªåŠ¨")}),ut.map(t=>e.jsxs(A,{variant:a===t?"default":"outline",className:"cursor-pointer px-4 py-2 text-sm",onClick:()=>g(t),children:[t," ",h("aiRecipe.dishUnit","é“èœ")]},t))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Is,{className:"h-4 w-4"}),h("aiRecipe.cookingNotes","å¤‡æ³¨")]}),e.jsx(Ze,{value:c,onChange:t=>y(t.target.value),placeholder:h("aiRecipe.cookingNotesPlaceholder","å¦‚ï¼šä¸è¦å¤ªè¾£ã€æƒ³åšä¸€æ¡Œå¹´å¤œé¥­ã€åæ¸…æ·¡å£å‘³ç­‰..."),rows:3,className:"resize-none"})]}),e.jsx("div",{className:"flex gap-3 pt-2",children:e.jsx(_,{className:"flex-1",onClick:()=>s({difficulty:b,servings:o,dishCount:a,notes:c.trim()||void 0}),children:h("aiRecipe.confirmPreferences","å¼€å§‹ç”Ÿæˆèœè°±")})})]})},xt=({recipes:s,recipeHistory:j=[],onSelectHistoryMeal:x,onConfirmMeal:h,onRegenerate:b,isRegenerating:m,preferences:o,isLoadingImages:u})=>{const{t:a,i18n:g}=H(),[c,y]=d.useState(!1),[f,T]=d.useState(o?.notes||""),[I,U]=d.useState(!1),P=i=>g.language==="en"&&i.recipe_name_en?i.recipe_name_en:g.language==="pt"&&i.recipe_name_pt?i.recipe_name_pt:i.recipe_name,l=i=>g.language==="en"&&i.subtitle_en?i.subtitle_en:g.language==="pt"&&i.subtitle_pt?i.subtitle_pt:i.subtitle,t=i=>{switch(i){case"easy":return a("recipe.difficulty.easy","ç®€å•");case"medium":return a("recipe.difficulty.medium","ä¸­ç­‰");case"hard":return a("recipe.difficulty.hard","å›°éš¾");default:return i}},n=s.reduce((i,C)=>i+(C.cook_time||0),0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center space-y-2 mb-4",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-primary/10 rounded-full",children:[e.jsx(qe,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-primary",children:a("aiRecipe.mealPlan","å®Œæ•´èœå•")})]}),e.jsx("h3",{className:"text-lg font-semibold",children:a("aiRecipe.mealPlanTitle","AI ä¸ºæ‚¨è®¾è®¡äº†ä¸€æ¡Œèœ")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a("aiRecipe.mealPlanDesc","å…± {{count}} é“èœï¼Œæ€»è®¡çº¦ {{time}} åˆ†é’Ÿ",{count:s.length,time:n})}),o&&e.jsxs("div",{className:"inline-flex items-start gap-1.5 text-xs text-muted-foreground bg-muted/50 rounded-lg px-3 py-2 mt-1 text-left max-w-sm mx-auto",children:[e.jsx(Ds,{className:"h-3.5 w-3.5 mt-0.5 shrink-0"}),e.jsx("span",{children:o.dishCount?a("aiRecipe.dishCountExplain","æŒ‰ç…§æ‚¨æŒ‡å®šçš„ {{count}} é“èœç”Ÿæˆ",{count:o.dishCount}):o.notes?a("aiRecipe.dishCountFromNotes","æ ¹æ®æ‚¨çš„å¤‡æ³¨ã€Œ{{notes}}ã€ï¼ŒAI ä¸ºæ‚¨è§„åˆ’äº† {{count}} é“èœ",{notes:o.notes.length>20?o.notes.slice(0,20)+"â€¦":o.notes,count:s.length}):a("aiRecipe.dishCountAuto","AI æ ¹æ® {{servings}} äººä»½çš„é£Ÿæè‡ªåŠ¨è§„åˆ’äº† {{count}} é“èœ",{servings:o.servings||s[0]?.servings||"?",count:s.length})})]})]}),e.jsx("div",{className:"space-y-3",children:s.map((i,C)=>e.jsxs(je,{className:"overflow-hidden",children:[i.image_url?e.jsxs("div",{className:"relative w-full aspect-[16/9] bg-muted",children:[e.jsx("img",{src:i.image_url,alt:P(i),className:"w-full h-full object-cover",loading:"lazy"}),e.jsx(A,{variant:"secondary",className:"absolute top-2 left-2 text-xs font-bold",children:a("aiRecipe.dishNumber","ç¬¬ {{n}} é“",{n:C+1})}),e.jsx(A,{variant:"secondary",className:"absolute bottom-2 right-2 text-[10px] gap-1 opacity-80",children:i.image_source==="ai"?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-2.5 w-2.5"}),a("aiRecipe.imageSourceAI","AI ç”Ÿæˆ")]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"h-2.5 w-2.5"}),a("aiRecipe.imageSourceWeb","æ¥è‡ªç½‘ç»œ")]})})]}):e.jsxs("div",{className:"relative w-full aspect-[16/9] overflow-hidden bg-muted",children:[u?e.jsxs(e.Fragment,{children:[e.jsx(Ls,{className:"absolute inset-0 w-full h-full rounded-none"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-1.5 z-10",children:[e.jsx(q,{className:"h-5 w-5 text-primary animate-pulse"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a("aiRecipe.generatingImage","AI æ­£åœ¨ç”Ÿæˆå›¾ç‰‡...")})]})]}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(q,{className:"h-8 w-8 text-muted-foreground/30"})}),e.jsx(A,{variant:"secondary",className:"absolute top-2 left-2 text-xs font-bold z-20",children:a("aiRecipe.dishNumber","ç¬¬ {{n}} é“",{n:C+1})})]}),e.jsxs(Ae,{className:"pb-2",children:[e.jsx("h4",{className:"font-semibold",children:P(i)}),l(i)&&e.jsx("p",{className:"text-xs text-muted-foreground italic",children:l(i)})]}),e.jsxs(Te,{className:"pt-0",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(A,{variant:"outline",className:"gap-1 text-xs",children:[e.jsx(De,{className:"h-3 w-3"}),i.cook_time," ",a("recipe.minutes","åˆ†é’Ÿ")]}),e.jsxs(A,{variant:"outline",className:"gap-1 text-xs",children:[e.jsx(ve,{className:"h-3 w-3"}),t(i.difficulty)]}),e.jsxs(A,{variant:"outline",className:"gap-1 text-xs",children:[e.jsx(Ce,{className:"h-3 w-3"}),i.servings," ",a("recipe.servingsUnit","äººä»½")]})]}),i.missing_ingredients&&i.missing_ingredients.length>0&&e.jsxs("div",{className:"mt-2 flex items-start gap-1.5 text-xs text-destructive",children:[e.jsx(Ps,{className:"h-3.5 w-3.5 mt-0.5 shrink-0"}),e.jsxs("span",{children:[a("aiRecipe.missingIngredients","éœ€è¦é¢å¤–é£Ÿæï¼š"),(()=>{const D=g.language;return(D==="en"?i.missing_ingredients_en||i.missing_ingredients:D==="pt"&&i.missing_ingredients_pt||i.missing_ingredients).join(D==="zh"?"ã€":", ")})()]})]})]})]},C))}),e.jsx("div",{className:"space-y-2",children:c?e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:a("aiRecipe.editNotes","ç¼–è¾‘å¤‡æ³¨ï¼ˆä¿®æ”¹åç‚¹å‡»æ¢ä¸€æ‰¹å³å¯é‡æ–°ç”Ÿæˆï¼‰")}),e.jsx(Ze,{value:f,onChange:i=>T(i.target.value),placeholder:a("aiRecipe.notesPlaceholder","ä¾‹å¦‚ï¼šä¸¤èœä¸€æ±¤ã€æ¸…æ·¡ä¸ºä¸»..."),className:"min-h-[60px] text-sm"}),e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>y(!1),children:a("common.done","å®Œæˆ")})]}):e.jsxs("button",{onClick:()=>y(!0),className:"inline-flex items-center gap-1.5 text-xs text-muted-foreground hover:text-primary transition-colors",children:[e.jsx(As,{className:"h-3 w-3"}),f?a("aiRecipe.currentNotes","å¤‡æ³¨ï¼š{{notes}}",{notes:f.length>30?f.slice(0,30)+"â€¦":f}):a("aiRecipe.addNotes","æ·»åŠ å¤‡æ³¨ï¼ˆå¦‚ï¼šä¸¤èœä¸€æ±¤ï¼‰")]})}),e.jsxs("div",{className:"flex gap-3 pt-2 sticky bottom-4",children:[b&&e.jsxs(_,{variant:"outline",className:"flex-1 gap-1.5",onClick:()=>b(f||void 0),disabled:m,children:[e.jsx(Ts,{className:`h-4 w-4 ${m?"animate-spin":""}`}),m?a("aiRecipe.regenerating","é‡æ–°ç”Ÿæˆä¸­..."):a("aiRecipe.regenerateRecipes","æ¢ä¸€æ‰¹")]}),e.jsxs(_,{className:"flex-1 gap-1.5",onClick:h,children:[e.jsx(re,{className:"h-4 w-4"}),a("aiRecipe.confirmMeal","ç¡®è®¤èœå•")]})]}),j.length>0&&x&&e.jsxs("div",{className:"border rounded-xl overflow-hidden",children:[e.jsxs("button",{className:"w-full flex items-center justify-between px-4 py-3 text-sm font-medium hover:bg-muted/50 transition-colors",onClick:()=>U(i=>!i),children:[e.jsxs("span",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Us,{className:"h-4 w-4"}),a("aiRecipe.historyMeals","å†å²èœå•"),e.jsx(A,{variant:"secondary",className:"text-xs",children:j.length})]}),e.jsx(Xe,{className:`h-4 w-4 text-muted-foreground transition-transform ${I?"rotate-180":""}`})]}),I&&e.jsx("div",{className:"divide-y",children:j.map((i,C)=>e.jsxs("div",{className:"px-4 py-3 space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:a("aiRecipe.historyEntry","ç¬¬ {{n}} æ¬¡ç”Ÿæˆ",{n:j.length-C})}),e.jsxs(_,{size:"sm",variant:"ghost",className:"h-7 text-xs gap-1 text-primary",onClick:()=>{x(i),U(!1)},children:[e.jsx(re,{className:"h-3 w-3"}),a("aiRecipe.useThisMeal","é€‰è¿™æ¡Œ")]})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:i.map((D,B)=>e.jsx("span",{className:"text-xs bg-muted rounded-full px-2.5 py-0.5",children:g.language==="en"&&D.recipe_name_en?D.recipe_name_en:g.language==="pt"&&D.recipe_name_pt?D.recipe_name_pt:D.recipe_name},B))})]},C))})]})]})},ht=({recipes:s})=>{const{t:j,i18n:x}=H(),[h,b]=d.useState(0),m=a=>x.language==="en"&&a.recipe_name_en?a.recipe_name_en:x.language==="pt"&&a.recipe_name_pt?a.recipe_name_pt:a.recipe_name,o=a=>x.language==="en"&&a.subtitle_en?a.subtitle_en:x.language==="pt"&&a.subtitle_pt?a.subtitle_pt:a.subtitle,u=a=>{switch(a){case"easy":return j("recipe.difficulty.easy","ç®€å•");case"medium":return j("recipe.difficulty.medium","ä¸­ç­‰");case"hard":return j("recipe.difficulty.hard","å›°éš¾");default:return a}};return e.jsx("div",{className:"space-y-3",children:s.map((a,g)=>e.jsx(at,{open:h===g,onOpenChange:c=>b(c?g:-1),children:e.jsxs(je,{className:"overflow-hidden",children:[a.image_url&&e.jsxs("div",{className:"relative w-full aspect-[16/9] bg-muted",children:[e.jsx("img",{src:a.image_url,alt:m(a),className:"w-full h-full object-cover",loading:"lazy"}),e.jsx("div",{className:"absolute bottom-2 right-2",children:e.jsx("span",{className:"inline-flex items-center gap-1 text-[10px] bg-black/50 text-white px-2 py-0.5 rounded-full",children:a.image_source==="ai"?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-2.5 w-2.5"}),"AI ç”Ÿæˆ"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"h-2.5 w-2.5"}),"æ¥è‡ªç½‘ç»œ"]})})})]}),e.jsx(it,{className:"w-full text-left",children:e.jsxs(Ae,{className:"pb-2 flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{variant:"secondary",className:"text-xs shrink-0",children:j("aiRecipe.dishNumber","ç¬¬ {{n}} é“",{n:g+1})}),e.jsx("h4",{className:"font-semibold truncate",children:m(a)})]}),o(a)&&e.jsx("p",{className:"text-xs text-muted-foreground italic mt-1",children:o(a)}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsxs(A,{variant:"outline",className:"gap-1 text-xs",children:[e.jsx(De,{className:"h-3 w-3"}),a.cook_time,j("recipe.minutes","åˆ†é’Ÿ")]}),e.jsxs(A,{variant:"outline",className:"gap-1 text-xs",children:[e.jsx(ve,{className:"h-3 w-3"}),u(a.difficulty)]})]})]}),h===g?e.jsx(zs,{className:"h-5 w-5 text-muted-foreground shrink-0 ml-2"}):e.jsx(Xe,{className:"h-5 w-5 text-muted-foreground shrink-0 ml-2"})]})}),e.jsx(nt,{children:e.jsxs(Te,{className:"pt-0 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-sm mb-2",children:j("recipe.step.ingredients","é…æ–™")}),e.jsx("div",{className:"space-y-1",children:a.ingredients.map((c,y)=>{const f=x.language==="en"&&c.name_en?c.name_en:x.language==="pt"&&c.name_pt?c.name_pt:c.name;return e.jsxs("div",{className:"flex justify-between text-sm py-1 border-b border-dashed last:border-0",children:[e.jsx("span",{children:f}),e.jsxs("span",{className:"text-muted-foreground",children:[c.amount," ",x.language==="en"&&c.unit_en?c.unit_en:x.language==="pt"&&c.unit_pt?c.unit_pt:c.unit]})]},y)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-sm mb-2",children:j("recipe.step.steps","æ­¥éª¤")}),e.jsx("div",{className:"space-y-3",children:a.steps.map((c,y)=>{const f=x.language==="en"&&c.description_en?c.description_en:x.language==="pt"&&c.description_pt?c.description_pt:c.description;return e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center shrink-0 mt-0.5",children:e.jsx("span",{className:"text-xs font-bold text-primary",children:c.order||y+1})}),e.jsx("p",{className:"text-sm leading-relaxed",children:f})]},y)})})]})]})})]})},g))})},gt=({recipe:s,ingredientImageUrl:j,onComplete:x,onBack:h,onSkip:b})=>{const{t:m,i18n:o}=H(),[u,a]=d.useState("guided"),[g,c]=d.useState(!1),[y,f]=d.useState(null),{videoTasks:T,generateVideo:I,clearTask:U}=Ye(),[P,l]=d.useState(!1),t=s.recipe_name,n=P?T[t]:void 0,i=n?.status==="succeeded"?n.videoUrl:null,{watermarkedUrl:C,isProcessing:D}=ct(i,ot),B=()=>{const p=s.image_url;if(!p)return;l(!0);const N=s.recipe_name_en||s.recipe_name,v=s.steps.slice(0,6).map(W=>W.description_en||W.description).filter(Boolean).join(". "),$=`Step-by-step cooking tutorial video showing the complete preparation process of ${N}. Show hands chopping ingredients, mixing in a bowl, cooking in a pan with oil sizzling. ${v||"preparing ingredients, cooking, and plating"}. Kitchen counter with fresh ingredients, cutting board, knife, pots and pans visible. Warm natural kitchen lighting, steam rising from the pan, close-up of each cooking step, smooth transitions between steps. --duration 5 --camerafixed true`;I(t,p,$)},F=()=>o.language==="en"&&s.recipe_name_en?s.recipe_name_en:o.language==="pt"&&s.recipe_name_pt?s.recipe_name_pt:s.recipe_name,k=p=>{switch(p){case"easy":return m("recipe.difficulty.easy","ç®€å•");case"medium":return m("recipe.difficulty.medium","ä¸­ç­‰");case"hard":return m("recipe.difficulty.hard","å›°éš¾");default:return p}},J=p=>{switch(p){case"easy":return"bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30";case"medium":return"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30";case"hard":return"bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30";default:return"bg-muted text-muted-foreground"}},V=s.steps.map((p,N)=>({...p,order:p.order||N+1}));if(u==="guided"&&g)return e.jsx(je,{className:"overflow-hidden",children:e.jsx(rt,{steps:V,onExit:()=>c(!1),onComplete:x})});const L=()=>e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"inline-flex h-9 items-center rounded-md bg-muted p-1 text-muted-foreground",children:[e.jsxs("button",{onClick:()=>{a("guided"),c(!1)},className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 ${u==="guided"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(Fe,{className:"h-4 w-4"}),m("recipe.guidedMode","æµç¨‹æ¨¡å¼")]}),e.jsxs("button",{onClick:()=>a("full"),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 ${u==="full"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(Ms,{className:"h-4 w-4"}),m("recipe.fullMode","å®Œæ•´æ¨¡å¼")]})]})}),le=()=>e.jsxs(je,{className:"overflow-hidden",children:[s.image_url?e.jsxs("div",{className:"relative w-full aspect-[16/9] bg-muted",children:[e.jsx("img",{src:s.image_url,alt:F(),className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute bottom-2 right-2 flex items-center gap-1.5",children:[!n?.videoUrl&&e.jsx("button",{onClick:B,disabled:n?.status==="creating"||n?.status==="processing",className:"inline-flex items-center gap-1 text-[10px] bg-black/60 hover:bg-black/80 text-white px-2 py-1 rounded-full transition-colors disabled:opacity-50",children:n?.status==="creating"||n?.status==="processing"?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-2.5 w-2.5 animate-spin"}),m("aiRecipe.generatingVideo","ç”Ÿæˆè§†é¢‘ä¸­...")]}):e.jsxs(e.Fragment,{children:[e.jsx(Es,{className:"h-2.5 w-2.5"}),m("aiRecipe.generateVideo","ç”Ÿæˆè§†é¢‘")]})}),e.jsx("span",{className:"inline-flex items-center gap-1 text-[10px] bg-black/50 text-white px-2 py-0.5 rounded-full",children:s.image_source==="ai"?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-2.5 w-2.5"}),"AI ç”Ÿæˆ"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"h-2.5 w-2.5"}),"æ¥è‡ªç½‘ç»œ"]})})]}),n?.status==="failed"&&e.jsx("div",{className:"absolute top-2 left-2 right-2",children:e.jsx("div",{className:"bg-destructive/90 text-destructive-foreground text-xs px-2 py-1 rounded",children:n.error||m("aiRecipe.videoFailed","è§†é¢‘ç”Ÿæˆå¤±è´¥")})})]}):null,n?.status==="succeeded"&&n.videoUrl&&e.jsx("div",{className:"px-4 pt-3",children:D?e.jsx("div",{className:"w-full aspect-video rounded-xl bg-muted flex items-center justify-center",children:e.jsx(X,{className:"h-5 w-5 animate-spin text-muted-foreground"})}):e.jsx("video",{src:C||n.videoUrl,controls:!0,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,className:"w-full rounded-xl"})}),e.jsxs(Ae,{className:"pb-3",children:[e.jsx("h2",{className:"text-xl font-bold",children:F()}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[s.cook_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(De,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.cook_time," ",m("recipe.minutes","åˆ†é’Ÿ")]})]}),s.servings&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.servings," ",m("recipe.servingsUnit","äººä»½")]})]}),s.difficulty&&e.jsxs(A,{variant:"outline",className:J(s.difficulty),children:[e.jsx(ve,{className:"h-3 w-3 mr-1"}),k(s.difficulty)]})]})]}),e.jsxs(Te,{className:"space-y-6",children:[(()=>{const p=o.language==="en"&&s.introduction_en?s.introduction_en:o.language==="pt"&&s.introduction_pt?s.introduction_pt:s.introduction;return p&&e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:p})})(),e.jsx(Re,{}),s.ingredients.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[m("recipe.ingredients","é£Ÿæ")," (",s.ingredients.length,")"]}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground font-medium px-2 py-1.5 bg-muted/50 rounded-t-md border border-border/50",children:[e.jsx("span",{className:"flex-1",children:m("recipe.ingredientName","åç§°")}),e.jsx("span",{className:"w-24 text-right",children:m("recipe.amount","ç”¨é‡")})]}),e.jsx("ul",{className:"border border-t-0 border-border/50 rounded-b-md divide-y divide-border/50",children:s.ingredients.map((p,N)=>{const v=o.language==="en"&&p.name_en?p.name_en:o.language==="pt"&&p.name_pt?p.name_pt:p.name;return e.jsxs("li",{className:"flex items-center text-sm px-2 py-2",children:[e.jsx("span",{className:"flex-1 min-w-0 truncate",children:v}),e.jsxs("span",{className:"w-24 text-right text-muted-foreground shrink-0",children:[p.amount," ",o.language==="en"&&p.unit_en?p.unit_en:o.language==="pt"&&p.unit_pt?p.unit_pt:p.unit]})]},N)})})]}),u==="guided"&&e.jsxs(e.Fragment,{children:[e.jsx(Re,{}),e.jsxs(_,{size:"lg",className:"w-full gap-2 h-14 text-lg",onClick:()=>c(!0),children:[e.jsx(Fe,{className:"h-6 w-6"}),m("recipe.startCooking","å¼€å§‹çƒ¹é¥ª"),e.jsxs(A,{variant:"secondary",className:"ml-2",children:[V.length," ",m("recipe.stepsCount","æ­¥")]})]}),b&&e.jsxs(_,{variant:"ghost",className:"w-full gap-2 text-muted-foreground",onClick:b,children:[e.jsx(Pe,{className:"h-4 w-4"}),m("aiRecipe.skipDish","è·³è¿‡è¿™é“èœ")]})]}),u==="full"&&e.jsxs(e.Fragment,{children:[e.jsx(Re,{}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[m("recipe.step.steps","æ­¥éª¤")," (",V.length,")"]}),e.jsx("ol",{className:"space-y-4",children:V.map((p,N)=>{const v=o.language==="en"&&p.description_en?p.description_en:o.language==="pt"&&p.description_pt?p.description_pt:p.description;return e.jsxs("li",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold",children:p.order}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("p",{className:"text-sm",children:v}),(()=>{const $=p.image_urls&&p.image_urls.length>0?p.image_urls:p.image_url?[p.image_url]:[];return $.length>0&&e.jsx("div",{className:`flex gap-2 ${$.length===1?"":"flex-wrap"}`,children:$.map((W,G)=>e.jsx("img",{src:W,alt:`Step ${p.order} - ${G+1}`,className:`rounded-lg max-h-48 object-cover cursor-pointer ${$.length===1?"w-full":"w-[calc(50%-0.25rem)]"}`,onClick:()=>f(W)},G))})})()]})]},N)})})]})]}),u==="full"&&e.jsx(_,{size:"lg",variant:"outline",className:"w-full gap-2",onClick:x,children:m("recipe.completeCooking","å®Œæˆçƒ¹é¥ª")})]})]});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(L,{}),e.jsx(le,{}),e.jsx(lt,{imageUrl:y||"",isOpen:!!y,onClose:()=>f(null)})]})},ft=({recipes:s,ingredientImageUrl:j,onComplete:x,onBack:h})=>{const{t:b,i18n:m}=H(),[o,u]=d.useState(0),[a,g]=d.useState(new Set),[c,y]=d.useState(new Set),f=l=>m.language==="en"&&l.recipe_name_en?l.recipe_name_en:m.language==="pt"&&l.recipe_name_pt?l.recipe_name_pt:l.recipe_name,T=(l,t)=>l.size+t.size===s.length,I=(l,t,n)=>{if(T(l,t)){x(Array.from(t));return}for(let i=n+1;i<s.length;i++)if(!l.has(i)&&!t.has(i)){u(i);return}for(let i=0;i<n;i++)if(!l.has(i)&&!t.has(i)){u(i);return}x(Array.from(t))},U=()=>{const l=new Set(a);l.add(o),g(l),I(l,c,o)},P=()=>{const l=new Set(c);l.add(o),y(l),I(a,l,o)};return a.size+c.size,e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto pb-1 scrollbar-hide",children:s.map((l,t)=>e.jsxs("button",{onClick:()=>u(t),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-all border shrink-0 ${o===t?"bg-primary text-primary-foreground border-primary":a.has(t)?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 border-green-300 dark:border-green-700":c.has(t)?"bg-muted text-muted-foreground/50 border-border line-through":"bg-muted text-muted-foreground border-border hover:border-primary/50"}`,children:[a.has(t)&&e.jsx(re,{className:"h-3 w-3"}),c.has(t)&&e.jsx(Pe,{className:"h-3 w-3"}),f(l)]},t))}),e.jsxs("div",{className:"text-center text-xs text-muted-foreground",children:[b("aiRecipe.cookingProgress","å·²å®Œæˆ {{done}}/{{total}} é“èœ",{done:a.size,total:s.length}),c.size>0&&e.jsxs("span",{className:"ml-1 opacity-60",children:["(",b("aiRecipe.skippedCount","å·²è·³è¿‡ {{n}} é“",{n:c.size}),")"]})]}),e.jsx(gt,{recipe:s[o],ingredientImageUrl:j,onComplete:U,onBack:h,onSkip:s.length>1&&!c.has(o)?P:void 0},o)]})},jt=({recipes:s,skippedIndices:j=[],onShare:x,onSkip:h,onSaveRecipe:b,onUnsaveRecipe:m,isSaving:o})=>{const{t:u,i18n:a}=H(),[g,c]=d.useState(new Set(s.map((t,n)=>n).filter(t=>!j.includes(t)))),[y,f]=d.useState(new Map),[T,I]=d.useState(null),U=async(t,n)=>{if(n.stopPropagation(),!!b)if(y.has(t)){const i=y.get(t);if(i&&m){I(t);try{await m(i),f(C=>{const D=new Map(C);return D.delete(t),D})}finally{I(null)}}}else{I(t);try{const i=await b(s[t]);f(C=>new Map(C).set(t,i?.id||"saved"))}finally{I(null)}}},P=t=>a.language==="en"&&t.recipe_name_en?t.recipe_name_en:a.language==="pt"&&t.recipe_name_pt?t.recipe_name_pt:t.recipe_name,l=t=>{const n=new Set(g);n.has(t)?n.delete(t):n.add(t),c(n)};return e.jsxs("div",{className:"flex flex-col items-center gap-5 py-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(Fs,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{className:"text-center space-y-1.5",children:[e.jsx("h3",{className:"text-xl font-bold",children:u("aiRecipe.cookingDone","çƒ¹é¥ªå®Œæˆï¼ğŸ‰")}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-xs mx-auto",children:u("aiRecipe.shareSelectDesc","é€‰æ‹©æ‚¨æƒ³è¦åˆ†äº«åˆ°ç¤¾åŒºçš„èœå“ï¼Œæ¯é“èœéœ€è¦æ‹æ‘„æˆå“ç…§ç‰‡")})]}),e.jsx("div",{className:"w-full max-w-sm space-y-2",children:s.map((t,n)=>{const i=j.includes(n),C=y.has(n);return e.jsxs("button",{onClick:()=>!i&&l(n),className:`w-full flex items-center gap-3 p-3 rounded-xl border transition-all text-left ${i?"border-border bg-muted/20 opacity-40 cursor-not-allowed":g.has(n)?"border-primary bg-primary/5 ring-1 ring-primary/20":"border-border bg-muted/30 opacity-60"}`,children:[e.jsx("div",{className:"w-14 h-14 rounded-lg overflow-hidden bg-muted shrink-0",children:t.image_url?e.jsx("img",{src:t.image_url,alt:t.recipe_name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground text-lg",children:"ğŸ½ï¸"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:P(t)}),t.subtitle&&e.jsx("p",{className:"text-xs text-muted-foreground italic truncate mt-0.5",children:t.subtitle}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1",children:[e.jsxs(A,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[t.cook_time,u("recipe.minuteShort","åˆ†é’Ÿ")]}),i&&e.jsx(A,{variant:"outline",className:"text-[10px] px-1.5 py-0 text-muted-foreground",children:u("aiRecipe.skipped","å·²è·³è¿‡")})]})]}),b&&!i&&e.jsx("button",{onClick:D=>U(n,D),disabled:T===n,className:`p-1.5 rounded-lg shrink-0 transition-colors ${C?"text-primary":"text-muted-foreground hover:text-primary hover:bg-primary/10"}`,children:T===n?e.jsx(X,{className:"h-4 w-4 animate-spin"}):e.jsx(fe,{className:`h-4 w-4 ${C?"fill-primary":""}`})}),!i&&e.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center shrink-0 transition-colors ${g.has(n)?"bg-primary border-primary text-primary-foreground":"border-muted-foreground/30"}`,children:g.has(n)&&e.jsx(re,{className:"h-3.5 w-3.5"})})]},n)})}),e.jsxs("div",{className:"w-full max-w-sm space-y-3",children:[e.jsx(_,{className:"w-full gap-2 h-12",onClick:()=>x(Array.from(g).sort()),disabled:g.size===0,children:g.size>0?u("aiRecipe.shareSelected","åˆ†äº« {{count}} é“èœåˆ°ç¤¾åŒº",{count:g.size}):u("aiRecipe.shareToComm","åˆ†äº«åˆ°ç¤¾åŒº")}),e.jsxs(_,{variant:"outline",className:"w-full gap-2",onClick:h,children:[e.jsx(Ne,{className:"h-4 w-4"}),u("aiRecipe.noThanks","æš‚æ—¶ä¸åˆ†äº«")]})]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center max-w-xs",children:u("aiRecipe.shareNote","åˆ†äº«éœ€è¦æ‹æ‘„æˆå“ç…§ç‰‡è¿›è¡ŒéªŒè¯ï¼Œä»¥ç¡®ä¿å†…å®¹çœŸå®å¯é ")})]})},Je=["photo","confirm","preferences","generating","select","detail","cooking","share-prompt","result","publish"],Z="ai-recipe-session",Nt=()=>{try{const s=sessionStorage.getItem(Z);if(s)return JSON.parse(s)}catch{}return{}},$t=()=>{const{t:s}=H(),j=Os(),h=Vs().state?.from||"/ai-recipe",{requireLogin:b}=tt(),{identifyIngredients:m,generateRecipes:o,generateRecipeImages:u,verifyResultPhoto:a,uploadImage:g,isIdentifying:c,isGenerating:y,isVerifying:f,isGeneratingImages:T}=Xs(),[I,U]=d.useState(!1),P=et(),{saveRecipe:l,deleteRecipe:t,isSaving:n}=st(),{videoTasks:i,videoStates:C,generateVideo:D,selectVideo:B,clearTask:F}=Ye(),[k]=d.useState(()=>Nt()),J=!!(k.step&&k.step!=="photo"&&k.step!=="generating"&&(k.ingredients?.length||k.recipes?.length)),[V,L]=d.useState(J),[le,p]=d.useState(!J),[N,v]=d.useState("photo"),[$,W]=d.useState([]),[G,ce]=d.useState([]),[Y,oe]=d.useState({}),[z,de]=d.useState([]),me=d.useRef([]),[es,Ue]=d.useState([]),[ze,ee]=d.useState(0),[O,ue]=d.useState([]),[Q,pe]=d.useState(""),[be,xe]=d.useState(!1),[Me,we]=d.useState(""),[ss,ts]=d.useState([]),as=()=>{v(k.step&&k.step!=="generating"?k.step:"photo"),W(k.ingredientImageUrls||[]),ce(k.ingredients||[]),oe(k.preferences||{});const r=k.recipes||[];me.current=r,de(r),ee(k.publishingDishIndex||0),ue(k.publishQueue||[]),pe(k.resultImageUrl||""),xe(k.photoVerified||!1),p(!0),L(!1)};d.useEffect(()=>{me.current=z},[z]);const is=()=>{sessionStorage.removeItem(Z),Object.keys(i).forEach(r=>F(r)),p(!0),L(!1)},ns=(Je.indexOf(N)+1)/Je.length*100;d.useEffect(()=>{if(le)try{const r=z.map(R=>({...R,image_url:R.image_url&&R.image_url.startsWith("data:")?void 0:R.image_url})),S={step:N,ingredientImageUrls:$,ingredients:G,preferences:Y,recipes:r,publishingDishIndex:ze,publishQueue:O,resultImageUrl:Q,photoVerified:be};sessionStorage.setItem(Z,JSON.stringify(S))}catch(r){console.warn("Session save failed (quota):",r)}},[le,N,$,G,Y,z,ze,O,Q,be]),d.useEffect(()=>{window.scrollTo({top:0,behavior:"instant"})},[N]);const w=O.length>0?z[O[0]]:null,ye=O.length>0?1:0,rs=async r=>{if(!b())return;W(r);const S=[],R=new Set;for(const M of r){const E=await m(M);if(E)for(const K of E)R.has(K.name)||(R.add(K.name),S.push(K))}S.length>0&&(ce(S),v("confirm"))},ls=()=>{b()&&(ce([]),v("confirm"))},cs=()=>{if(G.length===0){ie.error(s("aiRecipe.noIngredients","è¯·è‡³å°‘ä¿ç•™ä¸€ç§é£Ÿæ"));return}v("preferences")},os=async r=>{oe(r),await _e(r)},ds=async()=>{oe({}),await _e({})},_e=async(r,S)=>{v("generating");const R=me.current.slice(),M=await o(G,r.difficulty,r.servings,r.dishCount,r.notes,S);M&&M.length>0?(R.length>0&&Ue(E=>E.length>0&&E[0].length===R.length&&E[0][0]?.recipe_name===R[0]?.recipe_name?E:[R,...E].slice(0,5)),de(M),v("select"),u(M.map(E=>({recipe_name:E.recipe_name,recipe_name_en:E.recipe_name_en})),(E,K,ys)=>{de(_s=>_s.map(ke=>ke.recipe_name===E?{...ke,image_url:K,image_source:ys}:ke))})):v("preferences")},ms=()=>{v("detail")},us=async()=>{for(const r of z)await l(r)},ps=()=>{z.forEach(r=>F(r.recipe_name)),v("cooking")},xs=r=>{ts(r),v("share-prompt")},[se,te]=d.useState(null),hs=r=>{ue(r),te("share")},ae=()=>{sessionStorage.removeItem(Z),ie.success(s("aiRecipe.cookingComplete","å¤ªæ£’äº†ï¼çƒ¹é¥ªå®Œæˆï¼")),j("/community")},gs=async r=>{for(const S of z)await l(S);te(null),r==="share"?(ee(O[0]||0),v("result")):ae()},fs=r=>{te(null),r==="share"?(ee(O[0]||0),v("result")):ae()},js=(r,S,R)=>{pe(r),xe(S),R&&we(R),S&&v("publish")},Ns=async r=>{if(!(!w||!Q))try{await P.mutateAsync({recipe_name:w.recipe_name,recipe_name_en:w.recipe_name_en,recipe_name_pt:w.recipe_name_pt,subtitle:w.subtitle,subtitle_en:w.subtitle_en,subtitle_pt:w.subtitle_pt,cook_time:w.cook_time,difficulty:w.difficulty,servings:w.servings,ingredients:w.ingredients,steps:w.steps.map((R,M)=>({...R,order:M+1})),cover_image:Q,introduction:w.introduction||"",introduction_en:w.introduction_en,introduction_pt:w.introduction_pt,cooking_note:r?.trim()||Me||void 0,ai_recipe_source:{source:"ai_recipe",ingredient_images:$,identified_ingredients:G,selected_recipe_index:O[0],all_recipes:z.map(R=>R.recipe_name),result_image:Q,photo_verified:be}});const S=O.slice(1);ue(S),S.length>0?(ie.success(s("aiRecipe.dishPublished","ç¬¬ {{n}} é“èœå·²å‘å¸ƒï¼ç»§ç»­ä¸‹ä¸€é“",{n:ye})),ee(S[0]),pe(""),xe(!1),we(""),v("result")):(sessionStorage.removeItem(Z),ie.success(s("aiRecipe.allPublished","æ‰€æœ‰èœè°±å·²å‘å¸ƒåˆ°ç¤¾åŒºï¼")),j("/community"))}catch{}},Ee=()=>{const r=O.slice(1);ue(r),r.length>0?(ee(r[0]),pe(""),xe(!1),we(""),v("result")):(sessionStorage.removeItem(Z),ie.success(s("aiRecipe.publishDone","å‘å¸ƒå®Œæˆï¼")),j("/community"))},vs=()=>{switch(N){case"confirm":v("photo");break;case"preferences":v("confirm");break;case"select":v("preferences");break;case"detail":v("select");break;case"cooking":v("detail");break;case"share-prompt":v("cooking");break;case"result":v("share-prompt");break;case"publish":v("result");break;default:j("/ai-recipe",{replace:!0,state:{from:h}});break}},bs=()=>{switch(N){case"photo":return s("aiRecipe.stepPhoto","æ‹æ‘„é£Ÿæ");case"confirm":return s("aiRecipe.stepConfirm","ç¡®è®¤é£Ÿæ");case"preferences":return s("aiRecipe.stepPreferences","çƒ¹é¥ªåå¥½");case"generating":return s("aiRecipe.stepGenerating","ç”Ÿæˆèœè°±");case"select":return s("aiRecipe.stepMealPlan","å®Œæ•´èœå•");case"detail":return s("aiRecipe.stepDetail","èœè°±è¯¦æƒ…");case"cooking":return s("aiRecipe.stepCooking","çƒ¹é¥ªä¸­");case"share-prompt":return s("aiRecipe.stepShare","åˆ†äº«");case"result":return w?s("aiRecipe.stepResultDish","æ‹æ‘„æˆå“ ({{n}}/{{total}})",{n:ye,total:O.length+ye-1}):s("aiRecipe.stepResult","æ‹æ‘„æˆå“");case"publish":return s("aiRecipe.stepPublish","å‘å¸ƒ")}},ws=()=>{const r=k.step;return r==="select"||r==="detail"?s("aiRecipe.resumeAtSelect","å·²ç”Ÿæˆèœå•"):r==="cooking"?s("aiRecipe.resumeAtCooking","çƒ¹é¥ªä¸­"):r==="confirm"?s("aiRecipe.resumeAtConfirm","é£Ÿæç¡®è®¤"):r==="preferences"?s("aiRecipe.resumeAtPrefs","çƒ¹é¥ªåå¥½"):r==="share-prompt"||r==="result"||r==="publish"?s("aiRecipe.resumeAtShare","åˆ†äº«/å‘å¸ƒ"):""};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[V?e.jsx(Bs,{open:V,onOpenChange:r=>{r||(L(!1),j("/community",{state:{openCreatePost:!0}}))},children:e.jsxs(Gs,{children:[e.jsxs(Hs,{children:[e.jsxs(Ws,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-primary"}),s("aiRecipe.resumeTitle","æ£€æµ‹åˆ°æœªå®Œæˆçš„é£Ÿè°±")]}),e.jsxs(Ks,{className:"space-y-2",children:[e.jsx("span",{children:s("aiRecipe.resumeDesc","æ‚¨æœ‰ä¸€ä¸ªæœªå®Œæˆçš„ AI é£Ÿè°±æµç¨‹ï¼Œæ˜¯å¦è¦ç»§ç»­ï¼Ÿ")}),k.recipes&&k.recipes.length>0&&e.jsx("span",{className:"block text-xs mt-2 bg-muted rounded-lg px-3 py-2",children:k.recipes.map(r=>r.recipe_name).join("ã€")}),e.jsx("span",{className:"block text-xs text-muted-foreground",children:s("aiRecipe.resumeProgress","è¿›åº¦ï¼š{{step}}",{step:ws()})})]})]}),e.jsxs(Js,{className:"flex-col sm:flex-row gap-2",children:[e.jsx(_,{variant:"outline",onClick:is,children:s("aiRecipe.startNew","é‡æ–°å¼€å§‹")}),e.jsx(_,{onClick:as,children:s("aiRecipe.resumeContinue","ç»§ç»­ä¸Šæ¬¡")})]})]})}):null,!V&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 py-3 border-b bg-background shrink-0 sticky top-14 z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("button",{onClick:N==="publish"||N==="share-prompt"?()=>U(!0):vs,className:"p-1 -ml-1 hover:bg-muted rounded-md",children:N==="publish"||N==="share-prompt"?e.jsx(Ne,{className:"h-5 w-5"}):e.jsx($s,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-primary"}),e.jsx("h2",{className:"font-medium",children:bs()})]}),e.jsx("div",{className:"w-6"})]}),e.jsx(Qs,{value:ns,className:"h-1"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 max-w-lg mx-auto w-full",children:[N==="photo"&&e.jsx(dt,{onPhotosUploaded:rs,onSkipToManual:ls,uploadImage:g,isUploading:c,initialImageUrls:$,onRequireLogin:b}),c&&e.jsxs("div",{className:"flex flex-col items-center gap-3 py-12",children:[e.jsx(X,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx(Oe,{messages:[s("aiRecipe.identifying.1","AI æ­£åœ¨è¯†åˆ«é£Ÿæ..."),s("aiRecipe.identifying.2","åˆ†æé£Ÿæç§ç±»ä¸æ•°é‡..."),s("aiRecipe.identifying.3","å³å°†å®Œæˆè¯†åˆ«...")]})]}),N==="confirm"&&!c&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(mt,{ingredients:G,onChange:ce}),e.jsx(_,{className:"w-full",onClick:cs,children:s("aiRecipe.nextStep","ä¸‹ä¸€æ­¥")})]}),N==="preferences"&&e.jsx(pt,{onConfirm:os,onSkip:ds,initialValues:Y}),N==="generating"&&e.jsxs("div",{className:"flex flex-col items-center gap-3 py-12",children:[e.jsx(X,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx(Oe,{messages:[s("aiRecipe.generating.1","AI æ­£åœ¨ä¸ºæ‚¨è®¾è®¡ä¸€æ¡Œèœ..."),s("aiRecipe.generating.2","æ­é…è¥å…»å‡è¡¡çš„é£Ÿè°±..."),s("aiRecipe.generating.3","è®¡ç®—æœ€ä½³çƒ¹é¥ªé¡ºåº..."),s("aiRecipe.generating.4","ç”Ÿæˆè¯¦ç»†çƒ¹é¥ªæ­¥éª¤..."),s("aiRecipe.generating.5","å³å°†å®Œæˆï¼Œè¯·ç¨å€™..."),s("aiRecipe.generating.6","æŒ‘é€‰æœ€ä½³è°ƒå‘³æ­é…..."),s("aiRecipe.generating.7","ä¼˜åŒ–çƒ¹é¥ªç«å€™ä¸æ¸©åº¦..."),s("aiRecipe.generating.8","åŠ å…¥å¤§å¨ç§è—å°çªé—¨..."),s("aiRecipe.generating.9","ç²¾è°ƒæ¯é“èœçš„ç”¨é‡..."),s("aiRecipe.generating.10","æ‰“ç£¨æœ€ç»ˆèœè°±ç»†èŠ‚...")]})]}),N==="select"&&e.jsx(xt,{recipes:z,recipeHistory:es,onSelectHistoryMeal:r=>{const S=me.current.slice();Ue(R=>{const M=R.filter(K=>K!==r);return S.length===0||M.length>0&&M[0][0]?.recipe_name===S[0]?.recipe_name&&M[0].length===S.length?M:[S,...M].slice(0,5)}),de(r)},onConfirmMeal:ms,onRegenerate:r=>{const S=z.map(M=>M.recipe_name),R={...Y,notes:r!==void 0?r:Y.notes};oe(R),_e(R,S)},isRegenerating:y,preferences:Y,isLoadingImages:T}),N==="detail"&&z.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(ht,{recipes:z}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(_,{variant:"outline",className:"flex-1",onClick:()=>v("select"),children:s("aiRecipe.changeMeal","æ¢ä¸€æ¡Œ")}),e.jsxs(_,{variant:"outline",className:"gap-1",onClick:us,disabled:n,children:[e.jsx(fe,{className:"h-4 w-4"}),s("aiRecipe.saveAll","å…¨éƒ¨ä¿å­˜")]}),e.jsx(_,{className:"flex-1",onClick:ps,children:s("aiRecipe.startCooking","å¼€å§‹çƒ¹é¥ª")})]})]}),N==="cooking"&&z.length>0&&e.jsx(ft,{recipes:z,ingredientImageUrl:$[0]||"",onComplete:xs,onBack:()=>v("detail")}),N==="share-prompt"&&z.length>0&&e.jsx("div",{className:"space-y-4",children:e.jsx(jt,{recipes:z,skippedIndices:ss,onShare:hs,onSkip:()=>te("skip"),onSaveRecipe:l,onUnsaveRecipe:t,isSaving:n})}),e.jsx(Ve,{open:!!se,onOpenChange:r=>!r&&te(null),children:e.jsxs($e,{children:[e.jsxs(Le,{children:[e.jsx(Be,{children:s("aiRecipe.saveBeforeTitle","ä¿å­˜é£Ÿè°±ï¼Ÿ")}),e.jsx(Ge,{children:s("aiRecipe.saveBeforeDescMeal","æ˜¯å¦å°†è¿™æ¡Œèœçš„æ‰€æœ‰é£Ÿè°±ä¿å­˜åˆ°æ‚¨çš„æ”¶è—ä¸­ï¼Ÿ")})]}),e.jsxs(He,{className:"flex-col sm:flex-row gap-2",children:[e.jsx(We,{onClick:()=>se&&fs(se),children:s("aiRecipe.noSave","ä¸ä¿å­˜")}),e.jsxs(he,{onClick:()=>se&&gs(se),disabled:n,children:[e.jsx(fe,{className:"h-4 w-4 mr-1"}),s("aiRecipe.saveAllRecipes","ä¿å­˜å…¨éƒ¨é£Ÿè°±")]})]})]})}),N==="result"&&w&&e.jsxs("div",{className:"space-y-4",children:[O.length>0&&e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl border bg-muted/30",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden bg-muted shrink-0",children:w.image_url?e.jsx("img",{src:w.image_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-lg",children:"ğŸ½ï¸"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:w.recipe_name}),w.subtitle&&e.jsx("p",{className:"text-xs text-muted-foreground italic truncate",children:w.subtitle})]}),O.length>1&&e.jsxs(_,{variant:"ghost",size:"sm",className:"text-xs shrink-0",onClick:Ee,children:[e.jsx(Pe,{className:"h-3.5 w-3.5 mr-1"}),s("aiRecipe.skipThisDish","è·³è¿‡")]})]}),e.jsx(Ys,{onPhotoVerified:js,uploadImage:g,verifyPhoto:a,recipeName:w.recipe_name,isVerifying:f})]}),N==="publish"&&w&&e.jsx(Zs,{resultImageUrl:Q,recipeName:w.recipe_name,initialNote:Me,onPublish:Ns,onSkip:Ee,isPublishing:P.isPending,recipeSteps:w.steps,videoTask:i[w.recipe_name],videoState:C[w.recipe_name],onGenerateVideo:r=>D(w.recipe_name,Q,r),onSelectVideo:r=>B(w.recipe_name,r)}),e.jsx(Ve,{open:I,onOpenChange:U,children:e.jsxs($e,{children:[e.jsxs(Le,{children:[e.jsx(Be,{children:N==="share-prompt"?s("aiRecipe.exitShareTitle","ç¡®è®¤é€€å‡ºï¼Ÿ"):s("aiRecipe.closeConfirmTitle","ç¡®è®¤ç¦»å¼€ï¼Ÿ")}),e.jsx(Ge,{children:N==="share-prompt"?s("aiRecipe.exitShareDesc","æ‚¨è¿˜æ²¡æœ‰ä¿å­˜é£Ÿè°±ï¼Œé€€å‡ºåé£Ÿè°±å°†ä¸¢å¤±ã€‚æ˜¯å¦å…ˆä¿å­˜ï¼Ÿ"):s("aiRecipe.closeConfirmDesc","ç¦»å¼€åå°†æ”¾å¼ƒå‘å¸ƒï¼Œæ‚¨çš„æˆå“ç…§ç‰‡å’Œé£Ÿè°±å°†ä¸ä¼šä¿å­˜åˆ°ç¤¾åŒºã€‚")})]}),e.jsxs(He,{className:"flex-col sm:flex-row gap-2",children:[e.jsx(We,{children:s("common.cancel","å–æ¶ˆ")}),N==="share-prompt"?e.jsxs(e.Fragment,{children:[e.jsxs(he,{onClick:async()=>{for(const r of z)await l(r);U(!1),ae()},disabled:n,children:[e.jsx(fe,{className:"h-4 w-4 mr-1"}),s("aiRecipe.saveAndExit","ä¿å­˜å¹¶é€€å‡º")]}),e.jsx(he,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:()=>{U(!1),ae()},children:s("aiRecipe.exitWithoutSave","ä¸ä¿å­˜ï¼Œç›´æ¥é€€å‡º")})]}):e.jsx(he,{onClick:ae,children:s("aiRecipe.confirmLeave","ç¡®è®¤ç¦»å¼€")})]})]})})]})]})]})};export{$t as default};
//# sourceMappingURL=AIRecipe-CiDHVZtv.js.map
