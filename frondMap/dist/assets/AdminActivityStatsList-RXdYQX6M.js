import{j as s}from"./vendor-ui-DAmPMpEA.js";import{u as V,r as A}from"./vendor-react-iAJ0IrSD.js";import{a as d}from"./vendor-query-BlSVl3IQ.js";import{s as f,bA as I,i as z,aM as Q,aN as k,aO as B,aP as U,aQ as u,g as o,v as m,aV as y,as as N,a5 as w,bm as b,t as H,T as M,B as P,Q as x}from"./index-C1nN4O7Q.js";import{u as $}from"./useLocalizedContent-DPVaEcf3.js";import{u as G}from"./vendor-i18n-DxKeo2S1.js";import{s as v}from"./startOfDay-D8P-y0b_.js";import{s as _}from"./subDays-BXDMDv-T.js";import"./vendor-charts-Bz7hPIBd.js";import"./vendor-supabase-KNAP0qdW.js";const is=()=>{const{t:r}=G(),S=V(),{getLocalizedField:C}=$(),[n,q]=A.useState("30days"),O=()=>{const e=new Date;switch(n){case"today":return v(e).toISOString();case"7days":return v(_(e,6)).toISOString();case"30days":return v(_(e,29)).toISOString();default:return null}},{data:F,isLoading:D}=d({queryKey:["admin-activities-stats-list"],queryFn:async()=>{const{data:e,error:a}=await x.from("activities").select("*").neq("status","draft").order("created_at",{ascending:!1});if(a)throw a;return e}}),l=O(),{data:h}=d({queryKey:["admin-all-subscription-counts",n],queryFn:async()=>{let e=x.from("subscriptions").select("activity_id, created_at");l&&(e=e.gte("created_at",l));const{data:a,error:i}=await e;if(i)throw i;const t={};return a.forEach(c=>{t[c.activity_id]=(t[c.activity_id]||0)+1}),t}}),{data:j}=d({queryKey:["admin-all-share-counts",n],queryFn:async()=>{let e=x.from("activity_shares").select("activity_id, created_at");l&&(e=e.gte("created_at",l));const{data:a,error:i}=await e;if(i)throw i;const t={};return a.forEach(c=>{t[c.activity_id]=(t[c.activity_id]||0)+1}),t}}),{data:g}=d({queryKey:["admin-all-activity-view-counts",n],queryFn:async()=>{let e=x.from("page_views").select("target_id, created_at").eq("page_type","activity");l&&(e=e.gte("created_at",l));const{data:a,error:i}=await e;if(i)throw i;const t={};return a.forEach(c=>{c.target_id&&(t[c.target_id]=(t[c.target_id]||0)+1)}),t}}),{data:p}=d({queryKey:["admin-all-activity-restaurant-counts"],queryFn:async()=>{const{data:e,error:a}=await x.from("activity_restaurants").select("activity_id");if(a)throw a;const i={};return e.forEach(t=>{i[t.activity_id]=(i[t.activity_id]||0)+1}),i}}),E=g?Object.values(g).reduce((e,a)=>e+a,0):0,T=h?Object.values(h).reduce((e,a)=>e+a,0):0,K=j?Object.values(j).reduce((e,a)=>e+a,0):0,L=p?Object.values(p).reduce((e,a)=>e+a,0):0;return D?s.jsxs("div",{className:"space-y-6",children:[s.jsx(f,{className:"h-8 w-48"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[1,2,3,4].map(e=>s.jsx(f,{className:"h-24"},e))}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(e=>s.jsx(f,{className:"h-40"},e))})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(I,{className:"h-6 w-6 text-primary"}),s.jsx("h1",{className:"text-2xl font-bold",children:r("admin.activityStatistics")})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(z,{className:"h-4 w-4 text-muted-foreground"}),s.jsxs(Q,{value:n,onValueChange:e=>q(e),children:[s.jsx(k,{className:"w-[140px]",children:s.jsx(B,{})}),s.jsxs(U,{children:[s.jsx(u,{value:"today",children:r("analytics.today","今日")}),s.jsx(u,{value:"7days",children:r("analytics.last7Days","近7天")}),s.jsx(u,{value:"30days",children:r("analytics.last30Days","近30天")}),s.jsx(u,{value:"all",children:r("analytics.allTime","所有时间")})]})]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsx(o,{children:s.jsx(m,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:s.jsx(y,{className:"h-5 w-5 text-primary"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:r("admin.totalViews")}),s.jsx("p",{className:"text-2xl font-bold",children:E})]})]})})}),s.jsx(o,{children:s.jsx(m,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-red-500/10 rounded-lg",children:s.jsx(N,{className:"h-5 w-5 text-red-500"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:r("admin.totalSubscribers")}),s.jsx("p",{className:"text-2xl font-bold",children:T})]})]})})}),s.jsx(o,{children:s.jsx(m,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-green-500/10 rounded-lg",children:s.jsx(w,{className:"h-5 w-5 text-green-500"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:r("admin.totalShares")}),s.jsx("p",{className:"text-2xl font-bold",children:K})]})]})})}),s.jsx(o,{children:s.jsx(m,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-amber-500/10 rounded-lg",children:s.jsx(b,{className:"h-5 w-5 text-amber-500"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:r("admin.participatingRestaurants")}),s.jsx("p",{className:"text-2xl font-bold",children:L})]})]})})})]}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-semibold mb-4",children:r("admin.allActivities")}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:F?.map(e=>{const a=C(e,"title"),i=g?.[e.id]||0,t=h?.[e.id]||0,c=j?.[e.id]||0,R=p?.[e.id]||0;return s.jsxs(o,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>S(`/admin/activity-stats/${e.id}`),children:[s.jsx(H,{className:"pb-2",children:s.jsx(M,{className:"text-base line-clamp-2",children:a})}),s.jsxs(m,{children:[s.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(y,{className:"h-4 w-4 text-muted-foreground"}),s.jsxs("span",{children:[i," ",r("admin.views")]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(N,{className:"h-4 w-4 text-muted-foreground"}),s.jsxs("span",{children:[t," ",r("admin.subscribers")]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(w,{className:"h-4 w-4 text-muted-foreground"}),s.jsxs("span",{children:[c," ",r("admin.shares")]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(b,{className:"h-4 w-4 text-muted-foreground"}),s.jsxs("span",{children:[R," ",r("admin.restaurants")]})]})]}),s.jsx(P,{variant:"outline",size:"sm",className:"w-full mt-4",children:r("admin.viewDetails")})]})]},e.id)})})]})]})};export{is as default};
//# sourceMappingURL=AdminActivityStatsList-RXdYQX6M.js.map
