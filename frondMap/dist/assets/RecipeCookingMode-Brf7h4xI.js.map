{"version":3,"file":"RecipeCookingMode-Brf7h4xI.js","sources":["../../src/components/community/recipe/RecipeCookingMode.tsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { ChevronLeft, ChevronRight, Check, X } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Progress } from \"@/components/ui/progress\";\r\nimport { RecipeStep } from \"./RecipeTypes\";\r\nimport TranslateButton from \"@/components/TranslateButton\";\r\nimport ImagePreviewModal from \"@/components/ImagePreviewModal\";\r\n\r\ninterface RecipeCookingModeProps {\r\n  steps: RecipeStep[];\r\n  onExit: () => void;\r\n  onComplete?: () => void;\r\n}\r\n\r\nconst RecipeCookingMode = ({ steps, onExit, onComplete: onCompleteProp }: RecipeCookingModeProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const [currentStep, setCurrentStep] = useState(0);\r\n  const [translatedSteps, setTranslatedSteps] = useState<Record<number, string>>({});\r\n  const [previewImageUrl, setPreviewImageUrl] = useState<string | null>(null);\r\n  \r\n  const sortedSteps = [...steps].sort((a, b) => a.order - b.order);\r\n  const totalSteps = sortedSteps.length;\r\n  const step = sortedSteps[currentStep];\r\n  const progress = ((currentStep + 1) / totalSteps) * 100;\r\n  const isLastStep = currentStep === totalSteps - 1;\r\n  const isFirstStep = currentStep === 0;\r\n\r\n  const handleNext = () => {\r\n    if (!isLastStep) {\r\n      setCurrentStep(prev => prev + 1);\r\n    }\r\n  };\r\n\r\n  const handlePrev = () => {\r\n    if (!isFirstStep) {\r\n      setCurrentStep(prev => prev - 1);\r\n    }\r\n  };\r\n\r\n  const handleComplete = () => {\r\n    if (onCompleteProp) {\r\n      onCompleteProp();\r\n    } else {\r\n      onExit();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full min-h-[60vh]\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between px-4 py-3 border-b bg-background sticky top-0 z-10\">\r\n        <Button variant=\"ghost\" size=\"icon\" onClick={onExit}>\r\n          <X className=\"h-5 w-5\" />\r\n        </Button>\r\n        <span className=\"font-medium\">\r\n          {t(\"recipe.stepProgress\", \"步骤 {{current}} / {{total}}\", { \r\n            current: currentStep + 1, \r\n            total: totalSteps \r\n          })}\r\n        </span>\r\n        <TranslateButton \r\n          text={sortedSteps.map(s => s.description).join('\\n---\\n')} \r\n          onTranslation={(translated) => {\r\n            if (translated) {\r\n              const descriptions = translated.split('\\n---\\n');\r\n              const map: Record<number, string> = {};\r\n              descriptions.forEach((desc, idx) => { map[idx] = desc; });\r\n              setTranslatedSteps(map);\r\n            } else {\r\n              setTranslatedSteps({});\r\n            }\r\n          }}\r\n        />\r\n      </div>\r\n\r\n      {/* Progress bar */}\r\n      <Progress value={progress} className=\"h-1 rounded-none\" />\r\n\r\n      {/* Step content */}\r\n      <div className=\"flex-1 overflow-y-auto p-6\">\r\n        {/* Step number badge */}\r\n        <div className=\"flex items-center justify-center mb-6\">\r\n          <div className=\"w-16 h-16 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-2xl font-bold shadow-lg\">\r\n            {step.order}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Step images */}\r\n        {(() => {\r\n          const imgs = (step.image_urls && step.image_urls.length > 0) ? step.image_urls : step.image_url ? [step.image_url] : [];\r\n          return imgs.length > 0 && (\r\n            <div className=\"mb-6 flex flex-wrap justify-center gap-2\">\r\n              {imgs.map((url, imgIdx) => (\r\n                <img\r\n                  key={imgIdx}\r\n                  src={url}\r\n                  alt={`Step ${step.order} - ${imgIdx + 1}`}\r\n                  className={`h-auto max-h-64 object-cover cursor-pointer rounded-xl ${imgs.length === 1 ? 'max-w-[75%]' : 'w-[calc(50%-0.25rem)]'}`}\r\n                  onClick={() => setPreviewImageUrl(url)}\r\n                />\r\n              ))}\r\n            </div>\r\n          );\r\n        })()}\r\n\r\n        {/* Step description */}\r\n        <p className=\"text-lg leading-relaxed text-center\">\r\n          {translatedSteps[currentStep] || (\r\n            i18n.language === \"en\" && step.description_en ? step.description_en\r\n            : i18n.language === \"pt\" && step.description_pt ? step.description_pt\r\n            : step.description\r\n          )}\r\n        </p>\r\n      </div>\r\n\r\n      {/* Step dots indicator */}\r\n      <div className=\"flex justify-center gap-1.5 py-3\">\r\n        {sortedSteps.map((_, index) => (\r\n          <button\r\n            key={index}\r\n            className={`w-2 h-2 rounded-full transition-all ${\r\n              index === currentStep \r\n                ? 'bg-primary w-6' \r\n                : index < currentStep \r\n                  ? 'bg-primary/50' \r\n                  : 'bg-muted-foreground/30'\r\n            }`}\r\n            onClick={() => setCurrentStep(index)}\r\n          />\r\n        ))}\r\n      </div>\r\n\r\n      {/* Navigation buttons */}\r\n      <div className=\"flex items-center justify-between p-4 border-t bg-background\">\r\n        <Button\r\n          variant=\"outline\"\r\n          size=\"lg\"\r\n          onClick={handlePrev}\r\n          disabled={isFirstStep}\r\n          className=\"gap-2\"\r\n        >\r\n          <ChevronLeft className=\"h-5 w-5\" />\r\n          {t(\"recipe.prevStep\", \"上一步\")}\r\n        </Button>\r\n\r\n        {isLastStep ? (\r\n          <Button\r\n            size=\"lg\"\r\n            onClick={handleComplete}\r\n            className=\"gap-2\"\r\n            variant=\"default\"\r\n          >\r\n            <Check className=\"h-5 w-5\" />\r\n            {onCompleteProp ? t(\"recipe.completeCooking\", \"完成烹饪\") : t(\"recipe.complete\", \"完成\")}\r\n          </Button>\r\n        ) : (\r\n          <Button\r\n            size=\"lg\"\r\n            onClick={handleNext}\r\n            className=\"gap-2\"\r\n          >\r\n            {t(\"recipe.nextStep\", \"下一步\")}\r\n            <ChevronRight className=\"h-5 w-5\" />\r\n          </Button>\r\n        )}\r\n      </div>\r\n\r\n      <ImagePreviewModal\r\n        imageUrl={previewImageUrl || \"\"}\r\n        isOpen={!!previewImageUrl}\r\n        onClose={() => setPreviewImageUrl(null)}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RecipeCookingMode;\r\n"],"names":["RecipeCookingMode","steps","onExit","onCompleteProp","t","i18n","useTranslation","currentStep","setCurrentStep","useState","translatedSteps","setTranslatedSteps","previewImageUrl","setPreviewImageUrl","sortedSteps","a","b","totalSteps","step","progress","isLastStep","isFirstStep","handleNext","prev","handlePrev","handleComplete","jsxs","jsx","Button","X","TranslateButton","translated","descriptions","map","desc","idx","Progress","imgs","url","imgIdx","_","index","ChevronLeft","Check","ChevronRight","ImagePreviewModal"],"mappings":"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"}