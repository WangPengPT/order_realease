import{c as A,u as D,r as b,j as s,D as F,b as M,d as B,e as O,a6 as R,a7 as U,M as z,ag as H,ah as E,ai as V,aj as Y,ak as $,a9 as q,B as P,L as G,a as J,p as K,C as w,m as _,l as Q,w as W,ao as X,t as S}from"./index-QLT-vsIo.js";import{e as Z}from"./usePoints-BWO1YvCQ.js";import{c as ss,d as es,e as as}from"./useShopItems-mbDqfbH6.js";import{u as L}from"./useLocalizedContent-8mQ1Oy6B.js";import{u as ts,P as ns}from"./PointsHistoryDialog-B_lKBBOM.js";import{C as f}from"./coins-DF9fqRTV.js";import{S as k}from"./shopping-bag-BSMK46Dl.js";import{P as cs}from"./package-D7rD2Z68.js";import{T as rs}from"./ticket-Czmc4E0K.js";import"./tabs-Dr4DNDA4.js";import"./history-DGVSQ8AN.js";import"./arrow-up-CWODAH03.js";import"./clock-BrXCpyQ1.js";import"./refresh-cw-Bfxsa4TZ.js";import"./gift-DjzqvAl3.js";import"./format-Dpeb5NTb.js";import"./startOfDay-CaII_qte.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=A("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]),ls=({open:a,onOpenChange:d,item:n,userPoints:l})=>{const{t}=D(),{getLocalizedField:m}=L(),{data:h=[]}=ts(),p=ss(),[x,g]=b.useState(""),u=n.item_type==="physical",v=l-n.points_cost,N=async()=>{await p.mutateAsync({itemId:n.id,shippingAddressId:u?x:void 0}),d(!1)},y=!u||x;return s.jsx(F,{open:a,onOpenChange:d,children:s.jsxs(M,{className:"sm:max-w-md",children:[s.jsxs(B,{children:[s.jsx(O,{children:t("shop.confirmPurchase")}),s.jsx(R,{children:t("shop.confirmPurchaseDesc")})]}),s.jsxs("div",{className:"space-y-4 py-4",children:[s.jsxs("div",{className:"flex items-start gap-4 p-4 bg-secondary/30 rounded-lg",children:[n.image_url&&s.jsx("img",{src:n.image_url,alt:String(m(n,"name")),className:"w-16 h-16 rounded-lg object-cover"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"font-semibold",children:m(n,"name")}),s.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:m(n,"description")})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-muted-foreground",children:t("shop.currentPoints")}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(f,{className:"w-4 h-4 text-accent"}),s.jsx("span",{className:"font-medium",children:l})]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-muted-foreground",children:t("shop.pointsCost")}),s.jsxs("span",{className:"flex items-center gap-1 text-destructive",children:[s.jsx("span",{children:"-"}),s.jsx(f,{className:"w-4 h-4"}),s.jsx("span",{className:"font-medium",children:n.points_cost})]})]}),s.jsxs("div",{className:"border-t pt-2 flex justify-between items-center",children:[s.jsx("span",{className:"font-medium",children:t("shop.afterPurchase")}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(f,{className:"w-4 h-4 text-accent"}),s.jsx("span",{className:"font-bold",children:v})]})]})]}),u&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs(U,{className:"flex items-center gap-2",children:[s.jsx(z,{className:"w-4 h-4"}),t("shop.selectAddress")]}),h.length===0?s.jsx("p",{className:"text-sm text-muted-foreground",children:t("shop.noAddresses")}):s.jsxs(H,{value:x,onValueChange:g,children:[s.jsx(E,{children:s.jsx(V,{placeholder:t("shop.selectAddressPlaceholder")})}),s.jsx(Y,{children:h.map(r=>s.jsx($,{value:r.id,children:s.jsxs("div",{className:"text-left",children:[s.jsx("div",{className:"font-medium",children:r.label}),s.jsxs("div",{className:"text-sm text-muted-foreground",children:[r.street,", ",r.city]})]})},r.id))})]})]})]}),s.jsxs(q,{className:"gap-2 sm:gap-0",children:[s.jsx(P,{variant:"outline",onClick:()=>d(!1),children:t("common.cancel")}),s.jsx(P,{onClick:N,disabled:!y||p.isPending,children:p.isPending?s.jsxs(s.Fragment,{children:[s.jsx(G,{className:"w-4 h-4 mr-2 animate-spin"}),t("common.processing")]}):t("shop.confirmPurchaseBtn")})]})]})})},Cs=()=>{const{t:a}=D(),d=J(),{user:n}=K(),{getLocalizedField:l}=L(),{data:t=0,isLoading:m}=Z(),{data:h=[],isLoading:p}=es(),{data:x=[]}=as(),[g,u]=b.useState(null),[v,N]=b.useState(!1),y=e=>{switch(e){case"coupon":return s.jsx(rs,{className:"w-5 h-5"});case"physical":return s.jsx(cs,{className:"w-5 h-5"});case"badge":return s.jsx(is,{className:"w-5 h-5"});default:return s.jsx(k,{className:"w-5 h-5"})}},r=e=>{switch(e){case"coupon":return a("shop.itemType.coupon");case"physical":return a("shop.itemType.physical");case"badge":return a("shop.itemType.badge");default:return e}},C=e=>{const c=x.find(j=>j.shop_item_id===e.id);if(!c)return e.per_user_limit;const i=new Date(c.period_start),o=new Date;if(e.limit_refresh_period==="daily"&&i.toDateString()!==o.toDateString())return e.per_user_limit;if(e.limit_refresh_period==="weekly"){const j=new Date(o.getTime()-6048e5);if(i<j)return e.per_user_limit}return e.limit_refresh_period==="monthly"&&(i.getMonth()!==o.getMonth()||i.getFullYear()!==o.getFullYear())?e.per_user_limit:Math.max(0,e.per_user_limit-c.purchase_count)},I=e=>!(!n||t<e.points_cost||e.stock!==null&&e.stock<=0||C(e)<=0),T=e=>{if(!n){d("/auth");return}u(e),N(!0)};return p?s.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4",children:s.jsx("div",{className:"container mx-auto max-w-6xl",children:s.jsx("div",{className:"text-center",children:a("common.loading")})})}):s.jsxs("div",{className:"min-h-screen bg-secondary/20 py-4 md:py-8 px-3 md:px-4",children:[s.jsxs("div",{className:"container mx-auto max-w-6xl",children:[s.jsx("div",{className:"mb-6 md:mb-8",children:s.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-foreground mb-2",children:a("shop.title")}),s.jsx("p",{className:"text-muted-foreground",children:a("shop.description")})]}),n&&s.jsx(w,{className:"md:w-auto",children:s.jsxs(_,{className:"p-4 flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(f,{className:"w-6 h-6 text-accent"}),s.jsx("span",{className:"text-2xl font-bold text-foreground",children:m?"...":t}),s.jsx("span",{className:"text-muted-foreground",children:a("shop.points")})]}),s.jsx(ns,{})]})})]})}),h.length===0?s.jsx(w,{children:s.jsxs(_,{className:"py-12 text-center",children:[s.jsx(k,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),s.jsx("p",{className:"text-muted-foreground",children:a("shop.noItems")})]})}):s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:h.map(e=>{const c=e.stock!==null&&e.stock<=0,i=C(e),o=i<=0,j=t<e.points_cost;return s.jsxs(w,{className:`overflow-hidden ${c?"opacity-60":""}`,children:[e.image_url&&s.jsx("div",{className:"aspect-video overflow-hidden bg-secondary/30",children:s.jsx("img",{src:e.image_url,alt:String(l(e,"name")),className:"w-full h-full object-cover"})}),s.jsx(Q,{className:"pb-2",children:s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx(W,{className:"text-lg line-clamp-1",children:l(e,"name")}),s.jsx(X,{className:"line-clamp-2 mt-1",children:l(e,"description")})]}),s.jsxs(S,{variant:"secondary",className:"flex items-center gap-1 shrink-0",children:[y(e.item_type),s.jsx("span",{className:"hidden sm:inline",children:r(e.item_type)})]})]})}),s.jsxs(_,{className:"pt-0",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(f,{className:"w-4 h-4 text-accent"}),s.jsx("span",{className:"font-bold text-lg",children:e.points_cost}),s.jsx("span",{className:"text-muted-foreground text-sm",children:a("shop.points")})]}),s.jsx("div",{className:"text-sm text-muted-foreground",children:e.stock!==null?c?s.jsx(S,{variant:"destructive",children:a("shop.soldOut")}):s.jsxs("span",{children:[a("shop.stock"),": ",e.stock]}):s.jsx("span",{children:a("shop.unlimited")})})]}),s.jsxs("div",{className:"text-sm text-muted-foreground mb-3",children:[e.limit_refresh_period==="none"?s.jsx("span",{children:a("shop.limitTotal",{count:e.per_user_limit})}):s.jsx("span",{children:a(`shop.limit.${e.limit_refresh_period}`,{count:e.per_user_limit})}),n&&!c&&s.jsxs("span",{className:"ml-2",children:["(",a("shop.remaining"),": ",i,")"]})]}),s.jsx(P,{className:"w-full",disabled:!I(e),onClick:()=>T(e),children:a(n?c?"shop.soldOut":o?"shop.limitReached":j?"shop.insufficientPoints":"shop.purchase":"shop.loginToPurchase")})]})]},e.id)})})]}),g&&s.jsx(ls,{open:v,onOpenChange:N,item:g,userPoints:t})]})};export{Cs as default};
