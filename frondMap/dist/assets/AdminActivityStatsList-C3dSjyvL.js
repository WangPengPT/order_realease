import{p as P,u as V,r as z,s as o,j as e,cC as A,b0 as E,bS as v,bG as b,bu as w,cn as S}from"./vendor-react-87iFmKFJ.js";import{s as m,S as N,a8 as k,a9 as U,aa as B,ab as G,ac as h,C as u,p as x,n as H,F as Q,i as $}from"./index-C3xfGQgV.js";import{u as J}from"./useLocalizedContent-CFh79NZC.js";import{f as y,s as q}from"./vendor-utils-vwQGbBim.js";import"./vendor-i18n-AOdgFpXS.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-CQWbleDe.js";const ae=()=>{const{t:i}=P(),C=V(),{getLocalizedField:_}=J(),[d,F]=z.useState("30days"),O=()=>{const s=new Date;switch(d){case"today":return y(s).toISOString();case"7days":return y(q(s,6)).toISOString();case"30days":return y(q(s,29)).toISOString();default:return null}},{data:t,isLoading:D}=o({queryKey:["admin-activities-stats-list"],queryFn:async()=>{const{data:s,error:a}=await m.from("activities").select("*").neq("status","draft").order("created_at",{ascending:!1});if(a)throw a;return s}}),c=O(),{data:g}=o({queryKey:["admin-all-subscription-counts",d,t?.map(s=>s.id)],queryFn:async()=>{if(!t?.length)return{};const s={};return await Promise.all(t.map(async a=>{let r=m.from("subscriptions").select("*",{count:"exact",head:!0}).eq("activity_id",a.id);c&&(r=r.gte("created_at",c));const{count:n,error:l}=await r;!l&&n!==null&&(s[a.id]=n)})),s},enabled:!!t?.length}),{data:j}=o({queryKey:["admin-all-share-counts",d,t?.map(s=>s.id)],queryFn:async()=>{if(!t?.length)return{};const s={};return await Promise.all(t.map(async a=>{let r=m.from("activity_shares").select("*",{count:"exact",head:!0}).eq("activity_id",a.id);c&&(r=r.gte("created_at",c));const{count:n,error:l}=await r;!l&&n!==null&&(s[a.id]=n)})),s},enabled:!!t?.length}),{data:p}=o({queryKey:["admin-all-activity-view-counts",d,t?.map(s=>s.id)],queryFn:async()=>{if(!t?.length)return{};const s={};return await Promise.all(t.map(async a=>{let r=m.from("page_views").select("*",{count:"exact",head:!0}).eq("page_type","activity").eq("target_id",a.id);c&&(r=r.gte("created_at",c));const{count:n,error:l}=await r;!l&&n!==null&&(s[a.id]=n)})),s},enabled:!!t?.length}),{data:f}=o({queryKey:["admin-all-activity-restaurant-counts",t?.map(s=>s.id)],queryFn:async()=>{if(!t?.length)return{};const s={};return await Promise.all(t.map(async a=>{const{count:r,error:n}=await m.from("activity_restaurants").select("*",{count:"exact",head:!0}).eq("activity_id",a.id);!n&&r!==null&&(s[a.id]=r)})),s},enabled:!!t?.length}),T=p?Object.values(p).reduce((s,a)=>s+a,0):0,K=g?Object.values(g).reduce((s,a)=>s+a,0):0,L=j?Object.values(j).reduce((s,a)=>s+a,0):0,R=f?Object.values(f).reduce((s,a)=>s+a,0):0;return D?e.jsxs("div",{className:"space-y-6",children:[e.jsx(N,{className:"h-8 w-48"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[1,2,3,4].map(s=>e.jsx(N,{className:"h-24"},s))}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(s=>e.jsx(N,{className:"h-40"},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-2xl font-bold",children:i("admin.activityStatistics")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(k,{value:d,onValueChange:s=>F(s),children:[e.jsx(U,{className:"w-[140px]",children:e.jsx(B,{})}),e.jsxs(G,{children:[e.jsx(h,{value:"today",children:i("analytics.today","今日")}),e.jsx(h,{value:"7days",children:i("analytics.last7Days","近7天")}),e.jsx(h,{value:"30days",children:i("analytics.last30Days","近30天")}),e.jsx(h,{value:"all",children:i("analytics.allTime","所有时间")})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(u,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(v,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:i("admin.totalViews")}),e.jsx("p",{className:"text-2xl font-bold",children:T})]})]})})}),e.jsx(u,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-500/10 rounded-lg",children:e.jsx(b,{className:"h-5 w-5 text-red-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:i("admin.totalSubscribers")}),e.jsx("p",{className:"text-2xl font-bold",children:K})]})]})})}),e.jsx(u,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-500/10 rounded-lg",children:e.jsx(w,{className:"h-5 w-5 text-green-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:i("admin.totalShares")}),e.jsx("p",{className:"text-2xl font-bold",children:L})]})]})})}),e.jsx(u,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-500/10 rounded-lg",children:e.jsx(S,{className:"h-5 w-5 text-amber-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:i("admin.participatingRestaurants")}),e.jsx("p",{className:"text-2xl font-bold",children:R})]})]})})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:i("admin.allActivities")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t?.map(s=>{const a=_(s,"title"),r=p?.[s.id]||0,n=g?.[s.id]||0,l=j?.[s.id]||0,I=f?.[s.id]||0;return e.jsxs(u,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>C(`/admin/activity-stats/${s.id}`),children:[e.jsx(H,{className:"pb-2",children:e.jsx(Q,{className:"text-base line-clamp-2",children:a})}),e.jsxs(x,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[r," ",i("admin.views")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[n," ",i("admin.subscribers")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[l," ",i("admin.shares")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[I," ",i("admin.restaurants")]})]})]}),e.jsx($,{variant:"outline",size:"sm",className:"w-full mt-4",children:i("admin.viewDetails")})]})]},s.id)})})]})]})};export{ae as default};
//# sourceMappingURL=AdminActivityStatsList-C3dSjyvL.js.map
