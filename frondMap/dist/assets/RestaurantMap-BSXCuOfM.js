import{j as f}from"./vendor-ui-DmpovMYY.js";import{r as c}from"./vendor-react-iAJ0IrSD.js";import{m as d}from"./vendor-map-BaCLwlqt.js";/* empty css                  */import{c as S,m as $}from"./geolocation-DRm3QMsJ.js";import{t as W,a4 as x,ar as z,B as O,g as P}from"./index-CLDmU-vQ.js";import{u as B}from"./vendor-i18n-DxKeo2S1.js";const F=({restaurants:w,onRestaurantClick:R,userLocation:t,radiusFilter:y,onMapInit:I,onMarkerClick:k,showViewDetailsButton:E=!1})=>{const{i18n:N,t:u}=B(),h=c.useRef(null),r=c.useRef(null),b=c.useRef([]),[g,j]=c.useState(!1),[T,v]=c.useState(null),s=c.useRef(null);return c.useEffect(()=>{if(!h.current||r.current)return;const n="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";if(!(()=>{try{const l=document.createElement("canvas");return l.getContext("webgl")||l.getContext("experimental-webgl")?d.supported():(console.warn("[RestaurantMap] WebGL context creation failed"),!1)}catch(l){return console.warn("[RestaurantMap] WebGL check error:",l),!1}})()){console.warn("[RestaurantMap] WebGL not supported",{isIOSDevice:W(),isIOSWebView:x(),userAgent:navigator.userAgent}),v(u("map.webglNotSupported","Your browser does not support map display"));return}let a=0;const i=30,o=()=>{if(!h.current)return;const l=h.current.getBoundingClientRect();if(l.width===0||l.height===0){if(a++,a>=i){console.error("[RestaurantMap] Container never got valid dimensions after",i,"retries"),x()?v(u("map.loadError","Map failed to load")):setTimeout(o,500);return}setTimeout(o,100);return}try{d.accessToken=n;const p=t?[t.lng,t.lat]:[-9.1393,38.7223];r.current=new d.Map({container:h.current,style:"mapbox://styles/mapbox/light-v11",center:p,zoom:13,cooperativeGestures:!0,doubleClickZoom:!1,fadeDuration:x()?0:300,preserveDrawingBuffer:x()}),r.current.on("error",M=>{console.error("[RestaurantMap] Map error:",M),v(u("map.loadError","Map failed to load"))}),r.current.addControl(new d.NavigationControl({visualizePitch:!0}),"top-right"),r.current.on("load",()=>{j(!0),I&&r.current&&I(r.current)})}catch(p){console.error("[RestaurantMap] Failed to initialize map:",p),v(u("map.loadError","Map failed to load"))}};return x()?setTimeout(o,200):o(),()=>{b.current.forEach(l=>l.remove()),b.current=[],s.current&&(s.current.remove(),s.current=null),r.current?.remove(),r.current=null,j(!1)}},[]),c.useEffect(()=>{r.current&&t&&g&&r.current.flyTo({center:[t.lng,t.lat],zoom:14,duration:1500})},[t,g]),c.useEffect(()=>{if(!r.current||!g)return;b.current.forEach(e=>e.remove()),b.current=[],s.current&&(s.current.remove(),s.current=null);let n=w;if(t&&y&&(n=w.filter(e=>S(t.lat,t.lng,e.lat,e.lng)<=y)),n.forEach(e=>{const a=document.createElement("div");a.className="p-3 min-w-[200px]",a.innerHTML=`
        <div class="space-y-2">
          <h3 class="font-bold text-base text-foreground">${e.name}</h3>
          ${e.type&&e.type.length>0?`
            <div class="flex flex-wrap gap-1">
              ${e.type.slice(0,2).map(m=>`<span class="text-xs bg-secondary text-secondary-foreground px-2 py-0.5 rounded">${m}</span>`).join("")}
            </div>
          `:""}
          ${e.rating?`
            <div class="flex items-center gap-1">
              <span style="color: #016450;">‚≠ê</span>
              <span class="font-semibold text-sm">${e.rating.toFixed(1)}</span>
            </div>
          `:""}
          <p class="text-xs text-muted-foreground">${e.address}</p>
          ${E?`
            <button 
              id="view-details-${e.id}" 
              class="w-full mt-2 px-3 py-1.5 text-sm font-medium text-white rounded-md transition-colors"
              style="background-color: #016450;"
              onmouseover="this.style.opacity='0.9'"
              onmouseout="this.style.opacity='1'"
            >
              ${u("restaurants.viewDetails")}
            </button>
          `:""}
        </div>
      `;const i=new d.Popup({offset:25,closeButton:!0,closeOnClick:!1,closeOnMove:!1,maxWidth:"300px"}).setLngLat([e.lng,e.lat]).setDOMContent(a),o=document.createElement("div");o.className="custom-marker",o.style.backgroundImage=`url(${$})`,o.style.width="40px",o.style.height="40px",o.style.backgroundSize="contain",o.style.backgroundRepeat="no-repeat",o.style.backgroundPosition="center",o.style.cursor="pointer";const l=new d.Marker({element:o,draggable:!1}).setLngLat([e.lng,e.lat]).addTo(r.current),p=l.getElement();p.style.cursor="pointer";const M=m=>{m.stopPropagation(),m.preventDefault(),s.current&&s.current!==i&&s.current.remove(),i.addTo(r.current),s.current=i,r.current.easeTo({center:[e.lng,e.lat],zoom:17,duration:800}),k&&k(e)};p.addEventListener("click",M,!0),E&&i.on("open",()=>{const m=document.getElementById(`view-details-${e.id}`);m&&m.addEventListener("click",C=>{C.stopPropagation(),R(e)})}),i.on("close",()=>{s.current===i&&(s.current=null)}),b.current.push(l)}),n.length>0){const e=new d.LngLatBounds;n.forEach(a=>{e.extend([a.lng,a.lat])}),t&&e.extend([t.lng,t.lat]),r.current.fitBounds(e,{padding:50,maxZoom:15})}},[w,y,t,g,R,N.language,E,u,k]),c.useEffect(()=>{if(!r.current||!t||!g)return;const n=document.createElement("div");n.className="user-location-marker",n.style.backgroundColor="#3b82f6",n.style.width="20px",n.style.height="20px",n.style.borderRadius="50%",n.style.border="3px solid white",n.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)";const e=new d.Marker(n).setLngLat([t.lng,t.lat]).addTo(r.current);return()=>{e.remove()}},[t,g]),T?f.jsxs("div",{className:"w-full h-full rounded-lg overflow-hidden bg-muted/50 flex flex-col items-center justify-center p-6 text-center",children:[f.jsx(z,{className:"w-12 h-12 text-muted-foreground mb-4"}),f.jsx("p",{className:"text-muted-foreground mb-2",children:T}),f.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:u("map.viewListInstead","Please view the restaurant list below")}),x()&&f.jsxs(O,{variant:"outline",size:"sm",onClick:()=>window.open(window.location.href,"_blank"),children:[f.jsx(P,{className:"w-4 h-4 mr-2"}),u("map.openInBrowser","Open in Browser")]})]}):f.jsx("div",{ref:h,className:"w-full h-full rounded-lg overflow-hidden",style:{minHeight:"300px",WebkitTransform:"translateZ(0)"}})};export{F as R};
//# sourceMappingURL=RestaurantMap-BSXCuOfM.js.map
