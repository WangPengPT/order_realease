{"version":3,"file":"PostDetail-D870brjK.js","sources":["../../src/components/community/PostCard.tsx","../../src/pages/PostDetail.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { formatDistanceToNow } from \"date-fns\";\r\nimport { zhCN, enUS, pt } from \"date-fns/locale\";\r\nimport { Heart, MessageCircle, Share2, MoreHorizontal, Calendar, X, ChevronLeft, ChevronRight, MapPin, FileImage } from \"lucide-react\";\r\nimport {\r\n  Carousel,\r\n  CarouselContent,\r\n  CarouselItem,\r\n  type CarouselApi,\r\n} from \"@/components/ui/carousel\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardFooter, CardHeader } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuTrigger,\r\n} from \"@/components/ui/dropdown-menu\";\r\nimport { CommunityPost, useLikePost, useSharePost, useDeletePost } from \"@/hooks/useCommunityPosts\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { toast } from \"sonner\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport TranslateButton from \"@/components/TranslateButton\";\r\n\r\ninterface PostCardProps {\r\n  post: CommunityPost;\r\n  showActions?: boolean;\r\n  isDetailPage?: boolean;\r\n}\r\n\r\nconst PostCard = ({ post, showActions = true, isDetailPage = false }: PostCardProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const { user } = useAuth();\r\n  const navigate = useNavigate();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const likePost = useLikePost();\r\n  const sharePost = useSharePost();\r\n  const deletePost = useDeletePost();\r\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\r\n  const [imageError, setImageError] = useState<Record<string, boolean>>({});\r\n  const [previewOpen, setPreviewOpen] = useState(false);\r\n  const [previewIndex, setPreviewIndex] = useState(0);\r\n  const [carouselApi, setCarouselApi] = useState<CarouselApi>();\r\n  const [previewCarouselApi, setPreviewCarouselApi] = useState<CarouselApi>();\r\n  const [currentSlide, setCurrentSlide] = useState(0);\r\n  const [translatedContent, setTranslatedContent] = useState<string | null>(null);\r\n  const [touchStartX, setTouchStartX] = useState<number | null>(null);\r\n  const [isSwiping, setIsSwiping] = useState(false);\r\n  const [swipeOffset, setSwipeOffset] = useState(0);\r\n  const [isAnimating, setIsAnimating] = useState(false);\r\n  const [imageDimensions, setImageDimensions] = useState<Record<string, { width: number; height: number }>>({});\r\n  const [longImageScrollStart, setLongImageScrollStart] = useState<{ y: number; scrollTop: number } | null>(null);\r\n\r\n  // Lock body scroll when preview is open\r\n  useEffect(() => {\r\n    if (previewOpen) {\r\n      const scrollY = window.scrollY;\r\n      document.body.style.position = 'fixed';\r\n      document.body.style.top = `-${scrollY}px`;\r\n      document.body.style.left = '0';\r\n      document.body.style.right = '0';\r\n      document.body.style.overflow = 'hidden';\r\n      \r\n      return () => {\r\n        document.body.style.position = '';\r\n        document.body.style.top = '';\r\n        document.body.style.left = '';\r\n        document.body.style.right = '';\r\n        document.body.style.overflow = '';\r\n        window.scrollTo(0, scrollY);\r\n      };\r\n    }\r\n  }, [previewOpen]);\r\n\r\n  // Listen to carousel slide changes\r\n  useEffect(() => {\r\n    if (!carouselApi) return;\r\n    \r\n    setCurrentSlide(carouselApi.selectedScrollSnap());\r\n    \r\n    carouselApi.on(\"select\", () => {\r\n      setCurrentSlide(carouselApi.selectedScrollSnap());\r\n    });\r\n  }, [carouselApi]);\r\n\r\n  const getDateLocale = () => {\r\n    switch (i18n.language) {\r\n      case \"zh\":\r\n        return zhCN;\r\n      case \"pt\":\r\n        return pt;\r\n      default:\r\n        return enUS;\r\n    }\r\n  };\r\n\r\n  const handleLike = () => {\r\n    if (!user) return;\r\n    likePost.mutate({ postId: post.id, liked: post.user_liked || false });\r\n  };\r\n\r\n  const handleShare = async () => {\r\n    const shareUrl = `${window.location.origin}/community/${post.id}`;\r\n    \r\n    if (navigator.share) {\r\n      try {\r\n        await navigator.share({\r\n          title: t(\"community.shareTitle\", \"分享帖子\"),\r\n          url: shareUrl,\r\n        });\r\n        if (user) {\r\n          sharePost.mutate(post.id);\r\n        }\r\n        toast.success(t(\"community.shareSuccess\", \"分享成功\"));\r\n      } catch (error: any) {\r\n        // User cancelled or share failed - fallback to copy\r\n        if (error?.name !== \"AbortError\") {\r\n          await navigator.clipboard.writeText(shareUrl);\r\n          toast.success(t(\"community.linkCopied\", \"链接已复制到剪贴板\"));\r\n          if (user) {\r\n            sharePost.mutate(post.id);\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      // Fallback: copy to clipboard\r\n      try {\r\n        await navigator.clipboard.writeText(shareUrl);\r\n        toast.success(t(\"community.linkCopied\", \"链接已复制到剪贴板\"));\r\n        if (user) {\r\n          sharePost.mutate(post.id);\r\n        }\r\n      } catch (error) {\r\n        toast.error(t(\"community.shareFailed\", \"分享失败\"));\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleDelete = () => {\r\n    deletePost.mutate(post.id);\r\n    setShowDeleteDialog(false);\r\n  };\r\n\r\n  const handleImageClick = (index: number) => {\r\n    if (isDetailPage) {\r\n      // On detail page, open preview\r\n      setPreviewIndex(index);\r\n      setPreviewOpen(true);\r\n    } else {\r\n      // On feed, navigate to post detail\r\n      navigate(`/community/${post.id}`);\r\n    }\r\n  };\r\n\r\n  const handlePrevImage = () => {\r\n    if (isAnimating) return;\r\n    setIsAnimating(true);\r\n    setSwipeOffset(window.innerWidth);\r\n    setTimeout(() => {\r\n      setPreviewIndex((prev) => \r\n        prev === 0 ? (post.image_urls?.length || 1) - 1 : prev - 1\r\n      );\r\n      setSwipeOffset(0);\r\n      setIsAnimating(false);\r\n    }, 250);\r\n  };\r\n\r\n  const handleNextImage = () => {\r\n    if (isAnimating) return;\r\n    setIsAnimating(true);\r\n    setSwipeOffset(-window.innerWidth);\r\n    setTimeout(() => {\r\n      setPreviewIndex((prev) => \r\n        prev === (post.image_urls?.length || 1) - 1 ? 0 : prev + 1\r\n      );\r\n      setSwipeOffset(0);\r\n      setIsAnimating(false);\r\n    }, 250);\r\n  };\r\n\r\n  const handleImageLoad = (e: React.SyntheticEvent<HTMLImageElement>, url: string) => {\r\n    const img = e.currentTarget;\r\n    setImageDimensions(prev => ({\r\n      ...prev,\r\n      [url]: { width: img.naturalWidth, height: img.naturalHeight }\r\n    }));\r\n  };\r\n\r\n  const isLongImage = (url: string) => {\r\n    const dims = imageDimensions[url];\r\n    return dims ? dims.height / dims.width > 1.5 : false;\r\n  };\r\n\r\n  const isAuthor = user?.id === post.author_id;\r\n  const activityTitle = post.activity\r\n    ? getLocalizedField(post.activity, \"title\")\r\n    : null;\r\n  const restaurantName = post.restaurant\r\n    ? getLocalizedField(post.restaurant, \"name\")\r\n    : null;\r\n\r\n  // Get localized content - prioritize pre-stored translations\r\n  const localizedContent = getLocalizedField(post, \"content\");\r\n  \r\n  // Check if we have a pre-stored translation for current language\r\n  const hasLocalizedTranslation = \r\n    (i18n.language === \"zh\" && post.content_zh) ||\r\n    (i18n.language === \"en\" && post.content_en) ||\r\n    (i18n.language === \"pt\" && post.content_pt);\r\n  \r\n  // Use localized content, or translated content, or original\r\n  const displayContent = translatedContent || localizedContent || post.content;\r\n\r\n  return (\r\n    <>\r\n      <Card className=\"overflow-hidden\">\r\n        <CardHeader className=\"pb-3\">\r\n          <div className=\"flex items-start justify-between\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <Avatar className=\"h-10 w-10\">\r\n                <AvatarImage src={post.author?.avatar_url || undefined} />\r\n                <AvatarFallback>\r\n                  {post.author?.display_name?.charAt(0) || \"?\"}\r\n                </AvatarFallback>\r\n              </Avatar>\r\n              <div>\r\n                <p className=\"font-medium text-sm\">{post.author?.display_name}</p>\r\n                <p className=\"text-xs text-muted-foreground\">\r\n                  {formatDistanceToNow(new Date(post.created_at), {\r\n                    addSuffix: true,\r\n                    locale: getDateLocale(),\r\n                  })}\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {showActions && isAuthor && (\r\n              <DropdownMenu>\r\n                <DropdownMenuTrigger asChild>\r\n                  <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\r\n                    <MoreHorizontal className=\"h-4 w-4\" />\r\n                  </Button>\r\n                </DropdownMenuTrigger>\r\n                <DropdownMenuContent align=\"end\">\r\n                  <DropdownMenuItem\r\n                    onClick={() => setShowDeleteDialog(true)}\r\n                    className=\"text-destructive\"\r\n                  >\r\n                    {t(\"common.delete\", \"删除\")}\r\n                  </DropdownMenuItem>\r\n                </DropdownMenuContent>\r\n              </DropdownMenu>\r\n            )}\r\n          </div>\r\n        </CardHeader>\r\n\r\n        <CardContent className=\"pt-0 pb-3\">\r\n          {/* Activity & Restaurant Badges */}\r\n          {(post.activity || post.restaurant) && (\r\n            <div className=\"flex flex-wrap gap-2 mb-3\">\r\n              {post.activity && (\r\n                <Link to={`/activity/${post.activity.id}`}>\r\n                  <Badge variant=\"secondary\" className=\"gap-1\">\r\n                    <Calendar className=\"h-3 w-3\" />\r\n                    {activityTitle}\r\n                  </Badge>\r\n                </Link>\r\n              )}\r\n              {post.restaurant && (\r\n                <Link to={`/restaurant/${post.restaurant.id}`}>\r\n                  <Badge variant=\"secondary\" className=\"gap-1\">\r\n                    <MapPin className=\"h-3 w-3\" />\r\n                    {restaurantName}\r\n                  </Badge>\r\n                </Link>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Content */}\r\n          <Link to={`/community/${post.id}`}>\r\n            <div\r\n              className=\"prose prose-sm max-w-none dark:prose-invert\"\r\n              dangerouslySetInnerHTML={{ __html: displayContent }}\r\n            />\r\n          </Link>\r\n\r\n          {/* Translate Button - only show if no pre-stored translation */}\r\n          {!hasLocalizedTranslation && (\r\n            <TranslateButton \r\n              text={post.content} \r\n              onTranslation={setTranslatedContent}\r\n              className=\"mt-1\"\r\n            />\r\n          )}\r\n\r\n          {/* Images - Carousel only for multiple images */}\r\n          {/* In detail page with video, filter out auto-generated cover images */}\r\n          {(() => {\r\n            const displayImageUrls = isDetailPage && post.video_url\r\n              ? (post.image_urls || []).filter(url => !url.includes('-cover'))\r\n              : post.image_urls;\r\n            \r\n            if (!displayImageUrls || displayImageUrls.length === 0) return null;\r\n            \r\n            return (\r\n              <div className=\"relative mt-3\">\r\n                {displayImageUrls.length === 1 ? (\r\n                  // Single image - smart display based on aspect ratio\r\n                  (() => {\r\n                    const url = displayImageUrls[0];\r\n                    const isLong = isLongImage(url);\r\n                    return (\r\n                      <div \r\n                        className={`relative overflow-hidden rounded-lg cursor-pointer ${\r\n                          isLong ? \"max-h-[500px]\" : \"aspect-square\"\r\n                        }`}\r\n                        onClick={() => handleImageClick(0)}\r\n                      >\r\n                        {!imageError[url] ? (\r\n                          <>\r\n                            <img\r\n                              src={url}\r\n                              alt=\"\"\r\n                              className={`w-full ${isLong ? \"h-auto object-contain\" : \"h-full object-cover\"}`}\r\n                              onLoad={(e) => handleImageLoad(e, url)}\r\n                              onError={() =>\r\n                                setImageError((prev) => ({ ...prev, [url]: true }))\r\n                              }\r\n                            />\r\n                            {/* Long image indicator */}\r\n                            {isLong && (\r\n                              <div className=\"absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full flex items-center gap-1\">\r\n                                <FileImage className=\"h-3 w-3\" />\r\n                                <span>{t(\"community.longImage\", \"长图\")}</span>\r\n                              </div>\r\n                            )}\r\n                          </>\r\n                        ) : (\r\n                          <div className=\"w-full h-full min-h-[200px] bg-muted flex items-center justify-center\">\r\n                            <span className=\"text-xs text-muted-foreground\">\r\n                              {t(\"common.imageLoadError\", \"图片加载失败\")}\r\n                            </span>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    );\r\n                  })()\r\n                ) : (\r\n                  // Multiple images - use carousel with smart display\r\n                  <>\r\n                    <Carousel \r\n                      setApi={setCarouselApi} \r\n                      className=\"w-full\"\r\n                      opts={{ loop: true }}\r\n                    >\r\n                      <CarouselContent className=\"-ml-0\">\r\n                        {displayImageUrls.map((url, index) => {\r\n                          const isLong = isLongImage(url);\r\n                          return (\r\n                            <CarouselItem key={index} className=\"pl-0\">\r\n                              <div \r\n                                className={`relative overflow-hidden rounded-lg cursor-pointer ${\r\n                                  isLong ? \"max-h-[500px]\" : \"aspect-square\"\r\n                                }`}\r\n                                onClick={() => handleImageClick(index)}\r\n                              >\r\n                                {!imageError[url] ? (\r\n                                  <>\r\n                                    <img\r\n                                      src={url}\r\n                                      alt=\"\"\r\n                                      className={`w-full ${isLong ? \"h-auto object-contain\" : \"h-full object-cover\"}`}\r\n                                      onLoad={(e) => handleImageLoad(e, url)}\r\n                                      onError={() =>\r\n                                        setImageError((prev) => ({ ...prev, [url]: true }))\r\n                                      }\r\n                                    />\r\n                                    {/* Long image indicator */}\r\n                                    {isLong && (\r\n                                      <div className=\"absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full flex items-center gap-1\">\r\n                                        <FileImage className=\"h-3 w-3\" />\r\n                                        <span>{t(\"community.longImage\", \"长图\")}</span>\r\n                                      </div>\r\n                                    )}\r\n                                  </>\r\n                                ) : (\r\n                                  <div className=\"w-full h-full min-h-[200px] bg-muted flex items-center justify-center\">\r\n                                    <span className=\"text-xs text-muted-foreground\">\r\n                                      {t(\"common.imageLoadError\", \"图片加载失败\")}\r\n                                    </span>\r\n                                  </div>\r\n                                )}\r\n                              </div>\r\n                            </CarouselItem>\r\n                          );\r\n                        })}\r\n                      </CarouselContent>\r\n                    </Carousel>\r\n                    \r\n                    {/* Top-right slide counter */}\r\n                    <div className=\"absolute top-3 right-3 bg-black/60 text-white text-xs px-2 py-1 rounded-full z-10\">\r\n                      {currentSlide + 1}/{displayImageUrls.length}\r\n                    </div>\r\n                    \r\n                    {/* Bottom navigation dots */}\r\n                    <div className=\"flex justify-center gap-1.5 mt-2\">\r\n                      {displayImageUrls.map((_, index) => (\r\n                        <button\r\n                          key={index}\r\n                          className={`w-1.5 h-1.5 rounded-full transition-colors ${\r\n                            index === currentSlide \r\n                              ? \"bg-primary\" \r\n                              : \"bg-muted-foreground/30\"\r\n                          }`}\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            carouselApi?.scrollTo(index);\r\n                          }}\r\n                        />\r\n                      ))}\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </div>\r\n            );\r\n          })()}\r\n\r\n          {/* Video */}\r\n          {post.video_url && (\r\n            <div className=\"mt-3 rounded-lg overflow-hidden bg-gray-900\">\r\n              <video\r\n                src={post.video_url}\r\n                {...(post.image_urls?.length ? { poster: post.image_urls[0] } : {})}\r\n                controls\r\n                className=\"w-full max-h-96\"\r\n                preload=\"metadata\"\r\n                playsInline\r\n              />\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n\r\n        <CardFooter className=\"pt-0 border-t\">\r\n          <div className=\"flex items-center gap-4 pt-3 w-full\">\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              className={`gap-2 ${post.user_liked ? \"text-red-500\" : \"\"}`}\r\n              onClick={handleLike}\r\n              disabled={!user}\r\n            >\r\n              <Heart\r\n                className={`h-4 w-4 ${post.user_liked ? \"fill-current\" : \"\"}`}\r\n              />\r\n              <span>{post.likes_count}</span>\r\n            </Button>\r\n\r\n            <Link to={`/community/${post.id}`}>\r\n              <Button variant=\"ghost\" size=\"sm\" className=\"gap-2\">\r\n                <MessageCircle className=\"h-4 w-4\" />\r\n                <span>{post.comments_count}</span>\r\n              </Button>\r\n            </Link>\r\n\r\n            <Button variant=\"ghost\" size=\"sm\" className=\"gap-2\" onClick={handleShare}>\r\n              <Share2 className=\"h-4 w-4\" />\r\n              <span>{post.shares_count}</span>\r\n            </Button>\r\n          </div>\r\n        </CardFooter>\r\n      </Card>\r\n\r\n      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"common.confirmDelete\", \"确认删除\")}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"community.deleteWarning\", \"删除后无法恢复，确定要删除这篇帖子吗？\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>{t(\"common.cancel\", \"取消\")}</AlertDialogCancel>\r\n            <AlertDialogAction onClick={handleDelete}>\r\n              {t(\"common.delete\", \"删除\")}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Image Preview - Using Carousel for smooth swipe like feed */}\r\n      {previewOpen && createPortal(\r\n        <div \r\n          className=\"fixed inset-0 z-[100] bg-black overflow-hidden\"\r\n          onClick={(e) => {\r\n            // Only close if clicking on backdrop, not carousel\r\n            if (e.target === e.currentTarget) {\r\n              setPreviewOpen(false);\r\n            }\r\n          }}\r\n          onWheel={(e) => e.stopPropagation()}\r\n          onTouchMove={(e) => e.stopPropagation()}\r\n        >\r\n          {/* Image Counter */}\r\n          {post.image_urls && post.image_urls.length > 1 && (\r\n            <div className=\"absolute top-4 left-1/2 -translate-x-1/2 z-10 text-white text-sm bg-black/50 px-4 py-1.5 rounded-full\">\r\n              {previewIndex + 1} / {post.image_urls.length}\r\n            </div>\r\n          )}\r\n\r\n          {/* Close Button */}\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"icon\"\r\n            className=\"absolute top-4 right-4 z-10 text-white hover:bg-white/20\"\r\n            onClick={() => setPreviewOpen(false)}\r\n          >\r\n            <X className=\"h-6 w-6\" />\r\n          </Button>\r\n\r\n          {/* Full screen Carousel - centered with calc() constraints */}\r\n          <div className=\"absolute inset-0 flex items-center justify-center\">\r\n            <Carousel\r\n              className=\"w-full\"\r\n              opts={{ loop: true }}\r\n              setApi={(api) => {\r\n                setPreviewCarouselApi(api);\r\n                if (api) {\r\n                  api.on(\"select\", () => {\r\n                    setPreviewIndex(api.selectedScrollSnap());\r\n                  });\r\n                }\r\n              }}\r\n            >\r\n              <CarouselContent className=\"-ml-0\">\r\n                {post.image_urls?.map((url, index) => {\r\n                  const dims = imageDimensions[url];\r\n                  const isLong = dims ? dims.height / dims.width > 1.5 : false;\r\n                  return (\r\n                    <CarouselItem key={index} className=\"pl-0 flex items-center justify-center\">\r\n                      {isLong ? (\r\n                        <div \r\n                          className=\"w-full h-screen overflow-y-auto overscroll-contain\"\r\n                          onMouseDown={(e) => {\r\n                            const target = e.currentTarget;\r\n                            setLongImageScrollStart({ y: e.clientY, scrollTop: target.scrollTop });\r\n                          }}\r\n                          onMouseUp={(e) => {\r\n                            if (longImageScrollStart) {\r\n                              const deltaY = Math.abs(e.clientY - longImageScrollStart.y);\r\n                              const deltaScroll = Math.abs(e.currentTarget.scrollTop - longImageScrollStart.scrollTop);\r\n                              if (deltaY < 10 && deltaScroll < 10) {\r\n                                setPreviewOpen(false);\r\n                              }\r\n                              setLongImageScrollStart(null);\r\n                            }\r\n                          }}\r\n                          onTouchStart={(e) => {\r\n                            const target = e.currentTarget;\r\n                            setLongImageScrollStart({ y: e.touches[0].clientY, scrollTop: target.scrollTop });\r\n                          }}\r\n                          onTouchEnd={(e) => {\r\n                            if (longImageScrollStart) {\r\n                              const touch = e.changedTouches[0];\r\n                              const deltaY = Math.abs(touch.clientY - longImageScrollStart.y);\r\n                              const deltaScroll = Math.abs(e.currentTarget.scrollTop - longImageScrollStart.scrollTop);\r\n                              // Use a slightly larger threshold for touch to account for touch inaccuracy\r\n                              if (deltaY < 15 && deltaScroll < 15) {\r\n                                e.preventDefault();\r\n                                setPreviewOpen(false);\r\n                              }\r\n                              setLongImageScrollStart(null);\r\n                            }\r\n                          }}\r\n                        >\r\n                          <div className=\"min-h-full flex flex-col items-center py-4\">\r\n                            <img\r\n                              src={url}\r\n                              alt=\"\"\r\n                              className=\"w-full max-w-[90vw] h-auto object-contain select-none pointer-events-none\"\r\n                              draggable={false}\r\n                              onLoad={(e) => handleImageLoad(e, url)}\r\n                            />\r\n                          </div>\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"w-full h-full flex items-center justify-center\">\r\n                          <img\r\n                            src={url}\r\n                            alt=\"\"\r\n                            className=\"object-contain w-screen h-screen select-none cursor-pointer\"\r\n                            draggable={false}\r\n                            onClick={() => setPreviewOpen(false)}\r\n                            onLoad={(e) => handleImageLoad(e, url)}\r\n                          />\r\n                        </div>\r\n                      )}\r\n                    </CarouselItem>\r\n                  );\r\n                })}\r\n              </CarouselContent>\r\n            </Carousel>\r\n          </div>\r\n\r\n          {/* Desktop Navigation Buttons - connected to Carousel API */}\r\n          {post.image_urls && post.image_urls.length > 1 && (\r\n            <>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"absolute left-4 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 hidden sm:flex\"\r\n                onClick={() => previewCarouselApi?.scrollPrev()}\r\n              >\r\n                <ChevronLeft className=\"h-8 w-8\" />\r\n              </Button>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"absolute right-4 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 hidden sm:flex\"\r\n                onClick={() => previewCarouselApi?.scrollNext()}\r\n              >\r\n                <ChevronRight className=\"h-8 w-8\" />\r\n              </Button>\r\n            </>\r\n          )}\r\n        </div>,\r\n        document.body\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default PostCard;\r\n","import { useParams, useNavigate } from \"react-router-dom\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { ArrowLeft, Loader2 } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport PostCard from \"@/components/community/PostCard\";\r\nimport RestaurantComments from \"@/components/RestaurantComments\";\r\nimport { useCommunityPost } from \"@/hooks/useCommunityPosts\";\r\n\r\nconst PostDetail = () => {\r\n  const { id } = useParams<{ id: string }>();\r\n  const { t } = useTranslation();\r\n  const navigate = useNavigate();\r\n  const { data: post, isLoading, error } = useCommunityPost(id || \"\");\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"container max-w-2xl mx-auto py-6 px-4 flex justify-center\">\r\n        <Loader2 className=\"h-8 w-8 animate-spin\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !post) {\r\n    return (\r\n      <div className=\"container max-w-2xl mx-auto py-6 px-4\">\r\n        <div className=\"text-center py-12\">\r\n          <p className=\"text-muted-foreground\">\r\n            {t(\"community.postNotFound\", \"帖子不存在或已被删除\")}\r\n          </p>\r\n          <Button\r\n            variant=\"outline\"\r\n            className=\"mt-4\"\r\n            onClick={() => navigate(\"/community\")}\r\n          >\r\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n            {t(\"community.backToList\", \"返回社区\")}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"container max-w-2xl mx-auto py-6 px-4\">\r\n      {/* Back Button */}\r\n      <Button\r\n        variant=\"ghost\"\r\n        size=\"sm\"\r\n        className=\"mb-4\"\r\n        onClick={() => navigate(\"/community\")}\r\n      >\r\n        <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n        {t(\"community.backToList\", \"返回社区\")}\r\n      </Button>\r\n\r\n      {/* Post Card */}\r\n      <PostCard post={post} showActions isDetailPage />\r\n\r\n      {/* Comments Section */}\r\n      <div className=\"mt-6\">\r\n        <RestaurantComments\r\n          targetId={post.id}\r\n          targetType=\"post\"\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PostDetail;\r\n"],"names":["PostCard","post","showActions","isDetailPage","t","i18n","useTranslation","user","useAuth","navigate","useNavigate","getLocalizedField","useLocalizedContent","likePost","useLikePost","sharePost","useSharePost","deletePost","useDeletePost","showDeleteDialog","setShowDeleteDialog","useState","imageError","setImageError","previewOpen","setPreviewOpen","previewIndex","setPreviewIndex","carouselApi","setCarouselApi","previewCarouselApi","setPreviewCarouselApi","currentSlide","setCurrentSlide","translatedContent","setTranslatedContent","imageDimensions","setImageDimensions","longImageScrollStart","setLongImageScrollStart","useEffect","scrollY","getDateLocale","zhCN","pt","enUS","handleLike","handleShare","shareUrl","toast","error","handleDelete","handleImageClick","index","handleImageLoad","e","url","img","prev","isLongImage","dims","isAuthor","activityTitle","restaurantName","localizedContent","hasLocalizedTranslation","displayContent","jsxs","Fragment","Card","jsx","CardHeader","Avatar","AvatarImage","AvatarFallback","DropdownMenu","DropdownMenuTrigger","Button","MoreHorizontal","DropdownMenuContent","DropdownMenuItem","CardContent","Link","Badge","Calendar","MapPin","TranslateButton","displayImageUrls","isLong","FileImage","Carousel","CarouselContent","CarouselItem","_","CardFooter","Heart","MessageCircle","Share2","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","createPortal","X","api","target","deltaY","deltaScroll","touch","ChevronLeft","ChevronRight","PostDetail","id","useParams","isLoading","useCommunityPost","Loader2","ArrowLeft","RestaurantComments"],"mappings":"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"}