import{j as e}from"./vendor-ui-BO6fjm1h.js";import{r as t}from"./vendor-react-CrHRjzzo.js";import{s as T,ai as z,ah as je,as as ge,q as d,a1 as c,ax as O,bB as H,bC as q,a0 as fe,b4 as Ne,a9 as be,aS as ve,B as r,bk as ye,L as D,cD as we,P as Ce,I as Q,a5 as ke,k as y,aB as _e,aC as Se,aD as Re,aU as Ie,cE as Ue,cF as De,D as V,c as K,d as X,e as G,aE as J,a_ as W,a$ as Y,b0 as Z,b1 as ee,b2 as se,bf as ae,aH as te,b9 as Le,bE as Be}from"./index-DPt6srxb.js";import{i as Pe,v as $e,w as Me,x as Ae,y as Ee}from"./useAdmin-D9X9Atbs.js";import{u as Fe}from"./useInfiniteScroll-1jvSebPK.js";import{u as Te,a as ze,b as Oe}from"./vendor-query-EnOED-MY.js";import{u as re}from"./vendor-i18n-DWR4v88Y.js";import{U as He}from"./UserProfileDialog-CcDZ5SOU.js";import{f as qe}from"./format-BKpO4UHC.js";import"./vendor-charts-C50LysBY.js";import"./vendor-supabase-QnE9GqXs.js";import"./separator-Cw8_ERVs.js";import"./useLocalizedContent-S0TAoDtX.js";import"./startOfDay-Dg24GAz-.js";const Qe=()=>{const{t:a}=re(),w=Te(),{data:n,isLoading:C,refetch:k}=ze({queryKey:["login-lockouts"],queryFn:async()=>{const{data:m,error:i}=await T.rpc("admin_get_locked_ips");if(i)throw i;return m||[]},refetchInterval:3e4}),_=Oe({mutationFn:async({ip:m,email:i})=>{const{data:u,error:o}=await T.rpc("admin_clear_login_lockout",{p_ip_address:m||null,p_email:i||null});if(o)throw o;return u},onSuccess:()=>{z.success(a("admin.lockoutCleared")),w.invalidateQueries({queryKey:["login-lockouts"]})},onError:()=>{z.error(a("common.error"))}});return{lockedIPs:n,isLoading:C,clearLockout:_,refetch:k}},Ve=["spam","harassment","inappropriate_content","fraud","terms_violation","other"],Ke=["spam_comments","inappropriate_language","repeated_warnings","temporary_restriction","other"],ds=()=>{const{t:a}=re(),{isAdmin:w}=je(),{data:n,isLoading:C}=Pe(),k=$e(),_=Me(),m=Ae(),i=Ee(),{lockedIPs:u,isLoading:o,clearLockout:S,refetch:ne}=Qe(),[l,L]=t.useState(""),[x,j]=t.useState({open:!1,userId:"",userName:""}),[g,B]=t.useState("other"),[f,P]=t.useState(""),[h,N]=t.useState({open:!1,userId:"",userName:""}),[b,$]=t.useState("other"),[v,M]=t.useState(""),[R,A]=t.useState("7"),[p,E]=t.useState({open:!1,userId:"",userName:"",userRole:""}),I=t.useMemo(()=>n?{total:n.length,banned:n.filter(s=>s.is_banned).length,muted:n.filter(s=>s.is_muted).length}:{total:0,banned:0,muted:0},[n]),U=t.useMemo(()=>n?n.filter(s=>l===""||s.display_name.toLowerCase().includes(l.toLowerCase())||s.phone?.toLowerCase().includes(l.toLowerCase())||s.email?.toLowerCase().includes(l.toLowerCase())):[],[n,l]),{displayedData:le,hasMore:ie,reset:F,displayedCount:oe,sentinelRef:de}=Fe({data:U,initialItemsPerPage:30,incrementPerPage:30});t.useEffect(()=>{F()},[l,F]);const ce=()=>g==="other"?f:f?`${a(`admin.banReasons.${g}`)}: ${f}`:a(`admin.banReasons.${g}`),me=()=>b==="other"?v:v?`${a(`admin.muteReasons.${b}`)}: ${v}`:a(`admin.muteReasons.${b}`),ue=()=>{x.userId&&k.mutate({userId:x.userId,banReason:ce()},{onSuccess:()=>{j({open:!1,userId:"",userName:""}),B("other"),P("")}})},xe=()=>{if(!h.userId)return;const s=R?new Date(Date.now()+parseInt(R)*24*60*60*1e3).toISOString():void 0;m.mutate({userId:h.userId,muteReason:me(),mutedUntil:s},{onSuccess:()=>{N({open:!1,userId:"",userName:""}),$("other"),M(""),A("7")}})},he=s=>{switch(s){case"admin":return"bg-primary text-primary-foreground";case"supervisor":return"bg-blue-500 text-white";case"merchant":return"bg-emerald-500 text-white";default:return"bg-muted text-muted-foreground"}},pe=s=>{switch(s){case"admin":case"supervisor":return e.jsx(Be,{className:"h-3.5 w-3.5"});case"merchant":return e.jsx(Le,{className:"h-3.5 w-3.5"});default:return e.jsx(O,{className:"h-3.5 w-3.5"})}};return C?e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:a("common.loading")})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(ge,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:a("admin.userSecurity")}),e.jsx("p",{className:"text-muted-foreground",children:a("admin.userSecurityDesc")})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(d,{className:"bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20",children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:a("admin.totalUsersLabel")}),e.jsx("p",{className:"text-2xl font-bold",children:I.total})]}),e.jsx(O,{className:"h-8 w-8 text-primary/60"})]})})}),e.jsx(d,{className:"bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200 dark:from-orange-950/20 dark:to-orange-900/20 dark:border-orange-900/30",children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:a("admin.bannedCount")}),e.jsx("p",{className:"text-2xl font-bold",children:I.banned})]}),e.jsx(H,{className:"h-8 w-8 text-orange-500"})]})})}),e.jsx(d,{className:"bg-gradient-to-br from-yellow-50 to-yellow-100 border-yellow-200 dark:from-yellow-950/20 dark:to-yellow-900/20 dark:border-yellow-900/30",children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:a("admin.mutedCount")}),e.jsx("p",{className:"text-2xl font-bold",children:I.muted})]}),e.jsx(q,{className:"h-8 w-8 text-yellow-500"})]})})})]}),e.jsxs(d,{children:[e.jsx(fe,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-red-500"}),e.jsxs("div",{children:[e.jsx(be,{className:"text-lg",children:a("admin.loginLockouts")}),e.jsx(ve,{children:a("admin.loginLockoutsDesc")})]})]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>ne(),disabled:o,children:[e.jsx(ye,{className:`h-4 w-4 mr-1 ${o?"animate-spin":""}`}),a("common.refresh")]})]})}),e.jsx(c,{children:o?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(D,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):!u||u.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-4",children:a("admin.noLockedIPs")}):e.jsx("div",{className:"space-y-3",children:u.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 dark:bg-red-950/20 rounded-lg border border-red-200 dark:border-red-900/30",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-mono text-sm truncate",children:s.ip_address}),s.email&&e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.email}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a("admin.failedAttempts"),": ",s.failed_attempts," | ",a("admin.expiresAt"),": ",qe(new Date(s.lockout_expires),"HH:mm:ss")]})]}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>S.mutate({ip:s.ip_address}),disabled:S.isPending,className:"ml-2 shrink-0",children:S.isPending?e.jsx(D,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"h-4 w-4 mr-1"}),a("admin.unlock")]})})]},s.ip_address))})})]}),e.jsx(d,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Q,{placeholder:a("admin.searchUserPlaceholder"),value:l,onChange:s=>L(s.target.value),className:"pl-10 pr-10"}),l&&e.jsx(r,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-7 w-7 p-0",onClick:()=>L(""),children:e.jsx(ke,{className:"h-4 w-4"})})]})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(y,{variant:"secondary",className:"text-xs",children:[oe," / ",U?.length||0," ",a("admin.totalUsersLabel")]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:le?.map(s=>e.jsx(d,{className:`transition-all duration-200 hover:shadow-md ${s.is_banned?"border-orange-300 bg-orange-50/50 dark:bg-orange-950/20":""} ${s.is_muted?"border-yellow-300 bg-yellow-50/50 dark:bg-yellow-950/20":""}`,children:e.jsxs(c,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(_e,{className:"h-12 w-12",children:[e.jsx(Se,{src:s.avatar_url,alt:s.display_name}),e.jsx(Re,{children:s.display_name.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h3",{className:"font-semibold truncate",children:s.display_name}),s.is_banned&&e.jsx(y,{variant:"outline",className:"text-xs text-orange-500 border-orange-300",children:a("admin.banned")}),s.is_muted&&e.jsx(y,{variant:"outline",className:"text-xs text-yellow-500 border-yellow-300",children:a("admin.muted")})]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.email}),e.jsxs(y,{className:`${he(s.role)} text-xs mt-1`,children:[pe(s.role),e.jsx("span",{className:"ml-1 capitalize",children:s.role})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4 pt-3 border-t",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>E({open:!0,userId:s.id,userName:s.display_name,userRole:s.role}),children:[e.jsx(Ie,{className:"h-4 w-4 mr-1"}),a("admin.viewProfile")]}),w&&s.role!=="admin"&&e.jsxs(e.Fragment,{children:[s.is_banned?e.jsxs(r,{variant:"outline",size:"sm",className:"text-green-600 border-green-300 hover:bg-green-50",onClick:()=>_.mutate(s.id),children:[e.jsx(Ue,{className:"h-4 w-4 mr-1"}),a("admin.unban")]}):e.jsxs(r,{variant:"outline",size:"sm",className:"text-orange-600 border-orange-300 hover:bg-orange-50",onClick:()=>j({open:!0,userId:s.id,userName:s.display_name}),children:[e.jsx(H,{className:"h-4 w-4 mr-1"}),a("admin.ban")]}),s.is_muted?e.jsxs(r,{variant:"outline",size:"sm",className:"text-green-600 border-green-300 hover:bg-green-50",onClick:()=>i.mutate(s.id),children:[e.jsx(De,{className:"h-4 w-4 mr-1"}),a("admin.unmute")]}):e.jsxs(r,{variant:"outline",size:"sm",className:"text-yellow-600 border-yellow-300 hover:bg-yellow-50",onClick:()=>N({open:!0,userId:s.id,userName:s.display_name}),children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),a("admin.mute")]})]})]})]})},s.id))}),ie&&e.jsx("div",{ref:de,className:"flex justify-center py-4",children:e.jsx(D,{className:"h-6 w-6 animate-spin text-muted-foreground"})})]}),U?.length===0&&e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:a("admin.noUsersFound")}),e.jsx(V,{open:x.open,onOpenChange:s=>j({...x,open:s}),children:e.jsxs(K,{children:[e.jsxs(X,{children:[e.jsx(G,{children:a("admin.banUser")}),e.jsx(J,{children:a("admin.banUserConfirm",{name:x.userName})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:a("admin.selectBanReason")}),e.jsxs(W,{value:g,onValueChange:B,children:[e.jsx(Y,{className:"mt-1",children:e.jsx(Z,{})}),e.jsx(ee,{children:Ve.map(s=>e.jsx(se,{value:s,children:a(`admin.banReasons.${s}`)},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:a("admin.additionalDetails")}),e.jsx(ae,{placeholder:a("admin.banReasonPlaceholder"),value:f,onChange:s=>P(s.target.value),className:"mt-1"})]})]}),e.jsxs(te,{children:[e.jsx(r,{variant:"outline",onClick:()=>j({open:!1,userId:"",userName:""}),children:a("common.cancel")}),e.jsx(r,{variant:"destructive",onClick:ue,children:a("admin.confirmBan")})]})]})}),e.jsx(V,{open:h.open,onOpenChange:s=>N({...h,open:s}),children:e.jsxs(K,{children:[e.jsxs(X,{children:[e.jsx(G,{children:a("admin.muteUser")}),e.jsx(J,{children:a("admin.muteUserConfirm",{name:h.userName})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:a("admin.muteDuration")}),e.jsx(Q,{type:"number",placeholder:"7",value:R,onChange:s=>A(s.target.value),className:"mt-1"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a("admin.muteDurationHint")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:a("admin.selectMuteReason")}),e.jsxs(W,{value:b,onValueChange:$,children:[e.jsx(Y,{className:"mt-1",children:e.jsx(Z,{})}),e.jsx(ee,{children:Ke.map(s=>e.jsx(se,{value:s,children:a(`admin.muteReasons.${s}`)},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:a("admin.additionalDetails")}),e.jsx(ae,{placeholder:a("admin.muteReasonPlaceholder"),value:v,onChange:s=>M(s.target.value),className:"mt-1"})]})]}),e.jsxs(te,{children:[e.jsx(r,{variant:"outline",onClick:()=>N({open:!1,userId:"",userName:""}),children:a("common.cancel")}),e.jsx(r,{variant:"destructive",onClick:xe,children:a("admin.confirmMute")})]})]})}),e.jsx(He,{open:p.open,onOpenChange:s=>E({...p,open:s}),userId:p.userId,userName:p.userName,userRole:p.userRole})]})};export{ds as default};
//# sourceMappingURL=AdminUserSecurity-5d18Qb2c.js.map
