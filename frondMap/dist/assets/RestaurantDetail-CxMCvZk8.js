const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RestaurantComments-B8eJXJqn.js","assets/vendor-react-Dx9aTW_3.js","assets/vendor-i18n-jtdHZIRR.js","assets/vendor-editor-B1vH4T8i.js","assets/vendor-utils-vwQGbBim.js","assets/vendor-react-CG6K1Se3.css","assets/index-YQstMq3Q.js","assets/vendor-supabase-X8tv2THq.js","assets/index-CAzVl2EL.css","assets/ReportDialog-BnMkmweQ.js","assets/input-otp-u-blEv7Q.js","assets/useSensitiveWords-DpC2XWX2.js"])))=>i.map(i=>d[i]);
import{j,C as E,p as X,q as B,F as qe,i as Ae,s as Ms,a as Ke,B as y,D as Os,c as Ls,e as $s,S as Es,l as As,g as $,_ as ms,u as Fs,G as qs,J as as,k as Bs,A as me,t as xe,v as ue,w as he,x as pe,y as ge,E as ae,o as ye,z as fe,K as Vs,L as Gs,M as Us,N as re,O as rs}from"./index-YQstMq3Q.js";import{j as e,p as H,a$ as we,bg as Ws,s as Hs,r as a,bh as Ks,bi as Qs,bb as Xs,aw as Y,ar as xs,X as us,bj as Qe,W as hs,bk as ps,bl as Ue,H as Ys,I as Zs,z as Js,B as et,F as st,bm as ne,bn as tt,bo as at,bp as rt,aY as nt,aZ as lt,L as Ce,bq as je,be as gs,br as fs,bs as it,bt as ot,b1 as ct,bu as dt,a_ as We,y as js,b3 as be,aM as _e,bv as mt,bw as xt,aO as ut,u as ht,q as pt,w as Ee,bx as ns,by as ls,bz as Ve,bA as gt,aW as Ge,bB as ft,bf as jt,b6 as bt}from"./vendor-react-Dx9aTW_3.js";import{S as He}from"./separator-CEM4TUcu.js";import{C as Z,a as J,b as ee}from"./collapsible-C5LFVTiX.js";import{d as wt,b as Nt,c as vt}from"./useRestaurants-5zimfmc1.js";import{u as bs,R as is}from"./ReportDialog-BnMkmweQ.js";import{u as Xe}from"./useLocalizedContent-CmXuRrEu.js";import{f as yt}from"./timeUtils-pgRxO0UB.js";import{g as kt,c as _t,o as Ct,m as St}from"./geolocation-DRm3QMsJ.js";import{m as ke}from"./vendor-map-CvE3ASYw.js";import{P as Tt}from"./PullToRefresh-CqdIJ3fI.js";import{u as Dt}from"./usePageView-9rxMSAy6.js";import{u as zt}from"./ShareDrawer-Bl1r5kt7.js";import{u as Rt}from"./useActivityParticipation-BGaon81i.js";import{u as Pt,R as os}from"./RestaurantFormDialog-kbIpoIwX.js";import{C as ws,a as Ns,b as vs,c as ys,d as ks}from"./carousel-CRVLY--u.js";import{D as It,a as Mt,b as Ot,c as Lt,d as $t}from"./drawer-D0igjhc6.js";import{u as Et}from"./useBrands-DshegnHO.js";import"./vendor-utils-vwQGbBim.js";import"./vendor-supabase-X8tv2THq.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-i18n-jtdHZIRR.js";import"./input-otp-u-blEv7Q.js";import"./checkbox-BkkxO9x1.js";import"./switch--7xe53rn.js";import"./radio-group-CPtkC5wM.js";import"./tabs-BXJg-F5o.js";import"./RichTextEditor-Da_m1dBp.js";const At=()=>e.jsxs("div",{className:"min-h-screen bg-background pb-8",children:[e.jsxs("div",{className:"relative h-[30vh] sm:h-[35vh] overflow-hidden",children:[e.jsx(j,{className:"w-full h-full rounded-none"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/80 to-transparent"}),e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx(j,{className:"h-10 w-10 rounded-md"})}),e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[e.jsx(j,{className:"h-10 w-10 rounded-md"}),e.jsx(j,{className:"h-10 w-10 rounded-md"})]})]}),e.jsxs("div",{className:"container mx-auto px-4 -mt-16 relative z-10",children:[e.jsxs(E,{className:"shadow-large",children:[e.jsx(X,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-3 flex flex-wrap gap-2",children:[e.jsx(j,{className:"h-6 w-16 rounded-full"}),e.jsx(j,{className:"h-6 w-20 rounded-full"}),e.jsx(j,{className:"h-6 w-14 rounded-full"})]}),e.jsx(j,{className:"h-9 w-64 mb-3"}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx(j,{className:"h-5 w-20"}),e.jsx(j,{className:"h-5 w-24"}),e.jsx(j,{className:"h-5 w-16"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{className:"h-10 w-28 rounded-md"}),e.jsx(j,{className:"h-10 w-10 rounded-md"})]})]})}),e.jsxs(B,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{className:"h-5 w-24"}),e.jsx(j,{className:"h-16 w-full rounded-md"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{className:"h-5 w-32"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{className:"h-8 w-24 rounded-full"}),e.jsx(j,{className:"h-8 w-28 rounded-full"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(j,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(j,{className:"h-5 w-full"}),e.jsx(j,{className:"h-5 w-3/4"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{className:"h-5 w-5 flex-shrink-0"}),e.jsx(j,{className:"h-5 w-32"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(j,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(j,{className:"h-5 w-40"}),e.jsx(j,{className:"h-5 w-48"})]})]})]})]})]}),e.jsxs(E,{className:"mt-6 shadow-large",children:[e.jsx(X,{children:e.jsx(j,{className:"h-6 w-20"})}),e.jsx(B,{children:e.jsx(j,{className:"h-[200px] w-full rounded-lg"})})]}),e.jsxs(E,{className:"mt-6 shadow-large",children:[e.jsx(X,{children:e.jsx(j,{className:"h-6 w-24"})}),e.jsx(B,{children:e.jsx("div",{className:"flex gap-3 overflow-hidden",children:[1,2,3,4].map(s=>e.jsx(j,{className:"h-24 w-24 rounded-lg flex-shrink-0"},s))})})]}),e.jsxs(E,{className:"mt-6 shadow-large",children:[e.jsxs(X,{className:"flex flex-row items-center justify-between",children:[e.jsx(j,{className:"h-6 w-32"}),e.jsx(j,{className:"h-9 w-24 rounded-md"})]}),e.jsx(B,{className:"space-y-4",children:[1,2,3].map(s=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx(j,{className:"h-10 w-10 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-24"}),e.jsx(j,{className:"h-4 w-16"})]}),e.jsx(j,{className:"h-4 w-full"}),e.jsx(j,{className:"h-4 w-3/4"})]})]},s))})]})]})]}),Ft=[{value:"0-5",label:"0-5€"},{value:"5-10",label:"5-10€"},{value:"10-15",label:"10-15€"},{value:"15-20",label:"15-20€"},{value:"20-25",label:"20-25€"},{value:"25-30",label:"25-30€"},{value:"30-40",label:"30-40€"},{value:"40-50",label:"40-50€"},{value:"50+",label:"50€+"}],_s=({restaurantId:s})=>{const{t:c}=H(),{data:t}=bs(s,"restaurant"),x=t?.filter(o=>o.rating_value)||[],d=x.length?x.reduce((o,u)=>o+(u.rating_value||0),0)/x.length:0,f=[5,4,3,2,1].map(o=>({star:o,count:x.filter(u=>u.rating_value===o).length,percentage:x.length?(x.filter(u=>u.rating_value===o).length/x.length*100).toFixed(0):0})),l=x.reduce((o,u)=>(u.price_range&&(o[u.price_range]=(o[u.price_range]||0)+1),o),{}),p=l&&Object.keys(l).length>0?Object.entries(l).sort((o,u)=>u[1]-o[1])[0]:null;return e.jsxs(E,{children:[e.jsx(X,{children:e.jsx(qe,{children:c("restaurant.rating")})}),e.jsxs(B,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-5xl font-bold",children:d.toFixed(1)}),e.jsx("div",{className:"flex items-center justify-center mt-2",children:[1,2,3,4,5].map(o=>e.jsx(we,{className:Ae("w-5 h-5",o<=Math.round(d)?"fill-accent text-accent":"text-muted-foreground")},o))}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[x.length," ",c("restaurant.ratingsCount")]}),p&&e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-2 text-sm",children:[e.jsx(Ws,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-foreground",children:Ft.find(o=>o.value===p[0])?.label})]})]}),e.jsx("div",{className:"flex-1 space-y-2",children:f.map(({star:o,count:u,percentage:v})=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs("span",{className:"w-8",children:[o," ★"]}),e.jsx("div",{className:"flex-1 h-2 bg-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-accent transition-all",style:{width:`${v}%`}})}),e.jsx("span",{className:"w-12 text-right text-muted-foreground",children:u})]},o))})]}),e.jsx("div",{className:"pt-4 border-t text-center text-sm text-muted-foreground",children:c("restaurant.signInToRate")})]})]})},qt=s=>(H(),Hs({queryKey:["restaurant-activities",s],queryFn:async()=>{const{data:c,error:t}=await Ms.from("activity_restaurants").select(`
          activity_id,
          activities (
            id,
            title_zh,
            title_en,
            title_pt,
            intro_zh,
            intro_en,
            intro_pt,
            badge_text_zh,
            badge_text_en,
            badge_text_pt,
            badge_color,
            start_date,
            end_date
          )
        `).eq("restaurant_id",s);if(t)throw t;const x=new Date;return c.filter(f=>{const l=f.activities;if(!l)return!1;const p=new Date(l.start_date),o=l.end_date?new Date(l.end_date):null;return p<=x&&(!o||o>=x)}).map(f=>({activity_id:f.activity_id,title_zh:f.activities.title_zh,title_en:f.activities.title_en,title_pt:f.activities.title_pt,intro_zh:f.activities.intro_zh,intro_en:f.activities.intro_en,intro_pt:f.activities.intro_pt,badge_text_zh:f.activities.badge_text_zh,badge_text_en:f.activities.badge_text_en,badge_text_pt:f.activities.badge_text_pt,badge_color:f.activities.badge_color}))},enabled:!!s})),Cs=(s,c)=>c==="zh"?s.title_zh:c==="pt"?s.title_pt:s.title_en,Fe=(s,c)=>{let t="";return c==="zh"?t=s.badge_text_zh||s.title_zh:c==="pt"?t=s.badge_text_pt||s.title_pt:t=s.badge_text_en||s.title_en,t},Ss=(s,c)=>c==="zh"?s.intro_zh||"":c==="pt"?s.intro_pt||"":s.intro_en||"",cs="dish-gallery-view-mode";function Ts({restaurantId:s,showGallery:c=!0}){const{t}=H(),{data:x=[],isLoading:d}=Pt(s),[f,l]=a.useState(!1),[p,o]=a.useState(0),[u,v]=a.useState(!1),w=Ke(),[D,P]=a.useState(()=>{if(typeof window<"u"){const h=localStorage.getItem(cs);return h==="single"||h==="multi"?h:"multi"}return"multi"});a.useEffect(()=>{localStorage.setItem(cs,D)},[D]);const N=a.useCallback(h=>{o(h),l(!0)},[]),_=a.useCallback(()=>{l(!1)},[]),z=a.useCallback(()=>{o(h=>h===0?x.length-1:h-1)},[x.length]),V=a.useCallback(()=>{o(h=>h===x.length-1?0:h+1)},[x.length]),C=a.useCallback(h=>{h.key==="ArrowLeft"&&z(),h.key==="ArrowRight"&&V(),h.key==="Escape"&&_()},[z,V,_]);if(d||!c||!x.length)return null;const R=()=>w&&D==="single"?"pl-2 basis-full":"pl-2 md:pl-4 basis-1/2 md:basis-1/3 lg:basis-1/4";return e.jsxs(e.Fragment,{children:[e.jsx(E,{children:e.jsxs(Z,{open:!u,onOpenChange:h=>v(!h),children:[e.jsx(X,{className:"pb-3",children:e.jsx(J,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(qe,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ks,{className:"w-5 h-5"}),t("restaurant.photoGallery"),e.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["(",x.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[w&&e.jsxs("div",{className:"flex items-center gap-1 bg-muted rounded-md p-0.5",onClick:h=>h.stopPropagation(),children:[e.jsx(y,{variant:D==="single"?"default":"ghost",size:"icon",className:"h-7 w-7",onClick:h=>{h.stopPropagation(),P("single")},title:t("dishImages.singleView"),children:e.jsx(Qs,{className:"h-4 w-4"})}),e.jsx(y,{variant:D==="multi"?"default":"ghost",size:"icon",className:"h-7 w-7",onClick:h=>{h.stopPropagation(),P("multi")},title:t("dishImages.multiView"),children:e.jsx(Xs,{className:"h-4 w-4"})})]}),e.jsx(Y,{className:`w-5 h-5 text-muted-foreground transition-transform ${u?"":"rotate-180"}`})]})]})})}),e.jsx(ee,{children:e.jsxs(B,{children:[e.jsxs(ws,{className:"w-full",children:[e.jsx(Ns,{className:"-ml-2 md:-ml-4",children:x.map((h,G)=>e.jsx(vs,{className:R(),children:e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>N(G),children:e.jsx("img",{src:h.image_url,alt:`Dish ${G+1}`,className:"w-full h-full object-cover",loading:"lazy"})})},h.id))}),x.length>(w&&D==="single"?1:2)&&e.jsxs(e.Fragment,{children:[e.jsx(ys,{className:"-left-3 md:-left-4"}),e.jsx(ks,{className:"-right-3 md:-right-4"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2 text-center",children:t("dishImages.clickToEnlarge")})]})})]})}),e.jsx(Os,{open:f,onOpenChange:l,children:e.jsxs(Ls,{className:"max-w-[95vw] max-h-[95vh] p-0 bg-black/95 border-none",onKeyDown:C,children:[e.jsx(xs,{children:e.jsx($s,{children:t("restaurants.dishGallery","Dish Gallery")})}),e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center min-h-[50vh]",children:[e.jsx(y,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 z-50 text-white hover:bg-white/20",onClick:_,children:e.jsx(us,{className:"w-6 h-6"})}),x.length>1&&e.jsx(y,{variant:"ghost",size:"icon",className:"absolute left-2 z-50 text-white hover:bg-white/20 h-12 w-12",onClick:z,children:e.jsx(Qe,{className:"w-8 h-8"})}),e.jsx("img",{src:x[p]?.image_url,alt:`Dish ${p+1}`,className:"max-w-full max-h-[85vh] object-contain"}),x.length>1&&e.jsx(y,{variant:"ghost",size:"icon",className:"absolute right-2 z-50 text-white hover:bg-white/20 h-12 w-12",onClick:V,children:e.jsx(hs,{className:"w-8 h-8"})}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-white bg-black/50 px-3 py-1 rounded-full text-sm",children:[p+1," / ",x.length]})]})]})})]})}const Bt=({ownerBio:s,ownerName:c,ownerAvatarUrl:t,avatarFallback:x})=>{const{t:d}=H();return e.jsxs(It,{children:[e.jsx(Mt,{asChild:!0,children:e.jsxs(y,{variant:"ghost",size:"sm",className:"text-primary hover:text-primary/80 p-0 h-auto font-medium gap-1",children:[d("common.viewMore","查看全部"),e.jsx(hs,{className:"w-4 h-4"})]})}),e.jsxs(Ot,{className:"max-h-[85vh]",children:[e.jsx(Lt,{className:"pb-2",children:e.jsxs($t,{className:"flex items-center gap-2 text-lg",children:[e.jsx(ps,{className:"w-5 h-5 text-primary"}),d("restaurants.ownerStory","主理人")]})}),e.jsx(Es,{className:"flex-1 px-4 pb-8",children:e.jsxs("div",{className:"relative max-w-2xl mx-auto",children:[e.jsx(Ue,{className:"absolute -top-4 -left-2 w-12 h-12 text-primary/10 rotate-180"}),e.jsx("div",{className:"relative z-10 pt-6 space-y-4",children:e.jsx("p",{className:"text-base md:text-lg text-foreground leading-relaxed whitespace-pre-wrap first-letter:text-4xl first-letter:font-bold first-letter:text-primary first-letter:float-left first-letter:mr-2 first-letter:mt-1",children:s})}),e.jsxs("div",{className:"mt-8 flex items-center gap-3 pt-6 border-t",children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gradient-to-br from-primary to-accent flex items-center justify-center text-primary-foreground font-bold text-lg shadow-lg",children:t?e.jsx("img",{src:t,alt:c,className:"w-full h-full object-cover"}):x}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-foreground",children:c}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d("restaurants.chef","大厨")})]})]})]})})]})]})},Ds=({open:s,onOpenChange:c,videoUrl:t,posterUrl:x,title:d})=>{const{t:f}=H(),l=a.useRef(null),p=a.useRef(null),[o,u]=a.useState(!1),[v,w]=a.useState(!1),[D,P]=a.useState(!1),[N,_]=a.useState(0),[z,V]=a.useState(0),[C,R]=a.useState(!0),h=a.useRef(null),G=n=>{const L=Math.floor(n/60),W=Math.floor(n%60);return`${L}:${W.toString().padStart(2,"0")}`},k=a.useCallback(()=>{l.current&&(o?l.current.pause():l.current.play())},[o]),se=a.useCallback(()=>{l.current&&(l.current.muted=!v,w(!v))},[v]),Q=a.useCallback(async()=>{try{document.fullscreenElement?(await document.exitFullscreen(),P(!1)):(await l.current?.requestFullscreen(),P(!0))}catch(n){console.log("Fullscreen not supported:",n)}},[]),A=a.useCallback(n=>{if(!l.current||!p.current)return;const L=p.current.getBoundingClientRect(),g=(n.clientX-L.left)/L.width;l.current.currentTime=g*z},[z]),O=a.useCallback(()=>{R(!0),h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{o&&R(!1)},3e3)},[o]),U=a.useCallback(n=>{if(!l.current||!p.current)return;n.preventDefault(),n.stopPropagation();const L=p.current.getBoundingClientRect(),W=n.touches[0].clientX-L.left,g=Math.max(0,Math.min(1,W/L.width));l.current.currentTime=g*z},[z]);a.useEffect(()=>(s&&l.current?(l.current.currentTime=0,_(0),R(!0),l.current.play().catch(()=>{u(!1)})):!s&&l.current&&(l.current.pause(),l.current.currentTime=0,u(!1),_(0),R(!0)),()=>{h.current&&clearTimeout(h.current)}),[s]);const Ne=a.useCallback(()=>u(!0),[]),te=a.useCallback(()=>u(!1),[]),le=a.useCallback(()=>{l.current&&_(l.current.currentTime)},[]),I=a.useCallback(()=>{l.current&&V(l.current.duration)},[]),ie=a.useCallback(()=>{u(!1),R(!0)},[]),F=z>0?N/z*100:0;return e.jsx(Ys,{open:s,onOpenChange:c,children:e.jsxs(Zs,{children:[e.jsx(Js,{className:"fixed inset-0 z-[49] bg-black/90 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",style:{pointerEvents:"none"}}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{touchAction:"none"},onClick:n=>{n.target===n.currentTarget&&c(!1)},onTouchEnd:n=>{n.target===n.currentTarget&&c(!1)},children:e.jsxs(et,{className:"relative w-full max-w-4xl bg-black rounded-lg overflow-hidden outline-none",style:{touchAction:"auto"},"aria-describedby":void 0,onMouseMove:O,onTouchStart:n=>{n.stopPropagation(),O()},onTouchMove:n=>{n.stopPropagation(),O()},onClick:n=>n.stopPropagation(),children:[e.jsx(xs,{children:e.jsx(st,{children:d||f("restaurants.videoPlayer","Video Player")})}),e.jsx(y,{type:"button",variant:"ghost",size:"icon",className:Ae("absolute top-3 right-3 z-[60] bg-black/50 hover:bg-black/70 text-white h-10 w-10 rounded-full transition-opacity duration-300",C?"opacity-100":"opacity-0 pointer-events-none"),onClick:n=>{n.stopPropagation(),c(!1)},children:e.jsx(us,{className:"h-5 w-5"})}),d&&e.jsx("div",{className:Ae("absolute top-3 left-3 z-[60] transition-opacity duration-300 pointer-events-none",C?"opacity-100":"opacity-0"),children:e.jsx("h3",{className:"text-white font-semibold text-lg drop-shadow-lg",children:d})}),e.jsxs("div",{className:"relative aspect-video bg-black select-none",children:[e.jsx("video",{ref:l,src:t,poster:x,className:"w-full h-full object-contain cursor-pointer",playsInline:!0,preload:"metadata",onPlay:Ne,onPause:te,onTimeUpdate:le,onLoadedMetadata:I,onEnded:ie,onCanPlay:()=>{l.current&&!z&&V(l.current.duration)},onClick:n=>{n.stopPropagation(),k()},onTouchEnd:n=>{n.target===l.current&&(n.preventDefault(),k())}}),!o&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center cursor-pointer bg-black/30",style:{zIndex:5},onClick:n=>{n.stopPropagation(),k()},onTouchEnd:n=>{n.preventDefault(),n.stopPropagation(),k()},children:e.jsx("div",{className:"w-16 h-16 md:w-20 md:h-20 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center hover:bg-white/30 transition-colors",children:e.jsx(ne,{className:"w-8 h-8 md:w-10 md:h-10 text-white ml-1",fill:"white"})})}),e.jsxs("div",{className:Ae("absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent px-4 py-3 transition-opacity duration-300",C?"opacity-100":"opacity-0"),style:{zIndex:30,pointerEvents:C?"auto":"none"},onClick:n=>n.stopPropagation(),onTouchStart:n=>n.stopPropagation(),onTouchMove:n=>n.stopPropagation(),children:[e.jsx("div",{ref:p,className:"w-full py-2 cursor-pointer mb-2 group",style:{touchAction:"none"},onClick:n=>{n.stopPropagation(),A(n)},onTouchStart:n=>{n.stopPropagation(),U(n)},onTouchMove:n=>{n.stopPropagation(),U(n)},onTouchEnd:n=>{n.stopPropagation()},children:e.jsx("div",{className:"w-full h-2 bg-white/30 rounded-full relative",children:e.jsx("div",{className:"h-full bg-primary rounded-full relative transition-all",style:{width:`${F}%`},children:e.jsx("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 w-5 h-5 bg-white rounded-full shadow-md -mr-2.5"})})})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{type:"button",variant:"ghost",size:"icon",className:"h-10 w-10 text-white hover:bg-white/20 active:scale-95",onClick:n=>{n.stopPropagation(),k()},onTouchEnd:n=>{n.preventDefault(),n.stopPropagation(),k()},children:o?e.jsx(tt,{className:"h-6 w-6"}):e.jsx(ne,{className:"h-6 w-6"})}),e.jsx(y,{type:"button",variant:"ghost",size:"icon",className:"h-10 w-10 text-white hover:bg-white/20 active:scale-95",onClick:n=>{n.stopPropagation(),se()},onTouchEnd:n=>{n.preventDefault(),n.stopPropagation(),se()},children:v?e.jsx(at,{className:"h-6 w-6"}):e.jsx(rt,{className:"h-6 w-6"})}),e.jsxs("span",{className:"text-white text-sm font-medium select-none",children:[G(N)," / ",G(z)]})]}),e.jsx(y,{type:"button",variant:"ghost",size:"icon",className:"h-10 w-10 text-white hover:bg-white/20 active:scale-95",onClick:n=>{n.stopPropagation(),Q()},onTouchEnd:n=>{n.preventDefault(),n.stopPropagation(),Q()},children:D?e.jsx(nt,{className:"h-6 w-6"}):e.jsx(lt,{className:"h-6 w-6"})})]})]})]})]})})]})})},Vt=({restaurant:s,localizedRestaurant:c,backUrl:t,user:x,isFavorite:d,onToggleFavorite:f,onShare:l,showEditButton:p,editButton:o,reportButton:u})=>{const{t:v}=H(),{getLocalizedField:w}=Xe();As();const[D,P]=a.useState(!1),[N,_]=a.useState(!1),[z,V]=a.useState(!1),C=a.useRef(null),R=w(s,"owner_bio")||s.owner_bio,h=c.description,G=c.name?.charAt(0)?.toUpperCase()||"主",k=s.banner_media_type==="video"&&s.promo_video_url,se=s.banner_url||s.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80",Q=s.promo_video_poster||se,[A,O]=a.useState(!1),U=3,Ne=g=>g?.replace(/<[^>]*>/g,"")||"",te=R&&R.length>100?R.substring(0,100)+"...":R,le=R&&R.length>100,I=Ne(h),ie=I&&I.length>120?I.substring(0,120)+"...":I,F=a.useRef(null),n=a.useCallback(g=>{!C.current||!k||A||(g?C.current.play().catch(()=>{}):C.current.pause())},[k,A]),L=a.useCallback(async g=>{try{return g.muted=!0,g.volume=0,await g.play(),!0}catch(q){return console.warn("Video autoplay attempt failed:",q),!1}},[]);a.useEffect(()=>{if(!k||!C.current)return;const g=C.current;let q=0,oe,K=!0;const ce=async()=>{if(!K||q>=U){K&&q>=U&&(O(!0),_(!0));return}q++,await L(g)&&K?(_(!0),O(!1)):K&&q<U?oe=setTimeout(ce,500):K&&(O(!0),_(!0))},Se=()=>{ce()},Te=()=>{K&&V(!0)};return g.readyState>=2?ce():g.addEventListener("loadeddata",Se),g.addEventListener("error",Te),()=>{K=!1,clearTimeout(oe),g.removeEventListener("loadeddata",Se),g.removeEventListener("error",Te)}},[k,L]),a.useEffect(()=>{if(!k||A||!F.current)return;const g=new IntersectionObserver(q=>{q.forEach(oe=>{n(oe.isIntersecting)})},{threshold:.1});return g.observe(F.current),()=>{g.disconnect()}},[k,A,n]);const W=()=>{if(k&&s.promo_video_url)if(A&&C.current){const g=C.current;g.muted=!0,g.play().then(()=>{O(!1),_(!0)}).catch(()=>{P(!0)})}else P(!0)};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{ref:F,className:"relative h-[33vh] md:h-[40vh] overflow-hidden bg-muted cursor-pointer group",onClick:W,children:[k&&!z?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:Q,alt:c.name,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-500 ${N&&!A?"opacity-0":"opacity-100"}`,loading:"eager"}),e.jsx("video",{ref:C,src:s.promo_video_url,poster:Q,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-500 ${N&&!A?"opacity-100":"opacity-0"}`,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,"webkit-playsinline":"true","x5-playsinline":"true","x5-video-player-type":"h5"})]}):e.jsx("img",{src:se,alt:c.name,className:"w-full h-full object-cover",loading:"eager"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 via-background/20 to-transparent"}),k&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:`w-16 h-16 md:w-20 md:h-20 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center border border-white/30 transition-opacity duration-300 pointer-events-auto cursor-pointer ${A?"opacity-100":"opacity-0 group-hover:opacity-100"}`,children:e.jsx(ne,{className:"w-8 h-8 md:w-10 md:h-10 text-white ml-1",fill:"white"})})}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 flex justify-between items-center z-40 p-3 md:p-4",onClick:g=>g.stopPropagation(),children:[e.jsx(y,{asChild:!0,variant:"secondary",size:"icon",className:"h-9 w-9 md:h-10 md:w-10 shadow-lg",children:e.jsx(Ce,{to:t,children:e.jsx(Qe,{className:"w-4 h-4 md:w-5 md:h-5"})})}),e.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2",children:[u,o,e.jsx(y,{variant:"secondary",size:"icon",className:"h-9 w-9 md:h-10 md:w-10 shadow-lg",onClick:g=>{g.stopPropagation(),l()},children:e.jsx(je,{className:"w-4 h-4 md:w-5 md:h-5"})}),x&&e.jsx(y,{variant:"secondary",size:"icon",className:"h-9 w-9 md:h-10 md:w-10 shadow-lg",onClick:g=>{g.stopPropagation(),f()},children:e.jsx(gs,{className:`w-4 h-4 md:w-5 md:h-5 ${d?"fill-destructive text-destructive":""}`})})]})]})]}),e.jsxs("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-8",children:[k&&e.jsx("div",{className:"flex justify-center mb-3",children:e.jsxs(y,{variant:"secondary",size:"sm",className:"gap-2 bg-primary/5 hover:bg-primary/10 text-primary/70 border border-primary/10 backdrop-blur-md",onClick:()=>{C.current&&C.current.pause(),P(!0)},children:[e.jsx(ne,{className:"w-4 h-4"}),v("restaurants.clickWatchFullVideo","点击观看完整视频")]})}),e.jsxs(E,{className:"shadow-xl border-border/50",children:[e.jsxs(X,{className:"pb-4 md:pb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5 md:mb-2",children:[e.jsxs($,{variant:"secondary",className:"text-[10px] md:text-xs gap-1 bg-primary/10 text-primary border-primary/20",children:[e.jsx(fs,{className:"w-3 h-3"}),v("admin.templateGhost","Virtual Restaurant")]}),e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.15em] md:tracking-[0.2em] uppercase text-primary",children:v("restaurants.exclusiveInterview","专属故事")})]}),e.jsx(qe,{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-foreground leading-tight",children:c.name})]}),e.jsx(B,{className:"pt-0",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-5 md:gap-6 lg:gap-8",children:[e.jsxs("div",{className:"md:col-span-3 space-y-5 md:space-y-6",children:[e.jsxs("div",{className:"relative aspect-square md:aspect-square w-full max-w-md mx-auto overflow-hidden rounded-xl shadow-lg group",children:[e.jsx("img",{src:s.cover_image_url||s.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=800&q=80",alt:c.name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 via-transparent to-transparent"})]}),(ie||h)&&e.jsxs("div",{className:"space-y-2 md:space-y-3 bg-muted/50 rounded-xl p-4 md:p-5 lg:p-6 border border-border/30",children:[e.jsxs("h3",{className:"text-base md:text-lg font-semibold text-foreground flex items-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4 md:w-5 md:h-5 text-primary"}),v("restaurants.foodPhilosophy","美食哲学")]}),e.jsx("div",{className:"text-sm md:text-base text-muted-foreground leading-relaxed prose prose-sm dark:prose-invert max-w-none [&_*]:!text-muted-foreground [&_a]:!text-primary [&_a]:underline [&_p]:my-2",dangerouslySetInnerHTML:{__html:h}})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"bg-muted/30 rounded-2xl border border-border/30 overflow-hidden sticky top-20 self-start",children:[e.jsx("div",{className:"relative pt-6 md:pt-8 pb-4 md:pb-6 px-4 md:px-6 bg-gradient-to-b from-primary/5 to-transparent",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 md:w-28 md:h-28 rounded-full overflow-hidden border-4 border-background shadow-xl ring-4 ring-primary/10",children:s.owner_avatar_url?e.jsx("img",{src:s.owner_avatar_url,alt:c.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-primary/30 via-accent/20 to-muted flex items-center justify-center",children:e.jsx("span",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-primary/70",children:G})})}),e.jsxs($,{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 bg-primary text-primary-foreground border-0 px-2 md:px-3 py-0.5 md:py-1 text-[10px] md:text-xs font-medium shadow-lg whitespace-nowrap",children:[e.jsx(ps,{className:"w-2.5 h-2.5 md:w-3 md:h-3 mr-0.5 md:mr-1"}),v("restaurants.ownerStory","主理人")]})]})})}),e.jsxs("div",{className:"px-4 md:px-6 py-3 md:py-4 text-center border-b border-border/30",children:[e.jsx("h3",{className:"text-lg md:text-xl font-bold text-foreground",children:c.name}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground font-medium tracking-wider uppercase mt-0.5 md:mt-1",children:v("restaurants.chef","大厨")})]}),e.jsxs("div",{className:"p-4 md:p-6 space-y-3 md:space-y-4",children:[e.jsxs("h4",{className:"text-xs md:text-sm font-semibold text-foreground flex items-center gap-1.5 md:gap-2",children:[e.jsx(Ue,{className:"w-3 h-3 md:w-4 md:h-4 text-primary rotate-180"}),v("restaurants.ownerWords","主理人故事")]}),R?e.jsxs("div",{className:"space-y-2 md:space-y-3",children:[e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground leading-relaxed",children:te}),le&&e.jsx(Bt,{ownerBio:R,ownerName:c.name,ownerAvatarUrl:s.owner_avatar_url,avatarFallback:G})]}):e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground/60 italic",children:v("restaurants.noBioYet","暂无简介")})]}),e.jsx("div",{className:"h-1.5 md:h-2 bg-gradient-to-r from-primary/20 via-primary/40 to-primary/20"})]})})]})})]})]}),k&&e.jsx(Ds,{open:D,onOpenChange:P,videoUrl:s.promo_video_url,posterUrl:Q,title:c.name})]})},Gt=it,Ut=s=>{if(!s)return"";const c=Math.floor(s/60),t=Math.floor(s%60);return`${c}:${t.toString().padStart(2,"0")}`},ds=({video:s,onClick:c,language:t})=>{const d=(()=>{switch(t){case"en":return s.title_en||s.title_zh||"";case"pt":return s.title_pt||s.title_en||s.title_zh||"";default:return s.title_zh||s.title_en||""}})();return e.jsxs(E,{className:"group cursor-pointer overflow-hidden border-border/50 hover:border-primary/30 transition-all hover:shadow-lg",onClick:c,children:[e.jsxs("div",{className:"relative",children:[e.jsx(Gt,{ratio:16/9,children:s.poster_url?e.jsx("img",{src:s.poster_url,alt:d,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",loading:"lazy"}):e.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-primary/20 via-primary/10 to-muted flex items-center justify-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/20 backdrop-blur-sm flex items-center justify-center border border-primary/30",children:e.jsx(ne,{className:"w-8 h-8 text-primary ml-1",fill:"currentColor"})}),e.jsx(ot,{className:"absolute bottom-3 left-3 w-5 h-5 text-primary/40"})]})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none md:opacity-0 md:group-hover:opacity-100 transition-opacity",children:e.jsx("div",{className:"w-12 h-12 md:w-14 md:h-14 rounded-full bg-black/50 md:bg-white/20 backdrop-blur-sm flex items-center justify-center border border-white/30 md:group-hover:scale-110 transition-transform",children:e.jsx(ne,{className:"w-6 h-6 md:w-7 md:h-7 text-white ml-0.5",fill:"white"})})}),s.duration&&e.jsx($,{variant:"secondary",className:"absolute bottom-2 right-2 bg-black/70 text-white text-xs border-0",children:Ut(s.duration)})]}),d&&e.jsx("div",{className:"p-3",children:e.jsx("p",{className:"text-sm font-medium text-foreground line-clamp-2",children:d})})]})},Wt=({videos:s})=>{const{t:c,i18n:t}=H(),x=Ke(),[d,f]=a.useState(null);if(!s||s.length===0)return null;const l=p=>{switch(t.language){case"en":return p.title_en||p.title_zh||"";case"pt":return p.title_pt||p.title_en||p.title_zh||"";default:return p.title_zh||p.title_en||""}};return e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"py-8 md:py-12 lg:py-16 bg-muted/30",children:e.jsxs("div",{className:"container mx-auto max-w-6xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:"BEHIND THE KITCHEN"}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(ne,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),c("restaurants.videoSection","美食视界")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),x?e.jsxs(ws,{opts:{align:"start",loop:s.length>2},className:"w-full",children:[e.jsx(Ns,{className:"-ml-2",children:s.map((p,o)=>e.jsx(vs,{className:"pl-2 basis-4/5 sm:basis-1/2",children:e.jsx(ds,{video:p,onClick:()=>f(p),language:t.language})},o))}),s.length>2&&e.jsxs(e.Fragment,{children:[e.jsx(ys,{className:"hidden sm:flex -left-4"}),e.jsx(ks,{className:"hidden sm:flex -right-4"})]})]}):e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:s.map((p,o)=>e.jsx(ds,{video:p,onClick:()=>f(p),language:t.language},o))})]})}),e.jsx(Ds,{open:!!d,onOpenChange:p=>!p&&f(null),videoUrl:d?.url||"",posterUrl:d?.poster_url,title:d?l(d):void 0})]})},Ht=a.lazy(()=>ms(()=>import("./RestaurantComments-B8eJXJqn.js").then(s=>s.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Kt=({restaurant:s,localizedRestaurant:c,restaurantActivities:t,ratingCount:x,averageRating:d,onTakeawayClick:f})=>{const{t:l,i18n:p}=H(),{getLocalizedField:o}=Xe(),[u,v]=a.useState(!1),[w,D]=a.useState(!1),P=a.useRef(null);return e.jsxs("div",{className:"relative bg-background",children:[s.website_url&&s.show_takeaway_button&&e.jsx("section",{className:"py-6 md:py-8 bg-gradient-to-b from-muted/50 to-background",children:e.jsxs("div",{className:"container mx-auto max-w-2xl px-4",children:[e.jsxs("div",{className:"text-center mb-4 md:mb-5",children:[e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mb-1",children:l("restaurants.readyToOrder")}),e.jsx("p",{className:"text-sm md:text-base font-medium text-foreground",children:l("restaurants.orderNowHint")})]}),e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs(y,{className:"w-full h-11 md:h-12 text-sm md:text-base shadow-md hover:shadow-lg transition-shadow",size:"lg",onClick:f,children:[e.jsx(ct,{className:"w-4 h-4 md:w-5 md:h-5 mr-2"}),l("restaurant.takeawayOrder")]})}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-4 md:mt-5",children:[e.jsx("div",{className:"h-px w-12 md:w-16 bg-border"}),e.jsx("span",{className:"text-[10px] md:text-xs text-muted-foreground uppercase tracking-wider",children:l("restaurants.orBrowse")}),e.jsx("div",{className:"h-px w-12 md:w-16 bg-border"})]})]})}),e.jsx("section",{className:"py-8 md:py-12 lg:py-16",children:e.jsxs("div",{className:"container mx-auto max-w-6xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:l("restaurants.gallery","美食图鉴")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(dt,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),l("restaurants.photoWall","照片墙")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(Ts,{restaurantId:s.id,showGallery:s.show_dish_gallery!==!1})]})}),s.videos&&Array.isArray(s.videos)&&s.videos.length>0&&e.jsx(Wt,{videos:s.videos}),e.jsx("section",{className:"py-8 md:py-12 lg:py-16 bg-muted/30",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:l("restaurants.info","详情")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(We,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),l("restaurants.contactInfo","联系信息")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(E,{className:"border-0 shadow-lg md:shadow-xl overflow-hidden",children:e.jsxs(B,{className:"p-4 md:p-6 lg:p-8 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:gap-3",children:[c.type.slice(0,3).map((N,_)=>e.jsx($,{variant:"secondary",className:"text-xs md:text-sm",children:N},_)),e.jsxs($,{variant:"secondary",className:"gap-1 text-xs md:text-sm bg-primary/10 text-primary border-primary/20",children:[e.jsx(fs,{className:"w-3 h-3"}),l("admin.templateGhost","Virtual Restaurant")]}),x>0&&e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx(we,{className:"w-4 h-4 md:w-5 md:h-5 fill-accent text-accent"}),e.jsxs("span",{className:"font-bold text-base md:text-lg",children:[d.toFixed(1),e.jsxs("span",{className:"text-muted-foreground font-normal text-xs md:text-sm ml-1",children:["(",x,")"]})]})]})]}),e.jsx(He,{}),e.jsxs("div",{className:"grid gap-3 md:gap-4",children:[t.length>0&&e.jsxs(Z,{open:u,onOpenChange:v,className:"flex items-start gap-2 md:gap-3 p-3 md:p-4 rounded-lg md:rounded-xl bg-gradient-to-r from-primary/5 to-transparent border border-primary/10",children:[e.jsx(we,{className:"w-4 h-4 md:w-5 md:h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(J,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-semibold text-sm md:text-base text-card-foreground",children:l("activities.title")}),!u&&e.jsxs("div",{className:"flex flex-wrap gap-1 md:gap-1.5 mt-1",children:[t.slice(0,2).map((N,_)=>e.jsx($,{variant:"default",className:"text-white text-[10px] md:text-xs",style:{backgroundColor:N.badge_color||"hsl(var(--primary))"},children:Fe(N,p.language)},`activity-${_}`)),t.length>2&&e.jsxs($,{variant:"secondary",className:"text-[10px] md:text-xs",children:["+",t.length-2]})]})]}),e.jsx(Y,{className:`w-4 h-4 md:w-5 md:h-5 text-muted-foreground transition-transform flex-shrink-0 ${u?"rotate-180":""}`})]})}),e.jsx(ee,{className:"mt-2 md:mt-3 space-y-1.5 md:space-y-2",children:t.map((N,_)=>{const z=Ss(N,p.language);return e.jsxs(Ce,{to:`/activity/${N.activity_id}`,className:"block p-2 md:p-3 rounded-md md:rounded-lg hover:bg-muted/80 transition-colors border border-transparent hover:border-primary/20",children:[e.jsx($,{variant:"default",className:"text-white mr-1.5 md:mr-2 text-[10px] md:text-xs",style:{backgroundColor:N.badge_color||"hsl(var(--primary))"},children:Fe(N,p.language)}),e.jsxs("span",{className:"text-xs md:text-sm text-muted-foreground",children:[z||Cs(N,p.language)," ... →"]})]},`activity-detail-${_}`)})})]})]}),e.jsxs("div",{className:"flex items-start gap-2 md:gap-3 p-3 md:p-4 rounded-lg md:rounded-xl bg-muted/50 hover:bg-muted/70 transition-colors",children:[e.jsx(We,{className:"w-4 h-4 md:w-5 md:h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm md:text-base text-card-foreground",children:l("restaurants.productionAddress")}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mt-0.5 md:mt-1 break-words",children:s.address})]})]}),s.phone&&e.jsxs("a",{href:`tel:${s.phone}`,className:"flex items-start gap-2 md:gap-3 p-3 md:p-4 rounded-lg md:rounded-xl bg-muted/50 hover:bg-primary/10 transition-colors cursor-pointer group",children:[e.jsx(js,{className:"w-4 h-4 md:w-5 md:h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm md:text-base text-card-foreground",children:l("restaurant.phone")}),e.jsx("p",{className:"text-sm md:text-base text-primary group-hover:underline mt-0.5 md:mt-1",children:s.phone})]})]}),s&&(o(s,"announcement")||s.announcement_zh)&&e.jsxs(Z,{open:w,onOpenChange:D,className:"flex items-start gap-2 md:gap-3 p-3 md:p-4 rounded-lg md:rounded-xl bg-muted/50",children:[e.jsx(be,{className:"w-4 h-4 md:w-5 md:h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(J,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-semibold text-sm md:text-base text-card-foreground",children:l("restaurant.announcement")}),e.jsx(Y,{className:`w-4 h-4 md:w-5 md:h-5 text-muted-foreground transition-transform flex-shrink-0 ${w?"rotate-180":""}`})]})}),e.jsx(ee,{className:"mt-2 md:mt-3",children:e.jsx("div",{className:"p-3 md:p-4 rounded-md md:rounded-lg bg-primary/5 border border-primary/10",children:e.jsx("p",{className:"text-xs md:text-sm text-foreground whitespace-pre-wrap leading-relaxed",children:o(s,"announcement")||s.announcement_zh})})})]})]})]})]})})]})}),e.jsx("section",{className:"py-8 md:py-12 lg:py-16",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:l("restaurants.rating","评分")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(we,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),l("restaurants.rateUs","给我们评分")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(E,{className:"border-0 shadow-lg md:shadow-xl overflow-hidden",children:e.jsx(B,{className:"p-4 md:p-6 lg:p-8",children:e.jsx(_s,{restaurantId:s.id})})})]})}),e.jsx("section",{className:"py-8 md:py-12 lg:py-16 bg-muted/30",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:l("restaurants.reviews","评价")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(be,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),l("restaurants.customerReviews","用户评价")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(E,{className:"border-0 shadow-lg md:shadow-xl overflow-hidden",children:e.jsx(B,{className:"p-4 md:p-6 lg:p-8",ref:P,children:e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center py-8 md:py-12",children:e.jsx(_e,{className:"w-6 h-6 md:w-8 md:h-8 animate-spin text-primary"})}),children:e.jsx(Ht,{restaurantId:s.id})})})})]})})]})};function Qt({brandId:s}){const{t:c,i18n:t}=H(),[x,d]=a.useState(!1),{data:f,isLoading:l}=Et(s);if(l||!f)return null;const p=()=>{switch(t.language){case"zh":return f.intro_zh;case"pt":return f.intro_pt;default:return f.intro_en||f.intro_zh}},o=w=>{switch(t.language){case"zh":return w.content_zh;case"pt":return w.content_pt;default:return w.content_en||w.content_zh}},u=p(),v=f.content_blocks&&f.content_blocks.length>0;return!u&&!v?null:e.jsxs(Z,{open:x,onOpenChange:d,className:"mt-4",children:[e.jsx(J,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(mt,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"font-medium",children:c("brand.aboutUs")})]}),e.jsx(Y,{className:`w-5 h-5 text-muted-foreground transition-transform ${x?"rotate-180":""}`})]})}),e.jsx(ee,{children:e.jsxs("div",{className:"p-4 mt-2 rounded-lg bg-muted/30",children:[e.jsx("div",{className:"space-y-4",children:v&&f.content_blocks.map((w,D)=>{const P=o(w),N=w.type==="image"&&D===0,_=w.type==="image"&&D===f.content_blocks.length-1;return e.jsxs("div",{children:[w.type==="text"&&P&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline",dangerouslySetInnerHTML:{__html:P}}),w.type==="image"&&w.url&&e.jsx("div",{className:"flex justify-start",children:e.jsx("img",{src:w.url,alt:w.alt||"",className:N?"w-16 h-16 object-contain rounded-lg":_?"h-12 w-auto object-contain opacity-80":"max-w-[120px] max-h-24 object-contain rounded-lg"})})]},w.id)})}),u&&!v&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline",dangerouslySetInnerHTML:{__html:u}})]})})]})}const Xt=a.lazy(()=>ms(()=>import("./RestaurantComments-B8eJXJqn.js").then(s=>s.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Sa=()=>{const{id:s}=xt(),c=ut(),{t,i18n:x}=H(),{user:d}=Fs(),{localizeRestaurant:f,getLocalizedField:l}=Xe(),p=Ke(),o=a.useRef(null),u=a.useRef(null),[v,w]=a.useState(null),[D,P]=a.useState(!1),[N,_]=a.useState(!0),[z,V]=a.useState(!1),[C,R]=a.useState(!1),[h,G]=a.useState(!0),[k,se]=a.useState(!0),[Q,A]=a.useState(!1),O=a.useRef(null),U=a.useRef(null),[Ne,te]=a.useState(!1),[le,I]=a.useState(!1),[ie,F]=a.useState(!1),[n,L]=a.useState(!1),W=ht(),g=pt(),{share:q,DrawerComponent:oe}=zt(),K=a.useCallback(async()=>{g.removeQueries({queryKey:["restaurant",s]}),g.removeQueries({queryKey:["comments",s]}),g.removeQueries({queryKey:["restaurant-activities",s]}),g.removeQueries({queryKey:["dish-images",s]}),await Promise.all([g.invalidateQueries({queryKey:["restaurant",s]}),g.invalidateQueries({queryKey:["comments",s]}),g.invalidateQueries({queryKey:["restaurant-activities",s]}),g.invalidateQueries({queryKey:["dish-images",s]})])},[g,s]);Dt({pageType:"restaurant",targetId:s});const ce=c.state?.fromActivity,Se=c.state?.from==="admin",Te=c.state?.from==="profile",De=Se?"/admin/restaurants":Te?"/profile":ce?`/activity/${ce}`:"/restaurants",{data:r,isLoading:zs}=wt(s),{data:Rs=[]}=Nt(),{data:ze}=bs(s,"restaurant",{enabled:k}),Ye=vt(),{role:Yt,isAdmin:Re}=qs(),{data:Ps=[]}=Rt(),{data:Pe=[]}=qt(s),Ie=r&&Ps.some(i=>i.id===r.id),S=r?f(r):null,Ze=r?Rs.includes(r.id):!1;a.useMemo(()=>[{value:"€",label:"€ (0-10€)"},{value:"€€",label:"€€ (10-20€)"},{value:"€€€",label:"€€€ (20€+)"}],[]);const de=a.useMemo(()=>{const i={};return ze?.forEach(m=>{m.price_range&&(i[m.price_range]||(i[m.price_range]={count:0,latestDate:m.created_at}),i[m.price_range].count+=1,m.created_at>i[m.price_range].latestDate&&(i[m.price_range].latestDate=m.created_at))}),i},[ze]),Je=a.useMemo(()=>de?Object.values(de).reduce((i,m)=>i+m.count,0):0,[de]),es=a.useMemo(()=>!de||Je<10?null:Object.entries(de).sort(([,m],[,T])=>T.count!==m.count?T.count-m.count:T.latestDate.localeCompare(m.latestDate))[0]?.[0]||null,[de,Je]),{ratingCount:Me,averageRating:ss}=a.useMemo(()=>{const i=ze?.filter(b=>b.rating_value)||[],m=i.length,T=m>0?i.reduce((b,M)=>b+(M.rating_value||0),0)/m:0;return{ratingCount:m,averageRating:T}},[ze]);a.useEffect(()=>{r&&kt().then(i=>{const m=_t(i.coords.latitude,i.coords.longitude,r.lat,r.lng);w(m)}).catch(()=>{w(null)})},[r]);const ts=a.useCallback(()=>{!d||!r||Ye.mutate(r.id)},[d,r,Ye]),Oe=a.useCallback(async()=>{try{await navigator.clipboard.writeText(window.location.href),Ee.success(t("common.linkCopied"))}catch(i){console.error("Error copying link:",i),Ee.error(t("common.shareError"))}},[t]),Be=a.useCallback(async()=>{!r||!S||q({title:S.name,text:`${S.name} - Xiaoxiong Market

${S.description||S.address}`,url:window.location.href},()=>{Ee.success(t("common.shareSuccess"))})},[r,S,q,t]),ve=a.useCallback(i=>{if(!r||!S)return;const m=encodeURIComponent(window.location.href),T=encodeURIComponent(S.name);let b="";switch(i){case"whatsapp":b=`https://wa.me/?text=${T}%20${m}`;break;case"facebook":b=`https://www.facebook.com/sharer/sharer.php?u=${m}`;break;case"twitter":b=`https://twitter.com/intent/tweet?text=${T}&url=${m}`;break;case"telegram":b=`https://t.me/share/url?url=${m}&text=${T}`;break;case"wechat":Oe(),Ee.info(t("common.shareVia")+" WeChat");return;default:return}as()?window.location.href=b:window.open(b,"_blank","width=600,height=400")},[r,S,Oe,t]);return a.useEffect(()=>{const i=new IntersectionObserver(T=>{T.forEach(b=>{b.isIntersecting&&!h&&G(!0)})},{rootMargin:"100px"}),m=new IntersectionObserver(T=>{T.forEach(b=>{b.isIntersecting&&!k&&se(!0)})},{rootMargin:"200px"});return O.current&&i.observe(O.current),U.current&&m.observe(U.current),()=>{i.disconnect(),m.disconnect()}},[h,k]),a.useEffect(()=>{if(!o.current||!r||!h||!N||u.current)return;const i="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";if(!ke.supported()){console.warn("[RestaurantDetail Map] WebGL not supported",{isIOSDevice:Bs(),isIOSWebView:as(),userAgent:navigator.userAgent});return}const m=()=>{if(!o.current)return;const T=o.current.getBoundingClientRect();if(T.width===0||T.height===0){setTimeout(m,100);return}try{ke.accessToken=i,u.current=new ke.Map({container:o.current,style:"mapbox://styles/mapbox/light-v11",center:[r.lng,r.lat],zoom:15,cooperativeGestures:!0}),u.current.on("error",M=>{console.error("[RestaurantDetail Map] Map error:",M)});const b=document.createElement("div");b.style.backgroundImage=`url(${St})`,b.style.width="40px",b.style.height="40px",b.style.backgroundSize="contain",b.style.backgroundRepeat="no-repeat",b.style.backgroundPosition="center",b.style.cursor="pointer",new ke.Marker({element:b}).setLngLat([r.lng,r.lat]).addTo(u.current),u.current.addControl(new ke.NavigationControl)}catch(b){console.error("[RestaurantDetail Map] Failed to initialize map:",b)}};return setTimeout(m,50),()=>{u.current?.remove(),u.current=null}},[r,h,N]),a.useEffect(()=>{if(N&&u.current){const i=setTimeout(()=>{u.current?.resize(),r&&u.current?.setCenter([r.lng,r.lat])},350);return()=>clearTimeout(i)}},[N,r]),zs?e.jsx(At,{}):!r||!S?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl text-muted-foreground",children:t("error.notFound")}),e.jsx(y,{asChild:!0,className:"mt-4",children:e.jsx(Ce,{to:De,children:t("common.back")})})]})}):r.template==="ghost"?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Vt,{restaurant:r,localizedRestaurant:S,backUrl:De,user:d,isFavorite:Ze,onToggleFavorite:ts,onShare:()=>{if(!d){I(!0);return}p&&navigator.share?Be():Oe()},onReport:()=>{},showEditButton:Ie||Re,editButton:(Ie||Re)&&r?e.jsx(os,{restaurant:r,trigger:e.jsx(y,{variant:"secondary",size:"icon",className:"backdrop-blur-sm bg-background/60",children:e.jsx(ns,{className:"w-5 h-5"})})}):null,reportButton:r?e.jsx(is,{targetType:"restaurant",targetId:r.id,onLoginRequired:()=>I(!0),trigger:e.jsx(y,{variant:"secondary",size:"icon",className:"backdrop-blur-sm bg-background/60",children:e.jsx(ls,{className:"w-5 h-5"})})}):null}),e.jsx(Kt,{restaurant:r,localizedRestaurant:S,restaurantActivities:Pe,ratingCount:Me,averageRating:ss,onTakeawayClick:()=>F(!0)}),e.jsx(me,{open:ie,onOpenChange:F,children:e.jsxs(xe,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(ue,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0",children:e.jsx(Ve,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(he,{className:"text-base font-semibold tracking-tight text-foreground",children:t("restaurant.orderOrBookTitle","外卖/订台")}),e.jsx(pe,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:t("restaurant.orderOrBookDescription","即将为您打开餐厅私域页面")})]})]}),e.jsxs(ge,{className:"relative flex-col gap-2 pt-4 mt-1",children:[e.jsx(ae,{onClick:()=>{try{let i=r.website_url;if(d){const m=new URL(r.website_url);m.searchParams.set("user_id",d.id),i=m.toString()}ye(i)}catch{ye(r.website_url)}},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:t("common.continue","继续")}),e.jsx(fe,{className:"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:t("common.cancel")})]})]})}),e.jsx(me,{open:le,onOpenChange:I,children:e.jsxs(xe,{children:[e.jsxs(ue,{children:[e.jsx(he,{children:t("activities.loginRequired")}),e.jsx(pe,{children:t("activities.loginRequiredMessage")})]}),e.jsxs(ge,{children:[e.jsx(fe,{children:t("common.cancel")}),e.jsx(ae,{onClick:()=>W("/auth"),children:t("activities.goToLogin")})]})]})})]}):e.jsx(Tt,{onRefresh:K,children:e.jsxs("div",{className:"min-h-screen bg-secondary/20",children:[e.jsxs("div",{className:"relative h-[33vh] overflow-hidden bg-muted",children:[e.jsx("img",{src:r.cover_image_url||r.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80",alt:S.name,className:"w-full h-full object-cover",loading:"eager"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),e.jsx(y,{asChild:!0,variant:"secondary",size:"icon",className:"absolute top-4 left-4",children:e.jsx(Ce,{to:De,children:e.jsx(Qe,{className:"w-5 h-5"})})}),d&&e.jsx(y,{variant:"secondary",size:"icon",className:"absolute top-4 right-4",onClick:ts,children:e.jsx(gs,{className:`w-5 h-5 ${Ze?"fill-destructive text-destructive":""}`})}),p&&navigator.share?e.jsx(y,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${d?"right-16":"right-4"}`,onClick:()=>{if(!d){I(!0);return}Be()},children:e.jsx(je,{className:"w-5 h-5"})}):e.jsxs(Vs,{children:[e.jsx(Gs,{asChild:!0,children:e.jsx(y,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${d?"right-16":"right-4"}`,onClick:i=>{d||(i.preventDefault(),I(!0))},children:e.jsx(je,{className:"w-5 h-5"})})}),e.jsxs(Us,{align:"end",className:"w-48",children:[navigator.share&&e.jsxs(e.Fragment,{children:[e.jsxs(re,{onClick:Be,children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),t("common.moreOptions")]}),e.jsx(rs,{})]}),e.jsxs(re,{onClick:()=>ve("wechat"),children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"WeChat"]}),e.jsxs(re,{onClick:()=>ve("whatsapp"),children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),e.jsxs(re,{onClick:()=>ve("facebook"),children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Facebook"]}),e.jsxs(re,{onClick:()=>ve("twitter"),children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"X (Twitter)"]}),e.jsxs(re,{onClick:()=>ve("telegram"),children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Telegram"]}),e.jsx(rs,{}),e.jsxs(re,{onClick:Oe,children:[e.jsx(gt,{className:"w-4 h-4 mr-2"}),t("common.copyLink")]})]})]}),(Ie||Re)&&r&&e.jsx(os,{restaurant:r,trigger:e.jsx(y,{variant:"secondary",size:"icon",className:`absolute top-4 ${d?"right-28":"right-16"}`,children:e.jsx(ns,{className:"w-5 h-5"})})}),r&&e.jsx(is,{targetType:"restaurant",targetId:r.id,onLoginRequired:()=>I(!0),trigger:e.jsx(y,{variant:"secondary",size:"icon",className:`absolute top-4 ${Ie||Re?d?"right-40":"right-28":d?"right-28":"right-16"}`,children:e.jsx(ls,{className:"w-5 h-5"})})})]}),e.jsx("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12",children:e.jsxs(E,{className:"shadow-large",children:[e.jsx(X,{children:e.jsx("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 flex flex-wrap gap-2",children:S.type.slice(0,3).map((i,m)=>e.jsx($,{variant:"secondary",children:i},m))}),e.jsx(qe,{className:"text-3xl mb-2",children:S.name}),e.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[v!==null&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ge,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"font-semibold text-base",children:[v.toFixed(1)," km"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(we,{className:`w-5 h-5 ${Me>0?"fill-accent text-accent":"text-muted-foreground"}`}),Me>0?e.jsxs("span",{className:"font-semibold text-base",children:[ss.toFixed(1),e.jsxs("span",{className:"text-muted-foreground font-normal text-sm ml-1",children:["(",Me,")"]})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:t("restaurant.noRatingWithHint")})]}),es&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ft,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-base",children:es})]})]}),r.brand_id&&e.jsx(Qt,{brandId:r.brand_id}),S.description&&S.description.replace(/<[^>]*>/g,"").trim()!==""&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline mt-3",dangerouslySetInnerHTML:{__html:S.description}})]})})}),e.jsxs(B,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[Pe.length>0&&e.jsxs(Z,{open:C,onOpenChange:R,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(we,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(J,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:t("activities.title")}),!C&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-1",children:Pe.map((i,m)=>e.jsx($,{variant:"default",className:"text-white",style:{backgroundColor:i.badge_color||"#9b87f5"},children:Fe(i,x.language)},`activity-${m}`))})]}),e.jsx(Y,{className:`w-5 h-5 text-muted-foreground transition-transform ${C?"rotate-180":""}`})]})}),e.jsx(ee,{className:"mt-3 space-y-2",children:Pe.map((i,m)=>{const T=Ss(i,x.language);return e.jsxs(Ce,{to:`/activity/${i.activity_id}`,className:"block p-2 rounded-md hover:bg-muted/80 transition-colors",children:[e.jsx($,{variant:"default",className:"text-white mr-2",style:{backgroundColor:i.badge_color||"#9b87f5"},children:Fe(i,x.language)}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[T||Cs(i,x.language)," ... →"]})]},`activity-detail-${m}`)})})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(We,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-card-foreground",children:t("restaurant.address")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-muted-foreground",children:r.address}),r.template==="ghost"&&e.jsx($,{variant:"secondary",className:"text-xs",children:t("restaurants.ghostKitchen")})]})]})]}),r.phone&&e.jsxs("a",{href:`tel:${r.phone}`,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors cursor-pointer",children:[e.jsx(js,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-card-foreground",children:t("restaurant.phone")}),e.jsx("p",{className:"text-primary underline",children:r.phone})]})]}),r.opening_hours&&r.template!=="ghost"&&e.jsxs(Z,{open:D,onOpenChange:P,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(jt,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(J,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:t("restaurant.hours")}),!D&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-0.5",children:[t("restaurant.today")," ",yt(r.opening_hours)]})]}),e.jsx(Y,{className:`w-5 h-5 text-muted-foreground transition-transform ${D?"rotate-180":""}`})]})}),e.jsx(ee,{className:"mt-3",children:e.jsx("div",{className:"space-y-2",children:(()=>{const i=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],m={monday:"dayMon",tuesday:"dayTue",wednesday:"dayWed",thursday:"dayThu",friday:"dayFri",saturday:"daySat",sunday:"daySun"},T=i[new Date().getDay()===0?6:new Date().getDay()-1];return i.map(b=>{const M=r.opening_hours[b],Le=b===T,Is=t(`restaurant.${m[b]}`);let $e="N/A";return M&&(M.closed?$e=t("restaurant.closed"):M.splitShift?$e=`${M.open} - ${M.close}, ${M.open2} - ${M.close2}`:$e=`${M.open} - ${M.close}`),e.jsxs("div",{className:`flex justify-between items-center py-1.5 px-2 rounded ${Le?"bg-primary/10 border border-primary/20":""}`,children:[e.jsxs("span",{className:`text-sm font-medium ${Le?"text-primary":"text-foreground"}`,children:[Is,Le&&e.jsxs("span",{className:"ml-2 text-xs",children:["(",t("restaurant.today"),")"]})]}),e.jsx("span",{className:`text-sm ${Le?"text-primary font-semibold":"text-muted-foreground"} ${M?.closed?"italic":""}`,children:$e})]},b)})})()})})]})]}),r&&(l(r,"announcement")||r.announcement_zh)&&e.jsxs(Z,{open:z,onOpenChange:V,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(be,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(J,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:t("restaurant.announcement")}),e.jsx(Y,{className:`w-5 h-5 text-muted-foreground transition-transform ${z?"rotate-180":""}`})]})}),e.jsx(ee,{className:"mt-3",children:e.jsx("div",{className:"p-3 rounded-md bg-primary/5 border border-primary/10",children:e.jsx("p",{className:"text-sm text-foreground whitespace-pre-wrap",children:l(r,"announcement")||r.announcement_zh})})})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[r.template!=="ghost"&&e.jsxs(y,{variant:"secondary",className:"w-full",onClick:()=>te(!0),children:[e.jsx(Ge,{className:"w-4 h-4 mr-2"}),t("restaurant.getDirections")]}),r.website_url&&(r.show_takeaway_button||r.show_booking_button&&r.template!=="ghost")&&e.jsxs(y,{className:"w-full",onClick:()=>F(!0),children:[e.jsx(bt,{className:"w-4 h-4 mr-2"}),t("restaurant.orderOrBook","外卖/订台")]})]}),e.jsx(me,{open:Ne,onOpenChange:te,children:e.jsxs(xe,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(ue,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(Ge,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(he,{className:"text-base font-semibold tracking-tight text-foreground",children:t("navigation.confirmTitle")}),e.jsx(pe,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:t("navigation.confirmDescriptionSimple",{destination:S.name})})]})]}),e.jsxs(ge,{className:"relative flex-col gap-2 pt-4 mt-1",children:[e.jsx(ae,{onClick:()=>{Ct(r.lat,r.lng,S.name),te(!1)},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:t("navigation.openNavigation","获取路线")}),e.jsx(fe,{className:"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:t("common.cancel")})]})]})}),e.jsx(me,{open:n,onOpenChange:L,children:e.jsxs(xe,{className:"max-w-xs w-[calc(100%-3rem)] mx-auto border-0 bg-white/70 dark:bg-gray-900/70 backdrop-blur-xl shadow-2xl rounded-3xl overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 rounded-3xl bg-gradient-to-b from-white/30 via-transparent to-transparent pointer-events-none"}),e.jsxs(ue,{className:"relative text-center pb-2",children:[e.jsx("div",{className:"mx-auto mb-4 w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/20 to-primary/10 flex items-center justify-center shadow-inner shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(Ve,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:2})}),e.jsx(he,{className:"text-lg font-semibold text-foreground",children:t("restaurant.joinPrivateTitle")}),e.jsx(pe,{className:"text-center text-sm text-muted-foreground mt-2 leading-relaxed",children:t("restaurant.joinPrivateDescription")})]}),e.jsxs(ge,{className:"relative flex-col gap-2 pt-4",children:[e.jsxs(ae,{onClick:()=>{const i=new URL(r.website_url);d&&i.searchParams.set("user_id",d.id);const m=i.toString();ye(m)},className:"w-full rounded-xl py-3 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/20 transition-all duration-200",children:[Q?e.jsx(_e,{className:"w-4 h-4 mr-2 animate-spin"}):null,t("restaurant.joinPrivateConfirm")]}),e.jsx(fe,{className:"w-full rounded-xl py-3 bg-white/50 dark:bg-white/10 hover:bg-white/70 dark:hover:bg-white/20 border-0 text-muted-foreground font-medium transition-all duration-200",children:t("common.cancel")})]})]})}),e.jsx(me,{open:ie,onOpenChange:F,children:e.jsxs(xe,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(ue,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(Ve,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(he,{className:"text-base font-semibold tracking-tight text-foreground",children:t("restaurant.orderOrBookTitle","外卖/订台")}),e.jsx(pe,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:d?t("restaurant.orderOrBookDescription","即将为您打开餐厅私域页面"):t("restaurant.orderOrBookLoginRequired","请先登录后再进入餐厅私域页面")})]})]}),e.jsxs(ge,{className:"relative flex-col gap-2 pt-4 mt-1",children:[d?e.jsx(ae,{onClick:()=>{try{let i=r.website_url;if(d){const m=new URL(r.website_url);m.searchParams.set("user_id",d.id),i=m.toString()}ye(i)}catch{ye(r.website_url)}},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:t("common.continue","继续")}):e.jsx(ae,{onClick:()=>{F(!1),W("/auth",{state:{from:c.pathname}})},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:t("auth.login","登录")}),e.jsx(fe,{className:"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:t("common.cancel")})]})]})}),e.jsx(Ts,{restaurantId:r.id,showGallery:r.show_dish_gallery!==!1}),r.template!=="ghost"&&e.jsx("div",{ref:O,children:e.jsxs(Z,{open:N,onOpenChange:_,className:"p-4 rounded-lg bg-muted/50",children:[e.jsx(J,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:t("restaurant.map")}),e.jsx(Y,{className:`w-5 h-5 text-muted-foreground transition-transform ${N?"rotate-180":""}`})]})}),e.jsx(ee,{children:h?e.jsx("div",{ref:o,className:"h-[350px] rounded-lg overflow-hidden bg-muted"}):e.jsx("div",{className:"h-[350px] rounded-lg bg-muted flex items-center justify-center",children:e.jsx(_e,{className:"w-6 h-6 animate-spin text-muted-foreground"})})})]})}),e.jsx(He,{}),e.jsx(_s,{restaurantId:r.id}),e.jsx(He,{}),e.jsx("div",{ref:U,children:k?e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(_e,{className:"w-8 h-8 animate-spin text-primary"})}),children:e.jsx(Xt,{restaurantId:r.id})}):e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(_e,{className:"w-8 h-8 animate-spin text-muted-foreground"})})})]})]})}),e.jsx(me,{open:le,onOpenChange:I,children:e.jsxs(xe,{children:[e.jsxs(ue,{children:[e.jsx(he,{children:t("activities.loginRequired")}),e.jsx(pe,{children:t("activities.loginRequiredMessage")})]}),e.jsxs(ge,{children:[e.jsx(fe,{children:t("common.cancel")}),e.jsx(ae,{onClick:()=>W("/auth"),children:t("activities.goToLogin")})]})]})}),oe]})})};export{Sa as default};
//# sourceMappingURL=RestaurantDetail-CxMCvZk8.js.map
