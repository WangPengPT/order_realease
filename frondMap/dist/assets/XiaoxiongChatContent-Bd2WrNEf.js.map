{"version":3,"file":"XiaoxiongChatContent-Bd2WrNEf.js","sources":["../../src/hooks/useXiaoxiongChat.ts","../../src/components/XiaoxiongChatContent.tsx"],"sourcesContent":["import { useState, useRef, useCallback } from \"react\";\r\nimport { flushSync } from \"react-dom\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\n\r\nconst SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL;\r\nconst SUPABASE_ANON_KEY = import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY;\r\n\r\n// Location-related keywords in multiple languages\r\nconst LOCATION_KEYWORDS = [\r\n  // 中文\r\n  \"最近\", \"附近\", \"离我\", \"距离\", \"远近\", \"近的\", \"周边\", \"周围\", \"最近的\", \"附近的\",\r\n  // 英文\r\n  \"nearest\", \"closest\", \"nearby\", \"near me\", \"close to me\", \"distance\", \"around me\",\r\n  // 葡萄牙语\r\n  \"mais perto\", \"próximo\", \"perto de mim\", \"distância\", \"mais próximo\"\r\n];\r\n\r\nexport interface Message {\r\n  id: string;\r\n  role: \"user\" | \"assistant\";\r\n  content: string;\r\n  isStreaming?: boolean;\r\n}\r\n\r\nexport type Provider = \"ask-xiaoxiong\" | \"xiaoxiong-agent\" | \"lovable-ai\" | \"xiaoxiong-community\";\r\n\r\n// Get or create a random user ID for non-logged-in users\r\nconst getAnonymousUserId = (): string => {\r\n  const storageKey = \"xiaoxiong_anonymous_user_id\";\r\n  let anonymousId = localStorage.getItem(storageKey);\r\n  if (!anonymousId) {\r\n    anonymousId = `anon_${Date.now()}_${Math.random().toString(36).substring(2, 11)}`;\r\n    localStorage.setItem(storageKey, anonymousId);\r\n  }\r\n  return anonymousId;\r\n};\r\n\r\nexport const useXiaoxiongChat = (provider: Provider = \"ask-xiaoxiong\") => {\r\n  const { i18n } = useTranslation();\r\n  const { user } = useAuth();\r\n  \r\n  const [input, setInput] = useState(\"\");\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [userLocation, setUserLocation] = useState<{ lat: number; lng: number } | null>(null);\r\n  const [showLocationDialog, setShowLocationDialog] = useState(false);\r\n  const [pendingMessage, setPendingMessage] = useState<string | null>(null);\r\n  \r\n  const abortControllerRef = useRef<AbortController | null>(null);\r\n\r\n  // Get user ID for agent provider\r\n  const getUserId = useCallback((): string => {\r\n    if (user?.id) {\r\n      return user.id;\r\n    }\r\n    return getAnonymousUserId();\r\n  }, [user?.id]);\r\n\r\n  // Check if message needs location info\r\n  const needsLocationInfo = useCallback((message: string): boolean => {\r\n    const lowerMessage = message.toLowerCase();\r\n    return LOCATION_KEYWORDS.some(keyword => lowerMessage.includes(keyword));\r\n  }, []);\r\n\r\n  const handleSubmitAskXiaoxiong = async (userMessage: Message, assistantMessageId: string) => {\r\n    const response = await fetch(`${SUPABASE_URL}/functions/v1/ask-xiaoxiong`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,\r\n        'apikey': SUPABASE_ANON_KEY,\r\n      },\r\n      body: JSON.stringify({ \r\n        text: userMessage.content, \r\n        stream: true,\r\n        lat: userLocation?.lat,\r\n        lng: userLocation?.lng,\r\n      }),\r\n      signal: abortControllerRef.current?.signal,\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`Request failed with status: ${response.status}`);\r\n    }\r\n\r\n    if (!response.body) {\r\n      throw new Error('No response body');\r\n    }\r\n\r\n    const reader = response.body.getReader();\r\n    const decoder = new TextDecoder();\r\n    let accumulatedResult = \"\";\r\n\r\n    while (true) {\r\n      const { done, value } = await reader.read();\r\n      \r\n      if (done) {\r\n        break;\r\n      }\r\n\r\n      const chunk = decoder.decode(value, { stream: true });\r\n      accumulatedResult += chunk;\r\n      \r\n      let cleanResult = accumulatedResult;\r\n      if (cleanResult.startsWith('\"')) {\r\n        cleanResult = cleanResult.slice(1);\r\n      }\r\n      if (cleanResult.endsWith('\"')) {\r\n        cleanResult = cleanResult.slice(0, -1);\r\n      }\r\n      cleanResult = cleanResult.replace(/\\\\n/g, '\\n');\r\n      \r\n      setMessages((prev) =>\r\n        prev.map((msg) =>\r\n          msg.id === assistantMessageId\r\n            ? { ...msg, content: cleanResult }\r\n            : msg\r\n        )\r\n      );\r\n    }\r\n\r\n    let finalResult = accumulatedResult;\r\n    if (finalResult.startsWith('\"')) {\r\n      finalResult = finalResult.slice(1);\r\n    }\r\n    if (finalResult.endsWith('\"')) {\r\n      finalResult = finalResult.slice(0, -1);\r\n    }\r\n    finalResult = finalResult.replace(/\\\\n/g, '\\n');\r\n    \r\n    setMessages((prev) =>\r\n      prev.map((msg) =>\r\n        msg.id === assistantMessageId\r\n          ? { ...msg, content: finalResult, isStreaming: false }\r\n          : msg\r\n      )\r\n    );\r\n  };\r\n\r\n  const handleSubmitXiaoxiongAgent = async (userMessage: Message, assistantMessageId: string) => {\r\n    const userId = getUserId();\r\n    \r\n    const response = await fetch(`${SUPABASE_URL}/functions/v1/xiaoxiong-agent`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,\r\n        'apikey': SUPABASE_ANON_KEY,\r\n      },\r\n      body: JSON.stringify({ \r\n        message: userMessage.content, \r\n        userId,\r\n      }),\r\n      signal: abortControllerRef.current?.signal,\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`Request failed with status: ${response.status}`);\r\n    }\r\n\r\n    if (!response.body) {\r\n      throw new Error('No response body');\r\n    }\r\n\r\n    const reader = response.body.getReader();\r\n    const decoder = new TextDecoder();\r\n    let accumulatedResult = \"\";\r\n\r\n    while (true) {\r\n      const { done, value } = await reader.read();\r\n      \r\n      if (done) {\r\n        break;\r\n      }\r\n\r\n      const chunk = decoder.decode(value, { stream: true });\r\n      accumulatedResult += chunk;\r\n      \r\n      flushSync(() => {\r\n        setMessages((prev) =>\r\n          prev.map((msg) =>\r\n            msg.id === assistantMessageId\r\n              ? { ...msg, content: accumulatedResult }\r\n              : msg\r\n          )\r\n        );\r\n      });\r\n      \r\n      await new Promise(resolve => requestAnimationFrame(resolve));\r\n    }\r\n\r\n    setMessages((prev) =>\r\n      prev.map((msg) =>\r\n        msg.id === assistantMessageId\r\n          ? { ...msg, isStreaming: false }\r\n          : msg\r\n      )\r\n    );\r\n  };\r\n\r\n  const handleSubmitLovableAI = async (userMessage: Message, assistantMessageId: string) => {\r\n    const response = await fetch(`${SUPABASE_URL}/functions/v1/lovable-chat`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,\r\n        'apikey': SUPABASE_ANON_KEY,\r\n      },\r\n      body: JSON.stringify({ \r\n        message: userMessage.content,\r\n        lat: userLocation?.lat,\r\n        lng: userLocation?.lng,\r\n        language: i18n.language,\r\n      }),\r\n      signal: abortControllerRef.current?.signal,\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorData = await response.json().catch(() => ({}));\r\n      throw new Error(errorData.error || `Request failed with status: ${response.status}`);\r\n    }\r\n\r\n    if (!response.body) {\r\n      throw new Error('No response body');\r\n    }\r\n\r\n    const reader = response.body.getReader();\r\n    const decoder = new TextDecoder();\r\n    let accumulatedResult = \"\";\r\n    let textBuffer = \"\";\r\n\r\n    while (true) {\r\n      const { done, value } = await reader.read();\r\n      \r\n      if (done) {\r\n        break;\r\n      }\r\n\r\n      textBuffer += decoder.decode(value, { stream: true });\r\n\r\n      let newlineIndex: number;\r\n      while ((newlineIndex = textBuffer.indexOf(\"\\n\")) !== -1) {\r\n        let line = textBuffer.slice(0, newlineIndex);\r\n        textBuffer = textBuffer.slice(newlineIndex + 1);\r\n\r\n        if (line.endsWith(\"\\r\")) line = line.slice(0, -1);\r\n        if (line.startsWith(\":\") || line.trim() === \"\") continue;\r\n        if (!line.startsWith(\"data: \")) continue;\r\n\r\n        const jsonStr = line.slice(6).trim();\r\n        if (jsonStr === \"[DONE]\") break;\r\n\r\n        try {\r\n          const parsed = JSON.parse(jsonStr);\r\n          const content = parsed.choices?.[0]?.delta?.content as string | undefined;\r\n          if (content) {\r\n            accumulatedResult += content;\r\n            \r\n            flushSync(() => {\r\n              setMessages((prev) =>\r\n                prev.map((msg) =>\r\n                  msg.id === assistantMessageId\r\n                    ? { ...msg, content: accumulatedResult }\r\n                    : msg\r\n                )\r\n              );\r\n            });\r\n            \r\n            await new Promise(resolve => requestAnimationFrame(resolve));\r\n          }\r\n        } catch {\r\n          // Ignore parsing errors\r\n        }\r\n      }\r\n    }\r\n\r\n    setMessages((prev) =>\r\n      prev.map((msg) =>\r\n        msg.id === assistantMessageId\r\n          ? { ...msg, isStreaming: false }\r\n          : msg\r\n      )\r\n    );\r\n  };\r\n\r\n  const handleSubmitXiaoxiongCommunity = async (userMessage: Message, assistantMessageId: string) => {\r\n    // Build messages array for context\r\n    const chatMessages = messages\r\n      .filter(m => m.content && !m.isStreaming)\r\n      .map(m => ({ role: m.role, content: m.content }));\r\n    chatMessages.push({ role: \"user\", content: userMessage.content });\r\n\r\n    const response = await fetch(`${SUPABASE_URL}/functions/v1/xiaoxiong-community`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,\r\n        'apikey': SUPABASE_ANON_KEY,\r\n      },\r\n      body: JSON.stringify({ \r\n        messages: chatMessages,\r\n        includeContext: true,\r\n      }),\r\n      signal: abortControllerRef.current?.signal,\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorData = await response.json().catch(() => ({}));\r\n      throw new Error(errorData.error || `Request failed with status: ${response.status}`);\r\n    }\r\n\r\n    if (!response.body) {\r\n      throw new Error('No response body');\r\n    }\r\n\r\n    const reader = response.body.getReader();\r\n    const decoder = new TextDecoder();\r\n    let accumulatedResult = \"\";\r\n    let textBuffer = \"\";\r\n\r\n    while (true) {\r\n      const { done, value } = await reader.read();\r\n      \r\n      if (done) {\r\n        break;\r\n      }\r\n\r\n      textBuffer += decoder.decode(value, { stream: true });\r\n\r\n      let newlineIndex: number;\r\n      while ((newlineIndex = textBuffer.indexOf(\"\\n\")) !== -1) {\r\n        let line = textBuffer.slice(0, newlineIndex);\r\n        textBuffer = textBuffer.slice(newlineIndex + 1);\r\n\r\n        if (line.endsWith(\"\\r\")) line = line.slice(0, -1);\r\n        if (line.startsWith(\":\") || line.trim() === \"\") continue;\r\n        if (!line.startsWith(\"data: \")) continue;\r\n\r\n        const jsonStr = line.slice(6).trim();\r\n        if (jsonStr === \"[DONE]\") break;\r\n\r\n        try {\r\n          const parsed = JSON.parse(jsonStr);\r\n          const content = parsed.choices?.[0]?.delta?.content as string | undefined;\r\n          if (content) {\r\n            accumulatedResult += content;\r\n            \r\n            flushSync(() => {\r\n              setMessages((prev) =>\r\n                prev.map((msg) =>\r\n                  msg.id === assistantMessageId\r\n                    ? { ...msg, content: accumulatedResult }\r\n                    : msg\r\n                )\r\n              );\r\n            });\r\n            \r\n            await new Promise(resolve => requestAnimationFrame(resolve));\r\n          }\r\n        } catch {\r\n          // Ignore parsing errors\r\n        }\r\n      }\r\n    }\r\n\r\n    setMessages((prev) =>\r\n      prev.map((msg) =>\r\n        msg.id === assistantMessageId\r\n          ? { ...msg, isStreaming: false }\r\n          : msg\r\n      )\r\n    );\r\n  };\r\n\r\n  // Process and send message to AI\r\n  const processMessage = useCallback(async (messageContent: string) => {\r\n    const userMessage: Message = {\r\n      id: Date.now().toString(),\r\n      role: \"user\",\r\n      content: messageContent,\r\n    };\r\n\r\n    const assistantMessageId = (Date.now() + 1).toString();\r\n    const assistantMessage: Message = {\r\n      id: assistantMessageId,\r\n      role: \"assistant\",\r\n      content: \"\",\r\n      isStreaming: true,\r\n    };\r\n\r\n    setMessages((prev) => [...prev, userMessage, assistantMessage]);\r\n    setInput(\"\");\r\n    setIsLoading(true);\r\n\r\n    if (abortControllerRef.current) {\r\n      abortControllerRef.current.abort();\r\n    }\r\n    abortControllerRef.current = new AbortController();\r\n\r\n    try {\r\n      if (provider === \"xiaoxiong-community\") {\r\n        await handleSubmitXiaoxiongCommunity(userMessage, assistantMessageId);\r\n      } else if (provider === \"lovable-ai\") {\r\n        await handleSubmitLovableAI(userMessage, assistantMessageId);\r\n      } else if (provider === \"xiaoxiong-agent\") {\r\n        await handleSubmitXiaoxiongAgent(userMessage, assistantMessageId);\r\n      } else {\r\n        await handleSubmitAskXiaoxiong(userMessage, assistantMessageId);\r\n      }\r\n    } catch (err) {\r\n      if (err instanceof Error && err.name === 'AbortError') {\r\n        console.log('Request aborted');\r\n        return;\r\n      }\r\n      console.error(\"Ask API error:\", err);\r\n      const errorMessage =\r\n        i18n.language === \"zh\"\r\n          ? \"抱歉，暂时无法获取结果，请稍后再试\"\r\n          : i18n.language === \"pt\"\r\n          ? \"Desculpe, não foi possível obter resultados. Tente novamente mais tarde.\"\r\n          : \"Sorry, unable to get results. Please try again later.\";\r\n      \r\n      setMessages((prev) =>\r\n        prev.map((msg) =>\r\n          msg.id === assistantMessageId\r\n            ? { ...msg, content: errorMessage, isStreaming: false }\r\n            : msg\r\n        )\r\n      );\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [provider, userLocation, i18n.language, getUserId]);\r\n\r\n  // Handle location permission confirmation\r\n  const handleLocationConfirm = useCallback(() => {\r\n    setShowLocationDialog(false);\r\n    navigator.geolocation?.getCurrentPosition(\r\n      (position) => {\r\n        setUserLocation({\r\n          lat: position.coords.latitude,\r\n          lng: position.coords.longitude,\r\n        });\r\n        if (pendingMessage) {\r\n          setTimeout(() => {\r\n            processMessage(pendingMessage);\r\n            setPendingMessage(null);\r\n          }, 100);\r\n        }\r\n      },\r\n      (error) => {\r\n        console.log(\"Location permission denied:\", error.message);\r\n        if (pendingMessage) {\r\n          processMessage(pendingMessage);\r\n          setPendingMessage(null);\r\n        }\r\n      },\r\n      { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }\r\n    );\r\n  }, [pendingMessage, processMessage]);\r\n\r\n  const handleSubmit = useCallback(async () => {\r\n    if (!input.trim() || isLoading) return;\r\n\r\n    const messageContent = input.trim();\r\n\r\n    if (!userLocation && needsLocationInfo(messageContent)) {\r\n      setPendingMessage(messageContent);\r\n      setShowLocationDialog(true);\r\n      setInput(\"\");\r\n      return;\r\n    }\r\n\r\n    await processMessage(messageContent);\r\n  }, [input, isLoading, userLocation, needsLocationInfo, processMessage]);\r\n\r\n  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\r\n    if (e.key === \"Enter\" && !e.shiftKey) {\r\n      e.preventDefault();\r\n      handleSubmit();\r\n    }\r\n  }, [handleSubmit]);\r\n\r\n  const abortRequest = useCallback(() => {\r\n    if (abortControllerRef.current) {\r\n      abortControllerRef.current.abort();\r\n    }\r\n  }, []);\r\n\r\n  // Get initial location\r\n  const requestLocation = useCallback(() => {\r\n    navigator.geolocation?.getCurrentPosition(\r\n      (position) => {\r\n        setUserLocation({\r\n          lat: position.coords.latitude,\r\n          lng: position.coords.longitude,\r\n        });\r\n      },\r\n      (error) => {\r\n        console.log(\"Unable to get user location:\", error.message);\r\n      },\r\n      { enableHighAccuracy: false, timeout: 5000, maximumAge: 300000 }\r\n    );\r\n  }, []);\r\n\r\n  return {\r\n    input,\r\n    setInput,\r\n    messages,\r\n    isLoading,\r\n    showLocationDialog,\r\n    setShowLocationDialog,\r\n    pendingMessage,\r\n    setPendingMessage,\r\n    handleSubmit,\r\n    handleKeyDown,\r\n    handleLocationConfirm,\r\n    processMessage,\r\n    abortRequest,\r\n    requestLocation,\r\n  };\r\n};\r\n","import { useRef, useEffect, useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { Send, Loader2, User, Mic, MicOff, ArrowLeft } from \"lucide-react\";\r\nimport { useSiteSettings } from \"@/hooks/useSiteSettings\";\r\nimport { useProfile } from \"@/hooks/useProfile\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport LocationPermissionDialog from \"@/components/LocationPermissionDialog\";\r\nimport ExternalLinkConfirmDialog from \"@/components/ExternalLinkConfirmDialog\";\r\nimport { openExternalUrl } from \"@/lib/externalLinks\";\r\nimport { Message } from \"@/hooks/useXiaoxiongChat\";\r\n\r\n// TypeScript declarations for Web Speech API\r\ninterface SpeechRecognitionEvent extends Event {\r\n  results: SpeechRecognitionResultList;\r\n}\r\n\r\ninterface SpeechRecognitionErrorEvent extends Event {\r\n  error: string;\r\n}\r\n\r\ninterface SpeechRecognition extends EventTarget {\r\n  lang: string;\r\n  continuous: boolean;\r\n  interimResults: boolean;\r\n  onstart: ((this: SpeechRecognition, ev: Event) => void) | null;\r\n  onresult: ((this: SpeechRecognition, ev: SpeechRecognitionEvent) => void) | null;\r\n  onerror: ((this: SpeechRecognition, ev: SpeechRecognitionErrorEvent) => void) | null;\r\n  onend: ((this: SpeechRecognition, ev: Event) => void) | null;\r\n  start(): void;\r\n  stop(): void;\r\n}\r\n\r\ndeclare global {\r\n  interface Window {\r\n    SpeechRecognition: new () => SpeechRecognition;\r\n    webkitSpeechRecognition: new () => SpeechRecognition;\r\n    webkit?: {\r\n      messageHandlers: {\r\n        VoiceBridge?: {\r\n          postMessage: (message: string) => void;\r\n        };\r\n      };\r\n    };\r\n    VoiceBridge?: {\r\n      postMessage: (message: string) => void;\r\n    };\r\n    onSpeechResult?: (text: string) => void;\r\n  }\r\n}\r\n\r\n// Check for native voice bridge support\r\nconst hasNativeVoiceBridge = (): boolean => {\r\n  return !!(\r\n    (window.webkit?.messageHandlers?.VoiceBridge) || \r\n    window.VoiceBridge\r\n  );\r\n};\r\n\r\n// Native voice bridge utility\r\nconst NativeVoice = {\r\n  start: () => {\r\n    const message = JSON.stringify({ action: \"start\" });\r\n    if (window.webkit?.messageHandlers?.VoiceBridge) {\r\n      window.webkit.messageHandlers.VoiceBridge.postMessage(message);\r\n    } else if (window.VoiceBridge) {\r\n      window.VoiceBridge.postMessage(message);\r\n    }\r\n  },\r\n  stop: () => {\r\n    const message = JSON.stringify({ action: \"stop\" });\r\n    if (window.webkit?.messageHandlers?.VoiceBridge) {\r\n      window.webkit.messageHandlers.VoiceBridge.postMessage(message);\r\n    } else if (window.VoiceBridge) {\r\n      window.VoiceBridge.postMessage(message);\r\n    }\r\n  }\r\n};\r\n\r\ninterface XiaoxiongChatContentProps {\r\n  messages: Message[];\r\n  input: string;\r\n  setInput: (value: string) => void;\r\n  isLoading: boolean;\r\n  showLocationDialog: boolean;\r\n  setShowLocationDialog: (value: boolean) => void;\r\n  pendingMessage: string | null;\r\n  handleSubmit: () => void;\r\n  handleKeyDown: (e: React.KeyboardEvent) => void;\r\n  handleLocationConfirm: () => void;\r\n  processMessage: (message: string) => void;\r\n  setPendingMessage: (message: string | null) => void;\r\n  onClose?: () => void;\r\n  showBackButton?: boolean;\r\n  showHeader?: boolean;\r\n  className?: string;\r\n}\r\n\r\nconst XiaoxiongChatContent = ({\r\n  messages,\r\n  input,\r\n  setInput,\r\n  isLoading,\r\n  showLocationDialog,\r\n  setShowLocationDialog,\r\n  pendingMessage,\r\n  handleSubmit,\r\n  handleKeyDown,\r\n  handleLocationConfirm,\r\n  processMessage,\r\n  setPendingMessage,\r\n  onClose,\r\n  showBackButton = false,\r\n  showHeader = true,\r\n  className,\r\n}: XiaoxiongChatContentProps) => {\r\n  const { i18n } = useTranslation();\r\n  const navigate = useNavigate();\r\n  const { settings } = useSiteSettings();\r\n  const { data: profile } = useProfile();\r\n  const logoUrl = settings?.logo_url;\r\n  const userAvatarUrl = profile?.avatar_url;\r\n  \r\n  const [isListening, setIsListening] = useState(false);\r\n  const [speechSupported, setSpeechSupported] = useState(false);\r\n  const [nativeVoiceSupported, setNativeVoiceSupported] = useState(false);\r\n  const [externalLinkDialogOpen, setExternalLinkDialogOpen] = useState(false);\r\n  const [pendingExternalLink, setPendingExternalLink] = useState<string | null>(null);\r\n  \r\n  const scrollAreaRef = useRef<HTMLDivElement>(null);\r\n  const recognitionRef = useRef<SpeechRecognition | null>(null);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Check for speech recognition support\r\n  useEffect(() => {\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    setSpeechSupported(!!SpeechRecognition);\r\n    setNativeVoiceSupported(hasNativeVoiceBridge());\r\n    \r\n    window.onSpeechResult = (text: string) => {\r\n      setInput(text);\r\n      setIsListening(false);\r\n    };\r\n    \r\n    return () => {\r\n      window.onSpeechResult = undefined;\r\n    };\r\n  }, [setInput]);\r\n\r\n  // Auto scroll to bottom\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  // Cleanup speech recognition\r\n  useEffect(() => {\r\n    return () => {\r\n      if (recognitionRef.current) {\r\n        recognitionRef.current.stop();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const shouldShowVoiceInput = (): boolean => {\r\n    return speechSupported || nativeVoiceSupported;\r\n  };\r\n\r\n  const startListening = () => {\r\n    if (nativeVoiceSupported) {\r\n      NativeVoice.start();\r\n      setIsListening(true);\r\n      return;\r\n    }\r\n\r\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    if (!SpeechRecognition) return;\r\n\r\n    if (recognitionRef.current) {\r\n      recognitionRef.current.stop();\r\n    }\r\n\r\n    const recognition = new SpeechRecognition();\r\n    recognitionRef.current = recognition;\r\n\r\n    const langMap: Record<string, string> = {\r\n      zh: \"zh-CN\",\r\n      en: \"en-US\",\r\n      pt: \"pt-BR\",\r\n    };\r\n    recognition.lang = langMap[i18n.language] || \"zh-CN\";\r\n    recognition.continuous = false;\r\n    recognition.interimResults = true;\r\n\r\n    recognition.onstart = () => setIsListening(true);\r\n    recognition.onresult = (event) => {\r\n      const transcript = Array.from(event.results)\r\n        .map((result) => result[0].transcript)\r\n        .join(\"\");\r\n      setInput(transcript);\r\n    };\r\n    recognition.onerror = () => setIsListening(false);\r\n    recognition.onend = () => setIsListening(false);\r\n    recognition.start();\r\n  };\r\n\r\n  const stopListening = () => {\r\n    if (nativeVoiceSupported) {\r\n      NativeVoice.stop();\r\n      setIsListening(false);\r\n      return;\r\n    }\r\n    \r\n    if (recognitionRef.current) {\r\n      recognitionRef.current.stop();\r\n      setIsListening(false);\r\n    }\r\n  };\r\n\r\n  const toggleListening = () => {\r\n    if (isListening) {\r\n      stopListening();\r\n    } else {\r\n      startListening();\r\n    }\r\n  };\r\n\r\n  const handleLinkClick = (href: string) => {\r\n    onClose?.();\r\n    navigate(href);\r\n  };\r\n\r\n  const handleExternalLinkClick = (url: string) => {\r\n    setPendingExternalLink(url);\r\n    setExternalLinkDialogOpen(true);\r\n  };\r\n\r\n  const confirmExternalLink = () => {\r\n    if (pendingExternalLink) {\r\n      openExternalUrl(pendingExternalLink);\r\n    }\r\n    setExternalLinkDialogOpen(false);\r\n    setPendingExternalLink(null);\r\n  };\r\n\r\n  // Parse text with links\r\n  const parseTextWithLinks = (text: string): JSX.Element[] => {\r\n    const linkRegex = /\\[([^\\]]+)\\]\\(([^)]+)\\)/g;\r\n    const parts: JSX.Element[] = [];\r\n    let lastIndex = 0;\r\n    let match;\r\n    let keyIndex = 0;\r\n\r\n    while ((match = linkRegex.exec(text)) !== null) {\r\n      if (match.index > lastIndex) {\r\n        parts.push(<span key={keyIndex++}>{text.slice(lastIndex, match.index)}</span>);\r\n      }\r\n\r\n      const linkText = match[1];\r\n      const href = match[2];\r\n\r\n      if (href.startsWith(\"/\")) {\r\n        parts.push(\r\n          <button\r\n            key={keyIndex++}\r\n            onClick={() => handleLinkClick(href)}\r\n            className=\"text-primary hover:underline font-medium cursor-pointer\"\r\n          >\r\n            {linkText}\r\n          </button>\r\n        );\r\n      } else if (href.startsWith(\"!external:\")) {\r\n        const actualUrl = href.slice(\"!external:\".length);\r\n        parts.push(\r\n          <button\r\n            key={keyIndex++}\r\n            onClick={() => handleExternalLinkClick(actualUrl)}\r\n            className=\"text-primary hover:underline font-medium cursor-pointer\"\r\n          >\r\n            {linkText}\r\n          </button>\r\n        );\r\n      } else if (href.startsWith(\"http://\") || href.startsWith(\"https://\")) {\r\n        parts.push(\r\n          <button\r\n            key={keyIndex++}\r\n            onClick={() => handleExternalLinkClick(href)}\r\n            className=\"text-primary hover:underline font-medium cursor-pointer\"\r\n          >\r\n            {linkText}\r\n          </button>\r\n        );\r\n      } else {\r\n        parts.push(\r\n          <a\r\n            key={keyIndex++}\r\n            href={href}\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n            className=\"text-primary hover:underline font-medium\"\r\n          >\r\n            {linkText}\r\n          </a>\r\n        );\r\n      }\r\n\r\n      lastIndex = match.index + match[0].length;\r\n    }\r\n\r\n    if (lastIndex < text.length) {\r\n      parts.push(<span key={keyIndex++}>{text.slice(lastIndex)}</span>);\r\n    }\r\n\r\n    return parts.length > 0 ? parts : [<span key=\"0\">{text}</span>];\r\n  };\r\n\r\n  const removeBoldMarkers = (text: string): string => {\r\n    return text.replace(/\\*\\*(.*?)\\*\\*/g, '$1');\r\n  };\r\n\r\n  const truncateText = (text: string, maxLength: number = 20): string => {\r\n    if (text.length <= maxLength) return text;\r\n    return text.slice(0, maxLength) + '...';\r\n  };\r\n\r\n  const renderTable = (tableLines: string[], key: number) => {\r\n    const parseRow = (line: string) =>\r\n      line\r\n        .split(\"|\")\r\n        .slice(1, -1)\r\n        .map((cell) => removeBoldMarkers(cell.trim()));\r\n\r\n    const headers = parseRow(tableLines[0]);\r\n    const rows = tableLines.slice(2).map(parseRow);\r\n\r\n    return (\r\n      <div key={key} className=\"overflow-x-auto my-2 max-w-full\">\r\n        <table className=\"w-full text-xs border border-border rounded-md overflow-hidden table-fixed\">\r\n          <thead className=\"bg-muted/60\">\r\n            <tr>\r\n              {headers.map((header, i) => (\r\n                <th\r\n                  key={i}\r\n                  className=\"px-2 py-2 text-left font-semibold border-b border-border truncate max-w-[100px]\"\r\n                  title={header}\r\n                >\r\n                  {parseTextWithLinks(truncateText(header, 15))}\r\n                </th>\r\n              ))}\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {rows.map((row, rowIndex) => (\r\n              <tr\r\n                key={rowIndex}\r\n                className=\"border-b border-border last:border-0 hover:bg-muted/30 transition-colors\"\r\n              >\r\n                {row.map((cell, cellIndex) => (\r\n                  <td \r\n                    key={cellIndex} \r\n                    className=\"px-2 py-2 truncate max-w-[100px]\"\r\n                    title={cell}\r\n                  >\r\n                    {parseTextWithLinks(truncateText(cell, 18))}\r\n                  </td>\r\n                ))}\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderMarkdown = (content: string) => {\r\n    const lines = content.split(\"\\n\");\r\n    const elements: JSX.Element[] = [];\r\n    let i = 0;\r\n\r\n    while (i < lines.length) {\r\n      const line = lines[i];\r\n\r\n      if (line.trim().startsWith(\"|\") && line.split(\"|\").length > 2) {\r\n        const tableLines: string[] = [];\r\n        while (i < lines.length && lines[i].trim().startsWith(\"|\")) {\r\n          tableLines.push(lines[i]);\r\n          i++;\r\n        }\r\n        if (tableLines.length >= 2) {\r\n          elements.push(renderTable(tableLines, elements.length));\r\n        }\r\n        continue;\r\n      }\r\n\r\n      if (line.startsWith(\"### \")) {\r\n        elements.push(\r\n          <h3 key={elements.length} className=\"text-base font-semibold mt-3 mb-1\">\r\n            {parseTextWithLinks(line.slice(4))}\r\n          </h3>\r\n        );\r\n      } else if (line.startsWith(\"## \")) {\r\n        elements.push(\r\n          <h2 key={elements.length} className=\"text-lg font-bold mt-4 mb-2\">\r\n            {parseTextWithLinks(line.slice(3))}\r\n          </h2>\r\n        );\r\n      } else if (line.startsWith(\"# \")) {\r\n        elements.push(\r\n          <h1 key={elements.length} className=\"text-xl font-bold mt-4 mb-2\">\r\n            {parseTextWithLinks(line.slice(2))}\r\n          </h1>\r\n        );\r\n      } else if (line.includes(\"**\")) {\r\n        const parts = line.split(/\\*\\*(.*?)\\*\\*/g);\r\n        elements.push(\r\n          <p key={elements.length} className=\"mb-1 leading-relaxed\">\r\n            {parts.map((part, idx) =>\r\n              idx % 2 === 1 ? (\r\n                <strong key={idx} className=\"font-semibold\">\r\n                  {parseTextWithLinks(part)}\r\n                </strong>\r\n              ) : (\r\n                parseTextWithLinks(part)\r\n              )\r\n            )}\r\n          </p>\r\n        );\r\n      } else if (line.startsWith(\"- \") || line.startsWith(\"* \")) {\r\n        elements.push(\r\n          <li key={elements.length} className=\"ml-4 mb-0.5 list-disc\">\r\n            {parseTextWithLinks(line.slice(2))}\r\n          </li>\r\n        );\r\n      } else if (/^\\d+\\.\\s/.test(line)) {\r\n        elements.push(\r\n          <li key={elements.length} className=\"ml-4 mb-0.5 list-decimal\">\r\n            {parseTextWithLinks(line.replace(/^\\d+\\.\\s/, \"\"))}\r\n          </li>\r\n        );\r\n      } else if (line.match(/^[-*_]{3,}$/)) {\r\n        elements.push(<hr key={elements.length} className=\"my-3 border-border\" />);\r\n      } else if (line.trim() === \"\") {\r\n        elements.push(<div key={elements.length} className=\"h-1\" />);\r\n      } else {\r\n        elements.push(\r\n          <p key={elements.length} className=\"mb-1 leading-relaxed\">\r\n            {parseTextWithLinks(line)}\r\n          </p>\r\n        );\r\n      }\r\n\r\n      i++;\r\n    }\r\n\r\n    return elements;\r\n  };\r\n\r\n  const getTitle = () => {\r\n    if (i18n.language === \"zh\") return \"小熊AI助手\";\r\n    if (i18n.language === \"pt\") return \"Assistente IA Xiaoxiong\";\r\n    return \"Xiaoxiong AI Assistant\";\r\n  };\r\n\r\n  const getPlaceholder = () => {\r\n    if (i18n.language === \"zh\") return \"告诉小熊，你想吃什么...\";\r\n    if (i18n.language === \"pt\") return \"Diga ao Xiaoxiong o que você quer comer...\";\r\n    return \"Tell Xiaoxiong what you want to eat...\";\r\n  };\r\n\r\n  const getWelcomeMessage = () => {\r\n    if (i18n.language === \"zh\") return \"你好，我是小熊，我来帮你推荐餐厅；比如：「我附近的寿司餐厅」\";\r\n    if (i18n.language === \"pt\") return \"Olá, eu sou o Xiaoxiong, vou te ajudar a encontrar restaurantes; por exemplo: 「restaurantes de sushi perto de mim」\";\r\n    return \"Hi, I'm Xiaoxiong, I'll help you find restaurants; for example: \\\"sushi restaurants near me\\\"\";\r\n  };\r\n\r\n  return (\r\n    <div className={cn(\"flex flex-col h-full bg-background overflow-hidden\", className)}>\r\n      {/* Header - sticky to stay visible when iOS keyboard appears */}\r\n      {showHeader && (\r\n        <div className=\"px-4 py-3 shrink-0 border-b flex items-center gap-2 bg-background sticky top-0 z-10\">\r\n          {showBackButton && (\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"icon\"\r\n              onClick={onClose}\r\n              className=\"shrink-0\"\r\n            >\r\n              <ArrowLeft className=\"h-5 w-5\" />\r\n            </Button>\r\n          )}\r\n          <div className=\"flex items-center gap-2 flex-1\">\r\n            {logoUrl && <img src={logoUrl} alt=\"Logo\" className=\"w-8 h-8 rounded-full object-cover\" />}\r\n            <h1 className=\"text-base font-semibold\">{getTitle()}</h1>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Chat Messages Area */}\r\n      <ScrollArea className=\"flex-1 min-h-0 overflow-auto\" ref={scrollAreaRef}>\r\n        <div className=\"p-4 space-y-4\">\r\n          {/* Welcome message */}\r\n          {messages.length === 0 && (\r\n            <div className=\"flex gap-3\">\r\n              <div className=\"w-8 h-8 rounded-full bg-muted flex items-center justify-center shrink-0 overflow-hidden\">\r\n                {logoUrl && <img src={logoUrl} alt=\"Xiaoxiong\" className=\"w-full h-full object-cover\" />}\r\n              </div>\r\n              <div className=\"flex-1 bg-muted rounded-lg px-3 py-2 text-sm\">\r\n                {getWelcomeMessage()}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Messages */}\r\n          {messages.map((message) => (\r\n            <div\r\n              key={message.id}\r\n              className={cn(\r\n                \"flex gap-3\",\r\n                message.role === \"user\" && \"flex-row-reverse\"\r\n              )}\r\n            >\r\n              {message.role === \"user\" ? (\r\n                <div className=\"w-8 h-8 rounded-full bg-muted flex items-center justify-center shrink-0 overflow-hidden\">\r\n                  {userAvatarUrl ? (\r\n                    <img src={userAvatarUrl} alt=\"User\" className=\"w-full h-full object-cover\" />\r\n                  ) : (\r\n                    <User className=\"h-4 w-4\" />\r\n                  )}\r\n                </div>\r\n              ) : (\r\n                <div className=\"w-8 h-8 rounded-full bg-muted flex items-center justify-center shrink-0 overflow-hidden\">\r\n                  {logoUrl && <img src={logoUrl} alt=\"Xiaoxiong\" className=\"w-full h-full object-cover\" />}\r\n                </div>\r\n              )}\r\n              <div\r\n                className={cn(\r\n                  \"flex-1 max-w-[85%] rounded-lg px-3 py-2 text-sm bg-muted\",\r\n                )}\r\n              >\r\n                {message.role === \"assistant\" ? (\r\n                  <>\r\n                    {message.content ? (\r\n                      <div className=\"prose-sm\">\r\n                        {renderMarkdown(message.content)}\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"flex items-center gap-2 text-muted-foreground\">\r\n                        <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                        <span>\r\n                          {i18n.language === \"zh\"\r\n                            ? \"思考中...\"\r\n                            : i18n.language === \"pt\"\r\n                            ? \"Pensando...\"\r\n                            : \"Thinking...\"}\r\n                        </span>\r\n                      </div>\r\n                    )}\r\n                    {message.isStreaming && message.content && (\r\n                      <span className=\"inline-block w-1.5 h-4 bg-primary/50 animate-pulse ml-0.5 align-middle\" />\r\n                    )}\r\n                  </>\r\n                ) : (\r\n                  message.content\r\n                )}\r\n              </div>\r\n            </div>\r\n          ))}\r\n          <div ref={messagesEndRef} />\r\n        </div>\r\n      </ScrollArea>\r\n\r\n      {/* Input Section */}\r\n      <div className=\"px-2 py-1.5 pb-[max(1.5rem,calc(env(safe-area-inset-bottom)+1rem))] md:pb-4 shrink-0\">\r\n        <div className=\"flex items-center gap-1.5 px-2 py-1.5 rounded-full backdrop-blur-md border border-border/50 bg-muted/80 dark:bg-muted/60\">\r\n          {shouldShowVoiceInput() && (\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"icon\"\r\n              onClick={toggleListening}\r\n              disabled={isLoading}\r\n              className={cn(\"bg-transparent hover:bg-transparent\", isListening && \"text-destructive\")}\r\n            >\r\n              {isListening ? <MicOff className=\"h-4 w-4\" /> : <Mic className=\"h-4 w-4\" />}\r\n            </Button>\r\n          )}\r\n          \r\n          <Input\r\n            value={input}\r\n            onChange={(e) => setInput(e.target.value)}\r\n            onKeyDown={handleKeyDown}\r\n            placeholder={isListening ? (i18n.language === \"zh\" ? \"正在聆听...\" : \"Listening...\") : getPlaceholder()}\r\n            disabled={isLoading}\r\n            className=\"flex-1 bg-transparent border-0 shadow-none focus-visible:ring-0 focus-visible:ring-offset-0\"\r\n          />\r\n          <Button\r\n            onClick={handleSubmit}\r\n            disabled={!input.trim() || isLoading}\r\n            size=\"icon\"\r\n            variant=\"ghost\"\r\n            className=\"bg-transparent hover:bg-white/50 rounded-full\"\r\n          >\r\n            {isLoading ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <Send className=\"h-4 w-4\" />}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Location Permission Dialog */}\r\n      <LocationPermissionDialog\r\n        open={showLocationDialog}\r\n        onOpenChange={(open) => {\r\n          setShowLocationDialog(open);\r\n          if (!open && pendingMessage) {\r\n            processMessage(pendingMessage);\r\n            setPendingMessage(null);\r\n          }\r\n        }}\r\n        onConfirm={handleLocationConfirm}\r\n      />\r\n\r\n      {/* External Link Confirm Dialog */}\r\n      <ExternalLinkConfirmDialog\r\n        open={externalLinkDialogOpen}\r\n        onOpenChange={setExternalLinkDialogOpen}\r\n        onConfirm={confirmExternalLink}\r\n        url={pendingExternalLink || undefined}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default XiaoxiongChatContent;\r\n"],"names":["SUPABASE_URL","SUPABASE_ANON_KEY","LOCATION_KEYWORDS","getAnonymousUserId","storageKey","anonymousId","useXiaoxiongChat","provider","i18n","useTranslation","user","useAuth","input","setInput","useState","messages","setMessages","isLoading","setIsLoading","userLocation","setUserLocation","showLocationDialog","setShowLocationDialog","pendingMessage","setPendingMessage","abortControllerRef","useRef","getUserId","useCallback","needsLocationInfo","message","lowerMessage","keyword","handleSubmitAskXiaoxiong","userMessage","assistantMessageId","response","reader","decoder","accumulatedResult","done","value","chunk","cleanResult","prev","msg","finalResult","handleSubmitXiaoxiongAgent","userId","flushSync","resolve","handleSubmitLovableAI","errorData","textBuffer","newlineIndex","line","jsonStr","content","handleSubmitXiaoxiongCommunity","chatMessages","m","processMessage","messageContent","assistantMessage","err","errorMessage","handleLocationConfirm","position","error","handleSubmit","handleKeyDown","e","abortRequest","requestLocation","hasNativeVoiceBridge","NativeVoice","XiaoxiongChatContent","onClose","showBackButton","showHeader","className","navigate","useNavigate","settings","useSiteSettings","profile","useProfile","logoUrl","userAvatarUrl","isListening","setIsListening","speechSupported","setSpeechSupported","nativeVoiceSupported","setNativeVoiceSupported","externalLinkDialogOpen","setExternalLinkDialogOpen","pendingExternalLink","setPendingExternalLink","scrollAreaRef","recognitionRef","messagesEndRef","useEffect","SpeechRecognition","text","shouldShowVoiceInput","startListening","recognition","langMap","event","transcript","result","stopListening","toggleListening","handleLinkClick","href","handleExternalLinkClick","url","confirmExternalLink","openExternalUrl","parseTextWithLinks","linkRegex","parts","lastIndex","match","keyIndex","jsx","linkText","actualUrl","removeBoldMarkers","truncateText","maxLength","renderTable","tableLines","key","parseRow","cell","headers","rows","jsxs","header","i","row","rowIndex","cellIndex","renderMarkdown","lines","elements","part","idx","getTitle","getPlaceholder","getWelcomeMessage","cn","Button","ArrowLeft","ScrollArea","User","Fragment","Loader2","MicOff","Mic","Input","Send","LocationPermissionDialog","open","ExternalLinkConfirmDialog"],"mappings":"8VAKA,MAAMA,EAAe,2CACfC,EAAoB,mNAGpBC,GAAoB,CAExB,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MAAO,MAEvD,UAAW,UAAW,SAAU,UAAW,cAAe,WAAY,YAEtE,aAAc,UAAW,eAAgB,YAAa,cACxD,EAYMC,GAAqB,IAAc,CACvC,MAAMC,EAAa,8BACf,IAAAC,EAAc,aAAa,QAAQD,CAAU,EACjD,OAAKC,IACHA,EAAc,QAAQ,KAAK,IAAK,CAAA,IAAI,KAAK,OAAS,EAAA,SAAS,EAAE,EAAE,UAAU,EAAG,EAAE,CAAC,GAClE,aAAA,QAAQD,EAAYC,CAAW,GAEvCA,CACT,EAEaC,GAAmB,CAACC,EAAqB,kBAAoB,CAClE,KAAA,CAAE,KAAAC,GAASC,KACX,CAAE,KAAAC,GAASC,KAEX,CAACC,EAAOC,CAAQ,EAAIC,WAAS,EAAE,EAC/B,CAACC,EAAUC,CAAW,EAAIF,EAAA,SAAoB,CAAE,CAAA,EAChD,CAACG,EAAWC,CAAY,EAAIJ,WAAS,EAAK,EAC1C,CAACK,EAAcC,CAAe,EAAIN,WAA8C,IAAI,EACpF,CAACO,EAAoBC,CAAqB,EAAIR,WAAS,EAAK,EAC5D,CAACS,EAAgBC,CAAiB,EAAIV,WAAwB,IAAI,EAElEW,EAAqBC,SAA+B,IAAI,EAGxDC,EAAYC,EAAAA,YAAY,IACxBlB,GAAM,GACDA,EAAK,GAEPP,GAAmB,EACzB,CAACO,GAAM,EAAE,CAAC,EAGPmB,EAAoBD,cAAaE,GAA6B,CAC5D,MAAAC,EAAeD,EAAQ,cAC7B,OAAO5B,GAAkB,KAAK8B,GAAWD,EAAa,SAASC,CAAO,CAAC,CACzE,EAAG,CAAE,CAAA,EAECC,GAA2B,MAAOC,EAAsBC,IAA+B,CAC3F,MAAMC,EAAW,MAAM,MAAM,GAAGpC,CAAY,8BAA+B,CACzE,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUC,CAAiB,GAC5C,OAAUA,CACZ,EACA,KAAM,KAAK,UAAU,CACnB,KAAMiC,EAAY,QAClB,OAAQ,GACR,IAAKf,GAAc,IACnB,IAAKA,GAAc,GAAA,CACpB,EACD,OAAQM,EAAmB,SAAS,MAAA,CACrC,EAEG,GAAA,CAACW,EAAS,GACZ,MAAM,IAAI,MAAM,+BAA+BA,EAAS,MAAM,EAAE,EAG9D,GAAA,CAACA,EAAS,KACN,MAAA,IAAI,MAAM,kBAAkB,EAG9B,MAAAC,EAASD,EAAS,KAAK,UAAU,EACjCE,EAAU,IAAI,YACpB,IAAIC,EAAoB,GAExB,OAAa,CACX,KAAM,CAAE,KAAAC,EAAM,MAAAC,CAAA,EAAU,MAAMJ,EAAO,KAAK,EAE1C,GAAIG,EACF,MAGF,MAAME,EAAQJ,EAAQ,OAAOG,EAAO,CAAE,OAAQ,GAAM,EAC/BF,GAAAG,EAErB,IAAIC,EAAcJ,EACdI,EAAY,WAAW,GAAG,IACdA,EAAAA,EAAY,MAAM,CAAC,GAE/BA,EAAY,SAAS,GAAG,IACZA,EAAAA,EAAY,MAAM,EAAG,EAAE,GAEzBA,EAAAA,EAAY,QAAQ,OAAQ;AAAA,CAAI,EAE9C3B,EAAa4B,GACXA,EAAK,IAAKC,GACRA,EAAI,KAAOV,EACP,CAAE,GAAGU,EAAK,QAASF,CAAA,EACnBE,CACN,CAAA,CAEJ,CAEA,IAAIC,EAAcP,EACdO,EAAY,WAAW,GAAG,IACdA,EAAAA,EAAY,MAAM,CAAC,GAE/BA,EAAY,SAAS,GAAG,IACZA,EAAAA,EAAY,MAAM,EAAG,EAAE,GAEzBA,EAAAA,EAAY,QAAQ,OAAQ;AAAA,CAAI,EAE9C9B,EAAa4B,GACXA,EAAK,IAAKC,GACRA,EAAI,KAAOV,EACP,CAAE,GAAGU,EAAK,QAASC,EAAa,YAAa,EAC7C,EAAAD,CACN,CAAA,CACF,EAGIE,GAA6B,MAAOb,EAAsBC,IAA+B,CAC7F,MAAMa,EAASrB,IAETS,EAAW,MAAM,MAAM,GAAGpC,CAAY,gCAAiC,CAC3E,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUC,CAAiB,GAC5C,OAAUA,CACZ,EACA,KAAM,KAAK,UAAU,CACnB,QAASiC,EAAY,QACrB,OAAAc,CAAA,CACD,EACD,OAAQvB,EAAmB,SAAS,MAAA,CACrC,EAEG,GAAA,CAACW,EAAS,GACZ,MAAM,IAAI,MAAM,+BAA+BA,EAAS,MAAM,EAAE,EAG9D,GAAA,CAACA,EAAS,KACN,MAAA,IAAI,MAAM,kBAAkB,EAG9B,MAAAC,EAASD,EAAS,KAAK,UAAU,EACjCE,EAAU,IAAI,YACpB,IAAIC,EAAoB,GAExB,OAAa,CACX,KAAM,CAAE,KAAAC,EAAM,MAAAC,CAAA,EAAU,MAAMJ,EAAO,KAAK,EAE1C,GAAIG,EACF,MAGF,MAAME,EAAQJ,EAAQ,OAAOG,EAAO,CAAE,OAAQ,GAAM,EAC/BF,GAAAG,EAErBO,GAAAA,UAAU,IAAM,CACdjC,EAAa4B,GACXA,EAAK,IAAKC,GACRA,EAAI,KAAOV,EACP,CAAE,GAAGU,EAAK,QAASN,CAAA,EACnBM,CACN,CAAA,CACF,CACD,EAED,MAAM,IAAI,QAAmBK,GAAA,sBAAsBA,CAAO,CAAC,CAC7D,CAEAlC,EAAa4B,GACXA,EAAK,IAAKC,GACRA,EAAI,KAAOV,EACP,CAAE,GAAGU,EAAK,YAAa,EAAA,EACvBA,CACN,CAAA,CACF,EAGIM,EAAwB,MAAOjB,EAAsBC,IAA+B,CACxF,MAAMC,EAAW,MAAM,MAAM,GAAGpC,CAAY,6BAA8B,CACxE,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUC,CAAiB,GAC5C,OAAUA,CACZ,EACA,KAAM,KAAK,UAAU,CACnB,QAASiC,EAAY,QACrB,IAAKf,GAAc,IACnB,IAAKA,GAAc,IACnB,SAAUX,EAAK,QAAA,CAChB,EACD,OAAQiB,EAAmB,SAAS,MAAA,CACrC,EAEG,GAAA,CAACW,EAAS,GAAI,CACV,MAAAgB,EAAY,MAAMhB,EAAS,OAAO,MAAM,KAAO,CAAG,EAAA,EACxD,MAAM,IAAI,MAAMgB,EAAU,OAAS,+BAA+BhB,EAAS,MAAM,EAAE,CACrF,CAEI,GAAA,CAACA,EAAS,KACN,MAAA,IAAI,MAAM,kBAAkB,EAG9B,MAAAC,EAASD,EAAS,KAAK,UAAU,EACjCE,EAAU,IAAI,YACpB,IAAIC,EAAoB,GACpBc,EAAa,GAEjB,OAAa,CACX,KAAM,CAAE,KAAAb,EAAM,MAAAC,CAAA,EAAU,MAAMJ,EAAO,KAAK,EAE1C,GAAIG,EACF,MAGFa,GAAcf,EAAQ,OAAOG,EAAO,CAAE,OAAQ,GAAM,EAEhD,IAAAa,EACJ,MAAQA,EAAeD,EAAW,QAAQ;AAAA,CAAI,KAAO,IAAI,CACvD,IAAIE,EAAOF,EAAW,MAAM,EAAGC,CAAY,EAK3C,GAJaD,EAAAA,EAAW,MAAMC,EAAe,CAAC,EAE1CC,EAAK,SAAS,IAAI,MAAUA,EAAK,MAAM,EAAG,EAAE,GAC5CA,EAAK,WAAW,GAAG,GAAKA,EAAK,KAAA,IAAW,IACxC,CAACA,EAAK,WAAW,QAAQ,EAAG,SAEhC,MAAMC,EAAUD,EAAK,MAAM,CAAC,EAAE,KAAK,EACnC,GAAIC,IAAY,SAAU,MAEtB,GAAA,CAEF,MAAMC,EADS,KAAK,MAAMD,CAAO,EACV,UAAU,CAAC,GAAG,OAAO,QACxCC,IACmBlB,GAAAkB,EAErBR,GAAAA,UAAU,IAAM,CACdjC,EAAa4B,GACXA,EAAK,IAAKC,GACRA,EAAI,KAAOV,EACP,CAAE,GAAGU,EAAK,QAASN,CAAA,EACnBM,CACN,CAAA,CACF,CACD,EAED,MAAM,IAAI,QAAmBK,GAAA,sBAAsBA,CAAO,CAAC,EAC7D,MACM,CAER,CACF,CACF,CAEAlC,EAAa4B,GACXA,EAAK,IAAKC,GACRA,EAAI,KAAOV,EACP,CAAE,GAAGU,EAAK,YAAa,EAAA,EACvBA,CACN,CAAA,CACF,EAGIa,EAAiC,MAAOxB,EAAsBC,IAA+B,CAE3F,MAAAwB,EAAe5C,EAClB,UAAY6C,EAAE,SAAW,CAACA,EAAE,WAAW,EACvC,IAAIA,IAAM,CAAE,KAAMA,EAAE,KAAM,QAASA,EAAE,OAAU,EAAA,EAClDD,EAAa,KAAK,CAAE,KAAM,OAAQ,QAASzB,EAAY,QAAS,EAEhE,MAAME,EAAW,MAAM,MAAM,GAAGpC,CAAY,oCAAqC,CAC/E,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,cAAiB,UAAUC,CAAiB,GAC5C,OAAUA,CACZ,EACA,KAAM,KAAK,UAAU,CACnB,SAAU0D,EACV,eAAgB,EAAA,CACjB,EACD,OAAQlC,EAAmB,SAAS,MAAA,CACrC,EAEG,GAAA,CAACW,EAAS,GAAI,CACV,MAAAgB,EAAY,MAAMhB,EAAS,OAAO,MAAM,KAAO,CAAG,EAAA,EACxD,MAAM,IAAI,MAAMgB,EAAU,OAAS,+BAA+BhB,EAAS,MAAM,EAAE,CACrF,CAEI,GAAA,CAACA,EAAS,KACN,MAAA,IAAI,MAAM,kBAAkB,EAG9B,MAAAC,EAASD,EAAS,KAAK,UAAU,EACjCE,EAAU,IAAI,YACpB,IAAIC,EAAoB,GACpBc,EAAa,GAEjB,OAAa,CACX,KAAM,CAAE,KAAAb,EAAM,MAAAC,CAAA,EAAU,MAAMJ,EAAO,KAAK,EAE1C,GAAIG,EACF,MAGFa,GAAcf,EAAQ,OAAOG,EAAO,CAAE,OAAQ,GAAM,EAEhD,IAAAa,EACJ,MAAQA,EAAeD,EAAW,QAAQ;AAAA,CAAI,KAAO,IAAI,CACvD,IAAIE,EAAOF,EAAW,MAAM,EAAGC,CAAY,EAK3C,GAJaD,EAAAA,EAAW,MAAMC,EAAe,CAAC,EAE1CC,EAAK,SAAS,IAAI,MAAUA,EAAK,MAAM,EAAG,EAAE,GAC5CA,EAAK,WAAW,GAAG,GAAKA,EAAK,KAAA,IAAW,IACxC,CAACA,EAAK,WAAW,QAAQ,EAAG,SAEhC,MAAMC,EAAUD,EAAK,MAAM,CAAC,EAAE,KAAK,EACnC,GAAIC,IAAY,SAAU,MAEtB,GAAA,CAEF,MAAMC,EADS,KAAK,MAAMD,CAAO,EACV,UAAU,CAAC,GAAG,OAAO,QACxCC,IACmBlB,GAAAkB,EAErBR,GAAAA,UAAU,IAAM,CACdjC,EAAa4B,GACXA,EAAK,IAAKC,GACRA,EAAI,KAAOV,EACP,CAAE,GAAGU,EAAK,QAASN,CAAA,EACnBM,CACN,CAAA,CACF,CACD,EAED,MAAM,IAAI,QAAmBK,GAAA,sBAAsBA,CAAO,CAAC,EAC7D,MACM,CAER,CACF,CACF,CAEAlC,EAAa4B,GACXA,EAAK,IAAKC,GACRA,EAAI,KAAOV,EACP,CAAE,GAAGU,EAAK,YAAa,EAAA,EACvBA,CACN,CAAA,CACF,EAIIgB,EAAiBjC,cAAY,MAAOkC,GAA2B,CACnE,MAAM5B,EAAuB,CAC3B,GAAI,KAAK,IAAI,EAAE,SAAS,EACxB,KAAM,OACN,QAAS4B,CAAA,EAGL3B,GAAsB,KAAK,IAAI,EAAI,GAAG,WACtC4B,EAA4B,CAChC,GAAI5B,EACJ,KAAM,YACN,QAAS,GACT,YAAa,EAAA,EAGfnB,EAAa4B,GAAS,CAAC,GAAGA,EAAMV,EAAa6B,CAAgB,CAAC,EAC9DlD,EAAS,EAAE,EACXK,EAAa,EAAI,EAEbO,EAAmB,SACrBA,EAAmB,QAAQ,QAEVA,EAAA,QAAU,IAAI,gBAE7B,GAAA,CACElB,IAAa,sBACT,MAAAmD,EAA+BxB,EAAaC,CAAkB,EAC3D5B,IAAa,aAChB,MAAA4C,EAAsBjB,EAAaC,CAAkB,EAClD5B,IAAa,kBAChB,MAAAwC,GAA2Bb,EAAaC,CAAkB,EAE1D,MAAAF,GAAyBC,EAAaC,CAAkB,QAEzD6B,EAAK,CACZ,GAAIA,aAAe,OAASA,EAAI,OAAS,aAAc,CACrD,QAAQ,IAAI,iBAAiB,EAC7B,MACF,CACQ,QAAA,MAAM,iBAAkBA,CAAG,EAC7B,MAAAC,EACJzD,EAAK,WAAa,KACd,oBACAA,EAAK,WAAa,KAClB,2EACA,wDAENQ,EAAa4B,GACXA,EAAK,IAAKC,GACRA,EAAI,KAAOV,EACP,CAAE,GAAGU,EAAK,QAASoB,EAAc,YAAa,EAC9C,EAAApB,CACN,CAAA,CACF,QACA,CACA3B,EAAa,EAAK,CACpB,CAAA,EACC,CAACX,EAAUY,EAAcX,EAAK,SAAUmB,CAAS,CAAC,EAG/CuC,EAAwBtC,EAAAA,YAAY,IAAM,CAC9CN,EAAsB,EAAK,EAC3B,UAAU,aAAa,mBACpB6C,GAAa,CACI/C,EAAA,CACd,IAAK+C,EAAS,OAAO,SACrB,IAAKA,EAAS,OAAO,SAAA,CACtB,EACG5C,GACF,WAAW,IAAM,CACfsC,EAAetC,CAAc,EAC7BC,EAAkB,IAAI,GACrB,GAAG,CAEV,EACC4C,GAAU,CACD,QAAA,IAAI,8BAA+BA,EAAM,OAAO,EACpD7C,IACFsC,EAAetC,CAAc,EAC7BC,EAAkB,IAAI,EAE1B,EACA,CAAE,mBAAoB,GAAM,QAAS,IAAO,WAAY,CAAE,CAAA,CAC5D,EACC,CAACD,EAAgBsC,CAAc,CAAC,EAE7BQ,EAAezC,EAAAA,YAAY,SAAY,CAC3C,GAAI,CAAChB,EAAM,KAAK,GAAKK,EAAW,OAE1B,MAAA6C,EAAiBlD,EAAM,OAE7B,GAAI,CAACO,GAAgBU,EAAkBiC,CAAc,EAAG,CACtDtC,EAAkBsC,CAAc,EAChCxC,EAAsB,EAAI,EAC1BT,EAAS,EAAE,EACX,MACF,CAEA,MAAMgD,EAAeC,CAAc,CAAA,EAClC,CAAClD,EAAOK,EAAWE,EAAcU,EAAmBgC,CAAc,CAAC,EAEhES,GAAgB1C,cAAa2C,GAA2B,CACxDA,EAAE,MAAQ,SAAW,CAACA,EAAE,WAC1BA,EAAE,eAAe,EACJF,IACf,EACC,CAACA,CAAY,CAAC,EAEXG,EAAe5C,EAAAA,YAAY,IAAM,CACjCH,EAAmB,SACrBA,EAAmB,QAAQ,OAE/B,EAAG,CAAE,CAAA,EAGCgD,GAAkB7C,EAAAA,YAAY,IAAM,CACxC,UAAU,aAAa,mBACpBuC,GAAa,CACI/C,EAAA,CACd,IAAK+C,EAAS,OAAO,SACrB,IAAKA,EAAS,OAAO,SAAA,CACtB,CACH,EACCC,GAAU,CACD,QAAA,IAAI,+BAAgCA,EAAM,OAAO,CAC3D,EACA,CAAE,mBAAoB,GAAO,QAAS,IAAM,WAAY,GAAO,CAAA,CAEnE,EAAG,CAAE,CAAA,EAEE,MAAA,CACL,MAAAxD,EACA,SAAAC,EACA,SAAAE,EACA,UAAAE,EACA,mBAAAI,EACA,sBAAAC,EACA,eAAAC,EACA,kBAAAC,EACA,aAAA6C,EACA,cAAAC,GACA,sBAAAJ,EACA,eAAAL,EACA,aAAAW,EACA,gBAAAC,EAAA,CAEJ,ECndMC,GAAuB,IACpB,CAAC,EACL,OAAO,QAAQ,iBAAiB,aACjC,OAAO,aAKLC,GAAc,CAClB,MAAO,IAAM,CACX,MAAM7C,EAAU,KAAK,UAAU,CAAE,OAAQ,QAAS,EAC9C,OAAO,QAAQ,iBAAiB,YAClC,OAAO,OAAO,gBAAgB,YAAY,YAAYA,CAAO,EACpD,OAAO,aACT,OAAA,YAAY,YAAYA,CAAO,CAE1C,EACA,KAAM,IAAM,CACV,MAAMA,EAAU,KAAK,UAAU,CAAE,OAAQ,OAAQ,EAC7C,OAAO,QAAQ,iBAAiB,YAClC,OAAO,OAAO,gBAAgB,YAAY,YAAYA,CAAO,EACpD,OAAO,aACT,OAAA,YAAY,YAAYA,CAAO,CAE1C,CACF,EAqBM8C,GAAuB,CAAC,CAC5B,SAAA7D,EACA,MAAAH,EACA,SAAAC,EACA,UAAAI,EACA,mBAAAI,EACA,sBAAAC,EACA,eAAAC,EACA,aAAA8C,EACA,cAAAC,EACA,sBAAAJ,EACA,eAAAL,EACA,kBAAArC,EACA,QAAAqD,EACA,eAAAC,EAAiB,GACjB,WAAAC,EAAa,GACb,UAAAC,CACF,IAAiC,CACzB,KAAA,CAAE,KAAAxE,GAASC,KACXwE,EAAWC,KACX,CAAE,SAAAC,IAAaC,KACf,CAAE,KAAMC,EAAQ,EAAIC,GAAW,EAC/BC,EAAUJ,IAAU,SACpBK,EAAgBH,IAAS,WAEzB,CAACI,EAAaC,CAAc,EAAI5E,WAAS,EAAK,EAC9C,CAAC6E,EAAiBC,EAAkB,EAAI9E,WAAS,EAAK,EACtD,CAAC+E,EAAsBC,EAAuB,EAAIhF,WAAS,EAAK,EAChE,CAACiF,EAAwBC,CAAyB,EAAIlF,WAAS,EAAK,EACpE,CAACmF,EAAqBC,CAAsB,EAAIpF,WAAwB,IAAI,EAE5EqF,EAAgBzE,SAAuB,IAAI,EAC3C0E,EAAiB1E,SAAiC,IAAI,EACtD2E,EAAiB3E,SAAuB,IAAI,EAGlD4E,EAAAA,UAAU,IAAM,CACR,MAAAC,EAAoB,OAAO,mBAAqB,OAAO,wBAC1C,OAAAX,GAAA,CAAC,CAACW,CAAiB,EACtCT,GAAwBpB,IAAsB,EAEvC,OAAA,eAAkB8B,GAAiB,CACxC3F,EAAS2F,CAAI,EACbd,EAAe,EAAK,CAAA,EAGf,IAAM,CACX,OAAO,eAAiB,MAAA,CAC1B,EACC,CAAC7E,CAAQ,CAAC,EAGbyF,EAAAA,UAAU,IAAM,CACdD,EAAe,SAAS,eAAe,CAAE,SAAU,QAAU,CAAA,CAAA,EAC5D,CAACtF,CAAQ,CAAC,EAGbuF,EAAAA,UAAU,IACD,IAAM,CACPF,EAAe,SACjBA,EAAe,QAAQ,MACzB,EAED,CAAE,CAAA,EAEL,MAAMK,EAAuB,IACpBd,GAAmBE,EAGtBa,EAAiB,IAAM,CAC3B,GAAIb,EAAsB,CACxBlB,GAAY,MAAM,EAClBe,EAAe,EAAI,EACnB,MACF,CAEM,MAAAa,EAAoB,OAAO,mBAAqB,OAAO,wBAC7D,GAAI,CAACA,EAAmB,OAEpBH,EAAe,SACjBA,EAAe,QAAQ,OAGnB,MAAAO,EAAc,IAAIJ,EACxBH,EAAe,QAAUO,EAEzB,MAAMC,EAAkC,CACtC,GAAI,QACJ,GAAI,QACJ,GAAI,OAAA,EAEND,EAAY,KAAOC,EAAQpG,EAAK,QAAQ,GAAK,QAC7CmG,EAAY,WAAa,GACzBA,EAAY,eAAiB,GAEjBA,EAAA,QAAU,IAAMjB,EAAe,EAAI,EACnCiB,EAAA,SAAYE,GAAU,CAChC,MAAMC,EAAa,MAAM,KAAKD,EAAM,OAAO,EACxC,IAAKE,GAAWA,EAAO,CAAC,EAAE,UAAU,EACpC,KAAK,EAAE,EACVlG,EAASiG,CAAU,CAAA,EAETH,EAAA,QAAU,IAAMjB,EAAe,EAAK,EACpCiB,EAAA,MAAQ,IAAMjB,EAAe,EAAK,EAC9CiB,EAAY,MAAM,CAAA,EAGdK,EAAgB,IAAM,CAC1B,GAAInB,EAAsB,CACxBlB,GAAY,KAAK,EACjBe,EAAe,EAAK,EACpB,MACF,CAEIU,EAAe,UACjBA,EAAe,QAAQ,OACvBV,EAAe,EAAK,EACtB,EAGIuB,EAAkB,IAAM,CACxBxB,EACYuB,IAECN,GACjB,EAGIQ,EAAmBC,GAAiB,CAC9BtC,MACVI,EAASkC,CAAI,CAAA,EAGTC,EAA2BC,GAAgB,CAC/CnB,EAAuBmB,CAAG,EAC1BrB,EAA0B,EAAI,CAAA,EAG1BsB,EAAsB,IAAM,CAC5BrB,GACFsB,GAAgBtB,CAAmB,EAErCD,EAA0B,EAAK,EAC/BE,EAAuB,IAAI,CAAA,EAIvBsB,EAAsBhB,GAAgC,CAC1D,MAAMiB,EAAY,2BACZC,EAAuB,CAAA,EAC7B,IAAIC,EAAY,EACZC,EACAC,EAAW,EAEf,MAAQD,EAAQH,EAAU,KAAKjB,CAAI,KAAO,MAAM,CAC1CoB,EAAM,MAAQD,GACVD,EAAA,KAAMI,EAAAA,IAAA,OAAA,CAAuB,SAAKtB,EAAA,MAAMmB,EAAWC,EAAM,KAAK,CAA9C,EAAAC,GAAgD,CAAO,EAGzE,MAAAE,EAAWH,EAAM,CAAC,EAClBT,EAAOS,EAAM,CAAC,EAEhB,GAAAT,EAAK,WAAW,GAAG,EACfO,EAAA,KACJI,EAAA,IAAC,SAAA,CAEC,QAAS,IAAMZ,EAAgBC,CAAI,EACnC,UAAU,0DAET,SAAAY,CAAA,EAJIF,GAKP,CAAA,UAEOV,EAAK,WAAW,YAAY,EAAG,CACxC,MAAMa,GAAYb,EAAK,MAAM,EAAmB,EAC1CO,EAAA,KACJI,EAAA,IAAC,SAAA,CAEC,QAAS,IAAMV,EAAwBY,EAAS,EAChD,UAAU,0DAET,SAAAD,CAAA,EAJIF,GAKP,CAAA,CACF,MACSV,EAAK,WAAW,SAAS,GAAKA,EAAK,WAAW,UAAU,EAC3DO,EAAA,KACJI,EAAA,IAAC,SAAA,CAEC,QAAS,IAAMV,EAAwBD,CAAI,EAC3C,UAAU,0DAET,SAAAY,CAAA,EAJIF,GAKP,CAAA,EAGIH,EAAA,KACJI,EAAA,IAAC,IAAA,CAEC,KAAAX,EACA,OAAO,SACP,IAAI,sBACJ,UAAU,2CAET,SAAAY,CAAA,EANIF,GAOP,CAAA,EAIJF,EAAYC,EAAM,MAAQA,EAAM,CAAC,EAAE,MACrC,CAEI,OAAAD,EAAYnB,EAAK,QACbkB,EAAA,WAAM,OAAuB,CAAA,SAAAlB,EAAK,MAAMmB,CAAS,CAAA,EAAjCE,GAAmC,CAAO,EAG3DH,EAAM,OAAS,EAAIA,EAAQ,CAAEI,EAAAA,IAAA,OAAA,CAAc,SAALtB,GAAA,GAAU,CAAO,CAAA,EAG1DyB,EAAqBzB,GAClBA,EAAK,QAAQ,iBAAkB,IAAI,EAGtC0B,EAAe,CAAC1B,EAAc2B,EAAoB,KAClD3B,EAAK,QAAU2B,EAAkB3B,EAC9BA,EAAK,MAAM,EAAG2B,CAAS,EAAI,MAG9BC,GAAc,CAACC,EAAsBC,IAAgB,CACzD,MAAMC,EAAYhF,GAChBA,EACG,MAAM,GAAG,EACT,MAAM,EAAG,EAAE,EACX,IAAKiF,GAASP,EAAkBO,EAAK,KAAM,CAAA,CAAC,EAE3CC,EAAUF,EAASF,EAAW,CAAC,CAAC,EAChCK,EAAOL,EAAW,MAAM,CAAC,EAAE,IAAIE,CAAQ,EAE7C,aACG,MAAc,CAAA,UAAU,kCACvB,SAACI,EAAA,KAAA,QAAA,CAAM,UAAU,6EACf,SAAA,CAACb,EAAAA,IAAA,QAAA,CAAM,UAAU,cACf,SAAAA,EAAA,IAAC,MACE,SAAQW,EAAA,IAAI,CAACG,EAAQC,IACpBf,EAAA,IAAC,KAAA,CAEC,UAAU,kFACV,MAAOc,EAEN,SAAmBpB,EAAAU,EAAaU,EAAQ,EAAE,CAAC,CAAA,EAJvCC,CAAA,CAMR,EACH,CACF,CAAA,QACC,QACE,CAAA,SAAAH,EAAK,IAAI,CAACI,EAAKC,IACdjB,EAAA,IAAC,KAAA,CAEC,UAAU,2EAET,SAAIgB,EAAA,IAAI,CAACN,EAAMQ,KACdlB,EAAA,IAAC,KAAA,CAEC,UAAU,mCACV,MAAOU,EAEN,SAAmBhB,EAAAU,EAAaM,EAAM,EAAE,CAAC,CAAA,EAJrCQ,EAAA,CAMR,CAAA,EAXID,CAaR,CAAA,EACH,CAAA,EACF,GAjCQT,CAkCV,CAAA,EAIEW,GAAkBxF,GAAoB,CACpC,MAAAyF,EAAQzF,EAAQ,MAAM;AAAA,CAAI,EAC1B0F,EAA0B,CAAA,EAChC,IAAIN,EAAI,EAED,KAAAA,EAAIK,EAAM,QAAQ,CACjB,MAAA3F,EAAO2F,EAAML,CAAC,EAEhB,GAAAtF,EAAK,OAAO,WAAW,GAAG,GAAKA,EAAK,MAAM,GAAG,EAAE,OAAS,EAAG,CAC7D,MAAM8E,EAAuB,CAAA,EACtB,KAAAQ,EAAIK,EAAM,QAAUA,EAAML,CAAC,EAAE,KAAK,EAAE,WAAW,GAAG,GAC5CR,EAAA,KAAKa,EAAML,CAAC,CAAC,EACxBA,IAEER,EAAW,QAAU,GACvBc,EAAS,KAAKf,GAAYC,EAAYc,EAAS,MAAM,CAAC,EAExD,QACF,CAEI,GAAA5F,EAAK,WAAW,MAAM,EACf4F,EAAA,KACPrB,EAAAA,IAAC,KAAyB,CAAA,UAAU,oCACjC,SAAAN,EAAmBjE,EAAK,MAAM,CAAC,CAAC,CAD1B,EAAA4F,EAAS,MAElB,CAAA,UAEO5F,EAAK,WAAW,KAAK,EACrB4F,EAAA,KACPrB,EAAAA,IAAC,KAAyB,CAAA,UAAU,8BACjC,SAAAN,EAAmBjE,EAAK,MAAM,CAAC,CAAC,CAD1B,EAAA4F,EAAS,MAElB,CAAA,UAEO5F,EAAK,WAAW,IAAI,EACpB4F,EAAA,KACPrB,EAAAA,IAAC,KAAyB,CAAA,UAAU,8BACjC,SAAAN,EAAmBjE,EAAK,MAAM,CAAC,CAAC,CAD1B,EAAA4F,EAAS,MAElB,CAAA,UAEO5F,EAAK,SAAS,IAAI,EAAG,CACxB,MAAAmE,EAAQnE,EAAK,MAAM,gBAAgB,EAChC4F,EAAA,KACNrB,EAAA,IAAA,IAAA,CAAwB,UAAU,uBAChC,SAAMJ,EAAA,IAAI,CAAC0B,EAAMC,IAChBA,EAAM,IAAM,EACTvB,EAAAA,IAAA,SAAA,CAAiB,UAAU,gBACzB,WAAmBsB,CAAI,CAAA,EADbC,CAEb,EAEA7B,EAAmB4B,CAAI,CAAA,CAE3B,EATMD,EAAS,MAUjB,CAAA,CACF,MACS5F,EAAK,WAAW,IAAI,GAAKA,EAAK,WAAW,IAAI,EAC7C4F,EAAA,KACPrB,EAAAA,IAAC,KAAyB,CAAA,UAAU,wBACjC,SAAAN,EAAmBjE,EAAK,MAAM,CAAC,CAAC,CAD1B,EAAA4F,EAAS,MAElB,CAAA,EAEO,WAAW,KAAK5F,CAAI,EACpB4F,EAAA,KACNrB,EAAAA,IAAA,KAAA,CAAyB,UAAU,2BACjC,SAAmBN,EAAAjE,EAAK,QAAQ,WAAY,EAAE,CAAC,CADzC,EAAA4F,EAAS,MAElB,CAAA,EAEO5F,EAAK,MAAM,aAAa,EACjC4F,EAAS,KAAMrB,EAAA,IAAA,KAAA,CAAyB,UAAU,sBAA3BqB,EAAS,MAAuC,CAAE,EAChE5F,EAAK,KAAK,IAAM,GACzB4F,EAAS,KAAMrB,EAAA,IAAA,MAAA,CAA0B,UAAU,OAA3BqB,EAAS,MAAwB,CAAE,EAElDA,EAAA,KACPrB,EAAAA,IAAC,KAAwB,UAAU,uBAChC,WAAmBvE,CAAI,CAAA,EADlB4F,EAAS,MAEjB,CAAA,EAIJN,GACF,CAEO,OAAAM,CAAA,EAGHG,GAAW,IACX9I,EAAK,WAAa,KAAa,SAC/BA,EAAK,WAAa,KAAa,0BAC5B,yBAGH+I,GAAiB,IACjB/I,EAAK,WAAa,KAAa,gBAC/BA,EAAK,WAAa,KAAa,6CAC5B,yCAGHgJ,GAAoB,IACpBhJ,EAAK,WAAa,KAAa,iCAC/BA,EAAK,WAAa,KAAa,qHAC5B,8FAGT,cACG,MAAI,CAAA,UAAWiJ,EAAG,qDAAsDzE,CAAS,EAE/E,SAAA,CACCD,GAAA4D,EAAA,KAAC,MAAI,CAAA,UAAU,sFACZ,SAAA,CACC7D,GAAAgD,EAAA,IAAC4B,GAAA,CACC,QAAQ,QACR,KAAK,OACL,QAAS7E,EACT,UAAU,WAEV,SAAAiD,EAAAA,IAAC6B,GAAU,CAAA,UAAU,SAAU,CAAA,CAAA,CACjC,EAEFhB,EAAAA,KAAC,MAAI,CAAA,UAAU,iCACZ,SAAA,CAAApD,SAAY,MAAI,CAAA,IAAKA,EAAS,IAAI,OAAO,UAAU,oCAAoC,EACvFuC,EAAA,IAAA,KAAA,CAAG,UAAU,0BAA2B,cAAW,CAAA,EACtD,CAAA,EACF,EAIFA,EAAAA,IAAC8B,IAAW,UAAU,+BAA+B,IAAKzD,EACxD,SAAAwC,EAAA,KAAC,MAAI,CAAA,UAAU,gBAEZ,SAAA,CAAA5H,EAAS,SAAW,GAClB4H,EAAA,KAAA,MAAA,CAAI,UAAU,aACb,SAAA,CAAAb,EAAA,IAAC,MAAI,CAAA,UAAU,0FACZ,SAAAvC,GAAYuC,MAAA,MAAA,CAAI,IAAKvC,EAAS,IAAI,YAAY,UAAU,4BAA6B,CAAA,EACxF,EACCuC,EAAA,IAAA,MAAA,CAAI,UAAU,+CACZ,cACH,CAAA,EACF,EAID/G,EAAS,IAAKe,GACb6G,EAAA,KAAC,MAAA,CAEC,UAAWc,EACT,aACA3H,EAAQ,OAAS,QAAU,kBAC7B,EAEC,SAAA,CAAAA,EAAQ,OAAS,OACfgG,EAAA,IAAA,MAAA,CAAI,UAAU,0FACZ,SAAAtC,EACEsC,EAAA,IAAA,MAAA,CAAI,IAAKtC,EAAe,IAAI,OAAO,UAAU,6BAA6B,EAE3EsC,MAAC+B,GAAK,CAAA,UAAU,UAAU,CAE9B,CAAA,EAEC/B,EAAAA,IAAA,MAAA,CAAI,UAAU,0FACZ,SAAAvC,GAAYuC,EAAAA,IAAA,MAAA,CAAI,IAAKvC,EAAS,IAAI,YAAY,UAAU,4BAA6B,CAAA,EACxF,EAEFuC,EAAA,IAAC,MAAA,CACC,UAAW2B,EACT,0DACF,EAEC,SAAA3H,EAAQ,OAAS,YAEb6G,EAAAA,KAAAmB,EAAAA,SAAA,CAAA,SAAA,CAAAhI,EAAQ,QACPgG,MAAC,MAAI,CAAA,UAAU,WACZ,SAAAmB,GAAenH,EAAQ,OAAO,CACjC,CAAA,EAEC6G,EAAA,KAAA,MAAA,CAAI,UAAU,gDACb,SAAA,CAACb,EAAAA,IAAAiC,GAAA,CAAQ,UAAU,sBAAuB,CAAA,EAC1CjC,EAAAA,IAAC,OACE,CAAA,SAAAtH,EAAK,WAAa,KACf,SACAA,EAAK,WAAa,KAClB,cACA,aACN,CAAA,CAAA,EACF,EAEDsB,EAAQ,aAAeA,EAAQ,SAC7BgG,EAAA,IAAA,OAAA,CAAK,UAAU,yEAAyE,CAAA,CAE7F,CAAA,EAEAhG,EAAQ,OAAA,CAEZ,CAAA,CAAA,EAjDKA,EAAQ,EAAA,CAmDhB,EACDgG,EAAAA,IAAC,MAAI,CAAA,IAAKzB,CAAgB,CAAA,CAAA,CAAA,CAC5B,CACF,CAAA,QAGC,MAAI,CAAA,UAAU,uFACb,SAACsC,EAAA,KAAA,MAAA,CAAI,UAAU,2HACZ,SAAA,CAAAlC,EACC,GAAAqB,EAAA,IAAC4B,GAAA,CACC,QAAQ,QACR,KAAK,OACL,QAASzC,EACT,SAAUhG,EACV,UAAWwI,EAAG,sCAAuChE,GAAe,kBAAkB,EAErF,SAAAA,QAAeuE,GAAO,CAAA,UAAU,UAAU,EAAKlC,EAAA,IAACmC,GAAI,CAAA,UAAU,SAAU,CAAA,CAAA,CAC3E,EAGFnC,EAAA,IAACoC,GAAA,CACC,MAAOtJ,EACP,SAAW2D,GAAM1D,EAAS0D,EAAE,OAAO,KAAK,EACxC,UAAWD,EACX,YAAamB,EAAejF,EAAK,WAAa,KAAO,UAAY,eAAkB+I,GAAe,EAClG,SAAUtI,EACV,UAAU,6FAAA,CACZ,EACA6G,EAAA,IAAC4B,GAAA,CACC,QAASrF,EACT,SAAU,CAACzD,EAAM,KAAA,GAAUK,EAC3B,KAAK,OACL,QAAQ,QACR,UAAU,gDAET,SAAAA,QAAa8I,GAAQ,CAAA,UAAU,uBAAuB,EAAKjC,EAAA,IAACqC,GAAK,CAAA,UAAU,SAAU,CAAA,CAAA,CACxF,CAAA,CAAA,CACF,CACF,CAAA,EAGArC,EAAA,IAACsC,GAAA,CACC,KAAM/I,EACN,aAAegJ,GAAS,CACtB/I,EAAsB+I,CAAI,EACtB,CAACA,GAAQ9I,IACXsC,EAAetC,CAAc,EAC7BC,EAAkB,IAAI,EAE1B,EACA,UAAW0C,CAAA,CACb,EAGA4D,EAAA,IAACwC,GAAA,CACC,KAAMvE,EACN,aAAcC,EACd,UAAWsB,EACX,IAAKrB,GAAuB,MAAA,CAC9B,CACF,CAAA,CAAA,CAEJ"}