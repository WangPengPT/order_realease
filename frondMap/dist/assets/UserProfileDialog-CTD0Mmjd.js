import{p as ae,r as u,j as e,bR as re,M as ne,y as z,am as ie,bN as ce,bb as T,a_ as le,bc as de,ao as F,b9 as M,W as g,aK as me,ba as b,b3 as oe,bC as xe,bY as ue,L as v,bz as w}from"./vendor-react-DanJ59UG.js";import{s as d,D as he,c as ge,d as U,h as fe,e as B,T as H,F as pe,S as f,P as je,Q as Ne,R as ve,B as y,C as p,n as j}from"./index-BBMW0-Iu.js";import{S as D}from"./separator-B-J9T76O.js";import{u as _e}from"./useLocalizedContent-Brt5DvN3.js";import{H as O}from"./vendor-utils-vwQGbBim.js";function Re({open:k,onOpenChange:V,userId:c,userName:be,userRole:N}){const{t}=ae(),{getLocalizedField:m}=_e(),[K,L]=u.useState(!0),[a,Q]=u.useState(null),[W,Y]=u.useState(null),[r,G]=u.useState({favoriteRestaurants:0,favoriteActivities:0,comments:0,ratings:0,addresses:0,restaurants:0}),[C,R]=u.useState(null),[x,o]=u.useState([]),[J,E]=u.useState(!1);u.useEffect(()=>{k&&c&&X()},[k,c]);const X=async()=>{L(!0);try{const{data:s,error:i}=await d.from("profiles").select("*").eq("id",c).maybeSingle();if(i)throw i;Q(s);try{const{data:n}=await d.functions.invoke("get-user-emails",{body:{userIds:[c]}});n?.emails?.[c]&&Y(n.emails[c])}catch(n){console.error("Error fetching email:",n)}const[l,_,S,$,q,A]=await Promise.all([d.from("favorites").select("id",{count:"exact",head:!0}).eq("user_id",c),d.from("subscriptions").select("id",{count:"exact",head:!0}).eq("user_id",c),d.from("comments").select("id",{count:"exact",head:!0}).eq("user_id",c),d.from("ratings").select("id",{count:"exact",head:!0}).eq("user_id",c),d.from("user_addresses").select("id",{count:"exact",head:!0}).eq("user_id",c),d.from("merchant_restaurants").select("id",{count:"exact",head:!0}).eq("user_id",c)]);G({favoriteRestaurants:l.count||0,favoriteActivities:_.count||0,comments:S.count||0,ratings:$.count||0,addresses:q.count||0,restaurants:A.count||0})}catch(s){console.error("Error fetching user profile:",s)}finally{L(!1)}},h=async s=>{if(s){E(!0),R(s);try{switch(s){case"restaurants":{const{data:i}=await d.from("favorites").select("created_at, restaurants(id, name, name_en, name_pt, image_url, rating, type, type_en, type_pt)").eq("user_id",c).order("created_at",{ascending:!1});o(i?.map(l=>({...l.restaurants,favorited_at:l.created_at}))||[]);break}case"activities":{const{data:i}=await d.from("subscriptions").select("created_at, activities(id, title_zh, title_en, title_pt, image_url, start_date, end_date)").eq("user_id",c).order("created_at",{ascending:!1});o(i?.map(l=>({...l.activities,subscribed_at:l.created_at}))||[]);break}case"comments":{const{data:i}=await d.from("comments").select("id, content, target_type, target_id, rating_value, created_at").eq("user_id",c).order("created_at",{ascending:!1});if(i){const l=i.filter(n=>n.target_type==="restaurant").map(n=>n.target_id),_=i.filter(n=>n.target_type==="activity").map(n=>n.target_id),[S,$]=await Promise.all([l.length>0?d.from("restaurants").select("id, name, name_en, name_pt").in("id",l):{data:[]},_.length>0?d.from("activities").select("id, title_zh, title_en, title_pt").in("id",_):{data:[]}]),q=Object.fromEntries((S.data||[]).map(n=>[n.id,n])),A=Object.fromEntries(($.data||[]).map(n=>[n.id,n]));o(i.map(n=>({...n,target:n.target_type==="restaurant"?q[n.target_id]:A[n.target_id]})))}break}case"ratings":{const{data:i}=await d.from("ratings").select("id, rating_value, price_range, created_at, restaurants(id, name, name_en, name_pt)").eq("user_id",c).order("created_at",{ascending:!1});o(i?.map(l=>({...l,restaurant:l.restaurants}))||[]);break}case"addresses":{const{data:i}=await d.from("user_addresses").select("*").eq("user_id",c).order("is_default",{ascending:!1});o(i||[]);break}case"managedRestaurants":{const{data:i}=await d.from("merchant_restaurants").select("created_at, restaurants(id, name, name_en, name_pt, image_url, address)").eq("user_id",c).order("created_at",{ascending:!1});o(i?.map(l=>({...l.restaurants,assigned_at:l.created_at}))||[]);break}}}catch(i){console.error("Error fetching detail data:",i),o([])}finally{E(!1)}}},Z=s=>{switch(s){case"restaurants":return t("admin.restaurantFavorites");case"activities":return t("admin.activityFavorites");case"comments":return t("admin.commentsCount");case"ratings":return t("admin.ratingsCount");case"addresses":return t("admin.addressesCount");case"managedRestaurants":return t("admin.managedRestaurants");default:return""}},I=s=>{switch(s){case"admin":return"bg-primary text-primary-foreground";case"supervisor":return"bg-blue-500 text-white";case"merchant":return"bg-emerald-500 text-white";default:return"bg-muted text-muted-foreground"}},ee=s=>{switch(s){case"admin":return e.jsx(F,{className:"h-3.5 w-3.5"});case"supervisor":return e.jsx(F,{className:"h-3.5 w-3.5"});case"merchant":return e.jsx(ue,{className:"h-3.5 w-3.5"});default:return e.jsx(xe,{className:"h-3.5 w-3.5"})}},P=s=>s?new Date(s).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}):"-",se=s=>{s||(R(null),o([])),V(s)},te=()=>{if(J)return e.jsx("div",{className:"space-y-3",children:[1,2,3].map(s=>e.jsx(f,{className:"h-16 w-full"},s))});if(x.length===0)return e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:t("common.noDataFound")});switch(C){case"restaurants":return e.jsx("div",{className:"space-y-2",children:x.map(s=>e.jsxs(v,{to:`/restaurant/${s.id}`,target:"_blank",className:"flex items-center gap-3 p-3 rounded-lg border hover:bg-muted/50 transition-colors",children:[e.jsx("img",{src:s.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=100&q=80",alt:m(s,"name"),className:"w-12 h-12 rounded-lg object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:m(s,"name")}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:m(s,"type")})]}),s.rating&&e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(b,{className:"h-3.5 w-3.5 fill-yellow-500 text-yellow-500"}),s.rating.toFixed(1)]}),e.jsx(w,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"})]},s.id))});case"activities":return e.jsx("div",{className:"space-y-2",children:x.map(s=>e.jsxs(v,{to:`/activity/${s.id}`,target:"_blank",className:"flex items-center gap-3 p-3 rounded-lg border hover:bg-muted/50 transition-colors",children:[s.image_url&&e.jsx("img",{src:s.image_url,alt:m(s,"title"),className:"w-12 h-12 rounded-lg object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:m(s,"title")}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[new Date(s.start_date).toLocaleDateString(),s.end_date&&` - ${new Date(s.end_date).toLocaleDateString()}`]})]}),e.jsx(w,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"})]},s.id))});case"comments":return e.jsx("div",{className:"space-y-2",children:x.map(s=>e.jsxs(v,{to:`/${s.target_type}/${s.target_id}`,target:"_blank",className:"block p-3 rounded-lg border hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{variant:"outline",className:"text-xs",children:s.target_type==="restaurant"?t("common.restaurant"):t("common.activity")}),e.jsx("span",{className:"text-sm font-medium truncate",children:s.target&&(s.target_type==="restaurant"?m(s.target,"name"):m(s.target,"title"))})]}),s.rating_value&&e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(b,{className:"h-3.5 w-3.5 fill-yellow-500 text-yellow-500"}),s.rating_value]})]}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.content}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:O(new Date(s.created_at),{addSuffix:!0})})]},s.id))});case"ratings":return e.jsx("div",{className:"space-y-2",children:x.map(s=>e.jsxs(v,{to:`/restaurant/${s.restaurant?.id}`,target:"_blank",className:"flex items-center gap-3 p-3 rounded-lg border hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:m(s.restaurant,"name")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:O(new Date(s.created_at),{addSuffix:!0})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"h-4 w-4 fill-yellow-500 text-yellow-500"}),e.jsx("span",{className:"font-semibold",children:s.rating_value})]}),e.jsx(w,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"})]},s.id))});case"addresses":return e.jsx("div",{className:"space-y-2",children:x.map(s=>e.jsxs("div",{className:"p-3 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium",children:s.label}),s.is_default&&e.jsx(y,{variant:"secondary",className:"text-xs",children:t("profile.defaultAddress")})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.street,", ",s.district&&`${s.district}, `,s.city]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.postal_code&&`${s.postal_code}, `,s.country]}),s.phone&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[s.phone_code," ",s.phone]})]},s.id))});case"managedRestaurants":return e.jsx("div",{className:"space-y-2",children:x.map(s=>e.jsxs(v,{to:`/restaurant/${s.id}`,target:"_blank",className:"flex items-center gap-3 p-3 rounded-lg border hover:bg-muted/50 transition-colors",children:[s.image_url&&e.jsx("img",{src:s.image_url,alt:m(s,"name"),className:"w-12 h-12 rounded-lg object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:m(s,"name")}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s.address})]}),e.jsx(w,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"})]},s.id))});default:return null}};return e.jsx(he,{open:k,onOpenChange:se,children:e.jsx(ge,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:C?e.jsxs(e.Fragment,{children:[e.jsx(U,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{R(null),o([])},children:e.jsx(re,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx(B,{children:Z(C)}),e.jsxs(H,{children:[a?.display_name," - ",x.length," ",t("common.items")]})]})]})}),e.jsx(pe,{className:"max-h-[60vh] pr-4",children:te()})]}):e.jsxs(e.Fragment,{children:[e.jsxs(U,{children:[e.jsx(B,{children:t("admin.viewProfile")}),e.jsx(H,{children:t("admin.userProfileDetails")})]}),K?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(f,{className:"h-16 w-16 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{className:"h-5 w-32"}),e.jsx(f,{className:"h-4 w-24"})]})]}),e.jsx(f,{className:"h-20 w-full"}),e.jsx(f,{className:"h-32 w-full"})]}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(je,{className:"h-16 w-16 border-2 border-primary/20",children:[e.jsx(Ne,{src:a.avatar_url||"",alt:a.display_name}),e.jsx(ve,{className:"text-xl bg-primary/10 text-primary",children:a.display_name.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"text-xl font-semibold",children:a.display_name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(y,{className:`${I(N)} gap-1`,children:[ee(N),e.jsx("span",{className:"capitalize",children:N})]}),a.is_banned&&e.jsx(y,{variant:"destructive",children:t("admin.banned")})]})]})]}),e.jsx(D,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground",children:t("admin.contactInfo")}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:W||"-"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:a.phone||"-"})]})]})]}),(a.full_name||a.nif||a.contact||a.address)&&e.jsxs(e.Fragment,{children:[e.jsx(D,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground",children:t("admin.applicationInfo")}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[a.full_name&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:t("admin.fullName")}),e.jsx("p",{children:a.full_name})]})]}),a.nif&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:t("admin.nif")}),e.jsx("p",{children:a.nif})]})]}),a.contact&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:t("admin.contactMethod")}),e.jsx("p",{children:a.contact})]})]}),a.address&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:t("admin.address")}),e.jsx("p",{children:a.address})]})]})]})]})]}),e.jsx(D,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground",children:t("admin.accountInfo")}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:t("admin.registrationTime")}),e.jsx("p",{children:P(a.created_at)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:t("admin.languagePreference")}),e.jsx("p",{children:a.language_preference||"en"})]})]})]}),a.activity_terms_agreed&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-emerald-600",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsxs("span",{children:[t("admin.agreedActivityTerms")," (",P(a.activity_terms_agreed_at),")"]})]}),a.is_banned&&a.ban_reason&&e.jsxs("div",{className:"p-3 bg-destructive/10 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-destructive font-medium",children:[t("admin.banReason"),":"]}),e.jsx("p",{className:"text-sm text-destructive/80",children:a.ban_reason})]})]}),e.jsx(D,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground",children:t("admin.userStats")}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(p,{className:`bg-muted/30 transition-colors ${r.favoriteRestaurants>0?"cursor-pointer hover:bg-muted/50":""}`,onClick:()=>r.favoriteRestaurants>0&&h("restaurants"),children:e.jsxs(j,{className:"p-3 text-center relative",children:[e.jsx(M,{className:"h-4 w-4 mx-auto mb-1 text-red-500"}),e.jsx("p",{className:"text-lg font-semibold",children:r.favoriteRestaurants}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("admin.restaurantFavorites")}),r.favoriteRestaurants>0&&e.jsx(g,{className:"h-3 w-3 absolute top-2 right-2 text-muted-foreground"})]})}),e.jsx(p,{className:`bg-muted/30 transition-colors ${r.favoriteActivities>0?"cursor-pointer hover:bg-muted/50":""}`,onClick:()=>r.favoriteActivities>0&&h("activities"),children:e.jsxs(j,{className:"p-3 text-center relative",children:[e.jsx(M,{className:"h-4 w-4 mx-auto mb-1 text-primary"}),e.jsx("p",{className:"text-lg font-semibold",children:r.favoriteActivities}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("admin.activityFavorites")}),r.favoriteActivities>0&&e.jsx(g,{className:"h-3 w-3 absolute top-2 right-2 text-muted-foreground"})]})}),e.jsx(p,{className:`bg-muted/30 transition-colors ${r.comments>0?"cursor-pointer hover:bg-muted/50":""}`,onClick:()=>r.comments>0&&h("comments"),children:e.jsxs(j,{className:"p-3 text-center relative",children:[e.jsx(me,{className:"h-4 w-4 mx-auto mb-1 text-blue-500"}),e.jsx("p",{className:"text-lg font-semibold",children:r.comments}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("admin.commentsCount")}),r.comments>0&&e.jsx(g,{className:"h-3 w-3 absolute top-2 right-2 text-muted-foreground"})]})}),e.jsx(p,{className:`bg-muted/30 transition-colors ${r.ratings>0?"cursor-pointer hover:bg-muted/50":""}`,onClick:()=>r.ratings>0&&h("ratings"),children:e.jsxs(j,{className:"p-3 text-center relative",children:[e.jsx(b,{className:"h-4 w-4 mx-auto mb-1 text-yellow-500"}),e.jsx("p",{className:"text-lg font-semibold",children:r.ratings}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("admin.ratingsCount")}),r.ratings>0&&e.jsx(g,{className:"h-3 w-3 absolute top-2 right-2 text-muted-foreground"})]})}),e.jsx(p,{className:`bg-muted/30 transition-colors ${r.addresses>0?"cursor-pointer hover:bg-muted/50":""}`,onClick:()=>r.addresses>0&&h("addresses"),children:e.jsxs(j,{className:"p-3 text-center relative",children:[e.jsx(T,{className:"h-4 w-4 mx-auto mb-1 text-emerald-500"}),e.jsx("p",{className:"text-lg font-semibold",children:r.addresses}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("admin.addressesCount")}),r.addresses>0&&e.jsx(g,{className:"h-3 w-3 absolute top-2 right-2 text-muted-foreground"})]})}),(N==="merchant"||N==="supervisor")&&e.jsx(p,{className:`bg-muted/30 transition-colors ${r.restaurants>0?"cursor-pointer hover:bg-muted/50":""}`,onClick:()=>r.restaurants>0&&h("managedRestaurants"),children:e.jsxs(j,{className:"p-3 text-center relative",children:[e.jsx(oe,{className:"h-4 w-4 mx-auto mb-1 text-orange-500"}),e.jsx("p",{className:"text-lg font-semibold",children:r.restaurants}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("admin.managedRestaurants")}),r.restaurants>0&&e.jsx(g,{className:"h-3 w-3 absolute top-2 right-2 text-muted-foreground"})]})})]})]})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:t("common.noDataFound")})]})})})}export{Re as U};
//# sourceMappingURL=UserProfileDialog-CTD0Mmjd.js.map
