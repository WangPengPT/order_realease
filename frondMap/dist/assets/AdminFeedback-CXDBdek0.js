import{p as B,q as P,r as k,s as L,v as S,j as e,aK as I,aM as K,bj as Q,bM as p,ak as U,bE as F,c1 as T,w as g,bh as V}from"./vendor-react-D8EXe6Pj.js";import{a1 as z,a2 as O,a3 as X,a4 as Z,a5 as l,C as G,p as J,F as W,Z as Y,q as $,B as c,A as ee,a6 as se,t as ae,v as ie,w as te,x as ne,y as de,z as re,E as le,D as ce,b as oe,c as me,d as ue,T as xe,U as r,a7 as he,s as j,g as o}from"./index-Flvc7LYa.js";import{T as ge,a as je,b as A,c as n,d as fe,e as d}from"./table-CoE5wHN9.js";import{D as M}from"./vendor-utils-Z4kpnli5.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-BzOCmhQX.js";const Ce=()=>{const{t:s}=B(),v=P(),[m,_]=k.useState("all"),[i,f]=k.useState(null),[N,w]=k.useState(""),{data:u,isLoading:q}=L({queryKey:["admin-feedback",m],queryFn:async()=>{let a=j.from("feedback").select("*").order("created_at",{ascending:!1});m!=="all"&&(a=a.eq("status",m));const{data:t,error:h}=await a;if(h)throw h;return t}}),x=S({mutationFn:async({id:a,status:t,notes:h})=>{const{data:{user:H}}=await j.auth.getUser(),{error:D}=await j.from("feedback").update({status:t,admin_notes:h||null,reviewed_at:new Date().toISOString(),reviewed_by:H?.id}).eq("id",a);if(D)throw D},onSuccess:()=>{v.invalidateQueries({queryKey:["admin-feedback"]}),g.success(s("admin.feedback.updateSuccess","Feedback status updated")),f(null)},onError:a=>{console.error("Error updating feedback:",a),g.error(s("admin.feedback.updateError","Failed to update feedback"))}}),E=S({mutationFn:async a=>{const{error:t}=await j.from("feedback").delete().eq("id",a);if(t)throw t},onSuccess:()=>{v.invalidateQueries({queryKey:["admin-feedback"]}),g.success(s("admin.feedback.deleteSuccess","Feedback deleted"))},onError:a=>{console.error("Error deleting feedback:",a),g.error(s("admin.feedback.deleteError","Failed to delete feedback"))}}),y=a=>{switch(a){case"pending":return e.jsxs(o,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(V,{className:"h-3 w-3"}),s("admin.feedback.status.pending","Pending")]});case"reviewing":return e.jsxs(o,{variant:"outline",className:"flex items-center gap-1 border-yellow-500 text-yellow-600",children:[e.jsx(p,{className:"h-3 w-3"}),s("admin.feedback.status.reviewing","Reviewing")]});case"resolved":return e.jsxs(o,{variant:"default",className:"flex items-center gap-1 bg-green-500",children:[e.jsx(F,{className:"h-3 w-3"}),s("admin.feedback.status.resolved","Resolved")]});case"dismissed":return e.jsxs(o,{variant:"destructive",className:"flex items-center gap-1",children:[e.jsx(T,{className:"h-3 w-3"}),s("admin.feedback.status.dismissed","Dismissed")]});default:return e.jsx(o,{variant:"secondary",children:a})}},C=a=>({bug:s("feedback.reasons.bug","Bug"),suggestion:s("feedback.reasons.suggestion","Suggestion"),feature:s("feedback.reasons.feature","Feature Request"),complaint:s("feedback.reasons.complaint","Complaint"),praise:s("feedback.reasons.praise","Praise"),other:s("feedback.reasons.other","Other")})[a]||a,R=a=>{f(a),w(a.admin_notes||"")},b=a=>{i&&x.mutate({id:i.id,status:a,notes:N})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(I,{className:"h-6 w-6"}),s("admin.feedback.title","User Feedback")]}),e.jsx("p",{className:"text-muted-foreground",children:s("admin.feedback.description","View and manage user feedback submissions")})]}),e.jsxs(z,{value:m,onValueChange:_,children:[e.jsx(O,{className:"w-[180px]",children:e.jsx(X,{placeholder:s("admin.feedback.filterByStatus","Filter by status")})}),e.jsxs(Z,{children:[e.jsx(l,{value:"all",children:s("admin.feedback.allStatus","All Status")}),e.jsx(l,{value:"pending",children:s("admin.feedback.status.pending","Pending")}),e.jsx(l,{value:"reviewing",children:s("admin.feedback.status.reviewing","Reviewing")}),e.jsx(l,{value:"resolved",children:s("admin.feedback.status.resolved","Resolved")}),e.jsx(l,{value:"dismissed",children:s("admin.feedback.status.dismissed","Dismissed")})]})]})]}),e.jsxs(G,{children:[e.jsxs(J,{children:[e.jsx(W,{children:s("admin.feedback.listTitle","Feedback List")}),e.jsxs(Y,{children:[u?.length||0," ",s("admin.feedback.totalCount","feedback submissions")]})]}),e.jsx($,{children:q?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(K,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):u&&u.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ge,{children:[e.jsx(je,{children:e.jsxs(A,{children:[e.jsx(n,{children:s("admin.feedback.email","Email")}),e.jsx(n,{children:s("admin.feedback.reason","Type")}),e.jsx(n,{className:"max-w-[300px]",children:s("admin.feedback.content","Content")}),e.jsx(n,{children:s("admin.feedback.image","Image")}),e.jsx(n,{children:s("admin.feedback.status","Status")}),e.jsx(n,{children:s("admin.feedback.createdAt","Submitted")}),e.jsx(n,{className:"text-right",children:s("common.actions","Actions")})]})}),e.jsx(fe,{children:u.map(a=>e.jsxs(A,{children:[e.jsx(d,{className:"font-medium",children:a.email}),e.jsx(d,{children:C(a.reason)}),e.jsx(d,{className:"max-w-[300px] truncate",children:a.content}),e.jsx(d,{children:a.image_url?e.jsx("a",{href:a.image_url,target:"_blank",rel:"noopener noreferrer",children:e.jsx(Q,{className:"h-4 w-4 text-primary"})}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(d,{children:y(a.status)}),e.jsx(d,{children:M(new Date(a.created_at),"yyyy-MM-dd HH:mm")}),e.jsx(d,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:()=>R(a),children:e.jsx(p,{className:"h-4 w-4"})}),e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsx(c,{variant:"outline",size:"sm",className:"text-destructive",children:e.jsx(U,{className:"h-4 w-4"})})}),e.jsxs(ae,{children:[e.jsxs(ie,{children:[e.jsx(te,{children:s("admin.feedback.confirmDelete","Delete Feedback?")}),e.jsx(ne,{children:s("admin.feedback.confirmDeleteDesc","This action cannot be undone.")})]}),e.jsxs(de,{children:[e.jsx(re,{children:s("common.cancel")}),e.jsx(le,{onClick:()=>E.mutate(a.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:s("common.delete")})]})]})]})]})})]},a.id))})]})}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:s("admin.feedback.noFeedback","No feedback submissions yet")})})]}),e.jsx(ce,{open:!!i,onOpenChange:()=>f(null),children:e.jsxs(oe,{className:"max-w-2xl",children:[e.jsxs(me,{children:[e.jsx(ue,{children:s("admin.feedback.details","Feedback Details")}),e.jsx(xe,{children:i&&M(new Date(i.created_at),"yyyy-MM-dd HH:mm:ss")})]}),i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground",children:s("admin.feedback.email","Email")}),e.jsx("p",{className:"font-medium",children:i.email})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground",children:s("admin.feedback.reason","Type")}),e.jsx("p",{className:"font-medium",children:C(i.reason)})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground",children:s("admin.feedback.content","Content")}),e.jsx("div",{className:"mt-1 p-3 bg-muted rounded-md whitespace-pre-wrap",children:i.content})]}),i.image_url&&e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground",children:s("admin.feedback.image","Screenshot")}),e.jsx("div",{className:"mt-1",children:e.jsx("a",{href:i.image_url,target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:i.image_url,alt:s("admin.feedback.imageAlt"),className:"max-h-48 rounded-md border cursor-pointer hover:opacity-80 transition-opacity"})})})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-muted-foreground",children:s("admin.feedback.currentStatus","Current Status")}),e.jsx("div",{className:"mt-1",children:y(i.status)})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"admin-notes",children:s("admin.feedback.adminNotes","Admin Notes")}),e.jsx(he,{id:"admin-notes",value:N,onChange:a=>w(a.target.value),placeholder:s("admin.feedback.adminNotesPlaceholder","Add notes for this feedback..."),rows:3,className:"mt-1"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(c,{variant:"outline",onClick:()=>b("reviewing"),disabled:x.isPending,children:[e.jsx(p,{className:"mr-2 h-4 w-4"}),s("admin.feedback.markReviewing","Mark as Reviewing")]}),e.jsxs(c,{variant:"default",className:"bg-green-600 hover:bg-green-700",onClick:()=>b("resolved"),disabled:x.isPending,children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),s("admin.feedback.markResolved","Mark as Resolved")]}),e.jsxs(c,{variant:"destructive",onClick:()=>b("dismissed"),disabled:x.isPending,children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),s("admin.feedback.markDismissed","Dismiss")]})]})]})]})})]})};export{Ce as default};
//# sourceMappingURL=AdminFeedback-CXDBdek0.js.map
