{"version":3,"file":"Shop-BefehxZs.js","sources":["../../src/components/PurchaseConfirmDialog.tsx","../../src/pages/Shop.tsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Coins, MapPin, Loader2 } from \"lucide-react\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { ShopItem, usePurchaseItem } from \"@/hooks/useShopItems\";\r\nimport { useUserAddresses } from \"@/hooks/useUserAddresses\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\n\r\ninterface PurchaseConfirmDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  item: ShopItem;\r\n  userPoints: number;\r\n}\r\n\r\nexport const PurchaseConfirmDialog = ({\r\n  open,\r\n  onOpenChange,\r\n  item,\r\n  userPoints,\r\n}: PurchaseConfirmDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const { data: addresses = [] } = useUserAddresses();\r\n  const purchaseMutation = usePurchaseItem();\r\n  \r\n  const [selectedAddressId, setSelectedAddressId] = useState<string>(\"\");\r\n  \r\n  const isPhysical = item.item_type === 'physical';\r\n  const remainingPoints = userPoints - item.points_cost;\r\n  \r\n  const handleConfirm = async () => {\r\n    await purchaseMutation.mutateAsync({\r\n      itemId: item.id,\r\n      shippingAddressId: isPhysical ? selectedAddressId : undefined,\r\n    });\r\n    onOpenChange(false);\r\n  };\r\n\r\n  const canConfirm = !isPhysical || selectedAddressId;\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-md\">\r\n        <DialogHeader>\r\n          <DialogTitle>{t('shop.confirmPurchase')}</DialogTitle>\r\n          <DialogDescription>\r\n            {t('shop.confirmPurchaseDesc')}\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-4 py-4\">\r\n          {/* Item Info */}\r\n          <div className=\"flex items-start gap-4 p-4 bg-secondary/30 rounded-lg\">\r\n            {item.image_url && (\r\n              <img \r\n                src={item.image_url} \r\n                alt={String(getLocalizedField(item, 'name'))}\r\n                className=\"w-16 h-16 rounded-lg object-cover\"\r\n              />\r\n            )}\r\n            <div className=\"flex-1\">\r\n              <h4 className=\"font-semibold\">{getLocalizedField(item, 'name')}</h4>\r\n              <p className=\"text-sm text-muted-foreground line-clamp-2\">\r\n                {getLocalizedField(item, 'description')}\r\n              </p>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Points Info */}\r\n          <div className=\"space-y-2\">\r\n            <div className=\"flex justify-between items-center\">\r\n              <span className=\"text-muted-foreground\">{t('shop.currentPoints')}</span>\r\n              <span className=\"flex items-center gap-1\">\r\n                <Coins className=\"w-4 h-4 text-accent\" />\r\n                <span className=\"font-medium\">{userPoints}</span>\r\n              </span>\r\n            </div>\r\n            <div className=\"flex justify-between items-center\">\r\n              <span className=\"text-muted-foreground\">{t('shop.pointsCost')}</span>\r\n              <span className=\"flex items-center gap-1 text-destructive\">\r\n                <span>-</span>\r\n                <Coins className=\"w-4 h-4\" />\r\n                <span className=\"font-medium\">{item.points_cost}</span>\r\n              </span>\r\n            </div>\r\n            <div className=\"border-t pt-2 flex justify-between items-center\">\r\n              <span className=\"font-medium\">{t('shop.afterPurchase')}</span>\r\n              <span className=\"flex items-center gap-1\">\r\n                <Coins className=\"w-4 h-4 text-accent\" />\r\n                <span className=\"font-bold\">{remainingPoints}</span>\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Shipping Address (for physical items) */}\r\n          {isPhysical && (\r\n            <div className=\"space-y-2\">\r\n              <Label className=\"flex items-center gap-2\">\r\n                <MapPin className=\"w-4 h-4\" />\r\n                {t('shop.selectAddress')}\r\n              </Label>\r\n              {addresses.length === 0 ? (\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  {t('shop.noAddresses')}\r\n                </p>\r\n              ) : (\r\n                <Select value={selectedAddressId} onValueChange={setSelectedAddressId}>\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder={t('shop.selectAddressPlaceholder')} />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {addresses.map((address) => (\r\n                      <SelectItem key={address.id} value={address.id}>\r\n                        <div className=\"text-left\">\r\n                          <div className=\"font-medium\">{address.label}</div>\r\n                          <div className=\"text-sm text-muted-foreground\">\r\n                            {address.street}, {address.city}\r\n                          </div>\r\n                        </div>\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <DialogFooter className=\"gap-2 sm:gap-0\">\r\n          <Button variant=\"outline\" onClick={() => onOpenChange(false)}>\r\n            {t('common.cancel')}\r\n          </Button>\r\n          <Button \r\n            onClick={handleConfirm} \r\n            disabled={!canConfirm || purchaseMutation.isPending}\r\n          >\r\n            {purchaseMutation.isPending ? (\r\n              <>\r\n                <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                {t('common.processing')}\r\n              </>\r\n            ) : (\r\n              t('shop.confirmPurchaseBtn')\r\n            )}\r\n          </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n","import { useState, useCallback } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { Coins, Package, Ticket, Award, ShoppingBag } from \"lucide-react\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useUserPoints } from \"@/hooks/usePoints\";\r\nimport { useShopItems, useUserPurchaseLimits, ShopItem } from \"@/hooks/useShopItems\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { PurchaseConfirmDialog } from \"@/components/PurchaseConfirmDialog\";\r\nimport { PointsHistoryDialog } from \"@/components/PointsHistoryDialog\";\r\nimport { PullToRefresh } from \"@/components/PullToRefresh\";\r\n\r\nconst Shop = () => {\r\n  const { t } = useTranslation();\r\n  const navigate = useNavigate();\r\n  const { user } = useAuth();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const queryClient = useQueryClient();\r\n  \r\n  const { data: points = 0, isLoading: pointsLoading } = useUserPoints();\r\n  const { data: items = [], isLoading: itemsLoading } = useShopItems();\r\n  const { data: purchaseLimits = [] } = useUserPurchaseLimits();\r\n  \r\n  const [selectedItem, setSelectedItem] = useState<ShopItem | null>(null);\r\n  const [purchaseDialogOpen, setPurchaseDialogOpen] = useState(false);\r\n\r\n  const handleRefresh = useCallback(async () => {\r\n    await Promise.all([\r\n      queryClient.invalidateQueries({ queryKey: ['shop-items'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['user-points'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['user-purchase-limits'] }),\r\n    ]);\r\n  }, [queryClient]);\r\n\r\n  const getItemTypeIcon = (type: string) => {\r\n    switch (type) {\r\n      case 'coupon':\r\n        return <Ticket className=\"w-5 h-5\" />;\r\n      case 'physical':\r\n        return <Package className=\"w-5 h-5\" />;\r\n      case 'badge':\r\n        return <Award className=\"w-5 h-5\" />;\r\n      default:\r\n        return <ShoppingBag className=\"w-5 h-5\" />;\r\n    }\r\n  };\r\n\r\n  const getItemTypeLabel = (type: string) => {\r\n    switch (type) {\r\n      case 'coupon':\r\n        return t('shop.itemType.coupon');\r\n      case 'physical':\r\n        return t('shop.itemType.physical');\r\n      case 'badge':\r\n        return t('shop.itemType.badge');\r\n      default:\r\n        return type;\r\n    }\r\n  };\r\n\r\n  const getUserRemainingPurchases = (item: ShopItem) => {\r\n    const limit = purchaseLimits.find(l => l.shop_item_id === item.id);\r\n    if (!limit) return item.per_user_limit;\r\n    \r\n    // Check if period needs reset\r\n    const periodStart = new Date(limit.period_start);\r\n    const now = new Date();\r\n    \r\n    if (item.limit_refresh_period === 'daily' && periodStart.toDateString() !== now.toDateString()) {\r\n      return item.per_user_limit;\r\n    }\r\n    if (item.limit_refresh_period === 'weekly') {\r\n      const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\r\n      if (periodStart < weekAgo) return item.per_user_limit;\r\n    }\r\n    if (item.limit_refresh_period === 'monthly') {\r\n      if (periodStart.getMonth() !== now.getMonth() || periodStart.getFullYear() !== now.getFullYear()) {\r\n        return item.per_user_limit;\r\n      }\r\n    }\r\n    \r\n    return Math.max(0, item.per_user_limit - limit.purchase_count);\r\n  };\r\n\r\n  const canPurchase = (item: ShopItem) => {\r\n    if (!user) return false;\r\n    if (points < item.points_cost) return false;\r\n    if (item.stock !== null && item.stock <= 0) return false;\r\n    if (getUserRemainingPurchases(item) <= 0) return false;\r\n    return true;\r\n  };\r\n\r\n  const handlePurchaseClick = (item: ShopItem) => {\r\n    if (!user) {\r\n      navigate('/auth');\r\n      return;\r\n    }\r\n    setSelectedItem(item);\r\n    setPurchaseDialogOpen(true);\r\n  };\r\n\r\n  if (itemsLoading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-secondary/20 py-8 px-4\">\r\n        <div className=\"container mx-auto max-w-6xl\">\r\n          <div className=\"text-center\">{t('common.loading')}</div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <PullToRefresh onRefresh={handleRefresh}>\r\n    <div className=\"min-h-screen bg-secondary/20 py-4 md:py-8 px-3 md:px-4\">\r\n      <div className=\"container mx-auto max-w-6xl\">\r\n        {/* Header */}\r\n        <div className=\"mb-6 md:mb-8\">\r\n          <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\r\n            <div>\r\n              <h1 className=\"text-2xl md:text-3xl font-bold text-foreground mb-2\">\r\n                {t('shop.title')}\r\n              </h1>\r\n              <p className=\"text-muted-foreground\">\r\n                {t('shop.description')}\r\n              </p>\r\n            </div>\r\n            \r\n            {user && (\r\n              <Card className=\"md:w-auto\">\r\n                <CardContent className=\"p-4 flex items-center gap-4\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Coins className=\"w-6 h-6 text-accent\" />\r\n                    <span className=\"text-2xl font-bold text-foreground\">\r\n                      {pointsLoading ? '...' : points}\r\n                    </span>\r\n                    <span className=\"text-muted-foreground\">{t('shop.points')}</span>\r\n                  </div>\r\n                  <PointsHistoryDialog />\r\n                </CardContent>\r\n              </Card>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Items Grid */}\r\n        {items.length === 0 ? (\r\n          <Card>\r\n            <CardContent className=\"py-12 text-center\">\r\n              <ShoppingBag className=\"w-12 h-12 mx-auto mb-4 text-muted-foreground\" />\r\n              <p className=\"text-muted-foreground\">{t('shop.noItems')}</p>\r\n            </CardContent>\r\n          </Card>\r\n        ) : (\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6\">\r\n            {items.map((item) => {\r\n              const isSoldOut = item.stock !== null && item.stock <= 0;\r\n              const remainingPurchases = getUserRemainingPurchases(item);\r\n              const isLimitReached = remainingPurchases <= 0;\r\n              const insufficientPoints = points < item.points_cost;\r\n              \r\n              return (\r\n                <Card \r\n                  key={item.id} \r\n                  className={`overflow-hidden ${isSoldOut ? 'opacity-60' : ''}`}\r\n                >\r\n                  {/* Image */}\r\n                  {item.image_url && (\r\n                    <div className=\"aspect-video overflow-hidden bg-secondary/30\">\r\n                      <img \r\n                        src={item.image_url} \r\n                        alt={String(getLocalizedField(item, 'name'))}\r\n                        className=\"w-full h-full object-cover\"\r\n                      />\r\n                    </div>\r\n                  )}\r\n                  \r\n                  <CardHeader className=\"pb-2\">\r\n                    <div className=\"flex items-start justify-between gap-2\">\r\n                      <div className=\"flex-1\">\r\n                        <CardTitle className=\"text-lg line-clamp-1\">\r\n                          {getLocalizedField(item, 'name')}\r\n                        </CardTitle>\r\n                        <CardDescription className=\"line-clamp-2 mt-1\">\r\n                          {getLocalizedField(item, 'description')}\r\n                        </CardDescription>\r\n                      </div>\r\n                      <Badge variant=\"secondary\" className=\"flex items-center gap-1 shrink-0\">\r\n                        {getItemTypeIcon(item.item_type)}\r\n                        <span className=\"hidden sm:inline\">{getItemTypeLabel(item.item_type)}</span>\r\n                      </Badge>\r\n                    </div>\r\n                  </CardHeader>\r\n                  \r\n                  <CardContent className=\"pt-0\">\r\n                    {/* Price and Stock */}\r\n                    <div className=\"flex items-center justify-between mb-3\">\r\n                      <div className=\"flex items-center gap-1\">\r\n                        <Coins className=\"w-4 h-4 text-accent\" />\r\n                        <span className=\"font-bold text-lg\">{item.points_cost}</span>\r\n                        <span className=\"text-muted-foreground text-sm\">{t('shop.points')}</span>\r\n                      </div>\r\n                      \r\n                      <div className=\"text-sm text-muted-foreground\">\r\n                        {item.stock !== null ? (\r\n                          isSoldOut ? (\r\n                            <Badge variant=\"destructive\">{t('shop.soldOut')}</Badge>\r\n                          ) : (\r\n                            <span>{t('shop.stock')}: {item.stock}</span>\r\n                          )\r\n                        ) : (\r\n                          <span>{t('shop.unlimited')}</span>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    {/* Limit Info */}\r\n                    <div className=\"text-sm text-muted-foreground mb-3\">\r\n                      {item.limit_refresh_period === 'none' ? (\r\n                        <span>{t('shop.limitTotal', { count: item.per_user_limit })}</span>\r\n                      ) : (\r\n                        <span>\r\n                          {t(`shop.limit.${item.limit_refresh_period}`, { count: item.per_user_limit })}\r\n                        </span>\r\n                      )}\r\n                      {user && !isSoldOut && (\r\n                        <span className=\"ml-2\">\r\n                          ({t('shop.remaining')}: {remainingPurchases})\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                    \r\n                    {/* Purchase Button */}\r\n                    <Button \r\n                      className=\"w-full\"\r\n                      disabled={!canPurchase(item)}\r\n                      onClick={() => handlePurchaseClick(item)}\r\n                    >\r\n                      {!user ? (\r\n                        t('shop.loginToPurchase')\r\n                      ) : isSoldOut ? (\r\n                        t('shop.soldOut')\r\n                      ) : isLimitReached ? (\r\n                        t('shop.limitReached')\r\n                      ) : insufficientPoints ? (\r\n                        t('shop.insufficientPoints')\r\n                      ) : (\r\n                        t('shop.purchase')\r\n                      )}\r\n                    </Button>\r\n                  </CardContent>\r\n                </Card>\r\n              );\r\n            })}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Purchase Confirm Dialog */}\r\n      {selectedItem && (\r\n        <PurchaseConfirmDialog\r\n          open={purchaseDialogOpen}\r\n          onOpenChange={setPurchaseDialogOpen}\r\n          item={selectedItem}\r\n          userPoints={points}\r\n        />\r\n      )}\r\n    </div>\r\n    </PullToRefresh>\r\n  );\r\n};\r\n\r\nexport default Shop;\r\n"],"names":["PurchaseConfirmDialog","open","onOpenChange","item","userPoints","useTranslation","getLocalizedField","useLocalizedContent","addresses","useUserAddresses","purchaseMutation","usePurchaseItem","selectedAddressId","setSelectedAddressId","useState","isPhysical","remainingPoints","handleConfirm","canConfirm","Dialog","jsxs","DialogContent","DialogHeader","jsx","DialogTitle","DialogDescription","Coins","Label","MapPin","Select","SelectTrigger","SelectValue","SelectContent","address","SelectItem","DialogFooter","Button","Fragment","Loader2","Shop","t","navigate","useNavigate","user","useAuth","queryClient","useQueryClient","points","pointsLoading","useUserPoints","items","itemsLoading","useShopItems","purchaseLimits","useUserPurchaseLimits","selectedItem","setSelectedItem","purchaseDialogOpen","setPurchaseDialogOpen","handleRefresh","useCallback","getItemTypeIcon","type","Ticket","Package","Award","ShoppingBag","getItemTypeLabel","getUserRemainingPurchases","limit","l","periodStart","now","weekAgo","canPurchase","handlePurchaseClick","PullToRefresh","Card","CardContent","PointsHistoryDialog","isSoldOut","remainingPurchases","isLimitReached","insufficientPoints","CardHeader","CardTitle","CardDescription","Badge"],"mappings":"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"}