import{p as g,r as c,v as u}from"./index-QLT-vsIo.js";const l="location_cache",d=()=>{const t="visitor_id";let e=localStorage.getItem(t);return e||(e=crypto.randomUUID(),localStorage.setItem(t,e)),e},y=()=>{try{const t=sessionStorage.getItem(l);if(t)return JSON.parse(t)}catch{}return null},p=t=>{try{sessionStorage.setItem(l,JSON.stringify(t))}catch{}},h=async()=>{const t=y();if(t)return t;try{const{data:e,error:r}=await u.functions.invoke("get-location");if(r)return console.error("Failed to fetch location:",r),{country:null,city:null,region:null};const o={country:(e==null?void 0:e.country)||null,city:(e==null?void 0:e.city)||null,region:(e==null?void 0:e.region)||null,ip:(e==null?void 0:e.ip)||null};return(o.country||o.city)&&p(o),o}catch(e){return console.error("Failed to fetch location data:",e),{country:null,city:null,region:null}}},I=({pageType:t,targetId:e})=>{const{user:r}=g(),o=c.useRef(!1);c.useEffect(()=>{if(o.current)return;o.current=!0,(async()=>{try{const n=d(),i=await h();await u.from("page_views").insert({page_type:t,target_id:e||null,visitor_id:n,user_id:(r==null?void 0:r.id)||null,user_agent:navigator.userAgent,referer:document.referrer||null,country:i.country,city:i.city,region:i.region})}catch(n){console.error("Failed to track page view:",n)}})()},[t,e,r==null?void 0:r.id])},m=()=>{const t=window.Capacitor;if(!t)return!1;if(typeof t.isNativePlatform=="function")return t.isNativePlatform();if(typeof t.isNativePlatform=="boolean")return t.isNativePlatform;if(typeof t.isNative=="boolean")return t.isNative;if(t.getPlatform&&typeof t.getPlatform=="function"){const e=t.getPlatform();return e==="ios"||e==="android"}return!0},w=()=>{if(m())return!1;const t=navigator.userAgent;if(!/iPad|iPhone|iPod/.test(t)||window.navigator.standalone===!0)return!1;if(/FBAN|FBAV|Twitter|Instagram|Line|WeChat|MicroMessenger|QQ|Weibo/i.test(t))return!0;const s=/Safari\//.test(t),n=/CriOS/.test(t),i=/FxiOS/.test(t),a=/EdgiOS/.test(t);if(!s&&!n&&!i&&!a)return!0;const f=/Version\/[\d.]+/.test(t);return!!(s&&!f&&!n&&!i&&!a)},v=()=>{const t=navigator.userAgent,e=/Android/.test(t),r=/wv/.test(t)||/Version\/[\d.]+.*Chrome/.test(t);return e&&r},A=()=>w()||v();export{A as a,w as b,m as i,I as u};
