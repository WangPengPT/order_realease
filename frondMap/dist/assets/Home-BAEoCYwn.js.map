{"version":3,"file":"Home-BAEoCYwn.js","sources":["../../src/components/AskXiaoxiongDialog.tsx","../../src/components/HomeMapSection.tsx","../../src/components/MobileHeroSection.tsx","../../src/hooks/useRecentActivities.ts","../../src/components/RecentActivitiesSection.tsx","../../src/pages/Home.tsx"],"sourcesContent":["import { useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { useXiaoxiongChat, Provider } from \"@/hooks/useXiaoxiongChat\";\r\nimport XiaoxiongChatContent from \"@/components/XiaoxiongChatContent\";\r\nimport { useSiteSettings } from \"@/hooks/useSiteSettings\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\n\r\ninterface AskXiaoxiongDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  provider?: Provider;\r\n}\r\n\r\nconst AskXiaoxiongDialog = ({ open, onOpenChange, provider = \"ask-xiaoxiong\" }: AskXiaoxiongDialogProps) => {\r\n  const { i18n } = useTranslation();\r\n  const navigate = useNavigate();\r\n  const isMobile = useIsMobile();\r\n  const { settings } = useSiteSettings();\r\n  const logoUrl = settings?.logo_url;\r\n  \r\n  const {\r\n    input,\r\n    setInput,\r\n    messages,\r\n    isLoading,\r\n    showLocationDialog,\r\n    setShowLocationDialog,\r\n    pendingMessage,\r\n    setPendingMessage,\r\n    handleSubmit,\r\n    handleKeyDown,\r\n    handleLocationConfirm,\r\n    processMessage,\r\n    abortRequest,\r\n    requestLocation,\r\n  } = useXiaoxiongChat(provider);\r\n\r\n  // On mobile, redirect to full page instead of dialog\r\n  useEffect(() => {\r\n    if (open && isMobile) {\r\n      onOpenChange(false);\r\n      navigate(\"/ask-xiaoxiong\");\r\n    }\r\n  }, [open, isMobile, navigate, onOpenChange]);\r\n\r\n  // Request location on dialog open\r\n  useEffect(() => {\r\n    if (open && !isMobile) {\r\n      requestLocation();\r\n    }\r\n  }, [open, isMobile, requestLocation]);\r\n\r\n  // Cleanup on close\r\n  const handleClose = () => {\r\n    abortRequest();\r\n    onOpenChange(false);\r\n  };\r\n\r\n  const getTitle = () => {\r\n    if (i18n.language === \"zh\") return \"小熊AI助手\";\r\n    if (i18n.language === \"pt\") return \"Assistente IA Xiaoxiong\";\r\n    return \"Xiaoxiong AI Assistant\";\r\n  };\r\n\r\n  // Don't render dialog on mobile (will redirect to page)\r\n  if (isMobile) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"sm:max-w-2xl sm:h-[90vh] sm:max-h-[90vh] flex flex-col p-0 gap-0 overflow-hidden\">\r\n        <DialogHeader className=\"px-4 py-3 shrink-0 border-b\">\r\n          <DialogTitle className=\"text-base font-semibold flex items-center gap-2\">\r\n            {logoUrl && <img src={logoUrl} alt=\"Logo\" className=\"w-8 h-8 rounded-full object-cover\" />}\r\n            {getTitle()}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"flex-1 min-h-0 flex flex-col overflow-hidden\">\r\n          <XiaoxiongChatContent\r\n            messages={messages}\r\n            input={input}\r\n            setInput={setInput}\r\n            isLoading={isLoading}\r\n            showLocationDialog={showLocationDialog}\r\n            setShowLocationDialog={setShowLocationDialog}\r\n            pendingMessage={pendingMessage}\r\n            handleSubmit={handleSubmit}\r\n            handleKeyDown={handleKeyDown}\r\n            handleLocationConfirm={handleLocationConfirm}\r\n            processMessage={processMessage}\r\n            setPendingMessage={setPendingMessage}\r\n            onClose={handleClose}\r\n            showBackButton={false}\r\n            showHeader={false}\r\n            className=\"flex-1\"\r\n          />\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default AskXiaoxiongDialog;\r\n","import { useState, useEffect, useRef } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Card } from \"@/components/ui/card\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\r\nimport { Navigation, Maximize, Minimize, MapPin, Star, MoreHorizontal, Filter, ChevronUp, ChevronDown } from \"lucide-react\";\r\nimport { useRestaurants, useRestaurantTypes } from \"@/hooks/useRestaurants\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { calculateDistance, getUserLocation } from \"@/lib/geolocation\";\r\nimport RestaurantMap from \"@/components/RestaurantMap\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport mapboxgl from \"mapbox-gl\";\r\nimport { useActivities } from \"@/hooks/useActivities\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useActivityRestaurantCounts } from \"@/hooks/useActivityRestaurantCounts\";\r\nimport logoIcon from \"@/assets/xiaoxiong-logo-clean.png\";\r\nimport LocationPermissionDialog from \"@/components/LocationPermissionDialog\";\r\n\r\nconst MapRestaurantTags = ({ restaurant, language }: { \r\n  restaurant: any; \r\n  language: string;\r\n}) => {\r\n  const [visibleCount, setVisibleCount] = useState(999);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  \r\n  const allTags = restaurant.type.slice(0, 3).map((type: string, idx: number) => ({ \r\n    key: `type-${idx}`, \r\n    label: type, \r\n    variant: \"secondary\" as const,\r\n    color: undefined \r\n  }));\r\n  \r\n  useEffect(() => {\r\n    const checkOverflow = () => {\r\n      if (!containerRef.current) return;\r\n      \r\n      const container = containerRef.current;\r\n      const badges = Array.from(container.querySelectorAll('.tag-badge')) as HTMLElement[];\r\n      \r\n      if (badges.length === 0) {\r\n        setTimeout(checkOverflow, 50);\r\n        return;\r\n      }\r\n      \r\n      const firstBadgeTop = badges[0]?.offsetTop;\r\n      let lastVisibleIndex = badges.length;\r\n      \r\n      for (let i = 0; i < badges.length; i++) {\r\n        if (badges[i].offsetTop > firstBadgeTop) {\r\n          lastVisibleIndex = i;\r\n          break;\r\n        }\r\n      }\r\n      \r\n      if (lastVisibleIndex < badges.length) {\r\n        lastVisibleIndex = Math.max(1, lastVisibleIndex - 1);\r\n      }\r\n      \r\n      setVisibleCount(lastVisibleIndex);\r\n    };\r\n    \r\n    setVisibleCount(999);\r\n    const timer = setTimeout(checkOverflow, 100);\r\n    \r\n    window.addEventListener('resize', checkOverflow);\r\n    return () => {\r\n      clearTimeout(timer);\r\n      window.removeEventListener('resize', checkOverflow);\r\n    };\r\n  }, [allTags.length, restaurant.id]);\r\n  \r\n  const visibleTags = allTags.slice(0, visibleCount);\r\n  const hasMore = allTags.length > visibleCount;\r\n  \r\n  return (\r\n    <div className=\"flex items-center gap-2\">\r\n      <div ref={containerRef} className=\"flex gap-1.5 flex-wrap flex-1\">\r\n        {visibleTags.map((tag) => (\r\n          <Badge \r\n            key={tag.key} \r\n            variant={tag.variant}\r\n            className=\"text-xs font-medium whitespace-nowrap tag-badge\"\r\n            style={tag.color ? { backgroundColor: tag.color, color: 'white' } : undefined}\r\n          >\r\n            {tag.label}\r\n          </Badge>\r\n        ))}\r\n      </div>\r\n      {hasMore && (\r\n        <Popover>\r\n          <PopoverTrigger asChild>\r\n            <Button variant=\"ghost\" size=\"sm\" className=\"h-6 px-2 text-muted-foreground hover:text-foreground flex-shrink-0\">\r\n              <MoreHorizontal className=\"h-4 w-4\" />\r\n            </Button>\r\n          </PopoverTrigger>\r\n          <PopoverContent className=\"w-80\">\r\n            <div className=\"flex flex-wrap gap-2\">\r\n              {allTags.map((tag) => (\r\n                <Badge \r\n                  key={tag.key} \r\n                  variant={tag.variant}\r\n                  className=\"text-xs font-medium\"\r\n                  style={tag.color ? { backgroundColor: tag.color, color: 'white' } : undefined}\r\n                >\r\n                  {tag.label}\r\n                </Badge>\r\n              ))}\r\n            </div>\r\n          </PopoverContent>\r\n        </Popover>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst HomeMapSection = () => {\r\n  const navigate = useNavigate();\r\n  const { t, i18n } = useTranslation();\r\n  const { toast } = useToast();\r\n  const { localizeRestaurant } = useLocalizedContent();\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [selectedTypes, setSelectedTypes] = useState<string[]>([]);\r\n  const [selectedActivity, setSelectedActivity] = useState<string | null>(null);\r\n  const [activityRestaurantIds, setActivityRestaurantIds] = useState<string[]>([]);\r\n  const [radiusFilter, setRadiusFilter] = useState<number | null>(null);\r\n  const [userLocation, setUserLocation] = useState<{ lat: number; lng: number } | null>(null);\r\n  const [isFullscreen, setIsFullscreen] = useState(false);\r\n  const [showAllTypes, setShowAllTypes] = useState(false);\r\n  const [showAllActivities, setShowAllActivities] = useState(false);\r\n  const mapRef = useRef<mapboxgl.Map | null>(null);\r\n  const savedMapState = useRef<{ center: [number, number]; zoom: number } | null>(null);\r\n  const restaurantRefs = useRef<{ [key: string]: HTMLDivElement | null }>({});\r\n  const [selectedRestaurantId, setSelectedRestaurantId] = useState<string | null>(null);\r\n  const [showFilters, setShowFilters] = useState(false);\r\n  const [showLocationDialog, setShowLocationDialog] = useState(false);\r\n  const [isMapCollapsed, setIsMapCollapsed] = useState(false);\r\n  const [isMobileListExpanded, setIsMobileListExpanded] = useState(false);\r\n\r\n  const MOBILE_DEFAULT_VISIBLE = 4;\r\n\r\n  const { data: restaurants, isLoading } = useRestaurants(searchQuery, selectedTypes.length > 0 ? selectedTypes.join(',') : undefined);\r\n  const { data: restaurantTypes = [] } = useRestaurantTypes();\r\n  const { data: activities = [] } = useActivities();\r\n  const { data: activityRestaurantCounts = {} } = useActivityRestaurantCounts();\r\n\r\n  const activitiesWithRestaurants = activities.filter(activity => (activityRestaurantCounts[activity.id] || 0) > 0);\r\n\r\n  const handleTypeFilter = (type: string) => {\r\n    setSelectedTypes(prev => {\r\n      if (prev.includes(type)) {\r\n        return prev.filter(t => t !== type);\r\n      } else {\r\n        return [...prev, type];\r\n      }\r\n    });\r\n  };\r\n\r\n  const handleRequestLocation = () => {\r\n    setShowLocationDialog(true);\r\n  };\r\n\r\n  const requestLocation = async () => {\r\n    setShowLocationDialog(false);\r\n    try {\r\n      const position = await getUserLocation();\r\n      setUserLocation({\r\n        lat: position.coords.latitude,\r\n        lng: position.coords.longitude,\r\n      });\r\n      toast({\r\n        title: t(\"restaurants.locationEnabled\"),\r\n        description: t(\"restaurants.sortByDistance\"),\r\n      });\r\n    } catch (error: any) {\r\n      console.error(\"Location error:\", error);\r\n    }\r\n  };\r\n\r\n  const handleRadiusChange = (radius: number | null) => {\r\n    setRadiusFilter(radius);\r\n    if (radius && !userLocation) {\r\n      handleRequestLocation();\r\n    }\r\n  };\r\n\r\n  const handleActivityFilter = async (activityId: string) => {\r\n    if (selectedActivity === activityId) {\r\n      setSelectedActivity(null);\r\n      setActivityRestaurantIds([]);\r\n    } else {\r\n      setSelectedActivity(activityId);\r\n      const { data, error } = await supabase\r\n        .from(\"activity_restaurants\")\r\n        .select(\"restaurant_id\")\r\n        .eq(\"activity_id\", activityId);\r\n      \r\n      if (error) {\r\n        console.error(\"Error fetching activity restaurants:\", error);\r\n        setActivityRestaurantIds([]);\r\n      } else {\r\n        setActivityRestaurantIds(data.map(ar => ar.restaurant_id));\r\n      }\r\n    }\r\n  };\r\n\r\n  const processedRestaurants = restaurants?.map(restaurant => {\r\n    const localized = localizeRestaurant(restaurant);\r\n    if (userLocation) {\r\n      const distance = calculateDistance(\r\n        userLocation.lat,\r\n        userLocation.lng,\r\n        restaurant.lat,\r\n        restaurant.lng\r\n      );\r\n      return { ...localized, distance };\r\n    }\r\n    return localized;\r\n  }) || [];\r\n\r\n  const activityFilteredRestaurants = selectedActivity \r\n    ? processedRestaurants.filter(r => activityRestaurantIds.includes(r.id)) \r\n    : processedRestaurants;\r\n\r\n  const filteredRestaurants = radiusFilter && userLocation\r\n    ? activityFilteredRestaurants\r\n        .filter(r => r.distance && r.distance <= radiusFilter)\r\n        .sort((a, b) => (a.distance || 0) - (b.distance || 0))\r\n    : userLocation \r\n      ? activityFilteredRestaurants.sort((a, b) => (a.distance || 0) - (b.distance || 0))\r\n      : activityFilteredRestaurants.sort((a, b) => (b.rating || 0) - (a.rating || 0));\r\n\r\n  const handleRestaurantClick = (restaurant: any) => {\r\n    navigate(`/restaurant/${restaurant.id}`);\r\n  };\r\n\r\n  const handleMarkerClick = (restaurant: any) => {\r\n    setSelectedRestaurantId(restaurant.id);\r\n    \r\n    const restaurantElement = restaurantRefs.current[restaurant.id];\r\n    if (restaurantElement) {\r\n      restaurantElement.scrollIntoView({ \r\n        behavior: 'smooth', \r\n        block: 'center'\r\n      });\r\n    }\r\n  };\r\n\r\n  const toggleFullscreen = () => {\r\n    const mapContainer = document.getElementById('home-map-container');\r\n    if (!mapContainer) return;\r\n\r\n    if (!isFullscreen) {\r\n      if (mapRef.current) {\r\n        const center = mapRef.current.getCenter();\r\n        const zoom = mapRef.current.getZoom();\r\n        savedMapState.current = { center: [center.lng, center.lat], zoom };\r\n      }\r\n      if (mapContainer.requestFullscreen) {\r\n        mapContainer.requestFullscreen();\r\n      }\r\n    } else {\r\n      if (document.exitFullscreen) {\r\n        document.exitFullscreen();\r\n      }\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const handleFullscreenChange = () => {\r\n      const isNowFullscreen = !!document.fullscreenElement;\r\n      setIsFullscreen(isNowFullscreen);\r\n      \r\n      if (!isNowFullscreen && savedMapState.current && mapRef.current) {\r\n        setTimeout(() => {\r\n          mapRef.current?.jumpTo({\r\n            center: savedMapState.current!.center,\r\n            zoom: savedMapState.current!.zoom,\r\n          });\r\n        }, 100);\r\n      }\r\n    };\r\n\r\n    document.addEventListener('fullscreenchange', handleFullscreenChange);\r\n    return () => {\r\n      document.removeEventListener('fullscreenchange', handleFullscreenChange);\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"animate-fade-in\">\r\n      {/* Header - Left aligned */}\r\n      <div className=\"text-left mb-6\">\r\n        <h2 className=\"text-xl sm:text-2xl font-bold text-foreground mb-2 sm:mb-3\">\r\n          {t(\"nav.mapView\")}\r\n        </h2>\r\n        <p className=\"text-sm sm:text-base text-muted-foreground\">{t(\"map.subtitle\")}</p>\r\n      </div>\r\n        \r\n      {/* Search and Filters - Left aligned */}\r\n      <div className=\"mb-6 space-y-4\">\r\n        <div className=\"flex flex-col md:flex-row gap-3\">\r\n          <div className=\"flex-1 max-w-md\">\r\n            <Input\r\n              placeholder={t(\"restaurants.search\")}\r\n              value={searchQuery}\r\n              onChange={(e) => setSearchQuery(e.target.value)}\r\n              className=\"h-11 bg-background/60 backdrop-blur-sm border-primary/20 focus:border-primary\"\r\n            />\r\n          </div>\r\n          \r\n          <div className=\"flex gap-2 md:contents\">\r\n            <Button\r\n              variant={userLocation ? \"default\" : \"outline\"}\r\n              onClick={userLocation ? undefined : handleRequestLocation}\r\n              className=\"flex-1 md:flex-initial gap-2 h-11 md:px-6\"\r\n            >\r\n              <Navigation className={`w-4 h-4 ${userLocation ? 'animate-pulse' : ''}`} />\r\n              <span className=\"md:hidden\">{t(\"restaurants.getLocationMobile\")}</span>\r\n              <span className=\"hidden md:inline\">{userLocation ? t(\"restaurants.locationEnabled\") : t(\"restaurants.getLocation\")}</span>\r\n            </Button>\r\n\r\n            <Button\r\n              variant={showFilters ? \"default\" : \"outline\"}\r\n              onClick={() => setShowFilters(!showFilters)}\r\n              className=\"flex-1 md:flex-initial gap-2 h-11 md:px-6\"\r\n            >\r\n              <Filter className=\"w-4 h-4\" />\r\n              {t(\"restaurants.filter\")}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Filters Container */}\r\n        {showFilters && (\r\n          <div className=\"space-y-3 bg-card/50 backdrop-blur-sm rounded-lg p-4 border border-border/50 animate-fade-in\">\r\n            {/* Type Filters Section */}\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex items-center gap-2 flex-wrap\">\r\n                <span className=\"text-sm font-semibold text-foreground\">{t(\"restaurants.restaurantTypes\")}:</span>\r\n                {selectedTypes.length > 0 && (\r\n                  <Badge\r\n                    variant=\"outline\"\r\n                    className=\"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5\"\r\n                    onClick={() => setSelectedTypes([])}>\r\n                    {t(\"common.actions.clearFilter\")}\r\n                  </Badge>\r\n                )}\r\n                {restaurantTypes.length > 8 && (\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className=\"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200\"\r\n                    onClick={() => setShowAllTypes(!showAllTypes)}\r\n                  >\r\n                    {showAllTypes ? t(\"common.showLess\") : t(\"common.showMore\")}\r\n                  </Button>\r\n                )}\r\n              </div>\r\n              <div className=\"relative overflow-hidden\">\r\n                <div className={`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${showAllTypes ? 'animate-expand-height' : ''}`}>\r\n                  {(showAllTypes ? restaurantTypes : restaurantTypes.slice(0, 8)).map((type, index) => (\r\n                    <Badge\r\n                      key={type}\r\n                      variant={selectedTypes.includes(type) ? \"default\" : \"secondary\"}\r\n                      className={`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${selectedTypes.includes(type) ? 'ring-2 ring-primary/30 shadow-sm' : ''}`}\r\n                      style={{ animationDelay: `${index * 30}ms` }}\r\n                      onClick={() => handleTypeFilter(type)}\r\n                    >\r\n                      {type}\r\n                    </Badge>\r\n                  ))}\r\n                </div>\r\n                <div className=\"sm:hidden relative -mx-1 px-1\">\r\n                  <div className=\"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth\">\r\n                    {restaurantTypes.map((type, index) => (\r\n                      <Badge\r\n                        key={type}\r\n                        variant={selectedTypes.includes(type) ? \"default\" : \"secondary\"}\r\n                        className={`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${selectedTypes.includes(type) ? 'ring-2 ring-primary/30 shadow-sm' : ''}`}\r\n                        style={{ animationDelay: `${index * 30}ms` }}\r\n                        onClick={() => handleTypeFilter(type)}\r\n                      >\r\n                        {type}\r\n                      </Badge>\r\n                    ))}\r\n                  </div>\r\n                  <div className=\"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none\" />\r\n                  <div className=\"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none\" />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Activity Filters Section */}\r\n            {activitiesWithRestaurants.length > 0 && (\r\n              <div className=\"space-y-2 pt-1 border-t border-border/30\">\r\n                <div className=\"flex items-center gap-2 flex-wrap\">\r\n                  <span className=\"text-sm font-semibold text-foreground\">{t(\"nav.activities\")}:</span>\r\n                  {selectedActivity && (\r\n                    <Badge\r\n                      variant=\"outline\"\r\n                      className=\"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5\"\r\n                      onClick={() => {\r\n                        setSelectedActivity(null);\r\n                        setActivityRestaurantIds([]);\r\n                      }}>\r\n                      {t(\"common.actions.clearFilter\")}\r\n                    </Badge>\r\n                  )}\r\n                  {activitiesWithRestaurants.length > 8 && (\r\n                    <Button\r\n                      variant=\"ghost\"\r\n                      size=\"sm\"\r\n                      className=\"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200\"\r\n                      onClick={() => setShowAllActivities(!showAllActivities)}\r\n                    >\r\n                      {showAllActivities ? t(\"common.showLess\") : t(\"common.showMore\")}\r\n                    </Button>\r\n                  )}\r\n                </div>\r\n                <div className=\"relative overflow-hidden\">\r\n                  <div className={`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${showAllActivities ? 'animate-expand-height' : ''}`}>\r\n                    {(showAllActivities ? activitiesWithRestaurants : activitiesWithRestaurants.slice(0, 8)).map((activity, index) => {\r\n                      const activityLabel = i18n.language === 'zh' \r\n                        ? (activity.badge_text_zh || activity.title_zh)\r\n                        : i18n.language === 'pt' \r\n                        ? (activity.badge_text_pt || activity.title_pt)\r\n                        : (activity.badge_text_en || activity.title_en);\r\n                      return (\r\n                        <Badge\r\n                          key={activity.id}\r\n                          variant={selectedActivity === activity.id ? \"default\" : \"secondary\"}\r\n                          className={`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${selectedActivity === activity.id ? 'ring-2 ring-primary/30 shadow-sm' : ''}`}\r\n                          style={{ animationDelay: `${index * 30}ms` }}\r\n                          onClick={() => handleActivityFilter(activity.id)}\r\n                        >\r\n                          {activityLabel}\r\n                        </Badge>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                  <div className=\"sm:hidden relative -mx-1 px-1\">\r\n                    <div className=\"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth\">\r\n                      {activitiesWithRestaurants.map((activity, index) => {\r\n                        const activityLabel = i18n.language === 'zh' \r\n                          ? (activity.badge_text_zh || activity.title_zh)\r\n                          : i18n.language === 'pt' \r\n                          ? (activity.badge_text_pt || activity.title_pt)\r\n                          : (activity.badge_text_en || activity.title_en);\r\n                        return (\r\n                          <Badge\r\n                            key={activity.id}\r\n                            variant={selectedActivity === activity.id ? \"default\" : \"secondary\"}\r\n                            className={`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${selectedActivity === activity.id ? 'ring-2 ring-primary/30 shadow-sm' : ''}`}\r\n                            style={{ animationDelay: `${index * 30}ms` }}\r\n                            onClick={() => handleActivityFilter(activity.id)}\r\n                          >\r\n                            {activityLabel}\r\n                          </Badge>\r\n                        );\r\n                      })}\r\n                    </div>\r\n                    <div className=\"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none\" />\r\n                    <div className=\"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none\" />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Radius Filter */}\r\n        {userLocation && (\r\n          <div className=\"flex gap-2 flex-wrap items-center bg-muted/30 backdrop-blur-sm rounded-lg p-3 border border-primary/10\">\r\n            <span className=\"text-sm font-semibold text-primary\">{t(\"restaurants.radius\")}:</span>\r\n            <Badge\r\n              variant={radiusFilter === null ? \"default\" : \"secondary\"}\r\n              className=\"cursor-pointer hover:scale-105 transition-transform\"\r\n              onClick={() => handleRadiusChange(null)}\r\n            >\r\n              {t(\"restaurants.allRestaurants\")}\r\n            </Badge>\r\n            <Badge\r\n              variant={radiusFilter === 5 ? \"default\" : \"secondary\"}\r\n              className=\"cursor-pointer hover:scale-105 transition-transform\"\r\n              onClick={() => handleRadiusChange(5)}\r\n            >\r\n              {t(\"restaurants.radius5km\")}\r\n            </Badge>\r\n            <Badge\r\n              variant={radiusFilter === 10 ? \"default\" : \"secondary\"}\r\n              className=\"cursor-pointer hover:scale-105 transition-transform\"\r\n              onClick={() => handleRadiusChange(10)}\r\n            >\r\n              {t(\"restaurants.radius10km\")}\r\n            </Badge>\r\n            <Badge\r\n              variant={radiusFilter === 20 ? \"default\" : \"secondary\"}\r\n              className=\"cursor-pointer hover:scale-105 transition-transform\"\r\n              onClick={() => handleRadiusChange(20)}\r\n            >\r\n              {t(\"restaurants.radius20km\")}\r\n            </Badge>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Map and List Layout */}\r\n      {!isLoading && filteredRestaurants && (\r\n        <div className=\"flex flex-col lg:flex-row gap-6\">\r\n          {/* Map */}\r\n          <div className={`w-full lg:flex-1 transition-all duration-300 ease-in-out ${isMapCollapsed ? 'h-0 overflow-hidden lg:h-[500px]' : 'h-[400px] lg:h-[500px]'}`}>\r\n            <div id=\"home-map-container\" className={`${isFullscreen ? 'fixed inset-0 z-50 bg-background' : 'w-full h-full'} rounded-xl overflow-hidden shadow-2xl border border-primary/10 relative group`}>\r\n              <Button\r\n                variant=\"secondary\"\r\n                size=\"icon\"\r\n                className=\"absolute bottom-4 right-4 z-10 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                onClick={toggleFullscreen}\r\n              >\r\n                {isFullscreen ? (\r\n                  <Minimize className=\"w-5 h-5\" />\r\n                ) : (\r\n                  <Maximize className=\"w-5 h-5\" />\r\n                )}\r\n              </Button>\r\n              <div className=\"h-full relative\">\r\n                <RestaurantMap\r\n                  restaurants={filteredRestaurants}\r\n                  onRestaurantClick={handleRestaurantClick}\r\n                  userLocation={userLocation}\r\n                  radiusFilter={radiusFilter}\r\n                  onMarkerClick={handleMarkerClick}\r\n                  showViewDetailsButton={true}\r\n                  onMapInit={(mapInstance) => {\r\n                    mapRef.current = mapInstance;\r\n                  }}\r\n                />\r\n                <div className=\"absolute bottom-4 left-4 z-10 pointer-events-none flex items-center gap-2 bg-background/80 backdrop-blur-sm px-3 py-2 rounded-full shadow-lg\">\r\n                  <img \r\n                    src={logoIcon} \r\n                    alt=\"Xiaoxiong Market Logo\" \r\n                    className=\"h-6 w-6 object-contain\"\r\n                  />\r\n                  <span className=\"text-sm font-semibold text-foreground whitespace-nowrap\">\r\n                    {i18n.language === 'zh' ? '小熊市场' : 'Xiaoxiong Market'}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Mobile Map Toggle Button */}\r\n          <Button\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            className=\"lg:hidden flex items-center justify-center gap-2 -mt-3 mb-1\"\r\n            onClick={() => setIsMapCollapsed(!isMapCollapsed)}\r\n          >\r\n            {isMapCollapsed ? (\r\n              <>\r\n                <ChevronDown className=\"w-4 h-4\" />\r\n                {t(\"map.showMap\")}\r\n              </>\r\n            ) : (\r\n              <>\r\n                <ChevronUp className=\"w-4 h-4\" />\r\n                {t(\"map.hideMap\")}\r\n              </>\r\n            )}\r\n          </Button>\r\n\r\n          {/* Restaurant List Sidebar */}\r\n          <div className=\"w-full lg:w-[420px] flex flex-col\">\r\n            <div className=\"mb-4 pb-4 border-b border-border\">\r\n              <h2 className=\"text-xl sm:text-2xl font-bold text-foreground flex items-center gap-2\">\r\n                <MapPin className=\"w-6 h-6 text-primary\" />\r\n                {t(\"restaurants.title\")}\r\n                <Badge variant=\"secondary\" className=\"ml-2\">{filteredRestaurants.length}</Badge>\r\n              </h2>\r\n              {userLocation && (\r\n                <p className=\"text-sm text-muted-foreground mt-2 flex items-center gap-1.5\">\r\n                  <Navigation className=\"w-4 h-4\" />\r\n                  {t(\"restaurants.sortedByDistance\")}\r\n                </p>\r\n              )}\r\n            </div>\r\n            \r\n            {filteredRestaurants.length === 0 ? (\r\n              <div className=\"flex flex-col items-center justify-center py-12 text-center\">\r\n                <MapPin className=\"w-16 h-16 text-muted-foreground/40 mb-4\" />\r\n                <h3 className=\"text-xl font-semibold text-foreground mb-2\">\r\n                  {t(\"restaurants.noResults\")}\r\n                </h3>\r\n                <p className=\"text-muted-foreground max-w-xs\">\r\n                  {t(\"restaurants.noResultsDesc\")}\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              <>\r\n                <div className=\"lg:hidden space-y-3 pb-4\">\r\n                  {(isMobileListExpanded \r\n                    ? filteredRestaurants \r\n                    : filteredRestaurants.slice(0, MOBILE_DEFAULT_VISIBLE)\r\n                  ).map((restaurant) => (\r\n                    <Card\r\n                      key={restaurant.id}\r\n                      ref={(el) => restaurantRefs.current[restaurant.id] = el}\r\n                      className={`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${\r\n                        selectedRestaurantId === restaurant.id \r\n                          ? 'border-primary ring-2 ring-primary ring-offset-2' \r\n                          : 'border-transparent'\r\n                      }`}\r\n                      onClick={() => handleRestaurantClick(restaurant)}\r\n                    >\r\n                      <div className=\"flex flex-col gap-3\">\r\n                        <div className=\"flex items-start justify-between gap-2\">\r\n                          <div className=\"flex flex-col gap-2\">\r\n                            <h3 className=\"font-bold text-lg text-foreground line-clamp-1 flex-1\">\r\n                              {restaurant.name}\r\n                            </h3>\r\n                            {restaurant.distance !== undefined && (\r\n                              <div className=\"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full w-fit\">\r\n                                <Navigation className=\"w-4 h-4 text-primary\" />\r\n                                <span className=\"font-bold text-sm text-primary\">\r\n                                  {restaurant.distance < 1 \r\n                                    ? `${(restaurant.distance * 1000).toFixed(0)} m` \r\n                                    : `${restaurant.distance.toFixed(1)} km`}\r\n                                </span>\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                          {restaurant.rating > 0 && (\r\n                            <div className=\"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full flex-shrink-0\">\r\n                              <Star className=\"w-4 h-4\" style={{ fill: '#016450', color: '#016450' }} />\r\n                              <span className=\"font-bold text-sm text-primary\">{restaurant.rating}</span>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                        \r\n                        {restaurant.type && restaurant.type.length > 0 && (\r\n                          <MapRestaurantTags \r\n                            restaurant={restaurant} \r\n                            language={i18n.language}\r\n                          />\r\n                        )}\r\n                        \r\n                        <div className=\"flex items-start gap-2 text-sm text-muted-foreground\">\r\n                          <MapPin className=\"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60\" />\r\n                          <span className=\"line-clamp-2\">{restaurant.address}</span>\r\n                        </div>\r\n                      </div>\r\n                    </Card>\r\n                  ))}\r\n                  \r\n                  {filteredRestaurants.length > MOBILE_DEFAULT_VISIBLE && (\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      className=\"w-full mt-2 gap-2\"\r\n                      onClick={() => setIsMobileListExpanded(!isMobileListExpanded)}\r\n                    >\r\n                      {isMobileListExpanded ? (\r\n                        <>\r\n                          <ChevronUp className=\"w-4 h-4\" />\r\n                          {t(\"map.collapseList\")}\r\n                        </>\r\n                      ) : (\r\n                        <>\r\n                          <ChevronDown className=\"w-4 h-4\" />\r\n                          {t(\"map.showAllRestaurants\", { count: filteredRestaurants.length })}\r\n                        </>\r\n                      )}\r\n                    </Button>\r\n                  )}\r\n                </div>\r\n                \r\n                <ScrollArea className=\"hidden lg:block h-[420px] pr-4\">\r\n                  <div className=\"space-y-3 pb-4\">\r\n                    {filteredRestaurants.map((restaurant) => (\r\n                      <Card\r\n                        key={restaurant.id}\r\n                        ref={(el) => restaurantRefs.current[restaurant.id] = el}\r\n                        className={`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${\r\n                          selectedRestaurantId === restaurant.id \r\n                            ? 'border-primary ring-2 ring-primary ring-offset-2' \r\n                            : 'border-transparent'\r\n                        }`}\r\n                        onClick={() => handleRestaurantClick(restaurant)}\r\n                      >\r\n                        <div className=\"flex flex-col gap-3\">\r\n                          <div className=\"flex items-start justify-between gap-2\">\r\n                            <div className=\"flex flex-col gap-2\">\r\n                              <h3 className=\"font-bold text-lg text-foreground line-clamp-1 flex-1\">\r\n                                {restaurant.name}\r\n                              </h3>\r\n                              {restaurant.distance !== undefined && (\r\n                                <div className=\"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full w-fit\">\r\n                                  <Navigation className=\"w-4 h-4 text-primary\" />\r\n                                  <span className=\"font-bold text-sm text-primary\">\r\n                                    {restaurant.distance < 1 \r\n                                      ? `${(restaurant.distance * 1000).toFixed(0)} m` \r\n                                      : `${restaurant.distance.toFixed(1)} km`}\r\n                                  </span>\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                            {restaurant.rating > 0 && (\r\n                              <div className=\"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full flex-shrink-0\">\r\n                                <Star className=\"w-4 h-4\" style={{ fill: '#016450', color: '#016450' }} />\r\n                                <span className=\"font-bold text-sm text-primary\">{restaurant.rating}</span>\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        \r\n                          {restaurant.type && restaurant.type.length > 0 && (\r\n                            <MapRestaurantTags \r\n                              restaurant={restaurant} \r\n                              language={i18n.language}\r\n                            />\r\n                          )}\r\n                          \r\n                          <div className=\"flex items-start gap-2 text-sm text-muted-foreground\">\r\n                            <MapPin className=\"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60\" />\r\n                            <span className=\"line-clamp-2\">{restaurant.address}</span>\r\n                          </div>\r\n                        </div>\r\n                      </Card>\r\n                    ))}\r\n                  </div>\r\n                </ScrollArea>\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <LocationPermissionDialog\r\n        open={showLocationDialog}\r\n        onOpenChange={setShowLocationDialog}\r\n        onConfirm={requestLocation}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default HomeMapSection;\r\n","import { memo, useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { ShoppingBag, CalendarCheck, MessageCircle, Search, Info } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport mapIcon from \"@/assets/map-icon.png\";\r\nimport { useActiveHomepageTemplates } from \"@/hooks/useHomepageTemplates\";\r\nimport { useNavigationSettings } from \"@/hooks/useNavigationSettings\";\r\nimport { useSiteSettings } from \"@/hooks/useSiteSettings\";\r\nimport { openExternalUrl } from \"@/lib/externalLinks\";\r\nimport ExternalLinkConfirmDialog from \"@/components/ExternalLinkConfirmDialog\";\r\n\r\ninterface MobileHeroSectionProps {\r\n  stats: { order_count: number; reserve_count: number } | null;\r\n  onAskXiaoxiong: () => void;\r\n}\r\n\r\nconst MobileHeroSection = memo(({ stats, onAskXiaoxiong }: MobileHeroSectionProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const { data: templates } = useActiveHomepageTemplates();\r\n  const { buttons } = useNavigationSettings();\r\n  const { settings } = useSiteSettings();\r\n  const currentLang = i18n.language;\r\n  \r\n  // State for external link confirmation dialog\r\n  const [showExternalLinkDialog, setShowExternalLinkDialog] = useState(false);\r\n  \r\n  // Check if About Us button should be shown\r\n  const showAboutUsButton = settings?.about_us_button_mobile !== false;\r\n\r\n  // Find demo button from navigation settings\r\n  const demoButton = buttons?.find(\r\n    (btn) => btn.label_zh === \"演示\" || btn.link?.includes(\"v.xiaoxiong.pt\")\r\n  );\r\n\r\n  // Check if demo button should be shown\r\n  const showDemoButton = demoButton && \r\n    demoButton.enabled !== false && \r\n    demoButton.visible !== false && \r\n    demoButton.show_on_mobile !== false;\r\n\r\n  // Get localized demo button label\r\n  const getDemoLabel = () => {\r\n    if (!demoButton) return t(\"home.hero.demo\", \"前往演示\");\r\n    if (currentLang === \"zh\") return demoButton.label_zh;\r\n    if (currentLang === \"pt\") return demoButton.label_pt;\r\n    return demoButton.label_en;\r\n  };\r\n\r\n  // Get localized text from active template\r\n  const getLocalizedText = (field: string) => {\r\n    if (!templates || templates.length === 0) return \"\";\r\n    const template = templates[0];\r\n    const langSuffix = currentLang === \"zh\" ? \"_zh\" : currentLang === \"pt\" ? \"_pt\" : \"_en\";\r\n    return (template as any)[`${field}${langSuffix}`] || \"\";\r\n  };\r\n\r\n  const title = getLocalizedText(\"title\") || t(\"home.hero.title\");\r\n  const description = getLocalizedText(\"description\") || t(\"home.hero.description\");\r\n  const chatButtonText = getLocalizedText(\"subtitle_button_text\") || t(\"home.hero.subtitle\");\r\n\r\n  // Handle demo button click - show confirmation dialog\r\n  const handleDemoClick = () => {\r\n    setShowExternalLinkDialog(true);\r\n  };\r\n\r\n  // Handle confirmation - open external URL with iOS WebView compatibility\r\n  const handleConfirmExternalLink = () => {\r\n    if (demoButton?.link) {\r\n      openExternalUrl(demoButton.link);\r\n    }\r\n    setShowExternalLinkDialog(false);\r\n  };\r\n\r\n  return (\r\n    <section className=\"min-h-[55vh] flex flex-col bg-secondary/20\">\r\n      {/* Header Area - Brand + Demo Button */}\r\n      <div className=\"pt-20 px-4\">\r\n        {/* Top Row: Brand Name + Demo Button */}\r\n        <div className=\"flex items-center justify-between mb-3\">\r\n          {/* Brand Name with Icon */}\r\n          <div className=\"flex items-center gap-2\">\r\n            <span className=\"text-xl font-bold text-foreground\">\r\n              {t(\"home.hero.brandName\")}\r\n            </span>\r\n            <img \r\n              src={mapIcon} \r\n              alt=\"map icon\" \r\n              width={28}\r\n              height={28}\r\n              loading=\"eager\"\r\n              decoding=\"async\"\r\n              className=\"w-7 h-7 object-contain flex-shrink-0\" \r\n            />\r\n          </div>\r\n\r\n          {/* About Us Button */}\r\n          {showAboutUsButton && (\r\n            <Link\r\n              to=\"/about-us\"\r\n              className=\"flex items-center gap-1.5 px-3 py-1.5 text-sm bg-background/80 backdrop-blur-sm rounded-full border border-border/50 shadow-sm hover:bg-background transition-colors\"\r\n            >\r\n              <Info className=\"w-4 h-4 text-primary\" />\r\n              <span className=\"text-foreground/80\">\r\n                {t(\"nav.aboutUs\", \"关于我们\")}\r\n              </span>\r\n            </Link>\r\n          )}\r\n        </div>\r\n\r\n        {/* Stats Row: Delivery + Booking */}\r\n        {stats && (\r\n          <div className=\"flex items-center gap-4\">\r\n            <div className=\"flex items-center gap-1.5\">\r\n              <ShoppingBag className=\"w-4 h-4 text-primary\" />\r\n              <span className=\"text-sm text-muted-foreground\">{t(\"home.stats.delivery\")}</span>\r\n              <span className=\"font-bold text-foreground text-sm\">{stats.order_count}</span>\r\n            </div>\r\n            <div className=\"flex items-center gap-1.5\">\r\n              <CalendarCheck className=\"w-4 h-4 text-accent\" />\r\n              <span className=\"text-sm text-muted-foreground\">{t(\"home.stats.reservation\")}</span>\r\n              <span className=\"font-bold text-foreground text-sm\">{stats.reserve_count}</span>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Content Area - Title, Description, Chat Button */}\r\n      <div className=\"flex-1 flex flex-col items-center justify-center px-4 py-8\">\r\n        <div className=\"max-w-md mx-auto text-center space-y-4\">\r\n          {/* Title */}\r\n          <h1 className=\"text-2xl sm:text-3xl font-bold text-foreground leading-tight\">\r\n            {title}\r\n          </h1>\r\n          \r\n          {/* Description */}\r\n          <p className=\"text-sm sm:text-base text-muted-foreground max-w-sm mx-auto\">\r\n            {description}\r\n          </p>\r\n          \r\n          {/* Chat Button - Ask Xiaoxiong */}\r\n          <div className=\"pt-4\">\r\n            <button \r\n              onClick={onAskXiaoxiong}\r\n              className=\"group flex items-center gap-3 bg-secondary/50 backdrop-blur-sm text-foreground px-5 py-3.5 rounded-full shadow-sm hover:shadow-md hover:bg-secondary/70 transition-all duration-300 cursor-text border border-border/50 mx-auto\"\r\n            >\r\n              <MessageCircle className=\"w-5 h-5 text-primary group-hover:text-primary/80 transition-colors\" />\r\n              <span className=\"text-sm text-muted-foreground group-hover:text-foreground transition-colors\">\r\n                {chatButtonText}\r\n              </span>\r\n              <Search className=\"w-4 h-4 text-muted-foreground/60 ml-2\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* External Link Confirmation Dialog */}\r\n      <ExternalLinkConfirmDialog\r\n        open={showExternalLinkDialog}\r\n        onOpenChange={setShowExternalLinkDialog}\r\n        onConfirm={handleConfirmExternalLink}\r\n        url={demoButton?.link}\r\n      />\r\n    </section>\r\n  );\r\n});\r\n\r\nMobileHeroSection.displayName = \"MobileHeroSection\";\r\n\r\nexport default MobileHeroSection;\r\n","import { useMemo } from \"react\";\r\nimport { useActivities, Activity, ActivityCreator } from \"@/hooks/useActivities\";\r\nimport { addDays, isSameDay, getDay, getDate, getMonth, startOfDay } from \"date-fns\";\r\n\r\n// Extended Activity type with creator\r\ntype ActivityWithExtras = Activity & { creator: ActivityCreator; share_count?: number };\r\n\r\ninterface DateRange {\r\n  start: number;\r\n  end: number;\r\n}\r\n\r\n// Type guard to check if value is a valid DateRange array\r\nconst isDateRangeArray = (value: unknown): value is DateRange[] => {\r\n  if (!value || !Array.isArray(value)) return false;\r\n  return value.every(item => \r\n    typeof item === 'object' && \r\n    item !== null &&\r\n    'start' in item && \r\n    'end' in item &&\r\n    typeof item.start === 'number' &&\r\n    typeof item.end === 'number'\r\n  );\r\n};\r\n\r\n// Check if activity is valid on a specific date\r\nconst isActivityValidOnDate = (activity: ActivityWithExtras, targetDate: Date): boolean => {\r\n  const startDate = startOfDay(new Date(activity.start_date));\r\n  const endDate = activity.end_date ? startOfDay(new Date(activity.end_date)) : null;\r\n  const target = startOfDay(targetDate);\r\n  \r\n  // Check if within valid period\r\n  if (target < startDate) return false;\r\n  if (endDate && target > endDate) return false;\r\n  \r\n  const repeatMode = activity.repeat_mode || \"none\";\r\n  \r\n  switch (repeatMode) {\r\n    case \"none\":\r\n      // Only valid on start date\r\n      return isSameDay(startDate, target);\r\n      \r\n    case \"daily\":\r\n      // Valid every day\r\n      return true;\r\n      \r\n    case \"weekly\":\r\n      // Check weekday (0-6, Sunday = 0)\r\n      const targetWeekday = getDay(target);\r\n      // Need to fetch repeat_weekday from the raw data\r\n      const weekday = (activity as any).repeat_weekday;\r\n      return weekday === targetWeekday;\r\n      \r\n    case \"monthly\":\r\n      // Check day of month ranges\r\n      const targetDayOfMonth = getDate(target);\r\n      const monthRanges = (activity as any).repeat_month_day;\r\n      if (!isDateRangeArray(monthRanges)) return false;\r\n      return monthRanges.some(range => \r\n        targetDayOfMonth >= range.start && targetDayOfMonth <= range.end\r\n      );\r\n      \r\n    case \"yearly\":\r\n      // Check month and day of year\r\n      const targetMonth = getMonth(target) + 1; // 1-12\r\n      const targetDay = getDate(target);\r\n      const yearlyMonth = (activity as any).repeat_yearly_month;\r\n      const yearlyDay = (activity as any).repeat_yearly_day;\r\n      return yearlyMonth === targetMonth && yearlyDay === targetDay;\r\n             \r\n    default:\r\n      return false;\r\n  }\r\n};\r\n\r\n// Get sort weight for activity (lower = higher priority)\r\nconst getActivitySortWeight = (activity: ActivityWithExtras): number => {\r\n  const repeatMode = activity.repeat_mode || \"none\";\r\n  switch (repeatMode) {\r\n    case \"none\": return 0;      // Dated activities first\r\n    case \"weekly\": return 1;\r\n    case \"monthly\": return 2;\r\n    case \"yearly\": return 3;\r\n    case \"daily\": return 4;     // Daily activities last\r\n    default: return 5;\r\n  }\r\n};\r\n\r\nexport interface ActivityWithDayLabel extends ActivityWithExtras {\r\n  dayLabel: \"today\" | \"tomorrow\" | \"dayAfterTomorrow\";\r\n}\r\n\r\nexport const useRecentActivities = () => {\r\n  const { data: activities, isLoading } = useActivities();\r\n  \r\n  const recentActivities = useMemo(() => {\r\n    if (!activities) return { today: [], tomorrow: [], dayAfterTomorrow: [] };\r\n    \r\n    const today = new Date();\r\n    const tomorrow = addDays(today, 1);\r\n    const dayAfterTomorrow = addDays(today, 2);\r\n    \r\n    const filterAndSort = (date: Date): ActivityWithExtras[] => {\r\n      return activities\r\n        .filter(a => a.visible && a.status === \"published\")\r\n        .filter(a => isActivityValidOnDate(a, date))\r\n        .sort((a, b) => {\r\n          // Sort by type weight first\r\n          const weightDiff = getActivitySortWeight(a) - getActivitySortWeight(b);\r\n          if (weightDiff !== 0) return weightDiff;\r\n          \r\n          // Then by pinned and sort_order\r\n          if (a.pinned !== b.pinned) return a.pinned ? -1 : 1;\r\n          return (a.sort_order || 0) - (b.sort_order || 0);\r\n        });\r\n    };\r\n    \r\n    return {\r\n      today: filterAndSort(today),\r\n      tomorrow: filterAndSort(tomorrow),\r\n      dayAfterTomorrow: filterAndSort(dayAfterTomorrow),\r\n    };\r\n  }, [activities]);\r\n  \r\n  // Combine all recent activities (deduplicated, with day label)\r\n  const allRecentActivities = useMemo((): ActivityWithDayLabel[] => {\r\n    const seen = new Set<string>();\r\n    const combined: ActivityWithDayLabel[] = [];\r\n    \r\n    // Add today's activities\r\n    recentActivities.today.forEach(activity => {\r\n      if (!seen.has(activity.id)) {\r\n        seen.add(activity.id);\r\n        combined.push({ ...activity, dayLabel: \"today\" });\r\n      }\r\n    });\r\n    \r\n    // Add tomorrow's activities\r\n    recentActivities.tomorrow.forEach(activity => {\r\n      if (!seen.has(activity.id)) {\r\n        seen.add(activity.id);\r\n        combined.push({ ...activity, dayLabel: \"tomorrow\" });\r\n      }\r\n    });\r\n    \r\n    // Add day after tomorrow's activities\r\n    recentActivities.dayAfterTomorrow.forEach(activity => {\r\n      if (!seen.has(activity.id)) {\r\n        seen.add(activity.id);\r\n        combined.push({ ...activity, dayLabel: \"dayAfterTomorrow\" });\r\n      }\r\n    });\r\n    \r\n    // Sort combined list\r\n    return combined.sort((a, b) => {\r\n      const weightDiff = getActivitySortWeight(a) - getActivitySortWeight(b);\r\n      if (weightDiff !== 0) return weightDiff;\r\n      if (a.pinned !== b.pinned) return a.pinned ? -1 : 1;\r\n      return (a.sort_order || 0) - (b.sort_order || 0);\r\n    });\r\n  }, [recentActivities]);\r\n  \r\n  return {\r\n    recentActivities,\r\n    allRecentActivities,\r\n    isLoading,\r\n    hasActivities: allRecentActivities.length > 0,\r\n  };\r\n};\r\n","import { memo, useMemo, useState, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { ArrowRight, Calendar, UtensilsCrossed, ShoppingBag } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { useRecentActivities, ActivityWithDayLabel } from \"@/hooks/useRecentActivities\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\n// Get responsive display count based on window width\r\nconst useResponsiveCount = () => {\r\n  const [count, setCount] = useState(4);\r\n  \r\n  useEffect(() => {\r\n    const updateCount = () => {\r\n      const width = window.innerWidth;\r\n      if (width < 640) {\r\n        setCount(2);\r\n      } else if (width < 1024) {\r\n        setCount(3);\r\n      } else {\r\n        setCount(4);\r\n      }\r\n    };\r\n    \r\n    updateCount();\r\n    window.addEventListener(\"resize\", updateCount);\r\n    return () => window.removeEventListener(\"resize\", updateCount);\r\n  }, []);\r\n  \r\n  return count;\r\n};\r\n\r\n// Activity Card Component\r\nconst ActivityCard = memo(({ \r\n  activity, \r\n  dayLabel \r\n}: { \r\n  activity: ActivityWithDayLabel; \r\n  dayLabel: string;\r\n}) => {\r\n  const navigate = useNavigate();\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  \r\n  const title = getLocalizedField(activity, \"title\");\r\n  \r\n  const serviceTypeLabel = useMemo(() => {\r\n    switch (activity.service_type) {\r\n      case \"dine_in\":\r\n        return t(\"activities.serviceType.dine_in\");\r\n      case \"takeaway\":\r\n        return t(\"activities.serviceType.takeaway\");\r\n      case \"both\":\r\n        return t(\"activities.serviceType.both\");\r\n      default:\r\n        return \"\";\r\n    }\r\n  }, [activity.service_type, t]);\r\n  \r\n  const handleClick = () => {\r\n    navigate(`/activity/${activity.id}`);\r\n  };\r\n  \r\n  return (\r\n    <Card \r\n      className=\"group cursor-pointer overflow-hidden hover:shadow-lg transition-all duration-300 border-border/50 bg-card\"\r\n      onClick={handleClick}\r\n    >\r\n      {/* Image Container */}\r\n      <div className=\"relative aspect-[16/10] overflow-hidden bg-muted\">\r\n        {activity.image_url ? (\r\n          <img \r\n            src={activity.image_url} \r\n            alt={title}\r\n            className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300\"\r\n            loading=\"lazy\"\r\n          />\r\n        ) : (\r\n          <div className=\"w-full h-full flex items-center justify-center bg-gradient-to-br from-primary/20 to-primary/5\">\r\n            <Calendar className=\"w-12 h-12 text-primary/40\" />\r\n          </div>\r\n        )}\r\n        \r\n        {/* Day Badge */}\r\n        <Badge \r\n          className={cn(\r\n            \"absolute top-2 left-2 text-xs font-medium\",\r\n            dayLabel === t(\"home.recentActivities.today\") \r\n              ? \"bg-primary text-primary-foreground\" \r\n              : \"bg-secondary text-secondary-foreground\"\r\n          )}\r\n        >\r\n          {dayLabel}\r\n        </Badge>\r\n        \r\n        {/* Pinned Badge */}\r\n        {activity.pinned && (\r\n          <Badge \r\n            className=\"absolute top-2 right-2 text-xs bg-accent text-accent-foreground\"\r\n          >\r\n            {t(\"activities.pinned\")}\r\n          </Badge>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Content */}\r\n      <div className=\"p-3 space-y-2\">\r\n        <h3 className=\"font-medium text-sm leading-tight line-clamp-2 text-foreground group-hover:text-primary transition-colors\">\r\n          {title}\r\n        </h3>\r\n        \r\n        <div className=\"flex items-center gap-1.5 text-xs text-muted-foreground\">\r\n          {activity.service_type === \"dine_in\" && (\r\n            <UtensilsCrossed className=\"w-3 h-3 flex-shrink-0\" />\r\n          )}\r\n          {activity.service_type === \"takeaway\" && (\r\n            <ShoppingBag className=\"w-3 h-3 flex-shrink-0\" />\r\n          )}\r\n          {activity.service_type === \"both\" && (\r\n            <>\r\n              <UtensilsCrossed className=\"w-3 h-3 flex-shrink-0\" />\r\n              <ShoppingBag className=\"w-3 h-3 flex-shrink-0\" />\r\n            </>\r\n          )}\r\n          <span className=\"truncate\">{serviceTypeLabel}</span>\r\n        </div>\r\n      </div>\r\n    </Card>\r\n  );\r\n});\r\nActivityCard.displayName = \"ActivityCard\";\r\n\r\n// Loading Skeleton\r\nconst LoadingSkeleton = memo(() => {\r\n  const displayCount = useResponsiveCount();\r\n  \r\n  return (\r\n    <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4\">\r\n      {Array.from({ length: displayCount }).map((_, i) => (\r\n        <Card key={i} className=\"overflow-hidden\">\r\n          <Skeleton className=\"aspect-[16/10] w-full\" />\r\n          <div className=\"p-3 space-y-2\">\r\n            <Skeleton className=\"h-4 w-full\" />\r\n            <Skeleton className=\"h-3 w-2/3\" />\r\n          </div>\r\n        </Card>\r\n      ))}\r\n    </div>\r\n  );\r\n});\r\nLoadingSkeleton.displayName = \"LoadingSkeleton\";\r\n\r\n// Main Component\r\nconst RecentActivitiesSection = memo(() => {\r\n  const { t } = useTranslation();\r\n  const { allRecentActivities, isLoading, hasActivities } = useRecentActivities();\r\n  const displayCount = useResponsiveCount();\r\n  const [showAll, setShowAll] = useState(false);\r\n  \r\n  // Get day label for display\r\n  const getDayLabel = (dayKey: \"today\" | \"tomorrow\" | \"dayAfterTomorrow\") => {\r\n    switch (dayKey) {\r\n      case \"today\":\r\n        return t(\"home.recentActivities.today\");\r\n      case \"tomorrow\":\r\n        return t(\"home.recentActivities.tomorrow\");\r\n      case \"dayAfterTomorrow\":\r\n        return t(\"home.recentActivities.dayAfterTomorrow\");\r\n      default:\r\n        return \"\";\r\n    }\r\n  };\r\n  \r\n  // Slice activities to display count or show all\r\n  const displayedActivities = useMemo(() => {\r\n    if (showAll) {\r\n      return allRecentActivities;\r\n    }\r\n    return allRecentActivities.slice(0, displayCount);\r\n  }, [allRecentActivities, displayCount, showAll]);\r\n  \r\n  const hasMore = allRecentActivities.length > displayCount;\r\n  \r\n  // Don't render if no activities and not loading\r\n  if (!isLoading && !hasActivities) {\r\n    return null;\r\n  }\r\n  \r\n  return (\r\n    <section className=\"py-8 sm:py-12 px-4 bg-secondary/20\">\r\n      <div className=\"container mx-auto max-w-7xl\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between mb-6\">\r\n          <h2 className=\"text-xl sm:text-2xl font-bold text-foreground\">\r\n            {t(\"home.recentActivities.title\")}\r\n          </h2>\r\n          \r\n          {hasMore && !showAll && (\r\n            <Button \r\n              variant=\"ghost\" \r\n              size=\"sm\" \r\n              className=\"text-primary hover:text-primary/80\"\r\n              onClick={() => setShowAll(true)}\r\n            >\r\n              <span className=\"flex items-center gap-1\">\r\n                {t(\"home.recentActivities.viewAll\")}\r\n                <ArrowRight className=\"w-4 h-4\" />\r\n              </span>\r\n            </Button>\r\n          )}\r\n          \r\n          {showAll && (\r\n            <Button \r\n              variant=\"ghost\" \r\n              size=\"sm\" \r\n              className=\"text-muted-foreground hover:text-foreground\"\r\n              onClick={() => setShowAll(false)}\r\n            >\r\n              <span className=\"flex items-center gap-1\">\r\n                {t(\"home.recentActivities.collapse\")}\r\n              </span>\r\n            </Button>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Content */}\r\n        {isLoading ? (\r\n          <LoadingSkeleton />\r\n        ) : (\r\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4\">\r\n            {displayedActivities.map((activity) => (\r\n              <ActivityCard \r\n                key={activity.id} \r\n                activity={activity}\r\n                dayLabel={getDayLabel(activity.dayLabel)}\r\n              />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </section>\r\n  );\r\n});\r\nRecentActivitiesSection.displayName = \"RecentActivitiesSection\";\r\n\r\nexport default RecentActivitiesSection;\r\n","import { Button } from \"@/components/ui/button\";\r\nimport { MapPin, Search, Star, Calendar, Store, ArrowRight, ShoppingBag, CalendarCheck, Smartphone, Download, MessageCircle } from \"lucide-react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Card } from \"@/components/ui/card\";\r\n// Hero images served from public folder for LCP optimization (discoverable in initial HTML)\r\nconst sushiRamenHero = \"/images/sushi-ramen-hero.jpg\";\r\nconst sushiRamenMobile = \"/images/sushi-ramen-mobile.jpg\";\r\nimport mapIcon from \"@/assets/map-icon.png\";\r\nimport googlePlayBadge from \"@/assets/google-play-badge-new.png\";\r\nimport appStoreBadge from \"@/assets/app-store-badge.svg\";\r\nimport { useState, useEffect, memo, useCallback, useRef } from \"react\";\r\nimport { useActiveHomepageTemplates, HomepageTemplate } from \"@/hooks/useHomepageTemplates\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { usePageView } from \"@/hooks/usePageView\";\r\nimport { HomeSkeleton } from \"@/components/skeletons\";\r\nimport { isIOSWebView, isInWebView, isCapacitorApp, isIOSDevice } from \"@/lib/externalLinks\";\r\nimport AskXiaoxiongDialog from \"@/components/AskXiaoxiongDialog\";\r\nimport { PullToRefresh } from \"@/components/PullToRefresh\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport { useSiteSettings } from \"@/hooks/useSiteSettings\";\r\nimport HomeMapSection from \"@/components/HomeMapSection\";\r\nimport MobileHeroSection from \"@/components/MobileHeroSection\";\r\nimport RecentActivitiesSection from \"@/components/RecentActivitiesSection\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport useEnvironment from \"@/hooks/useEnvironment\";\r\n// Memoized Stats Display Component\r\nconst StatsDisplay = memo(({ stats, t }: { stats: { order_count: number; reserve_count: number }; t: (key: string) => string }) => (\r\n  <div className=\"absolute top-16 sm:top-20 left-3 z-20\">\r\n    <div className=\"gap-4 w-fit flex-col flex items-start justify-start\">\r\n      <div className=\"flex items-center gap-4\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <ShoppingBag className=\"w-4 h-4 text-primary\" />\r\n          <span className=\"text-sm text-white/90 drop-shadow-md\">{t(\"home.stats.delivery\")}</span>\r\n          <span className=\"font-bold text-white text-sm drop-shadow-md\">{stats.order_count}</span>\r\n        </div>\r\n        <div className=\"flex items-center gap-2\">\r\n          <CalendarCheck className=\"w-4 h-4 text-accent\" />\r\n          <span className=\"text-sm text-white/90 drop-shadow-md\">{t(\"home.stats.reservation\")}</span>\r\n          <span className=\"font-bold text-white text-sm drop-shadow-md\">{stats.reserve_count}</span>\r\n        </div>\r\n      </div>\r\n      \r\n      <div className=\"flex items-center gap-2\">\r\n        <span className=\"text-xl sm:text-2xl font-bold text-white drop-shadow-md\">\r\n          {t(\"home.hero.brandName\")}\r\n        </span>\r\n        <img \r\n          src={mapIcon} \r\n          alt=\"map icon\" \r\n          width={32}\r\n          height={32}\r\n          loading=\"eager\"\r\n          decoding=\"async\"\r\n          className=\"w-7 sm:w-8 h-7 sm:h-8 object-contain flex-shrink-0\" \r\n        />\r\n      </div>\r\n    </div>\r\n  </div>\r\n));\r\nStatsDisplay.displayName = \"StatsDisplay\";\r\n\r\n\r\n// Hook to determine if we should use lightweight mode for better performance\r\nconst useLightweightMode = (): boolean => {\r\n  const isMobile = window.innerWidth < 640;\r\n  const isDesktop = window.innerWidth >= 1024;\r\n  const connection = (navigator as any).connection;\r\n  \r\n  // Detection for iOS environments\r\n  const isCapacitor = isCapacitorApp();\r\n  const isWebView = isInWebView();\r\n  const isIOS = isIOSDevice();\r\n  \r\n  // Desktop: only use lightweight mode if user explicitly enabled data saver\r\n  if (isDesktop) {\r\n    if (connection?.saveData) return true;\r\n    return false; // Desktop always loads video by default\r\n  }\r\n  \r\n  // Mobile/Tablet: WebView environments use lightweight mode\r\n  // But exclude Capacitor native apps (user's own app should play videos)\r\n  if (isWebView && !isCapacitor) {\r\n    return true;\r\n  }\r\n  \r\n  // Check for slow network or data saver (mobile/tablet)\r\n  if (connection) {\r\n    if (connection.saveData) return true;\r\n    if (connection.effectiveType === '2g' || connection.effectiveType === 'slow-2g') return true;\r\n  }\r\n  \r\n  // Mobile low memory devices (< 2GB) - reduced threshold\r\n  if (isMobile && (navigator as any).deviceMemory && (navigator as any).deviceMemory < 2) return true;\r\n  \r\n  return false;\r\n};\r\n\r\n// Hero Slide Component\r\nconst HeroSlide = memo(({ \r\n  template, \r\n  isActive, \r\n  currentLang, \r\n  t,\r\n  onContentReady,\r\n  onAskXiaoxiong\r\n}: { \r\n  template: HomepageTemplate; \r\n  isActive: boolean;\r\n  currentLang: string;\r\n  t: (key: string) => string;\r\n  onContentReady?: () => void;\r\n  onAskXiaoxiong?: () => void;\r\n}) => {\r\n  const [postersLoaded, setPostersLoaded] = useState<Record<string, boolean>>({});\r\n  const [videosReady, setVideosReady] = useState<Record<string, boolean>>({});\r\n  const [videoErrors, setVideoErrors] = useState<Record<string, boolean>>({});\r\n  const [imagesLoaded, setImagesLoaded] = useState<Record<string, boolean>>({\r\n    mobile: true,\r\n    tablet: true, \r\n    desktop: true\r\n  });\r\n  // Control when to start loading videos - only after image is ready\r\n  const [shouldLoadVideo, setShouldLoadVideo] = useState(false);\r\n  const isLightweight = useLightweightMode();\r\n  \r\n  // Video refs for iOS Safari fix\r\n  const mobileVideoRef = useRef<HTMLVideoElement>(null);\r\n  const tabletVideoRef = useRef<HTMLVideoElement>(null);\r\n  const desktopVideoRef = useRef<HTMLVideoElement>(null);\r\n  \r\n  const getLocalizedText = (field: string) => {\r\n    const langSuffix = currentLang === \"zh\" ? \"_zh\" : currentLang === \"pt\" ? \"_pt\" : \"_en\";\r\n    return (template as any)[`${field}${langSuffix}`] || \"\";\r\n  };\r\n\r\n  const getDeviceType = () => {\r\n    if (window.innerWidth < 640) return 'mobile';\r\n    if (window.innerWidth < 1024) return 'tablet';\r\n    return 'desktop';\r\n  };\r\n\r\n  const getOverlayOpacity = () => {\r\n    const deviceType = getDeviceType();\r\n    \r\n    if (deviceType === 'mobile' && template.mobile_overlay_opacity !== null) {\r\n      return template.mobile_overlay_opacity;\r\n    }\r\n    if (deviceType === 'tablet' && template.tablet_overlay_opacity !== null) {\r\n      return template.tablet_overlay_opacity;\r\n    }\r\n    if (deviceType === 'desktop' && template.desktop_overlay_opacity !== null) {\r\n      return template.desktop_overlay_opacity;\r\n    }\r\n    \r\n    return template.overlay_opacity ?? 30;\r\n  };\r\n\r\n  const getOverlayStyle = () => {\r\n    const baseOpacity = getOverlayOpacity();\r\n    const direction = template.overlay_gradient_direction || 'to-b';\r\n    \r\n    const normalizeOpacity = (value: number | null | undefined, defaultValue: number) => {\r\n      if (value === null || value === undefined) return defaultValue / 100;\r\n      return value > 1 ? value / 100 : value;\r\n    };\r\n    \r\n    const normalizedBaseOpacity = baseOpacity > 1 ? baseOpacity / 100 : baseOpacity;\r\n    \r\n    const fromOpacity = normalizeOpacity(template.overlay_gradient_from_opacity, 30) * normalizedBaseOpacity;\r\n    const viaOpacity = normalizeOpacity(template.overlay_gradient_via_opacity, 25) * normalizedBaseOpacity;\r\n    const toOpacity = normalizeOpacity(template.overlay_gradient_to_opacity, 40) * normalizedBaseOpacity;\r\n\r\n    const directionMap: Record<string, string> = {\r\n      'to-t': 'to top',\r\n      'to-b': 'to bottom',\r\n      'to-l': 'to left',\r\n      'to-r': 'to right',\r\n      'to-tl': 'to top left',\r\n      'to-tr': 'to top right',\r\n      'to-bl': 'to bottom left',\r\n      'to-br': 'to bottom right'\r\n    };\r\n\r\n    const cssDirection = directionMap[direction] || 'to bottom';\r\n\r\n    const colorMap: Record<string, string> = {\r\n      'black': '0, 0, 0',\r\n      'white': '255, 255, 255',\r\n      'background': '0, 0, 0',\r\n      'foreground': '255, 255, 255',\r\n      'primary': '1, 100, 80',\r\n      'secondary': '240, 240, 240'\r\n    };\r\n\r\n    const fromColor = colorMap[template.overlay_gradient_from || 'black'] || '0, 0, 0';\r\n    const viaColor = colorMap[template.overlay_gradient_via || 'black'] || '0, 0, 0';\r\n    const toColor = colorMap[template.overlay_gradient_to || 'black'] || '0, 0, 0';\r\n\r\n    return {\r\n      background: `linear-gradient(${cssDirection}, rgba(${fromColor}, ${fromOpacity}), rgba(${viaColor}, ${viaOpacity}), rgba(${toColor}, ${toOpacity}))`\r\n    };\r\n  };\r\n\r\n  const mobileImg = template.mobile_image_url || sushiRamenMobile;\r\n  const tabletImg = template.tablet_image_url || template.desktop_image_url || sushiRamenHero;\r\n  const desktopImg = template.desktop_image_url || sushiRamenHero;\r\n  const blurAmount = template.background_blur || 0;\r\n\r\n  // Per-device media type (fallback to global media_type for backwards compatibility)\r\n  const desktopMediaType = (template as any).desktop_media_type || template.media_type || 'image';\r\n  const tabletMediaType = (template as any).tablet_media_type || template.media_type || 'image';\r\n  const mobileMediaType = (template as any).mobile_media_type || template.media_type || 'image';\r\n\r\n  // In lightweight mode (WebView), always treat as image to avoid video loading overhead\r\n  const isDesktopVideo = desktopMediaType === 'video' && !isLightweight;\r\n  const isTabletVideo = tabletMediaType === 'video' && !isLightweight;\r\n  const isMobileVideo = mobileMediaType === 'video' && !isLightweight;\r\n  \r\n  const mobileVideo = isMobileVideo ? template.mobile_video_url : null;\r\n  const tabletVideo = isTabletVideo ? (template.tablet_video_url || template.desktop_video_url) : null;\r\n  const desktopVideo = isDesktopVideo ? template.desktop_video_url : null;\r\n\r\n  // Preload only current device's poster image to prevent flash\r\n  useEffect(() => {\r\n    const deviceType = getDeviceType();\r\n    const currentImage = deviceType === 'mobile' ? mobileImg \r\n      : deviceType === 'tablet' ? tabletImg : desktopImg;\r\n    \r\n    if (currentImage) {\r\n      const img = new Image();\r\n      img.onload = () => {\r\n        setPostersLoaded(prev => ({ ...prev, [deviceType]: true }));\r\n        setImagesLoaded(prev => ({ ...prev, [deviceType]: true }));\r\n        // Image is ready - notify parent and start loading video\r\n        if (isActive) {\r\n          onContentReady?.();\r\n          // Start loading video after image is displayed (with slight delay for smoother UX)\r\n          setTimeout(() => setShouldLoadVideo(true), 100);\r\n        }\r\n      };\r\n      img.src = currentImage;\r\n    }\r\n  }, [mobileImg, tabletImg, desktopImg, isActive, onContentReady]);\r\n\r\n  // Also enable video loading when slide becomes active (for carousel navigation)\r\n  useEffect(() => {\r\n    if (isActive && postersLoaded[getDeviceType()]) {\r\n      setShouldLoadVideo(true);\r\n    }\r\n  }, [isActive, postersLoaded]);\r\n\r\n  const handleVideoCanPlay = (device: string) => {\r\n    setVideosReady(prev => ({ ...prev, [device]: true }));\r\n  };\r\n\r\n  const handleVideoError = (device: string, error: any) => {\r\n    console.error(`[HeroSlide] Video error on ${device}:`, error);\r\n    setVideoErrors(prev => ({ ...prev, [device]: true }));\r\n  };\r\n\r\n  // iOS Safari video autoplay fix - programmatically set muted and trigger play\r\n  useEffect(() => {\r\n    if (!shouldLoadVideo || !isActive) return;\r\n    \r\n    const isIOS = isIOSDevice();\r\n    if (!isIOS) return;\r\n\r\n    const deviceType = getDeviceType();\r\n    const videoRef = deviceType === 'mobile' ? mobileVideoRef \r\n      : deviceType === 'tablet' ? tabletVideoRef : desktopVideoRef;\r\n    \r\n    const video = videoRef.current;\r\n    if (!video) return;\r\n\r\n    // For iOS, we need to programmatically ensure muted is set and call play()\r\n    const attemptPlay = async () => {\r\n      try {\r\n        video.muted = true;\r\n        video.playsInline = true;\r\n        // Set webkit-playsinline for older iOS versions\r\n        video.setAttribute('webkit-playsinline', 'true');\r\n        \r\n        await video.play();\r\n        console.log(`[HeroSlide] iOS video play successful on ${deviceType}`);\r\n      } catch (err) {\r\n        console.error(`[HeroSlide] iOS video play failed on ${deviceType}:`, err);\r\n        // Mark as error so we show the fallback image\r\n        setVideoErrors(prev => ({ ...prev, [deviceType]: true }));\r\n      }\r\n    };\r\n\r\n    // Small delay to ensure video element is ready\r\n    const timer = setTimeout(attemptPlay, 150);\r\n    return () => clearTimeout(timer);\r\n  }, [shouldLoadVideo, isActive]);\r\n\r\n  return (\r\n    <div className={cn(\r\n      \"absolute inset-0 w-full h-full transition-opacity duration-1000\",\r\n      isActive ? \"opacity-100 z-10\" : \"opacity-0 z-0\"\r\n    )}>\r\n      {/* 背景媒体 */}\r\n      <div className=\"absolute inset-0 w-full h-full\">\r\n        {/* Mobile: Per-device media type */}\r\n        <div className=\"absolute inset-0 w-full h-full sm:hidden\">\r\n          {!imagesLoaded.mobile && (\r\n            <div className=\"absolute inset-0 w-full h-full bg-muted animate-pulse z-20\" />\r\n          )}\r\n          {isMobileVideo && mobileVideo ? (\r\n            <>\r\n              <img \r\n                src={mobileImg} \r\n                alt=\"Background\" \r\n                className={cn(\r\n                  \"absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500\",\r\n                  videosReady.mobile && !videoErrors.mobile ? \"opacity-0 pointer-events-none\" : \"opacity-100\"\r\n                )}\r\n                style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n              />\r\n              {shouldLoadVideo && !videoErrors.mobile && (\r\n                <video\r\n                  ref={mobileVideoRef}\r\n                  src={mobileVideo}\r\n                  autoPlay\r\n                  loop\r\n                  muted\r\n                  playsInline\r\n                  // @ts-ignore - webkit-playsinline for iOS Safari\r\n                  webkit-playsinline=\"true\"\r\n                  preload=\"auto\"\r\n                  onCanPlay={() => handleVideoCanPlay('mobile')}\r\n                  onError={(e) => handleVideoError('mobile', e)}\r\n                  className=\"absolute inset-0 w-full h-full object-cover object-center\"\r\n                  style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n                />\r\n              )}\r\n            </>\r\n          ) : (\r\n            <img \r\n              src={mobileImg} \r\n              alt=\"Background\" \r\n              className={cn(\r\n                \"absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500\",\r\n                imagesLoaded.mobile ? \"opacity-100\" : \"opacity-0\"\r\n              )}\r\n              style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n            />\r\n          )}\r\n        </div>\r\n        \r\n        {/* Tablet: Per-device media type */}\r\n        <div className=\"absolute inset-0 w-full h-full hidden sm:block lg:hidden\">\r\n          {!imagesLoaded.tablet && (\r\n            <div className=\"absolute inset-0 w-full h-full bg-muted animate-pulse z-20\" />\r\n          )}\r\n          {isTabletVideo && tabletVideo ? (\r\n            <>\r\n              <img \r\n                src={tabletImg} \r\n                alt=\"Background\" \r\n                className={cn(\r\n                  \"absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500\",\r\n                  videosReady.tablet && !videoErrors.tablet ? \"opacity-0 pointer-events-none\" : \"opacity-100\"\r\n                )}\r\n                style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n              />\r\n              {shouldLoadVideo && !videoErrors.tablet && (\r\n                <video\r\n                  ref={tabletVideoRef}\r\n                  src={tabletVideo}\r\n                  autoPlay\r\n                  loop\r\n                  muted\r\n                  playsInline\r\n                  // @ts-ignore - webkit-playsinline for iOS Safari\r\n                  webkit-playsinline=\"true\"\r\n                  preload=\"auto\"\r\n                  onCanPlay={() => handleVideoCanPlay('tablet')}\r\n                  onError={(e) => handleVideoError('tablet', e)}\r\n                  className=\"absolute inset-0 w-full h-full object-cover object-center\"\r\n                  style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n                />\r\n              )}\r\n            </>\r\n          ) : (\r\n            <img \r\n              src={tabletImg} \r\n              alt=\"Background\" \r\n              className={cn(\r\n                \"absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500\",\r\n                imagesLoaded.tablet ? \"opacity-100\" : \"opacity-0\"\r\n              )}\r\n              style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n            />\r\n          )}\r\n        </div>\r\n        \r\n        {/* Desktop: Per-device media type */}\r\n        <div className=\"absolute inset-0 w-full h-full hidden lg:block\">\r\n          {!imagesLoaded.desktop && (\r\n            <div className=\"absolute inset-0 w-full h-full bg-muted animate-pulse z-20\" />\r\n          )}\r\n          {isDesktopVideo && desktopVideo ? (\r\n            <>\r\n              <img \r\n                src={desktopImg} \r\n                alt=\"Background\" \r\n                className={cn(\r\n                  \"absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500\",\r\n                  videosReady.desktop && !videoErrors.desktop ? \"opacity-0 pointer-events-none\" : \"opacity-100\"\r\n                )}\r\n                style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n              />\r\n              {shouldLoadVideo && !videoErrors.desktop && (\r\n                <video\r\n                  ref={desktopVideoRef}\r\n                  src={desktopVideo}\r\n                  autoPlay\r\n                  loop\r\n                  muted\r\n                  playsInline\r\n                  // @ts-ignore - webkit-playsinline for iOS Safari\r\n                  webkit-playsinline=\"true\"\r\n                  preload=\"auto\"\r\n                  onCanPlay={() => handleVideoCanPlay('desktop')}\r\n                  onError={(e) => handleVideoError('desktop', e)}\r\n                  className=\"absolute inset-0 w-full h-full object-cover object-center\"\r\n                  style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n                />\r\n              )}\r\n            </>\r\n          ) : (\r\n            <img \r\n              src={desktopImg} \r\n              alt=\"Background\" \r\n              fetchPriority=\"high\"\r\n              loading=\"eager\"\r\n              decoding=\"async\"\r\n              className={cn(\r\n                \"absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500\",\r\n                imagesLoaded.desktop ? \"opacity-100\" : \"opacity-0\"\r\n              )}\r\n              style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n            />\r\n          )}\r\n        </div>\r\n        <div className=\"absolute inset-0 w-full h-full\" style={getOverlayStyle()} />\r\n      </div>\r\n\r\n      {/* 内容 */}\r\n      <div className=\"relative z-10 container mx-auto px-4 sm:px-6 flex items-center justify-center min-h-screen\">\r\n        <div className=\"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full\">\r\n          <h1 className=\"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]\">\r\n            {getLocalizedText(\"title\") || t(\"home.hero.title\")}\r\n          </h1>\r\n          \r\n          <p className=\"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]\">\r\n            {getLocalizedText(\"description\") || t(\"home.hero.description\")}\r\n          </p>\r\n          \r\n          {template.subtitle_button_text_zh && (\r\n            <div className=\"flex justify-center\">\r\n              <button \r\n                onClick={onAskXiaoxiong}\r\n                className=\"group flex items-center gap-3 bg-white/20 backdrop-blur-xl text-white px-5 sm:px-7 py-3.5 sm:py-4 rounded-full shadow-[0_8px_32px_rgba(0,0,0,0.12)] hover:shadow-[0_16px_48px_rgba(0,0,0,0.2)] hover:bg-white/30 transition-all duration-300 cursor-text border border-white/40\"\r\n              >\r\n                <MessageCircle className=\"w-5 h-5 text-white/90 group-hover:text-white transition-colors drop-shadow-sm\" />\r\n                <span className=\"text-sm sm:text-base text-primary group-hover:text-primary/80 transition-colors drop-shadow-sm font-medium\">\r\n                  {getLocalizedText(\"subtitle_button_text\") || t(\"home.hero.subtitle\")}\r\n                </span>\r\n                <Search className=\"w-4 h-4 text-white/60 ml-2 drop-shadow-sm\" />\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\nHeroSlide.displayName = \"HeroSlide\";\r\n\r\nconst Home = () => {\r\n  const { t, i18n } = useTranslation();\r\n  const queryClient = useQueryClient();\r\n  const { settings: siteSettings } = useSiteSettings();\r\n  const { data: templates, isLoading: isLoadingTemplates, refetch: refetchTemplates } = useActiveHomepageTemplates();\r\n  const [currentIndex, setCurrentIndex] = useState(0);\r\n  const [stats, setStats] = useState<{ order_count: number; reserve_count: number } | null>(null);\r\n  const timerRef = useRef<NodeJS.Timeout | null>(null);\r\n  const [firstSlideReady, setFirstSlideReady] = useState(false);\r\n  const [askDialogOpen, setAskDialogOpen] = useState(false);\r\n  \r\n  // Mobile/WebView detection for conditional layout\r\n  const isMobile = useIsMobile();\r\n  const { isWebView } = useEnvironment();\r\n  const showMobileLayout = isMobile || isWebView;\r\n  \r\n  // Check if AI assistant is enabled and get provider\r\n  const isAIAssistantEnabled = siteSettings?.ai_assistant_enabled !== false;\r\n  const aiProvider = (siteSettings?.ai_provider || \"ask-xiaoxiong\") as \"ask-xiaoxiong\" | \"xiaoxiong-agent\" | \"lovable-ai\";\r\n  \r\n  // Handler for when the first slide's content is ready\r\n  const handleContentReady = useCallback(() => {\r\n    setFirstSlideReady(true);\r\n  }, []);\r\n\r\n  // Track page view\r\n  usePageView({ pageType: \"home\" });\r\n\r\n  const fetchStats = useCallback(async () => {\r\n    try {\r\n      const response = await fetch(\"https://v.xiaoxiong.pt/api/get_info\");\r\n      const result = await response.json();\r\n      if (result) {\r\n        setStats({\r\n          order_count: result.order_count || 0,\r\n          reserve_count: result.reserve_count || 0\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Failed to fetch stats:\", error);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    fetchStats();\r\n  }, [fetchStats]);\r\n\r\n  // Pull-to-refresh handler\r\n  const handleRefresh = useCallback(async () => {\r\n    await Promise.all([\r\n      refetchTemplates(),\r\n      fetchStats(),\r\n      queryClient.invalidateQueries({ queryKey: ['restaurants'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['activities'] })\r\n    ]);\r\n  }, [refetchTemplates, fetchStats, queryClient]);\r\n\r\n  // Auto-rotate carousel\r\n  useEffect(() => {\r\n    if (!templates || templates.length <= 1) return;\r\n\r\n    const currentTemplate = templates[currentIndex];\r\n    const duration = currentTemplate?.duration || 5000;\r\n\r\n    timerRef.current = setTimeout(() => {\r\n      setCurrentIndex((prev) => (prev + 1) % templates.length);\r\n    }, duration);\r\n\r\n    return () => {\r\n      if (timerRef.current) clearTimeout(timerRef.current);\r\n    };\r\n  }, [templates, currentIndex]);\r\n\r\n  const goToSlide = useCallback((index: number) => {\r\n    if (timerRef.current) clearTimeout(timerRef.current);\r\n    setCurrentIndex(index);\r\n  }, []);\r\n\r\n  const goToPrev = useCallback(() => {\r\n    if (!templates) return;\r\n    if (timerRef.current) clearTimeout(timerRef.current);\r\n    setCurrentIndex((prev) => (prev - 1 + templates.length) % templates.length);\r\n  }, [templates]);\r\n\r\n  const goToNext = useCallback(() => {\r\n    if (!templates) return;\r\n    if (timerRef.current) clearTimeout(timerRef.current);\r\n    setCurrentIndex((prev) => (prev + 1) % templates.length);\r\n  }, [templates]);\r\n\r\n  const currentLang = i18n.language;\r\n  const showControls = templates && templates.length > 1;\r\n\r\n  return (\r\n    <PullToRefresh onRefresh={handleRefresh}>\r\n      <div className=\"min-h-screen\">\r\n        {/* Hero Section - Conditional Layout */}\r\n        {showMobileLayout ? (\r\n          // Mobile/WebView: Simplified hero without background\r\n          <MobileHeroSection \r\n            stats={stats} \r\n            onAskXiaoxiong={() => setAskDialogOpen(true)} \r\n          />\r\n        ) : (\r\n          // Desktop: Full carousel with background media\r\n          <section className=\"relative h-screen flex items-start overflow-hidden bg-background\">\r\n            {/* 统计数据显示 - 左上角 */}\r\n            {stats && <StatsDisplay stats={stats} t={t} />}\r\n\r\n            {/* Carousel Slides */}\r\n            <div className={cn(\r\n              \"absolute inset-0 w-full h-full transition-opacity duration-500\",\r\n              firstSlideReady ? \"opacity-100\" : \"opacity-0\"\r\n            )}>\r\n              {templates?.map((template, index) => (\r\n                <HeroSlide\r\n                  key={template.id}\r\n                  template={template}\r\n                  isActive={index === currentIndex}\r\n                  currentLang={currentLang}\r\n                  t={t}\r\n                  onContentReady={index === 0 ? handleContentReady : undefined}\r\n                  onAskXiaoxiong={() => setAskDialogOpen(true)}\r\n                />\r\n              ))}\r\n            </div>\r\n\r\n            {/* Loading state - show skeleton until content is actually ready */}\r\n            <div \r\n              className={cn(\r\n                \"absolute inset-0 w-full h-full z-20 transition-opacity duration-500\",\r\n                (isLoadingTemplates || !firstSlideReady) ? \"opacity-100\" : \"opacity-0 pointer-events-none\"\r\n              )}\r\n            >\r\n              <HomeSkeleton />\r\n            </div>\r\n\r\n            {/* Fallback if no templates (only after loading completes) */}\r\n            {!isLoadingTemplates && (!templates || templates.length === 0) && (\r\n              <div className=\"absolute inset-0 w-full h-full\">\r\n                <img \r\n                  src={sushiRamenMobile} \r\n                  alt=\"Background\" \r\n                  fetchPriority=\"high\"\r\n                  loading=\"eager\"\r\n                  decoding=\"async\"\r\n                  className=\"absolute inset-0 w-full h-full object-cover object-center sm:hidden\"\r\n                />\r\n                <img \r\n                  src={sushiRamenHero} \r\n                  alt=\"Background\" \r\n                  fetchPriority=\"high\"\r\n                  loading=\"eager\"\r\n                  decoding=\"async\"\r\n                  className=\"absolute inset-0 w-full h-full object-cover object-center hidden sm:block\"\r\n                />\r\n                <div className=\"absolute inset-0 w-full h-full bg-gradient-to-b from-black/30 via-black/25 to-black/40\" />\r\n                <div className=\"relative z-10 container mx-auto px-4 sm:px-6 flex items-center min-h-screen\">\r\n                  <div className=\"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full\">\r\n                    <h1 className=\"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]\">\r\n                      {t(\"home.hero.title\")}\r\n                    </h1>\r\n                    <p className=\"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]\">\r\n                      {t(\"home.hero.description\")}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Carousel Controls - Dot Indicators Only */}\r\n            {showControls && (\r\n              <div className=\"absolute bottom-8 left-1/2 -translate-x-1/2 z-30 flex gap-2\">\r\n                {templates.map((_, index) => (\r\n                  <button\r\n                    key={index}\r\n                    onClick={() => goToSlide(index)}\r\n                    className={cn(\r\n                      \"w-3 h-3 rounded-full transition-all duration-300\",\r\n                      index === currentIndex \r\n                        ? \"bg-white w-8\" \r\n                        : \"bg-white/50 hover:bg-white/70\"\r\n                    )}\r\n                    aria-label={`Go to slide ${index + 1}`}\r\n                  />\r\n                ))}\r\n              </div>\r\n            )}\r\n          </section>\r\n        )}\r\n\r\n      {/* Recent Activities Section */}\r\n      <RecentActivitiesSection />\r\n\r\n      {/* Map Section */}\r\n      <section className=\"py-12 sm:py-20 px-4 bg-secondary/20\">\r\n        <div className=\"container mx-auto max-w-7xl\">\r\n          <HomeMapSection />\r\n        </div>\r\n      </section>\r\n\r\n      {/* App Download Section - Hidden in WebView/Native App */}\r\n      {!isInWebView() && !isCapacitorApp() && (\r\n      <section className=\"py-16 sm:py-24 px-4 relative overflow-hidden\">\r\n        {/* Background with soft edges using mask */}\r\n        <div \r\n          className=\"absolute inset-0 bg-gradient-to-br from-primary/5 via-primary/3 to-primary/8\"\r\n          style={{\r\n            maskImage: 'radial-gradient(ellipse 80% 70% at 50% 50%, black 40%, transparent 100%)',\r\n            WebkitMaskImage: 'radial-gradient(ellipse 80% 70% at 50% 50%, black 40%, transparent 100%)',\r\n          }}\r\n        />\r\n        \r\n        {/* Decorative elements */}\r\n        <div className=\"absolute top-1/4 left-1/4 w-72 h-72 bg-primary/8 rounded-full blur-3xl\" />\r\n        <div className=\"absolute bottom-1/4 right-1/4 w-96 h-96 bg-primary/5 rounded-full blur-3xl\" />\r\n        \r\n        <div className=\"container mx-auto max-w-5xl relative z-10\">\r\n          <div className=\"flex flex-col items-center justify-center gap-8\">\r\n            \r\n            {/* Content */}\r\n            <div className=\"text-center max-w-md\">\r\n              <div className=\"inline-flex items-center gap-2 bg-primary/10 text-primary text-sm font-medium px-4 py-2 rounded-full mb-4\">\r\n                <Smartphone className=\"w-4 h-4\" />\r\n                <span>Mobile App</span>\r\n              </div>\r\n              <h3 className=\"text-2xl sm:text-3xl md:text-4xl font-bold text-foreground mb-4\">\r\n                {t(\"home.app.title\")}\r\n              </h3>\r\n              <p className=\"text-base sm:text-lg text-muted-foreground mb-8 leading-relaxed\">\r\n                {t(\"home.app.description\")}\r\n              </p>\r\n              <div className=\"flex flex-col items-center gap-4\">\r\n                <div className=\"flex flex-col sm:flex-row items-center justify-center gap-4\">\r\n                  {/* App Store */}\r\n                  <a \r\n                    href=\"https://apps.apple.com/cn/app/xiaoxiong/id6755481369\" \r\n                    target=\"_blank\" \r\n                    rel=\"noopener noreferrer\"\r\n                    className=\"relative group\"\r\n                  >\r\n                    <div className=\"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity\" />\r\n                    <div className=\"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center\">\r\n                      <img \r\n                        src={appStoreBadge} \r\n                        alt=\"Download on the App Store\" \r\n                        className=\"h-8 sm:h-9\"\r\n                      />\r\n                    </div>\r\n                  </a>\r\n                  \r\n                  {/* Google Play */}\r\n                  <a \r\n                    href=\"https://play.google.com/store/apps/details?id=com.xiaoxiong.market\" \r\n                    target=\"_blank\" \r\n                    rel=\"noopener noreferrer\"\r\n                    className=\"relative group\"\r\n                  >\r\n                    <div className=\"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity\" />\r\n                    <div className=\"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center\">\r\n                      <img \r\n                        src={googlePlayBadge} \r\n                        alt=\"Get it on Google Play\" \r\n                        className=\"h-12 sm:h-14\"\r\n                      />\r\n                    </div>\r\n                  </a>\r\n                </div>\r\n                \r\n                {/* Download hint */}\r\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\r\n                  <Download className=\"w-4 h-4 animate-bounce\" />\r\n                  <span>{t(\"home.app.downloadNow\")}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n      )}\r\n\r\n      {/* CTA Section */}\r\n      <section className=\"py-16 sm:py-20 px-4 bg-gradient-to-r from-primary/90 to-primary relative overflow-hidden rounded-3xl mx-4 sm:mx-8 lg:mx-16 mb-8\">\r\n        <div className=\"absolute inset-0 bg-grid-pattern opacity-10\" />\r\n        <div className=\"absolute top-0 right-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/10 rounded-full blur-3xl\" />\r\n        <div className=\"absolute bottom-0 left-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/10 rounded-full blur-3xl\" />\r\n        \r\n        <div className=\"container mx-auto max-w-4xl text-center relative z-10\">\r\n          <h2 className=\"text-3xl sm:text-4xl md:text-5xl font-bold text-primary-foreground mb-4 sm:mb-6 px-4\">\r\n            {t(\"home.cta.title\")}\r\n          </h2>\r\n          <p className=\"text-base sm:text-xl text-primary-foreground/90 mb-6 sm:mb-8 max-w-2xl mx-auto px-4\">\r\n            {t(\"home.cta.description\")}\r\n          </p>\r\n          <div className=\"flex justify-center\">\r\n            <Button size=\"lg\" variant=\"secondary\" asChild className=\"text-base sm:text-lg shadow-xl hover:shadow-2xl\">\r\n              <Link to=\"/join-us\">\r\n                <Store className=\"mr-2 w-4 sm:w-5 h-4 sm:h-5\" />\r\n                {t(\"home.cta.button\")}\r\n              </Link>\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Ask Xiaoxiong Dialog - conditionally rendered based on settings */}\r\n      {isAIAssistantEnabled && (\r\n        <AskXiaoxiongDialog open={askDialogOpen} onOpenChange={setAskDialogOpen} provider={aiProvider} />\r\n      )}\r\n      </div>\r\n    </PullToRefresh>\r\n  );\r\n};\r\n\r\nexport default Home;\r\n"],"names":["AskXiaoxiongDialog","open","onOpenChange","provider","i18n","useTranslation","navigate","useNavigate","isMobile","useIsMobile","settings","useSiteSettings","logoUrl","input","setInput","messages","isLoading","showLocationDialog","setShowLocationDialog","pendingMessage","setPendingMessage","handleSubmit","handleKeyDown","handleLocationConfirm","processMessage","abortRequest","requestLocation","useXiaoxiongChat","useEffect","handleClose","getTitle","jsx","Dialog","jsxs","DialogContent","DialogHeader","DialogTitle","XiaoxiongChatContent","MapRestaurantTags","restaurant","language","visibleCount","setVisibleCount","useState","containerRef","useRef","allTags","type","idx","checkOverflow","container","badges","firstBadgeTop","lastVisibleIndex","i","timer","visibleTags","hasMore","tag","Badge","Popover","PopoverTrigger","Button","MoreHorizontal","PopoverContent","HomeMapSection","t","toast","useToast","localizeRestaurant","useLocalizedContent","searchQuery","setSearchQuery","selectedTypes","setSelectedTypes","selectedActivity","setSelectedActivity","activityRestaurantIds","setActivityRestaurantIds","radiusFilter","setRadiusFilter","userLocation","setUserLocation","isFullscreen","setIsFullscreen","showAllTypes","setShowAllTypes","showAllActivities","setShowAllActivities","mapRef","savedMapState","restaurantRefs","selectedRestaurantId","setSelectedRestaurantId","showFilters","setShowFilters","isMapCollapsed","setIsMapCollapsed","isMobileListExpanded","setIsMobileListExpanded","MOBILE_DEFAULT_VISIBLE","restaurants","useRestaurants","restaurantTypes","useRestaurantTypes","activities","useActivities","activityRestaurantCounts","useActivityRestaurantCounts","activitiesWithRestaurants","activity","handleTypeFilter","prev","handleRequestLocation","position","getUserLocation","error","handleRadiusChange","radius","handleActivityFilter","activityId","data","supabase","ar","processedRestaurants","localized","distance","calculateDistance","activityFilteredRestaurants","r","filteredRestaurants","a","b","handleRestaurantClick","handleMarkerClick","restaurantElement","toggleFullscreen","mapContainer","center","zoom","handleFullscreenChange","isNowFullscreen","Input","e","Navigation","Filter","index","activityLabel","Minimize","Maximize","RestaurantMap","mapInstance","logoIcon","Fragment","ChevronDown","ChevronUp","MapPin","Card","el","Star","ScrollArea","LocationPermissionDialog","MobileHeroSection","memo","stats","onAskXiaoxiong","templates","useActiveHomepageTemplates","buttons","useNavigationSettings","currentLang","showExternalLinkDialog","setShowExternalLinkDialog","showAboutUsButton","demoButton","btn","getLocalizedText","field","title","description","chatButtonText","handleConfirmExternalLink","openExternalUrl","mapIcon","Link","Info","ShoppingBag","CalendarCheck","MessageCircle","Search","ExternalLinkConfirmDialog","isDateRangeArray","value","item","isActivityValidOnDate","targetDate","startDate","startOfDay","endDate","target","isSameDay","targetWeekday","getDay","targetDayOfMonth","getDate","monthRanges","range","targetMonth","getMonth","targetDay","yearlyMonth","yearlyDay","getActivitySortWeight","useRecentActivities","recentActivities","useMemo","today","tomorrow","addDays","dayAfterTomorrow","filterAndSort","date","weightDiff","allRecentActivities","seen","combined","useResponsiveCount","count","setCount","updateCount","width","ActivityCard","dayLabel","getLocalizedField","serviceTypeLabel","handleClick","Calendar","cn","UtensilsCrossed","LoadingSkeleton","displayCount","_","Skeleton","RecentActivitiesSection","hasActivities","showAll","setShowAll","getDayLabel","dayKey","displayedActivities","ArrowRight","sushiRamenHero","sushiRamenMobile","StatsDisplay","useLightweightMode","isDesktop","connection","isCapacitor","isCapacitorApp","isWebView","isInWebView","HeroSlide","template","isActive","onContentReady","postersLoaded","setPostersLoaded","videosReady","setVideosReady","videoErrors","setVideoErrors","imagesLoaded","setImagesLoaded","shouldLoadVideo","setShouldLoadVideo","isLightweight","mobileVideoRef","tabletVideoRef","desktopVideoRef","getDeviceType","getOverlayOpacity","deviceType","getOverlayStyle","baseOpacity","direction","normalizeOpacity","defaultValue","normalizedBaseOpacity","fromOpacity","viaOpacity","toOpacity","cssDirection","colorMap","fromColor","viaColor","toColor","mobileImg","tabletImg","desktopImg","blurAmount","desktopMediaType","tabletMediaType","mobileMediaType","isDesktopVideo","isTabletVideo","isMobileVideo","mobileVideo","tabletVideo","desktopVideo","currentImage","img","handleVideoCanPlay","device","handleVideoError","isIOSDevice","video","err","Home","queryClient","useQueryClient","siteSettings","isLoadingTemplates","refetchTemplates","currentIndex","setCurrentIndex","setStats","timerRef","firstSlideReady","setFirstSlideReady","askDialogOpen","setAskDialogOpen","useEnvironment","showMobileLayout","isAIAssistantEnabled","aiProvider","handleContentReady","useCallback","usePageView","fetchStats","result","handleRefresh","duration","goToSlide","showControls","PullToRefresh","HomeSkeleton","Smartphone","appStoreBadge","googlePlayBadge","Download","Store"],"mappings":"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"}