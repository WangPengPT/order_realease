import{p as L,r as d,j as e,bz as ve,aM as ee,X as xe,bY as Ge,bi as Ns,et as vs,a4 as se,eu as bs,ak as ws,a_ as pe,bG as we,b1 as Ve,aK as ys,al as _s,bl as B,ab as ye,be as _e,bJ as ks,c$ as Ss,c9 as Cs,cb as Rs,aw as Qe,ay as Is,el as Te,b8 as Ds,ev as ke,e3 as Ps,ce as me,u as As,aO as Ts,bT as zs,w as Y}from"./vendor-react-87iFmKFJ.js";import{A as ze}from"./AnimatedLoadingText-yrWpC26J.js";import{i as w,I as Z,B as A,ae as We,C as ue,S as Ms,n as Se,p as Ce,D as Us,c as Es,d as Fs,e as Os,Z as Ls,a0 as $s,A as Me,r as Ue,t as Ee,v as Fe,w as Oe,x as Le,y as $e,z as oe}from"./index-C3xfGQgV.js";import{P as Bs}from"./progress-CKfvw8UR.js";import{C as Hs,u as Gs,R as Vs,P as Qs}from"./PublishConfirmStep-0Yglv_km.js";import{u as Ws}from"./useCreateRecipe-5rjo-E9n.js";import{u as Js}from"./useSavedRecipes-DmNDhRhv.js";import{u as Ks}from"./useLoginRequired-BPMAXLoc.js";import{C as qs,a as Xs,b as Ys}from"./collapsible-DE4DVYv9.js";import{S as be}from"./separator-ZnoPDUxo.js";import{R as Zs}from"./RecipeCookingMode-DMhWLzea.js";import{I as et}from"./ImagePreviewModal-i6EihQ1q.js";import"./vendor-i18n-AOdgFpXS.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-utils-vwQGbBim.js";import"./vendor-supabase-CQWbleDe.js";import"./TranslateButton-cmFvingd.js";const de=5,st=({onPhotosUploaded:s,onSkipToManual:f,uploadImage:x,isUploading:p,initialImageUrls:j,onRequireLogin:u})=>{const{t:o}=L(),[m,n]=d.useState(()=>j&&j.length>0?j.map((a,t)=>({id:`restored-${t}`,preview:a,url:a,uploading:!1})):[]),[h,c]=d.useState(!1),N=d.useRef(null),g=m.filter(a=>a.uploading).length,D=m.length>0&&m.every(a=>a.url!==null),I=async a=>{if(u&&!u())return;const t=Array.from(a),y=de-m.length,b=t.slice(0,y).filter(E=>E.size<=10*1024*1024);if(b.length===0)return;const U=b.map(E=>({id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,preview:URL.createObjectURL(E),url:null,uploading:!0}));n(E=>[...E,...U]),await Promise.all(b.map(async(E,W)=>{const _=await x(E,"ai-recipe-ingredients");n(_?v=>v.map(O=>O.id===U[W].id?{...O,url:_,uploading:!1}:O):v=>v.filter(O=>O.id!==U[W].id))}))},P=a=>{c(!1),I([a])},R=()=>{u&&!u()||c(!0)},l=a=>{n(t=>t.filter(y=>y.id!==a))},i=()=>{if(u&&!u())return;const a=m.map(t=>t.url).filter(Boolean);a.length>0&&s(a)};return e.jsxs(e.Fragment,{children:[h&&e.jsx(Hs,{onCapture:P,onClose:()=>c(!1)}),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-6 py-8",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-primary/10 flex items-center justify-center mx-auto",children:e.jsx(ve,{className:"h-10 w-10 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold",children:o("aiRecipe.photoTitle","æ‹æ‘„æ‚¨çš„é£Ÿæ")}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-xs",children:o("aiRecipe.photoDescMulti","æ‹ç…§æˆ–ä¸Šä¼ é£Ÿæç…§ç‰‡ï¼ˆæœ€å¤š5å¼ ï¼‰ï¼ŒAI å°†è‡ªåŠ¨è¯†åˆ«é£Ÿæ")})]}),m.length>0&&e.jsxs("div",{className:"w-full max-w-sm grid grid-cols-3 gap-2",children:[m.map(a=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden border bg-muted",children:[e.jsx("img",{src:a.preview,alt:"Preview",className:"w-full h-full object-cover"}),a.uploading&&e.jsx("div",{className:"absolute inset-0 bg-background/60 flex items-center justify-center",children:e.jsx(ee,{className:"h-5 w-5 animate-spin text-primary"})}),e.jsx("button",{onClick:()=>l(a.id),className:"absolute top-1 right-1 w-5 h-5 rounded-full bg-black/60 text-white flex items-center justify-center",children:e.jsx(xe,{className:"h-3 w-3"})})]},a.id)),m.length<de&&e.jsxs("button",{onClick:()=>N.current?.click(),className:"aspect-square rounded-lg border-2 border-dashed border-muted-foreground/30 flex flex-col items-center justify-center gap-1 text-muted-foreground hover:border-primary/50 hover:text-primary transition-colors",disabled:g>0,children:[e.jsx(Ge,{className:"h-5 w-5"}),e.jsxs("span",{className:"text-xs",children:[m.length,"/",de]})]})]}),m.length===0?e.jsxs("div",{className:"flex gap-3 w-full max-w-sm",children:[e.jsxs(w,{variant:"default",className:"flex-1 gap-2",onClick:R,children:[e.jsx(ve,{className:"h-4 w-4"}),o("aiRecipe.takePhoto","æ‹ç…§")]}),e.jsxs(w,{variant:"outline",className:"flex-1 gap-2",onClick:()=>N.current?.click(),children:[e.jsx(Ns,{className:"h-4 w-4"}),o("aiRecipe.uploadPhoto","ç›¸å†Œ")]})]}):e.jsxs("div",{className:"flex gap-3 w-full max-w-sm",children:[e.jsxs(w,{variant:"outline",className:"flex-1 gap-2",onClick:R,disabled:m.length>=de||g>0,children:[e.jsx(ve,{className:"h-4 w-4"}),o("aiRecipe.addMore","ç»§ç»­æ‹ç…§")]}),e.jsx(w,{className:"flex-1 gap-2",onClick:i,disabled:!D||g>0,children:g>0?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4 animate-spin"}),o("common.uploading","ä¸Šä¼ ä¸­...")]}):o("aiRecipe.startIdentify","å¼€å§‹è¯†åˆ«")})]}),e.jsxs(w,{variant:"ghost",className:"gap-2 text-muted-foreground",onClick:f,disabled:g>0,children:[e.jsx(vs,{className:"h-4 w-4"}),o("aiRecipe.skipToManual","è·³è¿‡ï¼Œæ‰‹åŠ¨è¾“å…¥é£Ÿæ")]}),e.jsx("input",{ref:N,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:a=>{const t=a.target.files;t?.length&&I(t),a.target.value=""}})]})]})},tt=({ingredients:s,onChange:f})=>{const{t:x}=L(),[p,j]=d.useState(null),[u,o]=d.useState(""),[m,n]=d.useState(""),[h,c]=d.useState(""),[N,g]=d.useState(""),D=l=>{j(l),o(s[l].name),n(s[l].estimated_amount||""),c(s[l].unit||"")},I=()=>{if(p===null||!u.trim())return;const l=[...s];l[p]={...l[p],name:u.trim(),estimated_amount:m.trim(),unit:h.trim()},f(l),j(null)},P=l=>{f(s.filter((i,a)=>a!==l))},R=()=>{if(!N.trim())return;const l=N.split(/[ï¼Œ,\s]+/).map(i=>i.trim()).filter(Boolean);l.length!==0&&(f([...s,...l.map(i=>({name:i,estimated_amount:"",unit:""}))]),g(""))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center space-y-1 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:x("aiRecipe.confirmIngredients","ç¡®è®¤é£Ÿæ")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x("aiRecipe.confirmIngredientsDesc","ç¡®è®¤ AI è¯†åˆ«çš„é£Ÿæï¼Œæ‚¨å¯ä»¥æ·»åŠ ã€ç¼–è¾‘æˆ–åˆ é™¤")})]}),e.jsx("div",{className:"space-y-2",children:s.map((l,i)=>e.jsx("div",{className:"flex items-center gap-2 p-3 rounded-lg border bg-card",children:p===i?e.jsxs(e.Fragment,{children:[e.jsx(Z,{value:u,onChange:a=>o(a.target.value),placeholder:x("aiRecipe.ingredientName","é£Ÿæåç§°"),className:"flex-1 h-8",autoFocus:!0}),e.jsx(Z,{value:m,onChange:a=>n(a.target.value),placeholder:x("aiRecipe.amount","æ•°é‡"),className:"w-16 h-8"}),e.jsx(Z,{value:h,onChange:a=>c(a.target.value),placeholder:x("aiRecipe.unit","å•ä½"),className:"w-14 h-8"}),e.jsx(w,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:I,children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(w,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>j(null),children:e.jsx(xe,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"flex-1 text-sm font-medium",children:l.name}),l.estimated_amount&&e.jsxs(A,{variant:"outline",className:"text-xs",children:[l.estimated_amount,l.unit||""]}),e.jsx(w,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>D(i),children:e.jsx(bs,{className:"h-3.5 w-3.5"})}),e.jsx(w,{size:"icon",variant:"ghost",className:"h-8 w-8 text-destructive",onClick:()=>P(i),children:e.jsx(ws,{className:"h-3.5 w-3.5"})})]})},i))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Z,{value:N,onChange:l=>g(l.target.value),placeholder:x("aiRecipe.addIngredientPlaceholder","æ·»åŠ é£Ÿæ..."),className:"flex-1",onKeyDown:l=>l.key==="Enter"&&R()}),e.jsx(w,{onClick:R,disabled:!N.trim(),size:"icon",children:e.jsx(Ge,{className:"h-4 w-4"})})]})]})},Be=[1,2,3,4,6],at=[1,2,3,4,5,6],it=({onConfirm:s,onSkip:f,initialValues:x})=>{const{t:p}=L(),[j,u]=d.useState(x?.difficulty),[o,m]=d.useState(x?.servings??2),[n,h]=d.useState(x?.dishCount),[c,N]=d.useState(x?.notes||""),g=x?.servings!=null&&!Be.includes(x.servings),[D,I]=d.useState(g),[P,R]=d.useState(g?String(x?.servings):""),l=[{value:"easy",label:p("recipe.difficulty.easy","ç®€å•"),desc:p("aiRecipe.diffEasyDesc","é€‚åˆé›¶åŸºç¡€æ–°æ‰‹")},{value:"medium",label:p("recipe.difficulty.medium","ä¸­ç­‰"),desc:p("aiRecipe.diffMediumDesc","æœ‰ä¸€ç‚¹çƒ¹é¥ªç»éªŒ")},{value:"hard",label:p("recipe.difficulty.hard","å›°éš¾"),desc:p("aiRecipe.diffHardDesc","æŒ‘æˆ˜é«˜éš¾åº¦èœè‚´")}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("h3",{className:"text-lg font-semibold",children:p("aiRecipe.preferences","çƒ¹é¥ªåå¥½")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:p("aiRecipe.preferencesDesc","è®¾ç½®æ‚¨çš„åå¥½ï¼ŒAI ä¼šæ®æ­¤æ¨èæ›´åˆé€‚çš„èœè°±")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(pe,{className:"h-4 w-4"}),p("aiRecipe.preferredDifficulty","æœŸæœ›éš¾åº¦")]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:l.map(i=>e.jsxs("button",{onClick:()=>u(j===i.value?void 0:i.value),className:`p-3 rounded-lg border text-center transition-all ${j===i.value?"border-primary bg-primary/10 ring-1 ring-primary":"hover:border-primary/50"}`,children:[e.jsx("div",{className:"text-sm font-medium",children:i.label}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0.5",children:i.desc})]},i.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(we,{className:"h-4 w-4"}),p("aiRecipe.preferredServings","ç”¨é¤äººæ•°")]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[Be.map(i=>e.jsxs(A,{variant:o===i&&!D?"default":"outline",className:"cursor-pointer px-4 py-2 text-sm",onClick:()=>{m(i),I(!1),R("")},children:[i," ",p("recipe.servingsUnit","äººä»½")]},i)),e.jsx(A,{variant:D?"default":"outline",className:"cursor-pointer px-4 py-2 text-sm",onClick:()=>{I(!0),m(void 0)},children:p("aiRecipe.customServings","è‡ªå®šä¹‰")})]}),D&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(Z,{type:"number",min:1,max:99,placeholder:p("aiRecipe.enterServings","è¾“å…¥äººæ•°"),value:P,onChange:i=>{R(i.target.value);const a=parseInt(i.target.value);m(a>0?a:void 0)},className:"w-28"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:p("recipe.servingsUnit","äººä»½")})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Ve,{className:"h-4 w-4"}),p("aiRecipe.dishCount","èœå“æ•°é‡")]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:p("aiRecipe.dishCountDesc","ä¸æŒ‡å®šæ—¶ AI ä¼šæ ¹æ®äººæ•°å’Œé£Ÿæè‡ªåŠ¨åˆ¤æ–­")}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(A,{variant:n===void 0?"default":"outline",className:"cursor-pointer px-4 py-2 text-sm",onClick:()=>h(void 0),children:p("aiRecipe.autoDecide","è‡ªåŠ¨")}),at.map(i=>e.jsxs(A,{variant:n===i?"default":"outline",className:"cursor-pointer px-4 py-2 text-sm",onClick:()=>h(i),children:[i," ",p("aiRecipe.dishUnit","é“èœ")]},i))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ys,{className:"h-4 w-4"}),p("aiRecipe.cookingNotes","å¤‡æ³¨")]}),e.jsx(We,{value:c,onChange:i=>N(i.target.value),placeholder:p("aiRecipe.cookingNotesPlaceholder","å¦‚ï¼šä¸è¦å¤ªè¾£ã€æƒ³åšä¸€æ¡Œå¹´å¤œé¥­ã€åæ¸…æ·¡å£å‘³ç­‰..."),rows:3,className:"resize-none"})]}),e.jsx("div",{className:"flex gap-3 pt-2",children:e.jsx(w,{className:"flex-1",onClick:()=>s({difficulty:j,servings:o,dishCount:n,notes:c.trim()||void 0}),children:p("aiRecipe.confirmPreferences","å¼€å§‹ç”Ÿæˆèœè°±")})})]})},nt=({recipes:s,recipeHistory:f=[],onSelectHistoryMeal:x,onConfirmMeal:p,onRegenerate:j,isRegenerating:u,preferences:o,isLoadingImages:m})=>{const{t:n,i18n:h}=L(),[c,N]=d.useState(!1),[g,D]=d.useState(o?.notes||""),[I,P]=d.useState(!1),R=t=>h.language==="en"&&t.recipe_name_en?t.recipe_name_en:h.language==="pt"&&t.recipe_name_pt?t.recipe_name_pt:t.recipe_name,l=t=>h.language==="en"&&t.subtitle_en?t.subtitle_en:h.language==="pt"&&t.subtitle_pt?t.subtitle_pt:t.subtitle,i=t=>{switch(t){case"easy":return n("recipe.difficulty.easy","ç®€å•");case"medium":return n("recipe.difficulty.medium","ä¸­ç­‰");case"hard":return n("recipe.difficulty.hard","å›°éš¾");default:return t}},a=s.reduce((t,y)=>t+(y.cook_time||0),0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center space-y-2 mb-4",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-primary/10 rounded-full",children:[e.jsx(Ve,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-primary",children:n("aiRecipe.mealPlan","å®Œæ•´èœå•")})]}),e.jsx("h3",{className:"text-lg font-semibold",children:n("aiRecipe.mealPlanTitle","AI ä¸ºæ‚¨è®¾è®¡äº†ä¸€æ¡Œèœ")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n("aiRecipe.mealPlanDesc","å…± {{count}} é“èœï¼Œæ€»è®¡çº¦ {{time}} åˆ†é’Ÿ",{count:s.length,time:a})}),o&&e.jsxs("div",{className:"inline-flex items-start gap-1.5 text-xs text-muted-foreground bg-muted/50 rounded-lg px-3 py-2 mt-1 text-left max-w-sm mx-auto",children:[e.jsx(_s,{className:"h-3.5 w-3.5 mt-0.5 shrink-0"}),e.jsx("span",{children:o.dishCount?n("aiRecipe.dishCountExplain","æŒ‰ç…§æ‚¨æŒ‡å®šçš„ {{count}} é“èœç”Ÿæˆ",{count:o.dishCount}):o.notes?n("aiRecipe.dishCountFromNotes","æ ¹æ®æ‚¨çš„å¤‡æ³¨ã€Œ{{notes}}ã€ï¼ŒAI ä¸ºæ‚¨è§„åˆ’äº† {{count}} é“èœ",{notes:o.notes.length>20?o.notes.slice(0,20)+"â€¦":o.notes,count:s.length}):n("aiRecipe.dishCountAuto","AI æ ¹æ® {{servings}} äººä»½çš„é£Ÿæè‡ªåŠ¨è§„åˆ’äº† {{count}} é“èœ",{servings:o.servings||s[0]?.servings||"?",count:s.length})})]})]}),e.jsx("div",{className:"space-y-3",children:s.map((t,y)=>e.jsxs(ue,{className:"overflow-hidden",children:[t.image_url?e.jsxs("div",{className:"relative w-full aspect-[16/9] bg-muted",children:[e.jsx("img",{src:t.image_url,alt:R(t),className:"w-full h-full object-cover",loading:"lazy"}),e.jsx(A,{variant:"secondary",className:"absolute top-2 left-2 text-xs font-bold",children:n("aiRecipe.dishNumber","ç¬¬ {{n}} é“",{n:y+1})}),e.jsx(A,{variant:"secondary",className:"absolute bottom-2 right-2 text-[10px] gap-1 opacity-80",children:t.image_source==="ai"?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-2.5 w-2.5"}),n("aiRecipe.imageSourceAI","AI ç”Ÿæˆ")]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"h-2.5 w-2.5"}),n("aiRecipe.imageSourceWeb","æ¥è‡ªç½‘ç»œ")]})})]}):e.jsxs("div",{className:"relative w-full aspect-[16/9] overflow-hidden bg-muted",children:[m?e.jsxs(e.Fragment,{children:[e.jsx(Ms,{className:"absolute inset-0 w-full h-full rounded-none"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-1.5 z-10",children:[e.jsx(B,{className:"h-5 w-5 text-primary animate-pulse"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:n("aiRecipe.generatingImage","AI æ­£åœ¨ç”Ÿæˆå›¾ç‰‡...")})]})]}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(B,{className:"h-8 w-8 text-muted-foreground/30"})}),e.jsx(A,{variant:"secondary",className:"absolute top-2 left-2 text-xs font-bold z-20",children:n("aiRecipe.dishNumber","ç¬¬ {{n}} é“",{n:y+1})})]}),e.jsxs(Se,{className:"pb-2",children:[e.jsx("h4",{className:"font-semibold",children:R(t)}),l(t)&&e.jsx("p",{className:"text-xs text-muted-foreground italic",children:l(t)})]}),e.jsxs(Ce,{className:"pt-0",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(A,{variant:"outline",className:"gap-1 text-xs",children:[e.jsx(_e,{className:"h-3 w-3"}),t.cook_time," ",n("recipe.minutes","åˆ†é’Ÿ")]}),e.jsxs(A,{variant:"outline",className:"gap-1 text-xs",children:[e.jsx(pe,{className:"h-3 w-3"}),i(t.difficulty)]}),e.jsxs(A,{variant:"outline",className:"gap-1 text-xs",children:[e.jsx(we,{className:"h-3 w-3"}),t.servings," ",n("recipe.servingsUnit","äººä»½")]})]}),t.missing_ingredients&&t.missing_ingredients.length>0&&e.jsxs("div",{className:"mt-2 flex items-start gap-1.5 text-xs text-destructive",children:[e.jsx(ks,{className:"h-3.5 w-3.5 mt-0.5 shrink-0"}),e.jsxs("span",{children:[n("aiRecipe.missingIngredients","éœ€è¦é¢å¤–é£Ÿæï¼š"),(()=>{const b=h.language;return(b==="en"?t.missing_ingredients_en||t.missing_ingredients:b==="pt"&&t.missing_ingredients_pt||t.missing_ingredients).join(b==="zh"?"ã€":", ")})()]})]})]})]},y))}),e.jsx("div",{className:"space-y-2",children:c?e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:n("aiRecipe.editNotes","ç¼–è¾‘å¤‡æ³¨ï¼ˆä¿®æ”¹åç‚¹å‡»æ¢ä¸€æ‰¹å³å¯é‡æ–°ç”Ÿæˆï¼‰")}),e.jsx(We,{value:g,onChange:t=>D(t.target.value),placeholder:n("aiRecipe.notesPlaceholder","ä¾‹å¦‚ï¼šä¸¤èœä¸€æ±¤ã€æ¸…æ·¡ä¸ºä¸»..."),className:"min-h-[60px] text-sm"}),e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>N(!1),children:n("common.done","å®Œæˆ")})]}):e.jsxs("button",{onClick:()=>N(!0),className:"inline-flex items-center gap-1.5 text-xs text-muted-foreground hover:text-primary transition-colors",children:[e.jsx(Ss,{className:"h-3 w-3"}),g?n("aiRecipe.currentNotes","å¤‡æ³¨ï¼š{{notes}}",{notes:g.length>30?g.slice(0,30)+"â€¦":g}):n("aiRecipe.addNotes","æ·»åŠ å¤‡æ³¨ï¼ˆå¦‚ï¼šä¸¤èœä¸€æ±¤ï¼‰")]})}),e.jsxs("div",{className:"flex gap-3 pt-2 sticky bottom-4",children:[j&&e.jsxs(w,{variant:"outline",className:"flex-1 gap-1.5",onClick:()=>j(g||void 0),disabled:u,children:[e.jsx(Cs,{className:`h-4 w-4 ${u?"animate-spin":""}`}),u?n("aiRecipe.regenerating","é‡æ–°ç”Ÿæˆä¸­..."):n("aiRecipe.regenerateRecipes","æ¢ä¸€æ‰¹")]}),e.jsxs(w,{className:"flex-1 gap-1.5",onClick:p,children:[e.jsx(se,{className:"h-4 w-4"}),n("aiRecipe.confirmMeal","ç¡®è®¤èœå•")]})]}),f.length>0&&x&&e.jsxs("div",{className:"border rounded-xl overflow-hidden",children:[e.jsxs("button",{className:"w-full flex items-center justify-between px-4 py-3 text-sm font-medium hover:bg-muted/50 transition-colors",onClick:()=>P(t=>!t),children:[e.jsxs("span",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Rs,{className:"h-4 w-4"}),n("aiRecipe.historyMeals","å†å²èœå•"),e.jsx(A,{variant:"secondary",className:"text-xs",children:f.length})]}),e.jsx(Qe,{className:`h-4 w-4 text-muted-foreground transition-transform ${I?"rotate-180":""}`})]}),I&&e.jsx("div",{className:"divide-y",children:f.map((t,y)=>e.jsxs("div",{className:"px-4 py-3 space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:n("aiRecipe.historyEntry","ç¬¬ {{n}} æ¬¡ç”Ÿæˆ",{n:f.length-y})}),e.jsxs(w,{size:"sm",variant:"ghost",className:"h-7 text-xs gap-1 text-primary",onClick:()=>{x(t),P(!1)},children:[e.jsx(se,{className:"h-3 w-3"}),n("aiRecipe.useThisMeal","é€‰è¿™æ¡Œ")]})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.map((b,U)=>e.jsx("span",{className:"text-xs bg-muted rounded-full px-2.5 py-0.5",children:h.language==="en"&&b.recipe_name_en?b.recipe_name_en:h.language==="pt"&&b.recipe_name_pt?b.recipe_name_pt:b.recipe_name},U))})]},y))})]})]})},lt=({recipes:s})=>{const{t:f,i18n:x}=L(),[p,j]=d.useState(0),u=n=>x.language==="en"&&n.recipe_name_en?n.recipe_name_en:x.language==="pt"&&n.recipe_name_pt?n.recipe_name_pt:n.recipe_name,o=n=>x.language==="en"&&n.subtitle_en?n.subtitle_en:x.language==="pt"&&n.subtitle_pt?n.subtitle_pt:n.subtitle,m=n=>{switch(n){case"easy":return f("recipe.difficulty.easy","ç®€å•");case"medium":return f("recipe.difficulty.medium","ä¸­ç­‰");case"hard":return f("recipe.difficulty.hard","å›°éš¾");default:return n}};return e.jsx("div",{className:"space-y-3",children:s.map((n,h)=>e.jsx(qs,{open:p===h,onOpenChange:c=>j(c?h:-1),children:e.jsxs(ue,{className:"overflow-hidden",children:[n.image_url&&e.jsxs("div",{className:"relative w-full aspect-[16/9] bg-muted",children:[e.jsx("img",{src:n.image_url,alt:u(n),className:"w-full h-full object-cover",loading:"lazy"}),e.jsx("div",{className:"absolute bottom-2 right-2",children:e.jsx("span",{className:"inline-flex items-center gap-1 text-[10px] bg-black/50 text-white px-2 py-0.5 rounded-full",children:n.image_source==="ai"?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-2.5 w-2.5"}),"AI ç”Ÿæˆ"]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"h-2.5 w-2.5"}),"æ¥è‡ªç½‘ç»œ"]})})})]}),e.jsx(Xs,{className:"w-full text-left",children:e.jsxs(Se,{className:"pb-2 flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{variant:"secondary",className:"text-xs shrink-0",children:f("aiRecipe.dishNumber","ç¬¬ {{n}} é“",{n:h+1})}),e.jsx("h4",{className:"font-semibold truncate",children:u(n)})]}),o(n)&&e.jsx("p",{className:"text-xs text-muted-foreground italic mt-1",children:o(n)}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsxs(A,{variant:"outline",className:"gap-1 text-xs",children:[e.jsx(_e,{className:"h-3 w-3"}),n.cook_time,f("recipe.minutes","åˆ†é’Ÿ")]}),e.jsxs(A,{variant:"outline",className:"gap-1 text-xs",children:[e.jsx(pe,{className:"h-3 w-3"}),m(n.difficulty)]})]})]}),p===h?e.jsx(Is,{className:"h-5 w-5 text-muted-foreground shrink-0 ml-2"}):e.jsx(Qe,{className:"h-5 w-5 text-muted-foreground shrink-0 ml-2"})]})}),e.jsx(Ys,{children:e.jsxs(Ce,{className:"pt-0 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-sm mb-2",children:f("recipe.step.ingredients","é…æ–™")}),e.jsx("div",{className:"space-y-1",children:n.ingredients.map((c,N)=>{const g=x.language==="en"&&c.name_en?c.name_en:x.language==="pt"&&c.name_pt?c.name_pt:c.name;return e.jsxs("div",{className:"flex justify-between text-sm py-1 border-b border-dashed last:border-0",children:[e.jsx("span",{children:g}),e.jsxs("span",{className:"text-muted-foreground",children:[c.amount," ",x.language==="en"&&c.unit_en?c.unit_en:x.language==="pt"&&c.unit_pt?c.unit_pt:c.unit]})]},N)})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-sm mb-2",children:f("recipe.step.steps","æ­¥éª¤")}),e.jsx("div",{className:"space-y-3",children:n.steps.map((c,N)=>{const g=x.language==="en"&&c.description_en?c.description_en:x.language==="pt"&&c.description_pt?c.description_pt:c.description;return e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center shrink-0 mt-0.5",children:e.jsx("span",{className:"text-xs font-bold text-primary",children:c.order||N+1})}),e.jsx("p",{className:"text-sm leading-relaxed",children:g})]},N)})})]})]})})]})},h))})},rt=({recipe:s,ingredientImageUrl:f,onComplete:x,onBack:p,onSkip:j})=>{const{t:u,i18n:o}=L(),[m,n]=d.useState("guided"),[h,c]=d.useState(!1),[N,g]=d.useState(null),D=()=>o.language==="en"&&s.recipe_name_en?s.recipe_name_en:o.language==="pt"&&s.recipe_name_pt?s.recipe_name_pt:s.recipe_name,I=a=>{switch(a){case"easy":return u("recipe.difficulty.easy","ç®€å•");case"medium":return u("recipe.difficulty.medium","ä¸­ç­‰");case"hard":return u("recipe.difficulty.hard","å›°éš¾");default:return a}},P=a=>{switch(a){case"easy":return"bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30";case"medium":return"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30";case"hard":return"bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30";default:return"bg-muted text-muted-foreground"}},R=s.steps.map((a,t)=>({...a,order:a.order||t+1}));if(m==="guided"&&h)return e.jsx(ue,{className:"overflow-hidden",children:e.jsx(Zs,{steps:R,onExit:()=>c(!1),onComplete:x})});const l=()=>e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"inline-flex h-9 items-center rounded-md bg-muted p-1 text-muted-foreground",children:[e.jsxs("button",{onClick:()=>{n("guided"),c(!1)},className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 ${m==="guided"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(Te,{className:"h-4 w-4"}),u("recipe.guidedMode","æµç¨‹æ¨¡å¼")]}),e.jsxs("button",{onClick:()=>n("full"),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 ${m==="full"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(Ds,{className:"h-4 w-4"}),u("recipe.fullMode","å®Œæ•´æ¨¡å¼")]})]})}),i=()=>e.jsxs(ue,{className:"overflow-hidden",children:[s.image_url&&e.jsxs("div",{className:"relative w-full aspect-[16/9] bg-muted",children:[e.jsx("img",{src:s.image_url,alt:D(),className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute bottom-2 right-2",children:e.jsx("span",{className:"inline-flex items-center gap-1 text-[10px] bg-black/50 text-white px-2 py-0.5 rounded-full",children:s.image_source==="ai"?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-2.5 w-2.5"}),"AI ç”Ÿæˆ"]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"h-2.5 w-2.5"}),"æ¥è‡ªç½‘ç»œ"]})})})]}),e.jsxs(Se,{className:"pb-3",children:[e.jsx("h2",{className:"text-xl font-bold",children:D()}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[s.cook_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.cook_time," ",u("recipe.minutes","åˆ†é’Ÿ")]})]}),s.servings&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.servings," ",u("recipe.servingsUnit","äººä»½")]})]}),s.difficulty&&e.jsxs(A,{variant:"outline",className:P(s.difficulty),children:[e.jsx(pe,{className:"h-3 w-3 mr-1"}),I(s.difficulty)]})]})]}),e.jsxs(Ce,{className:"space-y-6",children:[(()=>{const a=o.language==="en"&&s.introduction_en?s.introduction_en:o.language==="pt"&&s.introduction_pt?s.introduction_pt:s.introduction;return a&&e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:a})})(),e.jsx(be,{}),s.ingredients.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[u("recipe.ingredients","é£Ÿæ")," (",s.ingredients.length,")"]}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground font-medium px-2 py-1.5 bg-muted/50 rounded-t-md border border-border/50",children:[e.jsx("span",{className:"flex-1",children:u("recipe.ingredientName","åç§°")}),e.jsx("span",{className:"w-24 text-right",children:u("recipe.amount","ç”¨é‡")})]}),e.jsx("ul",{className:"border border-t-0 border-border/50 rounded-b-md divide-y divide-border/50",children:s.ingredients.map((a,t)=>{const y=o.language==="en"&&a.name_en?a.name_en:o.language==="pt"&&a.name_pt?a.name_pt:a.name;return e.jsxs("li",{className:"flex items-center text-sm px-2 py-2",children:[e.jsx("span",{className:"flex-1 min-w-0 truncate",children:y}),e.jsxs("span",{className:"w-24 text-right text-muted-foreground shrink-0",children:[a.amount," ",o.language==="en"&&a.unit_en?a.unit_en:o.language==="pt"&&a.unit_pt?a.unit_pt:a.unit]})]},t)})})]}),m==="guided"&&e.jsxs(e.Fragment,{children:[e.jsx(be,{}),e.jsxs(w,{size:"lg",className:"w-full gap-2 h-14 text-lg",onClick:()=>c(!0),children:[e.jsx(Te,{className:"h-6 w-6"}),u("recipe.startCooking","å¼€å§‹çƒ¹é¥ª"),e.jsxs(A,{variant:"secondary",className:"ml-2",children:[R.length," ",u("recipe.stepsCount","æ­¥")]})]}),j&&e.jsxs(w,{variant:"ghost",className:"w-full gap-2 text-muted-foreground",onClick:j,children:[e.jsx(ke,{className:"h-4 w-4"}),u("aiRecipe.skipDish","è·³è¿‡è¿™é“èœ")]})]}),m==="full"&&e.jsxs(e.Fragment,{children:[e.jsx(be,{}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[u("recipe.step.steps","æ­¥éª¤")," (",R.length,")"]}),e.jsx("ol",{className:"space-y-4",children:R.map((a,t)=>{const y=o.language==="en"&&a.description_en?a.description_en:o.language==="pt"&&a.description_pt?a.description_pt:a.description;return e.jsxs("li",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold",children:a.order}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("p",{className:"text-sm",children:y}),(()=>{const b=a.image_urls&&a.image_urls.length>0?a.image_urls:a.image_url?[a.image_url]:[];return b.length>0&&e.jsx("div",{className:`flex gap-2 ${b.length===1?"":"flex-wrap"}`,children:b.map((U,E)=>e.jsx("img",{src:U,alt:`Step ${a.order} - ${E+1}`,className:`rounded-lg max-h-48 object-cover cursor-pointer ${b.length===1?"w-full":"w-[calc(50%-0.25rem)]"}`,onClick:()=>g(U)},E))})})()]})]},t)})})]})]}),m==="full"&&e.jsx(w,{size:"lg",variant:"outline",className:"w-full gap-2",onClick:x,children:u("recipe.completeCooking","å®Œæˆçƒ¹é¥ª")})]})]});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{}),e.jsx(i,{}),e.jsx(et,{imageUrl:N||"",isOpen:!!N,onClose:()=>g(null)})]})},ct=({recipes:s,ingredientImageUrl:f,onComplete:x,onBack:p})=>{const{t:j,i18n:u}=L(),[o,m]=d.useState(0),[n,h]=d.useState(new Set),[c,N]=d.useState(new Set),g=l=>u.language==="en"&&l.recipe_name_en?l.recipe_name_en:u.language==="pt"&&l.recipe_name_pt?l.recipe_name_pt:l.recipe_name,D=(l,i)=>l.size+i.size===s.length,I=(l,i,a)=>{if(D(l,i)){x(Array.from(i));return}for(let t=a+1;t<s.length;t++)if(!l.has(t)&&!i.has(t)){m(t);return}for(let t=0;t<a;t++)if(!l.has(t)&&!i.has(t)){m(t);return}x(Array.from(i))},P=()=>{const l=new Set(n);l.add(o),h(l),I(l,c,o)},R=()=>{const l=new Set(c);l.add(o),N(l),I(n,l,o)};return n.size+c.size,e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto pb-1 scrollbar-hide",children:s.map((l,i)=>e.jsxs("button",{onClick:()=>m(i),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-all border shrink-0 ${o===i?"bg-primary text-primary-foreground border-primary":n.has(i)?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 border-green-300 dark:border-green-700":c.has(i)?"bg-muted text-muted-foreground/50 border-border line-through":"bg-muted text-muted-foreground border-border hover:border-primary/50"}`,children:[n.has(i)&&e.jsx(se,{className:"h-3 w-3"}),c.has(i)&&e.jsx(ke,{className:"h-3 w-3"}),g(l)]},i))}),e.jsxs("div",{className:"text-center text-xs text-muted-foreground",children:[j("aiRecipe.cookingProgress","å·²å®Œæˆ {{done}}/{{total}} é“èœ",{done:n.size,total:s.length}),c.size>0&&e.jsxs("span",{className:"ml-1 opacity-60",children:["(",j("aiRecipe.skippedCount","å·²è·³è¿‡ {{n}} é“",{n:c.size}),")"]})]}),e.jsx(rt,{recipe:s[o],ingredientImageUrl:f,onComplete:P,onBack:p,onSkip:s.length>1&&!c.has(o)?R:void 0},o)]})},ot=({recipes:s,skippedIndices:f=[],onShare:x,onSkip:p,onSaveRecipe:j,onUnsaveRecipe:u,isSaving:o})=>{const{t:m,i18n:n}=L(),[h,c]=d.useState(new Set(s.map((i,a)=>a).filter(i=>!f.includes(i)))),[N,g]=d.useState(new Map),[D,I]=d.useState(null),P=async(i,a)=>{if(a.stopPropagation(),!!j)if(N.has(i)){const t=N.get(i);if(t&&u){I(i);try{await u(t),g(y=>{const b=new Map(y);return b.delete(i),b})}finally{I(null)}}}else{I(i);try{const t=await j(s[i]);g(y=>new Map(y).set(i,t?.id||"saved"))}finally{I(null)}}},R=i=>n.language==="en"&&i.recipe_name_en?i.recipe_name_en:n.language==="pt"&&i.recipe_name_pt?i.recipe_name_pt:i.recipe_name,l=i=>{const a=new Set(h);a.has(i)?a.delete(i):a.add(i),c(a)};return e.jsxs("div",{className:"flex flex-col items-center gap-5 py-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(Ps,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{className:"text-center space-y-1.5",children:[e.jsx("h3",{className:"text-xl font-bold",children:m("aiRecipe.cookingDone","çƒ¹é¥ªå®Œæˆï¼ğŸ‰")}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-xs mx-auto",children:m("aiRecipe.shareSelectDesc","é€‰æ‹©æ‚¨æƒ³è¦åˆ†äº«åˆ°ç¤¾åŒºçš„èœå“ï¼Œæ¯é“èœéœ€è¦æ‹æ‘„æˆå“ç…§ç‰‡")})]}),e.jsx("div",{className:"w-full max-w-sm space-y-2",children:s.map((i,a)=>{const t=f.includes(a),y=N.has(a);return e.jsxs("button",{onClick:()=>!t&&l(a),className:`w-full flex items-center gap-3 p-3 rounded-xl border transition-all text-left ${t?"border-border bg-muted/20 opacity-40 cursor-not-allowed":h.has(a)?"border-primary bg-primary/5 ring-1 ring-primary/20":"border-border bg-muted/30 opacity-60"}`,children:[e.jsx("div",{className:"w-14 h-14 rounded-lg overflow-hidden bg-muted shrink-0",children:i.image_url?e.jsx("img",{src:i.image_url,alt:i.recipe_name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground text-lg",children:"ğŸ½ï¸"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:R(i)}),i.subtitle&&e.jsx("p",{className:"text-xs text-muted-foreground italic truncate mt-0.5",children:i.subtitle}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1",children:[e.jsxs(A,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[i.cook_time,m("recipe.minuteShort","åˆ†é’Ÿ")]}),t&&e.jsx(A,{variant:"outline",className:"text-[10px] px-1.5 py-0 text-muted-foreground",children:m("aiRecipe.skipped","å·²è·³è¿‡")})]})]}),j&&!t&&e.jsx("button",{onClick:b=>P(a,b),disabled:D===a,className:`p-1.5 rounded-lg shrink-0 transition-colors ${y?"text-primary":"text-muted-foreground hover:text-primary hover:bg-primary/10"}`,children:D===a?e.jsx(ee,{className:"h-4 w-4 animate-spin"}):e.jsx(me,{className:`h-4 w-4 ${y?"fill-primary":""}`})}),!t&&e.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center shrink-0 transition-colors ${h.has(a)?"bg-primary border-primary text-primary-foreground":"border-muted-foreground/30"}`,children:h.has(a)&&e.jsx(se,{className:"h-3.5 w-3.5"})})]},a)})}),e.jsxs("div",{className:"w-full max-w-sm space-y-3",children:[e.jsx(w,{className:"w-full gap-2 h-12",onClick:()=>x(Array.from(h).sort()),disabled:h.size===0,children:h.size>0?m("aiRecipe.shareSelected","åˆ†äº« {{count}} é“èœåˆ°ç¤¾åŒº",{count:h.size}):m("aiRecipe.shareToComm","åˆ†äº«åˆ°ç¤¾åŒº")}),e.jsxs(w,{variant:"outline",className:"w-full gap-2",onClick:p,children:[e.jsx(xe,{className:"h-4 w-4"}),m("aiRecipe.noThanks","æš‚æ—¶ä¸åˆ†äº«")]})]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center max-w-xs",children:m("aiRecipe.shareNote","åˆ†äº«éœ€è¦æ‹æ‘„æˆå“ç…§ç‰‡è¿›è¡ŒéªŒè¯ï¼Œä»¥ç¡®ä¿å†…å®¹çœŸå®å¯é ")})]})},He=["photo","confirm","preferences","generating","select","detail","cooking","share-prompt","result","publish"],Q="ai-recipe-session",dt=()=>{try{const s=sessionStorage.getItem(Q);if(s)return JSON.parse(s)}catch{}return{}},It=()=>{const{t:s}=L(),f=As(),p=Ts().state?.from||"/ai-recipe",{requireLogin:j}=Ks(),{identifyIngredients:u,generateRecipes:o,generateRecipeImages:m,verifyResultPhoto:n,uploadImage:h,isIdentifying:c,isGenerating:N,isVerifying:g,isGeneratingImages:D}=Gs(),[I,P]=d.useState(!1),R=Ws(),{saveRecipe:l,deleteRecipe:i,isSaving:a}=Js(),[t]=d.useState(()=>dt()),y=!!(t.step&&t.step!=="photo"&&t.step!=="generating"&&(t.ingredients?.length||t.recipes?.length)),[b,U]=d.useState(y),[E,W]=d.useState(!y),[_,v]=d.useState("photo"),[O,Re]=d.useState([]),[H,te]=d.useState([]),[G,ae]=d.useState({}),[T,ie]=d.useState([]),ne=d.useRef([]),[Je,Ie]=d.useState([]),[De,J]=d.useState(0),[F,le]=d.useState([]),[V,re]=d.useState(""),[he,ce]=d.useState(!1),[Pe,ge]=d.useState(""),[Ke,qe]=d.useState([]),Xe=()=>{v(t.step&&t.step!=="generating"?t.step:"photo"),Re(t.ingredientImageUrls||[]),te(t.ingredients||[]),ae(t.preferences||{});const r=t.recipes||[];ne.current=r,ie(r),J(t.publishingDishIndex||0),le(t.publishQueue||[]),re(t.resultImageUrl||""),ce(t.photoVerified||!1),W(!0),U(!1)};d.useEffect(()=>{ne.current=T},[T]);const Ye=()=>{sessionStorage.removeItem(Q),W(!0),U(!1)},Ze=(He.indexOf(_)+1)/He.length*100;d.useEffect(()=>{if(E)try{const r=T.map(C=>({...C,image_url:C.image_url&&C.image_url.startsWith("data:")?void 0:C.image_url})),S={step:_,ingredientImageUrls:O,ingredients:H,preferences:G,recipes:r,publishingDishIndex:De,publishQueue:F,resultImageUrl:V,photoVerified:he};sessionStorage.setItem(Q,JSON.stringify(S))}catch(r){console.warn("Session save failed (quota):",r)}},[E,_,O,H,G,T,De,F,V,he]),d.useEffect(()=>{window.scrollTo({top:0,behavior:"instant"})},[_]);const k=F.length>0?T[F[0]]:null,fe=F.length>0?1:0,es=async r=>{if(!j())return;Re(r);const S=[],C=new Set;for(const z of r){const M=await u(z);if(M)for(const $ of M)C.has($.name)||(C.add($.name),S.push($))}S.length>0&&(te(S),v("confirm"))},ss=()=>{j()&&(te([]),v("confirm"))},ts=()=>{if(H.length===0){Y.error(s("aiRecipe.noIngredients","è¯·è‡³å°‘ä¿ç•™ä¸€ç§é£Ÿæ"));return}v("preferences")},as=async r=>{ae(r),await je(r)},is=async()=>{ae({}),await je({})},je=async(r,S)=>{v("generating");const C=ne.current.slice(),z=await o(H,r.difficulty,r.servings,r.dishCount,r.notes,S);z&&z.length>0?(C.length>0&&Ie(M=>M.length>0&&M[0].length===C.length&&M[0][0]?.recipe_name===C[0]?.recipe_name?M:[C,...M].slice(0,5)),ie(z),v("select"),m(z.map(M=>({recipe_name:M.recipe_name,recipe_name_en:M.recipe_name_en})),(M,$,fs)=>{ie(js=>js.map(Ne=>Ne.recipe_name===M?{...Ne,image_url:$,image_source:fs}:Ne))})):v("preferences")},ns=()=>{v("detail")},ls=async()=>{for(const r of T)await l(r)},rs=()=>{v("cooking")},cs=r=>{qe(r),v("share-prompt")},[K,q]=d.useState(null),os=r=>{le(r),q("share")},X=()=>{sessionStorage.removeItem(Q),Y.success(s("aiRecipe.cookingComplete","å¤ªæ£’äº†ï¼çƒ¹é¥ªå®Œæˆï¼")),f("/community")},ds=async r=>{for(const S of T)await l(S);q(null),r==="share"?(J(F[0]||0),v("result")):X()},ms=r=>{q(null),r==="share"?(J(F[0]||0),v("result")):X()},us=(r,S,C)=>{re(r),ce(S),C&&ge(C),S&&v("publish")},xs=async r=>{if(!(!k||!V))try{await R.mutateAsync({recipe_name:k.recipe_name,recipe_name_en:k.recipe_name_en,recipe_name_pt:k.recipe_name_pt,subtitle:k.subtitle,subtitle_en:k.subtitle_en,subtitle_pt:k.subtitle_pt,cook_time:k.cook_time,difficulty:k.difficulty,servings:k.servings,ingredients:k.ingredients,steps:k.steps.map((C,z)=>({...C,order:z+1})),cover_image:V,introduction:k.introduction||"",introduction_en:k.introduction_en,introduction_pt:k.introduction_pt,cooking_note:r?.trim()||Pe||void 0,ai_recipe_source:{source:"ai_recipe",ingredient_images:O,identified_ingredients:H,selected_recipe_index:F[0],all_recipes:T.map(C=>C.recipe_name),result_image:V,photo_verified:he}});const S=F.slice(1);le(S),S.length>0?(Y.success(s("aiRecipe.dishPublished","ç¬¬ {{n}} é“èœå·²å‘å¸ƒï¼ç»§ç»­ä¸‹ä¸€é“",{n:fe})),J(S[0]),re(""),ce(!1),ge(""),v("result")):(sessionStorage.removeItem(Q),Y.success(s("aiRecipe.allPublished","æ‰€æœ‰èœè°±å·²å‘å¸ƒåˆ°ç¤¾åŒºï¼")),f("/community"))}catch{}},Ae=()=>{const r=F.slice(1);le(r),r.length>0?(J(r[0]),re(""),ce(!1),ge(""),v("result")):(sessionStorage.removeItem(Q),Y.success(s("aiRecipe.publishDone","å‘å¸ƒå®Œæˆï¼")),f("/community"))},ps=()=>{switch(_){case"confirm":v("photo");break;case"preferences":v("confirm");break;case"select":v("preferences");break;case"detail":v("select");break;case"cooking":v("detail");break;case"share-prompt":v("cooking");break;case"result":v("share-prompt");break;case"publish":v("result");break;default:f("/ai-recipe",{replace:!0,state:{from:p}});break}},hs=()=>{switch(_){case"photo":return s("aiRecipe.stepPhoto","æ‹æ‘„é£Ÿæ");case"confirm":return s("aiRecipe.stepConfirm","ç¡®è®¤é£Ÿæ");case"preferences":return s("aiRecipe.stepPreferences","çƒ¹é¥ªåå¥½");case"generating":return s("aiRecipe.stepGenerating","ç”Ÿæˆèœè°±");case"select":return s("aiRecipe.stepMealPlan","å®Œæ•´èœå•");case"detail":return s("aiRecipe.stepDetail","èœè°±è¯¦æƒ…");case"cooking":return s("aiRecipe.stepCooking","çƒ¹é¥ªä¸­");case"share-prompt":return s("aiRecipe.stepShare","åˆ†äº«");case"result":return k?s("aiRecipe.stepResultDish","æ‹æ‘„æˆå“ ({{n}}/{{total}})",{n:fe,total:F.length+fe-1}):s("aiRecipe.stepResult","æ‹æ‘„æˆå“");case"publish":return s("aiRecipe.stepPublish","å‘å¸ƒ")}},gs=()=>{const r=t.step;return r==="select"||r==="detail"?s("aiRecipe.resumeAtSelect","å·²ç”Ÿæˆèœå•"):r==="cooking"?s("aiRecipe.resumeAtCooking","çƒ¹é¥ªä¸­"):r==="confirm"?s("aiRecipe.resumeAtConfirm","é£Ÿæç¡®è®¤"):r==="preferences"?s("aiRecipe.resumeAtPrefs","çƒ¹é¥ªåå¥½"):r==="share-prompt"||r==="result"||r==="publish"?s("aiRecipe.resumeAtShare","åˆ†äº«/å‘å¸ƒ"):""};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[b?e.jsx(Us,{open:b,onOpenChange:r=>{r||(U(!1),f("/community",{state:{openCreatePost:!0}}))},children:e.jsxs(Es,{children:[e.jsxs(Fs,{children:[e.jsxs(Os,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5 text-primary"}),s("aiRecipe.resumeTitle","æ£€æµ‹åˆ°æœªå®Œæˆçš„é£Ÿè°±")]}),e.jsxs(Ls,{className:"space-y-2",children:[e.jsx("span",{children:s("aiRecipe.resumeDesc","æ‚¨æœ‰ä¸€ä¸ªæœªå®Œæˆçš„ AI é£Ÿè°±æµç¨‹ï¼Œæ˜¯å¦è¦ç»§ç»­ï¼Ÿ")}),t.recipes&&t.recipes.length>0&&e.jsx("span",{className:"block text-xs mt-2 bg-muted rounded-lg px-3 py-2",children:t.recipes.map(r=>r.recipe_name).join("ã€")}),e.jsx("span",{className:"block text-xs text-muted-foreground",children:s("aiRecipe.resumeProgress","è¿›åº¦ï¼š{{step}}",{step:gs()})})]})]}),e.jsxs($s,{className:"flex-col sm:flex-row gap-2",children:[e.jsx(w,{variant:"outline",onClick:Ye,children:s("aiRecipe.startNew","é‡æ–°å¼€å§‹")}),e.jsx(w,{onClick:Xe,children:s("aiRecipe.resumeContinue","ç»§ç»­ä¸Šæ¬¡")})]})]})}):null,!b&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 py-3 border-b bg-background shrink-0 sticky top-14 z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("button",{onClick:_==="publish"||_==="share-prompt"?()=>P(!0):ps,className:"p-1 -ml-1 hover:bg-muted rounded-md",children:_==="publish"||_==="share-prompt"?e.jsx(xe,{className:"h-5 w-5"}):e.jsx(zs,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4 text-primary"}),e.jsx("h2",{className:"font-medium",children:hs()})]}),e.jsx("div",{className:"w-6"})]}),e.jsx(Bs,{value:Ze,className:"h-1"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 max-w-lg mx-auto w-full",children:[_==="photo"&&e.jsx(st,{onPhotosUploaded:es,onSkipToManual:ss,uploadImage:h,isUploading:c,initialImageUrls:O,onRequireLogin:j}),c&&e.jsxs("div",{className:"flex flex-col items-center gap-3 py-12",children:[e.jsx(ee,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx(ze,{messages:[s("aiRecipe.identifying.1","AI æ­£åœ¨è¯†åˆ«é£Ÿæ..."),s("aiRecipe.identifying.2","åˆ†æé£Ÿæç§ç±»ä¸æ•°é‡..."),s("aiRecipe.identifying.3","å³å°†å®Œæˆè¯†åˆ«...")]})]}),_==="confirm"&&!c&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(tt,{ingredients:H,onChange:te}),e.jsx(w,{className:"w-full",onClick:ts,children:s("aiRecipe.nextStep","ä¸‹ä¸€æ­¥")})]}),_==="preferences"&&e.jsx(it,{onConfirm:as,onSkip:is,initialValues:G}),_==="generating"&&e.jsxs("div",{className:"flex flex-col items-center gap-3 py-12",children:[e.jsx(ee,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx(ze,{messages:[s("aiRecipe.generating.1","AI æ­£åœ¨ä¸ºæ‚¨è®¾è®¡ä¸€æ¡Œèœ..."),s("aiRecipe.generating.2","æ­é…è¥å…»å‡è¡¡çš„é£Ÿè°±..."),s("aiRecipe.generating.3","è®¡ç®—æœ€ä½³çƒ¹é¥ªé¡ºåº..."),s("aiRecipe.generating.4","ç”Ÿæˆè¯¦ç»†çƒ¹é¥ªæ­¥éª¤..."),s("aiRecipe.generating.5","å³å°†å®Œæˆï¼Œè¯·ç¨å€™...")]})]}),_==="select"&&e.jsx(nt,{recipes:T,recipeHistory:Je,onSelectHistoryMeal:r=>{const S=ne.current.slice();Ie(C=>{const z=C.filter($=>$!==r);return S.length===0||z.length>0&&z[0][0]?.recipe_name===S[0]?.recipe_name&&z[0].length===S.length?z:[S,...z].slice(0,5)}),ie(r)},onConfirmMeal:ns,onRegenerate:r=>{const S=T.map(z=>z.recipe_name),C={...G,notes:r!==void 0?r:G.notes};ae(C),je(C,S)},isRegenerating:N,preferences:G,isLoadingImages:D}),_==="detail"&&T.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(lt,{recipes:T}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(w,{variant:"outline",className:"flex-1",onClick:()=>v("select"),children:s("aiRecipe.changeMeal","æ¢ä¸€æ¡Œ")}),e.jsxs(w,{variant:"outline",className:"gap-1",onClick:ls,disabled:a,children:[e.jsx(me,{className:"h-4 w-4"}),s("aiRecipe.saveAll","å…¨éƒ¨ä¿å­˜")]}),e.jsx(w,{className:"flex-1",onClick:rs,children:s("aiRecipe.startCooking","å¼€å§‹çƒ¹é¥ª")})]})]}),_==="cooking"&&T.length>0&&e.jsx(ct,{recipes:T,ingredientImageUrl:O[0]||"",onComplete:cs,onBack:()=>v("detail")}),_==="share-prompt"&&T.length>0&&e.jsx("div",{className:"space-y-4",children:e.jsx(ot,{recipes:T,skippedIndices:Ke,onShare:os,onSkip:()=>q("skip"),onSaveRecipe:l,onUnsaveRecipe:i,isSaving:a})}),e.jsx(Me,{open:!!K,onOpenChange:r=>!r&&q(null),children:e.jsxs(Ue,{children:[e.jsxs(Ee,{children:[e.jsx(Fe,{children:s("aiRecipe.saveBeforeTitle","ä¿å­˜é£Ÿè°±ï¼Ÿ")}),e.jsx(Oe,{children:s("aiRecipe.saveBeforeDescMeal","æ˜¯å¦å°†è¿™æ¡Œèœçš„æ‰€æœ‰é£Ÿè°±ä¿å­˜åˆ°æ‚¨çš„æ”¶è—ä¸­ï¼Ÿ")})]}),e.jsxs(Le,{className:"flex-col sm:flex-row gap-2",children:[e.jsx($e,{onClick:()=>K&&ms(K),children:s("aiRecipe.noSave","ä¸ä¿å­˜")}),e.jsxs(oe,{onClick:()=>K&&ds(K),disabled:a,children:[e.jsx(me,{className:"h-4 w-4 mr-1"}),s("aiRecipe.saveAllRecipes","ä¿å­˜å…¨éƒ¨é£Ÿè°±")]})]})]})}),_==="result"&&k&&e.jsxs("div",{className:"space-y-4",children:[F.length>0&&e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl border bg-muted/30",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden bg-muted shrink-0",children:k.image_url?e.jsx("img",{src:k.image_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-lg",children:"ğŸ½ï¸"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:k.recipe_name}),k.subtitle&&e.jsx("p",{className:"text-xs text-muted-foreground italic truncate",children:k.subtitle})]}),F.length>1&&e.jsxs(w,{variant:"ghost",size:"sm",className:"text-xs shrink-0",onClick:Ae,children:[e.jsx(ke,{className:"h-3.5 w-3.5 mr-1"}),s("aiRecipe.skipThisDish","è·³è¿‡")]})]}),e.jsx(Vs,{onPhotoVerified:us,uploadImage:h,verifyPhoto:n,recipeName:k.recipe_name,isVerifying:g})]}),_==="publish"&&k&&e.jsx(Qs,{resultImageUrl:V,recipeName:k.recipe_name,initialNote:Pe,onPublish:xs,onSkip:Ae,isPublishing:R.isPending}),e.jsx(Me,{open:I,onOpenChange:P,children:e.jsxs(Ue,{children:[e.jsxs(Ee,{children:[e.jsx(Fe,{children:_==="share-prompt"?s("aiRecipe.exitShareTitle","ç¡®è®¤é€€å‡ºï¼Ÿ"):s("aiRecipe.closeConfirmTitle","ç¡®è®¤ç¦»å¼€ï¼Ÿ")}),e.jsx(Oe,{children:_==="share-prompt"?s("aiRecipe.exitShareDesc","æ‚¨è¿˜æ²¡æœ‰ä¿å­˜é£Ÿè°±ï¼Œé€€å‡ºåé£Ÿè°±å°†ä¸¢å¤±ã€‚æ˜¯å¦å…ˆä¿å­˜ï¼Ÿ"):s("aiRecipe.closeConfirmDesc","ç¦»å¼€åå°†æ”¾å¼ƒå‘å¸ƒï¼Œæ‚¨çš„æˆå“ç…§ç‰‡å’Œé£Ÿè°±å°†ä¸ä¼šä¿å­˜åˆ°ç¤¾åŒºã€‚")})]}),e.jsxs(Le,{className:"flex-col sm:flex-row gap-2",children:[e.jsx($e,{children:s("common.cancel","å–æ¶ˆ")}),_==="share-prompt"?e.jsxs(e.Fragment,{children:[e.jsxs(oe,{onClick:async()=>{for(const r of T)await l(r);P(!1),X()},disabled:a,children:[e.jsx(me,{className:"h-4 w-4 mr-1"}),s("aiRecipe.saveAndExit","ä¿å­˜å¹¶é€€å‡º")]}),e.jsx(oe,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:()=>{P(!1),X()},children:s("aiRecipe.exitWithoutSave","ä¸ä¿å­˜ï¼Œç›´æ¥é€€å‡º")})]}):e.jsx(oe,{onClick:X,children:s("aiRecipe.confirmLeave","ç¡®è®¤ç¦»å¼€")})]})]})})]})]})]})};export{It as default};
//# sourceMappingURL=AIRecipe-Dk_SNEmT.js.map
