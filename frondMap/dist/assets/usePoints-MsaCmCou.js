import{a,u as d,b as p}from"./vendor-query-EnOED-MY.js";import{u as m,s as i,aH as o}from"./index-ChGLUOfd.js";import{u as y}from"./vendor-i18n-DWR4v88Y.js";const w=()=>{const{user:t}=m();return a({queryKey:["user-points",t?.id],queryFn:async()=>{if(!t?.id)return 0;const{data:s,error:e}=await i.from("profiles").select("points").eq("id",t.id).single();if(e)throw e;return s?.points??0},enabled:!!t?.id})},g=t=>{const{user:s}=m(),e=s?.id;return a({queryKey:["points-transactions",e],queryFn:async()=>{if(!e)return[];const{data:r,error:n}=await i.from("points_transactions").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(n)throw n;return r},enabled:!!e})},v=t=>a({queryKey:["all-points-transactions",t],queryFn:async()=>{let s=i.from("points_transactions").select(`
          *,
          profiles:user_id (
            id,
            display_name,
            avatar_url
          )
        `).order("created_at",{ascending:!1}).limit(500);const{data:e,error:r}=await s;if(r)throw r;return e}}),K=()=>a({queryKey:["points-settings"],queryFn:async()=>{const{data:t,error:s}=await i.from("points_settings").select("*");if(s)throw s;return t}}),h=()=>{const{t}=y(),s=d();return p({mutationFn:async({key:e,value:r})=>{const{error:n}=await i.from("points_settings").update({value:r,updated_at:new Date().toISOString()}).eq("key",e);if(n)throw n},onSuccess:()=>{s.invalidateQueries({queryKey:["points-settings"]}),o({title:t("common.success"),description:t("admin.points.settingUpdated")})},onError:()=>{o({title:t("common.error"),description:t("common.errorOccurred"),variant:"destructive"})}})},S=()=>{const{t}=y(),s=d();return p({mutationFn:async({userId:e,amount:r,reason:n})=>{const{data:l,error:c}=await i.rpc("admin_modify_points",{p_target_user_id:e,p_amount:r,p_reason:n});if(c)throw c;const u=l;if(!u.success)throw new Error(u.error||"Unknown error");return u},onSuccess:(e,r)=>{s.invalidateQueries({queryKey:["user-points"]}),s.invalidateQueries({queryKey:["points-transactions"]}),s.invalidateQueries({queryKey:["all-points-transactions"]}),s.invalidateQueries({queryKey:["profiles"]}),o({title:t("common.success"),description:r.amount>0?t("admin.points.grantSuccess"):t("admin.points.deductSuccess")})},onError:e=>{o({title:t("common.error"),description:e.message==="insufficient_points"?t("admin.points.insufficientPoints"):t("common.errorOccurred"),variant:"destructive"})}})};export{S as a,v as b,K as c,h as d,w as e,g as u};
//# sourceMappingURL=usePoints-MsaCmCou.js.map
