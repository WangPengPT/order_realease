import{j as e}from"./vendor-ui-DAmPMpEA.js";import{r as t}from"./vendor-react-iAJ0IrSD.js";import{x as oe,C as d,j as c,I as _,B as r,X as me,q as f,Y as de,Z as ce,_ as ue,L as xe,D as k,a as B,b as $,c as M,$ as A,a6 as L,a7 as P,a8 as T,a9 as E,aa as z,ab as V,a2 as F,an as he}from"./index-BcrfGQEh.js";import{i as pe,v as je,w as ge,x as fe,y as Ne}from"./useAdmin-jXgzqV2H.js";import{u as be}from"./useInfiniteScroll-ZuOE9FjP.js";import{U as ve}from"./UserProfileDialog-nQaU7EW9.js";import{u as ye}from"./vendor-i18n-DxKeo2S1.js";import{S as we}from"./shield-alert-DewI1FnT.js";import{U as O}from"./users-B1UqT5l5.js";import{B as H}from"./ban-BgXjBYQA.js";import{V as Q}from"./volume-x-DCede4Rw.js";import{S as Ce}from"./search-DYCHfSrp.js";import{E as Se}from"./eye-CrXJhp4G.js";import{U as Re}from"./user-check-Ccn1SqRm.js";import{V as Ue}from"./volume-2-BCDvozzC.js";import{B as Ie}from"./briefcase-B385EK3a.js";import"./vendor-charts-Bz7hPIBd.js";import"./vendor-query-BlSVl3IQ.js";import"./vendor-supabase-KNAP0qdW.js";import"./separator-CM8vz3w9.js";import"./useLocalizedContent-tJ7i_ycU.js";import"./arrow-left-4K88mBFI.js";import"./clock-DGED8Oob.js";import"./heart-ClAJibHi.js";import"./star-DqKRai6M.js";import"./external-link-C5GWMUy2.js";const De=["spam","harassment","inappropriate_content","fraud","terms_violation","other"],_e=["spam_comments","inappropriate_language","repeated_warnings","temporary_restriction","other"],rs=()=>{const{t:a}=ye(),{isAdmin:X}=oe(),{data:n,isLoading:q}=pe(),Y=je(),Z=ge(),G=fe(),J=Ne(),[l,y]=t.useState(""),[i,u]=t.useState({open:!1,userId:"",userName:""}),[x,w]=t.useState("other"),[h,C]=t.useState(""),[o,p]=t.useState({open:!1,userId:"",userName:""}),[j,S]=t.useState("other"),[g,R]=t.useState(""),[N,U]=t.useState("7"),[m,I]=t.useState({open:!1,userId:"",userName:"",userRole:""}),b=t.useMemo(()=>n?{total:n.length,banned:n.filter(s=>s.is_banned).length,muted:n.filter(s=>s.is_muted).length}:{total:0,banned:0,muted:0},[n]),v=t.useMemo(()=>n?n.filter(s=>l===""||s.display_name.toLowerCase().includes(l.toLowerCase())||s.phone?.toLowerCase().includes(l.toLowerCase())||s.email?.toLowerCase().includes(l.toLowerCase())):[],[n,l]),{displayedData:K,hasMore:W,reset:D,displayedCount:ee,sentinelRef:se}=be({data:v,initialItemsPerPage:30,incrementPerPage:30});t.useEffect(()=>{D()},[l,D]);const ae=()=>x==="other"?h:h?`${a(`admin.banReasons.${x}`)}: ${h}`:a(`admin.banReasons.${x}`),te=()=>j==="other"?g:g?`${a(`admin.muteReasons.${j}`)}: ${g}`:a(`admin.muteReasons.${j}`),re=()=>{i.userId&&Y.mutate({userId:i.userId,banReason:ae()},{onSuccess:()=>{u({open:!1,userId:"",userName:""}),w("other"),C("")}})},ne=()=>{if(!o.userId)return;const s=N?new Date(Date.now()+parseInt(N)*24*60*60*1e3).toISOString():void 0;G.mutate({userId:o.userId,muteReason:te(),mutedUntil:s},{onSuccess:()=>{p({open:!1,userId:"",userName:""}),S("other"),R(""),U("7")}})},le=s=>{switch(s){case"admin":return"bg-primary text-primary-foreground";case"supervisor":return"bg-blue-500 text-white";case"merchant":return"bg-emerald-500 text-white";default:return"bg-muted text-muted-foreground"}},ie=s=>{switch(s){case"admin":case"supervisor":return e.jsx(he,{className:"h-3.5 w-3.5"});case"merchant":return e.jsx(Ie,{className:"h-3.5 w-3.5"});default:return e.jsx(O,{className:"h-3.5 w-3.5"})}};return q?e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:a("common.loading")})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(we,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:a("admin.userSecurity")}),e.jsx("p",{className:"text-muted-foreground",children:a("admin.userSecurityDesc")})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(d,{className:"bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20",children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:a("admin.totalUsersLabel")}),e.jsx("p",{className:"text-2xl font-bold",children:b.total})]}),e.jsx(O,{className:"h-8 w-8 text-primary/60"})]})})}),e.jsx(d,{className:"bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200 dark:from-orange-950/20 dark:to-orange-900/20 dark:border-orange-900/30",children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:a("admin.bannedCount")}),e.jsx("p",{className:"text-2xl font-bold",children:b.banned})]}),e.jsx(H,{className:"h-8 w-8 text-orange-500"})]})})}),e.jsx(d,{className:"bg-gradient-to-br from-yellow-50 to-yellow-100 border-yellow-200 dark:from-yellow-950/20 dark:to-yellow-900/20 dark:border-yellow-900/30",children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:a("admin.mutedCount")}),e.jsx("p",{className:"text-2xl font-bold",children:b.muted})]}),e.jsx(Q,{className:"h-8 w-8 text-yellow-500"})]})})})]}),e.jsx(d,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(_,{placeholder:a("admin.searchUserPlaceholder"),value:l,onChange:s=>y(s.target.value),className:"pl-10 pr-10"}),l&&e.jsx(r,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-7 w-7 p-0",onClick:()=>y(""),children:e.jsx(me,{className:"h-4 w-4"})})]})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(f,{variant:"secondary",className:"text-xs",children:[ee," / ",v?.length||0," ",a("admin.totalUsersLabel")]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:K?.map(s=>e.jsx(d,{className:`transition-all duration-200 hover:shadow-md ${s.is_banned?"border-orange-300 bg-orange-50/50 dark:bg-orange-950/20":""} ${s.is_muted?"border-yellow-300 bg-yellow-50/50 dark:bg-yellow-950/20":""}`,children:e.jsxs(c,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(de,{className:"h-12 w-12",children:[e.jsx(ce,{src:s.avatar_url,alt:s.display_name}),e.jsx(ue,{children:s.display_name.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h3",{className:"font-semibold truncate",children:s.display_name}),s.is_banned&&e.jsx(f,{variant:"outline",className:"text-xs text-orange-500 border-orange-300",children:a("admin.banned")}),s.is_muted&&e.jsx(f,{variant:"outline",className:"text-xs text-yellow-500 border-yellow-300",children:a("admin.muted")})]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.email}),e.jsxs(f,{className:`${le(s.role)} text-xs mt-1`,children:[ie(s.role),e.jsx("span",{className:"ml-1 capitalize",children:s.role})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4 pt-3 border-t",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>I({open:!0,userId:s.id,userName:s.display_name,userRole:s.role}),children:[e.jsx(Se,{className:"h-4 w-4 mr-1"}),a("admin.viewProfile")]}),X&&s.role!=="admin"&&e.jsxs(e.Fragment,{children:[s.is_banned?e.jsxs(r,{variant:"outline",size:"sm",className:"text-green-600 border-green-300 hover:bg-green-50",onClick:()=>Z.mutate(s.id),children:[e.jsx(Re,{className:"h-4 w-4 mr-1"}),a("admin.unban")]}):e.jsxs(r,{variant:"outline",size:"sm",className:"text-orange-600 border-orange-300 hover:bg-orange-50",onClick:()=>u({open:!0,userId:s.id,userName:s.display_name}),children:[e.jsx(H,{className:"h-4 w-4 mr-1"}),a("admin.ban")]}),s.is_muted?e.jsxs(r,{variant:"outline",size:"sm",className:"text-green-600 border-green-300 hover:bg-green-50",onClick:()=>J.mutate(s.id),children:[e.jsx(Ue,{className:"h-4 w-4 mr-1"}),a("admin.unmute")]}):e.jsxs(r,{variant:"outline",size:"sm",className:"text-yellow-600 border-yellow-300 hover:bg-yellow-50",onClick:()=>p({open:!0,userId:s.id,userName:s.display_name}),children:[e.jsx(Q,{className:"h-4 w-4 mr-1"}),a("admin.mute")]})]})]})]})},s.id))}),W&&e.jsx("div",{ref:se,className:"flex justify-center py-4",children:e.jsx(xe,{className:"h-6 w-6 animate-spin text-muted-foreground"})})]}),v?.length===0&&e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:a("admin.noUsersFound")}),e.jsx(k,{open:i.open,onOpenChange:s=>u({...i,open:s}),children:e.jsxs(B,{children:[e.jsxs($,{children:[e.jsx(M,{children:a("admin.banUser")}),e.jsx(A,{children:a("admin.banUserConfirm",{name:i.userName})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:a("admin.selectBanReason")}),e.jsxs(L,{value:x,onValueChange:w,children:[e.jsx(P,{className:"mt-1",children:e.jsx(T,{})}),e.jsx(E,{children:De.map(s=>e.jsx(z,{value:s,children:a(`admin.banReasons.${s}`)},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:a("admin.additionalDetails")}),e.jsx(V,{placeholder:a("admin.banReasonPlaceholder"),value:h,onChange:s=>C(s.target.value),className:"mt-1"})]})]}),e.jsxs(F,{children:[e.jsx(r,{variant:"outline",onClick:()=>u({open:!1,userId:"",userName:""}),children:a("common.cancel")}),e.jsx(r,{variant:"destructive",onClick:re,children:a("admin.confirmBan")})]})]})}),e.jsx(k,{open:o.open,onOpenChange:s=>p({...o,open:s}),children:e.jsxs(B,{children:[e.jsxs($,{children:[e.jsx(M,{children:a("admin.muteUser")}),e.jsx(A,{children:a("admin.muteUserConfirm",{name:o.userName})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:a("admin.muteDuration")}),e.jsx(_,{type:"number",placeholder:"7",value:N,onChange:s=>U(s.target.value),className:"mt-1"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a("admin.muteDurationHint")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:a("admin.selectMuteReason")}),e.jsxs(L,{value:j,onValueChange:S,children:[e.jsx(P,{className:"mt-1",children:e.jsx(T,{})}),e.jsx(E,{children:_e.map(s=>e.jsx(z,{value:s,children:a(`admin.muteReasons.${s}`)},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:a("admin.additionalDetails")}),e.jsx(V,{placeholder:a("admin.muteReasonPlaceholder"),value:g,onChange:s=>R(s.target.value),className:"mt-1"})]})]}),e.jsxs(F,{children:[e.jsx(r,{variant:"outline",onClick:()=>p({open:!1,userId:"",userName:""}),children:a("common.cancel")}),e.jsx(r,{variant:"destructive",onClick:ne,children:a("admin.confirmMute")})]})]})}),e.jsx(ve,{open:m.open,onOpenChange:s=>I({...m,open:s}),userId:m.userId,userName:m.userName,userRole:m.userRole})]})};export{rs as default};
//# sourceMappingURL=AdminUserSecurity-CsdlNLSM.js.map
