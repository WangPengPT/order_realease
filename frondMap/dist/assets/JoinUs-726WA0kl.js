import{p as $,c5 as A,r as j,bH as O,bL as R,j as e,c6 as H,y as B,M as Q,ba as X,an as J,aM as w,a4 as W,X as G,L as S,bs as K}from"./vendor-react-COnB1Bf9.js";import{b as Y,C as I,q as F,B as M,p as Z,F as ee,$ as se,I as h,X as g,i as te,o as ne,s as ae}from"./index-B-ATr_p9.js";import{C as ie}from"./checkbox-Dwf34iWO.js";import{F as re,a as l,b as c,c as d,d as m,e as u,f as oe}from"./form-CW4HFyhy.js";import{d as le}from"./useInvitationCodes-DduGPKAf.js";import{N as ce,O as p,P as de,Q as me}from"./vendor-utils-Z4kpnli5.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-CK3nEoYK.js";const k=["booking","delivery","qrcode"],be=()=>{const{t:s,i18n:_}=$(),[v]=A(),[b,N]=j.useState(!1),[P,y]=j.useState(!1),{settings:a}=Y(),q=le(),[o,x]=j.useState({isValidating:!1,isValid:null,inviterUserId:null}),E=j.useMemo(()=>ce({name:p().min(2,{message:s("joinUs.nameMin")}),email:p().email({message:s("joinUs.emailInvalid")}),phone:p().min(6,{message:s("joinUs.phoneMin")}),restaurant_name:p().min(2,{message:s("joinUs.restaurantNameMin")}),restaurant_address:p().min(2,{message:s("joinUs.addressMin")}),features_selected:de(me(k)).min(1,{message:s("joinUs.featuresMin")}),invitation_code:p().optional()}),[s]),i=O({resolver:R(E),defaultValues:{name:"",email:"",phone:"",restaurant_name:"",restaurant_address:"",features_selected:[],invitation_code:v.get("code")||""}}),r=i.watch("features_selected")?.includes("qrcode");j.useEffect(()=>{const t=v.get("code");t&&r&&C(t)},[v,r]),j.useEffect(()=>{r||(i.setValue("invitation_code",""),x({isValidating:!1,isValid:null,inviterUserId:null}))},[r,i]);const C=async t=>{if(!t||t.length<6){x({isValidating:!1,isValid:null,inviterUserId:null});return}x({isValidating:!0,isValid:null,inviterUserId:null});try{const n=await q.mutateAsync(t);x(n?{isValidating:!1,isValid:!0,inviterUserId:n.user_id}:{isValidating:!1,isValid:!1,inviterUserId:null})}catch{x({isValidating:!1,isValid:!1,inviterUserId:null})}},T=async t=>{N(!0);try{const n=_.language||"en",{error:f}=await ae.functions.invoke("send-join-request-email",{body:{...t,language:n,invitation_code:o.isValid?t.invitation_code:null,invited_by_user_id:o.inviterUserId}});if(f){if(f.message.includes("rate_limit_exceeded"))g({title:s("joinUs.rateLimitError"),description:s("joinUs.rateLimitErrorDesc"),variant:"destructive"});else throw f;return}y(!0),i.reset(),g({title:s("joinUs.successTitle"),description:s("joinUs.successDescription")})}catch(n){console.error("Error submitting join request:",n),g({title:s("common.error"),description:s("joinUs.submitError"),variant:"destructive"})}finally{N(!1)}},L=()=>{const t=_.language;return t==="zh"&&a?.join_success_title_zh?a.join_success_title_zh:t==="pt"&&a?.join_success_title_pt?a.join_success_title_pt:a?.join_success_title_en?a.join_success_title_en:s("joinUs.successTitle")},z=()=>{const t=_.language;return t==="zh"&&a?.join_success_message_zh?a.join_success_message_zh:t==="pt"&&a?.join_success_message_pt?a.join_success_message_pt:a?.join_success_message_en?a.join_success_message_en:s("joinUs.successMessage")},V=a?.join_contact_phone||"968815050",U=a?.contact_email;return P?e.jsx("div",{className:"min-h-screen pt-20 pb-12 px-4 bg-secondary/20",children:e.jsx("div",{className:"container mx-auto max-w-2xl",children:e.jsx(I,{className:"border-primary",children:e.jsxs(F,{className:"pt-12 pb-12 text-center",children:[e.jsx(H,{className:"w-16 h-16 text-primary mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-4",children:L()}),e.jsx("p",{className:"text-muted-foreground mb-4 max-w-md mx-auto",children:z()}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4 mb-6",children:[e.jsxs("a",{href:`tel:${V}`,className:"flex items-center gap-2 text-primary font-semibold hover:underline",children:[e.jsx(B,{className:"w-5 h-5"}),e.jsx("span",{children:V})]}),U&&e.jsxs("a",{href:`mailto:${U}`,className:"flex items-center gap-2 text-primary font-semibold hover:underline",children:[e.jsx(Q,{className:"w-5 h-5"}),e.jsx("span",{children:U})]})]}),e.jsx(M,{onClick:()=>y(!1),children:s("joinUs.submitAnother")})]})})})}):e.jsx("div",{className:"min-h-screen pt-4 pb-12 px-4 bg-secondary/20",children:e.jsx("div",{className:"container mx-auto max-w-3xl",children:e.jsxs(I,{children:[e.jsxs(Z,{className:"text-center space-y-2",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(X,{className:"w-12 h-12 text-primary"})}),e.jsx(ee,{className:"text-3xl font-bold",children:s("joinUs.title")}),e.jsx(se,{className:"text-base",children:s("joinUs.description")})]}),e.jsx(F,{children:e.jsx(re,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(T),className:"space-y-6",children:[e.jsx(l,{control:i.control,name:"name",render:({field:t})=>e.jsxs(c,{children:[e.jsx(d,{children:s("joinUs.name")}),e.jsx(m,{children:e.jsx(h,{placeholder:s("joinUs.namePlaceholder"),...t})}),e.jsx(u,{})]})}),e.jsx(l,{control:i.control,name:"email",render:({field:t})=>e.jsxs(c,{children:[e.jsx(d,{children:s("joinUs.email")}),e.jsx(m,{children:e.jsx(h,{type:"email",placeholder:s("joinUs.emailPlaceholder"),...t})}),e.jsx(u,{})]})}),e.jsx(l,{control:i.control,name:"phone",render:({field:t})=>e.jsxs(c,{children:[e.jsx(d,{children:s("joinUs.phone")}),e.jsx(m,{children:e.jsx(h,{type:"tel",placeholder:s("joinUs.phonePlaceholder"),...t})}),e.jsx(u,{})]})}),e.jsx(l,{control:i.control,name:"restaurant_name",render:({field:t})=>e.jsxs(c,{children:[e.jsx(d,{children:s("joinUs.restaurantName")}),e.jsx(m,{children:e.jsx(h,{placeholder:s("joinUs.restaurantNamePlaceholder"),...t})}),e.jsx(u,{})]})}),e.jsx(l,{control:i.control,name:"restaurant_address",render:({field:t})=>e.jsxs(c,{children:[e.jsx(d,{children:s("joinUs.restaurantAddress")}),e.jsx(m,{children:e.jsx(h,{placeholder:s("joinUs.restaurantAddressPlaceholder"),...t})}),e.jsx(u,{})]})}),e.jsx(l,{control:i.control,name:"features_selected",render:()=>e.jsxs(c,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(d,{children:s("joinUs.featuresNeeded")}),e.jsx(oe,{children:s("joinUs.featuresDescription")})]}),k.map(t=>e.jsx(l,{control:i.control,name:"features_selected",render:({field:n})=>e.jsxs(c,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(m,{children:e.jsx(ie,{checked:n.value?.includes(t),onCheckedChange:f=>f?n.onChange([...n.value,t]):n.onChange(n.value?.filter(D=>D!==t))})}),e.jsx(d,{className:"font-normal cursor-pointer",children:s(`joinUs.feature.${t}`)})]},t)},t)),e.jsx(u,{})]})}),e.jsx(l,{control:i.control,name:"invitation_code",render:({field:t})=>e.jsxs(c,{children:[e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),s("joinUs.invitationCode"),e.jsxs("span",{className:"text-muted-foreground font-normal text-xs",children:["(",s("joinUs.optional"),")"]})]}),e.jsx(m,{children:e.jsxs("div",{className:"relative",children:[e.jsx(h,{placeholder:s("joinUs.invitationCodePlaceholder","如有邀请码请输入"),...t,disabled:!r,onChange:n=>{t.onChange(n),r&&C(n.target.value)},onFocus:()=>{r||g({title:s("joinUs.qrcodeRequired","请先勾选扫码点餐"),description:s("joinUs.qrcodeRequiredDesc","只有选择扫码点餐功能后才能使用邀请码")})},className:te("pr-10",!r&&"cursor-not-allowed opacity-50")}),r&&o.isValidating&&e.jsx(w,{className:"w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 animate-spin text-muted-foreground"}),r&&!o.isValidating&&o.isValid===!0&&e.jsx(W,{className:"w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 text-green-500"}),r&&!o.isValidating&&o.isValid===!1&&t.value&&e.jsx(G,{className:"w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 text-red-500"})]})}),!r&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s("joinUs.qrcodeRequiredHint","需要勾选扫码点餐功能后才能填写邀请码")}),r&&o.isValid===!0&&e.jsx("p",{className:"text-xs text-green-600",children:s("joinUs.invitationCodeValid","邀请码有效")}),r&&o.isValid===!1&&t.value&&e.jsx("p",{className:"text-xs text-red-600",children:s("joinUs.invitationCodeInvalid","邀请码无效")}),e.jsx(u,{})]})}),e.jsxs("div",{className:"text-xs text-muted-foreground text-center pb-4",children:[s("joinUs.consentText")," ",e.jsx(S,{to:"/privacy-policy",className:"text-primary hover:underline",children:s("joinUs.privacyPolicy")})," ",s("joinUs.and")," ",e.jsx(S,{to:"/terms-of-service",className:"text-primary hover:underline",children:s("joinUs.termsOfService")})]}),e.jsxs(M,{type:"submit",className:"w-full",size:"lg",disabled:b,children:[b&&e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}),s("joinUs.submit")]}),e.jsx("div",{className:"text-center pt-4",children:e.jsxs("button",{type:"button",onClick:()=>ne("https://xiaoxiong.pt/en/pages/subscription"),className:"inline-flex items-center gap-1 text-sm text-primary hover:underline",children:[s("joinUs.visitOurWebsite","访问我们的官网查看详细信息"),e.jsx(K,{className:"w-3 h-3"})]})})]})})})]})})})};export{be as default};
//# sourceMappingURL=JoinUs-726WA0kl.js.map
