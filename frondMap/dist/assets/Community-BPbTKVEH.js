import{p as H,j as e,bM as oe,bL as se,be as ce,ao as Re,u as le,bt as me,cB as de,bl as Pe,r as a,bT as X,b2 as Ie,aM as re,a4 as Te,w as h,aO as Le,dN as Ue,X as ne,bd as qe,b0 as Ee,bi as De,cW as Me,q as _e,bY as te,dO as Ae,es as $e,b8 as Fe,b7 as Oe}from"./vendor-react-87iFmKFJ.js";import{D as Be,a0 as ze,c as Qe,d as Ge,e as He,M as ue,h as $,F as Ke,G as Ve,J as We,L as Je,ad as Xe,s as q,a as Ye,u as Ze,S as O}from"./index-BrOhGy48.js";import{P as es}from"./PostGridCard-D40TZjW8.js";import{c as ss}from"./usePoints-D5ALf_dl.js";import{R as ts,b as rs,c as is,M as as,A as ns,d as os}from"./EditRecipeDialog-Cz0bhn8M.js";import{P as cs}from"./progress-BadpfeCy.js";import{u as ls}from"./useCreateRecipe-BuEYr6mx.js";import{g as ms,h as ds,i as us,u as ps,j as xs}from"./useCommunityPosts-DKYl2zeJ.js";import{u as hs}from"./useActivities-BAx51-Kh.js";import{u as fs}from"./useRestaurants-Ch3qGF43.js";import{u as gs}from"./useLocalizedContent-CFh79NZC.js";import{P as ys}from"./PullToRefresh-BhvRBCAN.js";import{u as bs}from"./useInfiniteScroll-D740jfGn.js";import{u as js}from"./useLoginRequired-Dp0yFRaH.js";import"./vendor-i18n-AOdgFpXS.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-utils-vwQGbBim.js";import"./vendor-supabase-CQWbleDe.js";import"./drawer-CW6pNCyQ.js";import"./popover-EdXj_xX-.js";import"./collapsible-DE4DVYv9.js";const vs=()=>{const{t}=H(),{data:s}=ss(),n=s?.find(c=>c.key==="post_points")?.value||"5",g=s?.find(c=>c.key==="min_post_length")?.value||"10",u=s?.find(c=>c.key==="post_require_media")?.value==="true";return e.jsxs(Be,{children:[e.jsx(ze,{asChild:!0,children:e.jsx("button",{className:"text-primary hover:underline text-sm whitespace-nowrap",children:t("community.viewPointsRules","查看详细规则")})}),e.jsxs(Qe,{className:"max-w-md",children:[e.jsx(Ge,{children:e.jsxs(He,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-primary"}),t("community.pointsRulesTitle","发帖积分规则")]})}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:t("community.pointsRulesIntro","通过发布社区帖子获得积分，具体规则如下：")}),e.jsxs("ul",{className:"space-y-3",children:[e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(se,{className:"h-4 w-4 text-green-500 mt-0.5 shrink-0"}),e.jsx("span",{children:t("community.rulePostPoints",{points:n})})]}),e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(se,{className:"h-4 w-4 text-green-500 mt-0.5 shrink-0"}),e.jsx("span",{children:t("community.ruleMinLength",{length:g})})]}),u&&e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(se,{className:"h-4 w-4 text-green-500 mt-0.5 shrink-0"}),e.jsx("span",{children:t("community.ruleRequireMedia","帖子必须包含至少一张图片或一个视频")})]}),e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(ce,{className:"h-4 w-4 text-blue-500 mt-0.5 shrink-0"}),e.jsx("span",{children:t("community.ruleDailyLimit","每天仅可通过发帖获得一次积分奖励")})]}),e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(Re,{className:"h-4 w-4 text-purple-500 mt-0.5 shrink-0"}),e.jsx("span",{children:t("community.ruleModerationRequired","帖子需通过审核后才能获得积分")})]})]})]})]})]})},Ns=({onSelect:t})=>{const{t:s}=H(),n=le(),{isAdmin:g,isMerchant:u,isSupervisor:c}=ue(),S=g||u||c;return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:s("community.selectPostType","选择发布类型")}),e.jsx("p",{className:"text-muted-foreground text-sm mb-8 text-center",children:s("community.selectPostTypeDesc","选择您想要发布的内容类型")}),e.jsxs("div",{className:`grid gap-3 w-full max-w-md ${S?"grid-cols-3":"grid-cols-2"}`,children:[e.jsxs("button",{onClick:()=>t("post"),className:"flex flex-col items-center gap-3 p-5 rounded-xl border-2 border-border hover:border-primary hover:bg-primary/5 transition-all duration-200 group",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-primary/10 flex items-center justify-center group-hover:bg-primary/20 transition-colors",children:e.jsx(me,{className:"h-7 w-7 text-primary"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-medium text-sm",children:s("community.postType.post","发布帖子")}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("community.postType.postDesc","分享美食体验和想法")})]})]}),S&&e.jsxs("button",{onClick:()=>t("recipe"),className:"flex flex-col items-center gap-3 p-5 rounded-xl border-2 border-border hover:border-primary hover:bg-primary/5 transition-all duration-200 group",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-primary/10 flex items-center justify-center group-hover:bg-primary/20 transition-colors",children:e.jsx(de,{className:"h-7 w-7 text-primary"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-medium text-sm",children:s("community.postType.recipe","发布食谱")}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("community.postType.recipeDesc","分享烹饪教程和菜谱")})]})]}),e.jsxs("button",{onClick:()=>n("/ai-recipe",{state:{from:"/community"}}),className:"flex flex-col items-center gap-3 p-5 rounded-xl border-2 border-border hover:border-primary hover:bg-primary/5 transition-all duration-200 group relative",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-primary/10 flex items-center justify-center group-hover:bg-primary/20 transition-colors",children:e.jsx(Pe,{className:"h-7 w-7 text-primary"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-medium text-sm",children:s("community.postType.aiRecipe","AI 食谱")}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("community.postType.aiRecipeDesc","AI 识别食材并生成菜谱")})]})]})]})]})},ws=({onClose:t,onSuccess:s})=>{const{t:n}=H(),g=ls(),[u,c]=a.useState(0),[S,E]=a.useState(null),[x,y]=a.useState({recipe_name:"",cook_time:void 0,difficulty:void 0,servings:void 0}),[D,M]=a.useState([{name:"",amount:"",unit:""}]),[b,F]=a.useState([{order:1,description:""}]),[w,R]=a.useState({}),[k,_]=a.useState(""),f=[{key:"basic",title:n("recipe.step.basic","基本信息")},{key:"ingredients",title:n("recipe.step.ingredients","配料")},{key:"steps",title:n("recipe.step.steps","步骤")}],P=(u+1)/f.length*100,I=()=>x.recipe_name?.trim()?!x.cook_time||x.cook_time<1?(h.error(n("recipe.cookTimeRequired","请输入烹饪时间")),!1):x.difficulty?!x.servings||x.servings<1?(h.error(n("recipe.servingsRequired","请输入份量")),!1):!0:(h.error(n("recipe.difficultyRequired","请选择难度")),!1):(h.error(n("recipe.nameRequired","请输入食谱名称")),!1),C=()=>D.filter(v=>v.name.trim()).length===0?(h.error(n("recipe.ingredientsRequired","请至少添加一种配料")),!1):!0,o=()=>b.filter(v=>v.description.trim()).length===0?(h.error(n("recipe.stepsRequired","请至少添加一个步骤")),!1):!0,j=()=>{u===0&&!I()||u===1&&!C()||c(m=>Math.min(m+1,f.length-1))},B=()=>{c(m=>Math.max(m-1,0))},K=async()=>{if(!o())return;const m=D.filter(N=>N.name.trim()),v=b.filter(N=>N.description.trim()).map((N,Y)=>({...N,order:Y+1})),z=w.calories||w.protein||w.carbs||w.fat;try{await g.mutateAsync({recipe_name:x.recipe_name,cook_time:x.cook_time,difficulty:x.difficulty,servings:x.servings,ingredients:m,steps:v,cover_image:S,nutrition:z?w:void 0,introduction:k.trim()||void 0}),s()}catch{}},V=()=>{switch(u){case 0:return e.jsx(is,{data:x,coverImage:S,nutrition:w,introduction:k,onDataChange:y,onCoverImageChange:E,onNutritionChange:R,onIntroductionChange:_});case 1:return e.jsx(rs,{ingredients:D,onChange:M});case 2:return e.jsx(ts,{steps:b,onChange:F});default:return null}};return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b bg-background shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("button",{type:"button",onClick:t,className:"p-1 -ml-1 hover:bg-muted rounded-md transition-colors",children:e.jsx(X,{className:"h-5 w-5"})}),e.jsx("h2",{className:"font-medium",children:n("recipe.createTitle","创建食谱")}),e.jsx("div",{className:"w-6"})," "]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(cs,{value:P,className:"h-1"}),e.jsx("div",{className:"flex justify-between text-xs text-muted-foreground",children:f.map((m,v)=>e.jsx("span",{className:v===u?"text-primary font-medium":"",children:m.title},m.key))})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:V()}),e.jsx("div",{className:"px-4 py-3 pb-[max(1rem,env(safe-area-inset-bottom))] border-t bg-background shrink-0",children:e.jsxs("div",{className:"flex gap-3",children:[u>0&&e.jsxs($,{type:"button",variant:"outline",onClick:B,className:"flex-1",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),n("common.back","上一步")]}),u<f.length-1?e.jsxs($,{type:"button",onClick:j,className:"flex-1",children:[n("common.next","下一步"),e.jsx(Ie,{className:"h-4 w-4 ml-2"})]}):e.jsxs($,{type:"button",onClick:K,disabled:g.isPending,className:"flex-1",children:[g.isPending?e.jsx(re,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Te,{className:"h-4 w-4 mr-2"}),n("recipe.publish","发布食谱")]})]})})]})},ks=({trigger:t})=>{const{t:s}=H(),n=Le(),g=le(),{getLocalizedField:u}=gs(),c=ms(),{data:S}=hs(),{data:E}=fs(),{role:x,isMerchant:y,isAdmin:D,isSupervisor:M}=ue(),{data:b}=ds(),{data:F,isLoading:w}=us(),[R,k]=a.useState(!1),[_,f]=a.useState("selecting");a.useEffect(()=>{n.state?.openCreatePost&&(k(!0),f("selecting"),g(n.pathname,{replace:!0,state:{}}))},[n.state]);const[P,I]=a.useState(""),[C,o]=a.useState([]),[j,B]=a.useState(null),[K,V]=a.useState(""),[m,v]=a.useState([]),[z,N]=a.useState(!1),[Y,ie]=a.useState(!1),[pe,ae]=a.useState(!1),[Z,Q]=a.useState(!1),W=a.useRef(null),J=a.useRef(null),G=!y&&!M&&!D;a.useEffect(()=>{y&&b&&R&&v([b.id])},[y,b,R]);const ee=()=>{f("selecting"),I(""),o([]),B(null),V(""),v([]),ie(!1),ae(!1),Q(!1)};a.useEffect(()=>{R&&f("selecting")},[R]);const xe=r=>{k(r),r||ee()},he=S?.filter(r=>r.status==="published")||[],fe=async r=>{const l=r.target.files;if(!(!l||l.length===0)){if(C.length+l.length>9){h.error(s("community.maxImages","最多上传9张图片"));return}N(!0);try{const{data:{user:p}}=await q.auth.getUser();if(!p)throw new Error("Not authenticated");const i=[];for(const d of Array.from(l)){const A=d.name.split(".").pop(),T=`${p.id}/${Date.now()}-${Math.random().toString(36).substring(7)}.${A}`,{error:L}=await q.storage.from("community-posts").upload(T,d);if(L)throw L;const{data:{publicUrl:U}}=q.storage.from("community-posts").getPublicUrl(T);i.push(U)}o(d=>[...d,...i])}catch(p){console.error("Upload error:",p),h.error(s("common.uploadError","上传失败"))}finally{N(!1),W.current&&(W.current.value="")}}},ge=r=>new Promise((l,p)=>{const i=document.createElement("video"),d=document.createElement("canvas"),A=d.getContext("2d");i.preload="auto",i.muted=!0,i.playsInline=!0;let T=!1;const L=()=>{T||i.videoWidth===0||i.videoHeight===0||(d.width=i.videoWidth,d.height=i.videoHeight,A&&(A.drawImage(i,0,0,d.width,d.height),d.toBlob(U=>{U&&U.size>0?(T=!0,i.pause(),URL.revokeObjectURL(i.src),l(U)):p(new Error("Failed to create blob"))},"image/jpeg",.85)))};i.onloadedmetadata=()=>{d.width=i.videoWidth,d.height=i.videoHeight,i.currentTime=.1},i.onseeked=()=>{setTimeout(L,100)},i.onerror=()=>{URL.revokeObjectURL(i.src),p(new Error("Failed to load video"))},setTimeout(()=>{T||(URL.revokeObjectURL(i.src),p(new Error("Timeout")))},1e4),i.src=URL.createObjectURL(r),i.load()}),ye=async r=>{const l=r.target.files?.[0];if(l){if(l.size>100*1024*1024){h.error(s("community.videoTooLarge","视频不能超过100MB"));return}N(!0);try{const{data:{user:p}}=await q.auth.getUser();if(!p)throw new Error("Not authenticated");const i=l.name.split(".").pop(),d=`${p.id}/${Date.now()}.${i}`,{error:A}=await q.storage.from("community-posts").upload(d,l);if(A)throw A;const{data:{publicUrl:T}}=q.storage.from("community-posts").getPublicUrl(d);B(T);try{h.info(s("community.extractingCover","正在提取视频封面..."));const L=await ge(l),U=`${p.id}/${Date.now()}-cover.jpg`,{error:ke}=await q.storage.from("community-posts").upload(U,L);if(!ke){const{data:{publicUrl:Ce}}=q.storage.from("community-posts").getPublicUrl(U);o(Se=>[Ce,...Se]),h.success(s("community.coverExtracted","封面已自动生成"))}}catch(L){console.warn("Cover extraction failed:",L)}}catch(p){console.error("Upload error:",p),h.error(s("common.uploadError","上传失败"))}finally{N(!1),J.current&&(J.current.value="")}}},be=r=>{o(l=>l.filter((p,i)=>i!==r))},je=()=>{B(null),o(r=>r.length>0&&r[0].includes("-cover.jpg")?r.slice(1):r)},ve=async()=>{if(Q(!1),!P.trim()){h.error(s("community.contentRequired","请输入内容"));return}if(G&&m.length===0){Q(!0),h.error(s("community.restaurantRequired","请选择餐厅"));return}await c.mutateAsync({content:P,image_urls:C,video_url:j||void 0,activity_id:K||void 0,restaurant_ids:m.length>0?m:void 0}),ee(),k(!1)},Ne=()=>b?u(b,"name"):s("community.noRestaurant","未关联餐厅"),we=()=>{ee(),k(!1)};return e.jsxs(Ke,{open:R,onOpenChange:xe,children:[e.jsx(Ve,{asChild:!0,children:t||e.jsx($,{children:s("community.createPost","发布帖子")})}),e.jsxs(We,{side:"bottom",className:"h-full flex flex-col p-0 rounded-none border-0 [&>button]:hidden",children:[e.jsx(Ue,{children:e.jsx(Je,{children:s("community.createPost","发布帖子")})}),_==="selecting"&&e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b bg-background shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>k(!1),className:"p-1 -ml-1 hover:bg-muted rounded-md transition-colors",children:e.jsx(X,{className:"h-5 w-5"})}),e.jsx("span",{className:"font-medium",children:s("community.create","发布")}),e.jsx("div",{className:"w-6"})]}),e.jsx(Ns,{onSelect:f})]}),_==="recipe"&&e.jsx(ws,{onClose:()=>f("selecting"),onSuccess:we}),_==="post"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b bg-background shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>f("selecting"),className:"p-1 -ml-1 hover:bg-muted rounded-md transition-colors",children:e.jsx(X,{className:"h-5 w-5"})}),e.jsxs($,{size:"sm",onClick:ve,disabled:c.isPending||!P.trim(),className:"rounded-full px-6",children:[c.isPending&&e.jsx(re,{className:"h-4 w-4 mr-2 animate-spin"}),s("community.publish","发布")]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"px-4 py-4 space-y-4",children:[!w&&!F&&e.jsxs("div",{className:"flex items-center justify-between gap-2 px-3 py-2 bg-primary/10 dark:bg-primary/20 border border-primary/30 dark:border-primary/40 rounded-md text-sm text-primary dark:text-primary",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{children:s("community.dailyPointsHint","每日发布首个帖子可获得5积分！")})]}),e.jsx(vs,{})]}),e.jsx(Xe,{value:P,onChange:r=>I(r.target.value),placeholder:s("community.contentPlaceholder","分享你的想法..."),className:"min-h-[150px] border-none shadow-none resize-none focus-visible:ring-0 p-0 text-base whitespace-pre-wrap"}),C.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2",children:C.map((r,l)=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-muted",children:[e.jsx("img",{src:r,alt:"",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>be(l),className:"absolute top-1 right-1 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:e.jsx(ne,{className:"h-3 w-3"})})]},l))}),j&&e.jsxs("div",{className:"relative rounded-lg overflow-hidden",children:[e.jsx("video",{src:j,controls:!0,className:"w-full max-h-48",preload:"metadata"}),e.jsx("button",{type:"button",onClick:je,className:"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:e.jsx(ne,{className:"h-4 w-4"})})]})]})}),e.jsxs("div",{className:"px-4 py-2 pb-0 bg-background shrink-0 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:`flex items-center gap-3 ${Z&&G&&m.length===0?"text-destructive":""}`,children:[e.jsx(qe,{className:`h-5 w-5 shrink-0 ${Z&&G&&m.length===0?"text-destructive":"text-muted-foreground"}`}),y?e.jsx("span",{className:"text-sm text-muted-foreground",children:Ne()}):e.jsx(as,{open:Y,onOpenChange:r=>{ie(r),r&&Q(!1)},value:m,onSelect:r=>{v(r),Q(!1)},restaurants:E||[],required:G})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ee,{className:"h-5 w-5 text-muted-foreground shrink-0"}),e.jsx(ns,{open:pe,onOpenChange:ae,value:K,onSelect:V,activities:he})]})]}),Z&&G&&m.length===0&&e.jsx("p",{className:"text-xs text-destructive pl-8",children:s("community.restaurantRequired","请选择餐厅")})]}),e.jsxs("div",{className:"flex items-center gap-6 px-4 pt-0 py-2 pb-[max(2rem,calc(env(safe-area-inset-bottom)+1rem))] bg-background shrink-0",children:[e.jsx("input",{ref:W,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:fe}),e.jsx("input",{ref:J,type:"file",accept:"video/*",className:"hidden",onChange:ye}),e.jsxs("button",{type:"button",onClick:()=>W.current?.click(),disabled:z||C.length>=9,className:"flex items-center gap-1.5 text-muted-foreground hover:text-foreground disabled:opacity-50 transition-colors",children:[e.jsx(De,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm",children:s("community.photo","照片")})]}),e.jsxs("button",{type:"button",onClick:()=>J.current?.click(),disabled:z||!!j,className:"flex items-center gap-1.5 text-muted-foreground hover:text-foreground disabled:opacity-50 transition-colors",children:[e.jsx(Me,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm",children:s("community.video","视频")})]}),e.jsx(os,{onSelect:r=>I(l=>l+r)}),z&&e.jsx(re,{className:"h-5 w-5 animate-spin ml-auto"})]})]})]})]})},Cs=()=>e.jsxs("div",{className:"rounded-xl overflow-hidden bg-card border border-border/50",children:[e.jsx(O,{className:"aspect-[4/5] w-full"}),e.jsxs("div",{className:"p-3 space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{className:"h-4 w-full"}),e.jsx(O,{className:"h-4 w-3/4"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5 rounded-full"}),e.jsx(O,{className:"h-3 w-16"})]}),e.jsx(O,{className:"h-4 w-10"})]})]})]}),Ks=()=>{const{t}=H(),s=_e(),n=Ye(),{user:g}=Ze(),{requireLogin:u}=js(),[c,S]=a.useState(()=>localStorage.getItem("community-mobile-layout")==="single"?"single":"double"),[E,x]=a.useState(()=>localStorage.getItem("community-sort")==="popular"?"popular":"latest"),[y,D]=a.useState(()=>{const o=localStorage.getItem("community-post-type");return["all","post","recipe"].includes(o||"")?o:"all"}),{data:M,isLoading:b}=ps({status:"approved",sortBy:E,postType:y}),{data:F}=xs(),{displayedData:w,hasMore:R,sentinelRef:k}=bs({data:M,initialItemsPerPage:12,incrementPerPage:12}),_=a.useCallback(async()=>{s.removeQueries({queryKey:["community-posts"]}),s.removeQueries({queryKey:["can-create-post"]}),s.removeQueries({queryKey:["has-posted-today"]}),await Promise.all([s.invalidateQueries({queryKey:["community-posts"]}),s.invalidateQueries({queryKey:["can-create-post"]}),s.invalidateQueries({queryKey:["has-posted-today"]})])},[s]),f=()=>{const o=c==="double"?"single":"double";S(o),localStorage.setItem("community-mobile-layout",o)},P=o=>{const j=o;x(j),localStorage.setItem("community-sort",j)},I=o=>{D(o),localStorage.setItem("community-post-type",o)},C=()=>n?c==="single"?"columns-1 gap-4":"columns-2 gap-3":"columns-3 lg:columns-4 gap-4";return e.jsx(ys,{onRefresh:_,children:e.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4 animate-fade-in",children:e.jsxs("div",{className:"container mx-auto max-w-5xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl sm:text-4xl mb-2 text-primary font-medium",children:t("community.title","社区")}),e.jsx("p",{className:"text-muted-foreground text-base sm:text-lg",children:t("community.description","分享美食体验，发现更多精彩")})]}),F?e.jsx(ks,{trigger:e.jsxs($,{size:"sm",className:"gap-1.5",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:t("community.createPost","发布")})]})}):g?null:e.jsxs($,{size:"sm",className:"gap-1.5",onClick:()=>u(),children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:t("community.createPost","发布")})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsxs("div",{className:"inline-flex h-9 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",children:[e.jsxs("button",{onClick:()=>P("latest"),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${E==="latest"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(ce,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:t("community.sortLatest","最新")})]}),e.jsxs("button",{onClick:()=>P("popular"),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${E==="popular"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(Ae,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:t("community.sortPopular","热门")})]})]}),e.jsxs("div",{className:"inline-flex h-9 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",children:[e.jsxs("button",{onClick:()=>I("all"),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${y==="all"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx($e,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:t("community.filterAll","全部")})]}),e.jsxs("button",{onClick:()=>I("post"),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${y==="post"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(me,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:t("community.filterPost","帖子")})]}),e.jsxs("button",{onClick:()=>I("recipe"),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${y==="recipe"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(de,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:t("community.filterRecipe","食谱")})]})]}),n&&e.jsx("button",{onClick:f,className:"ml-auto inline-flex h-9 items-center justify-center whitespace-nowrap rounded-md bg-muted px-2.5 py-1.5 text-sm font-medium text-muted-foreground ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",title:c==="double"?t("community.singleColumn","单列布局"):t("community.doubleColumn","双列布局"),children:c==="double"?e.jsx(Fe,{className:"h-3.5 w-3.5"}):e.jsx(Oe,{className:"h-3.5 w-3.5"})})]}),b?e.jsx("div",{className:C(),children:Array.from({length:8}).map((o,j)=>e.jsx("div",{className:"break-inside-avoid mb-3 sm:mb-4",children:e.jsx(Cs,{})},j))}):M&&M.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:C(),children:w.map(o=>e.jsx("div",{className:"break-inside-avoid mb-3 sm:mb-4",children:e.jsx(es,{post:o,showAssociations:n&&c==="single"})},o.id))}),R&&e.jsx("div",{ref:k,className:"flex justify-center py-6",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent"})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] text-center px-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-muted/50 flex items-center justify-center mb-4",children:e.jsx(te,{className:"w-8 h-8 text-muted-foreground/50"})}),e.jsx("p",{className:"text-muted-foreground text-lg",children:t("community.noPosts","暂无帖子")}),F&&e.jsx("p",{className:"mt-2 text-sm text-muted-foreground/70",children:t("community.beFirst","成为第一个发帖的人吧！")})]})]})})})};export{Ks as default};
//# sourceMappingURL=Community-BPbTKVEH.js.map
