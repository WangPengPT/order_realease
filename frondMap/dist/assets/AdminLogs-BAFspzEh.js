import{j as e}from"./vendor-ui-DmpovMYY.js";import{r as c}from"./vendor-react-iAJ0IrSD.js";import{aN as v,p as n,O as i,c1 as j,v as $,I as z,aW as L,aX as P,F as X,aY as D,aZ as _,a_ as m,S as w,U as Y,W as Z,B as q,C as K,a4 as Q,j as A}from"./index-DsNZqemC.js";import{T as ee,a as se,b as k,c as p,d as ae,e as o}from"./table-vfS63EgP.js";import{t as re}from"./useAdmin-Rx2QTMTH.js";import{u as te,P as le,a as ne,b as T,c as de,d as ce,f as ie}from"./usePagination-DpbTCjrd.js";import{u as me}from"./vendor-i18n-DxKeo2S1.js";import{f as oe}from"./format-B_zu4AQa.js";import"./vendor-charts-Bz7hPIBd.js";import"./vendor-query-D82cqPtt.js";import"./vendor-supabase-6pZ9VDFn.js";import"./startOfDay-DrMIfBcP.js";const Te=()=>{const{t:r}=me(),{data:l,isLoading:I}=re(),[F,R]=c.useState(new Set),[x,U]=c.useState(""),[u,B]=c.useState("all"),[N,M]=c.useState("all"),H=c.useMemo(()=>l?[...new Set(l.map(t=>t.table_name))].sort():[],[l]),E=c.useMemo(()=>l?l.filter(s=>{const t=x===""||s.user_name?.toLowerCase().includes(x.toLowerCase())||s.table_name.toLowerCase().includes(x.toLowerCase()),a=u==="all"||s.action===u,g=N==="all"||s.table_name===N;return t&&a&&g}):[],[l,x,u,N]),{currentPage:d,totalPages:h,paginatedData:f,goToPage:b,canGoNext:y,canGoPrevious:S,startIndex:O,endIndex:V,totalItems:G}=te({data:E,itemsPerPage:15}),J=s=>{R(t=>{const a=new Set(t);return a.has(s)?a.delete(s):a.add(s),a})},W=s=>({INSERT:{variant:"default",className:"bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 border-emerald-500/20 hover:bg-emerald-500/20"},UPDATE:{variant:"secondary",className:"bg-amber-500/10 text-amber-600 dark:text-amber-400 border-amber-500/20 hover:bg-amber-500/20"},DELETE:{variant:"destructive",className:"bg-red-500/10 text-red-600 dark:text-red-400 border-red-500/20 hover:bg-red-500/20"}})[s]||{variant:"outline",className:""},C=s=>{if(!s)return null;try{return JSON.stringify(s,null,2)}catch{return String(s)}};return I?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("span",{className:"text-muted-foreground",children:r("common.loading")})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(v,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:r("admin.operationLogs")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r("admin.viewSystemLogs")})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(n,{className:"border-none shadow-sm bg-gradient-to-br from-emerald-500/5 to-emerald-500/10 dark:from-emerald-500/10 dark:to-emerald-500/20",children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-emerald-500/10 dark:bg-emerald-500/20",children:e.jsx(j,{className:"h-4 w-4 text-emerald-600 dark:text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"INSERT"}),e.jsx("p",{className:"text-xl font-bold text-emerald-600 dark:text-emerald-400",children:l?.filter(s=>s.action==="INSERT").length||0})]})]})})}),e.jsx(n,{className:"border-none shadow-sm bg-gradient-to-br from-amber-500/5 to-amber-500/10 dark:from-amber-500/10 dark:to-amber-500/20",children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-amber-500/10 dark:bg-amber-500/20",children:e.jsx(j,{className:"h-4 w-4 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"UPDATE"}),e.jsx("p",{className:"text-xl font-bold text-amber-600 dark:text-amber-400",children:l?.filter(s=>s.action==="UPDATE").length||0})]})]})})}),e.jsx(n,{className:"border-none shadow-sm bg-gradient-to-br from-red-500/5 to-red-500/10 dark:from-red-500/10 dark:to-red-500/20",children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-red-500/10 dark:bg-red-500/20",children:e.jsx(j,{className:"h-4 w-4 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"DELETE"}),e.jsx("p",{className:"text-xl font-bold text-red-600 dark:text-red-400",children:l?.filter(s=>s.action==="DELETE").length||0})]})]})})}),e.jsx(n,{className:"border-none shadow-sm bg-gradient-to-br from-primary/5 to-primary/10",children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-primary/10",children:e.jsx(v,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:r("common.total")}),e.jsx("p",{className:"text-xl font-bold text-primary",children:l?.length||0})]})]})})})]}),e.jsx(n,{className:"border-none shadow-sm",children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx($,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:r("common.search"),value:x,onChange:s=>U(s.target.value),className:"pl-9"})]}),e.jsxs(L,{value:u,onValueChange:B,children:[e.jsxs(P,{className:"w-full sm:w-[140px]",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),e.jsx(D,{placeholder:r("admin.action")})]}),e.jsxs(_,{children:[e.jsx(m,{value:"all",children:r("common.all")}),e.jsx(m,{value:"INSERT",children:"INSERT"}),e.jsx(m,{value:"UPDATE",children:"UPDATE"}),e.jsx(m,{value:"DELETE",children:"DELETE"})]})]}),e.jsxs(L,{value:N,onValueChange:M,children:[e.jsxs(P,{className:"w-full sm:w-[180px]",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),e.jsx(D,{placeholder:r("admin.table")})]}),e.jsxs(_,{children:[e.jsx(m,{value:"all",children:r("common.all")}),H.map(s=>e.jsx(m,{value:s,children:s},s))]})]})]})})}),E.length>0&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:[r("common.showing")," ",O,"-",V," ",r("common.of")," ",G," ",r("common.results")]}),f&&f.length>0?e.jsx(n,{className:"border-none shadow-sm overflow-hidden",children:e.jsx(w,{className:"w-full",children:e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs(k,{className:"bg-muted/30 hover:bg-muted/30",children:[e.jsx(p,{className:"w-[50px]"}),e.jsx(p,{className:"min-w-[120px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),r("admin.user")]})}),e.jsx(p,{className:"min-w-[120px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-4"}),r("admin.table")]})}),e.jsx(p,{className:"min-w-[100px]",children:r("admin.action")}),e.jsx(p,{className:"min-w-[160px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),r("admin.time")]})})]})}),e.jsx(ae,{children:f.map(s=>{const t=F.has(s.id),a=s.old_data||s.new_data,g=W(s.action);return e.jsxs(e.Fragment,{children:[e.jsxs(k,{className:`cursor-pointer transition-colors ${a?"hover:bg-muted/50":""}`,onClick:()=>a&&J(s.id),children:[e.jsx(o,{className:"w-[50px]",children:a&&e.jsx(q,{variant:"ghost",size:"icon",className:"h-6 w-6",children:t?e.jsx(K,{className:"h-4 w-4"}):e.jsx(Q,{className:"h-4 w-4"})})}),e.jsx(o,{children:e.jsx("span",{className:"font-medium",children:s.user_name||"-"})}),e.jsx(o,{children:e.jsx(A,{variant:"outline",className:"font-mono text-xs",children:s.table_name})}),e.jsx(o,{children:e.jsx(A,{variant:g.variant,className:g.className,children:s.action})}),e.jsx(o,{className:"text-muted-foreground text-sm",children:oe(new Date(s.created_at),"yyyy-MM-dd HH:mm:ss")})]},s.id),t&&a&&e.jsx(k,{children:e.jsx(o,{colSpan:5,className:"bg-muted/20 p-0",children:e.jsx("div",{className:"p-4 space-y-4",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[s.old_data&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-red-500 dark:bg-red-400"}),e.jsx("span",{className:"font-semibold text-sm text-red-600 dark:text-red-400",children:r("admin.oldData")})]}),e.jsx(w,{className:"h-[200px] rounded-lg border border-red-500/20 dark:border-red-400/30 bg-red-500/5 dark:bg-red-500/10",children:e.jsx("pre",{className:"p-3 text-xs font-mono whitespace-pre-wrap break-all text-foreground",children:C(s.old_data)})})]}),s.new_data&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-emerald-500 dark:bg-emerald-400"}),e.jsx("span",{className:"font-semibold text-sm text-emerald-600 dark:text-emerald-400",children:r("admin.newData")})]}),e.jsx(w,{className:"h-[200px] rounded-lg border border-emerald-500/20 dark:border-emerald-400/30 bg-emerald-500/5 dark:bg-emerald-500/10",children:e.jsx("pre",{className:"p-3 text-xs font-mono whitespace-pre-wrap break-all text-foreground",children:C(s.new_data)})})]})]})})})},`${s.id}-expanded`)]})})})]})})}):e.jsx(n,{className:"border-none shadow-sm",children:e.jsx(i,{className:"py-16 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"p-4 rounded-full bg-muted",children:e.jsx(v,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("p",{className:"text-muted-foreground",children:r("admin.noLogs")})]})})}),h>1&&e.jsx(le,{children:e.jsxs(ne,{children:[e.jsx(T,{children:e.jsx(de,{onClick:()=>S&&b(d-1),className:S?"cursor-pointer":"pointer-events-none opacity-50"})}),Array.from({length:Math.min(5,h)},(s,t)=>{let a;return h<=5||d<=3?a=t+1:d>=h-2?a=h-4+t:a=d-2+t,e.jsx(T,{children:e.jsx(ce,{onClick:()=>b(a),isActive:d===a,className:"cursor-pointer",children:a})},a)}),e.jsx(T,{children:e.jsx(ie,{onClick:()=>y&&b(d+1),className:y?"cursor-pointer":"pointer-events-none opacity-50"})})]})})]})};export{Te as default};
//# sourceMappingURL=AdminLogs-BAFspzEh.js.map
