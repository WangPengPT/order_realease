{"version":3,"file":"AdminActivityStats-kb0n7jOc.js","sources":["../../src/pages/admin/AdminActivityStats.tsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport { useParams, Link } from \"react-router-dom\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { \r\n  ChevronLeft, \r\n  Eye, \r\n  Users, \r\n  Heart, \r\n  Share2, \r\n  Star, \r\n  MessageCircle,\r\n  TrendingUp,\r\n  Calendar,\r\n  Store\r\n} from \"lucide-react\";\r\nimport { useActivity, useActivityRestaurants } from \"@/hooks/useActivities\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { useQuery } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { format, subDays, startOfDay } from \"date-fns\";\r\nimport { fetchAllPaginated } from \"@/lib/paginatedQuery\";\r\nimport { \r\n  LineChart, \r\n  Line, \r\n  XAxis, \r\n  YAxis, \r\n  CartesianGrid, \r\n  Tooltip, \r\n  ResponsiveContainer\r\n} from \"recharts\";\r\n\r\ntype TimeRange = \"today\" | \"7days\" | \"30days\" | \"all\";\r\n\r\nconst AdminActivityStats = () => {\r\n  const { id } = useParams<{ id: string }>();\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const [timeRange, setTimeRange] = useState<TimeRange>(\"30days\");\r\n\r\n  const getDateFilter = () => {\r\n    const now = new Date();\r\n    switch (timeRange) {\r\n      case \"today\":\r\n        return startOfDay(now).toISOString();\r\n      case \"7days\":\r\n        return startOfDay(subDays(now, 6)).toISOString();\r\n      case \"30days\":\r\n        return startOfDay(subDays(now, 29)).toISOString();\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  const getChartDays = () => {\r\n    switch (timeRange) {\r\n      case \"today\": return 1;\r\n      case \"7days\": return 7;\r\n      case \"30days\": return 30;\r\n      default: return 30;\r\n    }\r\n  };\r\n  \r\n  const { data: activity, isLoading: activityLoading } = useActivity(id!);\r\n  const { data: restaurants = [] } = useActivityRestaurants(id!);\r\n  const dateFilter = getDateFilter();\r\n\r\n  // Fetch subscribers list with time filter (with pagination)\r\n  const { data: subscribers = [], isLoading: subscribersLoading } = useQuery({\r\n    queryKey: [\"activity-subscribers\", id, timeRange],\r\n    queryFn: async () => {\r\n      const data = await fetchAllPaginated(\r\n        \"subscriptions\",\r\n        \"user_id, created_at\",\r\n        (query) => {\r\n          query = query\r\n            .eq(\"activity_id\", id!)\r\n            .order(\"created_at\", { ascending: false });\r\n          if (dateFilter) {\r\n            query = query.gte(\"created_at\", dateFilter);\r\n          }\r\n          return query;\r\n        }\r\n      );\r\n      \r\n      if (data && data.length > 0) {\r\n        const userIds = data.map(s => s.user_id);\r\n        const { data: profiles } = await supabase\r\n          .rpc(\"get_public_profiles\", { user_ids: userIds });\r\n        \r\n        return data.map(s => ({\r\n          ...s,\r\n          profile: profiles?.find((p: any) => p.id === s.user_id)\r\n        }));\r\n      }\r\n      return [];\r\n    },\r\n    enabled: !!id,\r\n  });\r\n\r\n  // Fetch sharers list with time filter (with pagination)\r\n  const { data: sharers = [], isLoading: sharersLoading } = useQuery({\r\n    queryKey: [\"activity-sharers\", id, timeRange],\r\n    queryFn: async () => {\r\n      const data = await fetchAllPaginated(\r\n        \"activity_shares\",\r\n        \"user_id, created_at\",\r\n        (query) => {\r\n          query = query\r\n            .eq(\"activity_id\", id!)\r\n            .order(\"created_at\", { ascending: false });\r\n          if (dateFilter) {\r\n            query = query.gte(\"created_at\", dateFilter);\r\n          }\r\n          return query;\r\n        }\r\n      );\r\n      \r\n      if (data && data.length > 0) {\r\n        const userIds = data.map(s => s.user_id);\r\n        const { data: profiles } = await supabase\r\n          .rpc(\"get_public_profiles\", { user_ids: userIds });\r\n        \r\n        return data.map(s => ({\r\n          ...s,\r\n          profile: profiles?.find((p: any) => p.id === s.user_id)\r\n        }));\r\n      }\r\n      return [];\r\n    },\r\n    enabled: !!id,\r\n  });\r\n\r\n  // Fetch comments and ratings with time filter (with pagination)\r\n  const { data: comments = [], isLoading: commentsLoading } = useQuery({\r\n    queryKey: [\"activity-comments\", id, timeRange],\r\n    queryFn: async () => {\r\n      const data = await fetchAllPaginated(\r\n        \"comments\",\r\n        \"id, user_id, content, rating_value, created_at\",\r\n        (query) => {\r\n          query = query\r\n            .eq(\"target_id\", id!)\r\n            .eq(\"target_type\", \"activity\")\r\n            .order(\"created_at\", { ascending: false });\r\n          if (dateFilter) {\r\n            query = query.gte(\"created_at\", dateFilter);\r\n          }\r\n          return query;\r\n        }\r\n      );\r\n      \r\n      if (data && data.length > 0) {\r\n        const userIds = [...new Set(data.map(c => c.user_id))];\r\n        const { data: profiles } = await supabase\r\n          .rpc(\"get_public_profiles\", { user_ids: userIds });\r\n        \r\n        return data.map(c => ({\r\n          ...c,\r\n          profile: profiles?.find((p: any) => p.id === c.user_id)\r\n        }));\r\n      }\r\n      return [];\r\n    },\r\n    enabled: !!id,\r\n  });\r\n\r\n  // Fetch page views for this activity with time filter (with pagination)\r\n  const { data: pageViews = [], isLoading: viewsLoading } = useQuery({\r\n    queryKey: [\"activity-page-views\", id, timeRange],\r\n    queryFn: async () => {\r\n      return await fetchAllPaginated(\r\n        \"page_views\",\r\n        \"created_at\",\r\n        (query) => {\r\n          query = query\r\n            .eq(\"target_id\", id!)\r\n            .eq(\"page_type\", \"activity\");\r\n          if (dateFilter) {\r\n            query = query.gte(\"created_at\", dateFilter);\r\n          }\r\n          return query;\r\n        }\r\n      );\r\n    },\r\n    enabled: !!id,\r\n  });\r\n\r\n  // Process view trend data\r\n  const viewTrendData = (() => {\r\n    const dateMap = new Map<string, number>();\r\n    const days = getChartDays();\r\n    \r\n    // Initialize days based on time range\r\n    for (let i = days - 1; i >= 0; i--) {\r\n      const date = format(subDays(new Date(), i), \"MM-dd\");\r\n      dateMap.set(date, 0);\r\n    }\r\n    \r\n    // Count views per day\r\n    pageViews.forEach(view => {\r\n      const date = format(new Date(view.created_at), \"MM-dd\");\r\n      if (dateMap.has(date)) {\r\n        dateMap.set(date, (dateMap.get(date) || 0) + 1);\r\n      }\r\n    });\r\n    \r\n    return Array.from(dateMap.entries()).map(([date, views]) => ({\r\n      date,\r\n      views\r\n    }));\r\n  })();\r\n\r\n  // Calculate stats\r\n  const totalViews = pageViews.length;\r\n  const subscriberCount = subscribers.length;\r\n  const shareCount = sharers.length;\r\n  const ratingsWithValue = comments.filter(c => c.rating_value !== null);\r\n  const averageRating = ratingsWithValue.length > 0 \r\n    ? (ratingsWithValue.reduce((sum, c) => sum + (c.rating_value || 0), 0) / ratingsWithValue.length).toFixed(1)\r\n    : \"0.0\";\r\n  const totalComments = comments.length;\r\n\r\n  if (activityLoading) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <Skeleton className=\"h-8 w-48\" />\r\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n          {[1, 2, 3, 4].map(i => (\r\n            <Skeleton key={i} className=\"h-32\" />\r\n          ))}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!activity) {\r\n    return (\r\n      <div className=\"text-center py-12\">\r\n        <p className=\"text-muted-foreground\">{t(\"common.notFound\")}</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const activityTitle = getLocalizedField(activity, \"title\");\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n        <div className=\"flex items-center gap-4\">\r\n          <Button variant=\"ghost\" size=\"icon\" asChild>\r\n            <Link to=\"/admin/activity-stats\">\r\n              <ChevronLeft className=\"h-5 w-5\" />\r\n            </Link>\r\n          </Button>\r\n          <div>\r\n            <h1 className=\"text-2xl font-bold\">{t(\"admin.activityStats\")}</h1>\r\n            <p className=\"text-muted-foreground\">{activityTitle}</p>\r\n          </div>\r\n        </div>\r\n        <div className=\"flex items-center gap-2 ml-12 sm:ml-0\">\r\n          <Calendar className=\"h-4 w-4 text-muted-foreground\" />\r\n          <Select value={timeRange} onValueChange={(v) => setTimeRange(v as TimeRange)}>\r\n            <SelectTrigger className=\"w-[140px]\">\r\n              <SelectValue />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"today\">{t('analytics.today')}</SelectItem>\r\n              <SelectItem value=\"7days\">{t('analytics.last7Days')}</SelectItem>\r\n              <SelectItem value=\"30days\">{t('analytics.last30Days', '近30天')}</SelectItem>\r\n              <SelectItem value=\"all\">{t('analytics.allTime', '所有时间')}</SelectItem>\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Overview Stats */}\r\n      <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4\">\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center gap-2 text-muted-foreground mb-2\">\r\n              <Eye className=\"w-4 h-4\" />\r\n              <span className=\"text-sm\">{t(\"analytics.pageViews\")}</span>\r\n            </div>\r\n            <p className=\"text-2xl font-bold\">{totalViews}</p>\r\n          </CardContent>\r\n        </Card>\r\n        \r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center gap-2 text-muted-foreground mb-2\">\r\n              <Heart className=\"w-4 h-4\" />\r\n              <span className=\"text-sm\">{t(\"activities.favorites\")}</span>\r\n            </div>\r\n            <p className=\"text-2xl font-bold\">{subscriberCount}</p>\r\n          </CardContent>\r\n        </Card>\r\n        \r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center gap-2 text-muted-foreground mb-2\">\r\n              <Share2 className=\"w-4 h-4\" />\r\n              <span className=\"text-sm\">{t(\"activities.shares\")}</span>\r\n            </div>\r\n            <p className=\"text-2xl font-bold\">{shareCount}</p>\r\n          </CardContent>\r\n        </Card>\r\n        \r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center gap-2 text-muted-foreground mb-2\">\r\n              <Star className=\"w-4 h-4\" />\r\n              <span className=\"text-sm\">{t(\"restaurant.rating\")}</span>\r\n            </div>\r\n            <p className=\"text-2xl font-bold\">{averageRating}</p>\r\n          </CardContent>\r\n        </Card>\r\n        \r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center gap-2 text-muted-foreground mb-2\">\r\n              <MessageCircle className=\"w-4 h-4\" />\r\n              <span className=\"text-sm\">{t(\"restaurant.comments\")}</span>\r\n            </div>\r\n            <p className=\"text-2xl font-bold\">{totalComments}</p>\r\n          </CardContent>\r\n        </Card>\r\n        \r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center gap-2 text-muted-foreground mb-2\">\r\n              <Store className=\"w-4 h-4\" />\r\n              <span className=\"text-sm\">{t(\"activities.participatingRestaurants\")}</span>\r\n            </div>\r\n            <p className=\"text-2xl font-bold\">{restaurants.length}</p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* View Trend Chart */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <TrendingUp className=\"w-5 h-5\" />\r\n            {t(\"analytics.viewTrend\")}\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"h-[300px]\">\r\n            {viewsLoading ? (\r\n              <div className=\"flex items-center justify-center h-full\">\r\n                <Skeleton className=\"h-full w-full\" />\r\n              </div>\r\n            ) : (\r\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                <LineChart data={viewTrendData}>\r\n                  <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\r\n                  <XAxis \r\n                    dataKey=\"date\" \r\n                    className=\"text-xs\"\r\n                    tick={{ fontSize: 11 }}\r\n                  />\r\n                  <YAxis \r\n                    className=\"text-xs\"\r\n                    tick={{ fontSize: 11 }}\r\n                  />\r\n                  <Tooltip \r\n                    contentStyle={{ \r\n                      backgroundColor: \"hsl(var(--background))\", \r\n                      border: \"1px solid hsl(var(--border))\" \r\n                    }}\r\n                  />\r\n                  <Line \r\n                    type=\"monotone\" \r\n                    dataKey=\"views\" \r\n                    stroke=\"hsl(var(--primary))\" \r\n                    strokeWidth={2}\r\n                    dot={false}\r\n                  />\r\n                </LineChart>\r\n              </ResponsiveContainer>\r\n            )}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* User Lists */}\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n        {/* Sharers - moved first */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Share2 className=\"w-5 h-5\" />\r\n              {t(\"admin.sharersList\", \"分享用户\")} ({sharers.length})\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {sharersLoading ? (\r\n              <div className=\"space-y-3\">\r\n                {[1, 2, 3].map(i => (\r\n                  <Skeleton key={i} className=\"h-12 w-full\" />\r\n                ))}\r\n              </div>\r\n            ) : sharers.length > 0 ? (\r\n              <div className=\"space-y-3 max-h-[300px] overflow-y-auto\">\r\n                {sharers.map((sharer: any, index) => (\r\n                  <div key={index} className=\"flex items-center justify-between p-2 rounded-lg bg-muted/50\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <Avatar className=\"h-8 w-8\">\r\n                        <AvatarImage src={sharer.profile?.avatar_url} />\r\n                        <AvatarFallback>\r\n                          {sharer.profile?.display_name?.charAt(0) || \"U\"}\r\n                        </AvatarFallback>\r\n                      </Avatar>\r\n                      <span className=\"font-medium text-sm\">\r\n                        {sharer.profile?.display_name || t(\"common.anonymous\")}\r\n                      </span>\r\n                    </div>\r\n                    <span className=\"text-xs text-muted-foreground\">\r\n                      {format(new Date(sharer.created_at), \"yyyy-MM-dd\")}\r\n                    </span>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <p className=\"text-muted-foreground text-center py-8\">\r\n                {t(\"analytics.noData\")}\r\n              </p>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Subscribers - moved second */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Heart className=\"w-5 h-5\" />\r\n              {t(\"admin.subscribersList\", \"收藏用户\")} ({subscribers.length})\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {subscribersLoading ? (\r\n              <div className=\"space-y-3\">\r\n                {[1, 2, 3].map(i => (\r\n                  <Skeleton key={i} className=\"h-12 w-full\" />\r\n                ))}\r\n              </div>\r\n            ) : subscribers.length > 0 ? (\r\n              <div className=\"space-y-3 max-h-[300px] overflow-y-auto\">\r\n                {subscribers.map((sub: any, index) => (\r\n                  <div key={index} className=\"flex items-center justify-between p-2 rounded-lg bg-muted/50\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <Avatar className=\"h-8 w-8\">\r\n                        <AvatarImage src={sub.profile?.avatar_url} />\r\n                        <AvatarFallback>\r\n                          {sub.profile?.display_name?.charAt(0) || \"U\"}\r\n                        </AvatarFallback>\r\n                      </Avatar>\r\n                      <span className=\"font-medium text-sm\">\r\n                        {sub.profile?.display_name || t(\"common.anonymous\")}\r\n                      </span>\r\n                    </div>\r\n                    <span className=\"text-xs text-muted-foreground\">\r\n                      {format(new Date(sub.created_at), \"yyyy-MM-dd\")}\r\n                    </span>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <p className=\"text-muted-foreground text-center py-8\">\r\n                {t(\"analytics.noData\")}\r\n              </p>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Comments & Ratings */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <MessageCircle className=\"w-5 h-5\" />\r\n            {t(\"admin.commentsAndRatings\", \"评论与评分\")} ({comments.length})\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          {commentsLoading ? (\r\n            <div className=\"space-y-3\">\r\n              {[1, 2, 3].map(i => (\r\n                <Skeleton key={i} className=\"h-20 w-full\" />\r\n              ))}\r\n            </div>\r\n          ) : comments.length > 0 ? (\r\n            <div className=\"space-y-4 max-h-[400px] overflow-y-auto\">\r\n              {comments.map((comment: any) => (\r\n                <div key={comment.id} className=\"p-4 rounded-lg bg-muted/50\">\r\n                  <div className=\"flex items-center justify-between mb-2\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <Avatar className=\"h-8 w-8\">\r\n                        <AvatarImage src={comment.profile?.avatar_url} />\r\n                        <AvatarFallback>\r\n                          {comment.profile?.display_name?.charAt(0) || \"U\"}\r\n                        </AvatarFallback>\r\n                      </Avatar>\r\n                      <span className=\"font-medium text-sm\">\r\n                        {comment.profile?.display_name || t(\"common.anonymous\")}\r\n                      </span>\r\n                      {comment.rating_value && (\r\n                        <Badge variant=\"secondary\" className=\"flex items-center gap-1\">\r\n                          <Star className=\"w-3 h-3 fill-current\" />\r\n                          {comment.rating_value}\r\n                        </Badge>\r\n                      )}\r\n                    </div>\r\n                    <span className=\"text-xs text-muted-foreground\">\r\n                      {format(new Date(comment.created_at), \"yyyy-MM-dd HH:mm\")}\r\n                    </span>\r\n                  </div>\r\n                  <p className=\"text-sm text-muted-foreground line-clamp-3\">\r\n                    {comment.content}\r\n                  </p>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <p className=\"text-muted-foreground text-center py-8\">\r\n              {t(\"analytics.noData\")}\r\n            </p>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminActivityStats;\r\n"],"names":["AdminActivityStats","id","useParams","useTranslation","getLocalizedField","useLocalizedContent","timeRange","setTimeRange","useState","getDateFilter","now","startOfDay","subDays","getChartDays","activity","activityLoading","useActivity","restaurants","useActivityRestaurants","dateFilter","subscribers","subscribersLoading","useQuery","data","fetchAllPaginated","query","userIds","s","profiles","supabase","p","sharers","sharersLoading","comments","commentsLoading","c","pageViews","viewsLoading","viewTrendData","dateMap","days","i","date","format","view","views","totalViews","subscriberCount","shareCount","ratingsWithValue","averageRating","sum","totalComments","jsxs","jsx","Skeleton","activityTitle","Button","Link","ChevronLeft","Calendar","Select","v","SelectTrigger","SelectValue","SelectContent","SelectItem","Card","CardContent","Eye","Heart","Share2","Star","MessageCircle","Store","CardHeader","CardTitle","TrendingUp","ResponsiveContainer","LineChart","CartesianGrid","XAxis","YAxis","Tooltip","Line","sharer","index","Avatar","AvatarImage","AvatarFallback","sub","comment","Badge"],"mappings":"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"}