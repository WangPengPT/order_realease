{"version":3,"file":"RestaurantFormDialog-DScDgYpu.js","sources":["../../src/hooks/useDishImages.ts","../../src/components/admin/DishImageManager.tsx","../../src/components/admin/TypeCombobox.tsx","../../src/hooks/useAllRestaurantTypes.ts","../../src/components/admin/RestaurantVideoManager.tsx","../../src/components/admin/RestaurantFormDialog.tsx"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { toast } from \"sonner\";\r\nimport i18n from \"i18next\";\r\n\r\nexport interface DishImage {\r\n  id: string;\r\n  restaurant_id: string;\r\n  image_url: string;\r\n  sort_order: number;\r\n  created_at: string;\r\n  created_by: string | null;\r\n}\r\n\r\nexport const useDishImages = (restaurantId: string) => {\r\n  return useQuery({\r\n    queryKey: [\"dish-images\", restaurantId],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"restaurant_dish_images\")\r\n        .select(\"*\")\r\n        .eq(\"restaurant_id\", restaurantId)\r\n        .order(\"sort_order\", { ascending: true });\r\n\r\n      if (error) throw error;\r\n      return data as DishImage[];\r\n    },\r\n    enabled: !!restaurantId,\r\n  });\r\n};\r\n\r\nexport const useAddDishImage = () => {\r\n  const { user } = useAuth();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async ({ restaurantId, file }: { restaurantId: string; file: File }) => {\r\n      if (!user) throw new Error(\"Must be logged in\");\r\n\r\n      // Check current image count\r\n      const { data: existingImages, error: countError } = await supabase\r\n        .from(\"restaurant_dish_images\")\r\n        .select(\"id\")\r\n        .eq(\"restaurant_id\", restaurantId);\r\n\r\n      if (countError) throw countError;\r\n      if (existingImages && existingImages.length >= 10) {\r\n        throw new Error(\"MAX_IMAGES_REACHED\");\r\n      }\r\n\r\n      // Upload image\r\n      const fileExt = file.name.split(\".\").pop();\r\n      const fileName = `${restaurantId}/${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;\r\n\r\n      const { error: uploadError } = await supabase.storage\r\n        .from(\"dish-images\")\r\n        .upload(fileName, file);\r\n\r\n      if (uploadError) throw uploadError;\r\n\r\n      // Get public URL\r\n      const { data: { publicUrl } } = supabase.storage\r\n        .from(\"dish-images\")\r\n        .getPublicUrl(fileName);\r\n\r\n      // Get next sort order\r\n      const nextSortOrder = existingImages ? existingImages.length : 0;\r\n\r\n      // Insert record\r\n      const { data, error: insertError } = await supabase\r\n        .from(\"restaurant_dish_images\")\r\n        .insert({\r\n          restaurant_id: restaurantId,\r\n          image_url: publicUrl,\r\n          sort_order: nextSortOrder,\r\n          created_by: user.id,\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (insertError) throw insertError;\r\n      return data;\r\n    },\r\n    onSuccess: (_, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: [\"dish-images\", variables.restaurantId] });\r\n      toast.success(i18n.t(\"dishImages.uploadSuccess\"));\r\n    },\r\n    onError: (error: any) => {\r\n      if (error.message === \"MAX_IMAGES_REACHED\") {\r\n        toast.error(i18n.t(\"dishImages.maxImagesReached\"));\r\n      } else {\r\n        toast.error(i18n.t(\"dishImages.uploadFailed\"));\r\n      }\r\n    },\r\n  });\r\n};\r\n\r\nexport const useDeleteDishImage = () => {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async ({ imageId, restaurantId, imageUrl }: { imageId: string; restaurantId: string; imageUrl: string }) => {\r\n      // Delete from storage\r\n      const urlParts = imageUrl.split(\"/dish-images/\");\r\n      if (urlParts[1]) {\r\n        await supabase.storage\r\n          .from(\"dish-images\")\r\n          .remove([urlParts[1]]);\r\n      }\r\n\r\n      // Delete record\r\n      const { error } = await supabase\r\n        .from(\"restaurant_dish_images\")\r\n        .delete()\r\n        .eq(\"id\", imageId);\r\n\r\n      if (error) throw error;\r\n      return { restaurantId };\r\n    },\r\n    onSuccess: (data) => {\r\n      queryClient.invalidateQueries({ queryKey: [\"dish-images\", data.restaurantId] });\r\n      toast.success(i18n.t(\"dishImages.deleteSuccess\"));\r\n    },\r\n    onError: () => {\r\n      toast.error(i18n.t(\"dishImages.deleteFailed\"));\r\n    },\r\n  });\r\n};\r\n\r\nexport const useReorderDishImages = () => {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async ({ images, restaurantId }: { images: { id: string; sort_order: number }[]; restaurantId: string }) => {\r\n      const updates = images.map(img => \r\n        supabase\r\n          .from(\"restaurant_dish_images\")\r\n          .update({ sort_order: img.sort_order })\r\n          .eq(\"id\", img.id)\r\n      );\r\n\r\n      await Promise.all(updates);\r\n      return { restaurantId };\r\n    },\r\n    onSuccess: (data) => {\r\n      queryClient.invalidateQueries({ queryKey: [\"dish-images\", data.restaurantId] });\r\n    },\r\n  });\r\n};\r\n","import { useState, useRef } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Upload, X, Loader2, ImageIcon, GripVertical } from \"lucide-react\";\r\nimport { useDishImages, useAddDishImage, useDeleteDishImage, useReorderDishImages, DishImage } from \"@/hooks/useDishImages\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport {\r\n  DndContext,\r\n  closestCenter,\r\n  KeyboardSensor,\r\n  PointerSensor,\r\n  useSensor,\r\n  useSensors,\r\n  DragEndEvent,\r\n} from \"@dnd-kit/core\";\r\nimport {\r\n  arrayMove,\r\n  SortableContext,\r\n  sortableKeyboardCoordinates,\r\n  useSortable,\r\n  rectSortingStrategy,\r\n} from \"@dnd-kit/sortable\";\r\nimport { CSS } from \"@dnd-kit/utilities\";\r\n\r\ninterface DishImageManagerProps {\r\n  restaurantId: string;\r\n}\r\n\r\ninterface SortableImageProps {\r\n  image: DishImage;\r\n  index: number;\r\n  onDelete: (id: string, url: string) => void;\r\n}\r\n\r\nfunction SortableImage({ image, index, onDelete }: SortableImageProps) {\r\n  const {\r\n    attributes,\r\n    listeners,\r\n    setNodeRef,\r\n    transform,\r\n    transition,\r\n    isDragging,\r\n  } = useSortable({ id: image.id });\r\n\r\n  const style = {\r\n    transform: CSS.Transform.toString(transform),\r\n    transition,\r\n    zIndex: isDragging ? 10 : 1,\r\n    opacity: isDragging ? 0.8 : 1,\r\n  };\r\n\r\n  return (\r\n    <div\r\n      ref={setNodeRef}\r\n      style={style}\r\n      className={`relative group aspect-square rounded-lg overflow-hidden border ${\r\n        isDragging ? \"ring-2 ring-primary shadow-lg\" : \"\"\r\n      }`}\r\n    >\r\n      {/* Drag Handle */}\r\n      <div\r\n        {...attributes}\r\n        {...listeners}\r\n        className=\"absolute top-1 left-1 z-10 p-1 bg-black/60 rounded cursor-grab active:cursor-grabbing opacity-0 group-hover:opacity-100 transition-opacity\"\r\n      >\r\n        <GripVertical className=\"w-4 h-4 text-white\" />\r\n      </div>\r\n\r\n      <img\r\n        src={image.image_url}\r\n        alt={`Dish ${index + 1}`}\r\n        className=\"w-full h-full object-cover\"\r\n        draggable={false}\r\n      />\r\n      \r\n      <div className=\"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center\">\r\n        <Button\r\n          type=\"button\"\r\n          variant=\"destructive\"\r\n          size=\"icon\"\r\n          className=\"h-8 w-8\"\r\n          onClick={(e) => {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            onDelete(image.id, image.image_url);\r\n          }}\r\n        >\r\n          <X className=\"w-4 h-4\" />\r\n        </Button>\r\n      </div>\r\n      \r\n      <div className=\"absolute bottom-1 right-1 bg-black/60 text-white text-xs px-1.5 py-0.5 rounded\">\r\n        {index + 1}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function DishImageManager({ restaurantId }: DishImageManagerProps) {\r\n  const { t } = useTranslation();\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const { data: images = [], isLoading } = useDishImages(restaurantId);\r\n  const addImage = useAddDishImage();\r\n  const deleteImage = useDeleteDishImage();\r\n  const reorderImages = useReorderDishImages();\r\n  const [deleteConfirm, setDeleteConfirm] = useState<{ id: string; url: string } | null>(null);\r\n  const [localImages, setLocalImages] = useState<DishImage[]>([]);\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n\r\n  // Sync local state with fetched images\r\n  const displayImages = localImages.length > 0 ? localImages : images;\r\n\r\n  const sensors = useSensors(\r\n    useSensor(PointerSensor, {\r\n      activationConstraint: {\r\n        distance: 8,\r\n      },\r\n    }),\r\n    useSensor(KeyboardSensor, {\r\n      coordinateGetter: sortableKeyboardCoordinates,\r\n    })\r\n  );\r\n\r\n  const handleDragEnd = (event: DragEndEvent) => {\r\n    const { active, over } = event;\r\n\r\n    if (over && active.id !== over.id) {\r\n      const oldIndex = displayImages.findIndex((img) => img.id === active.id);\r\n      const newIndex = displayImages.findIndex((img) => img.id === over.id);\r\n\r\n      const newOrder = arrayMove(displayImages, oldIndex, newIndex);\r\n      setLocalImages(newOrder);\r\n\r\n      // Update sort orders in database\r\n      const updates = newOrder.map((img, idx) => ({\r\n        id: img.id,\r\n        sort_order: idx,\r\n      }));\r\n\r\n      reorderImages.mutate(\r\n        { images: updates, restaurantId },\r\n        {\r\n          onSuccess: () => {\r\n            setLocalImages([]);\r\n          },\r\n          onError: () => {\r\n            setLocalImages([]);\r\n          },\r\n        }\r\n      );\r\n    }\r\n  };\r\n\r\n  const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      return;\r\n    }\r\n\r\n    if (!file.type.startsWith(\"image/\")) {\r\n      return;\r\n    }\r\n\r\n    await addImage.mutateAsync({ restaurantId, file });\r\n    \r\n    if (fileInputRef.current) {\r\n      fileInputRef.current.value = \"\";\r\n    }\r\n  };\r\n\r\n  const handleDeleteClick = (id: string, url: string) => {\r\n    setDeleteConfirm({ id, url });\r\n  };\r\n\r\n  const handleDeleteConfirm = async () => {\r\n    if (!deleteConfirm || isDeleting) return;\r\n    \r\n    const { id, url } = deleteConfirm;\r\n    setIsDeleting(true);\r\n    \r\n    try {\r\n      await deleteImage.mutateAsync({\r\n        imageId: id,\r\n        restaurantId,\r\n        imageUrl: url,\r\n      });\r\n      // Only close dialog after successful deletion\r\n      setDeleteConfirm(null);\r\n    } catch (error) {\r\n      console.error(\"Delete failed:\", error);\r\n    } finally {\r\n      setIsDeleting(false);\r\n    }\r\n  };\r\n\r\n  const handleDialogClose = (open: boolean) => {\r\n    // Only allow closing if not currently deleting\r\n    if (!open && !isDeleting) {\r\n      setDeleteConfirm(null);\r\n    }\r\n  };\r\n\r\n  const canAddMore = displayImages.length < 10;\r\n\r\n  return (\r\n    <Card>\r\n      <CardHeader className=\"pb-3\">\r\n        <CardTitle className=\"text-lg flex items-center gap-2\">\r\n          <ImageIcon className=\"w-5 h-5\" />\r\n          {t(\"dishImages.title\")}\r\n        </CardTitle>\r\n        <CardDescription>\r\n          {t(\"dishImages.description\", { current: displayImages.length, max: 10 })}\r\n          {displayImages.length > 1 && (\r\n            <span className=\"block mt-1 text-xs\">\r\n              {t(\"dishImages.dragToReorder\")}\r\n            </span>\r\n          )}\r\n        </CardDescription>\r\n      </CardHeader>\r\n      <CardContent>\r\n        {isLoading ? (\r\n          <div className=\"flex items-center justify-center py-8\">\r\n            <Loader2 className=\"w-6 h-6 animate-spin\" />\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-4\">\r\n            {/* Image Grid with Drag and Drop */}\r\n            {displayImages.length > 0 && (\r\n              <DndContext\r\n                sensors={sensors}\r\n                collisionDetection={closestCenter}\r\n                onDragEnd={handleDragEnd}\r\n              >\r\n                <SortableContext\r\n                  items={displayImages.map((img) => img.id)}\r\n                  strategy={rectSortingStrategy}\r\n                >\r\n                  <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3\">\r\n                    {displayImages.map((image, index) => (\r\n                      <SortableImage\r\n                        key={image.id}\r\n                        image={image}\r\n                        index={index}\r\n                        onDelete={(id, url) => setDeleteConfirm({ id, url })}\r\n                      />\r\n                    ))}\r\n                  </div>\r\n                </SortableContext>\r\n              </DndContext>\r\n            )}\r\n\r\n            {/* Upload Button */}\r\n            {canAddMore && (\r\n              <div>\r\n                <input\r\n                  ref={fileInputRef}\r\n                  type=\"file\"\r\n                  accept=\"image/*\"\r\n                  className=\"hidden\"\r\n                  onChange={handleFileSelect}\r\n                  disabled={addImage.isPending}\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"outline\"\r\n                  className=\"w-full\"\r\n                  onClick={() => fileInputRef.current?.click()}\r\n                  disabled={addImage.isPending}\r\n                >\r\n                  {addImage.isPending ? (\r\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                  ) : (\r\n                    <Upload className=\"w-4 h-4 mr-2\" />\r\n                  )}\r\n                  {t(\"dishImages.upload\")}\r\n                </Button>\r\n              </div>\r\n            )}\r\n\r\n            {!canAddMore && (\r\n              <p className=\"text-sm text-muted-foreground text-center\">\r\n                {t(\"dishImages.maxReached\")}\r\n              </p>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Delete Confirmation - Rendered in portal to avoid form interference */}\r\n        <AlertDialog open={!!deleteConfirm} onOpenChange={handleDialogClose}>\r\n          <AlertDialogContent \r\n            onClick={(e) => e.stopPropagation()}\r\n            onKeyDown={(e) => {\r\n              if (e.key === 'Enter') {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n              }\r\n            }}\r\n          >\r\n            <form onSubmit={(e) => e.preventDefault()}>\r\n              <AlertDialogHeader>\r\n                <AlertDialogTitle>{t(\"dishImages.deleteConfirmTitle\")}</AlertDialogTitle>\r\n                <AlertDialogDescription>\r\n                  {t(\"dishImages.deleteConfirmDescription\")}\r\n                </AlertDialogDescription>\r\n              </AlertDialogHeader>\r\n              <AlertDialogFooter className=\"mt-4\">\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"outline\"\r\n                  onClick={(e) => {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    if (!isDeleting) {\r\n                      setDeleteConfirm(null);\r\n                    }\r\n                  }}\r\n                  disabled={isDeleting}\r\n                >\r\n                  {t(\"common.cancel\")}\r\n                </Button>\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"destructive\"\r\n                  onClick={(e) => {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    handleDeleteConfirm();\r\n                  }}\r\n                  disabled={isDeleting}\r\n                >\r\n                  {isDeleting ? <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> : null}\r\n                  {t(\"common.delete\")}\r\n                </Button>\r\n              </AlertDialogFooter>\r\n            </form>\r\n          </AlertDialogContent>\r\n        </AlertDialog>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n","import { useState, useRef, useEffect } from \"react\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Check } from \"lucide-react\";\r\n\r\ninterface TypeComboboxProps {\r\n  value: string;\r\n  onChange: (value: string) => void;\r\n  suggestions: string[];\r\n  placeholder?: string;\r\n  className?: string;\r\n}\r\n\r\nexport function TypeCombobox({\r\n  value,\r\n  onChange,\r\n  suggestions,\r\n  placeholder,\r\n  className,\r\n}: TypeComboboxProps) {\r\n  const [open, setOpen] = useState(false);\r\n  const [inputValue, setInputValue] = useState(value);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n  const dropdownRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Filter suggestions based on input\r\n  const filteredSuggestions = suggestions.filter((s) =>\r\n    s.toLowerCase().includes(inputValue.toLowerCase())\r\n  );\r\n\r\n  // Sync inputValue with value prop\r\n  useEffect(() => {\r\n    setInputValue(value);\r\n  }, [value]);\r\n\r\n  // Close dropdown when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (\r\n        dropdownRef.current &&\r\n        !dropdownRef.current.contains(event.target as Node) &&\r\n        inputRef.current &&\r\n        !inputRef.current.contains(event.target as Node)\r\n      ) {\r\n        setOpen(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n  }, []);\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const newValue = e.target.value;\r\n    setInputValue(newValue);\r\n    onChange(newValue);\r\n    setOpen(true);\r\n  };\r\n\r\n  const handleSelect = (selectedValue: string) => {\r\n    setInputValue(selectedValue);\r\n    onChange(selectedValue);\r\n    setOpen(false);\r\n    inputRef.current?.focus();\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative\">\r\n      <Input\r\n        ref={inputRef}\r\n        value={inputValue}\r\n        onChange={handleInputChange}\r\n        onFocus={() => setOpen(true)}\r\n        placeholder={placeholder}\r\n        className={className}\r\n      />\r\n      {open && filteredSuggestions.length > 0 && (\r\n        <div\r\n          ref={dropdownRef}\r\n          className=\"absolute z-50 mt-1 w-full max-h-48 overflow-auto rounded-md border bg-popover p-1 shadow-md\"\r\n        >\r\n          {filteredSuggestions.map((suggestion) => (\r\n            <div\r\n              key={suggestion}\r\n              onClick={() => handleSelect(suggestion)}\r\n              className={cn(\r\n                \"relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground\",\r\n                suggestion === inputValue && \"bg-accent\"\r\n              )}\r\n            >\r\n              {suggestion === inputValue && (\r\n                <Check className=\"mr-2 h-4 w-4\" />\r\n              )}\r\n              <span className={suggestion === inputValue ? \"\" : \"pl-6\"}>\r\n                {suggestion}\r\n              </span>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import { useQuery } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\n\r\nexport interface RestaurantTypeSet {\r\n  zh: string;\r\n  en: string;\r\n  pt: string;\r\n}\r\n\r\nexport const useAllRestaurantTypes = () => {\r\n  return useQuery({\r\n    queryKey: [\"all-restaurant-types\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"restaurants\")\r\n        .select(\"type, type_en, type_pt\");\r\n\r\n      if (error) throw error;\r\n\r\n      // Build a map of unique type sets\r\n      const typeMap = new Map<string, RestaurantTypeSet>();\r\n\r\n      data.forEach((r) => {\r\n        const types = r.type || [];\r\n        const typesEn = r.type_en || [];\r\n        const typesPt = r.type_pt || [];\r\n\r\n        // Align types by index\r\n        const maxLen = Math.max(types.length, typesEn.length, typesPt.length);\r\n        for (let i = 0; i < maxLen; i++) {\r\n          const zh = types[i] || \"\";\r\n          const en = typesEn[i] || \"\";\r\n          const pt = typesPt[i] || \"\";\r\n          \r\n          // Use zh as primary key, but also check en/pt for dedup\r\n          const key = `${zh}|${en}|${pt}`;\r\n          if (zh || en || pt) {\r\n            if (!typeMap.has(key)) {\r\n              typeMap.set(key, { zh, en, pt });\r\n            }\r\n          }\r\n        }\r\n      });\r\n\r\n      // Also extract individual unique values for each language\r\n      const uniqueZh = new Set<string>();\r\n      const uniqueEn = new Set<string>();\r\n      const uniquePt = new Set<string>();\r\n\r\n      typeMap.forEach((t) => {\r\n        if (t.zh) uniqueZh.add(t.zh);\r\n        if (t.en) uniqueEn.add(t.en);\r\n        if (t.pt) uniquePt.add(t.pt);\r\n      });\r\n\r\n      return {\r\n        typeSets: Array.from(typeMap.values()),\r\n        uniqueZh: Array.from(uniqueZh).sort(),\r\n        uniqueEn: Array.from(uniqueEn).sort(),\r\n        uniquePt: Array.from(uniquePt).sort(),\r\n      };\r\n    },\r\n  });\r\n};\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { AspectRatio } from \"@/components/ui/aspect-ratio\";\r\nimport { Film, Play, Plus, Trash2, Upload, X, ImageIcon } from \"lucide-react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\n\r\ninterface VideoItem {\r\n  url: string;\r\n  title_zh?: string;\r\n  title_en?: string;\r\n  title_pt?: string;\r\n  poster_url?: string;\r\n  duration?: number;\r\n}\r\n\r\ninterface RestaurantVideoManagerProps {\r\n  bannerMediaType: 'image' | 'video';\r\n  onBannerMediaTypeChange: (type: 'image' | 'video') => void;\r\n  promoVideoUrl: string;\r\n  onPromoVideoUrlChange: (url: string) => void;\r\n  promoVideoPoster: string;\r\n  onPromoVideoPosterChange: (url: string) => void;\r\n  videos: VideoItem[];\r\n  onVideosChange: (videos: VideoItem[]) => void;\r\n}\r\n\r\nconst MAX_VIDEOS = 5;\r\n\r\nexport function RestaurantVideoManager({\r\n  bannerMediaType,\r\n  onBannerMediaTypeChange,\r\n  promoVideoUrl,\r\n  onPromoVideoUrlChange,\r\n  promoVideoPoster,\r\n  onPromoVideoPosterChange,\r\n  videos,\r\n  onVideosChange,\r\n}: RestaurantVideoManagerProps) {\r\n  const { t } = useTranslation();\r\n  const { toast } = useToast();\r\n  const [isUploading, setIsUploading] = useState(false);\r\n\r\n  const uploadFile = async (file: File, prefix: string, isVideo: boolean = false): Promise<string> => {\r\n    const fileExt = file.name.split(\".\").pop();\r\n    const fileName = `${prefix}_${Math.random()}.${fileExt}`;\r\n    const bucket = isVideo ? \"restaurant-videos\" : \"restaurant-images\";\r\n\r\n    const { error: uploadError } = await supabase.storage\r\n      .from(bucket)\r\n      .upload(fileName, file);\r\n\r\n    if (uploadError) throw uploadError;\r\n\r\n    const { data: { publicUrl } } = supabase.storage\r\n      .from(bucket)\r\n      .getPublicUrl(fileName);\r\n\r\n    return publicUrl;\r\n  };\r\n\r\n  const handlePromoVideoUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    setIsUploading(true);\r\n    try {\r\n      const url = await uploadFile(file, \"promo_video\", true);\r\n      onPromoVideoUrlChange(url);\r\n      toast({ title: t(\"common.success\"), description: t(\"admin.videoUploaded\", \"ËßÜÈ¢ë‰∏ä‰º†ÊàêÂäü\") });\r\n    } catch (error: any) {\r\n      toast({ title: t(\"common.error\"), description: error.message, variant: \"destructive\" });\r\n    } finally {\r\n      setIsUploading(false);\r\n    }\r\n  };\r\n\r\n  const handlePromoPosterUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    setIsUploading(true);\r\n    try {\r\n      const url = await uploadFile(file, \"promo_poster\");\r\n      onPromoVideoPosterChange(url);\r\n    } catch (error: any) {\r\n      toast({ title: t(\"common.error\"), description: error.message, variant: \"destructive\" });\r\n    } finally {\r\n      setIsUploading(false);\r\n    }\r\n  };\r\n\r\n  const addVideo = () => {\r\n    if (videos.length >= MAX_VIDEOS) return;\r\n    onVideosChange([...videos, { url: \"\", title_zh: \"\", title_en: \"\", title_pt: \"\", poster_url: \"\" }]);\r\n  };\r\n\r\n  const removeVideo = (index: number) => {\r\n    onVideosChange(videos.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const updateVideo = (index: number, field: keyof VideoItem, value: string | number) => {\r\n    const newVideos = [...videos];\r\n    newVideos[index] = { ...newVideos[index], [field]: value };\r\n    onVideosChange(newVideos);\r\n  };\r\n\r\n  const handleVideoUpload = async (index: number, e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    setIsUploading(true);\r\n    try {\r\n      const url = await uploadFile(file, `video_${index}`, true);\r\n      updateVideo(index, \"url\", url);\r\n      toast({ title: t(\"common.success\"), description: t(\"admin.videoUploaded\", \"ËßÜÈ¢ë‰∏ä‰º†ÊàêÂäü\") });\r\n    } catch (error: any) {\r\n      toast({ title: t(\"common.error\"), description: error.message, variant: \"destructive\" });\r\n    } finally {\r\n      setIsUploading(false);\r\n    }\r\n  };\r\n\r\n  const handleVideoPosterUpload = async (index: number, e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    setIsUploading(true);\r\n    try {\r\n      const url = await uploadFile(file, `video_poster_${index}`);\r\n      updateVideo(index, \"poster_url\", url);\r\n    } catch (error: any) {\r\n      toast({ title: t(\"common.error\"), description: error.message, variant: \"destructive\" });\r\n    } finally {\r\n      setIsUploading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Banner Media Type Selection */}\r\n      <Card className=\"border-primary/20\">\r\n        <CardContent className=\"p-4 space-y-4\">\r\n          <Label className=\"text-sm font-semibold flex items-center gap-2\">\r\n            <Film className=\"w-4 h-4 text-primary\" />\r\n            {t(\"restaurants.bannerType\", \"Ê®™ÂπÖÁ±ªÂûã\")}\r\n          </Label>\r\n          <RadioGroup\r\n            value={bannerMediaType}\r\n            onValueChange={(value) => onBannerMediaTypeChange(value as 'image' | 'video')}\r\n            className=\"flex gap-4\"\r\n          >\r\n            <div className=\"flex items-center space-x-2\">\r\n              <RadioGroupItem value=\"image\" id=\"banner-image\" />\r\n              <Label htmlFor=\"banner-image\" className=\"cursor-pointer text-sm\">\r\n                {t(\"restaurants.bannerImage\", \"ÂõæÁâá\")}\r\n              </Label>\r\n            </div>\r\n            <div className=\"flex items-center space-x-2\">\r\n              <RadioGroupItem value=\"video\" id=\"banner-video\" />\r\n              <Label htmlFor=\"banner-video\" className=\"cursor-pointer text-sm\">\r\n                {t(\"restaurants.bannerVideo\", \"ËßÜÈ¢ë\")}\r\n              </Label>\r\n            </div>\r\n          </RadioGroup>\r\n\r\n          {/* Promo Video Upload (only when video is selected) */}\r\n          {bannerMediaType === 'video' && (\r\n            <div className=\"space-y-4 pt-2\">\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                {t(\"restaurants.promoVideoHint\", \"ÂÆ£‰º†ËßÜÈ¢ëÂ∞ÜÂú®È°∂ÈÉ®Ê®™ÂπÖ‰ΩçÁΩÆËá™Âä®ÈùôÈü≥Âæ™ÁéØÊí≠Êîæ\")}\r\n              </p>\r\n              \r\n              {/* Video Upload */}\r\n              <div className=\"space-y-2\">\r\n                <Label className=\"text-sm\">{t(\"restaurants.promoVideo\", \"ÂÆ£‰º†ËßÜÈ¢ë\")}</Label>\r\n                <div className=\"flex items-center gap-3\">\r\n                  {promoVideoUrl ? (\r\n                    <div className=\"relative group\">\r\n                      <div className=\"w-40 h-24 bg-muted rounded-lg flex items-center justify-center overflow-hidden\">\r\n                        <video \r\n                          src={promoVideoUrl} \r\n                          className=\"w-full h-full object-cover\"\r\n                          muted\r\n                        />\r\n                        <div className=\"absolute inset-0 bg-black/30 flex items-center justify-center\">\r\n                          <Play className=\"w-8 h-8 text-white\" fill=\"white\" />\r\n                        </div>\r\n                      </div>\r\n                      <Button\r\n                        type=\"button\"\r\n                        variant=\"destructive\"\r\n                        size=\"icon\"\r\n                        className=\"absolute -top-2 -right-2 h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity rounded-full\"\r\n                        onClick={() => onPromoVideoUrlChange(\"\")}\r\n                      >\r\n                        <X className=\"h-3 w-3\" />\r\n                      </Button>\r\n                    </div>\r\n                  ) : (\r\n                    <Label htmlFor=\"promo-video-upload\" className=\"cursor-pointer\">\r\n                      <div className=\"flex flex-col items-center gap-2 px-6 py-4 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all\">\r\n                        <Upload className=\"h-6 w-6 text-primary\" />\r\n                        <p className=\"font-medium text-xs\">{t(\"admin.uploadVideo\", \"‰∏ä‰º†ËßÜÈ¢ë\")}</p>\r\n                      </div>\r\n                      <Input\r\n                        id=\"promo-video-upload\"\r\n                        type=\"file\"\r\n                        accept=\"video/*\"\r\n                        className=\"hidden\"\r\n                        onChange={handlePromoVideoUpload}\r\n                        disabled={isUploading}\r\n                      />\r\n                    </Label>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Video Poster Upload */}\r\n              <div className=\"space-y-2\">\r\n                <Label className=\"text-sm\">{t(\"restaurants.videoPoster\", \"ËßÜÈ¢ëÂ∞ÅÈù¢\")}</Label>\r\n                <p className=\"text-xs text-muted-foreground\">{t(\"restaurants.videoPosterHint\", \"ËßÜÈ¢ëÂä†ËΩΩÊó∂ÊòæÁ§∫ÁöÑÂ∞ÅÈù¢Âõæ\")}</p>\r\n                <div className=\"flex items-center gap-3\">\r\n                  {promoVideoPoster ? (\r\n                    <div className=\"relative group\">\r\n                      <img\r\n                        src={promoVideoPoster}\r\n                        alt=\"Video Poster\"\r\n                        className=\"w-32 h-20 object-cover rounded-lg shadow ring-2 ring-primary/20\"\r\n                      />\r\n                      <Button\r\n                        type=\"button\"\r\n                        variant=\"destructive\"\r\n                        size=\"icon\"\r\n                        className=\"absolute -top-2 -right-2 h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity rounded-full\"\r\n                        onClick={() => onPromoVideoPosterChange(\"\")}\r\n                      >\r\n                        <X className=\"h-3 w-3\" />\r\n                      </Button>\r\n                    </div>\r\n                  ) : (\r\n                    <Label htmlFor=\"promo-poster-upload\" className=\"cursor-pointer\">\r\n                      <div className=\"flex flex-col items-center gap-2 px-4 py-3 border-2 border-dashed border-muted-foreground/30 rounded-lg hover:border-primary/50 transition-all\">\r\n                        <ImageIcon className=\"h-5 w-5 text-muted-foreground\" />\r\n                        <p className=\"font-medium text-xs text-muted-foreground\">{t(\"admin.uploadImage\")}</p>\r\n                      </div>\r\n                      <Input\r\n                        id=\"promo-poster-upload\"\r\n                        type=\"file\"\r\n                        accept=\"image/*\"\r\n                        className=\"hidden\"\r\n                        onChange={handlePromoPosterUpload}\r\n                        disabled={isUploading}\r\n                      />\r\n                    </Label>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Video Gallery Section */}\r\n      <Card className=\"border-primary/20\">\r\n        <CardContent className=\"p-4 space-y-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <Label className=\"text-sm font-semibold flex items-center gap-2\">\r\n              <Play className=\"w-4 h-4 text-primary\" />\r\n              {t(\"restaurants.videoGallery\", \"ËßÜÈ¢ëÂàóË°®\")}\r\n            </Label>\r\n            <span className=\"text-xs text-muted-foreground\">\r\n              {t(\"restaurants.maxVideos\", { count: MAX_VIDEOS })}\r\n            </span>\r\n          </div>\r\n          \r\n          <p className=\"text-xs text-muted-foreground\">\r\n            {t(\"restaurants.videoGalleryHint\", \"Ê∑ªÂä†ÁæéÈ£üÂà∂‰ΩúËøáÁ®ã„ÄÅÂìÅÁâåÊïÖ‰∫ãÁ≠âËßÜÈ¢ë\")}\r\n          </p>\r\n\r\n          {/* Video List */}\r\n          <div className=\"space-y-4\">\r\n            {videos.map((video, index) => (\r\n              <div key={index} className=\"p-4 border rounded-lg space-y-3 bg-muted/30\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span className=\"text-sm font-medium\">{t(\"common.video\", \"ËßÜÈ¢ë\")} #{index + 1}</span>\r\n                  <Button\r\n                    type=\"button\"\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    onClick={() => removeVideo(index)}\r\n                    className=\"text-destructive hover:text-destructive\"\r\n                  >\r\n                    <Trash2 className=\"w-4 h-4\" />\r\n                  </Button>\r\n                </div>\r\n\r\n                {/* Video Upload */}\r\n                <div className=\"space-y-3\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    {video.url ? (\r\n                      <div className=\"relative group\">\r\n                        <div className=\"w-32 h-20 bg-muted rounded-lg flex items-center justify-center overflow-hidden\">\r\n                          <video \r\n                            src={video.url} \r\n                            className=\"w-full h-full object-cover\"\r\n                            muted\r\n                          />\r\n                          <div className=\"absolute inset-0 bg-black/30 flex items-center justify-center\">\r\n                            <Play className=\"w-6 h-6 text-white\" fill=\"white\" />\r\n                          </div>\r\n                        </div>\r\n                        <Button\r\n                          type=\"button\"\r\n                          variant=\"destructive\"\r\n                          size=\"icon\"\r\n                          className=\"absolute -top-2 -right-2 h-5 w-5 opacity-0 group-hover:opacity-100 transition-opacity rounded-full\"\r\n                          onClick={() => updateVideo(index, \"url\", \"\")}\r\n                        >\r\n                          <X className=\"h-3 w-3\" />\r\n                        </Button>\r\n                      </div>\r\n                    ) : (\r\n                      <Label htmlFor={`video-upload-${index}`} className=\"cursor-pointer\">\r\n                        <div className=\"flex flex-col items-center gap-1 px-4 py-3 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all\">\r\n                          <Upload className=\"h-5 w-5 text-primary\" />\r\n                          <p className=\"font-medium text-xs\">{t(\"admin.uploadVideo\", \"‰∏ä‰º†ËßÜÈ¢ë\")}</p>\r\n                        </div>\r\n                        <Input\r\n                          id={`video-upload-${index}`}\r\n                          type=\"file\"\r\n                          accept=\"video/*\"\r\n                          className=\"hidden\"\r\n                          onChange={(e) => handleVideoUpload(index, e)}\r\n                          disabled={isUploading}\r\n                        />\r\n                      </Label>\r\n                    )}\r\n\r\n                    {/* Poster Upload - Required */}\r\n                    {video.poster_url ? (\r\n                      <div className=\"relative group\">\r\n                        <img\r\n                          src={video.poster_url}\r\n                          alt=\"Poster\"\r\n                          className=\"w-20 h-20 object-cover rounded-lg ring-2 ring-primary/20\"\r\n                        />\r\n                        <Button\r\n                          type=\"button\"\r\n                          variant=\"destructive\"\r\n                          size=\"icon\"\r\n                          className=\"absolute -top-2 -right-2 h-5 w-5 opacity-0 group-hover:opacity-100 transition-opacity rounded-full\"\r\n                          onClick={() => updateVideo(index, \"poster_url\", \"\")}\r\n                        >\r\n                          <X className=\"h-3 w-3\" />\r\n                        </Button>\r\n                      </div>\r\n                    ) : (\r\n                      <Label htmlFor={`poster-upload-${index}`} className=\"cursor-pointer\">\r\n                        <div className={`flex flex-col items-center gap-1 px-3 py-2 border-2 border-dashed rounded-lg transition-all ${video.url ? 'border-destructive/50 bg-destructive/5' : 'border-muted-foreground/30 hover:border-primary/50'}`}>\r\n                          <ImageIcon className={`h-4 w-4 ${video.url ? 'text-destructive' : 'text-muted-foreground'}`} />\r\n                          <p className={`text-xs ${video.url ? 'text-destructive font-medium' : 'text-muted-foreground'}`}>\r\n                            {t(\"restaurants.videoPoster\", \"Â∞ÅÈù¢\")}\r\n                            {video.url && <span className=\"text-destructive\">*</span>}\r\n                          </p>\r\n                        </div>\r\n                        <Input\r\n                          id={`poster-upload-${index}`}\r\n                          type=\"file\"\r\n                          accept=\"image/*\"\r\n                          className=\"hidden\"\r\n                          onChange={(e) => handleVideoPosterUpload(index, e)}\r\n                          disabled={isUploading}\r\n                        />\r\n                      </Label>\r\n                    )}\r\n                  </div>\r\n                  \r\n                  {/* Required poster warning */}\r\n                  {video.url && !video.poster_url && (\r\n                    <p className=\"text-xs text-destructive flex items-center gap-1\">\r\n                      <span>‚ö†Ô∏è</span>\r\n                      {t(\"restaurants.posterRequired\", \"ËØ∑‰∏ä‰º†ËßÜÈ¢ëÂ∞ÅÈù¢ÂõæÔºåÁî®‰∫éÂú®ÂàóË°®‰∏≠Â±ïÁ§∫\")}\r\n                    </p>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Video Titles (Tri-lingual) */}\r\n                <Tabs defaultValue=\"zh\" className=\"w-full\">\r\n                  <TabsList className=\"grid w-full grid-cols-3 h-8\">\r\n                    <TabsTrigger value=\"zh\" className=\"text-xs\">üá®üá≥</TabsTrigger>\r\n                    <TabsTrigger value=\"en\" className=\"text-xs\">üá¨üáß</TabsTrigger>\r\n                    <TabsTrigger value=\"pt\" className=\"text-xs\">üáµüáπ</TabsTrigger>\r\n                  </TabsList>\r\n                  <TabsContent value=\"zh\" className=\"mt-2\">\r\n                    <Input\r\n                      value={video.title_zh || \"\"}\r\n                      onChange={(e) => updateVideo(index, \"title_zh\", e.target.value)}\r\n                      placeholder={t(\"restaurants.videoTitle\", \"ËßÜÈ¢ëÊ†áÈ¢ò\") + \" (‰∏≠Êñá)\"}\r\n                      className=\"text-sm\"\r\n                    />\r\n                  </TabsContent>\r\n                  <TabsContent value=\"en\" className=\"mt-2\">\r\n                    <Input\r\n                      value={video.title_en || \"\"}\r\n                      onChange={(e) => updateVideo(index, \"title_en\", e.target.value)}\r\n                      placeholder=\"Video Title (English)\"\r\n                      className=\"text-sm\"\r\n                    />\r\n                  </TabsContent>\r\n                  <TabsContent value=\"pt\" className=\"mt-2\">\r\n                    <Input\r\n                      value={video.title_pt || \"\"}\r\n                      onChange={(e) => updateVideo(index, \"title_pt\", e.target.value)}\r\n                      placeholder=\"T√≠tulo do V√≠deo (Portugu√™s)\"\r\n                      className=\"text-sm\"\r\n                    />\r\n                  </TabsContent>\r\n                </Tabs>\r\n\r\n                {/* Duration */}\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Label className=\"text-xs text-muted-foreground\">{t(\"common.duration\", \"Êó∂Èïø\")} (s):</Label>\r\n                  <Input\r\n                    type=\"number\"\r\n                    value={video.duration || \"\"}\r\n                    onChange={(e) => updateVideo(index, \"duration\", parseInt(e.target.value) || 0)}\r\n                    placeholder=\"90\"\r\n                    className=\"w-20 h-8 text-sm\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          {/* Add Video Button */}\r\n          {videos.length < MAX_VIDEOS && (\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={addVideo}\r\n              className=\"w-full gap-2\"\r\n            >\r\n              <Plus className=\"w-4 h-4\" />\r\n              {t(\"restaurants.addVideo\", \"Ê∑ªÂä†ËßÜÈ¢ë\")}\r\n            </Button>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default RestaurantVideoManager;\r\n","import { useState, useEffect, useRef } from \"react\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\nimport * as z from \"zod\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport mapboxgl from \"mapbox-gl\";\r\nimport \"mapbox-gl/dist/mapbox-gl.css\";\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { Switch } from \"@/components/ui/switch\";\r\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\r\nimport { Upload, X, MapPin, Globe, Store, Clock, Phone, Globe as WebIcon, Key, ImageIcon, ShoppingBag, UtensilsCrossed, User, Building2, Link, Film, Ghost } from \"lucide-react\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { DishImageManager } from \"@/components/admin/DishImageManager\";\r\nimport { RichTextEditor } from \"@/components/admin/RichTextEditor\";\r\nimport { TypeCombobox } from \"@/components/admin/TypeCombobox\";\r\nimport { useAllRestaurantTypes } from \"@/hooks/useAllRestaurantTypes\";\r\nimport { useBrands, Brand } from \"@/hooks/useBrands\";\r\nimport { RestaurantVideoManager } from \"@/components/admin/RestaurantVideoManager\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport i18n from \"@/i18n/config\";\r\n\r\ninterface VideoItem {\r\n  url: string;\r\n  title_zh?: string;\r\n  title_en?: string;\r\n  title_pt?: string;\r\n  poster_url?: string;\r\n  duration?: number;\r\n}\r\n\r\nconst restaurantSchema = z.object({\r\n  name: z.string().min(1, i18n.t(\"validation.nameRequired\")),\r\n  name_en: z.string().min(1, i18n.t(\"validation.nameRequired\")),\r\n  name_pt: z.string().min(1, i18n.t(\"validation.nameRequired\")),\r\n  key_id: z.string().optional(),\r\n  type: z.array(z.string()).min(1, i18n.t(\"validation.typeRequired\")).max(3, i18n.t(\"validation.typeMaximum\")),\r\n  type_en: z.array(z.string()).min(1, i18n.t(\"validation.typeRequired\")).max(3, i18n.t(\"validation.typeMaximum\")),\r\n  type_pt: z.array(z.string()).min(1, i18n.t(\"validation.typeRequired\")).max(3, i18n.t(\"validation.typeMaximum\")),\r\n  description: z.string().optional(),\r\n  description_en: z.string().optional(),\r\n  description_pt: z.string().optional(),\r\n  announcement_zh: z.string().optional(),\r\n  announcement_en: z.string().optional(),\r\n  announcement_pt: z.string().optional(),\r\n  address: z.string().min(1, i18n.t(\"validation.addressRequired\")),\r\n  lat: z.number(),\r\n  lng: z.number(),\r\n  phone: z.string().optional(),\r\n  website_url: z.string().optional(),\r\n  visible: z.boolean().default(true),\r\n  show_takeaway_button: z.boolean().default(true),\r\n  show_booking_button: z.boolean().default(true),\r\n  show_ghost_intro: z.boolean().default(true),\r\n});\r\n\r\ntype RestaurantFormData = z.infer<typeof restaurantSchema>;\r\n\r\ninterface RestaurantFormDialogProps {\r\n  restaurant?: any;\r\n  trigger: React.ReactNode;\r\n}\r\n\r\ninterface DayHours {\r\n  open: string;\r\n  close: string;\r\n  closed: boolean;\r\n  splitShift?: boolean; // ÂàÜÊÆµËê•‰∏öÊ®°Âºè\r\n  open2?: string; // Á¨¨‰∫åÊó∂ÊÆµÂºÄÈó®Êó∂Èó¥\r\n  close2?: string; // Á¨¨‰∫åÊó∂ÊÆµÂÖ≥Èó®Êó∂Èó¥\r\n}\r\n\r\nconst DAYS = [\"monday\", \"tuesday\", \"wednesday\", \"thursday\", \"friday\", \"saturday\", \"sunday\"];\r\n\r\nexport function RestaurantFormDialog({ restaurant, trigger }: RestaurantFormDialogProps) {\r\n  const { t } = useTranslation();\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n  const { isAdmin } = useUserRole();\r\n  const { data: existingTypes } = useAllRestaurantTypes();\r\n  const { data: brands } = useBrands();\r\n  const [open, setOpen] = useState(false);\r\n  const [isChain, setIsChain] = useState<boolean>(restaurant?.is_chain || false);\r\n  const [brandId, setBrandId] = useState<string | null>(restaurant?.brand_id || null);\r\n  const [imageFile, setImageFile] = useState<File | null>(null);\r\n  const [imagePreview, setImagePreview] = useState<string | null>(restaurant?.image_url || null);\r\n  const [coverImageFile, setCoverImageFile] = useState<File | null>(null);\r\n  const [coverImagePreview, setCoverImagePreview] = useState<string | null>(restaurant?.cover_image_url || null);\r\n  const [ownerAvatarFile, setOwnerAvatarFile] = useState<File | null>(null);\r\n  const [ownerAvatarPreview, setOwnerAvatarPreview] = useState<string | null>(restaurant?.owner_avatar_url || null);\r\n  const [bannerFile, setBannerFile] = useState<File | null>(null);\r\n  const [bannerPreview, setBannerPreview] = useState<string | null>(restaurant?.banner_url || null);\r\n  const [ownerBio, setOwnerBio] = useState<string>(restaurant?.owner_bio || \"\");\r\n  const [ownerBioEn, setOwnerBioEn] = useState<string>(restaurant?.owner_bio_en || \"\");\r\n  const [ownerBioPt, setOwnerBioPt] = useState<string>(restaurant?.owner_bio_pt || \"\");\r\n  const [ownerName, setOwnerName] = useState<string>((restaurant as any)?.owner_name || \"\");\r\n  const [ownerNameEn, setOwnerNameEn] = useState<string>((restaurant as any)?.owner_name_en || \"\");\r\n  const [ownerNamePt, setOwnerNamePt] = useState<string>((restaurant as any)?.owner_name_pt || \"\");\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  \r\n  // Video management state\r\n  const [bannerMediaType, setBannerMediaType] = useState<'image' | 'video'>(\r\n    (restaurant?.banner_media_type as 'image' | 'video') || 'image'\r\n  );\r\n  const [promoVideoUrl, setPromoVideoUrl] = useState<string>(restaurant?.promo_video_url || \"\");\r\n  const [promoVideoPoster, setPromoVideoPoster] = useState<string>(restaurant?.promo_video_poster || \"\");\r\n  const [videos, setVideos] = useState<VideoItem[]>(() => {\r\n    if (restaurant?.videos && Array.isArray(restaurant.videos)) {\r\n      return restaurant.videos as VideoItem[];\r\n    }\r\n    return [];\r\n  });\r\n  const mapContainer = useRef<HTMLDivElement>(null);\r\n  const map = useRef<mapboxgl.Map | null>(null);\r\n  const marker = useRef<mapboxgl.Marker | null>(null);\r\n  const [openingHours, setOpeningHours] = useState<Record<string, DayHours>>(() => {\r\n    const defaultHours: Record<string, DayHours> = {};\r\n    DAYS.forEach(day => {\r\n      defaultHours[day] = { \r\n        open: \"12:00\", \r\n        close: \"23:00\", \r\n        closed: false,\r\n        splitShift: false,\r\n        open2: \"19:00\",\r\n        close2: \"23:00\"\r\n      };\r\n    });\r\n    if (restaurant?.opening_hours) {\r\n      return { ...defaultHours, ...restaurant.opening_hours };\r\n    }\r\n    return defaultHours;\r\n  });\r\n  \r\n  // State for template type\r\n  const [template, setTemplate] = useState<string>(restaurant?.template || 'default');\r\n  \r\n  // Reset all local state when dialog opens or restaurant prop changes\r\n  useEffect(() => {\r\n    if (open) {\r\n      setIsChain(restaurant?.is_chain || false);\r\n      setBrandId(restaurant?.brand_id || null);\r\n      setImageFile(null);\r\n      setImagePreview(restaurant?.image_url || null);\r\n      setCoverImageFile(null);\r\n      setCoverImagePreview(restaurant?.cover_image_url || null);\r\n      setOwnerAvatarFile(null);\r\n      setOwnerAvatarPreview(restaurant?.owner_avatar_url || null);\r\n      setBannerFile(null);\r\n      setBannerPreview(restaurant?.banner_url || null);\r\n      setOwnerBio(restaurant?.owner_bio || \"\");\r\n      setOwnerBioEn(restaurant?.owner_bio_en || \"\");\r\n      setOwnerBioPt(restaurant?.owner_bio_pt || \"\");\r\n      setOwnerName((restaurant as any)?.owner_name || \"\");\r\n      setOwnerNameEn((restaurant as any)?.owner_name_en || \"\");\r\n      setOwnerNamePt((restaurant as any)?.owner_name_pt || \"\");\r\n      setBannerMediaType((restaurant?.banner_media_type as 'image' | 'video') || 'image');\r\n      setPromoVideoUrl(restaurant?.promo_video_url || \"\");\r\n      setPromoVideoPoster(restaurant?.promo_video_poster || \"\");\r\n      setVideos(restaurant?.videos && Array.isArray(restaurant.videos) ? restaurant.videos as VideoItem[] : []);\r\n      setTemplate(restaurant?.template || 'default');\r\n\r\n      // Reset opening hours\r\n      const defaultHours: Record<string, DayHours> = {};\r\n      DAYS.forEach(day => {\r\n        defaultHours[day] = { open: \"12:00\", close: \"23:00\", closed: false, splitShift: false, open2: \"19:00\", close2: \"23:00\" };\r\n      });\r\n      setOpeningHours(restaurant?.opening_hours ? { ...defaultHours, ...restaurant.opening_hours } : defaultHours);\r\n\r\n      // Reset types\r\n      if (restaurant?.type && Array.isArray(restaurant.type)) {\r\n        setTypes(restaurant.type.map((zh: string, idx: number) => ({\r\n          zh,\r\n          en: restaurant.type_en?.[idx] || \"\",\r\n          pt: restaurant.type_pt?.[idx] || \"\",\r\n        })));\r\n      } else {\r\n        setTypes([{ zh: \"\", en: \"\", pt: \"\" }]);\r\n      }\r\n\r\n      // Reset form values\r\n      if (restaurant) {\r\n        setValue('name', restaurant.name);\r\n        setValue('name_en', restaurant.name_en || \"\");\r\n        setValue('name_pt', restaurant.name_pt || \"\");\r\n        setValue('key_id', restaurant.key_id || \"\");\r\n        setValue('type', Array.isArray(restaurant.type) ? restaurant.type : [restaurant.type]);\r\n        setValue('type_en', Array.isArray(restaurant.type_en) ? restaurant.type_en : (restaurant.type_en ? [restaurant.type_en] : [\"\"]));\r\n        setValue('type_pt', Array.isArray(restaurant.type_pt) ? restaurant.type_pt : (restaurant.type_pt ? [restaurant.type_pt] : [\"\"]));\r\n        setValue('description', restaurant.description || \"\");\r\n        setValue('description_en', restaurant.description_en || \"\");\r\n        setValue('description_pt', restaurant.description_pt || \"\");\r\n        setValue('announcement_zh', restaurant.announcement_zh || \"\");\r\n        setValue('announcement_en', restaurant.announcement_en || \"\");\r\n        setValue('announcement_pt', restaurant.announcement_pt || \"\");\r\n        setValue('address', restaurant.address);\r\n        setValue('lat', typeof restaurant.lat === 'number' && !isNaN(restaurant.lat) ? restaurant.lat : 38.7223);\r\n        setValue('lng', typeof restaurant.lng === 'number' && !isNaN(restaurant.lng) ? restaurant.lng : -9.1393);\r\n        setValue('phone', restaurant.phone || \"\");\r\n        setValue('website_url', restaurant.website_url || \"\");\r\n        setValue('visible', restaurant.visible ?? true);\r\n        setValue('show_takeaway_button', restaurant.show_takeaway_button ?? true);\r\n        setValue('show_booking_button', restaurant.show_booking_button ?? true);\r\n        setValue('show_ghost_intro', restaurant.show_ghost_intro ?? true);\r\n      }\r\n    }\r\n  }, [open, restaurant]);\r\n\r\n  // State for multiple types (1-3 tags)\r\n  const [types, setTypes] = useState<{ zh: string; en: string; pt: string }[]>(() => {\r\n    if (restaurant?.type && Array.isArray(restaurant.type)) {\r\n      return restaurant.type.map((zh: string, idx: number) => ({\r\n        zh,\r\n        en: restaurant.type_en?.[idx] || \"\",\r\n        pt: restaurant.type_pt?.[idx] || \"\",\r\n      }));\r\n    }\r\n    return [{ zh: \"\", en: \"\", pt: \"\" }];\r\n  });\r\n\r\n  const {\r\n    register,\r\n    handleSubmit,\r\n    formState: { errors },\r\n    setValue,\r\n    watch,\r\n    trigger: triggerValidation,\r\n  } = useForm<RestaurantFormData>({\r\n    resolver: zodResolver(restaurantSchema),\r\n    defaultValues: restaurant ? {\r\n      name: restaurant.name,\r\n      name_en: restaurant.name_en || \"\",\r\n      name_pt: restaurant.name_pt || \"\",\r\n      key_id: restaurant.key_id || \"\",\r\n      type: Array.isArray(restaurant.type) ? restaurant.type : [restaurant.type],\r\n      type_en: Array.isArray(restaurant.type_en) ? restaurant.type_en : (restaurant.type_en ? [restaurant.type_en] : [\"\"]),\r\n      type_pt: Array.isArray(restaurant.type_pt) ? restaurant.type_pt : (restaurant.type_pt ? [restaurant.type_pt] : [\"\"]),\r\n      description: restaurant.description || \"\",\r\n      description_en: restaurant.description_en || \"\",\r\n      description_pt: restaurant.description_pt || \"\",\r\n      announcement_zh: restaurant.announcement_zh || \"\",\r\n      announcement_en: restaurant.announcement_en || \"\",\r\n      announcement_pt: restaurant.announcement_pt || \"\",\r\n      address: restaurant.address,\r\n      lat: typeof restaurant.lat === 'number' && !isNaN(restaurant.lat) ? restaurant.lat : 38.7223,\r\n      lng: typeof restaurant.lng === 'number' && !isNaN(restaurant.lng) ? restaurant.lng : -9.1393,\r\n      phone: restaurant.phone || \"\",\r\n      website_url: restaurant.website_url || \"\",\r\n      visible: restaurant.visible ?? true,\r\n      show_takeaway_button: restaurant.show_takeaway_button ?? true,\r\n      show_booking_button: restaurant.show_booking_button ?? true,\r\n      show_ghost_intro: restaurant.show_ghost_intro ?? true,\r\n    } : {\r\n      name: \"\",\r\n      name_en: \"\",\r\n      name_pt: \"\",\r\n      key_id: \"\",\r\n      type: [\"\"],\r\n      type_en: [\"\"],\r\n      type_pt: [\"\"],\r\n      description: \"\",\r\n      description_en: \"\",\r\n      description_pt: \"\",\r\n      announcement_zh: \"\",\r\n      announcement_en: \"\",\r\n      announcement_pt: \"\",\r\n      address: \"\",\r\n      lat: 38.7223,\r\n      lng: -9.1393,\r\n      phone: \"\",\r\n      website_url: \"\",\r\n      visible: true,\r\n      show_takeaway_button: true,\r\n      show_booking_button: true,\r\n      show_ghost_intro: true,\r\n    },\r\n  });\r\n\r\n  // Helper to show validation errors\r\n  const showValidationErrors = () => {\r\n    const errorMessages: string[] = [];\r\n    \r\n    if (errors.name) errorMessages.push(t(\"admin.fieldName\") + \" (‰∏≠Êñá)\");\r\n    if (errors.name_en) errorMessages.push(t(\"admin.fieldName\") + \" (EN)\");\r\n    if (errors.name_pt) errorMessages.push(t(\"admin.fieldName\") + \" (PT)\");\r\n    if (errors.type) errorMessages.push(t(\"admin.fieldType\") + \" (‰∏≠Êñá)\");\r\n    if (errors.type_en) errorMessages.push(t(\"admin.fieldType\") + \" (EN)\");\r\n    if (errors.type_pt) errorMessages.push(t(\"admin.fieldType\") + \" (PT)\");\r\n    if (errors.address) errorMessages.push(t(\"admin.fieldAddress\"));\r\n    if (errors.lat || errors.lng) errorMessages.push(t(\"admin.fieldLocation\"));\r\n    \r\n    if (errorMessages.length > 0) {\r\n      toast({\r\n        title: t(\"admin.validationFailed\"),\r\n        description: t(\"admin.missingFields\") + \": \" + errorMessages.join(\", \"),\r\n        variant: \"destructive\",\r\n      });\r\n    }\r\n  };\r\n  \r\n  const addType = () => {\r\n    if (types.length < 3) {\r\n      setTypes([...types, { zh: \"\", en: \"\", pt: \"\" }]);\r\n    }\r\n  };\r\n  \r\n  const removeType = (index: number) => {\r\n    if (types.length > 1) {\r\n      setTypes(types.filter((_, i) => i !== index));\r\n    }\r\n  };\r\n  \r\n  const updateType = (index: number, field: 'zh' | 'en' | 'pt', value: string) => {\r\n    const newTypes = [...types];\r\n    newTypes[index][field] = value;\r\n    setTypes(newTypes);\r\n    \r\n    // Update form values\r\n    setValue('type', newTypes.map(t => t.zh).filter(Boolean));\r\n    setValue('type_en', newTypes.map(t => t.en).filter(Boolean));\r\n    setValue('type_pt', newTypes.map(t => t.pt).filter(Boolean));\r\n  };\r\n\r\n  const lat = watch(\"lat\");\r\n  const lng = watch(\"lng\");\r\n  const visible = watch(\"visible\");\r\n  const showTakeawayButton = watch(\"show_takeaway_button\");\r\n  const showBookingButton = watch(\"show_booking_button\");\r\n  const showGhostIntro = watch(\"show_ghost_intro\");\r\n\r\n  // Helper function to check if coordinates are valid\r\n  const isValidCoordinate = (lat: number, lng: number) => {\r\n    return typeof lat === 'number' && typeof lng === 'number' && \r\n           !isNaN(lat) && !isNaN(lng) && \r\n           isFinite(lat) && isFinite(lng);\r\n  };\r\n\r\n  // Initialize map when dialog opens\r\n  useEffect(() => {\r\n    if (!open) {\r\n      // Clean up map when dialog closes\r\n      if (map.current) {\r\n        map.current.remove();\r\n        map.current = null;\r\n        marker.current = null;\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Don't initialize if already exists\r\n    if (map.current) return;\r\n\r\n    const mapboxToken = import.meta.env.VITE_MAPBOX_TOKEN;\r\n    if (!mapboxToken) {\r\n      console.error(\"Mapbox token not found\");\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"admin.mapboxTokenNotConfigured\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Wait for container to be rendered\r\n    const initMap = () => {\r\n      if (!mapContainer.current) {\r\n        console.error(\"Map container not found\");\r\n        return;\r\n      }\r\n\r\n      try {\r\n        mapboxgl.accessToken = mapboxToken;\r\n\r\n        // Use valid coordinates or default to Lisbon\r\n        const centerLng = isValidCoordinate(lat, lng) ? lng : -9.1393;\r\n        const centerLat = isValidCoordinate(lat, lng) ? lat : 38.7223;\r\n\r\n        map.current = new mapboxgl.Map({\r\n          container: mapContainer.current,\r\n          style: \"mapbox://styles/mapbox/light-v11\",\r\n          center: [centerLng, centerLat],\r\n          zoom: 15,\r\n        });\r\n\r\n        // Disable scroll zoom by default (require Ctrl key)\r\n        map.current.scrollZoom.disable();\r\n\r\n        map.current.on('load', () => {\r\n          if (!map.current) return;\r\n          \r\n          // Add marker after map loads only if coordinates are valid\r\n          if (isValidCoordinate(lat, lng)) {\r\n            marker.current = new mapboxgl.Marker({ draggable: true })\r\n              .setLngLat([lng, lat])\r\n              .addTo(map.current);\r\n          }\r\n\r\n          marker.current.on(\"dragend\", () => {\r\n            const lngLat = marker.current!.getLngLat();\r\n            setValue(\"lng\", lngLat.lng);\r\n            setValue(\"lat\", lngLat.lat);\r\n          });\r\n\r\n          // Resize to fit container\r\n          setTimeout(() => {\r\n            map.current?.resize();\r\n          }, 100);\r\n        });\r\n\r\n        // Enable scroll zoom only when Ctrl key is pressed\r\n        const handleWheel = (e: WheelEvent) => {\r\n          if (e.ctrlKey || e.metaKey) {\r\n            map.current?.scrollZoom.enable();\r\n          } else {\r\n            map.current?.scrollZoom.disable();\r\n          }\r\n        };\r\n\r\n        mapContainer.current.addEventListener('wheel', handleWheel);\r\n\r\n        map.current.on(\"click\", (e) => {\r\n          const { lng, lat } = e.lngLat;\r\n          setValue(\"lng\", lng);\r\n          setValue(\"lat\", lat);\r\n          marker.current?.setLngLat([lng, lat]);\r\n        });\r\n\r\n        map.current.on('error', (e) => {\r\n          console.error(\"Map error:\", e);\r\n        });\r\n      } catch (error) {\r\n        console.error(\"Failed to initialize map:\", error);\r\n      }\r\n    };\r\n\r\n    // Give time for dialog animation and container to render\r\n    const timer = setTimeout(initMap, 500);\r\n\r\n    return () => {\r\n      clearTimeout(timer);\r\n    };\r\n  }, [open, lat, lng]);\r\n\r\n  // Update marker position when lat/lng changes\r\n  useEffect(() => {\r\n    if (marker.current && map.current && isValidCoordinate(lat, lng)) {\r\n      marker.current.setLngLat([lng, lat]);\r\n      map.current.setCenter([lng, lat]);\r\n    }\r\n  }, [lat, lng]);\r\n\r\n  const handleImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      setImageFile(file);\r\n      const reader = new FileReader();\r\n      reader.onloadend = () => {\r\n        setImagePreview(reader.result as string);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  };\r\n\r\n  const handleCoverImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      setCoverImageFile(file);\r\n      const reader = new FileReader();\r\n      reader.onloadend = () => {\r\n        setCoverImagePreview(reader.result as string);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  };\r\n\r\n  const handleOwnerAvatarChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      setOwnerAvatarFile(file);\r\n      const reader = new FileReader();\r\n      reader.onloadend = () => {\r\n        setOwnerAvatarPreview(reader.result as string);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  };\r\n\r\n  const handleBannerChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      setBannerFile(file);\r\n      const reader = new FileReader();\r\n      reader.onloadend = () => {\r\n        setBannerPreview(reader.result as string);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  };\r\n\r\n  const uploadImage = async (): Promise<string | null> => {\r\n    if (!imageFile) return restaurant?.image_url || null;\r\n\r\n    const fileExt = imageFile.name.split(\".\").pop();\r\n    const fileName = `${Math.random()}.${fileExt}`;\r\n    const filePath = `${fileName}`;\r\n\r\n    const { error: uploadError } = await supabase.storage\r\n      .from(\"restaurant-images\")\r\n      .upload(filePath, imageFile);\r\n\r\n    if (uploadError) {\r\n      throw uploadError;\r\n    }\r\n\r\n    const { data: { publicUrl } } = supabase.storage\r\n      .from(\"restaurant-images\")\r\n      .getPublicUrl(filePath);\r\n\r\n    return publicUrl;\r\n  };\r\n\r\n  const uploadCoverImage = async (): Promise<string | null> => {\r\n    if (!coverImageFile) return restaurant?.cover_image_url || null;\r\n\r\n    const fileExt = coverImageFile.name.split(\".\").pop();\r\n    const fileName = `cover_${Math.random()}.${fileExt}`;\r\n    const filePath = `${fileName}`;\r\n\r\n    const { error: uploadError } = await supabase.storage\r\n      .from(\"restaurant-images\")\r\n      .upload(filePath, coverImageFile);\r\n\r\n    if (uploadError) {\r\n      throw uploadError;\r\n    }\r\n\r\n    const { data: { publicUrl } } = supabase.storage\r\n      .from(\"restaurant-images\")\r\n      .getPublicUrl(filePath);\r\n\r\n    return publicUrl;\r\n  };\r\n\r\n  const uploadOwnerAvatar = async (): Promise<string | null> => {\r\n    if (!ownerAvatarFile) return restaurant?.owner_avatar_url || null;\r\n\r\n    const fileExt = ownerAvatarFile.name.split(\".\").pop();\r\n    const fileName = `owner_${Math.random()}.${fileExt}`;\r\n    const filePath = `${fileName}`;\r\n\r\n    const { error: uploadError } = await supabase.storage\r\n      .from(\"restaurant-images\")\r\n      .upload(filePath, ownerAvatarFile);\r\n\r\n    if (uploadError) {\r\n      throw uploadError;\r\n    }\r\n\r\n    const { data: { publicUrl } } = supabase.storage\r\n      .from(\"restaurant-images\")\r\n      .getPublicUrl(filePath);\r\n\r\n    return publicUrl;\r\n  };\r\n\r\n  const uploadBanner = async (): Promise<string | null> => {\r\n    if (!bannerFile) return restaurant?.banner_url || null;\r\n\r\n    const fileExt = bannerFile.name.split(\".\").pop();\r\n    const fileName = `banner_${Math.random()}.${fileExt}`;\r\n    const filePath = `${fileName}`;\r\n\r\n    const { error: uploadError } = await supabase.storage\r\n      .from(\"restaurant-images\")\r\n      .upload(filePath, bannerFile);\r\n\r\n    if (uploadError) {\r\n      throw uploadError;\r\n    }\r\n\r\n    const { data: { publicUrl } } = supabase.storage\r\n      .from(\"restaurant-images\")\r\n      .getPublicUrl(filePath);\r\n\r\n    return publicUrl;\r\n  };\r\n\r\n  const onSubmit = async (data: RestaurantFormData) => {\r\n    setIsSubmitting(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      const imageUrl = await uploadImage();\r\n      const coverImageUrl = await uploadCoverImage();\r\n      const ownerAvatarUrl = await uploadOwnerAvatar();\r\n      const bannerUrl = await uploadBanner();\r\n\r\n      const restaurantData = {\r\n        name: data.name,\r\n        name_en: data.name_en,\r\n        name_pt: data.name_pt,\r\n        key_id: data.key_id || null,\r\n        type: data.type,\r\n        type_en: data.type_en,\r\n        type_pt: data.type_pt,\r\n        description: data.description || null,\r\n        description_en: data.description_en || null,\r\n        description_pt: data.description_pt || null,\r\n        announcement_zh: data.announcement_zh || null,\r\n        announcement_en: data.announcement_en || null,\r\n        announcement_pt: data.announcement_pt || null,\r\n        address: data.address,\r\n        lat: data.lat,\r\n        lng: data.lng,\r\n        phone: data.phone || null,\r\n        website_url: data.website_url || null,\r\n        visible: data.visible,\r\n        show_takeaway_button: data.show_takeaway_button,\r\n        show_booking_button: template === 'ghost' ? false : data.show_booking_button,\r\n        show_ghost_intro: template === 'ghost' ? data.show_ghost_intro : true,\r\n        image_url: imageUrl,\r\n        cover_image_url: coverImageUrl,\r\n        opening_hours: template === 'ghost' ? null : openingHours as any,\r\n        template: template,\r\n        owner_avatar_url: ownerAvatarUrl,\r\n        banner_url: bannerUrl,\r\n        owner_bio: ownerBio || null,\r\n        owner_bio_en: ownerBioEn || null,\r\n        owner_bio_pt: ownerBioPt || null,\r\n        owner_name: ownerName || null,\r\n        owner_name_en: ownerNameEn || null,\r\n        owner_name_pt: ownerNamePt || null,\r\n        is_chain: isChain,\r\n        brand_id: isChain ? brandId : null,\r\n        // Video fields for Ghost template\r\n        banner_media_type: template === 'ghost' ? bannerMediaType : 'image',\r\n        promo_video_url: template === 'ghost' ? (promoVideoUrl || null) : null,\r\n        promo_video_poster: template === 'ghost' ? (promoVideoPoster || null) : null,\r\n        videos: template === 'ghost' ? (videos as any) : [],\r\n      };\r\n\r\n      if (restaurant) {\r\n        const { error } = await supabase\r\n          .from(\"restaurants\")\r\n          .update({ ...restaurantData, updated_by: user.id })\r\n          .eq(\"id\", restaurant.id);\r\n\r\n        if (error) throw error;\r\n\r\n        toast({\r\n          title: t(\"common.success\"),\r\n          description: t(\"admin.restaurantUpdated\"),\r\n        });\r\n      } else {\r\n        const { error } = await supabase\r\n          .from(\"restaurants\")\r\n          .insert([{ ...restaurantData, created_by: user.id }]);\r\n\r\n        if (error) throw error;\r\n\r\n        toast({\r\n          title: t(\"common.success\"),\r\n          description: t(\"admin.restaurantCreated\"),\r\n        });\r\n      }\r\n\r\n      queryClient.invalidateQueries({ queryKey: [\"restaurants\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"admin-restaurants\"] });\r\n      if (restaurant?.id) {\r\n        queryClient.invalidateQueries({ queryKey: [\"restaurant\", restaurant.id] });\r\n      }\r\n      setOpen(false);\r\n    } catch (error: any) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: error.message,\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={setOpen}>\r\n      <DialogTrigger asChild>{trigger}</DialogTrigger>\r\n      <DialogContent className=\"max-w-[95vw] sm:max-w-6xl max-h-[95vh] overflow-hidden flex flex-col p-0\">\r\n        <DialogHeader className=\"px-6 pt-6 pb-4 border-b bg-muted/30\">\r\n          <DialogTitle className=\"text-2xl flex items-center gap-2\">\r\n            <Store className=\"w-6 h-6 text-primary\" />\r\n            {restaurant ? t(\"admin.editRestaurant\") : t(\"admin.addRestaurant\")}\r\n          </DialogTitle>\r\n          <DialogDescription className=\"text-base\">\r\n            {restaurant ? t(\"admin.editRestaurantDetails\") : t(\"admin.createRestaurantWithInfo\")}\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <ScrollArea className=\"px-6 h-[calc(95vh-220px)]\">\r\n          <form onSubmit={handleSubmit(onSubmit, showValidationErrors)} className=\"space-y-6 py-6\">\r\n            {/* Visibility Toggle - At the very top */}\r\n            <Card className=\"border-primary/20 bg-gradient-to-br from-primary/5 to-background\">\r\n              <CardContent className=\"p-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <div className=\"p-2 rounded-lg bg-primary/10\">\r\n                      <Globe className=\"w-5 h-5 text-primary\" />\r\n                    </div>\r\n                    <div>\r\n                      <Label className=\"text-base font-semibold\">{t(\"admin.frontendDisplay\")}</Label>\r\n                      <p className=\"text-xs text-muted-foreground\">{t(\"admin.frontendDisplayDesc\")}</p>\r\n                    </div>\r\n                  </div>\r\n                  <Switch\r\n                    checked={visible}\r\n                    onCheckedChange={(checked) => setValue(\"visible\", checked)}\r\n                  />\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            {/* Template Selection - Only visible to admins */}\r\n            {isAdmin && (\r\n              <Card className=\"border-primary/20 bg-gradient-to-br from-background to-muted/20\">\r\n                <CardContent className=\"p-6\">\r\n                  <Label className=\"text-base font-semibold flex items-center gap-2 mb-4\">\r\n                    <Store className=\"w-5 h-5 text-primary\" />\r\n                    {t(\"admin.restaurantTemplate\")}\r\n                  </Label>\r\n                  <RadioGroup\r\n                    value={template}\r\n                    onValueChange={setTemplate}\r\n                    className=\"grid grid-cols-1 md:grid-cols-2 gap-4\"\r\n                  >\r\n                    <div className=\"flex items-start space-x-3 p-4 rounded-lg border border-border hover:border-primary/50 transition-colors cursor-pointer\" onClick={() => setTemplate('default')}>\r\n                      <RadioGroupItem value=\"default\" id=\"template-default\" className=\"mt-1\" />\r\n                      <div className=\"flex-1\">\r\n                        <Label htmlFor=\"template-default\" className=\"text-sm font-medium cursor-pointer\">\r\n                          {t(\"admin.templateDefault\")}\r\n                        </Label>\r\n                        <p className=\"text-xs text-muted-foreground mt-1\">\r\n                          {t(\"admin.templateDefaultDesc\")}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex items-start space-x-3 p-4 rounded-lg border border-border hover:border-primary/50 transition-colors cursor-pointer\" onClick={() => setTemplate('ghost')}>\r\n                      <RadioGroupItem value=\"ghost\" id=\"template-ghost\" className=\"mt-1\" />\r\n                      <div className=\"flex-1\">\r\n                        <Label htmlFor=\"template-ghost\" className=\"text-sm font-medium cursor-pointer\">\r\n                          {t(\"admin.templateGhost\")}\r\n                        </Label>\r\n                        <p className=\"text-xs text-muted-foreground mt-1\">\r\n                          {t(\"admin.templateGhostDesc\")}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </RadioGroup>\r\n                </CardContent>\r\n              </Card>\r\n            )}\r\n\r\n            {/* Chain Restaurant & Brand Selection */}\r\n            <Card className=\"border-primary/20 bg-gradient-to-br from-background to-muted/20\">\r\n              <CardContent className=\"p-6\">\r\n                <Label className=\"text-base font-semibold flex items-center gap-2 mb-4\">\r\n                  <Building2 className=\"w-5 h-5 text-primary\" />\r\n                  {t(\"admin.restaurant.isChain\")}\r\n                </Label>\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"flex items-center justify-between p-3 border rounded-lg\">\r\n                    <div className=\"space-y-0.5\">\r\n                      <Label className=\"text-sm font-medium\">\r\n                        {t(\"admin.restaurant.isChain\")}\r\n                      </Label>\r\n                      <p className=\"text-xs text-muted-foreground\">\r\n                        {t(\"admin.restaurant.isChainDesc\")}\r\n                      </p>\r\n                    </div>\r\n                    <Switch\r\n                      checked={isChain}\r\n                      onCheckedChange={(checked) => {\r\n                        setIsChain(checked);\r\n                        if (!checked) setBrandId(null);\r\n                      }}\r\n                    />\r\n                  </div>\r\n                  \r\n                  {isChain && (\r\n                    <div className=\"space-y-2\">\r\n                      <Label className=\"text-sm font-medium\">\r\n                        {t(\"admin.restaurant.selectBrand\")}\r\n                      </Label>\r\n                      <Select value={brandId || \"\"} onValueChange={(val) => setBrandId(val || null)}>\r\n                        <SelectTrigger>\r\n                          <SelectValue placeholder={t(\"admin.restaurant.selectBrandPlaceholder\")} />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                          {brands?.map((brand) => (\r\n                            <SelectItem key={brand.id} value={brand.id}>\r\n                              <div className=\"flex items-center gap-2\">\r\n                                {brand.logo_url ? (\r\n                                  <img src={brand.logo_url} alt=\"\" className=\"w-5 h-5 object-contain rounded\" />\r\n                                ) : (\r\n                                  <Building2 className=\"w-4 h-4 text-muted-foreground\" />\r\n                                )}\r\n                                {brand.name}\r\n                              </div>\r\n                            </SelectItem>\r\n                          ))}\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            {/* Image Upload */}\r\n            <Card className=\"border-primary/20 bg-gradient-to-br from-background to-muted/20\">\r\n              <CardContent className=\"p-6\">\r\n                <Label className=\"text-base font-semibold flex items-center gap-2 mb-4\">\r\n                  <Upload className=\"w-5 h-5 text-primary\" />\r\n                  {t(\"admin.restaurantImages\")}\r\n                </Label>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                  {/* Card Image - for restaurant list */}\r\n                  <div className=\"space-y-3\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <span className=\"text-sm font-medium\">{t(\"admin.cardImage\")}</span>\r\n                      <span className=\"text-xs text-muted-foreground\">({t(\"admin.cardImageHint\")})</span>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-4\">\r\n                      {imagePreview && (\r\n                        <div className=\"relative group\">\r\n                          <img\r\n                            src={imagePreview}\r\n                            alt=\"Card Preview\"\r\n                            className=\"w-32 h-32 object-cover rounded-lg shadow-lg ring-2 ring-primary/20 transition-transform duration-200 group-hover:scale-105\"\r\n                          />\r\n                          <Button\r\n                            type=\"button\"\r\n                            variant=\"destructive\"\r\n                            size=\"icon\"\r\n                            className=\"absolute -top-2 -right-2 h-6 w-6 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                            onClick={() => {\r\n                              setImageFile(null);\r\n                              setImagePreview(null);\r\n                            }}\r\n                          >\r\n                            <X className=\"h-3 w-3\" />\r\n                          </Button>\r\n                        </div>\r\n                      )}\r\n                      <Label htmlFor=\"image-upload\" className=\"cursor-pointer\">\r\n                        <div className=\"flex flex-col items-center gap-2 px-6 py-4 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200\">\r\n                          <Upload className=\"h-6 w-6 text-primary\" />\r\n                          <div className=\"text-center\">\r\n                            <p className=\"font-medium text-xs\">{t(\"admin.uploadImage\")}</p>\r\n                          </div>\r\n                        </div>\r\n                        <Input\r\n                          id=\"image-upload\"\r\n                          type=\"file\"\r\n                          accept=\"image/*\"\r\n                          className=\"hidden\"\r\n                          onChange={handleImageChange}\r\n                        />\r\n                      </Label>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Cover Image - for detail page background (only for non-ghost templates) */}\r\n                  {template !== 'ghost' && (\r\n                    <div className=\"space-y-3\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <span className=\"text-sm font-medium\">{t(\"admin.coverImage\")}</span>\r\n                        <span className=\"text-xs text-muted-foreground\">({t(\"admin.coverImageHint\")})</span>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-4\">\r\n                        {coverImagePreview && (\r\n                          <div className=\"relative group\">\r\n                            <img\r\n                              src={coverImagePreview}\r\n                              alt=\"Cover Preview\"\r\n                              className=\"w-32 h-32 object-cover rounded-lg shadow-lg ring-2 ring-accent/20 transition-transform duration-200 group-hover:scale-105\"\r\n                            />\r\n                            <Button\r\n                              type=\"button\"\r\n                              variant=\"destructive\"\r\n                              size=\"icon\"\r\n                              className=\"absolute -top-2 -right-2 h-6 w-6 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                              onClick={() => {\r\n                                setCoverImageFile(null);\r\n                                setCoverImagePreview(null);\r\n                              }}\r\n                            >\r\n                              <X className=\"h-3 w-3\" />\r\n                            </Button>\r\n                          </div>\r\n                        )}\r\n                        <Label htmlFor=\"cover-image-upload\" className=\"cursor-pointer\">\r\n                          <div className=\"flex flex-col items-center gap-2 px-6 py-4 border-2 border-dashed border-accent/30 rounded-lg hover:border-accent hover:bg-accent/5 transition-all duration-200\">\r\n                            <ImageIcon className=\"h-6 w-6 text-accent\" />\r\n                            <div className=\"text-center\">\r\n                              <p className=\"font-medium text-xs\">{t(\"admin.uploadImage\")}</p>\r\n                            </div>\r\n                          </div>\r\n                          <Input\r\n                            id=\"cover-image-upload\"\r\n                            type=\"file\"\r\n                            accept=\"image/*\"\r\n                            className=\"hidden\"\r\n                            onChange={handleCoverImageChange}\r\n                          />\r\n                        </Label>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            {/* Dish Images - Only show when editing existing restaurant */}\r\n            {restaurant?.id && (\r\n              <Card className=\"border-primary/20\">\r\n                <CardContent className=\"p-6\">\r\n                  <div className=\"flex items-center justify-between mb-4\">\r\n                    <Label className=\"text-base font-semibold flex items-center gap-2\">\r\n                      <ImageIcon className=\"w-5 h-5 text-primary\" />\r\n                      {t(\"admin.dishGallery\")}\r\n                    </Label>\r\n                  </div>\r\n                  <DishImageManager restaurantId={restaurant.id} />\r\n                </CardContent>\r\n              </Card>\r\n            )}\r\n\r\n            {/* Multi-language Content with Tabs */}\r\n            <Card className=\"border-primary/20\">\r\n              <CardContent className=\"p-6\">\r\n                <Label className=\"text-base font-semibold flex items-center gap-2 mb-4\">\r\n                  <Globe className=\"w-5 h-5 text-primary\" />\r\n                  {t(\"admin.multilingualContent\")}\r\n                </Label>\r\n                <Tabs defaultValue=\"zh\" className=\"w-full\">\r\n                  <TabsList className=\"grid w-full grid-cols-3 mb-6\">\r\n                    <TabsTrigger value=\"zh\" className=\"gap-2\">\r\n                      üá®üá≥ {t(\"admin.chinese\")}\r\n                    </TabsTrigger>\r\n                    <TabsTrigger value=\"en\" className=\"gap-2\">\r\n                      üá¨üáß {t(\"admin.english\")}\r\n                    </TabsTrigger>\r\n                    <TabsTrigger value=\"pt\" className=\"gap-2\">\r\n                      üáµüáπ {t(\"admin.portuguese\")}\r\n                    </TabsTrigger>\r\n                  </TabsList>\r\n                  \r\n                  <TabsContent value=\"zh\" className=\"space-y-4 mt-0\">\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"name\" className=\"text-sm font-medium\">{t(\"admin.restaurantName\")}</Label>\r\n                      <Input \r\n                        id=\"name\" \r\n                        {...register(\"name\")} \r\n                        placeholder={t(\"admin.enterRestaurantName\")}\r\n                        className=\"text-base\"\r\n                      />\r\n                      {errors.name && (\r\n                        <p className=\"text-sm text-destructive\">{errors.name.message}</p>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"space-y-3\">\r\n                      <div className=\"flex justify-between items-center\">\r\n                        <Label className=\"text-sm font-medium\">{t(\"admin.restaurantType\")}</Label>\r\n                        {types.length < 3 && (\r\n                          <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={addType}>\r\n                            {t(\"admin.addType\")}\r\n                          </Button>\r\n                        )}\r\n                      </div>\r\n                      {types.map((type, index) => (\r\n                        <div key={index} className=\"flex gap-2 items-center\">\r\n                          <TypeCombobox\r\n                            placeholder={t(\"admin.typeExample\")}\r\n                            value={type.zh}\r\n                            onChange={(value) => updateType(index, 'zh', value)}\r\n                            suggestions={existingTypes?.uniqueZh || []}\r\n                          />\r\n                          <Button\r\n                            type=\"button\"\r\n                            variant=\"ghost\"\r\n                            size=\"icon\"\r\n                            onClick={() => removeType(index)}\r\n                            disabled={types.length === 1}\r\n                          >\r\n                            <X className=\"h-4 w-4\" />\r\n                          </Button>\r\n                        </div>\r\n                      ))}\r\n                      {errors.type && (\r\n                        <p className=\"text-sm text-destructive\">{errors.type.message}</p>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"description\" className=\"text-sm font-medium\">{t(\"admin.description\")}</Label>\r\n                      <RichTextEditor\r\n                        value={watch(\"description\") || \"\"}\r\n                        onChange={(value) => setValue(\"description\", value)}\r\n                        placeholder={t(\"admin.enterDescription\")}\r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"announcement_zh\" className=\"text-sm font-medium\">{t(\"admin.announcement\")}</Label>\r\n                      <Textarea \r\n                        id=\"announcement_zh\" \r\n                        {...register(\"announcement_zh\")} \r\n                        rows={2}\r\n                        placeholder={t(\"admin.enterAnnouncement\")}\r\n                      />\r\n                      <p className=\"text-xs text-muted-foreground\">{t(\"admin.announcementHint\")}</p>\r\n                    </div>\r\n                  </TabsContent>\r\n                  \r\n                  <TabsContent value=\"en\" className=\"space-y-4 mt-0\">\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"name_en\" className=\"text-sm font-medium\">Restaurant Name</Label>\r\n                      <Input \r\n                        id=\"name_en\" \r\n                        {...register(\"name_en\")} \r\n                        placeholder=\"Enter restaurant name...\"\r\n                        className=\"text-base\"\r\n                      />\r\n                      {errors.name_en && (\r\n                        <p className=\"text-sm text-destructive\">{errors.name_en.message}</p>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"space-y-3\">\r\n                      <Label className=\"text-sm font-medium\">Restaurant Types (1-3 tags)</Label>\r\n                      {types.map((type, index) => (\r\n                        <div key={index} className=\"flex gap-2 items-center\">\r\n                          <TypeCombobox\r\n                            placeholder=\"e.g. Cantonese\"\r\n                            value={type.en}\r\n                            onChange={(value) => updateType(index, 'en', value)}\r\n                            suggestions={existingTypes?.uniqueEn || []}\r\n                          />\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"description_en\" className=\"text-sm font-medium\">Description</Label>\r\n                      <RichTextEditor\r\n                        value={watch(\"description_en\") || \"\"}\r\n                        onChange={(value) => setValue(\"description_en\", value)}\r\n                        placeholder=\"Enter restaurant description...\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"announcement_en\" className=\"text-sm font-medium\">Announcement</Label>\r\n                      <Textarea \r\n                        id=\"announcement_en\" \r\n                        {...register(\"announcement_en\")} \r\n                        rows={2}\r\n                        placeholder=\"Enter announcement (optional)...\"\r\n                      />\r\n                      <p className=\"text-xs text-muted-foreground\">Display important notices at top of restaurant page</p>\r\n                    </div>\r\n                  </TabsContent>\r\n                  \r\n                  <TabsContent value=\"pt\" className=\"space-y-4 mt-0\">\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"name_pt\" className=\"text-sm font-medium\">Nome do Restaurante</Label>\r\n                      <Input \r\n                        id=\"name_pt\" \r\n                        {...register(\"name_pt\")} \r\n                        placeholder=\"Digite o nome do restaurante...\"\r\n                        className=\"text-base\"\r\n                      />\r\n                      {errors.name_pt && (\r\n                        <p className=\"text-sm text-destructive\">{errors.name_pt.message}</p>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"space-y-3\">\r\n                      <Label className=\"text-sm font-medium\">Tipos de Restaurante (1-3 tags)</Label>\r\n                      {types.map((type, index) => (\r\n                        <div key={index} className=\"flex gap-2 items-center\">\r\n                          <TypeCombobox\r\n                            placeholder=\"ex: Cantonesa\"\r\n                            value={type.pt}\r\n                            onChange={(value) => updateType(index, 'pt', value)}\r\n                            suggestions={existingTypes?.uniquePt || []}\r\n                          />\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"description_pt\" className=\"text-sm font-medium\">Descri√ß√£o</Label>\r\n                      <RichTextEditor\r\n                        value={watch(\"description_pt\") || \"\"}\r\n                        onChange={(value) => setValue(\"description_pt\", value)}\r\n                        placeholder=\"Digite a descri√ß√£o do restaurante...\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"announcement_pt\" className=\"text-sm font-medium\">An√∫ncio</Label>\r\n                      <Textarea \r\n                        id=\"announcement_pt\" \r\n                        {...register(\"announcement_pt\")} \r\n                        rows={2}\r\n                        placeholder=\"Digite o an√∫ncio (opcional)...\"\r\n                      />\r\n                      <p className=\"text-xs text-muted-foreground\">Exibir avisos importantes no topo da p√°gina do restaurante</p>\r\n                    </div>\r\n                  </TabsContent>\r\n                </Tabs>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            {/* Location and Contact */}\r\n            <Card className=\"border-primary/20\">\r\n              <CardContent className=\"p-6 space-y-4\">\r\n                <Label className=\"text-base font-semibold flex items-center gap-2\">\r\n                  <MapPin className=\"w-5 h-5 text-primary\" />\r\n                  {t(\"admin.locationAndContact\")}\r\n                </Label>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"address\" className=\"text-sm font-medium flex items-center gap-2\">\r\n                      <MapPin className=\"w-4 h-4\" />\r\n                      {t(\"admin.address\")}\r\n                    </Label>\r\n                    <Input id=\"address\" {...register(\"address\")} placeholder={t(\"admin.enterAddress\")} />\r\n                    {errors.address && (\r\n                      <p className=\"text-sm text-destructive\">{errors.address.message}</p>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"phone\" className=\"text-sm font-medium flex items-center gap-2\">\r\n                      <Phone className=\"w-4 h-4\" />\r\n                      {t(\"admin.phone\")}\r\n                    </Label>\r\n                    <Input id=\"phone\" {...register(\"phone\")} placeholder=\"+351...\" />\r\n                  </div>\r\n                </div>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"website_url\" className=\"text-sm font-medium flex items-center gap-2\">\r\n                      <WebIcon className=\"w-4 h-4\" />\r\n                      {t(\"admin.websiteBaseUrl\")}\r\n                    </Label>\r\n                    <Input \r\n                      id=\"website_url\" \r\n                      {...register(\"website_url\")} \r\n                      placeholder=\"https://sushi.xiaoxiong.pt:6000\" \r\n                      readOnly={!isAdmin}\r\n                      disabled={!isAdmin}\r\n                      className={!isAdmin ? \"bg-muted cursor-not-allowed\" : \"\"}\r\n                    />\r\n                    {!isAdmin && (\r\n                      <p className=\"text-xs text-muted-foreground\">{t(\"admin.websiteReadOnly\")}</p>\r\n                    )}\r\n                  </div>\r\n                  {isAdmin && (\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"key_id\" className=\"text-sm font-medium flex items-center gap-2\">\r\n                        <Key className=\"w-4 h-4\" />\r\n                        Key ID (API)\r\n                      </Label>\r\n                      <Input \r\n                        id=\"key_id\" \r\n                        {...register(\"key_id\")} \r\n                        placeholder=\"‰æãÂ¶Ç: saldanha01\" \r\n                      />\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                {/* Button visibility toggles */}\r\n                <div className=\"space-y-3 pt-2\">\r\n                  <Label className=\"text-sm font-medium text-muted-foreground\">\r\n                    {t(\"admin.displaySettings\")}\r\n                  </Label>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n                    <div className=\"flex items-center space-x-2 p-3 rounded-lg border bg-muted/30\">\r\n                      <Checkbox\r\n                        id=\"show_takeaway_button\"\r\n                        checked={showTakeawayButton}\r\n                        onCheckedChange={(checked) => setValue(\"show_takeaway_button\", checked as boolean)}\r\n                      />\r\n                      <Label htmlFor=\"show_takeaway_button\" className=\"cursor-pointer text-sm flex items-center gap-2\">\r\n                        <ShoppingBag className=\"w-4 h-4\" />\r\n                        {t(\"admin.showTakeawayButton\")}\r\n                      </Label>\r\n                    </div>\r\n                    {/* Only show booking button toggle for non-ghost templates */}\r\n                    {template !== 'ghost' && (\r\n                      <div className=\"flex items-center space-x-2 p-3 rounded-lg border bg-muted/30\">\r\n                        <Checkbox\r\n                          id=\"show_booking_button\"\r\n                          checked={showBookingButton}\r\n                          onCheckedChange={(checked) => setValue(\"show_booking_button\", checked as boolean)}\r\n                        />\r\n                        <Label htmlFor=\"show_booking_button\" className=\"cursor-pointer text-sm flex items-center gap-2\">\r\n                          <UtensilsCrossed className=\"w-4 h-4\" />\r\n                          {t(\"admin.showBookingButton\")}\r\n                        </Label>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            {/* Ghost Template: Visual Assets Section */}\r\n            {template === 'ghost' && (\r\n              <Card className=\"border-primary/20 bg-gradient-to-br from-background to-muted/20\">\r\n                <CardContent className=\"p-6\">\r\n                  <Label className=\"text-base font-semibold flex items-center gap-2 mb-4\">\r\n                    <ImageIcon className=\"w-5 h-5 text-primary\" />\r\n                    {t(\"admin.visualAssets\", \"ËßÜËßâÁ¥†Êùê\")}\r\n                  </Label>\r\n                  \r\n                  {/* Banner Media Type & Video Management */}\r\n                  <div className=\"mb-6\">\r\n                    <RestaurantVideoManager\r\n                      bannerMediaType={bannerMediaType}\r\n                      onBannerMediaTypeChange={setBannerMediaType}\r\n                      promoVideoUrl={promoVideoUrl}\r\n                      onPromoVideoUrlChange={setPromoVideoUrl}\r\n                      promoVideoPoster={promoVideoPoster}\r\n                      onPromoVideoPosterChange={setPromoVideoPoster}\r\n                      videos={videos}\r\n                      onVideosChange={setVideos}\r\n                    />\r\n                  </div>\r\n                  \r\n                  {/* Background Banner Upload - shown only when banner type is image */}\r\n                  {bannerMediaType === 'image' && (\r\n                    <div className=\"space-y-4 mb-6 p-4 border rounded-lg bg-muted/20\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <ImageIcon className=\"w-4 h-4 text-primary\" />\r\n                        <span className=\"text-sm font-medium\">{t(\"admin.backgroundImage\", \"ËÉåÊôØÂõæ\")}</span>\r\n                      </div>\r\n                      <p className=\"text-xs text-muted-foreground\">{t(\"admin.backgroundImageDesc\", \"Ê≠§ÂõæÁâáÂ∞ÜÊòæÁ§∫Âú®ËØ¶ÊÉÖÈ°µÈ°∂ÈÉ®‰Ωú‰∏∫ËÉåÊôØÊ®™ÂπÖ\")}</p>\r\n                      <div className=\"flex items-start gap-4\">\r\n                        {bannerPreview && (\r\n                          <div className=\"relative group\">\r\n                            <img\r\n                              src={bannerPreview}\r\n                              alt=\"Background Banner Preview\"\r\n                              className=\"w-40 h-20 object-cover rounded-lg shadow-lg ring-2 ring-primary/20 transition-transform duration-200 group-hover:scale-105\"\r\n                            />\r\n                            <Button\r\n                              type=\"button\"\r\n                              variant=\"destructive\"\r\n                              size=\"icon\"\r\n                              className=\"absolute -top-2 -right-2 h-6 w-6 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity rounded-full\"\r\n                              onClick={() => {\r\n                                setBannerFile(null);\r\n                                setBannerPreview(null);\r\n                              }}\r\n                            >\r\n                              <X className=\"h-3 w-3\" />\r\n                            </Button>\r\n                          </div>\r\n                        )}\r\n                        <Label htmlFor=\"ghost-banner-upload\" className=\"cursor-pointer\">\r\n                          <div className=\"flex flex-col items-center gap-2 px-6 py-4 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200\">\r\n                            <ImageIcon className=\"h-6 w-6 text-primary\" />\r\n                            <div className=\"text-center\">\r\n                              <p className=\"font-medium text-xs\">{t(\"admin.uploadImage\")}</p>\r\n                              <p className=\"text-xs text-muted-foreground\">16:9 {t(\"admin.recommended\", \"Êé®Ëçê\")}</p>\r\n                            </div>\r\n                          </div>\r\n                          <Input\r\n                            id=\"ghost-banner-upload\"\r\n                            type=\"file\"\r\n                            accept=\"image/*\"\r\n                            className=\"hidden\"\r\n                            onChange={handleBannerChange}\r\n                          />\r\n                        </Label>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {/* Signature Dish Image Upload */}\r\n                  <div className=\"space-y-4 p-4 border rounded-lg bg-muted/20\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <UtensilsCrossed className=\"w-4 h-4 text-primary\" />\r\n                      <span className=\"text-sm font-medium\">{t(\"admin.signatureDish\", \"ÊãõÁâåÁæéÈ£ü\")}</span>\r\n                    </div>\r\n                    <p className=\"text-xs text-muted-foreground\">{t(\"admin.signatureDishDesc\", \"Ê≠§ÂõæÁâáÂ∞ÜÊòæÁ§∫Âú®ËØ¶ÊÉÖÈ°µÁæéÈ£üÂ±ïÁ§∫Âå∫\")}</p>\r\n                    <div className=\"flex items-start gap-4\">\r\n                      {coverImagePreview && (\r\n                        <div className=\"relative group\">\r\n                          <img\r\n                            src={coverImagePreview}\r\n                            alt=\"Food Image Preview\"\r\n                            className=\"w-32 h-32 object-cover rounded-lg shadow-lg ring-2 ring-primary/20 transition-transform duration-200 group-hover:scale-105\"\r\n                          />\r\n                          <Button\r\n                            type=\"button\"\r\n                            variant=\"destructive\"\r\n                            size=\"icon\"\r\n                            className=\"absolute -top-2 -right-2 h-6 w-6 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity rounded-full\"\r\n                            onClick={() => {\r\n                              setCoverImageFile(null);\r\n                              setCoverImagePreview(null);\r\n                            }}\r\n                          >\r\n                            <X className=\"h-3 w-3\" />\r\n                          </Button>\r\n                        </div>\r\n                      )}\r\n                      <Label htmlFor=\"ghost-cover-image-upload\" className=\"cursor-pointer\">\r\n                        <div className=\"flex flex-col items-center gap-2 px-6 py-4 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200\">\r\n                          <UtensilsCrossed className=\"h-6 w-6 text-primary\" />\r\n                          <div className=\"text-center\">\r\n                            <p className=\"font-medium text-xs\">{t(\"admin.uploadImage\")}</p>\r\n                            <p className=\"text-xs text-muted-foreground\">1:1 {t(\"admin.recommended\", \"Êé®Ëçê\")}</p>\r\n                          </div>\r\n                        </div>\r\n                        <Input\r\n                          id=\"ghost-cover-image-upload\"\r\n                          type=\"file\"\r\n                          accept=\"image/*\"\r\n                          className=\"hidden\"\r\n                          onChange={handleCoverImageChange}\r\n                        />\r\n                      </Label>\r\n                    </div>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            )}\r\n\r\n            {/* Ghost Template: Chef Profile Section */}\r\n            {template === 'ghost' && (\r\n              <Card className=\"border-primary/20 bg-gradient-to-br from-background to-muted/20\">\r\n                <CardContent className=\"p-6\">\r\n                  <Label className=\"text-base font-semibold flex items-center gap-2 mb-4\">\r\n                    <User className=\"w-5 h-5 text-primary\" />\r\n                    {t(\"admin.chefProfile\", \"Â§ßÂé®Ê°£Ê°à\")}\r\n                  </Label>\r\n                  \r\n                  {/* Owner Name - Multi-language */}\r\n                  <div className=\"space-y-3 mb-6\">\r\n                    <Label className=\"text-sm font-medium\">{t(\"admin.chefName\", \"Â§ßÂé®ÂêçÁß∞\")}</Label>\r\n                    <div className=\"grid grid-cols-3 gap-3\">\r\n                      <div>\r\n                        <Label className=\"text-xs text-muted-foreground mb-1 block\">üá®üá≥ {t(\"admin.chinese\")}</Label>\r\n                        <Input\r\n                          value={ownerName}\r\n                          onChange={(e) => setOwnerName(e.target.value)}\r\n                          placeholder={t(\"admin.chefNamePlaceholder\", \"ËæìÂÖ•Â§ßÂé®ÂêçÁß∞\")}\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <Label className=\"text-xs text-muted-foreground mb-1 block\">üá¨üáß {t(\"admin.english\")}</Label>\r\n                        <Input\r\n                          value={ownerNameEn}\r\n                          onChange={(e) => setOwnerNameEn(e.target.value)}\r\n                          placeholder=\"Chef name\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <Label className=\"text-xs text-muted-foreground mb-1 block\">üáµüáπ {t(\"admin.portuguese\")}</Label>\r\n                        <Input\r\n                          value={ownerNamePt}\r\n                          onChange={(e) => setOwnerNamePt(e.target.value)}\r\n                          placeholder=\"Nome do chef\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Owner Avatar Upload */}\r\n                  <div className=\"space-y-4 mb-6\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <span className=\"text-sm font-medium\">{t(\"admin.ownerAvatar\")}</span>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-4\">\r\n                      {ownerAvatarPreview && (\r\n                        <div className=\"relative group\">\r\n                          <img\r\n                            src={ownerAvatarPreview}\r\n                            alt=\"Owner Avatar Preview\"\r\n                            className=\"w-20 h-20 object-cover rounded-full shadow-lg ring-2 ring-primary/20 transition-transform duration-200 group-hover:scale-105\"\r\n                          />\r\n                          <Button\r\n                            type=\"button\"\r\n                            variant=\"destructive\"\r\n                            size=\"icon\"\r\n                            className=\"absolute -top-2 -right-2 h-6 w-6 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity rounded-full\"\r\n                            onClick={() => {\r\n                              setOwnerAvatarFile(null);\r\n                              setOwnerAvatarPreview(null);\r\n                            }}\r\n                          >\r\n                            <X className=\"h-3 w-3\" />\r\n                          </Button>\r\n                        </div>\r\n                      )}\r\n                      <Label htmlFor=\"owner-avatar-upload\" className=\"cursor-pointer\">\r\n                        <div className=\"flex flex-col items-center gap-2 px-6 py-4 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200\">\r\n                          <User className=\"h-6 w-6 text-primary\" />\r\n                          <div className=\"text-center\">\r\n                            <p className=\"font-medium text-xs\">{t(\"admin.uploadImage\")}</p>\r\n                          </div>\r\n                        </div>\r\n                        <Input\r\n                          id=\"owner-avatar-upload\"\r\n                          type=\"file\"\r\n                          accept=\"image/*\"\r\n                          className=\"hidden\"\r\n                          onChange={handleOwnerAvatarChange}\r\n                        />\r\n                      </Label>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  {/* Owner Bio - Multi-language */}\r\n                  <div className=\"space-y-4\">\r\n                    <Label className=\"text-sm font-medium\">{t(\"admin.ownerBio\")}</Label>\r\n                    <Tabs defaultValue=\"zh\" className=\"w-full\">\r\n                      <TabsList className=\"grid w-full grid-cols-3 mb-4\">\r\n                        <TabsTrigger value=\"zh\" className=\"gap-2 text-xs\">\r\n                          üá®üá≥ {t(\"admin.chinese\")}\r\n                        </TabsTrigger>\r\n                        <TabsTrigger value=\"en\" className=\"gap-2 text-xs\">\r\n                          üá¨üáß {t(\"admin.english\")}\r\n                        </TabsTrigger>\r\n                        <TabsTrigger value=\"pt\" className=\"gap-2 text-xs\">\r\n                          üáµüáπ {t(\"admin.portuguese\")}\r\n                        </TabsTrigger>\r\n                      </TabsList>\r\n                      \r\n                      <TabsContent value=\"zh\">\r\n                        <Textarea \r\n                          value={ownerBio}\r\n                          onChange={(e) => setOwnerBio(e.target.value)}\r\n                          rows={4}\r\n                          placeholder={t(\"admin.ownerBioPlaceholder\")}\r\n                        />\r\n                      </TabsContent>\r\n                      \r\n                      <TabsContent value=\"en\">\r\n                        <Textarea \r\n                          value={ownerBioEn}\r\n                          onChange={(e) => setOwnerBioEn(e.target.value)}\r\n                          rows={4}\r\n                          placeholder=\"Share your story, philosophy and culinary passion...\"\r\n                        />\r\n                      </TabsContent>\r\n                      \r\n                      <TabsContent value=\"pt\">\r\n                        <Textarea \r\n                          value={ownerBioPt}\r\n                          onChange={(e) => setOwnerBioPt(e.target.value)}\r\n                          rows={4}\r\n                          placeholder=\"Compartilhe sua hist√≥ria, filosofia e paix√£o culin√°ria...\"\r\n                        />\r\n                      </TabsContent>\r\n                    </Tabs>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            )}\r\n            <Card className=\"border-primary/20\">\r\n              <CardContent className=\"p-6 space-y-4\">\r\n                <Label className=\"text-base font-semibold flex items-center gap-2\">\r\n                  <MapPin className=\"w-5 h-5 text-primary\" />\r\n                  {t(\"admin.location\")}\r\n                </Label>\r\n                <div className=\"grid grid-cols-2 gap-4 mb-2\">\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"lat\" className=\"text-sm font-medium\">{t(\"admin.latitude\")}</Label>\r\n                    <Input\r\n                      id=\"lat\"\r\n                      type=\"number\"\r\n                      step=\"any\"\r\n                      {...register(\"lat\", { valueAsNumber: true })}\r\n                    />\r\n                  </div>\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"lng\" className=\"text-sm font-medium\">{t(\"admin.longitude\")}</Label>\r\n                    <Input\r\n                      id=\"lng\"\r\n                      type=\"number\"\r\n                      step=\"any\"\r\n                      {...register(\"lng\", { valueAsNumber: true })}\r\n                    />\r\n                  </div>\r\n                </div>\r\n                {template !== 'ghost' && (\r\n                  <>\r\n                    <div ref={mapContainer} className=\"h-96 w-full rounded-lg border-2 border-primary/20 shadow-sm\" style={{ minHeight: '384px' }} />\r\n                    <p className=\"text-sm text-muted-foreground flex items-center gap-2\">\r\n                      <MapPin className=\"w-4 h-4\" />\r\n                      {t(\"admin.clickOrDragToSetLocation\")}\r\n                    </p>\r\n                  </>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n\r\n            {/* Opening Hours - Only for non-ghost templates */}\r\n            {template !== 'ghost' && (\r\n              <Card className=\"border-primary/20 overflow-hidden\">\r\n                <CardContent className=\"p-3 md:p-6 space-y-4\">\r\n                  <Label className=\"text-base font-semibold flex items-center gap-2\">\r\n                    <Clock className=\"w-5 h-5 text-primary\" />\r\n                    {t(\"admin.openingHours\")}\r\n                  </Label>\r\n                  <div className=\"space-y-2\">\r\n                    {DAYS.map((day) => (\r\n                      <div key={day} className=\"space-y-2 p-2 md:p-3 rounded-lg hover:bg-muted/50 transition-colors\">\r\n                        {/* Mobile Layout */}\r\n                        <div className=\"md:hidden space-y-2\">\r\n                          <div className=\"flex items-center justify-between\">\r\n                            <Label className=\"capitalize font-semibold text-sm\">{t(`admin.day.${day}`)}</Label>\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <div className=\"flex items-center gap-1\">\r\n                                <Checkbox\r\n                                  id={`split-mobile-${day}`}\r\n                                  checked={openingHours[day].splitShift}\r\n                                  onCheckedChange={(checked) =>\r\n                                    setOpeningHours({\r\n                                      ...openingHours,\r\n                                      [day]: { ...openingHours[day], splitShift: checked as boolean },\r\n                                    })\r\n                                  }\r\n                                  disabled={openingHours[day].closed}\r\n                                  className=\"h-4 w-4\"\r\n                                />\r\n                                <Label htmlFor={`split-mobile-${day}`} className=\"cursor-pointer text-xs\">\r\n                                  ÂàÜÊÆµ\r\n                                </Label>\r\n                              </div>\r\n                              <div className=\"flex items-center gap-1\">\r\n                                <Checkbox\r\n                                  id={`closed-mobile-${day}`}\r\n                                  checked={openingHours[day].closed}\r\n                                  onCheckedChange={(checked) =>\r\n                                    setOpeningHours({\r\n                                      ...openingHours,\r\n                                      [day]: { ...openingHours[day], closed: checked as boolean },\r\n                                    })\r\n                                  }\r\n                                  className=\"h-4 w-4\"\r\n                                />\r\n                                <Label htmlFor={`closed-mobile-${day}`} className=\"cursor-pointer text-xs\">\r\n                                  {t(\"admin.closed\")}\r\n                                </Label>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                          \r\n                          {!openingHours[day].closed && (\r\n                            <div className=\"space-y-1.5\">\r\n                              {openingHours[day].splitShift ? (\r\n                                <div className=\"space-y-1.5\">\r\n                                  <div className=\"grid grid-cols-[32px_1fr_12px_1fr] gap-1 items-center\">\r\n                                    <span className=\"text-xs text-muted-foreground\">ÂçàÈ§ê</span>\r\n                                    <Input\r\n                                      type=\"time\"\r\n                                      value={openingHours[day].open}\r\n                                      onChange={(e) =>\r\n                                        setOpeningHours({\r\n                                          ...openingHours,\r\n                                          [day]: { ...openingHours[day], open: e.target.value },\r\n                                        })\r\n                                      }\r\n                                      className=\"h-8 text-xs px-2 min-w-0\"\r\n                                    />\r\n                                    <span className=\"text-muted-foreground text-xs text-center\">-</span>\r\n                                    <Input\r\n                                      type=\"time\"\r\n                                      value={openingHours[day].close}\r\n                                      onChange={(e) =>\r\n                                        setOpeningHours({\r\n                                          ...openingHours,\r\n                                          [day]: { ...openingHours[day], close: e.target.value },\r\n                                        })\r\n                                      }\r\n                                      className=\"h-8 text-xs px-2 min-w-0\"\r\n                                    />\r\n                                  </div>\r\n                                  <div className=\"grid grid-cols-[32px_1fr_12px_1fr] gap-1 items-center\">\r\n                                    <span className=\"text-xs text-muted-foreground\">ÊôöÈ§ê</span>\r\n                                    <Input\r\n                                      type=\"time\"\r\n                                      value={openingHours[day].open2 || \"19:00\"}\r\n                                      onChange={(e) =>\r\n                                        setOpeningHours({\r\n                                          ...openingHours,\r\n                                          [day]: { ...openingHours[day], open2: e.target.value },\r\n                                        })\r\n                                      }\r\n                                      className=\"h-8 text-xs px-2 min-w-0\"\r\n                                    />\r\n                                    <span className=\"text-muted-foreground text-xs text-center\">-</span>\r\n                                    <Input\r\n                                      type=\"time\"\r\n                                      value={openingHours[day].close2 || \"23:00\"}\r\n                                      onChange={(e) =>\r\n                                        setOpeningHours({\r\n                                          ...openingHours,\r\n                                          [day]: { ...openingHours[day], close2: e.target.value },\r\n                                        })\r\n                                      }\r\n                                      className=\"h-8 text-xs px-2 min-w-0\"\r\n                                    />\r\n                                  </div>\r\n                                </div>\r\n                              ) : (\r\n                                <div className=\"grid grid-cols-[1fr_12px_1fr] gap-1 items-center\">\r\n                                  <Input\r\n                                    type=\"time\"\r\n                                    value={openingHours[day].open}\r\n                                    onChange={(e) =>\r\n                                      setOpeningHours({\r\n                                        ...openingHours,\r\n                                        [day]: { ...openingHours[day], open: e.target.value },\r\n                                      })\r\n                                    }\r\n                                    className=\"h-8 text-xs px-2 min-w-0\"\r\n                                  />\r\n                                  <span className=\"text-muted-foreground text-xs text-center\">-</span>\r\n                                  <Input\r\n                                    type=\"time\"\r\n                                    value={openingHours[day].close}\r\n                                    onChange={(e) =>\r\n                                      setOpeningHours({\r\n                                        ...openingHours,\r\n                                        [day]: { ...openingHours[day], close: e.target.value },\r\n                                      })\r\n                                    }\r\n                                    className=\"h-8 text-xs px-2 min-w-0\"\r\n                                  />\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n\r\n                        {/* Desktop Layout */}\r\n                        <div className=\"hidden md:block\">\r\n                          <div className=\"grid grid-cols-[120px_1fr_auto] gap-4 items-center\">\r\n                            <Label className=\"capitalize font-semibold\">{t(`admin.day.${day}`)}</Label>\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <Checkbox\r\n                                id={`split-${day}`}\r\n                                checked={openingHours[day].splitShift}\r\n                                onCheckedChange={(checked) =>\r\n                                  setOpeningHours({\r\n                                    ...openingHours,\r\n                                    [day]: { ...openingHours[day], splitShift: checked as boolean },\r\n                                  })\r\n                                }\r\n                                disabled={openingHours[day].closed}\r\n                              />\r\n                              <Label htmlFor={`split-${day}`} className=\"cursor-pointer text-sm\">\r\n                                ÂàÜÊÆµËê•‰∏ö\r\n                              </Label>\r\n                            </div>\r\n                            <div className=\"flex items-center space-x-2\">\r\n                              <Checkbox\r\n                                id={`closed-${day}`}\r\n                                checked={openingHours[day].closed}\r\n                                onCheckedChange={(checked) =>\r\n                                  setOpeningHours({\r\n                                    ...openingHours,\r\n                                    [day]: { ...openingHours[day], closed: checked as boolean },\r\n                                  })\r\n                                }\r\n                              />\r\n                              <Label htmlFor={`closed-${day}`} className=\"cursor-pointer\">\r\n                                {t(\"admin.closed\")}\r\n                              </Label>\r\n                            </div>\r\n                          </div>\r\n                          \r\n                          {!openingHours[day].closed && (\r\n                            <div className=\"ml-[120px] space-y-2 mt-2\">\r\n                              {openingHours[day].splitShift ? (\r\n                                <div className=\"space-y-2\">\r\n                                  <div className=\"flex items-center gap-2\">\r\n                                    <span className=\"text-sm text-muted-foreground w-12\">ÂçàÈ§ê</span>\r\n                                    <Input\r\n                                      type=\"time\"\r\n                                      value={openingHours[day].open}\r\n                                      onChange={(e) =>\r\n                                        setOpeningHours({\r\n                                          ...openingHours,\r\n                                          [day]: { ...openingHours[day], open: e.target.value },\r\n                                        })\r\n                                      }\r\n                                      className=\"w-32\"\r\n                                    />\r\n                                    <span className=\"text-muted-foreground\">-</span>\r\n                                    <Input\r\n                                      type=\"time\"\r\n                                      value={openingHours[day].close}\r\n                                      onChange={(e) =>\r\n                                        setOpeningHours({\r\n                                          ...openingHours,\r\n                                          [day]: { ...openingHours[day], close: e.target.value },\r\n                                        })\r\n                                      }\r\n                                      className=\"w-32\"\r\n                                    />\r\n                                  </div>\r\n                                  <div className=\"flex items-center gap-2\">\r\n                                    <span className=\"text-sm text-muted-foreground w-12\">ÊôöÈ§ê</span>\r\n                                    <Input\r\n                                      type=\"time\"\r\n                                      value={openingHours[day].open2 || \"19:00\"}\r\n                                      onChange={(e) =>\r\n                                        setOpeningHours({\r\n                                          ...openingHours,\r\n                                          [day]: { ...openingHours[day], open2: e.target.value },\r\n                                        })\r\n                                      }\r\n                                      className=\"w-32\"\r\n                                    />\r\n                                    <span className=\"text-muted-foreground\">-</span>\r\n                                    <Input\r\n                                      type=\"time\"\r\n                                      value={openingHours[day].close2 || \"23:00\"}\r\n                                      onChange={(e) =>\r\n                                        setOpeningHours({\r\n                                          ...openingHours,\r\n                                          [day]: { ...openingHours[day], close2: e.target.value },\r\n                                        })\r\n                                      }\r\n                                      className=\"w-32\"\r\n                                    />\r\n                                  </div>\r\n                                </div>\r\n                              ) : (\r\n                                <div className=\"flex items-center gap-2\">\r\n                                  <Input\r\n                                    type=\"time\"\r\n                                    value={openingHours[day].open}\r\n                                    onChange={(e) =>\r\n                                      setOpeningHours({\r\n                                        ...openingHours,\r\n                                        [day]: { ...openingHours[day], open: e.target.value },\r\n                                      })\r\n                                    }\r\n                                    className=\"w-32\"\r\n                                  />\r\n                                  <span className=\"text-muted-foreground\">-</span>\r\n                                  <Input\r\n                                    type=\"time\"\r\n                                    value={openingHours[day].close}\r\n                                    onChange={(e) =>\r\n                                      setOpeningHours({\r\n                                        ...openingHours,\r\n                                        [day]: { ...openingHours[day], close: e.target.value },\r\n                                      })\r\n                                    }\r\n                                    className=\"w-32\"\r\n                                  />\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            )}\r\n          </form>\r\n        </ScrollArea>\r\n\r\n        <div className=\"flex justify-end gap-2 px-6 py-4 border-t bg-muted/30\">\r\n          <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)}>\r\n            {t(\"common.cancel\")}\r\n          </Button>\r\n          <Button type=\"submit\" disabled={isSubmitting} onClick={handleSubmit(onSubmit)} className=\"gap-2\">\r\n            <Store className=\"w-4 h-4\" />\r\n            {isSubmitting ? t(\"common.saving\") : t(\"common.save\")}\r\n          </Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n"],"names":["useDishImages","restaurantId","useQuery","data","error","supabase","useAddDishImage","user","useAuth","queryClient","useQueryClient","useMutation","file","existingImages","countError","fileExt","fileName","uploadError","publicUrl","nextSortOrder","insertError","_","variables","toast","i18n","useDeleteDishImage","imageId","imageUrl","urlParts","useReorderDishImages","images","updates","img","SortableImage","image","index","onDelete","attributes","listeners","setNodeRef","transform","transition","isDragging","useSortable","style","CSS","jsxs","jsx","GripVertical","Button","e","X","DishImageManager","t","useTranslation","fileInputRef","useRef","isLoading","addImage","deleteImage","reorderImages","deleteConfirm","setDeleteConfirm","useState","localImages","setLocalImages","isDeleting","setIsDeleting","displayImages","sensors","useSensors","useSensor","PointerSensor","KeyboardSensor","sortableKeyboardCoordinates","handleDragEnd","event","active","over","oldIndex","newIndex","newOrder","arrayMove","idx","handleFileSelect","handleDeleteConfirm","id","url","handleDialogClose","open","canAddMore","Card","CardHeader","CardTitle","ImageIcon","CardDescription","CardContent","Loader2","DndContext","closestCenter","SortableContext","rectSortingStrategy","Upload","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","TypeCombobox","value","onChange","suggestions","placeholder","className","setOpen","inputValue","setInputValue","inputRef","dropdownRef","filteredSuggestions","s","useEffect","handleClickOutside","handleInputChange","newValue","handleSelect","selectedValue","Input","suggestion","cn","Check","useAllRestaurantTypes","typeMap","r","types","typesEn","typesPt","maxLen","i","zh","en","pt","key","uniqueZh","uniqueEn","uniquePt","MAX_VIDEOS","RestaurantVideoManager","bannerMediaType","onBannerMediaTypeChange","promoVideoUrl","onPromoVideoUrlChange","promoVideoPoster","onPromoVideoPosterChange","videos","onVideosChange","useToast","isUploading","setIsUploading","uploadFile","prefix","isVideo","bucket","handlePromoVideoUpload","handlePromoPosterUpload","addVideo","removeVideo","updateVideo","field","newVideos","handleVideoUpload","handleVideoPosterUpload","Label","Film","RadioGroup","RadioGroupItem","Play","video","Trash2","Tabs","TabsList","TabsTrigger","TabsContent","Plus","restaurantSchema","z.object","z.string","z.array","z.number","z.boolean","DAYS","RestaurantFormDialog","restaurant","trigger","isAdmin","useUserRole","existingTypes","brands","useBrands","isChain","setIsChain","brandId","setBrandId","imageFile","setImageFile","imagePreview","setImagePreview","coverImageFile","setCoverImageFile","coverImagePreview","setCoverImagePreview","ownerAvatarFile","setOwnerAvatarFile","ownerAvatarPreview","setOwnerAvatarPreview","bannerFile","setBannerFile","bannerPreview","setBannerPreview","ownerBio","setOwnerBio","ownerBioEn","setOwnerBioEn","ownerBioPt","setOwnerBioPt","ownerName","setOwnerName","ownerNameEn","setOwnerNameEn","ownerNamePt","setOwnerNamePt","isSubmitting","setIsSubmitting","setBannerMediaType","setPromoVideoUrl","setPromoVideoPoster","setVideos","mapContainer","map","marker","openingHours","setOpeningHours","defaultHours","day","template","setTemplate","setTypes","setValue","register","handleSubmit","errors","watch","triggerValidation","useForm","zodResolver","showValidationErrors","errorMessages","addType","removeType","updateType","newTypes","lat","lng","visible","showTakeawayButton","showBookingButton","isValidCoordinate","mapboxToken","timer","mapboxgl","centerLng","centerLat","lngLat","handleWheel","handleImageChange","reader","handleCoverImageChange","handleOwnerAvatarChange","handleBannerChange","uploadImage","filePath","uploadCoverImage","uploadOwnerAvatar","uploadBanner","onSubmit","coverImageUrl","ownerAvatarUrl","bannerUrl","restaurantData","Dialog","DialogTrigger","DialogContent","DialogHeader","DialogTitle","Store","DialogDescription","ScrollArea","Globe","Switch","checked","Building2","Select","val","SelectTrigger","SelectValue","SelectContent","brand","SelectItem","type","RichTextEditor","Textarea","MapPin","Phone","WebIcon","Key","Checkbox","ShoppingBag","UtensilsCrossed","User","Fragment","Clock"],"mappings":"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"}