import{p as G,u as ge,r as o,j as e,aW as le,aX as We,aY as Xe,aZ as Qe,aw as ye,ay as ve,a_ as ce,a$ as je,b0 as Ke,L as Se,al as Ue,b1 as me,b2 as Le,b3 as Ae,b4 as Te,b5 as Ge,b6 as we,b7 as Ze,q as Ye,b8 as Je,b9 as et,ba as tt}from"./vendor-react-DwI6ZJq7.js";import{a as Me,b as be,D as st,c as at,d as rt,e as ot,f as nt,I as it,B as $,g as L,C as ue,S as lt,s as ct,h as dt,o as mt,i as I,j as he,k as ut,l as xt,H as ht,m as pt,n as ft}from"./index-C7QjDrm6.js";import{c as gt,g as bt,m as Re}from"./geolocation-DRm3QMsJ.js";import{a as yt,g as vt}from"./app-store-badge-CyCtXXOt.js";import{u as De}from"./useHomepageTemplates-DBTqWwtj.js";import{u as jt}from"./usePageView-Dh7mkpnz.js";import{u as wt,X as Nt}from"./XiaoxiongChatContent-Cy60Qg7A.js";import{P as kt}from"./PullToRefresh-BdSsR2rm.js";import{f as Ne}from"./textFormatting-Cvg0DSWq.js";import{P as _t,a as Ct,b as St}from"./popover-4Bdikmag.js";import{u as Lt,a as At}from"./useRestaurants-DnfmWCbl.js";import{u as Tt,R as Mt,l as Rt}from"./xiaoxiong-logo-clean-DbkYn5Vc.js";import{u as ze}from"./useLocalizedContent-MCfjRTM4.js";import{u as Ee}from"./useActivities-Dq8fuV2w.js";import{L as Dt}from"./LocationPermissionDialog-BiPXzRgE.js";import{E as zt}from"./ExternalLinkConfirmDialog-DhcjhnPd.js";import{a as ke,f as pe,K as Et,L as _e,M as $t,i as It}from"./vendor-utils-vwQGbBim.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-BlA2nlsP.js";import"./vendor-map-CvE3ASYw.js";const Ft=({open:s,onOpenChange:a})=>{const{i18n:n}=G(),m=ge(),r=Me(),{settings:h}=be(),l=h?.logo_url,d=h?.ai_provider||"xiaoxiong-community",{input:i,setInput:c,messages:f,isLoading:u,showLocationDialog:g,setShowLocationDialog:y,pendingMessage:j,setPendingMessage:b,handleSubmit:R,handleKeyDown:C,handleLocationConfirm:B,processMessage:T,abortRequest:V,requestLocation:A}=wt(d);o.useEffect(()=>{s&&r&&(a(!1),m("/ask-xiaoxiong"))},[s,r,m,a]),o.useEffect(()=>{s&&!r&&A()},[s,r,A]);const O=()=>{V(),a(!1)},S=()=>n.language==="zh"?"小熊AI助手":n.language==="pt"?"Assistente IA Xiaoxiong":"Xiaoxiong AI Assistant";return r?null:e.jsx(st,{open:s,onOpenChange:O,children:e.jsxs(at,{className:"sm:max-w-2xl sm:h-[90vh] sm:max-h-[90vh] flex flex-col p-0 gap-0 overflow-hidden",children:[e.jsx(rt,{className:"px-4 py-3 shrink-0 border-b",children:e.jsxs(ot,{className:"text-base font-semibold flex items-center gap-2",children:[l&&e.jsx("img",{src:l,alt:"Logo",className:"w-8 h-8 rounded-full object-cover"}),S()]})}),e.jsx("div",{className:"flex-1 min-h-0 flex flex-col overflow-hidden",children:e.jsx(Nt,{messages:f,input:i,setInput:c,isLoading:u,showLocationDialog:g,setShowLocationDialog:y,pendingMessage:j,handleSubmit:R,handleKeyDown:C,handleLocationConfirm:B,processMessage:T,setPendingMessage:b,onClose:O,showBackButton:!1,showHeader:!1,className:"flex-1"})})]})})},Ce=({restaurant:s,language:a})=>{const[n,m]=o.useState(999),r=o.useRef(null),h=s.type.slice(0,3).map((i,c)=>({key:`type-${c}`,label:i,variant:"secondary",color:void 0}));o.useEffect(()=>{const i=()=>{if(!r.current)return;const f=r.current,u=Array.from(f.querySelectorAll(".tag-badge"));if(u.length===0){setTimeout(i,50);return}const g=u[0]?.offsetTop;let y=u.length;for(let j=0;j<u.length;j++)if(u[j].offsetTop>g){y=j;break}y<u.length&&(y=Math.max(1,y-1)),m(y)};m(999);const c=setTimeout(i,100);return window.addEventListener("resize",i),()=>{clearTimeout(c),window.removeEventListener("resize",i)}},[h.length,s.id]);const l=h.slice(0,n),d=h.length>n;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{ref:r,className:"flex gap-1.5 flex-wrap flex-1",children:l.map(i=>e.jsx(L,{variant:i.variant,className:"text-xs font-medium whitespace-nowrap tag-badge",style:i.color?{backgroundColor:i.color,color:"white"}:void 0,children:i.label},i.key))}),d&&e.jsxs(_t,{children:[e.jsx(Ct,{asChild:!0,children:e.jsx($,{variant:"ghost",size:"sm",className:"h-6 px-2 text-muted-foreground hover:text-foreground flex-shrink-0",children:e.jsx(Ke,{className:"h-4 w-4"})})}),e.jsx(St,{className:"w-80",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:h.map(i=>e.jsx(L,{variant:i.variant,className:"text-xs font-medium",style:i.color?{backgroundColor:i.color,color:"white"}:void 0,children:i.label},i.key))})})]})]})},Bt=()=>{const s=ge(),{t:a,i18n:n}=G(),{toast:m}=nt(),{localizeRestaurant:r}=ze(),[h,l]=o.useState(""),[d,i]=o.useState([]),[c,f]=o.useState(null),[u,g]=o.useState([]),[y,j]=o.useState(null),[b,R]=o.useState(null),[C,B]=o.useState(!1),[T,V]=o.useState(!1),[A,O]=o.useState(!1),S=o.useRef(null),D=o.useRef(null),F=o.useRef({}),[P,v]=o.useState(null),[w,k]=o.useState(!1),[Z,W]=o.useState(!1),[X,oe]=o.useState(!1),[Q,ne]=o.useState(!1),Y=4,{data:J,isLoading:ee}=Lt(h,d.length>0?d.join(","):void 0),{data:x=[]}=At(),{data:_=[]}=Ee(),{data:z={}}=Tt(),N=_.filter(t=>(z[t.id]||0)>0),te=t=>{i(p=>p.includes(t)?p.filter(M=>M!==t):[...p,t])},K=()=>{W(!0)},se=async()=>{W(!1);try{const t=await bt();R({lat:t.coords.latitude,lng:t.coords.longitude}),m({title:a("restaurants.locationEnabled"),description:a("restaurants.sortByDistance")})}catch(t){console.error("Location error:",t)}},q=t=>{j(t),t&&!b&&K()},ie=async t=>{if(c===t)f(null),g([]);else{f(t);const{data:p,error:M}=await ct.from("activity_restaurants").select("restaurant_id").eq("activity_id",t);M?(console.error("Error fetching activity restaurants:",M),g([])):g(p.map(He=>He.restaurant_id))}},U=J?.map(t=>{const p=r(t);if(b){const M=gt(b.lat,b.lng,t.lat,t.lng);return{...p,distance:M}}return p})||[],ae=c?U.filter(t=>u.includes(t.id)):U,E=y&&b?ae.filter(t=>t.distance&&t.distance<=y).sort((t,p)=>(t.distance||0)-(p.distance||0)):b?ae.sort((t,p)=>(t.distance||0)-(p.distance||0)):ae.sort((t,p)=>(p.rating||0)-(t.rating||0)),re=t=>{s(`/restaurant/${t.id}`)},H=t=>{v(t.id);const p=F.current[t.id];p&&p.scrollIntoView({behavior:"smooth",block:"center"})},xe=()=>{const t=document.getElementById("home-map-container");if(t)if(C)document.exitFullscreen&&document.exitFullscreen();else{if(S.current){const p=S.current.getCenter(),M=S.current.getZoom();D.current={center:[p.lng,p.lat],zoom:M}}t.requestFullscreen&&t.requestFullscreen()}};return o.useEffect(()=>{const t=()=>{const p=!!document.fullscreenElement;B(p),!p&&D.current&&S.current&&setTimeout(()=>{S.current?.jumpTo({center:D.current.center,zoom:D.current.zoom})},100)};return document.addEventListener("fullscreenchange",t),()=>{document.removeEventListener("fullscreenchange",t)}},[]),e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("div",{className:"text-left mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-foreground mb-2 sm:mb-3",children:a("nav.mapView")}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:a("map.subtitle")})]}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx(it,{placeholder:a("restaurants.search"),value:h,onChange:t=>l(t.target.value),className:"h-11 bg-background/60 backdrop-blur-sm border-primary/20 focus:border-primary"})}),e.jsxs("div",{className:"flex gap-2 md:contents",children:[e.jsxs($,{variant:b?"default":"outline",onClick:b?void 0:K,className:"flex-1 md:flex-initial gap-2 h-11 md:px-6",children:[e.jsx(le,{className:`w-4 h-4 ${b?"animate-pulse":""}`}),e.jsx("span",{className:"md:hidden",children:a("restaurants.getLocationMobile")}),e.jsx("span",{className:"hidden md:inline",children:a(b?"restaurants.locationEnabled":"restaurants.getLocation")})]}),e.jsxs($,{variant:w?"default":"outline",onClick:()=>k(!w),className:"flex-1 md:flex-initial gap-2 h-11 md:px-6",children:[e.jsx(We,{className:"w-4 h-4"}),a("restaurants.filter")]})]})]}),w&&e.jsxs("div",{className:"space-y-3 bg-card/50 backdrop-blur-sm rounded-lg p-4 border border-border/50 animate-fade-in",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[a("restaurants.restaurantTypes"),":"]}),d.length>0&&e.jsx(L,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5",onClick:()=>i([]),children:a("common.actions.clearFilter")}),x.length>8&&e.jsx($,{variant:"ghost",size:"sm",className:"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200",onClick:()=>V(!T),children:a(T?"common.showLess":"common.showMore")})]}),e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${T?"animate-expand-height":""}`,children:(T?x:x.slice(0,8)).map((t,p)=>e.jsx(L,{variant:d.includes(t)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${d.includes(t)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${p*30}ms`},onClick:()=>te(t),children:t},t))}),e.jsxs("div",{className:"sm:hidden relative -mx-1 px-1",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth",children:x.map((t,p)=>e.jsx(L,{variant:d.includes(t)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${d.includes(t)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${p*30}ms`},onClick:()=>te(t),children:t},t))}),e.jsx("div",{className:"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none"})]})]})]}),N.length>0&&e.jsxs("div",{className:"space-y-2 pt-1 border-t border-border/30",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[a("nav.activities"),":"]}),c&&e.jsx(L,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5",onClick:()=>{f(null),g([])},children:a("common.actions.clearFilter")}),N.length>8&&e.jsx($,{variant:"ghost",size:"sm",className:"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200",onClick:()=>O(!A),children:a(A?"common.showLess":"common.showMore")})]}),e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${A?"animate-expand-height":""}`,children:(A?N:N.slice(0,8)).map((t,p)=>{const M=n.language==="zh"?t.badge_text_zh||t.title_zh:n.language==="pt"?t.badge_text_pt||t.title_pt:t.badge_text_en||t.title_en;return e.jsx(L,{variant:c===t.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${c===t.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${p*30}ms`},onClick:()=>ie(t.id),children:M},t.id)})}),e.jsxs("div",{className:"sm:hidden relative -mx-1 px-1",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth",children:N.map((t,p)=>{const M=n.language==="zh"?t.badge_text_zh||t.title_zh:n.language==="pt"?t.badge_text_pt||t.title_pt:t.badge_text_en||t.title_en;return e.jsx(L,{variant:c===t.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${c===t.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${p*30}ms`},onClick:()=>ie(t.id),children:M},t.id)})}),e.jsx("div",{className:"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none"})]})]})]})]}),b&&e.jsxs("div",{className:"flex gap-2 flex-wrap items-center bg-muted/30 backdrop-blur-sm rounded-lg p-3 border border-primary/10",children:[e.jsxs("span",{className:"text-sm font-semibold text-primary",children:[a("restaurants.radius"),":"]}),e.jsx(L,{variant:y===null?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>q(null),children:a("restaurants.allRestaurants")}),e.jsx(L,{variant:y===5?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>q(5),children:a("restaurants.radius5km")}),e.jsx(L,{variant:y===10?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>q(10),children:a("restaurants.radius10km")}),e.jsx(L,{variant:y===20?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>q(20),children:a("restaurants.radius20km")})]})]}),!ee&&E&&e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("div",{className:`w-full lg:flex-1 transition-all duration-300 ease-in-out ${X?"h-0 overflow-hidden lg:h-[500px]":"h-[400px] lg:h-[500px]"}`,children:e.jsxs("div",{id:"home-map-container",className:`${C?"fixed inset-0 z-50 bg-background":"w-full h-full"} rounded-xl overflow-hidden shadow-2xl border border-primary/10 relative group`,children:[e.jsx($,{variant:"secondary",size:"icon",className:"absolute bottom-4 right-4 z-10 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:xe,children:C?e.jsx(Xe,{className:"w-5 h-5"}):e.jsx(Qe,{className:"w-5 h-5"})}),e.jsxs("div",{className:"h-full relative",children:[e.jsx(Mt,{restaurants:E,onRestaurantClick:re,userLocation:b,radiusFilter:y,onMarkerClick:H,showViewDetailsButton:!0,onMapInit:t=>{S.current=t}}),e.jsxs("div",{className:"absolute bottom-4 left-4 z-10 pointer-events-none flex items-center gap-2 bg-background/80 backdrop-blur-sm px-3 py-2 rounded-full shadow-lg",children:[e.jsx("img",{src:Rt,alt:"Xiaoxiong Market Logo",className:"h-6 w-6 object-contain"}),e.jsx("span",{className:"text-sm font-semibold text-foreground whitespace-nowrap",children:n.language==="zh"?"小熊市场":"Xiaoxiong Market"})]})]})]})}),e.jsx($,{variant:"outline",size:"sm",className:"lg:hidden flex items-center justify-center gap-2 -mt-3 mb-1",onClick:()=>oe(!X),children:X?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-4 h-4"}),a("map.showMap")]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"w-4 h-4"}),a("map.hideMap")]})}),e.jsxs("div",{className:"w-full lg:w-[420px] flex flex-col",children:[e.jsxs("div",{className:"mb-4 pb-4 border-b border-border",children:[e.jsxs("h2",{className:"text-xl sm:text-2xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(ce,{className:"w-6 h-6 text-primary"}),a("restaurants.title"),e.jsx(L,{variant:"secondary",className:"ml-2",children:E.length})]}),b&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-2 flex items-center gap-1.5",children:[e.jsx(le,{className:"w-4 h-4"}),a("restaurants.sortedByDistance")]})]}),E.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(ce,{className:"w-16 h-16 text-muted-foreground/40 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2",children:a("restaurants.noResults")}),e.jsx("p",{className:"text-muted-foreground max-w-xs",children:a("restaurants.noResultsDesc")})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lg:hidden space-y-3 pb-4",children:[(Q?E:E.slice(0,Y)).map(t=>e.jsx(ue,{ref:p=>F.current[t.id]=p,className:`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${P===t.id?"border-primary ring-2 ring-primary ring-offset-2":"border-transparent"}`,onClick:()=>re(t),children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-bold text-lg text-foreground line-clamp-1 flex-1",children:Ne(t.name)}),t.distance!==void 0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full w-fit",children:[e.jsx(le,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.distance<1?`${(t.distance*1e3).toFixed(0)} m`:`${t.distance.toFixed(1)} km`})]})]}),t.rating>0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full flex-shrink-0",children:[e.jsx(je,{className:"w-4 h-4",style:{fill:"#016450",color:"#016450"}}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.rating})]})]}),t.type&&t.type.length>0&&e.jsx(Ce,{restaurant:t,language:n.language}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx(ce,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60"}),e.jsx("span",{className:"line-clamp-2",children:t.address})]})]})},t.id)),E.length>Y&&e.jsx($,{variant:"outline",className:"w-full mt-2 gap-2",onClick:()=>ne(!Q),children:Q?e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"w-4 h-4"}),a("map.collapseList")]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-4 h-4"}),a("map.showAllRestaurants",{count:E.length})]})})]}),e.jsx(lt,{className:"hidden lg:block h-[420px] pr-4",children:e.jsx("div",{className:"space-y-3 pb-4",children:E.map(t=>e.jsx(ue,{ref:p=>F.current[t.id]=p,className:`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${P===t.id?"border-primary ring-2 ring-primary ring-offset-2":"border-transparent"}`,onClick:()=>re(t),children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-bold text-lg text-foreground line-clamp-1 flex-1",children:Ne(t.name)}),t.distance!==void 0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full w-fit",children:[e.jsx(le,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.distance<1?`${(t.distance*1e3).toFixed(0)} m`:`${t.distance.toFixed(1)} km`})]})]}),t.rating>0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full flex-shrink-0",children:[e.jsx(je,{className:"w-4 h-4",style:{fill:"#016450",color:"#016450"}}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.rating})]})]}),t.type&&t.type.length>0&&e.jsx(Ce,{restaurant:t,language:n.language}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx(ce,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60"}),e.jsx("span",{className:"line-clamp-2",children:t.address})]})]})},t.id))})})]})]})]}),e.jsx(Dt,{open:Z,onOpenChange:W,onConfirm:se})]})},$e=o.memo(({stats:s,onAskXiaoxiong:a})=>{const{t:n,i18n:m}=G(),{data:r}=De(),{buttons:h}=dt(),{settings:l}=be(),d=m.language,[i,c]=o.useState(!1),f=l?.about_us_button_mobile!==!1,u=h?.find(C=>C.label_zh==="演示"||C.link?.includes("v.xiaoxiong.pt"));u&&u.enabled!==!1&&u.visible!==!1&&u.show_on_mobile;const g=C=>!r||r.length===0?"":r[0][`${C}${d==="zh"?"_zh":d==="pt"?"_pt":"_en"}`]||"",y=g("title")||n("home.hero.title"),j=g("description")||n("home.hero.description"),b=g("subtitle_button_text")||n("home.hero.subtitle"),R=()=>{u?.link&&mt(u.link),c(!1)};return e.jsxs("section",{className:"min-h-[55vh] flex flex-col bg-secondary/20",children:[e.jsxs("div",{className:"pt-20 px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-bold text-foreground",children:n("home.hero.brandName")}),e.jsx("img",{src:Re,alt:"map icon",width:28,height:28,loading:"eager",decoding:"async",className:"w-7 h-7 object-contain flex-shrink-0"})]}),f&&e.jsxs(Se,{to:"/about-us",className:"flex items-center gap-1 px-2 py-1 text-xs bg-background/80 backdrop-blur-sm rounded-full border border-border/50 shadow-sm hover:bg-background transition-colors whitespace-nowrap flex-shrink-0",children:[e.jsx(Ue,{className:"w-3.5 h-3.5 text-primary flex-shrink-0"}),e.jsx("span",{className:"text-foreground/80",children:n("nav.aboutUs","关于我们")})]})]}),s&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(me,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:n("home.stats.delivery")}),e.jsx("span",{className:"font-bold text-foreground text-sm",children:s.order_count})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Le,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:n("home.stats.reservation")}),e.jsx("span",{className:"font-bold text-foreground text-sm",children:s.reserve_count})]})]})]}),e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-4 py-8",children:e.jsxs("div",{className:"max-w-md mx-auto text-center space-y-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground leading-tight",children:y}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground max-w-sm mx-auto",children:j}),e.jsx("div",{className:"pt-4",children:e.jsxs("button",{onClick:a,className:"group flex items-center gap-3 bg-secondary/50 backdrop-blur-sm text-foreground px-5 py-3.5 rounded-full shadow-sm hover:shadow-md hover:bg-secondary/70 transition-all duration-300 cursor-text border border-border/50 mx-auto",children:[e.jsx(Ae,{className:"w-5 h-5 text-primary group-hover:text-primary/80 transition-colors"}),e.jsx("span",{className:"text-sm text-muted-foreground group-hover:text-foreground transition-colors",children:b}),e.jsx(Te,{className:"w-4 h-4 text-muted-foreground/60 ml-2"})]})})]})}),e.jsx(zt,{open:i,onOpenChange:c,onConfirm:R,url:u?.link})]})});$e.displayName="MobileHeroSection";const Vt=s=>!s||!Array.isArray(s)?!1:s.every(a=>typeof a=="object"&&a!==null&&"start"in a&&"end"in a&&typeof a.start=="number"&&typeof a.end=="number"),Pt=(s,a)=>{const n=pe(new Date(s.start_date)),m=s.end_date?pe(new Date(s.end_date)):null,r=pe(a);if(r<n||m&&r>m)return!1;switch(s.repeat_mode||"none"){case"none":return It(n,r);case"daily":return!0;case"weekly":const l=$t(r);return s.repeat_weekday===l;case"monthly":const i=_e(r),c=s.repeat_month_day;return Vt(c)?c.some(j=>i>=j.start&&i<=j.end):!1;case"yearly":const f=Et(r)+1,u=_e(r),g=s.repeat_yearly_month,y=s.repeat_yearly_day;return g===f&&y===u;default:return!1}},de=s=>{switch(s.repeat_mode||"none"){case"none":return 0;case"weekly":return 1;case"monthly":return 2;case"yearly":return 3;case"daily":return 4;default:return 5}},Ot=()=>{const{data:s,isLoading:a}=Ee(),n=o.useMemo(()=>{if(!s)return{today:[],tomorrow:[],dayAfterTomorrow:[]};const r=new Date,h=ke(r,1),l=ke(r,2),d=i=>s.filter(c=>c.visible&&c.status==="published").filter(c=>Pt(c,i)).sort((c,f)=>{const u=de(c)-de(f);return u!==0?u:c.pinned!==f.pinned?c.pinned?-1:1:(c.sort_order||0)-(f.sort_order||0)});return{today:d(r),tomorrow:d(h),dayAfterTomorrow:d(l)}},[s]),m=o.useMemo(()=>{const r=new Set,h=[];return n.today.forEach(l=>{r.has(l.id)||(r.add(l.id),h.push({...l,dayLabel:"today"}))}),n.tomorrow.forEach(l=>{r.has(l.id)||(r.add(l.id),h.push({...l,dayLabel:"tomorrow"}))}),n.dayAfterTomorrow.forEach(l=>{r.has(l.id)||(r.add(l.id),h.push({...l,dayLabel:"dayAfterTomorrow"}))}),h.sort((l,d)=>{const i=de(l)-de(d);return i!==0?i:l.pinned!==d.pinned?l.pinned?-1:1:(l.sort_order||0)-(d.sort_order||0)})},[n]);return{recentActivities:n,allRecentActivities:m,isLoading:a,hasActivities:m.length>0}},Ie=()=>{const[s,a]=o.useState(4);return o.useEffect(()=>{const n=()=>{const m=window.innerWidth;m<640?a(2):m<1024?a(3):a(4)};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),s},Fe=o.memo(({activity:s,dayLabel:a})=>{const n=ge(),{t:m}=G(),{getLocalizedField:r}=ze(),h=r(s,"title"),l=o.useMemo(()=>{switch(s.service_type){case"dine_in":return m("activities.serviceType.dine_in");case"takeaway":return m("activities.serviceType.takeaway");case"both":return m("activities.serviceType.both");default:return""}},[s.service_type,m]),d=()=>{n(`/activity/${s.id}`)};return e.jsxs(ue,{className:"group cursor-pointer overflow-hidden hover:shadow-lg transition-all duration-300 border-border/50 bg-card",onClick:d,children:[e.jsxs("div",{className:"relative aspect-[16/10] overflow-hidden bg-muted",children:[s.image_url?e.jsx("img",{src:s.image_url,alt:h,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",loading:"lazy"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-primary/20 to-primary/5",children:e.jsx(Ge,{className:"w-12 h-12 text-primary/40"})}),e.jsx(L,{className:I("absolute top-2 left-2 text-xs font-medium",a===m("home.recentActivities.today")?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground"),children:a}),s.pinned&&e.jsx(L,{className:"absolute top-2 right-2 text-xs bg-accent text-accent-foreground",children:m("activities.pinned")})]}),e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsx("h3",{className:"font-medium text-sm leading-tight line-clamp-2 text-foreground group-hover:text-primary transition-colors",children:h}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[s.service_type==="dine_in"&&e.jsx(we,{className:"w-3 h-3 flex-shrink-0"}),s.service_type==="takeaway"&&e.jsx(me,{className:"w-3 h-3 flex-shrink-0"}),s.service_type==="both"&&e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"w-3 h-3 flex-shrink-0"}),e.jsx(me,{className:"w-3 h-3 flex-shrink-0"})]}),e.jsx("span",{className:"truncate",children:l})]})]})]})});Fe.displayName="ActivityCard";const Be=o.memo(()=>{const s=Ie();return e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:Array.from({length:s}).map((a,n)=>e.jsxs(ue,{className:"overflow-hidden",children:[e.jsx(he,{className:"aspect-[16/10] w-full"}),e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsx(he,{className:"h-4 w-full"}),e.jsx(he,{className:"h-3 w-2/3"})]})]},n))})});Be.displayName="LoadingSkeleton";const Ve=o.memo(()=>{const{t:s}=G(),{allRecentActivities:a,isLoading:n,hasActivities:m}=Ot(),r=Ie(),[h,l]=o.useState(!1),d=f=>{switch(f){case"today":return s("home.recentActivities.today");case"tomorrow":return s("home.recentActivities.tomorrow");case"dayAfterTomorrow":return s("home.recentActivities.dayAfterTomorrow");default:return""}},i=o.useMemo(()=>h?a:a.slice(0,r),[a,r,h]),c=a.length>r;return!n&&!m?null:e.jsx("section",{className:"py-8 sm:py-12 px-4 bg-secondary/20",children:e.jsxs("div",{className:"container mx-auto max-w-7xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-foreground",children:s("home.recentActivities.title")}),c&&!h&&e.jsx($,{variant:"ghost",size:"sm",className:"text-primary hover:text-primary/80",onClick:()=>l(!0),children:e.jsxs("span",{className:"flex items-center gap-1",children:[s("home.recentActivities.viewAll"),e.jsx(Ze,{className:"w-4 h-4"})]})}),h&&e.jsx($,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground",onClick:()=>l(!1),children:e.jsx("span",{className:"flex items-center gap-1",children:s("home.recentActivities.collapse")})})]}),n?e.jsx(Be,{}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:i.map(f=>e.jsx(Fe,{activity:f,dayLabel:d(f.dayLabel)},f.id))})]})})});Ve.displayName="RecentActivitiesSection";const fe="/images/sushi-ramen-hero.jpg",Pe="/images/sushi-ramen-mobile.jpg",Oe=o.memo(({stats:s,t:a})=>e.jsx("div",{className:"absolute top-16 sm:top-20 left-3 z-20",children:e.jsxs("div",{className:"gap-4 w-fit flex-col flex items-start justify-start",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm text-white/90 drop-shadow-md",children:a("home.stats.delivery")}),e.jsx("span",{className:"font-bold text-white text-sm drop-shadow-md",children:s.order_count})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-sm text-white/90 drop-shadow-md",children:a("home.stats.reservation")}),e.jsx("span",{className:"font-bold text-white text-sm drop-shadow-md",children:s.reserve_count})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl sm:text-2xl font-bold text-white drop-shadow-md",children:a("home.hero.brandName")}),e.jsx("img",{src:Re,alt:"map icon",width:32,height:32,loading:"eager",decoding:"async",className:"w-7 sm:w-8 h-7 sm:h-8 object-contain flex-shrink-0"})]})]})}));Oe.displayName="StatsDisplay";const qt=()=>{const s=()=>{try{return typeof window<"u"?window.innerWidth:1024}catch{return 1024}},a=()=>{try{return typeof navigator<"u"?navigator.connection:null}catch{return null}},n=()=>{try{return typeof navigator<"u"?navigator.deviceMemory:null}catch{return null}},m=s(),r=m<640,h=m>=1024,l=a();let d=!1,i=!1;try{d=pt(),i=ft()}catch(f){console.warn("[useLightweightMode] Environment detection failed:",f)}if(h)return!!l?.saveData;if(i&&!d||l&&(l.saveData||l.effectiveType==="2g"||l.effectiveType==="slow-2g"))return!0;const c=n();return!!(r&&c&&c<2)},qe=o.memo(({template:s,isActive:a,currentLang:n,t:m,onContentReady:r,onAskXiaoxiong:h})=>{const[l,d]=o.useState({}),[i,c]=o.useState({}),[f,u]=o.useState({}),[g,y]=o.useState({mobile:!0,tablet:!0,desktop:!0}),[j,b]=o.useState(!1),R=qt(),C=o.useRef(null),B=o.useRef(null),T=o.useRef(null),V=x=>s[`${x}${n==="zh"?"_zh":n==="pt"?"_pt":"_en"}`]||"",A=()=>{try{if(typeof window>"u")return"desktop";const x=window.innerWidth;return x<640?"mobile":x<1024?"tablet":"desktop"}catch{return"desktop"}},O=()=>{const x=A();return x==="mobile"&&s.mobile_overlay_opacity!==null?s.mobile_overlay_opacity:x==="tablet"&&s.tablet_overlay_opacity!==null?s.tablet_overlay_opacity:x==="desktop"&&s.desktop_overlay_opacity!==null?s.desktop_overlay_opacity:s.overlay_opacity??30},S=()=>{const x=O(),_=s.overlay_gradient_direction||"to-b",z=(H,xe)=>H==null?xe/100:H>1?H/100:H,N=x>1?x/100:x,te=z(s.overlay_gradient_from_opacity,30)*N,K=z(s.overlay_gradient_via_opacity,25)*N,se=z(s.overlay_gradient_to_opacity,40)*N,ie={"to-t":"to top","to-b":"to bottom","to-l":"to left","to-r":"to right","to-tl":"to top left","to-tr":"to top right","to-bl":"to bottom left","to-br":"to bottom right"}[_]||"to bottom",U={black:"0, 0, 0",white:"255, 255, 255",background:"0, 0, 0",foreground:"255, 255, 255",primary:"1, 100, 80",secondary:"240, 240, 240"},ae=U[s.overlay_gradient_from||"black"]||"0, 0, 0",E=U[s.overlay_gradient_via||"black"]||"0, 0, 0",re=U[s.overlay_gradient_to||"black"]||"0, 0, 0";return{background:`linear-gradient(${ie}, rgba(${ae}, ${te}), rgba(${E}, ${K}), rgba(${re}, ${se}))`}},D=s.mobile_image_url||Pe,F=s.tablet_image_url||s.desktop_image_url||fe,P=s.desktop_image_url||fe,v=s.background_blur||0,w=s.desktop_media_type||s.media_type||"image",k=s.tablet_media_type||s.media_type||"image",Z=s.mobile_media_type||s.media_type||"image",W=w==="video"&&!R,X=k==="video"&&!R,oe=Z==="video"&&!R,Q=oe?s.mobile_video_url:null,ne=X?s.tablet_video_url||s.desktop_video_url:null,Y=W?s.desktop_video_url:null;o.useEffect(()=>{const x=A(),_=x==="mobile"?D:x==="tablet"?F:P;if(_){const z=new Image;z.onload=()=>{d(N=>({...N,[x]:!0})),y(N=>({...N,[x]:!0})),a&&(r?.(),setTimeout(()=>b(!0),100))},z.src=_}},[D,F,P,a,r]),o.useEffect(()=>{a&&l[A()]&&b(!0)},[a,l]);const J=x=>{c(_=>({..._,[x]:!0}))},ee=(x,_)=>{console.error(`[HeroSlide] Video error on ${x}:`,_),u(z=>({...z,[x]:!0}))};return o.useEffect(()=>{if(!j||!a)return;let x=!1;try{x=ut()}catch{}if(!x)return;const _=A(),N=(_==="mobile"?C:_==="tablet"?B:T).current;if(!N)return;const K=setTimeout(async()=>{try{N.muted=!0,N.playsInline=!0,N.setAttribute("webkit-playsinline","true"),await N.play(),console.log(`[HeroSlide] iOS video play successful on ${_}`)}catch(se){console.error(`[HeroSlide] iOS video play failed on ${_}:`,se),u(q=>({...q,[_]:!0}))}},150);return()=>clearTimeout(K)},[j,a]),e.jsxs("div",{className:I("absolute inset-0 w-full h-full transition-opacity duration-1000",a?"opacity-100 z-10":"opacity-0 z-0"),children:[e.jsxs("div",{className:"absolute inset-0 w-full h-full",children:[e.jsxs("div",{className:"absolute inset-0 w-full h-full sm:hidden",children:[!g.mobile&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),oe&&Q?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:D,alt:"Background",className:I("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",i.mobile&&!f.mobile?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:v>0?`blur(${v}px)`:void 0}}),j&&!f.mobile&&e.jsx("video",{ref:C,src:Q,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>J("mobile"),onError:x=>ee("mobile",x),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:v>0?`blur(${v}px)`:void 0}})]}):e.jsx("img",{src:D,alt:"Background",className:I("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",g.mobile?"opacity-100":"opacity-0"),style:{filter:v>0?`blur(${v}px)`:void 0}})]}),e.jsxs("div",{className:"absolute inset-0 w-full h-full hidden sm:block lg:hidden",children:[!g.tablet&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),X&&ne?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:F,alt:"Background",className:I("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",i.tablet&&!f.tablet?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:v>0?`blur(${v}px)`:void 0}}),j&&!f.tablet&&e.jsx("video",{ref:B,src:ne,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>J("tablet"),onError:x=>ee("tablet",x),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:v>0?`blur(${v}px)`:void 0}})]}):e.jsx("img",{src:F,alt:"Background",className:I("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",g.tablet?"opacity-100":"opacity-0"),style:{filter:v>0?`blur(${v}px)`:void 0}})]}),e.jsxs("div",{className:"absolute inset-0 w-full h-full hidden lg:block",children:[!g.desktop&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),W&&Y?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:P,alt:"Background",className:I("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",i.desktop&&!f.desktop?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:v>0?`blur(${v}px)`:void 0}}),j&&!f.desktop&&e.jsx("video",{ref:T,src:Y,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>J("desktop"),onError:x=>ee("desktop",x),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:v>0?`blur(${v}px)`:void 0}})]}):e.jsx("img",{src:P,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:I("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",g.desktop?"opacity-100":"opacity-0"),style:{filter:v>0?`blur(${v}px)`:void 0}})]}),e.jsx("div",{className:"absolute inset-0 w-full h-full",style:S()})]}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full",children:[e.jsx("h1",{className:"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]",children:V("title")||m("home.hero.title")}),e.jsx("p",{className:"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]",children:V("description")||m("home.hero.description")}),s.subtitle_button_text_zh&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:h,className:"group flex items-center gap-3 bg-white/20 backdrop-blur-xl text-white px-5 sm:px-7 py-3.5 sm:py-4 rounded-full shadow-[0_8px_32px_rgba(0,0,0,0.12)] hover:shadow-[0_16px_48px_rgba(0,0,0,0.2)] hover:bg-white/30 transition-all duration-300 cursor-text border border-white/40",children:[e.jsx(Ae,{className:"w-5 h-5 text-white/90 group-hover:text-white transition-colors drop-shadow-sm"}),e.jsx("span",{className:"text-sm sm:text-base text-primary group-hover:text-primary/80 transition-colors drop-shadow-sm font-medium",children:V("subtitle_button_text")||m("home.hero.subtitle")}),e.jsx(Te,{className:"w-4 h-4 text-white/60 ml-2 drop-shadow-sm"})]})})]})})]})});qe.displayName="HeroSlide";const ms=()=>{const{t:s,i18n:a}=G(),n=Ye(),{settings:m}=be(),{data:r,isLoading:h,refetch:l}=De(),[d,i]=o.useState(0),[c,f]=o.useState(null),u=o.useRef(null),[g,y]=o.useState(!1),[j,b]=o.useState(!1),R=Me(),{isWebView:C,isNativeApp:B}=xt(),T=R||C,V=C||B,A=m?.ai_assistant_enabled!==!1,O=o.useCallback(()=>{y(!0)},[]);jt({pageType:"home"});const S=o.useCallback(async()=>{try{const k=await(await fetch("https://v.xiaoxiong.pt/api/get_info")).json();k&&f({order_count:k.order_count||0,reserve_count:k.reserve_count||0})}catch(w){console.error("Failed to fetch stats:",w)}},[]);o.useEffect(()=>{S()},[S]);const D=o.useCallback(async()=>{n.removeQueries({queryKey:["homepage-templates"]}),n.removeQueries({queryKey:["restaurants"]}),n.removeQueries({queryKey:["activities"]}),n.removeQueries({queryKey:["recent-activities"]}),await Promise.all([l(),S(),n.invalidateQueries({queryKey:["restaurants"]}),n.invalidateQueries({queryKey:["activities"]}),n.invalidateQueries({queryKey:["recent-activities"]})])},[l,S,n]);o.useEffect(()=>{if(!r||r.length<=1)return;const k=r[d]?.duration||5e3;return u.current=setTimeout(()=>{i(Z=>(Z+1)%r.length)},k),()=>{u.current&&clearTimeout(u.current)}},[r,d]);const F=o.useCallback(w=>{u.current&&clearTimeout(u.current),i(w)},[]);o.useCallback(()=>{r&&(u.current&&clearTimeout(u.current),i(w=>(w-1+r.length)%r.length))},[r]),o.useCallback(()=>{r&&(u.current&&clearTimeout(u.current),i(w=>(w+1)%r.length))},[r]);const P=a.language,v=r&&r.length>1;return e.jsx(kt,{onRefresh:D,children:e.jsxs("div",{className:"min-h-screen",children:[T?e.jsx($e,{stats:c,onAskXiaoxiong:()=>b(!0)}):e.jsxs("section",{className:"relative h-screen flex items-start overflow-hidden bg-background",children:[c&&e.jsx(Oe,{stats:c,t:s}),e.jsx("div",{className:I("absolute inset-0 w-full h-full transition-opacity duration-500",g?"opacity-100":"opacity-0"),children:r?.map((w,k)=>e.jsx(qe,{template:w,isActive:k===d,currentLang:P,t:s,onContentReady:k===0?O:void 0,onAskXiaoxiong:()=>b(!0)},w.id))}),e.jsx("div",{className:I("absolute inset-0 w-full h-full z-20 transition-opacity duration-500",h||!g?"opacity-100":"opacity-0 pointer-events-none"),children:e.jsx(ht,{})}),!h&&(!r||r.length===0)&&e.jsxs("div",{className:"absolute inset-0 w-full h-full",children:[e.jsx("img",{src:Pe,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:"absolute inset-0 w-full h-full object-cover object-center sm:hidden"}),e.jsx("img",{src:fe,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:"absolute inset-0 w-full h-full object-cover object-center hidden sm:block"}),e.jsx("div",{className:"absolute inset-0 w-full h-full bg-gradient-to-b from-black/30 via-black/25 to-black/40"}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 flex items-center min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full",children:[e.jsx("h1",{className:"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]",children:s("home.hero.title")}),e.jsx("p",{className:"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]",children:s("home.hero.description")})]})})]}),v&&e.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 z-30 flex gap-2",children:r.map((w,k)=>e.jsx("button",{onClick:()=>F(k),className:I("w-3 h-3 rounded-full transition-all duration-300",k===d?"bg-white w-8":"bg-white/50 hover:bg-white/70"),"aria-label":`Go to slide ${k+1}`},k))})]}),e.jsx(Ve,{}),e.jsx("section",{className:"py-12 sm:py-20 px-4 bg-secondary/20",children:e.jsx("div",{className:"container mx-auto max-w-7xl",children:e.jsx(Bt,{})})}),!V&&e.jsxs("section",{className:"py-16 sm:py-24 px-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/5 via-primary/3 to-primary/8",style:{maskImage:"radial-gradient(ellipse 80% 70% at 50% 50%, black 40%, transparent 100%)",WebkitMaskImage:"radial-gradient(ellipse 80% 70% at 50% 50%, black 40%, transparent 100%)"}}),e.jsx("div",{className:"absolute top-1/4 left-1/4 w-72 h-72 bg-primary/8 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-primary/5 rounded-full blur-3xl"}),e.jsx("div",{className:"container mx-auto max-w-5xl relative z-10",children:e.jsx("div",{className:"flex flex-col items-center justify-center gap-8",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-primary/10 text-primary text-sm font-medium px-4 py-2 rounded-full mb-4",children:[e.jsx(Je,{className:"w-4 h-4"}),e.jsx("span",{children:"Mobile App"})]}),e.jsx("h3",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-foreground mb-4",children:s("home.app.title")}),e.jsx("p",{className:"text-base sm:text-lg text-muted-foreground mb-8 leading-relaxed",children:s("home.app.description")}),e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:[e.jsxs("a",{href:"https://apps.apple.com/cn/app/xiaoxiong/id6755481369",target:"_blank",rel:"noopener noreferrer",className:"relative group",children:[e.jsx("div",{className:"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity"}),e.jsx("div",{className:"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center",children:e.jsx("img",{src:yt,alt:"Download on the App Store",className:"h-8 sm:h-9"})})]}),e.jsxs("a",{href:"https://play.google.com/store/apps/details?id=com.xiaoxiong.market",target:"_blank",rel:"noopener noreferrer",className:"relative group",children:[e.jsx("div",{className:"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity"}),e.jsx("div",{className:"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center",children:e.jsx("img",{src:vt,alt:"Get it on Google Play",className:"h-12 sm:h-14"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(et,{className:"w-4 h-4 animate-bounce"}),e.jsx("span",{children:s("home.app.downloadNow")})]})]})]})})})]}),e.jsxs("section",{className:"py-16 sm:py-20 px-4 bg-gradient-to-r from-primary/90 to-primary relative overflow-hidden rounded-3xl mx-4 sm:mx-8 lg:mx-16 mb-8",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("div",{className:"absolute top-0 right-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/10 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/10 rounded-full blur-3xl"}),e.jsxs("div",{className:"container mx-auto max-w-4xl text-center relative z-10",children:[e.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-primary-foreground mb-4 sm:mb-6 px-4",children:s("home.cta.title")}),e.jsx("p",{className:"text-base sm:text-xl text-primary-foreground/90 mb-6 sm:mb-8 max-w-2xl mx-auto px-4",children:s("home.cta.description")}),e.jsx("div",{className:"flex justify-center",children:e.jsx($,{size:"lg",variant:"secondary",asChild:!0,className:"text-base sm:text-lg shadow-xl hover:shadow-2xl",children:e.jsxs(Se,{to:"/join-us",children:[e.jsx(tt,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),s("home.cta.button")]})})})]})]}),A&&e.jsx(Ft,{open:j,onOpenChange:b})]})})};export{ms as default};
//# sourceMappingURL=Home-DAcH00EG.js.map
