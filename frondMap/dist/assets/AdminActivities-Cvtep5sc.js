import{j as e}from"./vendor-ui-DAmPMpEA.js";import{r as f,R as y,L as it}from"./vendor-react-iAJ0IrSD.js";import{c as et,D as Me,a as Fe,b as Ie,d as Be,$ as jt,r as W,a2 as tt,B as C,a3 as st,au as $e,S as rt,C as se,k as ae,a0 as j,X as Oe,I as z,g as De,e as xe,a6 as fe,a7 as je,a8 as ve,a9 as we,aa as N,f as Ze,h as Pt,s as F,y as de,L as ke,a4 as Se,n as Tt,J as Ue,ah as Ve,ag as Mt,K as Ye,N as Xe,O as Ke,Q as qe,R as We,T as Qe,V as Ge,j as Ft,t as It,ac as Bt}from"./index-Do1W_89N.js";import{C as _e}from"./checkbox-Do5gfcxP.js";import{i as Lt}from"./useActivities-D4KR3YX0.js";import{u as Ht}from"./useLocalizedContent-tJ7i_ycU.js";import{r as $t,s as Ot}from"./useAdmin-Cqjt-KAT.js";import{u as Ut,C as K}from"./index.esm-CVRqJy9l.js";import{o as vt,s as _,d as ze,e as ne,n as ie,b as Ee,t as Vt}from"./types-CpDVS0Ep.js";import{C as lt}from"./calendar-B88J-cTe.js";import{P as ot,a as dt,b as ct}from"./popover-DuDjhr8M.js";import{T as Re,a as Ae,b as B,c as L}from"./tabs-cuGeNK5n.js";import{u as Yt}from"./useRestaurants-C1m5cU2_.js";import{u as Xt}from"./vendor-query-BlSVl3IQ.js";import{R as H}from"./RichTextEditor-DwM9opVO.js";import{A as Kt,a as qt}from"./alert-wGhh9MP-.js";import{u as be,i as ue}from"./vendor-i18n-DxKeo2S1.js";import{I as Wt}from"./info-CgAG28_X.js";import{U as ht}from"./upload-B1PGtm6Q.js";import{I as mt}from"./image-B9MAqH9W.js";import{V as xt}from"./video-C_HEt71w.js";import{F as Je}from"./file-pen-Cb7YC5oy.js";import{A as Qt}from"./arrow-up-down-DnMTFOix.js";import{f as Pe}from"./format-DMNSJgyu.js";import{u as Gt,a as Zt}from"./useActivityRules-CsHkhUyS.js";import{F as wt}from"./file-text-EiQL9V8p.js";import{S as _t}from"./save-Dtf4njxK.js";import{u as Jt,a as es}from"./useGlobalHandbook-_zq0NeOT.js";import{B as bt}from"./book-open-DQWYBj1g.js";import{b as ts}from"./exportUtils-YWmY6fTR.js";import{D as ss}from"./download-DPWfpS6b.js";import{P as as}from"./plus-D-VZe8Eb.js";import{S as ns}from"./search-DsePuv7P.js";import{C as is}from"./chart-column-CsuCj0AI.js";import"./vendor-charts-Bz7hPIBd.js";import"./vendor-supabase-KNAP0qdW.js";import"./startOfDay-D6pD3B6q.js";import"./subDays-DgL-WRAj.js";import"./chevron-left-BcmQFin1.js";import"./vendor-editor-BxSQdrX3.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=et("Crop",[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=et("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=et("Pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]);var ds=Object.defineProperty,cs=(a,s,t)=>s in a?ds(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t,D=(a,s,t)=>cs(a,typeof s!="symbol"?s+"":s,t);const Te={x:0,y:0,width:0,height:0,unit:"px"},pe=(a,s,t)=>Math.min(Math.max(a,s),t),hs=(...a)=>a.filter(s=>s&&typeof s=="string").join(" "),ut=(a,s)=>a===s||a.width===s.width&&a.height===s.height&&a.x===s.x&&a.y===s.y&&a.unit===s.unit;function ms(a,s,t,o){const n=q(a,t,o);return a.width&&(n.height=n.width/s),a.height&&(n.width=n.height*s),n.y+n.height>o&&(n.height=o-n.y,n.width=n.height*s),n.x+n.width>t&&(n.width=t-n.x,n.height=n.width/s),a.unit==="%"?te(n,t,o):n}function xs(a,s,t){const o=q(a,s,t);return o.x=(s-o.width)/2,o.y=(t-o.height)/2,a.unit==="%"?te(o,s,t):o}function te(a,s,t){return a.unit==="%"?{...Te,...a,unit:"%"}:{unit:"%",x:a.x?a.x/s*100:0,y:a.y?a.y/t*100:0,width:a.width?a.width/s*100:0,height:a.height?a.height/t*100:0}}function q(a,s,t){return a.unit?a.unit==="px"?{...Te,...a,unit:"px"}:{unit:"px",x:a.x?a.x*s/100:0,y:a.y?a.y*t/100:0,width:a.width?a.width*s/100:0,height:a.height?a.height*t/100:0}:{...Te,...a,unit:"px"}}function pt(a,s,t,o,n,i=0,c=0,p=o,d=n){const l={...a};let m=Math.min(i,o),x=Math.min(c,n),g=Math.min(p,o),h=Math.min(d,n);s&&(s>1?(m=c?c*s:m,x=m/s,g=p*s):(x=i?i/s:x,m=x*s,h=d/s)),l.y<0&&(l.height=Math.max(l.height+l.y,x),l.y=0),l.x<0&&(l.width=Math.max(l.width+l.x,m),l.x=0);const b=o-(l.x+l.width);b<0&&(l.x=Math.min(l.x,o-m),l.width+=b);const k=n-(l.y+l.height);if(k<0&&(l.y=Math.min(l.y,n-x),l.height+=k),l.width<m&&((t==="sw"||t=="nw")&&(l.x-=m-l.width),l.width=m),l.height<x&&((t==="nw"||t=="ne")&&(l.y-=x-l.height),l.height=x),l.width>g&&((t==="sw"||t=="nw")&&(l.x-=g-l.width),l.width=g),l.height>h&&((t==="nw"||t=="ne")&&(l.y-=h-l.height),l.height=h),s){const R=l.width/l.height;if(R<s){const v=Math.max(l.width/s,x);(t==="nw"||t=="ne")&&(l.y-=v-l.height),l.height=v}else if(R>s){const v=Math.max(l.height*s,m);(t==="sw"||t=="nw")&&(l.x-=v-l.width),l.width=v}}return l}function us(a,s,t,o){const n={...a};return s==="ArrowLeft"?o==="nw"?(n.x-=t,n.y-=t,n.width+=t,n.height+=t):o==="w"?(n.x-=t,n.width+=t):o==="sw"?(n.x-=t,n.width+=t,n.height+=t):o==="ne"?(n.y+=t,n.width-=t,n.height-=t):o==="e"?n.width-=t:o==="se"&&(n.width-=t,n.height-=t):s==="ArrowRight"&&(o==="nw"?(n.x+=t,n.y+=t,n.width-=t,n.height-=t):o==="w"?(n.x+=t,n.width-=t):o==="sw"?(n.x+=t,n.width-=t,n.height-=t):o==="ne"?(n.y-=t,n.width+=t,n.height+=t):o==="e"?n.width+=t:o==="se"&&(n.width+=t,n.height+=t)),s==="ArrowUp"?o==="nw"?(n.x-=t,n.y-=t,n.width+=t,n.height+=t):o==="n"?(n.y-=t,n.height+=t):o==="ne"?(n.y-=t,n.width+=t,n.height+=t):o==="sw"?(n.x+=t,n.width-=t,n.height-=t):o==="s"?n.height-=t:o==="se"&&(n.width-=t,n.height-=t):s==="ArrowDown"&&(o==="nw"?(n.x+=t,n.y+=t,n.width-=t,n.height-=t):o==="n"?(n.y+=t,n.height-=t):o==="ne"?(n.y+=t,n.width-=t,n.height-=t):o==="sw"?(n.x-=t,n.width+=t,n.height+=t):o==="s"?n.height+=t:o==="se"&&(n.width+=t,n.height+=t)),n}const ge={capture:!0,passive:!1};let ps=0;const ee=class U extends f.PureComponent{constructor(){super(...arguments),D(this,"docMoveBound",!1),D(this,"mouseDownOnCrop",!1),D(this,"dragStarted",!1),D(this,"evData",{startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0}),D(this,"componentRef",f.createRef()),D(this,"mediaRef",f.createRef()),D(this,"resizeObserver"),D(this,"initChangeCalled",!1),D(this,"instanceId",`rc-${ps++}`),D(this,"state",{cropIsActive:!1,newCropIsBeingDrawn:!1}),D(this,"onCropPointerDown",s=>{const{crop:t,disabled:o}=this.props,n=this.getBox();if(!t)return;const i=q(t,n.width,n.height);if(o)return;s.cancelable&&s.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const c=s.target.dataset.ord,p=!!c;let d=s.clientX,l=s.clientY,m=i.x,x=i.y;if(c){const g=s.clientX-n.x,h=s.clientY-n.y;let b=0,k=0;c==="ne"||c=="e"?(b=g-(i.x+i.width),k=h-i.y,m=i.x,x=i.y+i.height):c==="se"||c==="s"?(b=g-(i.x+i.width),k=h-(i.y+i.height),m=i.x,x=i.y):c==="sw"||c=="w"?(b=g-i.x,k=h-(i.y+i.height),m=i.x+i.width,x=i.y):(c==="nw"||c=="n")&&(b=g-i.x,k=h-i.y,m=i.x+i.width,x=i.y+i.height),d=m+n.x+b,l=x+n.y+k}this.evData={startClientX:d,startClientY:l,startCropX:m,startCropY:x,clientX:s.clientX,clientY:s.clientY,isResize:p,ord:c},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})}),D(this,"onComponentPointerDown",s=>{const{crop:t,disabled:o,locked:n,keepSelection:i,onChange:c}=this.props,p=this.getBox();if(o||n||i&&t)return;s.cancelable&&s.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const d=s.clientX-p.x,l=s.clientY-p.y,m={unit:"px",x:d,y:l,width:0,height:0};this.evData={startClientX:s.clientX,startClientY:s.clientY,startCropX:d,startCropY:l,clientX:s.clientX,clientY:s.clientY,isResize:!0},this.mouseDownOnCrop=!0,c(q(m,p.width,p.height),te(m,p.width,p.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})}),D(this,"onDocPointerMove",s=>{const{crop:t,disabled:o,onChange:n,onDragStart:i}=this.props,c=this.getBox();if(o||!t||!this.mouseDownOnCrop)return;s.cancelable&&s.preventDefault(),this.dragStarted||(this.dragStarted=!0,i&&i(s));const{evData:p}=this;p.clientX=s.clientX,p.clientY=s.clientY;let d;p.isResize?d=this.resizeCrop():d=this.dragCrop(),ut(t,d)||n(q(d,c.width,c.height),te(d,c.width,c.height))}),D(this,"onComponentKeyDown",s=>{const{crop:t,disabled:o,onChange:n,onComplete:i}=this.props;if(o)return;const c=s.key;let p=!1;if(!t)return;const d=this.getBox(),l=this.makePixelCrop(d),m=(navigator.platform.match("Mac")?s.metaKey:s.ctrlKey)?U.nudgeStepLarge:s.shiftKey?U.nudgeStepMedium:U.nudgeStep;if(c==="ArrowLeft"?(l.x-=m,p=!0):c==="ArrowRight"?(l.x+=m,p=!0):c==="ArrowUp"?(l.y-=m,p=!0):c==="ArrowDown"&&(l.y+=m,p=!0),p){s.cancelable&&s.preventDefault(),l.x=pe(l.x,0,d.width-l.width),l.y=pe(l.y,0,d.height-l.height);const x=q(l,d.width,d.height),g=te(l,d.width,d.height);n(x,g),i&&i(x,g)}}),D(this,"onHandlerKeyDown",(s,t)=>{const{aspect:o=0,crop:n,disabled:i,minWidth:c=0,minHeight:p=0,maxWidth:d,maxHeight:l,onChange:m,onComplete:x}=this.props,g=this.getBox();if(i||!n)return;if(s.key==="ArrowUp"||s.key==="ArrowDown"||s.key==="ArrowLeft"||s.key==="ArrowRight")s.stopPropagation(),s.preventDefault();else return;const h=(navigator.platform.match("Mac")?s.metaKey:s.ctrlKey)?U.nudgeStepLarge:s.shiftKey?U.nudgeStepMedium:U.nudgeStep,b=q(n,g.width,g.height),k=us(b,s.key,h,t),R=pt(k,o,t,g.width,g.height,c,p,d,l);if(!ut(n,R)){const v=te(R,g.width,g.height);m(R,v),x&&x(R,v)}}),D(this,"onDocPointerDone",s=>{const{crop:t,disabled:o,onComplete:n,onDragEnd:i}=this.props,c=this.getBox();this.unbindDocMove(),!(o||!t)&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,i&&i(s),n&&n(q(t,c.width,c.height),te(t,c.width,c.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))}),D(this,"onDragFocus",()=>{var s;(s=this.componentRef.current)==null||s.scrollTo(0,0)})}get document(){return document}getBox(){const s=this.mediaRef.current;if(!s)return{x:0,y:0,width:0,height:0};const{x:t,y:o,width:n,height:i}=s.getBoundingClientRect();return{x:t,y:o,width:n,height:i}}componentDidUpdate(s){const{crop:t,onComplete:o}=this.props;if(o&&!s.crop&&t){const{width:n,height:i}=this.getBox();n&&i&&o(q(t,n,i),te(t,n,i))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect(),this.unbindDocMove()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,ge),this.document.addEventListener("pointerup",this.onDocPointerDone,ge),this.document.addEventListener("pointercancel",this.onDocPointerDone,ge),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,ge),this.document.removeEventListener("pointerup",this.onDocPointerDone,ge),this.document.removeEventListener("pointercancel",this.onDocPointerDone,ge),this.docMoveBound=!1)}getCropStyle(){const{crop:s}=this.props;if(s)return{top:`${s.y}${s.unit}`,left:`${s.x}${s.unit}`,width:`${s.width}${s.unit}`,height:`${s.height}${s.unit}`}}dragCrop(){const{evData:s}=this,t=this.getBox(),o=this.makePixelCrop(t),n=s.clientX-s.startClientX,i=s.clientY-s.startClientY;return o.x=pe(s.startCropX+n,0,t.width-o.width),o.y=pe(s.startCropY+i,0,t.height-o.height),o}getPointRegion(s,t,o,n){const{evData:i}=this,c=i.clientX-s.x,p=i.clientY-s.y;let d;n&&t?d=t==="nw"||t==="n"||t==="ne":d=p<i.startCropY;let l;return o&&t?l=t==="nw"||t==="w"||t==="sw":l=c<i.startCropX,l?d?"nw":"sw":d?"ne":"se"}resolveMinDimensions(s,t,o=0,n=0){const i=Math.min(o,s.width),c=Math.min(n,s.height);return!t||!i&&!c?[i,c]:t>1?i?[i,i/t]:[c*t,c]:c?[c*t,c]:[i,i/t]}resizeCrop(){const{evData:s}=this,{aspect:t=0,maxWidth:o,maxHeight:n}=this.props,i=this.getBox(),[c,p]=this.resolveMinDimensions(i,t,this.props.minWidth,this.props.minHeight);let d=this.makePixelCrop(i);const l=this.getPointRegion(i,s.ord,c,p),m=s.ord||l;let x=s.clientX-s.startClientX,g=s.clientY-s.startClientY;(c&&m==="nw"||m==="w"||m==="sw")&&(x=Math.min(x,-c)),(p&&m==="nw"||m==="n"||m==="ne")&&(g=Math.min(g,-p));const h={unit:"px",x:0,y:0,width:0,height:0};l==="ne"?(h.x=s.startCropX,h.width=x,t?(h.height=h.width/t,h.y=s.startCropY-h.height):(h.height=Math.abs(g),h.y=s.startCropY-h.height)):l==="se"?(h.x=s.startCropX,h.y=s.startCropY,h.width=x,t?h.height=h.width/t:h.height=g):l==="sw"?(h.x=s.startCropX+x,h.y=s.startCropY,h.width=Math.abs(x),t?h.height=h.width/t:h.height=g):l==="nw"&&(h.x=s.startCropX+x,h.width=Math.abs(x),t?(h.height=h.width/t,h.y=s.startCropY-h.height):(h.height=Math.abs(g),h.y=s.startCropY+g));const b=pt(h,t,l,i.width,i.height,c,p,o,n);return t||U.xyOrds.indexOf(m)>-1?d=b:U.xOrds.indexOf(m)>-1?(d.x=b.x,d.width=b.width):U.yOrds.indexOf(m)>-1&&(d.y=b.y,d.height=b.height),d.x=pe(d.x,0,i.width-d.width),d.y=pe(d.y,0,i.height-d.height),d}renderCropSelection(){const{ariaLabels:s=U.defaultProps.ariaLabels,disabled:t,locked:o,renderSelectionAddon:n,ruleOfThirds:i,crop:c}=this.props,p=this.getCropStyle();if(c)return y.createElement("div",{style:p,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":s.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group"},!t&&!o&&y.createElement("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus},y.createElement("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),y.createElement("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),y.createElement("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),y.createElement("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":s.nwDragHandle,onKeyDown:d=>this.onHandlerKeyDown(d,"nw"),role:"button"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":s.nDragHandle,onKeyDown:d=>this.onHandlerKeyDown(d,"n"),role:"button"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":s.neDragHandle,onKeyDown:d=>this.onHandlerKeyDown(d,"ne"),role:"button"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":s.eDragHandle,onKeyDown:d=>this.onHandlerKeyDown(d,"e"),role:"button"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":s.seDragHandle,onKeyDown:d=>this.onHandlerKeyDown(d,"se"),role:"button"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":s.sDragHandle,onKeyDown:d=>this.onHandlerKeyDown(d,"s"),role:"button"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":s.swDragHandle,onKeyDown:d=>this.onHandlerKeyDown(d,"sw"),role:"button"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":s.wDragHandle,onKeyDown:d=>this.onHandlerKeyDown(d,"w"),role:"button"})),n&&y.createElement("div",{className:"ReactCrop__selection-addon",onPointerDown:d=>d.stopPropagation()},n(this.state)),i&&y.createElement(y.Fragment,null,y.createElement("div",{className:"ReactCrop__rule-of-thirds-hz"}),y.createElement("div",{className:"ReactCrop__rule-of-thirds-vt"})))}makePixelCrop(s){const t={...Te,...this.props.crop||{}};return q(t,s.width,s.height)}render(){const{aspect:s,children:t,circularCrop:o,className:n,crop:i,disabled:c,locked:p,style:d,ruleOfThirds:l}=this.props,{cropIsActive:m,newCropIsBeingDrawn:x}=this.state,g=i?this.renderCropSelection():null,h=hs("ReactCrop",n,m&&"ReactCrop--active",c&&"ReactCrop--disabled",p&&"ReactCrop--locked",x&&"ReactCrop--new-crop",i&&s&&"ReactCrop--fixed-aspect",i&&o&&"ReactCrop--circular-crop",i&&l&&"ReactCrop--rule-of-thirds",!this.dragStarted&&i&&!i.width&&!i.height&&"ReactCrop--invisible-crop",o&&"ReactCrop--no-animate");return y.createElement("div",{ref:this.componentRef,className:h,style:d},y.createElement("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown},t),i?y.createElement("svg",{className:"ReactCrop__crop-mask",width:"100%",height:"100%"},y.createElement("defs",null,y.createElement("mask",{id:`hole-${this.instanceId}`},y.createElement("rect",{width:"100%",height:"100%",fill:"white"}),o?y.createElement("ellipse",{cx:`${i.x+i.width/2}${i.unit}`,cy:`${i.y+i.height/2}${i.unit}`,rx:`${i.width/2}${i.unit}`,ry:`${i.height/2}${i.unit}`,fill:"black"}):y.createElement("rect",{x:`${i.x}${i.unit}`,y:`${i.y}${i.unit}`,width:`${i.width}${i.unit}`,height:`${i.height}${i.unit}`,fill:"black"}))),y.createElement("rect",{fill:"black",fillOpacity:.5,width:"100%",height:"100%",mask:`url(#hole-${this.instanceId})`})):void 0,g)}};D(ee,"xOrds",["e","w"]),D(ee,"yOrds",["n","s"]),D(ee,"xyOrds",["nw","ne","se","sw"]),D(ee,"nudgeStep",1),D(ee,"nudgeStepMedium",10),D(ee,"nudgeStepLarge",100),D(ee,"defaultProps",{ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}});let gs=ee;const yt=1200,Nt=630,gt=yt/Nt;function fs(a,s,t){return xs(ms({unit:"%",width:90},t,a,s),a,s)}function js({open:a,onOpenChange:s,imageFile:t,onCropComplete:o}){const{t:n}=be(),[i,c]=f.useState(""),[p,d]=f.useState(),[l,m]=f.useState(),x=f.useRef(null),[g,h]=f.useState(!1);f.useEffect(()=>{if(a&&t){const v=new FileReader;v.addEventListener("load",()=>{c(v.result?.toString()||"")}),v.readAsDataURL(t)}},[a,t]);const b=f.useCallback(v=>{const{width:A,height:P}=v.currentTarget;d(fs(A,P,gt))},[]),k=f.useCallback(async(v,A)=>{const P=document.createElement("canvas"),V=P.getContext("2d");if(!V)throw new Error("No 2d context");const Q=v.naturalWidth/v.width,u=v.naturalHeight/v.height;return P.width=A.width*Q,P.height=A.height*u,V.imageSmoothingQuality="high",V.drawImage(v,A.x*Q,A.y*u,A.width*Q,A.height*u,0,0,P.width,P.height),new Promise((T,G)=>{P.toBlob(Y=>{if(!Y){G(new Error("Canvas is empty"));return}T(Y)},"image/jpeg",.95)})},[]),R=f.useCallback(async()=>{if(!(!l||!x.current)){h(!0);try{const v=await k(x.current,l),A=new File([v],t.name,{type:"image/jpeg"}),P=URL.createObjectURL(v);o(A,P),s(!1)}catch(v){console.error("Error cropping image:",v)}finally{h(!1)}}},[l,t,o,s,k]);return e.jsx(Me,{open:a,onOpenChange:s,children:e.jsxs(Fe,{className:"max-w-[95vw] sm:max-w-4xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[e.jsxs(Ie,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-4 border-b",children:[e.jsxs(Be,{className:"text-lg sm:text-xl flex items-center gap-2",children:[e.jsx(rs,{className:"w-5 h-5 text-primary"}),n("admin.cropImage")]}),e.jsx(jt,{className:"text-xs sm:text-sm",children:n("admin.cropImageDescription")})]}),e.jsxs("div",{className:"px-4 sm:px-6 py-4 space-y-4 overflow-y-auto",children:[e.jsxs(Kt,{className:"border-primary/20 bg-primary/5",children:[e.jsx(Wt,{className:"h-4 w-4"}),e.jsxs(qt,{className:"text-xs sm:text-sm",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[e.jsxs("span",{className:"font-medium",children:[n("admin.recommendedSize"),":"]}),e.jsxs(W,{variant:"secondary",className:"w-fit",children:[e.jsx(ls,{className:"w-3 h-3 mr-1"}),yt," Ã— ",Nt," px"]})]}),e.jsx("p",{className:"mt-2 text-muted-foreground text-xs",children:n("admin.imageSizeHint")})]})]}),e.jsx("div",{className:"relative w-full overflow-hidden rounded-lg border",children:i&&e.jsx(gs,{crop:p,onChange:v=>d(v),onComplete:v=>m(v),aspect:gt,className:"max-h-[50vh] sm:max-h-[60vh]",children:e.jsx("img",{ref:x,src:i,alt:"Crop preview",onLoad:b,className:"max-w-full h-auto"})})})]}),e.jsxs(tt,{className:"px-4 sm:px-6 pb-4 sm:pb-6 pt-4 border-t gap-2 sm:gap-0",children:[e.jsx(C,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:g,className:"w-full sm:w-auto",children:n("common.cancel")}),e.jsx(C,{type:"button",onClick:R,disabled:!l||g,className:"w-full sm:w-auto",children:n(g?"common.processing":"admin.confirmCrop")})]})]})})}const vs=vt({title_en:_().optional(),title_zh:_().optional(),title_pt:_().optional(),intro_zh:_().optional(),intro_en:_().optional(),intro_pt:_().optional(),content_en:_().optional(),content_zh:_().optional(),content_pt:_().optional(),usage_instructions_zh:_().optional(),usage_instructions_en:_().optional(),usage_instructions_pt:_().optional(),start_date:ze().optional(),end_date:ze().optional(),repeat_mode:ne(["none","daily","weekly","monthly","yearly","days_before"]).optional(),repeat_weekday:ie().min(0).max(6).optional().nullable(),repeat_days_before:ie().min(0).max(30).optional().nullable(),service_type:ne(["dine_in","takeaway","both"]).optional(),status:ne(["draft","published"]).default("draft"),pinned:Ee().default(!1),visible:Ee().default(!1),sort_order:ie().default(0),badge_text_zh:_().optional(),badge_text_en:_().optional(),badge_text_pt:_().optional(),badge_color:_().optional(),discount_type:ne(["percentage","fixed_amount"]).optional().nullable(),discount_value:ie().optional().nullable(),discount_key:_().optional().nullable()}),ws=vt({title_en:_().min(1,ue.t("validation.titleRequired")),title_zh:_().min(1,ue.t("validation.titleRequired")),title_pt:_().min(1,ue.t("validation.titleRequired")),intro_zh:_().optional(),intro_en:_().optional(),intro_pt:_().optional(),content_en:_().min(1,ue.t("validation.contentRequired")),content_zh:_().min(1,ue.t("validation.contentRequired")),content_pt:_().min(1,ue.t("validation.contentRequired")),usage_instructions_zh:_().optional(),usage_instructions_en:_().optional(),usage_instructions_pt:_().optional(),start_date:ze(),end_date:ze().optional(),repeat_mode:ne(["none","daily","weekly","monthly","yearly","days_before"]),repeat_weekday:ie().min(0).max(6).optional().nullable(),repeat_days_before:ie().min(0).max(30).optional().nullable(),service_type:ne(["dine_in","takeaway","both"]),status:ne(["draft","published"]).default("published"),pinned:Ee().default(!1),visible:Ee().default(!0),sort_order:ie().default(0),badge_text_zh:_().optional(),badge_text_en:_().optional(),badge_text_pt:_().optional(),badge_color:_().optional(),discount_type:ne(["percentage","fixed_amount"]).optional().nullable(),discount_value:ie().optional().nullable(),discount_key:_().optional().nullable()}),_s=vs;function ft({activity:a,trigger:s}){const{t}=be(),o=Xt(),[n,i]=f.useState(!1),[c,p]=f.useState(null),[d,l]=f.useState(a?.image_url||null),[m,x]=f.useState([]),[g,h]=f.useState(!1),[b,k]=f.useState(!1),[R,v]=f.useState(null),[A,P]=f.useState(a?.media_type==="video"?"video":"image"),[V,Q]=f.useState(null),[u,T]=f.useState(a?.video_url||null),[G,Y]=f.useState(!1),[re,ce]=f.useState(!1),{data:ye}=Yt(),{register:M,handleSubmit:Le,formState:{errors:S},setValue:I,watch:E,control:X}=Ut({resolver:Vt(_s),defaultValues:a?{title_en:a.title_en,title_zh:a.title_zh,title_pt:a.title_pt,intro_zh:a.intro_zh||"",intro_en:a.intro_en||"",intro_pt:a.intro_pt||"",content_en:a.content_en,content_zh:a.content_zh,content_pt:a.content_pt,usage_instructions_zh:a.usage_instructions_zh||"",usage_instructions_en:a.usage_instructions_en||"",usage_instructions_pt:a.usage_instructions_pt||"",start_date:new Date(a.start_date),end_date:a.end_date?new Date(a.end_date):void 0,repeat_mode:a.repeat_mode||"none",repeat_weekday:a.repeat_weekday??null,repeat_days_before:a.repeat_days_before??null,service_type:a.service_type||"both",status:a.status||"draft",pinned:a.pinned||!1,visible:a.visible!==void 0?a.visible:!0,sort_order:a.sort_order||0,badge_text_zh:a.badge_text_zh||a.title_zh,badge_text_en:a.badge_text_en||a.title_en,badge_text_pt:a.badge_text_pt||a.title_pt,badge_color:a.badge_color||"#9b87f5",discount_type:a.discount_type||null,discount_value:a.discount_value||null,discount_key:a.discount_key||null}:{repeat_mode:"none",repeat_weekday:null,repeat_days_before:null,service_type:"both",status:"draft",pinned:!1,visible:!1,sort_order:0,badge_color:"#9b87f5",discount_type:null,discount_value:null,discount_key:null}}),Ne=E("start_date"),Ce=E("end_date"),Ct=E("pinned"),Dt=E("visible"),$=E("status");f.useEffect(()=>{$==="draft"&&(I("visible",!1),I("pinned",!1))},[$,I]),f.useEffect(()=>{(async()=>{if(a?.id){const{data:w}=await F.from("activity_restaurants").select("restaurant_id").eq("activity_id",a.id);w&&x(w.map(O=>O.restaurant_id))}})()},[a?.id]);const at=r=>{const w=r.target.files?.[0];if(w){if(w.size>10*1024*1024){de.error(t("admin.imageTooBig"));return}v(w),k(!0)}r.target.value=""},kt=(r,w)=>{p(r),l(w)},St=r=>{const w=r.target.files?.[0];if(w){if(w.size>100*1024*1024){de.error(t("admin.videoTooBig")||"è§†é¢‘æ–‡ä»¶è¿‡å¤§ï¼ˆæœ€å¤§100MBï¼‰");return}if(!w.type.startsWith("video/")){de.error(t("admin.invalidVideoFormat")||"è¯·ä¸Šä¼ è§†é¢‘æ–‡ä»¶");return}Q(w),T(URL.createObjectURL(w)),ce(!1)}r.target.value=""},zt=async()=>{if(!c)return a?.image_url||null;const r=c.name.split(".").pop(),O=`${`${Math.random()}.${r}`}`,{error:he}=await F.storage.from("activity-images").upload(O,c);if(he)throw he;const{data:{publicUrl:He}}=F.storage.from("activity-images").getPublicUrl(O);return He},Et=async()=>{if(re&&!V)return null;if(!V)return a?.video_url||null;Y(!0);try{const r=V.name.split(".").pop(),w=`video_${Date.now()}.${r}`,{error:O}=await F.storage.from("activity-images").upload(w,V);if(O)throw O;const{data:{publicUrl:he}}=F.storage.from("activity-images").getPublicUrl(w);return he}finally{Y(!1)}},Rt=async r=>{h(!0);try{if(r.status==="published"){const Z=ws.safeParse(r);if(!Z.success){const me={title_zh:t("admin.titleChinese"),title_en:t("admin.titleEnglish"),title_pt:t("admin.titlePortuguese"),content_zh:t("admin.contentChinese"),content_en:t("admin.contentEnglish"),content_pt:t("admin.contentPortuguese"),start_date:t("admin.startDate"),end_date:t("admin.endDate"),repeat_mode:t("admin.repeatMode"),service_type:t("admin.serviceType")},J=Z.error.errors.map(le=>{const oe=le.path.join(".");return me[oe]||oe});de.error(`${t("admin.publishRequiresComplete")}: ${J.join(", ")}`),h(!1);return}}const{data:{user:w}}=await F.auth.getUser();if(!w)throw new Error("Not authenticated");const[O,he]=await Promise.all([zt(),Et()]),He=r.status==="draft"?!1:r.visible,nt={title_en:r.title_en||"",title_zh:r.title_zh||"",title_pt:r.title_pt||"",intro_zh:r.intro_zh||null,intro_en:r.intro_en||null,intro_pt:r.intro_pt||null,content_en:r.content_en||"",content_zh:r.content_zh||"",content_pt:r.content_pt||"",usage_instructions_zh:r.usage_instructions_zh||null,usage_instructions_en:r.usage_instructions_en||null,usage_instructions_pt:r.usage_instructions_pt||null,repeat_mode:r.repeat_mode||"none",repeat_weekday:r.repeat_mode==="weekly"?r.repeat_weekday:null,repeat_days_before:r.repeat_mode==="days_before"?r.repeat_days_before:null,service_type:r.service_type||"both",status:r.status,pinned:r.status==="draft"?!1:r.pinned,visible:He,sort_order:r.sort_order,image_url:O,media_type:A,video_url:he,creator_id:w.id,start_date:r.start_date?.toISOString()||new Date().toISOString(),end_date:r.end_date?.toISOString()||null,badge_text_zh:r.badge_text_zh||r.title_zh||"",badge_text_en:r.badge_text_en||r.title_en||"",badge_text_pt:r.badge_text_pt||r.title_pt||"",badge_color:r.badge_color||"#9b87f5",discount_type:r.discount_type||null,discount_value:r.discount_value||null,discount_key:r.discount_key||null};if(a){const{error:Z}=await F.from("activities").update(nt).eq("id",a.id);if(Z)throw Z;if(await F.from("activity_restaurants").delete().eq("activity_id",a.id),m.length>0){const me=m.map(le=>({activity_id:a.id,restaurant_id:le})),{error:J}=await F.from("activity_restaurants").insert(me);if(J)throw J}de.success(t("admin.activityUpdated")),i(!1)}else{const{data:Z,error:me}=await F.from("activities").insert([nt]).select().single();if(me)throw me;if(m.length>0){const le=m.map(At=>({activity_id:Z.id,restaurant_id:At})),{error:oe}=await F.from("activity_restaurants").insert(le);if(oe)throw oe}const{data:J}=await F.from("coupon_templates").select("id").eq("auto_link_activities",!0).eq("is_active",!0);if(J&&J.length>0){const le=J.map(oe=>({coupon_template_id:oe.id,activity_id:Z.id}));await F.from("coupon_template_activities").insert(le)}de.success(t("admin.activityCreated")),i(!1)}o.invalidateQueries({queryKey:["activities"]})}catch(w){de.error(w.message||t("common.error"))}finally{h(!1)}};return e.jsxs(Me,{open:n,onOpenChange:i,children:[e.jsx(st,{asChild:!0,children:s}),e.jsxs(Fe,{className:"max-w-[95vw] sm:max-w-6xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[e.jsxs(Ie,{className:"px-6 pt-6 pb-4 border-b bg-muted/30",children:[e.jsxs(Be,{className:"text-2xl flex items-center gap-2",children:[e.jsx($e,{className:"w-6 h-6 text-primary"}),t(a?"admin.editActivity":"admin.addActivity")]}),e.jsx(jt,{className:"text-base",children:t(a?"admin.editActivityDetails":"admin.createActivityWithContent")})]}),e.jsx(rt,{className:"px-6 h-[calc(95vh-220px)]",children:e.jsxs("form",{onSubmit:Le(Rt),className:"space-y-6 py-6",children:[e.jsx(se,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:e.jsxs(ae,{className:"p-6",children:[e.jsxs(j,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(ht,{className:"w-5 h-5 text-primary"}),t("admin.activityMedia")||"æ´»åŠ¨åª’ä½“"]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs(C,{type:"button",variant:A==="image"?"default":"outline",size:"sm",onClick:()=>P("image"),className:"flex items-center gap-2",children:[e.jsx(mt,{className:"w-4 h-4"}),t("admin.image")||"å›¾ç‰‡"]}),e.jsxs(C,{type:"button",variant:A==="video"?"default":"outline",size:"sm",onClick:()=>P("video"),className:"flex items-center gap-2",children:[e.jsx(xt,{className:"w-4 h-4"}),t("admin.video")||"è§†é¢‘"]})]}),A==="image"&&e.jsxs("div",{className:"flex items-center gap-6",children:[d&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:d,alt:"Preview",className:"w-40 h-40 object-cover rounded-lg shadow-lg ring-2 ring-primary/20 transition-transform duration-200 group-hover:scale-105"}),e.jsx(C,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-8 w-8 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{p(null),l(null)},children:e.jsx(Oe,{className:"h-4 w-4"})})]}),e.jsxs(j,{htmlFor:"image-upload",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3 px-8 py-6 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[e.jsx(ht,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium text-sm",children:t("admin.uploadImage")}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t("admin.imageMaxSize")})]})]}),e.jsx(z,{id:"image-upload",type:"file",accept:"image/*",className:"hidden",onChange:at})]})]}),A==="video"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[u&&e.jsxs("div",{className:"relative group",children:[e.jsx("video",{src:u,className:"w-40 h-40 object-cover rounded-lg shadow-lg ring-2 ring-primary/20",muted:!0,loop:!0,playsInline:!0,onMouseEnter:r=>r.currentTarget.play(),onMouseLeave:r=>{r.currentTarget.pause(),r.currentTarget.currentTime=0}}),e.jsx(C,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-8 w-8 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{Q(null),T(null),ce(!0)},children:e.jsx(Oe,{className:"h-4 w-4"})})]}),e.jsxs(j,{htmlFor:"video-upload",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3 px-8 py-6 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[e.jsx(xt,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium text-sm",children:t("admin.uploadVideo")||"ä¸Šä¼ è§†é¢‘"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t("admin.videoMaxSize")||"æœ€å¤§ 50MB"})]})]}),e.jsx(z,{id:"video-upload",type:"file",accept:"video/*",className:"hidden",onChange:St})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx(j,{className:"text-sm font-medium mb-2 block",children:t("admin.fallbackImage")||"å°é¢å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:t("admin.fallbackImageDesc")||"è§†é¢‘åŠ è½½å‰æ˜¾ç¤ºçš„å°é¢å›¾"}),e.jsxs("div",{className:"flex items-center gap-4",children:[d&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:d,alt:"Fallback",className:"w-20 h-20 object-cover rounded-lg shadow ring-2 ring-primary/20"}),e.jsx(C,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-1 -right-1 h-6 w-6 shadow opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{p(null),l(null)},children:e.jsx(Oe,{className:"h-3 w-3"})})]}),e.jsxs(j,{htmlFor:"fallback-image-upload",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all text-sm",children:[e.jsx(mt,{className:"h-4 w-4 text-primary"}),e.jsx("span",{children:t("admin.uploadFallback")||"ä¸Šä¼ å°é¢"})]}),e.jsx(z,{id:"fallback-image-upload",type:"file",accept:"image/*",className:"hidden",onChange:at})]})]})]})]})]})}),e.jsx(se,{className:"border-primary/20",children:e.jsxs(ae,{className:"p-6",children:[e.jsxs(j,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx($e,{className:"w-5 h-5 text-primary"}),t("admin.multilingualContent")]}),e.jsxs(Re,{defaultValue:"zh",className:"w-full",children:[e.jsxs(Ae,{className:"grid w-full grid-cols-3 mb-6",children:[e.jsxs(B,{value:"zh",className:"gap-2",children:["ðŸ‡¨ðŸ‡³ ",t("admin.chinese")]}),e.jsxs(B,{value:"en",className:"gap-2",children:["ðŸ‡¬ðŸ‡§ ",t("admin.english")]}),e.jsxs(B,{value:"pt",className:"gap-2",children:["ðŸ‡µðŸ‡¹ ",t("admin.portuguese")]})]}),e.jsxs(L,{value:"zh",className:"space-y-4 mt-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"title_zh",className:"text-sm font-medium",children:t("admin.title")}),e.jsx(z,{id:"title_zh",...M("title_zh"),placeholder:t("admin.enterTitle"),className:"text-base"}),S.title_zh&&e.jsx("p",{className:"text-sm text-destructive",children:S.title_zh.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"intro_zh",className:"text-sm font-medium",children:"æ´»åŠ¨ç®€ä»‹"}),e.jsx(z,{id:"intro_zh",...M("intro_zh"),placeholder:"ç®€çŸ­æè¿°æ´»åŠ¨ï¼ˆæ˜¾ç¤ºåœ¨é¤åŽ…è¯¦æƒ…é¡µï¼‰",className:"text-base"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"åœ¨é¤åŽ…è¯¦æƒ…é¡µæ´»åŠ¨æ ‡ç­¾åŽæ˜¾ç¤ºçš„ç®€çŸ­è¯´æ˜Ž"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"content_zh",className:"text-sm font-medium",children:t("admin.content")}),e.jsx(K,{name:"content_zh",control:X,render:({field:r})=>e.jsx(H,{value:r.value,onChange:r.onChange,placeholder:t("admin.enterContent")})}),S.content_zh&&e.jsx("p",{className:"text-sm text-destructive",children:S.content_zh.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"usage_instructions_zh",className:"text-sm font-medium",children:"æ´»åŠ¨ä½¿ç”¨æ–¹æ³•"}),e.jsx(K,{name:"usage_instructions_zh",control:X,render:({field:r})=>e.jsx(H,{value:r.value||"",onChange:r.onChange,placeholder:"æè¿°å¦‚ä½•ä½¿ç”¨æ­¤æ´»åŠ¨ï¼ˆå¯é€‰ï¼‰"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"å‘ç”¨æˆ·è¯´æ˜Žå¦‚ä½•å‚ä¸Žå’Œä½¿ç”¨æ­¤æ´»åŠ¨"})]})]}),e.jsxs(L,{value:"en",className:"space-y-4 mt-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"title_en",className:"text-sm font-medium",children:t("admin.title")}),e.jsx(z,{id:"title_en",...M("title_en"),placeholder:t("admin.enterTitle"),className:"text-base"}),S.title_en&&e.jsx("p",{className:"text-sm text-destructive",children:S.title_en.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"intro_en",className:"text-sm font-medium",children:"Activity Brief"}),e.jsx(z,{id:"intro_en",...M("intro_en"),placeholder:"Short description (shown on restaurant details)",className:"text-base"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Brief description shown after activity badge on restaurant page"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"content_en",className:"text-sm font-medium",children:t("admin.content")}),e.jsx(K,{name:"content_en",control:X,render:({field:r})=>e.jsx(H,{value:r.value,onChange:r.onChange,placeholder:t("admin.enterContent")})}),S.content_en&&e.jsx("p",{className:"text-sm text-destructive",children:S.content_en.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"usage_instructions_en",className:"text-sm font-medium",children:"Usage Instructions"}),e.jsx(K,{name:"usage_instructions_en",control:X,render:({field:r})=>e.jsx(H,{value:r.value||"",onChange:r.onChange,placeholder:"Describe how to use this activity (optional)"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Explain to users how to participate and use this activity"})]})]}),e.jsxs(L,{value:"pt",className:"space-y-4 mt-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"title_pt",className:"text-sm font-medium",children:t("admin.title")}),e.jsx(z,{id:"title_pt",...M("title_pt"),placeholder:t("admin.enterTitle"),className:"text-base"}),S.title_pt&&e.jsx("p",{className:"text-sm text-destructive",children:S.title_pt.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"intro_pt",className:"text-sm font-medium",children:"Resumo da Atividade"}),e.jsx(z,{id:"intro_pt",...M("intro_pt"),placeholder:"DescriÃ§Ã£o curta (exibida nos detalhes do restaurante)",className:"text-base"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Breve descriÃ§Ã£o exibida apÃ³s o distintivo da atividade na pÃ¡gina do restaurante"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"content_pt",className:"text-sm font-medium",children:t("admin.content")}),e.jsx(K,{name:"content_pt",control:X,render:({field:r})=>e.jsx(H,{value:r.value,onChange:r.onChange,placeholder:t("admin.enterContent")})}),S.content_pt&&e.jsx("p",{className:"text-sm text-destructive",children:S.content_pt.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"usage_instructions_pt",className:"text-sm font-medium",children:"InstruÃ§Ãµes de Uso"}),e.jsx(K,{name:"usage_instructions_pt",control:X,render:({field:r})=>e.jsx(H,{value:r.value||"",onChange:r.onChange,placeholder:"Descreva como usar esta atividade (opcional)"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Explique aos usuÃ¡rios como participar e usar esta atividade"})]})]})]})]})}),e.jsx(se,{className:"border-primary/20",children:e.jsxs(ae,{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs(j,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(De,{className:"w-5 h-5 text-primary"}),t("admin.dateSettings")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{className:"text-sm font-medium",children:t("admin.startDate")}),e.jsxs(ot,{children:[e.jsx(dt,{asChild:!0,children:e.jsxs(C,{variant:"outline",className:xe("w-full justify-start text-left font-normal h-11",!Ne&&"text-muted-foreground"),children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),Ne?Pe(Ne,"PPP"):e.jsx("span",{children:t("admin.selectDate")})]})}),e.jsx(ct,{className:"w-auto p-0 z-[100]",align:"start",children:e.jsx(lt,{mode:"single",selected:Ne,onSelect:r=>I("start_date",r),initialFocus:!0,className:"pointer-events-auto"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{className:"text-sm font-medium",children:t("admin.endDate")}),e.jsxs(ot,{children:[e.jsx(dt,{asChild:!0,children:e.jsxs(C,{variant:"outline",className:xe("w-full justify-start text-left font-normal h-11",!Ce&&"text-muted-foreground"),children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),Ce?Pe(Ce,"PPP"):e.jsxs("span",{children:[t("admin.selectDate")," (",t("admin.optional"),")"]})]})}),e.jsx(ct,{className:"w-auto p-0 z-[100]",align:"start",children:e.jsx(lt,{mode:"single",selected:Ce,onSelect:r=>I("end_date",r),initialFocus:!0,className:"pointer-events-auto"})})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"repeat_mode",className:"text-sm font-medium",children:t("admin.repeatMode")}),e.jsxs(fe,{onValueChange:r=>I("repeat_mode",r),defaultValue:E("repeat_mode"),children:[e.jsx(je,{className:"h-11",children:e.jsx(ve,{placeholder:t("admin.selectRepeatMode")})}),e.jsxs(we,{children:[e.jsx(N,{value:"none",children:t("admin.repeatNone")}),e.jsx(N,{value:"daily",children:t("admin.repeatDaily")}),e.jsx(N,{value:"weekly",children:t("admin.repeatWeekly")}),e.jsx(N,{value:"monthly",children:t("admin.repeatMonthly")}),e.jsx(N,{value:"yearly",children:t("admin.repeatYearly")}),e.jsx(N,{value:"days_before",children:t("admin.repeatDaysBefore")})]})]})]}),E("repeat_mode")==="weekly"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"repeat_weekday",className:"text-sm font-medium",children:"æ¯å‘¨é‡å¤æ—¥ / Weekly on"}),e.jsx(K,{name:"repeat_weekday",control:X,render:({field:r})=>e.jsxs(fe,{value:r.value?.toString()||"",onValueChange:w=>r.onChange(w?parseInt(w):null),children:[e.jsx(je,{className:"h-11",children:e.jsx(ve,{placeholder:"é€‰æ‹©æ˜ŸæœŸå‡  / Select day"})}),e.jsxs(we,{children:[e.jsx(N,{value:"1",children:"å‘¨ä¸€ / Monday"}),e.jsx(N,{value:"2",children:"å‘¨äºŒ / Tuesday"}),e.jsx(N,{value:"3",children:"å‘¨ä¸‰ / Wednesday"}),e.jsx(N,{value:"4",children:"å‘¨å›› / Thursday"}),e.jsx(N,{value:"5",children:"å‘¨äº” / Friday"}),e.jsx(N,{value:"6",children:"å‘¨å…­ / Saturday"}),e.jsx(N,{value:"0",children:"å‘¨æ—¥ / Sunday"})]})]})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"é€‰æ‹©æ´»åŠ¨æ¯å‘¨ç”Ÿæ•ˆçš„æ—¥æœŸ / Select which day this activity is valid each week"})]}),E("repeat_mode")==="days_before"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"repeat_days_before",className:"text-sm font-medium",children:t("admin.daysBeforeLabel")}),e.jsx(K,{name:"repeat_days_before",control:X,render:({field:r})=>e.jsx(z,{type:"number",min:1,max:30,className:"h-11",placeholder:t("admin.daysBeforePlaceholder"),value:r.value??"",onChange:w=>r.onChange(w.target.value?parseInt(w.target.value):null)})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("admin.daysBeforeHint")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"service_type",className:"text-sm font-medium",children:t("admin.serviceType")}),e.jsxs(fe,{onValueChange:r=>I("service_type",r),defaultValue:E("service_type"),children:[e.jsx(je,{className:"h-11",children:e.jsx(ve,{placeholder:t("admin.selectServiceType")})}),e.jsxs(we,{children:[e.jsx(N,{value:"dine_in",children:t("activities.serviceType.dine_in")}),e.jsx(N,{value:"takeaway",children:t("activities.serviceType.takeaway")}),e.jsx(N,{value:"both",children:t("activities.serviceType.both")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{className:"text-sm font-medium flex items-center gap-2",children:[E("status")==="draft"?e.jsx(Je,{className:"w-4 h-4 text-yellow-500"}):e.jsx(Ze,{className:"w-4 h-4 text-green-500"}),"æ´»åŠ¨çŠ¶æ€"]}),e.jsxs(fe,{onValueChange:r=>I("status",r),value:$||"draft",children:[e.jsx(je,{className:"h-11",children:e.jsx(ve,{})}),e.jsxs(we,{children:[e.jsx(N,{value:"draft",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4 text-yellow-500"}),"è‰ç¨¿"]})}),e.jsx(N,{value:"published",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"w-4 h-4 text-green-500"}),"å·²å‘å¸ƒ"]})})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:$==="draft"?"è‰ç¨¿çŠ¶æ€ï¼šæ— å¿…å¡«é¡¹ï¼Œä¸æ˜¾ç¤ºåœ¨å‰ç«¯ï¼Œé¤åŽ…ä¸ä¼šæ”¶åˆ°é€šçŸ¥":"å‘å¸ƒæ—¶å°†éªŒè¯å¿…å¡«é¡¹"})]}),e.jsxs("div",{className:xe("flex items-center space-x-3 p-4 border rounded-lg transition-colors h-fit self-end",$==="draft"?"opacity-50 cursor-not-allowed bg-muted/30":"hover:bg-muted/50"),children:[e.jsx(_e,{id:"pinned",checked:Ct,onCheckedChange:r=>I("pinned",r===!0),className:"data-[state=checked]:bg-primary",disabled:$==="draft"}),e.jsxs(j,{htmlFor:"pinned",className:xe("flex items-center gap-2 text-sm font-medium",$==="draft"?"cursor-not-allowed":"cursor-pointer"),children:[e.jsx(os,{className:"w-4 h-4 text-primary"}),t("admin.pinToTop")]})]}),e.jsxs("div",{className:xe("flex items-center space-x-3 p-4 border rounded-lg transition-colors h-fit self-end",$==="draft"?"opacity-50 cursor-not-allowed bg-muted/30":"hover:bg-muted/50"),children:[e.jsx(_e,{id:"visible",checked:Dt,onCheckedChange:r=>I("visible",r===!0),className:"data-[state=checked]:bg-primary",disabled:$==="draft"}),e.jsxs(j,{htmlFor:"visible",className:xe("flex items-center gap-2 text-sm font-medium",$==="draft"?"cursor-not-allowed":"cursor-pointer"),children:[e.jsx($e,{className:"w-4 h-4 text-primary"}),"æ˜¾ç¤ºæ´»åŠ¨",$==="draft"&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"(è‰ç¨¿é»˜è®¤å…³é—­)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"sort_order",className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Qt,{className:"w-4 h-4 text-primary"}),t("admin.sortOrder")]}),e.jsx(z,{id:"sort_order",type:"number",...M("sort_order",{valueAsNumber:!0}),className:"h-11",placeholder:"0"})]})]})]})}),e.jsx(se,{className:"border-primary/20",children:e.jsxs(ae,{className:"p-6",children:[e.jsxs(j,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(W,{className:"w-5 h-5 text-primary"}),"æ˜¾ç¤ºå¾½ç« è®¾ç½®"]}),e.jsxs(Re,{defaultValue:"zh",className:"w-full",children:[e.jsxs(Ae,{className:"grid w-full grid-cols-3 mb-4",children:[e.jsx(B,{value:"zh",children:"ðŸ‡¨ðŸ‡³ ä¸­æ–‡"}),e.jsx(B,{value:"en",children:"ðŸ‡¬ðŸ‡§ English"}),e.jsx(B,{value:"pt",children:"ðŸ‡µðŸ‡¹ PortuguÃªs"})]}),e.jsx(L,{value:"zh",className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"badge_text_zh",className:"text-sm",children:["å¾½ç« æ–‡å­— (ä¸­æ–‡) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(z,{id:"badge_text_zh",...M("badge_text_zh"),placeholder:"ä¾‹å¦‚: ç²‰ä¸èŠ‚"}),S.badge_text_zh&&e.jsx("p",{className:"text-sm text-destructive",children:S.badge_text_zh.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"å¾½ç« æ–‡å­—æ˜¾ç¤ºåœ¨é¤åŽ…è¯¦æƒ…å’Œæ´»åŠ¨åˆ—è¡¨ä¸­ï¼Œå»ºè®®ç®€æ´æ˜Žäº†"})]})}),e.jsx(L,{value:"en",className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"badge_text_en",className:"text-sm",children:["Badge Text (English) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(z,{id:"badge_text_en",...M("badge_text_en"),placeholder:"e.g. Fan Festival"}),S.badge_text_en&&e.jsx("p",{className:"text-sm text-destructive",children:S.badge_text_en.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Badge text shown on restaurant details and activity list, keep it concise"})]})}),e.jsx(L,{value:"pt",className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"badge_text_pt",className:"text-sm",children:["Texto do Distintivo (PortuguÃªs) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(z,{id:"badge_text_pt",...M("badge_text_pt"),placeholder:"ex: Festival dos FÃ£s"}),S.badge_text_pt&&e.jsx("p",{className:"text-sm text-destructive",children:S.badge_text_pt.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Texto do emblema exibido nos detalhes do restaurante e na lista de atividades, mantenha-o conciso"})]})})]}),e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx(j,{htmlFor:"badge_color",className:"text-sm",children:"å¾½ç« é¢œè‰² / Badge Color"}),e.jsx(K,{name:"badge_color",control:X,render:({field:r})=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{id:"badge_color",type:"color",value:r.value||"#9b87f5",onChange:w=>r.onChange(w.target.value),className:"w-20 h-11 cursor-pointer"}),e.jsx(z,{value:r.value||"#9b87f5",onChange:w=>r.onChange(w.target.value),placeholder:"#9b87f5",className:"flex-1"})]})}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"é¢„è§ˆ / Preview:"}),e.jsx(W,{style:{backgroundColor:E("badge_color")||"#9b87f5"},className:"text-white",children:E("badge_text_zh")||E("title_zh")||"ç¤ºä¾‹"})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx(j,{className:"text-sm font-medium flex items-center gap-2 mb-3",children:"ðŸ’° ä¼˜æƒ è®¾ç½® / Discount Settings"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"discount_type",className:"text-sm",children:"æŠ˜æ‰£ç±»åž‹ / Discount Type"}),e.jsx(K,{name:"discount_type",control:X,render:({field:r})=>e.jsxs(fe,{value:r.value||"none",onValueChange:w=>r.onChange(w==="none"?null:w),children:[e.jsx(je,{className:"h-11",children:e.jsx(ve,{placeholder:"é€‰æ‹©æŠ˜æ‰£ç±»åž‹"})}),e.jsxs(we,{children:[e.jsx(N,{value:"none",children:"æ— ä¼˜æƒ  / No Discount"}),e.jsx(N,{value:"percentage",children:"ç™¾åˆ†æ¯”æŠ˜æ‰£ / Percentage"}),e.jsx(N,{value:"fixed_amount",children:"å›ºå®šé‡‘é¢ / Fixed Amount"})]})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"discount_value",className:"text-sm",children:["æŠ˜æ‰£å€¼ / Discount Value",E("discount_type")==="percentage"&&" (%)",E("discount_type")==="fixed_amount"&&" (â‚¬)"]}),e.jsx(z,{id:"discount_value",type:"number",step:"0.01",...M("discount_value",{valueAsNumber:!0}),className:"h-11",placeholder:E("discount_type")==="percentage"?"ä¾‹å¦‚: 20 (è¡¨ç¤º8æŠ˜)":"ä¾‹å¦‚: 5 (è¡¨ç¤ºå‡5â‚¬)",disabled:!E("discount_type")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:E("discount_type")==="percentage"?"è¾“å…¥æŠ˜æ‰£ç™¾åˆ†æ¯”ï¼Œå¦‚ 20 è¡¨ç¤ºæ‰“8æŠ˜ï¼ˆå‡20%ï¼‰":E("discount_type")==="fixed_amount"?"è¾“å…¥å›ºå®šå‡å…é‡‘é¢ï¼ˆæ¬§å…ƒï¼‰":"å…ˆé€‰æ‹©æŠ˜æ‰£ç±»åž‹"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"discount_key",className:"text-sm",children:"æŠ˜æ‰£æ ‡è¯† / Discount Key"}),e.jsx(z,{id:"discount_key",type:"text",...M("discount_key"),className:"h-11",placeholder:"ä¾‹å¦‚: SUMMER2025, VIP_DISCOUNT",disabled:!E("discount_type")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ç”¨äºŽå¤–éƒ¨ç³»ç»Ÿè¯†åˆ«çš„æŠ˜æ‰£æ ‡è¯†ç¬¦"})]})]})]})]})}),e.jsx(se,{className:"border-primary/20",children:e.jsxs(ae,{className:"p-6",children:[e.jsxs(j,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(Pt,{className:"w-5 h-5 text-primary"}),t("admin.associatedRestaurants")]}),e.jsx(rt,{className:"h-64 border rounded-lg p-4 bg-muted/20",children:e.jsx("div",{className:"space-y-2",children:ye?.map(r=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-md hover:bg-background transition-colors border border-transparent hover:border-primary/30",children:[e.jsx(_e,{id:r.id,checked:m.includes(r.id),onCheckedChange:w=>{x(w?[...m,r.id]:m.filter(O=>O!==r.id))},className:"data-[state=checked]:bg-primary"}),e.jsx(j,{htmlFor:r.id,className:"cursor-pointer flex-1 font-normal",children:r.name}),m.includes(r.id)&&e.jsx(W,{variant:"secondary",className:"text-xs",children:"å·²é€‰"})]},r.id))})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["å·²é€‰æ‹© ",m.length," ä¸ªé¤åŽ…"]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t sticky bottom-0 bg-background pb-[16px]",children:[e.jsx(C,{type:"button",variant:"outline",onClick:()=>i(!1),className:"min-w-[100px]",children:t("common.cancel")}),e.jsx(C,{type:"submit",disabled:g,className:"min-w-[100px] bg-primary hover:bg-primary/90",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),t("common.saving")]}):t("common.save")})]})]})}),R&&e.jsx(js,{open:b,onOpenChange:k,imageFile:R,onCropComplete:kt})]})]})}const bs=({children:a})=>{const{t:s}=be(),{data:t,isLoading:o}=Gt(),n=Zt(),[i,c]=f.useState(!1),[p,d]=f.useState("zh"),[l,m]=f.useState(""),[x,g]=f.useState(""),[h,b]=f.useState("");f.useEffect(()=>{t&&(m(t.content_zh),g(t.content_en),b(t.content_pt))},[t]);const k=async()=>{if(t)try{await n.mutateAsync({id:t.id,content_zh:l,content_en:x,content_pt:h}),Se({title:s("common.success"),description:"æ´»åŠ¨æ¡ä¾‹å·²æ›´æ–°"}),c(!1)}catch{Se({title:s("common.error"),description:"æ›´æ–°å¤±è´¥",variant:"destructive"})}};return e.jsxs(Me,{open:i,onOpenChange:c,children:[e.jsx(st,{asChild:!0,children:a}),e.jsxs(Fe,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ie,{children:e.jsxs(Be,{className:"flex items-center gap-2",children:[e.jsx(wt,{className:"w-5 h-5"}),"ç¼–è¾‘æ´»åŠ¨æ¡ä¾‹"]})}),o?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(ke,{className:"w-6 h-6 animate-spin text-primary"})}):e.jsx("div",{className:"space-y-4",children:e.jsxs(Re,{value:p,onValueChange:d,children:[e.jsxs(Ae,{className:"grid w-full grid-cols-3",children:[e.jsx(B,{value:"zh",children:"ä¸­æ–‡"}),e.jsx(B,{value:"en",children:"English"}),e.jsx(B,{value:"pt",children:"PortuguÃªs"})]}),e.jsx(L,{value:"zh",className:"mt-4",children:e.jsx(H,{value:l,onChange:m,placeholder:"è¯·è¾“å…¥ä¸­æ–‡æ´»åŠ¨æ¡ä¾‹å†…å®¹..."})}),e.jsx(L,{value:"en",className:"mt-4",children:e.jsx(H,{value:x,onChange:g,placeholder:"Enter English activity rules..."})}),e.jsx(L,{value:"pt",className:"mt-4",children:e.jsx(H,{value:h,onChange:b,placeholder:"Digite as regras da atividade em portuguÃªs..."})})]})}),e.jsxs(tt,{children:[e.jsx(C,{variant:"outline",onClick:()=>c(!1),children:s("common.cancel")}),e.jsxs(C,{onClick:k,disabled:n.isPending,children:[n.isPending?e.jsx(ke,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(_t,{className:"w-4 h-4 mr-2"}),s("common.save")]})]})]})]})},ys=({children:a})=>{const{t:s}=be(),{data:t,isLoading:o}=Jt(),n=es(),[i,c]=f.useState(!1),[p,d]=f.useState("zh"),[l,m]=f.useState(""),[x,g]=f.useState(""),[h,b]=f.useState("");f.useEffect(()=>{t&&(m(t.content_zh),g(t.content_en),b(t.content_pt))},[t]);const k=async()=>{if(t)try{await n.mutateAsync({id:t.id,content_zh:l,content_en:x,content_pt:h}),Se({title:s("common.success"),description:s("activities.handbook.updateSuccess")}),c(!1)}catch{Se({title:s("common.error"),description:s("activities.handbook.updateError"),variant:"destructive"})}};return e.jsxs(Me,{open:i,onOpenChange:c,children:[e.jsx(st,{asChild:!0,children:a}),e.jsxs(Fe,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ie,{children:e.jsxs(Be,{className:"flex items-center gap-2",children:[e.jsx(bt,{className:"w-5 h-5"}),s("admin.editActivityHandbook")]})}),o?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(ke,{className:"w-6 h-6 animate-spin text-primary"})}):e.jsx("div",{className:"space-y-4",children:e.jsxs(Re,{value:p,onValueChange:d,children:[e.jsxs(Ae,{className:"grid w-full grid-cols-3",children:[e.jsx(B,{value:"zh",children:"ä¸­æ–‡"}),e.jsx(B,{value:"en",children:"English"}),e.jsx(B,{value:"pt",children:"PortuguÃªs"})]}),e.jsx(L,{value:"zh",className:"mt-4",children:e.jsx(H,{value:l,onChange:m,placeholder:"è¯·è¾“å…¥ä¸­æ–‡æ´»åŠ¨æ‰‹å†Œå†…å®¹..."})}),e.jsx(L,{value:"en",className:"mt-4",children:e.jsx(H,{value:x,onChange:g,placeholder:"Enter English activity handbook content..."})}),e.jsx(L,{value:"pt",className:"mt-4",children:e.jsx(H,{value:h,onChange:b,placeholder:"Digite o conteÃºdo do manual da atividade em portuguÃªs..."})})]})}),e.jsxs(tt,{children:[e.jsx(C,{variant:"outline",onClick:()=>c(!1),children:s("common.cancel")}),e.jsxs(C,{onClick:k,disabled:n.isPending,children:[n.isPending?e.jsx(ke,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(_t,{className:"w-4 h-4 mr-2"}),s("common.save")]})]})]})]})},ca=()=>{const{t:a}=be(),{toast:s}=Tt(),{data:t,isLoading:o}=Lt(),{getLocalizedField:n}=Ht(),i=$t(),c=Ot(),[p,d]=f.useState([]),[l,m]=f.useState(""),[x,g]=f.useState("all"),[h,b]=f.useState({}),[k,R]=f.useState(""),v=f.useMemo(()=>t?t.filter(u=>{const T=String(n(u,"title")||""),G=String(n(u,"content")||""),Y=l===""||T.toLowerCase().includes(l.toLowerCase())||G.toLowerCase().includes(l.toLowerCase()),re=new Date,ce=new Date(u.start_date),ye=u.end_date?new Date(u.end_date):null,M=ye?ye<re:!1,Le=!M&&ce<=re,S=u.status||"published",I=x==="all"||x==="active"&&Le||x==="ended"&&M||x==="pinned"&&u.pinned||x==="draft"&&S==="draft"||x==="published"&&S==="published";return Y&&I}):[],[t,l,x,n]),A=()=>{if(!t||t.length===0){s({title:a("common.error"),description:a("admin.noDataToExport"),variant:"destructive"});return}ts(t),s({title:a("common.success"),description:a("admin.exportSuccess")})},P=u=>{d(T=>T.includes(u)?T.filter(G=>G!==u):[...T,u])},V=()=>{p.length===v?.length?d([]):d(v?.map(u=>u.id)||[])},Q=()=>{p.length!==0&&(c.mutate(p),d([]))};return o?e.jsx("div",{className:"text-center",children:a("common.loading")}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:a("admin.activityManagement")}),e.jsx("p",{className:"text-muted-foreground",children:a("admin.manageActivities")})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(ys,{children:e.jsxs(C,{variant:"outline",className:"flex-1 sm:flex-initial",children:[e.jsx(bt,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:a("admin.activityHandbook")})]})}),e.jsx(bs,{children:e.jsxs(C,{variant:"outline",className:"flex-1 sm:flex-initial",children:[e.jsx(wt,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:a("admin.activityRules")})]})}),e.jsxs(C,{variant:"outline",onClick:A,className:"flex-1 sm:flex-initial",children:[e.jsx(ss,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:a("admin.exportCSV")})]}),e.jsx(ft,{trigger:e.jsxs(C,{className:"flex-1 sm:flex-initial",children:[e.jsx(as,{className:"mr-2 h-4 w-4"}),a("admin.addActivity")]})})]})]}),e.jsx(se,{children:e.jsx(ae,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(ns,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:a("admin.searchActivities"),value:l,onChange:u=>m(u.target.value),className:"pl-9"})]})}),e.jsxs(fe,{value:x,onValueChange:g,children:[e.jsx(je,{className:"w-[180px]",children:e.jsx(ve,{placeholder:a("admin.filterByStatus")})}),e.jsxs(we,{children:[e.jsx(N,{value:"all",children:a("admin.allStatus")}),e.jsx(N,{value:"draft",children:a("admin.statusDraft")}),e.jsx(N,{value:"published",children:a("admin.statusPublished")}),e.jsx(N,{value:"active",children:a("admin.statusActive")}),e.jsx(N,{value:"ended",children:a("admin.statusEnded")}),e.jsx(N,{value:"pinned",children:a("admin.statusPinned")})]})]})]})})}),p.length>0&&e.jsx(se,{className:"bg-muted/50",children:e.jsx(ae,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsx("span",{className:"font-medium",children:a("admin.selectedCount",{count:p.length})}),e.jsxs("div",{className:"flex gap-2 flex-wrap w-full sm:w-auto",children:[e.jsxs(Ue,{children:[e.jsx(Ve,{asChild:!0,children:e.jsxs(C,{variant:"destructive",size:"sm",className:"flex-1 sm:flex-initial",children:[e.jsx(Mt,{className:"mr-2 h-4 w-4"}),a("admin.batchDelete")]})}),e.jsxs(Ye,{className:"max-w-[90vw] sm:max-w-[425px]",children:[e.jsxs(Xe,{children:[e.jsx(Ke,{children:a("admin.confirmBatchDelete")}),e.jsxs(qe,{className:"space-y-3",children:[e.jsx("p",{children:a("admin.batchDeleteWarning",{count:p.length})}),e.jsx("p",{className:"font-semibold text-destructive",children:a("admin.willDeleteActivities",{count:p.length})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm",children:a("admin.typeDeleteToConfirmBatch")}),e.jsx(z,{value:k,onChange:u=>R(u.target.value),placeholder:"DELETE",className:"font-mono"})]})]})]}),e.jsxs(We,{children:[e.jsx(Qe,{onClick:()=>R(""),children:a("common.cancel")}),e.jsx(Ge,{disabled:k!=="DELETE",onClick:()=>{Q(),R("")},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:a("common.delete")})]})]})]}),e.jsx(C,{variant:"outline",size:"sm",onClick:()=>d([]),className:"flex-1 sm:flex-initial",children:a("admin.clearSelection")})]})]})})}),e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[e.jsx(_e,{checked:p.length===v?.length&&v.length>0,onCheckedChange:V}),e.jsx("span",{className:"font-medium",children:a("admin.selectAll")}),e.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:["(",v?.length," ",a("admin.results"),")"]})]}),e.jsx("div",{className:"grid gap-4",children:v?.map(u=>e.jsx(se,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center",children:[e.jsx("div",{className:"p-4 flex items-start md:self-start",children:e.jsx(_e,{checked:p.includes(u.id),onCheckedChange:()=>P(u.id),className:"mt-1"})}),u.image_url&&e.jsx("div",{className:"w-full md:w-48 h-48 flex items-center justify-center overflow-hidden mx-auto md:mx-0 flex-shrink-0",children:e.jsx("img",{src:u.image_url,alt:String(n(u,"title")),className:"object-cover w-full h-full"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs(Ft,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsx(It,{className:"text-lg md:text-xl",children:n(u,"title")}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[u.status==="draft"?e.jsxs(W,{variant:"outline",className:"bg-yellow-500/10 text-yellow-600 border-yellow-500/30",children:[e.jsx(Je,{className:"w-3 h-3 mr-1"}),"è‰ç¨¿"]}):e.jsxs(W,{variant:"outline",className:"bg-green-500/10 text-green-600 border-green-500/30",children:[e.jsx(Ze,{className:"w-3 h-3 mr-1"}),"å·²å‘å¸ƒ"]}),!u.visible&&e.jsx(W,{variant:"secondary",children:a("admin.hidden")}),u.pinned&&e.jsx(W,{children:a("activities.pinned")}),(()=>{const T=new Date,G=new Date(u.start_date),Y=u.end_date?new Date(u.end_date):null,re=Y?Y<T:!1,ce=!re&&G<=T;return re?e.jsx(W,{variant:"secondary",children:a("activities.ended")}):ce?e.jsx(W,{children:a("activities.ongoing")}):null})()]})]}),e.jsx(Bt,{className:"line-clamp-2",children:e.jsx("div",{className:`prose prose-sm max-w-none\r
                          [&_p]:inline [&_p]:m-0\r
                          [&_strong]:font-semibold [&_strong]:text-foreground\r
                          [&_em]:italic\r
                          [&_h1]:text-base [&_h2]:text-base [&_h3]:text-base\r
                          [&_*]:text-muted-foreground`,dangerouslySetInnerHTML:{__html:n(u,"content")}})})]}),e.jsxs(ae,{children:[e.jsx("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-4 overflow-x-auto",children:e.jsxs("div",{className:"flex items-center gap-1 whitespace-nowrap",children:[e.jsx(De,{className:"h-4 w-4 flex-shrink-0"}),e.jsxs("span",{className:"text-xs sm:text-sm",children:[Pe(new Date(u.start_date),"PPP"),u.end_date&&` - ${Pe(new Date(u.end_date),"PPP")}`]})]})}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[u.status!=="draft"&&e.jsx(C,{variant:"outline",size:"sm",asChild:!0,className:"flex-1 sm:flex-initial",children:e.jsxs(it,{to:`/admin/activity-stats/${u.id}`,children:[e.jsx(is,{className:"w-4 h-4 mr-1"}),a("admin.stats","ç»Ÿè®¡")]})}),e.jsx(C,{variant:"outline",size:"sm",asChild:!0,className:"flex-1 sm:flex-initial",children:e.jsx(it,{to:`/activity/${u.id}`,state:{from:"admin"},children:a("admin.view")})}),e.jsx(ft,{activity:u,trigger:e.jsx(C,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:a("common.edit")})}),u.status==="draft"?e.jsxs(Ue,{children:[e.jsx(Ve,{asChild:!0,children:e.jsx(C,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:a("common.delete")})}),e.jsxs(Ye,{className:"max-w-[90vw] sm:max-w-[425px]",children:[e.jsxs(Xe,{children:[e.jsx(Ke,{children:a("admin.confirmDelete")}),e.jsxs(qe,{children:[e.jsx("p",{children:a("admin.deleteActivityWarning")}),e.jsx("p",{className:"font-semibold text-foreground mt-2",children:n(u,"title")})]})]}),e.jsxs(We,{children:[e.jsx(Qe,{children:a("common.cancel")}),e.jsx(Ge,{onClick:()=>i.mutate(u.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:a("common.delete")})]})]})]}):e.jsxs(Ue,{children:[e.jsx(Ve,{asChild:!0,children:e.jsx(C,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:a("common.delete")})}),e.jsxs(Ye,{className:"max-w-[90vw] sm:max-w-[425px]",children:[e.jsxs(Xe,{children:[e.jsx(Ke,{children:a("admin.confirmDelete")}),e.jsxs(qe,{className:"space-y-3",children:[e.jsx("p",{children:a("admin.deleteActivityWarning")}),e.jsx("p",{className:"font-semibold text-foreground",children:n(u,"title")}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm",children:a("admin.typeDeleteToConfirmBatch")}),e.jsx(z,{value:h[u.id]||"",onChange:T=>b({...h,[u.id]:T.target.value}),placeholder:"DELETE",className:"font-mono"})]})]})]}),e.jsxs(We,{children:[e.jsx(Qe,{onClick:()=>b({...h,[u.id]:""}),children:a("common.cancel")}),e.jsx(Ge,{disabled:h[u.id]!=="DELETE",onClick:()=>{i.mutate(u.id),b({...h,[u.id]:""})},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:a("common.delete")})]})]})]})]})]})]})]})},u.id))})]})};export{ca as default};
//# sourceMappingURL=AdminActivities-Cvtep5sc.js.map
