{"version":3,"file":"PullToRefresh-eghfMZXi.js","sources":["../../src/hooks/usePullToRefresh.ts","../../src/components/PullToRefresh.tsx"],"sourcesContent":["import { useState, useRef, useCallback, useEffect } from 'react';\r\n\r\ninterface UsePullToRefreshOptions {\r\n  onRefresh: () => Promise<void>;\r\n  threshold?: number;\r\n  maxPull?: number;\r\n}\r\n\r\nexport function usePullToRefresh({\r\n  onRefresh,\r\n  threshold = 80,\r\n  maxPull = 120\r\n}: UsePullToRefreshOptions) {\r\n  const [isPulling, setIsPulling] = useState(false);\r\n  const [isRefreshing, setIsRefreshing] = useState(false);\r\n  const [pullDistance, setPullDistance] = useState(0);\r\n  \r\n  const startY = useRef(0);\r\n  const currentY = useRef(0);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n  const handleTouchStart = useCallback((e: TouchEvent) => {\r\n    const container = containerRef.current;\r\n    \r\n    // Check multiple scroll sources for WebView compatibility\r\n    const windowScroll = window.scrollY || window.pageYOffset || 0;\r\n    const documentScroll = document.documentElement.scrollTop || 0;\r\n    const bodyScroll = document.body.scrollTop || 0;\r\n    const containerScroll = container?.scrollTop || 0;\r\n    \r\n    // Use the maximum of all scroll positions\r\n    const scrollTop = Math.max(windowScroll, documentScroll, bodyScroll, containerScroll);\r\n    \r\n    // Allow pull-to-refresh only when at the very top (reduced threshold for better detection)\r\n    if (scrollTop > 5) return;\r\n    \r\n    startY.current = e.touches[0].clientY;\r\n    setIsPulling(true);\r\n  }, []);\r\n\r\n  const handleTouchMove = useCallback((e: TouchEvent) => {\r\n    if (!isPulling || isRefreshing) return;\r\n    \r\n    currentY.current = e.touches[0].clientY;\r\n    const diff = currentY.current - startY.current;\r\n    \r\n    // Only pull down, not up\r\n    if (diff < 0) {\r\n      setPullDistance(0);\r\n      return;\r\n    }\r\n\r\n    // More aggressive preventDefault for iOS WebViews\r\n    // This prevents the browser's native pull-to-refresh and overscroll\r\n    if (diff > 5) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n    \r\n    // Apply resistance for a more natural feel\r\n    const resistance = 0.6;\r\n    const distance = Math.min(diff * resistance, maxPull);\r\n    setPullDistance(distance);\r\n  }, [isPulling, isRefreshing, maxPull]);\r\n\r\n  const handleTouchEnd = useCallback(async () => {\r\n    if (!isPulling) return;\r\n    \r\n    setIsPulling(false);\r\n    \r\n    if (pullDistance >= threshold && !isRefreshing) {\r\n      setIsRefreshing(true);\r\n      setPullDistance(threshold); // Keep at threshold during refresh\r\n      \r\n      try {\r\n        await onRefresh();\r\n      } finally {\r\n        setIsRefreshing(false);\r\n        setPullDistance(0);\r\n      }\r\n    } else {\r\n      setPullDistance(0);\r\n    }\r\n  }, [isPulling, pullDistance, threshold, isRefreshing, onRefresh]);\r\n\r\n  const handleTouchCancel = useCallback(() => {\r\n    setIsPulling(false);\r\n    setPullDistance(0);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const container = containerRef.current;\r\n    if (!container) return;\r\n\r\n    // Use passive: false to allow preventDefault for all touch events\r\n    const options = { passive: false };\r\n    \r\n    container.addEventListener('touchstart', handleTouchStart, options);\r\n    container.addEventListener('touchmove', handleTouchMove, options);\r\n    container.addEventListener('touchend', handleTouchEnd, { passive: true });\r\n    container.addEventListener('touchcancel', handleTouchCancel, { passive: true });\r\n\r\n    return () => {\r\n      container.removeEventListener('touchstart', handleTouchStart);\r\n      container.removeEventListener('touchmove', handleTouchMove);\r\n      container.removeEventListener('touchend', handleTouchEnd);\r\n      container.removeEventListener('touchcancel', handleTouchCancel);\r\n    };\r\n  }, [handleTouchStart, handleTouchMove, handleTouchEnd, handleTouchCancel]);\r\n\r\n  const progress = Math.min(pullDistance / threshold, 1);\r\n\r\n  return {\r\n    containerRef,\r\n    isPulling,\r\n    isRefreshing,\r\n    pullDistance,\r\n    progress\r\n  };\r\n}\r\n","import { ReactNode, CSSProperties } from 'react';\r\nimport { RefreshCw } from 'lucide-react';\r\nimport { usePullToRefresh } from '@/hooks/usePullToRefresh';\r\nimport { cn } from '@/lib/utils';\r\n\r\ninterface PullToRefreshProps {\r\n  children: ReactNode;\r\n  onRefresh: () => Promise<void>;\r\n  className?: string;\r\n}\r\n\r\nexport function PullToRefresh({ children, onRefresh, className }: PullToRefreshProps) {\r\n  const { containerRef, isRefreshing, pullDistance, progress } = usePullToRefresh({\r\n    onRefresh,\r\n    threshold: 80,\r\n    maxPull: 120\r\n  });\r\n\r\n  // Styles to prevent iOS overscroll conflicts\r\n  const containerStyle: CSSProperties = {\r\n    overscrollBehavior: 'none',\r\n    WebkitOverflowScrolling: 'touch',\r\n  };\r\n\r\n  return (\r\n    <div \r\n      ref={containerRef} \r\n      className={cn(\"relative\", className)}\r\n      style={containerStyle}\r\n    >\r\n      {/* Pull indicator */}\r\n      <div \r\n        className=\"absolute left-1/2 -translate-x-1/2 z-50 flex items-center justify-center transition-opacity duration-200 pointer-events-none\"\r\n        style={{ \r\n          top: Math.max(pullDistance - 50, 8),\r\n          opacity: pullDistance > 20 ? 1 : 0\r\n        }}\r\n      >\r\n        <div className={cn(\r\n          \"w-10 h-10 rounded-full bg-background/90 backdrop-blur-sm shadow-lg flex items-center justify-center border border-border/50\",\r\n          isRefreshing && \"animate-pulse\"\r\n        )}>\r\n          <RefreshCw \r\n            className={cn(\r\n              \"w-5 h-5 text-primary transition-transform duration-200\",\r\n              isRefreshing && \"animate-spin\"\r\n            )}\r\n            style={{ \r\n              transform: isRefreshing \r\n                ? undefined \r\n                : `rotate(${progress * 360}deg)` \r\n            }}\r\n          />\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Content with pull transform */}\r\n      <div \r\n        style={{ \r\n          transform: pullDistance > 0 ? `translateY(${pullDistance}px)` : undefined,\r\n          transition: pullDistance === 0 ? 'transform 0.3s ease-out' : undefined\r\n        }}\r\n      >\r\n        {children}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["usePullToRefresh","onRefresh","threshold","maxPull","isPulling","setIsPulling","useState","isRefreshing","setIsRefreshing","pullDistance","setPullDistance","startY","useRef","currentY","containerRef","handleTouchStart","useCallback","container","windowScroll","documentScroll","bodyScroll","containerScroll","handleTouchMove","diff","distance","handleTouchEnd","handleTouchCancel","useEffect","options","progress","PullToRefresh","children","className","containerStyle","jsxs","cn","jsx","RefreshCw"],"mappings":"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"}