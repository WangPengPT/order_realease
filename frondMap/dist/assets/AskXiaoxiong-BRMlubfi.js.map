{"version":3,"file":"AskXiaoxiong-BRMlubfi.js","sources":["../../src/pages/AskXiaoxiong.tsx"],"sourcesContent":["import { useEffect, useLayoutEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { useXiaoxiongChat, Provider } from \"@/hooks/useXiaoxiongChat\";\r\nimport XiaoxiongChatContent from \"@/components/XiaoxiongChatContent\";\r\nimport { useSiteSettings } from \"@/hooks/useSiteSettings\";\r\n\r\nconst AskXiaoxiong = () => {\r\n  const navigate = useNavigate();\r\n  const { settings } = useSiteSettings();\r\n  \r\n  // Use provider from site settings, fallback to xiaoxiong-community\r\n  const provider = (settings?.ai_provider || \"xiaoxiong-community\") as Provider;\r\n  \r\n  const {\r\n    input,\r\n    setInput,\r\n    messages,\r\n    isLoading,\r\n    showLocationDialog,\r\n    setShowLocationDialog,\r\n    pendingMessage,\r\n    setPendingMessage,\r\n    handleSubmit,\r\n    handleKeyDown,\r\n    handleLocationConfirm,\r\n    processMessage,\r\n    abortRequest,\r\n    requestLocation,\r\n  } = useXiaoxiongChat(provider);\r\n\r\n  // Force scroll to top on mount - critical for iOS embedded browsers\r\n  useLayoutEffect(() => {\r\n    // Immediately scroll window to top\r\n    window.scrollTo(0, 0);\r\n    document.documentElement.scrollTop = 0;\r\n    document.body.scrollTop = 0;\r\n    \r\n    // Also try after a small delay for iOS WebViews\r\n    const timer = setTimeout(() => {\r\n      window.scrollTo(0, 0);\r\n      document.documentElement.scrollTop = 0;\r\n      document.body.scrollTop = 0;\r\n    }, 50);\r\n    \r\n    return () => clearTimeout(timer);\r\n  }, []);\r\n\r\n  // Request location on mount\r\n  useEffect(() => {\r\n    requestLocation();\r\n  }, [requestLocation]);\r\n\r\n  // Cleanup on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      abortRequest();\r\n    };\r\n  }, [abortRequest]);\r\n\r\n  const handleClose = () => {\r\n    abortRequest();\r\n    navigate(\"/\");\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {/* Full screen overlay to cover everything including footer */}\r\n      <div className=\"fixed inset-0 z-[9999] bg-background\" />\r\n      \r\n      {/* Main chat container */}\r\n      <div \r\n        className=\"fixed inset-0 z-[10000] bg-background flex flex-col overflow-hidden\"\r\n        style={{\r\n          height: '100%',\r\n          minHeight: '-webkit-fill-available',\r\n        }}\r\n      >\r\n        <XiaoxiongChatContent\r\n          messages={messages}\r\n          input={input}\r\n          setInput={setInput}\r\n          isLoading={isLoading}\r\n          showLocationDialog={showLocationDialog}\r\n          setShowLocationDialog={setShowLocationDialog}\r\n          pendingMessage={pendingMessage}\r\n          handleSubmit={handleSubmit}\r\n          handleKeyDown={handleKeyDown}\r\n          handleLocationConfirm={handleLocationConfirm}\r\n          processMessage={processMessage}\r\n          setPendingMessage={setPendingMessage}\r\n          onClose={handleClose}\r\n          showBackButton={true}\r\n          className=\"flex-1 min-h-0 overflow-hidden\"\r\n        />\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default AskXiaoxiong;\r\n"],"names":["AskXiaoxiong","navigate","useNavigate","settings","useSiteSettings","provider","input","setInput","messages","isLoading","showLocationDialog","setShowLocationDialog","pendingMessage","setPendingMessage","handleSubmit","handleKeyDown","handleLocationConfirm","processMessage","abortRequest","requestLocation","useXiaoxiongChat","useLayoutEffect","timer","useEffect","handleClose","jsxs","Fragment","jsx","XiaoxiongChatContent"],"mappings":"iZAMA,MAAMA,EAAe,IAAM,CACzB,MAAMC,EAAWC,IACX,CAAE,SAAAC,GAAaC,IAGfC,EAAYF,GAAU,aAAe,sBAErC,CACJ,MAAAG,EACA,SAAAC,EACA,SAAAC,EACA,UAAAC,EACA,mBAAAC,EACA,sBAAAC,EACA,eAAAC,EACA,kBAAAC,EACA,aAAAC,EACA,cAAAC,EACA,sBAAAC,EACA,eAAAC,EACA,aAAAC,EACA,gBAAAC,CAAA,EACEC,EAAiBf,CAAQ,EAG7BgB,EAAAA,gBAAgB,IAAM,CAEb,OAAA,SAAS,EAAG,CAAC,EACpB,SAAS,gBAAgB,UAAY,EACrC,SAAS,KAAK,UAAY,EAGpB,MAAAC,EAAQ,WAAW,IAAM,CACtB,OAAA,SAAS,EAAG,CAAC,EACpB,SAAS,gBAAgB,UAAY,EACrC,SAAS,KAAK,UAAY,GACzB,EAAE,EAEE,MAAA,IAAM,aAAaA,CAAK,CACjC,EAAG,CAAE,CAAA,EAGLC,EAAAA,UAAU,IAAM,CACEJ,GAAA,EACf,CAACA,CAAe,CAAC,EAGpBI,EAAAA,UAAU,IACD,IAAM,CACEL,GAAA,EAEd,CAACA,CAAY,CAAC,EAEjB,MAAMM,EAAc,IAAM,CACXN,IACbjB,EAAS,GAAG,CAAA,EAGd,OAGIwB,EAAA,KAAAC,WAAA,CAAA,SAAA,CAACC,EAAAA,IAAA,MAAA,CAAI,UAAU,sCAAuC,CAAA,EAGtDA,EAAA,IAAC,MAAA,CACC,UAAU,sEACV,MAAO,CACL,OAAQ,OACR,UAAW,wBACb,EAEA,SAAAA,EAAA,IAACC,EAAA,CACC,SAAApB,EACA,MAAAF,EACA,SAAAC,EACA,UAAAE,EACA,mBAAAC,EACA,sBAAAC,EACA,eAAAC,EACA,aAAAE,EACA,cAAAC,EACA,sBAAAC,EACA,eAAAC,EACA,kBAAAJ,EACA,QAASW,EACT,eAAgB,GAChB,UAAU,gCAAA,CACZ,CAAA,CACF,CACF,CAAA,CAAA,CAEJ"}