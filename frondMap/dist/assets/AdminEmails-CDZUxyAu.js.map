{"version":3,"file":"AdminEmails-CDZUxyAu.js","sources":["../../src/pages/admin/AdminEmails.tsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Plus, Edit, Trash2, Send, Mail, Users, User, FileEdit, Check, Loader2, Eye, Megaphone, Shield, Sparkles, Copy } from \"lucide-react\";\r\nimport { format } from \"date-fns\";\r\nimport { RichTextEditor } from \"@/components/admin/RichTextEditor\";\r\n\r\nconst TEMPLATE_TYPES = [\r\n  { value: \"activity_promotion\", labelKey: \"admin.activityPromotion\", icon: Megaphone },\r\n  { value: \"security_alert\", labelKey: \"admin.securityAlert\", icon: Shield },\r\n  { value: \"custom\", labelKey: \"admin.customTemplate\", icon: Sparkles }\r\n];\r\n\r\ninterface EmailTemplate {\r\n  id: string;\r\n  name: string;\r\n  subject_zh: string;\r\n  subject_en: string;\r\n  subject_pt: string;\r\n  content_zh: string;\r\n  content_en: string;\r\n  content_pt: string;\r\n  template_type: string;\r\n  status: string;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\ninterface EmailSendRecord {\r\n  id: string;\r\n  template_id: string | null;\r\n  subject: string;\r\n  content: string;\r\n  target_type: string;\r\n  target_role: string | null;\r\n  target_user_ids: string[] | null;\r\n  sent_count: number;\r\n  success_count: number;\r\n  failed_count: number;\r\n  sent_at: string;\r\n}\r\n\r\nexport default function AdminEmails() {\r\n  const { t, i18n } = useTranslation();\r\n  const { user } = useAuth();\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  const [isTemplateDialogOpen, setIsTemplateDialogOpen] = useState(false);\r\n  const [isSendDialogOpen, setIsSendDialogOpen] = useState(false);\r\n  const [isPreviewDialogOpen, setIsPreviewDialogOpen] = useState(false);\r\n  const [editingTemplate, setEditingTemplate] = useState<EmailTemplate | null>(null);\r\n  const [selectedTemplate, setSelectedTemplate] = useState<EmailTemplate | null>(null);\r\n  const [activeTab, setActiveTab] = useState(\"templates\");\r\n\r\n  // Form state - simplified to single language\r\n  const [formData, setFormData] = useState({\r\n    name: \"\",\r\n    subject: \"\",\r\n    content: \"\",\r\n    template_type: \"custom\",\r\n    status: \"draft\"\r\n  });\r\n\r\n  // Send form state\r\n  const [sendData, setSendData] = useState({\r\n    targetType: \"all\" as \"all\" | \"role\" | \"specific\",\r\n    targetRole: \"\" as string,\r\n    targetUserIds: [] as string[],\r\n    userSearch: \"\"\r\n  });\r\n\r\n  // Fetch templates\r\n  const { data: templates = [], isLoading: templatesLoading } = useQuery({\r\n    queryKey: [\"email-templates\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"email_templates\")\r\n        .select(\"*\")\r\n        .order(\"created_at\", { ascending: false });\r\n      if (error) throw error;\r\n      return data as EmailTemplate[];\r\n    }\r\n  });\r\n\r\n  // Fetch send records\r\n  const { data: sendRecords = [], isLoading: recordsLoading } = useQuery({\r\n    queryKey: [\"email-send-records\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"email_send_records\")\r\n        .select(\"*\")\r\n        .order(\"sent_at\", { ascending: false });\r\n      if (error) throw error;\r\n      return data as EmailSendRecord[];\r\n    }\r\n  });\r\n\r\n  // Fetch users for specific targeting\r\n  const { data: users = [] } = useQuery({\r\n    queryKey: [\"all-users-for-email\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"id, display_name\")\r\n        .order(\"display_name\");\r\n      if (error) throw error;\r\n      return data;\r\n    }\r\n  });\r\n\r\n  // Create/Update template mutation\r\n  const templateMutation = useMutation({\r\n    mutationFn: async (data: typeof formData & { id?: string }) => {\r\n      // Save single content to all language fields\r\n      const templateData = {\r\n        name: data.name,\r\n        subject_zh: data.subject,\r\n        subject_en: data.subject,\r\n        subject_pt: data.subject,\r\n        content_zh: data.content,\r\n        content_en: data.content,\r\n        content_pt: data.content,\r\n        template_type: data.template_type,\r\n        status: data.status\r\n      };\r\n      \r\n      if (data.id) {\r\n        const { error } = await supabase\r\n          .from(\"email_templates\")\r\n          .update(templateData)\r\n          .eq(\"id\", data.id);\r\n        if (error) throw error;\r\n      } else {\r\n        const { error } = await supabase\r\n          .from(\"email_templates\")\r\n          .insert({\r\n            ...templateData,\r\n            created_by: user?.id\r\n          });\r\n        if (error) throw error;\r\n      }\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"email-templates\"] });\r\n      setIsTemplateDialogOpen(false);\r\n      resetForm();\r\n      toast({ title: t(\"common.success\"), description: editingTemplate ? t(\"common.updated\") : t(\"common.created\") });\r\n    },\r\n    onError: (error) => {\r\n      toast({ title: t(\"common.error\"), description: error.message, variant: \"destructive\" });\r\n    }\r\n  });\r\n\r\n  // Delete template mutation\r\n  const deleteMutation = useMutation({\r\n    mutationFn: async (id: string) => {\r\n      const { error } = await supabase\r\n        .from(\"email_templates\")\r\n        .delete()\r\n        .eq(\"id\", id);\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"email-templates\"] });\r\n      toast({ title: t(\"common.success\"), description: t(\"common.deleted\") });\r\n    }\r\n  });\r\n\r\n  // Send email mutation\r\n  const sendMutation = useMutation({\r\n    mutationFn: async () => {\r\n      if (!selectedTemplate) throw new Error(\"No template selected\");\r\n\r\n      // Call edge function to send emails\r\n      const { data, error } = await supabase.functions.invoke(\"send-bulk-email\", {\r\n        body: {\r\n          templateId: selectedTemplate.id,\r\n          targetType: sendData.targetType,\r\n          targetRole: sendData.targetType === \"role\" ? sendData.targetRole : null,\r\n          targetUserIds: sendData.targetType === \"specific\" ? sendData.targetUserIds : null\r\n        }\r\n      });\r\n\r\n      if (error) throw error;\r\n      return data;\r\n    },\r\n    onSuccess: (data) => {\r\n      queryClient.invalidateQueries({ queryKey: [\"email-send-records\"] });\r\n      setIsSendDialogOpen(false);\r\n      setSelectedTemplate(null);\r\n      setSendData({ targetType: \"all\", targetRole: \"\", targetUserIds: [], userSearch: \"\" });\r\n      toast({ \r\n        title: t(\"common.success\"), \r\n        description: `成功发送 ${data.success_count} 封邮件，失败 ${data.failed_count} 封`\r\n      });\r\n    },\r\n    onError: (error) => {\r\n      toast({ title: t(\"common.error\"), description: error.message, variant: \"destructive\" });\r\n    }\r\n  });\r\n\r\n  const resetForm = () => {\r\n    setFormData({\r\n      name: \"\",\r\n      subject: \"\",\r\n      content: \"\",\r\n      template_type: \"custom\",\r\n      status: \"draft\"\r\n    });\r\n    setEditingTemplate(null);\r\n  };\r\n\r\n  const openEditDialog = (template: EmailTemplate) => {\r\n    setEditingTemplate(template);\r\n    setFormData({\r\n      name: template.name,\r\n      subject: template.subject_zh,\r\n      content: template.content_zh,\r\n      template_type: template.template_type,\r\n      status: template.status\r\n    });\r\n    setIsTemplateDialogOpen(true);\r\n  };\r\n\r\n  const copyTemplate = (template: EmailTemplate) => {\r\n    setEditingTemplate(null);\r\n    setFormData({\r\n      name: `${template.name} (副本)`,\r\n      subject: template.subject_zh,\r\n      content: template.content_zh,\r\n      template_type: template.template_type,\r\n      status: \"draft\"\r\n    });\r\n    setIsTemplateDialogOpen(true);\r\n  };\r\n\r\n  const openSendDialog = (template: EmailTemplate) => {\r\n    setSelectedTemplate(template);\r\n    setIsSendDialogOpen(true);\r\n  };\r\n\r\n  const openPreviewDialog = (template: EmailTemplate) => {\r\n    setSelectedTemplate(template);\r\n    setIsPreviewDialogOpen(true);\r\n  };\r\n\r\n  const filteredUsers = users.filter(u => \r\n    u.display_name?.toLowerCase().includes(sendData.userSearch.toLowerCase())\r\n  );\r\n\r\n  const getTemplateTypeInfo = (type: string) => {\r\n    const info = TEMPLATE_TYPES.find(t => t.value === type) || TEMPLATE_TYPES[2];\r\n    return { ...info, label: t(info.labelKey, info.value) };\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-bold flex items-center gap-2\">\r\n            <Mail className=\"h-6 w-6\" />\r\n            {t(\"admin.emails\", \"发送邮件\")}\r\n          </h1>\r\n          <p className=\"text-muted-foreground\">{t(\"admin.emailsDesc\", \"管理邮件模板和批量发送邮件\")}</p>\r\n        </div>\r\n      </div>\r\n\r\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\r\n        <TabsList>\r\n          <TabsTrigger value=\"templates\">{t(\"admin.templates\", \"模板管理\")}</TabsTrigger>\r\n          <TabsTrigger value=\"records\">{t(\"admin.sendRecords\", \"发送记录\")}</TabsTrigger>\r\n        </TabsList>\r\n\r\n        <TabsContent value=\"templates\" className=\"space-y-4\">\r\n          <div className=\"flex justify-end\">\r\n            <Dialog open={isTemplateDialogOpen} onOpenChange={(open) => {\r\n              setIsTemplateDialogOpen(open);\r\n              if (!open) resetForm();\r\n            }}>\r\n              <DialogTrigger asChild>\r\n                <Button>\r\n                  <Plus className=\"h-4 w-4 mr-2\" />\r\n                  {t(\"admin.createTemplate\", \"创建模板\")}\r\n                </Button>\r\n              </DialogTrigger>\r\n              <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\r\n                <DialogHeader>\r\n                  <DialogTitle>\r\n                    {editingTemplate ? t(\"admin.editTemplate\", \"编辑模板\") : t(\"admin.createTemplate\", \"创建模板\")}\r\n                  </DialogTitle>\r\n                </DialogHeader>\r\n\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <Label>{t(\"admin.templateName\", \"模板名称\")}</Label>\r\n                    <Input\r\n                      value={formData.name}\r\n                      onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                      placeholder=\"模板名称\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <Label>{t(\"admin.templateType\", \"模板类型\")}</Label>\r\n                    <Select value={formData.template_type} onValueChange={(v) => setFormData({ ...formData, template_type: v })}>\r\n                      <SelectTrigger>\r\n                        <SelectValue />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        {TEMPLATE_TYPES.map((type) => (\r\n                          <SelectItem key={type.value} value={type.value}>\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <type.icon className=\"h-4 w-4\" />\r\n                              {t(type.labelKey, type.value)}\r\n                            </div>\r\n                          </SelectItem>\r\n                        ))}\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <Label>{t(\"common.status\")}</Label>\r\n                  <Select value={formData.status} onValueChange={(v) => setFormData({ ...formData, status: v })}>\r\n                    <SelectTrigger className=\"w-40\">\r\n                      <SelectValue />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"draft\">{t(\"common.draft\", \"草稿\")}</SelectItem>\r\n                      <SelectItem value=\"published\">{t(\"common.published\", \"已发布\")}</SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n\r\n                <div className=\"space-y-4\">\r\n                  <div>\r\n                    <Label>{t(\"admin.emailSubject\", \"邮件主题\")}</Label>\r\n                    <Input\r\n                      value={formData.subject}\r\n                      onChange={(e) => setFormData({ ...formData, subject: e.target.value })}\r\n                      placeholder=\"邮件主题\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <Label>{t(\"admin.emailContent\", \"邮件内容\")}</Label>\r\n                    <RichTextEditor\r\n                      value={formData.content}\r\n                      onChange={(v) => setFormData({ ...formData, content: v })}\r\n                      placeholder=\"邮件内容...\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <DialogFooter>\r\n                  <Button variant=\"outline\" onClick={() => setIsTemplateDialogOpen(false)}>\r\n                    {t(\"common.cancel\")}\r\n                  </Button>\r\n                  <Button \r\n                    onClick={() => templateMutation.mutate({ ...formData, id: editingTemplate?.id })}\r\n                    disabled={templateMutation.isPending || !formData.name || !formData.subject || !formData.content}\r\n                  >\r\n                    {templateMutation.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\r\n                    {editingTemplate ? t(\"common.save\") : t(\"common.create\")}\r\n                  </Button>\r\n                </DialogFooter>\r\n              </DialogContent>\r\n            </Dialog>\r\n          </div>\r\n\r\n          {templatesLoading ? (\r\n            <div className=\"flex justify-center py-8\">\r\n              <Loader2 className=\"h-8 w-8 animate-spin\" />\r\n            </div>\r\n          ) : (\r\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\r\n              {templates.map((template) => {\r\n                const typeInfo = getTemplateTypeInfo(template.template_type);\r\n                return (\r\n                  <Card key={template.id}>\r\n                    <CardHeader className=\"pb-2\">\r\n                      <div className=\"flex items-start justify-between\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <typeInfo.icon className=\"h-5 w-5 text-primary\" />\r\n                          <CardTitle className=\"text-lg\">{template.name}</CardTitle>\r\n                        </div>\r\n                        <Badge variant={template.status === \"published\" ? \"default\" : \"secondary\"}>\r\n                          {template.status === \"published\" ? (\r\n                            <><Check className=\"h-3 w-3 mr-1\" />{t(\"common.published\", \"已发布\")}</>\r\n                          ) : (\r\n                            <><FileEdit className=\"h-3 w-3 mr-1\" />{t(\"common.draft\", \"草稿\")}</>\r\n                          )}\r\n                        </Badge>\r\n                      </div>\r\n                      <CardDescription className=\"line-clamp-1\">\r\n                        {template.subject_zh}\r\n                      </CardDescription>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                      <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-4\">\r\n                        <Badge variant=\"outline\">{typeInfo.label}</Badge>\r\n                      </div>\r\n                      <div className=\"flex flex-wrap gap-2\">\r\n                        <Button size=\"sm\" variant=\"outline\" onClick={() => openEditDialog(template)}>\r\n                          <Edit className=\"h-4 w-4 mr-1\" />\r\n                          {t(\"common.edit\")}\r\n                        </Button>\r\n                        <Button size=\"sm\" variant=\"outline\" onClick={() => copyTemplate(template)}>\r\n                          <Copy className=\"h-4 w-4 mr-1\" />\r\n                          {t(\"common.copy\", \"复制\")}\r\n                        </Button>\r\n                        <Button size=\"sm\" variant=\"outline\" onClick={() => openPreviewDialog(template)}>\r\n                          <Eye className=\"h-4 w-4 mr-1\" />\r\n                          {t(\"common.preview\", \"预览\")}\r\n                        </Button>\r\n                        <Button \r\n                          size=\"sm\" \r\n                          variant=\"outline\"\r\n                          onClick={() => deleteMutation.mutate(template.id)}\r\n                          disabled={deleteMutation.isPending}\r\n                        >\r\n                          <Trash2 className=\"h-4 w-4 mr-1\" />\r\n                          {t(\"common.delete\")}\r\n                        </Button>\r\n                        {template.status === \"published\" && (\r\n                          <Button size=\"sm\" onClick={() => openSendDialog(template)}>\r\n                            <Send className=\"h-4 w-4 mr-1\" />\r\n                            {t(\"common.send\", \"发送\")}\r\n                          </Button>\r\n                        )}\r\n                      </div>\r\n                    </CardContent>\r\n                  </Card>\r\n                );\r\n              })}\r\n            </div>\r\n          )}\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"records\">\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>{t(\"admin.sendRecords\", \"发送记录\")}</CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {recordsLoading ? (\r\n                <div className=\"flex justify-center py-8\">\r\n                  <Loader2 className=\"h-8 w-8 animate-spin\" />\r\n                </div>\r\n              ) : (\r\n                <Table>\r\n                  <TableHeader>\r\n                    <TableRow>\r\n                      <TableHead>{t(\"admin.emailSubject\", \"邮件主题\")}</TableHead>\r\n                      <TableHead>{t(\"admin.targetType\", \"发送对象\")}</TableHead>\r\n                      <TableHead>{t(\"admin.sentCount\", \"发送数量\")}</TableHead>\r\n                      <TableHead>{t(\"admin.successCount\", \"成功\")}</TableHead>\r\n                      <TableHead>{t(\"admin.failedCount\", \"失败\")}</TableHead>\r\n                      <TableHead>{t(\"admin.sentAt\", \"发送时间\")}</TableHead>\r\n                    </TableRow>\r\n                  </TableHeader>\r\n                  <TableBody>\r\n                    {sendRecords.map((record) => (\r\n                      <TableRow key={record.id}>\r\n                        <TableCell className=\"font-medium max-w-xs truncate\">{record.subject}</TableCell>\r\n                        <TableCell>\r\n                          <Badge variant=\"outline\">\r\n                            {record.target_type === \"all\" ? (\r\n                              <><Users className=\"h-3 w-3 mr-1\" />{t(\"admin.allUsers\", \"全部用户\")}</>\r\n                            ) : record.target_type === \"role\" ? (\r\n                              <><User className=\"h-3 w-3 mr-1\" />{record.target_role}</>\r\n                            ) : (\r\n                              <><User className=\"h-3 w-3 mr-1\" />{t(\"admin.specificUsers\", \"指定用户\")}</>\r\n                            )}\r\n                          </Badge>\r\n                        </TableCell>\r\n                        <TableCell>{record.sent_count}</TableCell>\r\n                        <TableCell className=\"text-green-600\">{record.success_count}</TableCell>\r\n                        <TableCell className=\"text-red-600\">{record.failed_count}</TableCell>\r\n                        <TableCell>{format(new Date(record.sent_at), \"yyyy-MM-dd HH:mm\")}</TableCell>\r\n                      </TableRow>\r\n                    ))}\r\n                  </TableBody>\r\n                </Table>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n      </Tabs>\r\n\r\n      {/* Send Dialog */}\r\n      <Dialog open={isSendDialogOpen} onOpenChange={setIsSendDialogOpen}>\r\n        <DialogContent className=\"max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle>{t(\"admin.sendEmail\", \"发送邮件\")}</DialogTitle>\r\n            <DialogDescription>\r\n              {selectedTemplate?.name}\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n\r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <Label>{t(\"admin.targetType\", \"发送对象\")}</Label>\r\n              <Select \r\n                value={sendData.targetType} \r\n                onValueChange={(v: \"all\" | \"role\" | \"specific\") => setSendData({ ...sendData, targetType: v })}\r\n              >\r\n                <SelectTrigger>\r\n                  <SelectValue />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"all\">{t(\"admin.allUsers\", \"全部用户\")}</SelectItem>\r\n                  <SelectItem value=\"role\">{t(\"admin.byRole\", \"按身份\")}</SelectItem>\r\n                  <SelectItem value=\"specific\">{t(\"admin.specificUsers\", \"指定用户\")}</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n\r\n            {sendData.targetType === \"role\" && (\r\n              <div>\r\n                <Label>{t(\"admin.selectRole\", \"选择身份\")}</Label>\r\n                <Select value={sendData.targetRole} onValueChange={(v) => setSendData({ ...sendData, targetRole: v })}>\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder={t(\"admin.selectRole\")} />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"user\">{t(\"common.user\", \"用户\")}</SelectItem>\r\n                    <SelectItem value=\"merchant\">{t(\"common.merchant\", \"商家\")}</SelectItem>\r\n                    <SelectItem value=\"supervisor\">{t(\"common.supervisor\", \"主管\")}</SelectItem>\r\n                    <SelectItem value=\"admin\">{t(\"common.admin\", \"管理员\")}</SelectItem>\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n            )}\r\n\r\n            {sendData.targetType === \"specific\" && (\r\n              <div className=\"space-y-2\">\r\n                <Label>{t(\"admin.selectUsers\", \"选择用户\")}</Label>\r\n                <Input\r\n                  placeholder={t(\"admin.searchUsers\", \"搜索用户...\")}\r\n                  value={sendData.userSearch}\r\n                  onChange={(e) => setSendData({ ...sendData, userSearch: e.target.value })}\r\n                />\r\n                <div className=\"max-h-40 overflow-y-auto border rounded-md p-2 space-y-1\">\r\n                  {filteredUsers.slice(0, 20).map((u) => (\r\n                    <label key={u.id} className=\"flex items-center gap-2 p-1 hover:bg-muted rounded cursor-pointer\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={sendData.targetUserIds.includes(u.id)}\r\n                        onChange={(e) => {\r\n                          if (e.target.checked) {\r\n                            setSendData({ ...sendData, targetUserIds: [...sendData.targetUserIds, u.id] });\r\n                          } else {\r\n                            setSendData({ ...sendData, targetUserIds: sendData.targetUserIds.filter(id => id !== u.id) });\r\n                          }\r\n                        }}\r\n                      />\r\n                      <span className=\"text-sm\">{u.display_name}</span>\r\n                    </label>\r\n                  ))}\r\n                </div>\r\n                {sendData.targetUserIds.length > 0 && (\r\n                  <p className=\"text-sm text-muted-foreground\">\r\n                    {t(\"admin.selectedUsersCount\", { count: sendData.targetUserIds.length })}\r\n                  </p>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setIsSendDialogOpen(false)}>\r\n              {t(\"common.cancel\")}\r\n            </Button>\r\n            <Button \r\n              onClick={() => sendMutation.mutate()}\r\n              disabled={sendMutation.isPending || (sendData.targetType === \"role\" && !sendData.targetRole) || (sendData.targetType === \"specific\" && sendData.targetUserIds.length === 0)}\r\n            >\r\n              {sendMutation.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\r\n              <Send className=\"h-4 w-4 mr-2\" />\r\n              {t(\"common.send\", \"发送\")}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Preview Dialog */}\r\n      <Dialog open={isPreviewDialogOpen} onOpenChange={setIsPreviewDialogOpen}>\r\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\r\n          <DialogHeader>\r\n            <DialogTitle>{t(\"common.preview\", \"预览邮件\")}</DialogTitle>\r\n          </DialogHeader>\r\n          {selectedTemplate && (\r\n            <div className=\"border rounded-lg p-4\">\r\n              <h3 className=\"font-semibold text-lg mb-2\">{selectedTemplate.subject_zh}</h3>\r\n              <div \r\n                className=\"prose prose-sm max-w-none dark:prose-invert\"\r\n                dangerouslySetInnerHTML={{ __html: selectedTemplate.content_zh }}\r\n              />\r\n            </div>\r\n          )}\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setIsPreviewDialogOpen(false)}>\r\n              {t(\"common.close\", \"关闭\")}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["TEMPLATE_TYPES","Megaphone","Shield","Sparkles","AdminEmails","t","i18n","useTranslation","user","useAuth","toast","useToast","queryClient","useQueryClient","isTemplateDialogOpen","setIsTemplateDialogOpen","useState","isSendDialogOpen","setIsSendDialogOpen","isPreviewDialogOpen","setIsPreviewDialogOpen","editingTemplate","setEditingTemplate","selectedTemplate","setSelectedTemplate","activeTab","setActiveTab","formData","setFormData","sendData","setSendData","templates","templatesLoading","useQuery","data","error","supabase","sendRecords","recordsLoading","users","templateMutation","useMutation","templateData","resetForm","deleteMutation","id","sendMutation","openEditDialog","template","copyTemplate","openSendDialog","openPreviewDialog","filteredUsers","u","getTemplateTypeInfo","type","info","jsxs","jsx","Mail","Tabs","TabsList","TabsTrigger","TabsContent","Dialog","open","DialogTrigger","Button","Plus","DialogContent","DialogHeader","DialogTitle","Label","Input","e","Select","v","SelectTrigger","SelectValue","SelectContent","SelectItem","RichTextEditor","DialogFooter","Loader2","typeInfo","Card","CardHeader","CardTitle","Badge","Fragment","Check","FileEdit","CardDescription","CardContent","Edit","Copy","Eye","Trash2","Send","Table","TableHeader","TableRow","TableHead","TableBody","record","TableCell","Users","User","format","DialogDescription"],"mappings":"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"}