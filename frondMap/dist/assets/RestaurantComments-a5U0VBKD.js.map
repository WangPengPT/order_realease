{"version":3,"file":"RestaurantComments-a5U0VBKD.js","sources":["../../src/components/TranslateButton.tsx","../../src/components/TranslatableText.tsx","../../src/components/RestaurantComments.tsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Languages, Loader2, RotateCcw } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\ninterface TranslateButtonProps {\r\n  text: string;\r\n  className?: string;\r\n  onTranslation?: (translatedText: string | null) => void;\r\n}\r\n\r\n// Simple cache to store translations and avoid repeated API calls\r\nconst translationCache = new Map<string, string>();\r\n\r\nconst TranslateButton = ({ text, className, onTranslation }: TranslateButtonProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const [isTranslating, setIsTranslating] = useState(false);\r\n  const [translatedText, setTranslatedText] = useState<string | null>(null);\r\n  const [showTranslation, setShowTranslation] = useState(false);\r\n  const [lastTranslatedLang, setLastTranslatedLang] = useState<string | null>(null);\r\n\r\n  // Reset translation when language changes\r\n  const currentLang = i18n.language;\r\n  \r\n  // If language changed and we have a translation, reset it\r\n  if (lastTranslatedLang && lastTranslatedLang !== currentLang && showTranslation) {\r\n    setShowTranslation(false);\r\n    setTranslatedText(null);\r\n    onTranslation?.(null);\r\n  }\r\n\r\n  const handleTranslate = async () => {\r\n    // Get current language at call time, not render time\r\n    const targetLang = i18n.language;\r\n    const cacheKey = `${text.substring(0, 100)}_${targetLang}`;\r\n    \r\n    // If already showing translation for the same language, toggle back to original\r\n    if (showTranslation && lastTranslatedLang === targetLang) {\r\n      setShowTranslation(false);\r\n      onTranslation?.(null);\r\n      return;\r\n    }\r\n\r\n    // Check global cache\r\n    const cached = translationCache.get(cacheKey);\r\n    if (cached) {\r\n      setTranslatedText(cached);\r\n      setShowTranslation(true);\r\n      setLastTranslatedLang(targetLang);\r\n      onTranslation?.(cached);\r\n      return;\r\n    }\r\n\r\n    // Call translation API\r\n    setIsTranslating(true);\r\n    console.log('[TranslateButton] Calling translate-content with targetLang:', targetLang);\r\n    try {\r\n      const { data, error } = await supabase.functions.invoke('translate-content', {\r\n        body: { text, targetLang }\r\n      });\r\n      console.log('[TranslateButton] Response:', data, error);\r\n\r\n      if (error) {\r\n        console.error('Translation error:', error);\r\n        toast.error(t(\"translate.error\", \"翻译失败，请稍后重试\"));\r\n        return;\r\n      }\r\n\r\n      if (data?.translatedText) {\r\n        // Store in cache\r\n        translationCache.set(cacheKey, data.translatedText);\r\n        setTranslatedText(data.translatedText);\r\n        setShowTranslation(true);\r\n        setLastTranslatedLang(targetLang);\r\n        onTranslation?.(data.translatedText);\r\n      } else if (data?.error) {\r\n        toast.error(data.error);\r\n      }\r\n    } catch (err) {\r\n      console.error('Translation error:', err);\r\n      toast.error(t(\"translate.error\", \"翻译失败，请稍后重试\"));\r\n    } finally {\r\n      setIsTranslating(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Button\r\n      variant=\"ghost\"\r\n      size=\"sm\"\r\n      className={`gap-1.5 h-auto py-1 px-2 text-xs text-muted-foreground hover:text-foreground ${className || ''}`}\r\n      onClick={handleTranslate}\r\n      disabled={isTranslating}\r\n    >\r\n      {isTranslating ? (\r\n        <>\r\n          <Loader2 className=\"h-3 w-3 animate-spin\" />\r\n          <span>{t(\"translate.translating\", \"翻译中...\")}</span>\r\n        </>\r\n      ) : showTranslation ? (\r\n        <>\r\n          <RotateCcw className=\"h-3 w-3\" />\r\n          <span>{t(\"translate.showOriginal\", \"显示原文\")}</span>\r\n        </>\r\n      ) : (\r\n        <>\r\n          <Languages className=\"h-3 w-3\" />\r\n          <span>{t(\"translate.button\", \"翻译\")}</span>\r\n        </>\r\n      )}\r\n    </Button>\r\n  );\r\n};\r\n\r\nexport default TranslateButton;\r\n","import { useState } from \"react\";\r\nimport TranslateButton from \"@/components/TranslateButton\";\r\n\r\ninterface TranslatableTextProps {\r\n  text: string;\r\n  className?: string;\r\n}\r\n\r\nconst TranslatableText = ({ text, className }: TranslatableTextProps) => {\r\n  const [translatedText, setTranslatedText] = useState<string | null>(null);\r\n\r\n  return (\r\n    <div className={className}>\r\n      <p className=\"text-xs sm:text-sm text-foreground break-words\">\r\n        {translatedText || text}\r\n      </p>\r\n      <TranslateButton \r\n        text={text} \r\n        onTranslation={setTranslatedText}\r\n        className=\"mt-0.5\"\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TranslatableText;\r\n","import { useState, useCallback, useMemo, memo } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { useComments, useAddComment, useDeleteComment, Comment } from \"@/hooks/useComments\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useProfile } from \"@/hooks/useProfile\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useCheckSensitiveWords } from \"@/hooks/useSensitiveWords\";\r\nimport { formatDistanceToNow } from \"date-fns\";\r\nimport { MessageSquare, Trash2, Reply, Image as ImageIcon, X, Star, DollarSign, ShieldAlert, VolumeX, Clock, AlertCircle } from \"lucide-react\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport ReportDialog from \"@/components/ReportDialog\";\r\nimport TranslatableText from \"@/components/TranslatableText\";\r\n\r\ninterface RestaurantCommentsProps {\r\n  restaurantId?: string;\r\n  targetId?: string;\r\n  targetType?: \"restaurant\" | \"activity\" | \"post\";\r\n}\r\n\r\nconst priceRanges = [\r\n  { value: \"0-5\", label: \"0-5€\" },\r\n  { value: \"5-10\", label: \"5-10€\" },\r\n  { value: \"10-15\", label: \"10-15€\" },\r\n  { value: \"15-20\", label: \"15-20€\" },\r\n  { value: \"20-25\", label: \"20-25€\" },\r\n  { value: \"25-30\", label: \"25-30€\" },\r\n  { value: \"30-40\", label: \"30-40€\" },\r\n  { value: \"40-50\", label: \"40-50€\" },\r\n  { value: \"50+\", label: \"50€+\" },\r\n];\r\n\r\nconst RestaurantComments = ({ restaurantId, targetId, targetType = \"restaurant\" }: RestaurantCommentsProps) => {\r\n  // Support both old prop name (restaurantId) and new prop name (targetId)\r\n  const actualTargetId = targetId || restaurantId || \"\";\r\n  const { t } = useTranslation();\r\n  const { user } = useAuth();\r\n  const { data: profile } = useProfile();\r\n  const { isAdmin } = useUserRole();\r\n  const { toast } = useToast();\r\n  const navigate = useNavigate();\r\n  const [newComment, setNewComment] = useState(\"\");\r\n  const [rating, setRating] = useState(0);\r\n  const [hoverRating, setHoverRating] = useState(0);\r\n  const [priceRange, setPriceRange] = useState(\"\");\r\n  const [replyTo, setReplyTo] = useState<string | null>(null);\r\n  const [replyContent, setReplyContent] = useState(\"\");\r\n  const [commentImage, setCommentImage] = useState<File | null>(null);\r\n  const [commentImagePreview, setCommentImagePreview] = useState<string | null>(null);\r\n  const [replyImage, setReplyImage] = useState<File | null>(null);\r\n  const [replyImagePreview, setReplyImagePreview] = useState<string | null>(null);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [showLoginDialog, setShowLoginDialog] = useState(false);\r\n  const [deleteConfirmId, setDeleteConfirmId] = useState<string | null>(null);\r\n\r\n  const { data: comments, isLoading } = useComments(actualTargetId, targetType);\r\n  const addComment = useAddComment();\r\n  const deleteComment = useDeleteComment();\r\n  const { checkContent } = useCheckSensitiveWords();\r\n\r\n  const uploadImage = useCallback(async (file: File): Promise<string | null> => {\r\n    try {\r\n      const fileExt = file.name.split(\".\").pop();\r\n      const fileName = `${user?.id}-${Date.now()}.${fileExt}`;\r\n      const filePath = `${fileName}`;\r\n\r\n      const { error: uploadError, data } = await supabase.storage\r\n        .from(\"comment-images\")\r\n        .upload(filePath, file);\r\n\r\n      if (uploadError) throw uploadError;\r\n\r\n      const { data: { publicUrl } } = supabase.storage\r\n        .from(\"comment-images\")\r\n        .getPublicUrl(filePath);\r\n\r\n      return publicUrl;\r\n    } catch (error) {\r\n      console.error(\"Error uploading image:\", error);\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.imageUploadFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return null;\r\n    }\r\n  }, [user, toast, t]);\r\n\r\n  const handleImageSelect = useCallback((e: React.ChangeEvent<HTMLInputElement>, isReply: boolean = false) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      if (file.size > 5 * 1024 * 1024) {\r\n        toast({\r\n          title: t(\"common.error\"),\r\n          description: t(\"restaurant.imageTooLarge\"),\r\n          variant: \"destructive\",\r\n        });\r\n        return;\r\n      }\r\n\r\n      if (isReply) {\r\n        setReplyImage(file);\r\n        setReplyImagePreview(URL.createObjectURL(file));\r\n      } else {\r\n        setCommentImage(file);\r\n        setCommentImagePreview(URL.createObjectURL(file));\r\n      }\r\n    }\r\n  }, [toast, t]);\r\n\r\n  const clearImage = useCallback((isReply: boolean = false) => {\r\n    if (isReply) {\r\n      setReplyImage(null);\r\n      setReplyImagePreview(null);\r\n    } else {\r\n      setCommentImage(null);\r\n      setCommentImagePreview(null);\r\n    }\r\n  }, []);\r\n\r\n  const handleSubmitComment = useCallback(async () => {\r\n    if (!newComment.trim() || !user) return;\r\n    \r\n    // Check if user is muted\r\n    if (profile?.is_muted) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.youAreMuted\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n    \r\n    // Check for sensitive words\r\n    const sensitiveCheck = checkContent(newComment);\r\n    if (sensitiveCheck.hasSensitive) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.sensitiveWordsDetected\", \"评论包含敏感词，请修改后重试\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n    \r\n    // For restaurant comments, require rating\r\n    if (targetType === \"restaurant\" && !rating) {\r\n      toast({\r\n        title: t(\"common.hint\", \"提示\"),\r\n        description: t(\"toast.pleaseSelectRating\"),\r\n        variant: \"warning\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    let imageUrl: string | undefined;\r\n\r\n    if (commentImage) {\r\n      const uploadedUrl = await uploadImage(commentImage);\r\n      if (uploadedUrl) imageUrl = uploadedUrl;\r\n    }\r\n\r\n    await addComment.mutateAsync({\r\n      targetId: actualTargetId,\r\n      targetType: targetType,\r\n      content: newComment,\r\n      ratingValue: targetType === \"restaurant\" ? rating : undefined,\r\n      priceRange: targetType === \"restaurant\" && priceRange ? priceRange : undefined,\r\n      imageUrl,\r\n    });\r\n\r\n    setNewComment(\"\");\r\n    setRating(0);\r\n    setPriceRange(\"\");\r\n    setCommentImage(null);\r\n    setCommentImagePreview(null);\r\n    setUploading(false);\r\n  }, [newComment, user, profile, targetType, rating, toast, t, commentImage, uploadImage, addComment, restaurantId, priceRange, checkContent]);\r\n\r\n  const handleSubmitReply = useCallback(async (parentId: string) => {\r\n    if (!replyContent.trim() || !user) return;\r\n\r\n    // Check if user is muted\r\n    if (profile?.is_muted) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.youAreMuted\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Check for sensitive words\r\n    const sensitiveCheck = checkContent(replyContent);\r\n    if (sensitiveCheck.hasSensitive) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.sensitiveWordsDetected\", \"评论包含敏感词，请修改后重试\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    let imageUrl: string | undefined;\r\n\r\n    if (replyImage) {\r\n      const uploadedUrl = await uploadImage(replyImage);\r\n      if (uploadedUrl) imageUrl = uploadedUrl;\r\n    }\r\n\r\n    await addComment.mutateAsync({\r\n      targetId: actualTargetId,\r\n      targetType: targetType,\r\n      content: replyContent,\r\n      parentId,\r\n      imageUrl,\r\n    });\r\n\r\n    setReplyContent(\"\");\r\n    setReplyTo(null);\r\n    setReplyImage(null);\r\n    setReplyImagePreview(null);\r\n    setUploading(false);\r\n  }, [replyContent, user, profile, replyImage, uploadImage, addComment, restaurantId, targetType, checkContent, toast, t]);\r\n\r\n  const handleDeleteComment = useCallback(async (commentId: string) => {\r\n    await deleteComment.mutateAsync(commentId);\r\n    setDeleteConfirmId(null);\r\n  }, [deleteComment]);\r\n\r\n  const CommentItem = memo(({ comment, isReply = false }: { comment: Comment; isReply?: boolean }) => (\r\n    <div className={`flex gap-2 sm:gap-3 ${isReply ? \"ml-8 sm:ml-12 mt-3\" : \"\"}`}>\r\n      <Avatar className=\"w-8 h-8 sm:w-10 sm:h-10 shrink-0\">\r\n        <AvatarImage src={comment.profiles?.avatar_url} />\r\n        <AvatarFallback className=\"text-xs sm:text-sm\">\r\n          {comment.profiles?.display_name?.charAt(0).toUpperCase() || \"U\"}\r\n        </AvatarFallback>\r\n      </Avatar>\r\n      <div className=\"flex-1 min-w-0\">\r\n        <div className=\"flex items-center gap-2 flex-wrap\">\r\n          <span className=\"font-semibold text-xs sm:text-sm truncate\">{comment.profiles?.display_name}</span>\r\n          <span className=\"text-xs text-muted-foreground shrink-0\">\r\n            {formatDistanceToNow(new Date(comment.created_at), { addSuffix: true })}\r\n          </span>\r\n          {comment.edited && (\r\n            <span className=\"text-xs text-muted-foreground italic\">({t(\"restaurant.edited\")})</span>\r\n          )}\r\n          {/* Show moderation status badges for user's own comments */}\r\n          {user?.id === comment.user_id && comment.moderation_status === \"pending\" && (\r\n            <Badge variant=\"outline\" className=\"text-yellow-600 border-yellow-500 bg-yellow-50 dark:bg-yellow-950/30 text-xs py-0 h-5\">\r\n              <Clock className=\"w-3 h-3 mr-1\" />\r\n              {t(\"restaurant.commentPending\", \"审核中\")}\r\n            </Badge>\r\n          )}\r\n          {user?.id === comment.user_id && comment.moderation_status === \"flagged\" && (\r\n            <Badge variant=\"outline\" className=\"text-destructive border-destructive bg-destructive/10 text-xs py-0 h-5\">\r\n              <AlertCircle className=\"w-3 h-3 mr-1\" />\r\n              {t(\"restaurant.commentFailed\", \"发送失败\")}\r\n            </Badge>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Display rating and price range for main comments */}\r\n        {!isReply && comment.rating_value && (\r\n          <div className=\"flex items-center gap-3 mt-1 mb-2\">\r\n            <div className=\"flex items-center gap-1\">\r\n              {[1, 2, 3, 4, 5].map((star) => (\r\n                <Star\r\n                  key={star}\r\n                  className={cn(\r\n                    \"w-4 h-4\",\r\n                    star <= comment.rating_value!\r\n                      ? \"fill-accent text-accent\"\r\n                      : \"text-muted-foreground\"\r\n                  )}\r\n                />\r\n              ))}\r\n            </div>\r\n            {comment.price_range && (\r\n              <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\r\n                <DollarSign className=\"w-3 h-3\" />\r\n                <span>{priceRanges.find(r => r.value === comment.price_range)?.label}</span>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n        \r\n        <TranslatableText text={comment.content} className=\"mt-1\" />\r\n        {comment.image_url && (\r\n          <img\r\n            src={comment.image_url}\r\n            alt=\"Comment attachment\"\r\n            className=\"mt-2 rounded-lg max-w-full sm:max-w-sm w-full\"\r\n          />\r\n        )}\r\n        <div className=\"flex gap-2 sm:gap-3 mt-2\">\r\n          {!isReply && user && !profile?.is_muted && (\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              onClick={() => setReplyTo(comment.id)}\r\n              className=\"h-7 text-xs px-2 sm:px-3\"\r\n            >\r\n              <Reply className=\"w-3 h-3 mr-1\" />\r\n              <span className=\"hidden xs:inline\">{t(\"restaurant.reply\")}</span>\r\n            </Button>\r\n          )}\r\n          {(user?.id === comment.user_id || isAdmin) && (\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              onClick={() => setDeleteConfirmId(comment.id)}\r\n              className=\"h-7 text-xs text-destructive hover:text-destructive px-2 sm:px-3\"\r\n            >\r\n              <Trash2 className=\"w-3 h-3 mr-1\" />\r\n              <span className=\"hidden xs:inline\">{t(\"common.delete\")}</span>\r\n            </Button>\r\n          )}\r\n          {user?.id !== comment.user_id && (\r\n            <ReportDialog\r\n              targetType=\"comment\"\r\n              targetId={comment.id}\r\n              onLoginRequired={() => setShowLoginDialog(true)}\r\n              trigger={\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"h-7 text-xs px-2 sm:px-3\"\r\n                >\r\n                  <ShieldAlert className=\"w-3 h-3 mr-1\" />\r\n                  <span className=\"hidden xs:inline\">{t(\"report.title\")}</span>\r\n                </Button>\r\n              }\r\n            />\r\n          )}\r\n        </div>\r\n\r\n        {replyTo === comment.id && (\r\n          <div className=\"mt-3 space-y-2\">\r\n            <div className=\"flex flex-col sm:flex-row gap-2\">\r\n              <div className=\"flex-1 space-y-2\">\r\n                <Textarea\r\n                  value={replyContent}\r\n                  onChange={(e) => setReplyContent(e.target.value)}\r\n                  placeholder={t(\"restaurant.writeReply\")}\r\n                  className=\"min-h-[80px] text-sm\"\r\n                />\r\n                {replyImagePreview && (\r\n                  <div className=\"relative inline-block max-w-full\">\r\n                    <img\r\n                      src={replyImagePreview}\r\n                      alt=\"Preview\"\r\n                      className=\"max-w-full sm:max-w-xs rounded-lg\"\r\n                    />\r\n                    <Button\r\n                      size=\"icon\"\r\n                      variant=\"destructive\"\r\n                      className=\"absolute -top-2 -right-2 h-6 w-6 rounded-full\"\r\n                      onClick={() => clearImage(true)}\r\n                    >\r\n                      <X className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n              <div className=\"flex sm:flex-col gap-2\">\r\n                <Button\r\n                  size=\"sm\"\r\n                  onClick={() => handleSubmitReply(comment.id)}\r\n                  disabled={!replyContent.trim() || uploading}\r\n                  className=\"text-xs\"\r\n                >\r\n                  {uploading ? t(\"common.loading\") : t(\"restaurant.reply\")}\r\n                </Button>\r\n                <Input\r\n                  type=\"file\"\r\n                  accept=\"image/*\"\r\n                  onChange={(e) => handleImageSelect(e, true)}\r\n                  className=\"hidden\"\r\n                  id={`reply-image-${comment.id}`}\r\n                  disabled={uploading}\r\n                />\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant=\"outline\"\r\n                  onClick={() => document.getElementById(`reply-image-${comment.id}`)?.click()}\r\n                  disabled={uploading}\r\n                  className=\"text-xs sm:px-3\"\r\n                >\r\n                  <ImageIcon className=\"h-4 w-4 sm:mr-1\" />\r\n                  <span className=\"hidden sm:inline\">{t(\"restaurant.addImage\")}</span>\r\n                </Button>\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant=\"outline\"\r\n                  onClick={() => {\r\n                    setReplyTo(null);\r\n                    setReplyContent(\"\");\r\n                    clearImage(true);\r\n                  }}\r\n                  className=\"text-xs\"\r\n                >\r\n                  {t(\"common.cancel\")}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {comment.replies && comment.replies.length > 0 && (\r\n          <div className=\"mt-3 space-y-3\">\r\n            {comment.replies.map((reply) => (\r\n              <CommentItem key={reply.id} comment={reply} isReply />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  ));\r\n  CommentItem.displayName = \"CommentItem\";\r\n\r\n  if (isLoading) {\r\n    return <div className=\"text-center py-8\">{t(\"common.loading\")}</div>;\r\n  }\r\n\r\n  return (\r\n    <>\r\n    <div className=\"space-y-4 sm:space-y-6\">\r\n      <div className=\"flex items-center gap-2\">\r\n        <MessageSquare className=\"w-4 sm:w-5 h-4 sm:h-5\" />\r\n        <h2 className=\"text-xl sm:text-2xl font-bold\">\r\n          {t(\"restaurant.reviews\")} ({comments?.length || 0})\r\n        </h2>\r\n      </div>\r\n\r\n      {user ? (\r\n        profile?.is_muted ? (\r\n          <Card className=\"border-yellow-300 bg-yellow-50/50 dark:bg-yellow-950/20\">\r\n            <CardContent className=\"py-4 sm:py-6 px-3 sm:px-6\">\r\n              <div className=\"flex items-center gap-3 text-yellow-600 dark:text-yellow-400\">\r\n                <VolumeX className=\"w-5 h-5 shrink-0\" />\r\n                <span className=\"text-sm font-medium\">{t(\"restaurant.youAreMutedNotice\")}</span>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        ) : (\r\n        <Card>\r\n          <CardContent className=\"pt-4 sm:pt-6 px-3 sm:px-6\">\r\n            <div className=\"flex gap-2 sm:gap-3\">\r\n              <Avatar className=\"w-8 h-8 sm:w-10 sm:h-10 shrink-0\">\r\n                <AvatarImage src={profile?.avatar_url || undefined} />\r\n                <AvatarFallback className=\"text-xs sm:text-sm\">\r\n                  {profile?.display_name?.charAt(0).toUpperCase() || user?.email?.charAt(0).toUpperCase() || \"U\"}\r\n                </AvatarFallback>\r\n              </Avatar>\r\n              <div className=\"flex-1 space-y-2 sm:space-y-3 min-w-0\">\r\n                {/* Rating and Price Range - Only for restaurant */}\r\n                {targetType === \"restaurant\" && (\r\n                  <div className=\"space-y-3\">\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium flex items-center gap-2\">\r\n                        <Star className=\"w-4 h-4 text-accent\" />\r\n                        评分 <span className=\"text-destructive\">*</span>\r\n                      </label>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        {[1, 2, 3, 4, 5].map((star) => (\r\n                          <button\r\n                            key={star}\r\n                            type=\"button\"\r\n                            onMouseEnter={() => setHoverRating(star)}\r\n                            onMouseLeave={() => setHoverRating(0)}\r\n                            onClick={() => setRating(star)}\r\n                            className=\"transition-transform hover:scale-110\"\r\n                          >\r\n                            <Star\r\n                              className={cn(\r\n                                \"w-7 h-7 cursor-pointer transition-colors\",\r\n                                star <= (hoverRating || rating)\r\n                                  ? \"fill-accent text-accent\"\r\n                                  : \"text-muted-foreground hover:text-accent\"\r\n                              )}\r\n                            />\r\n                          </button>\r\n                        ))}\r\n                        {rating > 0 && (\r\n                          <span className=\"ml-2 text-sm text-muted-foreground\">\r\n                            ({rating}/5)\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium flex items-center gap-2\">\r\n                        <DollarSign className=\"w-4 h-4\" />\r\n                        {t(\"restaurant.priceRange\")}\r\n                      </label>\r\n                      <Select value={priceRange} onValueChange={setPriceRange}>\r\n                        <SelectTrigger className=\"w-full\">\r\n                          <SelectValue placeholder={t(\"restaurant.selectPriceRange\")} />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"bg-background\">\r\n                          {priceRanges.map((range) => (\r\n                            <SelectItem key={range.value} value={range.value}>\r\n                              {range.label}\r\n                            </SelectItem>\r\n                          ))}\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                <Textarea\r\n                  value={newComment}\r\n                  onChange={(e) => setNewComment(e.target.value)}\r\n                  placeholder={t(\"restaurant.writeComment\")}\r\n                  className=\"min-h-[80px] sm:min-h-[100px] text-sm\"\r\n                />\r\n                {commentImagePreview && (\r\n                  <div className=\"relative inline-block max-w-full\">\r\n                    <img\r\n                      src={commentImagePreview}\r\n                      alt=\"Preview\"\r\n                      className=\"max-w-full sm:max-w-xs rounded-lg\"\r\n                    />\r\n                    <Button\r\n                      size=\"icon\"\r\n                      variant=\"destructive\"\r\n                      className=\"absolute -top-2 -right-2 h-6 w-6 rounded-full\"\r\n                      onClick={() => clearImage(false)}\r\n                    >\r\n                      <X className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                  <Input\r\n                    type=\"file\"\r\n                    accept=\"image/*\"\r\n                    onChange={(e) => handleImageSelect(e, false)}\r\n                    className=\"hidden\"\r\n                    id=\"comment-image\"\r\n                    disabled={uploading}\r\n                  />\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={() => document.getElementById(\"comment-image\")?.click()}\r\n                    disabled={uploading}\r\n                    className=\"text-xs\"\r\n                  >\r\n                    <ImageIcon className=\"h-4 w-4 sm:mr-2\" />\r\n                    <span className=\"hidden sm:inline\">{t(\"restaurant.addImage\")}</span>\r\n                  </Button>\r\n                  <Button\r\n                    onClick={handleSubmitComment}\r\n                    disabled={!newComment.trim() || addComment.isPending || uploading}\r\n                    size=\"sm\"\r\n                    className=\"text-xs\"\r\n                  >\r\n                    {uploading || addComment.isPending ? t(\"common.loading\") : t(\"restaurant.postComment\")}\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n        )\r\n      ) : (\r\n        <Card>\r\n          <CardContent className=\"py-4 sm:py-6 px-3 sm:px-6 text-center text-muted-foreground text-sm\">\r\n            {t(\"restaurant.signInToComment\")}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      <div className=\"space-y-4 sm:space-y-6\">\r\n        {comments?.map((comment) => (\r\n          <Card key={comment.id}>\r\n            <CardHeader className=\"p-3 sm:p-6\">\r\n              <CommentItem comment={comment} />\r\n            </CardHeader>\r\n          </Card>\r\n        ))}\r\n      </div>\r\n\r\n      {comments?.length === 0 && (\r\n        <Card>\r\n          <CardContent className=\"py-8 sm:py-12 px-3 sm:px-6 text-center text-muted-foreground text-sm\">\r\n            {t(\"restaurant.noComments\")}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n    </div>\r\n\r\n    {/* Login Required Dialog */}\r\n    <AlertDialog open={showLoginDialog} onOpenChange={setShowLoginDialog}>\r\n      <AlertDialogContent>\r\n        <AlertDialogHeader>\r\n          <AlertDialogTitle>{t(\"activities.loginRequired\")}</AlertDialogTitle>\r\n          <AlertDialogDescription>\r\n            {t(\"activities.loginRequiredMessage\")}\r\n          </AlertDialogDescription>\r\n        </AlertDialogHeader>\r\n        <AlertDialogFooter>\r\n          <AlertDialogCancel>{t(\"common.cancel\")}</AlertDialogCancel>\r\n          <AlertDialogAction onClick={() => navigate(\"/auth\")}>\r\n            {t(\"activities.goToLogin\")}\r\n          </AlertDialogAction>\r\n        </AlertDialogFooter>\r\n      </AlertDialogContent>\r\n    </AlertDialog>\r\n\r\n    {/* Delete Comment Confirmation Dialog */}\r\n    <AlertDialog open={!!deleteConfirmId} onOpenChange={(open) => !open && setDeleteConfirmId(null)}>\r\n      <AlertDialogContent className=\"max-w-sm\">\r\n        <AlertDialogHeader>\r\n          <div className=\"mx-auto mb-4 flex h-14 w-14 items-center justify-center rounded-full bg-destructive/10\">\r\n            <Trash2 className=\"h-7 w-7 text-destructive\" />\r\n          </div>\r\n          <AlertDialogTitle className=\"text-center\">\r\n            {t(\"restaurant.deleteComment\")}\r\n          </AlertDialogTitle>\r\n          <AlertDialogDescription className=\"text-center\">\r\n            {t(\"restaurant.confirmDelete\")}\r\n          </AlertDialogDescription>\r\n        </AlertDialogHeader>\r\n        <AlertDialogFooter className=\"sm:justify-center gap-2\">\r\n          <AlertDialogCancel className=\"sm:w-24\">\r\n            {t(\"common.cancel\")}\r\n          </AlertDialogCancel>\r\n          <AlertDialogAction\r\n            onClick={() => deleteConfirmId && handleDeleteComment(deleteConfirmId)}\r\n            className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90 sm:w-24\"\r\n          >\r\n            {t(\"common.delete\")}\r\n          </AlertDialogAction>\r\n        </AlertDialogFooter>\r\n      </AlertDialogContent>\r\n    </AlertDialog>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default RestaurantComments;\r\n"],"names":["translationCache","TranslateButton","text","className","onTranslation","t","i18n","useTranslation","isTranslating","setIsTranslating","useState","translatedText","setTranslatedText","showTranslation","setShowTranslation","lastTranslatedLang","setLastTranslatedLang","currentLang","handleTranslate","targetLang","cacheKey","cached","data","error","supabase","toast","err","jsx","Button","jsxs","Fragment","Loader2","RotateCcw","Languages","TranslatableText","priceRanges","RestaurantComments","restaurantId","targetId","targetType","actualTargetId","user","useAuth","profile","useProfile","isAdmin","useUserRole","useToast","navigate","useNavigate","newComment","setNewComment","rating","setRating","hoverRating","setHoverRating","priceRange","setPriceRange","replyTo","setReplyTo","replyContent","setReplyContent","commentImage","setCommentImage","commentImagePreview","setCommentImagePreview","replyImage","setReplyImage","replyImagePreview","setReplyImagePreview","uploading","setUploading","showLoginDialog","setShowLoginDialog","deleteConfirmId","setDeleteConfirmId","comments","isLoading","useComments","addComment","useAddComment","deleteComment","useDeleteComment","checkContent","useCheckSensitiveWords","uploadImage","useCallback","file","fileExt","filePath","uploadError","publicUrl","handleImageSelect","e","isReply","clearImage","handleSubmitComment","imageUrl","uploadedUrl","handleSubmitReply","parentId","handleDeleteComment","commentId","CommentItem","memo","comment","Avatar","AvatarImage","AvatarFallback","Badge","Clock","AlertCircle","star","Star","cn","DollarSign","r","Reply","Trash2","ReportDialog","ShieldAlert","Textarea","X","Input","ImageIcon","reply","MessageSquare","Card","CardContent","VolumeX","Select","SelectTrigger","SelectValue","SelectContent","range","SelectItem","CardHeader","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","open"],"mappings":"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"}