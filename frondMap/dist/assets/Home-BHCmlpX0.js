import{j as e}from"./vendor-ui-BO6fjm1h.js";import{a as Ee,u as Ze,b as Me,l as et,D as tt,c as st,d as at,e as rt,S as Oe,M as Ne,f as O,U as nt,L as De,g as ot,h as lt,i as it,j as ct,I as dt,B as Z,N as je,F as mt,k as X,m as ut,n as xt,C as Te,o as Ie,p as we,q as Le,r as ze,E as ht,s as pt,A as gt,t as ft,v as bt,w as Fe,x as vt,y as yt,z as jt,G as wt,H as Nt,J as kt,K as Pe,O as Be,P as Ve,Q as St,R as _t,T as Ct,V as We,W as qe,X as Rt,Y as Dt,Z as Tt,_ as It}from"./index-DPt6srxb.js";import{u as He,r as n,a as Ae,L as Lt}from"./vendor-react-CrHRjzzo.js";import{c as zt,g as At,m as Xe}from"./geolocation-DRm3QMsJ.js";import{a as $t,g as Et}from"./app-store-badge-CyCtXXOt.js";import{u as Ue}from"./useHomepageTemplates-BATUs1Zt.js";import{u as Mt}from"./usePageView-B1S102Z8.js";import{L as Je}from"./LocationPermissionDialog-DKr3c8K4.js";import{u as ve}from"./vendor-i18n-DWR4v88Y.js";import{P as Ot}from"./PullToRefresh-eghfMZXi.js";import{u as Ft}from"./vendor-query-EnOED-MY.js";import{P as Pt,a as Bt,b as Vt}from"./popover-DQizrdtZ.js";import{u as Wt,a as qt}from"./useRestaurants-cC_FA8AO.js";import{u as Ht,R as Xt,l as Ut}from"./xiaoxiong-logo-clean-DCTu0tdK.js";import{u as Jt}from"./useLocalizedContent-S0TAoDtX.js";import{u as Kt}from"./useActivities-BVrK1Gn7.js";import"./vendor-charts-C50LysBY.js";import"./vendor-supabase-QnE9GqXs.js";import"./vendor-map-hWrxZwzm.js";/* empty css                  */const _e="https://tzdgqhwyzsxkxnncgzap.supabase.co",fe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",Qt=["最近","附近","离我","距离","远近","近的","周边","周围","最近的","附近的","nearest","closest","nearby","near me","close to me","distance","around me","mais perto","próximo","perto de mim","distância","mais próximo"],Yt=()=>{const r="xiaoxiong_anonymous_user_id";let o=localStorage.getItem(r);return o||(o=`anon_${Date.now()}_${Math.random().toString(36).substring(2,11)}`,localStorage.setItem(r,o)),o},Gt=({open:r,onOpenChange:o,provider:m="ask-xiaoxiong"})=>{const{i18n:h}=ve(),d=He(),{settings:w}=Ee(),{user:_}=Ze(),R=Me(),u=w?.logo_url||et,[x,C]=n.useState(""),[v,b]=n.useState([]),[j,D]=n.useState(!1),[f,U]=n.useState(null),[J,M]=n.useState(!1),[$,P]=n.useState(null),[T,F]=n.useState(!1),[K,B]=n.useState(!1),I=n.useRef(null),Q=n.useRef(null),c=n.useRef(null),N=n.useRef(null),le=()=>{if(!K)return!1;const s=typeof window<"u"?window.innerWidth:1024,i=s>=768&&s<1024,t=s>=1024;return R?w?.voice_input_mobile!==!1:i?w?.voice_input_tablet!==!1:t?w?.voice_input_desktop!==!1:!0},be=()=>_?.id?_.id:Yt();n.useEffect(()=>{const s=window.SpeechRecognition||window.webkitSpeechRecognition;B(!!s)},[]),n.useEffect(()=>{r&&!f&&navigator.geolocation?.getCurrentPosition(s=>{U({lat:s.coords.latitude,lng:s.coords.longitude})},s=>{console.log("Unable to get user location:",s.message)},{enableHighAccuracy:!1,timeout:5e3,maximumAge:3e5})},[r,f]),n.useEffect(()=>{!r&&c.current&&(c.current.stop(),F(!1))},[r]),n.useEffect(()=>{N.current?.scrollIntoView({behavior:"smooth"})},[v]);const te=async(s,i)=>{const t=await fetch(`${_e}/functions/v1/ask-xiaoxiong`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${fe}`,apikey:fe},body:JSON.stringify({text:s.content,stream:!0,lat:f?.lat,lng:f?.lng}),signal:I.current?.signal});if(!t.ok)throw new Error(`Request failed with status: ${t.status}`);if(!t.body)throw new Error("No response body");const a=t.body.getReader(),l=new TextDecoder;let g="";for(;;){const{done:S,value:z}=await a.read();if(S)break;const he=l.decode(z,{stream:!0});g+=he;let A=g;A.startsWith('"')&&(A=A.slice(1)),A.endsWith('"')&&(A=A.slice(0,-1)),A=A.replace(/\\n/g,`
`),b(Y=>Y.map(q=>q.id===i?{...q,content:A}:q))}let y=g;y.startsWith('"')&&(y=y.slice(1)),y.endsWith('"')&&(y=y.slice(0,-1)),y=y.replace(/\\n/g,`
`),b(S=>S.map(z=>z.id===i?{...z,content:y,isStreaming:!1}:z))},se=async(s,i)=>{const t=be(),a=Date.now();console.log(`[前端-Agent] ⏱️ 开始发送请求: ${new Date().toISOString()}`);const l=await fetch(`${_e}/functions/v1/xiaoxiong-agent`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${fe}`,apikey:fe},body:JSON.stringify({message:s.content,userId:t}),signal:I.current?.signal}),g=Date.now()-a;if(console.log(`[前端-Agent] ⏱️ 收到响应头: ${new Date().toISOString()}, 耗时: ${g}ms`),!l.ok)throw new Error(`Request failed with status: ${l.status}`);if(!l.body)throw new Error("No response body");const y=l.body.getReader(),S=new TextDecoder;let z="",he=!1,A=0;for(;;){const{done:Y,value:q}=await y.read();if(Y){console.log(`[前端-Agent] ⏱️ 流结束: ${new Date().toISOString()}, 总耗时: ${Date.now()-a}ms, 共 ${A} 个数据块`);break}A++;const H=S.decode(q,{stream:!0});if(z+=H,!he){he=!0;const oe=Date.now()-a;console.log(`[前端-Agent] ⏱️ 首个数据块 (TTFB): ${new Date().toISOString()}, 耗时: ${oe}ms, 大小: ${H.length} 字符`)}Ae.flushSync(()=>{b(oe=>oe.map(ye=>ye.id===i?{...ye,content:z}:ye))}),await new Promise(oe=>requestAnimationFrame(oe))}b(Y=>Y.map(q=>q.id===i?{...q,isStreaming:!1}:q))},pe=async(s,i)=>{const t=Date.now();console.log(`[前端-LovableAI] ⏱️ 开始发送请求: ${new Date().toISOString()}`);const a=await fetch(`${_e}/functions/v1/lovable-chat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${fe}`,apikey:fe},body:JSON.stringify({message:s.content,lat:f?.lat,lng:f?.lng,language:h.language}),signal:I.current?.signal}),l=Date.now()-t;if(console.log(`[前端-LovableAI] ⏱️ 收到响应头: ${new Date().toISOString()}, 耗时: ${l}ms`),!a.ok){const A=await a.json().catch(()=>({}));throw new Error(A.error||`Request failed with status: ${a.status}`)}if(!a.body)throw new Error("No response body");const g=a.body.getReader(),y=new TextDecoder;let S="",z="",he=!1;for(;;){const{done:A,value:Y}=await g.read();if(A){console.log(`[前端-LovableAI] ⏱️ 流结束: ${new Date().toISOString()}, 总耗时: ${Date.now()-t}ms`);break}if(z+=y.decode(Y,{stream:!0}),!he){he=!0;const H=Date.now()-t;console.log(`[前端-LovableAI] ⏱️ 首个数据块 (TTFB): ${new Date().toISOString()}, 耗时: ${H}ms`)}let q;for(;(q=z.indexOf(`
`))!==-1;){let H=z.slice(0,q);if(z=z.slice(q+1),H.endsWith("\r")&&(H=H.slice(0,-1)),H.startsWith(":")||H.trim()===""||!H.startsWith("data: "))continue;const oe=H.slice(6).trim();if(oe==="[DONE]")break;try{const Re=JSON.parse(oe).choices?.[0]?.delta?.content;Re&&(S+=Re,Ae.flushSync(()=>{b(ke=>ke.map(Se=>Se.id===i?{...Se,content:S}:Se))}),await new Promise(ke=>requestAnimationFrame(ke)))}catch{z=H+`
`+z;break}}}b(A=>A.map(Y=>Y.id===i?{...Y,isStreaming:!1}:Y))},ae=s=>{const i=s.toLowerCase();return Qt.some(t=>i.includes(t))},ee=async s=>{const i={id:Date.now().toString(),role:"user",content:s},t=(Date.now()+1).toString(),a={id:t,role:"assistant",content:"",isStreaming:!0};b(l=>[...l,i,a]),C(""),D(!0),I.current&&I.current.abort(),I.current=new AbortController;try{m==="lovable-ai"?await pe(i,t):m==="xiaoxiong-agent"?await se(i,t):await te(i,t)}catch(l){if(l instanceof Error&&l.name==="AbortError"){console.log("Request aborted");return}console.error("Ask API error:",l);const g=h.language==="zh"?"抱歉，暂时无法获取结果，请稍后再试":h.language==="pt"?"Desculpe, não foi possível obter resultados. Tente novamente mais tarde.":"Sorry, unable to get results. Please try again later.";b(y=>y.map(S=>S.id===t?{...S,content:g,isStreaming:!1}:S))}finally{D(!1)}},ie=()=>{M(!1),navigator.geolocation?.getCurrentPosition(s=>{U({lat:s.coords.latitude,lng:s.coords.longitude}),$&&setTimeout(()=>{ee($),P(null)},100)},s=>{console.log("Location permission denied:",s.message),$&&(ee($),P(null))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},re=async()=>{if(!x.trim()||j)return;const s=x.trim();if(!f&&ae(s)){P(s),M(!0),C("");return}await ee(s)},ce=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),re())},p=()=>{const s=window.SpeechRecognition||window.webkitSpeechRecognition;if(!s){console.log("Speech recognition not supported");return}c.current&&c.current.stop();const i=new s;c.current=i;const t={zh:"zh-CN",en:"en-US",pt:"pt-BR"};i.lang=t[h.language]||"zh-CN",i.continuous=!1,i.interimResults=!0,i.onstart=()=>{F(!0)},i.onresult=a=>{const l=Array.from(a.results).map(g=>g[0].transcript).join("");C(l)},i.onerror=a=>{console.log("Speech recognition error:",a.error),F(!1)},i.onend=()=>{F(!1)},i.start()},L=()=>{c.current&&(c.current.stop(),F(!1))},V=()=>{T?L():p()},k=()=>{I.current&&I.current.abort(),o(!1)},de=s=>{k(),d(s)},E=s=>{const i=/\[([^\]]+)\]\(([^)]+)\)/g,t=[];let a=0,l,g=0;for(;(l=i.exec(s))!==null;){l.index>a&&t.push(e.jsx("span",{children:s.slice(a,l.index)},g++));const y=l[1],S=l[2];S.startsWith("/")?t.push(e.jsx("button",{onClick:()=>de(S),className:"text-primary hover:underline font-medium cursor-pointer",children:y},g++)):t.push(e.jsx("a",{href:S,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline font-medium",children:y},g++)),a=l.index+l[0].length}return a<s.length&&t.push(e.jsx("span",{children:s.slice(a)},g++)),t.length>0?t:[e.jsx("span",{children:s},"0")]},me=s=>s.replace(/\*\*(.*?)\*\*/g,"$1"),G=(s,i=20)=>s.length<=i?s:s.slice(0,i)+"...",ge=(s,i)=>{const t=g=>g.split("|").slice(1,-1).map(y=>me(y.trim())),a=t(s[0]),l=s.slice(2).map(t);return e.jsx("div",{className:"overflow-x-auto my-2 max-w-full",children:e.jsxs("table",{className:"w-full text-xs border border-border rounded-md overflow-hidden table-fixed",children:[e.jsx("thead",{className:"bg-muted/60",children:e.jsx("tr",{children:a.map((g,y)=>e.jsx("th",{className:"px-2 py-2 text-left font-semibold border-b border-border truncate max-w-[100px]",title:g,children:E(G(g,15))},y))})}),e.jsx("tbody",{children:l.map((g,y)=>e.jsx("tr",{className:"border-b border-border last:border-0 hover:bg-muted/30 transition-colors",children:g.map((S,z)=>e.jsx("td",{className:"px-2 py-2 truncate max-w-[100px]",title:S,children:E(G(S,18))},z))},y))})]})},i)},ne=s=>{const i=s.split(`
`),t=[];let a=0;for(;a<i.length;){const l=i[a];if(l.trim().startsWith("|")&&l.split("|").length>2){const g=[];for(;a<i.length&&i[a].trim().startsWith("|");)g.push(i[a]),a++;g.length>=2&&t.push(ge(g,t.length));continue}if(l.startsWith("### "))t.push(e.jsx("h3",{className:"text-base font-semibold mt-3 mb-1",children:E(l.slice(4))},t.length));else if(l.startsWith("## "))t.push(e.jsx("h2",{className:"text-lg font-bold mt-4 mb-2",children:E(l.slice(3))},t.length));else if(l.startsWith("# "))t.push(e.jsx("h1",{className:"text-xl font-bold mt-4 mb-2",children:E(l.slice(2))},t.length));else if(l.includes("**")){const g=l.split(/\*\*(.*?)\*\*/g);t.push(e.jsx("p",{className:"mb-1 leading-relaxed",children:g.map((y,S)=>S%2===1?e.jsx("strong",{className:"font-semibold",children:E(y)},S):E(y))},t.length))}else l.startsWith("- ")||l.startsWith("* ")?t.push(e.jsx("li",{className:"ml-4 mb-0.5 list-disc",children:E(l.slice(2))},t.length)):/^\d+\.\s/.test(l)?t.push(e.jsx("li",{className:"ml-4 mb-0.5 list-decimal",children:E(l.replace(/^\d+\.\s/,""))},t.length)):l.match(/^[-*_]{3,}$/)?t.push(e.jsx("hr",{className:"my-3 border-border"},t.length)):l.trim()===""?t.push(e.jsx("div",{className:"h-1"},t.length)):t.push(e.jsx("p",{className:"mb-1 leading-relaxed",children:E(l)},t.length));a++}return t},ue=()=>h.language==="zh"?"小熊AI助手":h.language==="pt"?"Assistente IA Xiaoxiong":"Xiaoxiong AI Assistant",W=()=>h.language==="zh"?"告诉小熊，你想吃什么...":h.language==="pt"?"Diga ao Xiaoxiong o que você quer comer...":"Tell Xiaoxiong what you want to eat...",xe=()=>h.language==="zh"?"你好，我是小熊，我来帮你推荐餐厅；比如：「我附近的寿司餐厅」":h.language==="pt"?"Olá, eu sou o Xiaoxiong, vou te ajudar a encontrar restaurantes; por exemplo: 「restaurantes de sushi perto de mim」":`Hi, I'm Xiaoxiong, I'll help you find restaurants; for example: "sushi restaurants near me"`;return e.jsx(tt,{open:r,onOpenChange:k,children:e.jsxs(st,{className:"w-full h-full max-w-full max-h-full sm:max-w-lg sm:h-[70vh] sm:max-h-[70vh] sm:rounded-lg rounded-none flex flex-col p-0 gap-0 overflow-hidden",children:[e.jsx(at,{className:"px-4 py-3 border-b shrink-0 bg-primary/5",children:e.jsxs(rt,{className:"flex items-center gap-2 text-base",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:u,alt:"Logo",className:"w-6 h-6 object-contain"})}),ue()]})}),e.jsx(Oe,{className:"flex-1 h-0",ref:Q,children:e.jsxs("div",{className:"p-4 space-y-4",children:[v.length===0&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(Ne,{className:"w-4 h-4 text-primary"})}),e.jsx("div",{className:"flex-1 bg-muted/50 rounded-2xl rounded-tl-sm px-4 py-3 text-sm",children:xe()})]}),v.map(s=>e.jsxs("div",{className:O("flex gap-3",s.role==="user"&&"flex-row-reverse"),children:[e.jsx("div",{className:O("w-8 h-8 rounded-full flex items-center justify-center shrink-0",s.role==="user"?"bg-primary text-primary-foreground":"bg-primary/10"),children:s.role==="user"?e.jsx(nt,{className:"h-4 w-4"}):e.jsx(Ne,{className:"h-4 w-4"})}),e.jsx("div",{className:O("flex-1 max-w-[85%] rounded-2xl px-4 py-3 text-sm",s.role==="user"?"bg-primary text-primary-foreground rounded-tr-sm":"bg-muted/50 rounded-tl-sm"),children:s.role==="assistant"?e.jsxs(e.Fragment,{children:[s.content?e.jsx("div",{className:"prose-sm",children:ne(s.content)}):e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(De,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:h.language==="zh"?"思考中...":h.language==="pt"?"Pensando...":"Thinking..."})]}),s.isStreaming&&s.content&&e.jsx("span",{className:"inline-block w-1.5 h-4 bg-primary/50 animate-pulse ml-0.5 align-middle"})]}):s.content})]},s.id)),e.jsx("div",{ref:N})]})}),e.jsx("div",{className:"p-4 bg-background shrink-0",children:e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full border border-border/50 bg-muted/20 shadow-sm hover:shadow-md transition-shadow duration-200",children:[le()&&e.jsx("button",{onClick:V,disabled:j,className:O("shrink-0 p-2 rounded-full transition-all duration-200 hover:bg-muted",T&&"text-destructive animate-pulse"),title:h.language==="zh"?T?"停止录音":"语音输入":h.language==="pt"?T?"Parar gravação":"Entrada de voz":T?"Stop recording":"Voice input",children:T?e.jsx(ot,{className:"h-5 w-5"}):e.jsx(lt,{className:"h-5 w-5 text-muted-foreground"})}),e.jsx("input",{value:x,onChange:s=>C(s.target.value),onKeyDown:ce,placeholder:T?h.language==="zh"?"正在聆听...":h.language==="pt"?"Ouvindo...":"Listening...":W(),disabled:j,className:"flex-1 bg-transparent border-0 outline-none text-foreground placeholder:text-muted-foreground",autoFocus:!0}),e.jsx("button",{onClick:re,disabled:!x.trim()||j,className:O("shrink-0 p-2 rounded-full transition-all duration-200",x.trim()&&!j?"text-primary hover:bg-primary/10":"text-muted-foreground/50"),children:j?e.jsx(De,{className:"h-5 w-5 animate-spin"}):e.jsx(it,{className:"h-5 w-5"})})]})}),e.jsx(Je,{open:J,onOpenChange:s=>{M(s),!s&&$&&(ee($),P(null))},onConfirm:ie})]})})},$e=({restaurant:r,language:o})=>{const[m,h]=n.useState(999),d=n.useRef(null),w=r.type.slice(0,3).map((u,x)=>({key:`type-${x}`,label:u,variant:"secondary",color:void 0}));n.useEffect(()=>{const u=()=>{if(!d.current)return;const C=d.current,v=Array.from(C.querySelectorAll(".tag-badge"));if(v.length===0){setTimeout(u,50);return}const b=v[0]?.offsetTop;let j=v.length;for(let D=0;D<v.length;D++)if(v[D].offsetTop>b){j=D;break}j<v.length&&(j=Math.max(1,j-1)),h(j)};h(999);const x=setTimeout(u,100);return window.addEventListener("resize",u),()=>{clearTimeout(x),window.removeEventListener("resize",u)}},[w.length,r.id]);const _=w.slice(0,m),R=w.length>m;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{ref:d,className:"flex gap-1.5 flex-wrap flex-1",children:_.map(u=>e.jsx(X,{variant:u.variant,className:"text-xs font-medium whitespace-nowrap tag-badge",style:u.color?{backgroundColor:u.color,color:"white"}:void 0,children:u.label},u.key))}),R&&e.jsxs(Pt,{children:[e.jsx(Bt,{asChild:!0,children:e.jsx(Z,{variant:"ghost",size:"sm",className:"h-6 px-2 text-muted-foreground hover:text-foreground flex-shrink-0",children:e.jsx(ht,{className:"h-4 w-4"})})}),e.jsx(Vt,{className:"w-80",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(u=>e.jsx(X,{variant:u.variant,className:"text-xs font-medium",style:u.color?{backgroundColor:u.color,color:"white"}:void 0,children:u.label},u.key))})})]})]})},Zt=()=>{const r=He(),{t:o,i18n:m}=ve(),{toast:h}=ct(),{localizeRestaurant:d}=Jt(),[w,_]=n.useState(""),[R,u]=n.useState([]),[x,C]=n.useState(null),[v,b]=n.useState([]),[j,D]=n.useState(null),[f,U]=n.useState(null),[J,M]=n.useState(!1),[$,P]=n.useState(!1),[T,F]=n.useState(!1),K=n.useRef(null),B=n.useRef(null),I=n.useRef({}),[Q,c]=n.useState(null),[N,le]=n.useState(!1),[be,te]=n.useState(!1),[se,pe]=n.useState(!1),[ae,ee]=n.useState(!1),ie=4,{data:re,isLoading:ce}=Wt(w,R.length>0?R.join(","):void 0),{data:p=[]}=qt(),{data:L=[]}=Kt(),{data:V={}}=Ht(),k=L.filter(t=>(V[t.id]||0)>0),de=t=>{u(a=>a.includes(t)?a.filter(l=>l!==t):[...a,t])},E=()=>{te(!0)},me=async()=>{te(!1);try{const t=await At();U({lat:t.coords.latitude,lng:t.coords.longitude}),h({title:o("restaurants.locationEnabled"),description:o("restaurants.sortByDistance")})}catch(t){console.error("Location error:",t)}},G=t=>{D(t),t&&!f&&E()},ge=async t=>{if(x===t)C(null),b([]);else{C(t);const{data:a,error:l}=await pt.from("activity_restaurants").select("restaurant_id").eq("activity_id",t);l?(console.error("Error fetching activity restaurants:",l),b([])):b(a.map(g=>g.restaurant_id))}},ne=re?.map(t=>{const a=d(t);if(f){const l=zt(f.lat,f.lng,t.lat,t.lng);return{...a,distance:l}}return a})||[],ue=x?ne.filter(t=>v.includes(t.id)):ne,W=j&&f?ue.filter(t=>t.distance&&t.distance<=j).sort((t,a)=>(t.distance||0)-(a.distance||0)):f?ue.sort((t,a)=>(t.distance||0)-(a.distance||0)):ue.sort((t,a)=>(a.rating||0)-(t.rating||0)),xe=t=>{r(`/restaurant/${t.id}`)},s=t=>{c(t.id);const a=I.current[t.id];a&&a.scrollIntoView({behavior:"smooth",block:"center"})},i=()=>{const t=document.getElementById("home-map-container");if(t)if(J)document.exitFullscreen&&document.exitFullscreen();else{if(K.current){const a=K.current.getCenter(),l=K.current.getZoom();B.current={center:[a.lng,a.lat],zoom:l}}t.requestFullscreen&&t.requestFullscreen()}};return n.useEffect(()=>{const t=()=>{const a=!!document.fullscreenElement;M(a),!a&&B.current&&K.current&&setTimeout(()=>{K.current?.jumpTo({center:B.current.center,zoom:B.current.zoom})},100)};return document.addEventListener("fullscreenchange",t),()=>{document.removeEventListener("fullscreenchange",t)}},[]),e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("div",{className:"text-left mb-8 sm:mb-10",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-primary mb-2 sm:mb-3",children:o("nav.mapView")}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:o("map.subtitle")})]}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx(dt,{placeholder:o("restaurants.search"),value:w,onChange:t=>_(t.target.value),className:"h-11 bg-background/60 backdrop-blur-sm border-primary/20 focus:border-primary"})}),e.jsxs("div",{className:"flex gap-2 md:contents",children:[e.jsxs(Z,{variant:f?"default":"outline",onClick:f?void 0:E,className:"flex-1 md:flex-initial gap-2 h-11 md:px-6",children:[e.jsx(je,{className:`w-4 h-4 ${f?"animate-pulse":""}`}),e.jsx("span",{className:"md:hidden",children:o("restaurants.getLocationMobile")}),e.jsx("span",{className:"hidden md:inline",children:o(f?"restaurants.locationEnabled":"restaurants.getLocation")})]}),e.jsxs(Z,{variant:N?"default":"outline",onClick:()=>le(!N),className:"flex-1 md:flex-initial gap-2 h-11 md:px-6",children:[e.jsx(mt,{className:"w-4 h-4"}),o("restaurants.filter")]})]})]}),N&&e.jsxs("div",{className:"space-y-3 bg-card/50 backdrop-blur-sm rounded-lg p-4 border border-border/50 animate-fade-in",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[o("restaurants.restaurantTypes"),":"]}),R.length>0&&e.jsx(X,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5",onClick:()=>u([]),children:o("common.actions.clearFilter")}),p.length>8&&e.jsx(Z,{variant:"ghost",size:"sm",className:"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200",onClick:()=>P(!$),children:o($?"common.showLess":"common.showMore")})]}),e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${$?"animate-expand-height":""}`,children:($?p:p.slice(0,8)).map((t,a)=>e.jsx(X,{variant:R.includes(t)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${R.includes(t)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${a*30}ms`},onClick:()=>de(t),children:t},t))}),e.jsxs("div",{className:"sm:hidden relative -mx-1 px-1",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth",children:p.map((t,a)=>e.jsx(X,{variant:R.includes(t)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${R.includes(t)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${a*30}ms`},onClick:()=>de(t),children:t},t))}),e.jsx("div",{className:"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none"})]})]})]}),k.length>0&&e.jsxs("div",{className:"space-y-2 pt-1 border-t border-border/30",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[o("nav.activities"),":"]}),x&&e.jsx(X,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5",onClick:()=>{C(null),b([])},children:o("common.actions.clearFilter")}),k.length>8&&e.jsx(Z,{variant:"ghost",size:"sm",className:"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200",onClick:()=>F(!T),children:o(T?"common.showLess":"common.showMore")})]}),e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${T?"animate-expand-height":""}`,children:(T?k:k.slice(0,8)).map((t,a)=>{const l=m.language==="zh"?t.badge_text_zh||t.title_zh:m.language==="pt"?t.badge_text_pt||t.title_pt:t.badge_text_en||t.title_en;return e.jsx(X,{variant:x===t.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${x===t.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${a*30}ms`},onClick:()=>ge(t.id),children:l},t.id)})}),e.jsxs("div",{className:"sm:hidden relative -mx-1 px-1",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth",children:k.map((t,a)=>{const l=m.language==="zh"?t.badge_text_zh||t.title_zh:m.language==="pt"?t.badge_text_pt||t.title_pt:t.badge_text_en||t.title_en;return e.jsx(X,{variant:x===t.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${x===t.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${a*30}ms`},onClick:()=>ge(t.id),children:l},t.id)})}),e.jsx("div",{className:"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none"})]})]})]})]}),f&&e.jsxs("div",{className:"flex gap-2 flex-wrap items-center bg-muted/30 backdrop-blur-sm rounded-lg p-3 border border-primary/10",children:[e.jsxs("span",{className:"text-sm font-semibold text-primary",children:[o("restaurants.radius"),":"]}),e.jsx(X,{variant:j===null?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>G(null),children:o("restaurants.allRestaurants")}),e.jsx(X,{variant:j===5?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>G(5),children:o("restaurants.radius5km")}),e.jsx(X,{variant:j===10?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>G(10),children:o("restaurants.radius10km")}),e.jsx(X,{variant:j===20?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>G(20),children:o("restaurants.radius20km")})]})]}),!ce&&W&&e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("div",{className:`w-full lg:flex-1 transition-all duration-300 ease-in-out ${se?"h-0 overflow-hidden lg:h-[500px]":"h-[400px] lg:h-[500px]"}`,children:e.jsxs("div",{id:"home-map-container",className:`${J?"fixed inset-0 z-50 bg-background":"w-full h-full"} rounded-xl overflow-hidden shadow-2xl border border-primary/10 relative group`,children:[e.jsx(Z,{variant:"secondary",size:"icon",className:"absolute bottom-4 right-4 z-10 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:i,children:J?e.jsx(ut,{className:"w-5 h-5"}):e.jsx(xt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"h-full relative",children:[e.jsx(Xt,{restaurants:W,onRestaurantClick:xe,userLocation:f,radiusFilter:j,onMarkerClick:s,showViewDetailsButton:!0,onMapInit:t=>{K.current=t}}),e.jsxs("div",{className:"absolute bottom-4 left-4 z-10 pointer-events-none flex items-center gap-2 bg-background/80 backdrop-blur-sm px-3 py-2 rounded-full shadow-lg",children:[e.jsx("img",{src:Ut,alt:"Xiaoxiong Market Logo",className:"h-6 w-6 object-contain"}),e.jsx("span",{className:"text-sm font-semibold text-foreground whitespace-nowrap",children:m.language==="zh"?"小熊市场":"Xiaoxiong Market"})]})]})]})}),e.jsx(Z,{variant:"outline",size:"sm",className:"lg:hidden flex items-center justify-center gap-2 -mt-3 mb-1",onClick:()=>pe(!se),children:se?e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-4 h-4"}),o("map.showMap")]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4"}),o("map.hideMap")]})}),e.jsxs("div",{className:"w-full lg:w-[420px] flex flex-col",children:[e.jsxs("div",{className:"mb-4 pb-4 border-b border-border",children:[e.jsxs("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(we,{className:"w-6 h-6 text-primary"}),o("restaurants.title"),e.jsx(X,{variant:"secondary",className:"ml-2",children:W.length})]}),f&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-2 flex items-center gap-1.5",children:[e.jsx(je,{className:"w-4 h-4"}),o("restaurants.sortedByDistance")]})]}),W.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(we,{className:"w-16 h-16 text-muted-foreground/40 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2",children:o("restaurants.noResults")}),e.jsx("p",{className:"text-muted-foreground max-w-xs",children:o("restaurants.noResultsDesc")})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lg:hidden space-y-3 pb-4",children:[(ae?W:W.slice(0,ie)).map(t=>e.jsx(Le,{ref:a=>I.current[t.id]=a,className:`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${Q===t.id?"border-primary ring-2 ring-primary ring-offset-2":"border-transparent"}`,onClick:()=>xe(t),children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-bold text-lg text-foreground line-clamp-1 flex-1",children:t.name}),t.distance!==void 0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full w-fit",children:[e.jsx(je,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.distance<1?`${(t.distance*1e3).toFixed(0)} m`:`${t.distance.toFixed(1)} km`})]})]}),t.rating>0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full flex-shrink-0",children:[e.jsx(ze,{className:"w-4 h-4",style:{fill:"#016450",color:"#016450"}}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.rating})]})]}),t.type&&t.type.length>0&&e.jsx($e,{restaurant:t,language:m.language}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx(we,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60"}),e.jsx("span",{className:"line-clamp-2",children:t.address})]})]})},t.id)),W.length>ie&&e.jsx(Z,{variant:"outline",className:"w-full mt-2 gap-2",onClick:()=>ee(!ae),children:ae?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4"}),o("map.collapseList")]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-4 h-4"}),o("map.showAllRestaurants",{count:W.length})]})})]}),e.jsx(Oe,{className:"hidden lg:block h-[420px] pr-4",children:e.jsx("div",{className:"space-y-3 pb-4",children:W.map(t=>e.jsx(Le,{ref:a=>I.current[t.id]=a,className:`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${Q===t.id?"border-primary ring-2 ring-primary ring-offset-2":"border-transparent"}`,onClick:()=>xe(t),children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-bold text-lg text-foreground line-clamp-1 flex-1",children:t.name}),t.distance!==void 0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full w-fit",children:[e.jsx(je,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.distance<1?`${(t.distance*1e3).toFixed(0)} m`:`${t.distance.toFixed(1)} km`})]})]}),t.rating>0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full flex-shrink-0",children:[e.jsx(ze,{className:"w-4 h-4",style:{fill:"#016450",color:"#016450"}}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.rating})]})]}),t.type&&t.type.length>0&&e.jsx($e,{restaurant:t,language:m.language}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx(we,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60"}),e.jsx("span",{className:"line-clamp-2",children:t.address})]})]})},t.id))})})]})]})]}),e.jsx(Je,{open:be,onOpenChange:te,onConfirm:me})]})},es=({open:r,onOpenChange:o,onConfirm:m,siteName:h,url:d})=>{const{t:w}=ve();let _=h||"";if(d)try{_=new URL(d).hostname}catch{_=d}return e.jsx(gt,{open:r,onOpenChange:o,children:e.jsxs(ft,{className:"max-w-md",children:[e.jsxs(bt,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-full bg-primary/10",children:e.jsx(Fe,{className:"w-5 h-5 text-primary"})}),e.jsx(vt,{children:w("externalLink.confirmTitle")})]}),e.jsx(yt,{className:"text-left",children:w("externalLink.confirmDescription",{site:_})})]}),e.jsxs(jt,{className:"flex-col sm:flex-row gap-2",children:[e.jsx(wt,{className:"w-full sm:w-auto",children:w("common.cancel")}),e.jsx(Nt,{onClick:m,className:"w-full sm:w-auto",children:w("externalLink.continue")})]})]})})},Ke=n.memo(({stats:r,onAskXiaoxiong:o})=>{const{t:m,i18n:h}=ve(),{data:d}=Ue(),{buttons:w}=kt(),_=h.language,[R,u]=n.useState(!1),x=w?.find(M=>M.label_zh==="演示"||M.link?.includes("v.xiaoxiong.pt")),C=x&&x.enabled!==!1&&x.visible!==!1&&x.show_on_mobile!==!1,v=()=>x?_==="zh"?x.label_zh:_==="pt"?x.label_pt:x.label_en:m("home.hero.demo","前往演示"),b=M=>!d||d.length===0?"":d[0][`${M}${_==="zh"?"_zh":_==="pt"?"_pt":"_en"}`]||"",j=b("title")||m("home.hero.title"),D=b("description")||m("home.hero.description"),f=b("subtitle_button_text")||m("home.hero.subtitle"),U=()=>{u(!0)},J=()=>{x?.link&&St(x.link),u(!1)};return e.jsxs("section",{className:"min-h-[70vh] flex flex-col bg-secondary/20",children:[e.jsxs("div",{className:"pt-20 px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-bold text-foreground",children:m("home.hero.brandName")}),e.jsx("img",{src:Xe,alt:"map icon",width:28,height:28,loading:"eager",decoding:"async",className:"w-7 h-7 object-contain flex-shrink-0"})]}),C&&x&&e.jsxs(Z,{variant:"outline",size:"sm",className:"gap-1.5 text-xs",onClick:U,children:[e.jsx(Fe,{className:"w-3.5 h-3.5"}),v()]})]}),r&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Pe,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:m("home.stats.delivery")}),e.jsx("span",{className:"font-bold text-foreground text-sm",children:r.order_count})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Be,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:m("home.stats.reservation")}),e.jsx("span",{className:"font-bold text-foreground text-sm",children:r.reserve_count})]})]})]}),e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-4 py-8",children:e.jsxs("div",{className:"max-w-md mx-auto text-center space-y-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground leading-tight",children:j}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground max-w-sm mx-auto",children:D}),e.jsx("div",{className:"pt-4",children:e.jsxs("button",{onClick:o,className:"group flex items-center gap-3 bg-secondary/50 backdrop-blur-sm text-foreground px-5 py-3.5 rounded-full shadow-sm hover:shadow-md hover:bg-secondary/70 transition-all duration-300 cursor-text border border-border/50 mx-auto",children:[e.jsx(Ne,{className:"w-5 h-5 text-primary group-hover:text-primary/80 transition-colors"}),e.jsx("span",{className:"text-sm text-muted-foreground group-hover:text-foreground transition-colors",children:f}),e.jsx(Ve,{className:"w-4 h-4 text-muted-foreground/60 ml-2"})]})})]})}),e.jsx(es,{open:R,onOpenChange:u,onConfirm:J,url:x?.link})]})});Ke.displayName="MobileHeroSection";const Ce="/images/sushi-ramen-hero.jpg",Qe="/images/sushi-ramen-mobile.jpg",Ye=n.memo(({stats:r,t:o})=>e.jsx("div",{className:"absolute top-16 sm:top-20 left-3 z-20",children:e.jsxs("div",{className:"gap-4 w-fit flex-col flex items-start justify-start",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm text-white/90 drop-shadow-md",children:o("home.stats.delivery")}),e.jsx("span",{className:"font-bold text-white text-sm drop-shadow-md",children:r.order_count})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-sm text-white/90 drop-shadow-md",children:o("home.stats.reservation")}),e.jsx("span",{className:"font-bold text-white text-sm drop-shadow-md",children:r.reserve_count})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl sm:text-2xl font-bold text-white drop-shadow-md",children:o("home.hero.brandName")}),e.jsx("img",{src:Xe,alt:"map icon",width:32,height:32,loading:"eager",decoding:"async",className:"w-7 sm:w-8 h-7 sm:h-8 object-contain flex-shrink-0"})]})]})}));Ye.displayName="StatsDisplay";const ts=()=>{const r=window.innerWidth<640,o=window.innerWidth>=1024,m=navigator.connection,h=qe(),d=We();return o?!!m?.saveData:!!(d&&!h||m&&(m.saveData||m.effectiveType==="2g"||m.effectiveType==="slow-2g")||r&&navigator.deviceMemory&&navigator.deviceMemory<2)},Ge=n.memo(({template:r,isActive:o,currentLang:m,t:h,onContentReady:d,onAskXiaoxiong:w})=>{const[_,R]=n.useState({}),[u,x]=n.useState({}),[C,v]=n.useState({}),[b,j]=n.useState({mobile:!0,tablet:!0,desktop:!0}),[D,f]=n.useState(!1),U=ts(),J=n.useRef(null),M=n.useRef(null),$=n.useRef(null),P=p=>r[`${p}${m==="zh"?"_zh":m==="pt"?"_pt":"_en"}`]||"",T=()=>window.innerWidth<640?"mobile":window.innerWidth<1024?"tablet":"desktop",F=()=>{const p=T();return p==="mobile"&&r.mobile_overlay_opacity!==null?r.mobile_overlay_opacity:p==="tablet"&&r.tablet_overlay_opacity!==null?r.tablet_overlay_opacity:p==="desktop"&&r.desktop_overlay_opacity!==null?r.desktop_overlay_opacity:r.overlay_opacity??30},K=()=>{const p=F(),L=r.overlay_gradient_direction||"to-b",V=(s,i)=>s==null?i/100:s>1?s/100:s,k=p>1?p/100:p,de=V(r.overlay_gradient_from_opacity,30)*k,E=V(r.overlay_gradient_via_opacity,25)*k,me=V(r.overlay_gradient_to_opacity,40)*k,ge={"to-t":"to top","to-b":"to bottom","to-l":"to left","to-r":"to right","to-tl":"to top left","to-tr":"to top right","to-bl":"to bottom left","to-br":"to bottom right"}[L]||"to bottom",ne={black:"0, 0, 0",white:"255, 255, 255",background:"0, 0, 0",foreground:"255, 255, 255",primary:"1, 100, 80",secondary:"240, 240, 240"},ue=ne[r.overlay_gradient_from||"black"]||"0, 0, 0",W=ne[r.overlay_gradient_via||"black"]||"0, 0, 0",xe=ne[r.overlay_gradient_to||"black"]||"0, 0, 0";return{background:`linear-gradient(${ge}, rgba(${ue}, ${de}), rgba(${W}, ${E}), rgba(${xe}, ${me}))`}},B=r.mobile_image_url||Qe,I=r.tablet_image_url||r.desktop_image_url||Ce,Q=r.desktop_image_url||Ce,c=r.background_blur||0,N=r.desktop_media_type||r.media_type||"image",le=r.tablet_media_type||r.media_type||"image",be=r.mobile_media_type||r.media_type||"image",te=N==="video"&&!U,se=le==="video"&&!U,pe=be==="video"&&!U,ae=pe?r.mobile_video_url:null,ee=se?r.tablet_video_url||r.desktop_video_url:null,ie=te?r.desktop_video_url:null;n.useEffect(()=>{const p=T(),L=p==="mobile"?B:p==="tablet"?I:Q;if(L){const V=new Image;V.onload=()=>{R(k=>({...k,[p]:!0})),j(k=>({...k,[p]:!0})),o&&(d?.(),setTimeout(()=>f(!0),100))},V.src=L}},[B,I,Q,o,d]),n.useEffect(()=>{o&&_[T()]&&f(!0)},[o,_]);const re=p=>{x(L=>({...L,[p]:!0}))},ce=(p,L)=>{console.error(`[HeroSlide] Video error on ${p}:`,L),v(V=>({...V,[p]:!0}))};return n.useEffect(()=>{if(!D||!o||!It())return;const L=T(),k=(L==="mobile"?J:L==="tablet"?M:$).current;if(!k)return;const E=setTimeout(async()=>{try{k.muted=!0,k.playsInline=!0,k.setAttribute("webkit-playsinline","true"),await k.play(),console.log(`[HeroSlide] iOS video play successful on ${L}`)}catch(me){console.error(`[HeroSlide] iOS video play failed on ${L}:`,me),v(G=>({...G,[L]:!0}))}},150);return()=>clearTimeout(E)},[D,o]),e.jsxs("div",{className:O("absolute inset-0 w-full h-full transition-opacity duration-1000",o?"opacity-100 z-10":"opacity-0 z-0"),children:[e.jsxs("div",{className:"absolute inset-0 w-full h-full",children:[e.jsxs("div",{className:"absolute inset-0 w-full h-full sm:hidden",children:[!b.mobile&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),pe&&ae?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:B,alt:"Background",className:O("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",u.mobile&&!C.mobile?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:c>0?`blur(${c}px)`:void 0}}),D&&!C.mobile&&e.jsx("video",{ref:J,src:ae,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>re("mobile"),onError:p=>ce("mobile",p),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:c>0?`blur(${c}px)`:void 0}})]}):e.jsx("img",{src:B,alt:"Background",className:O("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",b.mobile?"opacity-100":"opacity-0"),style:{filter:c>0?`blur(${c}px)`:void 0}})]}),e.jsxs("div",{className:"absolute inset-0 w-full h-full hidden sm:block lg:hidden",children:[!b.tablet&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),se&&ee?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:I,alt:"Background",className:O("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",u.tablet&&!C.tablet?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:c>0?`blur(${c}px)`:void 0}}),D&&!C.tablet&&e.jsx("video",{ref:M,src:ee,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>re("tablet"),onError:p=>ce("tablet",p),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:c>0?`blur(${c}px)`:void 0}})]}):e.jsx("img",{src:I,alt:"Background",className:O("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",b.tablet?"opacity-100":"opacity-0"),style:{filter:c>0?`blur(${c}px)`:void 0}})]}),e.jsxs("div",{className:"absolute inset-0 w-full h-full hidden lg:block",children:[!b.desktop&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),te&&ie?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:Q,alt:"Background",className:O("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",u.desktop&&!C.desktop?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:c>0?`blur(${c}px)`:void 0}}),D&&!C.desktop&&e.jsx("video",{ref:$,src:ie,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>re("desktop"),onError:p=>ce("desktop",p),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:c>0?`blur(${c}px)`:void 0}})]}):e.jsx("img",{src:Q,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:O("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",b.desktop?"opacity-100":"opacity-0"),style:{filter:c>0?`blur(${c}px)`:void 0}})]}),e.jsx("div",{className:"absolute inset-0 w-full h-full",style:K()})]}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full",children:[e.jsx("h1",{className:"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]",children:P("title")||h("home.hero.title")}),e.jsx("p",{className:"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]",children:P("description")||h("home.hero.description")}),r.subtitle_button_text_zh&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:w,className:"group flex items-center gap-3 bg-white/20 backdrop-blur-xl text-white px-5 sm:px-7 py-3.5 sm:py-4 rounded-full shadow-[0_8px_32px_rgba(0,0,0,0.12)] hover:shadow-[0_16px_48px_rgba(0,0,0,0.2)] hover:bg-white/30 transition-all duration-300 cursor-text border border-white/40",children:[e.jsx(Ne,{className:"w-5 h-5 text-white/90 group-hover:text-white transition-colors drop-shadow-sm"}),e.jsx("span",{className:"text-sm sm:text-base text-primary group-hover:text-primary/80 transition-colors drop-shadow-sm font-medium",children:P("subtitle_button_text")||h("home.hero.subtitle")}),e.jsx(Ve,{className:"w-4 h-4 text-white/60 ml-2 drop-shadow-sm"})]})})]})})]})});Ge.displayName="HeroSlide";const ws=()=>{const{t:r,i18n:o}=ve(),m=Ft(),{settings:h}=Ee(),{data:d,isLoading:w,refetch:_}=Ue(),[R,u]=n.useState(0),[x,C]=n.useState(null),v=n.useRef(null),[b,j]=n.useState(!1),[D,f]=n.useState(!1),U=Me(),{isWebView:J}=_t(),M=U||J,$=h?.ai_assistant_enabled!==!1,P=h?.ai_provider||"ask-xiaoxiong",T=n.useCallback(()=>{j(!0)},[]);Mt({pageType:"home"});const F=n.useCallback(async()=>{try{const N=await(await fetch("https://v.xiaoxiong.pt/api/get_info")).json();N&&C({order_count:N.order_count||0,reserve_count:N.reserve_count||0})}catch(c){console.error("Failed to fetch stats:",c)}},[]);n.useEffect(()=>{F()},[F]);const K=n.useCallback(async()=>{await Promise.all([_(),F(),m.invalidateQueries({queryKey:["restaurants"]}),m.invalidateQueries({queryKey:["activities"]})])},[_,F,m]);n.useEffect(()=>{if(!d||d.length<=1)return;const N=d[R]?.duration||5e3;return v.current=setTimeout(()=>{u(le=>(le+1)%d.length)},N),()=>{v.current&&clearTimeout(v.current)}},[d,R]);const B=n.useCallback(c=>{v.current&&clearTimeout(v.current),u(c)},[]);n.useCallback(()=>{d&&(v.current&&clearTimeout(v.current),u(c=>(c-1+d.length)%d.length))},[d]),n.useCallback(()=>{d&&(v.current&&clearTimeout(v.current),u(c=>(c+1)%d.length))},[d]);const I=o.language,Q=d&&d.length>1;return e.jsx(Ot,{onRefresh:K,children:e.jsxs("div",{className:"min-h-screen",children:[M?e.jsx(Ke,{stats:x,onAskXiaoxiong:()=>f(!0)}):e.jsxs("section",{className:"relative h-screen flex items-start overflow-hidden bg-background",children:[x&&e.jsx(Ye,{stats:x,t:r}),e.jsx("div",{className:O("absolute inset-0 w-full h-full transition-opacity duration-500",b?"opacity-100":"opacity-0"),children:d?.map((c,N)=>e.jsx(Ge,{template:c,isActive:N===R,currentLang:I,t:r,onContentReady:N===0?T:void 0,onAskXiaoxiong:()=>f(!0)},c.id))}),e.jsx("div",{className:O("absolute inset-0 w-full h-full z-20 transition-opacity duration-500",w||!b?"opacity-100":"opacity-0 pointer-events-none"),children:e.jsx(Ct,{})}),!w&&(!d||d.length===0)&&e.jsxs("div",{className:"absolute inset-0 w-full h-full",children:[e.jsx("img",{src:Qe,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:"absolute inset-0 w-full h-full object-cover object-center sm:hidden"}),e.jsx("img",{src:Ce,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:"absolute inset-0 w-full h-full object-cover object-center hidden sm:block"}),e.jsx("div",{className:"absolute inset-0 w-full h-full bg-gradient-to-b from-black/30 via-black/25 to-black/40"}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 flex items-center min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full",children:[e.jsx("h1",{className:"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]",children:r("home.hero.title")}),e.jsx("p",{className:"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]",children:r("home.hero.description")})]})})]}),Q&&e.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 z-30 flex gap-2",children:d.map((c,N)=>e.jsx("button",{onClick:()=>B(N),className:O("w-3 h-3 rounded-full transition-all duration-300",N===R?"bg-white w-8":"bg-white/50 hover:bg-white/70"),"aria-label":`Go to slide ${N+1}`},N))})]}),e.jsx("section",{className:"py-12 sm:py-20 px-4 bg-secondary/20",children:e.jsx("div",{className:"container mx-auto max-w-7xl",children:e.jsx(Zt,{})})}),!We()&&!qe()&&e.jsxs("section",{className:"py-16 sm:py-24 px-4 bg-gradient-to-br from-primary/5 via-background to-primary/10 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-1/4 w-72 h-72 bg-primary/10 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-primary/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute top-1/2 left-0 w-32 h-32 bg-primary/20 rounded-full blur-2xl -translate-y-1/2"}),e.jsx("div",{className:"absolute top-1/2 right-0 w-32 h-32 bg-primary/20 rounded-full blur-2xl -translate-y-1/2"}),e.jsx("div",{className:"container mx-auto max-w-5xl relative z-10",children:e.jsx("div",{className:"flex flex-col items-center justify-center gap-8",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-primary/10 text-primary text-sm font-medium px-4 py-2 rounded-full mb-4",children:[e.jsx(Rt,{className:"w-4 h-4"}),e.jsx("span",{children:"Mobile App"})]}),e.jsx("h3",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-foreground mb-4",children:r("home.app.title")}),e.jsx("p",{className:"text-base sm:text-lg text-muted-foreground mb-8 leading-relaxed",children:r("home.app.description")}),e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:[e.jsxs("a",{href:"https://apps.apple.com/cn/app/xiaoxiong/id6755481369",target:"_blank",rel:"noopener noreferrer",className:"relative group",children:[e.jsx("div",{className:"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity"}),e.jsx("div",{className:"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center",children:e.jsx("img",{src:$t,alt:"Download on the App Store",className:"h-8 sm:h-9"})})]}),e.jsxs("a",{href:"https://play.google.com/store/apps/details?id=com.xiaoxiong.market",target:"_blank",rel:"noopener noreferrer",className:"relative group",children:[e.jsx("div",{className:"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity"}),e.jsx("div",{className:"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center",children:e.jsx("img",{src:Et,alt:"Get it on Google Play",className:"h-12 sm:h-14"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Dt,{className:"w-4 h-4 animate-bounce"}),e.jsx("span",{children:r("home.app.downloadNow")})]})]})]})})})]}),e.jsxs("section",{className:"py-16 sm:py-20 px-4 bg-gradient-to-br from-primary via-primary-glow to-primary-light relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("div",{className:"absolute top-0 right-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl"}),e.jsxs("div",{className:"container mx-auto max-w-4xl text-center relative z-10",children:[e.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-primary-foreground mb-4 sm:mb-6 px-4",children:r("home.cta.title")}),e.jsx("p",{className:"text-base sm:text-xl text-primary-foreground/90 mb-6 sm:mb-8 max-w-2xl mx-auto px-4",children:r("home.cta.description")}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Z,{size:"lg",variant:"secondary",asChild:!0,className:"text-base sm:text-lg shadow-xl hover:shadow-2xl",children:e.jsxs(Lt,{to:"/join-us",children:[e.jsx(Tt,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),r("home.cta.button")]})})})]})]}),$&&e.jsx(Gt,{open:D,onOpenChange:f,provider:P})]})})};export{ws as default};
//# sourceMappingURL=Home-BHCmlpX0.js.map
