{"version":3,"file":"useSavedRecipes-DmNDhRhv.js","sources":["../../src/hooks/useSavedRecipes.ts"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { toast } from \"sonner\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { AIRecipeSuggestion } from \"@/hooks/useAIRecipe\";\r\n\r\nexport interface SavedRecipe {\r\n  id: string;\r\n  user_id: string;\r\n  recipe_name: string;\r\n  recipe_data: AIRecipeSuggestion;\r\n  created_at: string;\r\n}\r\n\r\nexport const useSavedRecipes = () => {\r\n  const { user } = useAuth();\r\n  const { t } = useTranslation();\r\n  const queryClient = useQueryClient();\r\n\r\n  const query = useQuery({\r\n    queryKey: [\"saved-recipes\", user?.id],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"saved_recipes\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", user!.id)\r\n        .order(\"created_at\", { ascending: false });\r\n      if (error) throw error;\r\n      return data as unknown as SavedRecipe[];\r\n    },\r\n    enabled: !!user,\r\n  });\r\n\r\n  const saveMutation = useMutation({\r\n    mutationFn: async (recipe: AIRecipeSuggestion) => {\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n      const { data, error } = await supabase\r\n        .from(\"saved_recipes\")\r\n        .insert({\r\n          user_id: user.id,\r\n          recipe_name: recipe.recipe_name,\r\n          recipe_data: recipe as unknown as any,\r\n        } as any)\r\n        .select()\r\n        .single();\r\n      if (error) throw error;\r\n      return data;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"saved-recipes\"] });\r\n      toast.success(t(\"aiRecipe.recipeSaved\", \"食谱已保存\"));\r\n    },\r\n    onError: () => {\r\n      toast.error(t(\"aiRecipe.saveError\", \"保存失败\"));\r\n    },\r\n  });\r\n\r\n  const deleteMutation = useMutation({\r\n    mutationFn: async (id: string) => {\r\n      const { error } = await supabase\r\n        .from(\"saved_recipes\")\r\n        .delete()\r\n        .eq(\"id\", id);\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"saved-recipes\"] });\r\n      toast.success(t(\"aiRecipe.recipeDeleted\", \"食谱已删除\"));\r\n    },\r\n  });\r\n\r\n  return {\r\n    savedRecipes: query.data || [],\r\n    isLoading: query.isLoading,\r\n    saveRecipe: saveMutation.mutateAsync,\r\n    deleteRecipe: deleteMutation.mutateAsync,\r\n    isSaving: saveMutation.isPending,\r\n  };\r\n};\r\n"],"names":["useSavedRecipes","user","useAuth","t","useTranslation","queryClient","useQueryClient","query","useQuery","data","error","supabase","saveMutation","useMutation","recipe","toast","deleteMutation","id"],"mappings":"0HAeO,MAAMA,EAAkB,IAAM,CAC7B,KAAA,CAAE,KAAAC,GAASC,IACX,CAAE,EAAAC,GAAMC,IACRC,EAAcC,IAEdC,EAAQC,EAAS,CACrB,SAAU,CAAC,gBAAiBP,GAAM,EAAE,EACpC,QAAS,SAAY,CACb,KAAA,CAAE,KAAAQ,EAAM,MAAAC,GAAU,MAAMC,EAC3B,KAAK,eAAe,EACpB,OAAO,GAAG,EACV,GAAG,UAAWV,EAAM,EAAE,EACtB,MAAM,aAAc,CAAE,UAAW,EAAA,CAAO,EAC3C,GAAIS,EAAa,MAAAA,EACV,OAAAD,CACT,EACA,QAAS,CAAC,CAACR,CAAA,CACZ,EAEKW,EAAeC,EAAY,CAC/B,WAAY,MAAOC,GAA+B,CAChD,GAAI,CAACb,EAAY,MAAA,IAAI,MAAM,mBAAmB,EACxC,KAAA,CAAE,KAAAQ,EAAM,MAAAC,GAAU,MAAMC,EAC3B,KAAK,eAAe,EACpB,OAAO,CACN,QAASV,EAAK,GACd,YAAaa,EAAO,YACpB,YAAaA,CAAA,CACP,EACP,SACA,SACH,GAAIJ,EAAa,MAAAA,EACV,OAAAD,CACT,EACA,UAAW,IAAM,CACfJ,EAAY,kBAAkB,CAAE,SAAU,CAAC,eAAe,CAAG,CAAA,EAC7DU,EAAM,QAAQZ,EAAE,uBAAwB,OAAO,CAAC,CAClD,EACA,QAAS,IAAM,CACbY,EAAM,MAAMZ,EAAE,qBAAsB,MAAM,CAAC,CAC7C,CAAA,CACD,EAEKa,EAAiBH,EAAY,CACjC,WAAY,MAAOI,GAAe,CAChC,KAAM,CAAE,MAAAP,CAAA,EAAU,MAAMC,EACrB,KAAK,eAAe,EACpB,SACA,GAAG,KAAMM,CAAE,EACd,GAAIP,EAAa,MAAAA,CACnB,EACA,UAAW,IAAM,CACfL,EAAY,kBAAkB,CAAE,SAAU,CAAC,eAAe,CAAG,CAAA,EAC7DU,EAAM,QAAQZ,EAAE,yBAA0B,OAAO,CAAC,CACpD,CAAA,CACD,EAEM,MAAA,CACL,aAAcI,EAAM,MAAQ,CAAC,EAC7B,UAAWA,EAAM,UACjB,WAAYK,EAAa,YACzB,aAAcI,EAAe,YAC7B,SAAUJ,EAAa,SAAA,CAE3B"}