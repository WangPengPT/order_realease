const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RestaurantComments-DkL6xiTt.js","assets/vendor-react-Hsdnn-sD.js","assets/vendor-i18n-jtdHZIRR.js","assets/vendor-editor-B1vH4T8i.js","assets/vendor-utils-Z4kpnli5.js","assets/vendor-react-CG6K1Se3.css","assets/index-DNQsNrYF.js","assets/vendor-supabase-BVdpxhZP.js","assets/index-CCQJcoy1.css","assets/ReportDialog-DefvjdKf.js","assets/input-otp-BTJyHfxQ.js","assets/useSensitiveWords-4EqIZaNd.js"])))=>i.map(i=>d[i]);
import{n as o,C as S,v as W,w as R,M as De,e as fs,s as js,b as Ye,B as f,D as Ns,d as bs,g as ws,k as z,_ as Xe,u as vs,N as ys,O as Ge,t as ks,y as $,z as M,E as A,F as P,G as E,J as F,L as G,o as fe,K as U,P as _s,Q as Cs,R as Ds,T as q,U as Ue}from"./index-DNQsNrYF.js";import{j as e,p as Z,b1 as le,bi as Ss,s as Rs,r as n,bj as zs,bk as Is,bl as Ts,av as B,aq as Ls,X as Os,bm as Se,W as $s,L as re,bn as Q,bg as Qe,bo as Ms,bp as As,bq as Ps,b4 as ne,b0 as Ze,y as Je,b6 as ae,aL as te,br as Es,aN as Fs,u as Gs,w as ee,bs as qe,bt as We,bu as Us,aY as Ce,bv as qs,bh as Ws,bw as Be,bx as Bs}from"./vendor-react-Hsdnn-sD.js";import{S as je}from"./separator-BjpLaIT9.js";import{C as V,a as H,b as K}from"./collapsible-CLDFXLwJ.js";import{d as Vs,b as Hs,c as Ks}from"./useRestaurants-CAoMVwdD.js";import{u as es,R as Ve}from"./ReportDialog-DefvjdKf.js";import{u as Re}from"./useLocalizedContent-D-CDxH29.js";import{f as Ys}from"./timeUtils-pgRxO0UB.js";import{g as Xs,c as Qs,o as Zs,m as Js}from"./geolocation-DRm3QMsJ.js";import{m as se}from"./vendor-map-CvE3ASYw.js";import{u as ea}from"./usePageView-DMkTcRKf.js";import{u as sa}from"./useActivityParticipation-HRj5BaJ6.js";import{u as aa,R as He}from"./RestaurantFormDialog-Y6ZvveIm.js";import{C as ta,a as ra,b as na,c as la,d as ia}from"./carousel-DChhEBZN.js";import"./vendor-utils-Z4kpnli5.js";import"./vendor-supabase-BVdpxhZP.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-i18n-jtdHZIRR.js";import"./input-otp-BTJyHfxQ.js";import"./checkbox-3JW9vGeb.js";import"./switch-B0a39gcj.js";import"./radio-group-Dub7bPix.js";import"./tabs-ChHCVzdT.js";import"./RichTextEditor-DvMVo8fs.js";const oa=()=>e.jsxs("div",{className:"min-h-screen bg-background pb-8",children:[e.jsxs("div",{className:"relative h-[30vh] sm:h-[35vh] overflow-hidden",children:[e.jsx(o,{className:"w-full h-full rounded-none"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/80 to-transparent"}),e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx(o,{className:"h-10 w-10 rounded-md"})}),e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[e.jsx(o,{className:"h-10 w-10 rounded-md"}),e.jsx(o,{className:"h-10 w-10 rounded-md"})]})]}),e.jsxs("div",{className:"container mx-auto px-4 -mt-16 relative z-10",children:[e.jsxs(S,{className:"shadow-large",children:[e.jsx(W,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-3 flex flex-wrap gap-2",children:[e.jsx(o,{className:"h-6 w-16 rounded-full"}),e.jsx(o,{className:"h-6 w-20 rounded-full"}),e.jsx(o,{className:"h-6 w-14 rounded-full"})]}),e.jsx(o,{className:"h-9 w-64 mb-3"}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx(o,{className:"h-5 w-20"}),e.jsx(o,{className:"h-5 w-24"}),e.jsx(o,{className:"h-5 w-16"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{className:"h-10 w-28 rounded-md"}),e.jsx(o,{className:"h-10 w-10 rounded-md"})]})]})}),e.jsxs(R,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"h-5 w-24"}),e.jsx(o,{className:"h-16 w-full rounded-md"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"h-5 w-32"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{className:"h-8 w-24 rounded-full"}),e.jsx(o,{className:"h-8 w-28 rounded-full"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(o,{className:"h-5 w-full"}),e.jsx(o,{className:"h-5 w-3/4"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{className:"h-5 w-5 flex-shrink-0"}),e.jsx(o,{className:"h-5 w-32"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(o,{className:"h-5 w-40"}),e.jsx(o,{className:"h-5 w-48"})]})]})]})]})]}),e.jsxs(S,{className:"mt-6 shadow-large",children:[e.jsx(W,{children:e.jsx(o,{className:"h-6 w-20"})}),e.jsx(R,{children:e.jsx(o,{className:"h-[200px] w-full rounded-lg"})})]}),e.jsxs(S,{className:"mt-6 shadow-large",children:[e.jsx(W,{children:e.jsx(o,{className:"h-6 w-24"})}),e.jsx(R,{children:e.jsx("div",{className:"flex gap-3 overflow-hidden",children:[1,2,3,4].map(r=>e.jsx(o,{className:"h-24 w-24 rounded-lg flex-shrink-0"},r))})})]}),e.jsxs(S,{className:"mt-6 shadow-large",children:[e.jsxs(W,{className:"flex flex-row items-center justify-between",children:[e.jsx(o,{className:"h-6 w-32"}),e.jsx(o,{className:"h-9 w-24 rounded-md"})]}),e.jsx(R,{className:"space-y-4",children:[1,2,3].map(r=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx(o,{className:"h-10 w-10 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{className:"h-4 w-24"}),e.jsx(o,{className:"h-4 w-16"})]}),e.jsx(o,{className:"h-4 w-full"}),e.jsx(o,{className:"h-4 w-3/4"})]})]},r))})]})]})]}),ca=[{value:"0-5",label:"0-5€"},{value:"5-10",label:"5-10€"},{value:"10-15",label:"10-15€"},{value:"15-20",label:"15-20€"},{value:"20-25",label:"20-25€"},{value:"25-30",label:"25-30€"},{value:"30-40",label:"30-40€"},{value:"40-50",label:"40-50€"},{value:"50+",label:"50€+"}],ss=({restaurantId:r})=>{const{t:x}=Z(),{data:s}=es(r,"restaurant"),c=s?.filter(i=>i.rating_value)||[],h=c.length?c.reduce((i,d)=>i+(d.rating_value||0),0)/c.length:0,p=[5,4,3,2,1].map(i=>({star:i,count:c.filter(d=>d.rating_value===i).length,percentage:c.length?(c.filter(d=>d.rating_value===i).length/c.length*100).toFixed(0):0})),g=c.reduce((i,d)=>(d.price_range&&(i[d.price_range]=(i[d.price_range]||0)+1),i),{}),b=g&&Object.keys(g).length>0?Object.entries(g).sort((i,d)=>d[1]-i[1])[0]:null;return e.jsxs(S,{children:[e.jsx(W,{children:e.jsx(De,{children:x("restaurant.rating")})}),e.jsxs(R,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-5xl font-bold",children:h.toFixed(1)}),e.jsx("div",{className:"flex items-center justify-center mt-2",children:[1,2,3,4,5].map(i=>e.jsx(le,{className:fs("w-5 h-5",i<=Math.round(h)?"fill-accent text-accent":"text-muted-foreground")},i))}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[c.length," ",x("restaurant.ratingsCount")]}),b&&e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-2 text-sm",children:[e.jsx(Ss,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-foreground",children:ca.find(i=>i.value===b[0])?.label})]})]}),e.jsx("div",{className:"flex-1 space-y-2",children:p.map(({star:i,count:d,percentage:k})=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs("span",{className:"w-8",children:[i," ★"]}),e.jsx("div",{className:"flex-1 h-2 bg-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-accent transition-all",style:{width:`${k}%`}})}),e.jsx("span",{className:"w-12 text-right text-muted-foreground",children:d})]},i))})]}),e.jsx("div",{className:"pt-4 border-t text-center text-sm text-muted-foreground",children:x("restaurant.signInToRate")})]})]})},da=r=>(Z(),Rs({queryKey:["restaurant-activities",r],queryFn:async()=>{const{data:x,error:s}=await js.from("activity_restaurants").select(`
          activity_id,
          activities (
            id,
            title_zh,
            title_en,
            title_pt,
            intro_zh,
            intro_en,
            intro_pt,
            badge_text_zh,
            badge_text_en,
            badge_text_pt,
            badge_color,
            start_date,
            end_date
          )
        `).eq("restaurant_id",r);if(s)throw s;const c=new Date;return x.filter(p=>{const g=p.activities;if(!g)return!1;const b=new Date(g.start_date),i=g.end_date?new Date(g.end_date):null;return b<=c&&(!i||i>=c)}).map(p=>({activity_id:p.activity_id,title_zh:p.activities.title_zh,title_en:p.activities.title_en,title_pt:p.activities.title_pt,intro_zh:p.activities.intro_zh,intro_en:p.activities.intro_en,intro_pt:p.activities.intro_pt,badge_text_zh:p.activities.badge_text_zh,badge_text_en:p.activities.badge_text_en,badge_text_pt:p.activities.badge_text_pt,badge_color:p.activities.badge_color}))},enabled:!!r})),as=(r,x)=>x==="zh"?r.title_zh:x==="pt"?r.title_pt:r.title_en,Ne=(r,x)=>{let s="";return x==="zh"?s=r.badge_text_zh||r.title_zh:x==="pt"?s=r.badge_text_pt||r.title_pt:s=r.badge_text_en||r.title_en,s},ts=(r,x)=>x==="zh"?r.intro_zh||"":x==="pt"?r.intro_pt||"":r.intro_en||"",Ke="dish-gallery-view-mode";function rs({restaurantId:r,showGallery:x=!0}){const{t:s}=Z(),{data:c=[],isLoading:h}=aa(r),[p,g]=n.useState(!1),[b,i]=n.useState(0),[d,k]=n.useState(!1),_=Ye(),[v,I]=n.useState(()=>{if(typeof window<"u"){const m=localStorage.getItem(Ke);return m==="single"||m==="multi"?m:"multi"}return"multi"});n.useEffect(()=>{localStorage.setItem(Ke,v)},[v]);const C=n.useCallback(m=>{i(m),g(!0)},[]),T=n.useCallback(()=>{g(!1)},[]),w=n.useCallback(()=>{i(m=>m===0?c.length-1:m-1)},[c.length]),D=n.useCallback(()=>{i(m=>m===c.length-1?0:m+1)},[c.length]),L=n.useCallback(m=>{m.key==="ArrowLeft"&&w(),m.key==="ArrowRight"&&D(),m.key==="Escape"&&T()},[w,D,T]);if(h||!x||!c.length)return null;const be=()=>_&&v==="single"?"pl-2 basis-full":"pl-2 md:pl-4 basis-1/2 md:basis-1/3 lg:basis-1/4";return e.jsxs(e.Fragment,{children:[e.jsx(S,{children:e.jsxs(V,{open:!d,onOpenChange:m=>k(!m),children:[e.jsx(W,{className:"pb-3",children:e.jsx(H,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(De,{className:"text-lg flex items-center gap-2",children:[e.jsx(zs,{className:"w-5 h-5"}),s("restaurant.photoGallery"),e.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["(",c.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[_&&e.jsxs("div",{className:"flex items-center gap-1 bg-muted rounded-md p-0.5",onClick:m=>m.stopPropagation(),children:[e.jsx(f,{variant:v==="single"?"default":"ghost",size:"icon",className:"h-7 w-7",onClick:m=>{m.stopPropagation(),I("single")},title:s("dishImages.singleView"),children:e.jsx(Is,{className:"h-4 w-4"})}),e.jsx(f,{variant:v==="multi"?"default":"ghost",size:"icon",className:"h-7 w-7",onClick:m=>{m.stopPropagation(),I("multi")},title:s("dishImages.multiView"),children:e.jsx(Ts,{className:"h-4 w-4"})})]}),e.jsx(B,{className:`w-5 h-5 text-muted-foreground transition-transform ${d?"":"rotate-180"}`})]})]})})}),e.jsx(K,{children:e.jsxs(R,{children:[e.jsxs(ta,{className:"w-full",children:[e.jsx(ra,{className:"-ml-2 md:-ml-4",children:c.map((m,ie)=>e.jsx(na,{className:be(),children:e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>C(ie),children:e.jsx("img",{src:m.image_url,alt:`Dish ${ie+1}`,className:"w-full h-full object-cover",loading:"lazy"})})},m.id))}),c.length>(_&&v==="single"?1:2)&&e.jsxs(e.Fragment,{children:[e.jsx(la,{className:"-left-3 md:-left-4"}),e.jsx(ia,{className:"-right-3 md:-right-4"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2 text-center",children:s("dishImages.clickToEnlarge")})]})})]})}),e.jsx(Ns,{open:p,onOpenChange:g,children:e.jsxs(bs,{className:"max-w-[95vw] max-h-[95vh] p-0 bg-black/95 border-none",onKeyDown:L,children:[e.jsx(Ls,{children:e.jsx(ws,{children:s("restaurants.dishGallery","Dish Gallery")})}),e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center min-h-[50vh]",children:[e.jsx(f,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 z-50 text-white hover:bg-white/20",onClick:T,children:e.jsx(Os,{className:"w-6 h-6"})}),c.length>1&&e.jsx(f,{variant:"ghost",size:"icon",className:"absolute left-2 z-50 text-white hover:bg-white/20 h-12 w-12",onClick:w,children:e.jsx(Se,{className:"w-8 h-8"})}),e.jsx("img",{src:c[b]?.image_url,alt:`Dish ${b+1}`,className:"max-w-full max-h-[85vh] object-contain"}),c.length>1&&e.jsx(f,{variant:"ghost",size:"icon",className:"absolute right-2 z-50 text-white hover:bg-white/20 h-12 w-12",onClick:D,children:e.jsx($s,{className:"w-8 h-8"})}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-white bg-black/50 px-3 py-1 rounded-full text-sm",children:[b+1," / ",c.length]})]})]})})]})}const ma=({restaurant:r,localizedRestaurant:x,backUrl:s,user:c,isFavorite:h,onToggleFavorite:p,onShare:g,showEditButton:b,editButton:i,reportButton:d})=>{const{t:k}=Z(),{getLocalizedField:_}=Re(),v=_(r,"owner_bio")||r.owner_bio,I=x.name?.charAt(0)?.toUpperCase()||"主";return e.jsxs("div",{className:"relative min-h-[100vh] md:min-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("img",{src:r.cover_image_url||r.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80",alt:x.name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background via-background/70 to-background/30"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-background/50 via-transparent to-background/50"})]}),e.jsxs("div",{className:"absolute top-4 left-4 right-4 flex justify-between items-center z-20",children:[e.jsx(f,{asChild:!0,variant:"secondary",size:"icon",className:"backdrop-blur-sm bg-background/60",children:e.jsx(re,{to:s,children:e.jsx(Se,{className:"w-5 h-5"})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[d,i,e.jsx(f,{variant:"secondary",size:"icon",className:"backdrop-blur-sm bg-background/60",onClick:g,children:e.jsx(Q,{className:"w-5 h-5"})}),c&&e.jsx(f,{variant:"secondary",size:"icon",className:"backdrop-blur-sm bg-background/60",onClick:p,children:e.jsx(Qe,{className:`w-5 h-5 ${h?"fill-destructive text-destructive":""}`})})]})]}),e.jsx("div",{className:"relative z-10 min-h-[100vh] md:min-h-[90vh] flex flex-col justify-end pb-8 md:pb-16",children:e.jsx("div",{className:"container mx-auto max-w-6xl px-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-end",children:[e.jsx("div",{className:"order-2 lg:order-1 flex justify-center lg:justify-start",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -inset-4 bg-gradient-to-br from-primary/20 to-accent/20 rounded-[2rem] blur-2xl opacity-60"}),e.jsx("div",{className:"relative w-48 h-48 md:w-64 md:h-64 lg:w-80 lg:h-80 rounded-[1.5rem] overflow-hidden border-4 border-background/50 shadow-2xl",children:r.owner_avatar_url?e.jsx("img",{src:r.owner_avatar_url,alt:x.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-primary/20 via-accent/10 to-muted flex items-center justify-center",children:e.jsx("span",{className:"text-6xl md:text-8xl lg:text-9xl font-bold text-primary/40",children:I})})}),e.jsxs(z,{className:"absolute -bottom-3 left-1/2 -translate-x-1/2 bg-primary text-primary-foreground border-0 px-4 py-1.5 text-sm font-medium shadow-lg",children:[e.jsx(Ms,{className:"w-3.5 h-3.5 mr-1.5"}),k("restaurants.ownerStory","主理人")]})]})}),e.jsxs("div",{className:"order-1 lg:order-2 text-center lg:text-left space-y-6",children:[e.jsx("p",{className:"text-xs md:text-sm font-medium tracking-[0.25em] uppercase text-primary/80",children:k("restaurants.exclusiveInterview","专属故事")}),e.jsx("h1",{className:"text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-bold text-foreground leading-tight",children:x.name}),v&&e.jsx("p",{className:"text-lg md:text-xl text-muted-foreground leading-relaxed max-w-xl mx-auto lg:mx-0 line-clamp-3",children:v}),e.jsx("div",{className:"pt-4 flex justify-center lg:justify-start",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-muted-foreground/60",children:[e.jsx("span",{className:"text-xs tracking-wider uppercase",children:k("common.scrollDown","向下滚动")}),e.jsx("div",{className:"w-px h-8 bg-gradient-to-b from-muted-foreground/40 to-transparent animate-pulse"})]})})]})]})})})]})},xa=n.lazy(()=>Xe(()=>import("./RestaurantComments-DkL6xiTt.js").then(r=>r.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),ha=({restaurant:r,localizedRestaurant:x,restaurantActivities:s,ratingCount:c,averageRating:h,onTakeawayClick:p})=>{const{t:g,i18n:b}=Z(),{getLocalizedField:i}=Re(),[d,k]=n.useState(!1),[_,v]=n.useState(!1),I=n.useRef(null),C=i(r,"owner_bio")||r.owner_bio,T=x.name?.charAt(0)?.toUpperCase()||"主";return e.jsxs("div",{className:"relative bg-background",children:[e.jsx("section",{className:"py-16 md:py-24",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("p",{className:"text-xs md:text-sm font-medium tracking-[0.25em] uppercase text-primary mb-3",children:g("restaurants.theStory","品牌故事")}),e.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-foreground",children:g("restaurants.behindTheScene","幕后故事")}),e.jsx("div",{className:"w-16 h-1 bg-primary mx-auto mt-4"})]}),C&&e.jsxs("div",{className:"relative max-w-3xl mx-auto",children:[e.jsx(As,{className:"absolute -top-8 -left-4 md:-left-12 w-16 h-16 md:w-24 md:h-24 text-primary/10 rotate-180"}),e.jsx("div",{className:"relative z-10 space-y-6",children:e.jsx("p",{className:"text-lg md:text-xl lg:text-2xl text-foreground leading-relaxed md:leading-loose whitespace-pre-wrap first-letter:text-6xl first-letter:font-bold first-letter:text-primary first-letter:float-left first-letter:mr-3 first-letter:mt-2",children:C})}),e.jsxs("div",{className:"mt-12 flex items-center justify-center gap-4",children:[e.jsx("div",{className:"h-px flex-1 bg-gradient-to-r from-transparent to-border"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-primary to-accent flex items-center justify-center text-primary-foreground font-bold text-lg shadow-lg",children:T}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-foreground",children:x.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:g("restaurants.founder","创始人")})]})]}),e.jsx("div",{className:"h-px flex-1 bg-gradient-to-l from-transparent to-border"})]})]})]})}),x.description&&e.jsx("section",{className:"py-16 bg-muted/30",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("p",{className:"text-xs md:text-sm font-medium tracking-[0.25em] uppercase text-primary mb-3",children:g("restaurants.philosophy","理念")}),e.jsxs("h2",{className:"text-3xl md:text-4xl font-bold text-foreground flex items-center justify-center gap-3",children:[e.jsx(Ps,{className:"w-8 h-8 text-primary"}),g("restaurants.foodPhilosophy","美食哲学")]}),e.jsx("div",{className:"w-16 h-1 bg-primary mx-auto mt-4"})]}),e.jsx("div",{className:"prose prose-lg dark:prose-invert max-w-none text-center [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline",dangerouslySetInnerHTML:{__html:x.description}})]})}),e.jsx("section",{className:"py-16",children:e.jsx("div",{className:"container mx-auto max-w-5xl px-4",children:e.jsx(rs,{restaurantId:r.id,showGallery:r.show_dish_gallery!==!1})})}),e.jsx("section",{className:"py-16 bg-muted/30",children:e.jsx("div",{className:"container mx-auto max-w-4xl px-4",children:e.jsx(S,{className:"border-0 shadow-xl overflow-hidden",children:e.jsxs(R,{className:"p-6 md:p-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[x.type.slice(0,3).map((w,D)=>e.jsx(z,{variant:"secondary",children:w},D)),e.jsxs(z,{variant:"outline",className:"gap-1",children:[e.jsx(ne,{className:"w-3 h-3"}),g("restaurants.ghostKitchen")]}),c>0&&e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx(le,{className:"w-4 h-4 fill-accent text-accent"}),e.jsxs("span",{className:"font-semibold text-sm",children:[h.toFixed(1),e.jsxs("span",{className:"text-muted-foreground font-normal ml-1",children:["(",c,")"]})]})]})]}),e.jsx(je,{}),e.jsxs("div",{className:"grid gap-4",children:[s.length>0&&e.jsxs(V,{open:d,onOpenChange:k,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(le,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(H,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:g("activities.title")}),!d&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-1",children:s.map((w,D)=>e.jsx(z,{variant:"default",className:"text-white",style:{backgroundColor:w.badge_color||"hsl(var(--primary))"},children:Ne(w,b.language)},`activity-${D}`))})]}),e.jsx(B,{className:`w-5 h-5 text-muted-foreground transition-transform ${d?"rotate-180":""}`})]})}),e.jsx(K,{className:"mt-3 space-y-2",children:s.map((w,D)=>{const L=ts(w,b.language);return e.jsxs(re,{to:`/activity/${w.activity_id}`,className:"block p-2 rounded-md hover:bg-muted/80 transition-colors",children:[e.jsx(z,{variant:"default",className:"text-white mr-2",style:{backgroundColor:w.badge_color||"hsl(var(--primary))"},children:Ne(w,b.language)}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[L||as(w,b.language)," ... →"]})]},`activity-detail-${D}`)})})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(Ze,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-card-foreground",children:g("restaurants.productionAddress")}),e.jsx("p",{className:"text-muted-foreground",children:r.address})]})]}),r.phone&&e.jsxs("a",{href:`tel:${r.phone}`,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors cursor-pointer",children:[e.jsx(Je,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-card-foreground",children:g("restaurant.phone")}),e.jsx("p",{className:"text-primary underline",children:r.phone})]})]}),r&&(i(r,"announcement")||r.announcement_zh)&&e.jsxs(V,{open:_,onOpenChange:v,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(ae,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(H,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:g("restaurant.announcement")}),e.jsx(B,{className:`w-5 h-5 text-muted-foreground transition-transform ${_?"rotate-180":""}`})]})}),e.jsx(K,{className:"mt-3",children:e.jsx("div",{className:"p-3 rounded-md bg-primary/5 border border-primary/10",children:e.jsx("p",{className:"text-sm text-foreground whitespace-pre-wrap",children:i(r,"announcement")||r.announcement_zh})})})]})]})]}),r.website_url&&r.show_takeaway_button&&e.jsxs(e.Fragment,{children:[e.jsx(je,{}),e.jsxs(f,{className:"w-full",size:"lg",onClick:p,children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),g("restaurant.takeawayOrder")]})]})]})})})}),e.jsx("section",{className:"py-16",children:e.jsx("div",{className:"container mx-auto max-w-4xl px-4",children:e.jsx(S,{className:"border-0 shadow-xl overflow-hidden",children:e.jsx(R,{className:"p-6 md:p-8",children:e.jsx(ss,{restaurantId:r.id})})})})}),e.jsx("section",{className:"py-16 bg-muted/30",children:e.jsx("div",{className:"container mx-auto max-w-4xl px-4",children:e.jsx(S,{className:"border-0 shadow-xl overflow-hidden",children:e.jsx(R,{className:"p-6 md:p-8",ref:I,children:e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(te,{className:"w-8 h-8 animate-spin text-primary"})}),children:e.jsx(xa,{restaurantId:r.id})})})})})})]})},ua=n.lazy(()=>Xe(()=>import("./RestaurantComments-DkL6xiTt.js").then(r=>r.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Ua=()=>{const{id:r}=Es(),x=Fs(),{t:s,i18n:c}=Z(),{user:h}=vs(),{localizeRestaurant:p,getLocalizedField:g}=Re(),b=Ye(),i=n.useRef(null),d=n.useRef(null),[k,_]=n.useState(null),[v,I]=n.useState(!1),[C,T]=n.useState(!0),[w,D]=n.useState(!1),[L,be]=n.useState(!1),[m,ie]=n.useState(!0),[oe,ns]=n.useState(!0),[ls,ga]=n.useState(!1),we=n.useRef(null),ve=n.useRef(null),[is,ye]=n.useState(!1),[ze,O]=n.useState(!1),[Ie,ce]=n.useState(!1),[os,Te]=n.useState(!1),[cs,ds]=n.useState(!1),Le=Gs();ea({pageType:"restaurant",targetId:r});const Oe=x.state?.fromActivity,ms=x.state?.from==="admin",xs=x.state?.from==="profile",ke=ms?"/admin/restaurants":xs?"/profile":Oe?`/activity/${Oe}`:"/restaurants",{data:a,isLoading:hs}=Vs(r),{data:us=[]}=Hs(),{data:de}=es(r,"restaurant",{enabled:oe}),$e=Ks(),{role:pa,isAdmin:me}=ys(),{data:gs=[]}=sa(),{data:xe=[]}=da(r),he=a&&gs.some(t=>t.id===a.id),N=a?p(a):null,Me=a?us.includes(a.id):!1;n.useMemo(()=>[{value:"€",label:"€ (0-10€)"},{value:"€€",label:"€€ (10-20€)"},{value:"€€€",label:"€€€ (20€+)"}],[]);const Y=n.useMemo(()=>{const t={};return de?.forEach(l=>{l.price_range&&(t[l.price_range]||(t[l.price_range]={count:0,latestDate:l.created_at}),t[l.price_range].count+=1,l.created_at>t[l.price_range].latestDate&&(t[l.price_range].latestDate=l.created_at))}),t},[de]),Ae=n.useMemo(()=>Y?Object.values(Y).reduce((t,l)=>t+l.count,0):0,[Y]),Pe=n.useMemo(()=>!Y||Ae<10?null:Object.entries(Y).sort(([,l],[,j])=>j.count!==l.count?j.count-l.count:j.latestDate.localeCompare(l.latestDate))[0]?.[0]||null,[Y,Ae]),{ratingCount:ue,averageRating:Ee}=n.useMemo(()=>{const t=de?.filter(u=>u.rating_value)||[],l=t.length,j=l>0?t.reduce((u,y)=>u+(y.rating_value||0),0)/l:0;return{ratingCount:l,averageRating:j}},[de]);n.useEffect(()=>{a&&Xs().then(t=>{const l=Qs(t.coords.latitude,t.coords.longitude,a.lat,a.lng);_(l)}).catch(()=>{_(null)})},[a]);const Fe=n.useCallback(()=>{!h||!a||$e.mutate(a.id)},[h,a,$e]),X=n.useCallback(async()=>{try{await navigator.clipboard.writeText(window.location.href),ee.success(s("common.linkCopied"))}catch(t){console.error("Error copying link:",t),ee.error(s("common.shareError"))}},[s]),_e=n.useCallback(async()=>{if(!a||!N)return;const t={title:N.name,text:`${N.name} - Xiaoxiong Market

${N.description||N.address}`,url:window.location.href};try{navigator.share&&navigator.canShare&&navigator.canShare(t)?(await navigator.share(t),ee.success(s("common.shareSuccess"))):X()}catch(l){l.name!=="AbortError"&&(console.error("Error sharing:",l),ee.error(s("common.shareError")))}},[a,N,X,s]),J=n.useCallback(t=>{if(!a||!N)return;const l=encodeURIComponent(window.location.href),j=encodeURIComponent(N.name);let u="";switch(t){case"whatsapp":u=`https://wa.me/?text=${j}%20${l}`;break;case"facebook":u=`https://www.facebook.com/sharer/sharer.php?u=${l}`;break;case"twitter":u=`https://twitter.com/intent/tweet?text=${j}&url=${l}`;break;case"telegram":u=`https://t.me/share/url?url=${l}&text=${j}`;break;case"wechat":X(),ee.info(s("common.shareVia")+" WeChat");return;default:return}Ge()?window.location.href=u:window.open(u,"_blank","width=600,height=400")},[a,N,X,s]);return n.useEffect(()=>{const t=new IntersectionObserver(j=>{j.forEach(u=>{u.isIntersecting&&!m&&ie(!0)})},{rootMargin:"100px"}),l=new IntersectionObserver(j=>{j.forEach(u=>{u.isIntersecting&&!oe&&ns(!0)})},{rootMargin:"200px"});return we.current&&t.observe(we.current),ve.current&&l.observe(ve.current),()=>{t.disconnect(),l.disconnect()}},[m,oe]),n.useEffect(()=>{if(!i.current||!a||!m||!C||d.current)return;const t="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";if(!se.supported()){console.warn("[RestaurantDetail Map] WebGL not supported",{isIOSDevice:ks(),isIOSWebView:Ge(),userAgent:navigator.userAgent});return}const l=()=>{if(!i.current)return;const j=i.current.getBoundingClientRect();if(j.width===0||j.height===0){setTimeout(l,100);return}try{se.accessToken=t,d.current=new se.Map({container:i.current,style:"mapbox://styles/mapbox/light-v11",center:[a.lng,a.lat],zoom:15,cooperativeGestures:!0}),d.current.on("error",y=>{console.error("[RestaurantDetail Map] Map error:",y)});const u=document.createElement("div");u.style.backgroundImage=`url(${Js})`,u.style.width="40px",u.style.height="40px",u.style.backgroundSize="contain",u.style.backgroundRepeat="no-repeat",u.style.backgroundPosition="center",u.style.cursor="pointer",new se.Marker({element:u}).setLngLat([a.lng,a.lat]).addTo(d.current),d.current.addControl(new se.NavigationControl)}catch(u){console.error("[RestaurantDetail Map] Failed to initialize map:",u)}};return setTimeout(l,50),()=>{d.current?.remove(),d.current=null}},[a,m,C]),n.useEffect(()=>{if(C&&d.current){const t=setTimeout(()=>{d.current?.resize(),a&&d.current?.setCenter([a.lng,a.lat])},350);return()=>clearTimeout(t)}},[C,a]),hs?e.jsx(oa,{}):!a||!N?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl text-muted-foreground",children:s("error.notFound")}),e.jsx(f,{asChild:!0,className:"mt-4",children:e.jsx(re,{to:ke,children:s("common.back")})})]})}):a.template==="ghost"?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(ma,{restaurant:a,localizedRestaurant:N,backUrl:ke,user:h,isFavorite:Me,onToggleFavorite:Fe,onShare:()=>{if(!h){O(!0);return}b&&navigator.share?_e():X()},onReport:()=>{},showEditButton:he||me,editButton:(he||me)&&a?e.jsx(He,{restaurant:a,trigger:e.jsx(f,{variant:"secondary",size:"icon",className:"backdrop-blur-sm bg-background/60",children:e.jsx(qe,{className:"w-5 h-5"})})}):null,reportButton:a?e.jsx(Ve,{targetType:"restaurant",targetId:a.id,onLoginRequired:()=>O(!0),trigger:e.jsx(f,{variant:"secondary",size:"icon",className:"backdrop-blur-sm bg-background/60",children:e.jsx(We,{className:"w-5 h-5"})})}):null}),e.jsx(ha,{restaurant:a,localizedRestaurant:N,restaurantActivities:xe,ratingCount:ue,averageRating:Ee,onTakeawayClick:()=>ce(!0)}),e.jsx($,{open:Ie,onOpenChange:ce,children:e.jsxs(M,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(A,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0",children:e.jsx(ne,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(P,{className:"text-base font-semibold tracking-tight text-foreground",children:s("restaurant.takeawayOrderTitle","外卖点餐")}),e.jsx(E,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:s("restaurant.takeawayDescription","即将为您打开外卖订餐页面")})]})]}),e.jsxs(F,{className:"relative flex-col gap-2 pt-4 mt-1",children:[e.jsx(G,{onClick:()=>{try{const t=new URL(a.website_url);t.pathname="/table",h&&t.searchParams.set("user_id",h.id),fe(t.toString())}catch(t){console.error("Invalid URL:",t)}},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:s("common.continue","继续")}),e.jsx(U,{className:"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:s("common.cancel")})]})]})}),e.jsx($,{open:ze,onOpenChange:O,children:e.jsxs(M,{children:[e.jsxs(A,{children:[e.jsx(P,{children:s("activities.loginRequired")}),e.jsx(E,{children:s("activities.loginRequiredMessage")})]}),e.jsxs(F,{children:[e.jsx(U,{children:s("common.cancel")}),e.jsx(G,{onClick:()=>Le("/auth"),children:s("activities.goToLogin")})]})]})})]}):e.jsxs("div",{className:"min-h-screen bg-secondary/20",children:[e.jsxs("div",{className:"relative h-[33vh] overflow-hidden bg-muted",children:[e.jsx("img",{src:a.cover_image_url||a.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80",alt:N.name,className:"w-full h-full object-cover",loading:"eager"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),e.jsx(f,{asChild:!0,variant:"secondary",size:"icon",className:"absolute top-4 left-4",children:e.jsx(re,{to:ke,children:e.jsx(Se,{className:"w-5 h-5"})})}),h&&e.jsx(f,{variant:"secondary",size:"icon",className:"absolute top-4 right-4",onClick:Fe,children:e.jsx(Qe,{className:`w-5 h-5 ${Me?"fill-destructive text-destructive":""}`})}),b&&navigator.share?e.jsx(f,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${h?"right-16":"right-4"}`,onClick:()=>{if(!h){O(!0);return}_e()},children:e.jsx(Q,{className:"w-5 h-5"})}):e.jsxs(_s,{children:[e.jsx(Cs,{asChild:!0,children:e.jsx(f,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${h?"right-16":"right-4"}`,onClick:t=>{h||(t.preventDefault(),O(!0))},children:e.jsx(Q,{className:"w-5 h-5"})})}),e.jsxs(Ds,{align:"end",className:"w-48",children:[navigator.share&&e.jsxs(e.Fragment,{children:[e.jsxs(q,{onClick:_e,children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),s("common.moreOptions")]}),e.jsx(Ue,{})]}),e.jsxs(q,{onClick:()=>J("wechat"),children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"WeChat"]}),e.jsxs(q,{onClick:()=>J("whatsapp"),children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),e.jsxs(q,{onClick:()=>J("facebook"),children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Facebook"]}),e.jsxs(q,{onClick:()=>J("twitter"),children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"X (Twitter)"]}),e.jsxs(q,{onClick:()=>J("telegram"),children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Telegram"]}),e.jsx(Ue,{}),e.jsxs(q,{onClick:X,children:[e.jsx(Us,{className:"w-4 h-4 mr-2"}),s("common.copyLink")]})]})]}),(he||me)&&a&&e.jsx(He,{restaurant:a,trigger:e.jsx(f,{variant:"secondary",size:"icon",className:`absolute top-4 ${h?"right-28":"right-16"}`,children:e.jsx(qe,{className:"w-5 h-5"})})}),a&&e.jsx(Ve,{targetType:"restaurant",targetId:a.id,onLoginRequired:()=>O(!0),trigger:e.jsx(f,{variant:"secondary",size:"icon",className:`absolute top-4 ${he||me?h?"right-40":"right-28":h?"right-28":"right-16"}`,children:e.jsx(We,{className:"w-5 h-5"})})})]}),e.jsx("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12",children:e.jsxs(S,{className:"shadow-large",children:[e.jsx(W,{children:e.jsx("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 flex flex-wrap gap-2",children:N.type.slice(0,3).map((t,l)=>e.jsx(z,{variant:"secondary",children:t},l))}),e.jsx(De,{className:"text-3xl mb-2",children:N.name}),e.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[k!==null&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ce,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"font-semibold text-base",children:[k.toFixed(1)," km"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{className:`w-5 h-5 ${ue>0?"fill-accent text-accent":"text-muted-foreground"}`}),ue>0?e.jsxs("span",{className:"font-semibold text-base",children:[Ee.toFixed(1),e.jsxs("span",{className:"text-muted-foreground font-normal text-sm ml-1",children:["(",ue,")"]})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:s("restaurant.noRatingWithHint")})]}),Pe&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(qs,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-base",children:Pe})]})]}),N.description&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline",dangerouslySetInnerHTML:{__html:N.description}})]})})}),e.jsxs(R,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[xe.length>0&&e.jsxs(V,{open:L,onOpenChange:be,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(le,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(H,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("activities.title")}),!L&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-1",children:xe.map((t,l)=>e.jsx(z,{variant:"default",className:"text-white",style:{backgroundColor:t.badge_color||"#9b87f5"},children:Ne(t,c.language)},`activity-${l}`))})]}),e.jsx(B,{className:`w-5 h-5 text-muted-foreground transition-transform ${L?"rotate-180":""}`})]})}),e.jsx(K,{className:"mt-3 space-y-2",children:xe.map((t,l)=>{const j=ts(t,c.language);return e.jsxs(re,{to:`/activity/${t.activity_id}`,className:"block p-2 rounded-md hover:bg-muted/80 transition-colors",children:[e.jsx(z,{variant:"default",className:"text-white mr-2",style:{backgroundColor:t.badge_color||"#9b87f5"},children:Ne(t,c.language)}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[j||as(t,c.language)," ... →"]})]},`activity-detail-${l}`)})})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(Ze,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.address")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-muted-foreground",children:a.address}),a.template==="ghost"&&e.jsx(z,{variant:"secondary",className:"text-xs",children:s("restaurants.ghostKitchen")})]})]})]}),a.phone&&e.jsxs("a",{href:`tel:${a.phone}`,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors cursor-pointer",children:[e.jsx(Je,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.phone")}),e.jsx("p",{className:"text-primary underline",children:a.phone})]})]}),a.opening_hours&&a.template!=="ghost"&&e.jsxs(V,{open:v,onOpenChange:I,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(Ws,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(H,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.hours")}),!v&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-0.5",children:[s("restaurant.today")," ",Ys(a.opening_hours)]})]}),e.jsx(B,{className:`w-5 h-5 text-muted-foreground transition-transform ${v?"rotate-180":""}`})]})}),e.jsx(K,{className:"mt-3",children:e.jsx("div",{className:"space-y-2",children:(()=>{const t=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],l={monday:"dayMon",tuesday:"dayTue",wednesday:"dayWed",thursday:"dayThu",friday:"dayFri",saturday:"daySat",sunday:"daySun"},j=t[new Date().getDay()===0?6:new Date().getDay()-1];return t.map(u=>{const y=a.opening_hours[u],ge=u===j,ps=s(`restaurant.${l[u]}`);let pe="N/A";return y&&(y.closed?pe=s("restaurant.closed"):y.splitShift?pe=`${y.open} - ${y.close}, ${y.open2} - ${y.close2}`:pe=`${y.open} - ${y.close}`),e.jsxs("div",{className:`flex justify-between items-center py-1.5 px-2 rounded ${ge?"bg-primary/10 border border-primary/20":""}`,children:[e.jsxs("span",{className:`text-sm font-medium ${ge?"text-primary":"text-foreground"}`,children:[ps,ge&&e.jsxs("span",{className:"ml-2 text-xs",children:["(",s("restaurant.today"),")"]})]}),e.jsx("span",{className:`text-sm ${ge?"text-primary font-semibold":"text-muted-foreground"} ${y?.closed?"italic":""}`,children:pe})]},u)})})()})})]})]}),a&&(g(a,"announcement")||a.announcement_zh)&&e.jsxs(V,{open:w,onOpenChange:D,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(ae,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(H,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.announcement")}),e.jsx(B,{className:`w-5 h-5 text-muted-foreground transition-transform ${w?"rotate-180":""}`})]})}),e.jsx(K,{className:"mt-3",children:e.jsx("div",{className:"p-3 rounded-md bg-primary/5 border border-primary/10",children:e.jsx("p",{className:"text-sm text-foreground whitespace-pre-wrap",children:g(a,"announcement")||a.announcement_zh})})})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[a.template!=="ghost"&&e.jsxs(f,{variant:"secondary",className:"w-full",onClick:()=>ye(!0),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),s("restaurant.getDirections")]}),a.website_url&&(a.show_takeaway_button||a.show_booking_button&&a.template!=="ghost")&&e.jsxs("div",{className:"flex gap-3",children:[a.show_takeaway_button&&e.jsxs(f,{className:"flex-1",onClick:()=>ce(!0),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),s("restaurant.takeawayOrder")]}),a.show_booking_button&&a.template!=="ghost"&&e.jsxs(f,{className:"flex-1",onClick:()=>Te(!0),children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),s("restaurant.tableBooking")]})]})]}),e.jsx($,{open:is,onOpenChange:ye,children:e.jsxs(M,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(A,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(Ce,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(P,{className:"text-base font-semibold tracking-tight text-foreground",children:s("navigation.confirmTitle")}),e.jsx(E,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:s("navigation.confirmDescriptionSimple",{destination:N.name})})]})]}),e.jsxs(F,{className:"relative flex-col gap-2 pt-4 mt-1",children:[e.jsx(G,{onClick:()=>{Zs(a.lat,a.lng,N.name),ye(!1)},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:s("navigation.openNavigation","获取路线")}),e.jsx(U,{className:"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:s("common.cancel")})]})]})}),e.jsx($,{open:cs,onOpenChange:ds,children:e.jsxs(M,{className:"max-w-xs w-[calc(100%-3rem)] mx-auto border-0 bg-white/70 dark:bg-gray-900/70 backdrop-blur-xl shadow-2xl rounded-3xl overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 rounded-3xl bg-gradient-to-b from-white/30 via-transparent to-transparent pointer-events-none"}),e.jsxs(A,{className:"relative text-center pb-2",children:[e.jsx("div",{className:"mx-auto mb-4 w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/20 to-primary/10 flex items-center justify-center shadow-inner shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(Bs,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:2})}),e.jsx(P,{className:"text-lg font-semibold text-foreground",children:s("restaurant.joinPrivateTitle")}),e.jsx(E,{className:"text-center text-sm text-muted-foreground mt-2 leading-relaxed",children:s("restaurant.joinPrivateDescription")})]}),e.jsxs(F,{className:"relative flex-col gap-2 pt-4",children:[e.jsxs(G,{onClick:()=>{const t=new URL(a.website_url);h&&t.searchParams.set("user_id",h.id);const l=t.toString();fe(l)},className:"w-full rounded-xl py-3 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/20 transition-all duration-200",children:[ls?e.jsx(te,{className:"w-4 h-4 mr-2 animate-spin"}):null,s("restaurant.joinPrivateConfirm")]}),e.jsx(U,{className:"w-full rounded-xl py-3 bg-white/50 dark:bg-white/10 hover:bg-white/70 dark:hover:bg-white/20 border-0 text-muted-foreground font-medium transition-all duration-200",children:s("common.cancel")})]})]})}),e.jsx($,{open:Ie,onOpenChange:ce,children:e.jsxs(M,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(A,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(ne,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(P,{className:"text-base font-semibold tracking-tight text-foreground",children:s("restaurant.takeawayOrderTitle","外卖点餐")}),e.jsx(E,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:s("restaurant.takeawayDescription","即将为您打开外卖订餐页面")})]})]}),e.jsxs(F,{className:"relative flex-col gap-2 pt-4 mt-1",children:[e.jsx(G,{onClick:()=>{try{const t=new URL(a.website_url);t.pathname="/table",h&&t.searchParams.set("user_id",h.id),fe(t.toString())}catch(t){console.error("Invalid URL:",t)}},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:s("common.continue","继续")}),e.jsx(U,{className:"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:s("common.cancel")})]})]})}),e.jsx($,{open:os,onOpenChange:Te,children:e.jsxs(M,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(A,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(Be,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(P,{className:"text-base font-semibold tracking-tight text-foreground",children:s("restaurant.tableBookingTitle","预约订台")}),e.jsx(E,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:s("restaurant.bookingDescription","即将为您打开餐位预约页面")})]})]}),e.jsxs(F,{className:"relative flex-col gap-2 pt-4 mt-1",children:[e.jsx(G,{onClick:()=>{try{const t=new URL(a.website_url);t.pathname="/reservePage",h&&t.searchParams.set("user_id",h.id),fe(t.toString())}catch(t){console.error("Invalid URL:",t)}},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:s("common.continue","继续")}),e.jsx(U,{className:"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:s("common.cancel")})]})]})}),e.jsx(rs,{restaurantId:a.id,showGallery:a.show_dish_gallery!==!1}),a.template!=="ghost"&&e.jsx("div",{ref:we,children:e.jsxs(V,{open:C,onOpenChange:T,className:"p-4 rounded-lg bg-muted/50",children:[e.jsx(H,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:s("restaurant.map")}),e.jsx(B,{className:`w-5 h-5 text-muted-foreground transition-transform ${C?"rotate-180":""}`})]})}),e.jsx(K,{children:m?e.jsx("div",{ref:i,className:"h-[350px] rounded-lg overflow-hidden bg-muted"}):e.jsx("div",{className:"h-[350px] rounded-lg bg-muted flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 animate-spin text-muted-foreground"})})})]})}),e.jsx(je,{}),e.jsx(ss,{restaurantId:a.id}),e.jsx(je,{}),e.jsx("div",{ref:ve,children:oe?e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(te,{className:"w-8 h-8 animate-spin text-primary"})}),children:e.jsx(ua,{restaurantId:a.id})}):e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(te,{className:"w-8 h-8 animate-spin text-muted-foreground"})})})]})]})}),e.jsx($,{open:ze,onOpenChange:O,children:e.jsxs(M,{children:[e.jsxs(A,{children:[e.jsx(P,{children:s("activities.loginRequired")}),e.jsx(E,{children:s("activities.loginRequiredMessage")})]}),e.jsxs(F,{children:[e.jsx(U,{children:s("common.cancel")}),e.jsx(G,{onClick:()=>Le("/auth"),children:s("activities.goToLogin")})]})]})})]})};export{Ua as default};
//# sourceMappingURL=RestaurantDetail-GaykW6O6.js.map
