import{r as d,j as s}from"./vendor-react-core-BErlw7p5.js";import{m as V,B as P,C as f,j as N,I as b,s as S}from"./index-CEqKPgls.js";import{n as _}from"./useAdmin-_9qYsNyJ.js";import{u as $}from"./useLocalizedContent-DqTgPnyL.js";import{u as H,b as R}from"./vendor-query-BS0wY7WL.js";import{u as J,P as W,a as X,b as l,c as Y,d as Z,f as ee}from"./usePagination-lYmgCpru.js";import{u as se}from"./vendor-i18n-CqcxoxDo.js";import{a6 as k,t as te,a as ae,u as ne}from"./vendor-icons-C2Bicc1E.js";import"./vendor-editor-BdQcs4B3.js";import"./vendor-misc-DH4LiFnZ.js";import"./vendor-date-fYlqblcl.js";import"./vendor-router-CLK0c9aH.js";import"./vendor-ui-other-CPTlx-W2.js";import"./vendor-supabase-Clrw0GhO.js";import"./vendor-ui-dialog-Sv_VEL0d.js";import"./vendor-ui-dropdown-DwTcg2UT.js";const ye=()=>{const{t:n}=se(),{toast:m}=V(),o=H(),{data:u,isLoading:L}=_(),{getLocalizedField:x}=$(),[r,q]=d.useState(""),[i,h]=d.useState({}),[E,v]=d.useState(new Set),Q=d.useMemo(()=>u?u.filter(e=>r===""||x(e,"name").toString().toLowerCase().includes(r.toLowerCase())||e.address.toLowerCase().includes(r.toLowerCase())):[],[u,r,x]),{currentPage:c,totalPages:g,paginatedData:F,goToPage:K,nextPage:A,previousPage:I,canGoNext:T,canGoPrevious:z,startIndex:M,endIndex:O,totalItems:B}=J({data:Q,itemsPerPage:20}),y=R({mutationFn:async({restaurantId:e,rating:t})=>{const{error:a}=await S.from("restaurants").update({rating:t}).eq("id",e);if(a)throw a;return e},onSuccess:e=>{o.invalidateQueries({queryKey:["admin-restaurants"]}),o.invalidateQueries({queryKey:["restaurants"]}),v(t=>new Set([...t,e])),h(t=>{const a={...t};return delete a[e],a}),setTimeout(()=>{v(t=>{const a=new Set(t);return a.delete(e),a})},2e3)},onError:e=>{m({title:n("common.error"),description:e.message,variant:"destructive"})}}),w=R({mutationFn:async()=>{const e=Object.entries(i).map(([t,a])=>({id:t,rating:parseFloat(a)||0}));for(const t of e){const{error:a}=await S.from("restaurants").update({rating:t.rating}).eq("id",t.id);if(a)throw a}return e.length},onSuccess:e=>{o.invalidateQueries({queryKey:["admin-restaurants"]}),o.invalidateQueries({queryKey:["restaurants"]}),h({}),m({title:n("common.success"),description:n("admin.ratings.updated",{count:e})})},onError:e=>{m({title:n("common.error"),description:e.message,variant:"destructive"})}}),G=(e,t)=>{if(t===""||/^\d*\.?\d*$/.test(t)){const a=parseFloat(t);(t===""||a>=0&&a<=5)&&h(p=>({...p,[e]:t}))}},C=e=>{const t=parseFloat(i[e]||"0");t>=0&&t<=5&&y.mutate({restaurantId:e,rating:t})},U=(e,t)=>{e.key==="Enter"&&C(t)},D=Object.keys(i).length>0;return L?s.jsx("div",{className:"text-center",children:n("common.loading")}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:n("admin.ratings.title")}),s.jsx("p",{className:"text-muted-foreground",children:n("admin.ratings.description")})]}),D&&s.jsxs(P,{onClick:()=>w.mutate(),disabled:w.isPending,children:[s.jsx(k,{className:"mr-2 h-4 w-4"}),n("admin.ratings.saveAll")," (",Object.keys(i).length,")"]})]}),s.jsx(f,{children:s.jsx(N,{className:"pt-6",children:s.jsxs("div",{className:"relative max-w-md",children:[s.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),s.jsx(b,{placeholder:n("admin.ratings.searchPlaceholder"),value:r,onChange:e=>q(e.target.value),className:"pl-9"})]})})}),s.jsx(f,{className:"bg-muted/50",children:s.jsx(N,{className:"pt-6",children:s.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[s.jsxs("p",{children:["• ",n("admin.ratings.instruction1")]}),s.jsxs("p",{children:["• ",n("admin.ratings.instruction2")]}),s.jsxs("p",{children:["• ",n("admin.ratings.instruction3")]})]})})}),s.jsx("div",{className:"flex items-center justify-between pb-2 border-b",children:s.jsx("span",{className:"text-sm text-muted-foreground",children:n("admin.ratings.showing",{start:M,end:O,total:B})})}),s.jsx("div",{className:"grid gap-3",children:F?.map(e=>{const t=i[e.id]??(e.rating?.toString()||"0"),a=e.id in i,p=E.has(e.id);return s.jsx(f,{className:a?"border-primary/50":"",children:s.jsx(N,{className:"py-4",children:s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h3",{className:"font-medium truncate",children:x(e,"name")}),p&&s.jsxs("span",{className:"flex items-center text-green-600 text-sm",children:[s.jsx(ae,{className:"h-4 w-4 mr-1"}),n("admin.ratings.saved")]})]}),s.jsx("p",{className:"text-sm text-muted-foreground truncate",children:e.address})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[s.jsx(ne,{className:"h-4 w-4 fill-accent text-accent"}),s.jsx("span",{className:"text-sm",children:n("admin.ratings.current")}),s.jsx("span",{className:"font-medium",children:e.rating||0})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(b,{type:"text",inputMode:"decimal",value:t,onChange:j=>G(e.id,j.target.value),onKeyPress:j=>U(j,e.id),className:"w-20 text-center",placeholder:"0-5"}),s.jsx(P,{size:"sm",variant:a?"default":"outline",onClick:()=>C(e.id),disabled:!a||y.isPending,children:s.jsx(k,{className:"h-4 w-4"})})]})]})]})})},e.id)})}),g>1&&s.jsx(W,{className:"mt-6",children:s.jsxs(X,{children:[s.jsx(l,{children:s.jsx(Y,{onClick:I,className:z?"cursor-pointer":"pointer-events-none opacity-50"})}),Array.from({length:g},(e,t)=>t+1).map(e=>e===1||e===g||e>=c-1&&e<=c+1?s.jsx(l,{children:s.jsx(Z,{onClick:()=>K(e),isActive:c===e,className:"cursor-pointer",children:e})},e):e===c-2||e===c+2?s.jsx(l,{children:"..."},e):null),s.jsx(l,{children:s.jsx(ee,{onClick:A,className:T?"cursor-pointer":"pointer-events-none opacity-50"})})]})})]})};export{ye as default};
//# sourceMappingURL=AdminRatings-CybAFkF1.js.map
