import{j as e,p as S,r as g,b6 as D,u as M,q as F,bb as z,bc as B,L as R,b2 as y,aX as C,bG as T,bH as Q,b1 as E,bh as H,bI as K}from"./vendor-react-DImbKuZP.js";import{S as r,u as k,I as G,q as w,s as P,a as U,C as X,B as f,E as J,F as O,r as V,t as W,v as Y,G as Z}from"./index-_G3CuCzp.js";import{u as ee,a as se}from"./useActivities-B-dkIh_c.js";import{u as te}from"./useActivityRealtime-Qkau-lST.js";import{u as ae}from"./useLocalizedContent-B2SRIfSp.js";import{u as re}from"./useInfiniteScroll-tnzLsXiS.js";import{l as A}from"./xiaoxiong-logo-v3-D2n3VLi4.js";import{u as ie}from"./useLoginRequired-DynG1Vvm.js";import{i as d}from"./vendor-i18n-AOdgFpXS.js";import{P as le}from"./PullToRefresh-BimBuYXa.js";import{D as $}from"./vendor-utils-vwQGbBim.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-CRxszhSs.js";const ne=({count:t=4})=>e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6",children:Array.from({length:t}).map((l,m)=>e.jsxs("div",{className:"rounded-lg border border-border overflow-hidden bg-card",children:[e.jsxs("div",{className:"relative",children:[e.jsx(r,{className:"w-full h-48 sm:h-56 rounded-none"}),e.jsx(r,{className:"absolute top-3 left-3 h-6 w-20 rounded-full"})]}),e.jsxs("div",{className:"p-4 sm:p-5",children:[e.jsx(r,{className:"h-7 w-3/4 mb-2"}),e.jsx(r,{className:"h-4 w-48 mb-3"}),e.jsx(r,{className:"h-4 w-full mb-1"}),e.jsx(r,{className:"h-4 w-5/6 mb-4"}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx(r,{className:"h-5 w-24"}),e.jsx(r,{className:"h-5 w-20"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{className:"h-9 flex-1 rounded-md"}),e.jsx(r,{className:"h-9 w-9 rounded-md"}),e.jsx(r,{className:"h-9 w-9 rounded-md"})]})]})]},m))}),oe=({activityId:t,initialSubscribed:l=!1})=>{const{t:m}=S(),{user:o}=k(),{toast:u}=G(),{requireLogin:c}=ie(),[x,p]=g.useState(l),[b,h]=g.useState(!1);g.useEffect(()=>{p(l)},[l]);const v=async j=>{if(j.preventDefault(),j.stopPropagation(),!c())return;h(!0);const i=x;p(!i);try{if(i){const{error:n}=await P.from("subscriptions").delete().eq("activity_id",t).eq("user_id",o.id);if(n)throw n;u({title:d.t("toast.unsubscribed"),description:d.t("toast.unsubscribedDesc")})}else{const{error:n}=await P.from("subscriptions").insert({activity_id:t,user_id:o.id});if(n)throw n;u({title:d.t("toast.subscribed"),description:d.t("toast.subscribedDesc")})}}catch{p(i),u({title:d.t("common.error"),description:d.t("toast.subscriptionFailed"),variant:"destructive"})}finally{h(!1)}};return e.jsx(w,{variant:x?"default":"outline",size:"icon",onClick:v,disabled:b,title:m(x?"activities.favorited":"activities.favorite"),className:"transition-all duration-200",children:e.jsx(D,{className:`w-4 h-4 transition-all duration-200 ${x?"fill-current":""}`})})},ce=t=>{if(!t)return"";const l=d.language;return l==="zh"?t.name:l==="pt"?t.name_pt||t.name_en||t.name:t.name_en||t.name},_e=()=>{const{t}=S();k();const{localizeActivity:l}=ae(),m=M(),o=F(),u=U(),[c,x]=g.useState(()=>localStorage.getItem("activity-mobile-columns")==="2"?2:1),p=()=>{const s=c===1?2:1;x(s),localStorage.setItem("activity-mobile-columns",String(s))};te();const{data:b,isLoading:h}=ee(),{data:v=[]}=se(),j=v.map(s=>s.activity_id),i=b?.filter(s=>s.status==="published"&&s.visible===!0),{displayedData:n,hasMore:I,loadMore:L}=re({data:i,initialItemsPerPage:6,incrementPerPage:6}),q=g.useCallback(async()=>{o.removeQueries({queryKey:["activities"]}),o.removeQueries({queryKey:["subscriptions"]}),await Promise.all([o.invalidateQueries({queryKey:["activities"]}),o.invalidateQueries({queryKey:["subscriptions"]})])},[o]);return e.jsx(le,{onRefresh:q,children:e.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4 animate-fade-in",children:e.jsxs("div",{className:"container mx-auto max-w-7xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-medium text-primary",children:t("activities.title")}),u&&e.jsx("div",{className:"inline-flex h-9 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",children:e.jsx("button",{onClick:p,title:c===1?t("activities.doubleColumn","双列布局"):t("activities.singleColumn","单列布局"),className:"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-2.5 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-background text-foreground shadow-sm",children:c===1?e.jsx(z,{className:"h-3.5 w-3.5"}):e.jsx(B,{className:"h-3.5 w-3.5"})})})]}),e.jsx("p",{className:"text-muted-foreground text-base sm:text-lg",children:t("activities.description")})]}),h&&e.jsx(ne,{count:4}),!h&&(!i||i.length===0)&&e.jsx("div",{className:"text-center py-20",children:e.jsx("p",{className:"text-xl text-muted-foreground",children:t("activities.noActivities")||"No activities available"})}),!h&&i&&i.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`grid gap-6 ${c===2?"grid-cols-2":"grid-cols-1"} md:grid-cols-2`,children:n.map(s=>{const N=l(s),a=u&&c===2;return e.jsx(X,{className:`overflow-hidden hover:shadow-large transition-shadow flex flex-col h-full ${a?"gap-0":""}`,children:e.jsxs(R,{to:`/activity/${s.id}`,className:"flex flex-col h-full",children:[e.jsxs("div",{className:`relative overflow-hidden ${a?"h-28":"h-48"}`,children:[s.media_type==="video"&&s.video_url?e.jsx("video",{src:s.video_url,poster:s.image_url||void 0,className:"w-full h-full object-cover transition-transform hover:scale-105",muted:!0,loop:!0,playsInline:!0,autoPlay:!0}):e.jsx("img",{src:s.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=600&q=80",alt:N.title,className:"w-full h-full object-cover transition-transform hover:scale-105"}),s.pinned&&e.jsx(f,{className:`absolute ${a?"top-1.5 left-1.5 text-[10px] px-1.5 py-0":"top-3 left-3"} bg-accent`,children:t("activities.pinned")}),!a&&s.service_type&&e.jsxs(f,{className:"absolute bottom-3 left-3 flex items-center gap-1",variant:"secondary",children:[s.service_type==="dine_in"&&e.jsx(y,{className:"w-3 h-3"}),s.service_type==="takeaway"&&e.jsx(C,{className:"w-3 h-3"}),s.service_type==="both"&&e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-3 h-3"}),e.jsx(C,{className:"w-3 h-3"})]}),t(`activities.serviceType.${s.service_type}`)]}),s.end_date&&new Date(s.end_date)<new Date?e.jsx(f,{className:`absolute ${a?"top-1.5 right-1.5 text-[10px] px-1.5 py-0":"top-3 right-3"} bg-secondary`,children:t("activities.ended")}):e.jsxs("div",{className:`absolute ${a?"top-1.5 right-1.5":"top-3 right-3"} flex gap-1`,children:[s.subscriber_count!==void 0&&e.jsxs(f,{variant:"secondary",className:`flex items-center gap-0.5 ${a?"text-[10px] px-1 py-0":"gap-1"}`,children:[e.jsx(T,{className:a?"w-2.5 h-2.5":"w-3 h-3"}),e.jsx("span",{children:s.subscriber_count})]}),!a&&s.share_count!==void 0&&s.share_count>0&&e.jsxs(f,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(Q,{className:"w-3 h-3"}),e.jsx("span",{children:s.share_count})]})]})]}),e.jsx(J,{className:a?"p-2 pb-1":"",children:e.jsx("h3",{className:`font-semibold text-card-foreground line-clamp-2 ${a?"text-sm":"text-xl"}`,children:N.title})}),e.jsxs(O,{className:`flex-1 ${a?"p-2 pt-0 space-y-1":"space-y-3"}`,children:[!a&&e.jsx("div",{className:`text-muted-foreground text-sm line-clamp-3\r
                            [&_h1]:text-base [&_h1]:font-bold [&_h1]:text-foreground\r
                            [&_h2]:text-sm [&_h2]:font-semibold [&_h2]:text-foreground\r
                            [&_h3]:text-sm [&_h3]:font-medium [&_h3]:text-foreground\r
                            [&_strong]:font-semibold [&_strong]:text-foreground\r
                            [&_p]:my-1\r
                            [&_ul]:list-disc [&_ul]:ml-4\r
                            [&_ol]:list-decimal [&_ol]:ml-4\r
                            [&_*]:!text-inherit`,dangerouslySetInnerHTML:{__html:N.content}}),s.start_date&&e.jsxs("div",{className:`flex items-center gap-1 text-muted-foreground ${a?"text-xs":"gap-2 text-sm"}`,children:[e.jsx(E,{className:a?"w-3 h-3":"w-4 h-4"}),e.jsx("span",{children:$(new Date(s.start_date),a?"MM/dd":"PPP")})]}),!a&&s.end_date&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsxs("span",{children:[t("activities.until")," ",$(new Date(s.end_date),"PPP")]})]}),!a&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{children:t("activities.creatorLabel")}),s.creator?.isAdmin?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("img",{src:A,alt:"Platform",className:"w-4 h-4 rounded-full object-contain"}),e.jsx("span",{className:"font-medium",children:t("activities.createdByPlatform")})]}):s.creator?.restaurant?e.jsxs("div",{className:"flex items-center gap-1 cursor-pointer",onClick:_=>{_.preventDefault(),_.stopPropagation(),m(`/restaurant/${s.creator.restaurant.id}`)},children:[s.creator.avatar_url?e.jsxs(V,{className:"w-4 h-4",children:[e.jsx(W,{src:s.creator.avatar_url,alt:"Creator"}),e.jsx(Y,{className:"text-[8px]",children:s.creator.restaurant.name.charAt(0)})]}):e.jsx("div",{className:"w-4 h-4 rounded-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-[8px] font-medium",children:s.creator.restaurant.name.charAt(0)})}),e.jsx("span",{className:"text-primary font-medium hover:underline",children:ce(s.creator.restaurant)})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("img",{src:A,alt:"Platform",className:"w-4 h-4 rounded-full object-contain"}),e.jsx("span",{className:"font-medium",children:t("activities.createdByPlatform")})]})]})]}),e.jsxs(Z,{className:`${a?"p-2 pt-0":"gap-2"}`,children:[e.jsx(w,{asChild:!0,className:`flex-1 ${a?"h-7 text-xs":""}`,size:a?"sm":"default",children:e.jsx("span",{children:t("activities.viewDetails")})}),!a&&e.jsx(oe,{activityId:s.id,initialSubscribed:j.includes(s.id)})]})]})},s.id)})}),I&&e.jsx("div",{className:"flex justify-center mt-8",children:e.jsxs(w,{onClick:L,size:"lg",variant:"outline",children:[t("common.loadMore")," (",n.length," / ",i.length,")"]})})]})]})})})};export{_e as default};
//# sourceMappingURL=Activities-qvyqZXeI.js.map
