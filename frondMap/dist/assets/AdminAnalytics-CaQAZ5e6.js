import{s as se,r as v,p as le,w as xe,j as e,bG as te,a6 as ae,ca as ce,a_ as oe,bT as me,ba as he,b5 as ue,cz as Q,cA as q,cB as X,cC as H,cD as W,cE as G,cF as B,cH as J,cm as pe,c_ as fe,c$ as ge,d0 as ye,ab as Y,cI as Z,cJ as ee,bD as je,c0 as ve,cG as ne}from"./vendor-react-DP7WA3kK.js";import{s as M,D as we,W as Ne,B as F,c as be,d as _e,e as Se,S as De,P as Ce,Q as ke,R as Me,g as P,j as Ve,C as S,p as D,F as C,q as k}from"./index-Bj9FRlJR.js";import{f as Ee}from"./paginatedQuery-_NvOJ4H_.js";import{f as re,s as Le,D as U,H as Ae,p as Te,I as Oe,J as ze}from"./vendor-utils-vwQGbBim.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-B6TzwYo7.js";const Fe=a=>{if(!a)return"direct";try{return new URL(a).hostname.replace("www.","")}catch{return"unknown"}},Ue=(a=30)=>se({queryKey:["analytics",a],queryFn:async()=>{let h=null;a===1?h=re(new Date).toISOString():a>1&&(h=re(Le(new Date,a-1)).toISOString());const p=await Ee("page_views","*",t=>(h&&(t=t.gte("created_at",h)),t.order("created_at",{ascending:!1}))),g=p.length,A=new Set(p.map(t=>t.visitor_id)).size,w={};p.forEach(t=>{w[t.page_type]=(w[t.page_type]||0)+1});const V=new Map;p.forEach(t=>{const n=U(new Date(t.created_at),"yyyy-MM-dd");V.has(n)||V.set(n,{views:0,visitors:new Set});const l=V.get(n);l.views++,l.visitors.add(t.visitor_id)});const o=Array.from(V.entries()).map(([t,n])=>({date:t,views:n.views,uniqueVisitors:n.visitors.size})).sort((t,n)=>t.date.localeCompare(n.date)),E=new Map;p.forEach(t=>{const n=Fe(t.referer);E.set(n,(E.get(n)||0)+1)});const R=Array.from(E.entries()).map(([t,n])=>({domain:t,count:n,percentage:g>0?n/g*100:0})).sort((t,n)=>n.count-t.count),T=new Map;p.forEach(t=>{const n=t.country||"unknown";T.set(n,(T.get(n)||0)+1)});const $=Array.from(T.entries()).map(([t,n])=>({location:t,count:n,percentage:g>0?n/g*100:0})).sort((t,n)=>n.count-t.count),O=new Map;p.forEach(t=>{const n=t.city||"unknown";O.set(n,(O.get(n)||0)+1)});const I=Array.from(O.entries()).map(([t,n])=>({location:t,count:n,percentage:g>0?n/g*100:0})).sort((t,n)=>n.count-t.count),_=new Map;p.forEach(t=>{const n=U(new Date(t.created_at),"yyyy-MM-dd"),l=t.country||"unknown";_.has(l)||_.set(l,new Map);const f=_.get(l);f.set(n,(f.get(n)||0)+1)});const z=[];_.forEach((t,n)=>{t.forEach((l,f)=>{z.push({date:f,location:n,views:l})})}),z.sort((t,n)=>t.date.localeCompare(n.date));const c=new Map;p.forEach(t=>{const n=U(new Date(t.created_at),"yyyy-MM-dd"),l=t.city||"unknown";c.has(l)||c.set(l,new Map);const f=c.get(l);f.set(n,(f.get(n)||0)+1)});const L=[];c.forEach((t,n)=>{t.forEach((l,f)=>{L.push({date:f,location:n,views:l})})}),L.sort((t,n)=>t.date.localeCompare(n.date));const d=new Map;p.filter(t=>t.page_type==="restaurant"&&t.target_id).forEach(t=>{d.set(t.target_id,(d.get(t.target_id)||0)+1)});const i=Array.from(d.entries()).sort((t,n)=>n[1]-t[1]).slice(0,10);let m=[];if(i.length>0){const{data:t}=await M.from("restaurants").select("id, name").in("id",i.map(n=>n[0]));m=i.map(([n,l])=>({id:n,name:t?.find(f=>f.id===n)?.name||"Unknown",views:l}))}const x=new Map;p.filter(t=>t.page_type==="activity"&&t.target_id).forEach(t=>{x.set(t.target_id,(x.get(t.target_id)||0)+1)});const u=Array.from(x.entries()).sort((t,n)=>n[1]-t[1]).slice(0,10);let N=[];if(u.length>0){const{data:t}=await M.from("activities").select("id, title_zh, title_en, title_pt").in("id",u.map(n=>n[0]));N=u.map(([n,l])=>{const f=t?.find(y=>y.id===n);return{id:n,title:f?.title_zh||f?.title_en||"Unknown",views:l}})}return{totalViews:g,uniqueVisitors:A,viewsByPage:w,dailyViews:o,topRestaurants:m,topActivities:N,refererStats:R,countryStats:$,cityStats:I,countryDailyViews:z,cityDailyViews:L}}}),de=()=>{const[a,h]=v.useState(new Set),[p,g]=v.useState(new Set),[b,A]=v.useState([]),[w,V]=v.useState(null),[o,E]=v.useState(null);v.useEffect(()=>{console.log("Initializing online users observer...");const d=M.channel("online-users");return d.on("presence",{event:"sync"},()=>{const i=d.presenceState(),m=new Set;Object.keys(i).forEach(x=>{m.add(x)}),h(m),console.log("Presence sync - online users:",Array.from(m))}).on("presence",{event:"join"},({key:i,newPresences:m})=>{console.log("User joined:",i,m),h(x=>new Set([...x,i]))}).on("presence",{event:"leave"},({key:i,leftPresences:m})=>{console.log("User left:",i,m),h(x=>{const u=new Set(x);return u.delete(i),u})}).subscribe(i=>{console.log("Presence channel status:",i)}),V(d),()=>{console.log("Cleaning up online users observer..."),M.removeChannel(d)}},[]),v.useEffect(()=>{console.log("Initializing online visitors observer...");const d=M.channel("online-visitors");return d.on("presence",{event:"sync"},()=>{const i=d.presenceState(),m=new Set,x=[];Object.entries(i).forEach(([u,N])=>{if(m.add(u),N&&N.length>0){const t=N[0];x.push({visitor_id:u,online_at:t.online_at,country:t.country,city:t.city})}}),g(m),A(x),console.log("Visitor presence sync - online visitors:",Array.from(m))}).on("presence",{event:"join"},({key:i,newPresences:m})=>{if(console.log("Visitor joined:",i,m),g(x=>new Set([...x,i])),m&&m.length>0){const x=m[0];A(u=>[...u.filter(N=>N.visitor_id!==i),{visitor_id:i,online_at:x.online_at,country:x.country,city:x.city}])}}).on("presence",{event:"leave"},({key:i,leftPresences:m})=>{console.log("Visitor left:",i,m),g(x=>{const u=new Set(x);return u.delete(i),u}),A(x=>x.filter(u=>u.visitor_id!==i))}).subscribe(i=>{console.log("Visitor presence channel status:",i)}),E(d),()=>{console.log("Cleaning up online visitors observer..."),M.removeChannel(d)}},[]);const{data:R,isLoading:T,refetch:$}=se({queryKey:["online-users-details",Array.from(a).sort().join(",")],queryFn:async()=>{if(a.size===0)return[];const d=Array.from(a);console.log("Fetching details for online users:",d);const{data:i,error:m}=await M.from("user_presence").select("*").in("user_id",d);m&&console.error("Error fetching presence:",m);const{data:x,error:u}=await M.rpc("get_public_profiles",{user_ids:d});u&&console.error("Error fetching profiles:",u);const{data:N,error:t}=await M.from("user_roles").select("user_id, role").in("user_id",d);t&&console.error("Error fetching roles:",t);const n=new Map((i||[]).map(y=>[y.user_id,y])),l=new Map((x||[]).map(y=>[y.id,y])),f=new Map((N||[]).map(y=>[y.user_id,y.role]));return d.map(y=>{const s=n.get(y),r=l.get(y);return{user_id:y,is_online:!0,last_seen:s?.last_seen||new Date().toISOString(),ip_address:s?.ip_address,city:s?.city,country:s?.country,profile:r?{display_name:r.display_name,avatar_url:r.avatar_url}:void 0,role:f.get(y)}})},enabled:a.size>0,staleTime:1e4}),{data:O,refetch:I}=se({queryKey:["online-users-db-fallback"],queryFn:async()=>{const d=new Date(Date.now()-12e4).toISOString(),{data:i,error:m}=await M.from("user_presence").select("*").gte("last_seen",d).order("last_seen",{ascending:!1});if(m)return console.error("Error fetching DB presence:",m),[];if(!i||i.length===0)return[];const x=i.map(l=>l.user_id),{data:u}=await M.rpc("get_public_profiles",{user_ids:x}),{data:N}=await M.from("user_roles").select("user_id, role").in("user_id",x),t=new Map((u||[]).map(l=>[l.id,l])),n=new Map((N||[]).map(l=>[l.user_id,l.role]));return i.map(l=>({user_id:l.user_id,is_online:l.is_online,last_seen:l.last_seen,ip_address:l.ip_address,city:l.city,country:l.country,profile:t.get(l.user_id)?{display_name:t.get(l.user_id).display_name,avatar_url:t.get(l.user_id).avatar_url}:void 0,role:n.get(l.user_id)}))},refetchInterval:3e4}),_=(()=>{const d=new Map;return(O||[]).forEach(i=>{d.set(i.user_id,i)}),(R||[]).forEach(i=>{d.set(i.user_id,{...i,is_online:!0})}),a.forEach(i=>{d.has(i)||d.set(i,{user_id:i,is_online:!0,last_seen:new Date().toISOString()})}),Array.from(d.values())})(),z=_.length,c=p.size;return{onlineUsers:_,onlineCount:z,onlineVisitors:b,visitorCount:c,isLoading:T,refetch:async()=>{await Promise.all([$(),I()])}}},Re=({trigger:a})=>{const{t:h,i18n:p}=le(),[g,b]=v.useState(!1),[A,w]=v.useState(!1),{onlineUsers:V,onlineCount:o,isLoading:E,refetch:R}=de(),T=v.useCallback(async()=>{w(!0);try{await R(),xe.success(h("common.refreshed","已刷新"))}finally{w(!1)}},[R,h]),$=()=>{switch(p.language){case"zh":return ze;case"pt":return Oe;default:return Te}},O=c=>{switch(c){case"admin":return"destructive";case"supervisor":return"default";case"merchant":return"secondary";default:return"outline"}},I=c=>{switch(c){case"admin":return h("admin.role.admin","管理员");case"supervisor":return h("admin.role.supervisor","主管");case"merchant":return h("admin.role.merchant","商家");default:return h("admin.role.user","用户")}},_=(c,L)=>c&&L?`${c}, ${L}`:c||L||null,z=c=>c.city||c.country||c.ip_address;return e.jsxs(we,{open:g,onOpenChange:b,children:[e.jsx(Ne,{asChild:!0,children:a||e.jsxs(F,{variant:"outline",size:"sm",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),h("admin.onlineUsers.viewOnline","查看在线用户")]})}),e.jsxs(be,{className:"max-w-md",children:[e.jsx(_e,{children:e.jsxs(Se,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-3 h-3 fill-green-500 text-green-500"}),h("admin.onlineUsers.title","在线用户")," (",o,")"]})}),e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs(F,{variant:"ghost",size:"sm",onClick:T,disabled:E||A,children:[e.jsx(ce,{className:`w-4 h-4 mr-1 ${E||A?"animate-spin":""}`}),h("common.refresh","刷新")]})}),e.jsx(De,{className:"h-[400px] pr-4",children:E?e.jsx("div",{className:"flex items-center justify-center h-32 text-muted-foreground",children:h("common.loading","加载中...")}):V.length===0?e.jsx("div",{className:"flex items-center justify-center h-32 text-muted-foreground",children:h("admin.onlineUsers.noOnline","暂无在线用户")}):e.jsx("div",{className:"space-y-3",children:V.map(c=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(Ce,{className:"h-10 w-10",children:[e.jsx(ke,{src:c.profile?.avatar_url||void 0}),e.jsx(Me,{children:c.profile?.display_name?.charAt(0)||"?"})]}),e.jsx(ae,{className:`absolute -bottom-0.5 -right-0.5 w-3 h-3 ${c.is_online?"fill-green-500 text-green-500":"fill-yellow-500 text-yellow-500"}`})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium truncate",children:c.profile?.display_name||h("common.anonymous","匿名用户")}),e.jsx(P,{variant:O(c.role),className:"text-xs",children:I(c.role)})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c.is_online?h("admin.onlineUsers.online","在线中"):h("admin.onlineUsers.lastSeen","最后活跃 {{time}}",{time:Ae(new Date(c.last_seen),{addSuffix:!0,locale:$()})})}),z(c)&&e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-xs text-muted-foreground",children:[e.jsx(oe,{className:"w-3 h-3"}),e.jsxs("span",{className:"truncate",children:[_(c.city,c.country)&&e.jsx("span",{children:_(c.city,c.country)}),c.ip_address&&e.jsxs(e.Fragment,{children:[_(c.city,c.country)&&e.jsx("span",{className:"mx-1",children:"·"}),e.jsx("span",{className:"font-mono text-[10px]",children:c.ip_address})]})]})]})]})]},c.user_id))})})]})]})},ie=["hsl(var(--primary))","hsl(var(--chart-2))","hsl(var(--chart-3))","hsl(var(--chart-4))","hsl(var(--chart-5))","hsl(var(--muted-foreground))"],K=["hsl(var(--primary))","hsl(var(--chart-2))","hsl(var(--chart-3))","hsl(var(--chart-4))","hsl(var(--chart-5))"],We=()=>{const{t:a,i18n:h}=le(),[p,g]=v.useState(30),[b,A]=v.useState([]),[w,V]=v.useState([]),{data:o,isLoading:E,refetch:R,isRefetching:T}=Ue(p),{onlineCount:$,visitorCount:O,isLoading:I}=de(),_={home:a("analytics.pageTypes.home","首页"),restaurant:a("analytics.pageTypes.restaurant","餐厅详情"),activity:a("analytics.pageTypes.activity","活动详情"),restaurants:a("analytics.pageTypes.restaurants","餐厅列表"),activities:a("analytics.pageTypes.activities","活动列表"),map:a("analytics.pageTypes.map","地图"),profile:a("analytics.pageTypes.profile","个人资料"),auth:a("analytics.pageTypes.auth","登录/注册"),"join-us":a("analytics.pageTypes.joinUs","加入我们"),other:a("analytics.pageTypes.other","其他")},z={direct:a("analytics.referer.direct","直接访问"),unknown:a("analytics.referer.unknown","未知来源")},c={unknown:a("analytics.location.unknown","未知地区")},L=s=>z[s]||s,d=s=>c[s]||s,i=v.useMemo(()=>o?.countryStats?.slice(0,10).map(s=>s.location)||[],[o?.countryStats]),m=v.useMemo(()=>o?.cityStats?.slice(0,10).map(s=>s.location)||[],[o?.cityStats]),x=v.useMemo(()=>{if(!o?.countryDailyViews||b.length===0)return[];const s=new Map;return o.countryDailyViews.filter(r=>b.includes(r.location)).forEach(r=>{s.has(r.date)||s.set(r.date,{}),s.get(r.date)[r.location]=r.views}),Array.from(s.entries()).map(([r,j])=>({date:r,...j})).sort((r,j)=>r.date.localeCompare(j.date))},[o?.countryDailyViews,b]),u=v.useMemo(()=>{if(!o?.cityDailyViews||w.length===0)return[];const s=new Map;return o.cityDailyViews.filter(r=>w.includes(r.location)).forEach(r=>{s.has(r.date)||s.set(r.date,{}),s.get(r.date)[r.location]=r.views}),Array.from(s.entries()).map(([r,j])=>({date:r,...j})).sort((r,j)=>r.date.localeCompare(j.date))},[o?.cityDailyViews,w]),N=o?.viewsByPage?Object.entries(o.viewsByPage).map(([s,r])=>({name:_[s]||s,value:r})):[],t=o?.refererStats?.slice(0,10).map(s=>({name:L(s.domain),value:s.count,percentage:s.percentage.toFixed(1)}))||[],n=o?.countryStats?.slice(0,10).map(s=>({name:d(s.location),value:s.count,percentage:s.percentage.toFixed(1)}))||[],l=o?.cityStats?.slice(0,10).map(s=>({name:d(s.location),value:s.count,percentage:s.percentage.toFixed(1)}))||[],f=s=>{A(r=>r.includes(s)?r.filter(j=>j!==s):r.length<5?[...r,s]:r)},y=s=>{V(r=>r.includes(s)?r.filter(j=>j!==s):r.length<5?[...r,s]:r)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:a("analytics.title","访问统计")}),e.jsx("p",{className:"text-muted-foreground",children:a("analytics.description","网站访问数据分析")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[e.jsx(F,{variant:p===1?"default":"outline",size:"sm",onClick:()=>g(1),children:a("analytics.today","今日")}),[7,30,90].map(s=>e.jsxs(F,{variant:p===s?"default":"outline",size:"sm",onClick:()=>g(s),children:[s,a("analytics.days","天")]},s)),e.jsx(F,{variant:p===0?"default":"outline",size:"sm",onClick:()=>g(0),children:a("analytics.all","所有")})]}),e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>R(),disabled:T,children:[e.jsx(ce,{className:`w-4 h-4 mr-1 ${T?"animate-spin":""}`}),a("common.refresh","刷新")]})]})]}),E?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map((s,r)=>e.jsx(Ve,{className:"h-32"},r))}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs(S,{className:"border-green-500/50 bg-green-500/5",children:[e.jsxs(D,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs(C,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ae,{className:"h-3 w-3 fill-green-500 text-green-500"}),a("analytics.onlineUsers","在线用户")]}),e.jsx(te,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(k,{children:[e.jsxs("div",{className:"flex items-baseline gap-3",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:I?"-":$}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx("span",{className:"text-sm",children:"+"}),e.jsx("span",{className:"text-lg font-semibold text-blue-600 dark:text-blue-400",children:I?"-":O}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a("analytics.visitors","访客")})]})]}),e.jsx("div",{className:"mt-2",children:e.jsx(Re,{trigger:e.jsxs(F,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-green-600 dark:text-green-400 hover:text-green-700",children:[a("analytics.viewOnlineUsers","查看在线用户")," →"]})})})]})]}),e.jsxs(S,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:a("analytics.totalViews","总访问量")}),e.jsx(me,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o?.totalViews.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:p===0?a("analytics.allTime","所有时间"):p===1?a("analytics.today","今日"):a("analytics.lastNDays","最近{{days}}天",{days:p})})]})]}),e.jsxs(S,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:a("analytics.uniqueVisitors","独立访客")}),e.jsx(te,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o?.uniqueVisitors.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a("analytics.uniqueVisitorDesc","基于访客ID")})]})]}),e.jsxs(S,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:a("analytics.restaurantViews","餐厅浏览")}),e.jsx(he,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(o?.viewsByPage?.restaurant||0).toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a("analytics.restaurantViewsDesc","餐厅详情页访问")})]})]}),e.jsxs(S,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:a("analytics.activityViews","活动浏览")}),e.jsx(ue,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(o?.viewsByPage?.activity||0).toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a("analytics.activityViewsDesc","活动详情页访问")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S,{children:[e.jsx(D,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),a("analytics.dailyTrend","每日访问趋势")]})}),e.jsx(k,{children:e.jsx("div",{className:"h-[300px]",children:o?.dailyViews&&o.dailyViews.length>0?e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(X,{data:o.dailyViews,children:[e.jsx(H,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(W,{dataKey:"date",tickFormatter:s=>U(new Date(s),"MM/dd"),className:"text-xs"}),e.jsx(G,{className:"text-xs"}),e.jsx(B,{labelFormatter:s=>U(new Date(s),"yyyy-MM-dd"),contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(J,{type:"monotone",dataKey:"views",stroke:"hsl(var(--primary))",strokeWidth:2,name:a("analytics.views","访问量")}),e.jsx(J,{type:"monotone",dataKey:"uniqueVisitors",stroke:"hsl(var(--chart-2))",strokeWidth:2,name:a("analytics.uniqueVisitors","独立访客")})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:a("analytics.noData","暂无数据")})})})]}),e.jsxs(S,{children:[e.jsx(D,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5"}),a("analytics.pageDistribution","页面访问分布")]})}),e.jsx(k,{children:e.jsx("div",{className:"h-[300px]",children:N.length>0?e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(fe,{children:[e.jsx(ge,{data:N,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,percent:r})=>`${s} ${(r*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:N.map((s,r)=>e.jsx(ye,{fill:ie[r%ie.length]},`cell-${r}`))}),e.jsx(B,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:a("analytics.noData","暂无数据")})})})]})]}),e.jsxs(S,{children:[e.jsx(D,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),a("analytics.refererStats","访问来源统计")]})}),e.jsx(k,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-[300px]",children:t.length>0?e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(Z,{data:t,layout:"vertical",children:[e.jsx(H,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(W,{type:"number",className:"text-xs"}),e.jsx(G,{dataKey:"name",type:"category",width:120,className:"text-xs",tick:{fontSize:11}}),e.jsx(B,{formatter:(s,r,j)=>[`${s} (${j.payload.percentage}%)`,a("analytics.views","访问量")],contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(ee,{dataKey:"value",fill:"hsl(var(--primary))",radius:[0,4,4,0]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:a("analytics.noData","暂无数据")})}),e.jsx("div",{className:"space-y-3 max-h-[300px] overflow-y-auto",children:o?.refererStats&&o.refererStats.length>0?o.refererStats.map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{variant:r<3?"default":"secondary",className:"w-6 h-6 p-0 justify-center",children:r+1}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm truncate max-w-[150px]",children:L(s.domain)})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium",children:s.count}),e.jsxs(P,{variant:"outline",className:"text-xs",children:[s.percentage.toFixed(1),"%"]})]})]},s.domain)):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:a("analytics.noData","暂无数据")})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S,{children:[e.jsx(D,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),a("analytics.countryStats","国家/地区统计")]})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[200px]",children:n.length>0?e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(Z,{data:n,layout:"vertical",children:[e.jsx(H,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(W,{type:"number",className:"text-xs"}),e.jsx(G,{dataKey:"name",type:"category",width:100,className:"text-xs",tick:{fontSize:11}}),e.jsx(B,{formatter:(s,r,j)=>[`${s} (${j.payload.percentage}%)`,a("analytics.views","访问量")],contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(ee,{dataKey:"value",fill:"hsl(var(--chart-2))",radius:[0,4,4,0]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:a("analytics.noData","暂无数据")})}),e.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto",children:o?.countryStats&&o.countryStats.length>0?o.countryStats.slice(0,10).map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{variant:r<3?"default":"secondary",className:"w-6 h-6 p-0 justify-center",children:r+1}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm truncate max-w-[120px]",children:d(s.location)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:s.count}),e.jsxs(P,{variant:"outline",className:"text-xs",children:[s.percentage.toFixed(1),"%"]})]})]},s.location)):e.jsx("p",{className:"text-muted-foreground text-center py-4",children:a("analytics.noData","暂无数据")})})]})})]}),e.jsxs(S,{children:[e.jsx(D,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5"}),a("analytics.cityStats","城市统计")]})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[200px]",children:l.length>0?e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(Z,{data:l,layout:"vertical",children:[e.jsx(H,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(W,{type:"number",className:"text-xs"}),e.jsx(G,{dataKey:"name",type:"category",width:100,className:"text-xs",tick:{fontSize:11}}),e.jsx(B,{formatter:(s,r,j)=>[`${s} (${j.payload.percentage}%)`,a("analytics.views","访问量")],contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(ee,{dataKey:"value",fill:"hsl(var(--chart-3))",radius:[0,4,4,0]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:a("analytics.noData","暂无数据")})}),e.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto",children:o?.cityStats&&o.cityStats.length>0?o.cityStats.slice(0,10).map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{variant:r<3?"default":"secondary",className:"w-6 h-6 p-0 justify-center",children:r+1}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm truncate max-w-[120px]",children:d(s.location)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:s.count}),e.jsxs(P,{variant:"outline",className:"text-xs",children:[s.percentage.toFixed(1),"%"]})]})]},s.location)):e.jsx("p",{className:"text-muted-foreground text-center py-4",children:a("analytics.noData","暂无数据")})})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S,{children:[e.jsx(D,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),a("analytics.countryTrend","国家/地区访问趋势")]})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map((s,r)=>e.jsx(F,{variant:b.includes(s)?"default":"outline",size:"sm",onClick:()=>f(s),className:"text-xs",style:b.includes(s)?{backgroundColor:K[b.indexOf(s)%K.length]}:{},children:d(s)},s))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a("analytics.selectLocationsHint","选择最多5个地区查看趋势（点击选择/取消）")}),e.jsx("div",{className:"h-[250px]",children:x.length>0?e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(X,{data:x,children:[e.jsx(H,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(W,{dataKey:"date",tickFormatter:s=>U(new Date(s),"MM/dd"),className:"text-xs"}),e.jsx(G,{className:"text-xs"}),e.jsx(B,{labelFormatter:s=>U(new Date(s),"yyyy-MM-dd"),contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(ne,{}),b.map((s,r)=>e.jsx(J,{type:"monotone",dataKey:s,stroke:K[r%K.length],strokeWidth:2,name:d(s),dot:!1},s))]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:b.length===0?a("analytics.selectLocations","请选择地区查看趋势"):a("analytics.noData","暂无数据")})})]})})]}),e.jsxs(S,{children:[e.jsx(D,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),a("analytics.cityTrend","城市访问趋势")]})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map((s,r)=>e.jsx(F,{variant:w.includes(s)?"default":"outline",size:"sm",onClick:()=>y(s),className:"text-xs",style:w.includes(s)?{backgroundColor:K[w.indexOf(s)%K.length]}:{},children:d(s)},s))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a("analytics.selectLocationsHint","选择最多5个地区查看趋势（点击选择/取消）")}),e.jsx("div",{className:"h-[250px]",children:u.length>0?e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(X,{data:u,children:[e.jsx(H,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(W,{dataKey:"date",tickFormatter:s=>U(new Date(s),"MM/dd"),className:"text-xs"}),e.jsx(G,{className:"text-xs"}),e.jsx(B,{labelFormatter:s=>U(new Date(s),"yyyy-MM-dd"),contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(ne,{}),w.map((s,r)=>e.jsx(J,{type:"monotone",dataKey:s,stroke:K[r%K.length],strokeWidth:2,name:d(s),dot:!1},s))]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:w.length===0?a("analytics.selectLocations","请选择地区查看趋势"):a("analytics.noData","暂无数据")})})]})})]})]})]})]})};export{We as default};
//# sourceMappingURL=AdminAnalytics-CaQAZ5e6.js.map
