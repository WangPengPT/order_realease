import{k as Ke,al as Qe,am as Xe,h as Ye,r as o,u as Re,j as e,C as xe,e as fe,o as ge,an as we,f as pe,a7 as d,I as y,B as h,g as je,L as es,s as x,z as a}from"./index-BHnm7QJX.js";import{T as ss,a as ts,b as ye,c as ve}from"./tabs-DUBUOme8.js";import{u as N}from"./index.esm-CeuRZ0ll.js";import{o as b,s as l,t as S}from"./types-DXAl5Bp3.js";import{I as Ne,a as be,b as P}from"./input-otp-DD1jljig.js";import{C as rs}from"./checkbox-DswrG7h7.js";import{E as q}from"./eye-off-CrvReyVo.js";import{E as K}from"./eye-BuepfMw3.js";import{A as as}from"./arrow-left-DMzYR4mm.js";const ps=()=>{const{signIn:Se,signUp:Pe,signInWithGoogle:os,signInWithPhone:is,verifyOTP:ns,user:Q,isBanned:X,isCheckingBanStatus:Y}=Ke(),{settings:p}=Qe(),R=(p==null?void 0:p.logo_url)||Xe,ee=(p==null?void 0:p.logo_width)||35,se=(p==null?void 0:p.logo_height)||35,te=Ye(),[c,i]=o.useState(!1),[Ce,re]=o.useState("login"),[cs,ke]=o.useState("phone");o.useState(""),o.useState("+351");const[Fe,A]=o.useState("info"),[_,Ee]=o.useState(""),[V,ae]=o.useState(null),[f,$]=o.useState(0),[g,oe]=o.useState(null),[z,Te]=o.useState(!1);o.useState(!1),o.useState(!1);const[ie,Le]=o.useState(()=>{try{return localStorage.getItem("rememberMe")==="true"}catch{return!1}}),[ne,ce]=o.useState(!1),[T,D]=o.useState("email"),[B,le]=o.useState(""),[Me,de]=o.useState(""),[W,Ie]=o.useState(!1),[G,Ae]=o.useState(!1),[w,Z]=o.useState(null),[M,O]=o.useState(!1),[C,U]=o.useState(0),[H,J]=o.useState(null),{t:s}=Re(),Ve=b({email:l().email(s("auth.invalidEmail")),password:l().min(6,s("auth.passwordMin"))}),$e=b({displayName:l().min(2,s("auth.displayNameMin")),email:l().email(s("auth.invalidEmail")),password:l().min(6,s("auth.passwordMin")),confirmPassword:l()}).refine(r=>r.password===r.confirmPassword,{message:s("auth.passwordsDontMatch"),path:["confirmPassword"]}),De=b({phone:l().min(6,s("auth.phoneMin"))}),Be=b({otp:l().length(6,s("auth.otpLength"))}),Oe=b({code:l().length(4,"Verification code must be 4 digits")}),Ue=b({email:l().email(s("auth.invalidEmail"))}),He=b({code:l().length(4,"Verification code must be 4 digits")}),_e=b({newPassword:l().min(6,s("auth.passwordMin")),confirmNewPassword:l()}).refine(r=>r.newPassword===r.confirmNewPassword,{message:s("auth.passwordsDontMatch"),path:["confirmNewPassword"]}),k=N({resolver:S(Ve)}),n=N({resolver:S($e)});N({resolver:S(De)}),N({resolver:S(Be)});const F=N({resolver:S(Oe)}),I=N({resolver:S(Ue)}),L=N({resolver:S(He)}),j=N({resolver:S(_e)});o.useEffect(()=>{Q&&!X&&!Y&&te("/")},[Q,te,X,Y]),o.useEffect(()=>{let r;return f>0&&(r=setTimeout(()=>$(f-1),1e3)),()=>clearTimeout(r)},[f]),o.useEffect(()=>{let r;return C>0&&(r=setTimeout(()=>U(C-1),1e3),C<=1&&(O(!1),J(null))),()=>clearTimeout(r)},[C]),o.useEffect(()=>{(async()=>{try{const{data:t,error:m}=await x.functions.invoke("check-login-security",{body:{action:"check"}});!m&&(t!=null&&t.isLimited)&&(O(!0),U(t.remainingSeconds))}catch(t){console.error("Failed to check login security:",t)}})()},[]);const me=r=>{let t=0;return r.length>=6&&t++,r.length>=8&&t++,/[a-z]/.test(r)&&t++,/[A-Z]/.test(r)&&t++,/[0-9]/.test(r)&&t++,/[^a-zA-Z0-9]/.test(r)&&t++,t<=2?"weak":t<=4?"medium":"strong"},ze=async r=>{if(M){const t=Math.ceil(C/60);a.error(s("auth.tooManyAttempts",{minutes:t}));return}i(!0);try{const{data:t,error:m}=await x.functions.invoke("check-login-security",{body:{action:"check"}});if(!m&&(t!=null&&t.isLimited)){O(!0),U(t.remainingSeconds);const u=Math.ceil(t.remainingSeconds/60);a.error(s("auth.tooManyAttempts",{minutes:u})),i(!1);return}const{error:v}=await Se(r.email,r.password,ie);if(v){if(v.message==="ACCOUNT_BANNED")return;await x.functions.invoke("check-login-security",{body:{action:"record",email:r.email,success:!1}}).then(({data:u})=>{if(u!=null&&u.isLimited){O(!0),U(u.remainingSeconds);const E=Math.ceil(u.remainingSeconds/60);a.error(s("auth.tooManyAttempts",{minutes:E}))}else if((u==null?void 0:u.attemptCount)!==void 0){const E=5-u.attemptCount;J(E>0?E:0),a.error(s("auth.invalidCredentials")),E>0&&E<=3&&a.warning(s("auth.remainingAttempts",{count:E}))}});return}await x.functions.invoke("check-login-security",{body:{action:"record",email:r.email,success:!0}}),J(null),a.success(s("auth.signInSuccess"))}catch{a.error(s("auth.invalidCredentials"))}finally{i(!1)}},We=async r=>{i(!0);try{ae(r),Ee(r.email);const{error:t}=await x.functions.invoke("send-verification-code",{body:{email:r.email}});if(t){a.error(s("auth.verificationCodeFailed")),console.error(t);return}A("verify"),a.success(s("auth.verificationCodeSent")),$(30)}catch(t){a.error(t.message||s("error.general"))}finally{i(!1)}},Ge=async r=>{if(V){i(!0);try{const{data:t,error:m}=await x.functions.invoke("verify-email-code",{body:{email:_,code:r.code}});if(m||!(t!=null&&t.success)){a.error((t==null?void 0:t.error)||s("auth.invalidVerificationCode"));return}const{error:v}=await Pe(V.email,V.password,V.displayName);if(v){v.message.includes("already registered")?a.error(s("auth.emailExists")):a.error(v.message);return}a.success(s("auth.signUpSuccess")),re("login"),A("info"),n.reset(),F.reset(),ae(null)}catch(t){a.error(t.message||s("error.general"))}finally{i(!1)}}},ue=async()=>{if(!(f>0)){i(!0);try{const r=ne?B:_,{error:t}=await x.functions.invoke("send-verification-code",{body:{email:r}});if(t){a.error(s("toast.resendCodeFailed"));return}a.success(s("toast.verificationCodeResent")),$(30)}catch(r){a.error(r.message||"Failed to resend code")}finally{i(!1)}}},Ze=async r=>{i(!0);try{const{data:t,error:m}=await x.functions.invoke("check-email-registered",{body:{email:r.email}});if(m){a.error(s("error.general"));return}if(!(t!=null&&t.registered)){a.error(s("auth.emailNotRegistered"));return}const{error:v}=await x.functions.invoke("send-verification-code",{body:{email:r.email}});if(v){a.error(s("auth.verificationCodeFailed"));return}le(r.email),D("verify"),a.success(s("auth.verificationCodeSent")),$(30)}catch(t){a.error(t.message||s("error.general"))}finally{i(!1)}},Je=async r=>{i(!0);try{const{data:t,error:m}=await x.functions.invoke("verify-email-code",{body:{email:B,code:r.code}});if(m||!(t!=null&&t.success)){a.error((t==null?void 0:t.error)||s("auth.invalidVerificationCode"));return}de(r.code),D("newPassword"),a.success(s("auth.codeVerified"))}catch(t){a.error(t.message||s("error.general"))}finally{i(!1)}},qe=async r=>{i(!0);try{const{data:t,error:m}=await x.functions.invoke("reset-password",{body:{email:B,code:Me,newPassword:r.newPassword}});if(m||!(t!=null&&t.success)){a.error((t==null?void 0:t.error)||s("auth.passwordResetFailed"));return}a.success(s("auth.passwordResetSuccess")),he()}catch(t){a.error(t.message||s("error.general"))}finally{i(!1)}},he=()=>{ce(!1),D("email"),le(""),de(""),I.reset(),L.reset(),j.reset(),Z(null)};return ne?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-hero p-4",children:e.jsxs(xe,{className:"w-full max-w-md shadow-large",children:[e.jsxs(fe,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:R,alt:"Logo",style:{width:`${ee}px`,height:`${se}px`},className:"object-contain drop-shadow-md"})}),e.jsx(ge,{className:"text-2xl",children:s("auth.forgotPassword")}),e.jsxs(we,{children:[T==="email"&&s("auth.forgotPasswordDescription"),T==="verify"&&s("auth.verifyCodeDescription"),T==="newPassword"&&s("auth.setNewPasswordDescription")]})]}),e.jsxs(pe,{children:[T==="email"&&e.jsxs("form",{onSubmit:I.handleSubmit(Ze),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"forgot-email",children:s("auth.email")}),e.jsx(y,{id:"forgot-email",type:"email",placeholder:"you@example.com",...I.register("email")}),I.formState.errors.email&&e.jsx("p",{className:"text-sm text-destructive",children:I.formState.errors.email.message})]}),e.jsx(h,{type:"submit",className:"w-full",disabled:c,children:s(c?"auth.sendingCode":"auth.sendCode")})]}),T==="verify"&&e.jsxs("form",{onSubmit:L.handleSubmit(Je),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:s("auth.verificationCode")}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:s("auth.verificationCodeHint",{email:B})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Ne,{maxLength:4,...L.register("code"),onChange:r=>L.setValue("code",r),children:e.jsxs(be,{children:[e.jsx(P,{index:0}),e.jsx(P,{index:1}),e.jsx(P,{index:2}),e.jsx(P,{index:3})]})})}),L.formState.errors.code&&e.jsx("p",{className:"text-sm text-destructive text-center",children:L.formState.errors.code.message})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{type:"button",variant:"outline",className:"w-full",onClick:()=>D("email"),children:s("common.back")}),e.jsx(h,{type:"submit",className:"w-full",disabled:c,children:s(c?"auth.verifying":"auth.verify")})]}),e.jsx(h,{type:"button",variant:"ghost",className:"w-full text-sm",onClick:ue,disabled:c||f>0,children:f>0?s("auth.resendIn",{seconds:f}):s("auth.resendCode")})]}),T==="newPassword"&&e.jsxs("form",{onSubmit:j.handleSubmit(qe),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"new-password",children:s("auth.newPassword")}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{id:"new-password",type:W?"text":"password",placeholder:s("auth.passwordPlaceholder"),...j.register("newPassword"),onChange:r=>{j.setValue("newPassword",r.target.value),r.target.value?Z(me(r.target.value)):Z(null)}}),e.jsx("button",{type:"button",onClick:()=>Ie(!W),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:W?e.jsx(q,{className:"h-4 w-4"}):e.jsx(K,{className:"h-4 w-4"})})]}),j.formState.errors.newPassword&&e.jsx("p",{className:"text-sm text-destructive",children:j.formState.errors.newPassword.message}),w&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${w==="weak"?"bg-destructive":w==="medium"?"bg-warning":"bg-success"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${w==="medium"||w==="strong"?w==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${w==="strong"?"bg-success":"bg-muted"}`})]}),e.jsx("p",{className:`text-xs ${w==="weak"?"text-destructive":w==="medium"?"text-warning":"text-success"}`,children:s(`auth.passwordStrength.${w}`)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"confirm-new-password",children:s("auth.confirmNewPassword")}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{id:"confirm-new-password",type:G?"text":"password",placeholder:s("auth.passwordPlaceholder"),...j.register("confirmNewPassword")}),e.jsx("button",{type:"button",onClick:()=>Ae(!G),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:G?e.jsx(q,{className:"h-4 w-4"}):e.jsx(K,{className:"h-4 w-4"})})]}),j.formState.errors.confirmNewPassword&&e.jsx("p",{className:"text-sm text-destructive",children:j.formState.errors.confirmNewPassword.message})]}),e.jsx(h,{type:"submit",className:"w-full",disabled:c,children:s(c?"common.loading":"auth.resetPassword")})]})]}),e.jsx(je,{children:e.jsxs(h,{variant:"ghost",className:"w-full",onClick:he,children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),s("auth.backToLogin")]})})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-hero p-4",children:e.jsxs(xe,{className:"w-full max-w-md shadow-large",children:[e.jsxs(fe,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:R,alt:"Logo",style:{width:`${ee}px`,height:`${se}px`},className:"object-contain drop-shadow-md"})}),e.jsx(ge,{className:"text-2xl",children:s("auth.welcome")}),e.jsx(we,{children:s("auth.subtitle")})]}),e.jsx(pe,{children:e.jsxs(ss,{value:Ce,onValueChange:r=>{re(r),ke("phone"),A("info")},className:"w-full",children:[e.jsxs(ts,{className:"grid w-full grid-cols-2",children:[e.jsx(ye,{value:"login",children:s("auth.login")}),e.jsx(ye,{value:"register",children:s("auth.register")})]}),e.jsx(ve,{value:"login",children:e.jsxs("form",{onSubmit:k.handleSubmit(ze),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"email",children:s("auth.email")}),e.jsx(y,{id:"email",type:"email",placeholder:"you@example.com",...k.register("email")}),k.formState.errors.email&&e.jsx("p",{className:"text-sm text-destructive",children:k.formState.errors.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"password",children:s("auth.password")}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{id:"password",type:z?"text":"password",placeholder:"••••••••",...k.register("password")}),e.jsx("button",{type:"button",onClick:()=>Te(!z),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:z?e.jsx(q,{className:"h-4 w-4"}):e.jsx(K,{className:"h-4 w-4"})})]}),k.formState.errors.password&&e.jsx("p",{className:"text-sm text-destructive",children:k.formState.errors.password.message})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(rs,{id:"rememberMe",checked:ie,onCheckedChange:r=>{Le(r===!0),localStorage.setItem("rememberMe",String(r===!0))}}),e.jsx(d,{htmlFor:"rememberMe",className:"text-sm font-normal cursor-pointer",children:s("auth.rememberMe")})]}),e.jsx("button",{type:"button",className:"text-sm text-primary hover:underline",onClick:()=>ce(!0),children:s("auth.forgotPassword")})]}),M&&e.jsxs("div",{className:"p-3 bg-destructive/10 border border-destructive/20 rounded-md",children:[e.jsx("p",{className:"text-sm text-destructive font-medium",children:s("auth.accountLocked")}),e.jsx("p",{className:"text-xs text-destructive/80 mt-1",children:s("auth.tooManyAttempts",{minutes:Math.ceil(C/60)})})]}),!M&&H!==null&&H<=3&&H>0&&e.jsx("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-md",children:e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:s("auth.remainingAttempts",{count:H})})}),e.jsx(h,{type:"submit",className:"w-full",disabled:c||M,children:c?s("auth.signingIn"):M?`${s("auth.signIn")} (${Math.ceil(C/60)}m)`:s("auth.signIn")})]})}),e.jsx(ve,{value:"register",children:Fe==="info"?e.jsxs("form",{onSubmit:n.handleSubmit(We),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"display-name",children:s("auth.displayName")}),e.jsx(y,{id:"display-name",placeholder:"John Doe",...n.register("displayName")}),n.formState.errors.displayName&&e.jsx("p",{className:"text-sm text-destructive",children:n.formState.errors.displayName.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"register-email",children:s("auth.email")}),e.jsx(y,{id:"register-email",type:"email",placeholder:"you@example.com",...n.register("email")}),n.formState.errors.email&&e.jsx("p",{className:"text-sm text-destructive",children:n.formState.errors.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"register-password",children:s("auth.password")}),e.jsx(y,{id:"register-password",type:"password",placeholder:s("auth.passwordPlaceholder"),...n.register("password"),onChange:r=>{n.setValue("password",r.target.value),r.target.value?oe(me(r.target.value)):oe(null)}}),n.formState.errors.password&&e.jsx("p",{className:"text-sm text-destructive",children:n.formState.errors.password.message}),g&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${g==="weak"?"bg-destructive":g==="medium"?"bg-warning":"bg-success"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${g==="medium"||g==="strong"?g==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${g==="strong"?"bg-success":"bg-muted"}`})]}),e.jsx("p",{className:`text-xs ${g==="weak"?"text-destructive":g==="medium"?"text-warning":"text-success"}`,children:s(`auth.passwordStrength.${g}`)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"confirm-password",children:s("auth.confirmPassword")}),e.jsx(y,{id:"confirm-password",type:"password",placeholder:s("auth.passwordPlaceholder"),...n.register("confirmPassword")}),n.formState.errors.confirmPassword&&e.jsx("p",{className:"text-sm text-destructive",children:n.formState.errors.confirmPassword.message})]}),e.jsx(h,{type:"submit",className:"w-full",disabled:c,children:s(c?"auth.sendingCode":"auth.sendCode")})]}):e.jsxs("form",{onSubmit:F.handleSubmit(Ge),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"verification-code",children:"Verification Code"}),e.jsxs("p",{className:"text-xs text-muted-foreground mb-2",children:["Enter the 4-digit code sent to ",_]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Ne,{maxLength:4,...F.register("code"),onChange:r=>F.setValue("code",r),children:e.jsxs(be,{children:[e.jsx(P,{index:0}),e.jsx(P,{index:1}),e.jsx(P,{index:2}),e.jsx(P,{index:3})]})})}),F.formState.errors.code&&e.jsx("p",{className:"text-sm text-destructive text-center",children:F.formState.errors.code.message})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{type:"button",variant:"outline",className:"w-full",onClick:()=>{A("info"),F.reset()},children:s("common.back")}),e.jsx(h,{type:"submit",className:"w-full",disabled:c,children:c?s("auth.verifying"):"Verify & Register"})]}),e.jsx(h,{type:"button",variant:"ghost",className:"w-full text-sm",onClick:ue,disabled:c||f>0,children:f>0?`Resend Code (${f}s)`:"Resend Code"})]})})]})}),e.jsx(je,{children:e.jsx("p",{className:"text-sm text-muted-foreground text-center w-full",children:e.jsx(es,{to:"/",className:"text-primary hover:underline",children:s("auth.backToHome")})})})]})})};export{ps as default};
