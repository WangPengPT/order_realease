import{p as q,r as d,j as e,eh as de,bh as me,ay as he,d0 as ue,aw as xe,dD as I,bU as M,ak as J,w as F,bq as $,ab as ge,X as pe,bC as je,bW as fe,b4 as Ne,bx as ve}from"./vendor-react-DTNwRJdt.js";import{U as z,B as m,C as f,q as N,I as j,s as L,f as be,D as we,W as ye,c as Ce,d as _e,e as De,T as Be,S as Se,A as K,t as Y,v as Z,w as ee,x as se,y as ae,z as te,E as ne,p as ze,F as Le,$ as Te,a7 as Ae}from"./index-60xCuNp_.js";import{b as Pe,c as Ue,a as Ee,d as Ie}from"./useBrands-Efh_S9qQ.js";import{T as le,a as re,b as w,c as y}from"./tabs-zHeZaT3P.js";import{u as Fe}from"./useLocalizedContent-Z56eXyv6.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-utils-vwQGbBim.js";import"./vendor-supabase-CY_qUJoS.js";const ke=()=>Math.random().toString(36).substring(2,9),k={toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}],["link"],["clean"]]},Me=({blocks:a,onChange:x})=>{const{t:s,i18n:C}=q(),[v,h]=d.useState(null),u=t=>{const i={id:ke(),type:t,...t==="text"?{content_zh:"",content_en:"",content_pt:""}:{url:"",alt:""}};x([...a,i])},g=t=>{x(a.filter(i=>i.id!==t))},n=(t,i)=>{const l=[...a],o=i==="up"?t-1:t+1;o<0||o>=a.length||([l[t],l[o]]=[l[o],l[t]],x(l))},p=(t,i)=>{x(a.map(l=>l.id===t?{...l,...i}:l))},B=async(t,i)=>{if(!i.type.startsWith("image/")){F.error(s("admin.brand.invalidImageType"));return}h(t);try{const l=i.name.split(".").pop(),o=`brand-content-${Date.now()}.${l}`,{error:b}=await L.storage.from("restaurant-images").upload(o,i);if(b)throw b;const{data:{publicUrl:_}}=L.storage.from("restaurant-images").getPublicUrl(o);p(t,{url:_}),F.success(s("admin.brand.imageUploaded"))}catch(l){console.error("Upload error:",l),F.error(l.message||s("admin.brand.uploadError"))}finally{h(null)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(z,{children:s("admin.brand.contentBlocks")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{type:"button",variant:"outline",size:"sm",onClick:()=>u("text"),children:[e.jsx(de,{className:"h-4 w-4 mr-1"}),s("admin.brand.addText")]}),e.jsxs(m,{type:"button",variant:"outline",size:"sm",onClick:()=>u("image"),children:[e.jsx(me,{className:"h-4 w-4 mr-1"}),s("admin.brand.addImage")]})]})]}),a.length===0&&e.jsx(f,{className:"border-dashed",children:e.jsxs(N,{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{children:s("admin.brand.noBlocks")}),e.jsx("p",{className:"text-sm mt-1",children:s("admin.brand.addBlockHint")})]})}),e.jsx("div",{className:"space-y-3",children:a.map((t,i)=>e.jsx(f,{className:"relative",children:e.jsx(N,{className:"pt-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-1 pt-2",children:[e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"h-6 w-6",disabled:i===0,onClick:()=>n(i,"up"),children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex items-center justify-center h-6 w-6 text-muted-foreground",children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"h-6 w-6",disabled:i===a.length-1,onClick:()=>n(i,"down"),children:e.jsx(xe,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex-1 min-w-0",children:t.type==="text"?e.jsxs(le,{defaultValue:"zh",className:"w-full",children:[e.jsxs(re,{className:"mb-2",children:[e.jsx(w,{value:"zh",children:s("admin.chinese")}),e.jsx(w,{value:"en",children:s("admin.english")}),e.jsx(w,{value:"pt",children:s("admin.portuguese")})]}),e.jsx(y,{value:"zh",children:e.jsx(I,{theme:"snow",value:t.content_zh||"",onChange:l=>p(t.id,{content_zh:l}),modules:k,placeholder:s("admin.brand.textPlaceholder")})}),e.jsx(y,{value:"en",children:e.jsx(I,{theme:"snow",value:t.content_en||"",onChange:l=>p(t.id,{content_en:l}),modules:k,placeholder:s("admin.brand.textPlaceholder")})}),e.jsx(y,{value:"pt",children:e.jsx(I,{theme:"snow",value:t.content_pt||"",onChange:l=>p(t.id,{content_pt:l}),modules:k,placeholder:s("admin.brand.textPlaceholder")})})]}):e.jsxs("div",{className:"space-y-3",children:[t.url?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t.url,alt:t.alt||"",className:"w-full max-h-48 object-contain rounded-lg bg-muted"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center rounded-lg",children:e.jsxs("label",{className:"cursor-pointer",children:[e.jsx(j,{type:"file",accept:"image/*",className:"hidden",onChange:l=>{const o=l.target.files?.[0];o&&B(t.id,o)}}),e.jsx(m,{type:"button",variant:"secondary",size:"sm",children:s("common.replace")})]})})]}):e.jsxs("label",{className:"cursor-pointer",children:[e.jsx(j,{type:"file",accept:"image/*",className:"hidden",onChange:l=>{const o=l.target.files?.[0];o&&B(t.id,o)}}),e.jsx("div",{className:"border-2 border-dashed rounded-lg p-8 text-center hover:border-primary transition-colors",children:v===t.id?e.jsxs("div",{className:"animate-pulse text-muted-foreground",children:[s("common.uploading"),"..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-8 w-8 mx-auto text-muted-foreground mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("admin.brand.clickToUpload")})]})})]}),e.jsx(j,{placeholder:s("admin.brand.imageAlt"),value:t.alt||"",onChange:l=>p(t.id,{alt:l.target.value})})]})}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>g(t.id),children:e.jsx(J,{className:"h-4 w-4"})})]})})},t.id))})]})};function X({brand:a,trigger:x}){const{t:s}=q(),{toast:C}=be(),v=Pe(),h=Ue(),[u,g]=d.useState(!1),[n,p]=d.useState(!1),[B,t]=d.useState(!1),[i,l]=d.useState(""),[o,b]=d.useState(a?.name||""),[_,T]=d.useState(a?.name_en||""),[A,P]=d.useState(a?.name_pt||""),[H,U]=d.useState([]),[R,E]=d.useState(null),[W,S]=d.useState(a?.logo_url||null);d.useEffect(()=>{if(u&&a){b(a.name||""),T(a.name_en||""),P(a.name_pt||""),S(a.logo_url||null);const r=a.content_blocks||[];U(r)}else u&&!a&&(b(""),T(""),P(""),S(null),E(null),U([]))},[u,a]);const ie=r=>{const c=r.target.files?.[0];if(c){E(c);const D=new FileReader;D.onloadend=()=>{S(D.result)},D.readAsDataURL(c)}},oe=async(r,c)=>{const D=r.name.split(".").pop(),V=`${c}_${Math.random()}.${D}`,{error:G}=await L.storage.from("restaurant-images").upload(V,r);if(G)throw G;const{data:{publicUrl:ce}}=L.storage.from("restaurant-images").getPublicUrl(V);return ce},O=async r=>{if(r.preventDefault(),!o.trim()){C({title:s("common.error"),description:s("admin.brand.nameRequired"),variant:"destructive"});return}const c=[];if(o.trim()||c.push(s("admin.chinese")),_.trim()||c.push(s("admin.english")),A.trim()||c.push(s("admin.portuguese")),c.length>0){l(s("admin.brand.missingTranslations","以下语言的品牌名称尚未填写：{{langs}}，是否继续保存？").replace("{{langs}}",c.join("、"))),t(!0);return}Q()},Q=async()=>{p(!0);try{let r=a?.logo_url||null;R&&(r=await oe(R,"brand_logo"));const c={name:o,name_en:_||null,name_pt:A||null,logo_url:r,content_blocks:H};a?await h.mutateAsync({id:a.id,...c}):await v.mutateAsync(c),g(!1)}catch(r){C({title:s("common.error"),description:r.message,variant:"destructive"})}finally{p(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(we,{open:u,onOpenChange:g,children:[e.jsx(ye,{asChild:!0,children:x}),e.jsxs(Ce,{className:"max-w-[95vw] sm:max-w-4xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[e.jsxs(_e,{className:"px-6 pt-6 pb-4 border-b bg-muted/30",children:[e.jsxs(De,{className:"text-2xl flex items-center gap-2",children:[e.jsx($,{className:"w-6 h-6 text-primary"}),s(a?"admin.brand.edit":"admin.brand.create")]}),e.jsx(Be,{className:"text-base",children:s(a?"admin.brand.editDesc":"admin.brand.createDesc")})]}),e.jsx(Se,{className:"px-6 h-[calc(95vh-220px)]",children:e.jsxs("form",{onSubmit:O,className:"space-y-6 py-6",children:[e.jsx(f,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:e.jsxs(N,{className:"p-6",children:[e.jsxs(z,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(ge,{className:"w-5 h-5 text-primary"}),s("admin.brand.name")]}),e.jsxs(le,{defaultValue:"zh",className:"w-full",children:[e.jsxs(re,{className:"grid w-full grid-cols-3",children:[e.jsx(w,{value:"zh",children:s("admin.chinese")}),e.jsx(w,{value:"en",children:s("admin.english")}),e.jsx(w,{value:"pt",children:s("admin.portuguese")})]}),e.jsx(y,{value:"zh",className:"mt-4",children:e.jsx(j,{value:o,onChange:r=>b(r.target.value),placeholder:s("admin.brand.namePlaceholder")})}),e.jsx(y,{value:"en",className:"mt-4",children:e.jsx(j,{value:_,onChange:r=>T(r.target.value),placeholder:s("admin.brand.namePlaceholderEn")})}),e.jsx(y,{value:"pt",className:"mt-4",children:e.jsx(j,{value:A,onChange:r=>P(r.target.value),placeholder:s("admin.brand.namePlaceholderPt")})})]})]})}),e.jsx(f,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:e.jsxs(N,{className:"p-6",children:[e.jsxs(z,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(M,{className:"w-5 h-5 text-primary"}),s("admin.brand.logo")]}),e.jsxs("div",{className:"flex items-center gap-4",children:[W&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:W,alt:"Logo Preview",className:"w-24 h-24 object-contain rounded-lg shadow-lg ring-2 ring-primary/20 bg-muted"}),e.jsx(m,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{E(null),S(null)},children:e.jsx(pe,{className:"h-3 w-3"})})]}),e.jsxs(z,{htmlFor:"logo-upload",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2 px-6 py-4 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[e.jsx(M,{className:"h-6 w-6 text-primary"}),e.jsx("p",{className:"font-medium text-xs",children:s("admin.uploadImage")})]}),e.jsx(j,{id:"logo-upload",type:"file",accept:"image/*",className:"hidden",onChange:ie})]})]})]})}),e.jsx(f,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:e.jsx(N,{className:"p-6",children:e.jsx(Me,{blocks:H,onChange:U})})})]})}),e.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t bg-muted/30",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>g(!1),children:s("common.cancel")}),e.jsx(m,{onClick:O,disabled:n,children:s(n?"common.saving":a?"common.save":"common.create")})]})]})]}),e.jsx(K,{open:B,onOpenChange:t,children:e.jsxs(Y,{children:[e.jsxs(Z,{children:[e.jsx("div",{className:"mx-auto w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center mb-2",children:e.jsx(je,{className:"w-6 h-6 text-primary"})}),e.jsx(ee,{className:"text-center",children:s("admin.brand.translationWarning","翻译缺失提醒")}),e.jsx(se,{className:"text-center",children:i})]}),e.jsxs(ae,{className:"sm:justify-center gap-2",children:[e.jsx(te,{children:s("common.cancel")}),e.jsx(ne,{onClick:()=>{t(!1),Q()},children:s("common.confirmSave","确认保存")})]})]})})]})}const Xe=()=>{const{t:a}=q(),{data:x,isLoading:s}=Ee(),C=Ie(),{getLocalizedField:v}=Fe(),[h,u]=d.useState(""),g=x?.filter(n=>n.name.toLowerCase().includes(h.toLowerCase())||n.name_en?.toLowerCase().includes(h.toLowerCase())||n.name_pt?.toLowerCase().includes(h.toLowerCase()));return s?e.jsx("div",{className:"text-center",children:a("common.loading")}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:a("admin.brand.title")}),e.jsx("p",{className:"text-muted-foreground",children:a("admin.brand.subtitle")})]}),e.jsx(X,{trigger:e.jsxs(m,{children:[e.jsx(fe,{className:"mr-2 h-4 w-4"}),a("admin.brand.create")]})})]}),e.jsx(f,{children:e.jsx(N,{className:"pt-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(j,{placeholder:a("admin.brand.search"),value:h,onChange:n=>u(n.target.value),className:"pl-9"})]})})}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:g?.map(n=>e.jsxs(f,{className:"overflow-hidden",children:[n.image_url&&e.jsx("div",{className:"aspect-video overflow-hidden",children:e.jsx("img",{src:n.image_url,alt:n.name,className:"w-full h-full object-cover"})}),e.jsx(ze,{className:"pb-2",children:e.jsx("div",{className:"flex items-start justify-between gap-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[n.logo_url?e.jsx("img",{src:n.logo_url,alt:`${n.name} logo`,className:"w-10 h-10 object-contain rounded-lg bg-muted p-1"}):e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx($,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx(Le,{className:"text-lg",children:v(n,"name")}),e.jsx(Te,{className:"text-xs",children:n.name!==n.name_en&&n.name_en&&e.jsx("span",{className:"mr-2",children:n.name_en})})]})]})})}),e.jsxs(N,{className:"pt-0",children:[(n.intro_zh||n.intro_en||n.intro_pt)&&e.jsx("div",{className:`text-sm text-muted-foreground line-clamp-2 mb-4 prose prose-sm max-w-none\r
                    [&_p]:m-0 [&_*]:text-muted-foreground`,dangerouslySetInnerHTML:{__html:v(n,"intro")||""}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(X,{brand:n,trigger:e.jsxs(m,{variant:"outline",size:"sm",className:"flex-1",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),a("common.edit")]})}),e.jsxs(K,{children:[e.jsx(Ae,{asChild:!0,children:e.jsx(m,{variant:"outline",size:"sm",children:e.jsx(J,{className:"h-4 w-4"})})}),e.jsxs(Y,{children:[e.jsxs(Z,{children:[e.jsx(ee,{children:a("admin.brand.deleteConfirm")}),e.jsx(se,{children:a("admin.brand.deleteWarning")})]}),e.jsxs(ae,{children:[e.jsx(te,{children:a("common.cancel")}),e.jsx(ne,{onClick:()=>C.mutate(n.id),children:a("common.delete")})]})]})]})]})]})]},n.id))}),g?.length===0&&e.jsx(f,{children:e.jsxs(N,{className:"py-12 text-center",children:[e.jsx($,{className:"mx-auto h-12 w-12 text-muted-foreground/50 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:a("admin.brand.empty")})]})})]})};export{Xe as default};
//# sourceMappingURL=AdminBrands-BM9hO_BF.js.map
