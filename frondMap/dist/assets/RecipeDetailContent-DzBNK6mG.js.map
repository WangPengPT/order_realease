{"version":3,"file":"RecipeDetailContent-DzBNK6mG.js","sources":["../../src/components/community/PostCard.tsx","../../src/components/community/recipe/RecipeAds.tsx","../../src/components/community/recipe/RecipeOverview.tsx","../../src/components/community/recipe/RecipeDetailContent.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { formatDistanceToNow } from \"date-fns\";\r\nimport { zhCN, enUS, pt } from \"date-fns/locale\";\r\nimport { Heart, MessageCircle, Share2, MoreHorizontal, Calendar, X, ChevronLeft, ChevronRight, MapPin, FileImage, ChevronDown, ChevronUp, Pencil, Clock, Sparkles } from \"lucide-react\";\r\nimport {\r\n  Carousel,\r\n  CarouselContent,\r\n  CarouselItem,\r\n  type CarouselApi,\r\n} from \"@/components/ui/carousel\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardFooter, CardHeader } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuTrigger,\r\n} from \"@/components/ui/dropdown-menu\";\r\nimport { CommunityPost, useLikePost, useSharePost, useDeletePost } from \"@/hooks/useCommunityPosts\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { toast } from \"sonner\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport TranslateButton from \"@/components/TranslateButton\";\r\nimport { useSmartShare, ShareDrawer } from \"@/components/ShareDrawer\";\r\nimport EditPostDialog from \"@/components/community/EditPostDialog\";\r\nimport EditRecipeDialog from \"@/components/community/EditRecipeDialog\";\r\nimport { useLoginRequired } from \"@/hooks/useLoginRequired\";\r\n\r\ninterface PostCardProps {\r\n  post: CommunityPost;\r\n  showActions?: boolean;\r\n  isDetailPage?: boolean;\r\n}\r\n\r\nconst PostCard = ({ post, showActions = true, isDetailPage = false }: PostCardProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const { user } = useAuth();\r\n  const navigate = useNavigate();\r\n  const { requireLogin } = useLoginRequired();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const likePost = useLikePost();\r\n  const sharePost = useSharePost();\r\n  const deletePost = useDeletePost();\r\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\r\n  const [showEditDialog, setShowEditDialog] = useState(false);\r\n  const [imageError, setImageError] = useState<Record<string, boolean>>({});\r\n  const [previewOpen, setPreviewOpen] = useState(false);\r\n  const [previewIndex, setPreviewIndex] = useState(0);\r\n  const [carouselApi, setCarouselApi] = useState<CarouselApi>();\r\n  const [previewCarouselApi, setPreviewCarouselApi] = useState<CarouselApi>();\r\n  const [currentSlide, setCurrentSlide] = useState(0);\r\n  const [translatedContent, setTranslatedContent] = useState<string | null>(null);\r\n  const [touchStartX, setTouchStartX] = useState<number | null>(null);\r\n  const [isSwiping, setIsSwiping] = useState(false);\r\n  const [swipeOffset, setSwipeOffset] = useState(0);\r\n  const [isAnimating, setIsAnimating] = useState(false);\r\n  const [imageDimensions, setImageDimensions] = useState<Record<string, { width: number; height: number }>>({});\r\n  const [longImageScrollStart, setLongImageScrollStart] = useState<{ y: number; scrollTop: number } | null>(null);\r\n  const [showAllRestaurants, setShowAllRestaurants] = useState(false);\r\n  const { share: smartShareFn, DrawerComponent: SmartShareDrawer } = useSmartShare();\r\n\r\n  // Lock body scroll when preview is open\r\n  useEffect(() => {\r\n    if (previewOpen) {\r\n      const scrollY = window.scrollY;\r\n      document.body.style.position = 'fixed';\r\n      document.body.style.top = `-${scrollY}px`;\r\n      document.body.style.left = '0';\r\n      document.body.style.right = '0';\r\n      document.body.style.overflow = 'hidden';\r\n      \r\n      return () => {\r\n        document.body.style.position = '';\r\n        document.body.style.top = '';\r\n        document.body.style.left = '';\r\n        document.body.style.right = '';\r\n        document.body.style.overflow = '';\r\n        window.scrollTo(0, scrollY);\r\n      };\r\n    }\r\n  }, [previewOpen]);\r\n\r\n  // Listen to carousel slide changes\r\n  useEffect(() => {\r\n    if (!carouselApi) return;\r\n    \r\n    setCurrentSlide(carouselApi.selectedScrollSnap());\r\n    \r\n    carouselApi.on(\"select\", () => {\r\n      setCurrentSlide(carouselApi.selectedScrollSnap());\r\n    });\r\n  }, [carouselApi]);\r\n\r\n  const getDateLocale = () => {\r\n    switch (i18n.language) {\r\n      case \"zh\":\r\n        return zhCN;\r\n      case \"pt\":\r\n        return pt;\r\n      default:\r\n        return enUS;\r\n    }\r\n  };\r\n\r\n  const handleLike = () => {\r\n    if (!requireLogin()) return;\r\n    likePost.mutate({ postId: post.id, liked: post.user_liked || false });\r\n  };\r\n\r\n  const handleShare = async () => {\r\n    const shareUrl = `${window.location.origin}/community/${post.id}`;\r\n    \r\n    smartShareFn({\r\n      title: t(\"community.shareTitle\", \"分享帖子\"),\r\n      text: post.content.replace(/<[^>]*>/g, '').substring(0, 100),\r\n      url: shareUrl,\r\n    }, () => {\r\n      if (user) {\r\n        sharePost.mutate(post.id);\r\n      }\r\n      toast.success(t(\"community.shareSuccess\", \"分享成功\"));\r\n    });\r\n  };\r\n\r\n  const handleDelete = () => {\r\n    deletePost.mutate(post.id);\r\n    setShowDeleteDialog(false);\r\n  };\r\n\r\n  const handleImageClick = (index: number) => {\r\n    if (isDetailPage) {\r\n      // On detail page, open preview\r\n      setPreviewIndex(index);\r\n      setPreviewOpen(true);\r\n    } else {\r\n      // On feed, navigate to post detail\r\n      navigate(`/community/${post.id}`);\r\n    }\r\n  };\r\n\r\n  const handlePrevImage = () => {\r\n    if (isAnimating) return;\r\n    setIsAnimating(true);\r\n    setSwipeOffset(window.innerWidth);\r\n    setTimeout(() => {\r\n      setPreviewIndex((prev) => \r\n        prev === 0 ? (post.image_urls?.length || 1) - 1 : prev - 1\r\n      );\r\n      setSwipeOffset(0);\r\n      setIsAnimating(false);\r\n    }, 250);\r\n  };\r\n\r\n  const handleNextImage = () => {\r\n    if (isAnimating) return;\r\n    setIsAnimating(true);\r\n    setSwipeOffset(-window.innerWidth);\r\n    setTimeout(() => {\r\n      setPreviewIndex((prev) => \r\n        prev === (post.image_urls?.length || 1) - 1 ? 0 : prev + 1\r\n      );\r\n      setSwipeOffset(0);\r\n      setIsAnimating(false);\r\n    }, 250);\r\n  };\r\n\r\n  const handleImageLoad = (e: React.SyntheticEvent<HTMLImageElement>, url: string) => {\r\n    const img = e.currentTarget;\r\n    setImageDimensions(prev => ({\r\n      ...prev,\r\n      [url]: { width: img.naturalWidth, height: img.naturalHeight }\r\n    }));\r\n  };\r\n\r\n  const isLongImage = (url: string) => {\r\n    const dims = imageDimensions[url];\r\n    return dims ? dims.height / dims.width > 1.5 : false;\r\n  };\r\n\r\n  const isAuthor = user?.id === post.author_id;\r\n  const activityTitle = post.activity\r\n    ? getLocalizedField(post.activity, \"title\")\r\n    : null;\r\n  \r\n  // Get all restaurants (from new junction table + legacy single restaurant)\r\n  const allRestaurants = [\r\n    ...(post.restaurants || []),\r\n    ...(post.restaurant && !post.restaurants?.find(r => r.id === post.restaurant?.id) ? [post.restaurant] : []),\r\n  ];\r\n  \r\n  // Max visible restaurants before collapsing\r\n  const maxVisibleRestaurants = isDetailPage ? 3 : 2;\r\n  const visibleRestaurants = showAllRestaurants \r\n    ? allRestaurants \r\n    : allRestaurants.slice(0, maxVisibleRestaurants);\r\n  const hasMoreRestaurants = allRestaurants.length > maxVisibleRestaurants;\r\n\r\n  // Get localized content - prioritize pre-stored translations\r\n  const localizedContent = getLocalizedField(post, \"content\");\r\n  \r\n  // Check if we have a pre-stored translation for current language\r\n  const hasLocalizedTranslation = \r\n    (i18n.language === \"zh\" && post.content_zh) ||\r\n    (i18n.language === \"en\" && post.content_en) ||\r\n    (i18n.language === \"pt\" && post.content_pt);\r\n  \r\n  // Use localized content, or translated content, or original\r\n  // Convert newlines to <br> for proper display\r\n  const rawContent = translatedContent || localizedContent || post.content;\r\n  const displayContent = rawContent?.replace(/\\[\\[NOTE\\]\\]/g, '').replace(/\\[\\[INTRO\\]\\]/g, '').replace(/\\n/g, '<br>') || '';\r\n\r\n  return (\r\n    <>\r\n      <Card className=\"overflow-hidden\">\r\n        <CardHeader className=\"pb-3\">\r\n          <div className=\"flex items-start justify-between\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <Avatar\r\n                className=\"h-10 w-10 cursor-pointer hover:ring-2 hover:ring-primary/50 transition-all\"\r\n                onClick={() => post.author?.id && navigate(`/user/${post.author.id}`)}\r\n              >\r\n                <AvatarImage src={post.author?.avatar_url || undefined} />\r\n                <AvatarFallback>\r\n                  {post.author?.display_name?.charAt(0) || \"?\"}\r\n                </AvatarFallback>\r\n              </Avatar>\r\n              <div>\r\n                <p\r\n                  className=\"font-medium text-sm cursor-pointer hover:underline\"\r\n                  onClick={() => post.author?.id && navigate(`/user/${post.author.id}`)}\r\n                >\r\n                  {post.author?.display_name}\r\n                </p>\r\n                <p className=\"text-xs text-muted-foreground\">\r\n                  {formatDistanceToNow(new Date(post.created_at), {\r\n                    addSuffix: true,\r\n                    locale: getDateLocale(),\r\n                  })}\r\n                </p>\r\n                {/* Pending status badge for author */}\r\n                {isAuthor && post.status === \"pending\" && (\r\n                  <Badge variant=\"outline\" className=\"text-amber-600 border-amber-500 bg-amber-50 dark:bg-amber-950/30 text-xs mt-0.5\">\r\n                    <Clock className=\"w-3 h-3 mr-1\" />\r\n                    {t(\"community.pendingReview\", \"审核中\")}\r\n                  </Badge>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {showActions && isAuthor && (\r\n              <DropdownMenu>\r\n                <DropdownMenuTrigger asChild>\r\n                  <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\r\n                    <MoreHorizontal className=\"h-4 w-4\" />\r\n                  </Button>\r\n                </DropdownMenuTrigger>\r\n                <DropdownMenuContent align=\"end\">\r\n                  <DropdownMenuItem\r\n                    onClick={() => setShowEditDialog(true)}\r\n                  >\r\n                    <Pencil className=\"h-4 w-4 mr-2\" />\r\n                    {t(\"common.edit\", \"编辑\")}\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuItem\r\n                    onClick={() => setShowDeleteDialog(true)}\r\n                    className=\"text-destructive\"\r\n                  >\r\n                    {t(\"common.delete\", \"删除\")}\r\n                  </DropdownMenuItem>\r\n                </DropdownMenuContent>\r\n              </DropdownMenu>\r\n            )}\r\n          </div>\r\n        </CardHeader>\r\n\r\n        <CardContent className=\"pt-0 pb-3\">\r\n          {/* Activity & Restaurant Badges */}\r\n          {/* Activity, AI Recipe & Restaurant Badges */}\r\n          {(post.activity || allRestaurants.length > 0 || (post as any).ai_recipe_source) && (\r\n            <div className=\"flex flex-wrap gap-2 mb-3 items-center\">\r\n              {(post as any).ai_recipe_source && (\r\n                <Badge variant=\"secondary\" className=\"gap-1 bg-primary/10 text-primary\">\r\n                  <Sparkles className=\"h-3 w-3\" />\r\n                  {t(\"aiRecipe.badge\", \"AI 食谱\")}\r\n                </Badge>\r\n              )}\r\n              {post.activity && (\r\n                <Link to={`/activity/${post.activity.id}`}>\r\n                  <Badge variant=\"secondary\" className=\"gap-1\">\r\n                    <Calendar className=\"h-3 w-3\" />\r\n                    {activityTitle}\r\n                  </Badge>\r\n                </Link>\r\n              )}\r\n              {visibleRestaurants.map((restaurant) => (\r\n                <Link key={restaurant.id} to={`/restaurant/${restaurant.id}`}>\r\n                  <Badge variant=\"secondary\" className=\"gap-1\">\r\n                    <MapPin className=\"h-3 w-3\" />\r\n                    {getLocalizedField(restaurant, \"name\")}\r\n                  </Badge>\r\n                </Link>\r\n              ))}\r\n              {hasMoreRestaurants && !showAllRestaurants && (\r\n                <button\r\n                  onClick={() => setShowAllRestaurants(true)}\r\n                  className=\"text-xs text-muted-foreground hover:text-foreground flex items-center gap-0.5\"\r\n                >\r\n                  +{allRestaurants.length - maxVisibleRestaurants} {t(\"community.more\", \"更多\")}\r\n                  <ChevronDown className=\"h-3 w-3\" />\r\n                </button>\r\n              )}\r\n              {showAllRestaurants && hasMoreRestaurants && (\r\n                <button\r\n                  onClick={() => setShowAllRestaurants(false)}\r\n                  className=\"text-xs text-muted-foreground hover:text-foreground flex items-center gap-0.5\"\r\n                >\r\n                  {t(\"community.collapse\", \"收起\")}\r\n                  <ChevronUp className=\"h-3 w-3\" />\r\n                </button>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Content */}\r\n          <Link to={`/community/${post.id}`}>\r\n            <div\r\n              className={`prose prose-sm max-w-none dark:prose-invert ${!isDetailPage ? 'line-clamp-6' : ''}`}\r\n              dangerouslySetInnerHTML={{ __html: displayContent }}\r\n            />\r\n          </Link>\r\n\r\n          {/* Translate Button - only show if no pre-stored translation */}\r\n          {!hasLocalizedTranslation && (\r\n            <TranslateButton \r\n              text={post.content} \r\n              onTranslation={setTranslatedContent}\r\n              className=\"mt-1\"\r\n            />\r\n          )}\r\n\r\n          {/* Images - Carousel only for multiple images */}\r\n          {/* In detail page with video, filter out auto-generated cover images */}\r\n          {(() => {\r\n            const displayImageUrls = isDetailPage && post.video_url\r\n              ? (post.image_urls || []).filter(url => !url.includes('-cover'))\r\n              : post.image_urls;\r\n            \r\n            if (!displayImageUrls || displayImageUrls.length === 0) return null;\r\n            \r\n            return (\r\n              <div className=\"relative mt-3\">\r\n                {displayImageUrls.length === 1 ? (\r\n                  // Single image - always limit max height\r\n                  (() => {\r\n                    const url = displayImageUrls[0];\r\n                    const isLong = isLongImage(url);\r\n                    return (\r\n                      <div \r\n                        className=\"relative overflow-hidden rounded-lg cursor-pointer max-h-[300px] sm:max-h-[400px]\"\r\n                        onClick={() => handleImageClick(0)}\r\n                      >\r\n                        {!imageError[url] ? (\r\n                          <>\r\n                            <img\r\n                              src={url}\r\n                              alt=\"\"\r\n                              className=\"w-full max-h-[300px] sm:max-h-[400px] object-cover object-top\"\r\n                              onLoad={(e) => handleImageLoad(e, url)}\r\n                              onError={() =>\r\n                                setImageError((prev) => ({ ...prev, [url]: true }))\r\n                              }\r\n                            />\r\n                            {/* Long image indicator */}\r\n                            {isLong && (\r\n                              <div className=\"absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full flex items-center gap-1\">\r\n                                <FileImage className=\"h-3 w-3\" />\r\n                                <span>{t(\"community.longImage\", \"长图\")}</span>\r\n                              </div>\r\n                            )}\r\n                          </>\r\n                        ) : (\r\n                          <div className=\"w-full h-full min-h-[200px] bg-muted flex items-center justify-center\">\r\n                            <span className=\"text-xs text-muted-foreground\">\r\n                              {t(\"common.imageLoadError\", \"图片加载失败\")}\r\n                            </span>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    );\r\n                  })()\r\n                ) : (\r\n                  // Multiple images - use carousel with smart display\r\n                  <>\r\n                    <Carousel \r\n                      setApi={setCarouselApi} \r\n                      className=\"w-full\"\r\n                      opts={{ loop: true }}\r\n                    >\r\n                      <CarouselContent className=\"-ml-0\">\r\n                        {displayImageUrls.map((url, index) => {\r\n                          const isLong = isLongImage(url);\r\n                          return (\r\n                            <CarouselItem key={index} className=\"pl-0\">\r\n                              <div \r\n                                className=\"relative overflow-hidden rounded-lg cursor-pointer aspect-[4/3] bg-muted\"\r\n                                onClick={() => handleImageClick(index)}\r\n                              >\r\n                                {!imageError[url] ? (\r\n                                  <>\r\n                                    <img\r\n                                      src={url}\r\n                                      alt=\"\"\r\n                                      className=\"w-full h-full object-contain\"\r\n                                      onLoad={(e) => handleImageLoad(e, url)}\r\n                                      onError={() =>\r\n                                        setImageError((prev) => ({ ...prev, [url]: true }))\r\n                                      }\r\n                                    />\r\n                                    {/* Long image indicator */}\r\n                                    {isLong && (\r\n                                      <div className=\"absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full flex items-center gap-1\">\r\n                                        <FileImage className=\"h-3 w-3\" />\r\n                                        <span>{t(\"community.longImage\", \"长图\")}</span>\r\n                                      </div>\r\n                                    )}\r\n                                  </>\r\n                                ) : (\r\n                                  <div className=\"w-full h-full min-h-[200px] bg-muted flex items-center justify-center\">\r\n                                    <span className=\"text-xs text-muted-foreground\">\r\n                                      {t(\"common.imageLoadError\", \"图片加载失败\")}\r\n                                    </span>\r\n                                  </div>\r\n                                )}\r\n                              </div>\r\n                            </CarouselItem>\r\n                          );\r\n                        })}\r\n                      </CarouselContent>\r\n                    </Carousel>\r\n                    \r\n                    {/* Top-right slide counter */}\r\n                    <div className=\"absolute top-3 right-3 bg-black/60 text-white text-xs px-2 py-1 rounded-full z-10\">\r\n                      {currentSlide + 1}/{displayImageUrls.length}\r\n                    </div>\r\n                    \r\n                    {/* Bottom navigation dots */}\r\n                    <div className=\"flex justify-center gap-1.5 mt-2\">\r\n                      {displayImageUrls.map((_, index) => (\r\n                        <button\r\n                          key={index}\r\n                          className={`w-1.5 h-1.5 rounded-full transition-colors ${\r\n                            index === currentSlide \r\n                              ? \"bg-primary\" \r\n                              : \"bg-muted-foreground/30\"\r\n                          }`}\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            carouselApi?.scrollTo(index);\r\n                          }}\r\n                        />\r\n                      ))}\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </div>\r\n            );\r\n          })()}\r\n\r\n          {/* Video */}\r\n          {post.video_url && (\r\n            <div className=\"mt-3 rounded-lg overflow-hidden bg-gray-900\">\r\n              <video\r\n                src={post.video_url}\r\n                {...(post.image_urls?.length ? { poster: post.image_urls[0] } : {})}\r\n                controls\r\n                className=\"w-full max-h-96\"\r\n                preload=\"metadata\"\r\n                playsInline\r\n              />\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n\r\n        <CardFooter className=\"pt-0 border-t\">\r\n          <div className=\"flex items-center gap-4 pt-3 w-full\">\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              className={`gap-2 ${post.user_liked ? \"text-red-500\" : \"\"}`}\r\n              onClick={handleLike}\r\n              disabled={!user}\r\n            >\r\n              <Heart\r\n                className={`h-4 w-4 ${post.user_liked ? \"fill-current\" : \"\"}`}\r\n              />\r\n              <span>{post.likes_count}</span>\r\n            </Button>\r\n\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              className=\"gap-2\"\r\n              onClick={() => {\r\n                if (!requireLogin()) return;\r\n                navigate(`/community/${post.id}`);\r\n              }}\r\n            >\r\n              <MessageCircle className=\"h-4 w-4\" />\r\n              <span>{post.comments_count}</span>\r\n            </Button>\r\n\r\n            <Button variant=\"ghost\" size=\"sm\" className=\"gap-2\" onClick={handleShare}>\r\n              <Share2 className=\"h-4 w-4\" />\r\n              <span>{post.shares_count}</span>\r\n            </Button>\r\n          </div>\r\n        </CardFooter>\r\n      </Card>\r\n\r\n      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"common.confirmDelete\", \"确认删除\")}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"community.deleteWarning\", \"删除后无法恢复，确定要删除这篇帖子吗？\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>{t(\"common.cancel\", \"取消\")}</AlertDialogCancel>\r\n            <AlertDialogAction onClick={handleDelete}>\r\n              {t(\"common.delete\", \"删除\")}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Edit Dialog - type-aware */}\r\n      {(post as any).post_type === 'recipe' ? (\r\n        <EditRecipeDialog\r\n          post={post}\r\n          open={showEditDialog}\r\n          onOpenChange={setShowEditDialog}\r\n        />\r\n      ) : (\r\n        <EditPostDialog\r\n          post={post}\r\n          open={showEditDialog}\r\n          onOpenChange={setShowEditDialog}\r\n        />\r\n      )}\r\n\r\n      {/* Image Preview - Using Carousel for smooth swipe like feed */}\r\n      {previewOpen && createPortal(\r\n        <div \r\n          className=\"fixed inset-0 z-[100] bg-black overflow-hidden\"\r\n          onClick={(e) => {\r\n            // Only close if clicking on backdrop, not carousel\r\n            if (e.target === e.currentTarget) {\r\n              setPreviewOpen(false);\r\n            }\r\n          }}\r\n          onWheel={(e) => e.stopPropagation()}\r\n          onTouchMove={(e) => e.stopPropagation()}\r\n        >\r\n          {/* Image Counter */}\r\n          {post.image_urls && post.image_urls.length > 1 && (\r\n            <div className=\"absolute top-4 left-1/2 -translate-x-1/2 z-10 text-white text-sm bg-black/50 px-4 py-1.5 rounded-full\">\r\n              {previewIndex + 1} / {post.image_urls.length}\r\n            </div>\r\n          )}\r\n\r\n          {/* Close Button */}\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"icon\"\r\n            className=\"absolute top-4 right-4 z-10 text-white hover:bg-white/20\"\r\n            onClick={() => setPreviewOpen(false)}\r\n          >\r\n            <X className=\"h-6 w-6\" />\r\n          </Button>\r\n\r\n          {/* Full screen Carousel - centered with calc() constraints */}\r\n          <div className=\"absolute inset-0 flex items-center justify-center\">\r\n            <Carousel\r\n              className=\"w-full\"\r\n              opts={{ loop: true, startIndex: previewIndex }}\r\n              setApi={(api) => {\r\n                setPreviewCarouselApi(api);\r\n                if (api) {\r\n                  api.on(\"select\", () => {\r\n                    setPreviewIndex(api.selectedScrollSnap());\r\n                  });\r\n                }\r\n              }}\r\n            >\r\n              <CarouselContent className=\"-ml-0\">\r\n                {post.image_urls?.map((url, index) => {\r\n                  const dims = imageDimensions[url];\r\n                  const isLong = dims ? dims.height / dims.width > 1.5 : false;\r\n                  return (\r\n                    <CarouselItem key={index} className=\"pl-0 flex items-center justify-center\">\r\n                      {isLong ? (\r\n                        <div \r\n                          className=\"w-full h-screen overflow-x-hidden overflow-y-scroll overscroll-contain\"\r\n                          onMouseDown={(e) => {\r\n                            const target = e.currentTarget;\r\n                            setLongImageScrollStart({ y: e.clientY, scrollTop: target.scrollTop });\r\n                          }}\r\n                          onMouseUp={(e) => {\r\n                            if (longImageScrollStart) {\r\n                              const deltaY = Math.abs(e.clientY - longImageScrollStart.y);\r\n                              const deltaScroll = Math.abs(e.currentTarget.scrollTop - longImageScrollStart.scrollTop);\r\n                              if (deltaY < 10 && deltaScroll < 10) {\r\n                                setPreviewOpen(false);\r\n                              }\r\n                              setLongImageScrollStart(null);\r\n                            }\r\n                          }}\r\n                          onTouchStart={(e) => {\r\n                            const target = e.currentTarget;\r\n                            setLongImageScrollStart({ y: e.touches[0].clientY, scrollTop: target.scrollTop });\r\n                          }}\r\n                          onTouchEnd={(e) => {\r\n                            if (longImageScrollStart) {\r\n                              const touch = e.changedTouches[0];\r\n                              const deltaY = Math.abs(touch.clientY - longImageScrollStart.y);\r\n                              const deltaScroll = Math.abs(e.currentTarget.scrollTop - longImageScrollStart.scrollTop);\r\n                              // Use a slightly larger threshold for touch to account for touch inaccuracy\r\n                              if (deltaY < 15 && deltaScroll < 15) {\r\n                                e.preventDefault();\r\n                                setPreviewOpen(false);\r\n                              }\r\n                              setLongImageScrollStart(null);\r\n                            }\r\n                          }}\r\n                        >\r\n                        <img\r\n                              src={url}\r\n                              alt=\"\"\r\n                              className=\"block select-none\"\r\n                              style={{\r\n                                width: '100vw',\r\n                                minHeight: '100dvh',\r\n                                height: 'auto',\r\n                                margin: 0\r\n                              }}\r\n                              draggable={false}\r\n                              onLoad={(e) => handleImageLoad(e, url)}\r\n                            />\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"w-full h-full flex items-center justify-center\">\r\n                          <img\r\n                            src={url}\r\n                            alt=\"\"\r\n                            className=\"object-contain w-screen h-screen select-none cursor-pointer\"\r\n                            draggable={false}\r\n                            onClick={() => setPreviewOpen(false)}\r\n                            onLoad={(e) => handleImageLoad(e, url)}\r\n                          />\r\n                        </div>\r\n                      )}\r\n                    </CarouselItem>\r\n                  );\r\n                })}\r\n              </CarouselContent>\r\n            </Carousel>\r\n          </div>\r\n\r\n          {/* Desktop Navigation Buttons - connected to Carousel API */}\r\n          {post.image_urls && post.image_urls.length > 1 && (\r\n            <>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"absolute left-4 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 hidden sm:flex\"\r\n                onClick={() => previewCarouselApi?.scrollPrev()}\r\n              >\r\n                <ChevronLeft className=\"h-8 w-8\" />\r\n              </Button>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"absolute right-4 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 hidden sm:flex\"\r\n                onClick={() => previewCarouselApi?.scrollNext()}\r\n              >\r\n                <ChevronRight className=\"h-8 w-8\" />\r\n              </Button>\r\n            </>\r\n          )}\r\n        </div>,\r\n        document.body\r\n      )}\r\n      \r\n      {/* Smart Share Drawer for WebView environments */}\r\n      {SmartShareDrawer}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default PostCard;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useQuery } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { ExternalLink } from \"lucide-react\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport ExternalLinkConfirmDialog from \"@/components/ExternalLinkConfirmDialog\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\n\r\ninterface Ad {\r\n  id: string;\r\n  name: string;\r\n  image_url: string | null;\r\n  mobile_image_url: string | null;\r\n  desktop_image_url: string | null;\r\n  link_url: string | null;\r\n  is_active: boolean;\r\n  sort_order: number;\r\n  start_date: string | null;\r\n  end_date: string | null;\r\n}\r\n\r\nconst adsTable = () => (supabase as any).from(\"ads\");\r\n\r\nconst RecipeAds = () => {\r\n  const { t } = useTranslation();\r\n  const isMobile = useIsMobile();\r\n  const [pendingUrl, setPendingUrl] = useState<string | null>(null);\r\n  const [pendingAdName, setPendingAdName] = useState<string | null>(null);\r\n\r\n  const { data: ads } = useQuery({\r\n    queryKey: [\"active-ads\"],\r\n    queryFn: async () => {\r\n      const now = new Date().toISOString();\r\n      const { data, error } = await adsTable()\r\n        .select(\"*\")\r\n        .eq(\"is_active\", true)\r\n        .or(`start_date.is.null,start_date.lte.${now}`)\r\n        .or(`end_date.is.null,end_date.gte.${now}`)\r\n        .order(\"sort_order\", { ascending: true });\r\n      if (error) throw error;\r\n      return data as Ad[];\r\n    },\r\n    staleTime: 5 * 60 * 1000,\r\n  });\r\n\r\n  if (!ads || ads.length === 0) return null;\r\n\r\n  const handleAdClick = (ad: Ad) => {\r\n    if (ad.link_url) {\r\n      setPendingUrl(ad.link_url);\r\n      setPendingAdName(ad.name);\r\n    }\r\n  };\r\n\r\n  const handleConfirm = () => {\r\n    if (pendingUrl) {\r\n      window.open(pendingUrl, \"_blank\", \"noopener,noreferrer\");\r\n      setPendingUrl(null);\r\n      setPendingAdName(null);\r\n    }\r\n  };\r\n\r\n  const getImageUrl = (ad: Ad) => {\r\n    if (isMobile) {\r\n      return ad.mobile_image_url || ad.desktop_image_url || ad.image_url;\r\n    }\r\n    return ad.desktop_image_url || ad.mobile_image_url || ad.image_url;\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"space-y-2 mt-3\">\r\n        {ads.map((ad) => {\r\n          const imgUrl = getImageUrl(ad);\r\n          return (\r\n            <div\r\n              key={ad.id}\r\n              className=\"relative rounded-lg overflow-hidden border border-border/50 hover:border-primary/30 transition-colors cursor-pointer\"\r\n              style={{ aspectRatio: isMobile ? '375/112' : '672/112' }}\r\n              onClick={() => handleAdClick(ad)}\r\n            >\r\n              {/* Ad label */}\r\n              <Badge className=\"absolute top-1.5 left-1.5 z-10 bg-black/60 text-white text-[10px] px-1.5 py-0.5 rounded hover:bg-black/60\">\r\n                {t(\"common.ad\", \"广告\")}\r\n              </Badge>\r\n\r\n              {imgUrl ? (\r\n                <img\r\n                  src={imgUrl}\r\n                  alt={ad.name}\r\n                  className=\"w-full h-full object-cover\"\r\n                />\r\n              ) : (\r\n                <div className=\"flex items-center gap-2 px-3 bg-muted/50 text-sm text-muted-foreground w-full h-full justify-center\">\r\n                  <ExternalLink className=\"h-3.5 w-3.5 shrink-0\" />\r\n                  <span className=\"truncate\">{ad.name}</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      <ExternalLinkConfirmDialog\r\n        open={!!pendingUrl}\r\n        onOpenChange={(open) => { if (!open) { setPendingUrl(null); setPendingAdName(null); } }}\r\n        onConfirm={handleConfirm}\r\n        url={pendingUrl || undefined}\r\n        title={t(\"common.adLinkTitle\", \"外部链接\")}\r\n        description={t(\"common.adLinkDescription\", \"您即将离开本站，前往广告链接「{{name}}」的外部页面\", { name: pendingAdName || \"\" })}\r\n        confirmLabel={t(\"common.adLinkContinue\", \"继续前往\")}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default RecipeAds;\r\n","import { useState, useMemo } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { formatDistanceToNow } from \"date-fns\";\r\nimport { zhCN, enUS, pt } from \"date-fns/locale\";\r\nimport { Clock, Users, Utensils, Flame, ChefHat, PlayCircle, ChevronDown, ChevronUp, Quote } from \"lucide-react\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { CommunityPost } from \"@/hooks/useCommunityPosts\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { RecipeStep, Ingredient, NutritionInfo } from \"./RecipeTypes\";\r\nimport TranslateButton from \"@/components/TranslateButton\";\r\nimport TranslatableText from \"@/components/TranslatableText\";\r\nimport ImagePreviewModal from \"@/components/ImagePreviewModal\";\r\nimport RecipeAds from \"./RecipeAds\";\r\n\r\n// Parse structured content: [[NOTE]]心得\\n[[INTRO]]介绍\r\nconst parseRecipeContent = (raw: string) => {\r\n  const noteMatch = raw.match(/^\\[\\[NOTE\\]\\]([\\s\\S]*?)(?:\\n\\[\\[INTRO\\]\\]|$)/);\r\n  const introMatch = raw.match(/\\[\\[INTRO\\]\\]([\\s\\S]*)$/);\r\n  if (noteMatch) {\r\n    return {\r\n      note: noteMatch[1].trim(),\r\n      intro: introMatch ? introMatch[1].trim() : \"\",\r\n    };\r\n  }\r\n  return { note: \"\", intro: raw };\r\n};\r\n\r\ninterface ExtendedPost extends CommunityPost {\r\n  post_type?: string;\r\n  recipe_name?: string;\r\n  recipe_name_en?: string;\r\n  recipe_name_pt?: string;\r\n  cook_time?: number;\r\n  difficulty?: string;\r\n  servings?: number;\r\n  ingredients?: Ingredient[];\r\n  steps?: RecipeStep[];\r\n  nutrition?: NutritionInfo;\r\n  recipe_tags?: string[];\r\n  recipe_category?: string;\r\n}\r\n\r\ninterface RecipeOverviewProps {\r\n  post: ExtendedPost;\r\n  onStartCooking: () => void;\r\n}\r\n\r\nconst RecipeOverview = ({ post, onStartCooking }: RecipeOverviewProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const [translatedName, setTranslatedName] = useState<string | null>(null);\r\n  const [translatedContent, setTranslatedContent] = useState<string | null>(null);\r\n  const [translatedIngredients, setTranslatedIngredients] = useState<Record<number, string>>({});\r\n  const [previewImageUrl, setPreviewImageUrl] = useState<string | null>(null);\r\n  const [showFullContent, setShowFullContent] = useState(false);\r\n  const [showAllIngredients, setShowAllIngredients] = useState(false);\r\n\r\n  const CONTENT_MAX_LENGTH = 200;\r\n  const INGREDIENTS_PREVIEW_COUNT = 5;\r\n\r\n  // Get localized content - prioritize pre-stored translations\r\n  const getLocalizedContent = () => {\r\n    const langMap: Record<string, string> = {\r\n      'zh': 'content_zh',\r\n      'en': 'content_en', \r\n      'pt': 'content_pt'\r\n    };\r\n    const field = langMap[i18n.language] || 'content';\r\n    const localizedValue = post[field as keyof typeof post];\r\n    if (localizedValue && typeof localizedValue === 'string' && localizedValue.trim()) {\r\n      return localizedValue;\r\n    }\r\n    return post.content;\r\n  };\r\n\r\n  const displayContent = translatedContent || getLocalizedContent();\r\n  const parsedContent = useMemo(() => parseRecipeContent(displayContent || \"\"), [displayContent]);\r\n  const displayName = translatedName || getLocalizedField(post, \"recipe_name\") || post.recipe_name;\r\n\r\n  // Build combined text for translation: name + content + ingredients\r\n  const buildTranslationText = () => {\r\n    const parts: string[] = [];\r\n    // Recipe name\r\n    if (post.recipe_name) {\r\n      parts.push(`[NAME]${post.recipe_name}`);\r\n    }\r\n    // Content (if exists and not auto-generated)\r\n    if (post.content && post.content.trim() && !post.content.includes('主要配料：')) {\r\n      parts.push(`[CONTENT]${post.content}`);\r\n    }\r\n    // Ingredients\r\n    if (post.ingredients && post.ingredients.length > 0) {\r\n      const ingredientNames = post.ingredients.map(i => i.name).join('|');\r\n      parts.push(`[INGREDIENTS]${ingredientNames}`);\r\n    }\r\n    return parts.join('\\n---\\n');\r\n  };\r\n\r\n  // Parse translation result\r\n  const handleTranslation = (translated: string | null) => {\r\n    if (!translated) {\r\n      setTranslatedName(null);\r\n      setTranslatedContent(null);\r\n      setTranslatedIngredients({});\r\n      return;\r\n    }\r\n    \r\n    const sections = translated.split('\\n---\\n');\r\n    sections.forEach(section => {\r\n      if (section.startsWith('[NAME]')) {\r\n        setTranslatedName(section.replace('[NAME]', ''));\r\n      } else if (section.startsWith('[CONTENT]')) {\r\n        setTranslatedContent(section.replace('[CONTENT]', ''));\r\n      } else if (section.startsWith('[INGREDIENTS]')) {\r\n        const names = section.replace('[INGREDIENTS]', '').split('|');\r\n        const map: Record<number, string> = {};\r\n        names.forEach((name, idx) => { map[idx] = name.trim(); });\r\n        setTranslatedIngredients(map);\r\n      }\r\n    });\r\n  };\r\n\r\n  const getDateLocale = () => {\r\n    switch (i18n.language) {\r\n      case \"zh\": return zhCN;\r\n      case \"pt\": return pt;\r\n      default: return enUS;\r\n    }\r\n  };\r\n\r\n  const getDifficultyColor = (d: string) => {\r\n    switch (d) {\r\n      case 'easy': return 'bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30';\r\n      case 'medium': return 'bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30';\r\n      case 'hard': return 'bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30';\r\n      default: return 'bg-muted text-muted-foreground';\r\n    }\r\n  };\r\n\r\n  const getDifficultyLabel = (d: string) => {\r\n    switch (d) {\r\n      case 'easy': return t(\"recipe.difficulty.easy\", \"简单\");\r\n      case 'medium': return t(\"recipe.difficulty.medium\", \"中等\");\r\n      case 'hard': return t(\"recipe.difficulty.hard\", \"困难\");\r\n      default: return d;\r\n    }\r\n  };\r\n\r\n  const hasImages = post.image_urls && post.image_urls.length > 0;\r\n  const hasSteps = post.steps && post.steps.length > 0;\r\n\r\n  return (\r\n    <Card className=\"overflow-hidden\">\r\n      {/* Hero Image */}\r\n      {hasImages && (\r\n        <div className=\"relative aspect-video overflow-hidden\">\r\n          <img\r\n            src={post.image_urls![0]}\r\n            alt={displayName || \"\"}\r\n            className=\"w-full h-full object-cover cursor-pointer\"\r\n            onClick={() => setPreviewImageUrl(post.image_urls![0])}\r\n          />\r\n          <Badge className=\"absolute top-3 left-3 bg-primary text-primary-foreground gap-1\">\r\n            <Utensils className=\"h-3 w-3\" />\r\n            {t(\"recipe.badge\", \"食谱\")}\r\n          </Badge>\r\n        </div>\r\n      )}\r\n\r\n      <CardHeader className=\"pb-3\">\r\n        {/* Author */}\r\n        <div className=\"flex items-center gap-3 mb-4\">\r\n          <Avatar className=\"h-10 w-10\">\r\n            <AvatarImage src={post.author?.avatar_url || undefined} />\r\n            <AvatarFallback>\r\n              {post.author?.display_name?.charAt(0) || \"?\"}\r\n            </AvatarFallback>\r\n          </Avatar>\r\n          <div>\r\n            <p className=\"font-medium text-sm\">{post.author?.display_name}</p>\r\n            <p className=\"text-xs text-muted-foreground\">\r\n              {formatDistanceToNow(new Date(post.created_at), {\r\n                addSuffix: true,\r\n                locale: getDateLocale(),\r\n              })}\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Translate All Button - above recipe name */}\r\n        <div className=\"mb-2\">\r\n          <TranslateButton \r\n            text={buildTranslationText()} \r\n            onTranslation={handleTranslation}\r\n            label={t(\"recipe.translateAll\")}\r\n          />\r\n        </div>\r\n\r\n        {/* Recipe Name */}\r\n        <h2 className=\"text-xl font-bold\">{displayName}</h2>\r\n\r\n        {/* Meta Info */}\r\n        <div className=\"flex flex-wrap items-center gap-3 mt-3\">\r\n          {post.cook_time && (\r\n            <div className=\"flex items-center gap-1.5 text-sm text-muted-foreground\">\r\n              <Clock className=\"h-4 w-4\" />\r\n              <span>{post.cook_time} {t(\"recipe.minutes\", \"分钟\")}</span>\r\n            </div>\r\n          )}\r\n          {post.servings && (\r\n            <div className=\"flex items-center gap-1.5 text-sm text-muted-foreground\">\r\n              <Users className=\"h-4 w-4\" />\r\n              <span>{post.servings} {t(\"recipe.servings\", \"人份\")}</span>\r\n            </div>\r\n          )}\r\n          {post.difficulty && (\r\n            <Badge variant=\"outline\" className={getDifficultyColor(post.difficulty)}>\r\n              <ChefHat className=\"h-3 w-3 mr-1\" />\r\n              {getDifficultyLabel(post.difficulty)}\r\n            </Badge>\r\n          )}\r\n        </div>\r\n      </CardHeader>\r\n\r\n      <CardContent className=\"space-y-6\">\r\n        {/* Cooking Note + Description */}\r\n        {post.content && post.content.trim() && !post.content.includes('主要配料：') && (\r\n          <div className=\"space-y-3\">\r\n            {/* Cooking note - styled card */}\r\n            {parsedContent.note && (\r\n              <div className=\"rounded-lg border border-primary/20 bg-primary/5 px-4 py-3\">\r\n                <div className=\"flex items-center gap-1.5 mb-1.5\">\r\n                  <Quote className=\"h-3.5 w-3.5 text-primary\" />\r\n                  <span className=\"text-xs font-medium text-primary\">{t(\"recipe.cookingNote\", \"心得\")}</span>\r\n                </div>\r\n                <p className=\"text-sm text-foreground/80 italic leading-relaxed whitespace-pre-line\">\r\n                  {parsedContent.note}\r\n                </p>\r\n              </div>\r\n            )}\r\n            {/* Original AI introduction */}\r\n            {parsedContent.intro && (\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground whitespace-pre-line leading-relaxed\">\r\n                  {showFullContent || parsedContent.intro.length <= CONTENT_MAX_LENGTH\r\n                    ? parsedContent.intro\r\n                    : parsedContent.intro.slice(0, CONTENT_MAX_LENGTH) + '...'}\r\n                </p>\r\n                {parsedContent.intro.length > CONTENT_MAX_LENGTH && (\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className=\"px-0 h-auto py-1 text-xs text-primary\"\r\n                    onClick={() => setShowFullContent(!showFullContent)}\r\n                  >\r\n                    {showFullContent ? t(\"common.collapse\", \"收起\") : t(\"common.viewAll\", \"查看全部\")}\r\n                    {showFullContent ? <ChevronUp className=\"h-3 w-3 ml-1\" /> : <ChevronDown className=\"h-3 w-3 ml-1\" />}\r\n                  </Button>\r\n                )}\r\n              </div>\r\n            )}\r\n            {/* Legacy content without structured tags */}\r\n            {!parsedContent.note && !parsedContent.intro && (\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground whitespace-pre-line\">\r\n                  {showFullContent || (displayContent || '').length <= CONTENT_MAX_LENGTH\r\n                    ? displayContent\r\n                    : (displayContent || '').slice(0, CONTENT_MAX_LENGTH) + '...'}\r\n                </p>\r\n                {(displayContent || '').length > CONTENT_MAX_LENGTH && (\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className=\"px-0 h-auto py-1 text-xs text-primary\"\r\n                    onClick={() => setShowFullContent(!showFullContent)}\r\n                  >\r\n                    {showFullContent ? t(\"common.collapse\", \"收起\") : t(\"common.viewAll\", \"查看全部\")}\r\n                    {showFullContent ? <ChevronUp className=\"h-3 w-3 ml-1\" /> : <ChevronDown className=\"h-3 w-3 ml-1\" />}\r\n                  </Button>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Nutrition Info */}\r\n        {post.nutrition && (post.nutrition.calories || post.nutrition.protein || post.nutrition.carbs || post.nutrition.fat) && (\r\n          <div>\r\n            <h3 className=\"font-semibold text-sm mb-3 flex items-center gap-2\">\r\n              <Flame className=\"h-4 w-4 text-orange-500\" />\r\n              {t(\"recipe.nutrition\", \"营养信息\")}\r\n            </h3>\r\n            <div className=\"grid grid-cols-4 gap-2\">\r\n              {post.nutrition.calories && (\r\n                <div className=\"text-center p-2 bg-muted/50 rounded-lg\">\r\n                  <p className=\"text-lg font-bold text-primary\">{post.nutrition.calories}</p>\r\n                  <p className=\"text-xs text-muted-foreground\">{t(\"recipe.kcal\", \"千卡\")}</p>\r\n                </div>\r\n              )}\r\n              {post.nutrition.protein && (\r\n                <div className=\"text-center p-2 bg-muted/50 rounded-lg\">\r\n                  <p className=\"text-lg font-bold text-primary\">{post.nutrition.protein}g</p>\r\n                  <p className=\"text-xs text-muted-foreground\">{t(\"recipe.protein\", \"蛋白质\")}</p>\r\n                </div>\r\n              )}\r\n              {post.nutrition.carbs && (\r\n                <div className=\"text-center p-2 bg-muted/50 rounded-lg\">\r\n                  <p className=\"text-lg font-bold text-primary\">{post.nutrition.carbs}g</p>\r\n                  <p className=\"text-xs text-muted-foreground\">{t(\"recipe.carbs\", \"碳水\")}</p>\r\n                </div>\r\n              )}\r\n              {post.nutrition.fat && (\r\n                <div className=\"text-center p-2 bg-muted/50 rounded-lg\">\r\n                  <p className=\"text-lg font-bold text-primary\">{post.nutrition.fat}g</p>\r\n                  <p className=\"text-xs text-muted-foreground\">{t(\"recipe.fat\", \"脂肪\")}</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <Separator />\r\n\r\n        {/* Ingredients - collapsible */}\r\n        {post.ingredients && post.ingredients.length > 0 && (\r\n          <div>\r\n            <h3 className=\"font-semibold text-sm mb-3\">\r\n              {t(\"recipe.ingredients\", \"食材\")} ({post.ingredients.length})\r\n            </h3>\r\n            {/* Table header */}\r\n            <div className=\"flex items-center text-xs text-muted-foreground font-medium px-2 py-1.5 bg-muted/50 rounded-t-md border border-border/50\">\r\n              <span className=\"flex-1\">{t(\"recipe.ingredientName\", \"名称\")}</span>\r\n              <span className=\"w-24 text-right\">{t(\"recipe.amount\", \"用量\")}</span>\r\n            </div>\r\n            <ul className=\"border border-t-0 border-border/50 rounded-b-md divide-y divide-border/50\">\r\n              {(showAllIngredients ? post.ingredients : post.ingredients.slice(0, INGREDIENTS_PREVIEW_COUNT)).map((ingredient, index) => {\r\n                const localName = translatedIngredients[index]\r\n                  || (i18n.language === \"en\" && ingredient.name_en ? ingredient.name_en\r\n                    : i18n.language === \"pt\" && ingredient.name_pt ? ingredient.name_pt\r\n                    : ingredient.name);\r\n                return (\r\n                  <li key={index} className=\"flex items-center text-sm px-2 py-2\">\r\n                    <span className=\"flex-1 min-w-0 truncate\">{localName}</span>\r\n                    <span className=\"w-24 text-right text-muted-foreground shrink-0\">\r\n                      {ingredient.amount} {i18n.language === \"en\" && ingredient.unit_en ? ingredient.unit_en\r\n                        : i18n.language === \"pt\" && ingredient.unit_pt ? ingredient.unit_pt\r\n                        : ingredient.unit}\r\n                    </span>\r\n                  </li>\r\n                );\r\n              })}\r\n            </ul>\r\n            {post.ingredients.length > INGREDIENTS_PREVIEW_COUNT && (\r\n              <>\r\n                {showAllIngredients && <RecipeAds />}\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"w-full mt-2 text-xs text-primary\"\r\n                  onClick={() => setShowAllIngredients(!showAllIngredients)}\r\n                >\r\n                  {showAllIngredients\r\n                    ? t(\"common.collapse\", \"收起\")\r\n                    : t(\"recipe.showAllIngredients\", { count: post.ingredients.length })}\r\n                  {showAllIngredients ? <ChevronUp className=\"h-3 w-3 ml-1\" /> : <ChevronDown className=\"h-3 w-3 ml-1\" />}\r\n                </Button>\r\n              </>\r\n            )}\r\n            {/* Show ads when no collapse needed (fewer ingredients) */}\r\n            {post.ingredients.length <= INGREDIENTS_PREVIEW_COUNT && <RecipeAds />}\r\n          </div>\r\n        )}\r\n\r\n        {/* Tags */}\r\n        {post.recipe_tags && post.recipe_tags.length > 0 && (\r\n          <div className=\"flex flex-wrap gap-2 pt-2\">\r\n            {post.recipe_tags.map((tag, index) => (\r\n              <Badge key={index} variant=\"secondary\" className=\"text-xs\">\r\n                #{tag}\r\n              </Badge>\r\n            ))}\r\n          </div>\r\n        )}\r\n\r\n        {/* Start Cooking Button */}\r\n        {hasSteps && (\r\n          <Button \r\n            size=\"lg\" \r\n            className=\"w-full gap-2 h-14 text-lg\"\r\n            onClick={onStartCooking}\r\n          >\r\n            <PlayCircle className=\"h-6 w-6\" />\r\n            {t(\"recipe.startCooking\", \"开始烹饪\")}\r\n            <Badge variant=\"secondary\" className=\"ml-2\">\r\n              {post.steps!.length} {t(\"recipe.stepsCount\", \"步\")}\r\n            </Badge>\r\n          </Button>\r\n        )}\r\n      </CardContent>\r\n\r\n      <ImagePreviewModal\r\n        imageUrl={previewImageUrl || \"\"}\r\n        isOpen={!!previewImageUrl}\r\n        onClose={() => setPreviewImageUrl(null)}\r\n      />\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default RecipeOverview;\r\n","import { useState, useRef, useCallback, useMemo } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { formatDistanceToNow } from \"date-fns\";\r\nimport { zhCN, enUS, pt } from \"date-fns/locale\";\r\nimport { Clock, Users, Utensils, Flame, ChefHat, Heart, MessageCircle, Share2, List, PlayCircle, Quote } from \"lucide-react\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { CommunityPost } from \"@/hooks/useCommunityPosts\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { RecipeStep, Ingredient, NutritionInfo } from \"./RecipeTypes\";\r\nimport RecipeOverview from \"./RecipeOverview\";\r\nimport RecipeCookingMode from \"./RecipeCookingMode\";\r\nimport RecipeAds from \"./RecipeAds\";\r\nimport TranslateButton from \"@/components/TranslateButton\";\r\nimport ImagePreviewModal from \"@/components/ImagePreviewModal\";\r\n\r\n// Parse structured content: [[NOTE]]心得\\n[[INTRO]]介绍\r\nconst parseRecipeContent = (raw: string) => {\r\n  const noteMatch = raw.match(/^\\[\\[NOTE\\]\\]([\\s\\S]*?)(?:\\n\\[\\[INTRO\\]\\]|$)/);\r\n  const introMatch = raw.match(/\\[\\[INTRO\\]\\]([\\s\\S]*)$/);\r\n  if (noteMatch) {\r\n    return {\r\n      note: noteMatch[1].trim(),\r\n      intro: introMatch ? introMatch[1].trim() : \"\",\r\n    };\r\n  }\r\n  return { note: \"\", intro: raw };\r\n};\r\n\r\ninterface ExtendedPost extends CommunityPost {\r\n  post_type?: string;\r\n  recipe_name?: string;\r\n  recipe_name_en?: string;\r\n  recipe_name_pt?: string;\r\n  cook_time?: number;\r\n  difficulty?: string;\r\n  servings?: number;\r\n  ingredients?: Ingredient[];\r\n  steps?: RecipeStep[];\r\n  nutrition?: NutritionInfo;\r\n  recipe_tags?: string[];\r\n  recipe_category?: string;\r\n}\r\n\r\ninterface RecipeDetailContentProps {\r\n  post: ExtendedPost;\r\n  showActions?: boolean;\r\n}\r\n\r\ntype ViewMode = 'guided' | 'full';\r\ntype GuidedPhase = 'overview' | 'cooking';\r\n\r\nconst RecipeDetailContent = ({ post, showActions = false }: RecipeDetailContentProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  \r\n  // View mode: 'guided' (step-by-step) or 'full' (all at once)\r\n  const [viewMode, setViewMode] = useState<ViewMode>('guided');\r\n  // For guided mode: 'overview' (info + ingredients) or 'cooking' (steps)\r\n  const [guidedPhase, setGuidedPhase] = useState<GuidedPhase>('overview');\r\n  // Translation state\r\n  const [translatedName, setTranslatedName] = useState<string | null>(null);\r\n  const [translatedContent, setTranslatedContent] = useState<string | null>(null);\r\n  const [translatedIngredients, setTranslatedIngredients] = useState<Record<number, string>>({});\r\n  const [translatedSteps, setTranslatedSteps] = useState<Record<number, string>>({});\r\n  const [previewImageUrl, setPreviewImageUrl] = useState<string | null>(null);\r\n  const cookingRef = useRef<HTMLDivElement>(null);\r\n\r\n  const handleStartCooking = useCallback(() => {\r\n    setGuidedPhase('cooking');\r\n    // Scroll to top after render\r\n    requestAnimationFrame(() => {\r\n      window.scrollTo({ top: 0, behavior: 'smooth' });\r\n    });\r\n  }, []);\r\n\r\n  // Get localized content - prioritize pre-stored translations\r\n  const getLocalizedContent = () => {\r\n    const langMap: Record<string, string> = {\r\n      'zh': 'content_zh',\r\n      'en': 'content_en', \r\n      'pt': 'content_pt'\r\n    };\r\n    const field = langMap[i18n.language] || 'content';\r\n    const localizedValue = post[field as keyof typeof post];\r\n    if (localizedValue && typeof localizedValue === 'string' && localizedValue.trim()) {\r\n      return localizedValue;\r\n    }\r\n    return post.content;\r\n  };\r\n\r\n  const displayContent = translatedContent || getLocalizedContent();\r\n  const displayName = translatedName || getLocalizedField(post, \"recipe_name\") || post.recipe_name;\r\n  const parsedContent = useMemo(() => parseRecipeContent(displayContent || \"\"), [displayContent]);\r\n\r\n  // Build combined text for translation: name + content + ingredients + steps\r\n  const buildTranslationText = () => {\r\n    const parts: string[] = [];\r\n    if (post.recipe_name) {\r\n      parts.push(`[NAME]${post.recipe_name}`);\r\n    }\r\n    if (post.content && post.content.trim() && !post.content.includes('主要配料：')) {\r\n      parts.push(`[CONTENT]${post.content}`);\r\n    }\r\n    if (post.ingredients && post.ingredients.length > 0) {\r\n      const ingredientNames = post.ingredients.map(i => i.name).join('|');\r\n      parts.push(`[INGREDIENTS]${ingredientNames}`);\r\n    }\r\n    if (post.steps && post.steps.length > 0) {\r\n      const stepDescs = post.steps.sort((a, b) => a.order - b.order).map(s => s.description).join('|');\r\n      parts.push(`[STEPS]${stepDescs}`);\r\n    }\r\n    return parts.join('\\n---\\n');\r\n  };\r\n\r\n  // Parse translation result\r\n  const handleTranslation = (translated: string | null) => {\r\n    if (!translated) {\r\n      setTranslatedName(null);\r\n      setTranslatedContent(null);\r\n      setTranslatedIngredients({});\r\n      setTranslatedSteps({});\r\n      return;\r\n    }\r\n    \r\n    const sections = translated.split('\\n---\\n');\r\n    sections.forEach(section => {\r\n      if (section.startsWith('[NAME]')) {\r\n        setTranslatedName(section.replace('[NAME]', ''));\r\n      } else if (section.startsWith('[CONTENT]')) {\r\n        setTranslatedContent(section.replace('[CONTENT]', ''));\r\n      } else if (section.startsWith('[INGREDIENTS]')) {\r\n        const names = section.replace('[INGREDIENTS]', '').split('|');\r\n        const map: Record<number, string> = {};\r\n        names.forEach((name, idx) => { map[idx] = name.trim(); });\r\n        setTranslatedIngredients(map);\r\n      } else if (section.startsWith('[STEPS]')) {\r\n        const descs = section.replace('[STEPS]', '').split('|');\r\n        const map: Record<number, string> = {};\r\n        descs.forEach((desc, idx) => { map[idx] = desc.trim(); });\r\n        setTranslatedSteps(map);\r\n      }\r\n    });\r\n  };\r\n\r\n  const getDateLocale = () => {\r\n    switch (i18n.language) {\r\n      case \"zh\": return zhCN;\r\n      case \"pt\": return pt;\r\n      default: return enUS;\r\n    }\r\n  };\r\n\r\n  const getDifficultyColor = (d: string) => {\r\n    switch (d) {\r\n      case 'easy': return 'bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30';\r\n      case 'medium': return 'bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30';\r\n      case 'hard': return 'bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30';\r\n      default: return 'bg-muted text-muted-foreground';\r\n    }\r\n  };\r\n\r\n  const getDifficultyLabel = (d: string) => {\r\n    switch (d) {\r\n      case 'easy': return t(\"recipe.difficulty.easy\", \"简单\");\r\n      case 'medium': return t(\"recipe.difficulty.medium\", \"中等\");\r\n      case 'hard': return t(\"recipe.difficulty.hard\", \"困难\");\r\n      default: return d;\r\n    }\r\n  };\r\n\r\n  const hasImages = post.image_urls && post.image_urls.length > 0;\r\n  const hasSteps = post.steps && post.steps.length > 0;\r\n\r\n  // Guided mode - Cooking phase (full screen step-by-step)\r\n  if (viewMode === 'guided' && guidedPhase === 'cooking' && hasSteps) {\r\n    return (\r\n      <Card className=\"overflow-hidden\">\r\n        <RecipeCookingMode \r\n          steps={post.steps!} \r\n          onExit={() => setGuidedPhase('overview')} \r\n        />\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  // Guided mode - Overview phase\r\n  if (viewMode === 'guided') {\r\n    return (\r\n      <div className=\"space-y-4\">\r\n        {/* Mode toggle */}\r\n        <div className=\"flex justify-end\">\r\n          <div className=\"inline-flex h-9 items-center rounded-md bg-muted p-1 text-muted-foreground\">\r\n            <button\r\n              onClick={() => setViewMode('guided')}\r\n              className=\"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 bg-background text-foreground shadow-sm\"\r\n            >\r\n              <PlayCircle className=\"h-4 w-4\" />\r\n              {t(\"recipe.guidedMode\", \"流程模式\")}\r\n            </button>\r\n            <button\r\n              onClick={() => setViewMode('full')}\r\n              className=\"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5\"\r\n            >\r\n              <List className=\"h-4 w-4\" />\r\n              {t(\"recipe.fullMode\", \"完整模式\")}\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <RecipeOverview \r\n          post={post} \r\n          onStartCooking={handleStartCooking} \r\n        />\r\n\r\n        {/* Stats */}\r\n        <Card>\r\n          <CardContent className=\"py-4\">\r\n            <div className=\"flex items-center gap-6 text-muted-foreground\">\r\n              <span className=\"flex items-center gap-1.5 text-sm\">\r\n                <Heart className=\"h-4 w-4\" />\r\n                {post.likes_count || 0}\r\n              </span>\r\n              <span className=\"flex items-center gap-1.5 text-sm\">\r\n                <MessageCircle className=\"h-4 w-4\" />\r\n                {post.comments_count || 0}\r\n              </span>\r\n              <span className=\"flex items-center gap-1.5 text-sm\">\r\n                <Share2 className=\"h-4 w-4\" />\r\n                {post.shares_count || 0}\r\n              </span>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Full mode - Original layout with all content\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Mode toggle */}\r\n      <div className=\"flex justify-end\">\r\n        <div className=\"inline-flex h-9 items-center rounded-md bg-muted p-1 text-muted-foreground\">\r\n          <button\r\n            onClick={() => {\r\n              setViewMode('guided');\r\n              setGuidedPhase('overview');\r\n            }}\r\n            className=\"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5\"\r\n          >\r\n            <PlayCircle className=\"h-4 w-4\" />\r\n            {t(\"recipe.guidedMode\", \"流程模式\")}\r\n          </button>\r\n          <button\r\n            onClick={() => setViewMode('full')}\r\n            className=\"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 bg-background text-foreground shadow-sm\"\r\n          >\r\n            <List className=\"h-4 w-4\" />\r\n            {t(\"recipe.fullMode\", \"完整模式\")}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <Card className=\"overflow-hidden\">\r\n        {/* Hero Image */}\r\n        {hasImages && (\r\n          <div className=\"relative aspect-video overflow-hidden\">\r\n            <img\r\n              src={post.image_urls![0]}\r\n              alt={displayName || \"\"}\r\n              className=\"w-full h-full object-cover cursor-pointer\"\r\n              onClick={() => setPreviewImageUrl(post.image_urls![0])}\r\n            />\r\n            <Badge className=\"absolute top-3 left-3 bg-primary text-primary-foreground gap-1\">\r\n              <Utensils className=\"h-3 w-3\" />\r\n              {t(\"recipe.badge\", \"食谱\")}\r\n            </Badge>\r\n          </div>\r\n        )}\r\n\r\n        <CardHeader className=\"pb-3\">\r\n          {/* Author */}\r\n          <div className=\"flex items-center gap-3 mb-4\">\r\n            <Avatar className=\"h-10 w-10\">\r\n              <AvatarImage src={post.author?.avatar_url || undefined} />\r\n              <AvatarFallback>\r\n                {post.author?.display_name?.charAt(0) || \"?\"}\r\n              </AvatarFallback>\r\n            </Avatar>\r\n            <div>\r\n              <p className=\"font-medium text-sm\">{post.author?.display_name}</p>\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                {formatDistanceToNow(new Date(post.created_at), {\r\n                  addSuffix: true,\r\n                  locale: getDateLocale(),\r\n                })}\r\n              </p>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Translate All Button - above recipe name */}\r\n          <div className=\"mb-2\">\r\n            <TranslateButton \r\n              text={buildTranslationText()} \r\n              onTranslation={handleTranslation}\r\n              label={t(\"recipe.translateAllFull\")}\r\n            />\r\n          </div>\r\n\r\n          {/* Recipe Name */}\r\n          <h2 className=\"text-xl font-bold\">{displayName}</h2>\r\n\r\n          {/* Meta Info */}\r\n          <div className=\"flex flex-wrap items-center gap-3 mt-3\">\r\n            {post.cook_time && (\r\n              <div className=\"flex items-center gap-1.5 text-sm text-muted-foreground\">\r\n                <Clock className=\"h-4 w-4\" />\r\n                <span>{post.cook_time} {t(\"recipe.minutes\", \"分钟\")}</span>\r\n              </div>\r\n            )}\r\n            {post.servings && (\r\n              <div className=\"flex items-center gap-1.5 text-sm text-muted-foreground\">\r\n                <Users className=\"h-4 w-4\" />\r\n                <span>{post.servings} {t(\"recipe.servings\", \"人份\")}</span>\r\n              </div>\r\n            )}\r\n            {post.difficulty && (\r\n              <Badge variant=\"outline\" className={getDifficultyColor(post.difficulty)}>\r\n                <ChefHat className=\"h-3 w-3 mr-1\" />\r\n                {getDifficultyLabel(post.difficulty)}\r\n              </Badge>\r\n            )}\r\n          </div>\r\n        </CardHeader>\r\n\r\n        <CardContent className=\"space-y-6\">\r\n          {/* Description - cooking note + AI intro */}\r\n          {post.content && post.content.trim() && !post.content.includes('主要配料：') && (\r\n            <div className=\"space-y-3\">\r\n              {parsedContent.note && (\r\n                <div className=\"rounded-lg border border-primary/20 bg-primary/5 px-4 py-3\">\r\n                  <div className=\"flex items-center gap-1.5 mb-1.5\">\r\n                    <Quote className=\"h-3.5 w-3.5 text-primary\" />\r\n                    <span className=\"text-xs font-medium text-primary\">{t(\"recipe.cookingNote\", \"心得\")}</span>\r\n                  </div>\r\n                  <p className=\"text-sm text-foreground/80 italic leading-relaxed whitespace-pre-line\">\r\n                    {parsedContent.note}\r\n                  </p>\r\n                </div>\r\n              )}\r\n              {parsedContent.intro && (\r\n                <p className=\"text-sm text-muted-foreground whitespace-pre-line leading-relaxed\">\r\n                  {parsedContent.intro}\r\n                </p>\r\n              )}\r\n              {!parsedContent.note && !parsedContent.intro && (\r\n                <p className=\"text-sm text-muted-foreground whitespace-pre-line\">\r\n                  {displayContent}\r\n                </p>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Nutrition Info */}\r\n          {post.nutrition && (post.nutrition.calories || post.nutrition.protein || post.nutrition.carbs || post.nutrition.fat) && (\r\n            <div>\r\n              <h3 className=\"font-semibold text-sm mb-3 flex items-center gap-2\">\r\n                <Flame className=\"h-4 w-4 text-primary\" />\r\n                {t(\"recipe.nutrition\", \"营养信息\")}\r\n              </h3>\r\n              <div className=\"grid grid-cols-4 gap-2\">\r\n                {post.nutrition.calories && (\r\n                  <div className=\"text-center p-2 bg-muted/50 rounded-lg\">\r\n                    <p className=\"text-lg font-bold text-primary\">{post.nutrition.calories}</p>\r\n                    <p className=\"text-xs text-muted-foreground\">{t(\"recipe.kcal\", \"千卡\")}</p>\r\n                  </div>\r\n                )}\r\n                {post.nutrition.protein && (\r\n                  <div className=\"text-center p-2 bg-muted/50 rounded-lg\">\r\n                    <p className=\"text-lg font-bold text-primary\">{post.nutrition.protein}g</p>\r\n                    <p className=\"text-xs text-muted-foreground\">{t(\"recipe.protein\", \"蛋白质\")}</p>\r\n                  </div>\r\n                )}\r\n                {post.nutrition.carbs && (\r\n                  <div className=\"text-center p-2 bg-muted/50 rounded-lg\">\r\n                    <p className=\"text-lg font-bold text-primary\">{post.nutrition.carbs}g</p>\r\n                    <p className=\"text-xs text-muted-foreground\">{t(\"recipe.carbs\", \"碳水\")}</p>\r\n                  </div>\r\n                )}\r\n                {post.nutrition.fat && (\r\n                  <div className=\"text-center p-2 bg-muted/50 rounded-lg\">\r\n                    <p className=\"text-lg font-bold text-primary\">{post.nutrition.fat}g</p>\r\n                    <p className=\"text-xs text-muted-foreground\">{t(\"recipe.fat\", \"脂肪\")}</p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          <Separator />\r\n\r\n          {/* Ingredients */}\r\n          {post.ingredients && post.ingredients.length > 0 && (\r\n            <div>\r\n              <h3 className=\"font-semibold text-sm mb-3\">\r\n                {t(\"recipe.ingredients\", \"食材\")} ({post.ingredients.length})\r\n              </h3>\r\n              {/* Table header */}\r\n              <div className=\"flex items-center text-xs text-muted-foreground font-medium px-2 py-1.5 bg-muted/50 rounded-t-md border border-border/50\">\r\n                <span className=\"flex-1\">{t(\"recipe.ingredientName\", \"名称\")}</span>\r\n                <span className=\"w-24 text-right\">{t(\"recipe.amount\", \"用量\")}</span>\r\n              </div>\r\n              <ul className=\"border border-t-0 border-border/50 rounded-b-md divide-y divide-border/50\">\r\n                {post.ingredients.map((ingredient, index) => {\r\n                  // For AI-generated recipes, use built-in translations; otherwise use translate button result\r\n                  const localName = translatedIngredients[index]\r\n                    || (i18n.language === \"en\" && ingredient.name_en ? ingredient.name_en\r\n                      : i18n.language === \"pt\" && ingredient.name_pt ? ingredient.name_pt\r\n                      : ingredient.name);\r\n                  return (\r\n                    <li key={index} className=\"flex items-center text-sm px-2 py-2\">\r\n                      <span className=\"flex-1 min-w-0 truncate\">{localName}</span>\r\n                      <span className=\"w-24 text-right text-muted-foreground shrink-0\">\r\n                        {ingredient.amount} {i18n.language === \"en\" && ingredient.unit_en ? ingredient.unit_en\r\n                          : i18n.language === \"pt\" && ingredient.unit_pt ? ingredient.unit_pt\r\n                          : ingredient.unit}\r\n                      </span>\r\n                    </li>\r\n                  );\r\n                })}\r\n              </ul>\r\n              <RecipeAds />\r\n            </div>\r\n          )}\r\n\r\n          <Separator />\r\n\r\n          {/* Steps */}\r\n          {hasSteps && (\r\n            <div>\r\n              <h3 className=\"font-semibold text-sm mb-3\">\r\n                {t(\"recipe.steps\", \"步骤\")} ({post.steps!.length})\r\n              </h3>\r\n              <ol className=\"space-y-4\">\r\n                {post.steps!\r\n                  .sort((a, b) => a.order - b.order)\r\n                  .map((step, index) => {\r\n                    const localDesc = translatedSteps[index]\r\n                      || (i18n.language === \"en\" && step.description_en ? step.description_en\r\n                        : i18n.language === \"pt\" && step.description_pt ? step.description_pt\r\n                        : step.description);\r\n                    return (\r\n                    <li key={index} className=\"flex gap-3\">\r\n                      <div className=\"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold\">\r\n                        {step.order}\r\n                      </div>\r\n                      <div className=\"flex-1 space-y-2\">\r\n                        <p className=\"text-sm\">{localDesc}</p>\r\n                        {(() => {\r\n                          const imgs = (step.image_urls && step.image_urls.length > 0) ? step.image_urls : step.image_url ? [step.image_url] : [];\r\n                          return imgs.length > 0 && (\r\n                            <div className={`flex gap-2 ${imgs.length === 1 ? '' : 'flex-wrap'}`}>\r\n                              {imgs.map((url, imgIdx) => (\r\n                                <img\r\n                                  key={imgIdx}\r\n                                  src={url}\r\n                                  alt={`Step ${step.order} - ${imgIdx + 1}`}\r\n                                  className={`rounded-lg max-h-48 object-cover cursor-pointer ${imgs.length === 1 ? 'w-full' : 'w-[calc(50%-0.25rem)]'}`}\r\n                                  onClick={() => setPreviewImageUrl(url)}\r\n                                />\r\n                              ))}\r\n                            </div>\r\n                          );\r\n                        })()}\r\n                      </div>\r\n                    </li>\r\n                    );\r\n                  })}\r\n              </ol>\r\n            </div>\r\n          )}\r\n\r\n          {/* Tags */}\r\n          {post.recipe_tags && post.recipe_tags.length > 0 && (\r\n            <div className=\"flex flex-wrap gap-2 pt-2\">\r\n              {post.recipe_tags.map((tag, index) => (\r\n                <Badge key={index} variant=\"secondary\" className=\"text-xs\">\r\n                  #{tag}\r\n                </Badge>\r\n              ))}\r\n            </div>\r\n          )}\r\n\r\n          {/* Stats */}\r\n          <div className=\"flex items-center gap-6 pt-4 border-t text-muted-foreground\">\r\n            <span className=\"flex items-center gap-1.5 text-sm\">\r\n              <Heart className=\"h-4 w-4\" />\r\n              {post.likes_count || 0}\r\n            </span>\r\n            <span className=\"flex items-center gap-1.5 text-sm\">\r\n              <MessageCircle className=\"h-4 w-4\" />\r\n              {post.comments_count || 0}\r\n            </span>\r\n            <span className=\"flex items-center gap-1.5 text-sm\">\r\n              <Share2 className=\"h-4 w-4\" />\r\n              {post.shares_count || 0}\r\n            </span>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      <ImagePreviewModal\r\n        imageUrl={previewImageUrl || \"\"}\r\n        isOpen={!!previewImageUrl}\r\n        onClose={() => setPreviewImageUrl(null)}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RecipeDetailContent;\r\n"],"names":["PostCard","post","showActions","isDetailPage","t","i18n","useTranslation","user","useAuth","navigate","useNavigate","requireLogin","useLoginRequired","getLocalizedField","useLocalizedContent","likePost","useLikePost","sharePost","useSharePost","deletePost","useDeletePost","showDeleteDialog","setShowDeleteDialog","useState","showEditDialog","setShowEditDialog","imageError","setImageError","previewOpen","setPreviewOpen","previewIndex","setPreviewIndex","carouselApi","setCarouselApi","previewCarouselApi","setPreviewCarouselApi","currentSlide","setCurrentSlide","translatedContent","setTranslatedContent","imageDimensions","setImageDimensions","longImageScrollStart","setLongImageScrollStart","showAllRestaurants","setShowAllRestaurants","smartShareFn","SmartShareDrawer","useSmartShare","useEffect","scrollY","getDateLocale","zhCN","pt","enUS","handleLike","handleShare","shareUrl","toast","handleDelete","handleImageClick","index","handleImageLoad","e","url","img","prev","isLongImage","dims","isAuthor","activityTitle","allRestaurants","r","maxVisibleRestaurants","visibleRestaurants","hasMoreRestaurants","localizedContent","hasLocalizedTranslation","displayContent","jsxs","Fragment","Card","jsx","CardHeader","Avatar","AvatarImage","AvatarFallback","Badge","Clock","DropdownMenu","DropdownMenuTrigger","Button","MoreHorizontal","DropdownMenuContent","DropdownMenuItem","Pencil","CardContent","Sparkles","Link","Calendar","restaurant","MapPin","ChevronDown","ChevronUp","TranslateButton","displayImageUrls","isLong","FileImage","Carousel","CarouselContent","CarouselItem","_","CardFooter","Heart","MessageCircle","Share2","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","EditRecipeDialog","EditPostDialog","createPortal","X","api","target","deltaY","deltaScroll","touch","ChevronLeft","ChevronRight","adsTable","supabase","RecipeAds","isMobile","useIsMobile","pendingUrl","setPendingUrl","pendingAdName","setPendingAdName","ads","useQuery","now","data","error","handleAdClick","ad","handleConfirm","getImageUrl","imgUrl","ExternalLink","ExternalLinkConfirmDialog","open","parseRecipeContent","raw","noteMatch","introMatch","RecipeOverview","onStartCooking","translatedName","setTranslatedName","translatedIngredients","setTranslatedIngredients","previewImageUrl","setPreviewImageUrl","showFullContent","setShowFullContent","showAllIngredients","setShowAllIngredients","CONTENT_MAX_LENGTH","INGREDIENTS_PREVIEW_COUNT","field","localizedValue","parsedContent","useMemo","displayName","buildTranslationText","parts","ingredientNames","i","handleTranslation","translated","section","names","map","name","idx","getDifficultyColor","d","getDifficultyLabel","hasImages","hasSteps","Utensils","Users","ChefHat","Quote","Flame","Separator","ingredient","localName","tag","PlayCircle","ImagePreviewModal","RecipeDetailContent","viewMode","setViewMode","guidedPhase","setGuidedPhase","translatedSteps","setTranslatedSteps","useRef","handleStartCooking","useCallback","stepDescs","a","b","s","descs","desc","RecipeCookingMode","List","step","localDesc","imgs","imgIdx"],"mappings":"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"}