import{j as e}from"./vendor-ui-BO6fjm1h.js";import{r as x}from"./vendor-react-CrHRjzzo.js";import{D as be,c as ye,d as fe,e as Ne,bW as X,aA as we,c3 as Ce,c4 as ke,z as Te,k as $e,bY as Ae,L as ne,aD as Re,B as p,b2 as Le,q as te,P as ie,c5 as Oe,Y as Be,c6 as ge,aQ as Pe,aP as Me,af as Ue,aj as He,b3 as Ve,b1 as We,ak as Ye,al as qe,am as Ge,an as Xe,ao as Ze,ap as Je,aq as Qe,aG as Ke,X as ea,a6 as k,aB as n,$ as ce,bZ as de,I as d,a9 as aa,aa as sa,bg as ta,C as ia,ab as la,ac as le,ad as ra,aW as na,aX as oa,aY as ca,aZ as da,a_ as ae,bb as me,O as pe,Z as ue}from"./index-CMe-28It.js";import{S as ve}from"./slider-CyWVtlMQ.js";import{T as De,a as ze,b as Z,c as re}from"./tabs-D9by2SIk.js";import{a as ma,b as pa,c as ua,d as ha,e as xa,f as ga}from"./useHomepageTemplates-CoEutXEv.js";import{S as va,L as ja,B as _a}from"./ReactCrop-B-BeGi7O.js";import{A as ba,a as ya}from"./alert-DfdMJrtJ.js";import{u as he}from"./vendor-i18n-DWR4v88Y.js";import"./vendor-charts-C50LysBY.js";import"./vendor-query-EnOED-MY.js";import"./vendor-supabase-QnE9GqXs.js";const fa={desktop:{width:1920,height:1080,aspect:16/9,label:"桌面端 16:9",icon:Ce},tablet:{width:1024,height:768,aspect:4/3,label:"平板端 4:3",icon:ke},mobile:{width:750,height:1334,aspect:9/16,label:"移动端 9:16",icon:Te}};function je(s,w,f){return ja(_a({unit:"%",width:90},f,s,w),s,w)}function Na({open:s,onOpenChange:w,imageSource:f,deviceType:I,onCropComplete:C}){const{t:se}=he(),[A,J]=x.useState(""),[T,F]=x.useState(),[O,g]=x.useState(),[t,b]=x.useState(I),R=x.useRef(null),[E,B]=x.useState(!1),[S,P]=x.useState(!1),h=fa[t],W=h.icon;x.useEffect(()=>{if(s&&f)if(b(I),F(void 0),g(void 0),typeof f=="string")P(!0),J(f);else{P(!0);const o=new FileReader;o.addEventListener("load",()=>{J(o.result?.toString()||"")}),o.readAsDataURL(f)}},[s,f,I]);const M=x.useCallback(o=>{P(!1);const{width:v,height:j}=o.currentTarget;F(je(v,j,h.aspect))},[h.aspect]);x.useEffect(()=>{if(R.current&&R.current.complete){const{width:o,height:v}=R.current;o&&v&&F(je(o,v,h.aspect))}},[t,h.aspect]);const Y=x.useCallback(async(o,v)=>{const j=document.createElement("canvas"),q=j.getContext("2d");if(!q)throw new Error("No 2d context");const Q=o.naturalWidth/o.width,U=o.naturalHeight/o.height,G=v.width*Q,H=v.height*U;let D=G,L=H;if(D>h.width||L>h.height){const V=Math.min(h.width/D,h.height/L);D=D*V,L=L*V}return j.width=D,j.height=L,q.imageSmoothingQuality="high",q.drawImage(o,v.x*Q,v.y*U,G,H,0,0,j.width,j.height),new Promise((V,K)=>{j.toBlob(z=>{if(!z){K(new Error("Canvas is empty"));return}V(z)},"image/jpeg",.92)})},[h]),N=x.useCallback(async()=>{if(!(!O||!R.current)){B(!0);try{const o=await Y(R.current,O),v=typeof f=="string"?`cropped-${t}-${Date.now()}.jpg`:f.name,j=new File([o],v,{type:"image/jpeg"});C(j,t),w(!1)}catch(o){console.error("Error cropping image:",o)}finally{B(!1)}}},[O,f,t,C,w,Y]);return e.jsx(be,{open:s,onOpenChange:w,children:e.jsxs(ye,{className:"max-w-[95vw] sm:max-w-4xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[e.jsxs(fe,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-4 border-b",children:[e.jsxs(Ne,{className:"text-lg sm:text-xl flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-primary"}),"裁剪图片"]}),e.jsx(we,{className:"text-xs sm:text-sm",children:"拖动选择要保留的区域，裁剪后将用于主页轮播"})]}),e.jsxs("div",{className:"px-4 sm:px-6 py-4 space-y-4 overflow-y-auto",children:[e.jsx(De,{value:t,onValueChange:o=>b(o),children:e.jsxs(ze,{className:"grid w-full grid-cols-3",children:[e.jsxs(Z,{value:"desktop",className:"flex items-center gap-1",children:[e.jsx(Ce,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"桌面端"})]}),e.jsxs(Z,{value:"tablet",className:"flex items-center gap-1",children:[e.jsx(ke,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"平板端"})]}),e.jsxs(Z,{value:"mobile",className:"flex items-center gap-1",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"移动端"})]})]})}),e.jsxs(ba,{className:"border-primary/20 bg-primary/5",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx(ya,{className:"text-xs sm:text-sm",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"推荐尺寸:"}),e.jsxs($e,{variant:"secondary",className:"w-fit",children:[e.jsx(Ae,{className:"w-3 h-3 mr-1"}),h.width," × ",h.height," px (",h.label,")"]})]})})]}),e.jsxs("div",{className:"relative w-full overflow-hidden rounded-lg border bg-muted/30 min-h-[200px]",children:[S&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(ne,{className:"w-8 h-8 animate-spin text-muted-foreground"})}),A&&e.jsx(va,{crop:T,onChange:o=>F(o),onComplete:o=>g(o),aspect:h.aspect,className:"max-h-[50vh] sm:max-h-[55vh] flex items-center justify-center",children:e.jsx("img",{ref:R,src:A,alt:"Crop preview",onLoad:M,crossOrigin:"anonymous",className:"max-w-full max-h-[50vh] sm:max-h-[55vh] h-auto object-contain"})})]})]}),e.jsxs(Re,{className:"px-4 sm:px-6 pb-4 sm:pb-6 pt-4 border-t gap-2 sm:gap-0",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>w(!1),disabled:E,className:"w-full sm:w-auto",children:se("common.cancel")}),e.jsx(p,{type:"button",onClick:N,disabled:!O||E||S,className:"w-full sm:w-auto",children:E?"处理中...":"确认裁剪"})]})]})})}const _e="/images/sushi-ramen-hero.jpg",wa="/images/sushi-ramen-mobile.jpg",Ca=({template:s,onClose:w})=>{const{i18n:f}=he(),I=f.language?.split("-")[0]||"zh",C=N=>s[`${N}${I==="zh"?"_zh":I==="pt"?"_pt":"_en"}`]||"",se=()=>window.innerWidth<640?"mobile":window.innerWidth<1024?"tablet":"desktop",A=()=>{const N=se();return N==="mobile"&&s.mobile_overlay_opacity!==null?s.mobile_overlay_opacity:N==="tablet"&&s.tablet_overlay_opacity!==null?s.tablet_overlay_opacity:N==="desktop"&&s.desktop_overlay_opacity!==null?s.desktop_overlay_opacity:s.overlay_opacity??30},J=()=>{const N=A()||30,o=s.overlay_gradient_direction||"to-b",v=(z,ee)=>z==null?ee/100:z>1?z/100:z,j=N>1?N/100:N,q=v(s.overlay_gradient_from_opacity,30)*j,Q=v(s.overlay_gradient_via_opacity,25)*j,U=v(s.overlay_gradient_to_opacity,40)*j,H={"to-t":"to top","to-b":"to bottom","to-l":"to left","to-r":"to right","to-tl":"to top left","to-tr":"to top right","to-bl":"to bottom left","to-br":"to bottom right"}[o]||"to bottom",D={black:"0, 0, 0",white:"255, 255, 255",background:"0, 0, 0",foreground:"255, 255, 255",primary:"1, 100, 80",secondary:"240, 240, 240"},L=D[s.overlay_gradient_from||"black"]||"0, 0, 0",V=D[s.overlay_gradient_via||"black"]||"0, 0, 0",K=D[s.overlay_gradient_to||"black"]||"0, 0, 0";return{background:`linear-gradient(${H}, rgba(${L}, ${q}), rgba(${V}, ${Q}), rgba(${K}, ${U}))`}},T=s.mobile_image_url||wa,F=s.tablet_image_url||s.desktop_image_url||_e,O=s.desktop_image_url||_e,g=s.background_blur||0,t=s.desktop_media_type||s.media_type||"image",b=s.tablet_media_type||s.media_type||"image",E=(s.mobile_media_type||s.media_type||"image")==="video"?s.mobile_video_url:null,B=b==="video"?s.tablet_video_url||s.desktop_video_url:null,S=t==="video"?s.desktop_video_url:null,P=C("title"),h=C("subtitle"),W=C("description"),M=C("primary_button_text"),Y=C("secondary_button_text");return e.jsxs("div",{className:"relative w-full h-full",children:[e.jsxs("div",{className:"absolute inset-0 w-full h-full",children:[e.jsx("div",{className:"absolute inset-0 w-full h-full sm:hidden",children:E?e.jsx("video",{src:E,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:g>0?`blur(${g}px)`:void 0}}):e.jsx("img",{src:T||"",alt:"Background",className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:g>0?`blur(${g}px)`:void 0}})}),e.jsx("div",{className:"absolute inset-0 w-full h-full hidden sm:block lg:hidden",children:B?e.jsx("video",{src:B,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:g>0?`blur(${g}px)`:void 0}}):e.jsx("img",{src:F||"",alt:"Background",className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:g>0?`blur(${g}px)`:void 0}})}),e.jsx("div",{className:"absolute inset-0 w-full h-full hidden lg:block",children:S?e.jsx("video",{src:S,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:g>0?`blur(${g}px)`:void 0}}):e.jsx("img",{src:O||"",alt:"Background",className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:g>0?`blur(${g}px)`:void 0}})})]}),e.jsx("div",{className:"absolute inset-0 z-10",style:J()}),e.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col items-center justify-center text-center px-4",children:[h&&e.jsx("p",{className:"text-white/90 text-sm sm:text-base mb-2 drop-shadow-md",children:h}),P&&e.jsx("h1",{className:"text-3xl sm:text-4xl lg:text-5xl font-bold text-white mb-4 drop-shadow-lg",children:P}),W&&e.jsx("p",{className:"text-white/80 text-base sm:text-lg max-w-2xl mb-8 drop-shadow-md",children:W}),e.jsxs("div",{className:"flex flex-wrap gap-4 justify-center",children:[M&&e.jsx(p,{variant:s.primary_button_variant||"default",size:"lg",className:"pointer-events-none",children:M}),Y&&e.jsx(p,{variant:s.secondary_button_variant||"outline",size:"lg",className:"pointer-events-none text-white border-white hover:bg-white/10",children:Y})]})]}),e.jsx("div",{className:"absolute bottom-4 left-4 z-30 bg-black/50 text-white text-xs px-3 py-1 rounded-full",children:"预览模式 - 点击右上角关闭"})]})},Oa=()=>{const{t:s}=he(),{data:w,isLoading:f}=ma(),I=pa(),C=ua(),se=ha(),A=xa(),J=ga(),[T,F]=x.useState(null),[O,g]=x.useState(!1),[t,b]=x.useState({}),[R,E]=x.useState("images"),[B,S]=x.useState(null),[P,h]=x.useState(!1),[W,M]=x.useState(null),[Y,N]=x.useState("desktop"),o=()=>{b({sort_order:w?.length||0,is_active:!0,media_type:"image",desktop_media_type:"image",tablet_media_type:"image",mobile_media_type:"image",duration:5e3,overlay_opacity:40,overlay_gradient_direction:"to-b",overlay_gradient_from:"background",overlay_gradient_from_opacity:30,overlay_gradient_via:"background",overlay_gradient_via_opacity:25,overlay_gradient_to:"background",overlay_gradient_to_opacity:40,background_blur:0,title_zh:"发现您的亚洲美食之旅",title_en:"Discover Your Asian Food Journey",title_pt:"Descubra Sua Jornada Gastronômica Asiática",subtitle_zh:"您的美食之旅从这里开始",subtitle_en:"Your culinary journey starts here",subtitle_pt:"Sua jornada culinária começa aqui",description_zh:"探索里斯本地区最好的亚洲美食",description_en:"Explore the best Asian cuisine in the Lisbon area",description_pt:"Explore a melhor cozinha asiática na área de Lisboa",primary_button_text_zh:"探索餐厅",primary_button_text_en:"Explore Restaurants",primary_button_text_pt:"Explorar Restaurantes",primary_button_link:"/restaurants",primary_button_variant:"default",secondary_button_text_zh:"活动",secondary_button_text_en:"Activities",secondary_button_text_pt:"Atividades",secondary_button_link:"/activities",secondary_button_variant:"outline"}),g(!0),E("media")},v=a=>{b(a),F(a),E("media")},j=async()=>{try{T?(await C.mutateAsync({id:T.id,...t}),F(null)):(await I.mutateAsync(t),g(!1)),b({})}catch(a){console.error("Save failed:",a)}},q=async a=>{try{await se.mutateAsync(a)}catch(m){console.error("Delete failed:",m)}},Q=async a=>{try{await C.mutateAsync({id:a.id,is_active:!a.is_active})}catch(m){console.error("Toggle failed:",m)}},U=async(a,m)=>{const r=a.target.files?.[0];if(r){if(!r.type.startsWith("image/")){k.error(s("admin.homepageTemplates.selectImageFile"));return}try{const i=T?.id||"new",c=await A.mutateAsync({file:r,type:m,templateId:i});b(_=>({..._,[`${m}_image_url`]:c.url}))}catch(i){console.error("Upload failed:",i)}}},G=(a,m)=>{const r=a.target.files?.[0];if(r){if(!r.type.startsWith("image/")){k.error(s("admin.homepageTemplates.selectImageFile"));return}M(r),N(m),h(!0),a.target.value=""}},H=(a,m)=>{M(a),N(m),h(!0)},D=async(a,m)=>{try{const r=T?.id||"new",i=await A.mutateAsync({file:a,type:m,templateId:r});b(c=>({...c,[`${m}_image_url`]:i.url})),k.success("图片裁剪并上传成功")}catch(r){console.error("Upload failed:",r),k.error("上传失败")}},L=a=>new Promise((m,r)=>{const i=document.createElement("video"),c=document.createElement("canvas"),_=c.getContext("2d");i.preload="auto",i.muted=!0,i.playsInline=!0,i.crossOrigin="anonymous";let u=!1;const $=()=>{u||i.videoWidth===0||i.videoHeight===0||(c.width=i.videoWidth,c.height=i.videoHeight,_?(_.drawImage(i,0,0,c.width,c.height),c.toBlob(y=>{y&&y.size>0?(u=!0,i.pause(),URL.revokeObjectURL(i.src),m(y)):r(new Error("Failed to create blob from canvas"))},"image/jpeg",.95)):r(new Error("Failed to get canvas context")))};i.onloadedmetadata=()=>{c.width=i.videoWidth,c.height=i.videoHeight,i.currentTime=.1},i.onseeked=()=>{setTimeout($,100)},i.oncanplay=()=>{!u&&i.currentTime>=.1&&setTimeout($,100)},i.onerror=y=>{URL.revokeObjectURL(i.src),r(new Error("Failed to load video: "+y?.message||"Unknown error"))},setTimeout(()=>{u||(URL.revokeObjectURL(i.src),r(new Error("Timeout while extracting video frame")))},1e4),i.src=URL.createObjectURL(a),i.load()}),V=a=>new Promise((m,r)=>{const i=document.createElement("video"),c=document.createElement("canvas"),_=c.getContext("2d");i.preload="auto",i.muted=!0,i.playsInline=!0,i.crossOrigin="anonymous";let u=!1;const $=()=>{u||i.videoWidth===0||i.videoHeight===0||(c.width=i.videoWidth,c.height=i.videoHeight,_?(_.drawImage(i,0,0,c.width,c.height),c.toBlob(y=>{y&&y.size>0?(u=!0,i.pause(),m(y)):r(new Error("Failed to create blob from canvas"))},"image/jpeg",.95)):r(new Error("Failed to get canvas context")))};i.onloadedmetadata=()=>{c.width=i.videoWidth,c.height=i.videoHeight,i.currentTime=.1},i.onseeked=()=>{setTimeout($,100)},i.oncanplay=()=>{!u&&i.currentTime>=.1&&setTimeout($,100)},i.onerror=()=>{r(new Error("Failed to load video from URL"))},setTimeout(()=>{u||r(new Error("Timeout while extracting video frame from URL"))},15e3),i.src=a,i.load()}),[K,z]=x.useState(!1),ee=async a=>{const m=a?[a]:["desktop","tablet","mobile"],r=T?.id||"new",i={desktop:"桌面端",tablet:"平板端",mobile:"移动端"};z(!0);let c=0,_=0;for(const u of m){const $=t[`${u}_video_url`];if($)try{k.info(`正在提取${i[u]}视频第一帧...`);const y=await V($),Fe=new File([y],`${u}-poster-${Date.now()}.jpg`,{type:"image/jpeg"}),Ee=await A.mutateAsync({file:Fe,type:u,templateId:r});b(Se=>({...Se,[`${u}_image_url`]:Ee.url})),c++}catch(y){console.error(`Failed to regenerate ${u} poster:`,y),_++}}if(z(!1),c>0){const u=a?`成功重新生成${i[a]}备用图片`:`成功重新生成 ${c} 个备用图片`;k.success(u)}if(_>0&&k.warning(`${_} 个视频提取失败，可能是跨域限制`),c===0&&_===0){const u=a?`${i[a]}没有视频需要处理`:"没有找到需要处理的视频";k.info(u)}},oe=async(a,m)=>{const r=a.target.files?.[0];if(r){if(!r.type.startsWith("video/")){k.error("请选择视频文件");return}if(r.size>100*1024*1024){k.error("视频文件大小不能超过100MB");return}try{const i=T?.id||"new",c=await J.mutateAsync({file:r,type:m,templateId:i});try{k.info("正在提取视频第一帧作为备用图片...");const _=await L(r),u=new File([_],`${m}-poster-${Date.now()}.jpg`,{type:"image/jpeg"}),$=await A.mutateAsync({file:u,type:m,templateId:i});b(y=>({...y,[`${m}_video_url`]:c.url,[`${m}_image_url`]:$.url})),k.success("视频和备用图片已自动生成")}catch(_){console.error("Failed to extract first frame:",_),b(u=>({...u,[`${m}_video_url`]:c.url})),k.warning("视频已上传，但无法自动提取第一帧，请手动上传备用图片")}}catch(i){console.error("Upload failed:",i)}}},l=(a,m)=>{b(r=>({...r,[a]:m}))},xe=()=>{F(null),g(!1),b({})};if(f)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ne,{className:"w-8 h-8 animate-spin"})});const Ie=()=>e.jsxs(De,{value:R,onValueChange:E,className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-4",children:[e.jsx(Z,{value:"media",children:"媒体"}),e.jsx(Z,{value:"overlay",children:s("admin.homepageTemplates.tabs.overlay")}),e.jsx(Z,{value:"content",children:s("admin.homepageTemplates.tabs.content")}),e.jsx(Z,{value:"buttons",children:s("admin.homepageTemplates.tabs.buttons")})]}),e.jsxs(re,{value:"media",className:"space-y-6 mt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"每个端可以独立选择图片或视频，支持混合配置（如：桌面端视频 + 移动端图片）"}),e.jsxs("div",{className:"space-y-3 p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{className:"text-base font-medium",children:"桌面端"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{type:"button",size:"sm",variant:(t.desktop_media_type||"image")==="image"?"default":"outline",onClick:()=>l("desktop_media_type","image"),className:"flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),"图片"]}),e.jsxs(p,{type:"button",size:"sm",variant:(t.desktop_media_type||"image")==="video"?"default":"outline",onClick:()=>l("desktop_media_type","video"),className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),"视频"]})]})]}),(t.desktop_media_type||"image")==="image"?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-4",children:[t.desktop_image_url&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t.desktop_image_url,alt:"Desktop",className:"w-32 h-20 object-cover rounded border"}),e.jsx(p,{type:"button",variant:"secondary",size:"icon",className:"absolute inset-0 w-full h-full opacity-0 group-hover:opacity-100 transition-opacity bg-black/50 rounded",onClick:()=>H(t.desktop_image_url,"desktop"),title:"编辑裁剪",children:e.jsx(X,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx(d,{type:"file",accept:"image/*",onChange:a=>U(a,"desktop"),className:"flex-1"}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{type:"file",accept:"image/*",onChange:a=>G(a,"desktop"),className:"absolute inset-0 opacity-0 cursor-pointer",id:"desktop-crop-input"}),e.jsx(p,{type:"button",variant:"outline",size:"icon",title:"裁剪上传新图片",children:e.jsx(X,{className:"w-4 h-4"})})]})]})]})}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[t.desktop_video_url&&e.jsx("video",{src:t.desktop_video_url,className:"w-32 h-20 object-cover rounded border",muted:!0}),e.jsx(d,{type:"file",accept:"video/mp4,video/webm",onChange:a=>oe(a,"desktop")})]}),t.desktop_image_url&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:"备用图片:"}),e.jsx("img",{src:t.desktop_image_url,alt:"Desktop poster",className:"w-16 h-10 object-cover rounded border"})]})]})]}),e.jsxs("div",{className:"space-y-3 p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{className:"text-base font-medium",children:"平板端"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{type:"button",size:"sm",variant:(t.tablet_media_type||"image")==="image"?"default":"outline",onClick:()=>l("tablet_media_type","image"),className:"flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),"图片"]}),e.jsxs(p,{type:"button",size:"sm",variant:(t.tablet_media_type||"image")==="video"?"default":"outline",onClick:()=>l("tablet_media_type","video"),className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),"视频"]})]})]}),(t.tablet_media_type||"image")==="image"?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-4",children:[t.tablet_image_url&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t.tablet_image_url,alt:"Tablet",className:"w-32 h-20 object-cover rounded border"}),e.jsx(p,{type:"button",variant:"secondary",size:"icon",className:"absolute inset-0 w-full h-full opacity-0 group-hover:opacity-100 transition-opacity bg-black/50 rounded",onClick:()=>H(t.tablet_image_url,"tablet"),title:"编辑裁剪",children:e.jsx(X,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx(d,{type:"file",accept:"image/*",onChange:a=>U(a,"tablet"),className:"flex-1"}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{type:"file",accept:"image/*",onChange:a=>G(a,"tablet"),className:"absolute inset-0 opacity-0 cursor-pointer",id:"tablet-crop-input"}),e.jsx(p,{type:"button",variant:"outline",size:"icon",title:"裁剪上传新图片",children:e.jsx(X,{className:"w-4 h-4"})})]})]})]})}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[t.tablet_video_url&&e.jsx("video",{src:t.tablet_video_url,className:"w-32 h-20 object-cover rounded border",muted:!0}),e.jsx(d,{type:"file",accept:"video/mp4,video/webm",onChange:a=>oe(a,"tablet")})]}),t.tablet_image_url&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:"备用图片:"}),e.jsx("img",{src:t.tablet_image_url,alt:"Tablet poster",className:"w-16 h-10 object-cover rounded border"})]})]})]}),e.jsxs("div",{className:"space-y-3 p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{className:"text-base font-medium",children:"移动端"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{type:"button",size:"sm",variant:(t.mobile_media_type||"image")==="image"?"default":"outline",onClick:()=>l("mobile_media_type","image"),className:"flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),"图片"]}),e.jsxs(p,{type:"button",size:"sm",variant:(t.mobile_media_type||"image")==="video"?"default":"outline",onClick:()=>l("mobile_media_type","video"),className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),"视频"]})]})]}),(t.mobile_media_type||"image")==="image"?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-4",children:[t.mobile_image_url&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t.mobile_image_url,alt:"Mobile",className:"w-32 h-20 object-cover rounded border"}),e.jsx(p,{type:"button",variant:"secondary",size:"icon",className:"absolute inset-0 w-full h-full opacity-0 group-hover:opacity-100 transition-opacity bg-black/50 rounded",onClick:()=>H(t.mobile_image_url,"mobile"),title:"编辑裁剪",children:e.jsx(X,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx(d,{type:"file",accept:"image/*",onChange:a=>U(a,"mobile"),className:"flex-1"}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{type:"file",accept:"image/*",onChange:a=>G(a,"mobile"),className:"absolute inset-0 opacity-0 cursor-pointer",id:"mobile-crop-input"}),e.jsx(p,{type:"button",variant:"outline",size:"icon",title:"裁剪上传新图片",children:e.jsx(X,{className:"w-4 h-4"})})]})]})]})}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[t.mobile_video_url&&e.jsx("video",{src:t.mobile_video_url,className:"w-32 h-20 object-cover rounded border",muted:!0}),e.jsx(d,{type:"file",accept:"video/mp4,video/webm",onChange:a=>oe(a,"mobile")})]}),t.mobile_image_url&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:"备用图片:"}),e.jsx("img",{src:t.mobile_image_url,alt:"Mobile poster",className:"w-16 h-10 object-cover rounded border"})]})]})]}),(t.desktop_video_url||t.tablet_video_url||t.mobile_video_url)&&e.jsx("div",{className:"pt-4 border-t",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-medium",children:"备用图片管理"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"上传视频时会自动截取第一帧作为备用图片"})]}),e.jsxs(aa,{children:[e.jsx(sa,{asChild:!0,children:e.jsxs(p,{type:"button",variant:"outline",size:"sm",disabled:K,children:[K?e.jsx(ne,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ta,{className:"w-4 h-4 mr-2"}),"重新生成第一帧",e.jsx(ia,{className:"w-4 h-4 ml-2"})]})}),e.jsxs(la,{align:"end",children:[e.jsx(le,{onClick:()=>ee(),children:"全部重新生成"}),e.jsx(ra,{}),e.jsx(le,{onClick:()=>ee("desktop"),disabled:!t.desktop_video_url,className:t.desktop_video_url?"":"opacity-50 cursor-not-allowed",children:"仅桌面端"}),e.jsx(le,{onClick:()=>ee("tablet"),disabled:!t.tablet_video_url,className:t.tablet_video_url?"":"opacity-50 cursor-not-allowed",children:"仅平板端"}),e.jsx(le,{onClick:()=>ee("mobile"),disabled:!t.mobile_video_url,className:t.mobile_video_url?"":"opacity-50 cursor-not-allowed",children:"仅移动端"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.duration")}),e.jsx(d,{type:"number",value:t.duration||5e3,onChange:a=>l("duration",parseInt(a.target.value)||5e3),min:1e3,max:3e4}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s("admin.homepageTemplates.durationHint")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.sortOrder")}),e.jsx(d,{type:"number",value:t.sort_order||0,onChange:a=>l("sort_order",parseInt(a.target.value)||0)})]})]})]}),e.jsx(re,{value:"overlay",className:"space-y-4 mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{children:[s("admin.homepageTemplates.baseOverlayOpacity"),": ",t.overlay_opacity||40,"%"]}),e.jsx(ve,{value:[t.overlay_opacity||40],onValueChange:([a])=>l("overlay_opacity",a),max:100,step:1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.gradientDirection")}),e.jsxs(na,{value:t.overlay_gradient_direction||"to-b",onValueChange:a=>l("overlay_gradient_direction",a),children:[e.jsx(oa,{children:e.jsx(ca,{})}),e.jsxs(da,{children:[e.jsx(ae,{value:"to-b",children:s("admin.homepageTemplates.gradientDirection.toBottom")}),e.jsx(ae,{value:"to-t",children:s("admin.homepageTemplates.gradientDirection.toTop")}),e.jsx(ae,{value:"to-r",children:s("admin.homepageTemplates.gradientDirection.toRight")}),e.jsx(ae,{value:"to-l",children:s("admin.homepageTemplates.gradientDirection.toLeft")}),e.jsx(ae,{value:"to-br",children:s("admin.homepageTemplates.gradientDirection.toBottomRight")}),e.jsx(ae,{value:"to-tr",children:s("admin.homepageTemplates.gradientDirection.toTopRight")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.startOpacity")}),e.jsx(d,{type:"number",min:"0",max:"100",value:t.overlay_gradient_from_opacity||30,onChange:a=>l("overlay_gradient_from_opacity",parseInt(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.middleOpacity")}),e.jsx(d,{type:"number",min:"0",max:"100",value:t.overlay_gradient_via_opacity||25,onChange:a=>l("overlay_gradient_via_opacity",parseInt(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.endOpacity")}),e.jsx(d,{type:"number",min:"0",max:"100",value:t.overlay_gradient_to_opacity||40,onChange:a=>l("overlay_gradient_to_opacity",parseInt(a.target.value)||0)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{children:[s("admin.homepageTemplates.backgroundBlur"),": ",t.background_blur||0,"px"]}),e.jsx(ve,{value:[t.background_blur||0],onValueChange:([a])=>l("background_blur",a),max:50,step:1})]})]})}),e.jsx(re,{value:"content",className:"space-y-4 mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.titleChinese")}),e.jsx(d,{value:t.title_zh||"",onChange:a=>l("title_zh",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.titleEnglish")}),e.jsx(d,{value:t.title_en||"",onChange:a=>l("title_en",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.titlePortuguese")}),e.jsx(d,{value:t.title_pt||"",onChange:a=>l("title_pt",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.descriptionChinese")}),e.jsx(me,{value:t.description_zh||"",onChange:a=>l("description_zh",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.descriptionEnglish")}),e.jsx(me,{value:t.description_en||"",onChange:a=>l("description_en",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.descriptionPortuguese")}),e.jsx(me,{value:t.description_pt||"",onChange:a=>l("description_pt",a.target.value)})]})]})}),e.jsxs(re,{value:"buttons",className:"space-y-4 mt-4",children:[e.jsxs(te,{children:[e.jsx(pe,{className:"py-3",children:e.jsx(ue,{className:"text-lg",children:s("admin.homepageTemplates.primaryButton")})}),e.jsxs(ie,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.chinese")}),e.jsx(d,{value:t.primary_button_text_zh||"",onChange:a=>l("primary_button_text_zh",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.english")}),e.jsx(d,{value:t.primary_button_text_en||"",onChange:a=>l("primary_button_text_en",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.portuguese")}),e.jsx(d,{value:t.primary_button_text_pt||"",onChange:a=>l("primary_button_text_pt",a.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.link")}),e.jsx(d,{value:t.primary_button_link||"",onChange:a=>l("primary_button_link",a.target.value)})]})]})]}),e.jsxs(te,{children:[e.jsx(pe,{className:"py-3",children:e.jsx(ue,{className:"text-lg",children:s("admin.homepageTemplates.secondaryButton")})}),e.jsxs(ie,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.chinese")}),e.jsx(d,{value:t.secondary_button_text_zh||"",onChange:a=>l("secondary_button_text_zh",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.english")}),e.jsx(d,{value:t.secondary_button_text_en||"",onChange:a=>l("secondary_button_text_en",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.portuguese")}),e.jsx(d,{value:t.secondary_button_text_pt||"",onChange:a=>l("secondary_button_text_pt",a.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.link")}),e.jsx(d,{value:t.secondary_button_link||"",onChange:a=>l("secondary_button_link",a.target.value)})]})]})]}),e.jsxs(te,{children:[e.jsx(pe,{className:"py-3",children:e.jsx(ue,{className:"text-lg",children:s("admin.homepageTemplates.mapButton")})}),e.jsxs(ie,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.chinese")}),e.jsx(d,{value:t.map_button_text_zh||"",onChange:a=>l("map_button_text_zh",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.english")}),e.jsx(d,{value:t.map_button_text_en||"",onChange:a=>l("map_button_text_en",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.portuguese")}),e.jsx(d,{value:t.map_button_text_pt||"",onChange:a=>l("map_button_text_pt",a.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:s("admin.homepageTemplates.link")}),e.jsx(d,{value:t.map_button_link||"",onChange:a=>l("map_button_link",a.target.value),placeholder:"/map"})]})]})]})]})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:s("admin.homepageTemplates")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:s("admin.homepageTemplatesDescription")})]}),e.jsxs(p,{onClick:o,children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),s("admin.homepageTemplates.createTemplate")]})]}),e.jsxs("div",{className:"grid gap-4",children:[w?.map(a=>e.jsx(te,{className:a.is_active?"":"opacity-60",children:e.jsx(ie,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Oe,{className:"w-5 h-5"}),e.jsxs("span",{className:"text-sm font-medium",children:["#",a.sort_order]})]}),a.desktop_image_url&&e.jsx("img",{src:a.desktop_image_url,alt:"Preview",className:"w-24 h-16 object-cover rounded border"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold truncate",children:a.title_zh}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:a.description_zh}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Be,{className:"w-3 h-3 text-muted-foreground"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[a.duration/1e3,s("admin.homepageTemplates.seconds")]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>S(a),title:s("admin.homepageTemplates.preview")||"预览",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>Q(a),title:a.is_active?s("admin.homepageTemplates.hide"):s("admin.homepageTemplates.show"),children:a.is_active?e.jsx(Pe,{className:"w-4 h-4"}):e.jsx(Me,{className:"w-4 h-4"})}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>v(a),children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsxs(He,{children:[e.jsx(Ve,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",children:e.jsx(We,{className:"w-4 h-4"})})}),e.jsxs(Ye,{children:[e.jsxs(qe,{children:[e.jsx(Ge,{children:s("admin.confirmDelete")}),e.jsx(Xe,{children:s("admin.homepageTemplates.deleteTemplateConfirm")})]}),e.jsxs(Ze,{children:[e.jsx(Je,{children:s("common.cancel")}),e.jsx(Qe,{onClick:()=>q(a.id),children:s("common.delete")})]})]})]})]})]})})},a.id)),(!w||w.length===0)&&e.jsx(te,{children:e.jsx(ie,{className:"p-8 text-center text-muted-foreground",children:s("admin.homepageTemplates.noTemplates")})})]}),e.jsx(be,{open:!!T||O,onOpenChange:xe,children:e.jsxs(ye,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(fe,{children:[e.jsx(Ne,{children:s(T?"admin.homepageTemplates.editTemplate":"admin.homepageTemplates.createTemplate")}),e.jsx(we,{children:s("admin.homepageTemplates.configureTemplate")})]}),Ie(),e.jsxs("div",{className:"flex justify-between gap-2 mt-4",children:[e.jsxs(p,{variant:"outline",onClick:()=>S(t),disabled:!t.desktop_image_url&&!t.mobile_image_url,children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"预览"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:"outline",onClick:xe,children:s("common.cancel")}),e.jsxs(p,{onClick:j,disabled:I.isPending||C.isPending,children:[(I.isPending||C.isPending)&&e.jsx(ne,{className:"w-4 h-4 mr-2 animate-spin"}),e.jsx(Ke,{className:"w-4 h-4 mr-2"}),s("common.save")]})]})]})]})}),B&&e.jsxs("div",{className:"fixed inset-0 z-50 bg-black",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-50 text-white hover:bg-white/20",onClick:()=>S(null),children:e.jsx(ea,{className:"w-6 h-6"})}),e.jsx(Ca,{template:B,onClose:()=>S(null)})]}),W&&e.jsx(Na,{open:P,onOpenChange:a=>{h(a),a||M(null)},imageSource:W,deviceType:Y,onCropComplete:D})]})};export{Oa as default};
//# sourceMappingURL=AdminHomepageTemplates-DpLyr2kX.js.map
