const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CYYXDY6E.js","assets/index-D4G5innR.css"])))=>i.map(i=>d[i]);
import{c as $e,u as je,j as e,D as Oe,b as Te,d as Le,e as Ue,v as D,p as G,x as ke,s as P,a as It,F as Ys,r as j,ap as Ws,aq as Dt,aa as Xs,B as O,a6 as ys,a3 as Ns,a4 as ws,a5 as Cs,I as F,a7 as R,ag as qe,ah as Ve,ai as Ke,aj as Ge,ak as Ye,ar as Ft,as as Zs,R as oe,T as ce,U as de,V as me,W as he,Y as ue,Z as xe,$ as ae,G as _,_ as Ot,o as Ze,ac as Je,af as es,ad as Js,C as Q,l as re,w as ne,M as Me,m as q,ao as fe,a9 as Tt,P as Lt,at as Ut,ae as L,a1 as $t,h as pe,f as K,i as ge,au as et,av as Ts,aw as De}from"./index-CYYXDY6E.js";import{H as Fe}from"./heart-CRQBZyOQ.js";import{T as js,a as vs,b as se,c as te}from"./tabs-Bwn2-9Zo.js";import{C as zt,a as Bt,b as He}from"./carousel-BHUNrVI-.js";import{a as Ht}from"./useActivities-CdnwJfkp.js";import{u as ss}from"./useLocalizedContent-WZaNX232.js";import{u as Qt}from"./useActivityParticipation-DGG0NoP3.js";import{d as qt}from"./useCoupons-DZz9hHn8.js";import{S as Vt}from"./settings-C6Fycb4P.js";import{U as Kt}from"./upload-CecOgptZ.js";import{L as Gt}from"./lock-mhw4_HOY.js";import{C as Yt}from"./checkbox-CJeGfzBK.js";import{P as Ls}from"./plus-BtcrmSta.js";import{S as bs}from"./star-Cte2zIpP.js";import{S as Wt}from"./square-pen-Dhf4HUG4.js";import{B as Xt}from"./briefcase-COHrv2UH.js";import{B as Zt}from"./building-B5eb58zk.js";import{A as Us}from"./ActivityTermsAgreement-kM8lq4Ei.js";import{S as $s}from"./separator-TCKHLJL8.js";import{T as We}from"./ticket-DftzwVuP.js";import{C as st}from"./clock-DuREBjzO.js";import{f as Ne}from"./format-CnjInHVf.js";import{U as tt}from"./users-Dk6b5Gw1.js";import{u as Jt}from"./use-mobile-Db8IJyLa.js";import"./arrow-left-CJUGwKly.js";import"./arrow-right-rNygiE5A.js";import"./useActivityRules-CkNFUHCn.js";import"./file-text-K51ZCHdP.js";import"./circle-alert-2pQWmidS.js";import"./startOfDay-BxPv1STR.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=$e("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=$e("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=$e("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=$e("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=$e("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);function aa({open:s,onOpenChange:t,activity:i}){const{t:n}=je();return e.jsx(Oe,{open:s,onOpenChange:t,children:e.jsxs(Te,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsx(Le,{children:e.jsx(Ue,{className:"text-lg font-semibold line-clamp-2",children:i.title})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(D,{variant:"secondary",className:"flex items-center gap-1.5 w-fit",children:[e.jsx(Fe,{className:"w-3.5 h-3.5 fill-primary text-primary"}),n("profile.activityFavorited")]}),i.image_url&&e.jsx("div",{className:"w-full aspect-video rounded-lg overflow-hidden bg-secondary/30",children:e.jsx("img",{src:i.image_url,alt:i.title,className:"w-full h-full object-cover"})}),e.jsx("div",{className:`text-muted-foreground text-sm prose prose-sm max-w-none line-clamp-4\r
              [&_span[style*='color']]:!text-inherit`,dangerouslySetInnerHTML:{__html:i.content}})]})]})})}const ra=()=>{const{user:s}=G();return ke({queryKey:["favorites",s==null?void 0:s.id],queryFn:async()=>{if(!s)return[];const{data:t,error:i}=await P.from("favorites").select("restaurant_id").eq("user_id",s.id);if(i)throw i;if(!t||t.length===0)return[];const n=t.map(x=>x.restaurant_id),{data:u,error:o}=await P.from("restaurants").select("*").in("id",n);if(o)throw o;return u||[]},enabled:!!s})},na=()=>{const{user:s}=G();return ke({queryKey:["user-comments",s==null?void 0:s.id],queryFn:async()=>{if(!s)return[];const{data:t,error:i}=await P.from("comments").select("*").eq("user_id",s.id).is("parent_id",null).order("created_at",{ascending:!1});if(i)throw i;if(!t||t.length===0)return[];const n=t.filter(c=>c.target_type==="restaurant").map(c=>c.target_id),u=t.filter(c=>c.target_type==="activity").map(c=>c.target_id),o=new Map;if(n.length>0){const{data:c}=await P.from("restaurants").select("id, name, name_en, name_pt").in("id",n);c==null||c.forEach(r=>{o.set(r.id,{name:r.name,name_en:r.name_en||void 0,name_pt:r.name_pt||void 0})})}const x=new Map;if(u.length>0){const{data:c}=await P.from("activities").select("id, title_zh, title_en, title_pt").in("id",u);c==null||c.forEach(r=>{x.set(r.id,{title_zh:r.title_zh,title_en:r.title_en,title_pt:r.title_pt})})}return t.map(c=>{if(c.target_type==="restaurant"){const r=o.get(c.target_id);return{...c,target_name:(r==null?void 0:r.name)||"Unknown Restaurant",target_name_en:r==null?void 0:r.name_en,target_name_pt:r==null?void 0:r.name_pt}}else if(c.target_type==="activity"){const r=x.get(c.target_id);return{...c,target_name:(r==null?void 0:r.title_zh)||"Unknown Activity",target_name_en:r==null?void 0:r.title_en,target_name_pt:r==null?void 0:r.title_pt}}return c})},enabled:!!s,staleTime:3e4})},la=()=>{const{user:s}=G(),{data:t=[]}=Qt();return ke({queryKey:["merchantActivities",s==null?void 0:s.id],queryFn:async()=>{if(!s||t.length===0)return[];const i=t.map(a=>a.id),{data:n,error:u}=await P.from("activity_restaurants").select("*").in("restaurant_id",i).order("created_at",{ascending:!1});if(u)throw u;if(!n||n.length===0)return[];const{data:o}=await P.from("restaurants").select("id, name, name_en, name_pt, address").in("id",i),x=[...new Set(n.map(a=>a.activity_id))],{data:c}=await P.from("activities").select("*").in("id",x).eq("status","published");return n.map(a=>{const l=o==null?void 0:o.find(m=>m.id===a.restaurant_id),d=c==null?void 0:c.find(m=>m.id===a.activity_id);return{activity_id:a.activity_id,restaurant_id:a.restaurant_id,restaurant_name:(l==null?void 0:l.name)||"",restaurant_name_en:(l==null?void 0:l.name_en)||null,restaurant_name_pt:(l==null?void 0:l.name_pt)||null,restaurant_address:(l==null?void 0:l.address)||"",activity:d||null,created_at:a.created_at}}).filter(a=>a.activity!==null)},enabled:!!s&&t.length>0})},at=[{code:"+351",country:"Portugal",flag:"ðŸ‡µðŸ‡¹"},{code:"+34",country:"Spain",flag:"ðŸ‡ªðŸ‡¸"},{code:"+33",country:"France",flag:"ðŸ‡«ðŸ‡·"},{code:"+49",country:"Germany",flag:"ðŸ‡©ðŸ‡ª"},{code:"+39",country:"Italy",flag:"ðŸ‡®ðŸ‡¹"},{code:"+44",country:"UK",flag:"ðŸ‡¬ðŸ‡§"},{code:"+31",country:"Netherlands",flag:"ðŸ‡³ðŸ‡±"},{code:"+32",country:"Belgium",flag:"ðŸ‡§ðŸ‡ª"},{code:"+86",country:"China",flag:"ðŸ‡¨ðŸ‡³"},{code:"+1",country:"USA/Canada",flag:"ðŸ‡ºðŸ‡¸"},{code:"+55",country:"Brazil",flag:"ðŸ‡§ðŸ‡·"}],Bs=s=>{if(!s)return{code:"+351",number:""};for(const t of at)if(s.startsWith(t.code))return{code:t.code,number:s.slice(t.code.length).trim()};return{code:"+351",number:s}},Hs=({profile:s})=>{const{t}=je(),i=It(),{user:n}=G(),{isAdmin:u}=Ys(),[o,x]=j.useState(!1),[c,r]=j.useState(s.display_name),a=Bs(s.phone),[l,d]=j.useState(a.code),[m,p]=j.useState(a.number),[f,y]=j.useState(!1),[v,T]=j.useState(null),[E,N]=j.useState(s.avatar_url||""),[S,I]=j.useState(!1),[$,W]=j.useState(!1),[z,M]=j.useState(""),[le,U]=j.useState(!1),ve=j.useRef(!1);j.useEffect(()=>{const h=ve.current;if(ve.current=o,o&&!h){r(s.display_name);const w=Bs(s.phone);d(w.code),p(w.number),N(s.avatar_url||""),T(null),y(!1)}},[o,s.display_name,s.phone,s.avatar_url]);const[we,B]=j.useState(!1),[V,X]=j.useState(!1),[Z,J]=j.useState(!1),[g,b]=j.useState(""),[A,H]=j.useState(""),[ye,Ee]=j.useState(""),[Se,ze]=j.useState(!1),[Ce,Be]=j.useState(!1),[Is,ts]=j.useState(!1),[pt,Re]=j.useState(!1),[gt,Ie]=j.useState(!1),[as,rs]=j.useState(""),[ie,ns]=j.useState(""),[be,ls]=j.useState(""),[Ds,is]=j.useState(!1),[os,cs]=j.useState(""),[Ae,ds]=j.useState(!1),[Fs,Os]=j.useState(!1),[ee,ms]=j.useState(null),hs=j.useRef(null),us=j.useRef(null),xs=j.useRef(null),fs=Ws(),ps=Dt();j.useEffect(()=>{Se&&hs.current&&hs.current.focus()},[Se]),j.useEffect(()=>{Ce&&us.current&&us.current.focus()},[Ce]),j.useEffect(()=>{Ae&&xs.current&&xs.current.focus()},[Ae]);const jt=h=>{var Y;const w=(Y=h.target.files)==null?void 0:Y[0];if(w){if(w.size>2*1024*1024)return;T(w),N(URL.createObjectURL(w))}},vt=async()=>{let h=s.avatar_url;if(v){const Y=await ps.mutateAsync(v);Y&&(h=Y)}const w=m?`${l} ${m}`:void 0;await fs.mutateAsync({display_name:c,phone:w,avatar_url:h||void 0}),y(!1),x(!1)},yt=async()=>{if(!(!n||z.toLowerCase()!=="delete")){U(!0);try{const{error:h}=await P.functions.invoke("delete-account",{body:{userId:n.id}});if(h){_.error(t("profile.deleteAccountFailed")),console.error(h),U(!1);return}_.success(t("profile.deleteAccountSuccess")),W(!1),I(!1),M(""),await new Promise(w=>setTimeout(w,1500)),await P.auth.signOut(),i("/auth")}catch(h){_.error(h.message||t("profile.deleteAccountFailed")),U(!1)}finally{U(!1)}}},Nt=async()=>{if(n!=null&&n.email)try{const{error:h}=await P.functions.invoke("send-verification-code",{body:{email:n.email}});if(h)throw h;ze(!0),_.success(t("profile.codeSentToOldEmail"))}catch(h){_.error(t("profile.sendCodeFailed")),console.error(h)}},wt=async()=>{if(!A){_.error(t("profile.enterCodePlaceholder"));return}try{const{data:h,error:w}=await P.functions.invoke("verify-email-code",{body:{email:n==null?void 0:n.email,code:A}});if(w||!(h!=null&&h.success)){_.error(t("profile.codeIncorrect"));return}_.success(t("profile.oldEmailVerified")),B(!1),X(!0)}catch(h){_.error(t("profile.verificationFailed")),console.error(h)}},Ct=async()=>{if(!g||!g.includes("@")){_.error(t("profile.enterValidEmail"));return}try{const{error:h}=await P.functions.invoke("send-verification-code",{body:{email:g}});if(h)throw h;_.success(t("profile.codeSentToNewEmail")),Be(!0)}catch(h){_.error(t("profile.sendCodeFailed")),console.error(h)}},bt=async()=>{if(!ye){_.error(t("profile.enterCodePlaceholder"));return}try{const{data:h,error:w}=await P.functions.invoke("verify-email-code",{body:{email:g,code:ye}});if(w||!(h!=null&&h.success)){_.error(t("profile.codeIncorrect"));return}_.success(t("profile.newEmailVerified")),X(!1),setTimeout(()=>{J(!0)},100)}catch(h){_.error(t("toast.verificationFailed")),console.error(h)}},_t=async()=>{ts(!0);try{const{data:{session:h}}=await P.auth.getSession();if(!h||!n){_.error(t("toast.pleaseSignIn")),ts(!1);return}const{data:w,error:Y}=await P.functions.invoke("update-email",{body:{userId:n.id,oldEmail:n.email,oldEmailCode:A,newEmail:g,newEmailCode:ye},headers:{Authorization:`Bearer ${h.access_token}`}});if(Y||!(w!=null&&w.success))throw new Error((w==null?void 0:w.error)||"Failed to update email");_.success(t("toast.emailUpdatedSuccess")),J(!1),x(!1),H(""),b(""),Ee(""),ze(!1),Be(!1),await new Promise(gs=>setTimeout(gs,1500)),await P.auth.signOut(),i("/auth")}catch(h){_.error(h.message||t("toast.emailUpdateError")),console.error(h)}finally{ts(!1)}},Et=h=>{let w=0;return h.length>=6&&w++,h.length>=8&&w++,/[a-z]/.test(h)&&w++,/[A-Z]/.test(h)&&w++,/[0-9]/.test(h)&&w++,/[^a-zA-Z0-9]/.test(h)&&w++,w<=2?"weak":w<=4?"medium":"strong"},St=async h=>{if(h==null||h.preventDefault(),h==null||h.stopPropagation(),!as){_.error(t("profile.enterCurrentPassword"));return}try{const{createClient:w}=await Ot(async()=>{const{createClient:kt}=await import("./index-CYYXDY6E.js").then(Rt=>Rt.bx);return{createClient:kt}},__vite__mapDeps([0,1])),Y=w("https://tzdgqhwyzsxkxnncgzap.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",{auth:{persistSession:!1,autoRefreshToken:!1}}),{error:gs}=await Y.auth.signInWithPassword({email:(n==null?void 0:n.email)||"",password:as});if(gs){_.error(t("profile.oldPasswordIncorrect"));return}_.success(t("profile.oldPasswordVerified")),Re(!1),Ie(!0)}catch(w){_.error(t("profile.verificationFailed")),console.error(w)}},At=async()=>{if(n!=null&&n.email)try{const{error:h}=await P.functions.invoke("send-verification-code",{body:{email:n.email}});if(h)throw h;ds(!0),_.success(t("profile.codeSentToOldEmail"))}catch(h){_.error(t("profile.sendCodeFailed")),console.error(h)}},Pt=async h=>{if(h==null||h.preventDefault(),h==null||h.stopPropagation(),!os){_.error(t("profile.enterCodePlaceholder"));return}try{const{data:w,error:Y}=await P.functions.invoke("verify-email-code",{body:{email:n==null?void 0:n.email,code:os}});if(Y||!(w!=null&&w.success)){_.error(t("profile.codeIncorrect"));return}_.success(t("profile.oldEmailVerified")),Re(!1),Ie(!0)}catch(w){_.error(t("profile.verificationFailed")),console.error(w)}},Mt=async h=>{if(h==null||h.preventDefault(),h==null||h.stopPropagation(),!ie||!be){_.error(t("profile.enterNewPassword"));return}if(ie.length<6){_.error(t("profile.passwordTooShort"));return}if(ie!==be){_.error(t("profile.passwordsDontMatch"));return}Os(!0);try{const{error:w}=await P.auth.updateUser({password:ie});if(w)throw w;_.success(t("profile.passwordUpdated")),Ie(!1),x(!1),rs(""),ns(""),ls(""),is(!1),cs(""),ds(!1)}catch(w){_.error(w.message||t("profile.passwordUpdateFailed")),console.error(w)}finally{Os(!1)}};return e.jsxs(Oe,{open:o,onOpenChange:x,children:[e.jsx(Xs,{asChild:!0,children:e.jsxs(O,{variant:"outline",children:[e.jsx(Vt,{className:"w-4 h-4 mr-2"}),t("profile.editProfile")]})}),e.jsxs(Te,{className:"max-w-[90vw] sm:max-w-[425px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Le,{children:[e.jsx(Ue,{children:t("profile.editProfile")}),e.jsx(ys,{children:t("profile.editProfileDescription")})]}),e.jsxs("div",{className:"space-y-3 py-3",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs(Ns,{className:"w-16 h-16 sm:w-24 sm:h-24",children:[e.jsx(ws,{src:E}),e.jsx(Cs,{children:c==null?void 0:c.charAt(0).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx(F,{type:"file",accept:"image/*",onChange:jt,className:"hidden",id:"avatar-upload"}),e.jsxs(O,{variant:"outline",size:"sm",onClick:()=>{var h;return(h=document.getElementById("avatar-upload"))==null?void 0:h.click()},className:"text-xs sm:text-sm",children:[e.jsx(Kt,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),t("profile.uploadAvatar")]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(R,{htmlFor:"displayName",className:"text-sm",children:t("profile.displayName")}),e.jsx(F,{id:"displayName",value:c,onChange:h=>r(h.target.value),placeholder:t("profile.displayName"),className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(R,{htmlFor:"phone",className:"text-sm",children:t("profile.phone")}),!s.phone&&!f?e.jsx(O,{variant:"outline",size:"sm",onClick:()=>y(!0),className:"w-full justify-start h-9",children:t("profile.addPhoneNumber")}):f||!s.phone?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(qe,{value:l,onValueChange:d,children:[e.jsx(Ve,{className:"w-[110px] h-9",children:e.jsx(Ke,{placeholder:"+351"})}),e.jsx(Ge,{children:at.map(h=>e.jsx(Ye,{value:h.code,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:h.flag}),e.jsx("span",{children:h.code})]})},h.code))})]}),e.jsx(F,{id:"phone",className:"flex-1 h-9",value:m,onChange:h=>p(h.target.value),placeholder:t("profile.phonePlaceholder")})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{value:`${l} ${m}`,disabled:!0,className:"h-9 flex-1"}),e.jsx(O,{variant:"outline",size:"sm",onClick:()=>y(!0),className:"text-xs whitespace-nowrap",children:t("profile.modifyPhoneNumber")})]})]}),!u&&e.jsxs("div",{className:"space-y-1.5 pt-2 border-t",children:[e.jsx(R,{className:"text-sm",children:t("profile.email")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{value:(n==null?void 0:n.email)||"",disabled:!0,className:"h-9 flex-1"}),e.jsxs(O,{variant:"outline",size:"sm",onClick:()=>B(!0),className:"text-xs",children:[e.jsx(Ft,{className:"w-3 h-3 mr-1"}),t("profile.modify")]})]})]}),e.jsxs("div",{className:`space-y-1.5 ${u?"pt-2 border-t":""}`,children:[e.jsx(R,{className:"text-sm",children:t("profile.changePassword")}),e.jsxs(O,{variant:"outline",size:"sm",onClick:()=>Re(!0),className:"w-full justify-start h-9",children:[e.jsx(Gt,{className:"w-3 h-3 mr-2"}),t("profile.changePassword")]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 pt-2 border-t",children:[!u&&e.jsxs(O,{variant:"destructive",size:"sm",onClick:()=>I(!0),className:"w-full sm:w-auto text-xs sm:text-sm",children:[e.jsx(Zs,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),t("profile.deleteAccount")]}),e.jsxs("div",{className:`flex gap-2 w-full sm:w-auto ${u?"sm:ml-auto":""}`,children:[e.jsx(O,{variant:"outline",size:"sm",onClick:()=>{y(!1),x(!1)},className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:t("common.cancel")}),e.jsx(O,{size:"sm",onClick:vt,disabled:fs.isPending||ps.isPending,className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:fs.isPending||ps.isPending?t("common.loading"):t("common.save")})]})]})]}),e.jsx(oe,{open:S,onOpenChange:I,children:e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(me,{children:t("profile.deleteAccountWarning")}),e.jsx(he,{children:t("profile.deleteAccountDescription")})]}),e.jsxs(ue,{children:[e.jsx(xe,{children:t("common.cancel")}),e.jsx(ae,{onClick:()=>{I(!1),W(!0)},className:"bg-destructive hover:bg-destructive/90",children:t("common.continue")})]})]})}),e.jsx(oe,{open:$,onOpenChange:W,children:e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(me,{children:t("profile.confirmDeleteAccount")}),e.jsxs(he,{className:"space-y-4",children:[e.jsx("p",{children:t("profile.confirmDeleteDescription")}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"confirm-delete",children:t("profile.typeDeleteToConfirm")}),e.jsx(F,{id:"confirm-delete",value:z,onChange:h=>M(h.target.value),placeholder:"DELETE",className:"uppercase"})]})]})]}),e.jsxs(ue,{children:[e.jsx(xe,{onClick:()=>M(""),children:t("common.cancel")}),e.jsx(ae,{onClick:yt,disabled:z.toLowerCase()!=="delete"||le,className:"bg-destructive hover:bg-destructive/90",children:t(le?"common.loading":"profile.deleteAccount")})]})]})}),e.jsx(oe,{open:we,onOpenChange:B,children:e.jsxs(ce,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(de,{children:[e.jsx(me,{children:t("profile.verifyOldEmail")}),e.jsx(he,{children:t("profile.oldEmailStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:t("profile.currentEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{value:(n==null?void 0:n.email)||"",disabled:!0,className:"flex-1"}),e.jsx(O,{variant:"outline",size:"sm",onClick:Nt,disabled:Se,children:t(Se?"profile.codeSent":"profile.sendCode")})]})]}),Se&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:t("profile.verificationCode")}),e.jsx(F,{ref:hs,value:A,onChange:h=>H(h.target.value),placeholder:t("profile.enterCode"),maxLength:4})]})]}),e.jsxs(ue,{children:[e.jsx(xe,{onClick:()=>{B(!1),setTimeout(()=>{H(""),ze(!1)},300)},children:t("common.cancel")}),Se&&e.jsx(ae,{onClick:wt,children:t("profile.verify")})]})]})}),e.jsx(oe,{open:V,onOpenChange:X,children:e.jsxs(ce,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(de,{className:"text-center space-y-3",children:[e.jsx(me,{className:"text-xl",children:t("profile.verifyNewEmail")}),e.jsx(he,{className:"text-center",children:t("profile.newEmailStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{className:"text-sm font-normal",children:t("profile.newEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{type:"email",value:g,onChange:h=>b(h.target.value),placeholder:t("profile.enterNewEmail"),disabled:Ce,className:"border-2 focus:border-primary flex-1"}),e.jsx(O,{variant:"outline",size:"sm",onClick:Ct,disabled:!g||Ce,className:"text-xs whitespace-nowrap px-3",children:t(Ce?"profile.codeSent":"profile.sendCode")})]})]}),Ce&&e.jsxs("div",{className:"space-y-2 animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsx(R,{className:"text-sm font-normal",children:t("profile.verificationCode")}),e.jsx(F,{ref:us,value:ye,onChange:h=>Ee(h.target.value),placeholder:t("profile.enterCode"),maxLength:4,className:"border-2 focus:border-primary"})]})]}),e.jsxs(ue,{className:"flex-col sm:flex-col gap-2",children:[Ce&&e.jsx(ae,{onClick:bt,disabled:!ye||ye.length!==4,className:"w-full bg-primary hover:bg-primary/90",children:"ç¡®è®¤éªŒè¯ç "}),e.jsx(xe,{onClick:()=>{X(!1),setTimeout(()=>{b(""),Ee(""),Be(!1)},300)},className:"w-full mt-0",children:"å–æ¶ˆ"})]})]})}),e.jsx(oe,{open:Z,onOpenChange:J,children:e.jsxs(ce,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(de,{children:[e.jsx(me,{children:"ç¡®è®¤ä¿®æ”¹é‚®ç®±"}),e.jsx(he,{children:"æ­¥éª¤ 3/3: æ‰€æœ‰éªŒè¯å·²å®Œæˆ"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"rounded-lg bg-green-50 dark:bg-green-950 p-4 text-sm",children:[e.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:"éªŒè¯å®Œæˆï¼"}),e.jsx("p",{className:"text-green-700 dark:text-green-300 mt-1",children:'æ—§é‚®ç®±å’Œæ–°é‚®ç®±éƒ½å·²éªŒè¯æˆåŠŸï¼Œç‚¹å‡»"ç¡®è®¤ä¿®æ”¹"å®Œæˆé‚®ç®±æ›´æ–°ã€‚'})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"å½“å‰é‚®ç®±:"}),e.jsx("span",{className:"font-medium",children:n==null?void 0:n.email})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"æ–°é‚®ç®±:"}),e.jsx("span",{className:"font-medium",children:g})]})]})]}),e.jsxs(ue,{children:[e.jsx(xe,{onClick:()=>{J(!1),setTimeout(()=>{H(""),b(""),Ee(""),ze(!1),Be(!1)},300)},children:"å–æ¶ˆ"}),e.jsx(ae,{onClick:_t,disabled:Is,children:Is?"æ›´æ–°ä¸­...":"ç¡®è®¤ä¿®æ”¹"})]})]})}),e.jsx(oe,{open:pt,onOpenChange:Re,children:e.jsxs(ce,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(de,{children:[e.jsx(me,{children:t("profile.verifyOldPassword")}),e.jsx(he,{children:t("profile.oldPasswordStep")})]}),e.jsx("div",{className:"space-y-4 py-4",children:Ds?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:t("profile.currentEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{value:(n==null?void 0:n.email)||"",disabled:!0,className:"flex-1"}),e.jsx(O,{variant:"outline",size:"sm",onClick:At,disabled:Ae,children:t(Ae?"profile.codeSent":"profile.sendCode")})]})]}),Ae&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:t("profile.verificationCode")}),e.jsx(F,{ref:xs,value:os,onChange:h=>cs(h.target.value),placeholder:t("profile.enterCode"),maxLength:4})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:t("profile.currentPassword")}),e.jsx(F,{type:"password",value:as,onChange:h=>rs(h.target.value),placeholder:t("profile.enterCurrentPassword")})]}),e.jsxs(O,{variant:"link",size:"sm",onClick:()=>is(!0),className:"text-xs p-0 h-auto",children:[t("profile.forgotPassword")," ",t("profile.useEmailVerification")]})]})}),e.jsxs(ue,{children:[e.jsx(xe,{onClick:()=>{Re(!1),setTimeout(()=>{rs(""),is(!1),cs(""),ds(!1)},300)},children:t("common.cancel")}),Ds?Ae&&e.jsx(ae,{onClick:Pt,children:t("profile.verify")}):e.jsx(ae,{onClick:St,children:t("profile.verify")})]})]})}),e.jsx(oe,{open:gt,onOpenChange:Ie,children:e.jsxs(ce,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(de,{children:[e.jsx(me,{children:t("profile.setNewPassword")}),e.jsx(he,{children:t("profile.newPasswordStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:t("profile.newPassword")}),e.jsx(F,{type:"password",value:ie,onChange:h=>{ns(h.target.value),h.target.value?ms(Et(h.target.value)):ms(null)},placeholder:t("profile.enterNewPassword")}),ee&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${ee==="weak"?"bg-destructive":ee==="medium"?"bg-warning":"bg-success"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${ee==="medium"||ee==="strong"?ee==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${ee==="strong"?"bg-success":"bg-muted"}`})]}),e.jsx("p",{className:`text-xs ${ee==="weak"?"text-destructive":ee==="medium"?"text-warning":"text-success"}`,children:t(`auth.passwordStrength.${ee}`)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:t("profile.confirmNewPassword")}),e.jsx(F,{type:"password",value:be,onChange:h=>ls(h.target.value),placeholder:t("profile.confirmNewPasswordPlaceholder")})]}),ie&&be&&ie!==be&&e.jsx("p",{className:"text-sm text-destructive",children:t("profile.passwordsDontMatch")})]}),e.jsxs(ue,{children:[e.jsx(xe,{onClick:()=>{Ie(!1),setTimeout(()=>{ns(""),ls(""),ms(null)},300)},children:t("common.cancel")}),e.jsx(ae,{onClick:Mt,disabled:!ie||!be||ie!==be||Fs,children:t(Fs?"common.loading":"profile.updatePassword")})]})]})})]})},ia=()=>{const{user:s}=G();return ke({queryKey:["user-addresses",s==null?void 0:s.id],queryFn:async()=>{if(!s)return[];const{data:t,error:i}=await P.from("user_addresses").select("*").eq("user_id",s.id).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(i)throw i;return t},enabled:!!s})},oa=()=>{const{user:s}=G(),{toast:t}=Ze(),i=Je();return es({mutationFn:async n=>{if(!s)throw new Error("User not authenticated");const{data:u,error:o}=await P.from("user_addresses").insert({user_id:s.id,label:n.label,street:n.street,district:n.district||null,city:n.city,postal_code:n.postal_code||null,country:n.country,phone:n.phone||null,phone_code:n.phone_code||"+351",is_default:n.is_default||!1}).select().single();if(o)throw o;return u},onSuccess:()=>{i.invalidateQueries({queryKey:["user-addresses"]}),t({title:"Success",description:"Address added successfully"})},onError:()=>{t({title:"Error",description:"Failed to add address",variant:"destructive"})}})},ca=()=>{const{user:s}=G(),{toast:t}=Ze(),i=Je();return es({mutationFn:async({id:n,address:u})=>{if(!s)throw new Error("User not authenticated");const{data:o,error:x}=await P.from("user_addresses").update({label:u.label,street:u.street,district:u.district||null,city:u.city,postal_code:u.postal_code||null,country:u.country,phone:u.phone||null,phone_code:u.phone_code||"+351",is_default:u.is_default}).eq("id",n).eq("user_id",s.id).select().single();if(x)throw x;return o},onSuccess:()=>{i.invalidateQueries({queryKey:["user-addresses"]}),t({title:"Success",description:"Address updated successfully"})},onError:()=>{t({title:"Error",description:"Failed to update address",variant:"destructive"})}})},da=()=>{const{user:s}=G(),{toast:t}=Ze(),i=Je();return es({mutationFn:async n=>{if(!s)throw new Error("User not authenticated");const{error:u}=await P.from("user_addresses").delete().eq("id",n).eq("user_id",s.id);if(u)throw u},onSuccess:()=>{i.invalidateQueries({queryKey:["user-addresses"]}),t({title:"Success",description:"Address deleted successfully"})},onError:()=>{t({title:"Error",description:"Failed to delete address",variant:"destructive"})}})},ma=()=>{const{user:s}=G(),{toast:t}=Ze(),i=Je();return es({mutationFn:async n=>{if(!s)throw new Error("User not authenticated");const{data:u,error:o}=await P.from("user_addresses").update({is_default:!0}).eq("id",n).eq("user_id",s.id).select().single();if(o)throw o;return u},onSuccess:()=>{i.invalidateQueries({queryKey:["user-addresses"]}),t({title:"Success",description:"Default address updated"})},onError:()=>{t({title:"Error",description:"Failed to set default address",variant:"destructive"})}})},_s=[{value:"Home",icon:ea,labelKey:"address.labelHome"},{value:"Work",icon:Xt,labelKey:"address.labelWork"},{value:"Office",icon:Zt,labelKey:"address.labelOffice"},{value:"Other",icon:Me,labelKey:"address.labelOther"}],ha=[{code:"+351",country:"Portugal",flag:"ðŸ‡µðŸ‡¹"},{code:"+34",country:"Spain",flag:"ðŸ‡ªðŸ‡¸"},{code:"+33",country:"France",flag:"ðŸ‡«ðŸ‡·"},{code:"+49",country:"Germany",flag:"ðŸ‡©ðŸ‡ª"},{code:"+39",country:"Italy",flag:"ðŸ‡®ðŸ‡¹"},{code:"+44",country:"UK",flag:"ðŸ‡¬ðŸ‡§"},{code:"+31",country:"Netherlands",flag:"ðŸ‡³ðŸ‡±"},{code:"+32",country:"Belgium",flag:"ðŸ‡§ðŸ‡ª"},{code:"+86",country:"China",flag:"ðŸ‡¨ðŸ‡³"},{code:"+1",country:"USA/Canada",flag:"ðŸ‡ºðŸ‡¸"},{code:"+55",country:"Brazil",flag:"ðŸ‡§ðŸ‡·"}],ua=["Portugal","Spain","France","Germany","Italy","United Kingdom","Netherlands","Belgium","China","Other"],Qs=({initialData:s,onSubmit:t,onCancel:i,isLoading:n,isEdit:u})=>{const{t:o}=je(),[x,c]=j.useState({label:(s==null?void 0:s.label)||"Home",street:(s==null?void 0:s.street)||"",district:(s==null?void 0:s.district)||"",city:(s==null?void 0:s.city)||"",postal_code:(s==null?void 0:s.postal_code)||"",country:(s==null?void 0:s.country)||"Portugal",phone:(s==null?void 0:s.phone)||"",phone_code:(s==null?void 0:s.phone_code)||"+351",is_default:(s==null?void 0:s.is_default)||!1}),r=a=>{a.preventDefault(),t(x)};return e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"label",children:o("address.label")}),e.jsxs(qe,{value:x.label,onValueChange:a=>c({...x,label:a}),children:[e.jsx(Ve,{children:e.jsx(Ke,{placeholder:o("address.selectLabel")})}),e.jsx(Ge,{children:_s.map(a=>e.jsx(Ye,{value:a.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a.icon,{className:"w-4 h-4"}),o(a.labelKey)]})},a.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{htmlFor:"street",children:[o("address.street")," *"]}),e.jsx(F,{id:"street",value:x.street,onChange:a=>c({...x,street:a.target.value}),placeholder:o("address.streetPlaceholder"),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"district",children:o("address.district")}),e.jsx(F,{id:"district",value:x.district,onChange:a=>c({...x,district:a.target.value}),placeholder:o("address.districtPlaceholder")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{htmlFor:"city",children:[o("address.city")," *"]}),e.jsx(F,{id:"city",value:x.city,onChange:a=>c({...x,city:a.target.value}),placeholder:o("address.cityPlaceholder"),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{htmlFor:"postal_code",children:[o("address.postalCode")," *"]}),e.jsx(F,{id:"postal_code",value:x.postal_code,onChange:a=>c({...x,postal_code:a.target.value}),placeholder:o("address.postalCodePlaceholder"),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{htmlFor:"country",children:[o("address.country")," *"]}),e.jsxs(qe,{value:x.country,onValueChange:a=>c({...x,country:a}),children:[e.jsx(Ve,{children:e.jsx(Ke,{placeholder:o("address.selectCountry")})}),e.jsx(Ge,{children:ua.map(a=>e.jsx(Ye,{value:a,children:a},a))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{htmlFor:"phone",children:[o("address.phone")," *"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(qe,{value:x.phone_code,onValueChange:a=>c({...x,phone_code:a}),children:[e.jsx(Ve,{className:"w-[130px]",children:e.jsx(Ke,{placeholder:"+351"})}),e.jsx(Ge,{children:ha.map(a=>e.jsx(Ye,{value:a.code,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:a.flag}),e.jsx("span",{children:a.code})]})},a.code))})]}),e.jsx(F,{id:"phone",className:"flex-1",value:x.phone,onChange:a=>c({...x,phone:a.target.value}),placeholder:o("address.phonePlaceholder"),required:!0})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Yt,{id:"is_default",checked:x.is_default,onCheckedChange:a=>c({...x,is_default:a})}),e.jsx(R,{htmlFor:"is_default",className:"text-sm font-normal cursor-pointer",children:o("address.setAsDefault")})]}),e.jsxs(Tt,{className:"gap-2 sm:gap-0",children:[e.jsx(O,{type:"button",variant:"outline",onClick:i,children:o("common.cancel")}),e.jsx(O,{type:"submit",disabled:n,children:o(n?"common.saving":u?"common.save":"address.add")})]})]})},xa=({address:s,onEdit:t,onDelete:i,onSetDefault:n,isDeleting:u,isSettingDefault:o,canDelete:x=!0})=>{const{t:c}=je(),r=_s.find(l=>l.value===s.label)||_s[3],a=r.icon;return e.jsx("div",{className:`p-4 border rounded-lg hover:shadow-medium transition-shadow relative ${s.is_default?"bg-primary/5 border-primary/20":""}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`p-2 rounded-full ${s.is_default?"bg-primary/20":"bg-primary/10"}`,children:e.jsx(a,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-foreground",children:c(r.labelKey)}),s.is_default&&e.jsxs(D,{variant:"secondary",className:"text-xs",children:[e.jsx(bs,{className:"w-3 h-3 mr-1 fill-current"}),c("address.default")]})]}),e.jsxs("p",{className:"text-sm text-foreground",children:[s.street,s.district&&`, ${s.district}`]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:[s.postal_code,s.city,s.country].filter(Boolean).join(", ")}),s.phone&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(Lt,{className:"w-3 h-3"}),s.phone_code," ",s.phone]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[!s.is_default&&e.jsx(O,{variant:"ghost",size:"icon",onClick:()=>n(s.id),disabled:o,title:c("address.setAsDefault"),children:e.jsx(bs,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"icon",onClick:()=>t(s),title:c("common.edit"),children:e.jsx(Wt,{className:"w-4 h-4"})}),x&&e.jsxs(oe,{children:[e.jsx(Ut,{asChild:!0,children:e.jsx(O,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",title:c("common.delete"),children:e.jsx(Zs,{className:"w-4 h-4"})})}),e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(me,{children:c("address.deleteTitle")}),e.jsx(he,{children:c("address.deleteDescription")})]}),e.jsxs(ue,{children:[e.jsx(xe,{children:c("common.cancel")}),e.jsx(ae,{onClick:()=>i(s.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:u,children:c(u?"common.deleting":"common.delete")})]})]})]})]})]})})},qs=()=>{const{t:s}=je(),{data:t,isLoading:i}=ia(),{data:n}=Js(),u=oa(),o=ca(),x=Ws(),c=da(),r=ma(),[a,l]=j.useState(!1),[d,m]=j.useState(null),[p,f]=j.useState(null),[y,v]=j.useState(!1),T=!(n!=null&&n.phone),E=M=>{if(T&&M.phone){f(M),v(!0);return}u.mutate(M,{onSuccess:()=>l(!1)})},N=()=>{if(!p)return;const M=`${p.phone_code||"+351"} ${p.phone}`;x.mutate({phone:M}),u.mutate(p,{onSuccess:()=>{l(!1),f(null),v(!1)}})},S=()=>{f(null),v(!1)},I=M=>{d&&o.mutate({id:d.id,address:M},{onSuccess:()=>m(null)})},$=M=>{c.mutate(M)},W=M=>{r.mutate(M)};if(i)return e.jsxs(Q,{children:[e.jsx(re,{children:e.jsxs(ne,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5"}),s("address.myAddresses")]})}),e.jsx(q,{children:e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:s("common.loading")})})]});const z=t&&t.length>0;return e.jsxs(Q,{children:[e.jsx(re,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1.5 min-w-0 flex-1",children:[e.jsxs(ne,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5 flex-shrink-0"}),s("address.myAddresses")]}),e.jsx(fe,{className:"text-xs text-primary",children:s("address.manageDescription")})]}),z&&e.jsxs(Oe,{open:a,onOpenChange:l,children:[e.jsx(Xs,{asChild:!0,children:e.jsxs(O,{size:"sm",className:"w-full sm:w-auto flex-shrink-0",children:[e.jsx(Ls,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"truncate",children:s("address.addNew")})]})}),e.jsxs(Te,{className:"sm:max-w-[500px]",children:[e.jsxs(Le,{children:[e.jsx(Ue,{children:s("address.addNew")}),e.jsx(ys,{children:s("address.addDescription")})]}),e.jsx(Qs,{onSubmit:E,onCancel:()=>l(!1),isLoading:u.isPending})]})]})]})}),e.jsx(q,{children:z?e.jsx("div",{className:"space-y-4",children:t.map(M=>e.jsx(xa,{address:M,onEdit:m,onDelete:$,onSetDefault:W,isDeleting:c.isPending,isSettingDefault:r.isPending,canDelete:t.length>1},M.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Me,{className:"w-12 h-12 mx-auto text-muted-foreground/50 mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:s("address.noAddresses")}),e.jsxs(O,{onClick:()=>l(!0),children:[e.jsx(Ls,{className:"w-4 h-4 mr-2"}),s("address.addFirst")]})]})}),e.jsx(Oe,{open:!!d,onOpenChange:()=>m(null),children:e.jsxs(Te,{className:"sm:max-w-[500px]",children:[e.jsxs(Le,{children:[e.jsx(Ue,{children:s("address.editAddress")}),e.jsx(ys,{children:s("address.editDescription")})]}),d&&e.jsx(Qs,{initialData:d,onSubmit:I,onCancel:()=>m(null),isLoading:o.isPending,isEdit:!0})]})}),e.jsx(oe,{open:y,onOpenChange:v,children:e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(me,{children:s("address.phoneConfirmTitle")}),e.jsx(he,{children:s("address.phoneConfirmDescription")})]}),e.jsxs(ue,{children:[e.jsx(xe,{onClick:S,children:s("common.cancel")}),e.jsx(ae,{onClick:N,disabled:u.isPending||x.isPending,children:u.isPending||x.isPending?s("common.saving"):s("common.confirm")})]})]})})]})};var fa=Object.defineProperty,Xe=Object.getOwnPropertySymbols,rt=Object.prototype.hasOwnProperty,nt=Object.prototype.propertyIsEnumerable,Vs=(s,t,i)=>t in s?fa(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i,Es=(s,t)=>{for(var i in t||(t={}))rt.call(t,i)&&Vs(s,i,t[i]);if(Xe)for(var i of Xe(t))nt.call(t,i)&&Vs(s,i,t[i]);return s},Ss=(s,t)=>{var i={};for(var n in s)rt.call(s,n)&&t.indexOf(n)<0&&(i[n]=s[n]);if(s!=null&&Xe)for(var n of Xe(s))t.indexOf(n)<0&&nt.call(s,n)&&(i[n]=s[n]);return i};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var _e;(s=>{const t=class C{constructor(r,a,l,d){if(this.version=r,this.errorCorrectionLevel=a,this.modules=[],this.isFunction=[],r<C.MIN_VERSION||r>C.MAX_VERSION)throw new RangeError("Version value out of range");if(d<-1||d>7)throw new RangeError("Mask value out of range");this.size=r*4+17;let m=[];for(let f=0;f<this.size;f++)m.push(!1);for(let f=0;f<this.size;f++)this.modules.push(m.slice()),this.isFunction.push(m.slice());this.drawFunctionPatterns();const p=this.addEccAndInterleave(l);if(this.drawCodewords(p),d==-1){let f=1e9;for(let y=0;y<8;y++){this.applyMask(y),this.drawFormatBits(y);const v=this.getPenaltyScore();v<f&&(d=y,f=v),this.applyMask(y)}}u(0<=d&&d<=7),this.mask=d,this.applyMask(d),this.drawFormatBits(d),this.isFunction=[]}static encodeText(r,a){const l=s.QrSegment.makeSegments(r);return C.encodeSegments(l,a)}static encodeBinary(r,a){const l=s.QrSegment.makeBytes(r);return C.encodeSegments([l],a)}static encodeSegments(r,a,l=1,d=40,m=-1,p=!0){if(!(C.MIN_VERSION<=l&&l<=d&&d<=C.MAX_VERSION)||m<-1||m>7)throw new RangeError("Invalid value");let f,y;for(f=l;;f++){const N=C.getNumDataCodewords(f,a)*8,S=x.getTotalBits(r,f);if(S<=N){y=S;break}if(f>=d)throw new RangeError("Data too long")}for(const N of[C.Ecc.MEDIUM,C.Ecc.QUARTILE,C.Ecc.HIGH])p&&y<=C.getNumDataCodewords(f,N)*8&&(a=N);let v=[];for(const N of r){i(N.mode.modeBits,4,v),i(N.numChars,N.mode.numCharCountBits(f),v);for(const S of N.getData())v.push(S)}u(v.length==y);const T=C.getNumDataCodewords(f,a)*8;u(v.length<=T),i(0,Math.min(4,T-v.length),v),i(0,(8-v.length%8)%8,v),u(v.length%8==0);for(let N=236;v.length<T;N^=253)i(N,8,v);let E=[];for(;E.length*8<v.length;)E.push(0);return v.forEach((N,S)=>E[S>>>3]|=N<<7-(S&7)),new C(f,a,E,m)}getModule(r,a){return 0<=r&&r<this.size&&0<=a&&a<this.size&&this.modules[a][r]}getModules(){return this.modules}drawFunctionPatterns(){for(let l=0;l<this.size;l++)this.setFunctionModule(6,l,l%2==0),this.setFunctionModule(l,6,l%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const r=this.getAlignmentPatternPositions(),a=r.length;for(let l=0;l<a;l++)for(let d=0;d<a;d++)l==0&&d==0||l==0&&d==a-1||l==a-1&&d==0||this.drawAlignmentPattern(r[l],r[d]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(r){const a=this.errorCorrectionLevel.formatBits<<3|r;let l=a;for(let m=0;m<10;m++)l=l<<1^(l>>>9)*1335;const d=(a<<10|l)^21522;u(d>>>15==0);for(let m=0;m<=5;m++)this.setFunctionModule(8,m,n(d,m));this.setFunctionModule(8,7,n(d,6)),this.setFunctionModule(8,8,n(d,7)),this.setFunctionModule(7,8,n(d,8));for(let m=9;m<15;m++)this.setFunctionModule(14-m,8,n(d,m));for(let m=0;m<8;m++)this.setFunctionModule(this.size-1-m,8,n(d,m));for(let m=8;m<15;m++)this.setFunctionModule(8,this.size-15+m,n(d,m));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let r=this.version;for(let l=0;l<12;l++)r=r<<1^(r>>>11)*7973;const a=this.version<<12|r;u(a>>>18==0);for(let l=0;l<18;l++){const d=n(a,l),m=this.size-11+l%3,p=Math.floor(l/3);this.setFunctionModule(m,p,d),this.setFunctionModule(p,m,d)}}drawFinderPattern(r,a){for(let l=-4;l<=4;l++)for(let d=-4;d<=4;d++){const m=Math.max(Math.abs(d),Math.abs(l)),p=r+d,f=a+l;0<=p&&p<this.size&&0<=f&&f<this.size&&this.setFunctionModule(p,f,m!=2&&m!=4)}}drawAlignmentPattern(r,a){for(let l=-2;l<=2;l++)for(let d=-2;d<=2;d++)this.setFunctionModule(r+d,a+l,Math.max(Math.abs(d),Math.abs(l))!=1)}setFunctionModule(r,a,l){this.modules[a][r]=l,this.isFunction[a][r]=!0}addEccAndInterleave(r){const a=this.version,l=this.errorCorrectionLevel;if(r.length!=C.getNumDataCodewords(a,l))throw new RangeError("Invalid argument");const d=C.NUM_ERROR_CORRECTION_BLOCKS[l.ordinal][a],m=C.ECC_CODEWORDS_PER_BLOCK[l.ordinal][a],p=Math.floor(C.getNumRawDataModules(a)/8),f=d-p%d,y=Math.floor(p/d);let v=[];const T=C.reedSolomonComputeDivisor(m);for(let N=0,S=0;N<d;N++){let I=r.slice(S,S+y-m+(N<f?0:1));S+=I.length;const $=C.reedSolomonComputeRemainder(I,T);N<f&&I.push(0),v.push(I.concat($))}let E=[];for(let N=0;N<v[0].length;N++)v.forEach((S,I)=>{(N!=y-m||I>=f)&&E.push(S[N])});return u(E.length==p),E}drawCodewords(r){if(r.length!=Math.floor(C.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let a=0;for(let l=this.size-1;l>=1;l-=2){l==6&&(l=5);for(let d=0;d<this.size;d++)for(let m=0;m<2;m++){const p=l-m,y=(l+1&2)==0?this.size-1-d:d;!this.isFunction[y][p]&&a<r.length*8&&(this.modules[y][p]=n(r[a>>>3],7-(a&7)),a++)}}u(a==r.length*8)}applyMask(r){if(r<0||r>7)throw new RangeError("Mask value out of range");for(let a=0;a<this.size;a++)for(let l=0;l<this.size;l++){let d;switch(r){case 0:d=(l+a)%2==0;break;case 1:d=a%2==0;break;case 2:d=l%3==0;break;case 3:d=(l+a)%3==0;break;case 4:d=(Math.floor(l/3)+Math.floor(a/2))%2==0;break;case 5:d=l*a%2+l*a%3==0;break;case 6:d=(l*a%2+l*a%3)%2==0;break;case 7:d=((l+a)%2+l*a%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[a][l]&&d&&(this.modules[a][l]=!this.modules[a][l])}}getPenaltyScore(){let r=0;for(let m=0;m<this.size;m++){let p=!1,f=0,y=[0,0,0,0,0,0,0];for(let v=0;v<this.size;v++)this.modules[m][v]==p?(f++,f==5?r+=C.PENALTY_N1:f>5&&r++):(this.finderPenaltyAddHistory(f,y),p||(r+=this.finderPenaltyCountPatterns(y)*C.PENALTY_N3),p=this.modules[m][v],f=1);r+=this.finderPenaltyTerminateAndCount(p,f,y)*C.PENALTY_N3}for(let m=0;m<this.size;m++){let p=!1,f=0,y=[0,0,0,0,0,0,0];for(let v=0;v<this.size;v++)this.modules[v][m]==p?(f++,f==5?r+=C.PENALTY_N1:f>5&&r++):(this.finderPenaltyAddHistory(f,y),p||(r+=this.finderPenaltyCountPatterns(y)*C.PENALTY_N3),p=this.modules[v][m],f=1);r+=this.finderPenaltyTerminateAndCount(p,f,y)*C.PENALTY_N3}for(let m=0;m<this.size-1;m++)for(let p=0;p<this.size-1;p++){const f=this.modules[m][p];f==this.modules[m][p+1]&&f==this.modules[m+1][p]&&f==this.modules[m+1][p+1]&&(r+=C.PENALTY_N2)}let a=0;for(const m of this.modules)a=m.reduce((p,f)=>p+(f?1:0),a);const l=this.size*this.size,d=Math.ceil(Math.abs(a*20-l*10)/l)-1;return u(0<=d&&d<=9),r+=d*C.PENALTY_N4,u(0<=r&&r<=2568888),r}getAlignmentPatternPositions(){if(this.version==1)return[];{const r=Math.floor(this.version/7)+2,a=this.version==32?26:Math.ceil((this.version*4+4)/(r*2-2))*2;let l=[6];for(let d=this.size-7;l.length<r;d-=a)l.splice(1,0,d);return l}}static getNumRawDataModules(r){if(r<C.MIN_VERSION||r>C.MAX_VERSION)throw new RangeError("Version number out of range");let a=(16*r+128)*r+64;if(r>=2){const l=Math.floor(r/7)+2;a-=(25*l-10)*l-55,r>=7&&(a-=36)}return u(208<=a&&a<=29648),a}static getNumDataCodewords(r,a){return Math.floor(C.getNumRawDataModules(r)/8)-C.ECC_CODEWORDS_PER_BLOCK[a.ordinal][r]*C.NUM_ERROR_CORRECTION_BLOCKS[a.ordinal][r]}static reedSolomonComputeDivisor(r){if(r<1||r>255)throw new RangeError("Degree out of range");let a=[];for(let d=0;d<r-1;d++)a.push(0);a.push(1);let l=1;for(let d=0;d<r;d++){for(let m=0;m<a.length;m++)a[m]=C.reedSolomonMultiply(a[m],l),m+1<a.length&&(a[m]^=a[m+1]);l=C.reedSolomonMultiply(l,2)}return a}static reedSolomonComputeRemainder(r,a){let l=a.map(d=>0);for(const d of r){const m=d^l.shift();l.push(0),a.forEach((p,f)=>l[f]^=C.reedSolomonMultiply(p,m))}return l}static reedSolomonMultiply(r,a){if(r>>>8||a>>>8)throw new RangeError("Byte out of range");let l=0;for(let d=7;d>=0;d--)l=l<<1^(l>>>7)*285,l^=(a>>>d&1)*r;return u(l>>>8==0),l}finderPenaltyCountPatterns(r){const a=r[1];u(a<=this.size*3);const l=a>0&&r[2]==a&&r[3]==a*3&&r[4]==a&&r[5]==a;return(l&&r[0]>=a*4&&r[6]>=a?1:0)+(l&&r[6]>=a*4&&r[0]>=a?1:0)}finderPenaltyTerminateAndCount(r,a,l){return r&&(this.finderPenaltyAddHistory(a,l),a=0),a+=this.size,this.finderPenaltyAddHistory(a,l),this.finderPenaltyCountPatterns(l)}finderPenaltyAddHistory(r,a){a[0]==0&&(r+=this.size),a.pop(),a.unshift(r)}};t.MIN_VERSION=1,t.MAX_VERSION=40,t.PENALTY_N1=3,t.PENALTY_N2=3,t.PENALTY_N3=40,t.PENALTY_N4=10,t.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],t.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],s.QrCode=t;function i(c,r,a){if(r<0||r>31||c>>>r)throw new RangeError("Value out of range");for(let l=r-1;l>=0;l--)a.push(c>>>l&1)}function n(c,r){return(c>>>r&1)!=0}function u(c){if(!c)throw new Error("Assertion error")}const o=class k{constructor(r,a,l){if(this.mode=r,this.numChars=a,this.bitData=l,a<0)throw new RangeError("Invalid argument");this.bitData=l.slice()}static makeBytes(r){let a=[];for(const l of r)i(l,8,a);return new k(k.Mode.BYTE,r.length,a)}static makeNumeric(r){if(!k.isNumeric(r))throw new RangeError("String contains non-numeric characters");let a=[];for(let l=0;l<r.length;){const d=Math.min(r.length-l,3);i(parseInt(r.substring(l,l+d),10),d*3+1,a),l+=d}return new k(k.Mode.NUMERIC,r.length,a)}static makeAlphanumeric(r){if(!k.isAlphanumeric(r))throw new RangeError("String contains unencodable characters in alphanumeric mode");let a=[],l;for(l=0;l+2<=r.length;l+=2){let d=k.ALPHANUMERIC_CHARSET.indexOf(r.charAt(l))*45;d+=k.ALPHANUMERIC_CHARSET.indexOf(r.charAt(l+1)),i(d,11,a)}return l<r.length&&i(k.ALPHANUMERIC_CHARSET.indexOf(r.charAt(l)),6,a),new k(k.Mode.ALPHANUMERIC,r.length,a)}static makeSegments(r){return r==""?[]:k.isNumeric(r)?[k.makeNumeric(r)]:k.isAlphanumeric(r)?[k.makeAlphanumeric(r)]:[k.makeBytes(k.toUtf8ByteArray(r))]}static makeEci(r){let a=[];if(r<0)throw new RangeError("ECI assignment value out of range");if(r<128)i(r,8,a);else if(r<16384)i(2,2,a),i(r,14,a);else if(r<1e6)i(6,3,a),i(r,21,a);else throw new RangeError("ECI assignment value out of range");return new k(k.Mode.ECI,0,a)}static isNumeric(r){return k.NUMERIC_REGEX.test(r)}static isAlphanumeric(r){return k.ALPHANUMERIC_REGEX.test(r)}getData(){return this.bitData.slice()}static getTotalBits(r,a){let l=0;for(const d of r){const m=d.mode.numCharCountBits(a);if(d.numChars>=1<<m)return 1/0;l+=4+m+d.bitData.length}return l}static toUtf8ByteArray(r){r=encodeURI(r);let a=[];for(let l=0;l<r.length;l++)r.charAt(l)!="%"?a.push(r.charCodeAt(l)):(a.push(parseInt(r.substring(l+1,l+3),16)),l+=2);return a}};o.NUMERIC_REGEX=/^[0-9]*$/,o.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,o.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let x=o;s.QrSegment=o})(_e||(_e={}));(s=>{(t=>{const i=class{constructor(u,o){this.ordinal=u,this.formatBits=o}};i.LOW=new i(0,1),i.MEDIUM=new i(1,0),i.QUARTILE=new i(2,3),i.HIGH=new i(3,2),t.Ecc=i})(s.QrCode||(s.QrCode={}))})(_e||(_e={}));(s=>{(t=>{const i=class{constructor(u,o){this.modeBits=u,this.numBitsCharCount=o}numCharCountBits(u){return this.numBitsCharCount[Math.floor((u+7)/17)]}};i.NUMERIC=new i(1,[10,12,14]),i.ALPHANUMERIC=new i(2,[9,11,13]),i.BYTE=new i(4,[8,16,16]),i.KANJI=new i(8,[8,10,12]),i.ECI=new i(7,[0,0,0]),t.Mode=i})(s.QrSegment||(s.QrSegment={}))})(_e||(_e={}));var Pe=_e;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var pa={L:Pe.QrCode.Ecc.LOW,M:Pe.QrCode.Ecc.MEDIUM,Q:Pe.QrCode.Ecc.QUARTILE,H:Pe.QrCode.Ecc.HIGH},lt=128,it="L",ot="#FFFFFF",ct="#000000",dt=!1,mt=1,ga=4,ja=0,va=.1;function ht(s,t=0){const i=[];return s.forEach(function(n,u){let o=null;n.forEach(function(x,c){if(!x&&o!==null){i.push(`M${o+t} ${u+t}h${c-o}v1H${o+t}z`),o=null;return}if(c===n.length-1){if(!x)return;o===null?i.push(`M${c+t},${u+t} h1v1H${c+t}z`):i.push(`M${o+t},${u+t} h${c+1-o}v1H${o+t}z`);return}x&&o===null&&(o=c)})}),i.join("")}function ut(s,t){return s.slice().map((i,n)=>n<t.y||n>=t.y+t.h?i:i.map((u,o)=>o<t.x||o>=t.x+t.w?u:!1))}function ya(s,t,i,n){if(n==null)return null;const u=s.length+i*2,o=Math.floor(t*va),x=u/t,c=(n.width||o)*x,r=(n.height||o)*x,a=n.x==null?s.length/2-c/2:n.x*x,l=n.y==null?s.length/2-r/2:n.y*x,d=n.opacity==null?1:n.opacity;let m=null;if(n.excavate){let f=Math.floor(a),y=Math.floor(l),v=Math.ceil(c+a-f),T=Math.ceil(r+l-y);m={x:f,y,w:v,h:T}}const p=n.crossOrigin;return{x:a,y:l,h:r,w:c,excavation:m,opacity:d,crossOrigin:p}}function Na(s,t){return t!=null?Math.max(Math.floor(t),0):s?ga:ja}function xt({value:s,level:t,minVersion:i,includeMargin:n,marginSize:u,imageSettings:o,size:x,boostLevel:c}){let r=L.useMemo(()=>{const f=(Array.isArray(s)?s:[s]).reduce((y,v)=>(y.push(...Pe.QrSegment.makeSegments(v)),y),[]);return Pe.QrCode.encodeSegments(f,pa[t],i,void 0,void 0,c)},[s,t,i,c]);const{cells:a,margin:l,numCells:d,calculatedImageSettings:m}=L.useMemo(()=>{let p=r.getModules();const f=Na(n,u),y=p.length+f*2,v=ya(p,x,f,o);return{cells:p,margin:f,numCells:y,calculatedImageSettings:v}},[r,x,o,n,u]);return{qrcode:r,margin:l,cells:a,numCells:d,calculatedImageSettings:m}}var wa=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}(),Ca=L.forwardRef(function(t,i){const n=t,{value:u,size:o=lt,level:x=it,bgColor:c=ot,fgColor:r=ct,includeMargin:a=dt,minVersion:l=mt,boostLevel:d,marginSize:m,imageSettings:p}=n,y=Ss(n,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:v}=y,T=Ss(y,["style"]),E=p==null?void 0:p.src,N=L.useRef(null),S=L.useRef(null),I=L.useCallback(B=>{N.current=B,typeof i=="function"?i(B):i&&(i.current=B)},[i]),[$,W]=L.useState(!1),{margin:z,cells:M,numCells:le,calculatedImageSettings:U}=xt({value:u,level:x,minVersion:l,boostLevel:d,includeMargin:a,marginSize:m,imageSettings:p,size:o});L.useEffect(()=>{if(N.current!=null){const B=N.current,V=B.getContext("2d");if(!V)return;let X=M;const Z=S.current,J=U!=null&&Z!==null&&Z.complete&&Z.naturalHeight!==0&&Z.naturalWidth!==0;J&&U.excavation!=null&&(X=ut(M,U.excavation));const g=window.devicePixelRatio||1;B.height=B.width=o*g;const b=o/le*g;V.scale(b,b),V.fillStyle=c,V.fillRect(0,0,le,le),V.fillStyle=r,wa?V.fill(new Path2D(ht(X,z))):M.forEach(function(A,H){A.forEach(function(ye,Ee){ye&&V.fillRect(Ee+z,H+z,1,1)})}),U&&(V.globalAlpha=U.opacity),J&&V.drawImage(Z,U.x+z,U.y+z,U.w,U.h)}}),L.useEffect(()=>{W(!1)},[E]);const ve=Es({height:o,width:o},v);let we=null;return E!=null&&(we=L.createElement("img",{src:E,key:E,style:{display:"none"},onLoad:()=>{W(!0)},ref:S,crossOrigin:U==null?void 0:U.crossOrigin})),L.createElement(L.Fragment,null,L.createElement("canvas",Es({style:ve,height:o,width:o,ref:I,role:"img"},T)),we)});Ca.displayName="QRCodeCanvas";var ft=L.forwardRef(function(t,i){const n=t,{value:u,size:o=lt,level:x=it,bgColor:c=ot,fgColor:r=ct,includeMargin:a=dt,minVersion:l=mt,boostLevel:d,title:m,marginSize:p,imageSettings:f}=n,y=Ss(n,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:v,cells:T,numCells:E,calculatedImageSettings:N}=xt({value:u,level:x,minVersion:l,boostLevel:d,includeMargin:a,marginSize:p,imageSettings:f,size:o});let S=T,I=null;f!=null&&N!=null&&(N.excavation!=null&&(S=ut(T,N.excavation)),I=L.createElement("image",{href:f.src,height:N.h,width:N.w,x:N.x+v,y:N.y+v,preserveAspectRatio:"none",opacity:N.opacity,crossOrigin:N.crossOrigin}));const $=ht(S,v);return L.createElement("svg",Es({height:o,width:o,viewBox:`0 0 ${E} ${E}`,ref:i,role:"img"},y),!!m&&L.createElement("title",null,m),L.createElement("path",{fill:c,d:`M0,0 h${E}v${E}H0z`,shapeRendering:"crispEdges"}),L.createElement("path",{fill:r,d:$,shapeRendering:"crispEdges"}),I)});ft.displayName="QRCodeSVG";const ba=({open:s,onOpenChange:t,coupon:i})=>{var l,d;const{t:n}=je(),{getLocalizedField:u}=ss(),[o,x]=j.useState(!1),c=(l=i.coupon_codes)==null?void 0:l.coupon_templates,r=(d=i.coupon_codes)==null?void 0:d.code,a=!!i.used_at;return e.jsx(Oe,{open:s,onOpenChange:m=>{t(m),m||x(!1)},children:e.jsxs(Te,{className:"max-w-lg max-h-[90vh]",children:[e.jsx(Le,{children:e.jsxs(Ue,{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5 text-primary"}),n("profile.coupons.details")]})}),e.jsx($t,{className:"max-h-[70vh] pr-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-foreground",children:u(c,"title")}),e.jsx(D,{variant:a?"secondary":"default",children:n(a?"profile.coupons.used":"profile.coupons.available")})]}),c!=null&&c.description_zh||c!=null&&c.description_en||c!=null&&c.description_pt?e.jsx("p",{className:"text-muted-foreground text-sm",children:u(c,"description")}):null]}),e.jsx($s,{}),e.jsx("div",{className:"bg-secondary/30 p-4 rounded-lg cursor-pointer hover:bg-secondary/50 transition-colors",onClick:()=>x(!o),children:e.jsx("div",{className:"flex flex-col items-center gap-3",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white p-3 rounded-lg",children:e.jsx(ft,{value:r||"",size:140,level:"M",includeMargin:!1})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n("profile.coupons.tapToHideQr")})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-2xl font-mono font-bold tracking-wider",children:r}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(sa,{className:"w-4 h-4"}),e.jsx("p",{className:"text-xs",children:n("profile.coupons.tapToShowQr")})]})]})})}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-primary/10 rounded-lg",children:[e.jsx(Qe,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:n("profile.coupons.discount")}),e.jsx("p",{className:"text-xl font-bold text-primary",children:(c==null?void 0:c.discount_type)==="percentage"?`${c==null?void 0:c.discount_value}% OFF`:`â‚¬${c==null?void 0:c.discount_value}`})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(st,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:n("profile.coupons.claimedAt")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:Ne(new Date(i.claimed_at),"yyyy-MM-dd HH:mm")})]})]}),a&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(pe,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:n("profile.coupons.usedOn")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:Ne(new Date(i.used_at),"yyyy-MM-dd HH:mm")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(pe,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:n("profile.coupons.validity")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c!=null&&c.valid_until?`${Ne(new Date(c.valid_from),"yyyy-MM-dd")} - ${Ne(new Date(c.valid_until),"yyyy-MM-dd")}`:n("profile.coupons.noExpiry")})]})]}),(c==null?void 0:c.min_order_amount)&&c.min_order_amount>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Qe,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:n("profile.coupons.minOrder")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["â‚¬",c.min_order_amount]})]})]}),(c==null?void 0:c.max_discount_amount)&&c.max_discount_amount>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Qe,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:n("profile.coupons.maxDiscount")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["â‚¬",c.max_discount_amount]})]})]}),e.jsx($s,{}),i.activity_id&&i.source==="share"&&e.jsxs(K,{to:`/activity/${i.activity_id}`,className:"flex items-center justify-center gap-2 p-3 rounded-lg border hover:shadow-md transition-all hover:border-primary",children:[e.jsx(Qe,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"text-sm font-medium text-foreground",children:[n("profile.coupons.source"),": ",n("profile.coupons.fromSharing")]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",n("profile.coupons.viewActivity"),")"]})]})]})})]})})},_a=()=>{const{user:s}=G();return ke({queryKey:["bookingRecords",s==null?void 0:s.email],queryFn:async()=>{if(!(s!=null&&s.email))return[];const{data:t,error:i}=await P.from("booking_records").select(`
          *,
          restaurants (
            name,
            name_en,
            name_pt,
            image_url
          )
        `).order("booking_date",{ascending:!1});if(i)throw i;return t},enabled:!!(s!=null&&s.email)})},Ea=()=>{const{user:s}=G();return ke({queryKey:["deliveryRecords",s==null?void 0:s.email],queryFn:async()=>{if(!(s!=null&&s.email))return[];const{data:t,error:i}=await P.from("delivery_records").select(`
          *,
          restaurants (
            name,
            name_en,
            name_pt,
            image_url
          )
        `).order("order_date",{ascending:!1});if(i)throw i;return t},enabled:!!(s!=null&&s.email)})},Ks=()=>{const{t:s}=je(),{data:t,isLoading:i}=_a(),{getLocalizedField:n}=ss(),u=o=>{switch(o){case"confirmed":return e.jsx(D,{className:"bg-green-500",children:s("booking.status.confirmed")});case"pending":return e.jsx(D,{variant:"secondary",children:s("booking.status.pending")});case"cancelled":return e.jsx(D,{variant:"destructive",children:s("booking.status.cancelled")});case"completed":return e.jsx(D,{className:"bg-blue-500",children:s("booking.status.completed")});default:return e.jsx(D,{variant:"outline",children:o})}};return e.jsxs(Q,{children:[e.jsxs(re,{className:"pb-3",children:[e.jsxs(ne,{className:"text-lg flex items-center gap-2",children:[e.jsx(zs,{className:"w-5 h-5"}),s("profile.bookingRecords.title")]}),e.jsx(fe,{className:"text-xs",children:s("profile.bookingRecords.description")})]}),e.jsx(q,{className:"px-3",children:i?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):t&&t.length>0?e.jsx("div",{className:"space-y-3",children:t.map(o=>{const x=o.restaurants?n(o.restaurants,"name"):o.restaurant_name;return e.jsxs("div",{className:"p-3 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:o.restaurant_id?e.jsxs(K,{to:`/restaurant/${o.restaurant_id}`,className:"font-semibold text-sm hover:text-primary transition-colors",children:[e.jsx(ge,{className:"w-4 h-4 inline mr-1"}),x]}):e.jsxs("span",{className:"font-semibold text-sm",children:[e.jsx(ge,{className:"w-4 h-4 inline mr-1"}),x]})}),u(o.status)]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(zs,{className:"w-3 h-3"}),Ne(new Date(o.booking_date),"yyyy-MM-dd")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(st,{className:"w-3 h-3"}),o.booking_time.slice(0,5)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(tt,{className:"w-3 h-3"}),o.party_size," ",s("booking.people")]})]}),o.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2 line-clamp-2",children:o.notes})]},o.id)})}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.bookingRecords.noRecords")})})]})},Gs=()=>{const{t:s}=je(),{data:t,isLoading:i}=Ea(),{getLocalizedField:n}=ss(),u=o=>{switch(o){case"completed":return e.jsx(D,{className:"bg-green-500",children:s("delivery.status.completed")});case"pending":return e.jsx(D,{variant:"secondary",children:s("delivery.status.pending")});case"cancelled":return e.jsx(D,{variant:"destructive",children:s("delivery.status.cancelled")});case"delivering":return e.jsx(D,{className:"bg-blue-500",children:s("delivery.status.delivering")});default:return e.jsx(D,{variant:"outline",children:o})}};return e.jsxs(Q,{children:[e.jsxs(re,{className:"pb-3",children:[e.jsxs(ne,{className:"text-lg flex items-center gap-2",children:[e.jsx(ta,{className:"w-5 h-5"}),s("profile.deliveryRecords.title")]}),e.jsx(fe,{className:"text-xs",children:s("profile.deliveryRecords.description")})]}),e.jsx(q,{className:"px-3",children:i?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):t&&t.length>0?e.jsx("div",{className:"space-y-3",children:t.map(o=>{const x=o.restaurants?n(o.restaurants,"name"):o.restaurant_name;return e.jsxs("div",{className:"p-3 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:o.restaurant_id?e.jsxs(K,{to:`/restaurant/${o.restaurant_id}`,className:"font-semibold text-sm hover:text-primary transition-colors",children:[e.jsx(ge,{className:"w-4 h-4 inline mr-1"}),x]}):e.jsxs("span",{className:"font-semibold text-sm",children:[e.jsx(ge,{className:"w-4 h-4 inline mr-1"}),x]})}),u(o.status)]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground mb-2",children:[e.jsx("span",{children:Ne(new Date(o.order_date),"yyyy-MM-dd HH:mm")}),o.total_amount&&e.jsxs("span",{className:"font-medium text-foreground",children:["â‚¬",o.total_amount.toFixed(2)]})]}),o.delivery_address&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-start gap-1",children:[e.jsx(Me,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:o.delivery_address})]}),o.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2 line-clamp-2",children:o.notes})]},o.id)})}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.deliveryRecords.noRecords")})})]})},As=j.memo(({comment:s,getLocalizedField:t})=>e.jsxs(K,{to:`/${s.target_type}/${s.target_id}`,className:"block p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2 gap-2",children:[e.jsx("h3",{className:"font-semibold text-card-foreground text-sm md:text-base line-clamp-1 flex-1",children:t(s,"target_name")}),e.jsx("span",{className:"text-xs md:text-sm text-muted-foreground whitespace-nowrap",children:et(new Date(s.created_at),{addSuffix:!0})})]}),e.jsx("p",{className:"text-muted-foreground line-clamp-2 text-sm md:text-base",children:s.content}),s.image_url&&e.jsx("img",{src:s.image_url,alt:"Comment",className:"mt-2 rounded-lg max-w-full md:max-w-xs",loading:"lazy"})]}));As.displayName="CommentItem";const Ps=j.memo(({restaurant:s,getLocalizedField:t,t:i})=>e.jsxs(K,{to:`/restaurant/${s.id}`,className:"flex gap-3 md:gap-4 p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-lg overflow-hidden bg-secondary/30 flex-shrink-0",children:e.jsx("img",{src:s.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80",alt:String(t(s,"name")),className:"w-full h-full object-cover",loading:"lazy",onError:n=>{n.currentTarget.src="https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-base md:text-lg text-card-foreground line-clamp-1",children:t(s,"name")}),e.jsx("p",{className:"text-muted-foreground text-sm mb-2 line-clamp-1",children:t(s,"type")}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(bs,{className:`w-4 h-4 ${s.rating?"fill-accent text-accent":"text-muted-foreground"}`}),s.rating?e.jsx("span",{className:"font-medium",children:s.rating.toFixed(1)}):e.jsxs("span",{className:"text-xs text-muted-foreground text-center whitespace-nowrap",children:[i("restaurant.noRatingLine1"),e.jsx("br",{}),i("restaurant.noRatingLine2")]})]})]})]}));Ps.displayName="FavoriteRestaurantItem";const Ms=j.memo(({subscription:s,getLocalizedField:t,t:i,isMobile:n})=>{var x,c;const[u,o]=j.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:()=>o(!0),className:`block rounded-lg border hover:shadow-medium transition-shadow cursor-pointer ${n?"p-3":"p-4"}`,children:e.jsxs("div",{className:`flex items-start ${n?"gap-3":"gap-4"}`,children:[((x=s.activity)==null?void 0:x.image_url)&&e.jsx("img",{src:s.activity.image_url,alt:String(t(s.activity,"title")),className:`rounded-lg object-cover flex-shrink-0 ${n?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${n?"text-sm":""}`,children:t(s.activity,"title")}),e.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none ${n?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:t(s.activity,"content")}}),e.jsxs("p",{className:"text-muted-foreground mt-2 text-xs",children:[i("profile.joinedOn"),":"," ",et(new Date(s.created_at),{addSuffix:!0})]})]}),e.jsx(Fe,{className:`text-primary fill-primary flex-shrink-0 ${n?"w-4 h-4":"w-5 h-5"}`})]})}),e.jsx(aa,{open:u,onOpenChange:o,activity:{title:String(t(s.activity,"title")),image_url:(c=s.activity)==null?void 0:c.image_url,content:String(t(s.activity,"content"))}})]})});Ms.displayName="ActivitySubscriptionItem";const ks=j.memo(({activityGroup:s,getLocalizedField:t,t:i,isMobile:n})=>{const u=s.activity,o=s.restaurants;return e.jsxs("div",{className:`rounded-lg border hover:shadow-medium transition-shadow ${n?"p-3":"p-4"}`,children:[e.jsx(K,{to:`/activity/${u.id}`,className:n?"block mb-2":"block mb-3",children:e.jsxs("div",{className:`flex items-start ${n?"gap-3":"gap-4"}`,children:[u.image_url&&e.jsx("img",{src:u.image_url,alt:String(t(u,"title")),className:`rounded-lg object-cover flex-shrink-0 ${n?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${n?"text-sm":""}`,children:t(u,"title")}),e.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none mb-2 ${n?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:t(u,"content")}}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4 text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"w-3 h-3"}),new Date(u.start_date).toLocaleDateString()]}),u.end_date&&e.jsxs("span",{children:["- ",new Date(u.end_date).toLocaleDateString()]})]})]})]})}),e.jsxs("div",{className:`pt-2 md:pt-3 border-t ${n?"mt-2":"mt-3"}`,children:[e.jsxs("div",{className:`flex items-center gap-2 ${n?"mb-1.5":"mb-2"}`,children:[e.jsx(ge,{className:`text-primary ${n?"w-3.5 h-3.5":"w-4 h-4"}`}),e.jsxs("span",{className:`font-medium text-foreground ${n?"text-xs":"text-sm"}`,children:[i("profile.participatingRestaurants")," (",o.length,")"]})]}),e.jsx("div",{className:`flex flex-wrap ${n?"gap-1.5":"gap-2"}`,children:o.map(x=>e.jsx(D,{variant:"secondary",className:n?"text-xs px-2 py-0.5":"text-xs",children:t(x,"name")},x.id))})]})]})});ks.displayName="MerchantActivityItem";const Rs=j.memo(({coupon:s,getLocalizedField:t,t:i,isMobile:n})=>{var a,l;const[u,o]=j.useState(!1),x=(a=s.coupon_codes)==null?void 0:a.coupon_templates,c=(l=s.coupon_codes)==null?void 0:l.code,r=!!s.used_at;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`rounded-lg border transition-shadow cursor-pointer ${r?"bg-muted/30":"hover:shadow-medium"} ${n?"p-3":"p-4"}`,onClick:()=>o(!0),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${n?"text-sm":"text-base"}`,children:t(x,"title")}),e.jsx("p",{className:`text-muted-foreground line-clamp-2 ${n?"text-xs":"text-sm"}`,children:t(x,"description")})]}),e.jsx(D,{variant:r?"secondary":"default",className:n?"text-xs":"",children:i(r?"profile.coupons.used":"profile.coupons.available")})]}),e.jsxs("div",{className:`flex items-center gap-2 mb-2 ${n?"text-xs":"text-sm"}`,children:[e.jsx("span",{className:"font-mono bg-secondary/50 px-2 py-1 rounded",children:c}),e.jsx("span",{className:"text-muted-foreground",children:(x==null?void 0:x.discount_type)==="percentage"?`${x==null?void 0:x.discount_value}%`:`â‚¬${x==null?void 0:x.discount_value}`})]}),e.jsx("div",{className:`text-muted-foreground ${n?"text-xs":"text-sm"}`,children:r?e.jsxs("span",{children:[i("profile.coupons.usedOn"),": ",Ne(new Date(s.used_at),"yyyy-MM-dd HH:mm")]}):x!=null&&x.valid_until?e.jsxs("span",{children:[i("profile.coupons.validUntil"),": ",Ne(new Date(x.valid_until),"yyyy-MM-dd")]}):e.jsx("span",{children:i("profile.coupons.noExpiry")})})]}),e.jsx(ba,{open:u,onOpenChange:o,coupon:s})]})});Rs.displayName="UserCouponItem";const nr=()=>{var Z,J;const{t:s}=je(),{user:t}=G(),i=Jt(),{data:n,isLoading:u}=Js(),{data:o,isLoading:x}=ra(),{data:c,isLoading:r}=na(),{data:a,isLoading:l}=Ht(),{data:d,isLoading:m}=la(),{data:p,isLoading:f}=qt(),{role:y,isMerchant:v,isSupervisor:T}=Ys(),{getLocalizedField:E}=ss(),N=v||T,[S,I]=j.useState("profile"),[$,W]=j.useState(),[z,M]=j.useState({}),[le,U]=j.useState(new Set(["profile"])),ve=N?[{value:"profile",label:s("profile.profile"),icon:Ts},{value:"favorites",label:s("profile.favorites"),icon:Fe},{value:"comments",label:s("profile.comments"),icon:De},{value:"activities",label:s("profile.participatedActivities"),icon:pe}]:[{value:"profile",label:s("profile.profile"),icon:Ts},{value:"favorites",label:s("profile.favorites"),icon:Fe},{value:"comments",label:s("profile.comments"),icon:De}],we=g=>{M(b=>({...b,[g]:window.scrollY}))},B=g=>{if(le.has(g)){const b=z[g]||0;setTimeout(()=>window.scrollTo(0,b),0)}else setTimeout(()=>window.scrollTo(0,0),0),U(b=>new Set([...b,g]))};j.useEffect(()=>{if(!$)return;const g=()=>{const b=$.selectedScrollSnap(),A=ve[b].value;A!==S&&(we(S),B(A),I(A))};return $.on("select",g),()=>{$.off("select",g)}},[$,S,z,le]);const V=g=>{if(g===S)return;we(S);const b=ve.findIndex(A=>A.value===g);b!==-1&&$&&$.scrollTo(b),B(g),I(g)};if(!t||u)return e.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4",children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsx("div",{className:"text-center",children:s("common.loading")})})});const X=s(y?`profile.role.${y}`:"profile.role.user");return e.jsx("div",{className:`min-h-screen bg-secondary/20 ${i?"pb-20 pt-4":"py-4 md:py-8 px-3 md:px-4"}`,children:e.jsxs("div",{className:`container mx-auto max-w-6xl ${i?"px-3":""}`,children:[!i&&e.jsx(e.Fragment,{children:e.jsx(Q,{className:"mb-6 md:mb-8",children:e.jsx(q,{className:"pt-4 md:pt-6 pb-4 md:pb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-4 md:gap-6",children:[e.jsxs(Ns,{className:"w-24 h-24",children:[e.jsx(ws,{src:(n==null?void 0:n.avatar_url)||""}),e.jsx(Cs,{className:"text-3xl",children:((Z=n==null?void 0:n.display_name)==null?void 0:Z.charAt(0).toUpperCase())||"U"})]}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-foreground",children:n==null?void 0:n.display_name}),e.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:t.email}),(n==null?void 0:n.phone)&&e.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:n.phone}),y&&y!=="user"&&e.jsx(D,{className:"bg-primary capitalize",children:X})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-start",children:[n&&e.jsx(Hs,{profile:n}),N&&n&&e.jsx(Us,{isAgreed:(n==null?void 0:n.activity_terms_agreed)||!1,agreedAt:(n==null?void 0:n.activity_terms_agreed_at)||null})]})]})})})}),i?e.jsxs(e.Fragment,{children:[e.jsx(zt,{setApi:W,opts:{align:"start",loop:!1},className:"w-full",children:e.jsxs(Bt,{className:"-ml-0",children:[e.jsx(He,{className:"pl-0",children:e.jsxs("div",{className:"pb-4 space-y-4",children:[e.jsx(Q,{children:e.jsx(q,{className:"pt-6 pb-6",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs(Ns,{className:"w-20 h-20",children:[e.jsx(ws,{src:(n==null?void 0:n.avatar_url)||""}),e.jsx(Cs,{className:"text-2xl",children:((J=n==null?void 0:n.display_name)==null?void 0:J.charAt(0).toUpperCase())||"U"})]}),e.jsxs("div",{className:"flex-1 text-center w-full",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2 text-foreground",children:n==null?void 0:n.display_name}),e.jsx("p",{className:"text-muted-foreground text-sm mb-2",children:t.email}),(n==null?void 0:n.phone)&&e.jsx("p",{className:"text-muted-foreground text-sm mb-3",children:n.phone}),y&&y!=="user"&&e.jsx(D,{className:"bg-primary capitalize text-xs mb-4",children:X}),n&&e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-2 w-full",children:[e.jsx(Hs,{profile:n}),N&&e.jsx(Us,{isAgreed:(n==null?void 0:n.activity_terms_agreed)||!1,agreedAt:(n==null?void 0:n.activity_terms_agreed_at)||null})]})]})]})})}),e.jsxs(Q,{children:[e.jsxs(re,{className:"pb-3",children:[e.jsxs(ne,{className:"text-lg flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5"}),s("profile.coupons.title")]}),e.jsx(fe,{className:"text-xs",children:s("profile.coupons.description")})]}),e.jsx(q,{className:"px-3",children:f?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):p&&p.length>0?e.jsx("div",{className:"space-y-3",children:p.map(g=>e.jsx(Rs,{coupon:g,getLocalizedField:E,t:s,isMobile:!0},g.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.coupons.noCoupons")," ",e.jsx(K,{to:"/activities",className:"text-primary hover:underline",children:s("profile.coupons.browseActivities")})]})})]}),e.jsx(qs,{}),e.jsx(Ks,{}),e.jsx(Gs,{})]})}),e.jsx(He,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsx(Q,{children:e.jsx(q,{className:"pt-4",children:e.jsxs(js,{defaultValue:"restaurants",className:"w-full",children:[e.jsxs(vs,{className:"grid w-full grid-cols-2 mb-4",children:[e.jsxs(se,{value:"restaurants",className:"flex items-center gap-2 text-xs",children:[e.jsx(ge,{className:"w-4 h-4"}),s("profile.restaurantFavorites"),o&&o.length>0&&e.jsx(D,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:o.length})]}),e.jsxs(se,{value:"activities",className:"flex items-center gap-2 text-xs",children:[e.jsx(pe,{className:"w-4 h-4"}),s("profile.activityFavorites"),a&&a.length>0&&e.jsx(D,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:a.length})]})]}),e.jsx(te,{value:"restaurants",children:x?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):o&&o.length>0?e.jsx("div",{className:"grid gap-3 grid-cols-1",children:o.map(g=>e.jsx(Ps,{restaurant:g,getLocalizedField:E,t:s},g.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.noFavorites")})}),e.jsx(te,{value:"activities",children:l?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):a&&a.length>0?e.jsx("div",{className:"space-y-3",children:a.map(g=>e.jsx(Ms,{subscription:g,getLocalizedField:E,t:s,isMobile:!0},g.activity_id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.noActivityFavorites")," ",e.jsx(K,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})]})})})})}),e.jsx(He,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsxs(Q,{children:[e.jsxs(re,{className:"pb-3",children:[e.jsxs(ne,{className:"text-lg flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5"}),s("profile.myComments")]}),e.jsx(fe,{className:"text-xs",children:s("profile.commentsDesc")})]}),e.jsx(q,{className:"space-y-3 px-3",children:r?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):c&&c.length>0?c.map(g=>e.jsx(As,{comment:g,getLocalizedField:E},g.id)):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.noComments")})})]})})}),N&&e.jsx(He,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsxs(Q,{children:[e.jsxs(re,{className:"pb-3",children:[e.jsxs(ne,{className:"text-lg flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5"}),s("profile.participatedActivities")]}),e.jsx(fe,{className:"text-xs",children:s("profile.participatedActivitiesDesc")})]}),e.jsx(q,{className:"px-3",children:e.jsx("div",{className:"space-y-4",children:m?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):d&&d.length>0?e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2 text-base",children:[e.jsx(ge,{className:"w-4 h-4"}),s("profile.restaurantActivities")]}),e.jsx("div",{className:"space-y-3",children:(()=>{const g=d.reduce((b,A)=>{const H=A.activity_id;return b[H]||(b[H]={activity:A.activity,restaurants:[],participationDate:A.created_at}),b[H].restaurants.push({id:A.restaurant_id,name:A.restaurant_name,name_en:A.restaurant_name_en,name_pt:A.restaurant_name_pt}),b},{});return Object.values(g).map(b=>e.jsx(ks,{activityGroup:b,getLocalizedField:E,t:s,isMobile:!0},b.activity.id))})()})]}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.noParticipatedActivities")," ",e.jsx(K,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})})]})})})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-background border-t z-50",children:e.jsx("div",{className:"flex justify-around items-center py-2 px-2",children:ve.map(g=>{const b=g.icon;return e.jsxs("button",{onClick:()=>V(g.value),className:`flex flex-col items-center gap-1 py-2 px-3 rounded-lg transition-all ${S===g.value?"text-primary":"text-muted-foreground"}`,children:[e.jsx(b,{className:`${S===g.value?"w-6 h-6":"w-5 h-5"}`}),e.jsx("span",{className:"text-xs font-medium",children:g.label})]},g.value)})})})]}):e.jsxs(js,{defaultValue:"favorites",className:"space-y-4 md:space-y-6",children:[e.jsxs(vs,{className:`grid w-full ${N?"grid-cols-6":"grid-cols-5"}`,children:[e.jsxs(se,{value:"favorites",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),s("profile.favorites")]}),e.jsxs(se,{value:"coupons",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),s("profile.coupons.title")]}),e.jsxs(se,{value:"comments",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),s("profile.comments")]}),N&&e.jsxs(se,{value:"activities",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),s("profile.participatedActivities")]}),e.jsxs(se,{value:"addresses",children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),s("address.myAddresses")]}),e.jsxs(se,{value:"orders",children:[e.jsx(tt,{className:"w-4 h-4 mr-2"}),s("profile.orderRecords")]})]}),e.jsx(te,{value:"favorites",children:e.jsx(Q,{children:e.jsx(q,{className:"pt-6",children:e.jsxs(js,{defaultValue:"restaurants",className:"w-full",children:[e.jsxs(vs,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(se,{value:"restaurants",className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4"}),s("profile.restaurantFavorites"),o&&o.length>0&&e.jsx(D,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:o.length})]}),e.jsxs(se,{value:"activities",className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),s("profile.activityFavorites"),a&&a.length>0&&e.jsx(D,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:a.length})]})]}),e.jsx(te,{value:"restaurants",children:x?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):o&&o.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:o.map(g=>e.jsx(Ps,{restaurant:g,getLocalizedField:E,t:s},g.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:s("profile.noFavorites")})}),e.jsx(te,{value:"activities",children:l?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):a&&a.length>0?e.jsx("div",{className:"space-y-4",children:a.map(g=>e.jsx(Ms,{subscription:g,getLocalizedField:E,t:s,isMobile:i},g.activity_id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8",children:[s("profile.noActivityFavorites")," ",e.jsx(K,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})]})})})}),e.jsx(te,{value:"comments",children:e.jsxs(Q,{children:[e.jsxs(re,{className:i?"pb-3":"",children:[e.jsxs(ne,{className:`flex items-center gap-2 ${i?"text-lg":""}`,children:[e.jsx(De,{className:"w-5 h-5"}),s("profile.myComments")]}),e.jsx(fe,{className:i?"text-xs":"",children:s("profile.commentsDesc")})]}),e.jsx(q,{className:`space-y-3 md:space-y-4 ${i?"px-3":""}`,children:r?e.jsx("div",{className:`text-center py-8 ${i?"text-sm":""}`,children:s("common.loading")}):c&&c.length>0?c.map(g=>e.jsx(As,{comment:g,getLocalizedField:E},g.id)):e.jsx("p",{className:`text-muted-foreground text-center py-8 ${i?"text-sm":""}`,children:s("profile.noComments")})})]})}),N&&e.jsx(te,{value:"activities",children:e.jsxs(Q,{children:[e.jsxs(re,{className:i?"pb-3":"",children:[e.jsxs(ne,{className:`flex items-center gap-2 ${i?"text-lg":""}`,children:[e.jsx(pe,{className:"w-5 h-5"}),s("profile.participatedActivities")]}),e.jsx(fe,{className:i?"text-xs":"",children:s("profile.participatedActivitiesDesc")})]}),e.jsx(q,{className:i?"px-3":"",children:e.jsx("div",{className:i?"space-y-4":"space-y-6",children:m?e.jsx("div",{className:`text-center py-8 ${i?"text-sm":""}`,children:s("common.loading")}):d&&d.length>0?e.jsxs("div",{children:[e.jsxs("h3",{className:`font-semibold mb-3 md:mb-4 flex items-center gap-2 ${i?"text-base":"text-lg"}`,children:[e.jsx(ge,{className:i?"w-4 h-4":"w-5 h-5"}),s("profile.restaurantActivities")]}),e.jsx("div",{className:i?"space-y-3":"space-y-4",children:(()=>{const g=d.reduce((b,A)=>{const H=A.activity_id;return b[H]||(b[H]={activity:A.activity,restaurants:[],participationDate:A.created_at}),b[H].restaurants.push({id:A.restaurant_id,name:A.restaurant_name,name_en:A.restaurant_name_en,name_pt:A.restaurant_name_pt}),b},{});return Object.values(g).map(b=>e.jsx(ks,{activityGroup:b,getLocalizedField:E,t:s,isMobile:i},b.activity.id))})()})]}):e.jsxs("p",{className:`text-muted-foreground text-center py-8 ${i?"text-sm":""}`,children:[s("profile.noParticipatedActivities")," ",e.jsx(K,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})})]})}),e.jsx(te,{value:"coupons",children:e.jsxs(Q,{children:[e.jsxs(re,{className:i?"pb-3":"",children:[e.jsxs(ne,{className:`flex items-center gap-2 ${i?"text-lg":""}`,children:[e.jsx(We,{className:"w-5 h-5"}),s("profile.coupons.title")]}),e.jsx(fe,{className:i?"text-xs":"",children:s("profile.coupons.description")})]}),e.jsx(q,{className:i?"px-3":"",children:f?e.jsx("div",{className:`text-center py-8 ${i?"text-sm":""}`,children:s("common.loading")}):p&&p.length>0?e.jsx("div",{className:`grid gap-3 md:gap-4 ${i?"grid-cols-1":"md:grid-cols-2"}`,children:p.map(g=>e.jsx(Rs,{coupon:g,getLocalizedField:E,t:s,isMobile:i},g.id))}):e.jsxs("p",{className:`text-muted-foreground text-center py-8 ${i?"text-sm":""}`,children:[s("profile.coupons.noCoupons")," ",e.jsx(K,{to:"/activities",className:"text-primary hover:underline",children:s("profile.coupons.browseActivities")})]})})]})}),e.jsx(te,{value:"addresses",children:e.jsx(qs,{})}),e.jsx(te,{value:"orders",children:e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx(Ks,{}),e.jsx(Gs,{})]})})]})]})})};export{nr as default};
