{"version":3,"file":"Community-CPrs8mkp.js","sources":["../../src/components/community/PostGridCard.tsx","../../src/components/community/CreatePostDialog.tsx","../../src/pages/Community.tsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Heart, Images, MapPin } from \"lucide-react\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { CommunityPost, useLikePost } from \"@/hooks/useCommunityPosts\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\n\r\ninterface PostGridCardProps {\r\n  post: CommunityPost;\r\n}\r\n\r\nconst PostGridCard = ({ post }: PostGridCardProps) => {\r\n  const { t } = useTranslation();\r\n  const { user } = useAuth();\r\n  const navigate = useNavigate();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const likePost = useLikePost();\r\n  const [imageError, setImageError] = useState(false);\r\n\r\n  const handleLike = (e: React.MouseEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (!user) return;\r\n    likePost.mutate({ postId: post.id, liked: post.user_liked || false });\r\n  };\r\n\r\n  const handleCardClick = () => {\r\n    navigate(`/community/${post.id}`);\r\n  };\r\n\r\n  // Strip HTML tags for plain text preview\r\n  const getPlainTextContent = (html: string) => {\r\n    const doc = new DOMParser().parseFromString(html, \"text/html\");\r\n    return doc.body.textContent || \"\";\r\n  };\r\n\r\n  const content = getLocalizedField(post, \"content\");\r\n  const plainContent = getPlainTextContent(content);\r\n  const hasImages = post.image_urls && post.image_urls.length > 0;\r\n  const hasVideo = !!post.video_url;\r\n  const hasMedia = hasImages || hasVideo;\r\n  const imageCount = post.image_urls?.length || 0;\r\n\r\n  return (\r\n    <div \r\n      className=\"group cursor-pointer rounded-lg overflow-hidden bg-card border border-border/50 hover:shadow-lg transition-all duration-300 hover:-translate-y-1\"\r\n      onClick={handleCardClick}\r\n    >\r\n      {/* Media Section - Only show first image, no swipe */}\r\n      {hasMedia && (\r\n        <div className=\"relative\">\r\n          {hasImages ? (\r\n            <div className=\"relative aspect-[4/5] overflow-hidden\">\r\n              {!imageError ? (\r\n                <img\r\n                  src={post.image_urls![0]}\r\n                  alt=\"\"\r\n                  className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500\"\r\n                  onError={() => setImageError(true)}\r\n                />\r\n              ) : (\r\n                <div className=\"w-full h-full bg-muted flex items-center justify-center\">\r\n                  <span className=\"text-xs text-muted-foreground\">\r\n                    {t(\"common.imageLoadError\", \"图片加载失败\")}\r\n                  </span>\r\n                </div>\r\n              )}\r\n              \r\n              {/* Multiple images indicator */}\r\n              {imageCount > 1 && (\r\n                <div className=\"absolute top-2 right-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full z-10 flex items-center gap-1\">\r\n                  <Images className=\"h-3 w-3\" />\r\n                  <span>{imageCount}</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n          ) : hasVideo ? (\r\n            <div className=\"relative aspect-[4/5] overflow-hidden bg-gray-900\">\r\n              <video\r\n                src={post.video_url}\r\n                {...(post.image_urls?.length ? { poster: post.image_urls[0] } : {})}\r\n                className=\"w-full h-full object-cover\"\r\n                preload=\"metadata\"\r\n                muted\r\n                playsInline\r\n              />\r\n              <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                <div className=\"w-12 h-12 rounded-full bg-white/30 backdrop-blur-sm flex items-center justify-center\">\r\n                  <div className=\"w-0 h-0 border-l-[16px] border-l-white border-y-[10px] border-y-transparent ml-1\" />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ) : null}\r\n        </div>\r\n      )}\r\n\r\n      {/* Content Section */}\r\n      <div className=\"p-3\">\r\n        {/* Restaurant Badge */}\r\n        {post.restaurant && (\r\n          <Link \r\n            to={`/restaurants/${post.restaurant.id}`}\r\n            onClick={(e) => e.stopPropagation()}\r\n            className=\"inline-block mb-2\"\r\n          >\r\n            <Badge variant=\"outline\" className=\"text-xs gap-1 hover:bg-accent transition-colors\">\r\n              <MapPin className=\"h-3 w-3\" />\r\n              {getLocalizedField(post.restaurant, \"name\")}\r\n            </Badge>\r\n          </Link>\r\n        )}\r\n\r\n        {/* Text Content */}\r\n        <p className={`text-sm font-medium line-clamp-2 leading-relaxed ${hasMedia ? '' : 'min-h-[60px]'}`}>\r\n          {plainContent}\r\n        </p>\r\n\r\n        {/* Author Row */}\r\n        <div className=\"flex items-center justify-between mt-3\">\r\n          <div className=\"flex items-center gap-2 min-w-0 flex-1\">\r\n            <Avatar className=\"h-5 w-5 flex-shrink-0\">\r\n              <AvatarImage src={post.author?.avatar_url || undefined} />\r\n              <AvatarFallback className=\"text-[10px]\">\r\n                {post.author?.display_name?.charAt(0) || \"?\"}\r\n              </AvatarFallback>\r\n            </Avatar>\r\n            <span className=\"text-xs text-muted-foreground truncate\">\r\n              {post.author?.display_name}\r\n            </span>\r\n          </div>\r\n\r\n          {/* Like Button */}\r\n          <button\r\n            className={`flex items-center gap-1 text-xs ${\r\n              post.user_liked ? \"text-red-500\" : \"text-muted-foreground\"\r\n            } hover:text-red-500 transition-colors`}\r\n            onClick={handleLike}\r\n            disabled={!user}\r\n          >\r\n            <Heart\r\n              className={`h-4 w-4 ${post.user_liked ? \"fill-current\" : \"\"}`}\r\n            />\r\n            <span>{post.likes_count || 0}</span>\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PostGridCard;\r\n","import { useState, useRef, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Image, Video, X, Loader2, Calendar, MapPin } from \"lucide-react\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useCreatePost, useMerchantRestaurant } from \"@/hooks/useCommunityPosts\";\r\nimport { useActivities } from \"@/hooks/useActivities\";\r\nimport { useRestaurants } from \"@/hooks/useRestaurants\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { toast } from \"sonner\";\r\n\r\ninterface CreatePostDialogProps {\r\n  trigger?: React.ReactNode;\r\n}\r\n\r\nconst CreatePostDialog = ({ trigger }: CreatePostDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const createPost = useCreatePost();\r\n  const { data: activities } = useActivities();\r\n  const { data: restaurants } = useRestaurants();\r\n  const { role, isMerchant, isAdmin, isSupervisor } = useUserRole();\r\n  const { data: merchantRestaurant } = useMerchantRestaurant();\r\n\r\n  const [open, setOpen] = useState(false);\r\n  const [content, setContent] = useState(\"\");\r\n  const [imageUrls, setImageUrls] = useState<string[]>([]);\r\n  const [videoUrl, setVideoUrl] = useState<string | null>(null);\r\n  const [activityId, setActivityId] = useState<string>(\"\");\r\n  const [restaurantId, setRestaurantId] = useState<string>(\"\");\r\n  const [uploading, setUploading] = useState(false);\r\n\r\n  const imageInputRef = useRef<HTMLInputElement>(null);\r\n  const videoInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  // 普通用户 = 既不是商家、督导也不是管理员\r\n  const isRegularUser = !isMerchant && !isSupervisor && !isAdmin;\r\n\r\n  // 商家自动设置餐厅\r\n  useEffect(() => {\r\n    if (isMerchant && merchantRestaurant && open) {\r\n      setRestaurantId(merchantRestaurant.id);\r\n    }\r\n  }, [isMerchant, merchantRestaurant, open]);\r\n\r\n  // 重置表单\r\n  const resetForm = () => {\r\n    setContent(\"\");\r\n    setImageUrls([]);\r\n    setVideoUrl(null);\r\n    setActivityId(\"\");\r\n    setRestaurantId(\"\");\r\n  };\r\n\r\n  const handleOpenChange = (newOpen: boolean) => {\r\n    setOpen(newOpen);\r\n    if (!newOpen) {\r\n      resetForm();\r\n    }\r\n  };\r\n\r\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const files = e.target.files;\r\n    if (!files || files.length === 0) return;\r\n\r\n    if (imageUrls.length + files.length > 9) {\r\n      toast.error(t(\"community.maxImages\", \"最多上传9张图片\"));\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      const uploadedUrls: string[] = [];\r\n\r\n      for (const file of Array.from(files)) {\r\n        const fileExt = file.name.split(\".\").pop();\r\n        const fileName = `${user.id}/${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;\r\n\r\n        const { error: uploadError } = await supabase.storage\r\n          .from(\"community-posts\")\r\n          .upload(fileName, file);\r\n\r\n        if (uploadError) throw uploadError;\r\n\r\n        const { data: { publicUrl } } = supabase.storage\r\n          .from(\"community-posts\")\r\n          .getPublicUrl(fileName);\r\n\r\n        uploadedUrls.push(publicUrl);\r\n      }\r\n\r\n      setImageUrls((prev) => [...prev, ...uploadedUrls]);\r\n    } catch (error) {\r\n      console.error(\"Upload error:\", error);\r\n      toast.error(t(\"common.uploadError\", \"上传失败\"));\r\n    } finally {\r\n      setUploading(false);\r\n      if (imageInputRef.current) {\r\n        imageInputRef.current.value = \"\";\r\n      }\r\n    }\r\n  };\r\n\r\n  // Extract first frame from video file\r\n  const extractVideoFirstFrame = (videoFile: File): Promise<Blob> => {\r\n    return new Promise((resolve, reject) => {\r\n      const video = document.createElement('video');\r\n      const canvas = document.createElement('canvas');\r\n      const ctx = canvas.getContext('2d');\r\n      \r\n      video.preload = 'auto';\r\n      video.muted = true;\r\n      video.playsInline = true;\r\n      \r\n      let hasResolved = false;\r\n      \r\n      const captureFrame = () => {\r\n        if (hasResolved) return;\r\n        if (video.videoWidth === 0 || video.videoHeight === 0) return;\r\n        \r\n        canvas.width = video.videoWidth;\r\n        canvas.height = video.videoHeight;\r\n        \r\n        if (ctx) {\r\n          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n          canvas.toBlob((blob) => {\r\n            if (blob && blob.size > 0) {\r\n              hasResolved = true;\r\n              video.pause();\r\n              URL.revokeObjectURL(video.src);\r\n              resolve(blob);\r\n            } else {\r\n              reject(new Error('Failed to create blob'));\r\n            }\r\n          }, 'image/jpeg', 0.85);\r\n        }\r\n      };\r\n      \r\n      video.onloadedmetadata = () => {\r\n        canvas.width = video.videoWidth;\r\n        canvas.height = video.videoHeight;\r\n        video.currentTime = 0.1; // Jump to 0.1s to ensure frame is available\r\n      };\r\n      \r\n      video.onseeked = () => {\r\n        setTimeout(captureFrame, 100);\r\n      };\r\n      \r\n      video.onerror = () => {\r\n        URL.revokeObjectURL(video.src);\r\n        reject(new Error('Failed to load video'));\r\n      };\r\n      \r\n      // Timeout handling\r\n      setTimeout(() => {\r\n        if (!hasResolved) {\r\n          URL.revokeObjectURL(video.src);\r\n          reject(new Error('Timeout'));\r\n        }\r\n      }, 10000);\r\n      \r\n      video.src = URL.createObjectURL(videoFile);\r\n      video.load();\r\n    });\r\n  };\r\n\r\n  const handleVideoUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    // Check file size (max 100MB)\r\n    if (file.size > 100 * 1024 * 1024) {\r\n      toast.error(t(\"community.videoTooLarge\", \"视频不能超过100MB\"));\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      // 1. Upload video\r\n      const videoExt = file.name.split(\".\").pop();\r\n      const videoFileName = `${user.id}/${Date.now()}.${videoExt}`;\r\n\r\n      const { error: videoError } = await supabase.storage\r\n        .from(\"community-posts\")\r\n        .upload(videoFileName, file);\r\n\r\n      if (videoError) throw videoError;\r\n\r\n      const { data: { publicUrl: videoPublicUrl } } = supabase.storage\r\n        .from(\"community-posts\")\r\n        .getPublicUrl(videoFileName);\r\n\r\n      setVideoUrl(videoPublicUrl);\r\n\r\n      // 2. Extract and upload cover image\r\n      try {\r\n        toast.info(t(\"community.extractingCover\", \"正在提取视频封面...\"));\r\n        const coverBlob = await extractVideoFirstFrame(file);\r\n        const coverFileName = `${user.id}/${Date.now()}-cover.jpg`;\r\n        \r\n        const { error: coverError } = await supabase.storage\r\n          .from(\"community-posts\")\r\n          .upload(coverFileName, coverBlob);\r\n        \r\n        if (!coverError) {\r\n          const { data: { publicUrl: coverUrl } } = supabase.storage\r\n            .from(\"community-posts\")\r\n            .getPublicUrl(coverFileName);\r\n          \r\n          // Add cover image to the beginning of imageUrls\r\n          setImageUrls(prev => [coverUrl, ...prev]);\r\n          toast.success(t(\"community.coverExtracted\", \"封面已自动生成\"));\r\n        }\r\n      } catch (coverError) {\r\n        console.warn(\"Cover extraction failed:\", coverError);\r\n        // Cover extraction failure should not block video upload\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error(\"Upload error:\", error);\r\n      toast.error(t(\"common.uploadError\", \"上传失败\"));\r\n    } finally {\r\n      setUploading(false);\r\n      if (videoInputRef.current) {\r\n        videoInputRef.current.value = \"\";\r\n      }\r\n    }\r\n  };\r\n\r\n  const removeImage = (index: number) => {\r\n    setImageUrls((prev) => prev.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const removeVideo = () => {\r\n    setVideoUrl(null);\r\n    // Remove auto-generated cover image (URL contains -cover.jpg)\r\n    setImageUrls(prev => {\r\n      if (prev.length > 0 && prev[0].includes('-cover.jpg')) {\r\n        return prev.slice(1);\r\n      }\r\n      return prev;\r\n    });\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    if (!content.trim()) {\r\n      toast.error(t(\"community.contentRequired\", \"请输入内容\"));\r\n      return;\r\n    }\r\n\r\n    // 普通用户必须选择餐厅\r\n    if (isRegularUser && !restaurantId) {\r\n      toast.error(t(\"community.restaurantRequired\", \"请选择餐厅\"));\r\n      return;\r\n    }\r\n\r\n    await createPost.mutateAsync({\r\n      content,\r\n      image_urls: imageUrls,\r\n      video_url: videoUrl || undefined,\r\n      activity_id: activityId || undefined,\r\n      restaurant_id: restaurantId || undefined,\r\n    });\r\n\r\n    resetForm();\r\n    setOpen(false);\r\n  };\r\n\r\n  const activeActivities = activities?.filter((a) => a.status === \"published\") || [];\r\n\r\n  // 获取商家餐厅名称\r\n  const getMerchantRestaurantName = () => {\r\n    if (!merchantRestaurant) return t(\"community.noRestaurant\", \"未关联餐厅\");\r\n    return getLocalizedField(merchantRestaurant, \"name\");\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleOpenChange}>\r\n      <DialogTrigger asChild>\r\n        {trigger || (\r\n          <Button>{t(\"community.createPost\", \"发布帖子\")}</Button>\r\n        )}\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-w-lg max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle>{t(\"community.createPost\", \"发布帖子\")}</DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-4 mt-4\">\r\n          {/* Restaurant Selection */}\r\n          <div className=\"space-y-2\">\r\n            <Label className=\"flex items-center gap-2\">\r\n              <MapPin className=\"h-4 w-4\" />\r\n              {t(\"community.linkRestaurant\", \"关联餐厅\")}\r\n              {isRegularUser && <span className=\"text-destructive\">*</span>}\r\n            </Label>\r\n            \r\n            {isMerchant ? (\r\n              // 商家：显示已关联餐厅（只读）\r\n              <div className=\"px-3 py-2 border rounded-md bg-muted/50 text-sm\">\r\n                {getMerchantRestaurantName()}\r\n              </div>\r\n            ) : (\r\n              // 普通用户/督导/管理员：显示下拉选择\r\n              <Select \r\n                value={restaurantId || \"none\"} \r\n                onValueChange={(val) => setRestaurantId(val === \"none\" ? \"\" : val)}\r\n              >\r\n                <SelectTrigger>\r\n                  <SelectValue placeholder={t(\"community.selectRestaurant\", \"选择餐厅\")} />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  {/* 只有督导和管理员可以选择\"不关联\" */}\r\n                  {(isSupervisor || isAdmin) && (\r\n                    <SelectItem value=\"none\">\r\n                      {t(\"community.noRestaurantLink\", \"不关联餐厅\")}\r\n                    </SelectItem>\r\n                  )}\r\n                  {restaurants?.map((restaurant) => (\r\n                    <SelectItem key={restaurant.id} value={restaurant.id}>\r\n                      {getLocalizedField(restaurant, \"name\")}\r\n                    </SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n            )}\r\n          </div>\r\n\r\n          {/* Content */}\r\n          <div className=\"space-y-2\">\r\n            <Label>{t(\"community.content\", \"内容\")}</Label>\r\n            <Textarea\r\n              value={content}\r\n              onChange={(e) => setContent(e.target.value)}\r\n              placeholder={t(\"community.contentPlaceholder\", \"分享你的想法...\")}\r\n              rows={4}\r\n              className=\"resize-none\"\r\n            />\r\n          </div>\r\n\r\n          {/* Activity Selection */}\r\n          <div className=\"space-y-2\">\r\n            <Label className=\"flex items-center gap-2\">\r\n              <Calendar className=\"h-4 w-4\" />\r\n              {t(\"community.linkActivity\", \"关联活动\")}\r\n            </Label>\r\n            <Select value={activityId || \"none\"} onValueChange={(val) => setActivityId(val === \"none\" ? \"\" : val)}>\r\n              <SelectTrigger>\r\n                <SelectValue placeholder={t(\"community.selectActivity\", \"选择活动（可选）\")} />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"none\">\r\n                  {t(\"community.noActivity\", \"不关联活动\")}\r\n                </SelectItem>\r\n                {activeActivities.map((activity) => (\r\n                  <SelectItem key={activity.id} value={activity.id}>\r\n                    {getLocalizedField(activity, \"title\")}\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n\r\n          {/* Image Preview */}\r\n          {imageUrls.length > 0 && (\r\n            <div className=\"grid grid-cols-3 gap-2\">\r\n              {imageUrls.map((url, index) => (\r\n                <div key={index} className=\"relative aspect-square rounded-lg overflow-hidden\">\r\n                  <img src={url} alt=\"\" className=\"w-full h-full object-cover\" />\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => removeImage(index)}\r\n                    className=\"absolute top-1 right-1 p-1 bg-black/50 rounded-full text-white hover:bg-black/70\"\r\n                  >\r\n                    <X className=\"h-3 w-3\" />\r\n                  </button>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n\r\n          {/* Video Preview */}\r\n          {videoUrl && (\r\n            <div className=\"relative rounded-lg overflow-hidden\">\r\n              <video src={videoUrl} controls className=\"w-full max-h-48\" preload=\"metadata\" />\r\n              <button\r\n                type=\"button\"\r\n                onClick={removeVideo}\r\n                className=\"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70\"\r\n              >\r\n                <X className=\"h-4 w-4\" />\r\n              </button>\r\n            </div>\r\n          )}\r\n\r\n          {/* Upload Buttons */}\r\n          <div className=\"flex items-center gap-2\">\r\n            <input\r\n              ref={imageInputRef}\r\n              type=\"file\"\r\n              accept=\"image/*\"\r\n              multiple\r\n              className=\"hidden\"\r\n              onChange={handleImageUpload}\r\n            />\r\n            <input\r\n              ref={videoInputRef}\r\n              type=\"file\"\r\n              accept=\"video/*\"\r\n              className=\"hidden\"\r\n              onChange={handleVideoUpload}\r\n            />\r\n\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              onClick={() => imageInputRef.current?.click()}\r\n              disabled={uploading || imageUrls.length >= 9}\r\n            >\r\n              <Image className=\"h-4 w-4 mr-2\" />\r\n              {t(\"community.addImage\", \"添加图片\")}\r\n            </Button>\r\n\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              onClick={() => videoInputRef.current?.click()}\r\n              disabled={uploading || !!videoUrl}\r\n            >\r\n              <Video className=\"h-4 w-4 mr-2\" />\r\n              {t(\"community.addVideo\", \"添加视频\")}\r\n            </Button>\r\n\r\n            {uploading && <Loader2 className=\"h-4 w-4 animate-spin\" />}\r\n          </div>\r\n\r\n          {/* Submit */}\r\n          <div className=\"flex justify-end gap-2 pt-4\">\r\n            <Button variant=\"outline\" onClick={() => setOpen(false)}>\r\n              {t(\"common.cancel\", \"取消\")}\r\n            </Button>\r\n            <Button\r\n              onClick={handleSubmit}\r\n              disabled={createPost.isPending || !content.trim()}\r\n            >\r\n              {createPost.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\r\n              {t(\"community.publish\", \"发布\")}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default CreatePostDialog;\r\n","import { useCallback } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Plus } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport PostGridCard from \"@/components/community/PostGridCard\";\r\nimport CreatePostDialog from \"@/components/community/CreatePostDialog\";\r\nimport { useCommunityPosts, useCanCreatePost } from \"@/hooks/useCommunityPosts\";\r\nimport { PullToRefresh } from \"@/components/PullToRefresh\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\n\r\n// Skeleton for grid card\r\nconst PostGridSkeleton = () => (\r\n  <div className=\"rounded-xl overflow-hidden bg-card border border-border/50\">\r\n    <Skeleton className=\"aspect-[4/5] w-full\" />\r\n    <div className=\"p-3 space-y-3\">\r\n      <div className=\"space-y-2\">\r\n        <Skeleton className=\"h-4 w-full\" />\r\n        <Skeleton className=\"h-4 w-3/4\" />\r\n      </div>\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <Skeleton className=\"h-5 w-5 rounded-full\" />\r\n          <Skeleton className=\"h-3 w-16\" />\r\n        </div>\r\n        <Skeleton className=\"h-4 w-10\" />\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n\r\nconst Community = () => {\r\n  const { t } = useTranslation();\r\n  const queryClient = useQueryClient();\r\n  const { data: posts, isLoading } = useCommunityPosts({ status: \"approved\" });\r\n  const { data: canPost } = useCanCreatePost();\r\n\r\n  const handleRefresh = useCallback(async () => {\r\n    await queryClient.invalidateQueries({ queryKey: ['community-posts'] });\r\n  }, [queryClient]);\r\n\r\n  return (\r\n    <PullToRefresh onRefresh={handleRefresh}>\r\n      <div className=\"min-h-screen bg-secondary/20 py-8 px-4 animate-fade-in\">\r\n        <div className=\"container mx-auto max-w-4xl\">\r\n          {/* Header */}\r\n          <div className=\"flex items-center justify-between mb-6\">\r\n            <div>\r\n              <h1 className=\"text-3xl sm:text-4xl font-bold mb-2 text-primary\">\r\n                {t(\"community.title\", \"社区\")}\r\n              </h1>\r\n              <p className=\"text-muted-foreground text-base sm:text-lg\">\r\n                {t(\"community.description\", \"分享美食体验，发现更多精彩\")}\r\n              </p>\r\n            </div>\r\n            {canPost && (\r\n              <CreatePostDialog\r\n                trigger={\r\n                  <Button size=\"sm\" className=\"gap-1.5\">\r\n                    <Plus className=\"h-4 w-4\" />\r\n                    <span className=\"hidden sm:inline\">{t(\"community.createPost\", \"发布\")}</span>\r\n                  </Button>\r\n                }\r\n              />\r\n            )}\r\n          </div>\r\n\r\n        {/* Content */}\r\n        {isLoading ? (\r\n          // Loading skeleton - masonry style\r\n          <div className=\"columns-2 sm:columns-3 lg:columns-4 xl:columns-5 gap-3 sm:gap-4\">\r\n            {Array.from({ length: 6 }).map((_, i) => (\r\n              <div key={i} className=\"break-inside-avoid mb-3 sm:mb-4\">\r\n                <PostGridSkeleton />\r\n              </div>\r\n            ))}\r\n          </div>\r\n        ) : posts && posts.length > 0 ? (\r\n          // Xiaohongshu-style Masonry Grid\r\n          <div className=\"columns-2 sm:columns-3 lg:columns-4 xl:columns-5 gap-3 sm:gap-4\">\r\n            {posts.map((post) => (\r\n              <div key={post.id} className=\"break-inside-avoid mb-3 sm:mb-4\">\r\n                <PostGridCard post={post} />\r\n              </div>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          // Empty state - separate container for proper centering\r\n          <div className=\"flex flex-col items-center justify-center min-h-[60vh] text-center px-4\">\r\n            <div className=\"w-20 h-20 rounded-full bg-muted/50 flex items-center justify-center mb-4\">\r\n              <Plus className=\"w-8 h-8 text-muted-foreground/50\" />\r\n            </div>\r\n            <p className=\"text-muted-foreground text-lg\">{t(\"community.noPosts\", \"暂无帖子\")}</p>\r\n            {canPost && (\r\n              <p className=\"mt-2 text-sm text-muted-foreground/70\">\r\n                {t(\"community.beFirst\", \"成为第一个发帖的人吧！\")}\r\n              </p>\r\n            )}\r\n          </div>\r\n        )}\r\n        </div>\r\n      </div>\r\n    </PullToRefresh>\r\n  );\r\n};\r\n\r\nexport default Community;\r\n"],"names":["PostGridCard","post","t","useTranslation","user","useAuth","navigate","useNavigate","getLocalizedField","useLocalizedContent","likePost","useLikePost","imageError","setImageError","useState","handleLike","e","handleCardClick","getPlainTextContent","html","content","plainContent","hasImages","hasVideo","hasMedia","imageCount","jsxs","jsx","Images","Link","Badge","MapPin","Avatar","AvatarImage","AvatarFallback","Heart","CreatePostDialog","trigger","createPost","useCreatePost","activities","useActivities","restaurants","useRestaurants","role","isMerchant","isAdmin","isSupervisor","useUserRole","merchantRestaurant","useMerchantRestaurant","open","setOpen","setContent","imageUrls","setImageUrls","videoUrl","setVideoUrl","activityId","setActivityId","restaurantId","setRestaurantId","uploading","setUploading","imageInputRef","useRef","videoInputRef","isRegularUser","useEffect","resetForm","handleOpenChange","newOpen","handleImageUpload","files","toast","supabase","uploadedUrls","file","fileExt","fileName","uploadError","publicUrl","prev","error","extractVideoFirstFrame","videoFile","resolve","reject","video","canvas","ctx","hasResolved","captureFrame","blob","handleVideoUpload","videoExt","videoFileName","videoError","videoPublicUrl","coverBlob","coverFileName","coverError","coverUrl","removeImage","index","_","i","removeVideo","handleSubmit","activeActivities","a","getMerchantRestaurantName","Dialog","DialogTrigger","Button","DialogContent","DialogHeader","DialogTitle","Label","Select","val","SelectTrigger","SelectValue","SelectContent","SelectItem","restaurant","Textarea","Calendar","activity","url","X","Image","Video","Loader2","PostGridSkeleton","Skeleton","Community","queryClient","useQueryClient","posts","isLoading","useCommunityPosts","canPost","useCanCreatePost","handleRefresh","useCallback","PullToRefresh","Plus"],"mappings":"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"}