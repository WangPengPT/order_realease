import{s as a,p as d,q as p,v as y}from"./vendor-react-Hsdnn-sD.js";import{u as l,s as i,Z as o}from"./index-Bv780GYB.js";const _=()=>{const{user:t}=l();return a({queryKey:["user-points",t?.id],queryFn:async()=>{if(!t?.id)return 0;const{data:s,error:e}=await i.from("profiles").select("points").eq("id",t.id).single();if(e)throw e;return s?.points??0},enabled:!!t?.id})},w=t=>{const{user:s}=l(),e=s?.id;return a({queryKey:["points-transactions",e],queryFn:async()=>{if(!e)return[];const{data:r,error:n}=await i.from("points_transactions").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(n)throw n;return r},enabled:!!e})},g=t=>a({queryKey:["all-points-transactions",t],queryFn:async()=>{let s=i.from("points_transactions").select(`
          *,
          profiles:user_id (
            id,
            display_name,
            avatar_url
          )
        `).order("created_at",{ascending:!1}).limit(500);const{data:e,error:r}=await s;if(r)throw r;return e}}),v=()=>a({queryKey:["points-settings"],queryFn:async()=>{const{data:t,error:s}=await i.from("points_settings").select("*");if(s)throw s;return t}}),K=()=>{const{t}=d(),s=p();return y({mutationFn:async({key:e,value:r})=>{const{error:n}=await i.from("points_settings").update({value:r,updated_at:new Date().toISOString()}).eq("key",e);if(n)throw n},onSuccess:()=>{s.invalidateQueries({queryKey:["points-settings"]}),o({title:t("common.success"),description:t("admin.points.settingUpdated")})},onError:()=>{o({title:t("common.error"),description:t("common.errorOccurred"),variant:"destructive"})}})},h=()=>{const{t}=d(),s=p();return y({mutationFn:async({userId:e,amount:r,reason:n})=>{const{data:m,error:c}=await i.rpc("admin_modify_points",{p_target_user_id:e,p_amount:r,p_reason:n});if(c)throw c;const u=m;if(!u.success)throw new Error(u.error||"Unknown error");return u},onSuccess:(e,r)=>{s.invalidateQueries({queryKey:["user-points"]}),s.invalidateQueries({queryKey:["points-transactions"]}),s.invalidateQueries({queryKey:["all-points-transactions"]}),s.invalidateQueries({queryKey:["profiles"]}),o({title:t("common.success"),description:r.amount>0?t("admin.points.grantSuccess"):t("admin.points.deductSuccess")})},onError:e=>{o({title:t("common.error"),description:e.message==="insufficient_points"?t("admin.points.insufficientPoints"):t("common.errorOccurred"),variant:"destructive"})}})};export{h as a,g as b,v as c,K as d,_ as e,w as u};
//# sourceMappingURL=usePoints-C__p-ePn.js.map
