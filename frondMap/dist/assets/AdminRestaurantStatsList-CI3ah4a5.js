import{u as H,h as Q,r as v,p as f,j as e,d as y,af as _,ag as q,ah as D,ai as F,aj as m,B as O,b as $,C as g,f as u,S as B,e as G,o as J,s as p}from"./index-DVul3rRI.js";import{u as P}from"./useLocalizedContent-DGzOWXzu.js";import{T as W}from"./trending-up-ZVxTRXP-.js";import{A as X}from"./arrow-up-down-CeACw6QU.js";import{a as Y,A as Z}from"./arrow-up-B7C-TB6x.js";import{E as A}from"./eye-BCkNdHAq.js";import{M as E}from"./message-circle-BsnAz9ww.js";import{S as w}from"./star-CBcxmTIO.js";import{s as b}from"./startOfDay-BNzNGG7l.js";import{s as R}from"./subDays-BT2GcUDp.js";const me=()=>{const{t}=H(),T=Q(),{localizeRestaurant:k}=P(),[h,V]=v.useState("30days"),[S,z]=v.useState("rating"),[j,I]=v.useState("desc"),K=()=>{const s=new Date;switch(h){case"today":return b(s).toISOString();case"7days":return b(R(s,6)).toISOString();case"30days":return b(R(s,29)).toISOString();default:return null}},{data:o,isLoading:L}=f({queryKey:["admin-restaurants-stats-list"],queryFn:async()=>{const{data:s,error:a}=await p.from("restaurants").select("*").order("rating",{ascending:!1});if(a)throw a;return s}}),x=K(),{data:d}=f({queryKey:["admin-all-restaurant-view-counts",h],queryFn:async()=>{let s=p.from("page_views").select("target_id, created_at").eq("page_type","restaurant");x&&(s=s.gte("created_at",x));const{data:a,error:r}=await s;if(r)throw r;const l={};return a.forEach(n=>{n.target_id&&(l[n.target_id]=(l[n.target_id]||0)+1)}),l}}),{data:i}=f({queryKey:["admin-all-restaurant-comment-counts",h],queryFn:async()=>{let s=p.from("comments").select("target_id, created_at").eq("target_type","restaurant");x&&(s=s.gte("created_at",x));const{data:a,error:r}=await s;if(r)throw r;const l={};return a.forEach(n=>{l[n.target_id]=(l[n.target_id]||0)+1}),l}}),{data:c}=f({queryKey:["admin-all-restaurant-favorite-counts",h],queryFn:async()=>{let s=p.from("favorites").select("restaurant_id, created_at");x&&(s=s.gte("created_at",x));const{data:a,error:r}=await s;if(r)throw r;const l={};return a.forEach(n=>{l[n.restaurant_id]=(l[n.restaurant_id]||0)+1}),l}}),U=d?Object.values(d).reduce((s,a)=>s+a,0):0,C=i?Object.values(i).reduce((s,a)=>s+a,0):0,M=c?Object.values(c).reduce((s,a)=>s+a,0):0,N=o==null?void 0:o.slice().sort((s,a)=>{let r=0;switch(S){case"views":r=((d==null?void 0:d[a.id])||0)-((d==null?void 0:d[s.id])||0);break;case"comments":r=((i==null?void 0:i[a.id])||0)-((i==null?void 0:i[s.id])||0);break;case"favorites":r=((c==null?void 0:c[a.id])||0)-((c==null?void 0:c[s.id])||0);break;case"rating":default:r=(a.rating||0)-(s.rating||0)}return j==="desc"?r:-r});return L?e.jsxs("div",{className:"space-y-6",children:[e.jsx(y,{className:"h-8 w-48"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[1,2,3,4].map(s=>e.jsx(y,{className:"h-24"},s))}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(s=>e.jsx(y,{className:"h-40"},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-2xl font-bold",children:t("admin.restaurantStatistics","餐厅统计")})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(_,{value:S,onValueChange:s=>z(s),children:[e.jsx(q,{className:"w-[140px]",children:e.jsx(D,{})}),e.jsxs(F,{children:[e.jsx(m,{value:"rating",children:t("admin.sortByRating","按评分")}),e.jsx(m,{value:"views",children:t("admin.sortByViews","按浏览量")}),e.jsx(m,{value:"comments",children:t("admin.sortByComments","按评论数")}),e.jsx(m,{value:"favorites",children:t("admin.sortByFavorites","按收藏数")})]})]}),e.jsx(O,{variant:"outline",size:"icon",onClick:()=>I(j==="desc"?"asc":"desc"),title:j==="desc"?t("admin.sortDescending","从大到小"):t("admin.sortAscending","从小到大"),children:j==="desc"?e.jsx(Y,{className:"h-4 w-4"}):e.jsx(Z,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(_,{value:h,onValueChange:s=>V(s),children:[e.jsx(q,{className:"w-[140px]",children:e.jsx(D,{})}),e.jsxs(F,{children:[e.jsx(m,{value:"today",children:t("analytics.today","今日")}),e.jsx(m,{value:"7days",children:t("analytics.last7Days","近7天")}),e.jsx(m,{value:"30days",children:t("analytics.last30Days","近30天")}),e.jsx(m,{value:"all",children:t("analytics.allTime","所有时间")})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(g,{children:e.jsx(u,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(B,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("admin.totalRestaurants","餐厅总数")}),e.jsx("p",{className:"text-2xl font-bold",children:(o==null?void 0:o.length)||0})]})]})})}),e.jsx(g,{children:e.jsx(u,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500/10 rounded-lg",children:e.jsx(A,{className:"h-5 w-5 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("admin.totalViews","总浏览量")}),e.jsx("p",{className:"text-2xl font-bold",children:U})]})]})})}),e.jsx(g,{children:e.jsx(u,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-500/10 rounded-lg",children:e.jsx(E,{className:"h-5 w-5 text-amber-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("admin.totalComments","总评论数")}),e.jsx("p",{className:"text-2xl font-bold",children:C})]})]})})}),e.jsx(g,{children:e.jsx(u,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-500/10 rounded-lg",children:e.jsx(w,{className:"h-5 w-5 text-red-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("admin.totalFavorites","总收藏数")}),e.jsx("p",{className:"text-2xl font-bold",children:M})]})]})})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:t("admin.allRestaurants","所有餐厅")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:N==null?void 0:N.map(s=>{const a=k(s),r=(d==null?void 0:d[s.id])||0,l=(i==null?void 0:i[s.id])||0,n=(c==null?void 0:c[s.id])||0;return e.jsxs(g,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>T(`/admin/restaurant-stats/${s.id}`),children:[e.jsx(G,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.image_url?e.jsx("img",{src:s.image_url,alt:a.name,className:"w-12 h-12 rounded-lg object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(B,{className:"h-6 w-6 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(J,{className:"text-base line-clamp-1",children:a.name}),s.rating>0&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(w,{className:"h-3 w-3 fill-amber-400 text-amber-400"}),e.jsx("span",{children:s.rating.toFixed(1)})]})]})]})}),e.jsxs(u,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"flex flex-col items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx(A,{className:"h-4 w-4 text-muted-foreground mb-1"}),e.jsx("span",{className:"font-medium",children:r}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t("admin.views","浏览")})]}),e.jsxs("div",{className:"flex flex-col items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx(E,{className:"h-4 w-4 text-muted-foreground mb-1"}),e.jsx("span",{className:"font-medium",children:l}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t("admin.comments","评论")})]}),e.jsxs("div",{className:"flex flex-col items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx(w,{className:"h-4 w-4 text-muted-foreground mb-1"}),e.jsx("span",{className:"font-medium",children:n}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t("admin.favorites","收藏")})]})]}),e.jsx(O,{variant:"outline",size:"sm",className:"w-full mt-4",children:t("admin.viewDetails","查看详情")})]})]},s.id)})})]})]})};export{me as default};
