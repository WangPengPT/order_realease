import{r as z,j as e}from"./vendor-react-core-BErlw7p5.js";import{a as l}from"./vendor-query-BS0wY7WL.js";import{s as d,g as p,X as A,Y as k,Z as B,$ as H,a0 as h,C as u,j as x,h as Q,p as U,B as $}from"./index-kEIDKiMZ.js";import{u as P}from"./useLocalizedContent-DqTgPnyL.js";import{u as X}from"./vendor-i18n-CqcxoxDo.js";import{u as Y}from"./vendor-router-CLK0c9aH.js";import{aH as Z,e as G,ae as f,a2 as v,Q as N,aw as w}from"./vendor-icons-C2Bicc1E.js";import{c as y,s as b}from"./vendor-date-fYlqblcl.js";import"./vendor-editor-BdQcs4B3.js";import"./vendor-misc-DH4LiFnZ.js";import"./vendor-ui-other-CPTlx-W2.js";import"./vendor-supabase-Clrw0GhO.js";import"./vendor-ui-dialog-Sv_VEL0d.js";import"./vendor-ui-dropdown-DwTcg2UT.js";const me=()=>{const{t:r}=X(),_=Y(),{getLocalizedField:q}=P(),[o,S]=z.useState("30days"),C=()=>{const s=new Date;switch(o){case"today":return y(s).toISOString();case"7days":return y(b(s,6)).toISOString();case"30days":return y(b(s,29)).toISOString();default:return null}},{data:m,isLoading:F}=l({queryKey:["admin-activities-stats-list"],queryFn:async()=>{const{data:s,error:t}=await d.from("activities").select("*").neq("status","draft").order("created_at",{ascending:!1});if(t)throw t;return s}}),c=C(),{data:g}=l({queryKey:["admin-all-subscription-counts",o],queryFn:async()=>{let s=d.from("subscriptions").select("activity_id, created_at");c&&(s=s.gte("created_at",c));const{data:t,error:a}=await s;if(a)throw a;const i={};return t.forEach(n=>{i[n.activity_id]=(i[n.activity_id]||0)+1}),i}}),{data:j}=l({queryKey:["admin-all-share-counts",o],queryFn:async()=>{let s=d.from("activity_shares").select("activity_id, created_at");c&&(s=s.gte("created_at",c));const{data:t,error:a}=await s;if(a)throw a;const i={};return t.forEach(n=>{i[n.activity_id]=(i[n.activity_id]||0)+1}),i}}),{data:D}=l({queryKey:["admin-total-activity-views",o],queryFn:async()=>{let s=d.from("page_views").select("*",{count:"exact",head:!0}).eq("page_type","activity");c&&(s=s.gte("created_at",c));const{count:t,error:a}=await s;if(a)throw a;return t||0}}),{data:K}=l({queryKey:["admin-all-activity-view-counts",o,m],enabled:!!m&&m.length>0,queryFn:async()=>{const s={};return await Promise.all(m.map(async t=>{let a=d.from("page_views").select("*",{count:"exact",head:!0}).eq("page_type","activity").eq("target_id",t.id);c&&(a=a.gte("created_at",c));const{count:i}=await a;s[t.id]=i||0})),s}}),{data:E}=l({queryKey:["admin-total-restaurant-count"],queryFn:async()=>{const{count:s,error:t}=await d.from("activity_restaurants").select("*",{count:"exact",head:!0});if(t)throw t;return s||0}}),{data:O}=l({queryKey:["admin-all-activity-restaurant-counts"],queryFn:async()=>{const{data:s,error:t}=await d.from("activity_restaurants").select("activity_id");if(t)throw t;const a={};return s.forEach(i=>{a[i.activity_id]=(a[i.activity_id]||0)+1}),a}}),R=D||0,T=g?Object.values(g).reduce((s,t)=>s+t,0):0,L=j?Object.values(j).reduce((s,t)=>s+t,0):0,V=E||0;return F?e.jsxs("div",{className:"space-y-6",children:[e.jsx(p,{className:"h-8 w-48"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[1,2,3,4].map(s=>e.jsx(p,{className:"h-24"},s))}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(s=>e.jsx(p,{className:"h-40"},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-2xl font-bold",children:r("admin.activityStatistics")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(A,{value:o,onValueChange:s=>S(s),children:[e.jsx(k,{className:"w-[140px]",children:e.jsx(B,{})}),e.jsxs(H,{children:[e.jsx(h,{value:"today",children:r("analytics.today","今日")}),e.jsx(h,{value:"7days",children:r("analytics.last7Days","近7天")}),e.jsx(h,{value:"30days",children:r("analytics.last30Days","近30天")}),e.jsx(h,{value:"all",children:r("analytics.allTime","所有时间")})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(u,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(f,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:r("admin.totalViews")}),e.jsx("p",{className:"text-2xl font-bold",children:R})]})]})})}),e.jsx(u,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-500/10 rounded-lg",children:e.jsx(v,{className:"h-5 w-5 text-red-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:r("admin.totalSubscribers")}),e.jsx("p",{className:"text-2xl font-bold",children:T})]})]})})}),e.jsx(u,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-500/10 rounded-lg",children:e.jsx(N,{className:"h-5 w-5 text-green-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:r("admin.totalShares")}),e.jsx("p",{className:"text-2xl font-bold",children:L})]})]})})}),e.jsx(u,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-500/10 rounded-lg",children:e.jsx(w,{className:"h-5 w-5 text-amber-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:r("admin.participatingRestaurants")}),e.jsx("p",{className:"text-2xl font-bold",children:V})]})]})})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:r("admin.allActivities")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m?.map(s=>{const t=q(s,"title"),a=K?.[s.id]||0,i=g?.[s.id]||0,n=j?.[s.id]||0,I=O?.[s.id]||0;return e.jsxs(u,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>_(`/admin/activity-stats/${s.id}`),children:[e.jsx(Q,{className:"pb-2",children:e.jsx(U,{className:"text-base line-clamp-2",children:t})}),e.jsxs(x,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[a," ",r("admin.views")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[i," ",r("admin.subscribers")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[n," ",r("admin.shares")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[I," ",r("admin.restaurants")]})]})]}),e.jsx($,{variant:"outline",size:"sm",className:"w-full mt-4",children:r("admin.viewDetails")})]})]},s.id)})})]})]})};export{me as default};
//# sourceMappingURL=AdminActivityStatsList-C9uulf4H.js.map
