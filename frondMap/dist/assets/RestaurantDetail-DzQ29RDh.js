const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RestaurantComments-DMvtChP_.js","assets/index-CJcx5ZXn.js","assets/index-3CPwN867.css","assets/ReportDialog-gG8n6zKt.js","assets/input-otp-COsJjLY3.js","assets/shield-alert-WaYp5TI-.js","assets/plus-CMEzeJKN.js","assets/useSensitiveWords-BvQ0ksmX.js","assets/star-B60JlfS3.js","assets/trash-2-CwOgSwmo.js","assets/image-DiVlqqtj.js","assets/volume-x-PYSoj0fF.js"])))=>i.map(i=>d[i]);
import{c as de,j as e,d as l,C as R,e as I,f as $,u as Z,o as me,a as Qe,p as Ze,s as es,r as n,B as v,q as V,D as ss,t as ts,X as as,v as rs,_ as ns,w as ls,x as is,k as os,h as cs,y as ds,z as F,L as ie,A as ms,E as hs,F as us,G as z,J as ye,n as oe,M as xs,P as gs,K as q,N as _e,O as Ce,Q as ke,R as De,T as Se,U as ze,V as Re,W as Ie}from"./index-CJcx5ZXn.js";import{S as $e}from"./separator-R2uOiSe-.js";import{C as H,a as U,b as K}from"./collapsible-B643mUPf.js";import{d as ps,a as fs,c as js}from"./useRestaurants-Btrpdsd5.js";import{u as Ae,D as Ns,R as ws}from"./ReportDialog-gG8n6zKt.js";import{u as vs}from"./useLocalizedContent-CRFYWMmp.js";import{f as bs,N as ys}from"./timeUtils-CF4ibJXW.js";import{g as _s,c as Cs,N as Le,o as ks}from"./geolocation-BtvYIWp5.js";import{u as Ds,b as Me}from"./externalLinks-BRdTanVr.js";import{S as ce}from"./star-B60JlfS3.js";import{m as Q}from"./mapbox-gl-B4m1T7Sd.js";import{m as Ss}from"./map-icon-DR07RZr_.js";import{u as zs}from"./useActivityParticipation-D2x7_90F.js";import{u as Rs,R as Is}from"./RestaurantFormDialog-BZW3Xed_.js";import{u as Pe}from"./use-mobile-C0-bguRG.js";import{C as $s,a as Ls,b as Ms,c as Ts,d as Os}from"./carousel-YcX7WoVw.js";import{I as As}from"./image-DiVlqqtj.js";import{C as Ee}from"./chevron-left-fvMXiA7M.js";import{H as Ps}from"./heart-BHzsmQXG.js";import{S as G}from"./share-2-CZ8p9Nf7.js";import{M as W}from"./message-circle-CJMkMJ6n.js";import{L as Es}from"./link-2-DlD9Xb9E.js";import{S as Fs}from"./square-pen-I75zIY-d.js";import{S as qs}from"./shield-alert-WaYp5TI-.js";import{C as Gs}from"./clock-CziG37Y9.js";import"./index-BIasM_gL.js";import"./input-otp-COsJjLY3.js";import"./plus-CMEzeJKN.js";import"./index.esm-DxOD6PgC.js";import"./types-PTCIF_3G.js";import"./checkbox-DGthms9i.js";import"./switch-BUJXlJjk.js";import"./tabs-UcMiJ-MO.js";import"./upload-oa-JLXAc.js";import"./grip-vertical-C7KM2uhW.js";import"./RichTextEditor-C7wVn9af.js";import"./isEqual-CNuizy--.js";import"./key-DjASkOSv.js";import"./arrow-left-C8Vr4pQL.js";import"./arrow-right-C8aWUe0g.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=de("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=de("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=de("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]),Us=()=>e.jsxs("div",{className:"min-h-screen bg-background pb-8",children:[e.jsxs("div",{className:"relative h-[30vh] sm:h-[35vh] overflow-hidden",children:[e.jsx(l,{className:"w-full h-full rounded-none"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/80 to-transparent"}),e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx(l,{className:"h-10 w-10 rounded-md"})}),e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[e.jsx(l,{className:"h-10 w-10 rounded-md"}),e.jsx(l,{className:"h-10 w-10 rounded-md"})]})]}),e.jsxs("div",{className:"container mx-auto px-4 -mt-16 relative z-10",children:[e.jsxs(R,{className:"shadow-large",children:[e.jsx(I,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-3 flex flex-wrap gap-2",children:[e.jsx(l,{className:"h-6 w-16 rounded-full"}),e.jsx(l,{className:"h-6 w-20 rounded-full"}),e.jsx(l,{className:"h-6 w-14 rounded-full"})]}),e.jsx(l,{className:"h-9 w-64 mb-3"}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx(l,{className:"h-5 w-20"}),e.jsx(l,{className:"h-5 w-24"}),e.jsx(l,{className:"h-5 w-16"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{className:"h-10 w-28 rounded-md"}),e.jsx(l,{className:"h-10 w-10 rounded-md"})]})]})}),e.jsxs($,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"h-5 w-24"}),e.jsx(l,{className:"h-16 w-full rounded-md"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"h-5 w-32"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{className:"h-8 w-24 rounded-full"}),e.jsx(l,{className:"h-8 w-28 rounded-full"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(l,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(l,{className:"h-5 w-full"}),e.jsx(l,{className:"h-5 w-3/4"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{className:"h-5 w-5 flex-shrink-0"}),e.jsx(l,{className:"h-5 w-32"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(l,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(l,{className:"h-5 w-40"}),e.jsx(l,{className:"h-5 w-48"})]})]})]})]})]}),e.jsxs(R,{className:"mt-6 shadow-large",children:[e.jsx(I,{children:e.jsx(l,{className:"h-6 w-20"})}),e.jsx($,{children:e.jsx(l,{className:"h-[200px] w-full rounded-lg"})})]}),e.jsxs(R,{className:"mt-6 shadow-large",children:[e.jsx(I,{children:e.jsx(l,{className:"h-6 w-24"})}),e.jsx($,{children:e.jsx("div",{className:"flex gap-3 overflow-hidden",children:[1,2,3,4].map(c=>e.jsx(l,{className:"h-24 w-24 rounded-lg flex-shrink-0"},c))})})]}),e.jsxs(R,{className:"mt-6 shadow-large",children:[e.jsxs(I,{className:"flex flex-row items-center justify-between",children:[e.jsx(l,{className:"h-6 w-32"}),e.jsx(l,{className:"h-9 w-24 rounded-md"})]}),e.jsx($,{className:"space-y-4",children:[1,2,3].map(c=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx(l,{className:"h-10 w-10 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{className:"h-4 w-24"}),e.jsx(l,{className:"h-4 w-16"})]}),e.jsx(l,{className:"h-4 w-full"}),e.jsx(l,{className:"h-4 w-3/4"})]})]},c))})]})]})]}),Ks=[{value:"0-5",label:"0-5€"},{value:"5-10",label:"5-10€"},{value:"10-15",label:"10-15€"},{value:"15-20",label:"15-20€"},{value:"20-25",label:"20-25€"},{value:"25-30",label:"25-30€"},{value:"30-40",label:"30-40€"},{value:"40-50",label:"40-50€"},{value:"50+",label:"50€+"}],Bs=({restaurantId:c})=>{var N;const{t:u}=Z(),{data:t}=Ae(c,"restaurant"),d=(t==null?void 0:t.filter(i=>i.rating_value))||[],g=d.length?d.reduce((i,p)=>i+(p.rating_value||0),0)/d.length:0,x=[5,4,3,2,1].map(i=>({star:i,count:d.filter(p=>p.rating_value===i).length,percentage:d.length?(d.filter(p=>p.rating_value===i).length/d.length*100).toFixed(0):0})),j=d.reduce((i,p)=>(p.price_range&&(i[p.price_range]=(i[p.price_range]||0)+1),i),{}),b=j&&Object.keys(j).length>0?Object.entries(j).sort((i,p)=>p[1]-i[1])[0]:null;return e.jsxs(R,{children:[e.jsx(I,{children:e.jsx(me,{children:u("restaurant.rating")})}),e.jsxs($,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-5xl font-bold",children:g.toFixed(1)}),e.jsx("div",{className:"flex items-center justify-center mt-2",children:[1,2,3,4,5].map(i=>e.jsx(ce,{className:Qe("w-5 h-5",i<=Math.round(g)?"fill-accent text-accent":"text-muted-foreground")},i))}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[d.length," ",u("restaurant.ratingsCount")]}),b&&e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-2 text-sm",children:[e.jsx(Ns,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-foreground",children:(N=Ks.find(i=>i.value===b[0]))==null?void 0:N.label})]})]}),e.jsx("div",{className:"flex-1 space-y-2",children:x.map(({star:i,count:p,percentage:_})=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs("span",{className:"w-8",children:[i," ★"]}),e.jsx("div",{className:"flex-1 h-2 bg-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-accent transition-all",style:{width:`${_}%`}})}),e.jsx("span",{className:"w-12 text-right text-muted-foreground",children:p})]},i))})]}),e.jsx("div",{className:"pt-4 border-t text-center text-sm text-muted-foreground",children:u("restaurant.signInToRate")})]})]})},Xs=c=>(Z(),Ze({queryKey:["restaurant-activities",c],queryFn:async()=>{const{data:u,error:t}=await es.from("activity_restaurants").select(`
          activity_id,
          activities (
            id,
            title_zh,
            title_en,
            title_pt,
            intro_zh,
            intro_en,
            intro_pt,
            badge_text_zh,
            badge_text_en,
            badge_text_pt,
            badge_color,
            start_date,
            end_date
          )
        `).eq("restaurant_id",c);if(t)throw t;const d=new Date;return u.filter(x=>{const j=x.activities;if(!j)return!1;const b=new Date(j.start_date),N=j.end_date?new Date(j.end_date):null;return b<=d&&(!N||N>=d)}).map(x=>({activity_id:x.activity_id,title_zh:x.activities.title_zh,title_en:x.activities.title_en,title_pt:x.activities.title_pt,intro_zh:x.activities.intro_zh,intro_en:x.activities.intro_en,intro_pt:x.activities.intro_pt,badge_text_zh:x.activities.badge_text_zh,badge_text_en:x.activities.badge_text_en,badge_text_pt:x.activities.badge_text_pt,badge_color:x.activities.badge_color}))},enabled:!!c})),Ys=(c,u)=>u==="zh"?c.title_zh:u==="pt"?c.title_pt:c.title_en,Te=(c,u)=>{let t="";return u==="zh"?t=c.badge_text_zh||c.title_zh:u==="pt"?t=c.badge_text_pt||c.title_pt:t=c.badge_text_en||c.title_en,t},Js=(c,u)=>u==="zh"?c.intro_zh||"":u==="pt"?c.intro_pt||"":c.intro_en||"",Oe="dish-gallery-view-mode";function Qs({restaurantId:c,showGallery:u=!0}){var k;const{t}=Z(),{data:d=[],isLoading:g}=Rs(c),[x,j]=n.useState(!1),[b,N]=n.useState(0),[i,p]=n.useState(!1),_=Pe(),[y,B]=n.useState(()=>{if(typeof window<"u"){const m=localStorage.getItem(Oe);return m==="single"||m==="multi"?m:"multi"}return"multi"});n.useEffect(()=>{localStorage.setItem(Oe,y)},[y]);const C=n.useCallback(m=>{N(m),j(!0)},[]),T=n.useCallback(()=>{j(!1)},[]),L=n.useCallback(()=>{N(m=>m===0?d.length-1:m-1)},[d.length]),O=n.useCallback(()=>{N(m=>m===d.length-1?0:m+1)},[d.length]),A=n.useCallback(m=>{m.key==="ArrowLeft"&&L(),m.key==="ArrowRight"&&O(),m.key==="Escape"&&T()},[L,O,T]);if(g||!u||!d.length)return null;const ee=()=>_&&y==="single"?"pl-2 basis-full":"pl-2 md:pl-4 basis-1/2 md:basis-1/3 lg:basis-1/4";return e.jsxs(e.Fragment,{children:[e.jsx(R,{children:e.jsxs(H,{open:!i,onOpenChange:m=>p(!m),children:[e.jsx(I,{className:"pb-3",children:e.jsx(U,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(me,{className:"text-lg flex items-center gap-2",children:[e.jsx(As,{className:"w-5 h-5"}),t("restaurant.photoGallery"),e.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["(",d.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[_&&e.jsxs("div",{className:"flex items-center gap-1 bg-muted rounded-md p-0.5",onClick:m=>m.stopPropagation(),children:[e.jsx(v,{variant:y==="single"?"default":"ghost",size:"icon",className:"h-7 w-7",onClick:m=>{m.stopPropagation(),B("single")},title:t("dishImages.singleView"),children:e.jsx(Vs,{className:"h-4 w-4"})}),e.jsx(v,{variant:y==="multi"?"default":"ghost",size:"icon",className:"h-7 w-7",onClick:m=>{m.stopPropagation(),B("multi")},title:t("dishImages.multiView"),children:e.jsx(Ws,{className:"h-4 w-4"})})]}),e.jsx(V,{className:`w-5 h-5 text-muted-foreground transition-transform ${i?"":"rotate-180"}`})]})]})})}),e.jsx(K,{children:e.jsxs($,{children:[e.jsxs($s,{className:"w-full",children:[e.jsx(Ls,{className:"-ml-2 md:-ml-4",children:d.map((m,S)=>e.jsx(Ms,{className:ee(),children:e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>C(S),children:e.jsx("img",{src:m.image_url,alt:`Dish ${S+1}`,className:"w-full h-full object-cover",loading:"lazy"})})},m.id))}),d.length>(_&&y==="single"?1:2)&&e.jsxs(e.Fragment,{children:[e.jsx(Ts,{className:"-left-3 md:-left-4"}),e.jsx(Os,{className:"-right-3 md:-right-4"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2 text-center",children:t("dishImages.clickToEnlarge")})]})})]})}),e.jsx(ss,{open:x,onOpenChange:j,children:e.jsx(ts,{className:"max-w-[95vw] max-h-[95vh] p-0 bg-black/95 border-none",onKeyDown:A,children:e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center min-h-[50vh]",children:[e.jsx(v,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 z-50 text-white hover:bg-white/20",onClick:T,children:e.jsx(as,{className:"w-6 h-6"})}),d.length>1&&e.jsx(v,{variant:"ghost",size:"icon",className:"absolute left-2 z-50 text-white hover:bg-white/20 h-12 w-12",onClick:L,children:e.jsx(Ee,{className:"w-8 h-8"})}),e.jsx("img",{src:(k=d[b])==null?void 0:k.image_url,alt:`Dish ${b+1}`,className:"max-w-full max-h-[85vh] object-contain"}),d.length>1&&e.jsx(v,{variant:"ghost",size:"icon",className:"absolute right-2 z-50 text-white hover:bg-white/20 h-12 w-12",onClick:O,children:e.jsx(rs,{className:"w-8 h-8"})}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-white bg-black/50 px-3 py-1 rounded-full text-sm",children:[b+1," / ",d.length]})]})})})]})}const Zs=n.lazy(()=>ns(()=>import("./RestaurantComments-DMvtChP_.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Wt=()=>{var ve,be;const{id:c}=ls(),u=is(),{t,i18n:d}=Z(),{user:g}=os(),{localizeRestaurant:x,getLocalizedField:j}=vs(),b=Pe(),N=n.useRef(null),i=n.useRef(null),[p,_]=n.useState(null),[y,B]=n.useState(!1),[C,T]=n.useState(!0),[L,O]=n.useState(!1),[A,ee]=n.useState(!1),[k,m]=n.useState(!0),[S,Fe]=n.useState(!0),[se,et]=n.useState(!1),te=n.useRef(null),ae=n.useRef(null),[qe,re]=n.useState(!1),[Ge,X]=n.useState(!1),[We,he]=n.useState(!1),Ve=cs();Ds({pageType:"restaurant",targetId:c});const ue=(ve=u.state)==null?void 0:ve.fromActivity,xe=((be=u.state)==null?void 0:be.from)==="admin"?"/admin/restaurants":ue?`/activity/${ue}`:"/restaurants",{data:s,isLoading:He}=ps(c),{data:Ue=[]}=fs(),{data:D}=Ae(c,"restaurant",{enabled:S}),ge=js(),{role:tt,isAdmin:pe}=ds(),{data:Ke=[]}=zs(),{data:ne=[]}=Xs(c),fe=s&&Ke.some(a=>a.id===s.id),f=s?x(s):null,Be=s?Ue.includes(s.id):!1;n.useMemo(()=>[{value:"€",label:"€ (0-10€)"},{value:"€€",label:"€€ (10-20€)"},{value:"€€€",label:"€€€ (20€+)"}],[]);const M=n.useMemo(()=>{const a={};return D==null||D.forEach(r=>{r.price_range&&(a[r.price_range]||(a[r.price_range]={count:0,latestDate:r.created_at}),a[r.price_range].count+=1,r.created_at>a[r.price_range].latestDate&&(a[r.price_range].latestDate=r.created_at))}),a},[D]),je=n.useMemo(()=>M?Object.values(M).reduce((a,r)=>a+r.count,0):0,[M]),Ne=n.useMemo(()=>{var r;return!M||je<10?null:((r=Object.entries(M).sort(([,h],[,o])=>o.count!==h.count?o.count-h.count:o.latestDate.localeCompare(h.latestDate))[0])==null?void 0:r[0])||null},[M,je]),{ratingCount:le,averageRating:Xe}=n.useMemo(()=>{const a=(D==null?void 0:D.filter(o=>o.rating_value))||[],r=a.length,h=r>0?a.reduce((o,w)=>o+(w.rating_value||0),0)/r:0;return{ratingCount:r,averageRating:h}},[D]);n.useEffect(()=>{s&&_s().then(a=>{const r=Cs(a.coords.latitude,a.coords.longitude,s.lat,s.lng);_(r)}).catch(()=>{_(null)})},[s]);const Ye=n.useCallback(()=>{!g||!s||ge.mutate(s.id)},[g,s,ge]),P=n.useCallback(async()=>{try{await navigator.clipboard.writeText(window.location.href),F.success(t("common.linkCopied"))}catch(a){console.error("Error copying link:",a),F.error(t("common.shareError"))}},[t]),we=n.useCallback(async()=>{if(!s||!f)return;const a={title:f.name,text:`${f.name} - Xiaoxiong Market

${f.description||f.address}`,url:window.location.href};try{navigator.share&&navigator.canShare&&navigator.canShare(a)?(await navigator.share(a),F.success(t("common.shareSuccess"))):P()}catch(r){r.name!=="AbortError"&&(console.error("Error sharing:",r),F.error(t("common.shareError")))}},[s,f,P,t]),E=n.useCallback(a=>{if(!s||!f)return;const r=encodeURIComponent(window.location.href),h=encodeURIComponent(f.name);let o="";switch(a){case"whatsapp":o=`https://wa.me/?text=${h}%20${r}`;break;case"facebook":o=`https://www.facebook.com/sharer/sharer.php?u=${r}`;break;case"twitter":o=`https://twitter.com/intent/tweet?text=${h}&url=${r}`;break;case"telegram":o=`https://t.me/share/url?url=${r}&text=${h}`;break;case"wechat":P(),F.info(t("common.shareVia")+" WeChat");return;default:return}Me()?window.location.href=o:window.open(o,"_blank","width=600,height=400")},[s,f,P,t]);return n.useEffect(()=>{const a=new IntersectionObserver(h=>{h.forEach(o=>{o.isIntersecting&&!k&&m(!0)})},{rootMargin:"100px"}),r=new IntersectionObserver(h=>{h.forEach(o=>{o.isIntersecting&&!S&&Fe(!0)})},{rootMargin:"200px"});return te.current&&a.observe(te.current),ae.current&&r.observe(ae.current),()=>{a.disconnect(),r.disconnect()}},[k,S]),n.useEffect(()=>{if(!N.current||!s||!k||!C||i.current)return;const a="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g",r=()=>{if(!N.current)return;const h=N.current.getBoundingClientRect();if(h.width===0||h.height===0){setTimeout(r,100);return}Q.accessToken=a,i.current=new Q.Map({container:N.current,style:"mapbox://styles/mapbox/light-v11",center:[s.lng,s.lat],zoom:15,cooperativeGestures:!0});const o=document.createElement("div");o.style.backgroundImage=`url(${Ss})`,o.style.width="40px",o.style.height="40px",o.style.backgroundSize="contain",o.style.backgroundRepeat="no-repeat",o.style.backgroundPosition="center",o.style.cursor="pointer",new Q.Marker({element:o}).setLngLat([s.lng,s.lat]).addTo(i.current),i.current.addControl(new Q.NavigationControl)};return setTimeout(r,50),()=>{var h;(h=i.current)==null||h.remove(),i.current=null}},[s,k,C]),n.useEffect(()=>{if(C&&i.current){const a=setTimeout(()=>{var r,h;(r=i.current)==null||r.resize(),s&&((h=i.current)==null||h.setCenter([s.lng,s.lat]))},350);return()=>clearTimeout(a)}},[C,s]),He?e.jsx(Us,{}):!s||!f?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl text-muted-foreground",children:t("error.notFound")}),e.jsx(v,{asChild:!0,className:"mt-4",children:e.jsx(ie,{to:xe,children:t("common.back")})})]})}):e.jsxs("div",{className:"min-h-screen bg-secondary/20",children:[e.jsxs("div",{className:"relative h-[33vh] overflow-hidden bg-muted",children:[e.jsx("img",{src:s.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80",alt:f.name,className:"w-full h-full object-cover",loading:"eager"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),e.jsx(v,{asChild:!0,variant:"secondary",size:"icon",className:"absolute top-4 left-4",children:e.jsx(ie,{to:xe,children:e.jsx(Ee,{className:"w-5 h-5"})})}),g&&e.jsx(v,{variant:"secondary",size:"icon",className:"absolute top-4 right-4",onClick:Ye,children:e.jsx(Ps,{className:`w-5 h-5 ${Be?"fill-destructive text-destructive":""}`})}),b&&navigator.share?e.jsx(v,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${g?"right-16":"right-4"}`,onClick:()=>{if(!g){X(!0);return}we()},children:e.jsx(G,{className:"w-5 h-5"})}):e.jsxs(ms,{children:[e.jsx(hs,{asChild:!0,children:e.jsx(v,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${g?"right-16":"right-4"}`,onClick:a=>{g||(a.preventDefault(),X(!0))},children:e.jsx(G,{className:"w-5 h-5"})})}),e.jsxs(us,{align:"end",className:"w-48",children:[navigator.share&&e.jsxs(e.Fragment,{children:[e.jsxs(z,{onClick:we,children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),t("common.moreOptions")]}),e.jsx(ye,{})]}),e.jsxs(z,{onClick:()=>E("wechat"),children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"WeChat"]}),e.jsxs(z,{onClick:()=>E("whatsapp"),children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),e.jsxs(z,{onClick:()=>E("facebook"),children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Facebook"]}),e.jsxs(z,{onClick:()=>E("twitter"),children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"X (Twitter)"]}),e.jsxs(z,{onClick:()=>E("telegram"),children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Telegram"]}),e.jsx(ye,{}),e.jsxs(z,{onClick:P,children:[e.jsx(Es,{className:"w-4 h-4 mr-2"}),t("common.copyLink")]})]})]}),(fe||pe)&&s&&e.jsx(Is,{restaurant:s,trigger:e.jsx(v,{variant:"secondary",size:"icon",className:`absolute top-4 ${g?"right-28":"right-16"}`,children:e.jsx(Fs,{className:"w-5 h-5"})})}),s&&e.jsx(ws,{targetType:"restaurant",targetId:s.id,onLoginRequired:()=>X(!0),trigger:e.jsx(v,{variant:"secondary",size:"icon",className:`absolute top-4 ${fe||pe?g?"right-40":"right-28":g?"right-28":"right-16"}`,children:e.jsx(qs,{className:"w-5 h-5"})})})]}),e.jsx("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12",children:e.jsxs(R,{className:"shadow-large",children:[e.jsx(I,{children:e.jsx("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 flex flex-wrap gap-2",children:f.type.slice(0,3).map((a,r)=>e.jsx(oe,{variant:"secondary",children:a},r))}),e.jsx(me,{className:"text-3xl mb-2",children:f.name}),e.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[p!==null&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Le,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"font-semibold text-base",children:[p.toFixed(1)," km"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:`w-5 h-5 ${le>0?"fill-accent text-accent":"text-muted-foreground"}`}),le>0?e.jsxs("span",{className:"font-semibold text-base",children:[Xe.toFixed(1),e.jsxs("span",{className:"text-muted-foreground font-normal text-sm ml-1",children:["(",le,")"]})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:t("restaurant.noRatingWithHint")})]}),Ne&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Hs,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-base",children:Ne})]})]}),f.description&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline",dangerouslySetInnerHTML:{__html:f.description}})]})})}),e.jsxs($,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[ne.length>0&&e.jsxs(H,{open:A,onOpenChange:ee,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(ce,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(U,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:t("activities.title")}),!A&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-1",children:ne.map((a,r)=>e.jsx(oe,{variant:"default",className:"text-white",style:{backgroundColor:a.badge_color||"#9b87f5"},children:Te(a,d.language)},`activity-${r}`))})]}),e.jsx(V,{className:`w-5 h-5 text-muted-foreground transition-transform ${A?"rotate-180":""}`})]})}),e.jsx(K,{className:"mt-3 space-y-2",children:ne.map((a,r)=>{const h=Js(a,d.language);return e.jsxs(ie,{to:`/activity/${a.activity_id}`,className:"block p-2 rounded-md hover:bg-muted/80 transition-colors",children:[e.jsx(oe,{variant:"default",className:"text-white mr-2",style:{backgroundColor:a.badge_color||"#9b87f5"},children:Te(a,d.language)}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[h||Ys(a,d.language)," ... →"]})]},`activity-detail-${r}`)})})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(xs,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-card-foreground",children:t("restaurant.address")}),e.jsx("p",{className:"text-muted-foreground",children:s.address})]})]}),s.phone&&e.jsxs("a",{href:`tel:${s.phone}`,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors cursor-pointer",children:[e.jsx(gs,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-card-foreground",children:t("restaurant.phone")}),e.jsx("p",{className:"text-primary underline",children:s.phone})]})]}),s.opening_hours&&e.jsxs(H,{open:y,onOpenChange:B,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(Gs,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(U,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:t("restaurant.hours")}),!y&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-0.5",children:[t("restaurant.today")," ",bs(s.opening_hours)]})]}),e.jsx(V,{className:`w-5 h-5 text-muted-foreground transition-transform ${y?"rotate-180":""}`})]})}),e.jsx(K,{className:"mt-3",children:e.jsx("div",{className:"space-y-2",children:(()=>{const a=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],r={monday:"dayMon",tuesday:"dayTue",wednesday:"dayWed",thursday:"dayThu",friday:"dayFri",saturday:"daySat",sunday:"daySun"},h=a[new Date().getDay()===0?6:new Date().getDay()-1];return a.map(o=>{const w=s.opening_hours[o],Y=o===h,Je=t(`restaurant.${r[o]}`);let J="N/A";return w&&(w.closed?J=t("restaurant.closed"):w.splitShift?J=`${w.open} - ${w.close}, ${w.open2} - ${w.close2}`:J=`${w.open} - ${w.close}`),e.jsxs("div",{className:`flex justify-between items-center py-1.5 px-2 rounded ${Y?"bg-primary/10 border border-primary/20":""}`,children:[e.jsxs("span",{className:`text-sm font-medium ${Y?"text-primary":"text-foreground"}`,children:[Je,Y&&e.jsxs("span",{className:"ml-2 text-xs",children:["(",t("restaurant.today"),")"]})]}),e.jsx("span",{className:`text-sm ${Y?"text-primary font-semibold":"text-muted-foreground"} ${w!=null&&w.closed?"italic":""}`,children:J})]},o)})})()})})]})]}),s&&(j(s,"announcement")||s.announcement_zh)&&e.jsxs(H,{open:L,onOpenChange:O,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(W,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(U,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:t("restaurant.announcement")}),e.jsx(V,{className:`w-5 h-5 text-muted-foreground transition-transform ${L?"rotate-180":""}`})]})}),e.jsx(K,{className:"mt-3",children:e.jsx("div",{className:"p-3 rounded-md bg-primary/5 border border-primary/10",children:e.jsx("p",{className:"text-sm text-foreground whitespace-pre-wrap",children:j(s,"announcement")||s.announcement_zh})})})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(v,{variant:"secondary",className:"w-full",onClick:()=>re(!0),children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),t("restaurant.getDirections")]}),s.show_website_button&&s.website_url&&e.jsxs(v,{className:"w-full",disabled:se,onClick:()=>he(!0),children:[se?e.jsx(q,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(W,{className:"w-4 h-4 mr-2"}),t("restaurant.joinPrivate")]})]}),e.jsx(ys,{open:qe,onOpenChange:re,onConfirm:()=>{ks(s.lat,s.lng,f.name),re(!1)},destinationName:f.name}),e.jsx(_e,{open:We,onOpenChange:he,children:e.jsxs(Ce,{children:[e.jsxs(ke,{children:[e.jsx(De,{children:t("restaurant.joinPrivateTitle")}),e.jsx(Se,{children:t("restaurant.joinPrivateDescription")})]}),e.jsxs(ze,{children:[e.jsx(Re,{children:t("common.cancel")}),e.jsxs(Ie,{onClick:()=>{const a=new URL(s.website_url);g&&a.searchParams.set("user_id",g.id);const r=a.toString();Me()?window.location.href=r:window.open(r,"_blank")},children:[se?e.jsx(q,{className:"w-4 h-4 mr-2 animate-spin"}):null,t("restaurant.joinPrivateConfirm")]})]})]})}),e.jsx(Qs,{restaurantId:s.id,showGallery:s.show_dish_gallery!==!1}),e.jsx("div",{ref:te,children:e.jsxs(H,{open:C,onOpenChange:T,className:"p-4 rounded-lg bg-muted/50",children:[e.jsx(U,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:t("restaurant.map")}),e.jsx(V,{className:`w-5 h-5 text-muted-foreground transition-transform ${C?"rotate-180":""}`})]})}),e.jsx(K,{children:k?e.jsx("div",{ref:N,className:"h-[350px] rounded-lg overflow-hidden bg-muted"}):e.jsx("div",{className:"h-[350px] rounded-lg bg-muted flex items-center justify-center",children:e.jsx(q,{className:"w-6 h-6 animate-spin text-muted-foreground"})})})]})}),e.jsx($e,{}),e.jsx(Bs,{restaurantId:s.id}),e.jsx($e,{}),e.jsx("div",{ref:ae,children:S?e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(q,{className:"w-8 h-8 animate-spin text-primary"})}),children:e.jsx(Zs,{restaurantId:s.id})}):e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(q,{className:"w-8 h-8 animate-spin text-muted-foreground"})})})]})]})}),e.jsx(_e,{open:Ge,onOpenChange:X,children:e.jsxs(Ce,{children:[e.jsxs(ke,{children:[e.jsx(De,{children:t("activities.loginRequired")}),e.jsx(Se,{children:t("activities.loginRequiredMessage")})]}),e.jsxs(ze,{children:[e.jsx(Re,{children:t("common.cancel")}),e.jsx(Ie,{onClick:()=>Ve("/auth"),children:t("activities.goToLogin")})]})]})})]})};export{Wt as default};
