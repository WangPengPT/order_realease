import{p as le,q as de,r as j,s as K,v as ce,j as e,aL as O,ca as R,bh as oe,c1 as me,bA as xe,bZ as he,cl as pe,cm as w,cn as ue,co as P,cp as I,cq as Q,cr as N,ct as je,cM as fe,cN as V,cO as H,cP as z,cu as ge,cv as ve,b7 as ye,aZ as we,b3 as X,w as C}from"./vendor-react-Snp1tga-.js";import{C as i,v as n,M as l,$ as h,w as d,I as Z,B as p,P as Ne,Q as Ce,R as Se,T as f,k as G,D as be,d as De,e as _e,f as Re,V as ke,a2 as Fe,a3 as Le,a4 as Te,a5 as Ae,a6 as S,a8 as $e,s as b}from"./index-sfQV7kES.js";import{f as W,s as Ee,D as k,H as Me}from"./vendor-utils-Z4kpnli5.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-D3137XJ9.js";const Qe=()=>{const{t:s}=le(),F=de(),[r,g]=j.useState(null),[L,T]=j.useState(""),[A,$]=j.useState(""),[E,Y]=j.useState(""),[v,u]=j.useState("all"),{data:c,isLoading:J}=K({queryKey:["admin-reports"],queryFn:async()=>{const{data:a,error:t}=await b.from("reports").select(`
          *,
          reporter:profiles(display_name, avatar_url)
        `).order("created_at",{ascending:!1});if(t)throw t;return a}}),{data:D}=K({queryKey:["emailConfig","report"],queryFn:async()=>{const{data:a,error:t}=await b.from("email_config").select("*").eq("type","report").single();if(t)throw t;return a}}),M=c?.filter(a=>{const t=E.toLowerCase(),m=a.description.toLowerCase().includes(t)||a.reporter?.display_name?.toLowerCase().includes(t)||a.reason.toLowerCase().includes(t),x=v==="all"||a.status===v;return m&&x}),o={total:c?.length||0,pending:c?.filter(a=>a.status==="pending").length||0,reviewing:c?.filter(a=>a.status==="reviewing").length||0,resolved:c?.filter(a=>a.status==="resolved").length||0,dismissed:c?.filter(a=>a.status==="dismissed").length||0},ee=Array.from({length:7},(a,t)=>{const m=W(Ee(new Date,6-t)),x=k(m,"yyyy-MM-dd"),y=c?.filter(ne=>k(W(new Date(ne.created_at)),"yyyy-MM-dd")===x).length||0;return{date:k(m,"MM/dd"),count:y}}),B=["spam","harassment","inappropriate_content","misinformation","copyright","fraud","hate_speech","violence","other"].map(a=>({name:s(`report.reasons.${a}`),value:c?.filter(t=>t.reason===a).length||0})).filter(a=>a.value>0),se=["comment","restaurant","activity","user"].map(a=>({name:s(`admin.reportType.${a}`),value:c?.filter(t=>t.target_type===a).length||0})).filter(a=>a.value>0),q=["#016450","#018a6f","#4CAF50","#81C784","#FFA726","#FF7043","#EF5350","#EC407A","#AB47BC"],ae=async()=>{const a=prompt(s("joinUs.enterNewEmail"),D?.recipient_email);if(a)try{const{error:t}=await b.from("email_config").update({recipient_email:a}).eq("id",D?.id);if(t)throw t;F.invalidateQueries({queryKey:["emailConfig"]}),C.success(s("joinUs.emailUpdated"))}catch(t){console.error("Error updating email:",t),C.error(s("joinUs.emailUpdateError"))}},_=ce({mutationFn:async({id:a,status:t,notes:m})=>{const x={updated_at:new Date().toISOString()};t&&(x.status=t),m!==void 0&&(x.admin_notes=m);const{error:y}=await b.from("reports").update(x).eq("id",a);if(y)throw y},onSuccess:()=>{F.invalidateQueries({queryKey:["admin-reports"]}),C.success(s("toast.reportUpdatedSuccess")),g(null)},onError:a=>{C.error(a.message||s("toast.reportUpdateFailed"))}}),U=a=>{const t={pending:"default",reviewing:"secondary",resolved:"default",dismissed:"destructive"};return e.jsx(G,{variant:t[a]||"default",children:s(`admin.reportStatus.${a}`)})},te=(a,t)=>{switch(a){case"restaurant":return`/restaurant/${t}`;case"activity":return`/activity/${t}`;case"comment":return"#";case"user":return"/profile";default:return"#"}},re=a=>{g(a),T(a.admin_notes||""),$(a.status)},ie=()=>{r&&_.mutate({id:r.id,status:A,notes:L})};return J?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(O,{className:"w-8 h-8 animate-spin"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:s("admin.reports")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:s("admin.reportsDescription")})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsx(l,{children:s("joinUs.recipientEmail")}),e.jsx(h,{children:s("joinUs.recipientEmailDesc")})]}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Z,{value:D?.recipient_email||"",readOnly:!0}),e.jsx(p,{onClick:ae,children:s("common.edit")})]})})]}),e.jsxs(i,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:s("admin.totalReports")}),e.jsx(R,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.total}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("admin.allReportsCount")})]})]}),e.jsxs(i,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:s("admin.reportStatus.pending")}),e.jsx(oe,{className:"h-4 w-4 text-yellow-500"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.pending}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("admin.awaitingReview")})]})]}),e.jsxs(i,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:s("admin.reportStatus.reviewing")}),e.jsx(me,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.reviewing}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("admin.underReview")})]})]}),e.jsxs(i,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:s("admin.reportStatus.resolved")}),e.jsx(xe,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.resolved}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("admin.resolvedReports")})]})]}),e.jsxs(i,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:s("admin.reportStatus.dismissed")}),e.jsx(he,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.dismissed}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("admin.dismissedReports")})]})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-primary"}),e.jsx(l,{children:s("admin.reportsTrend")})]}),e.jsx(h,{children:s("admin.reportsTrendDesc")})]}),e.jsx(d,{children:e.jsx(w,{width:"100%",height:300,children:e.jsxs(ue,{data:ee,children:[e.jsx(P,{strokeDasharray:"3 3"}),e.jsx(I,{dataKey:"date"}),e.jsx(Q,{}),e.jsx(N,{}),e.jsx(je,{type:"monotone",dataKey:"count",stroke:"hsl(var(--primary))",strokeWidth:2,name:s("admin.reportsCount")})]})})})]}),e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-primary"}),e.jsx(l,{children:s("admin.reportsReasonDist")})]}),e.jsx(h,{children:s("admin.reportsReasonDistDesc")})]}),e.jsx(d,{children:e.jsx(w,{width:"100%",height:300,children:e.jsxs(V,{children:[e.jsx(H,{data:B,cx:"50%",cy:"50%",labelLine:!1,label:({name:a,percent:t})=>`${a}: ${(t*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:B.map((a,t)=>e.jsx(z,{fill:q[t%q.length]},`cell-${t}`))}),e.jsx(N,{})]})})})]}),e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsx(l,{children:s("admin.reportsTypeDist")}),e.jsx(h,{children:s("admin.reportsTypeDistDesc")})]}),e.jsx(d,{children:e.jsx(w,{width:"100%",height:300,children:e.jsxs(ge,{data:se,children:[e.jsx(P,{strokeDasharray:"3 3"}),e.jsx(I,{dataKey:"name"}),e.jsx(Q,{}),e.jsx(N,{}),e.jsx(ve,{dataKey:"value",fill:"hsl(var(--primary))",name:s("admin.reportsCount")})]})})})]}),e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsx(l,{children:s("admin.reportsStatusDist")}),e.jsx(h,{children:s("admin.reportsStatusDistDesc")})]}),e.jsx(d,{children:e.jsx(w,{width:"100%",height:300,children:e.jsxs(V,{children:[e.jsx(H,{data:[{name:s("admin.reportStatus.pending"),value:o.pending},{name:s("admin.reportStatus.reviewing"),value:o.reviewing},{name:s("admin.reportStatus.resolved"),value:o.resolved},{name:s("admin.reportStatus.dismissed"),value:o.dismissed}].filter(a=>a.value>0),cx:"50%",cy:"50%",labelLine:!1,label:({name:a,percent:t})=>`${a}: ${(t*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:[{color:"#FFA726"},{color:"#42A5F5"},{color:"#66BB6A"},{color:"#EF5350"}].map((a,t)=>e.jsx(z,{fill:a.color},`cell-${t}`))}),e.jsx(N,{})]})})})]})]}),e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(l,{children:s("admin.allReports")}),e.jsx(h,{children:s("admin.manageReportsDesc")})]})}),e.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Z,{placeholder:s("admin.searchReports"),value:E,onChange:a=>Y(a.target.value),className:"pl-10"})]}),e.jsxs(Ne,{children:[e.jsx(Ce,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:"gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),s(v==="all"?"admin.allStatus":`admin.reportStatus.${v}`)]})}),e.jsxs(Se,{align:"end",className:"bg-background",children:[e.jsx(f,{onClick:()=>u("all"),children:s("admin.allStatus")}),e.jsx(f,{onClick:()=>u("pending"),children:s("admin.reportStatus.pending")}),e.jsx(f,{onClick:()=>u("reviewing"),children:s("admin.reportStatus.reviewing")}),e.jsx(f,{onClick:()=>u("resolved"),children:s("admin.reportStatus.resolved")}),e.jsx(f,{onClick:()=>u("dismissed"),children:s("admin.reportStatus.dismissed")})]})]})]})]}),e.jsx(d,{children:e.jsxs("div",{className:"grid gap-4",children:[M?.map(a=>e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:s(`admin.reportType.${a.target_type}`)}),U(a.status),e.jsx(G,{variant:"outline",children:s(`report.reasons.${a.reason}`)})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a.description.substring(0,150),a.description.length>150&&"..."]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[s("admin.reportedBy"),": ",a.reporter?.display_name]}),e.jsxs("span",{children:[s("admin.reportedAt"),":"," ",Me(new Date(a.created_at),{addSuffix:!0})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>re(a),children:s("admin.viewReport")}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>window.open(te(a.target_type,a.target_id),"_blank"),children:e.jsx(X,{className:"w-4 h-4"})})]})]})},a.id)),M?.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(R,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:s("admin.noReports")})]})]})})]})]}),e.jsx(be,{open:!!r,onOpenChange:()=>g(null),children:e.jsxs(De,{className:"max-w-[90vw] sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(_e,{children:[e.jsxs(Re,{children:[s("admin.viewReport")," - ",r?.id]}),e.jsx(ke,{children:s(`admin.reportType.${r?.target_type}`)})]}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[s("admin.reportedBy"),":"]})," ",r.reporter?.display_name]}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[s("admin.reportedAt"),":"]})," ",new Date(r.created_at).toLocaleString()]}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[s("report.reason"),":"]})," ",s(`report.reasons.${r.reason}`)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",U(r.status)]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:s("report.detailsLabel")}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:r.description})]}),r.reporter_contact&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:s("report.contactLabel")}),e.jsx("p",{className:"text-sm",children:r.reporter_contact})]}),r.evidence_urls&&r.evidence_urls.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:s("report.evidenceLabel")}),e.jsx("ul",{className:"space-y-1",children:r.evidence_urls.map((a,t)=>e.jsx("li",{children:e.jsxs("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline flex items-center gap-1",children:[e.jsx(X,{className:"w-3 h-3"}),a]})},t))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:s("admin.updateStatus")}),e.jsxs(Fe,{value:A,onValueChange:$,children:[e.jsx(Le,{children:e.jsx(Te,{})}),e.jsxs(Ae,{children:[e.jsx(S,{value:"pending",children:s("admin.reportStatus.pending")}),e.jsx(S,{value:"reviewing",children:s("admin.reportStatus.reviewing")}),e.jsx(S,{value:"resolved",children:s("admin.reportStatus.resolved")}),e.jsx(S,{value:"dismissed",children:s("admin.reportStatus.dismissed")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:s("admin.adminNotes")}),e.jsx($e,{value:L,onChange:a=>T(a.target.value),placeholder:"Add internal notes...",rows:4})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(p,{variant:"outline",onClick:()=>g(null),children:s("common.cancel")}),e.jsx(p,{onClick:ie,disabled:_.isPending,children:_.isPending?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-4 h-4 mr-2 animate-spin"}),s("common.loading")]}):s("admin.saveNotes")})]})]})]})})]})};export{Qe as default};
//# sourceMappingURL=AdminReports-Dopq5M8Q.js.map
